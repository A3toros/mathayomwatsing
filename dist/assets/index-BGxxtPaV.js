var MP=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var fre=MP((_re,Uy)=>{function E3(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const a=Object.getOwnPropertyDescriptor(n,s);a&&Object.defineProperty(e,s,a.get?a:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();var $y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ep(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Wv={exports:{}},jg={},zv={exports:{}},Xr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bk;function OP(){if(bk)return Xr;bk=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),i=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;function g(V){return V===null||typeof V!="object"?null:(V=p&&V[p]||V["@@iterator"],typeof V=="function"?V:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,w={};function b(V,O,W){this.props=V,this.context=O,this.refs=w,this.updater=W||y}b.prototype.isReactComponent={},b.prototype.setState=function(V,O){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,O,"setState")},b.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function E(){}E.prototype=b.prototype;function k(V,O,W){this.props=V,this.context=O,this.refs=w,this.updater=W||y}var _=k.prototype=new E;_.constructor=k,v(_,b.prototype),_.isPureReactComponent=!0;var T=Array.isArray,j=Object.prototype.hasOwnProperty,P={current:null},R={key:!0,ref:!0,__self:!0,__source:!0};function N(V,O,W){var q,Y={},ee=null,X=null;if(O!=null)for(q in O.ref!==void 0&&(X=O.ref),O.key!==void 0&&(ee=""+O.key),O)j.call(O,q)&&!R.hasOwnProperty(q)&&(Y[q]=O[q]);var ne=arguments.length-2;if(ne===1)Y.children=W;else if(1<ne){for(var ge=Array(ne),_e=0;_e<ne;_e++)ge[_e]=arguments[_e+2];Y.children=ge}if(V&&V.defaultProps)for(q in ne=V.defaultProps,ne)Y[q]===void 0&&(Y[q]=ne[q]);return{$$typeof:e,type:V,key:ee,ref:X,props:Y,_owner:P.current}}function A(V,O){return{$$typeof:e,type:V.type,key:O,ref:V.ref,props:V.props,_owner:V._owner}}function M(V){return typeof V=="object"&&V!==null&&V.$$typeof===e}function H(V){var O={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(W){return O[W]})}var Q=/\/+/g;function Z(V,O){return typeof V=="object"&&V!==null&&V.key!=null?H(""+V.key):O.toString(36)}function ae(V,O,W,q,Y){var ee=typeof V;(ee==="undefined"||ee==="boolean")&&(V=null);var X=!1;if(V===null)X=!0;else switch(ee){case"string":case"number":X=!0;break;case"object":switch(V.$$typeof){case e:case t:X=!0}}if(X)return X=V,Y=Y(X),V=q===""?"."+Z(X,0):q,T(Y)?(W="",V!=null&&(W=V.replace(Q,"$&/")+"/"),ae(Y,O,W,"",function(_e){return _e})):Y!=null&&(M(Y)&&(Y=A(Y,W+(!Y.key||X&&X.key===Y.key?"":(""+Y.key).replace(Q,"$&/")+"/")+V)),O.push(Y)),1;if(X=0,q=q===""?".":q+":",T(V))for(var ne=0;ne<V.length;ne++){ee=V[ne];var ge=q+Z(ee,ne);X+=ae(ee,O,W,ge,Y)}else if(ge=g(V),typeof ge=="function")for(V=ge.call(V),ne=0;!(ee=V.next()).done;)ee=ee.value,ge=q+Z(ee,ne++),X+=ae(ee,O,W,ge,Y);else if(ee==="object")throw O=String(V),Error("Objects are not valid as a React child (found: "+(O==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":O)+"). If you meant to render a collection of children, use an array instead.");return X}function te(V,O,W){if(V==null)return V;var q=[],Y=0;return ae(V,q,"","",function(ee){return O.call(W,ee,Y++)}),q}function se(V){if(V._status===-1){var O=V._result;O=O(),O.then(function(W){(V._status===0||V._status===-1)&&(V._status=1,V._result=W)},function(W){(V._status===0||V._status===-1)&&(V._status=2,V._result=W)}),V._status===-1&&(V._status=0,V._result=O)}if(V._status===1)return V._result.default;throw V._result}var L={current:null},G={transition:null},I={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:G,ReactCurrentOwner:P};function z(){throw Error("act(...) is not supported in production builds of React.")}return Xr.Children={map:te,forEach:function(V,O,W){te(V,function(){O.apply(this,arguments)},W)},count:function(V){var O=0;return te(V,function(){O++}),O},toArray:function(V){return te(V,function(O){return O})||[]},only:function(V){if(!M(V))throw Error("React.Children.only expected to receive a single React element child.");return V}},Xr.Component=b,Xr.Fragment=r,Xr.Profiler=s,Xr.PureComponent=k,Xr.StrictMode=n,Xr.Suspense=c,Xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,Xr.act=z,Xr.cloneElement=function(V,O,W){if(V==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+V+".");var q=v({},V.props),Y=V.key,ee=V.ref,X=V._owner;if(O!=null){if(O.ref!==void 0&&(ee=O.ref,X=P.current),O.key!==void 0&&(Y=""+O.key),V.type&&V.type.defaultProps)var ne=V.type.defaultProps;for(ge in O)j.call(O,ge)&&!R.hasOwnProperty(ge)&&(q[ge]=O[ge]===void 0&&ne!==void 0?ne[ge]:O[ge])}var ge=arguments.length-2;if(ge===1)q.children=W;else if(1<ge){ne=Array(ge);for(var _e=0;_e<ge;_e++)ne[_e]=arguments[_e+2];q.children=ne}return{$$typeof:e,type:V.type,key:Y,ref:ee,props:q,_owner:X}},Xr.createContext=function(V){return V={$$typeof:i,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},V.Provider={$$typeof:a,_context:V},V.Consumer=V},Xr.createElement=N,Xr.createFactory=function(V){var O=N.bind(null,V);return O.type=V,O},Xr.createRef=function(){return{current:null}},Xr.forwardRef=function(V){return{$$typeof:l,render:V}},Xr.isValidElement=M,Xr.lazy=function(V){return{$$typeof:f,_payload:{_status:-1,_result:V},_init:se}},Xr.memo=function(V,O){return{$$typeof:d,type:V,compare:O===void 0?null:O}},Xr.startTransition=function(V){var O=G.transition;G.transition={};try{V()}finally{G.transition=O}},Xr.unstable_act=z,Xr.useCallback=function(V,O){return L.current.useCallback(V,O)},Xr.useContext=function(V){return L.current.useContext(V)},Xr.useDebugValue=function(){},Xr.useDeferredValue=function(V){return L.current.useDeferredValue(V)},Xr.useEffect=function(V,O){return L.current.useEffect(V,O)},Xr.useId=function(){return L.current.useId()},Xr.useImperativeHandle=function(V,O,W){return L.current.useImperativeHandle(V,O,W)},Xr.useInsertionEffect=function(V,O){return L.current.useInsertionEffect(V,O)},Xr.useLayoutEffect=function(V,O){return L.current.useLayoutEffect(V,O)},Xr.useMemo=function(V,O){return L.current.useMemo(V,O)},Xr.useReducer=function(V,O,W){return L.current.useReducer(V,O,W)},Xr.useRef=function(V){return L.current.useRef(V)},Xr.useState=function(V){return L.current.useState(V)},Xr.useSyncExternalStore=function(V,O,W){return L.current.useSyncExternalStore(V,O,W)},Xr.useTransition=function(){return L.current.useTransition()},Xr.version="18.3.1",Xr}var Sk;function E1(){return Sk||(Sk=1,zv.exports=OP()),zv.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kk;function LP(){if(kk)return jg;kk=1;var e=E1(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(l,c,d){var f,p={},g=null,y=null;d!==void 0&&(g=""+d),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(y=c.ref);for(f in c)n.call(c,f)&&!a.hasOwnProperty(f)&&(p[f]=c[f]);if(l&&l.defaultProps)for(f in c=l.defaultProps,c)p[f]===void 0&&(p[f]=c[f]);return{$$typeof:t,type:l,key:g,ref:y,props:p,_owner:s.current}}return jg.Fragment=r,jg.jsx=i,jg.jsxs=i,jg}var Ck;function BP(){return Ck||(Ck=1,Wv.exports=LP()),Wv.exports}var o=BP(),C=E1();const us=Ep(C),UP=E3({__proto__:null,default:us},[C]);var ry={},Hv={exports:{}},Ti={},Gv={exports:{}},Vv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tk;function $P(){return Tk||(Tk=1,(function(e){function t(G,I){var z=G.length;G.push(I);e:for(;0<z;){var V=z-1>>>1,O=G[V];if(0<s(O,I))G[V]=I,G[z]=O,z=V;else break e}}function r(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var I=G[0],z=G.pop();if(z!==I){G[0]=z;e:for(var V=0,O=G.length,W=O>>>1;V<W;){var q=2*(V+1)-1,Y=G[q],ee=q+1,X=G[ee];if(0>s(Y,z))ee<O&&0>s(X,Y)?(G[V]=X,G[ee]=z,V=ee):(G[V]=Y,G[q]=z,V=q);else if(ee<O&&0>s(X,z))G[V]=X,G[ee]=z,V=ee;else break e}}return I}function s(G,I){var z=G.sortIndex-I.sortIndex;return z!==0?z:G.id-I.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var i=Date,l=i.now();e.unstable_now=function(){return i.now()-l}}var c=[],d=[],f=1,p=null,g=3,y=!1,v=!1,w=!1,b=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(G){for(var I=r(d);I!==null;){if(I.callback===null)n(d);else if(I.startTime<=G)n(d),I.sortIndex=I.expirationTime,t(c,I);else break;I=r(d)}}function T(G){if(w=!1,_(G),!v)if(r(c)!==null)v=!0,se(j);else{var I=r(d);I!==null&&L(T,I.startTime-G)}}function j(G,I){v=!1,w&&(w=!1,E(N),N=-1),y=!0;var z=g;try{for(_(I),p=r(c);p!==null&&(!(p.expirationTime>I)||G&&!H());){var V=p.callback;if(typeof V=="function"){p.callback=null,g=p.priorityLevel;var O=V(p.expirationTime<=I);I=e.unstable_now(),typeof O=="function"?p.callback=O:p===r(c)&&n(c),_(I)}else n(c);p=r(c)}if(p!==null)var W=!0;else{var q=r(d);q!==null&&L(T,q.startTime-I),W=!1}return W}finally{p=null,g=z,y=!1}}var P=!1,R=null,N=-1,A=5,M=-1;function H(){return!(e.unstable_now()-M<A)}function Q(){if(R!==null){var G=e.unstable_now();M=G;var I=!0;try{I=R(!0,G)}finally{I?Z():(P=!1,R=null)}}else P=!1}var Z;if(typeof k=="function")Z=function(){k(Q)};else if(typeof MessageChannel<"u"){var ae=new MessageChannel,te=ae.port2;ae.port1.onmessage=Q,Z=function(){te.postMessage(null)}}else Z=function(){b(Q,0)};function se(G){R=G,P||(P=!0,Z())}function L(G,I){N=b(function(){G(e.unstable_now())},I)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(G){G.callback=null},e.unstable_continueExecution=function(){v||y||(v=!0,se(j))},e.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<G?Math.floor(1e3/G):5},e.unstable_getCurrentPriorityLevel=function(){return g},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(G){switch(g){case 1:case 2:case 3:var I=3;break;default:I=g}var z=g;g=I;try{return G()}finally{g=z}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(G,I){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var z=g;g=G;try{return I()}finally{g=z}},e.unstable_scheduleCallback=function(G,I,z){var V=e.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?V+z:V):z=V,G){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=z+O,G={id:f++,callback:I,priorityLevel:G,startTime:z,expirationTime:O,sortIndex:-1},z>V?(G.sortIndex=z,t(d,G),r(c)===null&&G===r(d)&&(w?(E(N),N=-1):w=!0,L(T,z-V))):(G.sortIndex=O,t(c,G),v||y||(v=!0,se(j))),G},e.unstable_shouldYield=H,e.unstable_wrapCallback=function(G){var I=g;return function(){var z=g;g=I;try{return G.apply(this,arguments)}finally{g=z}}}})(Vv)),Vv}var Nk;function b2(){return Nk||(Nk=1,Gv.exports=$P()),Gv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ek;function WP(){if(Ek)return Ti;Ek=1;var e=E1(),t=b2();function r(u){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+u,S=1;S<arguments.length;S++)h+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,s={};function a(u,h){i(u,h),i(u+"Capture",h)}function i(u,h){for(s[u]=h,u=0;u<h.length;u++)n.add(h[u])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(u){return c.call(p,u)?!0:c.call(f,u)?!1:d.test(u)?p[u]=!0:(f[u]=!0,!1)}function y(u,h,S,D){if(S!==null&&S.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return D?!1:S!==null?!S.acceptsBooleans:(u=u.toLowerCase().slice(0,5),u!=="data-"&&u!=="aria-");default:return!1}}function v(u,h,S,D){if(h===null||typeof h>"u"||y(u,h,S,D))return!0;if(D)return!1;if(S!==null)switch(S.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function w(u,h,S,D,U,J,ue){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=D,this.attributeNamespace=U,this.mustUseProperty=S,this.propertyName=u,this.type=h,this.sanitizeURL=J,this.removeEmptyString=ue}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(u){b[u]=new w(u,0,!1,u,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(u){var h=u[0];b[h]=new w(h,1,!1,u[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(u){b[u]=new w(u,2,!1,u.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(u){b[u]=new w(u,2,!1,u,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(u){b[u]=new w(u,3,!1,u.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(u){b[u]=new w(u,3,!0,u,null,!1,!1)}),["capture","download"].forEach(function(u){b[u]=new w(u,4,!1,u,null,!1,!1)}),["cols","rows","size","span"].forEach(function(u){b[u]=new w(u,6,!1,u,null,!1,!1)}),["rowSpan","start"].forEach(function(u){b[u]=new w(u,5,!1,u.toLowerCase(),null,!1,!1)});var E=/[\-:]([a-z])/g;function k(u){return u[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(u){var h=u.replace(E,k);b[h]=new w(h,1,!1,u,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(u){var h=u.replace(E,k);b[h]=new w(h,1,!1,u,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(u){var h=u.replace(E,k);b[h]=new w(h,1,!1,u,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(u){b[u]=new w(u,1,!1,u.toLowerCase(),null,!1,!1)}),b.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(u){b[u]=new w(u,1,!1,u.toLowerCase(),null,!0,!0)});function _(u,h,S,D){var U=b.hasOwnProperty(h)?b[h]:null;(U!==null?U.type!==0:D||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(v(h,S,U,D)&&(S=null),D||U===null?g(h)&&(S===null?u.removeAttribute(h):u.setAttribute(h,""+S)):U.mustUseProperty?u[U.propertyName]=S===null?U.type===3?!1:"":S:(h=U.attributeName,D=U.attributeNamespace,S===null?u.removeAttribute(h):(U=U.type,S=U===3||U===4&&S===!0?"":""+S,D?u.setAttributeNS(D,h,S):u.setAttribute(h,S))))}var T=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),P=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),H=Symbol.for("react.context"),Q=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),ae=Symbol.for("react.suspense_list"),te=Symbol.for("react.memo"),se=Symbol.for("react.lazy"),L=Symbol.for("react.offscreen"),G=Symbol.iterator;function I(u){return u===null||typeof u!="object"?null:(u=G&&u[G]||u["@@iterator"],typeof u=="function"?u:null)}var z=Object.assign,V;function O(u){if(V===void 0)try{throw Error()}catch(S){var h=S.stack.trim().match(/\n( *(at )?)/);V=h&&h[1]||""}return`
`+V+u}var W=!1;function q(u,h){if(!u||W)return"";W=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(ot){var D=ot}Reflect.construct(u,[],h)}else{try{h.call()}catch(ot){D=ot}u.call(h.prototype)}else{try{throw Error()}catch(ot){D=ot}u()}}catch(ot){if(ot&&D&&typeof ot.stack=="string"){for(var U=ot.stack.split(`
`),J=D.stack.split(`
`),ue=U.length-1,Te=J.length-1;1<=ue&&0<=Te&&U[ue]!==J[Te];)Te--;for(;1<=ue&&0<=Te;ue--,Te--)if(U[ue]!==J[Te]){if(ue!==1||Te!==1)do if(ue--,Te--,0>Te||U[ue]!==J[Te]){var Ie=`
`+U[ue].replace(" at new "," at ");return u.displayName&&Ie.includes("<anonymous>")&&(Ie=Ie.replace("<anonymous>",u.displayName)),Ie}while(1<=ue&&0<=Te);break}}}finally{W=!1,Error.prepareStackTrace=S}return(u=u?u.displayName||u.name:"")?O(u):""}function Y(u){switch(u.tag){case 5:return O(u.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return u=q(u.type,!1),u;case 11:return u=q(u.type.render,!1),u;case 1:return u=q(u.type,!0),u;default:return""}}function ee(u){if(u==null)return null;if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case R:return"Fragment";case P:return"Portal";case A:return"Profiler";case N:return"StrictMode";case Z:return"Suspense";case ae:return"SuspenseList"}if(typeof u=="object")switch(u.$$typeof){case H:return(u.displayName||"Context")+".Consumer";case M:return(u._context.displayName||"Context")+".Provider";case Q:var h=u.render;return u=u.displayName,u||(u=h.displayName||h.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case te:return h=u.displayName||null,h!==null?h:ee(u.type)||"Memo";case se:h=u._payload,u=u._init;try{return ee(u(h))}catch{}}return null}function X(u){var h=u.type;switch(u.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return u=h.render,u=u.displayName||u.name||"",h.displayName||(u!==""?"ForwardRef("+u+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ee(h);case 8:return h===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function ne(u){switch(typeof u){case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function ge(u){var h=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function _e(u){var h=ge(u)?"checked":"value",S=Object.getOwnPropertyDescriptor(u.constructor.prototype,h),D=""+u[h];if(!u.hasOwnProperty(h)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var U=S.get,J=S.set;return Object.defineProperty(u,h,{configurable:!0,get:function(){return U.call(this)},set:function(ue){D=""+ue,J.call(this,ue)}}),Object.defineProperty(u,h,{enumerable:S.enumerable}),{getValue:function(){return D},setValue:function(ue){D=""+ue},stopTracking:function(){u._valueTracker=null,delete u[h]}}}}function Pe(u){u._valueTracker||(u._valueTracker=_e(u))}function ce(u){if(!u)return!1;var h=u._valueTracker;if(!h)return!0;var S=h.getValue(),D="";return u&&(D=ge(u)?u.checked?"true":"false":u.value),u=D,u!==S?(h.setValue(u),!0):!1}function ye(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}function Fe(u,h){var S=h.checked;return z({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??u._wrapperState.initialChecked})}function Me(u,h){var S=h.defaultValue==null?"":h.defaultValue,D=h.checked!=null?h.checked:h.defaultChecked;S=ne(h.value!=null?h.value:S),u._wrapperState={initialChecked:D,initialValue:S,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function Oe(u,h){h=h.checked,h!=null&&_(u,"checked",h,!1)}function He(u,h){Oe(u,h);var S=ne(h.value),D=h.type;if(S!=null)D==="number"?(S===0&&u.value===""||u.value!=S)&&(u.value=""+S):u.value!==""+S&&(u.value=""+S);else if(D==="submit"||D==="reset"){u.removeAttribute("value");return}h.hasOwnProperty("value")?Ze(u,h.type,S):h.hasOwnProperty("defaultValue")&&Ze(u,h.type,ne(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(u.defaultChecked=!!h.defaultChecked)}function It(u,h,S){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var D=h.type;if(!(D!=="submit"&&D!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+u._wrapperState.initialValue,S||h===u.value||(u.value=h),u.defaultValue=h}S=u.name,S!==""&&(u.name=""),u.defaultChecked=!!u._wrapperState.initialChecked,S!==""&&(u.name=S)}function Ze(u,h,S){(h!=="number"||ye(u.ownerDocument)!==u)&&(S==null?u.defaultValue=""+u._wrapperState.initialValue:u.defaultValue!==""+S&&(u.defaultValue=""+S))}var Le=Array.isArray;function De(u,h,S,D){if(u=u.options,h){h={};for(var U=0;U<S.length;U++)h["$"+S[U]]=!0;for(S=0;S<u.length;S++)U=h.hasOwnProperty("$"+u[S].value),u[S].selected!==U&&(u[S].selected=U),U&&D&&(u[S].defaultSelected=!0)}else{for(S=""+ne(S),h=null,U=0;U<u.length;U++){if(u[U].value===S){u[U].selected=!0,D&&(u[U].defaultSelected=!0);return}h!==null||u[U].disabled||(h=u[U])}h!==null&&(h.selected=!0)}}function et(u,h){if(h.dangerouslySetInnerHTML!=null)throw Error(r(91));return z({},h,{value:void 0,defaultValue:void 0,children:""+u._wrapperState.initialValue})}function bt(u,h){var S=h.value;if(S==null){if(S=h.children,h=h.defaultValue,S!=null){if(h!=null)throw Error(r(92));if(Le(S)){if(1<S.length)throw Error(r(93));S=S[0]}h=S}h==null&&(h=""),S=h}u._wrapperState={initialValue:ne(S)}}function ut(u,h){var S=ne(h.value),D=ne(h.defaultValue);S!=null&&(S=""+S,S!==u.value&&(u.value=S),h.defaultValue==null&&u.defaultValue!==S&&(u.defaultValue=S)),D!=null&&(u.defaultValue=""+D)}function jt(u){var h=u.textContent;h===u._wrapperState.initialValue&&h!==""&&h!==null&&(u.value=h)}function Rt(u){switch(u){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xe(u,h){return u==null||u==="http://www.w3.org/1999/xhtml"?Rt(h):u==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":u}var Ye,pt=(function(u){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,S,D,U){MSApp.execUnsafeLocalFunction(function(){return u(h,S,D,U)})}:u})(function(u,h){if(u.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in u)u.innerHTML=h;else{for(Ye=Ye||document.createElement("div"),Ye.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=Ye.firstChild;u.firstChild;)u.removeChild(u.firstChild);for(;h.firstChild;)u.appendChild(h.firstChild)}});function mt(u,h){if(h){var S=u.firstChild;if(S&&S===u.lastChild&&S.nodeType===3){S.nodeValue=h;return}}u.textContent=h}var _t={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ht=["Webkit","ms","Moz","O"];Object.keys(_t).forEach(function(u){Ht.forEach(function(h){h=h+u.charAt(0).toUpperCase()+u.substring(1),_t[h]=_t[u]})});function Qt(u,h,S){return h==null||typeof h=="boolean"||h===""?"":S||typeof h!="number"||h===0||_t.hasOwnProperty(u)&&_t[u]?(""+h).trim():h+"px"}function nr(u,h){u=u.style;for(var S in h)if(h.hasOwnProperty(S)){var D=S.indexOf("--")===0,U=Qt(S,h[S],D);S==="float"&&(S="cssFloat"),D?u.setProperty(S,U):u[S]=U}}var Nr=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fr(u,h){if(h){if(Nr[u]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(r(137,u));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(r(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(r(61))}if(h.style!=null&&typeof h.style!="object")throw Error(r(62))}}function hr(u,h){if(u.indexOf("-")===-1)return typeof h.is=="string";switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sr=null;function Er(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var he=null,le=null,pe=null;function be(u){if(u=_d(u)){if(typeof he!="function")throw Error(r(280));var h=u.stateNode;h&&(h=Fs(h),he(u.stateNode,u.type,h))}}function Ve(u){le?pe?pe.push(u):pe=[u]:le=u}function Ct(){if(le){var u=le,h=pe;if(pe=le=null,be(u),h)for(u=0;u<h.length;u++)be(h[u])}}function Et(u,h){return u(h)}function Be(){}var at=!1;function dt(u,h,S){if(at)return u(h,S);at=!0;try{return Et(u,h,S)}finally{at=!1,(le!==null||pe!==null)&&(Be(),Ct())}}function zt(u,h){var S=u.stateNode;if(S===null)return null;var D=Fs(S);if(D===null)return null;S=D[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(u=u.type,D=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!D;break e;default:u=!1}if(u)return null;if(S&&typeof S!="function")throw Error(r(231,h,typeof S));return S}var Yt=!1;if(l)try{var wr={};Object.defineProperty(wr,"passive",{get:function(){Yt=!0}}),window.addEventListener("test",wr,wr),window.removeEventListener("test",wr,wr)}catch{Yt=!1}function Ur(u,h,S,D,U,J,ue,Te,Ie){var ot=Array.prototype.slice.call(arguments,3);try{h.apply(S,ot)}catch(Dt){this.onError(Dt)}}var yr=!1,ur=null,oe=!1,we=null,fe={onError:function(u){yr=!0,ur=u}};function me(u,h,S,D,U,J,ue,Te,Ie){yr=!1,ur=null,Ur.apply(fe,arguments)}function Se(u,h,S,D,U,J,ue,Te,Ie){if(me.apply(this,arguments),yr){if(yr){var ot=ur;yr=!1,ur=null}else throw Error(r(198));oe||(oe=!0,we=ot)}}function ke(u){var h=u,S=u;if(u.alternate)for(;h.return;)h=h.return;else{u=h;do h=u,(h.flags&4098)!==0&&(S=h.return),u=h.return;while(u)}return h.tag===3?S:null}function We(u){if(u.tag===13){var h=u.memoizedState;if(h===null&&(u=u.alternate,u!==null&&(h=u.memoizedState)),h!==null)return h.dehydrated}return null}function ft(u){if(ke(u)!==u)throw Error(r(188))}function Re(u){var h=u.alternate;if(!h){if(h=ke(u),h===null)throw Error(r(188));return h!==u?null:u}for(var S=u,D=h;;){var U=S.return;if(U===null)break;var J=U.alternate;if(J===null){if(D=U.return,D!==null){S=D;continue}break}if(U.child===J.child){for(J=U.child;J;){if(J===S)return ft(U),u;if(J===D)return ft(U),h;J=J.sibling}throw Error(r(188))}if(S.return!==D.return)S=U,D=J;else{for(var ue=!1,Te=U.child;Te;){if(Te===S){ue=!0,S=U,D=J;break}if(Te===D){ue=!0,D=U,S=J;break}Te=Te.sibling}if(!ue){for(Te=J.child;Te;){if(Te===S){ue=!0,S=J,D=U;break}if(Te===D){ue=!0,D=J,S=U;break}Te=Te.sibling}if(!ue)throw Error(r(189))}}if(S.alternate!==D)throw Error(r(190))}if(S.tag!==3)throw Error(r(188));return S.stateNode.current===S?u:h}function ie(u){return u=Re(u),u!==null?de(u):null}function de(u){if(u.tag===5||u.tag===6)return u;for(u=u.child;u!==null;){var h=de(u);if(h!==null)return h;u=u.sibling}return null}var Ce=t.unstable_scheduleCallback,Ne=t.unstable_cancelCallback,Ge=t.unstable_shouldYield,Je=t.unstable_requestPaint,yt=t.unstable_now,Vt=t.unstable_getCurrentPriorityLevel,gt=t.unstable_ImmediatePriority,Ot=t.unstable_UserBlockingPriority,vr=t.unstable_NormalPriority,kr=t.unstable_LowPriority,Pr=t.unstable_IdlePriority,hn=null,Kr=null;function $r(u){if(Kr&&typeof Kr.onCommitFiberRoot=="function")try{Kr.onCommitFiberRoot(hn,u,void 0,(u.current.flags&128)===128)}catch{}}var or=Math.clz32?Math.clz32:Ee,xe=Math.log,ht=Math.LN2;function Ee(u){return u>>>=0,u===0?32:31-(xe(u)/ht|0)|0}var tt=64,St=4194304;function je(u){switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return u&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return u}}function Ke(u,h){var S=u.pendingLanes;if(S===0)return 0;var D=0,U=u.suspendedLanes,J=u.pingedLanes,ue=S&268435455;if(ue!==0){var Te=ue&~U;Te!==0?D=je(Te):(J&=ue,J!==0&&(D=je(J)))}else ue=S&~U,ue!==0?D=je(ue):J!==0&&(D=je(J));if(D===0)return 0;if(h!==0&&h!==D&&(h&U)===0&&(U=D&-D,J=h&-h,U>=J||U===16&&(J&4194240)!==0))return h;if((D&4)!==0&&(D|=S&16),h=u.entangledLanes,h!==0)for(u=u.entanglements,h&=D;0<h;)S=31-or(h),U=1<<S,D|=u[S],h&=~U;return D}function Mt(u,h){switch(u){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function it(u,h){for(var S=u.suspendedLanes,D=u.pingedLanes,U=u.expirationTimes,J=u.pendingLanes;0<J;){var ue=31-or(J),Te=1<<ue,Ie=U[ue];Ie===-1?((Te&S)===0||(Te&D)!==0)&&(U[ue]=Mt(Te,h)):Ie<=h&&(u.expiredLanes|=Te),J&=~Te}}function _r(u){return u=u.pendingLanes&-1073741825,u!==0?u:u&1073741824?1073741824:0}function Ut(){var u=tt;return tt<<=1,(tt&4194240)===0&&(tt=64),u}function mr(u){for(var h=[],S=0;31>S;S++)h.push(u);return h}function Mr(u,h,S){u.pendingLanes|=h,h!==536870912&&(u.suspendedLanes=0,u.pingedLanes=0),u=u.eventTimes,h=31-or(h),u[h]=S}function lt(u,h){var S=u.pendingLanes&~h;u.pendingLanes=h,u.suspendedLanes=0,u.pingedLanes=0,u.expiredLanes&=h,u.mutableReadLanes&=h,u.entangledLanes&=h,h=u.entanglements;var D=u.eventTimes;for(u=u.expirationTimes;0<S;){var U=31-or(S),J=1<<U;h[U]=0,D[U]=-1,u[U]=-1,S&=~J}}function Tt(u,h){var S=u.entangledLanes|=h;for(u=u.entanglements;S;){var D=31-or(S),U=1<<D;U&h|u[D]&h&&(u[D]|=h),S&=~U}}var Pt=0;function zn(u){return u&=-u,1<u?4<u?(u&268435455)!==0?16:536870912:4:1}var pr,mn,In,ha,nl,Wc=!1,sl=[],yi=null,al=null,Qi=null,qr=new Map,zc=new Map,Zi=[],sx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ax(u,h){switch(u){case"focusin":case"focusout":yi=null;break;case"dragenter":case"dragleave":al=null;break;case"mouseover":case"mouseout":Qi=null;break;case"pointerover":case"pointerout":qr.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":zc.delete(h.pointerId)}}function od(u,h,S,D,U,J){return u===null||u.nativeEvent!==J?(u={blockedOn:h,domEventName:S,eventSystemFlags:D,nativeEvent:J,targetContainers:[U]},h!==null&&(h=_d(h),h!==null&&mn(h)),u):(u.eventSystemFlags|=D,h=u.targetContainers,U!==null&&h.indexOf(U)===-1&&h.push(U),u)}function js(u,h,S,D,U){switch(h){case"focusin":return yi=od(yi,u,h,S,D,U),!0;case"dragenter":return al=od(al,u,h,S,D,U),!0;case"mouseover":return Qi=od(Qi,u,h,S,D,U),!0;case"pointerover":var J=U.pointerId;return qr.set(J,od(qr.get(J)||null,u,h,S,D,U)),!0;case"gotpointercapture":return J=U.pointerId,zc.set(J,od(zc.get(J)||null,u,h,S,D,U)),!0}return!1}function Rf(u){var h=ml(u.target);if(h!==null){var S=ke(h);if(S!==null){if(h=S.tag,h===13){if(h=We(S),h!==null){u.blockedOn=h,nl(u.priority,function(){In(S)});return}}else if(h===3&&S.stateNode.current.memoizedState.isDehydrated){u.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}u.blockedOn=null}function Df(u){if(u.blockedOn!==null)return!1;for(var h=u.targetContainers;0<h.length;){var S=Of(u.domEventName,u.eventSystemFlags,h[0],u.nativeEvent);if(S===null){S=u.nativeEvent;var D=new S.constructor(S.type,S);sr=D,S.target.dispatchEvent(D),sr=null}else return h=_d(S),h!==null&&mn(h),u.blockedOn=S,!1;h.shift()}return!0}function If(u,h,S){Df(u)&&S.delete(h)}function fv(){Wc=!1,yi!==null&&Df(yi)&&(yi=null),al!==null&&Df(al)&&(al=null),Qi!==null&&Df(Qi)&&(Qi=null),qr.forEach(If),zc.forEach(If)}function il(u,h){u.blockedOn===h&&(u.blockedOn=null,Wc||(Wc=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,fv)))}function Ra(u){function h(U){return il(U,u)}if(0<sl.length){il(sl[0],u);for(var S=1;S<sl.length;S++){var D=sl[S];D.blockedOn===u&&(D.blockedOn=null)}}for(yi!==null&&il(yi,u),al!==null&&il(al,u),Qi!==null&&il(Qi,u),qr.forEach(h),zc.forEach(h),S=0;S<Zi.length;S++)D=Zi[S],D.blockedOn===u&&(D.blockedOn=null);for(;0<Zi.length&&(S=Zi[0],S.blockedOn===null);)Rf(S),S.blockedOn===null&&Zi.shift()}var Hc=T.ReactCurrentBatchConfig,Mf=!0;function Mi(u,h,S,D){var U=Pt,J=Hc.transition;Hc.transition=null;try{Pt=1,Gc(u,h,S,D)}finally{Pt=U,Hc.transition=J}}function jo(u,h,S,D){var U=Pt,J=Hc.transition;Hc.transition=null;try{Pt=4,Gc(u,h,S,D)}finally{Pt=U,Hc.transition=J}}function Gc(u,h,S,D){if(Mf){var U=Of(u,h,S,D);if(U===null)Zf(u,h,D,Vc,S),ax(u,D);else if(js(U,u,h,S,D))D.stopPropagation();else if(ax(u,D),h&4&&-1<sx.indexOf(u)){for(;U!==null;){var J=_d(U);if(J!==null&&pr(J),J=Of(u,h,S,D),J===null&&Zf(u,h,D,Vc,S),J===U)break;U=J}U!==null&&D.stopPropagation()}else Zf(u,h,D,null,S)}}var Vc=null;function Of(u,h,S,D){if(Vc=null,u=Er(D),u=ml(u),u!==null)if(h=ke(u),h===null)u=null;else if(S=h.tag,S===13){if(u=We(h),u!==null)return u;u=null}else if(S===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;u=null}else h!==u&&(u=null);return Vc=u,null}function ix(u){switch(u){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Vt()){case gt:return 1;case Ot:return 4;case vr:case kr:return 16;case Pr:return 536870912;default:return 16}default:return 16}}var Us=null,ol=null,Ao=null;function ld(){if(Ao)return Ao;var u,h=ol,S=h.length,D,U="value"in Us?Us.value:Us.textContent,J=U.length;for(u=0;u<S&&h[u]===U[u];u++);var ue=S-u;for(D=1;D<=ue&&h[S-D]===U[J-D];D++);return Ao=U.slice(u,1<D?1-D:void 0)}function Gl(u){var h=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&h===13&&(u=13)):u=h,u===10&&(u=13),32<=u||u===13?u:0}function ga(){return!0}function Qa(){return!1}function xs(u){function h(S,D,U,J,ue){this._reactName=S,this._targetInst=U,this.type=D,this.nativeEvent=J,this.target=ue,this.currentTarget=null;for(var Te in u)u.hasOwnProperty(Te)&&(S=u[Te],this[Te]=S?S(J):J[Te]);return this.isDefaultPrevented=(J.defaultPrevented!=null?J.defaultPrevented:J.returnValue===!1)?ga:Qa,this.isPropagationStopped=Qa,this}return z(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=ga)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=ga)},persist:function(){},isPersistent:ga}),h}var Da={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Oi=xs(Da),Li=z({},Da,{view:0,detail:0}),ox=xs(Li),cd,ud,$s,ma=z({},Li,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kl,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==$s&&($s&&u.type==="mousemove"?(cd=u.screenX-$s.screenX,ud=u.screenY-$s.screenY):ud=cd=0,$s=u),cd)},movementY:function(u){return"movementY"in u?u.movementY:ud}}),En=xs(ma),dd=z({},ma,{dataTransfer:0}),Bi=xs(dd),lx=z({},Li,{relatedTarget:0}),Lf=xs(lx),U0=z({},Da,{animationName:0,elapsedTime:0,pseudoElement:0}),$0=xs(U0),cx=z({},Da,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),Bf=xs(cx),ux=z({},Da,{data:0}),Vl=xs(ux),W0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Uf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gv(u){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(u):(u=Uf[u])?!!h[u]:!1}function Kl(){return gv}var $f=z({},Li,{key:function(u){if(u.key){var h=W0[u.key]||u.key;if(h!=="Unidentified")return h}return u.type==="keypress"?(u=Gl(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?hv[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kl,charCode:function(u){return u.type==="keypress"?Gl(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?Gl(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),dx=xs($f),fx=z({},ma,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ql=xs(fx),hx=z({},Li,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kl}),Wf=xs(hx),zf=z({},Da,{propertyName:0,elapsedTime:0,pseudoElement:0}),Kc=xs(zf),z0=z({},ma,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),H0=xs(z0),gx=[9,13,27,32],fd=l&&"CompositionEvent"in window,Xl=null;l&&"documentMode"in document&&(Xl=document.documentMode);var qc=l&&"TextEvent"in window&&!Xl,Za=l&&(!fd||Xl&&8<Xl&&11>=Xl),ll=" ",Hf=!1;function G0(u,h){switch(u){case"keyup":return gx.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ui(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var ei=!1;function V0(u,h){switch(u){case"compositionend":return Ui(h);case"keypress":return h.which!==32?null:(Hf=!0,ll);case"textInput":return u=h.data,u===ll&&Hf?null:u;default:return null}}function mx(u,h){if(ei)return u==="compositionend"||!fd&&G0(u,h)?(u=ld(),Ao=ol=Us=null,ei=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Za&&h.locale!=="ko"?null:h.data;default:return null}}var Fo={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Po(u){var h=u&&u.nodeName&&u.nodeName.toLowerCase();return h==="input"?!!Fo[u.type]:h==="textarea"}function hd(u,h,S,D){Ve(D),h=eh(h,"onChange"),0<h.length&&(S=new Oi("onChange","change",null,S,D),u.push({event:S,listeners:h}))}var Xc=null,cl=null;function px(u){ng(u,0)}function ul(u){var h=vs(u);if(ce(h))return u}function vi(u,h){if(u==="change")return h}var Yc=!1;if(l){var dl;if(l){var wi="oninput"in document;if(!wi){var Gf=document.createElement("div");Gf.setAttribute("oninput","return;"),wi=typeof Gf.oninput=="function"}dl=wi}else dl=!1;Yc=dl&&(!document.documentMode||9<document.documentMode)}function Yl(){Xc&&(Xc.detachEvent("onpropertychange",K0),cl=Xc=null)}function K0(u){if(u.propertyName==="value"&&ul(cl)){var h=[];hd(h,cl,u,Er(u)),dt(px,h)}}function q0(u,h,S){u==="focusin"?(Yl(),Xc=h,cl=S,Xc.attachEvent("onpropertychange",K0)):u==="focusout"&&Yl()}function Mn(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return ul(cl)}function Vf(u,h){if(u==="click")return ul(h)}function X0(u,h){if(u==="input"||u==="change")return ul(h)}function Y0(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var Ia=typeof Object.is=="function"?Object.is:Y0;function Jl(u,h){if(Ia(u,h))return!0;if(typeof u!="object"||u===null||typeof h!="object"||h===null)return!1;var S=Object.keys(u),D=Object.keys(h);if(S.length!==D.length)return!1;for(D=0;D<S.length;D++){var U=S[D];if(!c.call(h,U)||!Ia(u[U],h[U]))return!1}return!0}function fl(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function Fn(u,h){var S=fl(u);u=0;for(var D;S;){if(S.nodeType===3){if(D=u+S.textContent.length,u<=h&&D>=h)return{node:S,offset:h-u};u=D}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=fl(S)}}function ns(u,h){return u&&h?u===h?!0:u&&u.nodeType===3?!1:h&&h.nodeType===3?ns(u,h.parentNode):"contains"in u?u.contains(h):u.compareDocumentPosition?!!(u.compareDocumentPosition(h)&16):!1:!1}function ys(){for(var u=window,h=ye();h instanceof u.HTMLIFrameElement;){try{var S=typeof h.contentWindow.location.href=="string"}catch{S=!1}if(S)u=h.contentWindow;else break;h=ye(u.document)}return h}function Jc(u){var h=u&&u.nodeName&&u.nodeName.toLowerCase();return h&&(h==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||h==="textarea"||u.contentEditable==="true")}function gd(u){var h=ys(),S=u.focusedElem,D=u.selectionRange;if(h!==S&&S&&S.ownerDocument&&ns(S.ownerDocument.documentElement,S)){if(D!==null&&Jc(S)){if(h=D.start,u=D.end,u===void 0&&(u=h),"selectionStart"in S)S.selectionStart=h,S.selectionEnd=Math.min(u,S.value.length);else if(u=(h=S.ownerDocument||document)&&h.defaultView||window,u.getSelection){u=u.getSelection();var U=S.textContent.length,J=Math.min(D.start,U);D=D.end===void 0?J:Math.min(D.end,U),!u.extend&&J>D&&(U=D,D=J,J=U),U=Fn(S,J);var ue=Fn(S,D);U&&ue&&(u.rangeCount!==1||u.anchorNode!==U.node||u.anchorOffset!==U.offset||u.focusNode!==ue.node||u.focusOffset!==ue.offset)&&(h=h.createRange(),h.setStart(U.node,U.offset),u.removeAllRanges(),J>D?(u.addRange(h),u.extend(ue.node,ue.offset)):(h.setEnd(ue.node,ue.offset),u.addRange(h)))}}for(h=[],u=S;u=u.parentNode;)u.nodeType===1&&h.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<h.length;S++)u=h[S],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var md=l&&"documentMode"in document&&11>=document.documentMode,Qc=null,As=null,Ql=null,pd=!1;function Kf(u,h,S){var D=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;pd||Qc==null||Qc!==ye(D)||(D=Qc,"selectionStart"in D&&Jc(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),Ql&&Jl(Ql,D)||(Ql=D,D=eh(As,"onSelect"),0<D.length&&(h=new Oi("onSelect","select",null,h,S),u.push({event:h,listeners:D}),h.target=Qc)))}function ti(u,h){var S={};return S[u.toLowerCase()]=h.toLowerCase(),S["Webkit"+u]="webkit"+h,S["Moz"+u]="moz"+h,S}var Ws={animationend:ti("Animation","AnimationEnd"),animationiteration:ti("Animation","AnimationIteration"),animationstart:ti("Animation","AnimationStart"),transitionend:ti("Transition","TransitionEnd")},Zl={},qf={};l&&(qf=document.createElement("div").style,"AnimationEvent"in window||(delete Ws.animationend.animation,delete Ws.animationiteration.animation,delete Ws.animationstart.animation),"TransitionEvent"in window||delete Ws.transitionend.transition);function Zc(u){if(Zl[u])return Zl[u];if(!Ws[u])return u;var h=Ws[u],S;for(S in h)if(h.hasOwnProperty(S)&&S in qf)return Zl[u]=h[S];return u}var J0=Zc("animationend"),Q0=Zc("animationiteration"),Z0=Zc("animationstart"),eg=Zc("transitionend"),tg=new Map,rg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ro(u,h){tg.set(u,h),a(h,[u])}for(var Xf=0;Xf<rg.length;Xf++){var ec=rg[Xf],xx=ec.toLowerCase(),Yf=ec[0].toUpperCase()+ec.slice(1);Ro(xx,"on"+Yf)}Ro(J0,"onAnimationEnd"),Ro(Q0,"onAnimationIteration"),Ro(Z0,"onAnimationStart"),Ro("dblclick","onDoubleClick"),Ro("focusin","onFocus"),Ro("focusout","onBlur"),Ro(eg,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yx=new Set("cancel close invalid load scroll toggle".split(" ").concat(hl));function Jf(u,h,S){var D=u.type||"unknown-event";u.currentTarget=S,Se(D,h,void 0,u),u.currentTarget=null}function ng(u,h){h=(h&4)!==0;for(var S=0;S<u.length;S++){var D=u[S],U=D.event;D=D.listeners;e:{var J=void 0;if(h)for(var ue=D.length-1;0<=ue;ue--){var Te=D[ue],Ie=Te.instance,ot=Te.currentTarget;if(Te=Te.listener,Ie!==J&&U.isPropagationStopped())break e;Jf(U,Te,ot),J=Ie}else for(ue=0;ue<D.length;ue++){if(Te=D[ue],Ie=Te.instance,ot=Te.currentTarget,Te=Te.listener,Ie!==J&&U.isPropagationStopped())break e;Jf(U,Te,ot),J=Ie}}}if(oe)throw u=we,oe=!1,we=null,u}function Sn(u,h){var S=h[rh];S===void 0&&(S=h[rh]=new Set);var D=u+"__bubble";S.has(D)||(sg(h,u,2,!1),S.add(D))}function Qf(u,h,S){var D=0;h&&(D|=4),sg(S,u,D,h)}var xd="_reactListening"+Math.random().toString(36).slice(2);function tc(u){if(!u[xd]){u[xd]=!0,n.forEach(function(S){S!=="selectionchange"&&(yx.has(S)||Qf(S,!1,u),Qf(S,!0,u))});var h=u.nodeType===9?u:u.ownerDocument;h===null||h[xd]||(h[xd]=!0,Qf("selectionchange",!1,h))}}function sg(u,h,S,D){switch(ix(h)){case 1:var U=Mi;break;case 4:U=jo;break;default:U=Gc}S=U.bind(null,h,S,u),U=void 0,!Yt||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(U=!0),D?U!==void 0?u.addEventListener(h,S,{capture:!0,passive:U}):u.addEventListener(h,S,!0):U!==void 0?u.addEventListener(h,S,{passive:U}):u.addEventListener(h,S,!1)}function Zf(u,h,S,D,U){var J=D;if((h&1)===0&&(h&2)===0&&D!==null)e:for(;;){if(D===null)return;var ue=D.tag;if(ue===3||ue===4){var Te=D.stateNode.containerInfo;if(Te===U||Te.nodeType===8&&Te.parentNode===U)break;if(ue===4)for(ue=D.return;ue!==null;){var Ie=ue.tag;if((Ie===3||Ie===4)&&(Ie=ue.stateNode.containerInfo,Ie===U||Ie.nodeType===8&&Ie.parentNode===U))return;ue=ue.return}for(;Te!==null;){if(ue=ml(Te),ue===null)return;if(Ie=ue.tag,Ie===5||Ie===6){D=J=ue;continue e}Te=Te.parentNode}}D=D.return}dt(function(){var ot=J,Dt=Er(S),Bt=[];e:{var Ft=tg.get(u);if(Ft!==void 0){var tr=Oi,lr=u;switch(u){case"keypress":if(Gl(S)===0)break e;case"keydown":case"keyup":tr=dx;break;case"focusin":lr="focus",tr=Lf;break;case"focusout":lr="blur",tr=Lf;break;case"beforeblur":case"afterblur":tr=Lf;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tr=En;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tr=Bi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tr=Wf;break;case J0:case Q0:case Z0:tr=$0;break;case eg:tr=Kc;break;case"scroll":tr=ox;break;case"wheel":tr=H0;break;case"copy":case"cut":case"paste":tr=Bf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tr=ql}var cr=(h&4)!==0,Ss=!cr&&u==="scroll",qe=cr?Ft!==null?Ft+"Capture":null:Ft;cr=[];for(var Ue=ot,nt;Ue!==null;){nt=Ue;var Wt=nt.stateNode;if(nt.tag===5&&Wt!==null&&(nt=Wt,qe!==null&&(Wt=zt(Ue,qe),Wt!=null&&cr.push(eu(Ue,Wt,nt)))),Ss)break;Ue=Ue.return}0<cr.length&&(Ft=new tr(Ft,lr,null,S,Dt),Bt.push({event:Ft,listeners:cr}))}}if((h&7)===0){e:{if(Ft=u==="mouseover"||u==="pointerover",tr=u==="mouseout"||u==="pointerout",Ft&&S!==sr&&(lr=S.relatedTarget||S.fromElement)&&(ml(lr)||lr[to]))break e;if((tr||Ft)&&(Ft=Dt.window===Dt?Dt:(Ft=Dt.ownerDocument)?Ft.defaultView||Ft.parentWindow:window,tr?(lr=S.relatedTarget||S.toElement,tr=ot,lr=lr?ml(lr):null,lr!==null&&(Ss=ke(lr),lr!==Ss||lr.tag!==5&&lr.tag!==6)&&(lr=null)):(tr=null,lr=ot),tr!==lr)){if(cr=En,Wt="onMouseLeave",qe="onMouseEnter",Ue="mouse",(u==="pointerout"||u==="pointerover")&&(cr=ql,Wt="onPointerLeave",qe="onPointerEnter",Ue="pointer"),Ss=tr==null?Ft:vs(tr),nt=lr==null?Ft:vs(lr),Ft=new cr(Wt,Ue+"leave",tr,S,Dt),Ft.target=Ss,Ft.relatedTarget=nt,Wt=null,ml(Dt)===ot&&(cr=new cr(qe,Ue+"enter",lr,S,Dt),cr.target=nt,cr.relatedTarget=Ss,Wt=cr),Ss=Wt,tr&&lr)t:{for(cr=tr,qe=lr,Ue=0,nt=cr;nt;nt=rc(nt))Ue++;for(nt=0,Wt=qe;Wt;Wt=rc(Wt))nt++;for(;0<Ue-nt;)cr=rc(cr),Ue--;for(;0<nt-Ue;)qe=rc(qe),nt--;for(;Ue--;){if(cr===qe||qe!==null&&cr===qe.alternate)break t;cr=rc(cr),qe=rc(qe)}cr=null}else cr=null;tr!==null&&vx(Bt,Ft,tr,cr,!1),lr!==null&&Ss!==null&&vx(Bt,Ss,lr,cr,!0)}}e:{if(Ft=ot?vs(ot):window,tr=Ft.nodeName&&Ft.nodeName.toLowerCase(),tr==="select"||tr==="input"&&Ft.type==="file")var dr=vi;else if(Po(Ft))if(Yc)dr=X0;else{dr=Mn;var br=q0}else(tr=Ft.nodeName)&&tr.toLowerCase()==="input"&&(Ft.type==="checkbox"||Ft.type==="radio")&&(dr=Vf);if(dr&&(dr=dr(u,ot))){hd(Bt,dr,S,Dt);break e}br&&br(u,Ft,ot),u==="focusout"&&(br=Ft._wrapperState)&&br.controlled&&Ft.type==="number"&&Ze(Ft,"number",Ft.value)}switch(br=ot?vs(ot):window,u){case"focusin":(Po(br)||br.contentEditable==="true")&&(Qc=br,As=ot,Ql=null);break;case"focusout":Ql=As=Qc=null;break;case"mousedown":pd=!0;break;case"contextmenu":case"mouseup":case"dragend":pd=!1,Kf(Bt,S,Dt);break;case"selectionchange":if(md)break;case"keydown":case"keyup":Kf(Bt,S,Dt)}var Sr;if(fd)e:{switch(u){case"compositionstart":var Rr="onCompositionStart";break e;case"compositionend":Rr="onCompositionEnd";break e;case"compositionupdate":Rr="onCompositionUpdate";break e}Rr=void 0}else ei?G0(u,S)&&(Rr="onCompositionEnd"):u==="keydown"&&S.keyCode===229&&(Rr="onCompositionStart");Rr&&(Za&&S.locale!=="ko"&&(ei||Rr!=="onCompositionStart"?Rr==="onCompositionEnd"&&ei&&(Sr=ld()):(Us=Dt,ol="value"in Us?Us.value:Us.textContent,ei=!0)),br=eh(ot,Rr),0<br.length&&(Rr=new Vl(Rr,u,null,S,Dt),Bt.push({event:Rr,listeners:br}),Sr?Rr.data=Sr:(Sr=Ui(S),Sr!==null&&(Rr.data=Sr)))),(Sr=qc?V0(u,S):mx(u,S))&&(ot=eh(ot,"onBeforeInput"),0<ot.length&&(Dt=new Vl("onBeforeInput","beforeinput",null,S,Dt),Bt.push({event:Dt,listeners:ot}),Dt.data=Sr))}ng(Bt,h)})}function eu(u,h,S){return{instance:u,listener:h,currentTarget:S}}function eh(u,h){for(var S=h+"Capture",D=[];u!==null;){var U=u,J=U.stateNode;U.tag===5&&J!==null&&(U=J,J=zt(u,S),J!=null&&D.unshift(eu(u,J,U)),J=zt(u,h),J!=null&&D.push(eu(u,J,U))),u=u.return}return D}function rc(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5);return u||null}function vx(u,h,S,D,U){for(var J=h._reactName,ue=[];S!==null&&S!==D;){var Te=S,Ie=Te.alternate,ot=Te.stateNode;if(Ie!==null&&Ie===D)break;Te.tag===5&&ot!==null&&(Te=ot,U?(Ie=zt(S,J),Ie!=null&&ue.unshift(eu(S,Ie,Te))):U||(Ie=zt(S,J),Ie!=null&&ue.push(eu(S,Ie,Te)))),S=S.return}ue.length!==0&&u.push({event:h,listeners:ue})}var mv=/\r\n?/g,wx=/\u0000|\uFFFD/g;function ag(u){return(typeof u=="string"?u:""+u).replace(mv,`
`).replace(wx,"")}function yd(u,h,S){if(h=ag(h),ag(u)!==h&&S)throw Error(r(425))}function nc(){}var ig=null,og=null;function lg(u,h){return u==="textarea"||u==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var ri=typeof setTimeout=="function"?setTimeout:void 0,cg=typeof clearTimeout=="function"?clearTimeout:void 0,vd=typeof Promise=="function"?Promise:void 0,_x=typeof queueMicrotask=="function"?queueMicrotask:typeof vd<"u"?function(u){return vd.resolve(null).then(u).catch(bx)}:ri;function bx(u){setTimeout(function(){throw u})}function th(u,h){var S=h,D=0;do{var U=S.nextSibling;if(u.removeChild(S),U&&U.nodeType===8)if(S=U.data,S==="/$"){if(D===0){u.removeChild(U),Ra(h);return}D--}else S!=="$"&&S!=="$?"&&S!=="$!"||D++;S=U}while(S);Ra(h)}function eo(u){for(;u!=null;u=u.nextSibling){var h=u.nodeType;if(h===1||h===3)break;if(h===8){if(h=u.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return u}function sc(u){u=u.previousSibling;for(var h=0;u;){if(u.nodeType===8){var S=u.data;if(S==="$"||S==="$!"||S==="$?"){if(h===0)return u;h--}else S==="/$"&&h++}u=u.previousSibling}return null}var gl=Math.random().toString(36).slice(2),_i="__reactFiber$"+gl,wd="__reactProps$"+gl,to="__reactContainer$"+gl,rh="__reactEvents$"+gl,Sx="__reactListeners$"+gl,kx="__reactHandles$"+gl;function ml(u){var h=u[_i];if(h)return h;for(var S=u.parentNode;S;){if(h=S[to]||S[_i]){if(S=h.alternate,h.child!==null||S!==null&&S.child!==null)for(u=sc(u);u!==null;){if(S=u[_i])return S;u=sc(u)}return h}u=S,S=u.parentNode}return null}function _d(u){return u=u[_i]||u[to],!u||u.tag!==5&&u.tag!==6&&u.tag!==13&&u.tag!==3?null:u}function vs(u){if(u.tag===5||u.tag===6)return u.stateNode;throw Error(r(33))}function Fs(u){return u[wd]||null}var nh=[],ac=-1;function Do(u){return{current:u}}function kn(u){0>ac||(u.current=nh[ac],nh[ac]=null,ac--)}function pn(u,h){ac++,nh[ac]=u.current,u.current=h}var ro={},zs=Do(ro),Js=Do(!1),pl=ro;function ic(u,h){var S=u.type.contextTypes;if(!S)return ro;var D=u.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===h)return D.__reactInternalMemoizedMaskedChildContext;var U={},J;for(J in S)U[J]=h[J];return D&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=h,u.__reactInternalMemoizedMaskedChildContext=U),U}function Qs(u){return u=u.childContextTypes,u!=null}function tu(){kn(Js),kn(zs)}function ug(u,h,S){if(zs.current!==ro)throw Error(r(168));pn(zs,h),pn(Js,S)}function sh(u,h,S){var D=u.stateNode;if(h=h.childContextTypes,typeof D.getChildContext!="function")return S;D=D.getChildContext();for(var U in D)if(!(U in h))throw Error(r(108,X(u)||"Unknown",U));return z({},S,D)}function oc(u){return u=(u=u.stateNode)&&u.__reactInternalMemoizedMergedChildContext||ro,pl=zs.current,pn(zs,u),pn(Js,Js.current),!0}function Cx(u,h,S){var D=u.stateNode;if(!D)throw Error(r(169));S?(u=sh(u,h,pl),D.__reactInternalMemoizedMergedChildContext=u,kn(Js),kn(zs),pn(zs,u)):kn(Js),pn(Js,S)}var no=null,ru=!1,ah=!1;function bd(u){no===null?no=[u]:no.push(u)}function Io(u){ru=!0,bd(u)}function xl(){if(!ah&&no!==null){ah=!0;var u=0,h=Pt;try{var S=no;for(Pt=1;u<S.length;u++){var D=S[u];do D=D(!0);while(D!==null)}no=null,ru=!1}catch(U){throw no!==null&&(no=no.slice(u+1)),Ce(gt,xl),U}finally{Pt=h,ah=!1}}return null}var pa=[],lc=0,yl=null,vl=0,xa=[],ya=0,wl=null,ni=1,Pn="";function cc(u,h){pa[lc++]=vl,pa[lc++]=yl,yl=u,vl=h}function Tx(u,h,S){xa[ya++]=ni,xa[ya++]=Pn,xa[ya++]=wl,wl=u;var D=ni;u=Pn;var U=32-or(D)-1;D&=~(1<<U),S+=1;var J=32-or(h)+U;if(30<J){var ue=U-U%5;J=(D&(1<<ue)-1).toString(32),D>>=ue,U-=ue,ni=1<<32-or(h)+U|S<<U|D,Pn=J+u}else ni=1<<J|S<<U|D,Pn=u}function nu(u){u.return!==null&&(cc(u,1),Tx(u,1,0))}function Ps(u){for(;u===yl;)yl=pa[--lc],pa[lc]=null,vl=pa[--lc],pa[lc]=null;for(;u===wl;)wl=xa[--ya],xa[ya]=null,Pn=xa[--ya],xa[ya]=null,ni=xa[--ya],xa[ya]=null}var si=null,Jt=null,un=!1,ai=null;function dg(u,h){var S=uo(5,null,null,0);S.elementType="DELETED",S.stateNode=h,S.return=u,h=u.deletions,h===null?(u.deletions=[S],u.flags|=16):h.push(S)}function Nx(u,h){switch(u.tag){case 5:var S=u.type;return h=h.nodeType!==1||S.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(u.stateNode=h,si=u,Jt=eo(h.firstChild),!0):!1;case 6:return h=u.pendingProps===""||h.nodeType!==3?null:h,h!==null?(u.stateNode=h,si=u,Jt=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(S=wl!==null?{id:ni,overflow:Pn}:null,u.memoizedState={dehydrated:h,treeContext:S,retryLane:1073741824},S=uo(18,null,null,0),S.stateNode=h,S.return=u,u.child=S,si=u,Jt=null,!0):!1;default:return!1}}function uc(u){return(u.mode&1)!==0&&(u.flags&128)===0}function su(u){if(un){var h=Jt;if(h){var S=h;if(!Nx(u,h)){if(uc(u))throw Error(r(418));h=eo(S.nextSibling);var D=si;h&&Nx(u,h)?dg(D,S):(u.flags=u.flags&-4097|2,un=!1,si=u)}}else{if(uc(u))throw Error(r(418));u.flags=u.flags&-4097|2,un=!1,si=u}}}function ih(u){for(u=u.return;u!==null&&u.tag!==5&&u.tag!==3&&u.tag!==13;)u=u.return;si=u}function Sd(u){if(u!==si)return!1;if(!un)return ih(u),un=!0,!1;var h;if((h=u.tag!==3)&&!(h=u.tag!==5)&&(h=u.type,h=h!=="head"&&h!=="body"&&!lg(u.type,u.memoizedProps)),h&&(h=Jt)){if(uc(u))throw fg(),Error(r(418));for(;h;)dg(u,h),h=eo(h.nextSibling)}if(ih(u),u.tag===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));e:{for(u=u.nextSibling,h=0;u;){if(u.nodeType===8){var S=u.data;if(S==="/$"){if(h===0){Jt=eo(u.nextSibling);break e}h--}else S!=="$"&&S!=="$!"&&S!=="$?"||h++}u=u.nextSibling}Jt=null}}else Jt=si?eo(u.stateNode.nextSibling):null;return!0}function fg(){for(var u=Jt;u;)u=eo(u.nextSibling)}function dc(){Jt=si=null,un=!1}function kd(u){ai===null?ai=[u]:ai.push(u)}var hg=T.ReactCurrentBatchConfig;function Xn(u,h,S){if(u=S.ref,u!==null&&typeof u!="function"&&typeof u!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(r(309));var D=S.stateNode}if(!D)throw Error(r(147,u));var U=D,J=""+u;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===J?h.ref:(h=function(ue){var Te=U.refs;ue===null?delete Te[J]:Te[J]=ue},h._stringRef=J,h)}if(typeof u!="string")throw Error(r(284));if(!S._owner)throw Error(r(290,u))}return u}function Ma(u,h){throw u=Object.prototype.toString.call(h),Error(r(31,u==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":u))}function $i(u){var h=u._init;return h(u._payload)}function oh(u){function h(qe,Ue){if(u){var nt=qe.deletions;nt===null?(qe.deletions=[Ue],qe.flags|=16):nt.push(Ue)}}function S(qe,Ue){if(!u)return null;for(;Ue!==null;)h(qe,Ue),Ue=Ue.sibling;return null}function D(qe,Ue){for(qe=new Map;Ue!==null;)Ue.key!==null?qe.set(Ue.key,Ue):qe.set(Ue.index,Ue),Ue=Ue.sibling;return qe}function U(qe,Ue){return qe=ku(qe,Ue),qe.index=0,qe.sibling=null,qe}function J(qe,Ue,nt){return qe.index=nt,u?(nt=qe.alternate,nt!==null?(nt=nt.index,nt<Ue?(qe.flags|=2,Ue):nt):(qe.flags|=2,Ue)):(qe.flags|=1048576,Ue)}function ue(qe){return u&&qe.alternate===null&&(qe.flags|=2),qe}function Te(qe,Ue,nt,Wt){return Ue===null||Ue.tag!==6?(Ue=Mv(nt,qe.mode,Wt),Ue.return=qe,Ue):(Ue=U(Ue,nt),Ue.return=qe,Ue)}function Ie(qe,Ue,nt,Wt){var dr=nt.type;return dr===R?Dt(qe,Ue,nt.props.children,Wt,nt.key):Ue!==null&&(Ue.elementType===dr||typeof dr=="object"&&dr!==null&&dr.$$typeof===se&&$i(dr)===Ue.type)?(Wt=U(Ue,nt.props),Wt.ref=Xn(qe,Ue,nt),Wt.return=qe,Wt):(Wt=qx(nt.type,nt.key,nt.props,null,qe.mode,Wt),Wt.ref=Xn(qe,Ue,nt),Wt.return=qe,Wt)}function ot(qe,Ue,nt,Wt){return Ue===null||Ue.tag!==4||Ue.stateNode.containerInfo!==nt.containerInfo||Ue.stateNode.implementation!==nt.implementation?(Ue=Ov(nt,qe.mode,Wt),Ue.return=qe,Ue):(Ue=U(Ue,nt.children||[]),Ue.return=qe,Ue)}function Dt(qe,Ue,nt,Wt,dr){return Ue===null||Ue.tag!==7?(Ue=Id(nt,qe.mode,Wt,dr),Ue.return=qe,Ue):(Ue=U(Ue,nt),Ue.return=qe,Ue)}function Bt(qe,Ue,nt){if(typeof Ue=="string"&&Ue!==""||typeof Ue=="number")return Ue=Mv(""+Ue,qe.mode,nt),Ue.return=qe,Ue;if(typeof Ue=="object"&&Ue!==null){switch(Ue.$$typeof){case j:return nt=qx(Ue.type,Ue.key,Ue.props,null,qe.mode,nt),nt.ref=Xn(qe,null,Ue),nt.return=qe,nt;case P:return Ue=Ov(Ue,qe.mode,nt),Ue.return=qe,Ue;case se:var Wt=Ue._init;return Bt(qe,Wt(Ue._payload),nt)}if(Le(Ue)||I(Ue))return Ue=Id(Ue,qe.mode,nt,null),Ue.return=qe,Ue;Ma(qe,Ue)}return null}function Ft(qe,Ue,nt,Wt){var dr=Ue!==null?Ue.key:null;if(typeof nt=="string"&&nt!==""||typeof nt=="number")return dr!==null?null:Te(qe,Ue,""+nt,Wt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case j:return nt.key===dr?Ie(qe,Ue,nt,Wt):null;case P:return nt.key===dr?ot(qe,Ue,nt,Wt):null;case se:return dr=nt._init,Ft(qe,Ue,dr(nt._payload),Wt)}if(Le(nt)||I(nt))return dr!==null?null:Dt(qe,Ue,nt,Wt,null);Ma(qe,nt)}return null}function tr(qe,Ue,nt,Wt,dr){if(typeof Wt=="string"&&Wt!==""||typeof Wt=="number")return qe=qe.get(nt)||null,Te(Ue,qe,""+Wt,dr);if(typeof Wt=="object"&&Wt!==null){switch(Wt.$$typeof){case j:return qe=qe.get(Wt.key===null?nt:Wt.key)||null,Ie(Ue,qe,Wt,dr);case P:return qe=qe.get(Wt.key===null?nt:Wt.key)||null,ot(Ue,qe,Wt,dr);case se:var br=Wt._init;return tr(qe,Ue,nt,br(Wt._payload),dr)}if(Le(Wt)||I(Wt))return qe=qe.get(nt)||null,Dt(Ue,qe,Wt,dr,null);Ma(Ue,Wt)}return null}function lr(qe,Ue,nt,Wt){for(var dr=null,br=null,Sr=Ue,Rr=Ue=0,sa=null;Sr!==null&&Rr<nt.length;Rr++){Sr.index>Rr?(sa=Sr,Sr=null):sa=Sr.sibling;var an=Ft(qe,Sr,nt[Rr],Wt);if(an===null){Sr===null&&(Sr=sa);break}u&&Sr&&an.alternate===null&&h(qe,Sr),Ue=J(an,Ue,Rr),br===null?dr=an:br.sibling=an,br=an,Sr=sa}if(Rr===nt.length)return S(qe,Sr),un&&cc(qe,Rr),dr;if(Sr===null){for(;Rr<nt.length;Rr++)Sr=Bt(qe,nt[Rr],Wt),Sr!==null&&(Ue=J(Sr,Ue,Rr),br===null?dr=Sr:br.sibling=Sr,br=Sr);return un&&cc(qe,Rr),dr}for(Sr=D(qe,Sr);Rr<nt.length;Rr++)sa=tr(Sr,qe,Rr,nt[Rr],Wt),sa!==null&&(u&&sa.alternate!==null&&Sr.delete(sa.key===null?Rr:sa.key),Ue=J(sa,Ue,Rr),br===null?dr=sa:br.sibling=sa,br=sa);return u&&Sr.forEach(function(Cu){return h(qe,Cu)}),un&&cc(qe,Rr),dr}function cr(qe,Ue,nt,Wt){var dr=I(nt);if(typeof dr!="function")throw Error(r(150));if(nt=dr.call(nt),nt==null)throw Error(r(151));for(var br=dr=null,Sr=Ue,Rr=Ue=0,sa=null,an=nt.next();Sr!==null&&!an.done;Rr++,an=nt.next()){Sr.index>Rr?(sa=Sr,Sr=null):sa=Sr.sibling;var Cu=Ft(qe,Sr,an.value,Wt);if(Cu===null){Sr===null&&(Sr=sa);break}u&&Sr&&Cu.alternate===null&&h(qe,Sr),Ue=J(Cu,Ue,Rr),br===null?dr=Cu:br.sibling=Cu,br=Cu,Sr=sa}if(an.done)return S(qe,Sr),un&&cc(qe,Rr),dr;if(Sr===null){for(;!an.done;Rr++,an=nt.next())an=Bt(qe,an.value,Wt),an!==null&&(Ue=J(an,Ue,Rr),br===null?dr=an:br.sibling=an,br=an);return un&&cc(qe,Rr),dr}for(Sr=D(qe,Sr);!an.done;Rr++,an=nt.next())an=tr(Sr,qe,Rr,an.value,Wt),an!==null&&(u&&an.alternate!==null&&Sr.delete(an.key===null?Rr:an.key),Ue=J(an,Ue,Rr),br===null?dr=an:br.sibling=an,br=an);return u&&Sr.forEach(function(IP){return h(qe,IP)}),un&&cc(qe,Rr),dr}function Ss(qe,Ue,nt,Wt){if(typeof nt=="object"&&nt!==null&&nt.type===R&&nt.key===null&&(nt=nt.props.children),typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case j:e:{for(var dr=nt.key,br=Ue;br!==null;){if(br.key===dr){if(dr=nt.type,dr===R){if(br.tag===7){S(qe,br.sibling),Ue=U(br,nt.props.children),Ue.return=qe,qe=Ue;break e}}else if(br.elementType===dr||typeof dr=="object"&&dr!==null&&dr.$$typeof===se&&$i(dr)===br.type){S(qe,br.sibling),Ue=U(br,nt.props),Ue.ref=Xn(qe,br,nt),Ue.return=qe,qe=Ue;break e}S(qe,br);break}else h(qe,br);br=br.sibling}nt.type===R?(Ue=Id(nt.props.children,qe.mode,Wt,nt.key),Ue.return=qe,qe=Ue):(Wt=qx(nt.type,nt.key,nt.props,null,qe.mode,Wt),Wt.ref=Xn(qe,Ue,nt),Wt.return=qe,qe=Wt)}return ue(qe);case P:e:{for(br=nt.key;Ue!==null;){if(Ue.key===br)if(Ue.tag===4&&Ue.stateNode.containerInfo===nt.containerInfo&&Ue.stateNode.implementation===nt.implementation){S(qe,Ue.sibling),Ue=U(Ue,nt.children||[]),Ue.return=qe,qe=Ue;break e}else{S(qe,Ue);break}else h(qe,Ue);Ue=Ue.sibling}Ue=Ov(nt,qe.mode,Wt),Ue.return=qe,qe=Ue}return ue(qe);case se:return br=nt._init,Ss(qe,Ue,br(nt._payload),Wt)}if(Le(nt))return lr(qe,Ue,nt,Wt);if(I(nt))return cr(qe,Ue,nt,Wt);Ma(qe,nt)}return typeof nt=="string"&&nt!==""||typeof nt=="number"?(nt=""+nt,Ue!==null&&Ue.tag===6?(S(qe,Ue.sibling),Ue=U(Ue,nt),Ue.return=qe,qe=Ue):(S(qe,Ue),Ue=Mv(nt,qe.mode,Wt),Ue.return=qe,qe=Ue),ue(qe)):S(qe,Ue)}return Ss}var fc=oh(!0),bi=oh(!1),Cd=Do(null),ii=null,au=null,lh=null;function ch(){lh=au=ii=null}function uh(u){var h=Cd.current;kn(Cd),u._currentValue=h}function dh(u,h,S){for(;u!==null;){var D=u.alternate;if((u.childLanes&h)!==h?(u.childLanes|=h,D!==null&&(D.childLanes|=h)):D!==null&&(D.childLanes&h)!==h&&(D.childLanes|=h),u===S)break;u=u.return}}function Mo(u,h){ii=u,lh=au=null,u=u.dependencies,u!==null&&u.firstContext!==null&&((u.lanes&h)!==0&&(re=!0),u.firstContext=null)}function va(u){var h=u._currentValue;if(lh!==u)if(u={context:u,memoizedValue:h,next:null},au===null){if(ii===null)throw Error(r(308));au=u,ii.dependencies={lanes:0,firstContext:u}}else au=au.next=u;return h}var so=null;function iu(u){so===null?so=[u]:so.push(u)}function Td(u,h,S,D){var U=h.interleaved;return U===null?(S.next=S,iu(h)):(S.next=U.next,U.next=S),h.interleaved=S,oi(u,D)}function oi(u,h){u.lanes|=h;var S=u.alternate;for(S!==null&&(S.lanes|=h),S=u,u=u.return;u!==null;)u.childLanes|=h,S=u.alternate,S!==null&&(S.childLanes|=h),S=u,u=u.return;return S.tag===3?S.stateNode:null}var ao=!1;function Nd(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fh(u,h){u=u.updateQueue,h.updateQueue===u&&(h.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,effects:u.effects})}function io(u,h){return{eventTime:u,lane:h,tag:0,payload:null,callback:null,next:null}}function oo(u,h,S){var D=u.updateQueue;if(D===null)return null;if(D=D.shared,(rn&2)!==0){var U=D.pending;return U===null?h.next=h:(h.next=U.next,U.next=h),D.pending=h,oi(u,S)}return U=D.interleaved,U===null?(h.next=h,iu(D)):(h.next=U.next,U.next=h),D.interleaved=h,oi(u,S)}function hh(u,h,S){if(h=h.updateQueue,h!==null&&(h=h.shared,(S&4194240)!==0)){var D=h.lanes;D&=u.pendingLanes,S|=D,h.lanes=S,Tt(u,S)}}function Ed(u,h){var S=u.updateQueue,D=u.alternate;if(D!==null&&(D=D.updateQueue,S===D)){var U=null,J=null;if(S=S.firstBaseUpdate,S!==null){do{var ue={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};J===null?U=J=ue:J=J.next=ue,S=S.next}while(S!==null);J===null?U=J=h:J=J.next=h}else U=J=h;S={baseState:D.baseState,firstBaseUpdate:U,lastBaseUpdate:J,shared:D.shared,effects:D.effects},u.updateQueue=S;return}u=S.lastBaseUpdate,u===null?S.firstBaseUpdate=h:u.next=h,S.lastBaseUpdate=h}function ou(u,h,S,D){var U=u.updateQueue;ao=!1;var J=U.firstBaseUpdate,ue=U.lastBaseUpdate,Te=U.shared.pending;if(Te!==null){U.shared.pending=null;var Ie=Te,ot=Ie.next;Ie.next=null,ue===null?J=ot:ue.next=ot,ue=Ie;var Dt=u.alternate;Dt!==null&&(Dt=Dt.updateQueue,Te=Dt.lastBaseUpdate,Te!==ue&&(Te===null?Dt.firstBaseUpdate=ot:Te.next=ot,Dt.lastBaseUpdate=Ie))}if(J!==null){var Bt=U.baseState;ue=0,Dt=ot=Ie=null,Te=J;do{var Ft=Te.lane,tr=Te.eventTime;if((D&Ft)===Ft){Dt!==null&&(Dt=Dt.next={eventTime:tr,lane:0,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null});e:{var lr=u,cr=Te;switch(Ft=h,tr=S,cr.tag){case 1:if(lr=cr.payload,typeof lr=="function"){Bt=lr.call(tr,Bt,Ft);break e}Bt=lr;break e;case 3:lr.flags=lr.flags&-65537|128;case 0:if(lr=cr.payload,Ft=typeof lr=="function"?lr.call(tr,Bt,Ft):lr,Ft==null)break e;Bt=z({},Bt,Ft);break e;case 2:ao=!0}}Te.callback!==null&&Te.lane!==0&&(u.flags|=64,Ft=U.effects,Ft===null?U.effects=[Te]:Ft.push(Te))}else tr={eventTime:tr,lane:Ft,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},Dt===null?(ot=Dt=tr,Ie=Bt):Dt=Dt.next=tr,ue|=Ft;if(Te=Te.next,Te===null){if(Te=U.shared.pending,Te===null)break;Ft=Te,Te=Ft.next,Ft.next=null,U.lastBaseUpdate=Ft,U.shared.pending=null}}while(!0);if(Dt===null&&(Ie=Bt),U.baseState=Ie,U.firstBaseUpdate=ot,U.lastBaseUpdate=Dt,h=U.shared.interleaved,h!==null){U=h;do ue|=U.lane,U=U.next;while(U!==h)}else J===null&&(U.shared.lanes=0);Fd|=ue,u.lanes=ue,u.memoizedState=Bt}}function Hn(u,h,S){if(u=h.effects,h.effects=null,u!==null)for(h=0;h<u.length;h++){var D=u[h],U=D.callback;if(U!==null){if(D.callback=null,D=S,typeof U!="function")throw Error(r(191,U));U.call(D)}}}var Or={},xn=Do(Or),Rn=Do(Or),Yn=Do(Or);function ws(u){if(u===Or)throw Error(r(174));return u}function _l(u,h){switch(pn(Yn,h),pn(Rn,u),pn(xn,Or),u=h.nodeType,u){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:Xe(null,"");break;default:u=u===8?h.parentNode:h,h=u.namespaceURI||null,u=u.tagName,h=Xe(h,u)}kn(xn),pn(xn,h)}function Dn(){kn(xn),kn(Rn),kn(Yn)}function lu(u){ws(Yn.current);var h=ws(xn.current),S=Xe(h,u.type);h!==S&&(pn(Rn,u),pn(xn,S))}function Oo(u){Rn.current===u&&(kn(xn),kn(Rn))}var Cn=Do(0);function cu(u){for(var h=u;h!==null;){if(h.tag===13){var S=h.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===u)break;for(;h.sibling===null;){if(h.return===null||h.return===u)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var hc=[];function Zs(){for(var u=0;u<hc.length;u++)hc[u]._workInProgressVersionPrimary=null;hc.length=0}var uu=T.ReactCurrentDispatcher,jd=T.ReactCurrentBatchConfig,wa=0,gn=null,Gn=null,ss=null,Wi=!1,bl=!1,Si=0,gh=0;function as(){throw Error(r(321))}function Ad(u,h){if(h===null)return!1;for(var S=0;S<h.length&&S<u.length;S++)if(!Ia(u[S],h[S]))return!1;return!0}function du(u,h,S,D,U,J){if(wa=J,gn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,uu.current=u===null||u.memoizedState===null?xv:Cl,u=S(D,U),bl){J=0;do{if(bl=!1,Si=0,25<=J)throw Error(r(301));J+=1,ss=Gn=null,h.updateQueue=null,uu.current=vh,u=S(D,U)}while(bl)}if(uu.current=mu,h=Gn!==null&&Gn.next!==null,wa=0,ss=Gn=gn=null,Wi=!1,h)throw Error(r(300));return u}function fu(){var u=Si!==0;return Si=0,u}function jn(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ss===null?gn.memoizedState=ss=u:ss=ss.next=u,ss}function _s(){if(Gn===null){var u=gn.alternate;u=u!==null?u.memoizedState:null}else u=Gn.next;var h=ss===null?gn.memoizedState:ss.next;if(h!==null)ss=h,Gn=u;else{if(u===null)throw Error(r(310));Gn=u,u={memoizedState:Gn.memoizedState,baseState:Gn.baseState,baseQueue:Gn.baseQueue,queue:Gn.queue,next:null},ss===null?gn.memoizedState=ss=u:ss=ss.next=u}return ss}function ea(u,h){return typeof h=="function"?h(u):h}function ta(u){var h=_s(),S=h.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=u;var D=Gn,U=D.baseQueue,J=S.pending;if(J!==null){if(U!==null){var ue=U.next;U.next=J.next,J.next=ue}D.baseQueue=U=J,S.pending=null}if(U!==null){J=U.next,D=D.baseState;var Te=ue=null,Ie=null,ot=J;do{var Dt=ot.lane;if((wa&Dt)===Dt)Ie!==null&&(Ie=Ie.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),D=ot.hasEagerState?ot.eagerState:u(D,ot.action);else{var Bt={lane:Dt,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};Ie===null?(Te=Ie=Bt,ue=D):Ie=Ie.next=Bt,gn.lanes|=Dt,Fd|=Dt}ot=ot.next}while(ot!==null&&ot!==J);Ie===null?ue=D:Ie.next=Te,Ia(D,h.memoizedState)||(re=!0),h.memoizedState=D,h.baseState=ue,h.baseQueue=Ie,S.lastRenderedState=D}if(u=S.interleaved,u!==null){U=u;do J=U.lane,gn.lanes|=J,Fd|=J,U=U.next;while(U!==u)}else U===null&&(S.lanes=0);return[h.memoizedState,S.dispatch]}function mh(u){var h=_s(),S=h.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=u;var D=S.dispatch,U=S.pending,J=h.memoizedState;if(U!==null){S.pending=null;var ue=U=U.next;do J=u(J,ue.action),ue=ue.next;while(ue!==U);Ia(J,h.memoizedState)||(re=!0),h.memoizedState=J,h.baseQueue===null&&(h.baseState=J),S.lastRenderedState=J}return[J,D]}function ph(){}function xh(u,h){var S=gn,D=_s(),U=h(),J=!Ia(D.memoizedState,U);if(J&&(D.memoizedState=U,re=!0),D=D.queue,xg(gg.bind(null,S,D,u),[u]),D.getSnapshot!==h||J||ss!==null&&ss.memoizedState.tag&1){if(S.flags|=2048,hu(9,Lo.bind(null,S,D,U,h),void 0,null),na===null)throw Error(r(349));(wa&30)!==0||Ex(S,h,U)}return U}function Ex(u,h,S){u.flags|=16384,u={getSnapshot:h,value:S},h=gn.updateQueue,h===null?(h={lastEffect:null,stores:null},gn.updateQueue=h,h.stores=[u]):(S=h.stores,S===null?h.stores=[u]:S.push(u))}function Lo(u,h,S,D){h.value=S,h.getSnapshot=D,mg(h)&&yh(u)}function gg(u,h,S){return S(function(){mg(h)&&yh(u)})}function mg(u){var h=u.getSnapshot;u=u.value;try{var S=h();return!Ia(u,S)}catch{return!0}}function yh(u){var h=oi(u,1);h!==null&&Wo(h,u,1,-1)}function Sl(u){var h=jn();return typeof u=="function"&&(u=u()),h.memoizedState=h.baseState=u,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ea,lastRenderedState:u},h.queue=u,u=u.dispatch=Dx.bind(null,gn,u),[h.memoizedState,u]}function hu(u,h,S,D){return u={tag:u,create:h,destroy:S,deps:D,next:null},h=gn.updateQueue,h===null?(h={lastEffect:null,stores:null},gn.updateQueue=h,h.lastEffect=u.next=u):(S=h.lastEffect,S===null?h.lastEffect=u.next=u:(D=S.next,S.next=u,u.next=D,h.lastEffect=u)),u}function pg(){return _s().memoizedState}function gu(u,h,S,D){var U=jn();gn.flags|=u,U.memoizedState=hu(1|h,S,void 0,D===void 0?null:D)}function gc(u,h,S,D){var U=_s();D=D===void 0?null:D;var J=void 0;if(Gn!==null){var ue=Gn.memoizedState;if(J=ue.destroy,D!==null&&Ad(D,ue.deps)){U.memoizedState=hu(h,S,J,D);return}}gn.flags|=u,U.memoizedState=hu(1|h,S,J,D)}function jx(u,h){return gu(8390656,8,u,h)}function xg(u,h){return gc(2048,8,u,h)}function yg(u,h){return gc(4,2,u,h)}function vg(u,h){return gc(4,4,u,h)}function kl(u,h){if(typeof h=="function")return u=u(),h(u),function(){h(null)};if(h!=null)return u=u(),h.current=u,function(){h.current=null}}function Ax(u,h,S){return S=S!=null?S.concat([u]):null,gc(4,4,kl.bind(null,h,u),S)}function Bo(){}function wg(u,h){var S=_s();h=h===void 0?null:h;var D=S.memoizedState;return D!==null&&h!==null&&Ad(h,D[1])?D[0]:(S.memoizedState=[u,h],u)}function An(u,h){var S=_s();h=h===void 0?null:h;var D=S.memoizedState;return D!==null&&h!==null&&Ad(h,D[1])?D[0]:(u=u(),S.memoizedState=[u,h],u)}function Fx(u,h,S){return(wa&21)===0?(u.baseState&&(u.baseState=!1,re=!0),u.memoizedState=S):(Ia(S,h)||(S=Ut(),gn.lanes|=S,Fd|=S,u.baseState=!0),h)}function Px(u,h){var S=Pt;Pt=S!==0&&4>S?S:4,u(!0);var D=jd.transition;jd.transition={};try{u(!1),h()}finally{Pt=S,jd.transition=D}}function Rx(){return _s().memoizedState}function pv(u,h,S){var D=bu(u);if(S={lane:D,action:S,hasEagerState:!1,eagerState:null,next:null},_g(u))Ix(h,S);else if(S=Td(u,h,S,D),S!==null){var U=ci();Wo(S,u,D,U),li(S,h,D)}}function Dx(u,h,S){var D=bu(u),U={lane:D,action:S,hasEagerState:!1,eagerState:null,next:null};if(_g(u))Ix(h,U);else{var J=u.alternate;if(u.lanes===0&&(J===null||J.lanes===0)&&(J=h.lastRenderedReducer,J!==null))try{var ue=h.lastRenderedState,Te=J(ue,S);if(U.hasEagerState=!0,U.eagerState=Te,Ia(Te,ue)){var Ie=h.interleaved;Ie===null?(U.next=U,iu(h)):(U.next=Ie.next,Ie.next=U),h.interleaved=U;return}}catch{}finally{}S=Td(u,h,U,D),S!==null&&(U=ci(),Wo(S,u,D,U),li(S,h,D))}}function _g(u){var h=u.alternate;return u===gn||h!==null&&h===gn}function Ix(u,h){bl=Wi=!0;var S=u.pending;S===null?h.next=h:(h.next=S.next,S.next=h),u.pending=h}function li(u,h,S){if((S&4194240)!==0){var D=h.lanes;D&=u.pendingLanes,S|=D,h.lanes=S,Tt(u,S)}}var mu={readContext:va,useCallback:as,useContext:as,useEffect:as,useImperativeHandle:as,useInsertionEffect:as,useLayoutEffect:as,useMemo:as,useReducer:as,useRef:as,useState:as,useDebugValue:as,useDeferredValue:as,useTransition:as,useMutableSource:as,useSyncExternalStore:as,useId:as,unstable_isNewReconciler:!1},xv={readContext:va,useCallback:function(u,h){return jn().memoizedState=[u,h===void 0?null:h],u},useContext:va,useEffect:jx,useImperativeHandle:function(u,h,S){return S=S!=null?S.concat([u]):null,gu(4194308,4,kl.bind(null,h,u),S)},useLayoutEffect:function(u,h){return gu(4194308,4,u,h)},useInsertionEffect:function(u,h){return gu(4,2,u,h)},useMemo:function(u,h){var S=jn();return h=h===void 0?null:h,u=u(),S.memoizedState=[u,h],u},useReducer:function(u,h,S){var D=jn();return h=S!==void 0?S(h):h,D.memoizedState=D.baseState=h,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:h},D.queue=u,u=u.dispatch=pv.bind(null,gn,u),[D.memoizedState,u]},useRef:function(u){var h=jn();return u={current:u},h.memoizedState=u},useState:Sl,useDebugValue:Bo,useDeferredValue:function(u){return jn().memoizedState=u},useTransition:function(){var u=Sl(!1),h=u[0];return u=Px.bind(null,u[1]),jn().memoizedState=u,[h,u]},useMutableSource:function(){},useSyncExternalStore:function(u,h,S){var D=gn,U=jn();if(un){if(S===void 0)throw Error(r(407));S=S()}else{if(S=h(),na===null)throw Error(r(349));(wa&30)!==0||Ex(D,h,S)}U.memoizedState=S;var J={value:S,getSnapshot:h};return U.queue=J,jx(gg.bind(null,D,J,u),[u]),D.flags|=2048,hu(9,Lo.bind(null,D,J,S,h),void 0,null),S},useId:function(){var u=jn(),h=na.identifierPrefix;if(un){var S=Pn,D=ni;S=(D&~(1<<32-or(D)-1)).toString(32)+S,h=":"+h+"R"+S,S=Si++,0<S&&(h+="H"+S.toString(32)),h+=":"}else S=gh++,h=":"+h+"r"+S.toString(32)+":";return u.memoizedState=h},unstable_isNewReconciler:!1},Cl={readContext:va,useCallback:wg,useContext:va,useEffect:xg,useImperativeHandle:Ax,useInsertionEffect:yg,useLayoutEffect:vg,useMemo:An,useReducer:ta,useRef:pg,useState:function(){return ta(ea)},useDebugValue:Bo,useDeferredValue:function(u){var h=_s();return Fx(h,Gn.memoizedState,u)},useTransition:function(){var u=ta(ea)[0],h=_s().memoizedState;return[u,h]},useMutableSource:ph,useSyncExternalStore:xh,useId:Rx,unstable_isNewReconciler:!1},vh={readContext:va,useCallback:wg,useContext:va,useEffect:xg,useImperativeHandle:Ax,useInsertionEffect:yg,useLayoutEffect:vg,useMemo:An,useReducer:mh,useRef:pg,useState:function(){return mh(ea)},useDebugValue:Bo,useDeferredValue:function(u){var h=_s();return Gn===null?h.memoizedState=u:Fx(h,Gn.memoizedState,u)},useTransition:function(){var u=mh(ea)[0],h=_s().memoizedState;return[u,h]},useMutableSource:ph,useSyncExternalStore:xh,useId:Rx,unstable_isNewReconciler:!1};function Hs(u,h){if(u&&u.defaultProps){h=z({},h),u=u.defaultProps;for(var S in u)h[S]===void 0&&(h[S]=u[S]);return h}return h}function pu(u,h,S,D){h=u.memoizedState,S=S(D,h),S=S==null?h:z({},h,S),u.memoizedState=S,u.lanes===0&&(u.updateQueue.baseState=S)}var xu={isMounted:function(u){return(u=u._reactInternals)?ke(u)===u:!1},enqueueSetState:function(u,h,S){u=u._reactInternals;var D=ci(),U=bu(u),J=io(D,U);J.payload=h,S!=null&&(J.callback=S),h=oo(u,J,U),h!==null&&(Wo(h,u,U,D),hh(h,u,U))},enqueueReplaceState:function(u,h,S){u=u._reactInternals;var D=ci(),U=bu(u),J=io(D,U);J.tag=1,J.payload=h,S!=null&&(J.callback=S),h=oo(u,J,U),h!==null&&(Wo(h,u,U,D),hh(h,u,U))},enqueueForceUpdate:function(u,h){u=u._reactInternals;var S=ci(),D=bu(u),U=io(S,D);U.tag=2,h!=null&&(U.callback=h),h=oo(u,U,D),h!==null&&(Wo(h,u,D,S),hh(h,u,D))}};function wh(u,h,S,D,U,J,ue){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(D,J,ue):h.prototype&&h.prototype.isPureReactComponent?!Jl(S,D)||!Jl(U,J):!0}function Mx(u,h,S){var D=!1,U=ro,J=h.contextType;return typeof J=="object"&&J!==null?J=va(J):(U=Qs(h)?pl:zs.current,D=h.contextTypes,J=(D=D!=null)?ic(u,U):ro),h=new h(S,J),u.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=xu,u.stateNode=h,h._reactInternals=u,D&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=U,u.__reactInternalMemoizedMaskedChildContext=J),h}function bg(u,h,S,D){u=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(S,D),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(S,D),h.state!==u&&xu.enqueueReplaceState(h,h.state,null)}function _h(u,h,S,D){var U=u.stateNode;U.props=S,U.state=u.memoizedState,U.refs={},Nd(u);var J=h.contextType;typeof J=="object"&&J!==null?U.context=va(J):(J=Qs(h)?pl:zs.current,U.context=ic(u,J)),U.state=u.memoizedState,J=h.getDerivedStateFromProps,typeof J=="function"&&(pu(u,h,J,S),U.state=u.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(h=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),h!==U.state&&xu.enqueueReplaceState(U,U.state,null),ou(u,S,U,D),U.state=u.memoizedState),typeof U.componentDidMount=="function"&&(u.flags|=4194308)}function mc(u,h){try{var S="",D=h;do S+=Y(D),D=D.return;while(D);var U=S}catch(J){U=`
Error generating stack: `+J.message+`
`+J.stack}return{value:u,source:h,stack:U,digest:null}}function bh(u,h,S){return{value:u,source:null,stack:S??null,digest:h??null}}function yu(u,h){try{console.error(h.value)}catch(S){setTimeout(function(){throw S})}}var yv=typeof WeakMap=="function"?WeakMap:Map;function Ox(u,h,S){S=io(-1,S),S.tag=3,S.payload={element:null};var D=h.value;return S.callback=function(){Wx||(Wx=!0,Ev=D),yu(u,h)},S}function m(u,h,S){S=io(-1,S),S.tag=3;var D=u.type.getDerivedStateFromError;if(typeof D=="function"){var U=h.value;S.payload=function(){return D(U)},S.callback=function(){yu(u,h)}}var J=u.stateNode;return J!==null&&typeof J.componentDidCatch=="function"&&(S.callback=function(){yu(u,h),typeof D!="function"&&(wu===null?wu=new Set([this]):wu.add(this));var ue=h.stack;this.componentDidCatch(h.value,{componentStack:ue!==null?ue:""})}),S}function x(u,h,S){var D=u.pingCache;if(D===null){D=u.pingCache=new yv;var U=new Set;D.set(h,U)}else U=D.get(h),U===void 0&&(U=new Set,D.set(h,U));U.has(S)||(U.add(S),u=kP.bind(null,u,h,S),h.then(u,u))}function F(u){do{var h;if((h=u.tag===13)&&(h=u.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return u;u=u.return}while(u!==null);return null}function B(u,h,S,D,U){return(u.mode&1)===0?(u===h?u.flags|=65536:(u.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(h=io(-1,1),h.tag=2,oo(S,h,1))),S.lanes|=1),u):(u.flags|=65536,u.lanes=U,u)}var K=T.ReactCurrentOwner,re=!1;function ve(u,h,S,D){h.child=u===null?bi(h,null,S,D):fc(h,u.child,S,D)}function $e(u,h,S,D,U){S=S.render;var J=h.ref;return Mo(h,U),D=du(u,h,S,D,J,U),S=fu(),u!==null&&!re?(h.updateQueue=u.updateQueue,h.flags&=-2053,u.lanes&=~U,ra(u,h,U)):(un&&S&&nu(h),h.flags|=1,ve(u,h,D,U),h.child)}function ct(u,h,S,D,U){if(u===null){var J=S.type;return typeof J=="function"&&!Iv(J)&&J.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(h.tag=15,h.type=J,$t(u,h,J,D,U)):(u=qx(S.type,null,D,h,h.mode,U),u.ref=h.ref,u.return=h,h.child=u)}if(J=u.child,(u.lanes&U)===0){var ue=J.memoizedProps;if(S=S.compare,S=S!==null?S:Jl,S(ue,D)&&u.ref===h.ref)return ra(u,h,U)}return h.flags|=1,u=ku(J,D),u.ref=h.ref,u.return=h,h.child=u}function $t(u,h,S,D,U){if(u!==null){var J=u.memoizedProps;if(Jl(J,D)&&u.ref===h.ref)if(re=!1,h.pendingProps=D=J,(u.lanes&U)!==0)(u.flags&131072)!==0&&(re=!0);else return h.lanes=u.lanes,ra(u,h,U)}return Zt(u,h,S,D,U)}function ar(u,h,S){var D=h.pendingProps,U=D.children,J=u!==null?u.memoizedState:null;if(D.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null,transitions:null},pn(kh,zi),zi|=S;else{if((S&1073741824)===0)return u=J!==null?J.baseLanes|S:S,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:u,cachePool:null,transitions:null},h.updateQueue=null,pn(kh,zi),zi|=u,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=J!==null?J.baseLanes:S,pn(kh,zi),zi|=D}else J!==null?(D=J.baseLanes|S,h.memoizedState=null):D=S,pn(kh,zi),zi|=D;return ve(u,h,U,S),h.child}function Dr(u,h){var S=h.ref;(u===null&&S!==null||u!==null&&u.ref!==S)&&(h.flags|=512,h.flags|=2097152)}function Zt(u,h,S,D,U){var J=Qs(S)?pl:zs.current;return J=ic(h,J),Mo(h,U),S=du(u,h,S,D,J,U),D=fu(),u!==null&&!re?(h.updateQueue=u.updateQueue,h.flags&=-2053,u.lanes&=~U,ra(u,h,U)):(un&&D&&nu(h),h.flags|=1,ve(u,h,S,U),h.child)}function Tn(u,h,S,D,U){if(Qs(S)){var J=!0;oc(h)}else J=!1;if(Mo(h,U),h.stateNode===null)Jr(u,h),Mx(h,S,D),_h(h,S,D,U),D=!0;else if(u===null){var ue=h.stateNode,Te=h.memoizedProps;ue.props=Te;var Ie=ue.context,ot=S.contextType;typeof ot=="object"&&ot!==null?ot=va(ot):(ot=Qs(S)?pl:zs.current,ot=ic(h,ot));var Dt=S.getDerivedStateFromProps,Bt=typeof Dt=="function"||typeof ue.getSnapshotBeforeUpdate=="function";Bt||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Te!==D||Ie!==ot)&&bg(h,ue,D,ot),ao=!1;var Ft=h.memoizedState;ue.state=Ft,ou(h,D,ue,U),Ie=h.memoizedState,Te!==D||Ft!==Ie||Js.current||ao?(typeof Dt=="function"&&(pu(h,S,Dt,D),Ie=h.memoizedState),(Te=ao||wh(h,S,Te,D,Ft,Ie,ot))?(Bt||typeof ue.UNSAFE_componentWillMount!="function"&&typeof ue.componentWillMount!="function"||(typeof ue.componentWillMount=="function"&&ue.componentWillMount(),typeof ue.UNSAFE_componentWillMount=="function"&&ue.UNSAFE_componentWillMount()),typeof ue.componentDidMount=="function"&&(h.flags|=4194308)):(typeof ue.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=D,h.memoizedState=Ie),ue.props=D,ue.state=Ie,ue.context=ot,D=Te):(typeof ue.componentDidMount=="function"&&(h.flags|=4194308),D=!1)}else{ue=h.stateNode,fh(u,h),Te=h.memoizedProps,ot=h.type===h.elementType?Te:Hs(h.type,Te),ue.props=ot,Bt=h.pendingProps,Ft=ue.context,Ie=S.contextType,typeof Ie=="object"&&Ie!==null?Ie=va(Ie):(Ie=Qs(S)?pl:zs.current,Ie=ic(h,Ie));var tr=S.getDerivedStateFromProps;(Dt=typeof tr=="function"||typeof ue.getSnapshotBeforeUpdate=="function")||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Te!==Bt||Ft!==Ie)&&bg(h,ue,D,Ie),ao=!1,Ft=h.memoizedState,ue.state=Ft,ou(h,D,ue,U);var lr=h.memoizedState;Te!==Bt||Ft!==lr||Js.current||ao?(typeof tr=="function"&&(pu(h,S,tr,D),lr=h.memoizedState),(ot=ao||wh(h,S,ot,D,Ft,lr,Ie)||!1)?(Dt||typeof ue.UNSAFE_componentWillUpdate!="function"&&typeof ue.componentWillUpdate!="function"||(typeof ue.componentWillUpdate=="function"&&ue.componentWillUpdate(D,lr,Ie),typeof ue.UNSAFE_componentWillUpdate=="function"&&ue.UNSAFE_componentWillUpdate(D,lr,Ie)),typeof ue.componentDidUpdate=="function"&&(h.flags|=4),typeof ue.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof ue.componentDidUpdate!="function"||Te===u.memoizedProps&&Ft===u.memoizedState||(h.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Te===u.memoizedProps&&Ft===u.memoizedState||(h.flags|=1024),h.memoizedProps=D,h.memoizedState=lr),ue.props=D,ue.state=lr,ue.context=Ie,D=ot):(typeof ue.componentDidUpdate!="function"||Te===u.memoizedProps&&Ft===u.memoizedState||(h.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Te===u.memoizedProps&&Ft===u.memoizedState||(h.flags|=1024),D=!1)}return dn(u,h,S,D,J,U)}function dn(u,h,S,D,U,J){Dr(u,h);var ue=(h.flags&128)!==0;if(!D&&!ue)return U&&Cx(h,S,!1),ra(u,h,J);D=h.stateNode,K.current=h;var Te=ue&&typeof S.getDerivedStateFromError!="function"?null:D.render();return h.flags|=1,u!==null&&ue?(h.child=fc(h,u.child,null,J),h.child=fc(h,null,Te,J)):ve(u,h,Te,J),h.memoizedState=D.state,U&&Cx(h,S,!0),h.child}function _a(u){var h=u.stateNode;h.pendingContext?ug(u,h.pendingContext,h.pendingContext!==h.context):h.context&&ug(u,h.context,!1),_l(u,h.containerInfo)}function lo(u,h,S,D,U){return dc(),kd(U),h.flags|=256,ve(u,h,S,D),h.child}var st={dehydrated:null,treeContext:null,retryLane:0};function ze(u){return{baseLanes:u,cachePool:null,transitions:null}}function xt(u,h,S){var D=h.pendingProps,U=Cn.current,J=!1,ue=(h.flags&128)!==0,Te;if((Te=ue)||(Te=u!==null&&u.memoizedState===null?!1:(U&2)!==0),Te?(J=!0,h.flags&=-129):(u===null||u.memoizedState!==null)&&(U|=1),pn(Cn,U&1),u===null)return su(h),u=h.memoizedState,u!==null&&(u=u.dehydrated,u!==null)?((h.mode&1)===0?h.lanes=1:u.data==="$!"?h.lanes=8:h.lanes=1073741824,null):(ue=D.children,u=D.fallback,J?(D=h.mode,J=h.child,ue={mode:"hidden",children:ue},(D&1)===0&&J!==null?(J.childLanes=0,J.pendingProps=ue):J=Xx(ue,D,0,null),u=Id(u,D,S,null),J.return=h,u.return=h,J.sibling=u,h.child=J,h.child.memoizedState=ze(S),h.memoizedState=st,u):er(h,ue));if(U=u.memoizedState,U!==null&&(Te=U.dehydrated,Te!==null))return Wr(u,h,ue,D,Te,U,S);if(J){J=D.fallback,ue=h.mode,U=u.child,Te=U.sibling;var Ie={mode:"hidden",children:D.children};return(ue&1)===0&&h.child!==U?(D=h.child,D.childLanes=0,D.pendingProps=Ie,h.deletions=null):(D=ku(U,Ie),D.subtreeFlags=U.subtreeFlags&14680064),Te!==null?J=ku(Te,J):(J=Id(J,ue,S,null),J.flags|=2),J.return=h,D.return=h,D.sibling=J,h.child=D,D=J,J=h.child,ue=u.child.memoizedState,ue=ue===null?ze(S):{baseLanes:ue.baseLanes|S,cachePool:null,transitions:ue.transitions},J.memoizedState=ue,J.childLanes=u.childLanes&~S,h.memoizedState=st,D}return J=u.child,u=J.sibling,D=ku(J,{mode:"visible",children:D.children}),(h.mode&1)===0&&(D.lanes=S),D.return=h,D.sibling=null,u!==null&&(S=h.deletions,S===null?(h.deletions=[u],h.flags|=16):S.push(u)),h.child=D,h.memoizedState=null,D}function er(u,h){return h=Xx({mode:"visible",children:h},u.mode,0,null),h.return=u,u.child=h}function gr(u,h,S,D){return D!==null&&kd(D),fc(h,u.child,null,S),u=er(h,h.pendingProps.children),u.flags|=2,h.memoizedState=null,u}function Wr(u,h,S,D,U,J,ue){if(S)return h.flags&256?(h.flags&=-257,D=bh(Error(r(422))),gr(u,h,ue,D)):h.memoizedState!==null?(h.child=u.child,h.flags|=128,null):(J=D.fallback,U=h.mode,D=Xx({mode:"visible",children:D.children},U,0,null),J=Id(J,U,ue,null),J.flags|=2,D.return=h,J.return=h,D.sibling=J,h.child=D,(h.mode&1)!==0&&fc(h,u.child,null,ue),h.child.memoizedState=ze(ue),h.memoizedState=st,J);if((h.mode&1)===0)return gr(u,h,ue,null);if(U.data==="$!"){if(D=U.nextSibling&&U.nextSibling.dataset,D)var Te=D.dgst;return D=Te,J=Error(r(419)),D=bh(J,D,void 0),gr(u,h,ue,D)}if(Te=(ue&u.childLanes)!==0,re||Te){if(D=na,D!==null){switch(ue&-ue){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}U=(U&(D.suspendedLanes|ue))!==0?0:U,U!==0&&U!==J.retryLane&&(J.retryLane=U,oi(u,U),Wo(D,u,U,-1))}return Dv(),D=bh(Error(r(421))),gr(u,h,ue,D)}return U.data==="$?"?(h.flags|=128,h.child=u.child,h=CP.bind(null,u),U._reactRetry=h,null):(u=J.treeContext,Jt=eo(U.nextSibling),si=h,un=!0,ai=null,u!==null&&(xa[ya++]=ni,xa[ya++]=Pn,xa[ya++]=wl,ni=u.id,Pn=u.overflow,wl=h),h=er(h,D.children),h.flags|=4096,h)}function Ir(u,h,S){u.lanes|=h;var D=u.alternate;D!==null&&(D.lanes|=h),dh(u.return,h,S)}function Zr(u,h,S,D,U){var J=u.memoizedState;J===null?u.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:D,tail:S,tailMode:U}:(J.isBackwards=h,J.rendering=null,J.renderingStartTime=0,J.last=D,J.tail=S,J.tailMode=U)}function bs(u,h,S){var D=h.pendingProps,U=D.revealOrder,J=D.tail;if(ve(u,h,D.children,S),D=Cn.current,(D&2)!==0)D=D&1|2,h.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=h.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&Ir(u,S,h);else if(u.tag===19)Ir(u,S,h);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===h)break e;for(;u.sibling===null;){if(u.return===null||u.return===h)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}D&=1}if(pn(Cn,D),(h.mode&1)===0)h.memoizedState=null;else switch(U){case"forwards":for(S=h.child,U=null;S!==null;)u=S.alternate,u!==null&&cu(u)===null&&(U=S),S=S.sibling;S=U,S===null?(U=h.child,h.child=null):(U=S.sibling,S.sibling=null),Zr(h,!1,U,S,J);break;case"backwards":for(S=null,U=h.child,h.child=null;U!==null;){if(u=U.alternate,u!==null&&cu(u)===null){h.child=U;break}u=U.sibling,U.sibling=S,S=U,U=u}Zr(h,!0,S,null,J);break;case"together":Zr(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Jr(u,h){(h.mode&1)===0&&u!==null&&(u.alternate=null,h.alternate=null,h.flags|=2)}function ra(u,h,S){if(u!==null&&(h.dependencies=u.dependencies),Fd|=h.lanes,(S&h.childLanes)===0)return null;if(u!==null&&h.child!==u.child)throw Error(r(153));if(h.child!==null){for(u=h.child,S=ku(u,u.pendingProps),h.child=S,S.return=h;u.sibling!==null;)u=u.sibling,S=S.sibling=ku(u,u.pendingProps),S.return=h;S.sibling=null}return h.child}function vv(u,h,S){switch(h.tag){case 3:_a(h),dc();break;case 5:lu(h);break;case 1:Qs(h.type)&&oc(h);break;case 4:_l(h,h.stateNode.containerInfo);break;case 10:var D=h.type._context,U=h.memoizedProps.value;pn(Cd,D._currentValue),D._currentValue=U;break;case 13:if(D=h.memoizedState,D!==null)return D.dehydrated!==null?(pn(Cn,Cn.current&1),h.flags|=128,null):(S&h.child.childLanes)!==0?xt(u,h,S):(pn(Cn,Cn.current&1),u=ra(u,h,S),u!==null?u.sibling:null);pn(Cn,Cn.current&1);break;case 19:if(D=(S&h.childLanes)!==0,(u.flags&128)!==0){if(D)return bs(u,h,S);h.flags|=128}if(U=h.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),pn(Cn,Cn.current),D)break;return null;case 22:case 23:return h.lanes=0,ar(u,h,S)}return ra(u,h,S)}var KS,wv,qS,XS;KS=function(u,h){for(var S=h.child;S!==null;){if(S.tag===5||S.tag===6)u.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===h)break;for(;S.sibling===null;){if(S.return===null||S.return===h)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},wv=function(){},qS=function(u,h,S,D){var U=u.memoizedProps;if(U!==D){u=h.stateNode,ws(xn.current);var J=null;switch(S){case"input":U=Fe(u,U),D=Fe(u,D),J=[];break;case"select":U=z({},U,{value:void 0}),D=z({},D,{value:void 0}),J=[];break;case"textarea":U=et(u,U),D=et(u,D),J=[];break;default:typeof U.onClick!="function"&&typeof D.onClick=="function"&&(u.onclick=nc)}fr(S,D);var ue;S=null;for(ot in U)if(!D.hasOwnProperty(ot)&&U.hasOwnProperty(ot)&&U[ot]!=null)if(ot==="style"){var Te=U[ot];for(ue in Te)Te.hasOwnProperty(ue)&&(S||(S={}),S[ue]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(s.hasOwnProperty(ot)?J||(J=[]):(J=J||[]).push(ot,null));for(ot in D){var Ie=D[ot];if(Te=U?.[ot],D.hasOwnProperty(ot)&&Ie!==Te&&(Ie!=null||Te!=null))if(ot==="style")if(Te){for(ue in Te)!Te.hasOwnProperty(ue)||Ie&&Ie.hasOwnProperty(ue)||(S||(S={}),S[ue]="");for(ue in Ie)Ie.hasOwnProperty(ue)&&Te[ue]!==Ie[ue]&&(S||(S={}),S[ue]=Ie[ue])}else S||(J||(J=[]),J.push(ot,S)),S=Ie;else ot==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Te=Te?Te.__html:void 0,Ie!=null&&Te!==Ie&&(J=J||[]).push(ot,Ie)):ot==="children"?typeof Ie!="string"&&typeof Ie!="number"||(J=J||[]).push(ot,""+Ie):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(s.hasOwnProperty(ot)?(Ie!=null&&ot==="onScroll"&&Sn("scroll",u),J||Te===Ie||(J=[])):(J=J||[]).push(ot,Ie))}S&&(J=J||[]).push("style",S);var ot=J;(h.updateQueue=ot)&&(h.flags|=4)}},XS=function(u,h,S,D){S!==D&&(h.flags|=4)};function Sg(u,h){if(!un)switch(u.tailMode){case"hidden":h=u.tail;for(var S=null;h!==null;)h.alternate!==null&&(S=h),h=h.sibling;S===null?u.tail=null:S.sibling=null;break;case"collapsed":S=u.tail;for(var D=null;S!==null;)S.alternate!==null&&(D=S),S=S.sibling;D===null?h||u.tail===null?u.tail=null:u.tail.sibling=null:D.sibling=null}}function Oa(u){var h=u.alternate!==null&&u.alternate.child===u.child,S=0,D=0;if(h)for(var U=u.child;U!==null;)S|=U.lanes|U.childLanes,D|=U.subtreeFlags&14680064,D|=U.flags&14680064,U.return=u,U=U.sibling;else for(U=u.child;U!==null;)S|=U.lanes|U.childLanes,D|=U.subtreeFlags,D|=U.flags,U.return=u,U=U.sibling;return u.subtreeFlags|=D,u.childLanes=S,h}function gP(u,h,S){var D=h.pendingProps;switch(Ps(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oa(h),null;case 1:return Qs(h.type)&&tu(),Oa(h),null;case 3:return D=h.stateNode,Dn(),kn(Js),kn(zs),Zs(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(u===null||u.child===null)&&(Sd(h)?h.flags|=4:u===null||u.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,ai!==null&&(Fv(ai),ai=null))),wv(u,h),Oa(h),null;case 5:Oo(h);var U=ws(Yn.current);if(S=h.type,u!==null&&h.stateNode!=null)qS(u,h,S,D,U),u.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!D){if(h.stateNode===null)throw Error(r(166));return Oa(h),null}if(u=ws(xn.current),Sd(h)){D=h.stateNode,S=h.type;var J=h.memoizedProps;switch(D[_i]=h,D[wd]=J,u=(h.mode&1)!==0,S){case"dialog":Sn("cancel",D),Sn("close",D);break;case"iframe":case"object":case"embed":Sn("load",D);break;case"video":case"audio":for(U=0;U<hl.length;U++)Sn(hl[U],D);break;case"source":Sn("error",D);break;case"img":case"image":case"link":Sn("error",D),Sn("load",D);break;case"details":Sn("toggle",D);break;case"input":Me(D,J),Sn("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!J.multiple},Sn("invalid",D);break;case"textarea":bt(D,J),Sn("invalid",D)}fr(S,J),U=null;for(var ue in J)if(J.hasOwnProperty(ue)){var Te=J[ue];ue==="children"?typeof Te=="string"?D.textContent!==Te&&(J.suppressHydrationWarning!==!0&&yd(D.textContent,Te,u),U=["children",Te]):typeof Te=="number"&&D.textContent!==""+Te&&(J.suppressHydrationWarning!==!0&&yd(D.textContent,Te,u),U=["children",""+Te]):s.hasOwnProperty(ue)&&Te!=null&&ue==="onScroll"&&Sn("scroll",D)}switch(S){case"input":Pe(D),It(D,J,!0);break;case"textarea":Pe(D),jt(D);break;case"select":case"option":break;default:typeof J.onClick=="function"&&(D.onclick=nc)}D=U,h.updateQueue=D,D!==null&&(h.flags|=4)}else{ue=U.nodeType===9?U:U.ownerDocument,u==="http://www.w3.org/1999/xhtml"&&(u=Rt(S)),u==="http://www.w3.org/1999/xhtml"?S==="script"?(u=ue.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild)):typeof D.is=="string"?u=ue.createElement(S,{is:D.is}):(u=ue.createElement(S),S==="select"&&(ue=u,D.multiple?ue.multiple=!0:D.size&&(ue.size=D.size))):u=ue.createElementNS(u,S),u[_i]=h,u[wd]=D,KS(u,h,!1,!1),h.stateNode=u;e:{switch(ue=hr(S,D),S){case"dialog":Sn("cancel",u),Sn("close",u),U=D;break;case"iframe":case"object":case"embed":Sn("load",u),U=D;break;case"video":case"audio":for(U=0;U<hl.length;U++)Sn(hl[U],u);U=D;break;case"source":Sn("error",u),U=D;break;case"img":case"image":case"link":Sn("error",u),Sn("load",u),U=D;break;case"details":Sn("toggle",u),U=D;break;case"input":Me(u,D),U=Fe(u,D),Sn("invalid",u);break;case"option":U=D;break;case"select":u._wrapperState={wasMultiple:!!D.multiple},U=z({},D,{value:void 0}),Sn("invalid",u);break;case"textarea":bt(u,D),U=et(u,D),Sn("invalid",u);break;default:U=D}fr(S,U),Te=U;for(J in Te)if(Te.hasOwnProperty(J)){var Ie=Te[J];J==="style"?nr(u,Ie):J==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Ie!=null&&pt(u,Ie)):J==="children"?typeof Ie=="string"?(S!=="textarea"||Ie!=="")&&mt(u,Ie):typeof Ie=="number"&&mt(u,""+Ie):J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&J!=="autoFocus"&&(s.hasOwnProperty(J)?Ie!=null&&J==="onScroll"&&Sn("scroll",u):Ie!=null&&_(u,J,Ie,ue))}switch(S){case"input":Pe(u),It(u,D,!1);break;case"textarea":Pe(u),jt(u);break;case"option":D.value!=null&&u.setAttribute("value",""+ne(D.value));break;case"select":u.multiple=!!D.multiple,J=D.value,J!=null?De(u,!!D.multiple,J,!1):D.defaultValue!=null&&De(u,!!D.multiple,D.defaultValue,!0);break;default:typeof U.onClick=="function"&&(u.onclick=nc)}switch(S){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return Oa(h),null;case 6:if(u&&h.stateNode!=null)XS(u,h,u.memoizedProps,D);else{if(typeof D!="string"&&h.stateNode===null)throw Error(r(166));if(S=ws(Yn.current),ws(xn.current),Sd(h)){if(D=h.stateNode,S=h.memoizedProps,D[_i]=h,(J=D.nodeValue!==S)&&(u=si,u!==null))switch(u.tag){case 3:yd(D.nodeValue,S,(u.mode&1)!==0);break;case 5:u.memoizedProps.suppressHydrationWarning!==!0&&yd(D.nodeValue,S,(u.mode&1)!==0)}J&&(h.flags|=4)}else D=(S.nodeType===9?S:S.ownerDocument).createTextNode(D),D[_i]=h,h.stateNode=D}return Oa(h),null;case 13:if(kn(Cn),D=h.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(un&&Jt!==null&&(h.mode&1)!==0&&(h.flags&128)===0)fg(),dc(),h.flags|=98560,J=!1;else if(J=Sd(h),D!==null&&D.dehydrated!==null){if(u===null){if(!J)throw Error(r(318));if(J=h.memoizedState,J=J!==null?J.dehydrated:null,!J)throw Error(r(317));J[_i]=h}else dc(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Oa(h),J=!1}else ai!==null&&(Fv(ai),ai=null),J=!0;if(!J)return h.flags&65536?h:null}return(h.flags&128)!==0?(h.lanes=S,h):(D=D!==null,D!==(u!==null&&u.memoizedState!==null)&&D&&(h.child.flags|=8192,(h.mode&1)!==0&&(u===null||(Cn.current&1)!==0?Gs===0&&(Gs=3):Dv())),h.updateQueue!==null&&(h.flags|=4),Oa(h),null);case 4:return Dn(),wv(u,h),u===null&&tc(h.stateNode.containerInfo),Oa(h),null;case 10:return uh(h.type._context),Oa(h),null;case 17:return Qs(h.type)&&tu(),Oa(h),null;case 19:if(kn(Cn),J=h.memoizedState,J===null)return Oa(h),null;if(D=(h.flags&128)!==0,ue=J.rendering,ue===null)if(D)Sg(J,!1);else{if(Gs!==0||u!==null&&(u.flags&128)!==0)for(u=h.child;u!==null;){if(ue=cu(u),ue!==null){for(h.flags|=128,Sg(J,!1),D=ue.updateQueue,D!==null&&(h.updateQueue=D,h.flags|=4),h.subtreeFlags=0,D=S,S=h.child;S!==null;)J=S,u=D,J.flags&=14680066,ue=J.alternate,ue===null?(J.childLanes=0,J.lanes=u,J.child=null,J.subtreeFlags=0,J.memoizedProps=null,J.memoizedState=null,J.updateQueue=null,J.dependencies=null,J.stateNode=null):(J.childLanes=ue.childLanes,J.lanes=ue.lanes,J.child=ue.child,J.subtreeFlags=0,J.deletions=null,J.memoizedProps=ue.memoizedProps,J.memoizedState=ue.memoizedState,J.updateQueue=ue.updateQueue,J.type=ue.type,u=ue.dependencies,J.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),S=S.sibling;return pn(Cn,Cn.current&1|2),h.child}u=u.sibling}J.tail!==null&&yt()>Ch&&(h.flags|=128,D=!0,Sg(J,!1),h.lanes=4194304)}else{if(!D)if(u=cu(ue),u!==null){if(h.flags|=128,D=!0,S=u.updateQueue,S!==null&&(h.updateQueue=S,h.flags|=4),Sg(J,!0),J.tail===null&&J.tailMode==="hidden"&&!ue.alternate&&!un)return Oa(h),null}else 2*yt()-J.renderingStartTime>Ch&&S!==1073741824&&(h.flags|=128,D=!0,Sg(J,!1),h.lanes=4194304);J.isBackwards?(ue.sibling=h.child,h.child=ue):(S=J.last,S!==null?S.sibling=ue:h.child=ue,J.last=ue)}return J.tail!==null?(h=J.tail,J.rendering=h,J.tail=h.sibling,J.renderingStartTime=yt(),h.sibling=null,S=Cn.current,pn(Cn,D?S&1|2:S&1),h):(Oa(h),null);case 22:case 23:return Rv(),D=h.memoizedState!==null,u!==null&&u.memoizedState!==null!==D&&(h.flags|=8192),D&&(h.mode&1)!==0?(zi&1073741824)!==0&&(Oa(h),h.subtreeFlags&6&&(h.flags|=8192)):Oa(h),null;case 24:return null;case 25:return null}throw Error(r(156,h.tag))}function mP(u,h){switch(Ps(h),h.tag){case 1:return Qs(h.type)&&tu(),u=h.flags,u&65536?(h.flags=u&-65537|128,h):null;case 3:return Dn(),kn(Js),kn(zs),Zs(),u=h.flags,(u&65536)!==0&&(u&128)===0?(h.flags=u&-65537|128,h):null;case 5:return Oo(h),null;case 13:if(kn(Cn),u=h.memoizedState,u!==null&&u.dehydrated!==null){if(h.alternate===null)throw Error(r(340));dc()}return u=h.flags,u&65536?(h.flags=u&-65537|128,h):null;case 19:return kn(Cn),null;case 4:return Dn(),null;case 10:return uh(h.type._context),null;case 22:case 23:return Rv(),null;case 24:return null;default:return null}}var Lx=!1,La=!1,pP=typeof WeakSet=="function"?WeakSet:Set,ir=null;function Sh(u,h){var S=u.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(D){is(u,h,D)}else S.current=null}function _v(u,h,S){try{S()}catch(D){is(u,h,D)}}var YS=!1;function xP(u,h){if(ig=Mf,u=ys(),Jc(u)){if("selectionStart"in u)var S={start:u.selectionStart,end:u.selectionEnd};else e:{S=(S=u.ownerDocument)&&S.defaultView||window;var D=S.getSelection&&S.getSelection();if(D&&D.rangeCount!==0){S=D.anchorNode;var U=D.anchorOffset,J=D.focusNode;D=D.focusOffset;try{S.nodeType,J.nodeType}catch{S=null;break e}var ue=0,Te=-1,Ie=-1,ot=0,Dt=0,Bt=u,Ft=null;t:for(;;){for(var tr;Bt!==S||U!==0&&Bt.nodeType!==3||(Te=ue+U),Bt!==J||D!==0&&Bt.nodeType!==3||(Ie=ue+D),Bt.nodeType===3&&(ue+=Bt.nodeValue.length),(tr=Bt.firstChild)!==null;)Ft=Bt,Bt=tr;for(;;){if(Bt===u)break t;if(Ft===S&&++ot===U&&(Te=ue),Ft===J&&++Dt===D&&(Ie=ue),(tr=Bt.nextSibling)!==null)break;Bt=Ft,Ft=Bt.parentNode}Bt=tr}S=Te===-1||Ie===-1?null:{start:Te,end:Ie}}else S=null}S=S||{start:0,end:0}}else S=null;for(og={focusedElem:u,selectionRange:S},Mf=!1,ir=h;ir!==null;)if(h=ir,u=h.child,(h.subtreeFlags&1028)!==0&&u!==null)u.return=h,ir=u;else for(;ir!==null;){h=ir;try{var lr=h.alternate;if((h.flags&1024)!==0)switch(h.tag){case 0:case 11:case 15:break;case 1:if(lr!==null){var cr=lr.memoizedProps,Ss=lr.memoizedState,qe=h.stateNode,Ue=qe.getSnapshotBeforeUpdate(h.elementType===h.type?cr:Hs(h.type,cr),Ss);qe.__reactInternalSnapshotBeforeUpdate=Ue}break;case 3:var nt=h.stateNode.containerInfo;nt.nodeType===1?nt.textContent="":nt.nodeType===9&&nt.documentElement&&nt.removeChild(nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Wt){is(h,h.return,Wt)}if(u=h.sibling,u!==null){u.return=h.return,ir=u;break}ir=h.return}return lr=YS,YS=!1,lr}function kg(u,h,S){var D=h.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var U=D=D.next;do{if((U.tag&u)===u){var J=U.destroy;U.destroy=void 0,J!==void 0&&_v(h,S,J)}U=U.next}while(U!==D)}}function Bx(u,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var S=h=h.next;do{if((S.tag&u)===u){var D=S.create;S.destroy=D()}S=S.next}while(S!==h)}}function bv(u){var h=u.ref;if(h!==null){var S=u.stateNode;switch(u.tag){case 5:u=S;break;default:u=S}typeof h=="function"?h(u):h.current=u}}function JS(u){var h=u.alternate;h!==null&&(u.alternate=null,JS(h)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(h=u.stateNode,h!==null&&(delete h[_i],delete h[wd],delete h[rh],delete h[Sx],delete h[kx])),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}function QS(u){return u.tag===5||u.tag===3||u.tag===4}function ZS(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||QS(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function Sv(u,h,S){var D=u.tag;if(D===5||D===6)u=u.stateNode,h?S.nodeType===8?S.parentNode.insertBefore(u,h):S.insertBefore(u,h):(S.nodeType===8?(h=S.parentNode,h.insertBefore(u,S)):(h=S,h.appendChild(u)),S=S._reactRootContainer,S!=null||h.onclick!==null||(h.onclick=nc));else if(D!==4&&(u=u.child,u!==null))for(Sv(u,h,S),u=u.sibling;u!==null;)Sv(u,h,S),u=u.sibling}function kv(u,h,S){var D=u.tag;if(D===5||D===6)u=u.stateNode,h?S.insertBefore(u,h):S.appendChild(u);else if(D!==4&&(u=u.child,u!==null))for(kv(u,h,S),u=u.sibling;u!==null;)kv(u,h,S),u=u.sibling}var ba=null,Uo=!1;function vu(u,h,S){for(S=S.child;S!==null;)ek(u,h,S),S=S.sibling}function ek(u,h,S){if(Kr&&typeof Kr.onCommitFiberUnmount=="function")try{Kr.onCommitFiberUnmount(hn,S)}catch{}switch(S.tag){case 5:La||Sh(S,h);case 6:var D=ba,U=Uo;ba=null,vu(u,h,S),ba=D,Uo=U,ba!==null&&(Uo?(u=ba,S=S.stateNode,u.nodeType===8?u.parentNode.removeChild(S):u.removeChild(S)):ba.removeChild(S.stateNode));break;case 18:ba!==null&&(Uo?(u=ba,S=S.stateNode,u.nodeType===8?th(u.parentNode,S):u.nodeType===1&&th(u,S),Ra(u)):th(ba,S.stateNode));break;case 4:D=ba,U=Uo,ba=S.stateNode.containerInfo,Uo=!0,vu(u,h,S),ba=D,Uo=U;break;case 0:case 11:case 14:case 15:if(!La&&(D=S.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){U=D=D.next;do{var J=U,ue=J.destroy;J=J.tag,ue!==void 0&&((J&2)!==0||(J&4)!==0)&&_v(S,h,ue),U=U.next}while(U!==D)}vu(u,h,S);break;case 1:if(!La&&(Sh(S,h),D=S.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=S.memoizedProps,D.state=S.memoizedState,D.componentWillUnmount()}catch(Te){is(S,h,Te)}vu(u,h,S);break;case 21:vu(u,h,S);break;case 22:S.mode&1?(La=(D=La)||S.memoizedState!==null,vu(u,h,S),La=D):vu(u,h,S);break;default:vu(u,h,S)}}function tk(u){var h=u.updateQueue;if(h!==null){u.updateQueue=null;var S=u.stateNode;S===null&&(S=u.stateNode=new pP),h.forEach(function(D){var U=TP.bind(null,u,D);S.has(D)||(S.add(D),D.then(U,U))})}}function $o(u,h){var S=h.deletions;if(S!==null)for(var D=0;D<S.length;D++){var U=S[D];try{var J=u,ue=h,Te=ue;e:for(;Te!==null;){switch(Te.tag){case 5:ba=Te.stateNode,Uo=!1;break e;case 3:ba=Te.stateNode.containerInfo,Uo=!0;break e;case 4:ba=Te.stateNode.containerInfo,Uo=!0;break e}Te=Te.return}if(ba===null)throw Error(r(160));ek(J,ue,U),ba=null,Uo=!1;var Ie=U.alternate;Ie!==null&&(Ie.return=null),U.return=null}catch(ot){is(U,h,ot)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)rk(h,u),h=h.sibling}function rk(u,h){var S=u.alternate,D=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:if($o(h,u),Tl(u),D&4){try{kg(3,u,u.return),Bx(3,u)}catch(cr){is(u,u.return,cr)}try{kg(5,u,u.return)}catch(cr){is(u,u.return,cr)}}break;case 1:$o(h,u),Tl(u),D&512&&S!==null&&Sh(S,S.return);break;case 5:if($o(h,u),Tl(u),D&512&&S!==null&&Sh(S,S.return),u.flags&32){var U=u.stateNode;try{mt(U,"")}catch(cr){is(u,u.return,cr)}}if(D&4&&(U=u.stateNode,U!=null)){var J=u.memoizedProps,ue=S!==null?S.memoizedProps:J,Te=u.type,Ie=u.updateQueue;if(u.updateQueue=null,Ie!==null)try{Te==="input"&&J.type==="radio"&&J.name!=null&&Oe(U,J),hr(Te,ue);var ot=hr(Te,J);for(ue=0;ue<Ie.length;ue+=2){var Dt=Ie[ue],Bt=Ie[ue+1];Dt==="style"?nr(U,Bt):Dt==="dangerouslySetInnerHTML"?pt(U,Bt):Dt==="children"?mt(U,Bt):_(U,Dt,Bt,ot)}switch(Te){case"input":He(U,J);break;case"textarea":ut(U,J);break;case"select":var Ft=U._wrapperState.wasMultiple;U._wrapperState.wasMultiple=!!J.multiple;var tr=J.value;tr!=null?De(U,!!J.multiple,tr,!1):Ft!==!!J.multiple&&(J.defaultValue!=null?De(U,!!J.multiple,J.defaultValue,!0):De(U,!!J.multiple,J.multiple?[]:"",!1))}U[wd]=J}catch(cr){is(u,u.return,cr)}}break;case 6:if($o(h,u),Tl(u),D&4){if(u.stateNode===null)throw Error(r(162));U=u.stateNode,J=u.memoizedProps;try{U.nodeValue=J}catch(cr){is(u,u.return,cr)}}break;case 3:if($o(h,u),Tl(u),D&4&&S!==null&&S.memoizedState.isDehydrated)try{Ra(h.containerInfo)}catch(cr){is(u,u.return,cr)}break;case 4:$o(h,u),Tl(u);break;case 13:$o(h,u),Tl(u),U=u.child,U.flags&8192&&(J=U.memoizedState!==null,U.stateNode.isHidden=J,!J||U.alternate!==null&&U.alternate.memoizedState!==null||(Nv=yt())),D&4&&tk(u);break;case 22:if(Dt=S!==null&&S.memoizedState!==null,u.mode&1?(La=(ot=La)||Dt,$o(h,u),La=ot):$o(h,u),Tl(u),D&8192){if(ot=u.memoizedState!==null,(u.stateNode.isHidden=ot)&&!Dt&&(u.mode&1)!==0)for(ir=u,Dt=u.child;Dt!==null;){for(Bt=ir=Dt;ir!==null;){switch(Ft=ir,tr=Ft.child,Ft.tag){case 0:case 11:case 14:case 15:kg(4,Ft,Ft.return);break;case 1:Sh(Ft,Ft.return);var lr=Ft.stateNode;if(typeof lr.componentWillUnmount=="function"){D=Ft,S=Ft.return;try{h=D,lr.props=h.memoizedProps,lr.state=h.memoizedState,lr.componentWillUnmount()}catch(cr){is(D,S,cr)}}break;case 5:Sh(Ft,Ft.return);break;case 22:if(Ft.memoizedState!==null){ak(Bt);continue}}tr!==null?(tr.return=Ft,ir=tr):ak(Bt)}Dt=Dt.sibling}e:for(Dt=null,Bt=u;;){if(Bt.tag===5){if(Dt===null){Dt=Bt;try{U=Bt.stateNode,ot?(J=U.style,typeof J.setProperty=="function"?J.setProperty("display","none","important"):J.display="none"):(Te=Bt.stateNode,Ie=Bt.memoizedProps.style,ue=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null,Te.style.display=Qt("display",ue))}catch(cr){is(u,u.return,cr)}}}else if(Bt.tag===6){if(Dt===null)try{Bt.stateNode.nodeValue=ot?"":Bt.memoizedProps}catch(cr){is(u,u.return,cr)}}else if((Bt.tag!==22&&Bt.tag!==23||Bt.memoizedState===null||Bt===u)&&Bt.child!==null){Bt.child.return=Bt,Bt=Bt.child;continue}if(Bt===u)break e;for(;Bt.sibling===null;){if(Bt.return===null||Bt.return===u)break e;Dt===Bt&&(Dt=null),Bt=Bt.return}Dt===Bt&&(Dt=null),Bt.sibling.return=Bt.return,Bt=Bt.sibling}}break;case 19:$o(h,u),Tl(u),D&4&&tk(u);break;case 21:break;default:$o(h,u),Tl(u)}}function Tl(u){var h=u.flags;if(h&2){try{e:{for(var S=u.return;S!==null;){if(QS(S)){var D=S;break e}S=S.return}throw Error(r(160))}switch(D.tag){case 5:var U=D.stateNode;D.flags&32&&(mt(U,""),D.flags&=-33);var J=ZS(u);kv(u,J,U);break;case 3:case 4:var ue=D.stateNode.containerInfo,Te=ZS(u);Sv(u,Te,ue);break;default:throw Error(r(161))}}catch(Ie){is(u,u.return,Ie)}u.flags&=-3}h&4096&&(u.flags&=-4097)}function yP(u,h,S){ir=u,nk(u)}function nk(u,h,S){for(var D=(u.mode&1)!==0;ir!==null;){var U=ir,J=U.child;if(U.tag===22&&D){var ue=U.memoizedState!==null||Lx;if(!ue){var Te=U.alternate,Ie=Te!==null&&Te.memoizedState!==null||La;Te=Lx;var ot=La;if(Lx=ue,(La=Ie)&&!ot)for(ir=U;ir!==null;)ue=ir,Ie=ue.child,ue.tag===22&&ue.memoizedState!==null?ik(U):Ie!==null?(Ie.return=ue,ir=Ie):ik(U);for(;J!==null;)ir=J,nk(J),J=J.sibling;ir=U,Lx=Te,La=ot}sk(u)}else(U.subtreeFlags&8772)!==0&&J!==null?(J.return=U,ir=J):sk(u)}}function sk(u){for(;ir!==null;){var h=ir;if((h.flags&8772)!==0){var S=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:La||Bx(5,h);break;case 1:var D=h.stateNode;if(h.flags&4&&!La)if(S===null)D.componentDidMount();else{var U=h.elementType===h.type?S.memoizedProps:Hs(h.type,S.memoizedProps);D.componentDidUpdate(U,S.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var J=h.updateQueue;J!==null&&Hn(h,J,D);break;case 3:var ue=h.updateQueue;if(ue!==null){if(S=null,h.child!==null)switch(h.child.tag){case 5:S=h.child.stateNode;break;case 1:S=h.child.stateNode}Hn(h,ue,S)}break;case 5:var Te=h.stateNode;if(S===null&&h.flags&4){S=Te;var Ie=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":Ie.autoFocus&&S.focus();break;case"img":Ie.src&&(S.src=Ie.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var ot=h.alternate;if(ot!==null){var Dt=ot.memoizedState;if(Dt!==null){var Bt=Dt.dehydrated;Bt!==null&&Ra(Bt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}La||h.flags&512&&bv(h)}catch(Ft){is(h,h.return,Ft)}}if(h===u){ir=null;break}if(S=h.sibling,S!==null){S.return=h.return,ir=S;break}ir=h.return}}function ak(u){for(;ir!==null;){var h=ir;if(h===u){ir=null;break}var S=h.sibling;if(S!==null){S.return=h.return,ir=S;break}ir=h.return}}function ik(u){for(;ir!==null;){var h=ir;try{switch(h.tag){case 0:case 11:case 15:var S=h.return;try{Bx(4,h)}catch(Ie){is(h,S,Ie)}break;case 1:var D=h.stateNode;if(typeof D.componentDidMount=="function"){var U=h.return;try{D.componentDidMount()}catch(Ie){is(h,U,Ie)}}var J=h.return;try{bv(h)}catch(Ie){is(h,J,Ie)}break;case 5:var ue=h.return;try{bv(h)}catch(Ie){is(h,ue,Ie)}}}catch(Ie){is(h,h.return,Ie)}if(h===u){ir=null;break}var Te=h.sibling;if(Te!==null){Te.return=h.return,ir=Te;break}ir=h.return}}var vP=Math.ceil,Ux=T.ReactCurrentDispatcher,Cv=T.ReactCurrentOwner,co=T.ReactCurrentBatchConfig,rn=0,na=null,Rs=null,Sa=0,zi=0,kh=Do(0),Gs=0,Cg=null,Fd=0,$x=0,Tv=0,Tg=null,ki=null,Nv=0,Ch=1/0,pc=null,Wx=!1,Ev=null,wu=null,zx=!1,_u=null,Hx=0,Ng=0,jv=null,Gx=-1,Vx=0;function ci(){return(rn&6)!==0?yt():Gx!==-1?Gx:Gx=yt()}function bu(u){return(u.mode&1)===0?1:(rn&2)!==0&&Sa!==0?Sa&-Sa:hg.transition!==null?(Vx===0&&(Vx=Ut()),Vx):(u=Pt,u!==0||(u=window.event,u=u===void 0?16:ix(u.type)),u)}function Wo(u,h,S,D){if(50<Ng)throw Ng=0,jv=null,Error(r(185));Mr(u,S,D),((rn&2)===0||u!==na)&&(u===na&&((rn&2)===0&&($x|=S),Gs===4&&Su(u,Sa)),Ci(u,D),S===1&&rn===0&&(h.mode&1)===0&&(Ch=yt()+500,ru&&xl()))}function Ci(u,h){var S=u.callbackNode;it(u,h);var D=Ke(u,u===na?Sa:0);if(D===0)S!==null&&Ne(S),u.callbackNode=null,u.callbackPriority=0;else if(h=D&-D,u.callbackPriority!==h){if(S!=null&&Ne(S),h===1)u.tag===0?Io(lk.bind(null,u)):bd(lk.bind(null,u)),_x(function(){(rn&6)===0&&xl()}),S=null;else{switch(zn(D)){case 1:S=gt;break;case 4:S=Ot;break;case 16:S=vr;break;case 536870912:S=Pr;break;default:S=vr}S=pk(S,ok.bind(null,u))}u.callbackPriority=h,u.callbackNode=S}}function ok(u,h){if(Gx=-1,Vx=0,(rn&6)!==0)throw Error(r(327));var S=u.callbackNode;if(Th()&&u.callbackNode!==S)return null;var D=Ke(u,u===na?Sa:0);if(D===0)return null;if((D&30)!==0||(D&u.expiredLanes)!==0||h)h=Kx(u,D);else{h=D;var U=rn;rn|=2;var J=uk();(na!==u||Sa!==h)&&(pc=null,Ch=yt()+500,Rd(u,h));do try{bP();break}catch(Te){ck(u,Te)}while(!0);ch(),Ux.current=J,rn=U,Rs!==null?h=0:(na=null,Sa=0,h=Gs)}if(h!==0){if(h===2&&(U=_r(u),U!==0&&(D=U,h=Av(u,U))),h===1)throw S=Cg,Rd(u,0),Su(u,D),Ci(u,yt()),S;if(h===6)Su(u,D);else{if(U=u.current.alternate,(D&30)===0&&!wP(U)&&(h=Kx(u,D),h===2&&(J=_r(u),J!==0&&(D=J,h=Av(u,J))),h===1))throw S=Cg,Rd(u,0),Su(u,D),Ci(u,yt()),S;switch(u.finishedWork=U,u.finishedLanes=D,h){case 0:case 1:throw Error(r(345));case 2:Dd(u,ki,pc);break;case 3:if(Su(u,D),(D&130023424)===D&&(h=Nv+500-yt(),10<h)){if(Ke(u,0)!==0)break;if(U=u.suspendedLanes,(U&D)!==D){ci(),u.pingedLanes|=u.suspendedLanes&U;break}u.timeoutHandle=ri(Dd.bind(null,u,ki,pc),h);break}Dd(u,ki,pc);break;case 4:if(Su(u,D),(D&4194240)===D)break;for(h=u.eventTimes,U=-1;0<D;){var ue=31-or(D);J=1<<ue,ue=h[ue],ue>U&&(U=ue),D&=~J}if(D=U,D=yt()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*vP(D/1960))-D,10<D){u.timeoutHandle=ri(Dd.bind(null,u,ki,pc),D);break}Dd(u,ki,pc);break;case 5:Dd(u,ki,pc);break;default:throw Error(r(329))}}}return Ci(u,yt()),u.callbackNode===S?ok.bind(null,u):null}function Av(u,h){var S=Tg;return u.current.memoizedState.isDehydrated&&(Rd(u,h).flags|=256),u=Kx(u,h),u!==2&&(h=ki,ki=S,h!==null&&Fv(h)),u}function Fv(u){ki===null?ki=u:ki.push.apply(ki,u)}function wP(u){for(var h=u;;){if(h.flags&16384){var S=h.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var D=0;D<S.length;D++){var U=S[D],J=U.getSnapshot;U=U.value;try{if(!Ia(J(),U))return!1}catch{return!1}}}if(S=h.child,h.subtreeFlags&16384&&S!==null)S.return=h,h=S;else{if(h===u)break;for(;h.sibling===null;){if(h.return===null||h.return===u)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Su(u,h){for(h&=~Tv,h&=~$x,u.suspendedLanes|=h,u.pingedLanes&=~h,u=u.expirationTimes;0<h;){var S=31-or(h),D=1<<S;u[S]=-1,h&=~D}}function lk(u){if((rn&6)!==0)throw Error(r(327));Th();var h=Ke(u,0);if((h&1)===0)return Ci(u,yt()),null;var S=Kx(u,h);if(u.tag!==0&&S===2){var D=_r(u);D!==0&&(h=D,S=Av(u,D))}if(S===1)throw S=Cg,Rd(u,0),Su(u,h),Ci(u,yt()),S;if(S===6)throw Error(r(345));return u.finishedWork=u.current.alternate,u.finishedLanes=h,Dd(u,ki,pc),Ci(u,yt()),null}function Pv(u,h){var S=rn;rn|=1;try{return u(h)}finally{rn=S,rn===0&&(Ch=yt()+500,ru&&xl())}}function Pd(u){_u!==null&&_u.tag===0&&(rn&6)===0&&Th();var h=rn;rn|=1;var S=co.transition,D=Pt;try{if(co.transition=null,Pt=1,u)return u()}finally{Pt=D,co.transition=S,rn=h,(rn&6)===0&&xl()}}function Rv(){zi=kh.current,kn(kh)}function Rd(u,h){u.finishedWork=null,u.finishedLanes=0;var S=u.timeoutHandle;if(S!==-1&&(u.timeoutHandle=-1,cg(S)),Rs!==null)for(S=Rs.return;S!==null;){var D=S;switch(Ps(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&tu();break;case 3:Dn(),kn(Js),kn(zs),Zs();break;case 5:Oo(D);break;case 4:Dn();break;case 13:kn(Cn);break;case 19:kn(Cn);break;case 10:uh(D.type._context);break;case 22:case 23:Rv()}S=S.return}if(na=u,Rs=u=ku(u.current,null),Sa=zi=h,Gs=0,Cg=null,Tv=$x=Fd=0,ki=Tg=null,so!==null){for(h=0;h<so.length;h++)if(S=so[h],D=S.interleaved,D!==null){S.interleaved=null;var U=D.next,J=S.pending;if(J!==null){var ue=J.next;J.next=U,D.next=ue}S.pending=D}so=null}return u}function ck(u,h){do{var S=Rs;try{if(ch(),uu.current=mu,Wi){for(var D=gn.memoizedState;D!==null;){var U=D.queue;U!==null&&(U.pending=null),D=D.next}Wi=!1}if(wa=0,ss=Gn=gn=null,bl=!1,Si=0,Cv.current=null,S===null||S.return===null){Gs=1,Cg=h,Rs=null;break}e:{var J=u,ue=S.return,Te=S,Ie=h;if(h=Sa,Te.flags|=32768,Ie!==null&&typeof Ie=="object"&&typeof Ie.then=="function"){var ot=Ie,Dt=Te,Bt=Dt.tag;if((Dt.mode&1)===0&&(Bt===0||Bt===11||Bt===15)){var Ft=Dt.alternate;Ft?(Dt.updateQueue=Ft.updateQueue,Dt.memoizedState=Ft.memoizedState,Dt.lanes=Ft.lanes):(Dt.updateQueue=null,Dt.memoizedState=null)}var tr=F(ue);if(tr!==null){tr.flags&=-257,B(tr,ue,Te,J,h),tr.mode&1&&x(J,ot,h),h=tr,Ie=ot;var lr=h.updateQueue;if(lr===null){var cr=new Set;cr.add(Ie),h.updateQueue=cr}else lr.add(Ie);break e}else{if((h&1)===0){x(J,ot,h),Dv();break e}Ie=Error(r(426))}}else if(un&&Te.mode&1){var Ss=F(ue);if(Ss!==null){(Ss.flags&65536)===0&&(Ss.flags|=256),B(Ss,ue,Te,J,h),kd(mc(Ie,Te));break e}}J=Ie=mc(Ie,Te),Gs!==4&&(Gs=2),Tg===null?Tg=[J]:Tg.push(J),J=ue;do{switch(J.tag){case 3:J.flags|=65536,h&=-h,J.lanes|=h;var qe=Ox(J,Ie,h);Ed(J,qe);break e;case 1:Te=Ie;var Ue=J.type,nt=J.stateNode;if((J.flags&128)===0&&(typeof Ue.getDerivedStateFromError=="function"||nt!==null&&typeof nt.componentDidCatch=="function"&&(wu===null||!wu.has(nt)))){J.flags|=65536,h&=-h,J.lanes|=h;var Wt=m(J,Te,h);Ed(J,Wt);break e}}J=J.return}while(J!==null)}fk(S)}catch(dr){h=dr,Rs===S&&S!==null&&(Rs=S=S.return);continue}break}while(!0)}function uk(){var u=Ux.current;return Ux.current=mu,u===null?mu:u}function Dv(){(Gs===0||Gs===3||Gs===2)&&(Gs=4),na===null||(Fd&268435455)===0&&($x&268435455)===0||Su(na,Sa)}function Kx(u,h){var S=rn;rn|=2;var D=uk();(na!==u||Sa!==h)&&(pc=null,Rd(u,h));do try{_P();break}catch(U){ck(u,U)}while(!0);if(ch(),rn=S,Ux.current=D,Rs!==null)throw Error(r(261));return na=null,Sa=0,Gs}function _P(){for(;Rs!==null;)dk(Rs)}function bP(){for(;Rs!==null&&!Ge();)dk(Rs)}function dk(u){var h=mk(u.alternate,u,zi);u.memoizedProps=u.pendingProps,h===null?fk(u):Rs=h,Cv.current=null}function fk(u){var h=u;do{var S=h.alternate;if(u=h.return,(h.flags&32768)===0){if(S=gP(S,h,zi),S!==null){Rs=S;return}}else{if(S=mP(S,h),S!==null){S.flags&=32767,Rs=S;return}if(u!==null)u.flags|=32768,u.subtreeFlags=0,u.deletions=null;else{Gs=6,Rs=null;return}}if(h=h.sibling,h!==null){Rs=h;return}Rs=h=u}while(h!==null);Gs===0&&(Gs=5)}function Dd(u,h,S){var D=Pt,U=co.transition;try{co.transition=null,Pt=1,SP(u,h,S,D)}finally{co.transition=U,Pt=D}return null}function SP(u,h,S,D){do Th();while(_u!==null);if((rn&6)!==0)throw Error(r(327));S=u.finishedWork;var U=u.finishedLanes;if(S===null)return null;if(u.finishedWork=null,u.finishedLanes=0,S===u.current)throw Error(r(177));u.callbackNode=null,u.callbackPriority=0;var J=S.lanes|S.childLanes;if(lt(u,J),u===na&&(Rs=na=null,Sa=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||zx||(zx=!0,pk(vr,function(){return Th(),null})),J=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||J){J=co.transition,co.transition=null;var ue=Pt;Pt=1;var Te=rn;rn|=4,Cv.current=null,xP(u,S),rk(S,u),gd(og),Mf=!!ig,og=ig=null,u.current=S,yP(S),Je(),rn=Te,Pt=ue,co.transition=J}else u.current=S;if(zx&&(zx=!1,_u=u,Hx=U),J=u.pendingLanes,J===0&&(wu=null),$r(S.stateNode),Ci(u,yt()),h!==null)for(D=u.onRecoverableError,S=0;S<h.length;S++)U=h[S],D(U.value,{componentStack:U.stack,digest:U.digest});if(Wx)throw Wx=!1,u=Ev,Ev=null,u;return(Hx&1)!==0&&u.tag!==0&&Th(),J=u.pendingLanes,(J&1)!==0?u===jv?Ng++:(Ng=0,jv=u):Ng=0,xl(),null}function Th(){if(_u!==null){var u=zn(Hx),h=co.transition,S=Pt;try{if(co.transition=null,Pt=16>u?16:u,_u===null)var D=!1;else{if(u=_u,_u=null,Hx=0,(rn&6)!==0)throw Error(r(331));var U=rn;for(rn|=4,ir=u.current;ir!==null;){var J=ir,ue=J.child;if((ir.flags&16)!==0){var Te=J.deletions;if(Te!==null){for(var Ie=0;Ie<Te.length;Ie++){var ot=Te[Ie];for(ir=ot;ir!==null;){var Dt=ir;switch(Dt.tag){case 0:case 11:case 15:kg(8,Dt,J)}var Bt=Dt.child;if(Bt!==null)Bt.return=Dt,ir=Bt;else for(;ir!==null;){Dt=ir;var Ft=Dt.sibling,tr=Dt.return;if(JS(Dt),Dt===ot){ir=null;break}if(Ft!==null){Ft.return=tr,ir=Ft;break}ir=tr}}}var lr=J.alternate;if(lr!==null){var cr=lr.child;if(cr!==null){lr.child=null;do{var Ss=cr.sibling;cr.sibling=null,cr=Ss}while(cr!==null)}}ir=J}}if((J.subtreeFlags&2064)!==0&&ue!==null)ue.return=J,ir=ue;else e:for(;ir!==null;){if(J=ir,(J.flags&2048)!==0)switch(J.tag){case 0:case 11:case 15:kg(9,J,J.return)}var qe=J.sibling;if(qe!==null){qe.return=J.return,ir=qe;break e}ir=J.return}}var Ue=u.current;for(ir=Ue;ir!==null;){ue=ir;var nt=ue.child;if((ue.subtreeFlags&2064)!==0&&nt!==null)nt.return=ue,ir=nt;else e:for(ue=Ue;ir!==null;){if(Te=ir,(Te.flags&2048)!==0)try{switch(Te.tag){case 0:case 11:case 15:Bx(9,Te)}}catch(dr){is(Te,Te.return,dr)}if(Te===ue){ir=null;break e}var Wt=Te.sibling;if(Wt!==null){Wt.return=Te.return,ir=Wt;break e}ir=Te.return}}if(rn=U,xl(),Kr&&typeof Kr.onPostCommitFiberRoot=="function")try{Kr.onPostCommitFiberRoot(hn,u)}catch{}D=!0}return D}finally{Pt=S,co.transition=h}}return!1}function hk(u,h,S){h=mc(S,h),h=Ox(u,h,1),u=oo(u,h,1),h=ci(),u!==null&&(Mr(u,1,h),Ci(u,h))}function is(u,h,S){if(u.tag===3)hk(u,u,S);else for(;h!==null;){if(h.tag===3){hk(h,u,S);break}else if(h.tag===1){var D=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(wu===null||!wu.has(D))){u=mc(S,u),u=m(h,u,1),h=oo(h,u,1),u=ci(),h!==null&&(Mr(h,1,u),Ci(h,u));break}}h=h.return}}function kP(u,h,S){var D=u.pingCache;D!==null&&D.delete(h),h=ci(),u.pingedLanes|=u.suspendedLanes&S,na===u&&(Sa&S)===S&&(Gs===4||Gs===3&&(Sa&130023424)===Sa&&500>yt()-Nv?Rd(u,0):Tv|=S),Ci(u,h)}function gk(u,h){h===0&&((u.mode&1)===0?h=1:(h=St,St<<=1,(St&130023424)===0&&(St=4194304)));var S=ci();u=oi(u,h),u!==null&&(Mr(u,h,S),Ci(u,S))}function CP(u){var h=u.memoizedState,S=0;h!==null&&(S=h.retryLane),gk(u,S)}function TP(u,h){var S=0;switch(u.tag){case 13:var D=u.stateNode,U=u.memoizedState;U!==null&&(S=U.retryLane);break;case 19:D=u.stateNode;break;default:throw Error(r(314))}D!==null&&D.delete(h),gk(u,S)}var mk;mk=function(u,h,S){if(u!==null)if(u.memoizedProps!==h.pendingProps||Js.current)re=!0;else{if((u.lanes&S)===0&&(h.flags&128)===0)return re=!1,vv(u,h,S);re=(u.flags&131072)!==0}else re=!1,un&&(h.flags&1048576)!==0&&Tx(h,vl,h.index);switch(h.lanes=0,h.tag){case 2:var D=h.type;Jr(u,h),u=h.pendingProps;var U=ic(h,zs.current);Mo(h,S),U=du(null,h,D,u,U,S);var J=fu();return h.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,Qs(D)?(J=!0,oc(h)):J=!1,h.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,Nd(h),U.updater=xu,h.stateNode=U,U._reactInternals=h,_h(h,D,u,S),h=dn(null,h,D,!0,J,S)):(h.tag=0,un&&J&&nu(h),ve(null,h,U,S),h=h.child),h;case 16:D=h.elementType;e:{switch(Jr(u,h),u=h.pendingProps,U=D._init,D=U(D._payload),h.type=D,U=h.tag=EP(D),u=Hs(D,u),U){case 0:h=Zt(null,h,D,u,S);break e;case 1:h=Tn(null,h,D,u,S);break e;case 11:h=$e(null,h,D,u,S);break e;case 14:h=ct(null,h,D,Hs(D.type,u),S);break e}throw Error(r(306,D,""))}return h;case 0:return D=h.type,U=h.pendingProps,U=h.elementType===D?U:Hs(D,U),Zt(u,h,D,U,S);case 1:return D=h.type,U=h.pendingProps,U=h.elementType===D?U:Hs(D,U),Tn(u,h,D,U,S);case 3:e:{if(_a(h),u===null)throw Error(r(387));D=h.pendingProps,J=h.memoizedState,U=J.element,fh(u,h),ou(h,D,null,S);var ue=h.memoizedState;if(D=ue.element,J.isDehydrated)if(J={element:D,isDehydrated:!1,cache:ue.cache,pendingSuspenseBoundaries:ue.pendingSuspenseBoundaries,transitions:ue.transitions},h.updateQueue.baseState=J,h.memoizedState=J,h.flags&256){U=mc(Error(r(423)),h),h=lo(u,h,D,S,U);break e}else if(D!==U){U=mc(Error(r(424)),h),h=lo(u,h,D,S,U);break e}else for(Jt=eo(h.stateNode.containerInfo.firstChild),si=h,un=!0,ai=null,S=bi(h,null,D,S),h.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(dc(),D===U){h=ra(u,h,S);break e}ve(u,h,D,S)}h=h.child}return h;case 5:return lu(h),u===null&&su(h),D=h.type,U=h.pendingProps,J=u!==null?u.memoizedProps:null,ue=U.children,lg(D,U)?ue=null:J!==null&&lg(D,J)&&(h.flags|=32),Dr(u,h),ve(u,h,ue,S),h.child;case 6:return u===null&&su(h),null;case 13:return xt(u,h,S);case 4:return _l(h,h.stateNode.containerInfo),D=h.pendingProps,u===null?h.child=fc(h,null,D,S):ve(u,h,D,S),h.child;case 11:return D=h.type,U=h.pendingProps,U=h.elementType===D?U:Hs(D,U),$e(u,h,D,U,S);case 7:return ve(u,h,h.pendingProps,S),h.child;case 8:return ve(u,h,h.pendingProps.children,S),h.child;case 12:return ve(u,h,h.pendingProps.children,S),h.child;case 10:e:{if(D=h.type._context,U=h.pendingProps,J=h.memoizedProps,ue=U.value,pn(Cd,D._currentValue),D._currentValue=ue,J!==null)if(Ia(J.value,ue)){if(J.children===U.children&&!Js.current){h=ra(u,h,S);break e}}else for(J=h.child,J!==null&&(J.return=h);J!==null;){var Te=J.dependencies;if(Te!==null){ue=J.child;for(var Ie=Te.firstContext;Ie!==null;){if(Ie.context===D){if(J.tag===1){Ie=io(-1,S&-S),Ie.tag=2;var ot=J.updateQueue;if(ot!==null){ot=ot.shared;var Dt=ot.pending;Dt===null?Ie.next=Ie:(Ie.next=Dt.next,Dt.next=Ie),ot.pending=Ie}}J.lanes|=S,Ie=J.alternate,Ie!==null&&(Ie.lanes|=S),dh(J.return,S,h),Te.lanes|=S;break}Ie=Ie.next}}else if(J.tag===10)ue=J.type===h.type?null:J.child;else if(J.tag===18){if(ue=J.return,ue===null)throw Error(r(341));ue.lanes|=S,Te=ue.alternate,Te!==null&&(Te.lanes|=S),dh(ue,S,h),ue=J.sibling}else ue=J.child;if(ue!==null)ue.return=J;else for(ue=J;ue!==null;){if(ue===h){ue=null;break}if(J=ue.sibling,J!==null){J.return=ue.return,ue=J;break}ue=ue.return}J=ue}ve(u,h,U.children,S),h=h.child}return h;case 9:return U=h.type,D=h.pendingProps.children,Mo(h,S),U=va(U),D=D(U),h.flags|=1,ve(u,h,D,S),h.child;case 14:return D=h.type,U=Hs(D,h.pendingProps),U=Hs(D.type,U),ct(u,h,D,U,S);case 15:return $t(u,h,h.type,h.pendingProps,S);case 17:return D=h.type,U=h.pendingProps,U=h.elementType===D?U:Hs(D,U),Jr(u,h),h.tag=1,Qs(D)?(u=!0,oc(h)):u=!1,Mo(h,S),Mx(h,D,U),_h(h,D,U,S),dn(null,h,D,!0,u,S);case 19:return bs(u,h,S);case 22:return ar(u,h,S)}throw Error(r(156,h.tag))};function pk(u,h){return Ce(u,h)}function NP(u,h,S,D){this.tag=u,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function uo(u,h,S,D){return new NP(u,h,S,D)}function Iv(u){return u=u.prototype,!(!u||!u.isReactComponent)}function EP(u){if(typeof u=="function")return Iv(u)?1:0;if(u!=null){if(u=u.$$typeof,u===Q)return 11;if(u===te)return 14}return 2}function ku(u,h){var S=u.alternate;return S===null?(S=uo(u.tag,h,u.key,u.mode),S.elementType=u.elementType,S.type=u.type,S.stateNode=u.stateNode,S.alternate=u,u.alternate=S):(S.pendingProps=h,S.type=u.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=u.flags&14680064,S.childLanes=u.childLanes,S.lanes=u.lanes,S.child=u.child,S.memoizedProps=u.memoizedProps,S.memoizedState=u.memoizedState,S.updateQueue=u.updateQueue,h=u.dependencies,S.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},S.sibling=u.sibling,S.index=u.index,S.ref=u.ref,S}function qx(u,h,S,D,U,J){var ue=2;if(D=u,typeof u=="function")Iv(u)&&(ue=1);else if(typeof u=="string")ue=5;else e:switch(u){case R:return Id(S.children,U,J,h);case N:ue=8,U|=8;break;case A:return u=uo(12,S,h,U|2),u.elementType=A,u.lanes=J,u;case Z:return u=uo(13,S,h,U),u.elementType=Z,u.lanes=J,u;case ae:return u=uo(19,S,h,U),u.elementType=ae,u.lanes=J,u;case L:return Xx(S,U,J,h);default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case M:ue=10;break e;case H:ue=9;break e;case Q:ue=11;break e;case te:ue=14;break e;case se:ue=16,D=null;break e}throw Error(r(130,u==null?u:typeof u,""))}return h=uo(ue,S,h,U),h.elementType=u,h.type=D,h.lanes=J,h}function Id(u,h,S,D){return u=uo(7,u,D,h),u.lanes=S,u}function Xx(u,h,S,D){return u=uo(22,u,D,h),u.elementType=L,u.lanes=S,u.stateNode={isHidden:!1},u}function Mv(u,h,S){return u=uo(6,u,null,h),u.lanes=S,u}function Ov(u,h,S){return h=uo(4,u.children!==null?u.children:[],u.key,h),h.lanes=S,h.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},h}function jP(u,h,S,D,U){this.tag=h,this.containerInfo=u,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mr(0),this.expirationTimes=mr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mr(0),this.identifierPrefix=D,this.onRecoverableError=U,this.mutableSourceEagerHydrationData=null}function Lv(u,h,S,D,U,J,ue,Te,Ie){return u=new jP(u,h,S,Te,Ie),h===1?(h=1,J===!0&&(h|=8)):h=0,J=uo(3,null,null,h),u.current=J,J.stateNode=u,J.memoizedState={element:D,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},Nd(J),u}function AP(u,h,S){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:D==null?null:""+D,children:u,containerInfo:h,implementation:S}}function xk(u){if(!u)return ro;u=u._reactInternals;e:{if(ke(u)!==u||u.tag!==1)throw Error(r(170));var h=u;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(Qs(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(r(171))}if(u.tag===1){var S=u.type;if(Qs(S))return sh(u,S,h)}return h}function yk(u,h,S,D,U,J,ue,Te,Ie){return u=Lv(S,D,!0,u,U,J,ue,Te,Ie),u.context=xk(null),S=u.current,D=ci(),U=bu(S),J=io(D,U),J.callback=h??null,oo(S,J,U),u.current.lanes=U,Mr(u,U,D),Ci(u,D),u}function Yx(u,h,S,D){var U=h.current,J=ci(),ue=bu(U);return S=xk(S),h.context===null?h.context=S:h.pendingContext=S,h=io(J,ue),h.payload={element:u},D=D===void 0?null:D,D!==null&&(h.callback=D),u=oo(U,h,ue),u!==null&&(Wo(u,U,ue,J),hh(u,U,ue)),ue}function Jx(u){if(u=u.current,!u.child)return null;switch(u.child.tag){case 5:return u.child.stateNode;default:return u.child.stateNode}}function vk(u,h){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var S=u.retryLane;u.retryLane=S!==0&&S<h?S:h}}function Bv(u,h){vk(u,h),(u=u.alternate)&&vk(u,h)}function FP(){return null}var wk=typeof reportError=="function"?reportError:function(u){console.error(u)};function Uv(u){this._internalRoot=u}Qx.prototype.render=Uv.prototype.render=function(u){var h=this._internalRoot;if(h===null)throw Error(r(409));Yx(u,h,null,null)},Qx.prototype.unmount=Uv.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var h=u.containerInfo;Pd(function(){Yx(null,u,null,null)}),h[to]=null}};function Qx(u){this._internalRoot=u}Qx.prototype.unstable_scheduleHydration=function(u){if(u){var h=ha();u={blockedOn:null,target:u,priority:h};for(var S=0;S<Zi.length&&h!==0&&h<Zi[S].priority;S++);Zi.splice(S,0,u),S===0&&Rf(u)}};function $v(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function Zx(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11&&(u.nodeType!==8||u.nodeValue!==" react-mount-point-unstable "))}function _k(){}function PP(u,h,S,D,U){if(U){if(typeof D=="function"){var J=D;D=function(){var ot=Jx(ue);J.call(ot)}}var ue=yk(h,D,u,0,null,!1,!1,"",_k);return u._reactRootContainer=ue,u[to]=ue.current,tc(u.nodeType===8?u.parentNode:u),Pd(),ue}for(;U=u.lastChild;)u.removeChild(U);if(typeof D=="function"){var Te=D;D=function(){var ot=Jx(Ie);Te.call(ot)}}var Ie=Lv(u,0,!1,null,null,!1,!1,"",_k);return u._reactRootContainer=Ie,u[to]=Ie.current,tc(u.nodeType===8?u.parentNode:u),Pd(function(){Yx(h,Ie,S,D)}),Ie}function ey(u,h,S,D,U){var J=S._reactRootContainer;if(J){var ue=J;if(typeof U=="function"){var Te=U;U=function(){var Ie=Jx(ue);Te.call(Ie)}}Yx(h,ue,u,U)}else ue=PP(S,h,u,U,D);return Jx(ue)}pr=function(u){switch(u.tag){case 3:var h=u.stateNode;if(h.current.memoizedState.isDehydrated){var S=je(h.pendingLanes);S!==0&&(Tt(h,S|1),Ci(h,yt()),(rn&6)===0&&(Ch=yt()+500,xl()))}break;case 13:Pd(function(){var D=oi(u,1);if(D!==null){var U=ci();Wo(D,u,1,U)}}),Bv(u,1)}},mn=function(u){if(u.tag===13){var h=oi(u,134217728);if(h!==null){var S=ci();Wo(h,u,134217728,S)}Bv(u,134217728)}},In=function(u){if(u.tag===13){var h=bu(u),S=oi(u,h);if(S!==null){var D=ci();Wo(S,u,h,D)}Bv(u,h)}},ha=function(){return Pt},nl=function(u,h){var S=Pt;try{return Pt=u,h()}finally{Pt=S}},he=function(u,h,S){switch(h){case"input":if(He(u,S),h=S.name,S.type==="radio"&&h!=null){for(S=u;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<S.length;h++){var D=S[h];if(D!==u&&D.form===u.form){var U=Fs(D);if(!U)throw Error(r(90));ce(D),He(D,U)}}}break;case"textarea":ut(u,S);break;case"select":h=S.value,h!=null&&De(u,!!S.multiple,h,!1)}},Et=Pv,Be=Pd;var RP={usingClientEntryPoint:!1,Events:[_d,vs,Fs,Ve,Ct,Pv]},Eg={findFiberByHostInstance:ml,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},DP={bundleType:Eg.bundleType,version:Eg.version,rendererPackageName:Eg.rendererPackageName,rendererConfig:Eg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T.ReactCurrentDispatcher,findHostInstanceByFiber:function(u){return u=ie(u),u===null?null:u.stateNode},findFiberByHostInstance:Eg.findFiberByHostInstance||FP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ty=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ty.isDisabled&&ty.supportsFiber)try{hn=ty.inject(DP),Kr=ty}catch{}}return Ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RP,Ti.createPortal=function(u,h){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$v(h))throw Error(r(200));return AP(u,h,null,S)},Ti.createRoot=function(u,h){if(!$v(u))throw Error(r(299));var S=!1,D="",U=wk;return h!=null&&(h.unstable_strictMode===!0&&(S=!0),h.identifierPrefix!==void 0&&(D=h.identifierPrefix),h.onRecoverableError!==void 0&&(U=h.onRecoverableError)),h=Lv(u,1,!1,null,null,S,!1,D,U),u[to]=h.current,tc(u.nodeType===8?u.parentNode:u),new Uv(h)},Ti.findDOMNode=function(u){if(u==null)return null;if(u.nodeType===1)return u;var h=u._reactInternals;if(h===void 0)throw typeof u.render=="function"?Error(r(188)):(u=Object.keys(u).join(","),Error(r(268,u)));return u=ie(h),u=u===null?null:u.stateNode,u},Ti.flushSync=function(u){return Pd(u)},Ti.hydrate=function(u,h,S){if(!Zx(h))throw Error(r(200));return ey(null,u,h,!0,S)},Ti.hydrateRoot=function(u,h,S){if(!$v(u))throw Error(r(405));var D=S!=null&&S.hydratedSources||null,U=!1,J="",ue=wk;if(S!=null&&(S.unstable_strictMode===!0&&(U=!0),S.identifierPrefix!==void 0&&(J=S.identifierPrefix),S.onRecoverableError!==void 0&&(ue=S.onRecoverableError)),h=yk(h,null,u,1,S??null,U,!1,J,ue),u[to]=h.current,tc(u),D)for(u=0;u<D.length;u++)S=D[u],U=S._getVersion,U=U(S._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[S,U]:h.mutableSourceEagerHydrationData.push(S,U);return new Qx(h)},Ti.render=function(u,h,S){if(!Zx(h))throw Error(r(200));return ey(null,u,h,!1,S)},Ti.unmountComponentAtNode=function(u){if(!Zx(u))throw Error(r(40));return u._reactRootContainer?(Pd(function(){ey(null,null,u,!1,function(){u._reactRootContainer=null,u[to]=null})}),!0):!1},Ti.unstable_batchedUpdates=Pv,Ti.unstable_renderSubtreeIntoContainer=function(u,h,S,D){if(!Zx(S))throw Error(r(200));if(u==null||u._reactInternals===void 0)throw Error(r(38));return ey(u,h,S,!1,D)},Ti.version="18.3.1-next-f1338f8080-20240426",Ti}var jk;function j3(){if(jk)return Hv.exports;jk=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Hv.exports=WP(),Hv.exports}var Ak;function zP(){if(Ak)return ry;Ak=1;var e=j3();return ry.createRoot=e.createRoot,ry.hydrateRoot=e.hydrateRoot,ry}var HP=zP();const GP=Ep(HP);var Fk=j3();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ym(){return Ym=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ym.apply(this,arguments)}var Fu;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Fu||(Fu={}));const Pk="popstate";function VP(e){e===void 0&&(e={});function t(n,s){let{pathname:a,search:i,hash:l}=n.location;return n_("",{pathname:a,search:i,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:F3(s)}return qP(t,r,null,e)}function Bs(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function A3(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function KP(){return Math.random().toString(36).substr(2,8)}function Rk(e,t){return{usr:e.state,key:e.key,idx:t}}function n_(e,t,r,n){return r===void 0&&(r=null),Ym({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?v0(t):t,{state:r,key:t&&t.key||n||KP()})}function F3(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function v0(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function qP(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:a=!1}=n,i=s.history,l=Fu.Pop,c=null,d=f();d==null&&(d=0,i.replaceState(Ym({},i.state,{idx:d}),""));function f(){return(i.state||{idx:null}).idx}function p(){l=Fu.Pop;let b=f(),E=b==null?null:b-d;d=b,c&&c({action:l,location:w.location,delta:E})}function g(b,E){l=Fu.Push;let k=n_(w.location,b,E);d=f()+1;let _=Rk(k,d),T=w.createHref(k);try{i.pushState(_,"",T)}catch(j){if(j instanceof DOMException&&j.name==="DataCloneError")throw j;s.location.assign(T)}a&&c&&c({action:l,location:w.location,delta:1})}function y(b,E){l=Fu.Replace;let k=n_(w.location,b,E);d=f();let _=Rk(k,d),T=w.createHref(k);i.replaceState(_,"",T),a&&c&&c({action:l,location:w.location,delta:0})}function v(b){let E=s.location.origin!=="null"?s.location.origin:s.location.href,k=typeof b=="string"?b:F3(b);return k=k.replace(/ $/,"%20"),Bs(E,"No window.location.(origin|href) available to create URL for href: "+k),new URL(k,E)}let w={get action(){return l},get location(){return e(s,i)},listen(b){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Pk,p),c=b,()=>{s.removeEventListener(Pk,p),c=null}},createHref(b){return t(s,b)},createURL:v,encodeLocation(b){let E=v(b);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:g,replace:y,go(b){return i.go(b)}};return w}var Dk;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Dk||(Dk={}));function XP(e,t,r){return r===void 0&&(r="/"),YP(e,t,r)}function YP(e,t,r,n){let s=typeof t=="string"?v0(t):t,a=D3(s.pathname||"/",r);if(a==null)return null;let i=P3(e);JP(i);let l=null;for(let c=0;l==null&&c<i.length;++c){let d=cR(a);l=iR(i[c],d)}return l}function P3(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(a,i,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:i,route:a};c.relativePath.startsWith("/")&&(Bs(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let d=Kd([n,c.relativePath]),f=r.concat(c);a.children&&a.children.length>0&&(Bs(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),P3(a.children,t,f,d)),!(a.path==null&&!a.index)&&t.push({path:d,score:sR(d,a.index),routesMeta:f})};return e.forEach((a,i)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))s(a,i);else for(let c of R3(a.path))s(a,i,c)}),t}function R3(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return s?[a,""]:[a];let i=R3(n.join("/")),l=[];return l.push(...i.map(c=>c===""?a:[a,c].join("/"))),s&&l.push(...i),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function JP(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:aR(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const QP=/^:[\w-]+$/,ZP=3,eR=2,tR=1,rR=10,nR=-2,Ik=e=>e==="*";function sR(e,t){let r=e.split("/"),n=r.length;return r.some(Ik)&&(n+=nR),t&&(n+=eR),r.filter(s=>!Ik(s)).reduce((s,a)=>s+(QP.test(a)?ZP:a===""?tR:rR),n)}function aR(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function iR(e,t,r){let{routesMeta:n}=e,s={},a="/",i=[];for(let l=0;l<n.length;++l){let c=n[l],d=l===n.length-1,f=a==="/"?t:t.slice(a.length)||"/",p=oR({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},f),g=c.route;if(!p)return null;Object.assign(s,p.params),i.push({params:s,pathname:Kd([a,p.pathname]),pathnameBase:hR(Kd([a,p.pathnameBase])),route:g}),p.pathnameBase!=="/"&&(a=Kd([a,p.pathnameBase]))}return i}function oR(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=lR(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let a=s[0],i=a.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:n.reduce((d,f,p)=>{let{paramName:g,isOptional:y}=f;if(g==="*"){let w=l[p]||"";i=a.slice(0,a.length-w.length).replace(/(.)\/+$/,"$1")}const v=l[p];return y&&!v?d[g]=void 0:d[g]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:i,pattern:e}}function lR(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),A3(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function cR(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return A3(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function D3(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function uR(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:s=""}=typeof e=="string"?v0(e):e;return{pathname:r?r.startsWith("/")?r:dR(r,t):t,search:gR(n),hash:mR(s)}}function dR(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function Kv(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function fR(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function I3(e,t){let r=fR(e);return t?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function M3(e,t,r,n){n===void 0&&(n=!1);let s;typeof e=="string"?s=v0(e):(s=Ym({},e),Bs(!s.pathname||!s.pathname.includes("?"),Kv("?","pathname","search",s)),Bs(!s.pathname||!s.pathname.includes("#"),Kv("#","pathname","hash",s)),Bs(!s.search||!s.search.includes("#"),Kv("#","search","hash",s)));let a=e===""||s.pathname==="",i=a?"/":s.pathname,l;if(i==null)l=r;else{let p=t.length-1;if(!n&&i.startsWith("..")){let g=i.split("/");for(;g[0]==="..";)g.shift(),p-=1;s.pathname=g.join("/")}l=p>=0?t[p]:"/"}let c=uR(s,l),d=i&&i!=="/"&&i.endsWith("/"),f=(a||i===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||f)&&(c.pathname+="/"),c}const Kd=e=>e.join("/").replace(/\/\/+/g,"/"),hR=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),gR=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,mR=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function pR(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const O3=["post","put","patch","delete"];new Set(O3);const xR=["get",...O3];new Set(xR);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Jm(){return Jm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Jm.apply(this,arguments)}const S2=C.createContext(null),yR=C.createContext(null),jp=C.createContext(null),j1=C.createContext(null),Ju=C.createContext({outlet:null,matches:[],isDataRoute:!1}),L3=C.createContext(null);function Ap(){return C.useContext(j1)!=null}function A1(){return Ap()||Bs(!1),C.useContext(j1).location}function B3(e){C.useContext(jp).static||C.useLayoutEffect(e)}function Ii(){let{isDataRoute:e}=C.useContext(Ju);return e?FR():vR()}function vR(){Ap()||Bs(!1);let e=C.useContext(S2),{basename:t,future:r,navigator:n}=C.useContext(jp),{matches:s}=C.useContext(Ju),{pathname:a}=A1(),i=JSON.stringify(I3(s,r.v7_relativeSplatPath)),l=C.useRef(!1);return B3(()=>{l.current=!0}),C.useCallback(function(d,f){if(f===void 0&&(f={}),!l.current)return;if(typeof d=="number"){n.go(d);return}let p=M3(d,JSON.parse(i),a,f.relative==="path");e==null&&t!=="/"&&(p.pathname=p.pathname==="/"?t:Kd([t,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[t,n,i,a,e])}function F1(){let{matches:e}=C.useContext(Ju),t=e[e.length-1];return t?t.params:{}}function wR(e,t){return _R(e,t)}function _R(e,t,r,n){Ap()||Bs(!1);let{navigator:s}=C.useContext(jp),{matches:a}=C.useContext(Ju),i=a[a.length-1],l=i?i.params:{};i&&i.pathname;let c=i?i.pathnameBase:"/";i&&i.route;let d=A1(),f;if(t){var p;let b=typeof t=="string"?v0(t):t;c==="/"||(p=b.pathname)!=null&&p.startsWith(c)||Bs(!1),f=b}else f=d;let g=f.pathname||"/",y=g;if(c!=="/"){let b=c.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(b.length).join("/")}let v=XP(e,{pathname:y}),w=TR(v&&v.map(b=>Object.assign({},b,{params:Object.assign({},l,b.params),pathname:Kd([c,s.encodeLocation?s.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?c:Kd([c,s.encodeLocation?s.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),a,r,n);return t&&w?C.createElement(j1.Provider,{value:{location:Jm({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:Fu.Pop}},w):w}function bR(){let e=AR(),t=pR(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},t),r?C.createElement("pre",{style:s},r):null,null)}const SR=C.createElement(bR,null);class kR extends C.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?C.createElement(Ju.Provider,{value:this.props.routeContext},C.createElement(L3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function CR(e){let{routeContext:t,match:r,children:n}=e,s=C.useContext(S2);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),C.createElement(Ju.Provider,{value:t},n)}function TR(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var a;if(!r)return null;if(r.errors)e=r.matches;else if((a=n)!=null&&a.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let i=e,l=(s=r)==null?void 0:s.errors;if(l!=null){let f=i.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);f>=0||Bs(!1),i=i.slice(0,Math.min(i.length,f+1))}let c=!1,d=-1;if(r&&n&&n.v7_partialHydration)for(let f=0;f<i.length;f++){let p=i[f];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(d=f),p.route.id){let{loaderData:g,errors:y}=r,v=p.route.loader&&g[p.route.id]===void 0&&(!y||y[p.route.id]===void 0);if(p.route.lazy||v){c=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}return i.reduceRight((f,p,g)=>{let y,v=!1,w=null,b=null;r&&(y=l&&p.route.id?l[p.route.id]:void 0,w=p.route.errorElement||SR,c&&(d<0&&g===0?(PR("route-fallback"),v=!0,b=null):d===g&&(v=!0,b=p.route.hydrateFallbackElement||null)));let E=t.concat(i.slice(0,g+1)),k=()=>{let _;return y?_=w:v?_=b:p.route.Component?_=C.createElement(p.route.Component,null):p.route.element?_=p.route.element:_=f,C.createElement(CR,{match:p,routeContext:{outlet:f,matches:E,isDataRoute:r!=null},children:_})};return r&&(p.route.ErrorBoundary||p.route.errorElement||g===0)?C.createElement(kR,{location:r.location,revalidation:r.revalidation,component:w,error:y,children:k(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):k()},null)}var U3=(function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e})(U3||{}),$3=(function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e})($3||{});function NR(e){let t=C.useContext(S2);return t||Bs(!1),t}function ER(e){let t=C.useContext(yR);return t||Bs(!1),t}function jR(e){let t=C.useContext(Ju);return t||Bs(!1),t}function W3(e){let t=jR(),r=t.matches[t.matches.length-1];return r.route.id||Bs(!1),r.route.id}function AR(){var e;let t=C.useContext(L3),r=ER(),n=W3();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function FR(){let{router:e}=NR(U3.UseNavigateStable),t=W3($3.UseNavigateStable),r=C.useRef(!1);return B3(()=>{r.current=!0}),C.useCallback(function(s,a){a===void 0&&(a={}),r.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,Jm({fromRouteId:t},a)))},[e,t])}const Mk={};function PR(e,t,r){Mk[e]||(Mk[e]=!0)}function RR(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function o0(e){let{to:t,replace:r,state:n,relative:s}=e;Ap()||Bs(!1);let{future:a,static:i}=C.useContext(jp),{matches:l}=C.useContext(Ju),{pathname:c}=A1(),d=Ii(),f=M3(t,I3(l,a.v7_relativeSplatPath),c,s==="path"),p=JSON.stringify(f);return C.useEffect(()=>d(JSON.parse(p),{replace:r,state:n,relative:s}),[d,p,s,r,n]),null}function ds(e){Bs(!1)}function DR(e){let{basename:t="/",children:r=null,location:n,navigationType:s=Fu.Pop,navigator:a,static:i=!1,future:l}=e;Ap()&&Bs(!1);let c=t.replace(/^\/*/,"/"),d=C.useMemo(()=>({basename:c,navigator:a,static:i,future:Jm({v7_relativeSplatPath:!1},l)}),[c,l,a,i]);typeof n=="string"&&(n=v0(n));let{pathname:f="/",search:p="",hash:g="",state:y=null,key:v="default"}=n,w=C.useMemo(()=>{let b=D3(f,c);return b==null?null:{location:{pathname:b,search:p,hash:g,state:y,key:v},navigationType:s}},[c,f,p,g,y,v,s]);return w==null?null:C.createElement(jp.Provider,{value:d},C.createElement(j1.Provider,{children:r,value:w}))}function k2(e){let{children:t,location:r}=e;return wR(s_(t),r)}new Promise(()=>{});function s_(e,t){t===void 0&&(t=[]);let r=[];return C.Children.forEach(e,(n,s)=>{if(!C.isValidElement(n))return;let a=[...t,s];if(n.type===C.Fragment){r.push.apply(r,s_(n.props.children,a));return}n.type!==ds&&Bs(!1),!n.props.index||!n.props.children||Bs(!1);let i={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=s_(n.props.children,a)),r.push(i)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const IR="6";try{window.__reactRouterVersion=IR}catch{}const MR="startTransition",Ok=UP[MR];function OR(e){let{basename:t,children:r,future:n,window:s}=e,a=C.useRef();a.current==null&&(a.current=VP({window:s,v5Compat:!0}));let i=a.current,[l,c]=C.useState({action:i.action,location:i.location}),{v7_startTransition:d}=n||{},f=C.useCallback(p=>{d&&Ok?Ok(()=>c(p)):c(p)},[c,d]);return C.useLayoutEffect(()=>i.listen(f),[i,f]),C.useEffect(()=>RR(n),[n]),C.createElement(DR,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:i,future:n})}var Lk;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Lk||(Lk={}));var Bk;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Bk||(Bk={}));const hs={student_subjects:1800*1e3,student_active_tests:600*1e3,student_results_table:600*1e3,teacher_subjects:900*1e3,teacher_classes:900*1e3,teacher_tests:600*1e3,teacher_results_table:600*1e3,admin_users:1200*1e3,admin_teachers:1200*1e3,admin_subjects:1800*1e3,admin_academic_years:3600*1e3,admin_tests:900*1e3,admin_results_table:null,admin_teacher_id:3600*1e3,all_tests:1200*1e3,subjects_dropdown:1800*1e3,grades_classes:3600*1e3,test_progress:120*1e3,anti_cheating:120*1e3,word_matching_test:600*1e3,speaking_test_data:3600*1e3},Jn=e=>{try{const t=localStorage.getItem(e);if(!t)return console.log("💾 Cache: No data found for key:",e),null;const{data:r,timestamp:n,ttl:s}=JSON.parse(t),a=Date.now()-n;return a>s?(console.log("💾 Cache: Data expired for key:",e,"age:",a,"ttl:",s),localStorage.removeItem(e),null):(console.log("💾 Cache: Data found for key:",e,"age:",a,"ttl:",s),r)}catch(t){return console.log("💾 Cache: Corrupted data for key:",e,t),localStorage.removeItem(e),null}},Qn=(e,t,r)=>{try{console.log("💾 Cache: Setting data for key:",e,"ttl:",r),localStorage.setItem(e,JSON.stringify({data:t,timestamp:Date.now(),ttl:r})),console.log("💾 Cache: Data cached successfully for key:",e)}catch{console.log("💾 Cache: Storage full, cleaning old data for key:",e),z3();try{localStorage.setItem(e,JSON.stringify({data:t,timestamp:Date.now(),ttl:r})),console.log("💾 Cache: Data cached after cleanup for key:",e)}catch{console.warn("Storage full, cannot cache data")}}},z3=()=>{const e=Date.now(),t=Object.keys(localStorage);t.forEach(s=>{try{const a=localStorage.getItem(s);if(a){const{timestamp:i,ttl:l}=JSON.parse(a);e-i>l&&localStorage.removeItem(s)}}catch{localStorage.removeItem(s)}});const r=e-10080*60*1e3;t.forEach(s=>{try{const a=localStorage.getItem(s);if(a){const{timestamp:i}=JSON.parse(a);i<r&&localStorage.removeItem(s)}}catch{localStorage.removeItem(s)}});const n=Object.keys(localStorage);if(n.length>0){const s=n.map(i=>{try{const l=localStorage.getItem(i);if(l){const{timestamp:c}=JSON.parse(l);return{key:i,timestamp:c}}}catch{return{key:i,timestamp:0}}return{key:i,timestamp:0}}),a=Math.ceil(s.length*.25);s.sort((i,l)=>i.timestamp-l.timestamp).slice(0,a).forEach(({key:i})=>localStorage.removeItem(i))}},C2=e=>{Object.keys(localStorage).forEach(r=>{r.includes(e)&&localStorage.removeItem(r)})},w0=(e,t,r)=>{const n=`test_progress_${e}_${t}_${r}`,s=`anti_cheating_${e}_${t}_${r}`;if(localStorage.removeItem(n),localStorage.removeItem(s),t==="speaking_test_data"){const a=`speaking_test_data_${e}_${r}`;localStorage.removeItem(a),console.log(`Cleared speaking test data cache for ${r}`)}console.log(`Cleared test data for ${t}_${r}`)},Uh=Object.freeze(Object.defineProperty({__proto__:null,CACHE_TTL:hs,cleanupOldData:z3,clearTestData:w0,clearUserData:C2,getCachedData:Jn,setCachedData:Qn},Symbol.toStringTag,{value:"Module"})),H3=C.createContext(),G3=({children:e})=>{const[t,r]=C.useState(null),[n,s]=C.useState(null),[a,i]=C.useState(localStorage.getItem("token")),[l,c]=C.useState(!1),[d,f]=C.useState(!0),[p,g]=C.useState(null);C.useEffect(()=>{console.log("[AUTH] Initializing application session..."),b()},[]),C.useEffect(()=>{if(l&&a){console.log("[AUTH] Setting up proactive token refresh...");let V=!1;const O=setInterval(async()=>{if(l&&a&&!V){V=!0;try{const W=a||localStorage.getItem("auth_token");if(W&&y(W))console.log("[AUTH] Token expired, attempting refresh..."),await v()||console.log("[AUTH] Proactive refresh failed, but user remains logged in");else if(W)try{const Y=JSON.parse(atob(W.split(".")[1])).exp*1e3,ee=Date.now(),X=Y-ee;X<300*1e3&&X>0&&(console.log(`[AUTH] Token expires in ${Math.round(X/1e3)} seconds, refreshing...`),await v()||console.log("[AUTH] Proactive refresh failed, but user remains logged in"))}catch(q){console.error("[AUTH] Error parsing token for expiration check:",q)}}catch(W){console.error("[AUTH] Error in proactive refresh:",W)}finally{V=!1}}},300*1e3);return()=>{console.log("[AUTH] Clearing proactive token refresh interval"),clearInterval(O)}}},[l,a]);const y=V=>{if(!V)return!0;try{if(typeof V!="string"||!V.includes("."))return console.warn("[AUTH] Invalid token format - not a JWT"),!0;const O=V.split(".");if(O.length!==3)return console.warn("[AUTH] Invalid token format - not 3 parts"),!0;const W=JSON.parse(atob(O[1])),q=Date.now()/1e3;return W.exp<=q}catch(O){if(console.error("[AUTH] Error decoding token:",O),console.warn("[AUTH] Token appears to be corrupted - clearing authentication"),localStorage.removeItem("auth_token"),localStorage.removeItem("accessToken"),localStorage.removeItem("refresh_token"),localStorage.removeItem("userData"),window.tokenManager)try{window.tokenManager.clearTokens()}catch(W){console.warn("[AUTH] Error clearing token manager:",W)}return!0}},v=async()=>{const V=localStorage.getItem("refresh_token");if(!V)return console.log("[AUTH] No refresh token found"),!1;try{const O=await fetch("/.netlify/functions/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:V})});if(O.ok){const W=await O.json();console.log("[AUTH] Token refresh successful"),localStorage.setItem("auth_token",W.accessToken),localStorage.setItem("refresh_token",W.refreshToken),localStorage.setItem("accessToken",W.accessToken);try{window.tokenManager&&(window.tokenManager.setToken(W.accessToken),W.refreshToken&&window.tokenManager.setRefreshToken(W.refreshToken))}catch{}return i(W.accessToken),!0}else return console.error("[AUTH] Token refresh failed:",O.status),!1}catch(O){return console.error("[AUTH] Token refresh error:",O),!1}},w=async(V,O={})=>{const W=a||localStorage.getItem("auth_token");if(!W)throw new Error("No authentication token found");const q={"Content-Type":"application/json",Authorization:`Bearer ${W}`,...O.headers},Y=await fetch(V,{...O,headers:q});if(Y.status===401)if(console.log("[AUTH] 401 error, attempting token refresh..."),await v()){const X=localStorage.getItem("auth_token");return q.Authorization=`Bearer ${X}`,fetch(V,{...O,headers:q})}else throw console.log("[AUTH] Token refresh failed, returning 401 response"),new Error("Authentication failed - please login again");return Y},b=async()=>{try{console.log("[AUTH] Starting session initialization..."),f(!0);const V=localStorage.getItem("auth_token")||localStorage.getItem("accessToken")||localStorage.getItem("token"),O=localStorage.getItem("user_data")||localStorage.getItem("userData"),W=O?JSON.parse(O).role:null;if(console.log("[AUTH] Found stored data:",{hasToken:!!V,hasUser:!!O,role:W}),V&&W&&O)try{const q=JSON.parse(O);if(y(V))if(console.log("[AUTH] Token expired, attempting refresh..."),await v()){console.log("[AUTH] Token refreshed successfully");const ee=localStorage.getItem("auth_token");i(ee)}else console.log("[AUTH] Token refresh failed, but continuing with existing token..."),i(V);else i(V);s(W),r(q);try{if(window.tokenManager){window.tokenManager.setToken(localStorage.getItem("auth_token"));const Y=localStorage.getItem("refresh_token");Y&&window.tokenManager.setRefreshToken(Y)}}catch{}c(!0),await _(q,W)}catch(q){console.error("[AUTH] Error parsing stored user data:",q),console.log("[AUTH] Invalid user data, but not forcing logout - continuing with empty state"),c(!1)}}catch(V){console.error("[AUTH] Session initialization error:",V),console.log("[AUTH] Initialization error, but not forcing logout - continuing with empty state"),c(!1)}finally{console.log("[AUTH] Session initialization complete"),f(!1)}},E=async V=>{try{if(f(!0),g(null),window.forceLogout||window.preventAutoLogin){console.log("⚠️ Login blocked - force logout in progress"),g("Please wait for the logout process to complete.");return}console.log("Attempting login with:",V.username);let O,W;V.username==="admin"?(O={ok:!0,json:()=>({success:!0,token:"test-token"})},W="admin"):(O=await authService.teacherLogin(V),W="teacher");const q=await O.json();await k(O,W,q)}catch(O){N(O)}finally{f(!1)}},k=async(V,O,W)=>{try{if(V.ok&&W.success&&W.token){i(W.token),s(O),r(W),c(!0),localStorage.setItem("auth_token",W.accessToken||W.token),localStorage.setItem("refresh_token",W.refreshToken),localStorage.setItem("user_data",JSON.stringify(W)),localStorage.setItem("accessToken",W.accessToken||W.token);try{const q=Date.now(),Y=10080*60*1e3,ee=[];for(let X=0;X<localStorage.length;X++){const ne=localStorage.key(X);if(!(!ne||!(ne.startsWith("test_progress_")||ne.startsWith("test_timer_")||ne.startsWith("test_shuffle_order_")||ne.startsWith("student_results_table_")||ne.startsWith("anti_cheating_"))))try{const _e=localStorage.getItem(ne);if(!_e){ee.push(ne);continue}let Pe=null;if(_e.startsWith("{")||_e.startsWith("[")){const ce=JSON.parse(_e),ye=ce.timestamp||ce.lastSaved||ce.lastTickAt||ce.createdAt||ce.updatedAt||ce.startedAt||ce.started_at;ye&&(Pe=new Date(ye).getTime())}if(!Pe){const ce=`${ne}__ts`,ye=localStorage.getItem(ce);ye&&(Pe=parseInt(ye)||null)}if(!Pe)continue;q-Pe>Y&&ee.push(ne)}catch{}}ee.forEach(X=>{try{localStorage.removeItem(X)}catch{}})}catch(q){console.warn("LocalStorage cleanup skipped:",q)}return await _(W,O),!0}else{const q=W.message||V.statusText||"Login failed";return N(new Error(q)),!1}}catch(q){return N(q),!1}},_=async(V,O)=>{try{switch(O){case"admin":console.log("Admin login successful, role:",V.role),console.log("Admin logged in:",V);break;case"teacher":console.log("Teacher login successful, role:",V.role),console.log("Teacher data:",V.teacher),await j(V),await R();break;case"student":console.log("Student login successful"),T(V);break;default:console.warn("Unknown user role:",O)}}catch(W){console.error("Post-login actions error:",W)}},T=V=>{r(V),console.log("Student info populated:",V)},j=async V=>{r(V),console.log("Teacher info populated:",V)},P=async()=>{try{console.log("Initializing teacher cabinet...")}catch(V){console.error("Error initializing teacher cabinet:",V)}},R=async()=>{try{console.log("Checking teacher subjects...")}catch(V){console.error("Error checking teacher subjects:",V)}},N=V=>{g(V.message||"Login failed"),A()},A=()=>{g(null),f(!1)},M=C.useCallback(()=>{H()},[]),H=()=>{r(null),s(null),i(null),c(!1),g(null);const V=t?.student_id||t?.teacher_id||t?.admin_id||t?.id;V&&C2(V),localStorage.removeItem("token"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("user_role"),localStorage.removeItem("accessToken"),localStorage.removeItem("testProgress"),localStorage.removeItem("formData"),window.tokenManager&&window.tokenManager.clearAuth(),setTimeout(()=>{Q()},100)},Q=()=>{console.log("Interface reset after session clear - redirecting to login"),window.location.replace("/login")},Z=()=>t?.id||null,ae=()=>n==="admin"?t:null,te=()=>n==="admin",se=()=>te()?t?.admin_id:null,L=()=>n==="teacher"?t?.username:null,G=()=>{console.log("Auth functions available:",{handleUnifiedLogin:typeof E,logout:typeof M,getCurrentTeacherId:typeof Z,isAdmin:typeof te,getCurrentAdmin:typeof ae,getCurrentAdminId:typeof se,getCurrentTeacherUsername:typeof L})};C.useEffect(()=>(window.logout=M,window.getCurrentTeacherId=Z,window.getCurrentAdmin=ae,window.isAdmin=te,window.getCurrentAdminId=se,window.getCurrentTeacherUsername=L,window.checkFunctionAvailability=G,()=>{delete window.logout,delete window.getCurrentTeacherId,delete window.getCurrentAdmin,delete window.isAdmin,delete window.getCurrentAdminId,delete window.getCurrentTeacherUsername,delete window.checkFunctionAvailability}),[M]);const I=C.useCallback(V=>{console.log("Setting user data from external auth:",V),r(V),s(V.role),i(V.token),c(!0),f(!1),g(null),localStorage.setItem("auth_token",V.token),localStorage.setItem("user_data",JSON.stringify(V)),localStorage.setItem("accessToken",V.token)},[]),z={user:t,role:n,token:a,isAuthenticated:l,isLoading:d,error:p,login:E,setUserData:I,logout:M,resetLoginForm:A,forceCompleteLogout:H,initializeApplicationSession:b,makeAuthenticatedRequest:w,populateStudentInfo:T,populateTeacherInfo:j,initializeTeacherCabinet:P,checkTeacherSubjects:R,getCurrentTeacherId:Z,getCurrentAdmin:ae,isAdmin:te,getCurrentAdminId:se,getCurrentTeacherUsername:L,handleLoginResponse:k,handlePostLoginActions:_,handleLoginFailure:N,resetInterfaceAfterSessionClear:Q,checkFunctionAvailability:G};return o.jsx(H3.Provider,{value:z,children:e})},Wn=()=>{const e=C.useContext(H3);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e};class LR{constructor(){this.baseURL="http://localhost:8888/.netlify/functions",this.timeout=1e4,this.retryCount=3,this.retryDelay=1e3}getHeaders(){const t=localStorage.getItem("token");return{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}}}async sendRequest(t,r){try{return await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(n){throw console.error("❌ Network error:",n),n}}async request(t,r={}){const n=`${this.baseURL}${t}`,s={method:"GET",headers:this.getHeaders(),timeout:this.timeout,...r};let a;for(let i=0;i<this.retryCount;i++)try{const l=new AbortController,c=setTimeout(()=>l.abort(),this.timeout),d=await fetch(n,{...s,signal:l.signal});if(clearTimeout(c),!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(l){if(a=l,l.name==="AbortError")throw new Error("Request timeout");i<this.retryCount-1&&(console.warn(`Request failed, retrying in ${this.retryDelay}ms... (attempt ${i+1}/${this.retryCount})`),await new Promise(c=>setTimeout(c,this.retryDelay*Math.pow(2,i))))}throw a}async get(t,r={}){return this.request(t,{...r,method:"GET"})}async post(t,r,n={}){return this.request(t,{...n,method:"POST",body:JSON.stringify(r)})}async put(t,r,n={}){return this.request(t,{...n,method:"PUT",body:JSON.stringify(r)})}async delete(t,r={}){return this.request(t,{...r,method:"DELETE"})}async patch(t,r,n={}){return this.request(t,{...n,method:"PATCH",body:JSON.stringify(r)})}async uploadFile(t,r,n={}){const s=new FormData;s.append("file",r);const a=`${this.baseURL}${t}`,i={method:"POST",headers:{...localStorage.getItem("token")&&{Authorization:`Bearer ${localStorage.getItem("token")}`}},body:s,...n};try{const l=await fetch(a,i);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){throw l}}async downloadFile(t,r,n={}){const s=`${this.baseURL}${t}`,a={method:"GET",headers:this.getHeaders(),...n};try{const i=await fetch(s,a);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const l=await i.blob(),c=window.URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=r,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(c)}catch(i){throw i}}ensureDebugOutput(){let t=document.getElementById("debug-output");return t||(t=document.createElement("div"),t.id="debug-output",t.className="fixed top-4 right-4 w-96 max-h-96 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-50 overflow-auto",t.innerHTML='<div class="text-sm font-mono text-gray-800">Debug Output</div>',document.body.appendChild(t)),t}async testDbConnection(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/test-db-connection")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Database Connection Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,message:"Database connection successful",data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Database Connection Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,message:"Database connection failed",error:t.message}}}async testStudentLogin(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/student-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:"51706",password:"1"})})).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Student Login Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Student Login Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testTeacherLogin(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/teacher-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:"Aleksandr_Petrov",password:"465"})})).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Teacher Login Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Teacher Login Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testAdminLogin(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/admin-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:"admin",password:"admin123"})})).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Admin Login Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Admin Login Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetSubjects(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-subjects")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Subjects Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Subjects Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetTeacherSubjects(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-teacher-subjects")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Teacher Subjects Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Teacher Subjects Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetClassResults(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-class-results")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Class Results Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Class Results Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetStudentSubjects(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-student-subjects")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Student Subjects Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Student Subjects Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetStudentTestResults(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-student-test-results")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Student Test Results Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Student Test Results Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testEndpoints(){const t=["/debug/test-student-login","/debug/test-teacher-login","/debug/test-admin-login","/debug/test-get-subjects","/debug/test-get-teacher-subjects","/debug/test-get-class-results","/debug/test-get-student-subjects","/debug/test-get-student-test-results"],r={};for(const n of t)try{const s=await this.get(n);r[n]={success:!0,data:s}}catch(s){r[n]={success:!1,error:s.message}}return r}async debugFunction(t){const r=this.ensureDebugOutput();try{let n;switch(t){case"testDbConnection":n=await this.testDbConnection();break;case"testStudentLogin":n=await this.testStudentLogin();break;case"testTeacherLogin":n=await this.testTeacherLogin();break;case"testAdminLogin":n=await this.testAdminLogin();break;case"testGetSubjects":n=await this.testGetSubjects();break;case"testGetTeacherSubjects":n=await this.testGetTeacherSubjects();break;case"testGetClassResults":n=await this.testGetClassResults();break;case"testGetStudentSubjects":n=await this.testGetStudentSubjects();break;case"testGetStudentTestResults":n=await this.testGetStudentTestResults();break;default:throw new Error(`Unknown debug function: ${t}`)}return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Debug Function: ${t}</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),n}catch(n){throw r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Debug Function Error: ${t}</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${n.message}</pre>
        `),n}}showDebugFunctions(){const t=this.ensureDebugOutput(),r=`
      <div class="text-sm font-mono text-gray-800 mb-4">Debug Functions</div>
      <div class="grid grid-cols-2 gap-2 mb-4">
        <button onclick="apiClient.testDbConnection()" class="px-3 py-2 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">
          Test DB Connection
        </button>
        <button onclick="apiClient.testStudentLogin()" class="px-3 py-2 bg-green-500 text-white text-xs rounded hover:bg-green-600 transition-colors">
          Test Student Login
        </button>
        <button onclick="apiClient.testTeacherLogin()" class="px-3 py-2 bg-yellow-500 text-white text-xs rounded hover:bg-yellow-600 transition-colors">
          Test Teacher Login
        </button>
        <button onclick="apiClient.testAdminLogin()" class="px-3 py-2 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors">
          Test Admin Login
        </button>
        <button onclick="apiClient.testGetSubjects()" class="px-3 py-2 bg-purple-500 text-white text-xs rounded hover:bg-purple-600 transition-colors">
          Test Get Subjects
        </button>
        <button onclick="apiClient.testGetTeacherSubjects()" class="px-3 py-2 bg-indigo-500 text-white text-xs rounded hover:bg-indigo-600 transition-colors">
          Test Get Teacher Subjects
        </button>
        <button onclick="apiClient.testGetClassResults()" class="px-3 py-2 bg-pink-500 text-white text-xs rounded hover:bg-pink-600 transition-colors">
          Test Get Class Results
        </button>
        <button onclick="apiClient.testGetStudentSubjects()" class="px-3 py-2 bg-teal-500 text-white text-xs rounded hover:bg-teal-600 transition-colors">
          Test Get Student Subjects
        </button>
        <button onclick="apiClient.testGetStudentTestResults()" class="px-3 py-2 bg-orange-500 text-white text-xs rounded hover:bg-orange-600 transition-colors">
          Test Get Student Test Results
        </button>
        <button onclick="apiClient.testEndpoints()" class="px-3 py-2 bg-gray-500 text-white text-xs rounded hover:bg-gray-600 transition-colors">
          Test All Endpoints
        </button>
      </div>
    `;t.innerHTML=r}}const os=new LR,T2=C.createContext({});function N2(e){const t=C.useRef(null);return t.current===null&&(t.current=e()),t.current}const E2=typeof window<"u",V3=E2?C.useLayoutEffect:C.useEffect,P1=C.createContext(null);function j2(e,t){e.indexOf(t)===-1&&e.push(t)}function A2(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Fc=(e,t,r)=>r>t?t:r<e?e:r;let F2=()=>{};const Pc={},K3=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function q3(e){return typeof e=="object"&&e!==null}const X3=e=>/^0[^.\s]+$/u.test(e);function P2(e){let t;return()=>(t===void 0&&(t=e()),t)}const So=e=>e,BR=(e,t)=>r=>t(e(r)),Fp=(...e)=>e.reduce(BR),Qm=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n};class R2{constructor(){this.subscriptions=[]}add(t){return j2(this.subscriptions,t),()=>A2(this.subscriptions,t)}notify(t,r,n){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](t,r,n);else for(let a=0;a<s;a++){const i=this.subscriptions[a];i&&i(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ml=e=>e*1e3,Ol=e=>e/1e3;function Y3(e,t){return t?e*(1e3/t):0}const J3=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,UR=1e-7,$R=12;function WR(e,t,r,n,s){let a,i,l=0;do i=t+(r-t)/2,a=J3(i,n,s)-e,a>0?r=i:t=i;while(Math.abs(a)>UR&&++l<$R);return i}function Pp(e,t,r,n){if(e===t&&r===n)return So;const s=a=>WR(a,0,1,e,r);return a=>a===0||a===1?a:J3(s(a),t,n)}const Q3=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Z3=e=>t=>1-e(1-t),e5=Pp(.33,1.53,.69,.99),D2=Z3(e5),t5=Q3(D2),r5=e=>(e*=2)<1?.5*D2(e):.5*(2-Math.pow(2,-10*(e-1))),I2=e=>1-Math.sin(Math.acos(e)),n5=Z3(I2),s5=Q3(I2),zR=Pp(.42,0,1,1),HR=Pp(0,0,.58,1),a5=Pp(.42,0,.58,1),GR=e=>Array.isArray(e)&&typeof e[0]!="number",i5=e=>Array.isArray(e)&&typeof e[0]=="number",VR={linear:So,easeIn:zR,easeInOut:a5,easeOut:HR,circIn:I2,circInOut:s5,circOut:n5,backIn:D2,backInOut:t5,backOut:e5,anticipate:r5},KR=e=>typeof e=="string",Uk=e=>{if(i5(e)){F2(e.length===4);const[t,r,n,s]=e;return Pp(t,r,n,s)}else if(KR(e))return VR[e];return e},ny=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function qR(e,t){let r=new Set,n=new Set,s=!1,a=!1;const i=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(f){i.has(f)&&(d.schedule(f),e()),f(l)}const d={schedule:(f,p=!1,g=!1)=>{const v=g&&s?r:n;return p&&i.add(f),v.has(f)||v.add(f),f},cancel:f=>{n.delete(f),i.delete(f)},process:f=>{if(l=f,s){a=!0;return}s=!0,[r,n]=[n,r],r.forEach(c),r.clear(),s=!1,a&&(a=!1,d.process(f))}};return d}const XR=40;function o5(e,t){let r=!1,n=!0;const s={delta:0,timestamp:0,isProcessing:!1},a=()=>r=!0,i=ny.reduce((_,T)=>(_[T]=qR(a),_),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:f,update:p,preRender:g,render:y,postRender:v}=i,w=()=>{const _=Pc.useManualTiming?s.timestamp:performance.now();r=!1,Pc.useManualTiming||(s.delta=n?1e3/60:Math.max(Math.min(_-s.timestamp,XR),1)),s.timestamp=_,s.isProcessing=!0,l.process(s),c.process(s),d.process(s),f.process(s),p.process(s),g.process(s),y.process(s),v.process(s),s.isProcessing=!1,r&&t&&(n=!1,e(w))},b=()=>{r=!0,n=!0,s.isProcessing||e(w)};return{schedule:ny.reduce((_,T)=>{const j=i[T];return _[T]=(P,R=!1,N=!1)=>(r||b(),j.schedule(P,R,N)),_},{}),cancel:_=>{for(let T=0;T<ny.length;T++)i[ny[T]].cancel(_)},state:s,steps:i}}const{schedule:Kn,cancel:Wu,state:Ca,steps:qv}=o5(typeof requestAnimationFrame<"u"?requestAnimationFrame:So,!0);let Ay;function YR(){Ay=void 0}const Ai={now:()=>(Ay===void 0&&Ai.set(Ca.isProcessing||Pc.useManualTiming?Ca.timestamp:performance.now()),Ay),set:e=>{Ay=e,queueMicrotask(YR)}},l5=e=>t=>typeof t=="string"&&t.startsWith(e),M2=l5("--"),JR=l5("var(--"),O2=e=>JR(e)?QR.test(e.split("/*")[0].trim()):!1,QR=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,_0={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Zm={..._0,transform:e=>Fc(0,1,e)},sy={..._0,default:1},Pm=e=>Math.round(e*1e5)/1e5,L2=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ZR(e){return e==null}const eD=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,B2=(e,t)=>r=>!!(typeof r=="string"&&eD.test(r)&&r.startsWith(e)||t&&!ZR(r)&&Object.prototype.hasOwnProperty.call(r,t)),c5=(e,t,r)=>n=>{if(typeof n!="string")return n;const[s,a,i,l]=n.match(L2);return{[e]:parseFloat(s),[t]:parseFloat(a),[r]:parseFloat(i),alpha:l!==void 0?parseFloat(l):1}},tD=e=>Fc(0,255,e),Xv={..._0,transform:e=>Math.round(tD(e))},zd={test:B2("rgb","red"),parse:c5("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+Xv.transform(e)+", "+Xv.transform(t)+", "+Xv.transform(r)+", "+Pm(Zm.transform(n))+")"};function rD(e){let t="",r="",n="",s="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),s=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),s=e.substring(4,5),t+=t,r+=r,n+=n,s+=s),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:s?parseInt(s,16)/255:1}}const a_={test:B2("#"),parse:rD,transform:zd.transform},Rp=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),ju=Rp("deg"),Ll=Rp("%"),Ar=Rp("px"),nD=Rp("vh"),sD=Rp("vw"),$k={...Ll,parse:e=>Ll.parse(e)/100,transform:e=>Ll.transform(e*100)},$h={test:B2("hsl","hue"),parse:c5("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+Ll.transform(Pm(t))+", "+Ll.transform(Pm(r))+", "+Pm(Zm.transform(n))+")"},Os={test:e=>zd.test(e)||a_.test(e)||$h.test(e),parse:e=>zd.test(e)?zd.parse(e):$h.test(e)?$h.parse(e):a_.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?zd.transform(e):$h.transform(e),getAnimatableNone:e=>{const t=Os.parse(e);return t.alpha=0,Os.transform(t)}},aD=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function iD(e){return isNaN(e)&&typeof e=="string"&&(e.match(L2)?.length||0)+(e.match(aD)?.length||0)>0}const u5="number",d5="color",oD="var",lD="var(",Wk="${}",cD=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ep(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},s=[];let a=0;const l=t.replace(cD,c=>(Os.test(c)?(n.color.push(a),s.push(d5),r.push(Os.parse(c))):c.startsWith(lD)?(n.var.push(a),s.push(oD),r.push(c)):(n.number.push(a),s.push(u5),r.push(parseFloat(c))),++a,Wk)).split(Wk);return{values:r,split:l,indexes:n,types:s}}function f5(e){return ep(e).values}function h5(e){const{split:t,types:r}=ep(e),n=t.length;return s=>{let a="";for(let i=0;i<n;i++)if(a+=t[i],s[i]!==void 0){const l=r[i];l===u5?a+=Pm(s[i]):l===d5?a+=Os.transform(s[i]):a+=s[i]}return a}}const uD=e=>typeof e=="number"?0:Os.test(e)?Os.getAnimatableNone(e):e;function dD(e){const t=f5(e);return h5(e)(t.map(uD))}const zu={test:iD,parse:f5,createTransformer:h5,getAnimatableNone:dD};function Yv(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function fD({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let s=0,a=0,i=0;if(!t)s=a=i=r;else{const l=r<.5?r*(1+t):r+t-r*t,c=2*r-l;s=Yv(c,l,e+1/3),a=Yv(c,l,e),i=Yv(c,l,e-1/3)}return{red:Math.round(s*255),green:Math.round(a*255),blue:Math.round(i*255),alpha:n}}function Wy(e,t){return r=>r>0?t:e}const Zn=(e,t,r)=>e+(t-e)*r,Jv=(e,t,r)=>{const n=e*e,s=r*(t*t-n)+n;return s<0?0:Math.sqrt(s)},hD=[a_,zd,$h],gD=e=>hD.find(t=>t.test(e));function zk(e){const t=gD(e);if(!t)return!1;let r=t.parse(e);return t===$h&&(r=fD(r)),r}const Hk=(e,t)=>{const r=zk(e),n=zk(t);if(!r||!n)return Wy(e,t);const s={...r};return a=>(s.red=Jv(r.red,n.red,a),s.green=Jv(r.green,n.green,a),s.blue=Jv(r.blue,n.blue,a),s.alpha=Zn(r.alpha,n.alpha,a),zd.transform(s))},i_=new Set(["none","hidden"]);function mD(e,t){return i_.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function pD(e,t){return r=>Zn(e,t,r)}function U2(e){return typeof e=="number"?pD:typeof e=="string"?O2(e)?Wy:Os.test(e)?Hk:vD:Array.isArray(e)?g5:typeof e=="object"?Os.test(e)?Hk:xD:Wy}function g5(e,t){const r=[...e],n=r.length,s=e.map((a,i)=>U2(a)(a,t[i]));return a=>{for(let i=0;i<n;i++)r[i]=s[i](a);return r}}function xD(e,t){const r={...e,...t},n={};for(const s in r)e[s]!==void 0&&t[s]!==void 0&&(n[s]=U2(e[s])(e[s],t[s]));return s=>{for(const a in n)r[a]=n[a](s);return r}}function yD(e,t){const r=[],n={color:0,var:0,number:0};for(let s=0;s<t.values.length;s++){const a=t.types[s],i=e.indexes[a][n[a]],l=e.values[i]??0;r[s]=l,n[a]++}return r}const vD=(e,t)=>{const r=zu.createTransformer(t),n=ep(e),s=ep(t);return n.indexes.var.length===s.indexes.var.length&&n.indexes.color.length===s.indexes.color.length&&n.indexes.number.length>=s.indexes.number.length?i_.has(e)&&!s.values.length||i_.has(t)&&!n.values.length?mD(e,t):Fp(g5(yD(n,s),s.values),r):Wy(e,t)};function m5(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?Zn(e,t,r):U2(e)(e,t)}const wD=e=>{const t=({timestamp:r})=>e(r);return{start:(r=!0)=>Kn.update(t,r),stop:()=>Wu(t),now:()=>Ca.isProcessing?Ca.timestamp:Ai.now()}},p5=(e,t,r=10)=>{let n="";const s=Math.max(Math.round(t/r),2);for(let a=0;a<s;a++)n+=Math.round(e(a/(s-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},zy=2e4;function $2(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<zy;)t+=r,n=e.next(t);return t>=zy?1/0:t}function _D(e,t=100,r){const n=r({...e,keyframes:[0,t]}),s=Math.min($2(n),zy);return{type:"keyframes",ease:a=>n.next(s*a).value/t,duration:Ol(s)}}const bD=5;function x5(e,t,r){const n=Math.max(t-bD,0);return Y3(r-e(n),t-n)}const ls={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Qv=.001;function SD({duration:e=ls.duration,bounce:t=ls.bounce,velocity:r=ls.velocity,mass:n=ls.mass}){let s,a,i=1-t;i=Fc(ls.minDamping,ls.maxDamping,i),e=Fc(ls.minDuration,ls.maxDuration,Ol(e)),i<1?(s=d=>{const f=d*i,p=f*e,g=f-r,y=o_(d,i),v=Math.exp(-p);return Qv-g/y*v},a=d=>{const p=d*i*e,g=p*r+r,y=Math.pow(i,2)*Math.pow(d,2)*e,v=Math.exp(-p),w=o_(Math.pow(d,2),i);return(-s(d)+Qv>0?-1:1)*((g-y)*v)/w}):(s=d=>{const f=Math.exp(-d*e),p=(d-r)*e+1;return-Qv+f*p},a=d=>{const f=Math.exp(-d*e),p=(r-d)*(e*e);return f*p});const l=5/e,c=CD(s,a,l);if(e=Ml(e),isNaN(c))return{stiffness:ls.stiffness,damping:ls.damping,duration:e};{const d=Math.pow(c,2)*n;return{stiffness:d,damping:i*2*Math.sqrt(n*d),duration:e}}}const kD=12;function CD(e,t,r){let n=r;for(let s=1;s<kD;s++)n=n-e(n)/t(n);return n}function o_(e,t){return e*Math.sqrt(1-t*t)}const TD=["duration","bounce"],ND=["stiffness","damping","mass"];function Gk(e,t){return t.some(r=>e[r]!==void 0)}function ED(e){let t={velocity:ls.velocity,stiffness:ls.stiffness,damping:ls.damping,mass:ls.mass,isResolvedFromDuration:!1,...e};if(!Gk(e,ND)&&Gk(e,TD))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),s=n*n,a=2*Fc(.05,1,1-(e.bounce||0))*Math.sqrt(s);t={...t,mass:ls.mass,stiffness:s,damping:a}}else{const r=SD(e);t={...t,...r,mass:ls.mass},t.isResolvedFromDuration=!0}return t}function Hy(e=ls.visualDuration,t=ls.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:s}=r;const a=r.keyframes[0],i=r.keyframes[r.keyframes.length-1],l={done:!1,value:a},{stiffness:c,damping:d,mass:f,duration:p,velocity:g,isResolvedFromDuration:y}=ED({...r,velocity:-Ol(r.velocity||0)}),v=g||0,w=d/(2*Math.sqrt(c*f)),b=i-a,E=Ol(Math.sqrt(c/f)),k=Math.abs(b)<5;n||(n=k?ls.restSpeed.granular:ls.restSpeed.default),s||(s=k?ls.restDelta.granular:ls.restDelta.default);let _;if(w<1){const j=o_(E,w);_=P=>{const R=Math.exp(-w*E*P);return i-R*((v+w*E*b)/j*Math.sin(j*P)+b*Math.cos(j*P))}}else if(w===1)_=j=>i-Math.exp(-E*j)*(b+(v+E*b)*j);else{const j=E*Math.sqrt(w*w-1);_=P=>{const R=Math.exp(-w*E*P),N=Math.min(j*P,300);return i-R*((v+w*E*b)*Math.sinh(N)+j*b*Math.cosh(N))/j}}const T={calculatedDuration:y&&p||null,next:j=>{const P=_(j);if(y)l.done=j>=p;else{let R=j===0?v:0;w<1&&(R=j===0?Ml(v):x5(_,j,P));const N=Math.abs(R)<=n,A=Math.abs(i-P)<=s;l.done=N&&A}return l.value=l.done?i:P,l},toString:()=>{const j=Math.min($2(T),zy),P=p5(R=>T.next(j*R).value,j,30);return j+"ms "+P},toTransition:()=>{}};return T}Hy.applyToOptions=e=>{const t=_D(e,100,Hy);return e.ease=t.ease,e.duration=Ml(t.duration),e.type="keyframes",e};function l_({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:s=10,bounceStiffness:a=500,modifyTarget:i,min:l,max:c,restDelta:d=.5,restSpeed:f}){const p=e[0],g={done:!1,value:p},y=N=>l!==void 0&&N<l||c!==void 0&&N>c,v=N=>l===void 0?c:c===void 0||Math.abs(l-N)<Math.abs(c-N)?l:c;let w=r*t;const b=p+w,E=i===void 0?b:i(b);E!==b&&(w=E-p);const k=N=>-w*Math.exp(-N/n),_=N=>E+k(N),T=N=>{const A=k(N),M=_(N);g.done=Math.abs(A)<=d,g.value=g.done?E:M};let j,P;const R=N=>{y(g.value)&&(j=N,P=Hy({keyframes:[g.value,v(g.value)],velocity:x5(_,N,g.value),damping:s,stiffness:a,restDelta:d,restSpeed:f}))};return R(0),{calculatedDuration:null,next:N=>{let A=!1;return!P&&j===void 0&&(A=!0,T(N),R(N)),j!==void 0&&N>=j?P.next(N-j):(!A&&T(N),g)}}}function jD(e,t,r){const n=[],s=r||Pc.mix||m5,a=e.length-1;for(let i=0;i<a;i++){let l=s(e[i],e[i+1]);if(t){const c=Array.isArray(t)?t[i]||So:t;l=Fp(c,l)}n.push(l)}return n}function AD(e,t,{clamp:r=!0,ease:n,mixer:s}={}){const a=e.length;if(F2(a===t.length),a===1)return()=>t[0];if(a===2&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const l=jD(t,n,s),c=l.length,d=f=>{if(i&&f<e[0])return t[0];let p=0;if(c>1)for(;p<e.length-2&&!(f<e[p+1]);p++);const g=Qm(e[p],e[p+1],f);return l[p](g)};return r?f=>d(Fc(e[0],e[a-1],f)):d}function FD(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const s=Qm(0,t,n);e.push(Zn(r,1,s))}}function PD(e){const t=[0];return FD(t,e.length-1),t}function RD(e,t){return e.map(r=>r*t)}function DD(e,t){return e.map(()=>t||a5).splice(0,e.length-1)}function Rm({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const s=GR(n)?n.map(Uk):Uk(n),a={done:!1,value:t[0]},i=RD(r&&r.length===t.length?r:PD(t),e),l=AD(i,t,{ease:Array.isArray(s)?s:DD(t,s)});return{calculatedDuration:e,next:c=>(a.value=l(c),a.done=c>=e,a)}}const ID=e=>e!==null;function W2(e,{repeat:t,repeatType:r="loop"},n,s=1){const a=e.filter(ID),l=s<0||t&&r!=="loop"&&t%2===1?0:a.length-1;return!l||n===void 0?a[l]:n}const MD={decay:l_,inertia:l_,tween:Rm,keyframes:Rm,spring:Hy};function y5(e){typeof e.type=="string"&&(e.type=MD[e.type])}class z2{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,r){return this.finished.then(t,r)}}const OD=e=>e/100;class H2 extends z2{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==Ai.now()&&this.tick(Ai.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;y5(t);const{type:r=Rm,repeat:n=0,repeatDelay:s=0,repeatType:a,velocity:i=0}=t;let{keyframes:l}=t;const c=r||Rm;c!==Rm&&typeof l[0]!="number"&&(this.mixKeyframes=Fp(OD,m5(l[0],l[1])),l=[0,100]);const d=c({...t,keyframes:l});a==="mirror"&&(this.mirroredGenerator=c({...t,keyframes:[...l].reverse(),velocity:-i})),d.calculatedDuration===null&&(d.calculatedDuration=$2(d));const{calculatedDuration:f}=d;this.calculatedDuration=f,this.resolvedDuration=f+s,this.totalDuration=this.resolvedDuration*(n+1)-s,this.generator=d}updateTime(t){const r=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(t,r=!1){const{generator:n,totalDuration:s,mixKeyframes:a,mirroredGenerator:i,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return n.next(0);const{delay:d=0,keyframes:f,repeat:p,repeatType:g,repeatDelay:y,type:v,onUpdate:w,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-s/this.speed,this.startTime)),r?this.currentTime=t:this.updateTime(t);const E=this.currentTime-d*(this.playbackSpeed>=0?1:-1),k=this.playbackSpeed>=0?E<0:E>s;this.currentTime=Math.max(E,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let _=this.currentTime,T=n;if(p){const N=Math.min(this.currentTime,s)/l;let A=Math.floor(N),M=N%1;!M&&N>=1&&(M=1),M===1&&A--,A=Math.min(A,p+1),!!(A%2)&&(g==="reverse"?(M=1-M,y&&(M-=y/l)):g==="mirror"&&(T=i)),_=Fc(0,1,M)*l}const j=k?{done:!1,value:f[0]}:T.next(_);a&&(j.value=a(j.value));let{done:P}=j;!k&&c!==null&&(P=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const R=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&P);return R&&v!==l_&&(j.value=W2(f,this.options,b,this.speed)),w&&w(j.value),R&&this.finish(),j}then(t,r){return this.finished.then(t,r)}get duration(){return Ol(this.calculatedDuration)}get time(){return Ol(this.currentTime)}set time(t){t=Ml(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Ai.now());const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=Ol(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=wD,startTime:r}=this.options;this.driver||(this.driver=t(s=>this.tick(s))),this.options.onPlay?.();const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=r??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ai.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function LD(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Hd=e=>e*180/Math.PI,c_=e=>{const t=Hd(Math.atan2(e[1],e[0]));return u_(t)},BD={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:c_,rotateZ:c_,skewX:e=>Hd(Math.atan(e[1])),skewY:e=>Hd(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},u_=e=>(e=e%360,e<0&&(e+=360),e),Vk=c_,Kk=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),qk=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),UD={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Kk,scaleY:qk,scale:e=>(Kk(e)+qk(e))/2,rotateX:e=>u_(Hd(Math.atan2(e[6],e[5]))),rotateY:e=>u_(Hd(Math.atan2(-e[2],e[0]))),rotateZ:Vk,rotate:Vk,skewX:e=>Hd(Math.atan(e[4])),skewY:e=>Hd(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function d_(e){return e.includes("scale")?1:0}function f_(e,t){if(!e||e==="none")return d_(t);const r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,s;if(r)n=UD,s=r;else{const l=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=BD,s=l}if(!s)return d_(t);const a=n[t],i=s[1].split(",").map(WD);return typeof a=="function"?a(i):i[a]}const $D=(e,t)=>{const{transform:r="none"}=getComputedStyle(e);return f_(r,t)};function WD(e){return parseFloat(e.trim())}const b0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],S0=new Set(b0),Xk=e=>e===_0||e===Ar,zD=new Set(["x","y","z"]),HD=b0.filter(e=>!zD.has(e));function GD(e){const t=[];return HD.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const qd={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>f_(t,"x"),y:(e,{transform:t})=>f_(t,"y")};qd.translateX=qd.x;qd.translateY=qd.y;const Xd=new Set;let h_=!1,g_=!1,m_=!1;function v5(){if(g_){const e=Array.from(Xd).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const s=GD(n);s.length&&(r.set(n,s),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const s=r.get(n);s&&s.forEach(([a,i])=>{n.getValue(a)?.set(i)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}g_=!1,h_=!1,Xd.forEach(e=>e.complete(m_)),Xd.clear()}function w5(){Xd.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(g_=!0)})}function VD(){m_=!0,w5(),v5(),m_=!1}class G2{constructor(t,r,n,s,a,i=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=s,this.element=a,this.isAsync=i}scheduleResolve(){this.state="scheduled",this.isAsync?(Xd.add(this),h_||(h_=!0,Kn.read(w5),Kn.resolveKeyframes(v5))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:s}=this;if(t[0]===null){const a=s?.get(),i=t[t.length-1];if(a!==void 0)t[0]=a;else if(n&&r){const l=n.readValue(r,i);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=i),s&&a===void 0&&s.set(t[0])}LD(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Xd.delete(this)}cancel(){this.state==="scheduled"&&(Xd.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const KD=e=>e.startsWith("--");function qD(e,t,r){KD(t)?e.style.setProperty(t,r):e.style[t]=r}const XD=P2(()=>window.ScrollTimeline!==void 0),YD={};function JD(e,t){const r=P2(e);return()=>YD[t]??r()}const _5=JD(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Tm=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,Yk={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Tm([0,.65,.55,1]),circOut:Tm([.55,0,1,.45]),backIn:Tm([.31,.01,.66,-.59]),backOut:Tm([.33,1.53,.69,.99])};function b5(e,t){if(e)return typeof e=="function"?_5()?p5(e,t):"ease-out":i5(e)?Tm(e):Array.isArray(e)?e.map(r=>b5(r,t)||Yk.easeOut):Yk[e]}function QD(e,t,r,{delay:n=0,duration:s=300,repeat:a=0,repeatType:i="loop",ease:l="easeOut",times:c}={},d=void 0){const f={[t]:r};c&&(f.offset=c);const p=b5(l,s);Array.isArray(p)&&(f.easing=p);const g={delay:n,duration:s,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:a+1,direction:i==="reverse"?"alternate":"normal"};return d&&(g.pseudoElement=d),e.animate(f,g)}function S5(e){return typeof e=="function"&&"applyToOptions"in e}function ZD({type:e,...t}){return S5(e)&&_5()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class e7 extends z2{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:r,name:n,keyframes:s,pseudoElement:a,allowFlatten:i=!1,finalKeyframe:l,onComplete:c}=t;this.isPseudoElement=!!a,this.allowFlatten=i,this.options=t,F2(typeof t.type!="string");const d=ZD(t);this.animation=QD(r,n,s,d,a),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const f=W2(s,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(f):qD(r,n,f),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return Ol(Number(t))}get time(){return Ol(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=Ml(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&XD()?(this.animation.timeline=t,So):r(this)}}const k5={anticipate:r5,backInOut:t5,circInOut:s5};function t7(e){return e in k5}function r7(e){typeof e.ease=="string"&&t7(e.ease)&&(e.ease=k5[e.ease])}const Jk=10;class n7 extends e7{constructor(t){r7(t),y5(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:r,onUpdate:n,onComplete:s,element:a,...i}=this.options;if(!r)return;if(t!==void 0){r.set(t);return}const l=new H2({...i,autoplay:!1}),c=Ml(this.finishedTime??this.time);r.setWithVelocity(l.sample(c-Jk).value,l.sample(c).value,Jk),l.stop()}}const Qk=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(zu.test(e)||e==="0")&&!e.startsWith("url("));function s7(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function a7(e,t,r,n){const s=e[0];if(s===null)return!1;if(t==="display"||t==="visibility")return!0;const a=e[e.length-1],i=Qk(s,t),l=Qk(a,t);return!i||!l?!1:s7(e)||(r==="spring"||S5(r))&&n}function p_(e){e.duration=0,e.type}const i7=new Set(["opacity","clipPath","filter","transform"]),o7=P2(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function l7(e){const{motionValue:t,name:r,repeatDelay:n,repeatType:s,damping:a,type:i}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=t.owner.getProps();return o7()&&r&&i7.has(r)&&(r!=="transform"||!d)&&!c&&!n&&s!=="mirror"&&a!==0&&i!=="inertia"}const c7=40;class u7 extends z2{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:s=0,repeatDelay:a=0,repeatType:i="loop",keyframes:l,name:c,motionValue:d,element:f,...p}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Ai.now();const g={autoplay:t,delay:r,type:n,repeat:s,repeatDelay:a,repeatType:i,name:c,motionValue:d,element:f,...p},y=f?.KeyframeResolver||G2;this.keyframeResolver=new y(l,(v,w,b)=>this.onKeyframesResolved(v,w,g,!b),c,d,f),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,r,n,s){this.keyframeResolver=void 0;const{name:a,type:i,velocity:l,delay:c,isHandoff:d,onUpdate:f}=n;this.resolvedAt=Ai.now(),a7(t,a,i,l)||((Pc.instantAnimations||!c)&&f?.(W2(t,n,r)),t[0]=t[t.length-1],p_(n),n.repeat=0);const g={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>c7?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...n,keyframes:t},y=!d&&l7(g)?new n7({...g,element:g.motionValue.owner.current}):new H2(g);y.finished.then(()=>this.notifyFinished()).catch(So),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(t,r){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),VD()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const d7=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function f7(e){const t=d7.exec(e);if(!t)return[,];const[,r,n,s]=t;return[`--${r??n}`,s]}function C5(e,t,r=1){const[n,s]=f7(e);if(!n)return;const a=window.getComputedStyle(t).getPropertyValue(n);if(a){const i=a.trim();return K3(i)?parseFloat(i):i}return O2(s)?C5(s,t,r+1):s}function V2(e,t){return e?.[t]??e?.default??e}const T5=new Set(["width","height","top","left","right","bottom",...b0]),h7={test:e=>e==="auto",parse:e=>e},N5=e=>t=>t.test(e),E5=[_0,Ar,Ll,ju,sD,nD,h7],Zk=e=>E5.find(N5(e));function g7(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||X3(e):!0}const m7=new Set(["brightness","contrast","saturate","opacity"]);function p7(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(L2)||[];if(!n)return e;const s=r.replace(n,"");let a=m7.has(t)?1:0;return n!==r&&(a*=100),t+"("+a+s+")"}const x7=/\b([a-z-]*)\(.*?\)/gu,x_={...zu,getAnimatableNone:e=>{const t=e.match(x7);return t?t.map(p7).join(" "):e}},eC={..._0,transform:Math.round},y7={rotate:ju,rotateX:ju,rotateY:ju,rotateZ:ju,scale:sy,scaleX:sy,scaleY:sy,scaleZ:sy,skew:ju,skewX:ju,skewY:ju,distance:Ar,translateX:Ar,translateY:Ar,translateZ:Ar,x:Ar,y:Ar,z:Ar,perspective:Ar,transformPerspective:Ar,opacity:Zm,originX:$k,originY:$k,originZ:Ar},K2={borderWidth:Ar,borderTopWidth:Ar,borderRightWidth:Ar,borderBottomWidth:Ar,borderLeftWidth:Ar,borderRadius:Ar,radius:Ar,borderTopLeftRadius:Ar,borderTopRightRadius:Ar,borderBottomRightRadius:Ar,borderBottomLeftRadius:Ar,width:Ar,maxWidth:Ar,height:Ar,maxHeight:Ar,top:Ar,right:Ar,bottom:Ar,left:Ar,padding:Ar,paddingTop:Ar,paddingRight:Ar,paddingBottom:Ar,paddingLeft:Ar,margin:Ar,marginTop:Ar,marginRight:Ar,marginBottom:Ar,marginLeft:Ar,backgroundPositionX:Ar,backgroundPositionY:Ar,...y7,zIndex:eC,fillOpacity:Zm,strokeOpacity:Zm,numOctaves:eC},v7={...K2,color:Os,backgroundColor:Os,outlineColor:Os,fill:Os,stroke:Os,borderColor:Os,borderTopColor:Os,borderRightColor:Os,borderBottomColor:Os,borderLeftColor:Os,filter:x_,WebkitFilter:x_},j5=e=>v7[e];function A5(e,t){let r=j5(e);return r!==x_&&(r=zu),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const w7=new Set(["auto","none","0"]);function _7(e,t,r){let n=0,s;for(;n<e.length&&!s;){const a=e[n];typeof a=="string"&&!w7.has(a)&&ep(a).values.length&&(s=e[n]),n++}if(s&&r)for(const a of t)e[a]=A5(r,s)}class b7 extends G2{constructor(t,r,n,s,a){super(t,r,n,s,a,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),O2(d))){const f=C5(d,r.current);f!==void 0&&(t[c]=f),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!T5.has(n)||t.length!==2)return;const[s,a]=t,i=Zk(s),l=Zk(a);if(i!==l)if(Xk(i)&&Xk(l))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else qd[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let s=0;s<t.length;s++)(t[s]===null||g7(t[s]))&&n.push(s);n.length&&_7(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=qd[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const s=r[r.length-1];s!==void 0&&t.getValue(n,s).jump(s,!1)}measureEndState(){const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const s=t.getValue(r);s&&s.jump(this.measuredOrigin,!1);const a=n.length-1,i=n[a];n[a]=qd[r](t.measureViewportBox(),window.getComputedStyle(t.current)),i!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=i),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{t.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function S7(e,t,r){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let n=document;const s=r?.[e]??n.querySelectorAll(e);return s?Array.from(s):[]}return Array.from(e)}const F5=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function P5(e){return q3(e)&&"offsetHeight"in e}const tC=30,k7=e=>!isNaN(parseFloat(e));class C7{constructor(t,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const s=Ai.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=Ai.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=k7(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new R2);const n=this.events[t].add(r);return t==="change"?()=>{n(),Kn.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Ai.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>tC)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,tC);return Y3(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function l0(e,t){return new C7(e,t)}const{schedule:q2}=o5(queueMicrotask,!1),Go={x:!1,y:!1};function R5(){return Go.x||Go.y}function T7(e){return e==="x"||e==="y"?Go[e]?null:(Go[e]=!0,()=>{Go[e]=!1}):Go.x||Go.y?null:(Go.x=Go.y=!0,()=>{Go.x=Go.y=!1})}function D5(e,t){const r=S7(e),n=new AbortController,s={passive:!0,...t,signal:n.signal};return[r,s,()=>n.abort()]}function rC(e){return!(e.pointerType==="touch"||R5())}function N7(e,t,r={}){const[n,s,a]=D5(e,r),i=l=>{if(!rC(l))return;const{target:c}=l,d=t(c,l);if(typeof d!="function"||!c)return;const f=p=>{rC(p)&&(d(p),c.removeEventListener("pointerleave",f))};c.addEventListener("pointerleave",f,s)};return n.forEach(l=>{l.addEventListener("pointerenter",i,s)}),a}const I5=(e,t)=>t?e===t?!0:I5(e,t.parentElement):!1,X2=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,E7=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function j7(e){return E7.has(e.tagName)||e.tabIndex!==-1}const Fy=new WeakSet;function nC(e){return t=>{t.key==="Enter"&&e(t)}}function Zv(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const A7=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=nC(()=>{if(Fy.has(r))return;Zv(r,"down");const s=nC(()=>{Zv(r,"up")}),a=()=>Zv(r,"cancel");r.addEventListener("keyup",s,t),r.addEventListener("blur",a,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function sC(e){return X2(e)&&!R5()}function F7(e,t,r={}){const[n,s,a]=D5(e,r),i=l=>{const c=l.currentTarget;if(!sC(l))return;Fy.add(c);const d=t(c,l),f=(y,v)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",g),Fy.has(c)&&Fy.delete(c),sC(y)&&typeof d=="function"&&d(y,{success:v})},p=y=>{f(y,c===window||c===document||r.useGlobalTarget||I5(c,y.target))},g=y=>{f(y,!1)};window.addEventListener("pointerup",p,s),window.addEventListener("pointercancel",g,s)};return n.forEach(l=>{(r.useGlobalTarget?window:l).addEventListener("pointerdown",i,s),P5(l)&&(l.addEventListener("focus",d=>A7(d,s)),!j7(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),a}function M5(e){return q3(e)&&"ownerSVGElement"in e}function P7(e){return M5(e)&&e.tagName==="svg"}const Ga=e=>!!(e&&e.getVelocity),R7=[...E5,Os,zu],D7=e=>R7.find(N5(e)),Y2=C.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class I7 extends C.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=r.offsetParent,s=P5(n)&&n.offsetWidth||0,a=this.props.sizeRef.current;a.height=r.offsetHeight||0,a.width=r.offsetWidth||0,a.top=r.offsetTop,a.left=r.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function M7({children:e,isPresent:t,anchorX:r,root:n}){const s=C.useId(),a=C.useRef(null),i=C.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=C.useContext(Y2);return C.useInsertionEffect(()=>{const{width:c,height:d,top:f,left:p,right:g}=i.current;if(t||!a.current||!c||!d)return;const y=r==="left"?`left: ${p}`:`right: ${g}`;a.current.dataset.motionPopId=s;const v=document.createElement("style");l&&(v.nonce=l);const w=n??document.head;return w.appendChild(v),v.sheet&&v.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${d}px !important;
            ${y}px !important;
            top: ${f}px !important;
          }
        `),()=>{w.contains(v)&&w.removeChild(v)}},[t]),o.jsx(I7,{isPresent:t,childRef:a,sizeRef:i,children:C.cloneElement(e,{ref:a})})}const O7=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:s,presenceAffectsLayout:a,mode:i,anchorX:l,root:c})=>{const d=N2(L7),f=C.useId();let p=!0,g=C.useMemo(()=>(p=!1,{id:f,initial:t,isPresent:r,custom:s,onExitComplete:y=>{d.set(y,!0);for(const v of d.values())if(!v)return;n&&n()},register:y=>(d.set(y,!1),()=>d.delete(y))}),[r,d,n]);return a&&p&&(g={...g}),C.useMemo(()=>{d.forEach((y,v)=>d.set(v,!1))},[r]),C.useEffect(()=>{!r&&!d.size&&n&&n()},[r]),i==="popLayout"&&(e=o.jsx(M7,{isPresent:r,anchorX:l,root:c,children:e})),o.jsx(P1.Provider,{value:g,children:e})};function L7(){return new Map}function O5(e=!0){const t=C.useContext(P1);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:s}=t,a=C.useId();C.useEffect(()=>{if(e)return s(a)},[e]);const i=C.useCallback(()=>e&&n&&n(a),[a,n,e]);return!r&&n?[!1,i]:[!0]}const ay=e=>e.key||"";function aC(e){const t=[];return C.Children.forEach(e,r=>{C.isValidElement(r)&&t.push(r)}),t}const ji=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:s=!0,mode:a="sync",propagate:i=!1,anchorX:l="left",root:c})=>{const[d,f]=O5(i),p=C.useMemo(()=>aC(e),[e]),g=i&&!d?[]:p.map(ay),y=C.useRef(!0),v=C.useRef(p),w=N2(()=>new Map),[b,E]=C.useState(p),[k,_]=C.useState(p);V3(()=>{y.current=!1,v.current=p;for(let P=0;P<k.length;P++){const R=ay(k[P]);g.includes(R)?w.delete(R):w.get(R)!==!0&&w.set(R,!1)}},[k,g.length,g.join("-")]);const T=[];if(p!==b){let P=[...p];for(let R=0;R<k.length;R++){const N=k[R],A=ay(N);g.includes(A)||(P.splice(R,0,N),T.push(N))}return a==="wait"&&T.length&&(P=T),_(aC(P)),E(p),null}const{forceRender:j}=C.useContext(T2);return o.jsx(o.Fragment,{children:k.map(P=>{const R=ay(P),N=i&&!d?!1:p===k||g.includes(R),A=()=>{if(w.has(R))w.set(R,!0);else return;let M=!0;w.forEach(H=>{H||(M=!1)}),M&&(j?.(),_(v.current),i&&f?.(),n&&n())};return o.jsx(O7,{isPresent:N,initial:!y.current||r?void 0:!1,custom:t,presenceAffectsLayout:s,mode:a,root:c,onExitComplete:N?void 0:A,anchorX:l,children:P},R)})})},L5=C.createContext({strict:!1}),iC={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},c0={};for(const e in iC)c0[e]={isEnabled:t=>iC[e].some(r=>!!t[r])};function B7(e){for(const t in e)c0[t]={...c0[t],...e[t]}}const U7=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Gy(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||U7.has(e)}let B5=e=>!Gy(e);function $7(e){typeof e=="function"&&(B5=t=>t.startsWith("on")?!Gy(t):e(t))}try{$7(require("@emotion/is-prop-valid").default)}catch{}function W7(e,t,r){const n={};for(const s in e)s==="values"&&typeof e.values=="object"||(B5(s)||r===!0&&Gy(s)||!t&&!Gy(s)||e.draggable&&s.startsWith("onDrag"))&&(n[s]=e[s]);return n}const R1=C.createContext({});function D1(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function tp(e){return typeof e=="string"||Array.isArray(e)}const J2=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Q2=["initial",...J2];function I1(e){return D1(e.animate)||Q2.some(t=>tp(e[t]))}function U5(e){return!!(I1(e)||e.variants)}function z7(e,t){if(I1(e)){const{initial:r,animate:n}=e;return{initial:r===!1||tp(r)?r:void 0,animate:tp(n)?n:void 0}}return e.inherit!==!1?t:{}}function H7(e){const{initial:t,animate:r}=z7(e,C.useContext(R1));return C.useMemo(()=>({initial:t,animate:r}),[oC(t),oC(r)])}function oC(e){return Array.isArray(e)?e.join(" "):e}const rp={};function G7(e){for(const t in e)rp[t]=e[t],M2(t)&&(rp[t].isCSSVariable=!0)}function $5(e,{layout:t,layoutId:r}){return S0.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!rp[e]||e==="opacity")}const V7={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},K7=b0.length;function q7(e,t,r){let n="",s=!0;for(let a=0;a<K7;a++){const i=b0[a],l=e[i];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(i.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||r){const d=F5(l,K2[i]);if(!c){s=!1;const f=V7[i]||i;n+=`${f}(${d}) `}r&&(t[i]=d)}}return n=n.trim(),r?n=r(t,s?"":n):s&&(n="none"),n}function Z2(e,t,r){const{style:n,vars:s,transformOrigin:a}=e;let i=!1,l=!1;for(const c in t){const d=t[c];if(S0.has(c)){i=!0;continue}else if(M2(c)){s[c]=d;continue}else{const f=F5(d,K2[c]);c.startsWith("origin")?(l=!0,a[c]=f):n[c]=f}}if(t.transform||(i||r?n.transform=q7(t,e.transform,r):n.transform&&(n.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:f=0}=a;n.transformOrigin=`${c} ${d} ${f}`}}const eb=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function W5(e,t,r){for(const n in t)!Ga(t[n])&&!$5(n,r)&&(e[n]=t[n])}function X7({transformTemplate:e},t){return C.useMemo(()=>{const r=eb();return Z2(r,t,e),Object.assign({},r.vars,r.style)},[t])}function Y7(e,t){const r=e.style||{},n={};return W5(n,r,e),Object.assign(n,X7(e,t)),n}function J7(e,t){const r={},n=Y7(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const Q7={offset:"stroke-dashoffset",array:"stroke-dasharray"},Z7={offset:"strokeDashoffset",array:"strokeDasharray"};function e9(e,t,r=1,n=0,s=!0){e.pathLength=1;const a=s?Q7:Z7;e[a.offset]=Ar.transform(-n);const i=Ar.transform(t),l=Ar.transform(r);e[a.array]=`${i} ${l}`}function z5(e,{attrX:t,attrY:r,attrScale:n,pathLength:s,pathSpacing:a=1,pathOffset:i=0,...l},c,d,f){if(Z2(e,l,d),c){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:g}=e;p.transform&&(g.transform=p.transform,delete p.transform),(g.transform||p.transformOrigin)&&(g.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),g.transform&&(g.transformBox=f?.transformBox??"fill-box",delete p.transformBox),t!==void 0&&(p.x=t),r!==void 0&&(p.y=r),n!==void 0&&(p.scale=n),s!==void 0&&e9(p,s,a,i,!1)}const H5=()=>({...eb(),attrs:{}}),G5=e=>typeof e=="string"&&e.toLowerCase()==="svg";function t9(e,t,r,n){const s=C.useMemo(()=>{const a=H5();return z5(a,t,G5(n),e.transformTemplate,e.style),{...a.attrs,style:{...a.style}}},[t]);if(e.style){const a={};W5(a,e.style,e),s.style={...a,...s.style}}return s}const r9=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function tb(e){return typeof e!="string"||e.includes("-")?!1:!!(r9.indexOf(e)>-1||/[A-Z]/u.test(e))}function n9(e,t,r,{latestValues:n},s,a=!1){const l=(tb(e)?t9:J7)(t,n,s,e),c=W7(t,typeof e=="string",a),d=e!==C.Fragment?{...c,...l,ref:r}:{},{children:f}=t,p=C.useMemo(()=>Ga(f)?f.get():f,[f]);return C.createElement(e,{...d,children:p})}function lC(e){const t=[{},{}];return e?.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function rb(e,t,r,n){if(typeof t=="function"){const[s,a]=lC(n);t=t(r!==void 0?r:e.custom,s,a)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[s,a]=lC(n);t=t(r!==void 0?r:e.custom,s,a)}return t}function Py(e){return Ga(e)?e.get():e}function s9({scrapeMotionValuesFromProps:e,createRenderState:t},r,n,s){return{latestValues:a9(r,n,s,e),renderState:t()}}function a9(e,t,r,n){const s={},a=n(e,{});for(const g in a)s[g]=Py(a[g]);let{initial:i,animate:l}=e;const c=I1(e),d=U5(e);t&&d&&!c&&e.inherit!==!1&&(i===void 0&&(i=t.initial),l===void 0&&(l=t.animate));let f=r?r.initial===!1:!1;f=f||i===!1;const p=f?l:i;if(p&&typeof p!="boolean"&&!D1(p)){const g=Array.isArray(p)?p:[p];for(let y=0;y<g.length;y++){const v=rb(e,g[y]);if(v){const{transitionEnd:w,transition:b,...E}=v;for(const k in E){let _=E[k];if(Array.isArray(_)){const T=f?_.length-1:0;_=_[T]}_!==null&&(s[k]=_)}for(const k in w)s[k]=w[k]}}}return s}const V5=e=>(t,r)=>{const n=C.useContext(R1),s=C.useContext(P1),a=()=>s9(e,t,n,s);return r?a():N2(a)};function nb(e,t,r){const{style:n}=e,s={};for(const a in n)(Ga(n[a])||t.style&&Ga(t.style[a])||$5(a,e)||r?.getValue(a)?.liveStyle!==void 0)&&(s[a]=n[a]);return s}const i9=V5({scrapeMotionValuesFromProps:nb,createRenderState:eb});function K5(e,t,r){const n=nb(e,t,r);for(const s in e)if(Ga(e[s])||Ga(t[s])){const a=b0.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;n[a]=e[s]}return n}const o9=V5({scrapeMotionValuesFromProps:K5,createRenderState:H5}),l9=Symbol.for("motionComponentSymbol");function Wh(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function c9(e,t,r){return C.useCallback(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):Wh(r)&&(r.current=n))},[t])}const sb=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),u9="framerAppearId",q5="data-"+sb(u9),X5=C.createContext({});function d9(e,t,r,n,s){const{visualElement:a}=C.useContext(R1),i=C.useContext(L5),l=C.useContext(P1),c=C.useContext(Y2).reducedMotion,d=C.useRef(null);n=n||i.renderer,!d.current&&n&&(d.current=n(e,{visualState:t,parent:a,props:r,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const f=d.current,p=C.useContext(X5);f&&!f.projection&&s&&(f.type==="html"||f.type==="svg")&&f9(d.current,r,s,p);const g=C.useRef(!1);C.useInsertionEffect(()=>{f&&g.current&&f.update(r,l)});const y=r[q5],v=C.useRef(!!y&&!window.MotionHandoffIsComplete?.(y)&&window.MotionHasOptimisedAnimation?.(y));return V3(()=>{f&&(g.current=!0,window.MotionIsMounted=!0,f.updateFeatures(),f.scheduleRenderMicrotask(),v.current&&f.animationState&&f.animationState.animateChanges())}),C.useEffect(()=>{f&&(!v.current&&f.animationState&&f.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(y)}),v.current=!1),f.enteringChildren=void 0)}),f}function f9(e,t,r,n){const{layoutId:s,layout:a,drag:i,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:f}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:Y5(e.parent)),e.projection.setOptions({layoutId:s,layout:a,alwaysMeasureLayout:!!i||l&&Wh(l),visualElement:e,animationType:typeof a=="string"?a:"both",initialPromotionConfig:n,crossfade:f,layoutScroll:c,layoutRoot:d})}function Y5(e){if(e)return e.options.allowProjection!==!1?e.projection:Y5(e.parent)}function ew(e,{forwardMotionProps:t=!1}={},r,n){r&&B7(r);const s=tb(e)?o9:i9;function a(l,c){let d;const f={...C.useContext(Y2),...l,layoutId:h9(l)},{isStatic:p}=f,g=H7(l),y=s(l,p);if(!p&&E2){g9();const v=m9(f);d=v.MeasureLayout,g.visualElement=d9(e,y,f,n,v.ProjectionNode)}return o.jsxs(R1.Provider,{value:g,children:[d&&g.visualElement?o.jsx(d,{visualElement:g.visualElement,...f}):null,n9(e,l,c9(y,g.visualElement,c),y,p,t)]})}a.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const i=C.forwardRef(a);return i[l9]=e,i}function h9({layoutId:e}){const t=C.useContext(T2).id;return t&&e!==void 0?t+"-"+e:e}function g9(e,t){C.useContext(L5).strict}function m9(e){const{drag:t,layout:r}=c0;if(!t&&!r)return{};const n={...t,...r};return{MeasureLayout:t?.isEnabled(e)||r?.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function p9(e,t){if(typeof Proxy>"u")return ew;const r=new Map,n=(a,i)=>ew(a,i,e,t),s=(a,i)=>n(a,i);return new Proxy(s,{get:(a,i)=>i==="create"?n:(r.has(i)||r.set(i,ew(i,void 0,e,t)),r.get(i))})}function J5({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function x9({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function y9(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function tw(e){return e===void 0||e===1}function y_({scale:e,scaleX:t,scaleY:r}){return!tw(e)||!tw(t)||!tw(r)}function Ud(e){return y_(e)||Q5(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Q5(e){return cC(e.x)||cC(e.y)}function cC(e){return e&&e!=="0%"}function Vy(e,t,r){const n=e-r,s=t*n;return r+s}function uC(e,t,r,n,s){return s!==void 0&&(e=Vy(e,s,n)),Vy(e,r,n)+t}function v_(e,t=0,r=1,n,s){e.min=uC(e.min,t,r,n,s),e.max=uC(e.max,t,r,n,s)}function Z5(e,{x:t,y:r}){v_(e.x,t.translate,t.scale,t.originPoint),v_(e.y,r.translate,r.scale,r.originPoint)}const dC=.999999999999,fC=1.0000000000001;function v9(e,t,r,n=!1){const s=r.length;if(!s)return;t.x=t.y=1;let a,i;for(let l=0;l<s;l++){a=r[l],i=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(n&&a.options.layoutScroll&&a.scroll&&a!==a.root&&Hh(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,Z5(e,i)),n&&Ud(a.latestValues)&&Hh(e,a.latestValues))}t.x<fC&&t.x>dC&&(t.x=1),t.y<fC&&t.y>dC&&(t.y=1)}function zh(e,t){e.min=e.min+t,e.max=e.max+t}function hC(e,t,r,n,s=.5){const a=Zn(e.min,e.max,s);v_(e,t,r,a,n)}function Hh(e,t){hC(e.x,t.x,t.scaleX,t.scale,t.originX),hC(e.y,t.y,t.scaleY,t.scale,t.originY)}function e6(e,t){return J5(y9(e.getBoundingClientRect(),t))}function w9(e,t,r){const n=e6(e,r),{scroll:s}=t;return s&&(zh(n.x,s.offset.x),zh(n.y,s.offset.y)),n}const gC=()=>({translate:0,scale:1,origin:0,originPoint:0}),Gh=()=>({x:gC(),y:gC()}),mC=()=>({min:0,max:0}),Cs=()=>({x:mC(),y:mC()}),w_={current:null},t6={current:!1};function _9(){if(t6.current=!0,!!E2)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>w_.current=e.matches;e.addEventListener("change",t),t()}else w_.current=!1}const b9=new WeakMap;function S9(e,t,r){for(const n in t){const s=t[n],a=r[n];if(Ga(s))e.addValue(n,s);else if(Ga(a))e.addValue(n,l0(s,{owner:e}));else if(a!==s)if(e.hasValue(n)){const i=e.getValue(n);i.liveStyle===!0?i.jump(s):i.hasAnimated||i.set(s)}else{const i=e.getStaticValue(n);e.addValue(n,l0(i!==void 0?i:s,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const pC=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class k9{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:s,blockInitialAnimation:a,visualState:i},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=G2,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=Ai.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,Kn.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=i;this.latestValues=c,this.baseTarget={...c},this.initialValues=r.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=s,this.options=l,this.blockInitialAnimation=!!a,this.isControllingVariants=I1(r),this.isVariantNode=U5(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:f,...p}=this.scrapeMotionValuesFromProps(r,{},this);for(const g in p){const y=p[g];c[g]!==void 0&&Ga(y)&&y.set(c[g])}}mount(t){this.current=t,b9.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),t6.current||_9(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:w_.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Wu(this.notifyUpdate),Wu(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=S0.has(t);n&&this.onBindTransform&&this.onBindTransform();const s=r.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&Kn.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{s(),a&&a(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in c0){const r=c0[t];if(!r)continue;const{isEnabled:n,Feature:s}=r;if(!this.features[t]&&s&&n(this.props)&&(this.features[t]=new s(this)),this.features[t]){const a=this.features[t];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Cs()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<pC.length;n++){const s=pC[n];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const a="on"+s,i=t[a];i&&(this.propEventSubscriptions[s]=this.on(s,i))}this.prevMotionValues=S9(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=l0(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(K3(n)||X3(n))?n=parseFloat(n):!D7(n)&&zu.test(r)&&(n=A5(t,r)),this.setBaseTarget(t,Ga(n)?n.get():n)),Ga(n)?n.get():n}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const a=rb(this.props,r,this.presenceContext?.custom);a&&(n=a[t])}if(r&&n!==void 0)return n;const s=this.getBaseTargetFromProps(this.props,t);return s!==void 0&&!Ga(s)?s:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new R2),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}scheduleRenderMicrotask(){q2.render(this.render)}}class r6 extends k9{constructor(){super(...arguments),this.KeyframeResolver=b7}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Ga(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function n6(e,{style:t,vars:r},n,s){const a=e.style;let i;for(i in t)a[i]=t[i];s?.applyProjectionStyles(a,n);for(i in r)a.setProperty(i,r[i])}function C9(e){return window.getComputedStyle(e)}class T9 extends r6{constructor(){super(...arguments),this.type="html",this.renderInstance=n6}readValueFromInstance(t,r){if(S0.has(r))return this.projection?.isProjecting?d_(r):$D(t,r);{const n=C9(t),s=(M2(r)?n.getPropertyValue(r):n[r])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(t,{transformPagePoint:r}){return e6(t,r)}build(t,r,n){Z2(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return nb(t,r,n)}}const s6=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function N9(e,t,r,n){n6(e,t,void 0,n);for(const s in t.attrs)e.setAttribute(s6.has(s)?s:sb(s),t.attrs[s])}class E9 extends r6{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Cs}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(S0.has(r)){const n=j5(r);return n&&n.default||0}return r=s6.has(r)?r:sb(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return K5(t,r,n)}build(t,r,n){z5(t,r,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,r,n,s){N9(t,r,n,s)}mount(t){this.isSVGTag=G5(t.tagName),super.mount(t)}}const j9=(e,t)=>tb(e)?new E9(t):new T9(t,{allowProjection:e!==C.Fragment});function Yh(e,t,r){const n=e.getProps();return rb(n,t,r!==void 0?r:n.custom,e)}const __=e=>Array.isArray(e);function A9(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,l0(r))}function F9(e){return __(e)?e[e.length-1]||0:e}function P9(e,t){const r=Yh(e,t);let{transitionEnd:n={},transition:s={},...a}=r||{};a={...a,...n};for(const i in a){const l=F9(a[i]);A9(e,i,l)}}function R9(e){return!!(Ga(e)&&e.add)}function b_(e,t){const r=e.getValue("willChange");if(R9(r))return r.add(t);if(!r&&Pc.WillChange){const n=new Pc.WillChange("auto");e.addValue("willChange",n),n.add(t)}}function a6(e){return e.props[q5]}const D9=e=>e!==null;function I9(e,{repeat:t,repeatType:r="loop"},n){const s=e.filter(D9),a=t&&r!=="loop"&&t%2===1?0:s.length-1;return s[a]}const M9={type:"spring",stiffness:500,damping:25,restSpeed:10},O9=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),L9={type:"keyframes",duration:.8},B9={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},U9=(e,{keyframes:t})=>t.length>2?L9:S0.has(e)?e.startsWith("scale")?O9(t[1]):M9:B9;function $9({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:s,repeat:a,repeatType:i,repeatDelay:l,from:c,elapsed:d,...f}){return!!Object.keys(f).length}const ab=(e,t,r,n={},s,a)=>i=>{const l=V2(n,e)||{},c=l.delay||n.delay||0;let{elapsed:d=0}=n;d=d-Ml(c);const f={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:g=>{t.set(g),l.onUpdate&&l.onUpdate(g)},onComplete:()=>{i(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:a?void 0:s};$9(l)||Object.assign(f,U9(e,f)),f.duration&&(f.duration=Ml(f.duration)),f.repeatDelay&&(f.repeatDelay=Ml(f.repeatDelay)),f.from!==void 0&&(f.keyframes[0]=f.from);let p=!1;if((f.type===!1||f.duration===0&&!f.repeatDelay)&&(p_(f),f.delay===0&&(p=!0)),(Pc.instantAnimations||Pc.skipAnimations)&&(p=!0,p_(f),f.delay=0),f.allowFlatten=!l.type&&!l.ease,p&&!a&&t.get()!==void 0){const g=I9(f.keyframes,l);if(g!==void 0){Kn.update(()=>{f.onUpdate(g),f.onComplete()});return}}return l.isSync?new H2(f):new u7(f)};function W9({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function i6(e,t,{delay:r=0,transitionOverride:n,type:s}={}){let{transition:a=e.getDefaultTransition(),transitionEnd:i,...l}=t;n&&(a=n);const c=[],d=s&&e.animationState&&e.animationState.getState()[s];for(const f in l){const p=e.getValue(f,e.latestValues[f]??null),g=l[f];if(g===void 0||d&&W9(d,f))continue;const y={delay:r,...V2(a||{},f)},v=p.get();if(v!==void 0&&!p.isAnimating&&!Array.isArray(g)&&g===v&&!y.velocity)continue;let w=!1;if(window.MotionHandoffAnimation){const E=a6(e);if(E){const k=window.MotionHandoffAnimation(E,f,Kn);k!==null&&(y.startTime=k,w=!0)}}b_(e,f),p.start(ab(f,p,g,e.shouldReduceMotion&&T5.has(f)?{type:!1}:y,e,w));const b=p.animation;b&&c.push(b)}return i&&Promise.all(c).then(()=>{Kn.update(()=>{i&&P9(e,i)})}),c}function o6(e,t,r,n=0,s=1){const a=Array.from(e).sort((d,f)=>d.sortNodePosition(f)).indexOf(t),i=e.size,l=(i-1)*n;return typeof r=="function"?r(a,i):s===1?a*n:l-a*n}function S_(e,t,r={}){const n=Yh(e,t,r.type==="exit"?e.presenceContext?.custom:void 0);let{transition:s=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(s=r.transitionOverride);const a=n?()=>Promise.all(i6(e,n,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:p}=s;return z9(e,t,c,d,f,p,r)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,d]=l==="beforeChildren"?[a,i]:[i,a];return c().then(()=>d())}else return Promise.all([a(),i(r.delay)])}function z9(e,t,r=0,n=0,s=0,a=1,i){const l=[];for(const c of e.variantChildren)c.notify("AnimationStart",t),l.push(S_(c,t,{...i,delay:r+(typeof n=="function"?0:n)+o6(e.variantChildren,c,n,s,a)}).then(()=>c.notify("AnimationComplete",t)));return Promise.all(l)}function H9(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const s=t.map(a=>S_(e,a,r));n=Promise.all(s)}else if(typeof t=="string")n=S_(e,t,r);else{const s=typeof t=="function"?Yh(e,t,r.custom):t;n=Promise.all(i6(e,s,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}function l6(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}const G9=Q2.length;function c6(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?c6(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<G9;r++){const n=Q2[r],s=e.props[n];(tp(s)||s===!1)&&(t[n]=s)}return t}const V9=[...J2].reverse(),K9=J2.length;function q9(e){return t=>Promise.all(t.map(({animation:r,options:n})=>H9(e,r,n)))}function X9(e){let t=q9(e),r=xC(),n=!0;const s=c=>(d,f)=>{const p=Yh(e,f,c==="exit"?e.presenceContext?.custom:void 0);if(p){const{transition:g,transitionEnd:y,...v}=p;d={...d,...v,...y}}return d};function a(c){t=c(e)}function i(c){const{props:d}=e,f=c6(e.parent)||{},p=[],g=new Set;let y={},v=1/0;for(let b=0;b<K9;b++){const E=V9[b],k=r[E],_=d[E]!==void 0?d[E]:f[E],T=tp(_),j=E===c?k.isActive:null;j===!1&&(v=b);let P=_===f[E]&&_!==d[E]&&T;if(P&&n&&e.manuallyAnimateOnMount&&(P=!1),k.protectedKeys={...y},!k.isActive&&j===null||!_&&!k.prevProp||D1(_)||typeof _=="boolean")continue;const R=Y9(k.prevProp,_);let N=R||E===c&&k.isActive&&!P&&T||b>v&&T,A=!1;const M=Array.isArray(_)?_:[_];let H=M.reduce(s(E),{});j===!1&&(H={});const{prevResolvedValues:Q={}}=k,Z={...Q,...H},ae=L=>{N=!0,g.has(L)&&(A=!0,g.delete(L)),k.needsAnimating[L]=!0;const G=e.getValue(L);G&&(G.liveStyle=!1)};for(const L in Z){const G=H[L],I=Q[L];if(y.hasOwnProperty(L))continue;let z=!1;__(G)&&__(I)?z=!l6(G,I):z=G!==I,z?G!=null?ae(L):g.add(L):G!==void 0&&g.has(L)?ae(L):k.protectedKeys[L]=!0}k.prevProp=_,k.prevResolvedValues=H,k.isActive&&(y={...y,...H}),n&&e.blockInitialAnimation&&(N=!1);const te=P&&R;N&&(!te||A)&&p.push(...M.map(L=>{const G={type:E};if(typeof L=="string"&&n&&!te&&e.manuallyAnimateOnMount&&e.parent){const{parent:I}=e,z=Yh(I,L);if(I.enteringChildren&&z){const{delayChildren:V}=z.transition||{};G.delay=o6(I.enteringChildren,e,V)}}return{animation:L,options:G}}))}if(g.size){const b={};if(typeof d.initial!="boolean"){const E=Yh(e,Array.isArray(d.initial)?d.initial[0]:d.initial);E&&E.transition&&(b.transition=E.transition)}g.forEach(E=>{const k=e.getBaseTarget(E),_=e.getValue(E);_&&(_.liveStyle=!0),b[E]=k??null}),p.push({animation:b})}let w=!!p.length;return n&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(w=!1),n=!1,w?t(p):Promise.resolve()}function l(c,d){if(r[c].isActive===d)return Promise.resolve();e.variantChildren?.forEach(p=>p.animationState?.setActive(c,d)),r[c].isActive=d;const f=i(c);for(const p in r)r[p].protectedKeys={};return f}return{animateChanges:i,setActive:l,setAnimateFunction:a,getState:()=>r,reset:()=>{r=xC(),n=!0}}}function Y9(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!l6(t,e):!1}function Md(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function xC(){return{animate:Md(!0),whileInView:Md(),whileHover:Md(),whileTap:Md(),whileDrag:Md(),whileFocus:Md(),exit:Md()}}class Qu{constructor(t){this.isMounted=!1,this.node=t}update(){}}class J9 extends Qu{constructor(t){super(t),t.animationState||(t.animationState=X9(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();D1(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Q9=0;class Z9 extends Qu{constructor(){super(...arguments),this.id=Q9++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const s=this.node.animationState.setActive("exit",!t);r&&!t&&s.then(()=>{r(this.id)})}mount(){const{register:t,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const eI={animation:{Feature:J9},exit:{Feature:Z9}};function np(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function Dp(e){return{point:{x:e.pageX,y:e.pageY}}}const tI=e=>t=>X2(t)&&e(t,Dp(t));function Dm(e,t,r,n){return np(e,t,tI(r),n)}const u6=1e-4,rI=1-u6,nI=1+u6,d6=.01,sI=0-d6,aI=0+d6;function gi(e){return e.max-e.min}function iI(e,t,r){return Math.abs(e-t)<=r}function yC(e,t,r,n=.5){e.origin=n,e.originPoint=Zn(t.min,t.max,e.origin),e.scale=gi(r)/gi(t),e.translate=Zn(r.min,r.max,e.origin)-e.originPoint,(e.scale>=rI&&e.scale<=nI||isNaN(e.scale))&&(e.scale=1),(e.translate>=sI&&e.translate<=aI||isNaN(e.translate))&&(e.translate=0)}function Im(e,t,r,n){yC(e.x,t.x,r.x,n?n.originX:void 0),yC(e.y,t.y,r.y,n?n.originY:void 0)}function vC(e,t,r){e.min=r.min+t.min,e.max=e.min+gi(t)}function oI(e,t,r){vC(e.x,t.x,r.x),vC(e.y,t.y,r.y)}function wC(e,t,r){e.min=t.min-r.min,e.max=e.min+gi(t)}function Mm(e,t,r){wC(e.x,t.x,r.x),wC(e.y,t.y,r.y)}function yo(e){return[e("x"),e("y")]}const f6=({current:e})=>e?e.ownerDocument.defaultView:null,_C=(e,t)=>Math.abs(e-t);function lI(e,t){const r=_C(e.x,t.x),n=_C(e.y,t.y);return Math.sqrt(r**2+n**2)}class h6{constructor(t,r,{transformPagePoint:n,contextWindow:s=window,dragSnapToOrigin:a=!1,distanceThreshold:i=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=nw(this.lastMoveEventInfo,this.history),y=this.startEvent!==null,v=lI(g.offset,{x:0,y:0})>=this.distanceThreshold;if(!y&&!v)return;const{point:w}=g,{timestamp:b}=Ca;this.history.push({...w,timestamp:b});const{onStart:E,onMove:k}=this.handlers;y||(E&&E(this.lastMoveEvent,g),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,g)},this.handlePointerMove=(g,y)=>{this.lastMoveEvent=g,this.lastMoveEventInfo=rw(y,this.transformPagePoint),Kn.update(this.updatePoint,!0)},this.handlePointerUp=(g,y)=>{this.end();const{onEnd:v,onSessionEnd:w,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const E=nw(g.type==="pointercancel"?this.lastMoveEventInfo:rw(y,this.transformPagePoint),this.history);this.startEvent&&v&&v(g,E),w&&w(g,E)},!X2(t))return;this.dragSnapToOrigin=a,this.handlers=r,this.transformPagePoint=n,this.distanceThreshold=i,this.contextWindow=s||window;const l=Dp(t),c=rw(l,this.transformPagePoint),{point:d}=c,{timestamp:f}=Ca;this.history=[{...d,timestamp:f}];const{onSessionStart:p}=r;p&&p(t,nw(c,this.history)),this.removeListeners=Fp(Dm(this.contextWindow,"pointermove",this.handlePointerMove),Dm(this.contextWindow,"pointerup",this.handlePointerUp),Dm(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Wu(this.updatePoint)}}function rw(e,t){return t?{point:t(e.point)}:e}function bC(e,t){return{x:e.x-t.x,y:e.y-t.y}}function nw({point:e},t){return{point:e,delta:bC(e,g6(t)),offset:bC(e,cI(t)),velocity:uI(t,.1)}}function cI(e){return e[0]}function g6(e){return e[e.length-1]}function uI(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const s=g6(e);for(;r>=0&&(n=e[r],!(s.timestamp-n.timestamp>Ml(t)));)r--;if(!n)return{x:0,y:0};const a=Ol(s.timestamp-n.timestamp);if(a===0)return{x:0,y:0};const i={x:(s.x-n.x)/a,y:(s.y-n.y)/a};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function dI(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?Zn(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?Zn(r,e,n.max):Math.min(e,r)),e}function SC(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function fI(e,{top:t,left:r,bottom:n,right:s}){return{x:SC(e.x,r,s),y:SC(e.y,t,n)}}function kC(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function hI(e,t){return{x:kC(e.x,t.x),y:kC(e.y,t.y)}}function gI(e,t){let r=.5;const n=gi(e),s=gi(t);return s>n?r=Qm(t.min,t.max-n,e.min):n>s&&(r=Qm(e.min,e.max-s,t.min)),Fc(0,1,r)}function mI(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const k_=.35;function pI(e=k_){return e===!1?e=0:e===!0&&(e=k_),{x:CC(e,"left","right"),y:CC(e,"top","bottom")}}function CC(e,t,r){return{min:TC(e,t),max:TC(e,r)}}function TC(e,t){return typeof e=="number"?e:e[t]||0}const xI=new WeakMap;class yI{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Cs(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:r=!1,distanceThreshold:n}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const a=p=>{const{dragSnapToOrigin:g}=this.getProps();g?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Dp(p).point)},i=(p,g)=>{const{drag:y,dragPropagation:v,onDragStart:w}=this.getProps();if(y&&!v&&(this.openDragLock&&this.openDragLock(),this.openDragLock=T7(y),!this.openDragLock))return;this.latestPointerEvent=p,this.latestPanInfo=g,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),yo(E=>{let k=this.getAxisMotionValue(E).get()||0;if(Ll.test(k)){const{projection:_}=this.visualElement;if(_&&_.layout){const T=_.layout.layoutBox[E];T&&(k=gi(T)*(parseFloat(k)/100))}}this.originPoint[E]=k}),w&&Kn.postRender(()=>w(p,g)),b_(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},l=(p,g)=>{this.latestPointerEvent=p,this.latestPanInfo=g;const{dragPropagation:y,dragDirectionLock:v,onDirectionLock:w,onDrag:b}=this.getProps();if(!y&&!this.openDragLock)return;const{offset:E}=g;if(v&&this.currentDirection===null){this.currentDirection=vI(E),this.currentDirection!==null&&w&&w(this.currentDirection);return}this.updateAxis("x",g.point,E),this.updateAxis("y",g.point,E),this.visualElement.render(),b&&b(p,g)},c=(p,g)=>{this.latestPointerEvent=p,this.latestPanInfo=g,this.stop(p,g),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>yo(p=>this.getAnimationState(p)==="paused"&&this.getAxisMotionValue(p).animation?.play()),{dragSnapToOrigin:f}=this.getProps();this.panSession=new h6(t,{onSessionStart:a,onStart:i,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:f,distanceThreshold:n,contextWindow:f6(this.visualElement)})}stop(t,r){const n=t||this.latestPointerEvent,s=r||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!s||!n)return;const{velocity:i}=s;this.startAnimation(i);const{onDragEnd:l}=this.getProps();l&&Kn.postRender(()=>l(n,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:s}=this.getProps();if(!n||!iy(t,s,this.currentDirection))return;const a=this.getAxisMotionValue(t);let i=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(i=dI(i,this.constraints[t],this.elastic[t])),a.set(i)}resolveConstraints(){const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,s=this.constraints;t&&Wh(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=fI(n.layoutBox,t):this.constraints=!1,this.elastic=pI(r),s!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&yo(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=mI(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Wh(t))return!1;const n=t.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const a=w9(n,s.root,this.visualElement.getTransformPagePoint());let i=hI(s.layout.layoutBox,a);if(r){const l=r(x9(i));this.hasMutatedConstraints=!!l,l&&(i=J5(l))}return i}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:s,dragTransition:a,dragSnapToOrigin:i,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=yo(f=>{if(!iy(f,r,this.currentDirection))return;let p=c&&c[f]||{};i&&(p={min:0,max:0});const g=s?200:1e6,y=s?40:1e7,v={type:"inertia",velocity:n?t[f]:0,bounceStiffness:g,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...a,...p};return this.startAxisValueAnimation(f,v)});return Promise.all(d).then(l)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return b_(this.visualElement,t),n.start(ab(t,n,0,r,this.visualElement,!1))}stopAnimation(){yo(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){yo(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),s=n[r];return s||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){yo(r=>{const{drag:n}=this.getProps();if(!iy(r,n,this.currentDirection))return;const{projection:s}=this.visualElement,a=this.getAxisMotionValue(r);if(s&&s.layout){const{min:i,max:l}=s.layout.layoutBox[r];a.set(t[r]-Zn(i,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!Wh(r)||!n||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};yo(i=>{const l=this.getAxisMotionValue(i);if(l&&this.constraints!==!1){const c=l.get();s[i]=gI({min:c,max:c},this.constraints[i])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),yo(i=>{if(!iy(i,t,null))return;const l=this.getAxisMotionValue(i),{min:c,max:d}=this.constraints[i];l.set(Zn(c,d,s[i]))})}addListeners(){if(!this.visualElement.current)return;xI.set(this.visualElement,this);const t=this.visualElement.current,r=Dm(t,"pointerdown",c=>{const{drag:d,dragListener:f=!0}=this.getProps();d&&f&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();Wh(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,a=s.addEventListener("measure",n);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Kn.read(n);const i=np(window,"resize",()=>this.scalePositionWithinConstraints()),l=s.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(yo(f=>{const p=this.getAxisMotionValue(f);p&&(this.originPoint[f]+=c[f].translate,p.set(p.get()+c[f].translate))}),this.visualElement.render())}));return()=>{i(),r(),a(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:s=!1,dragConstraints:a=!1,dragElastic:i=k_,dragMomentum:l=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:s,dragConstraints:a,dragElastic:i,dragMomentum:l}}}function iy(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function vI(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class wI extends Qu{constructor(t){super(t),this.removeGroupControls=So,this.removeListeners=So,this.controls=new yI(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||So}unmount(){this.removeGroupControls(),this.removeListeners()}}const NC=e=>(t,r)=>{e&&Kn.postRender(()=>e(t,r))};class _I extends Qu{constructor(){super(...arguments),this.removePointerDownListener=So}onPointerDown(t){this.session=new h6(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:f6(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:s}=this.node.getProps();return{onSessionStart:NC(t),onStart:NC(r),onMove:n,onEnd:(a,i)=>{delete this.session,s&&Kn.postRender(()=>s(a,i))}}}mount(){this.removePointerDownListener=Dm(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Ry={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function EC(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Ag={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Ar.test(e))e=parseFloat(e);else return e;const r=EC(e,t.target.x),n=EC(e,t.target.y);return`${r}% ${n}%`}},bI={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,s=zu.parse(e);if(s.length>5)return n;const a=zu.createTransformer(e),i=typeof s[0]!="number"?1:0,l=r.x.scale*t.x,c=r.y.scale*t.y;s[0+i]/=l,s[1+i]/=c;const d=Zn(l,c,.5);return typeof s[2+i]=="number"&&(s[2+i]/=d),typeof s[3+i]=="number"&&(s[3+i]/=d),a(s)}};let sw=!1;class SI extends C.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:s}=this.props,{projection:a}=t;G7(kI),a&&(r.group&&r.group.add(a),n&&n.register&&s&&n.register(a),sw&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),Ry.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:s,isPresent:a}=this.props,{projection:i}=n;return i&&(i.isPresent=a,sw=!0,s||t.layoutDependency!==r||r===void 0||t.isPresent!==a?i.willUpdate():this.safeToRemove(),t.isPresent!==a&&(a?i.promote():i.relegate()||Kn.postRender(()=>{const l=i.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),q2.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:s}=t;sw=!0,s&&(s.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(s),n&&n.deregister&&n.deregister(s))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function m6(e){const[t,r]=O5(),n=C.useContext(T2);return o.jsx(SI,{...e,layoutGroup:n,switchLayoutGroup:C.useContext(X5),isPresent:t,safeToRemove:r})}const kI={borderRadius:{...Ag,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ag,borderTopRightRadius:Ag,borderBottomLeftRadius:Ag,borderBottomRightRadius:Ag,boxShadow:bI};function CI(e,t,r){const n=Ga(e)?e:l0(e);return n.start(ab("",n,t,r)),n.animation}const TI=(e,t)=>e.depth-t.depth;class NI{constructor(){this.children=[],this.isDirty=!1}add(t){j2(this.children,t),this.isDirty=!0}remove(t){A2(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(TI),this.isDirty=!1,this.children.forEach(t)}}function EI(e,t){const r=Ai.now(),n=({timestamp:s})=>{const a=s-r;a>=t&&(Wu(n),e(a-t))};return Kn.setup(n,!0),()=>Wu(n)}const p6=["TopLeft","TopRight","BottomLeft","BottomRight"],jI=p6.length,jC=e=>typeof e=="string"?parseFloat(e):e,AC=e=>typeof e=="number"||Ar.test(e);function AI(e,t,r,n,s,a){s?(e.opacity=Zn(0,r.opacity??1,FI(n)),e.opacityExit=Zn(t.opacity??1,0,PI(n))):a&&(e.opacity=Zn(t.opacity??1,r.opacity??1,n));for(let i=0;i<jI;i++){const l=`border${p6[i]}Radius`;let c=FC(t,l),d=FC(r,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||AC(c)===AC(d)?(e[l]=Math.max(Zn(jC(c),jC(d),n),0),(Ll.test(d)||Ll.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||r.rotate)&&(e.rotate=Zn(t.rotate||0,r.rotate||0,n))}function FC(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const FI=x6(0,.5,n5),PI=x6(.5,.95,So);function x6(e,t,r){return n=>n<e?0:n>t?1:r(Qm(e,t,n))}function PC(e,t){e.min=t.min,e.max=t.max}function fo(e,t){PC(e.x,t.x),PC(e.y,t.y)}function RC(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function DC(e,t,r,n,s){return e-=t,e=Vy(e,1/r,n),s!==void 0&&(e=Vy(e,1/s,n)),e}function RI(e,t=0,r=1,n=.5,s,a=e,i=e){if(Ll.test(t)&&(t=parseFloat(t),t=Zn(i.min,i.max,t/100)-i.min),typeof t!="number")return;let l=Zn(a.min,a.max,n);e===a&&(l-=t),e.min=DC(e.min,t,r,l,s),e.max=DC(e.max,t,r,l,s)}function IC(e,t,[r,n,s],a,i){RI(e,t[r],t[n],t[s],t.scale,a,i)}const DI=["x","scaleX","originX"],II=["y","scaleY","originY"];function MC(e,t,r,n){IC(e.x,t,DI,r?r.x:void 0,n?n.x:void 0),IC(e.y,t,II,r?r.y:void 0,n?n.y:void 0)}function OC(e){return e.translate===0&&e.scale===1}function y6(e){return OC(e.x)&&OC(e.y)}function LC(e,t){return e.min===t.min&&e.max===t.max}function MI(e,t){return LC(e.x,t.x)&&LC(e.y,t.y)}function BC(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function v6(e,t){return BC(e.x,t.x)&&BC(e.y,t.y)}function UC(e){return gi(e.x)/gi(e.y)}function $C(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class OI{constructor(){this.members=[]}add(t){j2(this.members,t),t.scheduleRender()}remove(t){if(A2(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(s=>t===s);if(r===0)return!1;let n;for(let s=r;s>=0;s--){const a=this.members[s];if(a.isPresent!==!1){n=a;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:s}=t.options;s===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function LI(e,t,r){let n="";const s=e.x.translate/t.x,a=e.y.translate/t.y,i=r?.z||0;if((s||a||i)&&(n=`translate3d(${s}px, ${a}px, ${i}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:d,rotate:f,rotateX:p,rotateY:g,skewX:y,skewY:v}=r;d&&(n=`perspective(${d}px) ${n}`),f&&(n+=`rotate(${f}deg) `),p&&(n+=`rotateX(${p}deg) `),g&&(n+=`rotateY(${g}deg) `),y&&(n+=`skewX(${y}deg) `),v&&(n+=`skewY(${v}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(n+=`scale(${l}, ${c})`),n||"none"}const aw=["","X","Y","Z"],BI=1e3;let UI=0;function iw(e,t,r,n){const{latestValues:s}=t;s[e]&&(r[e]=s[e],t.setStaticValue(e,0),n&&(n[e]=0))}function w6(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=a6(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:s,layoutId:a}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Kn,!(s||a))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&w6(n)}function _6({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:s}){return class{constructor(i={},l=t?.()){this.id=UI++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(zI),this.nodes.forEach(KI),this.nodes.forEach(qI),this.nodes.forEach(HI)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new NI)}addEventListener(i,l){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new R2),this.eventHandlers.get(i).add(l)}notifyListeners(i,...l){const c=this.eventHandlers.get(i);c&&c.notify(...l)}hasListeners(i){return this.eventHandlers.has(i)}mount(i){if(this.instance)return;this.isSVG=M5(i)&&!P7(i),this.instance=i;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),e){let f,p=0;const g=()=>this.root.updateBlockedByResize=!1;Kn.read(()=>{p=window.innerWidth}),e(i,()=>{const y=window.innerWidth;y!==p&&(p=y,this.root.updateBlockedByResize=!0,f&&f(),f=EI(g,250),Ry.hasAnimatedSinceResize&&(Ry.hasAnimatedSinceResize=!1,this.nodes.forEach(HC)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:p,hasRelativeLayoutChanged:g,layout:y})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||d.getDefaultTransition()||ZI,{onLayoutAnimationStart:w,onLayoutAnimationComplete:b}=d.getProps(),E=!this.targetLayout||!v6(this.targetLayout,y),k=!p&&g;if(this.options.layoutRoot||this.resumeFrom||k||p&&(E||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const _={...V2(v,"layout"),onPlay:w,onComplete:b};(d.shouldReduceMotion||this.options.layoutRoot)&&(_.delay=0,_.type=!1),this.startAnimation(_),this.setAnimationOrigin(f,k)}else p||HC(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=y})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Wu(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(XI),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&w6(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let f=0;f<this.path.length;f++){const p=this.path[f];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(WC);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(zC);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(VI),this.nodes.forEach($I),this.nodes.forEach(WI)):this.nodes.forEach(zC),this.clearAllSnapshots();const l=Ai.now();Ca.delta=Fc(0,1e3/60,l-Ca.timestamp),Ca.timestamp=l,Ca.isProcessing=!0,qv.update.process(Ca),qv.preRender.process(Ca),qv.render.process(Ca),Ca.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,q2.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(GI),this.sharedNodes.forEach(YI)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Kn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Kn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!gi(this.snapshot.measuredBox.x)&&!gi(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Cs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(l=!1),l&&this.instance){const c=n(this.instance);this.scroll={animationId:this.root.animationId,phase:i,isRoot:c,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!s)return;const i=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!y6(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,f=d!==this.prevTransformTemplateValue;i&&this.instance&&(l||Ud(this.latestValues)||f)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return i&&(c=this.removeTransform(c)),eM(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:i}=this.options;if(!i)return Cs();const l=i.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(tM))){const{scroll:d}=this.root;d&&(zh(l.x,d.offset.x),zh(l.y,d.offset.y))}return l}removeElementScroll(i){const l=Cs();if(fo(l,i),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:f,options:p}=d;d!==this.root&&f&&p.layoutScroll&&(f.wasRoot&&fo(l,i),zh(l.x,f.offset.x),zh(l.y,f.offset.y))}return l}applyTransform(i,l=!1){const c=Cs();fo(c,i);for(let d=0;d<this.path.length;d++){const f=this.path[d];!l&&f.options.layoutScroll&&f.scroll&&f!==f.root&&Hh(c,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),Ud(f.latestValues)&&Hh(c,f.latestValues)}return Ud(this.latestValues)&&Hh(c,this.latestValues),c}removeTransform(i){const l=Cs();fo(l,i);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!Ud(d.latestValues))continue;y_(d.latestValues)&&d.updateSnapshot();const f=Cs(),p=d.measurePageBox();fo(f,p),MC(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,f)}return Ud(this.latestValues)&&MC(l,this.latestValues),l}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ca.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(i||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:p}=this.options;if(!(!this.layout||!(f||p))){if(this.resolvedRelativeTargetAt=Ca.timestamp,!this.targetDelta&&!this.relativeTarget){const g=this.getClosestProjectingParent();g&&g.layout&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Cs(),this.relativeTargetOrigin=Cs(),Mm(this.relativeTargetOrigin,this.layout.layoutBox,g.layout.layoutBox),fo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Cs(),this.targetWithTransforms=Cs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),oI(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):fo(this.target,this.layout.layoutBox),Z5(this.target,this.targetDelta)):fo(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const g=this.getClosestProjectingParent();g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Cs(),this.relativeTargetOrigin=Cs(),Mm(this.relativeTargetOrigin,this.target,g.target),fo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||y_(this.parent.latestValues)||Q5(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const i=this.getLead(),l=!!this.resumingFrom||this!==i;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Ca.timestamp&&(c=!1),c)return;const{layout:d,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||f))return;fo(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,g=this.treeScale.y;v9(this.layoutCorrected,this.treeScale,this.path,l),i.layout&&!i.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(i.target=i.layout.layoutBox,i.targetWithTransforms=Cs());const{target:y}=i;if(!y){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(RC(this.prevProjectionDelta.x,this.projectionDelta.x),RC(this.prevProjectionDelta.y,this.projectionDelta.y)),Im(this.projectionDelta,this.layoutCorrected,y,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==g||!$C(this.projectionDelta.x,this.prevProjectionDelta.x)||!$C(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",y))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){if(this.options.visualElement?.scheduleRender(),i){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Gh(),this.projectionDelta=Gh(),this.projectionDeltaWithTransform=Gh()}setAnimationOrigin(i,l=!1){const c=this.snapshot,d=c?c.latestValues:{},f={...this.latestValues},p=Gh();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const g=Cs(),y=c?c.source:void 0,v=this.layout?this.layout.source:void 0,w=y!==v,b=this.getStack(),E=!b||b.members.length<=1,k=!!(w&&!E&&this.options.crossfade===!0&&!this.path.some(QI));this.animationProgress=0;let _;this.mixTargetDelta=T=>{const j=T/1e3;GC(p.x,i.x,j),GC(p.y,i.y,j),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Mm(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),JI(this.relativeTarget,this.relativeTargetOrigin,g,j),_&&MI(this.relativeTarget,_)&&(this.isProjectionDirty=!1),_||(_=Cs()),fo(_,this.relativeTarget)),w&&(this.animationValues=f,AI(f,d,this.latestValues,j,k,E)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=j},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Wu(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Kn.update(()=>{Ry.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=l0(0)),this.currentAnimation=CI(this.motionValue,[0,1e3],{...i,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),i.onUpdate&&i.onUpdate(l)},onStop:()=>{},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(BI),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:f}=i;if(!(!l||!c||!d)){if(this!==i&&this.layout&&d&&b6(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Cs();const p=gi(this.layout.layoutBox.x);c.x.min=i.target.x.min,c.x.max=c.x.min+p;const g=gi(this.layout.layoutBox.y);c.y.min=i.target.y.min,c.y.max=c.y.min+g}fo(l,c),Hh(l,f),Im(this.projectionDeltaWithTransform,this.layoutCorrected,l,f)}}registerSharedNode(i,l){this.sharedNodes.has(i)||this.sharedNodes.set(i,new OI),this.sharedNodes.get(i).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){const{layoutId:i}=this.options;return i?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:i}=this.options;return i?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),i&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetSkewAndRotation(){const{visualElement:i}=this.options;if(!i)return;let l=!1;const{latestValues:c}=i;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&iw("z",i,d,this.animationValues);for(let f=0;f<aw.length;f++)iw(`rotate${aw[f]}`,i,d,this.animationValues),iw(`skew${aw[f]}`,i,d,this.animationValues);i.render();for(const f in d)i.setStaticValue(f,d[f]),this.animationValues&&(this.animationValues[f]=d[f]);i.scheduleRender()}applyProjectionStyles(i,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){i.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,i.visibility="",i.opacity="",i.pointerEvents=Py(l?.pointerEvents)||"",i.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(i.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,i.pointerEvents=Py(l?.pointerEvents)||""),this.hasProjected&&!Ud(this.latestValues)&&(i.transform=c?c({},""):"none",this.hasProjected=!1);return}i.visibility="";const f=d.animationValues||d.latestValues;this.applyTransformsToTarget();let p=LI(this.projectionDeltaWithTransform,this.treeScale,f);c&&(p=c(f,p)),i.transform=p;const{x:g,y}=this.projectionDelta;i.transformOrigin=`${g.origin*100}% ${y.origin*100}% 0`,d.animationValues?i.opacity=d===this?f.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:i.opacity=d===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const v in rp){if(f[v]===void 0)continue;const{correct:w,applyTo:b,isCSSVariable:E}=rp[v],k=p==="none"?f[v]:w(f[v],d);if(b){const _=b.length;for(let T=0;T<_;T++)i[b[T]]=k}else E?this.options.visualElement.renderState.vars[v]=k:i[v]=k}this.options.layoutId&&(i.pointerEvents=d===this?Py(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>i.currentAnimation?.stop()),this.root.nodes.forEach(WC),this.root.sharedNodes.clear()}}}function $I(e){e.updateLayout()}function WI(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:s}=e.options,a=t.source!==e.layout.source;s==="size"?yo(f=>{const p=a?t.measuredBox[f]:t.layoutBox[f],g=gi(p);p.min=r[f].min,p.max=p.min+g}):b6(s,t.layoutBox,r)&&yo(f=>{const p=a?t.measuredBox[f]:t.layoutBox[f],g=gi(r[f]);p.max=p.min+g,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+g)});const i=Gh();Im(i,r,t.layoutBox);const l=Gh();a?Im(l,e.applyTransform(n,!0),t.measuredBox):Im(l,r,t.layoutBox);const c=!y6(i);let d=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:p,layout:g}=f;if(p&&g){const y=Cs();Mm(y,t.layoutBox,p.layoutBox);const v=Cs();Mm(v,r,g.layoutBox),v6(y,v)||(d=!0),f.options.layoutRoot&&(e.relativeTarget=v,e.relativeTargetOrigin=y,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:l,layoutDelta:i,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function zI(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function HI(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function GI(e){e.clearSnapshot()}function WC(e){e.clearMeasurements()}function zC(e){e.isLayoutDirty=!1}function VI(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function HC(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function KI(e){e.resolveTargetDelta()}function qI(e){e.calcProjection()}function XI(e){e.resetSkewAndRotation()}function YI(e){e.removeLeadSnapshot()}function GC(e,t,r){e.translate=Zn(t.translate,0,r),e.scale=Zn(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function VC(e,t,r,n){e.min=Zn(t.min,r.min,n),e.max=Zn(t.max,r.max,n)}function JI(e,t,r,n){VC(e.x,t.x,r.x,n),VC(e.y,t.y,r.y,n)}function QI(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const ZI={duration:.45,ease:[.4,0,.1,1]},KC=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),qC=KC("applewebkit/")&&!KC("chrome/")?Math.round:So;function XC(e){e.min=qC(e.min),e.max=qC(e.max)}function eM(e){XC(e.x),XC(e.y)}function b6(e,t,r){return e==="position"||e==="preserve-aspect"&&!iI(UC(t),UC(r),.2)}function tM(e){return e!==e.root&&e.scroll?.wasRoot}const rM=_6({attachResizeListener:(e,t)=>np(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ow={current:void 0},S6=_6({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!ow.current){const e=new rM({});e.mount(window),e.setOptions({layoutScroll:!0}),ow.current=e}return ow.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),nM={pan:{Feature:_I},drag:{Feature:wI,ProjectionNode:S6,MeasureLayout:m6}};function YC(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const s="onHover"+r,a=n[s];a&&Kn.postRender(()=>a(t,Dp(t)))}class sM extends Qu{mount(){const{current:t}=this.node;t&&(this.unmount=N7(t,(r,n)=>(YC(this.node,n,"Start"),s=>YC(this.node,s,"End"))))}unmount(){}}class aM extends Qu{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Fp(np(this.node.current,"focus",()=>this.onFocus()),np(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function JC(e,t,r){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const s="onTap"+(r==="End"?"":r),a=n[s];a&&Kn.postRender(()=>a(t,Dp(t)))}class iM extends Qu{mount(){const{current:t}=this.node;t&&(this.unmount=F7(t,(r,n)=>(JC(this.node,n,"Start"),(s,{success:a})=>JC(this.node,s,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const C_=new WeakMap,lw=new WeakMap,oM=e=>{const t=C_.get(e.target);t&&t(e)},lM=e=>{e.forEach(oM)};function cM({root:e,...t}){const r=e||document;lw.has(r)||lw.set(r,{});const n=lw.get(r),s=JSON.stringify(t);return n[s]||(n[s]=new IntersectionObserver(lM,{root:e,...t})),n[s]}function uM(e,t,r){const n=cM(t);return C_.set(e,r),n.observe(e),()=>{C_.delete(e),n.unobserve(e)}}const dM={some:0,all:1};class fM extends Qu{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:s="some",once:a}=t,i={root:r?r.current:void 0,rootMargin:n,threshold:typeof s=="number"?s:dM[s]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,a&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:f,onViewportLeave:p}=this.node.getProps(),g=d?f:p;g&&g(c)};return uM(this.node.current,i,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(hM(t,r))&&this.startObserver()}unmount(){}}function hM({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const gM={inView:{Feature:fM},tap:{Feature:iM},focus:{Feature:aM},hover:{Feature:sM}},mM={layout:{ProjectionNode:S6,MeasureLayout:m6}},pM={...eI,...gM,...nM,...mM},Qe=p9(pM,j9),rt=({children:e,variant:t="primary",size:r="md",onClick:n,disabled:s=!1,className:a="",...i})=>{const l="font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer",c={primary:"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500",success:"bg-green-600 hover:bg-green-700 text-white focus:ring-green-500",danger:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500",warning:"bg-yellow-600 hover:bg-yellow-700 text-white focus:ring-yellow-500",outline:"bg-transparent text-blue-600 border-2 border-blue-600 hover:bg-blue-600 hover:text-white focus:ring-blue-500",secondary:"bg-gray-200 hover:bg-gray-300 text-gray-700 focus:ring-gray-500"},d={xs:"px-2 py-1 text-xs",sm:"px-2 py-1 text-xs sm:px-3 sm:py-1.5 sm:text-sm",md:"px-3 py-1.5 text-sm sm:px-4 sm:py-2 sm:text-base",lg:"px-4 py-2 text-base sm:px-6 sm:py-3 sm:text-lg",icon:"p-0 flex items-center justify-center"},f=s?"opacity-50 cursor-not-allowed":"";return o.jsx(Qe.button,{className:`${l} ${c[t]} ${d[r]} ${f} ${a}`,onClick:n,disabled:s,whileHover:s?{}:{scale:1.05},whileTap:s?{}:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},...i,children:e})},Br=({size:e="md",color:t="blue",className:r=""})=>{const n={sm:"w-4 h-4",small:"w-4 h-4",md:"w-6 h-6",medium:"w-6 h-6",lg:"w-8 h-8",large:"w-8 h-8",xl:"w-12 h-12"},s={blue:"border-blue-600",green:"border-green-600",red:"border-red-600",yellow:"border-yellow-600",gray:"border-gray-600"};return o.jsx(Qe.div,{className:`
        inline-block border-2 border-gray-300 border-t-current rounded-full animate-spin
        ${n[e]} ${s[t]} ${r}
      `,animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})},el=({type:e="info",message:t="",duration:r=3e3,closable:n=!0,onClose:s,className:a="",...i})=>{const[l,c]=C.useState(!0),[d,f]=C.useState(!1),p=C.useRef(null),g=C.useRef(null);C.useEffect(()=>{if(r>0)return g.current=setTimeout(()=>{y()},r),()=>{g.current&&clearTimeout(g.current)}},[r]);const y=C.useCallback(()=>{d||(f(!0),g.current&&clearTimeout(g.current),setTimeout(()=>{c(!1),s&&s()},300))},[d,s]),v=C.useCallback(E=>{E.key==="Escape"&&y()},[y]);if(!l)return null;const w=["notification",`notification-${e}`,l?"notification-visible":"",d?"notification-exiting":"",a].filter(Boolean).join(" "),b=()=>{switch(e){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";case"info":default:return"ℹ"}};return o.jsx("div",{ref:p,className:w,role:"alert","aria-live":"polite",onKeyDown:v,tabIndex:-1,...i,children:o.jsxs("div",{className:"notification-content",children:[o.jsx("div",{className:"notification-icon","aria-hidden":"true",children:b()}),o.jsx("div",{className:"notification-body",children:o.jsx("div",{className:"notification-message",children:t})}),n&&o.jsx("button",{className:"notification-close",onClick:y,type:"button","aria-label":"Close notification",children:"×"})]})})},da=()=>{const[e,t]=C.useState([]),r=C.useCallback((a,i="info",l={})=>{const c=Date.now()+Math.random(),d={id:c,message:a,type:i,...l};return t(f=>[...f,d]),l.duration!==0&&setTimeout(()=>{n(c)},l.duration||3e3),c},[]),n=C.useCallback(a=>{t(i=>i.filter(l=>l.id!==a))},[]),s=C.useCallback(()=>{t([])},[]);return{notifications:e,showNotification:r,removeNotification:n,clearAllNotifications:s}},Ji=()=>{const[e,t]=C.useState(!1),[r,n]=C.useState(null),[s,a]=C.useState(null),i=C.useRef(null);C.useRef(new Map);const l=C.useRef(0),c=3,d=1e3,f=C.useCallback(()=>{i.current&&(i.current.abort(),i.current=null)},[]);C.useEffect(()=>f,[f]);const p=C.useCallback(async(O,W={})=>{try{t(!0),n(null),i.current=new AbortController;const q=W.method||"POST",Y={method:q,headers:{"Content-Type":"application/json",...W.headers},signal:i.current.signal,...W};q!=="GET"&&q!=="HEAD"&&(Y.body=JSON.stringify(W.data||{})),console.log(`[API] Making request to: ${O}`,Y);const ee=await fetch(O,Y);if(!ee.ok)throw new Error(`HTTP error! status: ${ee.status}`);const X=await ee.json();if(console.log("[API] Response received:",X),X.success)return a(X),l.current=0,X;throw new Error(X.error||X.message||"Request failed")}catch(q){if(q.name==="AbortError")return console.log("[API] Request was aborted"),null;if(console.error("[API] Request failed:",q),n(q.message||"Request failed"),l.current<c){l.current++;const Y=d*Math.pow(2,l.current-1);return console.log(`[API] Retrying in ${Y}ms (attempt ${l.current}/${c})`),await new Promise(ee=>setTimeout(ee,Y)),p(O,W)}throw q}finally{t(!1),i.current=null}},[]),g=C.useCallback(async(O,W={})=>{try{if(!window.tokenManager||!window.tokenManager.isAuthenticated())throw new Error("No valid authentication token found");return await window.tokenManager.makeAuthenticatedRequest(O,W)}catch(q){throw console.error("[API] Authenticated request failed:",q),q}},[]),y=C.useCallback(async(O,W)=>{try{const q=`/.netlify/functions/get-test-questions?test_type=${O}&test_id=${W}`;console.log(`[API] Getting test info for ${O}_${W}`);const ee=await(await g(q)).json();if(ee.success)return console.log("[API] Test info retrieved successfully:",ee.test_info),ee.test_info;throw new Error(ee.error||"Failed to get test info")}catch(q){throw console.error("[API] Failed to get test info:",q),q}},[g]),v=C.useCallback(async(O,W)=>{try{const q=`/.netlify/functions/get-test-questions?test_type=${O}&test_id=${W}`;console.log(`[API] Getting test questions for ${O}_${W}`);const ee=await(await g(q)).json();if(ee.success)return console.log("[API] Test questions retrieved successfully:",ee.questions),ee.questions;throw new Error(ee.error||"Failed to get test questions")}catch(q){throw console.error("[API] Failed to get test questions:",q),q}},[g]),w=C.useCallback(async()=>{try{const O="/.netlify/functions/get-student-active-tests";console.log("[API] Loading student active tests");const q=await(await g(O)).json();if(q.success)return console.log("[API] Student active tests loaded successfully:",q.tests),q.tests;throw new Error(q.error||"Failed to load student active tests")}catch(O){throw console.error("[API] Failed to load student active tests:",O),O}},[g]),b=C.useCallback(async(O,W,q)=>{try{let Y;switch(O){case"true_false":Y="/.netlify/functions/submit-true-false-test";break;case"multiple_choice":Y="/.netlify/functions/submit-multiple-choice-test";break;case"input":Y="/.netlify/functions/submit-input-test";break;case"matching_type":Y="/.netlify/functions/submit-matching-type-test";break;case"speaking":Y="/.netlify/functions/submit-speaking-test";break;default:throw new Error(`Unknown test type: ${O}`)}console.log(`[API] Submitting ${O} test:`,q);const X=await(await g(Y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)})).json();if(X.success)return console.log("[API] Test submitted successfully:",X),X;throw new Error(X.error||"Failed to submit test")}catch(Y){throw console.error("[API] Failed to submit test:",Y),Y}},[g]),E=C.useCallback(async O=>{try{const W="/.netlify/functions/save-multiple-choice-test";console.log("[API] Saving multiple choice test:",O);const Y=await(await g(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)})).json();if(Y.success)return console.log("[API] Multiple choice test saved successfully:",Y),Y;throw new Error(Y.error||"Failed to save multiple choice test")}catch(W){throw console.error("[API] Failed to save multiple choice test:",W),W}},[g]),k=C.useCallback(async O=>{try{const W="/.netlify/functions/save-true-false-test";console.log("[API] Saving true/false test:",O);const Y=await(await g(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)})).json();if(Y.success)return console.log("[API] True/false test saved successfully:",Y),Y;throw new Error(Y.error||"Failed to save true/false test")}catch(W){throw console.error("[API] Failed to save true/false test:",W),W}},[g]),_=C.useCallback(async O=>{try{const W="/.netlify/functions/save-input-test";console.log("[API] Saving input test:",O);const Y=await(await g(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)})).json();if(Y.success)return console.log("[API] Input test saved successfully:",Y),Y;throw new Error(Y.error||"Failed to save input test")}catch(W){throw console.error("[API] Failed to save input test:",W),W}},[g]),T=C.useCallback(async O=>{try{const W="/.netlify/functions/assign-test";console.log("[API] Assigning test to classes:",O);const Y=await(await g(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)})).json();if(Y.success)return console.log("[API] Test assigned successfully:",Y),Y;throw new Error(Y.error||"Failed to assign test")}catch(W){throw console.error("[API] Failed to assign test:",W),W}},[g]),j=C.useCallback(async()=>{try{const O="/.netlify/functions/get-teacher-active-tests";console.log("[API] Loading teacher active tests");const q=await(await g(O)).json();if(q.success)return console.log("[API] Teacher active tests loaded successfully:",q.tests),q.tests;throw new Error(q.error||"Failed to load teacher active tests")}catch(O){throw console.error("[API] Failed to load teacher active tests:",O),O}},[g]),P=C.useCallback(async()=>{try{const O="/.netlify/functions/get-all-users";console.log("[API] Getting all users");const q=await(await g(O)).json();if(q.success)return console.log("[API] All users loaded successfully:",q.users),q.users;throw new Error(q.error||"Failed to get all users")}catch(O){throw console.error("[API] Failed to get all users:",O),O}},[g]),R=C.useCallback(async()=>{try{const O="/.netlify/functions/get-all-teachers";console.log("[API] Getting all teachers");const q=await(await g(O)).json();if(q.success)return console.log("[API] All teachers loaded successfully:",q.teachers),q.teachers;throw new Error(q.error||"Failed to get all teachers")}catch(O){throw console.error("[API] Failed to get all teachers:",O),O}},[g]),N=C.useCallback(async()=>{try{const O="/.netlify/functions/get-all-subjects";console.log("[API] Getting all subjects");const q=await(await g(O)).json();if(q.success)return console.log("[API] All subjects loaded successfully:",q.subjects),q.subjects;throw new Error(q.error||"Failed to get all subjects")}catch(O){throw console.error("[API] Failed to get all subjects:",O),O}},[g]),A=C.useCallback(()=>{n(null)},[]),M=C.useCallback(()=>{a(null)},[]),H=C.useCallback(()=>{t(!1),n(null),a(null),l.current=0,f()},[f]),Q=C.useCallback(async(O,W={})=>{const Y=await(await g(O,{...W,method:"GET"})).json();if(Y.success)return Y;throw new Error(Y.error||"Request failed")},[g]),Z=C.useCallback(async(O,W,q={})=>{const ee=await(await g(O,{...q,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)})).json();if(ee.success)return ee;throw new Error(ee.error||"Request failed")},[g]),ae=C.useCallback(async(O,W,q={})=>{const ee=await(await g(O,{...q,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)})).json();if(ee.success)return ee;throw new Error(ee.error||"Request failed")},[g]),te=C.useCallback(async(O,W={})=>{const Y=await(await g(O,{...W,method:"DELETE"})).json();if(Y.success)return Y;throw new Error(Y.error||"Request failed")},[g]),se=C.useCallback(async O=>{try{const W="/.netlify/functions/submit-speaking-test";console.log("[API] Submitting speaking test:",O);const Y=await(await g(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)})).json();if(Y.success)return console.log("[API] Speaking test submitted successfully:",Y),Y;throw new Error(Y.error||"Failed to submit speaking test")}catch(W){throw console.error("[API] Failed to submit speaking test:",W),W}},[g]),L=C.useCallback(async O=>{try{const W=`/.netlify/functions/get-speaking-test-new?action=test&test_id=${O}`;console.log("[API] Getting speaking test:",O);const Y=await(await g(W,{method:"GET"})).json();if(Y.success)return console.log("[API] Speaking test loaded successfully:",Y),Y;throw new Error(Y.error||"Failed to load speaking test")}catch(W){throw console.error("[API] Failed to load speaking test:",W),W}},[g]),G=C.useCallback(async O=>{try{const W=`/.netlify/functions/get-speaking-test-new?action=questions&test_id=${O}`;console.log("[API] Getting speaking test questions:",O);const Y=await(await g(W,{method:"GET"})).json();if(Y.success)return console.log("[API] Speaking test questions loaded successfully:",Y),Y;throw new Error(Y.error||"Failed to load speaking test questions")}catch(W){throw console.error("[API] Failed to load speaking test questions:",W),W}},[g]),I=C.useCallback(async O=>{try{const W="/.netlify/functions/upload-speaking-audio";console.log("[API] Uploading speaking audio");const Y=await(await g(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)})).json();if(Y.success)return console.log("[API] Audio uploaded successfully:",Y),Y;throw new Error(Y.error||"Failed to upload audio")}catch(W){throw console.error("[API] Failed to upload audio:",W),W}},[g]),z=C.useCallback(async O=>{try{const W=`/.netlify/functions/get-speaking-test-new?action=audio&file_path=${encodeURIComponent(O)}`;console.log("[API] Getting speaking audio:",O);const Y=await(await g(W,{method:"GET"})).json();if(Y.success)return console.log("[API] Audio URL retrieved successfully:",Y),Y;throw new Error(Y.error||"Failed to get audio")}catch(W){throw console.error("[API] Failed to get audio:",W),W}},[g]),V=C.useCallback(async(O,W)=>{try{const q=`/.netlify/functions/check-test-completion?test_id=${O}&test_type=${W}`;console.log("[API] Checking test completion:",O,W);const ee=await(await g(q,{method:"GET"})).json();if(ee.success)return console.log("[API] Test completion status:",ee),ee;throw new Error(ee.error||"Failed to check test completion")}catch(q){throw console.error("[API] Failed to check test completion:",q),q}},[g]);return{loading:e,error:r,data:s,sendRequest:p,makeAuthenticatedRequest:g,get:Q,post:Z,put:ae,delete:te,getTestInfo:y,getTestQuestions:v,loadStudentActiveTests:w,submitTest:b,submitSpeakingTest:se,getSpeakingTest:L,getSpeakingTestQuestions:G,uploadSpeakingAudio:I,getSpeakingAudio:z,checkTestCompletion:V,saveMultipleChoiceTest:E,saveTrueFalseTest:k,saveInputTest:_,assignTestToClasses:T,loadTeacherActiveTests:j,getAllUsers:P,getAllTeachers:R,getAllSubjects:N,clearError:A,clearData:M,reset:H,cleanup:f}},xM="modulepreload",yM=function(e){return"/"+e},QC={},hi=function(t,r,n){let s=Promise.resolve();if(r&&r.length>0){let d=function(f){return Promise.all(f.map(p=>Promise.resolve(p).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};var i=d;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");s=d(r.map(f=>{if(f=yM(f),f in QC)return;QC[f]=!0;const p=f.endsWith(".css"),g=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${g}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":xM,p||(y.as="script"),y.crossOrigin="",y.href=f,c&&y.setAttribute("nonce",c),document.head.appendChild(y),p)return new Promise((v,w)=>{y.addEventListener("load",v),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&a(c.reason);return t().catch(a)})};var Dy={exports:{}},Fg={},cw={},uw={},ZC;function Vr(){return ZC||(ZC=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const t=Math.PI/180;function r(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}e.glob=typeof $y<"u"?$y:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},e.Konva={_global:e.glob,version:"9.3.22",isBrowser:r(),isUnminified:/param/.test((function(s){}).toString()),dblClickWindow:400,getAngle(s){return e.Konva.angleDeg?s*t:s},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return e.Konva.DD.isDragging},isTransforming(){var s;return(s=e.Konva.Transformer)===null||s===void 0?void 0:s.isTransforming()},isDragReady(){return!!e.Konva.DD.node},releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(s){e.glob.Konva=s}};const n=s=>{e.Konva[s.prototype.getClassName()]=s};e._registerNode=n,e.Konva._injectGlobal(e.Konva)})(uw)),uw}var dw={},eT;function ps(){return eT||(eT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Util=e.Transform=void 0;const t=Vr();class r{constructor(T=[1,0,0,1,0,0]){this.dirty=!1,this.m=T&&T.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new r(this.m)}copyInto(T){T.m[0]=this.m[0],T.m[1]=this.m[1],T.m[2]=this.m[2],T.m[3]=this.m[3],T.m[4]=this.m[4],T.m[5]=this.m[5]}point(T){const j=this.m;return{x:j[0]*T.x+j[2]*T.y+j[4],y:j[1]*T.x+j[3]*T.y+j[5]}}translate(T,j){return this.m[4]+=this.m[0]*T+this.m[2]*j,this.m[5]+=this.m[1]*T+this.m[3]*j,this}scale(T,j){return this.m[0]*=T,this.m[1]*=T,this.m[2]*=j,this.m[3]*=j,this}rotate(T){const j=Math.cos(T),P=Math.sin(T),R=this.m[0]*j+this.m[2]*P,N=this.m[1]*j+this.m[3]*P,A=this.m[0]*-P+this.m[2]*j,M=this.m[1]*-P+this.m[3]*j;return this.m[0]=R,this.m[1]=N,this.m[2]=A,this.m[3]=M,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(T,j){const P=this.m[0]+this.m[2]*j,R=this.m[1]+this.m[3]*j,N=this.m[2]+this.m[0]*T,A=this.m[3]+this.m[1]*T;return this.m[0]=P,this.m[1]=R,this.m[2]=N,this.m[3]=A,this}multiply(T){const j=this.m[0]*T.m[0]+this.m[2]*T.m[1],P=this.m[1]*T.m[0]+this.m[3]*T.m[1],R=this.m[0]*T.m[2]+this.m[2]*T.m[3],N=this.m[1]*T.m[2]+this.m[3]*T.m[3],A=this.m[0]*T.m[4]+this.m[2]*T.m[5]+this.m[4],M=this.m[1]*T.m[4]+this.m[3]*T.m[5]+this.m[5];return this.m[0]=j,this.m[1]=P,this.m[2]=R,this.m[3]=N,this.m[4]=A,this.m[5]=M,this}invert(){const T=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),j=this.m[3]*T,P=-this.m[1]*T,R=-this.m[2]*T,N=this.m[0]*T,A=T*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),M=T*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=j,this.m[1]=P,this.m[2]=R,this.m[3]=N,this.m[4]=A,this.m[5]=M,this}getMatrix(){return this.m}decompose(){const T=this.m[0],j=this.m[1],P=this.m[2],R=this.m[3],N=this.m[4],A=this.m[5],M=T*R-j*P,H={x:N,y:A,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(T!=0||j!=0){const Q=Math.sqrt(T*T+j*j);H.rotation=j>0?Math.acos(T/Q):-Math.acos(T/Q),H.scaleX=Q,H.scaleY=M/Q,H.skewX=(T*P+j*R)/M,H.skewY=0}else if(P!=0||R!=0){const Q=Math.sqrt(P*P+R*R);H.rotation=Math.PI/2-(R>0?Math.acos(-P/Q):-Math.acos(P/Q)),H.scaleX=M/Q,H.scaleY=Q,H.skewX=0,H.skewY=(T*P+j*R)/M}return H.rotation=e.Util._getRotation(H.rotation),H}}e.Transform=r;const n="[object Array]",s="[object Number]",a="[object String]",i="[object Boolean]",l=Math.PI/180,c=180/Math.PI,d="#",f="",p="0",g="Konva warning: ",y="Konva error: ",v="rgb(",w={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let E=[];const k=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(_){setTimeout(_,60)};e.Util={_isElement(_){return!!(_&&_.nodeType==1)},_isFunction(_){return!!(_&&_.constructor&&_.call&&_.apply)},_isPlainObject(_){return!!_&&_.constructor===Object},_isArray(_){return Object.prototype.toString.call(_)===n},_isNumber(_){return Object.prototype.toString.call(_)===s&&!isNaN(_)&&isFinite(_)},_isString(_){return Object.prototype.toString.call(_)===a},_isBoolean(_){return Object.prototype.toString.call(_)===i},isObject(_){return _ instanceof Object},isValidSelector(_){if(typeof _!="string")return!1;const T=_[0];return T==="#"||T==="."||T===T.toUpperCase()},_sign(_){return _===0||_>0?1:-1},requestAnimFrame(_){E.push(_),E.length===1&&k(function(){const T=E;E=[],T.forEach(function(j){j()})})},createCanvasElement(){const _=document.createElement("canvas");try{_.style=_.style||{}}catch{}return _},createImageElement(){return document.createElement("img")},_isInDocument(_){for(;_=_.parentNode;)if(_==document)return!0;return!1},_urlToImage(_,T){const j=e.Util.createImageElement();j.onload=function(){T(j)},j.src=_},_rgbToHex(_,T,j){return((1<<24)+(_<<16)+(T<<8)+j).toString(16).slice(1)},_hexToRgb(_){_=_.replace(d,f);const T=parseInt(_,16);return{r:T>>16&255,g:T>>8&255,b:T&255}},getRandomColor(){let _=(Math.random()*16777215<<0).toString(16);for(;_.length<6;)_=p+_;return d+_},getRGB(_){let T;return _ in w?(T=w[_],{r:T[0],g:T[1],b:T[2]}):_[0]===d?this._hexToRgb(_.substring(1)):_.substr(0,4)===v?(T=b.exec(_.replace(/ /g,"")),{r:parseInt(T[1],10),g:parseInt(T[2],10),b:parseInt(T[3],10)}):{r:0,g:0,b:0}},colorToRGBA(_){return _=_||"black",e.Util._namedColorToRBA(_)||e.Util._hex3ColorToRGBA(_)||e.Util._hex4ColorToRGBA(_)||e.Util._hex6ColorToRGBA(_)||e.Util._hex8ColorToRGBA(_)||e.Util._rgbColorToRGBA(_)||e.Util._rgbaColorToRGBA(_)||e.Util._hslColorToRGBA(_)},_namedColorToRBA(_){const T=w[_.toLowerCase()];return T?{r:T[0],g:T[1],b:T[2],a:1}:null},_rgbColorToRGBA(_){if(_.indexOf("rgb(")===0){_=_.match(/rgb\(([^)]+)\)/)[1];const T=_.split(/ *, */).map(Number);return{r:T[0],g:T[1],b:T[2],a:1}}},_rgbaColorToRGBA(_){if(_.indexOf("rgba(")===0){_=_.match(/rgba\(([^)]+)\)/)[1];const T=_.split(/ *, */).map((j,P)=>j.slice(-1)==="%"?P===3?parseInt(j)/100:parseInt(j)/100*255:Number(j));return{r:T[0],g:T[1],b:T[2],a:T[3]}}},_hex8ColorToRGBA(_){if(_[0]==="#"&&_.length===9)return{r:parseInt(_.slice(1,3),16),g:parseInt(_.slice(3,5),16),b:parseInt(_.slice(5,7),16),a:parseInt(_.slice(7,9),16)/255}},_hex6ColorToRGBA(_){if(_[0]==="#"&&_.length===7)return{r:parseInt(_.slice(1,3),16),g:parseInt(_.slice(3,5),16),b:parseInt(_.slice(5,7),16),a:1}},_hex4ColorToRGBA(_){if(_[0]==="#"&&_.length===5)return{r:parseInt(_[1]+_[1],16),g:parseInt(_[2]+_[2],16),b:parseInt(_[3]+_[3],16),a:parseInt(_[4]+_[4],16)/255}},_hex3ColorToRGBA(_){if(_[0]==="#"&&_.length===4)return{r:parseInt(_[1]+_[1],16),g:parseInt(_[2]+_[2],16),b:parseInt(_[3]+_[3],16),a:1}},_hslColorToRGBA(_){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(_)){const[T,...j]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(_),P=Number(j[0])/360,R=Number(j[1])/100,N=Number(j[2])/100;let A,M,H;if(R===0)return H=N*255,{r:Math.round(H),g:Math.round(H),b:Math.round(H),a:1};N<.5?A=N*(1+R):A=N+R-N*R;const Q=2*N-A,Z=[0,0,0];for(let ae=0;ae<3;ae++)M=P+1/3*-(ae-1),M<0&&M++,M>1&&M--,6*M<1?H=Q+(A-Q)*6*M:2*M<1?H=A:3*M<2?H=Q+(A-Q)*(2/3-M)*6:H=Q,Z[ae]=H*255;return{r:Math.round(Z[0]),g:Math.round(Z[1]),b:Math.round(Z[2]),a:1}}},haveIntersection(_,T){return!(T.x>_.x+_.width||T.x+T.width<_.x||T.y>_.y+_.height||T.y+T.height<_.y)},cloneObject(_){const T={};for(const j in _)this._isPlainObject(_[j])?T[j]=this.cloneObject(_[j]):this._isArray(_[j])?T[j]=this.cloneArray(_[j]):T[j]=_[j];return T},cloneArray(_){return _.slice(0)},degToRad(_){return _*l},radToDeg(_){return _*c},_degToRad(_){return e.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),e.Util.degToRad(_)},_radToDeg(_){return e.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),e.Util.radToDeg(_)},_getRotation(_){return t.Konva.angleDeg?e.Util.radToDeg(_):_},_capitalize(_){return _.charAt(0).toUpperCase()+_.slice(1)},throw(_){throw new Error(y+_)},error(_){console.error(y+_)},warn(_){t.Konva.showWarnings&&console.warn(g+_)},each(_,T){for(const j in _)T(j,_[j])},_inRange(_,T,j){return T<=_&&_<j},_getProjectionToSegment(_,T,j,P,R,N){let A,M,H;const Q=(_-j)*(_-j)+(T-P)*(T-P);if(Q==0)A=_,M=T,H=(R-j)*(R-j)+(N-P)*(N-P);else{const Z=((R-_)*(j-_)+(N-T)*(P-T))/Q;Z<0?(A=_,M=T,H=(_-R)*(_-R)+(T-N)*(T-N)):Z>1?(A=j,M=P,H=(j-R)*(j-R)+(P-N)*(P-N)):(A=_+Z*(j-_),M=T+Z*(P-T),H=(A-R)*(A-R)+(M-N)*(M-N))}return[A,M,H]},_getProjectionToLine(_,T,j){const P=e.Util.cloneObject(_);let R=Number.MAX_VALUE;return T.forEach(function(N,A){if(!j&&A===T.length-1)return;const M=T[(A+1)%T.length],H=e.Util._getProjectionToSegment(N.x,N.y,M.x,M.y,_.x,_.y),Q=H[0],Z=H[1],ae=H[2];ae<R&&(P.x=Q,P.y=Z,R=ae)}),P},_prepareArrayForTween(_,T,j){const P=[],R=[];if(_.length>T.length){const A=T;T=_,_=A}for(let A=0;A<_.length;A+=2)P.push({x:_[A],y:_[A+1]});for(let A=0;A<T.length;A+=2)R.push({x:T[A],y:T[A+1]});const N=[];return R.forEach(function(A){const M=e.Util._getProjectionToLine(A,P,j);N.push(M.x),N.push(M.y)}),N},_prepareToStringify(_){let T;_.visitedByCircularReferenceRemoval=!0;for(const j in _)if(_.hasOwnProperty(j)&&_[j]&&typeof _[j]=="object"){if(T=Object.getOwnPropertyDescriptor(_,j),_[j].visitedByCircularReferenceRemoval||e.Util._isElement(_[j]))if(T.configurable)delete _[j];else return null;else if(e.Util._prepareToStringify(_[j])===null)if(T.configurable)delete _[j];else return null}return delete _.visitedByCircularReferenceRemoval,_},_assign(_,T){for(const j in T)_[j]=T[j];return _},_getFirstPointerId(_){return _.touches?_.changedTouches[0].identifier:_.pointerId||999},releaseCanvas(..._){t.Konva.releaseCanvasOnDestroy&&_.forEach(T=>{T.width=0,T.height=0})},drawRoundedRectPath(_,T,j,P){let R=0,N=0,A=0,M=0;typeof P=="number"?R=N=A=M=Math.min(P,T/2,j/2):(R=Math.min(P[0]||0,T/2,j/2),N=Math.min(P[1]||0,T/2,j/2),M=Math.min(P[2]||0,T/2,j/2),A=Math.min(P[3]||0,T/2,j/2)),_.moveTo(R,0),_.lineTo(T-N,0),_.arc(T-N,N,N,Math.PI*3/2,0,!1),_.lineTo(T,j-M),_.arc(T-M,j-M,M,0,Math.PI/2,!1),_.lineTo(A,j),_.arc(A,j-A,A,Math.PI/2,Math.PI,!1),_.lineTo(0,R),_.arc(R,R,R,Math.PI,Math.PI*3/2,!1)}}})(dw)),dw}var Pg={},xc={},yc={},tT;function k6(){if(tT)return yc;tT=1,Object.defineProperty(yc,"__esModule",{value:!0}),yc.HitContext=yc.SceneContext=yc.Context=void 0;const e=ps(),t=Vr();function r(E){const k=[],_=E.length,T=e.Util;for(let j=0;j<_;j++){let P=E[j];T._isNumber(P)?P=Math.round(P*1e3)/1e3:T._isString(P)||(P=P+""),k.push(P)}return k}const n=",",s="(",a=")",i="([",l="])",c=";",d="()",f="=",p=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],g=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],y=100;let v=class{constructor(k){this.canvas=k,t.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(k){k.fillEnabled()&&this._fill(k)}_fill(k){}strokeShape(k){k.hasStroke()&&this._stroke(k)}_stroke(k){}fillStrokeShape(k){k.attrs.fillAfterStrokeEnabled?(this.strokeShape(k),this.fillShape(k)):(this.fillShape(k),this.strokeShape(k))}getTrace(k,_){let T=this.traceArr,j=T.length,P="",R,N,A,M;for(R=0;R<j;R++)N=T[R],A=N.method,A?(M=N.args,P+=A,k?P+=d:e.Util._isArray(M[0])?P+=i+M.join(n)+l:(_&&(M=M.map(H=>typeof H=="number"?Math.floor(H):H)),P+=s+M.join(n)+a)):(P+=N.property,k||(P+=f+N.val)),P+=c;return P}clearTrace(){this.traceArr=[]}_trace(k){let _=this.traceArr,T;_.push(k),T=_.length,T>=y&&_.shift()}reset(){const k=this.getCanvas().getPixelRatio();this.setTransform(1*k,0,0,1*k,0,0)}getCanvas(){return this.canvas}clear(k){const _=this.getCanvas();k?this.clearRect(k.x||0,k.y||0,k.width||0,k.height||0):this.clearRect(0,0,_.getWidth()/_.pixelRatio,_.getHeight()/_.pixelRatio)}_applyLineCap(k){const _=k.attrs.lineCap;_&&this.setAttr("lineCap",_)}_applyOpacity(k){const _=k.getAbsoluteOpacity();_!==1&&this.setAttr("globalAlpha",_)}_applyLineJoin(k){const _=k.attrs.lineJoin;_&&this.setAttr("lineJoin",_)}setAttr(k,_){this._context[k]=_}arc(k,_,T,j,P,R){this._context.arc(k,_,T,j,P,R)}arcTo(k,_,T,j,P){this._context.arcTo(k,_,T,j,P)}beginPath(){this._context.beginPath()}bezierCurveTo(k,_,T,j,P,R){this._context.bezierCurveTo(k,_,T,j,P,R)}clearRect(k,_,T,j){this._context.clearRect(k,_,T,j)}clip(...k){this._context.clip.apply(this._context,k)}closePath(){this._context.closePath()}createImageData(k,_){const T=arguments;if(T.length===2)return this._context.createImageData(k,_);if(T.length===1)return this._context.createImageData(k)}createLinearGradient(k,_,T,j){return this._context.createLinearGradient(k,_,T,j)}createPattern(k,_){return this._context.createPattern(k,_)}createRadialGradient(k,_,T,j,P,R){return this._context.createRadialGradient(k,_,T,j,P,R)}drawImage(k,_,T,j,P,R,N,A,M){const H=arguments,Q=this._context;H.length===3?Q.drawImage(k,_,T):H.length===5?Q.drawImage(k,_,T,j,P):H.length===9&&Q.drawImage(k,_,T,j,P,R,N,A,M)}ellipse(k,_,T,j,P,R,N,A){this._context.ellipse(k,_,T,j,P,R,N,A)}isPointInPath(k,_,T,j){return T?this._context.isPointInPath(T,k,_,j):this._context.isPointInPath(k,_,j)}fill(...k){this._context.fill.apply(this._context,k)}fillRect(k,_,T,j){this._context.fillRect(k,_,T,j)}strokeRect(k,_,T,j){this._context.strokeRect(k,_,T,j)}fillText(k,_,T,j){j?this._context.fillText(k,_,T,j):this._context.fillText(k,_,T)}measureText(k){return this._context.measureText(k)}getImageData(k,_,T,j){return this._context.getImageData(k,_,T,j)}lineTo(k,_){this._context.lineTo(k,_)}moveTo(k,_){this._context.moveTo(k,_)}rect(k,_,T,j){this._context.rect(k,_,T,j)}roundRect(k,_,T,j,P){this._context.roundRect(k,_,T,j,P)}putImageData(k,_,T){this._context.putImageData(k,_,T)}quadraticCurveTo(k,_,T,j){this._context.quadraticCurveTo(k,_,T,j)}restore(){this._context.restore()}rotate(k){this._context.rotate(k)}save(){this._context.save()}scale(k,_){this._context.scale(k,_)}setLineDash(k){this._context.setLineDash?this._context.setLineDash(k):"mozDash"in this._context?this._context.mozDash=k:"webkitLineDash"in this._context&&(this._context.webkitLineDash=k)}getLineDash(){return this._context.getLineDash()}setTransform(k,_,T,j,P,R){this._context.setTransform(k,_,T,j,P,R)}stroke(k){k?this._context.stroke(k):this._context.stroke()}strokeText(k,_,T,j){this._context.strokeText(k,_,T,j)}transform(k,_,T,j,P,R){this._context.transform(k,_,T,j,P,R)}translate(k,_){this._context.translate(k,_)}_enableTrace(){let k=this,_=p.length,T=this.setAttr,j,P;const R=function(N){let A=k[N],M;k[N]=function(){return P=r(Array.prototype.slice.call(arguments,0)),M=A.apply(k,arguments),k._trace({method:N,args:P}),M}};for(j=0;j<_;j++)R(p[j]);k.setAttr=function(){T.apply(k,arguments);const N=arguments[0];let A=arguments[1];(N==="shadowOffsetX"||N==="shadowOffsetY"||N==="shadowBlur")&&(A=A/this.canvas.getPixelRatio()),k._trace({property:N,val:A})}}_applyGlobalCompositeOperation(k){const _=k.attrs.globalCompositeOperation;!_||_==="source-over"||this.setAttr("globalCompositeOperation",_)}};yc.Context=v,g.forEach(function(E){Object.defineProperty(v.prototype,E,{get(){return this._context[E]},set(k){this._context[E]=k}})});class w extends v{constructor(k,{willReadFrequently:_=!1}={}){super(k),this._context=k._canvas.getContext("2d",{willReadFrequently:_})}_fillColor(k){const _=k.fill();this.setAttr("fillStyle",_),k._fillFunc(this)}_fillPattern(k){this.setAttr("fillStyle",k._getFillPattern()),k._fillFunc(this)}_fillLinearGradient(k){const _=k._getLinearGradient();_&&(this.setAttr("fillStyle",_),k._fillFunc(this))}_fillRadialGradient(k){const _=k._getRadialGradient();_&&(this.setAttr("fillStyle",_),k._fillFunc(this))}_fill(k){const _=k.fill(),T=k.getFillPriority();if(_&&T==="color"){this._fillColor(k);return}const j=k.getFillPatternImage();if(j&&T==="pattern"){this._fillPattern(k);return}const P=k.getFillLinearGradientColorStops();if(P&&T==="linear-gradient"){this._fillLinearGradient(k);return}const R=k.getFillRadialGradientColorStops();if(R&&T==="radial-gradient"){this._fillRadialGradient(k);return}_?this._fillColor(k):j?this._fillPattern(k):P?this._fillLinearGradient(k):R&&this._fillRadialGradient(k)}_strokeLinearGradient(k){const _=k.getStrokeLinearGradientStartPoint(),T=k.getStrokeLinearGradientEndPoint(),j=k.getStrokeLinearGradientColorStops(),P=this.createLinearGradient(_.x,_.y,T.x,T.y);if(j){for(let R=0;R<j.length;R+=2)P.addColorStop(j[R],j[R+1]);this.setAttr("strokeStyle",P)}}_stroke(k){const _=k.dash(),T=k.getStrokeScaleEnabled();if(k.hasStroke()){if(!T){this.save();const P=this.getCanvas().getPixelRatio();this.setTransform(P,0,0,P,0,0)}this._applyLineCap(k),_&&k.dashEnabled()&&(this.setLineDash(_),this.setAttr("lineDashOffset",k.dashOffset())),this.setAttr("lineWidth",k.strokeWidth()),k.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),k.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(k):this.setAttr("strokeStyle",k.stroke()),k._strokeFunc(this),T||this.restore()}}_applyShadow(k){var _,T,j;const P=(_=k.getShadowRGBA())!==null&&_!==void 0?_:"black",R=(T=k.getShadowBlur())!==null&&T!==void 0?T:5,N=(j=k.getShadowOffset())!==null&&j!==void 0?j:{x:0,y:0},A=k.getAbsoluteScale(),M=this.canvas.getPixelRatio(),H=A.x*M,Q=A.y*M;this.setAttr("shadowColor",P),this.setAttr("shadowBlur",R*Math.min(Math.abs(H),Math.abs(Q))),this.setAttr("shadowOffsetX",N.x*H),this.setAttr("shadowOffsetY",N.y*Q)}}yc.SceneContext=w;class b extends v{constructor(k){super(k),this._context=k._canvas.getContext("2d",{willReadFrequently:!0})}_fill(k){this.save(),this.setAttr("fillStyle",k.colorKey),k._fillFuncHit(this),this.restore()}strokeShape(k){k.hasHitStroke()&&this._stroke(k)}_stroke(k){if(k.hasHitStroke()){const _=k.getStrokeScaleEnabled();if(!_){this.save();const P=this.getCanvas().getPixelRatio();this.setTransform(P,0,0,P,0,0)}this._applyLineCap(k);const T=k.hitStrokeWidth(),j=T==="auto"?k.strokeWidth():T;this.setAttr("lineWidth",j),this.setAttr("strokeStyle",k.colorKey),k._strokeFuncHit(this),_||this.restore()}}}return yc.HitContext=b,yc}var rT;function M1(){if(rT)return xc;rT=1,Object.defineProperty(xc,"__esModule",{value:!0}),xc.HitCanvas=xc.SceneCanvas=xc.Canvas=void 0;const e=ps(),t=k6(),r=Vr();let n;function s(){if(n)return n;const c=e.Util.createCanvasElement(),d=c.getContext("2d");return n=(function(){const f=r.Konva._global.devicePixelRatio||1,p=d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1;return f/p})(),e.Util.releaseCanvas(c),n}let a=class{constructor(d){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const p=(d||{}).pixelRatio||r.Konva.pixelRatio||s();this.pixelRatio=p,this._canvas=e.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(d){const f=this.pixelRatio;this.pixelRatio=d,this.setSize(this.getWidth()/f,this.getHeight()/f)}setWidth(d){this.width=this._canvas.width=d*this.pixelRatio,this._canvas.style.width=d+"px";const f=this.pixelRatio;this.getContext()._context.scale(f,f)}setHeight(d){this.height=this._canvas.height=d*this.pixelRatio,this._canvas.style.height=d+"px";const f=this.pixelRatio;this.getContext()._context.scale(f,f)}getWidth(){return this.width}getHeight(){return this.height}setSize(d,f){this.setWidth(d||0),this.setHeight(f||0)}toDataURL(d,f){try{return this._canvas.toDataURL(d,f)}catch{try{return this._canvas.toDataURL()}catch(g){return e.Util.error("Unable to get data URL. "+g.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};xc.Canvas=a;class i extends a{constructor(d={width:0,height:0,willReadFrequently:!1}){super(d),this.context=new t.SceneContext(this,{willReadFrequently:d.willReadFrequently}),this.setSize(d.width,d.height)}}xc.SceneCanvas=i;class l extends a{constructor(d={width:0,height:0}){super(d),this.hitCanvas=!0,this.context=new t.HitContext(this),this.setSize(d.width,d.height)}}return xc.HitCanvas=l,xc}var fw={},nT;function ib(){return nT||(nT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;const t=Vr(),r=ps();e.DD={get isDragging(){let n=!1;return e.DD._dragElements.forEach(s=>{s.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return e.DD._dragElements.forEach(s=>{n=s.node}),n},_dragElements:new Map,_drag(n){const s=[];e.DD._dragElements.forEach((a,i)=>{const{node:l}=a,c=l.getStage();c.setPointersPositions(n),a.pointerId===void 0&&(a.pointerId=r.Util._getFirstPointerId(n));const d=c._changedPointerPositions.find(f=>f.id===a.pointerId);if(d){if(a.dragStatus!=="dragging"){const f=l.dragDistance();if(Math.max(Math.abs(d.x-a.startPointerPos.x),Math.abs(d.y-a.startPointerPos.y))<f||(l.startDrag({evt:n}),!l.isDragging()))return}l._setDragPosition(n,a),s.push(l)}}),s.forEach(a=>{a.fire("dragmove",{type:"dragmove",target:a,evt:n},!0)})},_endDragBefore(n){const s=[];e.DD._dragElements.forEach(a=>{const{node:i}=a,l=i.getStage();if(n&&l.setPointersPositions(n),!l._changedPointerPositions.find(f=>f.id===a.pointerId))return;(a.dragStatus==="dragging"||a.dragStatus==="stopped")&&(e.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,a.dragStatus="stopped");const d=a.node.getLayer()||a.node instanceof t.Konva.Stage&&a.node;d&&s.indexOf(d)===-1&&s.push(d)}),s.forEach(a=>{a.draw()})},_endDragAfter(n){e.DD._dragElements.forEach((s,a)=>{s.dragStatus==="stopped"&&s.node.fire("dragend",{type:"dragend",target:s.node,evt:n},!0),s.dragStatus!=="dragging"&&e.DD._dragElements.delete(a)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("touchcancel",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1),window.addEventListener("touchcancel",e.DD._endDragAfter,!1))})(fw)),fw}var hw={},Ni={},sT;function en(){if(sT)return Ni;sT=1,Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.RGBComponent=n,Ni.alphaComponent=s,Ni.getNumberValidator=a,Ni.getNumberOrArrayOfNumbersValidator=i,Ni.getNumberOrAutoValidator=l,Ni.getStringValidator=c,Ni.getStringOrGradientValidator=d,Ni.getFunctionValidator=f,Ni.getNumberArrayValidator=p,Ni.getBooleanValidator=g,Ni.getComponentValidator=y;const e=Vr(),t=ps();function r(v){return t.Util._isString(v)?'"'+v+'"':Object.prototype.toString.call(v)==="[object Number]"||t.Util._isBoolean(v)?v:Object.prototype.toString.call(v)}function n(v){return v>255?255:v<0?0:Math.round(v)}function s(v){return v>1?1:v<1e-4?1e-4:v}function a(){if(e.Konva.isUnminified)return function(v,w){return t.Util._isNumber(v)||t.Util.warn(r(v)+' is a not valid value for "'+w+'" attribute. The value should be a number.'),v}}function i(v){if(e.Konva.isUnminified)return function(w,b){let E=t.Util._isNumber(w),k=t.Util._isArray(w)&&w.length==v;return!E&&!k&&t.Util.warn(r(w)+' is a not valid value for "'+b+'" attribute. The value should be a number or Array<number>('+v+")"),w}}function l(){if(e.Konva.isUnminified)return function(v,w){return t.Util._isNumber(v)||v==="auto"||t.Util.warn(r(v)+' is a not valid value for "'+w+'" attribute. The value should be a number or "auto".'),v}}function c(){if(e.Konva.isUnminified)return function(v,w){return t.Util._isString(v)||t.Util.warn(r(v)+' is a not valid value for "'+w+'" attribute. The value should be a string.'),v}}function d(){if(e.Konva.isUnminified)return function(v,w){const b=t.Util._isString(v),E=Object.prototype.toString.call(v)==="[object CanvasGradient]"||v&&v.addColorStop;return b||E||t.Util.warn(r(v)+' is a not valid value for "'+w+'" attribute. The value should be a string or a native gradient.'),v}}function f(){if(e.Konva.isUnminified)return function(v,w){return t.Util._isFunction(v)||t.Util.warn(r(v)+' is a not valid value for "'+w+'" attribute. The value should be a function.'),v}}function p(){if(e.Konva.isUnminified)return function(v,w){const b=Int8Array?Object.getPrototypeOf(Int8Array):null;return b&&v instanceof b||(t.Util._isArray(v)?v.forEach(function(E){t.Util._isNumber(E)||t.Util.warn('"'+w+'" attribute has non numeric element '+E+". Make sure that all elements are numbers.")}):t.Util.warn(r(v)+' is a not valid value for "'+w+'" attribute. The value should be a array of numbers.')),v}}function g(){if(e.Konva.isUnminified)return function(v,w){return v===!0||v===!1||t.Util.warn(r(v)+' is a not valid value for "'+w+'" attribute. The value should be a boolean.'),v}}function y(v){if(e.Konva.isUnminified)return function(w,b){return w==null||t.Util.isObject(w)||t.Util.warn(r(w)+' is a not valid value for "'+b+'" attribute. The value should be an object with properties '+v),w}}return Ni}var aT;function Qr(){return aT||(aT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const t=ps(),r=en(),n="get",s="set";e.Factory={addGetterSetter(a,i,l,c,d){e.Factory.addGetter(a,i,l),e.Factory.addSetter(a,i,c,d),e.Factory.addOverloadedGetterSetter(a,i)},addGetter(a,i,l){const c=n+t.Util._capitalize(i);a.prototype[c]=a.prototype[c]||function(){const d=this.attrs[i];return d===void 0?l:d}},addSetter(a,i,l,c){const d=s+t.Util._capitalize(i);a.prototype[d]||e.Factory.overWriteSetter(a,i,l,c)},overWriteSetter(a,i,l,c){const d=s+t.Util._capitalize(i);a.prototype[d]=function(f){return l&&f!==void 0&&f!==null&&(f=l.call(this,f,i)),this._setAttr(i,f),c&&c.call(this),this}},addComponentsGetterSetter(a,i,l,c,d){const f=l.length,p=t.Util._capitalize,g=n+p(i),y=s+p(i);a.prototype[g]=function(){const w={};for(let b=0;b<f;b++){const E=l[b];w[E]=this.getAttr(i+p(E))}return w};const v=(0,r.getComponentValidator)(l);a.prototype[y]=function(w){const b=this.attrs[i];c&&(w=c.call(this,w,i)),v&&v.call(this,w,i);for(const E in w)w.hasOwnProperty(E)&&this._setAttr(i+p(E),w[E]);return w||l.forEach(E=>{this._setAttr(i+p(E),void 0)}),this._fireChangeEvent(i,b,w),d&&d.call(this),this},e.Factory.addOverloadedGetterSetter(a,i)},addOverloadedGetterSetter(a,i){const l=t.Util._capitalize(i),c=s+l,d=n+l;a.prototype[i]=function(){return arguments.length?(this[c](arguments[0]),this):this[d]()}},addDeprecatedGetterSetter(a,i,l,c){t.Util.error("Adding deprecated "+i);const d=n+t.Util._capitalize(i),f=i+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[d]=function(){t.Util.error(f);const p=this.attrs[i];return p===void 0?l:p},e.Factory.addSetter(a,i,c,function(){t.Util.error(f)}),e.Factory.addOverloadedGetterSetter(a,i)},backCompat(a,i){t.Util.each(i,function(l,c){const d=a.prototype[c],f=n+t.Util._capitalize(l),p=s+t.Util._capitalize(l);function g(){d.apply(this,arguments),t.Util.error('"'+l+'" method is deprecated and will be removed soon. Use ""'+c+'" instead.')}a.prototype[l]=g,a.prototype[f]=g,a.prototype[p]=g})},afterSetFilter(){this._filterUpToDate=!1}}})(hw)),hw}var iT;function Ns(){if(iT)return Pg;iT=1,Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.Node=void 0;const e=M1(),t=ib(),r=Qr(),n=Vr(),s=ps(),a=en(),i="absoluteOpacity",l="allEventListeners",c="absoluteTransform",d="absoluteScale",f="canvas",p="Change",g="children",y="konva",v="listening",w="mouseenter",b="mouseleave",E="pointerenter",k="pointerleave",_="touchenter",T="touchleave",j="set",P="Shape",R=" ",N="stage",A="transform",M="Stage",H="visible",Q=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(R);let Z=1,ae=class T_{constructor(L){this._id=Z++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(L),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(L){(L===A||L===c)&&this._cache.get(L)?this._cache.get(L).dirty=!0:L?this._cache.delete(L):this._cache.clear()}_getCache(L,G){let I=this._cache.get(L);return(I===void 0||(L===A||L===c)&&I.dirty===!0)&&(I=G.call(this),this._cache.set(L,I)),I}_calculate(L,G,I){if(!this._attachedDepsListeners.get(L)){const z=G.map(V=>V+"Change.konva").join(R);this.on(z,()=>{this._clearCache(L)}),this._attachedDepsListeners.set(L,!0)}return this._getCache(L,I)}_getCanvasCache(){return this._cache.get(f)}_clearSelfAndDescendantCache(L){this._clearCache(L),L===c&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(f)){const{scene:L,filter:G,hit:I,buffer:z}=this._cache.get(f);s.Util.releaseCanvas(L,G,I,z),this._cache.delete(f)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(L){const G=L||{};let I={};(G.x===void 0||G.y===void 0||G.width===void 0||G.height===void 0)&&(I=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let z=Math.ceil(G.width||I.width),V=Math.ceil(G.height||I.height),O=G.pixelRatio,W=G.x===void 0?Math.floor(I.x):G.x,q=G.y===void 0?Math.floor(I.y):G.y,Y=G.offset||0,ee=G.drawBorder||!1,X=G.hitCanvasPixelRatio||1;if(!z||!V){s.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const ne=Math.abs(Math.round(I.x)-W)>.5?1:0,ge=Math.abs(Math.round(I.y)-q)>.5?1:0;z+=Y*2+ne,V+=Y*2+ge,W-=Y,q-=Y;const _e=new e.SceneCanvas({pixelRatio:O,width:z,height:V}),Pe=new e.SceneCanvas({pixelRatio:O,width:0,height:0,willReadFrequently:!0}),ce=new e.HitCanvas({pixelRatio:X,width:z,height:V}),ye=_e.getContext(),Fe=ce.getContext(),Me=new e.SceneCanvas({width:_e.width/_e.pixelRatio+Math.abs(W),height:_e.height/_e.pixelRatio+Math.abs(q),pixelRatio:_e.pixelRatio}),Oe=Me.getContext();return ce.isCache=!0,_e.isCache=!0,this._cache.delete(f),this._filterUpToDate=!1,G.imageSmoothingEnabled===!1&&(_e.getContext()._context.imageSmoothingEnabled=!1,Pe.getContext()._context.imageSmoothingEnabled=!1),ye.save(),Fe.save(),Oe.save(),ye.translate(-W,-q),Fe.translate(-W,-q),Oe.translate(-W,-q),Me.x=W,Me.y=q,this._isUnderCache=!0,this._clearSelfAndDescendantCache(i),this._clearSelfAndDescendantCache(d),this.drawScene(_e,this,Me),this.drawHit(ce,this),this._isUnderCache=!1,ye.restore(),Fe.restore(),ee&&(ye.save(),ye.beginPath(),ye.rect(0,0,z,V),ye.closePath(),ye.setAttr("strokeStyle","red"),ye.setAttr("lineWidth",5),ye.stroke(),ye.restore()),this._cache.set(f,{scene:_e,filter:Pe,hit:ce,buffer:Me,x:W,y:q}),this._requestDraw(),this}isCached(){return this._cache.has(f)}getClientRect(L){throw new Error('abstract "getClientRect" method call')}_transformedRect(L,G){const I=[{x:L.x,y:L.y},{x:L.x+L.width,y:L.y},{x:L.x+L.width,y:L.y+L.height},{x:L.x,y:L.y+L.height}];let z=1/0,V=1/0,O=-1/0,W=-1/0;const q=this.getAbsoluteTransform(G);return I.forEach(function(Y){const ee=q.point(Y);z===void 0&&(z=O=ee.x,V=W=ee.y),z=Math.min(z,ee.x),V=Math.min(V,ee.y),O=Math.max(O,ee.x),W=Math.max(W,ee.y)}),{x:z,y:V,width:O-z,height:W-V}}_drawCachedSceneCanvas(L){L.save(),L._applyOpacity(this),L._applyGlobalCompositeOperation(this);const G=this._getCanvasCache();L.translate(G.x,G.y);const I=this._getCachedSceneCanvas(),z=I.pixelRatio;L.drawImage(I._canvas,0,0,I.width/z,I.height/z),L.restore()}_drawCachedHitCanvas(L){const G=this._getCanvasCache(),I=G.hit;L.save(),L.translate(G.x,G.y),L.drawImage(I._canvas,0,0,I.width/I.pixelRatio,I.height/I.pixelRatio),L.restore()}_getCachedSceneCanvas(){let L=this.filters(),G=this._getCanvasCache(),I=G.scene,z=G.filter,V=z.getContext(),O,W,q,Y;if(L){if(!this._filterUpToDate){const ee=I.pixelRatio;z.setSize(I.width/I.pixelRatio,I.height/I.pixelRatio);try{for(O=L.length,V.clear(),V.drawImage(I._canvas,0,0,I.getWidth()/ee,I.getHeight()/ee),W=V.getImageData(0,0,z.getWidth(),z.getHeight()),q=0;q<O;q++){if(Y=L[q],typeof Y!="function"){s.Util.error("Filter should be type of function, but got "+typeof Y+" instead. Please check correct filters");continue}Y.call(this,W),V.putImageData(W,0,0)}}catch(X){s.Util.error("Unable to apply filter. "+X.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return z}return I}on(L,G){if(this._cache&&this._cache.delete(l),arguments.length===3)return this._delegate.apply(this,arguments);const I=L.split(R);for(let z=0;z<I.length;z++){const O=I[z].split("."),W=O[0],q=O[1]||"";this.eventListeners[W]||(this.eventListeners[W]=[]),this.eventListeners[W].push({name:q,handler:G})}return this}off(L,G){let I=(L||"").split(R),z=I.length,V,O,W,q,Y,ee;if(this._cache&&this._cache.delete(l),!L)for(O in this.eventListeners)this._off(O);for(V=0;V<z;V++)if(W=I[V],q=W.split("."),Y=q[0],ee=q[1],Y)this.eventListeners[Y]&&this._off(Y,ee,G);else for(O in this.eventListeners)this._off(O,ee,G);return this}dispatchEvent(L){const G={target:this,type:L.type,evt:L};return this.fire(L.type,G),this}addEventListener(L,G){return this.on(L,function(I){G.call(this,I.evt)}),this}removeEventListener(L){return this.off(L),this}_delegate(L,G,I){const z=this;this.on(L,function(V){const O=V.target.findAncestors(G,!0,z);for(let W=0;W<O.length;W++)V=s.Util.cloneObject(V),V.currentTarget=O[W],I.call(O[W],V)})}remove(){return this.isDragging()&&this.stopDrag(),t.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(i),this._clearSelfAndDescendantCache(d),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(H),this._clearSelfAndDescendantCache(v)}_remove(){this._clearCaches();const L=this.getParent();L&&L.children&&(L.children.splice(this.index,1),L._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(L){const G="get"+s.Util._capitalize(L);return s.Util._isFunction(this[G])?this[G]():this.attrs[L]}getAncestors(){let L=this.getParent(),G=[];for(;L;)G.push(L),L=L.getParent();return G}getAttrs(){return this.attrs||{}}setAttrs(L){return this._batchTransformChanges(()=>{let G,I;if(!L)return this;for(G in L)G!==g&&(I=j+s.Util._capitalize(G),s.Util._isFunction(this[I])?this[I](L[G]):this._setAttr(G,L[G]))}),this}isListening(){return this._getCache(v,this._isListening)}_isListening(L){if(!this.listening())return!1;const I=this.getParent();return I&&I!==L&&this!==L?I._isListening(L):!0}isVisible(){return this._getCache(H,this._isVisible)}_isVisible(L){if(!this.visible())return!1;const I=this.getParent();return I&&I!==L&&this!==L?I._isVisible(L):!0}shouldDrawHit(L,G=!1){if(L)return this._isVisible(L)&&this._isListening(L);const I=this.getLayer();let z=!1;t.DD._dragElements.forEach(O=>{O.dragStatus==="dragging"&&(O.node.nodeType==="Stage"||O.node.getLayer()===I)&&(z=!0)});const V=!G&&!n.Konva.hitOnDragEnabled&&(z||n.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!V}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let L=this.getDepth(),G=this,I=0,z,V,O,W;function q(ee){for(z=[],V=ee.length,O=0;O<V;O++)W=ee[O],I++,W.nodeType!==P&&(z=z.concat(W.getChildren().slice())),W._id===G._id&&(O=V);z.length>0&&z[0].getDepth()<=L&&q(z)}const Y=this.getStage();return G.nodeType!==M&&Y&&q(Y.getChildren()),I}getDepth(){let L=0,G=this.parent;for(;G;)L++,G=G.parent;return L}_batchTransformChanges(L){this._batchingTransformChange=!0,L(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(A),this._clearSelfAndDescendantCache(c)),this._needClearTransformCache=!1}setPosition(L){return this._batchTransformChanges(()=>{this.x(L.x),this.y(L.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const L=this.getStage();if(!L)return null;const G=L.getPointerPosition();if(!G)return null;const I=this.getAbsoluteTransform().copy();return I.invert(),I.point(G)}getAbsolutePosition(L){let G=!1,I=this.parent;for(;I;){if(I.isCached()){G=!0;break}I=I.parent}G&&!L&&(L=!0);const z=this.getAbsoluteTransform(L).getMatrix(),V=new s.Transform,O=this.offset();return V.m=z.slice(),V.translate(O.x,O.y),V.getTranslation()}setAbsolutePosition(L){const{x:G,y:I,...z}=this._clearTransform();this.attrs.x=G,this.attrs.y=I,this._clearCache(A);const V=this._getAbsoluteTransform().copy();return V.invert(),V.translate(L.x,L.y),L={x:this.attrs.x+V.getTranslation().x,y:this.attrs.y+V.getTranslation().y},this._setTransform(z),this.setPosition({x:L.x,y:L.y}),this._clearCache(A),this._clearSelfAndDescendantCache(c),this}_setTransform(L){let G;for(G in L)this.attrs[G]=L[G]}_clearTransform(){const L={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,L}move(L){let G=L.x,I=L.y,z=this.x(),V=this.y();return G!==void 0&&(z+=G),I!==void 0&&(V+=I),this.setPosition({x:z,y:V}),this}_eachAncestorReverse(L,G){let I=[],z=this.getParent(),V,O;if(!(G&&G._id===this._id)){for(I.unshift(this);z&&(!G||z._id!==G._id);)I.unshift(z),z=z.parent;for(V=I.length,O=0;O<V;O++)L(I[O])}}rotate(L){return this.rotation(this.rotation()+L),this}moveToTop(){if(!this.parent)return s.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const L=this.index,G=this.parent.getChildren().length;return L<G-1?(this.parent.children.splice(L,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return s.Util.warn("Node has no parent. moveUp function is ignored."),!1;const L=this.index,G=this.parent.getChildren().length;return L<G-1?(this.parent.children.splice(L,1),this.parent.children.splice(L+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return s.Util.warn("Node has no parent. moveDown function is ignored."),!1;const L=this.index;return L>0?(this.parent.children.splice(L,1),this.parent.children.splice(L-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return s.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const L=this.index;return L>0?(this.parent.children.splice(L,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(L){if(!this.parent)return s.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(L<0||L>=this.parent.children.length)&&s.Util.warn("Unexpected value "+L+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const G=this.index;return this.parent.children.splice(G,1),this.parent.children.splice(L,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(i,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let L=this.opacity();const G=this.getParent();return G&&!G._isUnderCache&&(L*=G.getAbsoluteOpacity()),L}moveTo(L){return this.getParent()!==L&&(this._remove(),L.add(this)),this}toObject(){let L=this.getAttrs(),G,I,z,V,O;const W={attrs:{},className:this.getClassName()};for(G in L)I=L[G],O=s.Util.isObject(I)&&!s.Util._isPlainObject(I)&&!s.Util._isArray(I),!O&&(z=typeof this[G]=="function"&&this[G],delete L[G],V=z?z.call(this):null,L[G]=I,V!==I&&(W.attrs[G]=I));return s.Util._prepareToStringify(W)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(L,G,I){const z=[];G&&this._isMatch(L)&&z.push(this);let V=this.parent;for(;V;){if(V===I)return z;V._isMatch(L)&&z.push(V),V=V.parent}return z}isAncestorOf(L){return!1}findAncestor(L,G,I){return this.findAncestors(L,G,I)[0]}_isMatch(L){if(!L)return!1;if(typeof L=="function")return L(this);let G=L.replace(/ /g,"").split(","),I=G.length,z,V;for(z=0;z<I;z++)if(V=G[z],s.Util.isValidSelector(V)||(s.Util.warn('Selector "'+V+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),s.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),s.Util.warn("Konva is awesome, right?")),V.charAt(0)==="#"){if(this.id()===V.slice(1))return!0}else if(V.charAt(0)==="."){if(this.hasName(V.slice(1)))return!0}else if(this.className===V||this.nodeType===V)return!0;return!1}getLayer(){const L=this.getParent();return L?L.getLayer():null}getStage(){return this._getCache(N,this._getStage)}_getStage(){const L=this.getParent();return L?L.getStage():null}fire(L,G={},I){return G.target=G.target||this,I?this._fireAndBubble(L,G):this._fire(L,G),this}getAbsoluteTransform(L){return L?this._getAbsoluteTransform(L):this._getCache(c,this._getAbsoluteTransform)}_getAbsoluteTransform(L){let G;if(L)return G=new s.Transform,this._eachAncestorReverse(function(I){const z=I.transformsEnabled();z==="all"?G.multiply(I.getTransform()):z==="position"&&G.translate(I.x()-I.offsetX(),I.y()-I.offsetY())},L),G;{G=this._cache.get(c)||new s.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(G):G.reset();const I=this.transformsEnabled();if(I==="all")G.multiply(this.getTransform());else if(I==="position"){const z=this.attrs.x||0,V=this.attrs.y||0,O=this.attrs.offsetX||0,W=this.attrs.offsetY||0;G.translate(z-O,V-W)}return G.dirty=!1,G}}getAbsoluteScale(L){let G=this;for(;G;)G._isUnderCache&&(L=G),G=G.getParent();const z=this.getAbsoluteTransform(L).decompose();return{x:z.scaleX,y:z.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(A,this._getTransform)}_getTransform(){var L,G;const I=this._cache.get(A)||new s.Transform;I.reset();const z=this.x(),V=this.y(),O=n.Konva.getAngle(this.rotation()),W=(L=this.attrs.scaleX)!==null&&L!==void 0?L:1,q=(G=this.attrs.scaleY)!==null&&G!==void 0?G:1,Y=this.attrs.skewX||0,ee=this.attrs.skewY||0,X=this.attrs.offsetX||0,ne=this.attrs.offsetY||0;return(z!==0||V!==0)&&I.translate(z,V),O!==0&&I.rotate(O),(Y!==0||ee!==0)&&I.skew(Y,ee),(W!==1||q!==1)&&I.scale(W,q),(X!==0||ne!==0)&&I.translate(-1*X,-1*ne),I.dirty=!1,I}clone(L){let G=s.Util.cloneObject(this.attrs),I,z,V,O,W;for(I in L)G[I]=L[I];const q=new this.constructor(G);for(I in this.eventListeners)for(z=this.eventListeners[I],V=z.length,O=0;O<V;O++)W=z[O],W.name.indexOf(y)<0&&(q.eventListeners[I]||(q.eventListeners[I]=[]),q.eventListeners[I].push(W));return q}_toKonvaCanvas(L){L=L||{};const G=this.getClientRect(),I=this.getStage(),z=L.x!==void 0?L.x:Math.floor(G.x),V=L.y!==void 0?L.y:Math.floor(G.y),O=L.pixelRatio||1,W=new e.SceneCanvas({width:L.width||Math.ceil(G.width)||(I?I.width():0),height:L.height||Math.ceil(G.height)||(I?I.height():0),pixelRatio:O}),q=W.getContext(),Y=new e.SceneCanvas({width:W.width/W.pixelRatio+Math.abs(z),height:W.height/W.pixelRatio+Math.abs(V),pixelRatio:W.pixelRatio});return L.imageSmoothingEnabled===!1&&(q._context.imageSmoothingEnabled=!1),q.save(),(z||V)&&q.translate(-1*z,-1*V),this.drawScene(W,void 0,Y),q.restore(),W}toCanvas(L){return this._toKonvaCanvas(L)._canvas}toDataURL(L){L=L||{};const G=L.mimeType||null,I=L.quality||null,z=this._toKonvaCanvas(L).toDataURL(G,I);return L.callback&&L.callback(z),z}toImage(L){return new Promise((G,I)=>{try{const z=L?.callback;z&&delete L.callback,s.Util._urlToImage(this.toDataURL(L),function(V){G(V),z?.(V)})}catch(z){I(z)}})}toBlob(L){return new Promise((G,I)=>{try{const z=L?.callback;z&&delete L.callback,this.toCanvas(L).toBlob(V=>{G(V),z?.(V)},L?.mimeType,L?.quality)}catch(z){I(z)}})}setSize(L){return this.width(L.width),this.height(L.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.Konva.dragDistance}_off(L,G,I){let z=this.eventListeners[L],V,O,W;for(V=0;V<z.length;V++)if(O=z[V].name,W=z[V].handler,(O!=="konva"||G==="konva")&&(!G||O===G)&&(!I||I===W)){if(z.splice(V,1),z.length===0){delete this.eventListeners[L];break}V--}}_fireChangeEvent(L,G,I){this._fire(L+p,{oldVal:G,newVal:I})}addName(L){if(!this.hasName(L)){const G=this.name(),I=G?G+" "+L:L;this.name(I)}return this}hasName(L){if(!L)return!1;const G=this.name();return G?(G||"").split(/\s/g).indexOf(L)!==-1:!1}removeName(L){const G=(this.name()||"").split(/\s/g),I=G.indexOf(L);return I!==-1&&(G.splice(I,1),this.name(G.join(" "))),this}setAttr(L,G){const I=this[j+s.Util._capitalize(L)];return s.Util._isFunction(I)?I.call(this,G):this._setAttr(L,G),this}_requestDraw(){if(n.Konva.autoDrawEnabled){const L=this.getLayer()||this.getStage();L?.batchDraw()}}_setAttr(L,G){const I=this.attrs[L];I===G&&!s.Util.isObject(G)||(G==null?delete this.attrs[L]:this.attrs[L]=G,this._shouldFireChangeEvents&&this._fireChangeEvent(L,I,G),this._requestDraw())}_setComponentAttr(L,G,I){let z;I!==void 0&&(z=this.attrs[L],z||(this.attrs[L]=this.getAttr(L)),this.attrs[L][G]=I,this._fireChangeEvent(L,z,I))}_fireAndBubble(L,G,I){G&&this.nodeType===P&&(G.target=this);const z=[w,b,E,k,_,T];if(!(z.indexOf(L)!==-1&&(I&&(this===I||this.isAncestorOf&&this.isAncestorOf(I))||this.nodeType==="Stage"&&!I))){this._fire(L,G);const O=z.indexOf(L)!==-1&&I&&I.isAncestorOf&&I.isAncestorOf(this)&&!I.isAncestorOf(this.parent);(G&&!G.cancelBubble||!G)&&this.parent&&this.parent.isListening()&&!O&&(I&&I.parent?this._fireAndBubble.call(this.parent,L,G,I):this._fireAndBubble.call(this.parent,L,G))}}_getProtoListeners(L){var G,I,z;const V=(G=this._cache.get(l))!==null&&G!==void 0?G:{};let O=V?.[L];if(O===void 0){O=[];let W=Object.getPrototypeOf(this);for(;W;){const q=(z=(I=W.eventListeners)===null||I===void 0?void 0:I[L])!==null&&z!==void 0?z:[];O.push(...q),W=Object.getPrototypeOf(W)}V[L]=O,this._cache.set(l,V)}return O}_fire(L,G){G=G||{},G.currentTarget=this,G.type=L;const I=this._getProtoListeners(L);if(I)for(let V=0;V<I.length;V++)I[V].handler.call(this,G);const z=this.eventListeners[L];if(z)for(let V=0;V<z.length;V++)z[V].handler.call(this,G)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(L){const G=L?L.pointerId:void 0,I=this.getStage(),z=this.getAbsolutePosition();if(!I)return;const V=I._getPointerById(G)||I._changedPointerPositions[0]||z;t.DD._dragElements.set(this._id,{node:this,startPointerPos:V,offset:{x:V.x-z.x,y:V.y-z.y},dragStatus:"ready",pointerId:G})}startDrag(L,G=!0){t.DD._dragElements.has(this._id)||this._createDragElement(L);const I=t.DD._dragElements.get(this._id);I.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:L&&L.evt},G)}_setDragPosition(L,G){const I=this.getStage()._getPointerById(G.pointerId);if(!I)return;let z={x:I.x-G.offset.x,y:I.y-G.offset.y};const V=this.dragBoundFunc();if(V!==void 0){const O=V.call(this,z,L);O?z=O:s.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==z.x||this._lastPos.y!==z.y)&&(this.setAbsolutePosition(z),this._requestDraw()),this._lastPos=z}stopDrag(L){const G=t.DD._dragElements.get(this._id);G&&(G.dragStatus="stopped"),t.DD._endDragBefore(L),t.DD._endDragAfter(L)}setDraggable(L){this._setAttr("draggable",L),this._dragChange()}isDragging(){const L=t.DD._dragElements.get(this._id);return L?L.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(L){if(!(!(L.evt.button!==void 0)||n.Konva.dragButtons.indexOf(L.evt.button)>=0)||this.isDragging())return;let z=!1;t.DD._dragElements.forEach(V=>{this.isAncestorOf(V.node)&&(z=!0)}),z||this._createDragElement(L)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const G=t.DD._dragElements.get(this._id),I=G&&G.dragStatus==="dragging",z=G&&G.dragStatus==="ready";I?this.stopDrag():z&&t.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(L={x:0,y:0}){const G=this.getStage();if(!G)return!1;const I={x:-L.x,y:-L.y,width:G.width()+2*L.x,height:G.height()+2*L.y};return s.Util.haveIntersection(I,this.getClientRect())}static create(L,G){return s.Util._isString(L)&&(L=JSON.parse(L)),this._createNode(L,G)}static _createNode(L,G){let I=T_.prototype.getClassName.call(L),z=L.children,V,O,W;G&&(L.attrs.container=G),n.Konva[I]||(s.Util.warn('Can not find a node with class name "'+I+'". Fallback to "Shape".'),I="Shape");const q=n.Konva[I];if(V=new q(L.attrs),z)for(O=z.length,W=0;W<O;W++)V.add(T_._createNode(z[W]));return V}};Pg.Node=ae,ae.prototype.nodeType="Node",ae.prototype._attrsAffectingSize=[],ae.prototype.eventListeners={},ae.prototype.on.call(ae.prototype,Q,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(A),this._clearSelfAndDescendantCache(c)}),ae.prototype.on.call(ae.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(H)}),ae.prototype.on.call(ae.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(v)}),ae.prototype.on.call(ae.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(i)});const te=r.Factory.addGetterSetter;return te(ae,"zIndex"),te(ae,"absolutePosition"),te(ae,"position"),te(ae,"x",0,(0,a.getNumberValidator)()),te(ae,"y",0,(0,a.getNumberValidator)()),te(ae,"globalCompositeOperation","source-over",(0,a.getStringValidator)()),te(ae,"opacity",1,(0,a.getNumberValidator)()),te(ae,"name","",(0,a.getStringValidator)()),te(ae,"id","",(0,a.getStringValidator)()),te(ae,"rotation",0,(0,a.getNumberValidator)()),r.Factory.addComponentsGetterSetter(ae,"scale",["x","y"]),te(ae,"scaleX",1,(0,a.getNumberValidator)()),te(ae,"scaleY",1,(0,a.getNumberValidator)()),r.Factory.addComponentsGetterSetter(ae,"skew",["x","y"]),te(ae,"skewX",0,(0,a.getNumberValidator)()),te(ae,"skewY",0,(0,a.getNumberValidator)()),r.Factory.addComponentsGetterSetter(ae,"offset",["x","y"]),te(ae,"offsetX",0,(0,a.getNumberValidator)()),te(ae,"offsetY",0,(0,a.getNumberValidator)()),te(ae,"dragDistance",void 0,(0,a.getNumberValidator)()),te(ae,"width",0,(0,a.getNumberValidator)()),te(ae,"height",0,(0,a.getNumberValidator)()),te(ae,"listening",!0,(0,a.getBooleanValidator)()),te(ae,"preventDefault",!0,(0,a.getBooleanValidator)()),te(ae,"filters",void 0,function(se){return this._filterUpToDate=!1,se}),te(ae,"visible",!0,(0,a.getBooleanValidator)()),te(ae,"transformsEnabled","all",(0,a.getStringValidator)()),te(ae,"size"),te(ae,"dragBoundFunc"),te(ae,"draggable",!1,(0,a.getBooleanValidator)()),r.Factory.backCompat(ae,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Pg}var Rg={},oT;function O1(){if(oT)return Rg;oT=1,Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.Container=void 0;const e=Qr(),t=Ns(),r=en();let n=class extends t.Node{constructor(){super(...arguments),this.children=[]}getChildren(a){const i=this.children||[];return a?i.filter(a):i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.destroy()}),this.children=[],this._requestDraw(),this}add(...a){if(a.length===0)return this;if(a.length>1){for(let l=0;l<a.length;l++)this.add(a[l]);return this}const i=a[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(a){return this._generalFind(a,!1)}findOne(a){const i=this._generalFind(a,!0);return i.length>0?i[0]:void 0}_generalFind(a,i){const l=[];return this._descendants(c=>{const d=c._isMatch(a);return d&&l.push(c),!!(d&&i)}),l}_descendants(a){let i=!1;const l=this.getChildren();for(const c of l){if(i=a(c),i)return!0;if(c.hasChildren()&&(i=c._descendants(a),i))return!0}return!1}toObject(){const a=t.Node.prototype.toObject.call(this);return a.children=[],this.getChildren().forEach(i=>{a.children.push(i.toObject())}),a}isAncestorOf(a){let i=a.getParent();for(;i;){if(i._id===this._id)return!0;i=i.getParent()}return!1}clone(a){const i=t.Node.prototype.clone.call(this,a);return this.getChildren().forEach(function(l){i.add(l.clone())}),i}getAllIntersections(a){const i=[];return this.find("Shape").forEach(l=>{l.isVisible()&&l.intersects(a)&&i.push(l)}),i}_clearSelfAndDescendantCache(a){var i;super._clearSelfAndDescendantCache(a),!this.isCached()&&((i=this.children)===null||i===void 0||i.forEach(function(l){l._clearSelfAndDescendantCache(a)}))}_setChildrenIndices(){var a;(a=this.children)===null||a===void 0||a.forEach(function(i,l){i.index=l}),this._requestDraw()}drawScene(a,i,l){const c=this.getLayer(),d=a||c&&c.getCanvas(),f=d&&d.getContext(),p=this._getCanvasCache(),g=p&&p.scene,y=d&&d.isCache;if(!this.isVisible()&&!y)return this;if(g){f.save();const v=this.getAbsoluteTransform(i).getMatrix();f.transform(v[0],v[1],v[2],v[3],v[4],v[5]),this._drawCachedSceneCanvas(f),f.restore()}else this._drawChildren("drawScene",d,i,l);return this}drawHit(a,i){if(!this.shouldDrawHit(i))return this;const l=this.getLayer(),c=a||l&&l.hitCanvas,d=c&&c.getContext(),f=this._getCanvasCache();if(f&&f.hit){d.save();const g=this.getAbsoluteTransform(i).getMatrix();d.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._drawCachedHitCanvas(d),d.restore()}else this._drawChildren("drawHit",c,i);return this}_drawChildren(a,i,l,c){var d;const f=i&&i.getContext(),p=this.clipWidth(),g=this.clipHeight(),y=this.clipFunc(),v=typeof p=="number"&&typeof g=="number"||y,w=l===this;if(v){f.save();const E=this.getAbsoluteTransform(l);let k=E.getMatrix();f.transform(k[0],k[1],k[2],k[3],k[4],k[5]),f.beginPath();let _;if(y)_=y.call(this,f,this);else{const T=this.clipX(),j=this.clipY();f.rect(T||0,j||0,p,g)}f.clip.apply(f,_),k=E.copy().invert().getMatrix(),f.transform(k[0],k[1],k[2],k[3],k[4],k[5])}const b=!w&&this.globalCompositeOperation()!=="source-over"&&a==="drawScene";b&&(f.save(),f._applyGlobalCompositeOperation(this)),(d=this.children)===null||d===void 0||d.forEach(function(E){E[a](i,l,c)}),b&&f.restore(),v&&f.restore()}getClientRect(a={}){var i;const l=a.skipTransform,c=a.relativeTo;let d,f,p,g,y={x:1/0,y:1/0,width:0,height:0};const v=this;(i=this.children)===null||i===void 0||i.forEach(function(E){if(!E.visible())return;const k=E.getClientRect({relativeTo:v,skipShadow:a.skipShadow,skipStroke:a.skipStroke});k.width===0&&k.height===0||(d===void 0?(d=k.x,f=k.y,p=k.x+k.width,g=k.y+k.height):(d=Math.min(d,k.x),f=Math.min(f,k.y),p=Math.max(p,k.x+k.width),g=Math.max(g,k.y+k.height)))});const w=this.find("Shape");let b=!1;for(let E=0;E<w.length;E++)if(w[E]._isVisible(this)){b=!0;break}return b&&d!==void 0?y={x:d,y:f,width:p-d,height:g-f}:y={x:0,y:0,width:0,height:0},l?y:this._transformedRect(y,c)}};return Rg.Container=n,e.Factory.addComponentsGetterSetter(n,"clip",["x","y","width","height"]),e.Factory.addGetterSetter(n,"clipX",void 0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(n,"clipY",void 0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(n,"clipWidth",void 0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(n,"clipHeight",void 0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(n,"clipFunc"),Rg}var gw={},Tu={},lT;function C6(){if(lT)return Tu;lT=1,Object.defineProperty(Tu,"__esModule",{value:!0}),Tu.getCapturedShape=n,Tu.createEvent=s,Tu.hasPointerCapture=a,Tu.setPointerCapture=i,Tu.releaseCapture=l;const e=Vr(),t=new Map,r=e.Konva._global.PointerEvent!==void 0;function n(c){return t.get(c)}function s(c){return{evt:c,pointerId:c.pointerId}}function a(c,d){return t.get(c)===d}function i(c,d){l(c),d.getStage()&&(t.set(c,d),r&&d._fire("gotpointercapture",s(new PointerEvent("gotpointercapture"))))}function l(c,d){const f=t.get(c);if(!f)return;const p=f.getStage();p&&p.content,t.delete(c),r&&f._fire("lostpointercapture",s(new PointerEvent("lostpointercapture")))}return Tu}var cT;function vM(){return cT||(cT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stage=e.stages=void 0;const t=ps(),r=Qr(),n=O1(),s=Vr(),a=M1(),i=ib(),l=Vr(),c=C6(),d="Stage",f="string",p="px",g="mouseout",y="mouseleave",v="mouseover",w="mouseenter",b="mousemove",E="mousedown",k="mouseup",_="pointermove",T="pointerdown",j="pointerup",P="pointercancel",R="lostpointercapture",N="pointerout",A="pointerleave",M="pointerover",H="pointerenter",Q="contextmenu",Z="touchstart",ae="touchend",te="touchmove",se="touchcancel",L="wheel",G=5,I=[[w,"_pointerenter"],[E,"_pointerdown"],[b,"_pointermove"],[k,"_pointerup"],[y,"_pointerleave"],[Z,"_pointerdown"],[te,"_pointermove"],[ae,"_pointerup"],[se,"_pointercancel"],[v,"_pointerover"],[L,"_wheel"],[Q,"_contextmenu"],[T,"_pointerdown"],[_,"_pointermove"],[j,"_pointerup"],[P,"_pointercancel"],[A,"_pointerleave"],[R,"_lostpointercapture"]],z={mouse:{[N]:g,[A]:y,[M]:v,[H]:w,[_]:b,[T]:E,[j]:k,[P]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[N]:"touchout",[A]:"touchleave",[M]:"touchover",[H]:"touchenter",[_]:te,[T]:Z,[j]:ae,[P]:se,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[N]:N,[A]:A,[M]:M,[H]:H,[_]:_,[T]:T,[j]:j,[P]:P,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},V=ee=>ee.indexOf("pointer")>=0?"pointer":ee.indexOf("touch")>=0?"touch":"mouse",O=ee=>{const X=V(ee);if(X==="pointer")return s.Konva.pointerEventsEnabled&&z.pointer;if(X==="touch")return z.touch;if(X==="mouse")return z.mouse};function W(ee={}){return(ee.clipFunc||ee.clipWidth||ee.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),ee}const q="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";e.stages=[];class Y extends n.Container{constructor(X){super(W(X)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),e.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{W(this.attrs)}),this._checkVisibility()}_validateAdd(X){const ne=X.getType()==="Layer",ge=X.getType()==="FastLayer";ne||ge||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const X=this.visible()?"":"none";this.content.style.display=X}setContainer(X){if(typeof X===f){let ne;if(X.charAt(0)==="."){const ge=X.slice(1);X=document.getElementsByClassName(ge)[0]}else X.charAt(0)!=="#"?ne=X:ne=X.slice(1),X=document.getElementById(ne);if(!X)throw"Can not find container in document with id "+ne}return this._setAttr("container",X),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),X.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const X=this.children,ne=X.length;for(let ge=0;ge<ne;ge++)X[ge].clear();return this}clone(X){return X||(X={}),X.container=typeof document<"u"&&document.createElement("div"),n.Container.prototype.clone.call(this,X)}destroy(){super.destroy();const X=this.content;X&&t.Util._isInDocument(X)&&this.container().removeChild(X);const ne=e.stages.indexOf(this);return ne>-1&&e.stages.splice(ne,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const X=this._pointerPositions[0]||this._changedPointerPositions[0];return X?{x:X.x,y:X.y}:(t.Util.warn(q),null)}_getPointerById(X){return this._pointerPositions.find(ne=>ne.id===X)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(X){X=X||{},X.x=X.x||0,X.y=X.y||0,X.width=X.width||this.width(),X.height=X.height||this.height();const ne=new a.SceneCanvas({width:X.width,height:X.height,pixelRatio:X.pixelRatio||1}),ge=ne.getContext()._context,_e=this.children;return(X.x||X.y)&&ge.translate(-1*X.x,-1*X.y),_e.forEach(function(Pe){if(!Pe.isVisible())return;const ce=Pe._toKonvaCanvas(X);ge.drawImage(ce._canvas,X.x,X.y,ce.getWidth()/ce.getPixelRatio(),ce.getHeight()/ce.getPixelRatio())}),ne}getIntersection(X){if(!X)return null;const ne=this.children,ge=ne.length,_e=ge-1;for(let Pe=_e;Pe>=0;Pe--){const ce=ne[Pe].getIntersection(X);if(ce)return ce}return null}_resizeDOM(){const X=this.width(),ne=this.height();this.content&&(this.content.style.width=X+p,this.content.style.height=ne+p),this.bufferCanvas.setSize(X,ne),this.bufferHitCanvas.setSize(X,ne),this.children.forEach(ge=>{ge.setSize({width:X,height:ne}),ge.draw()})}add(X,...ne){if(arguments.length>1){for(let _e=0;_e<arguments.length;_e++)this.add(arguments[_e]);return this}super.add(X);const ge=this.children.length;return ge>G&&t.Util.warn("The stage has "+ge+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),X.setSize({width:this.width(),height:this.height()}),X.draw(),s.Konva.isBrowser&&this.content.appendChild(X.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(X){return c.hasPointerCapture(X,this)}setPointerCapture(X){c.setPointerCapture(X,this)}releaseCapture(X){c.releaseCapture(X,this)}getLayers(){return this.children}_bindContentEvents(){s.Konva.isBrowser&&I.forEach(([X,ne])=>{this.content.addEventListener(X,ge=>{this[ne](ge)},{passive:!1})})}_pointerenter(X){this.setPointersPositions(X);const ne=O(X.type);ne&&this._fire(ne.pointerenter,{evt:X,target:this,currentTarget:this})}_pointerover(X){this.setPointersPositions(X);const ne=O(X.type);ne&&this._fire(ne.pointerover,{evt:X,target:this,currentTarget:this})}_getTargetShape(X){let ne=this[X+"targetShape"];return ne&&!ne.getStage()&&(ne=null),ne}_pointerleave(X){const ne=O(X.type),ge=V(X.type);if(!ne)return;this.setPointersPositions(X);const _e=this._getTargetShape(ge),Pe=!(s.Konva.isDragging()||s.Konva.isTransforming())||s.Konva.hitOnDragEnabled;_e&&Pe?(_e._fireAndBubble(ne.pointerout,{evt:X}),_e._fireAndBubble(ne.pointerleave,{evt:X}),this._fire(ne.pointerleave,{evt:X,target:this,currentTarget:this}),this[ge+"targetShape"]=null):Pe&&(this._fire(ne.pointerleave,{evt:X,target:this,currentTarget:this}),this._fire(ne.pointerout,{evt:X,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(X){const ne=O(X.type),ge=V(X.type);if(!ne)return;this.setPointersPositions(X);let _e=!1;this._changedPointerPositions.forEach(Pe=>{const ce=this.getIntersection(Pe);if(i.DD.justDragged=!1,s.Konva["_"+ge+"ListenClick"]=!0,!ce||!ce.isListening()){this[ge+"ClickStartShape"]=void 0;return}s.Konva.capturePointerEventsEnabled&&ce.setPointerCapture(Pe.id),this[ge+"ClickStartShape"]=ce,ce._fireAndBubble(ne.pointerdown,{evt:X,pointerId:Pe.id}),_e=!0;const ye=X.type.indexOf("touch")>=0;ce.preventDefault()&&X.cancelable&&ye&&X.preventDefault()}),_e||this._fire(ne.pointerdown,{evt:X,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(X){const ne=O(X.type),ge=V(X.type);if(!ne||(s.Konva.isDragging()&&i.DD.node.preventDefault()&&X.cancelable&&X.preventDefault(),this.setPointersPositions(X),!(!(s.Konva.isDragging()||s.Konva.isTransforming())||s.Konva.hitOnDragEnabled)))return;const Pe={};let ce=!1;const ye=this._getTargetShape(ge);this._changedPointerPositions.forEach(Fe=>{const Me=c.getCapturedShape(Fe.id)||this.getIntersection(Fe),Oe=Fe.id,He={evt:X,pointerId:Oe},It=ye!==Me;if(It&&ye&&(ye._fireAndBubble(ne.pointerout,{...He},Me),ye._fireAndBubble(ne.pointerleave,{...He},Me)),Me){if(Pe[Me._id])return;Pe[Me._id]=!0}Me&&Me.isListening()?(ce=!0,It&&(Me._fireAndBubble(ne.pointerover,{...He},ye),Me._fireAndBubble(ne.pointerenter,{...He},ye),this[ge+"targetShape"]=Me),Me._fireAndBubble(ne.pointermove,{...He})):ye&&(this._fire(ne.pointerover,{evt:X,target:this,currentTarget:this,pointerId:Oe}),this[ge+"targetShape"]=null)}),ce||this._fire(ne.pointermove,{evt:X,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(X){const ne=O(X.type),ge=V(X.type);if(!ne)return;this.setPointersPositions(X);const _e=this[ge+"ClickStartShape"],Pe=this[ge+"ClickEndShape"],ce={};let ye=!1;this._changedPointerPositions.forEach(Fe=>{const Me=c.getCapturedShape(Fe.id)||this.getIntersection(Fe);if(Me){if(Me.releaseCapture(Fe.id),ce[Me._id])return;ce[Me._id]=!0}const Oe=Fe.id,He={evt:X,pointerId:Oe};let It=!1;s.Konva["_"+ge+"InDblClickWindow"]?(It=!0,clearTimeout(this[ge+"DblTimeout"])):i.DD.justDragged||(s.Konva["_"+ge+"InDblClickWindow"]=!0,clearTimeout(this[ge+"DblTimeout"])),this[ge+"DblTimeout"]=setTimeout(function(){s.Konva["_"+ge+"InDblClickWindow"]=!1},s.Konva.dblClickWindow),Me&&Me.isListening()?(ye=!0,this[ge+"ClickEndShape"]=Me,Me._fireAndBubble(ne.pointerup,{...He}),s.Konva["_"+ge+"ListenClick"]&&_e&&_e===Me&&(Me._fireAndBubble(ne.pointerclick,{...He}),It&&Pe&&Pe===Me&&Me._fireAndBubble(ne.pointerdblclick,{...He}))):(this[ge+"ClickEndShape"]=null,s.Konva["_"+ge+"ListenClick"]&&this._fire(ne.pointerclick,{evt:X,target:this,currentTarget:this,pointerId:Oe}),It&&this._fire(ne.pointerdblclick,{evt:X,target:this,currentTarget:this,pointerId:Oe}))}),ye||this._fire(ne.pointerup,{evt:X,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),s.Konva["_"+ge+"ListenClick"]=!1,X.cancelable&&ge!=="touch"&&ge!=="pointer"&&X.preventDefault()}_contextmenu(X){this.setPointersPositions(X);const ne=this.getIntersection(this.getPointerPosition());ne&&ne.isListening()?ne._fireAndBubble(Q,{evt:X}):this._fire(Q,{evt:X,target:this,currentTarget:this})}_wheel(X){this.setPointersPositions(X);const ne=this.getIntersection(this.getPointerPosition());ne&&ne.isListening()?ne._fireAndBubble(L,{evt:X}):this._fire(L,{evt:X,target:this,currentTarget:this})}_pointercancel(X){this.setPointersPositions(X);const ne=c.getCapturedShape(X.pointerId)||this.getIntersection(this.getPointerPosition());ne&&ne._fireAndBubble(j,c.createEvent(X)),c.releaseCapture(X.pointerId)}_lostpointercapture(X){c.releaseCapture(X.pointerId)}setPointersPositions(X){const ne=this._getContentPosition();let ge=null,_e=null;X=X||window.event,X.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(X.touches,Pe=>{this._pointerPositions.push({id:Pe.identifier,x:(Pe.clientX-ne.left)/ne.scaleX,y:(Pe.clientY-ne.top)/ne.scaleY})}),Array.prototype.forEach.call(X.changedTouches||X.touches,Pe=>{this._changedPointerPositions.push({id:Pe.identifier,x:(Pe.clientX-ne.left)/ne.scaleX,y:(Pe.clientY-ne.top)/ne.scaleY})})):(ge=(X.clientX-ne.left)/ne.scaleX,_e=(X.clientY-ne.top)/ne.scaleY,this.pointerPos={x:ge,y:_e},this._pointerPositions=[{x:ge,y:_e,id:t.Util._getFirstPointerId(X)}],this._changedPointerPositions=[{x:ge,y:_e,id:t.Util._getFirstPointerId(X)}])}_setPointerPosition(X){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(X)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const X=this.content.getBoundingClientRect();return{top:X.top,left:X.left,scaleX:X.width/this.content.clientWidth||1,scaleY:X.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new a.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new a.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!s.Konva.isBrowser)return;const X=this.container();if(!X)throw"Stage has no container. A container is required.";X.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),X.appendChild(this.content),this._resizeDOM()}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(X){X.batchDraw()}),this}}e.Stage=Y,Y.prototype.nodeType=d,(0,l._registerNode)(Y),r.Factory.addGetterSetter(Y,"container"),s.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{e.stages.forEach(ee=>{ee.batchDraw()})})})(gw)),gw}var Dg={},mw={},uT;function fa(){return uT||(uT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Shape=e.shapes=void 0;const t=Vr(),r=ps(),n=Qr(),s=Ns(),a=en(),i=Vr(),l=C6(),c="hasShadow",d="shadowRGBA",f="patternImage",p="linearGradient",g="radialGradient";let y;function v(){return y||(y=r.Util.createCanvasElement().getContext("2d"),y)}e.shapes={};function w(A){const M=this.attrs.fillRule;M?A.fill(M):A.fill()}function b(A){A.stroke()}function E(A){const M=this.attrs.fillRule;M?A.fill(M):A.fill()}function k(A){A.stroke()}function _(){this._clearCache(c)}function T(){this._clearCache(d)}function j(){this._clearCache(f)}function P(){this._clearCache(p)}function R(){this._clearCache(g)}class N extends s.Node{constructor(M){super(M);let H;for(;H=r.Util.getRandomColor(),!(H&&!(H in e.shapes)););this.colorKey=H,e.shapes[H]=this}getContext(){return r.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return r.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(c,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(f,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const H=v().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(H&&H.setTransform){const Q=new r.Transform;Q.translate(this.fillPatternX(),this.fillPatternY()),Q.rotate(t.Konva.getAngle(this.fillPatternRotation())),Q.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),Q.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const Z=Q.getMatrix(),ae=typeof DOMMatrix>"u"?{a:Z[0],b:Z[1],c:Z[2],d:Z[3],e:Z[4],f:Z[5]}:new DOMMatrix(Z);H.setTransform(ae)}return H}}_getLinearGradient(){return this._getCache(p,this.__getLinearGradient)}__getLinearGradient(){const M=this.fillLinearGradientColorStops();if(M){const H=v(),Q=this.fillLinearGradientStartPoint(),Z=this.fillLinearGradientEndPoint(),ae=H.createLinearGradient(Q.x,Q.y,Z.x,Z.y);for(let te=0;te<M.length;te+=2)ae.addColorStop(M[te],M[te+1]);return ae}}_getRadialGradient(){return this._getCache(g,this.__getRadialGradient)}__getRadialGradient(){const M=this.fillRadialGradientColorStops();if(M){const H=v(),Q=this.fillRadialGradientStartPoint(),Z=this.fillRadialGradientEndPoint(),ae=H.createRadialGradient(Q.x,Q.y,this.fillRadialGradientStartRadius(),Z.x,Z.y,this.fillRadialGradientEndRadius());for(let te=0;te<M.length;te+=2)ae.addColorStop(M[te],M[te+1]);return ae}}getShadowRGBA(){return this._getCache(d,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const M=r.Util.colorToRGBA(this.shadowColor());if(M)return"rgba("+M.r+","+M.g+","+M.b+","+M.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const M=this.hitStrokeWidth();return M==="auto"?this.hasStroke():this.strokeEnabled()&&!!M}intersects(M){const H=this.getStage();if(!H)return!1;const Q=H.bufferHitCanvas;return Q.getContext().clear(),this.drawHit(Q,void 0,!0),Q.context.getImageData(Math.round(M.x),Math.round(M.y),1,1).data[3]>0}destroy(){return s.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(M){var H;if(!((H=this.attrs.perfectDrawEnabled)!==null&&H!==void 0?H:!0))return!1;const Z=M||this.hasFill(),ae=this.hasStroke(),te=this.getAbsoluteOpacity()!==1;if(Z&&ae&&te)return!0;const se=this.hasShadow(),L=this.shadowForStrokeEnabled();return!!(Z&&ae&&se&&L)}setStrokeHitEnabled(M){r.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),M?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const M=this.size();return{x:this._centroid?-M.width/2:0,y:this._centroid?-M.height/2:0,width:M.width,height:M.height}}getClientRect(M={}){let H=!1,Q=this.getParent();for(;Q;){if(Q.isCached()){H=!0;break}Q=Q.getParent()}const Z=M.skipTransform,ae=M.relativeTo||H&&this.getStage()||void 0,te=this.getSelfRect(),L=!M.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,G=te.width+L,I=te.height+L,z=!M.skipShadow&&this.hasShadow(),V=z?this.shadowOffsetX():0,O=z?this.shadowOffsetY():0,W=G+Math.abs(V),q=I+Math.abs(O),Y=z&&this.shadowBlur()||0,ee=W+Y*2,X=q+Y*2,ne={width:ee,height:X,x:-(L/2+Y)+Math.min(V,0)+te.x,y:-(L/2+Y)+Math.min(O,0)+te.y};return Z?ne:this._transformedRect(ne,ae)}drawScene(M,H,Q){const Z=this.getLayer(),ae=M||Z.getCanvas(),te=ae.getContext(),se=this._getCanvasCache(),L=this.getSceneFunc(),G=this.hasShadow();let I;const z=H===this;if(!this.isVisible()&&!z)return this;if(se){te.save();const V=this.getAbsoluteTransform(H).getMatrix();return te.transform(V[0],V[1],V[2],V[3],V[4],V[5]),this._drawCachedSceneCanvas(te),te.restore(),this}if(!L)return this;if(te.save(),this._useBufferCanvas()){I=this.getStage();const V=Q||I.bufferCanvas,O=V.getContext();O.clear(),O.save(),O._applyLineJoin(this);const W=this.getAbsoluteTransform(H).getMatrix();O.transform(W[0],W[1],W[2],W[3],W[4],W[5]),L.call(this,O,this),O.restore();const q=V.pixelRatio;G&&te._applyShadow(this),te._applyOpacity(this),te._applyGlobalCompositeOperation(this),te.drawImage(V._canvas,V.x||0,V.y||0,V.width/q,V.height/q)}else{if(te._applyLineJoin(this),!z){const V=this.getAbsoluteTransform(H).getMatrix();te.transform(V[0],V[1],V[2],V[3],V[4],V[5]),te._applyOpacity(this),te._applyGlobalCompositeOperation(this)}G&&te._applyShadow(this),L.call(this,te,this)}return te.restore(),this}drawHit(M,H,Q=!1){if(!this.shouldDrawHit(H,Q))return this;const Z=this.getLayer(),ae=M||Z.hitCanvas,te=ae&&ae.getContext(),se=this.hitFunc()||this.sceneFunc(),L=this._getCanvasCache(),G=L&&L.hit;if(this.colorKey||r.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),G){te.save();const z=this.getAbsoluteTransform(H).getMatrix();return te.transform(z[0],z[1],z[2],z[3],z[4],z[5]),this._drawCachedHitCanvas(te),te.restore(),this}if(!se)return this;if(te.save(),te._applyLineJoin(this),!(this===H)){const z=this.getAbsoluteTransform(H).getMatrix();te.transform(z[0],z[1],z[2],z[3],z[4],z[5])}return se.call(this,te,this),te.restore(),this}drawHitFromCache(M=0){const H=this._getCanvasCache(),Q=this._getCachedSceneCanvas(),Z=H.hit,ae=Z.getContext(),te=Z.getWidth(),se=Z.getHeight();ae.clear(),ae.drawImage(Q._canvas,0,0,te,se);try{const L=ae.getImageData(0,0,te,se),G=L.data,I=G.length,z=r.Util._hexToRgb(this.colorKey);for(let V=0;V<I;V+=4)G[V+3]>M?(G[V]=z.r,G[V+1]=z.g,G[V+2]=z.b,G[V+3]=255):G[V+3]=0;ae.putImageData(L,0,0)}catch(L){r.Util.error("Unable to draw hit graph from cached scene canvas. "+L.message)}return this}hasPointerCapture(M){return l.hasPointerCapture(M,this)}setPointerCapture(M){l.setPointerCapture(M,this)}releaseCapture(M){l.releaseCapture(M,this)}}e.Shape=N,N.prototype._fillFunc=w,N.prototype._strokeFunc=b,N.prototype._fillFuncHit=E,N.prototype._strokeFuncHit=k,N.prototype._centroid=!1,N.prototype.nodeType="Shape",(0,i._registerNode)(N),N.prototype.eventListeners={},N.prototype.on.call(N.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",_),N.prototype.on.call(N.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",T),N.prototype.on.call(N.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",j),N.prototype.on.call(N.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",P),N.prototype.on.call(N.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",R),n.Factory.addGetterSetter(N,"stroke",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(N,"strokeWidth",2,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"fillAfterStrokeEnabled",!1),n.Factory.addGetterSetter(N,"hitStrokeWidth","auto",(0,a.getNumberOrAutoValidator)()),n.Factory.addGetterSetter(N,"strokeHitEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(N,"perfectDrawEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(N,"shadowForStrokeEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(N,"lineJoin"),n.Factory.addGetterSetter(N,"lineCap"),n.Factory.addGetterSetter(N,"sceneFunc"),n.Factory.addGetterSetter(N,"hitFunc"),n.Factory.addGetterSetter(N,"dash"),n.Factory.addGetterSetter(N,"dashOffset",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"shadowColor",void 0,(0,a.getStringValidator)()),n.Factory.addGetterSetter(N,"shadowBlur",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"shadowOpacity",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(N,"shadowOffset",["x","y"]),n.Factory.addGetterSetter(N,"shadowOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"shadowOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"fillPatternImage"),n.Factory.addGetterSetter(N,"fill",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(N,"fillPatternX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"fillPatternY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(N,"strokeLinearGradientColorStops"),n.Factory.addGetterSetter(N,"fillRadialGradientStartRadius",0),n.Factory.addGetterSetter(N,"fillRadialGradientEndRadius",0),n.Factory.addGetterSetter(N,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(N,"fillPatternRepeat","repeat"),n.Factory.addGetterSetter(N,"fillEnabled",!0),n.Factory.addGetterSetter(N,"strokeEnabled",!0),n.Factory.addGetterSetter(N,"shadowEnabled",!0),n.Factory.addGetterSetter(N,"dashEnabled",!0),n.Factory.addGetterSetter(N,"strokeScaleEnabled",!0),n.Factory.addGetterSetter(N,"fillPriority","color"),n.Factory.addComponentsGetterSetter(N,"fillPatternOffset",["x","y"]),n.Factory.addGetterSetter(N,"fillPatternOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"fillPatternOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(N,"fillPatternScale",["x","y"]),n.Factory.addGetterSetter(N,"fillPatternScaleX",1,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(N,"fillPatternScaleY",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(N,"fillLinearGradientStartPoint",["x","y"]),n.Factory.addComponentsGetterSetter(N,"strokeLinearGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(N,"fillLinearGradientStartPointX",0),n.Factory.addGetterSetter(N,"strokeLinearGradientStartPointX",0),n.Factory.addGetterSetter(N,"fillLinearGradientStartPointY",0),n.Factory.addGetterSetter(N,"strokeLinearGradientStartPointY",0),n.Factory.addComponentsGetterSetter(N,"fillLinearGradientEndPoint",["x","y"]),n.Factory.addComponentsGetterSetter(N,"strokeLinearGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(N,"fillLinearGradientEndPointX",0),n.Factory.addGetterSetter(N,"strokeLinearGradientEndPointX",0),n.Factory.addGetterSetter(N,"fillLinearGradientEndPointY",0),n.Factory.addGetterSetter(N,"strokeLinearGradientEndPointY",0),n.Factory.addComponentsGetterSetter(N,"fillRadialGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(N,"fillRadialGradientStartPointX",0),n.Factory.addGetterSetter(N,"fillRadialGradientStartPointY",0),n.Factory.addComponentsGetterSetter(N,"fillRadialGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(N,"fillRadialGradientEndPointX",0),n.Factory.addGetterSetter(N,"fillRadialGradientEndPointY",0),n.Factory.addGetterSetter(N,"fillPatternRotation",0),n.Factory.addGetterSetter(N,"fillRule",void 0,(0,a.getStringValidator)()),n.Factory.backCompat(N,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(mw)),mw}var dT;function T6(){if(dT)return Dg;dT=1,Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.Layer=void 0;const e=ps(),t=O1(),r=Ns(),n=Qr(),s=M1(),a=en(),i=fa(),l=Vr(),c="#",d="beforeDraw",f="draw",p=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],g=p.length;class y extends t.Container{constructor(w){super(w),this.canvas=new s.SceneCanvas,this.hitCanvas=new s.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(w){return this.getContext().clear(w),this.getHitCanvas().getContext().clear(w),this}setZIndex(w){super.setZIndex(w);const b=this.getStage();return b&&b.content&&(b.content.removeChild(this.getNativeCanvasElement()),w<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[w+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){r.Node.prototype.moveToTop.call(this);const w=this.getStage();return w&&w.content&&(w.content.removeChild(this.getNativeCanvasElement()),w.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!r.Node.prototype.moveUp.call(this))return!1;const b=this.getStage();return!b||!b.content?!1:(b.content.removeChild(this.getNativeCanvasElement()),this.index<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[this.index+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(r.Node.prototype.moveDown.call(this)){const w=this.getStage();if(w){const b=w.children;w.content&&(w.content.removeChild(this.getNativeCanvasElement()),w.content.insertBefore(this.getNativeCanvasElement(),b[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(r.Node.prototype.moveToBottom.call(this)){const w=this.getStage();if(w){const b=w.children;w.content&&(w.content.removeChild(this.getNativeCanvasElement()),w.content.insertBefore(this.getNativeCanvasElement(),b[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const w=this.getNativeCanvasElement();return r.Node.prototype.remove.call(this),w&&w.parentNode&&e.Util._isInDocument(w)&&w.parentNode.removeChild(w),this}getStage(){return this.parent}setSize({width:w,height:b}){return this.canvas.setSize(w,b),this.hitCanvas.setSize(w,b),this._setSmoothEnabled(),this}_validateAdd(w){const b=w.getType();b!=="Group"&&b!=="Shape"&&e.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(w){return w=w||{},w.width=w.width||this.getWidth(),w.height=w.height||this.getHeight(),w.x=w.x!==void 0?w.x:this.x(),w.y=w.y!==void 0?w.y:this.y(),r.Node.prototype._toKonvaCanvas.call(this,w)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){e.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){e.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,e.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(w){if(!this.isListening()||!this.isVisible())return null;let b=1,E=!1;for(;;){for(let k=0;k<g;k++){const _=p[k],T=this._getIntersection({x:w.x+_.x*b,y:w.y+_.y*b}),j=T.shape;if(j)return j;if(E=!!T.antialiased,!T.antialiased)break}if(E)b+=1;else return null}}_getIntersection(w){const b=this.hitCanvas.pixelRatio,E=this.hitCanvas.context.getImageData(Math.round(w.x*b),Math.round(w.y*b),1,1).data,k=E[3];if(k===255){const _=e.Util._rgbToHex(E[0],E[1],E[2]),T=i.shapes[c+_];return T?{shape:T}:{antialiased:!0}}else if(k>0)return{antialiased:!0};return{}}drawScene(w,b,E){const k=this.getLayer(),_=w||k&&k.getCanvas();return this._fire(d,{node:this}),this.clearBeforeDraw()&&_.getContext().clear(),t.Container.prototype.drawScene.call(this,_,b,E),this._fire(f,{node:this}),this}drawHit(w,b){const E=this.getLayer(),k=w||E&&E.hitCanvas;return E&&E.clearBeforeDraw()&&E.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,k,b),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(w){e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(w)}getHitGraphEnabled(w){return e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const w=this.parent;!!this.hitCanvas._canvas.parentNode?w.content.removeChild(this.hitCanvas._canvas):w.content.appendChild(this.hitCanvas._canvas)}destroy(){return e.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}return Dg.Layer=y,y.prototype.nodeType="Layer",(0,l._registerNode)(y),n.Factory.addGetterSetter(y,"imageSmoothingEnabled",!0),n.Factory.addGetterSetter(y,"clearBeforeDraw",!0),n.Factory.addGetterSetter(y,"hitGraphEnabled",!0,(0,a.getBooleanValidator)()),Dg}var Ig={},fT;function wM(){if(fT)return Ig;fT=1,Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.FastLayer=void 0;const e=ps(),t=T6(),r=Vr();class n extends t.Layer{constructor(a){super(a),this.listening(!1),e.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}return Ig.FastLayer=n,n.prototype.nodeType="FastLayer",(0,r._registerNode)(n),Ig}var Mg={},hT;function ob(){if(hT)return Mg;hT=1,Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.Group=void 0;const e=ps(),t=O1(),r=Vr();class n extends t.Container{_validateAdd(a){const i=a.getType();i!=="Group"&&i!=="Shape"&&e.Util.throw("You may only add groups and shapes to groups.")}}return Mg.Group=n,n.prototype.nodeType="Group",(0,r._registerNode)(n),Mg}var Og={},gT;function lb(){if(gT)return Og;gT=1,Object.defineProperty(Og,"__esModule",{value:!0}),Og.Animation=void 0;const e=Vr(),t=ps(),r=(function(){return e.glob.performance&&e.glob.performance.now?function(){return e.glob.performance.now()}:function(){return new Date().getTime()}})();let n=class Rh{constructor(a,i){this.id=Rh.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:r(),frameRate:0},this.func=a,this.setLayers(i)}setLayers(a){let i=[];return a&&(i=Array.isArray(a)?a:[a]),this.layers=i,this}getLayers(){return this.layers}addLayer(a){const i=this.layers,l=i.length;for(let c=0;c<l;c++)if(i[c]._id===a._id)return!1;return this.layers.push(a),!0}isRunning(){const i=Rh.animations,l=i.length;for(let c=0;c<l;c++)if(i[c].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=r(),Rh._addAnimation(this),this}stop(){return Rh._removeAnimation(this),this}_updateFrameObject(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(a){this.animations.push(a),this._handleAnimation()}static _removeAnimation(a){const i=a.id,l=this.animations,c=l.length;for(let d=0;d<c;d++)if(l[d].id===i){this.animations.splice(d,1);break}}static _runFrames(){const a={},i=this.animations;for(let l=0;l<i.length;l++){const c=i[l],d=c.layers,f=c.func;c._updateFrameObject(r());const p=d.length;let g;if(f?g=f.call(c,c.frame)!==!1:g=!0,!!g)for(let y=0;y<p;y++){const v=d[y];v._id!==void 0&&(a[v._id]=v)}}for(const l in a)a.hasOwnProperty(l)&&a[l].batchDraw()}static _animationLoop(){const a=Rh;a.animations.length?(a._runFrames(),t.Util.requestAnimFrame(a._animationLoop)):a.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,t.Util.requestAnimFrame(this._animationLoop))}};return Og.Animation=n,n.animations=[],n.animIdCounter=0,n.animRunning=!1,Og}var pw={},mT;function _M(){return mT||(mT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Easings=e.Tween=void 0;const t=ps(),r=lb(),n=Ns(),s=Vr(),a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},i=1,l=2,c=3,d=["fill","stroke","shadowColor"];let f=0;class p{constructor(v,w,b,E,k,_,T){this.prop=v,this.propFunc=w,this.begin=E,this._pos=E,this.duration=_,this._change=0,this.prevPos=0,this.yoyo=T,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=b,this._change=k-this.begin,this.pause()}fire(v){const w=this[v];w&&w()}setTime(v){v>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():v<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=v,this.update())}getTime(){return this._time}setPosition(v){this.prevPos=this._pos,this.propFunc(v),this._pos=v}getPosition(v){return v===void 0&&(v=this._time),this.func(v,this.begin,this._change,this.duration)}play(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(v){this.pause(),this._time=v,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const v=this.getTimer()-this._startTime;this.state===l?this.setTime(v):this.state===c&&this.setTime(this.duration-v)}pause(){this.state=i,this.fire("onPause")}getTimer(){return new Date().getTime()}}class g{constructor(v){const w=this,b=v.node,E=b._id,k=v.easing||e.Easings.Linear,_=!!v.yoyo;let T,j;typeof v.duration>"u"?T=.3:v.duration===0?T=.001:T=v.duration,this.node=b,this._id=f++;const P=b.getLayer()||(b instanceof s.Konva.Stage?b.getLayers():null);P||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new r.Animation(function(){w.tween.onEnterFrame()},P),this.tween=new p(j,function(R){w._tweenFunc(R)},k,0,1,T*1e3,_),this._addListeners(),g.attrs[E]||(g.attrs[E]={}),g.attrs[E][this._id]||(g.attrs[E][this._id]={}),g.tweens[E]||(g.tweens[E]={});for(j in v)a[j]===void 0&&this._addAttr(j,v[j]);this.reset(),this.onFinish=v.onFinish,this.onReset=v.onReset,this.onUpdate=v.onUpdate}_addAttr(v,w){const b=this.node,E=b._id;let k,_,T,j,P;const R=g.tweens[E][v];R&&delete g.attrs[E][R][v];let N=b.getAttr(v);if(t.Util._isArray(w))if(k=[],_=Math.max(w.length,N.length),v==="points"&&w.length!==N.length&&(w.length>N.length?(j=N,N=t.Util._prepareArrayForTween(N,w,b.closed())):(T=w,w=t.Util._prepareArrayForTween(w,N,b.closed()))),v.indexOf("fill")===0)for(let A=0;A<_;A++)if(A%2===0)k.push(w[A]-N[A]);else{const M=t.Util.colorToRGBA(N[A]);P=t.Util.colorToRGBA(w[A]),N[A]=M,k.push({r:P.r-M.r,g:P.g-M.g,b:P.b-M.b,a:P.a-M.a})}else for(let A=0;A<_;A++)k.push(w[A]-N[A]);else d.indexOf(v)!==-1?(N=t.Util.colorToRGBA(N),P=t.Util.colorToRGBA(w),k={r:P.r-N.r,g:P.g-N.g,b:P.b-N.b,a:P.a-N.a}):k=w-N;g.attrs[E][this._id][v]={start:N,diff:k,end:w,trueEnd:T,trueStart:j},g.tweens[E][v]=this._id}_tweenFunc(v){const w=this.node,b=g.attrs[w._id][this._id];let E,k,_,T,j,P,R,N;for(E in b){if(k=b[E],_=k.start,T=k.diff,N=k.end,t.Util._isArray(_))if(j=[],R=Math.max(_.length,N.length),E.indexOf("fill")===0)for(P=0;P<R;P++)P%2===0?j.push((_[P]||0)+T[P]*v):j.push("rgba("+Math.round(_[P].r+T[P].r*v)+","+Math.round(_[P].g+T[P].g*v)+","+Math.round(_[P].b+T[P].b*v)+","+(_[P].a+T[P].a*v)+")");else for(P=0;P<R;P++)j.push((_[P]||0)+T[P]*v);else d.indexOf(E)!==-1?j="rgba("+Math.round(_.r+T.r*v)+","+Math.round(_.g+T.g*v)+","+Math.round(_.b+T.b*v)+","+(_.a+T.a*v)+")":j=_+T*v;w.setAttr(E,j)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const v=this.node,w=g.attrs[v._id][this._id];w.points&&w.points.trueEnd&&v.setAttr("points",w.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const v=this.node,w=g.attrs[v._id][this._id];w.points&&w.points.trueStart&&v.points(w.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(v){return this.tween.seek(v*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const v=this.node._id,w=this._id,b=g.tweens[v];this.pause(),this.anim&&this.anim.stop();for(const E in b)delete g.tweens[v][E];delete g.attrs[v][w],g.tweens[v]&&(Object.keys(g.tweens[v]).length===0&&delete g.tweens[v],Object.keys(g.attrs[v]).length===0&&delete g.attrs[v])}}e.Tween=g,g.attrs={},g.tweens={},n.Node.prototype.to=function(y){const v=y.onFinish;y.node=this,y.onFinish=function(){this.destroy(),v&&v()},new g(y).play()},e.Easings={BackEaseIn(y,v,w,b){return w*(y/=b)*y*((1.70158+1)*y-1.70158)+v},BackEaseOut(y,v,w,b){return w*((y=y/b-1)*y*((1.70158+1)*y+1.70158)+1)+v},BackEaseInOut(y,v,w,b){let E=1.70158;return(y/=b/2)<1?w/2*(y*y*(((E*=1.525)+1)*y-E))+v:w/2*((y-=2)*y*(((E*=1.525)+1)*y+E)+2)+v},ElasticEaseIn(y,v,w,b,E,k){let _=0;return y===0?v:(y/=b)===1?v+w:(k||(k=b*.3),!E||E<Math.abs(w)?(E=w,_=k/4):_=k/(2*Math.PI)*Math.asin(w/E),-(E*Math.pow(2,10*(y-=1))*Math.sin((y*b-_)*(2*Math.PI)/k))+v)},ElasticEaseOut(y,v,w,b,E,k){let _=0;return y===0?v:(y/=b)===1?v+w:(k||(k=b*.3),!E||E<Math.abs(w)?(E=w,_=k/4):_=k/(2*Math.PI)*Math.asin(w/E),E*Math.pow(2,-10*y)*Math.sin((y*b-_)*(2*Math.PI)/k)+w+v)},ElasticEaseInOut(y,v,w,b,E,k){let _=0;return y===0?v:(y/=b/2)===2?v+w:(k||(k=b*(.3*1.5)),!E||E<Math.abs(w)?(E=w,_=k/4):_=k/(2*Math.PI)*Math.asin(w/E),y<1?-.5*(E*Math.pow(2,10*(y-=1))*Math.sin((y*b-_)*(2*Math.PI)/k))+v:E*Math.pow(2,-10*(y-=1))*Math.sin((y*b-_)*(2*Math.PI)/k)*.5+w+v)},BounceEaseOut(y,v,w,b){return(y/=b)<1/2.75?w*(7.5625*y*y)+v:y<2/2.75?w*(7.5625*(y-=1.5/2.75)*y+.75)+v:y<2.5/2.75?w*(7.5625*(y-=2.25/2.75)*y+.9375)+v:w*(7.5625*(y-=2.625/2.75)*y+.984375)+v},BounceEaseIn(y,v,w,b){return w-e.Easings.BounceEaseOut(b-y,0,w,b)+v},BounceEaseInOut(y,v,w,b){return y<b/2?e.Easings.BounceEaseIn(y*2,0,w,b)*.5+v:e.Easings.BounceEaseOut(y*2-b,0,w,b)*.5+w*.5+v},EaseIn(y,v,w,b){return w*(y/=b)*y+v},EaseOut(y,v,w,b){return-w*(y/=b)*(y-2)+v},EaseInOut(y,v,w,b){return(y/=b/2)<1?w/2*y*y+v:-w/2*(--y*(y-2)-1)+v},StrongEaseIn(y,v,w,b){return w*(y/=b)*y*y*y*y+v},StrongEaseOut(y,v,w,b){return w*((y=y/b-1)*y*y*y*y+1)+v},StrongEaseInOut(y,v,w,b){return(y/=b/2)<1?w/2*y*y*y*y*y+v:w/2*((y-=2)*y*y*y*y+2)+v},Linear(y,v,w,b){return w*y/b+v}}})(pw)),pw}var pT;function N_(){return pT||(pT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;const t=Vr(),r=ps(),n=Ns(),s=O1(),a=vM(),i=T6(),l=wM(),c=ob(),d=ib(),f=fa(),p=lb(),g=_M(),y=k6(),v=M1();e.Konva=r.Util._assign(t.Konva,{Util:r.Util,Transform:r.Transform,Node:n.Node,Container:s.Container,Stage:a.Stage,stages:a.stages,Layer:i.Layer,FastLayer:l.FastLayer,Group:c.Group,DD:d.DD,Shape:f.Shape,shapes:f.shapes,Animation:p.Animation,Tween:g.Tween,Easings:g.Easings,Context:y.Context,Canvas:v.Canvas}),e.default=e.Konva})(cw)),cw}var Lg={},xT;function bM(){if(xT)return Lg;xT=1,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.Arc=void 0;const e=Qr(),t=fa(),r=Vr(),n=en(),s=Vr();class a extends t.Shape{_sceneFunc(l){const c=r.Konva.getAngle(this.angle()),d=this.clockwise();l.beginPath(),l.arc(0,0,this.outerRadius(),0,c,d),l.arc(0,0,this.innerRadius(),c,0,!d),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}getSelfRect(){const l=this.innerRadius(),c=this.outerRadius(),d=this.clockwise(),f=r.Konva.getAngle(d?360-this.angle():this.angle()),p=Math.cos(Math.min(f,Math.PI)),g=1,y=Math.sin(Math.min(Math.max(Math.PI,f),3*Math.PI/2)),v=Math.sin(Math.min(f,Math.PI/2)),w=p*(p>0?l:c),b=g*c,E=y*(y>0?l:c),k=v*(v>0?c:l);return{x:w,y:d?-1*k:E,width:b-w,height:k-E}}}return Lg.Arc=a,a.prototype._centroid=!0,a.prototype.className="Arc",a.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"outerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"clockwise",!1,(0,n.getBooleanValidator)()),Lg}var Bg={},Ug={},yT;function N6(){if(yT)return Ug;yT=1,Object.defineProperty(Ug,"__esModule",{value:!0}),Ug.Line=void 0;const e=Qr(),t=Vr(),r=fa(),n=en();function s(l,c,d,f,p,g,y){const v=Math.sqrt(Math.pow(d-l,2)+Math.pow(f-c,2)),w=Math.sqrt(Math.pow(p-d,2)+Math.pow(g-f,2)),b=y*v/(v+w),E=y*w/(v+w),k=d-b*(p-l),_=f-b*(g-c),T=d+E*(p-l),j=f+E*(g-c);return[k,_,T,j]}function a(l,c){const d=l.length,f=[];for(let p=2;p<d-2;p+=2){const g=s(l[p-2],l[p-1],l[p],l[p+1],l[p+2],l[p+3],c);isNaN(g[0])||(f.push(g[0]),f.push(g[1]),f.push(l[p]),f.push(l[p+1]),f.push(g[2]),f.push(g[3]))}return f}class i extends r.Shape{constructor(c){super(c),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(c){const d=this.points(),f=d.length,p=this.tension(),g=this.closed(),y=this.bezier();if(!f)return;let v=0;if(c.beginPath(),c.moveTo(d[0],d[1]),p!==0&&f>4){const w=this.getTensionPoints(),b=w.length;for(v=g?0:4,g||c.quadraticCurveTo(w[0],w[1],w[2],w[3]);v<b-2;)c.bezierCurveTo(w[v++],w[v++],w[v++],w[v++],w[v++],w[v++]);g||c.quadraticCurveTo(w[b-2],w[b-1],d[f-2],d[f-1])}else if(y)for(v=2;v<f;)c.bezierCurveTo(d[v++],d[v++],d[v++],d[v++],d[v++],d[v++]);else for(v=2;v<f;v+=2)c.lineTo(d[v],d[v+1]);g?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():a(this.points(),this.tension())}_getTensionPointsClosed(){const c=this.points(),d=c.length,f=this.tension(),p=s(c[d-2],c[d-1],c[0],c[1],c[2],c[3],f),g=s(c[d-4],c[d-3],c[d-2],c[d-1],c[0],c[1],f),y=a(c,f);return[p[2],p[3]].concat(y).concat([g[0],g[1],c[d-2],c[d-1],g[2],g[3],p[0],p[1],c[0],c[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let c=this.points();if(c.length<4)return{x:c[0]||0,y:c[1]||0,width:0,height:0};this.tension()!==0?c=[c[0],c[1],...this._getTensionPoints(),c[c.length-2],c[c.length-1]]:c=this.points();let d=c[0],f=c[0],p=c[1],g=c[1],y,v;for(let w=0;w<c.length/2;w++)y=c[w*2],v=c[w*2+1],d=Math.min(d,y),f=Math.max(f,y),p=Math.min(p,v),g=Math.max(g,v);return{x:d,y:p,width:f-d,height:g-p}}}return Ug.Line=i,i.prototype.className="Line",i.prototype._attrsAffectingSize=["points","bezier","tension"],(0,t._registerNode)(i),e.Factory.addGetterSetter(i,"closed",!1),e.Factory.addGetterSetter(i,"bezier",!1),e.Factory.addGetterSetter(i,"tension",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"points",[],(0,n.getNumberArrayValidator)()),Ug}var $g={},xw={},vT;function SM(){return vT||(vT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.t2length=e.getQuadraticArcLength=e.getCubicArcLength=e.binomialCoefficients=e.cValues=e.tValues=void 0,e.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],e.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],e.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(i,l,c)=>{let d,f;const g=c/2;d=0;for(let y=0;y<20;y++)f=g*e.tValues[20][y]+g,d+=e.cValues[20][y]*n(i,l,f);return g*d};e.getCubicArcLength=t;const r=(i,l,c)=>{c===void 0&&(c=1);const d=i[0]-2*i[1]+i[2],f=l[0]-2*l[1]+l[2],p=2*i[1]-2*i[0],g=2*l[1]-2*l[0],y=4*(d*d+f*f),v=4*(d*p+f*g),w=p*p+g*g;if(y===0)return c*Math.sqrt(Math.pow(i[2]-i[0],2)+Math.pow(l[2]-l[0],2));const b=v/(2*y),E=w/y,k=c+b,_=E-b*b,T=k*k+_>0?Math.sqrt(k*k+_):0,j=b*b+_>0?Math.sqrt(b*b+_):0,P=b+Math.sqrt(b*b+_)!==0?_*Math.log(Math.abs((k+T)/(b+j))):0;return Math.sqrt(y)/2*(k*T-b*j+P)};e.getQuadraticArcLength=r;function n(i,l,c){const d=s(1,c,i),f=s(1,c,l),p=d*d+f*f;return Math.sqrt(p)}const s=(i,l,c)=>{const d=c.length-1;let f,p;if(d===0)return 0;if(i===0){p=0;for(let g=0;g<=d;g++)p+=e.binomialCoefficients[d][g]*Math.pow(1-l,d-g)*Math.pow(l,g)*c[g];return p}else{f=new Array(d);for(let g=0;g<d;g++)f[g]=d*(c[g+1]-c[g]);return s(i-1,l,f)}},a=(i,l,c)=>{let d=1,f=i/l,p=(i-c(f))/l,g=0;for(;d>.001;){const y=c(f+p),v=Math.abs(i-y)/l;if(v<d)d=v,f+=p;else{const w=c(f-p),b=Math.abs(i-w)/l;b<d?(d=b,f-=p):p/=2}if(g++,g>500)break}return f};e.t2length=a})(xw)),xw}var wT;function cb(){if(wT)return $g;wT=1,Object.defineProperty($g,"__esModule",{value:!0}),$g.Path=void 0;const e=Qr(),t=Vr(),r=fa(),n=SM();class s extends r.Shape{constructor(i){super(i),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=s.parsePathData(this.data()),this.pathLength=s.getPathLength(this.dataArray)}_sceneFunc(i){const l=this.dataArray;i.beginPath();let c=!1;for(let d=0;d<l.length;d++){const f=l[d].command,p=l[d].points;switch(f){case"L":i.lineTo(p[0],p[1]);break;case"M":i.moveTo(p[0],p[1]);break;case"C":i.bezierCurveTo(p[0],p[1],p[2],p[3],p[4],p[5]);break;case"Q":i.quadraticCurveTo(p[0],p[1],p[2],p[3]);break;case"A":const g=p[0],y=p[1],v=p[2],w=p[3],b=p[4],E=p[5],k=p[6],_=p[7],T=v>w?v:w,j=v>w?1:v/w,P=v>w?w/v:1;i.translate(g,y),i.rotate(k),i.scale(j,P),i.arc(0,0,T,b,b+E,1-_),i.scale(1/j,1/P),i.rotate(-k),i.translate(-g,-y);break;case"z":c=!0,i.closePath();break}}!c&&!this.hasFill()?i.strokeShape(this):i.fillStrokeShape(this)}getSelfRect(){let i=[];this.dataArray.forEach(function(y){if(y.command==="A"){const v=y.points[4],w=y.points[5],b=y.points[4]+w;let E=Math.PI/180;if(Math.abs(v-b)<E&&(E=Math.abs(v-b)),w<0)for(let k=v-E;k>b;k-=E){const _=s.getPointOnEllipticalArc(y.points[0],y.points[1],y.points[2],y.points[3],k,0);i.push(_.x,_.y)}else for(let k=v+E;k<b;k+=E){const _=s.getPointOnEllipticalArc(y.points[0],y.points[1],y.points[2],y.points[3],k,0);i.push(_.x,_.y)}}else if(y.command==="C")for(let v=0;v<=1;v+=.01){const w=s.getPointOnCubicBezier(v,y.start.x,y.start.y,y.points[0],y.points[1],y.points[2],y.points[3],y.points[4],y.points[5]);i.push(w.x,w.y)}else i=i.concat(y.points)});let l=i[0],c=i[0],d=i[1],f=i[1],p,g;for(let y=0;y<i.length/2;y++)p=i[y*2],g=i[y*2+1],isNaN(p)||(l=Math.min(l,p),c=Math.max(c,p)),isNaN(g)||(d=Math.min(d,g),f=Math.max(f,g));return{x:l,y:d,width:c-l,height:f-d}}getLength(){return this.pathLength}getPointAtLength(i){return s.getPointAtLengthOfDataArray(i,this.dataArray)}static getLineLength(i,l,c,d){return Math.sqrt((c-i)*(c-i)+(d-l)*(d-l))}static getPathLength(i){let l=0;for(let c=0;c<i.length;++c)l+=i[c].pathLength;return l}static getPointAtLengthOfDataArray(i,l){let c,d=0,f=l.length;if(!f)return null;for(;d<f&&i>l[d].pathLength;)i-=l[d].pathLength,++d;if(d===f)return c=l[d-1].points.slice(-2),{x:c[0],y:c[1]};if(i<.01)return l[d].command==="M"?(c=l[d].points.slice(0,2),{x:c[0],y:c[1]}):{x:l[d].start.x,y:l[d].start.y};const p=l[d],g=p.points;switch(p.command){case"L":return s.getPointOnLine(i,p.start.x,p.start.y,g[0],g[1]);case"C":return s.getPointOnCubicBezier((0,n.t2length)(i,s.getPathLength(l),T=>(0,n.getCubicArcLength)([p.start.x,g[0],g[2],g[4]],[p.start.y,g[1],g[3],g[5]],T)),p.start.x,p.start.y,g[0],g[1],g[2],g[3],g[4],g[5]);case"Q":return s.getPointOnQuadraticBezier((0,n.t2length)(i,s.getPathLength(l),T=>(0,n.getQuadraticArcLength)([p.start.x,g[0],g[2]],[p.start.y,g[1],g[3]],T)),p.start.x,p.start.y,g[0],g[1],g[2],g[3]);case"A":const y=g[0],v=g[1],w=g[2],b=g[3],E=g[5],k=g[6];let _=g[4];return _+=E*i/p.pathLength,s.getPointOnEllipticalArc(y,v,w,b,_,k)}return null}static getPointOnLine(i,l,c,d,f,p,g){p=p??l,g=g??c;const y=this.getLineLength(l,c,d,f);if(y<1e-10)return{x:l,y:c};if(d===l)return{x:p,y:g+(f>c?i:-i)};const v=(f-c)/(d-l),w=Math.sqrt(i*i/(1+v*v))*(d<l?-1:1),b=v*w;if(Math.abs(g-c-v*(p-l))<1e-10)return{x:p+w,y:g+b};const E=((p-l)*(d-l)+(g-c)*(f-c))/(y*y),k=l+E*(d-l),_=c+E*(f-c),T=this.getLineLength(p,g,k,_),j=Math.sqrt(i*i-T*T),P=Math.sqrt(j*j/(1+v*v))*(d<l?-1:1),R=v*P;return{x:k+P,y:_+R}}static getPointOnCubicBezier(i,l,c,d,f,p,g,y,v){function w(j){return j*j*j}function b(j){return 3*j*j*(1-j)}function E(j){return 3*j*(1-j)*(1-j)}function k(j){return(1-j)*(1-j)*(1-j)}const _=y*w(i)+p*b(i)+d*E(i)+l*k(i),T=v*w(i)+g*b(i)+f*E(i)+c*k(i);return{x:_,y:T}}static getPointOnQuadraticBezier(i,l,c,d,f,p,g){function y(k){return k*k}function v(k){return 2*k*(1-k)}function w(k){return(1-k)*(1-k)}const b=p*y(i)+d*v(i)+l*w(i),E=g*y(i)+f*v(i)+c*w(i);return{x:b,y:E}}static getPointOnEllipticalArc(i,l,c,d,f,p){const g=Math.cos(p),y=Math.sin(p),v={x:c*Math.cos(f),y:d*Math.sin(f)};return{x:i+(v.x*g-v.y*y),y:l+(v.x*y+v.y*g)}}static parsePathData(i){if(!i)return[];let l=i;const c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];l=l.replace(new RegExp(" ","g"),",");for(let b=0;b<c.length;b++)l=l.replace(new RegExp(c[b],"g"),"|"+c[b]);const d=l.split("|"),f=[],p=[];let g=0,y=0;const v=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let w;for(let b=1;b<d.length;b++){let E=d[b],k=E.charAt(0);for(E=E.slice(1),p.length=0;w=v.exec(E);)p.push(w[0]);const _=[];for(let T=0,j=p.length;T<j;T++){if(p[T]==="00"){_.push(0,0);continue}const P=parseFloat(p[T]);isNaN(P)?_.push(0):_.push(P)}for(;_.length>0&&!isNaN(_[0]);){let T="",j=[];const P=g,R=y;let N,A,M,H,Q,Z,ae,te,se,L;switch(k){case"l":g+=_.shift(),y+=_.shift(),T="L",j.push(g,y);break;case"L":g=_.shift(),y=_.shift(),j.push(g,y);break;case"m":const G=_.shift(),I=_.shift();if(g+=G,y+=I,T="M",f.length>2&&f[f.length-1].command==="z"){for(let z=f.length-2;z>=0;z--)if(f[z].command==="M"){g=f[z].points[0]+G,y=f[z].points[1]+I;break}}j.push(g,y),k="l";break;case"M":g=_.shift(),y=_.shift(),T="M",j.push(g,y),k="L";break;case"h":g+=_.shift(),T="L",j.push(g,y);break;case"H":g=_.shift(),T="L",j.push(g,y);break;case"v":y+=_.shift(),T="L",j.push(g,y);break;case"V":y=_.shift(),T="L",j.push(g,y);break;case"C":j.push(_.shift(),_.shift(),_.shift(),_.shift()),g=_.shift(),y=_.shift(),j.push(g,y);break;case"c":j.push(g+_.shift(),y+_.shift(),g+_.shift(),y+_.shift()),g+=_.shift(),y+=_.shift(),T="C",j.push(g,y);break;case"S":A=g,M=y,N=f[f.length-1],N.command==="C"&&(A=g+(g-N.points[2]),M=y+(y-N.points[3])),j.push(A,M,_.shift(),_.shift()),g=_.shift(),y=_.shift(),T="C",j.push(g,y);break;case"s":A=g,M=y,N=f[f.length-1],N.command==="C"&&(A=g+(g-N.points[2]),M=y+(y-N.points[3])),j.push(A,M,g+_.shift(),y+_.shift()),g+=_.shift(),y+=_.shift(),T="C",j.push(g,y);break;case"Q":j.push(_.shift(),_.shift()),g=_.shift(),y=_.shift(),j.push(g,y);break;case"q":j.push(g+_.shift(),y+_.shift()),g+=_.shift(),y+=_.shift(),T="Q",j.push(g,y);break;case"T":A=g,M=y,N=f[f.length-1],N.command==="Q"&&(A=g+(g-N.points[0]),M=y+(y-N.points[1])),g=_.shift(),y=_.shift(),T="Q",j.push(A,M,g,y);break;case"t":A=g,M=y,N=f[f.length-1],N.command==="Q"&&(A=g+(g-N.points[0]),M=y+(y-N.points[1])),g+=_.shift(),y+=_.shift(),T="Q",j.push(A,M,g,y);break;case"A":H=_.shift(),Q=_.shift(),Z=_.shift(),ae=_.shift(),te=_.shift(),se=g,L=y,g=_.shift(),y=_.shift(),T="A",j=this.convertEndpointToCenterParameterization(se,L,g,y,ae,te,H,Q,Z);break;case"a":H=_.shift(),Q=_.shift(),Z=_.shift(),ae=_.shift(),te=_.shift(),se=g,L=y,g+=_.shift(),y+=_.shift(),T="A",j=this.convertEndpointToCenterParameterization(se,L,g,y,ae,te,H,Q,Z);break}f.push({command:T||k,points:j,start:{x:P,y:R},pathLength:this.calcLength(P,R,T||k,j)})}(k==="z"||k==="Z")&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f}static calcLength(i,l,c,d){let f,p,g,y;const v=s;switch(c){case"L":return v.getLineLength(i,l,d[0],d[1]);case"C":return(0,n.getCubicArcLength)([i,d[0],d[2],d[4]],[l,d[1],d[3],d[5]],1);case"Q":return(0,n.getQuadraticArcLength)([i,d[0],d[2]],[l,d[1],d[3]],1);case"A":f=0;const w=d[4],b=d[5],E=d[4]+b;let k=Math.PI/180;if(Math.abs(w-E)<k&&(k=Math.abs(w-E)),p=v.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],w,0),b<0)for(y=w-k;y>E;y-=k)g=v.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],y,0),f+=v.getLineLength(p.x,p.y,g.x,g.y),p=g;else for(y=w+k;y<E;y+=k)g=v.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],y,0),f+=v.getLineLength(p.x,p.y,g.x,g.y),p=g;return g=v.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],E,0),f+=v.getLineLength(p.x,p.y,g.x,g.y),f}return 0}static convertEndpointToCenterParameterization(i,l,c,d,f,p,g,y,v){const w=v*(Math.PI/180),b=Math.cos(w)*(i-c)/2+Math.sin(w)*(l-d)/2,E=-1*Math.sin(w)*(i-c)/2+Math.cos(w)*(l-d)/2,k=b*b/(g*g)+E*E/(y*y);k>1&&(g*=Math.sqrt(k),y*=Math.sqrt(k));let _=Math.sqrt((g*g*(y*y)-g*g*(E*E)-y*y*(b*b))/(g*g*(E*E)+y*y*(b*b)));f===p&&(_*=-1),isNaN(_)&&(_=0);const T=_*g*E/y,j=_*-y*b/g,P=(i+c)/2+Math.cos(w)*T-Math.sin(w)*j,R=(l+d)/2+Math.sin(w)*T+Math.cos(w)*j,N=function(te){return Math.sqrt(te[0]*te[0]+te[1]*te[1])},A=function(te,se){return(te[0]*se[0]+te[1]*se[1])/(N(te)*N(se))},M=function(te,se){return(te[0]*se[1]<te[1]*se[0]?-1:1)*Math.acos(A(te,se))},H=M([1,0],[(b-T)/g,(E-j)/y]),Q=[(b-T)/g,(E-j)/y],Z=[(-1*b-T)/g,(-1*E-j)/y];let ae=M(Q,Z);return A(Q,Z)<=-1&&(ae=Math.PI),A(Q,Z)>=1&&(ae=0),p===0&&ae>0&&(ae=ae-2*Math.PI),p===1&&ae<0&&(ae=ae+2*Math.PI),[P,R,g,y,H,ae,w,p]}}return $g.Path=s,s.prototype.className="Path",s.prototype._attrsAffectingSize=["data"],(0,t._registerNode)(s),e.Factory.addGetterSetter(s,"data"),$g}var _T;function kM(){if(_T)return Bg;_T=1,Object.defineProperty(Bg,"__esModule",{value:!0}),Bg.Arrow=void 0;const e=Qr(),t=N6(),r=en(),n=Vr(),s=cb();class a extends t.Line{_sceneFunc(l){super._sceneFunc(l);const c=Math.PI*2,d=this.points();let f=d;const p=this.tension()!==0&&d.length>4;p&&(f=this.getTensionPoints());const g=this.pointerLength(),y=d.length;let v,w;if(p){const k=[f[f.length-4],f[f.length-3],f[f.length-2],f[f.length-1],d[y-2],d[y-1]],_=s.Path.calcLength(f[f.length-4],f[f.length-3],"C",k),T=s.Path.getPointOnQuadraticBezier(Math.min(1,1-g/_),k[0],k[1],k[2],k[3],k[4],k[5]);v=d[y-2]-T.x,w=d[y-1]-T.y}else v=d[y-2]-d[y-4],w=d[y-1]-d[y-3];const b=(Math.atan2(w,v)+c)%c,E=this.pointerWidth();this.pointerAtEnding()&&(l.save(),l.beginPath(),l.translate(d[y-2],d[y-1]),l.rotate(b),l.moveTo(0,0),l.lineTo(-g,E/2),l.lineTo(-g,-E/2),l.closePath(),l.restore(),this.__fillStroke(l)),this.pointerAtBeginning()&&(l.save(),l.beginPath(),l.translate(d[0],d[1]),p?(v=(f[0]+f[2])/2-d[0],w=(f[1]+f[3])/2-d[1]):(v=d[2]-d[0],w=d[3]-d[1]),l.rotate((Math.atan2(-w,-v)+c)%c),l.moveTo(0,0),l.lineTo(-g,E/2),l.lineTo(-g,-E/2),l.closePath(),l.restore(),this.__fillStroke(l))}__fillStroke(l){const c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,l.setLineDash([])),l.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)}getSelfRect(){const l=super.getSelfRect(),c=this.pointerWidth()/2;return{x:l.x,y:l.y-c,width:l.width,height:l.height+c*2}}}return Bg.Arrow=a,a.prototype.className="Arrow",(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"pointerLength",10,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(a,"pointerWidth",10,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(a,"pointerAtBeginning",!1),e.Factory.addGetterSetter(a,"pointerAtEnding",!0),Bg}var Wg={},bT;function CM(){if(bT)return Wg;bT=1,Object.defineProperty(Wg,"__esModule",{value:!0}),Wg.Circle=void 0;const e=Qr(),t=fa(),r=en(),n=Vr();class s extends t.Shape{_sceneFunc(i){i.beginPath(),i.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(i){this.radius()!==i/2&&this.radius(i/2)}setHeight(i){this.radius()!==i/2&&this.radius(i/2)}}return Wg.Circle=s,s.prototype._centroid=!0,s.prototype.className="Circle",s.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(s),e.Factory.addGetterSetter(s,"radius",0,(0,r.getNumberValidator)()),Wg}var zg={},ST;function TM(){if(ST)return zg;ST=1,Object.defineProperty(zg,"__esModule",{value:!0}),zg.Ellipse=void 0;const e=Qr(),t=fa(),r=en(),n=Vr();class s extends t.Shape{_sceneFunc(i){const l=this.radiusX(),c=this.radiusY();i.beginPath(),i.save(),l!==c&&i.scale(1,c/l),i.arc(0,0,l,0,Math.PI*2,!1),i.restore(),i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(i){this.radiusX(i/2)}setHeight(i){this.radiusY(i/2)}}return zg.Ellipse=s,s.prototype.className="Ellipse",s.prototype._centroid=!0,s.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,n._registerNode)(s),e.Factory.addComponentsGetterSetter(s,"radius",["x","y"]),e.Factory.addGetterSetter(s,"radiusX",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(s,"radiusY",0,(0,r.getNumberValidator)()),zg}var Hg={},kT;function NM(){if(kT)return Hg;kT=1,Object.defineProperty(Hg,"__esModule",{value:!0}),Hg.Image=void 0;const e=ps(),t=Qr(),r=fa(),n=Vr(),s=en();class a extends r.Shape{constructor(l){super(l),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",c=>{this._removeImageLoad(c.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const l=this.image();l&&l.complete||l&&l.readyState===4||l&&l.addEventListener&&l.addEventListener("load",this._loadListener)}_removeImageLoad(l){l&&l.removeEventListener&&l.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const l=!!this.cornerRadius(),c=this.hasShadow();return l&&c?!0:super._useBufferCanvas(!0)}_sceneFunc(l){const c=this.getWidth(),d=this.getHeight(),f=this.cornerRadius(),p=this.attrs.image;let g;if(p){const y=this.attrs.cropWidth,v=this.attrs.cropHeight;y&&v?g=[p,this.cropX(),this.cropY(),y,v,0,0,c,d]:g=[p,0,0,c,d]}(this.hasFill()||this.hasStroke()||f)&&(l.beginPath(),f?e.Util.drawRoundedRectPath(l,c,d,f):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)),p&&(f&&l.clip(),l.drawImage.apply(l,g))}_hitFunc(l){const c=this.width(),d=this.height(),f=this.cornerRadius();l.beginPath(),f?e.Util.drawRoundedRectPath(l,c,d,f):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)}getWidth(){var l,c;return(l=this.attrs.width)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.width}getHeight(){var l,c;return(l=this.attrs.height)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.height}static fromURL(l,c,d=null){const f=e.Util.createImageElement();f.onload=function(){const p=new a({image:f});c(p)},f.onerror=d,f.crossOrigin="Anonymous",f.src=l}}return Hg.Image=a,a.prototype.className="Image",(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),t.Factory.addGetterSetter(a,"image"),t.Factory.addComponentsGetterSetter(a,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(a,"cropX",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(a,"cropY",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(a,"cropWidth",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(a,"cropHeight",0,(0,s.getNumberValidator)()),Hg}var Od={},CT;function EM(){if(CT)return Od;CT=1,Object.defineProperty(Od,"__esModule",{value:!0}),Od.Tag=Od.Label=void 0;const e=Qr(),t=fa(),r=ob(),n=en(),s=Vr(),a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],i="Change.konva",l="none",c="up",d="right",f="down",p="left",g=a.length;class y extends r.Group{constructor(b){super(b),this.on("add.konva",function(E){this._addListeners(E.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(b){let E=this,k;const _=function(){E._sync()};for(k=0;k<g;k++)b.on(a[k]+i,_)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let b=this.getText(),E=this.getTag(),k,_,T,j,P,R,N;if(b&&E){switch(k=b.width(),_=b.height(),T=E.pointerDirection(),j=E.pointerWidth(),N=E.pointerHeight(),P=0,R=0,T){case c:P=k/2,R=-1*N;break;case d:P=k+j,R=_/2;break;case f:P=k/2,R=_+N;break;case p:P=-1*j,R=_/2;break}E.setAttrs({x:-1*P,y:-1*R,width:k,height:_}),b.setAttrs({x:-1*P,y:-1*R})}}}Od.Label=y,y.prototype.className="Label",(0,s._registerNode)(y);class v extends t.Shape{_sceneFunc(b){const E=this.width(),k=this.height(),_=this.pointerDirection(),T=this.pointerWidth(),j=this.pointerHeight(),P=this.cornerRadius();let R=0,N=0,A=0,M=0;typeof P=="number"?R=N=A=M=Math.min(P,E/2,k/2):(R=Math.min(P[0]||0,E/2,k/2),N=Math.min(P[1]||0,E/2,k/2),M=Math.min(P[2]||0,E/2,k/2),A=Math.min(P[3]||0,E/2,k/2)),b.beginPath(),b.moveTo(R,0),_===c&&(b.lineTo((E-T)/2,0),b.lineTo(E/2,-1*j),b.lineTo((E+T)/2,0)),b.lineTo(E-N,0),b.arc(E-N,N,N,Math.PI*3/2,0,!1),_===d&&(b.lineTo(E,(k-j)/2),b.lineTo(E+T,k/2),b.lineTo(E,(k+j)/2)),b.lineTo(E,k-M),b.arc(E-M,k-M,M,0,Math.PI/2,!1),_===f&&(b.lineTo((E+T)/2,k),b.lineTo(E/2,k+j),b.lineTo((E-T)/2,k)),b.lineTo(A,k),b.arc(A,k-A,A,Math.PI/2,Math.PI,!1),_===p&&(b.lineTo(0,(k+j)/2),b.lineTo(-1*T,k/2),b.lineTo(0,(k-j)/2)),b.lineTo(0,R),b.arc(R,R,R,Math.PI,Math.PI*3/2,!1),b.closePath(),b.fillStrokeShape(this)}getSelfRect(){let b=0,E=0,k=this.pointerWidth(),_=this.pointerHeight(),T=this.pointerDirection(),j=this.width(),P=this.height();return T===c?(E-=_,P+=_):T===f?P+=_:T===p?(b-=k*1.5,j+=k):T===d&&(j+=k*1.5),{x:b,y:E,width:j,height:P}}}return Od.Tag=v,v.prototype.className="Tag",(0,s._registerNode)(v),e.Factory.addGetterSetter(v,"pointerDirection",l),e.Factory.addGetterSetter(v,"pointerWidth",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(v,"pointerHeight",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(v,"cornerRadius",0,(0,n.getNumberOrArrayOfNumbersValidator)(4)),Od}var Gg={},TT;function E6(){if(TT)return Gg;TT=1,Object.defineProperty(Gg,"__esModule",{value:!0}),Gg.Rect=void 0;const e=Qr(),t=fa(),r=Vr(),n=ps(),s=en();class a extends t.Shape{_sceneFunc(l){const c=this.cornerRadius(),d=this.width(),f=this.height();l.beginPath(),c?n.Util.drawRoundedRectPath(l,d,f,c):l.rect(0,0,d,f),l.closePath(),l.fillStrokeShape(this)}}return Gg.Rect=a,a.prototype.className="Rect",(0,r._registerNode)(a),e.Factory.addGetterSetter(a,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),Gg}var Vg={},NT;function jM(){if(NT)return Vg;NT=1,Object.defineProperty(Vg,"__esModule",{value:!0}),Vg.RegularPolygon=void 0;const e=Qr(),t=fa(),r=en(),n=Vr();class s extends t.Shape{_sceneFunc(i){const l=this._getPoints();i.beginPath(),i.moveTo(l[0].x,l[0].y);for(let c=1;c<l.length;c++)i.lineTo(l[c].x,l[c].y);i.closePath(),i.fillStrokeShape(this)}_getPoints(){const i=this.attrs.sides,l=this.attrs.radius||0,c=[];for(let d=0;d<i;d++)c.push({x:l*Math.sin(d*2*Math.PI/i),y:-1*l*Math.cos(d*2*Math.PI/i)});return c}getSelfRect(){const i=this._getPoints();let l=i[0].x,c=i[0].y,d=i[0].x,f=i[0].y;return i.forEach(p=>{l=Math.min(l,p.x),c=Math.max(c,p.x),d=Math.min(d,p.y),f=Math.max(f,p.y)}),{x:l,y:d,width:c-l,height:f-d}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(i){this.radius(i/2)}setHeight(i){this.radius(i/2)}}return Vg.RegularPolygon=s,s.prototype.className="RegularPolygon",s.prototype._centroid=!0,s.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(s),e.Factory.addGetterSetter(s,"radius",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(s,"sides",0,(0,r.getNumberValidator)()),Vg}var Kg={},ET;function AM(){if(ET)return Kg;ET=1,Object.defineProperty(Kg,"__esModule",{value:!0}),Kg.Ring=void 0;const e=Qr(),t=fa(),r=en(),n=Vr(),s=Math.PI*2;class a extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.innerRadius(),0,s,!1),l.moveTo(this.outerRadius(),0),l.arc(0,0,this.outerRadius(),s,0,!0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}}return Kg.Ring=a,a.prototype.className="Ring",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"innerRadius",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(a,"outerRadius",0,(0,r.getNumberValidator)()),Kg}var qg={},jT;function FM(){if(jT)return qg;jT=1,Object.defineProperty(qg,"__esModule",{value:!0}),qg.Sprite=void 0;const e=Qr(),t=fa(),r=lb(),n=en(),s=Vr();class a extends t.Shape{constructor(l){super(l),this._updated=!0,this.anim=new r.Animation(()=>{const c=this._updated;return this._updated=!1,c}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(l){const c=this.animation(),d=this.frameIndex(),f=d*4,p=this.animations()[c],g=this.frameOffsets(),y=p[f+0],v=p[f+1],w=p[f+2],b=p[f+3],E=this.image();if((this.hasFill()||this.hasStroke())&&(l.beginPath(),l.rect(0,0,w,b),l.closePath(),l.fillStrokeShape(this)),E)if(g){const k=g[c],_=d*2;l.drawImage(E,y,v,w,b,k[_+0],k[_+1],w,b)}else l.drawImage(E,y,v,w,b,0,0,w,b)}_hitFunc(l){const c=this.animation(),d=this.frameIndex(),f=d*4,p=this.animations()[c],g=this.frameOffsets(),y=p[f+2],v=p[f+3];if(l.beginPath(),g){const w=g[c],b=d*2;l.rect(w[b+0],w[b+1],y,v)}else l.rect(0,0,y,v);l.closePath(),l.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const l=this;this.interval=setInterval(function(){l._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const l=this.getLayer();this.anim.setLayers(l),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const l=this.frameIndex(),c=this.animation(),d=this.animations(),f=d[c],p=f.length/4;l<p-1?this.frameIndex(l+1):this.frameIndex(0)}}return qg.Sprite=a,a.prototype.className="Sprite",(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"animation"),e.Factory.addGetterSetter(a,"animations"),e.Factory.addGetterSetter(a,"frameOffsets"),e.Factory.addGetterSetter(a,"image"),e.Factory.addGetterSetter(a,"frameIndex",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"frameRate",17,(0,n.getNumberValidator)()),e.Factory.backCompat(a,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),qg}var Xg={},AT;function PM(){if(AT)return Xg;AT=1,Object.defineProperty(Xg,"__esModule",{value:!0}),Xg.Star=void 0;const e=Qr(),t=fa(),r=en(),n=Vr();class s extends t.Shape{_sceneFunc(i){const l=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();i.beginPath(),i.moveTo(0,0-c);for(let f=1;f<d*2;f++){const p=f%2===0?c:l,g=p*Math.sin(f*Math.PI/d),y=-1*p*Math.cos(f*Math.PI/d);i.lineTo(g,y)}i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(i){this.outerRadius(i/2)}setHeight(i){this.outerRadius(i/2)}}return Xg.Star=s,s.prototype.className="Star",s.prototype._centroid=!0,s.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(s),e.Factory.addGetterSetter(s,"numPoints",5,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(s,"innerRadius",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(s,"outerRadius",0,(0,r.getNumberValidator)()),Xg}var Nh={},FT;function j6(){if(FT)return Nh;FT=1,Object.defineProperty(Nh,"__esModule",{value:!0}),Nh.Text=void 0,Nh.stringToArray=i;const e=ps(),t=Qr(),r=fa(),n=Vr(),s=en(),a=Vr();function i(O){return[...O].reduce((W,q,Y,ee)=>{if(new RegExp("\\p{Emoji}","u").test(q)){const X=ee[Y+1];X&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(X)?(W.push(q+X),ee[Y+1]=""):W.push(q)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(q+(ee[Y+1]||""))?W.push(q+ee[Y+1]):Y>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(q)?W[W.length-1]+=q:q&&W.push(q);return W},[])}const l="auto",c="center",d="inherit",f="justify",p="Change.konva",g="2d",y="-",v="left",w="text",b="Text",E="top",k="bottom",_="middle",T="normal",j="px ",P=" ",R="right",N="rtl",A="word",M="char",H="none",Q="…",Z=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],ae=Z.length;function te(O){return O.split(",").map(W=>{W=W.trim();const q=W.indexOf(" ")>=0,Y=W.indexOf('"')>=0||W.indexOf("'")>=0;return q&&!Y&&(W=`"${W}"`),W}).join(", ")}let se;function L(){return se||(se=e.Util.createCanvasElement().getContext(g),se)}function G(O){O.fillText(this._partialText,this._partialTextX,this._partialTextY)}function I(O){O.setAttr("miterLimit",2),O.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function z(O){return O=O||{},!O.fillLinearGradientColorStops&&!O.fillRadialGradientColorStops&&!O.fillPatternImage&&(O.fill=O.fill||"black"),O}class V extends r.Shape{constructor(W){super(z(W)),this._partialTextX=0,this._partialTextY=0;for(let q=0;q<ae;q++)this.on(Z[q]+p,this._setTextData);this._setTextData()}_sceneFunc(W){const q=this.textArr,Y=q.length;if(!this.text())return;let ee=this.padding(),X=this.fontSize(),ne=this.lineHeight()*X,ge=this.verticalAlign(),_e=this.direction(),Pe=0,ce=this.align(),ye=this.getWidth(),Fe=this.letterSpacing(),Me=this.fill(),Oe=this.textDecoration(),He=Oe.indexOf("underline")!==-1,It=Oe.indexOf("line-through")!==-1,Ze;_e=_e===d?W.direction:_e;let Le=ne/2,De=_;if(n.Konva._fixTextRendering){const et=this.measureSize("M");De="alphabetic",Le=(et.fontBoundingBoxAscent-et.fontBoundingBoxDescent)/2+ne/2}for(_e===N&&W.setAttr("direction",_e),W.setAttr("font",this._getContextFont()),W.setAttr("textBaseline",De),W.setAttr("textAlign",v),ge===_?Pe=(this.getHeight()-Y*ne-ee*2)/2:ge===k&&(Pe=this.getHeight()-Y*ne-ee*2),W.translate(ee,Pe+ee),Ze=0;Ze<Y;Ze++){let et=0,bt=0;const ut=q[Ze],jt=ut.text,Rt=ut.width,Xe=ut.lastInParagraph;if(W.save(),ce===R?et+=ye-Rt-ee*2:ce===c&&(et+=(ye-Rt-ee*2)/2),He){W.save(),W.beginPath();const Ye=n.Konva._fixTextRendering?Math.round(X/4):Math.round(X/2),pt=et,mt=Le+bt+Ye;W.moveTo(pt,mt);const _t=ce===f&&!Xe?ye-ee*2:Rt;W.lineTo(pt+Math.round(_t),mt),W.lineWidth=X/15;const Ht=this._getLinearGradient();W.strokeStyle=Ht||Me,W.stroke(),W.restore()}if(It){W.save(),W.beginPath();const Ye=n.Konva._fixTextRendering?-Math.round(X/4):0;W.moveTo(et,Le+bt+Ye);const pt=ce===f&&!Xe?ye-ee*2:Rt;W.lineTo(et+Math.round(pt),Le+bt+Ye),W.lineWidth=X/15;const mt=this._getLinearGradient();W.strokeStyle=mt||Me,W.stroke(),W.restore()}if(_e!==N&&(Fe!==0||ce===f)){const Ye=jt.split(" ").length-1,pt=i(jt);for(let mt=0;mt<pt.length;mt++){const _t=pt[mt];_t===" "&&!Xe&&ce===f&&(et+=(ye-ee*2-Rt)/Ye),this._partialTextX=et,this._partialTextY=Le+bt,this._partialText=_t,W.fillStrokeShape(this),et+=this.measureSize(_t).width+Fe}}else Fe!==0&&W.setAttr("letterSpacing",`${Fe}px`),this._partialTextX=et,this._partialTextY=Le+bt,this._partialText=jt,W.fillStrokeShape(this);W.restore(),Y>1&&(Le+=ne)}}_hitFunc(W){const q=this.getWidth(),Y=this.getHeight();W.beginPath(),W.rect(0,0,q,Y),W.closePath(),W.fillStrokeShape(this)}setText(W){const q=e.Util._isString(W)?W:W==null?"":W+"";return this._setAttr(w,q),this}getWidth(){return this.attrs.width===l||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===l||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(W){var q,Y,ee,X,ne,ge,_e,Pe,ce,ye,Fe;let Me=L(),Oe=this.fontSize(),He;Me.save(),Me.font=this._getContextFont(),He=Me.measureText(W),Me.restore();const It=Oe/100;return{actualBoundingBoxAscent:(q=He.actualBoundingBoxAscent)!==null&&q!==void 0?q:71.58203125*It,actualBoundingBoxDescent:(Y=He.actualBoundingBoxDescent)!==null&&Y!==void 0?Y:0,actualBoundingBoxLeft:(ee=He.actualBoundingBoxLeft)!==null&&ee!==void 0?ee:-7.421875*It,actualBoundingBoxRight:(X=He.actualBoundingBoxRight)!==null&&X!==void 0?X:75.732421875*It,alphabeticBaseline:(ne=He.alphabeticBaseline)!==null&&ne!==void 0?ne:0,emHeightAscent:(ge=He.emHeightAscent)!==null&&ge!==void 0?ge:100*It,emHeightDescent:(_e=He.emHeightDescent)!==null&&_e!==void 0?_e:-20*It,fontBoundingBoxAscent:(Pe=He.fontBoundingBoxAscent)!==null&&Pe!==void 0?Pe:91*It,fontBoundingBoxDescent:(ce=He.fontBoundingBoxDescent)!==null&&ce!==void 0?ce:21*It,hangingBaseline:(ye=He.hangingBaseline)!==null&&ye!==void 0?ye:72.80000305175781*It,ideographicBaseline:(Fe=He.ideographicBaseline)!==null&&Fe!==void 0?Fe:-21*It,width:He.width,height:Oe}}_getContextFont(){return this.fontStyle()+P+this.fontVariant()+P+(this.fontSize()+j)+te(this.fontFamily())}_addTextLine(W){this.align()===f&&(W=W.trim());const Y=this._getTextWidth(W);return this.textArr.push({text:W,width:Y,lastInParagraph:!1})}_getTextWidth(W){const q=this.letterSpacing(),Y=W.length;return L().measureText(W).width+q*Y}_setTextData(){let W=this.text().split(`
`),q=+this.fontSize(),Y=0,ee=this.lineHeight()*q,X=this.attrs.width,ne=this.attrs.height,ge=X!==l&&X!==void 0,_e=ne!==l&&ne!==void 0,Pe=this.padding(),ce=X-Pe*2,ye=ne-Pe*2,Fe=0,Me=this.wrap(),Oe=Me!==H,He=Me!==M&&Oe,It=this.ellipsis();this.textArr=[],L().font=this._getContextFont();const Ze=It?this._getTextWidth(Q):0;for(let Le=0,De=W.length;Le<De;++Le){let et=W[Le],bt=this._getTextWidth(et);if(ge&&bt>ce)for(;et.length>0;){let ut=0,jt=i(et).length,Rt="",Xe=0;for(;ut<jt;){const Ye=ut+jt>>>1,pt=i(et),mt=pt.slice(0,Ye+1).join(""),_t=this._getTextWidth(mt);(It&&_e&&Fe+ee>ye?_t+Ze:_t)<=ce?(ut=Ye+1,Rt=mt,Xe=_t):jt=Ye}if(Rt){if(He){const mt=i(et),_t=i(Rt),Ht=mt[_t.length],Qt=Ht===P||Ht===y;let nr;if(Qt&&Xe<=ce)nr=_t.length;else{const Nr=_t.lastIndexOf(P),fr=_t.lastIndexOf(y);nr=Math.max(Nr,fr)+1}nr>0&&(ut=nr,Rt=mt.slice(0,ut).join(""),Xe=this._getTextWidth(Rt))}if(Rt=Rt.trimRight(),this._addTextLine(Rt),Y=Math.max(Y,Xe),Fe+=ee,this._shouldHandleEllipsis(Fe)){this._tryToAddEllipsisToLastLine();break}if(et=i(et).slice(ut).join("").trimLeft(),et.length>0&&(bt=this._getTextWidth(et),bt<=ce)){this._addTextLine(et),Fe+=ee,Y=Math.max(Y,bt);break}}else break}else this._addTextLine(et),Fe+=ee,Y=Math.max(Y,bt),this._shouldHandleEllipsis(Fe)&&Le<De-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),_e&&Fe+ee>ye)break}this.textHeight=q,this.textWidth=Y}_shouldHandleEllipsis(W){const q=+this.fontSize(),Y=this.lineHeight()*q,ee=this.attrs.height,X=ee!==l&&ee!==void 0,ne=this.padding(),ge=ee-ne*2;return!(this.wrap()!==H)||X&&W+Y>ge}_tryToAddEllipsisToLastLine(){const W=this.attrs.width,q=W!==l&&W!==void 0,Y=this.padding(),ee=W-Y*2,X=this.ellipsis(),ne=this.textArr[this.textArr.length-1];!ne||!X||(q&&(this._getTextWidth(ne.text+Q)<ee||(ne.text=ne.text.slice(0,ne.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(ne.text+Q))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const W=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,q=this.hasShadow();return W&&q?!0:super._useBufferCanvas()}}return Nh.Text=V,V.prototype._fillFunc=G,V.prototype._strokeFunc=I,V.prototype.className=b,V.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,a._registerNode)(V),t.Factory.overWriteSetter(V,"width",(0,s.getNumberOrAutoValidator)()),t.Factory.overWriteSetter(V,"height",(0,s.getNumberOrAutoValidator)()),t.Factory.addGetterSetter(V,"direction",d),t.Factory.addGetterSetter(V,"fontFamily","Arial"),t.Factory.addGetterSetter(V,"fontSize",12,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(V,"fontStyle",T),t.Factory.addGetterSetter(V,"fontVariant",T),t.Factory.addGetterSetter(V,"padding",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(V,"align",v),t.Factory.addGetterSetter(V,"verticalAlign",E),t.Factory.addGetterSetter(V,"lineHeight",1,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(V,"wrap",A),t.Factory.addGetterSetter(V,"ellipsis",!1,(0,s.getBooleanValidator)()),t.Factory.addGetterSetter(V,"letterSpacing",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(V,"text","",(0,s.getStringValidator)()),t.Factory.addGetterSetter(V,"textDecoration",""),Nh}var Yg={},PT;function RM(){if(PT)return Yg;PT=1,Object.defineProperty(Yg,"__esModule",{value:!0}),Yg.TextPath=void 0;const e=ps(),t=Qr(),r=fa(),n=cb(),s=j6(),a=en(),i=Vr(),l="",c="normal";function d(g){g.fillText(this.partialText,0,0)}function f(g){g.strokeText(this.partialText,0,0)}class p extends r.Shape{constructor(y){super(y),this.dummyCanvas=e.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return n.Path.getPathLength(this.dataArray)}_getPointAtLength(y){if(!this.attrs.data)return null;const v=this.pathLength;return y-1>v?null:n.Path.getPointAtLengthOfDataArray(y,this.dataArray)}_readDataAttribute(){this.dataArray=n.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(y){y.setAttr("font",this._getContextFont()),y.setAttr("textBaseline",this.textBaseline()),y.setAttr("textAlign","left"),y.save();const v=this.textDecoration(),w=this.fill(),b=this.fontSize(),E=this.glyphInfo;v==="underline"&&y.beginPath();for(let k=0;k<E.length;k++){y.save();const _=E[k].p0;y.translate(_.x,_.y),y.rotate(E[k].rotation),this.partialText=E[k].text,y.fillStrokeShape(this),v==="underline"&&(k===0&&y.moveTo(0,b/2+1),y.lineTo(b,b/2+1)),y.restore()}v==="underline"&&(y.strokeStyle=w,y.lineWidth=b/20,y.stroke()),y.restore()}_hitFunc(y){y.beginPath();const v=this.glyphInfo;if(v.length>=1){const w=v[0].p0;y.moveTo(w.x,w.y)}for(let w=0;w<v.length;w++){const b=v[w].p1;y.lineTo(b.x,b.y)}y.setAttr("lineWidth",this.fontSize()),y.setAttr("strokeStyle",this.colorKey),y.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(y){return s.Text.prototype.setText.call(this,y)}_getContextFont(){return s.Text.prototype._getContextFont.call(this)}_getTextSize(y){const w=this.dummyCanvas.getContext("2d");w.save(),w.font=this._getContextFont();const b=w.measureText(y);return w.restore(),{width:b.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:y,height:v}=this._getTextSize(this.attrs.text);if(this.textWidth=y,this.textHeight=v,this.glyphInfo=[],!this.attrs.data)return null;const w=this.letterSpacing(),b=this.align(),E=this.kerningFunc(),k=Math.max(this.textWidth+((this.attrs.text||"").length-1)*w,0);let _=0;b==="center"&&(_=Math.max(0,this.pathLength/2-k/2)),b==="right"&&(_=Math.max(0,this.pathLength-k));const T=(0,s.stringToArray)(this.text());let j=_;for(let P=0;P<T.length;P++){const R=this._getPointAtLength(j);if(!R)return;let N=this._getTextSize(T[P]).width+w;if(T[P]===" "&&b==="justify"){const ae=this.text().split(" ").length-1;N+=(this.pathLength-k)/ae}const A=this._getPointAtLength(j+N);if(!A)return;const M=n.Path.getLineLength(R.x,R.y,A.x,A.y);let H=0;if(E)try{H=E(T[P-1],T[P])*this.fontSize()}catch{H=0}R.x+=H,A.x+=H,this.textWidth+=H;const Q=n.Path.getPointOnLine(H+M/2,R.x,R.y,A.x,A.y),Z=Math.atan2(A.y-R.y,A.x-R.x);this.glyphInfo.push({transposeX:Q.x,transposeY:Q.y,text:T[P],rotation:Z,p0:R,p1:A}),j+=N}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const y=[];this.glyphInfo.forEach(function(j){y.push(j.p0.x),y.push(j.p0.y),y.push(j.p1.x),y.push(j.p1.y)});let v=y[0]||0,w=y[0]||0,b=y[1]||0,E=y[1]||0,k,_;for(let j=0;j<y.length/2;j++)k=y[j*2],_=y[j*2+1],v=Math.min(v,k),w=Math.max(w,k),b=Math.min(b,_),E=Math.max(E,_);const T=this.fontSize();return{x:v-T/2,y:b-T/2,width:w-v+T,height:E-b+T}}destroy(){return e.Util.releaseCanvas(this.dummyCanvas),super.destroy()}}return Yg.TextPath=p,p.prototype._fillFunc=d,p.prototype._strokeFunc=f,p.prototype._fillFuncHit=d,p.prototype._strokeFuncHit=f,p.prototype.className="TextPath",p.prototype._attrsAffectingSize=["text","fontSize","data"],(0,i._registerNode)(p),t.Factory.addGetterSetter(p,"data"),t.Factory.addGetterSetter(p,"fontFamily","Arial"),t.Factory.addGetterSetter(p,"fontSize",12,(0,a.getNumberValidator)()),t.Factory.addGetterSetter(p,"fontStyle",c),t.Factory.addGetterSetter(p,"align","left"),t.Factory.addGetterSetter(p,"letterSpacing",0,(0,a.getNumberValidator)()),t.Factory.addGetterSetter(p,"textBaseline","middle"),t.Factory.addGetterSetter(p,"fontVariant",c),t.Factory.addGetterSetter(p,"text",l),t.Factory.addGetterSetter(p,"textDecoration",""),t.Factory.addGetterSetter(p,"kerningFunc",void 0),Yg}var Jg={},RT;function DM(){if(RT)return Jg;RT=1,Object.defineProperty(Jg,"__esModule",{value:!0}),Jg.Transformer=void 0;const e=ps(),t=Qr(),r=Ns(),n=fa(),s=E6(),a=ob(),i=Vr(),l=en(),c=Vr(),d="tr-konva",f=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(N=>N+`.${d}`).join(" "),p="nodesRect",g=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],y={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},v="ontouchstart"in i.Konva._global;function w(N,A,M){if(N==="rotater")return M;A+=e.Util.degToRad(y[N]||0);const H=(e.Util.radToDeg(A)%360+360)%360;return e.Util._inRange(H,315+22.5,360)||e.Util._inRange(H,0,22.5)?"ns-resize":e.Util._inRange(H,45-22.5,45+22.5)?"nesw-resize":e.Util._inRange(H,90-22.5,90+22.5)?"ew-resize":e.Util._inRange(H,135-22.5,135+22.5)?"nwse-resize":e.Util._inRange(H,180-22.5,180+22.5)?"ns-resize":e.Util._inRange(H,225-22.5,225+22.5)?"nesw-resize":e.Util._inRange(H,270-22.5,270+22.5)?"ew-resize":e.Util._inRange(H,315-22.5,315+22.5)?"nwse-resize":(e.Util.error("Transformer has unknown angle for cursor detection: "+H),"pointer")}const b=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function E(N){return{x:N.x+N.width/2*Math.cos(N.rotation)+N.height/2*Math.sin(-N.rotation),y:N.y+N.height/2*Math.cos(N.rotation)+N.width/2*Math.sin(N.rotation)}}function k(N,A,M){const H=M.x+(N.x-M.x)*Math.cos(A)-(N.y-M.y)*Math.sin(A),Q=M.y+(N.x-M.x)*Math.sin(A)+(N.y-M.y)*Math.cos(A);return{...N,rotation:N.rotation+A,x:H,y:Q}}function _(N,A){const M=E(N);return k(N,A,M)}function T(N,A,M){let H=A;for(let Q=0;Q<N.length;Q++){const Z=i.Konva.getAngle(N[Q]),ae=Math.abs(Z-A)%(Math.PI*2);Math.min(ae,Math.PI*2-ae)<M&&(H=Z)}return H}let j=0;class P extends a.Group{constructor(A){super(A),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(f,this.update),this.getNode()&&this.update()}attachTo(A){return this.setNode(A),this}setNode(A){return e.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([A])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return d+this._id}setNodes(A=[]){this._nodes&&this._nodes.length&&this.detach();const M=A.filter(Q=>Q.isAncestorOf(this)?(e.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=A=M,A.length===1&&this.useSingleNodeRotation()?this.rotation(A[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(Q=>{const Z=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(Q._attrsAffectingSize.length){const ae=Q._attrsAffectingSize.map(te=>te+"Change."+this._getEventNamespace()).join(" ");Q.on(ae,Z)}Q.on(g.map(ae=>ae+`.${this._getEventNamespace()}`).join(" "),Z),Q.on(`absoluteTransformChange.${this._getEventNamespace()}`,Z),this._proxyDrag(Q)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(A){let M;A.on(`dragstart.${this._getEventNamespace()}`,H=>{M=A.getAbsolutePosition(),!this.isDragging()&&A!==this.findOne(".back")&&this.startDrag(H,!1)}),A.on(`dragmove.${this._getEventNamespace()}`,H=>{if(!M)return;const Q=A.getAbsolutePosition(),Z=Q.x-M.x,ae=Q.y-M.y;this.nodes().forEach(te=>{if(te===A||te.isDragging())return;const se=te.getAbsolutePosition();te.setAbsolutePosition({x:se.x+Z,y:se.y+ae}),te.startDrag(H)}),M=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(A=>{A.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(p),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(p,this.__getNodeRect)}__getNodeShape(A,M=this.rotation(),H){const Q=A.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),Z=A.getAbsoluteScale(H),ae=A.getAbsolutePosition(H),te=Q.x*Z.x-A.offsetX()*Z.x,se=Q.y*Z.y-A.offsetY()*Z.y,L=(i.Konva.getAngle(A.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),G={x:ae.x+te*Math.cos(L)+se*Math.sin(-L),y:ae.y+se*Math.cos(L)+te*Math.sin(L),width:Q.width*Z.x,height:Q.height*Z.y,rotation:L};return k(G,-i.Konva.getAngle(M),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const M=[];this.nodes().map(L=>{const G=L.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),I=[{x:G.x,y:G.y},{x:G.x+G.width,y:G.y},{x:G.x+G.width,y:G.y+G.height},{x:G.x,y:G.y+G.height}],z=L.getAbsoluteTransform();I.forEach(function(V){const O=z.point(V);M.push(O)})});const H=new e.Transform;H.rotate(-i.Konva.getAngle(this.rotation()));let Q=1/0,Z=1/0,ae=-1/0,te=-1/0;M.forEach(function(L){const G=H.point(L);Q===void 0&&(Q=ae=G.x,Z=te=G.y),Q=Math.min(Q,G.x),Z=Math.min(Z,G.y),ae=Math.max(ae,G.x),te=Math.max(te,G.y)}),H.invert();const se=H.point({x:Q,y:Z});return{x:se.x,y:se.y,width:ae-Q,height:te-Z,rotation:i.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),b.forEach(A=>{this._createAnchor(A)}),this._createAnchor("rotater")}_createAnchor(A){const M=new s.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:A+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:v?10:"auto"}),H=this;M.on("mousedown touchstart",function(Q){H._handleMouseDown(Q)}),M.on("dragstart",Q=>{M.stopDrag(),Q.cancelBubble=!0}),M.on("dragend",Q=>{Q.cancelBubble=!0}),M.on("mouseenter",()=>{const Q=i.Konva.getAngle(this.rotation()),Z=this.rotateAnchorCursor(),ae=w(A,Q,Z);M.getStage().content&&(M.getStage().content.style.cursor=ae),this._cursorChange=!0}),M.on("mouseout",()=>{M.getStage().content&&(M.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(M)}_createBack(){const A=new n.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(M,H){const Q=H.getParent(),Z=Q.padding();M.beginPath(),M.rect(-Z,-Z,H.width()+Z*2,H.height()+Z*2),M.moveTo(H.width()/2,-Z),Q.rotateEnabled()&&Q.rotateLineVisible()&&M.lineTo(H.width()/2,-Q.rotateAnchorOffset()*e.Util._sign(H.height())-Z),M.fillStrokeShape(H)},hitFunc:(M,H)=>{if(!this.shouldOverdrawWholeArea())return;const Q=this.padding();M.beginPath(),M.rect(-Q,-Q,H.width()+Q*2,H.height()+Q*2),M.fillStrokeShape(H)}});this.add(A),this._proxyDrag(A),A.on("dragstart",M=>{M.cancelBubble=!0}),A.on("dragmove",M=>{M.cancelBubble=!0}),A.on("dragend",M=>{M.cancelBubble=!0}),this.on("dragmove",M=>{this.update()})}_handleMouseDown(A){if(this._transforming)return;this._movingAnchorName=A.target.name().split(" ")[0];const M=this._getNodeRect(),H=M.width,Q=M.height,Z=Math.sqrt(Math.pow(H,2)+Math.pow(Q,2));this.sin=Math.abs(Q/Z),this.cos=Math.abs(H/Z),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const ae=A.target.getAbsolutePosition(),te=A.target.getStage().getPointerPosition();this._anchorDragOffset={x:te.x-ae.x,y:te.y-ae.y},j++,this._fire("transformstart",{evt:A.evt,target:this.getNode()}),this._nodes.forEach(se=>{se._fire("transformstart",{evt:A.evt,target:se})})}_handleMouseMove(A){let M,H,Q;const Z=this.findOne("."+this._movingAnchorName),ae=Z.getStage();ae.setPointersPositions(A);const te=ae.getPointerPosition();let se={x:te.x-this._anchorDragOffset.x,y:te.y-this._anchorDragOffset.y};const L=Z.getAbsolutePosition();this.anchorDragBoundFunc()&&(se=this.anchorDragBoundFunc()(L,se,A)),Z.setAbsolutePosition(se);const G=Z.getAbsolutePosition();if(L.x===G.x&&L.y===G.y)return;if(this._movingAnchorName==="rotater"){const ee=this._getNodeRect();M=Z.x()-ee.width/2,H=-Z.y()+ee.height/2;let X=Math.atan2(-H,M)+Math.PI/2;ee.height<0&&(X-=Math.PI);const ge=i.Konva.getAngle(this.rotation())+X,_e=i.Konva.getAngle(this.rotationSnapTolerance()),ce=T(this.rotationSnaps(),ge,_e)-ee.rotation,ye=_(ee,ce);this._fitNodesInto(ye,A);return}const I=this.shiftBehavior();let z;I==="inverted"?z=this.keepRatio()&&!A.shiftKey:I==="none"?z=this.keepRatio():z=this.keepRatio()||A.shiftKey;let V=this.centeredScaling()||A.altKey;if(this._movingAnchorName==="top-left"){if(z){const ee=V?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};Q=Math.sqrt(Math.pow(ee.x-Z.x(),2)+Math.pow(ee.y-Z.y(),2));const X=this.findOne(".top-left").x()>ee.x?-1:1,ne=this.findOne(".top-left").y()>ee.y?-1:1;M=Q*this.cos*X,H=Q*this.sin*ne,this.findOne(".top-left").x(ee.x-M),this.findOne(".top-left").y(ee.y-H)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(Z.y());else if(this._movingAnchorName==="top-right"){if(z){const ee=V?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};Q=Math.sqrt(Math.pow(Z.x()-ee.x,2)+Math.pow(ee.y-Z.y(),2));const X=this.findOne(".top-right").x()<ee.x?-1:1,ne=this.findOne(".top-right").y()>ee.y?-1:1;M=Q*this.cos*X,H=Q*this.sin*ne,this.findOne(".top-right").x(ee.x+M),this.findOne(".top-right").y(ee.y-H)}var O=Z.position();this.findOne(".top-left").y(O.y),this.findOne(".bottom-right").x(O.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(Z.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(Z.x());else if(this._movingAnchorName==="bottom-left"){if(z){const ee=V?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};Q=Math.sqrt(Math.pow(ee.x-Z.x(),2)+Math.pow(Z.y()-ee.y,2));const X=ee.x<Z.x()?-1:1,ne=Z.y()<ee.y?-1:1;M=Q*this.cos*X,H=Q*this.sin*ne,Z.x(ee.x-M),Z.y(ee.y+H)}O=Z.position(),this.findOne(".top-left").x(O.x),this.findOne(".bottom-right").y(O.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(Z.y());else if(this._movingAnchorName==="bottom-right"){if(z){const ee=V?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};Q=Math.sqrt(Math.pow(Z.x()-ee.x,2)+Math.pow(Z.y()-ee.y,2));const X=this.findOne(".bottom-right").x()<ee.x?-1:1,ne=this.findOne(".bottom-right").y()<ee.y?-1:1;M=Q*this.cos*X,H=Q*this.sin*ne,this.findOne(".bottom-right").x(ee.x+M),this.findOne(".bottom-right").y(ee.y+H)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(V=this.centeredScaling()||A.altKey,V){const ee=this.findOne(".top-left"),X=this.findOne(".bottom-right"),ne=ee.x(),ge=ee.y(),_e=this.getWidth()-X.x(),Pe=this.getHeight()-X.y();X.move({x:-ne,y:-ge}),ee.move({x:_e,y:Pe})}const W=this.findOne(".top-left").getAbsolutePosition();M=W.x,H=W.y;const q=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),Y=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:M,y:H,width:q,height:Y,rotation:i.Konva.getAngle(this.rotation())},A)}_handleMouseUp(A){this._removeEvents(A)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(A){var M;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const H=this.getNode();j--,this._fire("transformend",{evt:A,target:H}),(M=this.getLayer())===null||M===void 0||M.batchDraw(),H&&this._nodes.forEach(Q=>{var Z;Q._fire("transformend",{evt:A,target:Q}),(Z=Q.getLayer())===null||Z===void 0||Z.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(A,M){const H=this._getNodeRect(),Q=1;if(e.Util._inRange(A.width,-this.padding()*2-Q,Q)){this.update();return}if(e.Util._inRange(A.height,-this.padding()*2-Q,Q)){this.update();return}const Z=new e.Transform;if(Z.rotate(i.Konva.getAngle(this.rotation())),this._movingAnchorName&&A.width<0&&this._movingAnchorName.indexOf("left")>=0){const z=Z.point({x:-this.padding()*2,y:0});A.x+=z.x,A.y+=z.y,A.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=z.x,this._anchorDragOffset.y-=z.y}else if(this._movingAnchorName&&A.width<0&&this._movingAnchorName.indexOf("right")>=0){const z=Z.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=z.x,this._anchorDragOffset.y-=z.y,A.width+=this.padding()*2}if(this._movingAnchorName&&A.height<0&&this._movingAnchorName.indexOf("top")>=0){const z=Z.point({x:0,y:-this.padding()*2});A.x+=z.x,A.y+=z.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=z.x,this._anchorDragOffset.y-=z.y,A.height+=this.padding()*2}else if(this._movingAnchorName&&A.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const z=Z.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=z.x,this._anchorDragOffset.y-=z.y,A.height+=this.padding()*2}if(this.boundBoxFunc()){const z=this.boundBoxFunc()(H,A);z?A=z:e.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const ae=1e7,te=new e.Transform;te.translate(H.x,H.y),te.rotate(H.rotation),te.scale(H.width/ae,H.height/ae);const se=new e.Transform,L=A.width/ae,G=A.height/ae;this.flipEnabled()===!1?(se.translate(A.x,A.y),se.rotate(A.rotation),se.translate(A.width<0?A.width:0,A.height<0?A.height:0),se.scale(Math.abs(L),Math.abs(G))):(se.translate(A.x,A.y),se.rotate(A.rotation),se.scale(L,G));const I=se.multiply(te.invert());this._nodes.forEach(z=>{var V;const O=z.getParent().getAbsoluteTransform(),W=z.getTransform().copy();W.translate(z.offsetX(),z.offsetY());const q=new e.Transform;q.multiply(O.copy().invert()).multiply(I).multiply(O).multiply(W);const Y=q.decompose();z.setAttrs(Y),(V=z.getLayer())===null||V===void 0||V.batchDraw()}),this.rotation(e.Util._getRotation(A.rotation)),this._nodes.forEach(z=>{this._fire("transform",{evt:M,target:z}),z._fire("transform",{evt:M,target:z})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(A,M){this.findOne(A).setAttrs(M)}update(){var A;const M=this._getNodeRect();this.rotation(e.Util._getRotation(M.rotation));const H=M.width,Q=M.height,Z=this.enabledAnchors(),ae=this.resizeEnabled(),te=this.padding(),se=this.anchorSize(),L=this.find("._anchor");L.forEach(I=>{I.setAttrs({width:se,height:se,offsetX:se/2,offsetY:se/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:se/2+te,offsetY:se/2+te,visible:ae&&Z.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:H/2,y:0,offsetY:se/2+te,visible:ae&&Z.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:H,y:0,offsetX:se/2-te,offsetY:se/2+te,visible:ae&&Z.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:Q/2,offsetX:se/2+te,visible:ae&&Z.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:H,y:Q/2,offsetX:se/2-te,visible:ae&&Z.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:Q,offsetX:se/2+te,offsetY:se/2-te,visible:ae&&Z.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:H/2,y:Q,offsetY:se/2-te,visible:ae&&Z.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:H,y:Q,offsetX:se/2-te,offsetY:se/2-te,visible:ae&&Z.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:H/2,y:-this.rotateAnchorOffset()*e.Util._sign(Q)-te,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:H,height:Q,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const G=this.anchorStyleFunc();G&&L.forEach(I=>{G(I)}),(A=this.getLayer())===null||A===void 0||A.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const A=this.findOne("."+this._movingAnchorName);A&&A.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),a.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return r.Node.prototype.toObject.call(this)}clone(A){return r.Node.prototype.clone.call(this,A)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}Jg.Transformer=P,P.isTransforming=()=>j>0;function R(N){return N instanceof Array||e.Util.warn("enabledAnchors value should be an array"),N instanceof Array&&N.forEach(function(A){b.indexOf(A)===-1&&e.Util.warn("Unknown anchor name: "+A+". Available names are: "+b.join(", "))}),N||[]}return P.prototype.className="Transformer",(0,c._registerNode)(P),t.Factory.addGetterSetter(P,"enabledAnchors",b,R),t.Factory.addGetterSetter(P,"flipEnabled",!0,(0,l.getBooleanValidator)()),t.Factory.addGetterSetter(P,"resizeEnabled",!0),t.Factory.addGetterSetter(P,"anchorSize",10,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"rotateEnabled",!0),t.Factory.addGetterSetter(P,"rotateLineVisible",!0),t.Factory.addGetterSetter(P,"rotationSnaps",[]),t.Factory.addGetterSetter(P,"rotateAnchorOffset",50,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"rotateAnchorCursor","crosshair"),t.Factory.addGetterSetter(P,"rotationSnapTolerance",5,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderEnabled",!0),t.Factory.addGetterSetter(P,"anchorStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(P,"anchorStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"anchorFill","white"),t.Factory.addGetterSetter(P,"anchorCornerRadius",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(P,"borderStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderDash"),t.Factory.addGetterSetter(P,"keepRatio",!0),t.Factory.addGetterSetter(P,"shiftBehavior","default"),t.Factory.addGetterSetter(P,"centeredScaling",!1),t.Factory.addGetterSetter(P,"ignoreStroke",!1),t.Factory.addGetterSetter(P,"padding",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"nodes"),t.Factory.addGetterSetter(P,"node"),t.Factory.addGetterSetter(P,"boundBoxFunc"),t.Factory.addGetterSetter(P,"anchorDragBoundFunc"),t.Factory.addGetterSetter(P,"anchorStyleFunc"),t.Factory.addGetterSetter(P,"shouldOverdrawWholeArea",!1),t.Factory.addGetterSetter(P,"useSingleNodeRotation",!0),t.Factory.backCompat(P,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),Jg}var Qg={},DT;function IM(){if(DT)return Qg;DT=1,Object.defineProperty(Qg,"__esModule",{value:!0}),Qg.Wedge=void 0;const e=Qr(),t=fa(),r=Vr(),n=en(),s=Vr();class a extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.radius(),0,r.Konva.getAngle(this.angle()),this.clockwise()),l.lineTo(0,0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius(l/2)}setHeight(l){this.radius(l/2)}}return Qg.Wedge=a,a.prototype.className="Wedge",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"radius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"clockwise",!1),e.Factory.backCompat(a,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Qg}var Zg={},IT;function MM(){if(IT)return Zg;IT=1,Object.defineProperty(Zg,"__esModule",{value:!0}),Zg.Blur=void 0;const e=Qr(),t=Ns(),r=en();function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const s=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],a=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function i(c,d){const f=c.data,p=c.width,g=c.height;let y,v,w,b,E,k,_,T,j,P,R,N,A,M,H,Q,Z,ae,te,se;const L=d+d+1,G=p-1,I=g-1,z=d+1,V=z*(z+1)/2,O=new n,W=s[d],q=a[d];let Y=null,ee=O,X=null,ne=null;for(let ge=1;ge<L;ge++)ee=ee.next=new n,ge===z&&(Y=ee);ee.next=O,w=v=0;for(let ge=0;ge<g;ge++){N=A=M=H=b=E=k=_=0,T=z*(Q=f[v]),j=z*(Z=f[v+1]),P=z*(ae=f[v+2]),R=z*(te=f[v+3]),b+=V*Q,E+=V*Z,k+=V*ae,_+=V*te,ee=O;for(let _e=0;_e<z;_e++)ee.r=Q,ee.g=Z,ee.b=ae,ee.a=te,ee=ee.next;for(let _e=1;_e<z;_e++)y=v+((G<_e?G:_e)<<2),b+=(ee.r=Q=f[y])*(se=z-_e),E+=(ee.g=Z=f[y+1])*se,k+=(ee.b=ae=f[y+2])*se,_+=(ee.a=te=f[y+3])*se,N+=Q,A+=Z,M+=ae,H+=te,ee=ee.next;X=O,ne=Y;for(let _e=0;_e<p;_e++)f[v+3]=te=_*W>>q,te!==0?(te=255/te,f[v]=(b*W>>q)*te,f[v+1]=(E*W>>q)*te,f[v+2]=(k*W>>q)*te):f[v]=f[v+1]=f[v+2]=0,b-=T,E-=j,k-=P,_-=R,T-=X.r,j-=X.g,P-=X.b,R-=X.a,y=w+((y=_e+d+1)<G?y:G)<<2,N+=X.r=f[y],A+=X.g=f[y+1],M+=X.b=f[y+2],H+=X.a=f[y+3],b+=N,E+=A,k+=M,_+=H,X=X.next,T+=Q=ne.r,j+=Z=ne.g,P+=ae=ne.b,R+=te=ne.a,N-=Q,A-=Z,M-=ae,H-=te,ne=ne.next,v+=4;w+=p}for(let ge=0;ge<p;ge++){A=M=H=N=E=k=_=b=0,v=ge<<2,T=z*(Q=f[v]),j=z*(Z=f[v+1]),P=z*(ae=f[v+2]),R=z*(te=f[v+3]),b+=V*Q,E+=V*Z,k+=V*ae,_+=V*te,ee=O;for(let Pe=0;Pe<z;Pe++)ee.r=Q,ee.g=Z,ee.b=ae,ee.a=te,ee=ee.next;let _e=p;for(let Pe=1;Pe<=d;Pe++)v=_e+ge<<2,b+=(ee.r=Q=f[v])*(se=z-Pe),E+=(ee.g=Z=f[v+1])*se,k+=(ee.b=ae=f[v+2])*se,_+=(ee.a=te=f[v+3])*se,N+=Q,A+=Z,M+=ae,H+=te,ee=ee.next,Pe<I&&(_e+=p);v=ge,X=O,ne=Y;for(let Pe=0;Pe<g;Pe++)y=v<<2,f[y+3]=te=_*W>>q,te>0?(te=255/te,f[y]=(b*W>>q)*te,f[y+1]=(E*W>>q)*te,f[y+2]=(k*W>>q)*te):f[y]=f[y+1]=f[y+2]=0,b-=T,E-=j,k-=P,_-=R,T-=X.r,j-=X.g,P-=X.b,R-=X.a,y=ge+((y=Pe+z)<I?y:I)*p<<2,b+=N+=X.r=f[y],E+=A+=X.g=f[y+1],k+=M+=X.b=f[y+2],_+=H+=X.a=f[y+3],X=X.next,T+=Q=ne.r,j+=Z=ne.g,P+=ae=ne.b,R+=te=ne.a,N-=Q,A-=Z,M-=ae,H-=te,ne=ne.next,v+=p}}const l=function(d){const f=Math.round(this.blurRadius());f>0&&i(d,f)};return Zg.Blur=l,e.Factory.addGetterSetter(t.Node,"blurRadius",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),Zg}var em={},MT;function OM(){if(MT)return em;MT=1,Object.defineProperty(em,"__esModule",{value:!0}),em.Brighten=void 0;const e=Qr(),t=Ns(),r=en(),n=function(s){const a=this.brightness()*255,i=s.data,l=i.length;for(let c=0;c<l;c+=4)i[c]+=a,i[c+1]+=a,i[c+2]+=a};return em.Brighten=n,e.Factory.addGetterSetter(t.Node,"brightness",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),em}var tm={},OT;function LM(){if(OT)return tm;OT=1,Object.defineProperty(tm,"__esModule",{value:!0}),tm.Contrast=void 0;const e=Qr(),t=Ns(),r=en(),n=function(s){const a=Math.pow((this.contrast()+100)/100,2),i=s.data,l=i.length;let c=150,d=150,f=150;for(let p=0;p<l;p+=4)c=i[p],d=i[p+1],f=i[p+2],c/=255,c-=.5,c*=a,c+=.5,c*=255,d/=255,d-=.5,d*=a,d+=.5,d*=255,f/=255,f-=.5,f*=a,f+=.5,f*=255,c=c<0?0:c>255?255:c,d=d<0?0:d>255?255:d,f=f<0?0:f>255?255:f,i[p]=c,i[p+1]=d,i[p+2]=f};return tm.Contrast=n,e.Factory.addGetterSetter(t.Node,"contrast",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),tm}var rm={},LT;function BM(){if(LT)return rm;LT=1,Object.defineProperty(rm,"__esModule",{value:!0}),rm.Emboss=void 0;const e=Qr(),t=Ns(),r=ps(),n=en(),s=function(a){const i=this.embossStrength()*10,l=this.embossWhiteLevel()*255,c=this.embossDirection(),d=this.embossBlend(),f=a.data,p=a.width,g=a.height,y=p*4;let v=0,w=0,b=g;switch(c){case"top-left":v=-1,w=-1;break;case"top":v=-1,w=0;break;case"top-right":v=-1,w=1;break;case"right":v=0,w=1;break;case"bottom-right":v=1,w=1;break;case"bottom":v=1,w=0;break;case"bottom-left":v=1,w=-1;break;case"left":v=0,w=-1;break;default:r.Util.error("Unknown emboss direction: "+c)}do{const E=(b-1)*y;let k=v;b+k<1&&(k=0),b+k>g&&(k=0);const _=(b-1+k)*p*4;let T=p;do{const j=E+(T-1)*4;let P=w;T+P<1&&(P=0),T+P>p&&(P=0);const R=_+(T-1+P)*4,N=f[j]-f[R],A=f[j+1]-f[R+1],M=f[j+2]-f[R+2];let H=N;const Q=H>0?H:-H,Z=A>0?A:-A,ae=M>0?M:-M;if(Z>Q&&(H=A),ae>Q&&(H=M),H*=i,d){const te=f[j]+H,se=f[j+1]+H,L=f[j+2]+H;f[j]=te>255?255:te<0?0:te,f[j+1]=se>255?255:se<0?0:se,f[j+2]=L>255?255:L<0?0:L}else{let te=l-H;te<0?te=0:te>255&&(te=255),f[j]=f[j+1]=f[j+2]=te}}while(--T)}while(--b)};return rm.Emboss=s,e.Factory.addGetterSetter(t.Node,"embossStrength",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossDirection","top-left",void 0,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossBlend",!1,void 0,e.Factory.afterSetFilter),rm}var nm={},BT;function UM(){if(BT)return nm;BT=1,Object.defineProperty(nm,"__esModule",{value:!0}),nm.Enhance=void 0;const e=Qr(),t=Ns(),r=en();function n(a,i,l,c,d){const f=l-i,p=d-c;if(f===0)return c+p/2;if(p===0)return c;let g=(a-i)/f;return g=p*g+c,g}const s=function(a){const i=a.data,l=i.length;let c=i[0],d=c,f,p=i[1],g=p,y,v=i[2],w=v,b;const E=this.enhance();if(E===0)return;for(let N=0;N<l;N+=4)f=i[N+0],f<c?c=f:f>d&&(d=f),y=i[N+1],y<p?p=y:y>g&&(g=y),b=i[N+2],b<v?v=b:b>w&&(w=b);d===c&&(d=255,c=0),g===p&&(g=255,p=0),w===v&&(w=255,v=0);let k,_,T,j,P,R;if(E>0)k=d+E*(255-d),_=c-E*(c-0),T=g+E*(255-g),j=p-E*(p-0),P=w+E*(255-w),R=v-E*(v-0);else{const N=(d+c)*.5;k=d+E*(d-N),_=c+E*(c-N);const A=(g+p)*.5;T=g+E*(g-A),j=p+E*(p-A);const M=(w+v)*.5;P=w+E*(w-M),R=v+E*(v-M)}for(let N=0;N<l;N+=4)i[N+0]=n(i[N+0],c,d,_,k),i[N+1]=n(i[N+1],p,g,j,T),i[N+2]=n(i[N+2],v,w,R,P)};return nm.Enhance=s,e.Factory.addGetterSetter(t.Node,"enhance",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),nm}var sm={},UT;function $M(){if(UT)return sm;UT=1,Object.defineProperty(sm,"__esModule",{value:!0}),sm.Grayscale=void 0;const e=function(t){const r=t.data,n=r.length;for(let s=0;s<n;s+=4){const a=.34*r[s]+.5*r[s+1]+.16*r[s+2];r[s]=a,r[s+1]=a,r[s+2]=a}};return sm.Grayscale=e,sm}var am={},$T;function WM(){if($T)return am;$T=1,Object.defineProperty(am,"__esModule",{value:!0}),am.HSL=void 0;const e=Qr(),t=Ns(),r=en();e.Factory.addGetterSetter(t.Node,"hue",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"luminance",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter);const n=function(s){const a=s.data,i=a.length,l=1,c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,f=this.luminance()*127,p=l*c*Math.cos(d*Math.PI/180),g=l*c*Math.sin(d*Math.PI/180),y=.299*l+.701*p+.167*g,v=.587*l-.587*p+.33*g,w=.114*l-.114*p-.497*g,b=.299*l-.299*p-.328*g,E=.587*l+.413*p+.035*g,k=.114*l-.114*p+.293*g,_=.299*l-.3*p+1.25*g,T=.587*l-.586*p-1.05*g,j=.114*l+.886*p-.2*g;let P,R,N,A;for(let M=0;M<i;M+=4)P=a[M+0],R=a[M+1],N=a[M+2],A=a[M+3],a[M+0]=y*P+v*R+w*N+f,a[M+1]=b*P+E*R+k*N+f,a[M+2]=_*P+T*R+j*N+f,a[M+3]=A};return am.HSL=n,am}var im={},WT;function zM(){if(WT)return im;WT=1,Object.defineProperty(im,"__esModule",{value:!0}),im.HSV=void 0;const e=Qr(),t=Ns(),r=en(),n=function(s){const a=s.data,i=a.length,l=Math.pow(2,this.value()),c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,f=l*c*Math.cos(d*Math.PI/180),p=l*c*Math.sin(d*Math.PI/180),g=.299*l+.701*f+.167*p,y=.587*l-.587*f+.33*p,v=.114*l-.114*f-.497*p,w=.299*l-.299*f-.328*p,b=.587*l+.413*f+.035*p,E=.114*l-.114*f+.293*p,k=.299*l-.3*f+1.25*p,_=.587*l-.586*f-1.05*p,T=.114*l+.886*f-.2*p;for(let j=0;j<i;j+=4){const P=a[j+0],R=a[j+1],N=a[j+2],A=a[j+3];a[j+0]=g*P+y*R+v*N,a[j+1]=w*P+b*R+E*N,a[j+2]=k*P+_*R+T*N,a[j+3]=A}};return im.HSV=n,e.Factory.addGetterSetter(t.Node,"hue",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"value",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),im}var om={},zT;function HM(){if(zT)return om;zT=1,Object.defineProperty(om,"__esModule",{value:!0}),om.Invert=void 0;const e=function(t){const r=t.data,n=r.length;for(let s=0;s<n;s+=4)r[s]=255-r[s],r[s+1]=255-r[s+1],r[s+2]=255-r[s+2]};return om.Invert=e,om}var lm={},HT;function GM(){if(HT)return lm;HT=1,Object.defineProperty(lm,"__esModule",{value:!0}),lm.Kaleidoscope=void 0;const e=Qr(),t=Ns(),r=ps(),n=en(),s=function(l,c,d){const f=l.data,p=c.data,g=l.width,y=l.height,v=d.polarCenterX||g/2,w=d.polarCenterY||y/2;let b=Math.sqrt(v*v+w*w),E=g-v,k=y-w;const _=Math.sqrt(E*E+k*k);b=_>b?_:b;const T=y,j=g,P=360/j*Math.PI/180;for(let R=0;R<j;R+=1){const N=Math.sin(R*P),A=Math.cos(R*P);for(let M=0;M<T;M+=1){E=Math.floor(v+b*M/T*A),k=Math.floor(w+b*M/T*N);let H=(k*g+E)*4;const Q=f[H+0],Z=f[H+1],ae=f[H+2],te=f[H+3];H=(R+M*g)*4,p[H+0]=Q,p[H+1]=Z,p[H+2]=ae,p[H+3]=te}}},a=function(l,c,d){const f=l.data,p=c.data,g=l.width,y=l.height,v=d.polarCenterX||g/2,w=d.polarCenterY||y/2;let b=Math.sqrt(v*v+w*w),E=g-v,k=y-w;const _=Math.sqrt(E*E+k*k);b=_>b?_:b;const T=y,j=g,P=0;let R,N;for(E=0;E<g;E+=1)for(k=0;k<y;k+=1){const A=E-v,M=k-w,H=Math.sqrt(A*A+M*M)*T/b;let Q=(Math.atan2(M,A)*180/Math.PI+360+P)%360;Q=Q*j/360,R=Math.floor(Q),N=Math.floor(H);let Z=(N*g+R)*4;const ae=f[Z+0],te=f[Z+1],se=f[Z+2],L=f[Z+3];Z=(k*g+E)*4,p[Z+0]=ae,p[Z+1]=te,p[Z+2]=se,p[Z+3]=L}},i=function(l){const c=l.width,d=l.height;let f,p,g,y,v,w,b,E,k,_,T=Math.round(this.kaleidoscopePower());const j=Math.round(this.kaleidoscopeAngle()),P=Math.floor(c*(j%360)/360);if(T<1)return;const R=r.Util.createCanvasElement();R.width=c,R.height=d;const N=R.getContext("2d").getImageData(0,0,c,d);r.Util.releaseCanvas(R),s(l,N,{polarCenterX:c/2,polarCenterY:d/2});let A=c/Math.pow(2,T);for(;A<=8;)A=A*2,T-=1;A=Math.ceil(A);let M=A,H=0,Q=M,Z=1;for(P+A>c&&(H=M,Q=0,Z=-1),p=0;p<d;p+=1)for(f=H;f!==Q;f+=Z)g=Math.round(f+P)%c,k=(c*p+g)*4,v=N.data[k+0],w=N.data[k+1],b=N.data[k+2],E=N.data[k+3],_=(c*p+f)*4,N.data[_+0]=v,N.data[_+1]=w,N.data[_+2]=b,N.data[_+3]=E;for(p=0;p<d;p+=1)for(M=Math.floor(A),y=0;y<T;y+=1){for(f=0;f<M+1;f+=1)k=(c*p+f)*4,v=N.data[k+0],w=N.data[k+1],b=N.data[k+2],E=N.data[k+3],_=(c*p+M*2-f-1)*4,N.data[_+0]=v,N.data[_+1]=w,N.data[_+2]=b,N.data[_+3]=E;M*=2}a(N,l,{})};return lm.Kaleidoscope=i,e.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),lm}var cm={},GT;function VM(){if(GT)return cm;GT=1,Object.defineProperty(cm,"__esModule",{value:!0}),cm.Mask=void 0;const e=Qr(),t=Ns(),r=en();function n(g,y,v){let w=(v*g.width+y)*4;const b=[];return b.push(g.data[w++],g.data[w++],g.data[w++],g.data[w++]),b}function s(g,y){return Math.sqrt(Math.pow(g[0]-y[0],2)+Math.pow(g[1]-y[1],2)+Math.pow(g[2]-y[2],2))}function a(g){const y=[0,0,0];for(let v=0;v<g.length;v++)y[0]+=g[v][0],y[1]+=g[v][1],y[2]+=g[v][2];return y[0]/=g.length,y[1]/=g.length,y[2]/=g.length,y}function i(g,y){const v=n(g,0,0),w=n(g,g.width-1,0),b=n(g,0,g.height-1),E=n(g,g.width-1,g.height-1),k=y||10;if(s(v,w)<k&&s(w,E)<k&&s(E,b)<k&&s(b,v)<k){const _=a([w,v,E,b]),T=[];for(let j=0;j<g.width*g.height;j++){const P=s(_,[g.data[j*4],g.data[j*4+1],g.data[j*4+2]]);T[j]=P<k?0:255}return T}}function l(g,y){for(let v=0;v<g.width*g.height;v++)g.data[4*v+3]=y[v]}function c(g,y,v){const w=[1,1,1,1,0,1,1,1,1],b=Math.round(Math.sqrt(w.length)),E=Math.floor(b/2),k=[];for(let _=0;_<v;_++)for(let T=0;T<y;T++){const j=_*y+T;let P=0;for(let R=0;R<b;R++)for(let N=0;N<b;N++){const A=_+R-E,M=T+N-E;if(A>=0&&A<v&&M>=0&&M<y){const H=A*y+M,Q=w[R*b+N];P+=g[H]*Q}}k[j]=P===2040?255:0}return k}function d(g,y,v){const w=[1,1,1,1,1,1,1,1,1],b=Math.round(Math.sqrt(w.length)),E=Math.floor(b/2),k=[];for(let _=0;_<v;_++)for(let T=0;T<y;T++){const j=_*y+T;let P=0;for(let R=0;R<b;R++)for(let N=0;N<b;N++){const A=_+R-E,M=T+N-E;if(A>=0&&A<v&&M>=0&&M<y){const H=A*y+M,Q=w[R*b+N];P+=g[H]*Q}}k[j]=P>=1020?255:0}return k}function f(g,y,v){const w=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],b=Math.round(Math.sqrt(w.length)),E=Math.floor(b/2),k=[];for(let _=0;_<v;_++)for(let T=0;T<y;T++){const j=_*y+T;let P=0;for(let R=0;R<b;R++)for(let N=0;N<b;N++){const A=_+R-E,M=T+N-E;if(A>=0&&A<v&&M>=0&&M<y){const H=A*y+M,Q=w[R*b+N];P+=g[H]*Q}}k[j]=P}return k}const p=function(g){const y=this.threshold();let v=i(g,y);return v&&(v=c(v,g.width,g.height),v=d(v,g.width,g.height),v=f(v,g.width,g.height),l(g,v)),g};return cm.Mask=p,e.Factory.addGetterSetter(t.Node,"threshold",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),cm}var um={},VT;function KM(){if(VT)return um;VT=1,Object.defineProperty(um,"__esModule",{value:!0}),um.Noise=void 0;const e=Qr(),t=Ns(),r=en(),n=function(s){const a=this.noise()*255,i=s.data,l=i.length,c=a/2;for(let d=0;d<l;d+=4)i[d+0]+=c-2*c*Math.random(),i[d+1]+=c-2*c*Math.random(),i[d+2]+=c-2*c*Math.random()};return um.Noise=n,e.Factory.addGetterSetter(t.Node,"noise",.2,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),um}var dm={},KT;function qM(){if(KT)return dm;KT=1,Object.defineProperty(dm,"__esModule",{value:!0}),dm.Pixelate=void 0;const e=Qr(),t=ps(),r=Ns(),n=en(),s=function(a){let i=Math.ceil(this.pixelSize()),l=a.width,c=a.height,d=Math.ceil(l/i),f=Math.ceil(c/i),p=a.data;if(i<=0){t.Util.error("pixelSize value can not be <= 0");return}for(let g=0;g<d;g+=1)for(let y=0;y<f;y+=1){let v=0,w=0,b=0,E=0;const k=g*i,_=k+i,T=y*i,j=T+i;let P=0;for(let R=k;R<_;R+=1)if(!(R>=l))for(let N=T;N<j;N+=1){if(N>=c)continue;const A=(l*N+R)*4;v+=p[A+0],w+=p[A+1],b+=p[A+2],E+=p[A+3],P+=1}v=v/P,w=w/P,b=b/P,E=E/P;for(let R=k;R<_;R+=1)if(!(R>=l))for(let N=T;N<j;N+=1){if(N>=c)continue;const A=(l*N+R)*4;p[A+0]=v,p[A+1]=w,p[A+2]=b,p[A+3]=E}}};return dm.Pixelate=s,e.Factory.addGetterSetter(r.Node,"pixelSize",8,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),dm}var fm={},qT;function XM(){if(qT)return fm;qT=1,Object.defineProperty(fm,"__esModule",{value:!0}),fm.Posterize=void 0;const e=Qr(),t=Ns(),r=en(),n=function(s){const a=Math.round(this.levels()*254)+1,i=s.data,l=i.length,c=255/a;for(let d=0;d<l;d+=1)i[d]=Math.floor(i[d]/c)*c};return fm.Posterize=n,e.Factory.addGetterSetter(t.Node,"levels",.5,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),fm}var hm={},XT;function YM(){if(XT)return hm;XT=1,Object.defineProperty(hm,"__esModule",{value:!0}),hm.RGB=void 0;const e=Qr(),t=Ns(),r=en(),n=function(s){const a=s.data,i=a.length,l=this.red(),c=this.green(),d=this.blue();for(let f=0;f<i;f+=4){const p=(.34*a[f]+.5*a[f+1]+.16*a[f+2])/255;a[f]=p*l,a[f+1]=p*c,a[f+2]=p*d,a[f+3]=a[f+3]}};return hm.RGB=n,e.Factory.addGetterSetter(t.Node,"red",0,function(s){return this._filterUpToDate=!1,s>255?255:s<0?0:Math.round(s)}),e.Factory.addGetterSetter(t.Node,"green",0,function(s){return this._filterUpToDate=!1,s>255?255:s<0?0:Math.round(s)}),e.Factory.addGetterSetter(t.Node,"blue",0,r.RGBComponent,e.Factory.afterSetFilter),hm}var gm={},YT;function JM(){if(YT)return gm;YT=1,Object.defineProperty(gm,"__esModule",{value:!0}),gm.RGBA=void 0;const e=Qr(),t=Ns(),r=en(),n=function(s){const a=s.data,i=a.length,l=this.red(),c=this.green(),d=this.blue(),f=this.alpha();for(let p=0;p<i;p+=4){const g=1-f;a[p]=l*f+a[p]*g,a[p+1]=c*f+a[p+1]*g,a[p+2]=d*f+a[p+2]*g}};return gm.RGBA=n,e.Factory.addGetterSetter(t.Node,"red",0,function(s){return this._filterUpToDate=!1,s>255?255:s<0?0:Math.round(s)}),e.Factory.addGetterSetter(t.Node,"green",0,function(s){return this._filterUpToDate=!1,s>255?255:s<0?0:Math.round(s)}),e.Factory.addGetterSetter(t.Node,"blue",0,r.RGBComponent,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"alpha",1,function(s){return this._filterUpToDate=!1,s>1?1:s<0?0:s}),gm}var mm={},JT;function QM(){if(JT)return mm;JT=1,Object.defineProperty(mm,"__esModule",{value:!0}),mm.Sepia=void 0;const e=function(t){const r=t.data,n=r.length;for(let s=0;s<n;s+=4){const a=r[s+0],i=r[s+1],l=r[s+2];r[s+0]=Math.min(255,a*.393+i*.769+l*.189),r[s+1]=Math.min(255,a*.349+i*.686+l*.168),r[s+2]=Math.min(255,a*.272+i*.534+l*.131)}};return mm.Sepia=e,mm}var pm={},QT;function ZM(){if(QT)return pm;QT=1,Object.defineProperty(pm,"__esModule",{value:!0}),pm.Solarize=void 0;const e=function(t){const r=t.data,n=t.width,s=t.height,a=n*4;let i=s;do{const l=(i-1)*a;let c=n;do{const d=l+(c-1)*4;let f=r[d],p=r[d+1],g=r[d+2];f>127&&(f=255-f),p>127&&(p=255-p),g>127&&(g=255-g),r[d]=f,r[d+1]=p,r[d+2]=g}while(--c)}while(--i)};return pm.Solarize=e,pm}var xm={},ZT;function eO(){if(ZT)return xm;ZT=1,Object.defineProperty(xm,"__esModule",{value:!0}),xm.Threshold=void 0;const e=Qr(),t=Ns(),r=en(),n=function(s){const a=this.threshold()*255,i=s.data,l=i.length;for(let c=0;c<l;c+=1)i[c]=i[c]<a?0:255};return xm.Threshold=n,e.Factory.addGetterSetter(t.Node,"threshold",.5,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),xm}var e4;function tO(){if(e4)return Fg;e4=1,Object.defineProperty(Fg,"__esModule",{value:!0}),Fg.Konva=void 0;const e=N_(),t=bM(),r=kM(),n=CM(),s=TM(),a=NM(),i=EM(),l=N6(),c=cb(),d=E6(),f=jM(),p=AM(),g=FM(),y=PM(),v=j6(),w=RM(),b=DM(),E=IM(),k=MM(),_=OM(),T=LM(),j=BM(),P=UM(),R=$M(),N=WM(),A=zM(),M=HM(),H=GM(),Q=VM(),Z=KM(),ae=qM(),te=XM(),se=YM(),L=JM(),G=QM(),I=ZM(),z=eO();return Fg.Konva=e.Konva.Util._assign(e.Konva,{Arc:t.Arc,Arrow:r.Arrow,Circle:n.Circle,Ellipse:s.Ellipse,Image:a.Image,Label:i.Label,Tag:i.Tag,Line:l.Line,Path:c.Path,Rect:d.Rect,RegularPolygon:f.RegularPolygon,Ring:p.Ring,Sprite:g.Sprite,Star:y.Star,Text:v.Text,TextPath:w.TextPath,Transformer:b.Transformer,Wedge:E.Wedge,Filters:{Blur:k.Blur,Brighten:_.Brighten,Contrast:T.Contrast,Emboss:j.Emboss,Enhance:P.Enhance,Grayscale:R.Grayscale,HSL:N.HSL,HSV:A.HSV,Invert:M.Invert,Kaleidoscope:H.Kaleidoscope,Mask:Q.Mask,Noise:Z.Noise,Pixelate:ae.Pixelate,Posterize:te.Posterize,RGB:se.RGB,RGBA:L.RGBA,Sepia:G.Sepia,Solarize:I.Solarize,Threshold:z.Threshold}}),Fg}var rO=Dy.exports,t4;function nO(){if(t4)return Dy.exports;t4=1,Object.defineProperty(rO,"__esModule",{value:!0});const e=tO();return Dy.exports=e.Konva,Dy.exports}var A6=nO();const sO=Ep(A6),aO=E3({__proto__:null,default:sO},[A6]);var oy={exports:{}},r4;function iO(){return r4||(r4=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;var r=N_();Object.defineProperty(t,"Konva",{enumerable:!0,get:function(){return r.Konva}});const n=N_();e.exports=n.Konva})(oy,oy.exports)),oy.exports}var oO=iO();const sp=Ep(oO);var yw={exports:{}};/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vw,n4;function lO(){return n4||(n4=1,vw=function(t){var r={},n=E1(),s=b2(),a=Object.assign;function i(m){for(var x="https://reactjs.org/docs/error-decoder.html?invariant="+m,F=1;F<arguments.length;F++)x+="&args[]="+encodeURIComponent(arguments[F]);return"Minified React error #"+m+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=Symbol.for("react.element"),d=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),v=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),T=Symbol.for("react.offscreen"),j=Symbol.iterator;function P(m){return m===null||typeof m!="object"?null:(m=j&&m[j]||m["@@iterator"],typeof m=="function"?m:null)}function R(m){if(m==null)return null;if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case f:return"Fragment";case d:return"Portal";case g:return"Profiler";case p:return"StrictMode";case b:return"Suspense";case E:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case v:return(m.displayName||"Context")+".Consumer";case y:return(m._context.displayName||"Context")+".Provider";case w:var x=m.render;return m=m.displayName,m||(m=x.displayName||x.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case k:return x=m.displayName||null,x!==null?x:R(m.type)||"Memo";case _:x=m._payload,m=m._init;try{return R(m(x))}catch{}}return null}function N(m){var x=m.type;switch(m.tag){case 24:return"Cache";case 9:return(x.displayName||"Context")+".Consumer";case 10:return(x._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return m=x.render,m=m.displayName||m.name||"",x.displayName||(m!==""?"ForwardRef("+m+")":"ForwardRef");case 7:return"Fragment";case 5:return x;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return R(x);case 8:return x===p?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x}return null}function A(m){var x=m,F=m;if(m.alternate)for(;x.return;)x=x.return;else{m=x;do x=m,(x.flags&4098)!==0&&(F=x.return),m=x.return;while(m)}return x.tag===3?F:null}function M(m){if(A(m)!==m)throw Error(i(188))}function H(m){var x=m.alternate;if(!x){if(x=A(m),x===null)throw Error(i(188));return x!==m?null:m}for(var F=m,B=x;;){var K=F.return;if(K===null)break;var re=K.alternate;if(re===null){if(B=K.return,B!==null){F=B;continue}break}if(K.child===re.child){for(re=K.child;re;){if(re===F)return M(K),m;if(re===B)return M(K),x;re=re.sibling}throw Error(i(188))}if(F.return!==B.return)F=K,B=re;else{for(var ve=!1,$e=K.child;$e;){if($e===F){ve=!0,F=K,B=re;break}if($e===B){ve=!0,B=K,F=re;break}$e=$e.sibling}if(!ve){for($e=re.child;$e;){if($e===F){ve=!0,F=re,B=K;break}if($e===B){ve=!0,B=re,F=K;break}$e=$e.sibling}if(!ve)throw Error(i(189))}}if(F.alternate!==B)throw Error(i(190))}if(F.tag!==3)throw Error(i(188));return F.stateNode.current===F?m:x}function Q(m){return m=H(m),m!==null?Z(m):null}function Z(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){var x=Z(m);if(x!==null)return x;m=m.sibling}return null}function ae(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){if(m.tag!==4){var x=ae(m);if(x!==null)return x}m=m.sibling}return null}var te=Array.isArray,se=t.getPublicInstance,L=t.getRootHostContext,G=t.getChildHostContext,I=t.prepareForCommit,z=t.resetAfterCommit,V=t.createInstance,O=t.appendInitialChild,W=t.finalizeInitialChildren,q=t.prepareUpdate,Y=t.shouldSetTextContent,ee=t.createTextInstance,X=t.scheduleTimeout,ne=t.cancelTimeout,ge=t.noTimeout,_e=t.isPrimaryRenderer,Pe=t.supportsMutation,ce=t.supportsPersistence,ye=t.supportsHydration,Fe=t.getInstanceFromNode,Me=t.preparePortalMount,Oe=t.getCurrentEventPriority,He=t.detachDeletedInstance,It=t.supportsMicrotasks,Ze=t.scheduleMicrotask,Le=t.supportsTestSelectors,De=t.findFiberRoot,et=t.getBoundingRect,bt=t.getTextContent,ut=t.isHiddenSubtree,jt=t.matchAccessibilityRole,Rt=t.setFocusIfFocusable,Xe=t.setupIntersectionObserver,Ye=t.appendChild,pt=t.appendChildToContainer,mt=t.commitTextUpdate,_t=t.commitMount,Ht=t.commitUpdate,Qt=t.insertBefore,nr=t.insertInContainerBefore,Nr=t.removeChild,fr=t.removeChildFromContainer,hr=t.resetTextContent,sr=t.hideInstance,Er=t.hideTextInstance,he=t.unhideInstance,le=t.unhideTextInstance,pe=t.clearContainer,be=t.cloneInstance,Ve=t.createContainerChildSet,Ct=t.appendChildToContainerChildSet,Et=t.finalizeContainerChildren,Be=t.replaceContainerChildren,at=t.cloneHiddenInstance,dt=t.cloneHiddenTextInstance,zt=t.canHydrateInstance,Yt=t.canHydrateTextInstance,wr=t.canHydrateSuspenseInstance,Ur=t.isSuspenseInstancePending,yr=t.isSuspenseInstanceFallback,ur=t.getSuspenseInstanceFallbackErrorDetails,oe=t.registerSuspenseInstanceRetry,we=t.getNextHydratableSibling,fe=t.getFirstHydratableChild,me=t.getFirstHydratableChildWithinContainer,Se=t.getFirstHydratableChildWithinSuspenseInstance,ke=t.hydrateInstance,We=t.hydrateTextInstance,ft=t.hydrateSuspenseInstance,Re=t.getNextHydratableInstanceAfterSuspenseInstance,ie=t.commitHydratedContainer,de=t.commitHydratedSuspenseInstance,Ce=t.clearSuspenseBoundary,Ne=t.clearSuspenseBoundaryFromContainer,Ge=t.shouldDeleteUnhydratedTailInstances,Je=t.didNotMatchHydratedContainerTextInstance,yt=t.didNotMatchHydratedTextInstance,Vt;function gt(m){if(Vt===void 0)try{throw Error()}catch(F){var x=F.stack.trim().match(/\n( *(at )?)/);Vt=x&&x[1]||""}return`
`+Vt+m}var Ot=!1;function vr(m,x){if(!m||Ot)return"";Ot=!0;var F=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(x)if(x=function(){throw Error()},Object.defineProperty(x.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x,[])}catch($t){var B=$t}Reflect.construct(m,[],x)}else{try{x.call()}catch($t){B=$t}m.call(x.prototype)}else{try{throw Error()}catch($t){B=$t}m()}}catch($t){if($t&&B&&typeof $t.stack=="string"){for(var K=$t.stack.split(`
`),re=B.stack.split(`
`),ve=K.length-1,$e=re.length-1;1<=ve&&0<=$e&&K[ve]!==re[$e];)$e--;for(;1<=ve&&0<=$e;ve--,$e--)if(K[ve]!==re[$e]){if(ve!==1||$e!==1)do if(ve--,$e--,0>$e||K[ve]!==re[$e]){var ct=`
`+K[ve].replace(" at new "," at ");return m.displayName&&ct.includes("<anonymous>")&&(ct=ct.replace("<anonymous>",m.displayName)),ct}while(1<=ve&&0<=$e);break}}}finally{Ot=!1,Error.prepareStackTrace=F}return(m=m?m.displayName||m.name:"")?gt(m):""}var kr=Object.prototype.hasOwnProperty,Pr=[],hn=-1;function Kr(m){return{current:m}}function $r(m){0>hn||(m.current=Pr[hn],Pr[hn]=null,hn--)}function or(m,x){hn++,Pr[hn]=m.current,m.current=x}var xe={},ht=Kr(xe),Ee=Kr(!1),tt=xe;function St(m,x){var F=m.type.contextTypes;if(!F)return xe;var B=m.stateNode;if(B&&B.__reactInternalMemoizedUnmaskedChildContext===x)return B.__reactInternalMemoizedMaskedChildContext;var K={},re;for(re in F)K[re]=x[re];return B&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=x,m.__reactInternalMemoizedMaskedChildContext=K),K}function je(m){return m=m.childContextTypes,m!=null}function Ke(){$r(Ee),$r(ht)}function Mt(m,x,F){if(ht.current!==xe)throw Error(i(168));or(ht,x),or(Ee,F)}function it(m,x,F){var B=m.stateNode;if(x=x.childContextTypes,typeof B.getChildContext!="function")return F;B=B.getChildContext();for(var K in B)if(!(K in x))throw Error(i(108,N(m)||"Unknown",K));return a({},F,B)}function _r(m){return m=(m=m.stateNode)&&m.__reactInternalMemoizedMergedChildContext||xe,tt=ht.current,or(ht,m),or(Ee,Ee.current),!0}function Ut(m,x,F){var B=m.stateNode;if(!B)throw Error(i(169));F?(m=it(m,x,tt),B.__reactInternalMemoizedMergedChildContext=m,$r(Ee),$r(ht),or(ht,m)):$r(Ee),or(Ee,F)}var mr=Math.clz32?Math.clz32:Tt,Mr=Math.log,lt=Math.LN2;function Tt(m){return m>>>=0,m===0?32:31-(Mr(m)/lt|0)|0}var Pt=64,zn=4194304;function pr(m){switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return m&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return m}}function mn(m,x){var F=m.pendingLanes;if(F===0)return 0;var B=0,K=m.suspendedLanes,re=m.pingedLanes,ve=F&268435455;if(ve!==0){var $e=ve&~K;$e!==0?B=pr($e):(re&=ve,re!==0&&(B=pr(re)))}else ve=F&~K,ve!==0?B=pr(ve):re!==0&&(B=pr(re));if(B===0)return 0;if(x!==0&&x!==B&&(x&K)===0&&(K=B&-B,re=x&-x,K>=re||K===16&&(re&4194240)!==0))return x;if((B&4)!==0&&(B|=F&16),x=m.entangledLanes,x!==0)for(m=m.entanglements,x&=B;0<x;)F=31-mr(x),K=1<<F,B|=m[F],x&=~K;return B}function In(m,x){switch(m){case 1:case 2:case 4:return x+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ha(m,x){for(var F=m.suspendedLanes,B=m.pingedLanes,K=m.expirationTimes,re=m.pendingLanes;0<re;){var ve=31-mr(re),$e=1<<ve,ct=K[ve];ct===-1?(($e&F)===0||($e&B)!==0)&&(K[ve]=In($e,x)):ct<=x&&(m.expiredLanes|=$e),re&=~$e}}function nl(m){return m=m.pendingLanes&-1073741825,m!==0?m:m&1073741824?1073741824:0}function Wc(){var m=Pt;return Pt<<=1,(Pt&4194240)===0&&(Pt=64),m}function sl(m){for(var x=[],F=0;31>F;F++)x.push(m);return x}function yi(m,x,F){m.pendingLanes|=x,x!==536870912&&(m.suspendedLanes=0,m.pingedLanes=0),m=m.eventTimes,x=31-mr(x),m[x]=F}function al(m,x){var F=m.pendingLanes&~x;m.pendingLanes=x,m.suspendedLanes=0,m.pingedLanes=0,m.expiredLanes&=x,m.mutableReadLanes&=x,m.entangledLanes&=x,x=m.entanglements;var B=m.eventTimes;for(m=m.expirationTimes;0<F;){var K=31-mr(F),re=1<<K;x[K]=0,B[K]=-1,m[K]=-1,F&=~re}}function Qi(m,x){var F=m.entangledLanes|=x;for(m=m.entanglements;F;){var B=31-mr(F),K=1<<B;K&x|m[B]&x&&(m[B]|=x),F&=~K}}var qr=0;function zc(m){return m&=-m,1<m?4<m?(m&268435455)!==0?16:536870912:4:1}var Zi=s.unstable_scheduleCallback,sx=s.unstable_cancelCallback,ax=s.unstable_shouldYield,od=s.unstable_requestPaint,js=s.unstable_now,Rf=s.unstable_ImmediatePriority,Df=s.unstable_UserBlockingPriority,If=s.unstable_NormalPriority,fv=s.unstable_IdlePriority,il=null,Ra=null;function Hc(m){if(Ra&&typeof Ra.onCommitFiberRoot=="function")try{Ra.onCommitFiberRoot(il,m,void 0,(m.current.flags&128)===128)}catch{}}function Mf(m,x){return m===x&&(m!==0||1/m===1/x)||m!==m&&x!==x}var Mi=typeof Object.is=="function"?Object.is:Mf,jo=null,Gc=!1,Vc=!1;function Of(m){jo===null?jo=[m]:jo.push(m)}function ix(m){Gc=!0,Of(m)}function Us(){if(!Vc&&jo!==null){Vc=!0;var m=0,x=qr;try{var F=jo;for(qr=1;m<F.length;m++){var B=F[m];do B=B(!0);while(B!==null)}jo=null,Gc=!1}catch(K){throw jo!==null&&(jo=jo.slice(m+1)),Zi(Rf,Us),K}finally{qr=x,Vc=!1}}return null}var ol=[],Ao=0,ld=null,Gl=0,ga=[],Qa=0,xs=null,Da=1,Oi="";function Li(m,x){ol[Ao++]=Gl,ol[Ao++]=ld,ld=m,Gl=x}function ox(m,x,F){ga[Qa++]=Da,ga[Qa++]=Oi,ga[Qa++]=xs,xs=m;var B=Da;m=Oi;var K=32-mr(B)-1;B&=~(1<<K),F+=1;var re=32-mr(x)+K;if(30<re){var ve=K-K%5;re=(B&(1<<ve)-1).toString(32),B>>=ve,K-=ve,Da=1<<32-mr(x)+K|F<<K|B,Oi=re+m}else Da=1<<re|F<<K|B,Oi=m}function cd(m){m.return!==null&&(Li(m,1),ox(m,1,0))}function ud(m){for(;m===ld;)ld=ol[--Ao],ol[Ao]=null,Gl=ol[--Ao],ol[Ao]=null;for(;m===xs;)xs=ga[--Qa],ga[Qa]=null,Oi=ga[--Qa],ga[Qa]=null,Da=ga[--Qa],ga[Qa]=null}var $s=null,ma=null,En=!1,dd=!1,Bi=null;function lx(m,x){var F=li(5,null,null,0);F.elementType="DELETED",F.stateNode=x,F.return=m,x=m.deletions,x===null?(m.deletions=[F],m.flags|=16):x.push(F)}function Lf(m,x){switch(m.tag){case 5:return x=zt(x,m.type,m.pendingProps),x!==null?(m.stateNode=x,$s=m,ma=fe(x),!0):!1;case 6:return x=Yt(x,m.pendingProps),x!==null?(m.stateNode=x,$s=m,ma=null,!0):!1;case 13:if(x=wr(x),x!==null){var F=xs!==null?{id:Da,overflow:Oi}:null;return m.memoizedState={dehydrated:x,treeContext:F,retryLane:1073741824},F=li(18,null,null,0),F.stateNode=x,F.return=m,m.child=F,$s=m,ma=null,!0}return!1;default:return!1}}function U0(m){return(m.mode&1)!==0&&(m.flags&128)===0}function $0(m){if(En){var x=ma;if(x){var F=x;if(!Lf(m,x)){if(U0(m))throw Error(i(418));x=we(F);var B=$s;x&&Lf(m,x)?lx(B,F):(m.flags=m.flags&-4097|2,En=!1,$s=m)}}else{if(U0(m))throw Error(i(418));m.flags=m.flags&-4097|2,En=!1,$s=m}}}function cx(m){for(m=m.return;m!==null&&m.tag!==5&&m.tag!==3&&m.tag!==13;)m=m.return;$s=m}function Bf(m){if(!ye||m!==$s)return!1;if(!En)return cx(m),En=!0,!1;if(m.tag!==3&&(m.tag!==5||Ge(m.type)&&!Y(m.type,m.memoizedProps))){var x=ma;if(x){if(U0(m))throw ux(),Error(i(418));for(;x;)lx(m,x),x=we(x)}}if(cx(m),m.tag===13){if(!ye)throw Error(i(316));if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));ma=Re(m)}else ma=$s?we(m.stateNode):null;return!0}function ux(){for(var m=ma;m;)m=we(m)}function Vl(){ye&&(ma=$s=null,dd=En=!1)}function W0(m){Bi===null?Bi=[m]:Bi.push(m)}var hv=l.ReactCurrentBatchConfig;function Uf(m,x){if(Mi(m,x))return!0;if(typeof m!="object"||m===null||typeof x!="object"||x===null)return!1;var F=Object.keys(m),B=Object.keys(x);if(F.length!==B.length)return!1;for(B=0;B<F.length;B++){var K=F[B];if(!kr.call(x,K)||!Mi(m[K],x[K]))return!1}return!0}function gv(m){switch(m.tag){case 5:return gt(m.type);case 16:return gt("Lazy");case 13:return gt("Suspense");case 19:return gt("SuspenseList");case 0:case 2:case 15:return m=vr(m.type,!1),m;case 11:return m=vr(m.type.render,!1),m;case 1:return m=vr(m.type,!0),m;default:return""}}function Kl(m,x,F){if(m=F.ref,m!==null&&typeof m!="function"&&typeof m!="object"){if(F._owner){if(F=F._owner,F){if(F.tag!==1)throw Error(i(309));var B=F.stateNode}if(!B)throw Error(i(147,m));var K=B,re=""+m;return x!==null&&x.ref!==null&&typeof x.ref=="function"&&x.ref._stringRef===re?x.ref:(x=function(ve){var $e=K.refs;ve===null?delete $e[re]:$e[re]=ve},x._stringRef=re,x)}if(typeof m!="string")throw Error(i(284));if(!F._owner)throw Error(i(290,m))}return m}function $f(m,x){throw m=Object.prototype.toString.call(x),Error(i(31,m==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":m))}function dx(m){var x=m._init;return x(m._payload)}function fx(m){function x(st,ze){if(m){var xt=st.deletions;xt===null?(st.deletions=[ze],st.flags|=16):xt.push(ze)}}function F(st,ze){if(!m)return null;for(;ze!==null;)x(st,ze),ze=ze.sibling;return null}function B(st,ze){for(st=new Map;ze!==null;)ze.key!==null?st.set(ze.key,ze):st.set(ze.index,ze),ze=ze.sibling;return st}function K(st,ze){return st=Cl(st,ze),st.index=0,st.sibling=null,st}function re(st,ze,xt){return st.index=xt,m?(xt=st.alternate,xt!==null?(xt=xt.index,xt<ze?(st.flags|=2,ze):xt):(st.flags|=2,ze)):(st.flags|=1048576,ze)}function ve(st){return m&&st.alternate===null&&(st.flags|=2),st}function $e(st,ze,xt,er){return ze===null||ze.tag!==6?(ze=xu(xt,st.mode,er),ze.return=st,ze):(ze=K(ze,xt),ze.return=st,ze)}function ct(st,ze,xt,er){var gr=xt.type;return gr===f?ar(st,ze,xt.props.children,er,xt.key):ze!==null&&(ze.elementType===gr||typeof gr=="object"&&gr!==null&&gr.$$typeof===_&&dx(gr)===ze.type)?(er=K(ze,xt.props),er.ref=Kl(st,ze,xt),er.return=st,er):(er=vh(xt.type,xt.key,xt.props,null,st.mode,er),er.ref=Kl(st,ze,xt),er.return=st,er)}function $t(st,ze,xt,er){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==xt.containerInfo||ze.stateNode.implementation!==xt.implementation?(ze=wh(xt,st.mode,er),ze.return=st,ze):(ze=K(ze,xt.children||[]),ze.return=st,ze)}function ar(st,ze,xt,er,gr){return ze===null||ze.tag!==7?(ze=Hs(xt,st.mode,er,gr),ze.return=st,ze):(ze=K(ze,xt),ze.return=st,ze)}function Dr(st,ze,xt){if(typeof ze=="string"&&ze!==""||typeof ze=="number")return ze=xu(""+ze,st.mode,xt),ze.return=st,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case c:return xt=vh(ze.type,ze.key,ze.props,null,st.mode,xt),xt.ref=Kl(st,null,ze),xt.return=st,xt;case d:return ze=wh(ze,st.mode,xt),ze.return=st,ze;case _:var er=ze._init;return Dr(st,er(ze._payload),xt)}if(te(ze)||P(ze))return ze=Hs(ze,st.mode,xt,null),ze.return=st,ze;$f(st,ze)}return null}function Zt(st,ze,xt,er){var gr=ze!==null?ze.key:null;if(typeof xt=="string"&&xt!==""||typeof xt=="number")return gr!==null?null:$e(st,ze,""+xt,er);if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case c:return xt.key===gr?ct(st,ze,xt,er):null;case d:return xt.key===gr?$t(st,ze,xt,er):null;case _:return gr=xt._init,Zt(st,ze,gr(xt._payload),er)}if(te(xt)||P(xt))return gr!==null?null:ar(st,ze,xt,er,null);$f(st,xt)}return null}function Tn(st,ze,xt,er,gr){if(typeof er=="string"&&er!==""||typeof er=="number")return st=st.get(xt)||null,$e(ze,st,""+er,gr);if(typeof er=="object"&&er!==null){switch(er.$$typeof){case c:return st=st.get(er.key===null?xt:er.key)||null,ct(ze,st,er,gr);case d:return st=st.get(er.key===null?xt:er.key)||null,$t(ze,st,er,gr);case _:var Wr=er._init;return Tn(st,ze,xt,Wr(er._payload),gr)}if(te(er)||P(er))return st=st.get(xt)||null,ar(ze,st,er,gr,null);$f(ze,er)}return null}function dn(st,ze,xt,er){for(var gr=null,Wr=null,Ir=ze,Zr=ze=0,bs=null;Ir!==null&&Zr<xt.length;Zr++){Ir.index>Zr?(bs=Ir,Ir=null):bs=Ir.sibling;var Jr=Zt(st,Ir,xt[Zr],er);if(Jr===null){Ir===null&&(Ir=bs);break}m&&Ir&&Jr.alternate===null&&x(st,Ir),ze=re(Jr,ze,Zr),Wr===null?gr=Jr:Wr.sibling=Jr,Wr=Jr,Ir=bs}if(Zr===xt.length)return F(st,Ir),En&&Li(st,Zr),gr;if(Ir===null){for(;Zr<xt.length;Zr++)Ir=Dr(st,xt[Zr],er),Ir!==null&&(ze=re(Ir,ze,Zr),Wr===null?gr=Ir:Wr.sibling=Ir,Wr=Ir);return En&&Li(st,Zr),gr}for(Ir=B(st,Ir);Zr<xt.length;Zr++)bs=Tn(Ir,st,Zr,xt[Zr],er),bs!==null&&(m&&bs.alternate!==null&&Ir.delete(bs.key===null?Zr:bs.key),ze=re(bs,ze,Zr),Wr===null?gr=bs:Wr.sibling=bs,Wr=bs);return m&&Ir.forEach(function(ra){return x(st,ra)}),En&&Li(st,Zr),gr}function _a(st,ze,xt,er){var gr=P(xt);if(typeof gr!="function")throw Error(i(150));if(xt=gr.call(xt),xt==null)throw Error(i(151));for(var Wr=gr=null,Ir=ze,Zr=ze=0,bs=null,Jr=xt.next();Ir!==null&&!Jr.done;Zr++,Jr=xt.next()){Ir.index>Zr?(bs=Ir,Ir=null):bs=Ir.sibling;var ra=Zt(st,Ir,Jr.value,er);if(ra===null){Ir===null&&(Ir=bs);break}m&&Ir&&ra.alternate===null&&x(st,Ir),ze=re(ra,ze,Zr),Wr===null?gr=ra:Wr.sibling=ra,Wr=ra,Ir=bs}if(Jr.done)return F(st,Ir),En&&Li(st,Zr),gr;if(Ir===null){for(;!Jr.done;Zr++,Jr=xt.next())Jr=Dr(st,Jr.value,er),Jr!==null&&(ze=re(Jr,ze,Zr),Wr===null?gr=Jr:Wr.sibling=Jr,Wr=Jr);return En&&Li(st,Zr),gr}for(Ir=B(st,Ir);!Jr.done;Zr++,Jr=xt.next())Jr=Tn(Ir,st,Zr,Jr.value,er),Jr!==null&&(m&&Jr.alternate!==null&&Ir.delete(Jr.key===null?Zr:Jr.key),ze=re(Jr,ze,Zr),Wr===null?gr=Jr:Wr.sibling=Jr,Wr=Jr);return m&&Ir.forEach(function(vv){return x(st,vv)}),En&&Li(st,Zr),gr}function lo(st,ze,xt,er){if(typeof xt=="object"&&xt!==null&&xt.type===f&&xt.key===null&&(xt=xt.props.children),typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case c:e:{for(var gr=xt.key,Wr=ze;Wr!==null;){if(Wr.key===gr){if(gr=xt.type,gr===f){if(Wr.tag===7){F(st,Wr.sibling),ze=K(Wr,xt.props.children),ze.return=st,st=ze;break e}}else if(Wr.elementType===gr||typeof gr=="object"&&gr!==null&&gr.$$typeof===_&&dx(gr)===Wr.type){F(st,Wr.sibling),ze=K(Wr,xt.props),ze.ref=Kl(st,Wr,xt),ze.return=st,st=ze;break e}F(st,Wr);break}else x(st,Wr);Wr=Wr.sibling}xt.type===f?(ze=Hs(xt.props.children,st.mode,er,xt.key),ze.return=st,st=ze):(er=vh(xt.type,xt.key,xt.props,null,st.mode,er),er.ref=Kl(st,ze,xt),er.return=st,st=er)}return ve(st);case d:e:{for(Wr=xt.key;ze!==null;){if(ze.key===Wr)if(ze.tag===4&&ze.stateNode.containerInfo===xt.containerInfo&&ze.stateNode.implementation===xt.implementation){F(st,ze.sibling),ze=K(ze,xt.children||[]),ze.return=st,st=ze;break e}else{F(st,ze);break}else x(st,ze);ze=ze.sibling}ze=wh(xt,st.mode,er),ze.return=st,st=ze}return ve(st);case _:return Wr=xt._init,lo(st,ze,Wr(xt._payload),er)}if(te(xt))return dn(st,ze,xt,er);if(P(xt))return _a(st,ze,xt,er);$f(st,xt)}return typeof xt=="string"&&xt!==""||typeof xt=="number"?(xt=""+xt,ze!==null&&ze.tag===6?(F(st,ze.sibling),ze=K(ze,xt),ze.return=st,st=ze):(F(st,ze),ze=xu(xt,st.mode,er),ze.return=st,st=ze),ve(st)):F(st,ze)}return lo}var ql=fx(!0),hx=fx(!1),Wf=Kr(null),zf=null,Kc=null,z0=null;function H0(){z0=Kc=zf=null}function gx(m,x,F){_e?(or(Wf,x._currentValue),x._currentValue=F):(or(Wf,x._currentValue2),x._currentValue2=F)}function fd(m){var x=Wf.current;$r(Wf),_e?m._currentValue=x:m._currentValue2=x}function Xl(m,x,F){for(;m!==null;){var B=m.alternate;if((m.childLanes&x)!==x?(m.childLanes|=x,B!==null&&(B.childLanes|=x)):B!==null&&(B.childLanes&x)!==x&&(B.childLanes|=x),m===F)break;m=m.return}}function qc(m,x){zf=m,z0=Kc=null,m=m.dependencies,m!==null&&m.firstContext!==null&&((m.lanes&x)!==0&&(vs=!0),m.firstContext=null)}function Za(m){var x=_e?m._currentValue:m._currentValue2;if(z0!==m)if(m={context:m,memoizedValue:x,next:null},Kc===null){if(zf===null)throw Error(i(308));Kc=m,zf.dependencies={lanes:0,firstContext:m}}else Kc=Kc.next=m;return x}var ll=null;function Hf(m){ll===null?ll=[m]:ll.push(m)}function G0(m,x,F,B){var K=x.interleaved;return K===null?(F.next=F,Hf(x)):(F.next=K.next,K.next=F),x.interleaved=F,Ui(m,B)}function Ui(m,x){m.lanes|=x;var F=m.alternate;for(F!==null&&(F.lanes|=x),F=m,m=m.return;m!==null;)m.childLanes|=x,F=m.alternate,F!==null&&(F.childLanes|=x),F=m,m=m.return;return F.tag===3?F.stateNode:null}var ei=!1;function V0(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mx(m,x){m=m.updateQueue,x.updateQueue===m&&(x.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,effects:m.effects})}function Fo(m,x){return{eventTime:m,lane:x,tag:0,payload:null,callback:null,next:null}}function Po(m,x,F){var B=m.updateQueue;if(B===null)return null;if(B=B.shared,(Or&2)!==0){var K=B.pending;return K===null?x.next=x:(x.next=K.next,K.next=x),B.pending=x,Ui(m,F)}return K=B.interleaved,K===null?(x.next=x,Hf(B)):(x.next=K.next,K.next=x),B.interleaved=x,Ui(m,F)}function hd(m,x,F){if(x=x.updateQueue,x!==null&&(x=x.shared,(F&4194240)!==0)){var B=x.lanes;B&=m.pendingLanes,F|=B,x.lanes=F,Qi(m,F)}}function Xc(m,x){var F=m.updateQueue,B=m.alternate;if(B!==null&&(B=B.updateQueue,F===B)){var K=null,re=null;if(F=F.firstBaseUpdate,F!==null){do{var ve={eventTime:F.eventTime,lane:F.lane,tag:F.tag,payload:F.payload,callback:F.callback,next:null};re===null?K=re=ve:re=re.next=ve,F=F.next}while(F!==null);re===null?K=re=x:re=re.next=x}else K=re=x;F={baseState:B.baseState,firstBaseUpdate:K,lastBaseUpdate:re,shared:B.shared,effects:B.effects},m.updateQueue=F;return}m=F.lastBaseUpdate,m===null?F.firstBaseUpdate=x:m.next=x,F.lastBaseUpdate=x}function cl(m,x,F,B){var K=m.updateQueue;ei=!1;var re=K.firstBaseUpdate,ve=K.lastBaseUpdate,$e=K.shared.pending;if($e!==null){K.shared.pending=null;var ct=$e,$t=ct.next;ct.next=null,ve===null?re=$t:ve.next=$t,ve=ct;var ar=m.alternate;ar!==null&&(ar=ar.updateQueue,$e=ar.lastBaseUpdate,$e!==ve&&($e===null?ar.firstBaseUpdate=$t:$e.next=$t,ar.lastBaseUpdate=ct))}if(re!==null){var Dr=K.baseState;ve=0,ar=$t=ct=null,$e=re;do{var Zt=$e.lane,Tn=$e.eventTime;if((B&Zt)===Zt){ar!==null&&(ar=ar.next={eventTime:Tn,lane:0,tag:$e.tag,payload:$e.payload,callback:$e.callback,next:null});e:{var dn=m,_a=$e;switch(Zt=x,Tn=F,_a.tag){case 1:if(dn=_a.payload,typeof dn=="function"){Dr=dn.call(Tn,Dr,Zt);break e}Dr=dn;break e;case 3:dn.flags=dn.flags&-65537|128;case 0:if(dn=_a.payload,Zt=typeof dn=="function"?dn.call(Tn,Dr,Zt):dn,Zt==null)break e;Dr=a({},Dr,Zt);break e;case 2:ei=!0}}$e.callback!==null&&$e.lane!==0&&(m.flags|=64,Zt=K.effects,Zt===null?K.effects=[$e]:Zt.push($e))}else Tn={eventTime:Tn,lane:Zt,tag:$e.tag,payload:$e.payload,callback:$e.callback,next:null},ar===null?($t=ar=Tn,ct=Dr):ar=ar.next=Tn,ve|=Zt;if($e=$e.next,$e===null){if($e=K.shared.pending,$e===null)break;Zt=$e,$e=Zt.next,Zt.next=null,K.lastBaseUpdate=Zt,K.shared.pending=null}}while(!0);if(ar===null&&(ct=Dr),K.baseState=ct,K.firstBaseUpdate=$t,K.lastBaseUpdate=ar,x=K.shared.interleaved,x!==null){K=x;do ve|=K.lane,K=K.next;while(K!==x)}else re===null&&(K.shared.lanes=0);Oo|=ve,m.lanes=ve,m.memoizedState=Dr}}function px(m,x,F){if(m=x.effects,x.effects=null,m!==null)for(x=0;x<m.length;x++){var B=m[x],K=B.callback;if(K!==null){if(B.callback=null,B=F,typeof K!="function")throw Error(i(191,K));K.call(B)}}}var ul={},vi=Kr(ul),Yc=Kr(ul),dl=Kr(ul);function wi(m){if(m===ul)throw Error(i(174));return m}function Gf(m,x){or(dl,x),or(Yc,m),or(vi,ul),m=L(x),$r(vi),or(vi,m)}function Yl(){$r(vi),$r(Yc),$r(dl)}function K0(m){var x=wi(dl.current),F=wi(vi.current);x=G(F,m.type,x),F!==x&&(or(Yc,m),or(vi,x))}function q0(m){Yc.current===m&&($r(vi),$r(Yc))}var Mn=Kr(0);function Vf(m){for(var x=m;x!==null;){if(x.tag===13){var F=x.memoizedState;if(F!==null&&(F=F.dehydrated,F===null||Ur(F)||yr(F)))return x}else if(x.tag===19&&x.memoizedProps.revealOrder!==void 0){if((x.flags&128)!==0)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===m)break;for(;x.sibling===null;){if(x.return===null||x.return===m)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}var X0=[];function Y0(){for(var m=0;m<X0.length;m++){var x=X0[m];_e?x._workInProgressVersionPrimary=null:x._workInProgressVersionSecondary=null}X0.length=0}var Ia=l.ReactCurrentDispatcher,Jl=l.ReactCurrentBatchConfig,fl=0,Fn=null,ns=null,ys=null,Jc=!1,gd=!1,md=0,Qc=0;function As(){throw Error(i(321))}function Ql(m,x){if(x===null)return!1;for(var F=0;F<x.length&&F<m.length;F++)if(!Mi(m[F],x[F]))return!1;return!0}function pd(m,x,F,B,K,re){if(fl=re,Fn=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,Ia.current=m===null||m.memoizedState===null?ig:og,m=F(B,K),gd){re=0;do{if(gd=!1,md=0,25<=re)throw Error(i(301));re+=1,ys=ns=null,x.updateQueue=null,Ia.current=lg,m=F(B,K)}while(gd)}if(Ia.current=nc,x=ns!==null&&ns.next!==null,fl=0,ys=ns=Fn=null,Jc=!1,x)throw Error(i(300));return m}function Kf(){var m=md!==0;return md=0,m}function ti(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ys===null?Fn.memoizedState=ys=m:ys=ys.next=m,ys}function Ws(){if(ns===null){var m=Fn.alternate;m=m!==null?m.memoizedState:null}else m=ns.next;var x=ys===null?Fn.memoizedState:ys.next;if(x!==null)ys=x,ns=m;else{if(m===null)throw Error(i(310));ns=m,m={memoizedState:ns.memoizedState,baseState:ns.baseState,baseQueue:ns.baseQueue,queue:ns.queue,next:null},ys===null?Fn.memoizedState=ys=m:ys=ys.next=m}return ys}function Zl(m,x){return typeof x=="function"?x(m):x}function qf(m){var x=Ws(),F=x.queue;if(F===null)throw Error(i(311));F.lastRenderedReducer=m;var B=ns,K=B.baseQueue,re=F.pending;if(re!==null){if(K!==null){var ve=K.next;K.next=re.next,re.next=ve}B.baseQueue=K=re,F.pending=null}if(K!==null){re=K.next,B=B.baseState;var $e=ve=null,ct=null,$t=re;do{var ar=$t.lane;if((fl&ar)===ar)ct!==null&&(ct=ct.next={lane:0,action:$t.action,hasEagerState:$t.hasEagerState,eagerState:$t.eagerState,next:null}),B=$t.hasEagerState?$t.eagerState:m(B,$t.action);else{var Dr={lane:ar,action:$t.action,hasEagerState:$t.hasEagerState,eagerState:$t.eagerState,next:null};ct===null?($e=ct=Dr,ve=B):ct=ct.next=Dr,Fn.lanes|=ar,Oo|=ar}$t=$t.next}while($t!==null&&$t!==re);ct===null?ve=B:ct.next=$e,Mi(B,x.memoizedState)||(vs=!0),x.memoizedState=B,x.baseState=ve,x.baseQueue=ct,F.lastRenderedState=B}if(m=F.interleaved,m!==null){K=m;do re=K.lane,Fn.lanes|=re,Oo|=re,K=K.next;while(K!==m)}else K===null&&(F.lanes=0);return[x.memoizedState,F.dispatch]}function Zc(m){var x=Ws(),F=x.queue;if(F===null)throw Error(i(311));F.lastRenderedReducer=m;var B=F.dispatch,K=F.pending,re=x.memoizedState;if(K!==null){F.pending=null;var ve=K=K.next;do re=m(re,ve.action),ve=ve.next;while(ve!==K);Mi(re,x.memoizedState)||(vs=!0),x.memoizedState=re,x.baseQueue===null&&(x.baseState=re),F.lastRenderedState=re}return[re,B]}function J0(){}function Q0(m,x){var F=Fn,B=Ws(),K=x(),re=!Mi(B.memoizedState,K);if(re&&(B.memoizedState=K,vs=!0),B=B.queue,Jf(tg.bind(null,F,B,m),[m]),B.getSnapshot!==x||re||ys!==null&&ys.memoizedState.tag&1){if(F.flags|=2048,ec(9,eg.bind(null,F,B,K,x),void 0,null),xn===null)throw Error(i(349));(fl&30)!==0||Z0(F,x,K)}return K}function Z0(m,x,F){m.flags|=16384,m={getSnapshot:x,value:F},x=Fn.updateQueue,x===null?(x={lastEffect:null,stores:null},Fn.updateQueue=x,x.stores=[m]):(F=x.stores,F===null?x.stores=[m]:F.push(m))}function eg(m,x,F,B){x.value=F,x.getSnapshot=B,rg(x)&&Ro(m)}function tg(m,x,F){return F(function(){rg(x)&&Ro(m)})}function rg(m){var x=m.getSnapshot;m=m.value;try{var F=x();return!Mi(m,F)}catch{return!0}}function Ro(m){var x=Ui(m,1);x!==null&&ea(x,m,1,-1)}function Xf(m){var x=ti();return typeof m=="function"&&(m=m()),x.memoizedState=x.baseState=m,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zl,lastRenderedState:m},x.queue=m,m=m.dispatch=mv.bind(null,Fn,m),[x.memoizedState,m]}function ec(m,x,F,B){return m={tag:m,create:x,destroy:F,deps:B,next:null},x=Fn.updateQueue,x===null?(x={lastEffect:null,stores:null},Fn.updateQueue=x,x.lastEffect=m.next=m):(F=x.lastEffect,F===null?x.lastEffect=m.next=m:(B=F.next,F.next=m,m.next=B,x.lastEffect=m)),m}function xx(){return Ws().memoizedState}function Yf(m,x,F,B){var K=ti();Fn.flags|=m,K.memoizedState=ec(1|x,F,void 0,B===void 0?null:B)}function hl(m,x,F,B){var K=Ws();B=B===void 0?null:B;var re=void 0;if(ns!==null){var ve=ns.memoizedState;if(re=ve.destroy,B!==null&&Ql(B,ve.deps)){K.memoizedState=ec(x,F,re,B);return}}Fn.flags|=m,K.memoizedState=ec(1|x,F,re,B)}function yx(m,x){return Yf(8390656,8,m,x)}function Jf(m,x){return hl(2048,8,m,x)}function ng(m,x){return hl(4,2,m,x)}function Sn(m,x){return hl(4,4,m,x)}function Qf(m,x){if(typeof x=="function")return m=m(),x(m),function(){x(null)};if(x!=null)return m=m(),x.current=m,function(){x.current=null}}function xd(m,x,F){return F=F!=null?F.concat([m]):null,hl(4,4,Qf.bind(null,x,m),F)}function tc(){}function sg(m,x){var F=Ws();x=x===void 0?null:x;var B=F.memoizedState;return B!==null&&x!==null&&Ql(x,B[1])?B[0]:(F.memoizedState=[m,x],m)}function Zf(m,x){var F=Ws();x=x===void 0?null:x;var B=F.memoizedState;return B!==null&&x!==null&&Ql(x,B[1])?B[0]:(m=m(),F.memoizedState=[m,x],m)}function eu(m,x,F){return(fl&21)===0?(m.baseState&&(m.baseState=!1,vs=!0),m.memoizedState=F):(Mi(F,x)||(F=Wc(),Fn.lanes|=F,Oo|=F,m.baseState=!0),x)}function eh(m,x){var F=qr;qr=F!==0&&4>F?F:4,m(!0);var B=Jl.transition;Jl.transition={};try{m(!1),x()}finally{qr=F,Jl.transition=B}}function rc(){return Ws().memoizedState}function vx(m,x,F){var B=_s(m);if(F={lane:B,action:F,hasEagerState:!1,eagerState:null,next:null},wx(m))ag(x,F);else if(F=G0(m,x,F,B),F!==null){var K=jn();ea(F,m,B,K),yd(F,x,B)}}function mv(m,x,F){var B=_s(m),K={lane:B,action:F,hasEagerState:!1,eagerState:null,next:null};if(wx(m))ag(x,K);else{var re=m.alternate;if(m.lanes===0&&(re===null||re.lanes===0)&&(re=x.lastRenderedReducer,re!==null))try{var ve=x.lastRenderedState,$e=re(ve,F);if(K.hasEagerState=!0,K.eagerState=$e,Mi($e,ve)){var ct=x.interleaved;ct===null?(K.next=K,Hf(x)):(K.next=ct.next,ct.next=K),x.interleaved=K;return}}catch{}finally{}F=G0(m,x,K,B),F!==null&&(K=jn(),ea(F,m,B,K),yd(F,x,B))}}function wx(m){var x=m.alternate;return m===Fn||x!==null&&x===Fn}function ag(m,x){gd=Jc=!0;var F=m.pending;F===null?x.next=x:(x.next=F.next,F.next=x),m.pending=x}function yd(m,x,F){if((F&4194240)!==0){var B=x.lanes;B&=m.pendingLanes,F|=B,x.lanes=F,Qi(m,F)}}var nc={readContext:Za,useCallback:As,useContext:As,useEffect:As,useImperativeHandle:As,useInsertionEffect:As,useLayoutEffect:As,useMemo:As,useReducer:As,useRef:As,useState:As,useDebugValue:As,useDeferredValue:As,useTransition:As,useMutableSource:As,useSyncExternalStore:As,useId:As,unstable_isNewReconciler:!1},ig={readContext:Za,useCallback:function(m,x){return ti().memoizedState=[m,x===void 0?null:x],m},useContext:Za,useEffect:yx,useImperativeHandle:function(m,x,F){return F=F!=null?F.concat([m]):null,Yf(4194308,4,Qf.bind(null,x,m),F)},useLayoutEffect:function(m,x){return Yf(4194308,4,m,x)},useInsertionEffect:function(m,x){return Yf(4,2,m,x)},useMemo:function(m,x){var F=ti();return x=x===void 0?null:x,m=m(),F.memoizedState=[m,x],m},useReducer:function(m,x,F){var B=ti();return x=F!==void 0?F(x):x,B.memoizedState=B.baseState=x,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:x},B.queue=m,m=m.dispatch=vx.bind(null,Fn,m),[B.memoizedState,m]},useRef:function(m){var x=ti();return m={current:m},x.memoizedState=m},useState:Xf,useDebugValue:tc,useDeferredValue:function(m){return ti().memoizedState=m},useTransition:function(){var m=Xf(!1),x=m[0];return m=eh.bind(null,m[1]),ti().memoizedState=m,[x,m]},useMutableSource:function(){},useSyncExternalStore:function(m,x,F){var B=Fn,K=ti();if(En){if(F===void 0)throw Error(i(407));F=F()}else{if(F=x(),xn===null)throw Error(i(349));(fl&30)!==0||Z0(B,x,F)}K.memoizedState=F;var re={value:F,getSnapshot:x};return K.queue=re,yx(tg.bind(null,B,re,m),[m]),B.flags|=2048,ec(9,eg.bind(null,B,re,F,x),void 0,null),F},useId:function(){var m=ti(),x=xn.identifierPrefix;if(En){var F=Oi,B=Da;F=(B&~(1<<32-mr(B)-1)).toString(32)+F,x=":"+x+"R"+F,F=md++,0<F&&(x+="H"+F.toString(32)),x+=":"}else F=Qc++,x=":"+x+"r"+F.toString(32)+":";return m.memoizedState=x},unstable_isNewReconciler:!1},og={readContext:Za,useCallback:sg,useContext:Za,useEffect:Jf,useImperativeHandle:xd,useInsertionEffect:ng,useLayoutEffect:Sn,useMemo:Zf,useReducer:qf,useRef:xx,useState:function(){return qf(Zl)},useDebugValue:tc,useDeferredValue:function(m){var x=Ws();return eu(x,ns.memoizedState,m)},useTransition:function(){var m=qf(Zl)[0],x=Ws().memoizedState;return[m,x]},useMutableSource:J0,useSyncExternalStore:Q0,useId:rc,unstable_isNewReconciler:!1},lg={readContext:Za,useCallback:sg,useContext:Za,useEffect:Jf,useImperativeHandle:xd,useInsertionEffect:ng,useLayoutEffect:Sn,useMemo:Zf,useReducer:Zc,useRef:xx,useState:function(){return Zc(Zl)},useDebugValue:tc,useDeferredValue:function(m){var x=Ws();return ns===null?x.memoizedState=m:eu(x,ns.memoizedState,m)},useTransition:function(){var m=Zc(Zl)[0],x=Ws().memoizedState;return[m,x]},useMutableSource:J0,useSyncExternalStore:Q0,useId:rc,unstable_isNewReconciler:!1};function ri(m,x){if(m&&m.defaultProps){x=a({},x),m=m.defaultProps;for(var F in m)x[F]===void 0&&(x[F]=m[F]);return x}return x}function cg(m,x,F,B){x=m.memoizedState,F=F(B,x),F=F==null?x:a({},x,F),m.memoizedState=F,m.lanes===0&&(m.updateQueue.baseState=F)}var vd={isMounted:function(m){return(m=m._reactInternals)?A(m)===m:!1},enqueueSetState:function(m,x,F){m=m._reactInternals;var B=jn(),K=_s(m),re=Fo(B,K);re.payload=x,F!=null&&(re.callback=F),x=Po(m,re,K),x!==null&&(ea(x,m,K,B),hd(x,m,K))},enqueueReplaceState:function(m,x,F){m=m._reactInternals;var B=jn(),K=_s(m),re=Fo(B,K);re.tag=1,re.payload=x,F!=null&&(re.callback=F),x=Po(m,re,K),x!==null&&(ea(x,m,K,B),hd(x,m,K))},enqueueForceUpdate:function(m,x){m=m._reactInternals;var F=jn(),B=_s(m),K=Fo(F,B);K.tag=2,x!=null&&(K.callback=x),x=Po(m,K,B),x!==null&&(ea(x,m,B,F),hd(x,m,B))}};function _x(m,x,F,B,K,re,ve){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(B,re,ve):x.prototype&&x.prototype.isPureReactComponent?!Uf(F,B)||!Uf(K,re):!0}function bx(m,x,F){var B=!1,K=xe,re=x.contextType;return typeof re=="object"&&re!==null?re=Za(re):(K=je(x)?tt:ht.current,B=x.contextTypes,re=(B=B!=null)?St(m,K):xe),x=new x(F,re),m.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=vd,m.stateNode=x,x._reactInternals=m,B&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=K,m.__reactInternalMemoizedMaskedChildContext=re),x}function th(m,x,F,B){m=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(F,B),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(F,B),x.state!==m&&vd.enqueueReplaceState(x,x.state,null)}function eo(m,x,F,B){var K=m.stateNode;K.props=F,K.state=m.memoizedState,K.refs={},V0(m);var re=x.contextType;typeof re=="object"&&re!==null?K.context=Za(re):(re=je(x)?tt:ht.current,K.context=St(m,re)),K.state=m.memoizedState,re=x.getDerivedStateFromProps,typeof re=="function"&&(cg(m,x,re,F),K.state=m.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(x=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),x!==K.state&&vd.enqueueReplaceState(K,K.state,null),cl(m,F,K,B),K.state=m.memoizedState),typeof K.componentDidMount=="function"&&(m.flags|=4194308)}function sc(m,x){try{var F="",B=x;do F+=gv(B),B=B.return;while(B);var K=F}catch(re){K=`
Error generating stack: `+re.message+`
`+re.stack}return{value:m,source:x,stack:K,digest:null}}function gl(m,x,F){return{value:m,source:null,stack:F??null,digest:x??null}}function _i(m,x){try{console.error(x.value)}catch(F){setTimeout(function(){throw F})}}var wd=typeof WeakMap=="function"?WeakMap:Map;function to(m,x,F){F=Fo(-1,F),F.tag=3,F.payload={element:null};var B=x.value;return F.callback=function(){Gn||(Gn=!0,ss=B),_i(m,x)},F}function rh(m,x,F){F=Fo(-1,F),F.tag=3;var B=m.type.getDerivedStateFromError;if(typeof B=="function"){var K=x.value;F.payload=function(){return B(K)},F.callback=function(){_i(m,x)}}var re=m.stateNode;return re!==null&&typeof re.componentDidCatch=="function"&&(F.callback=function(){_i(m,x),typeof B!="function"&&(Wi===null?Wi=new Set([this]):Wi.add(this));var ve=x.stack;this.componentDidCatch(x.value,{componentStack:ve!==null?ve:""})}),F}function Sx(m,x,F){var B=m.pingCache;if(B===null){B=m.pingCache=new wd;var K=new Set;B.set(x,K)}else K=B.get(x),K===void 0&&(K=new Set,B.set(x,K));K.has(F)||(K.add(F),m=Fx.bind(null,m,x,F),x.then(m,m))}function kx(m){do{var x;if((x=m.tag===13)&&(x=m.memoizedState,x=x!==null?x.dehydrated!==null:!0),x)return m;m=m.return}while(m!==null);return null}function ml(m,x,F,B,K){return(m.mode&1)===0?(m===x?m.flags|=65536:(m.flags|=128,F.flags|=131072,F.flags&=-52805,F.tag===1&&(F.alternate===null?F.tag=17:(x=Fo(-1,1),x.tag=2,Po(F,x,1))),F.lanes|=1),m):(m.flags|=65536,m.lanes=K,m)}var _d=l.ReactCurrentOwner,vs=!1;function Fs(m,x,F,B){x.child=m===null?hx(x,null,F,B):ql(x,m.child,F,B)}function nh(m,x,F,B,K){F=F.render;var re=x.ref;return qc(x,K),B=pd(m,x,F,B,re,K),F=Kf(),m!==null&&!vs?(x.updateQueue=m.updateQueue,x.flags&=-2053,m.lanes&=~K,Io(m,x,K)):(En&&F&&cd(x),x.flags|=1,Fs(m,x,B,K),x.child)}function ac(m,x,F,B,K){if(m===null){var re=F.type;return typeof re=="function"&&!mu(re)&&re.defaultProps===void 0&&F.compare===null&&F.defaultProps===void 0?(x.tag=15,x.type=re,Do(m,x,re,B,K)):(m=vh(F.type,null,B,x,x.mode,K),m.ref=x.ref,m.return=x,x.child=m)}if(re=m.child,(m.lanes&K)===0){var ve=re.memoizedProps;if(F=F.compare,F=F!==null?F:Uf,F(ve,B)&&m.ref===x.ref)return Io(m,x,K)}return x.flags|=1,m=Cl(re,B),m.ref=x.ref,m.return=x,x.child=m}function Do(m,x,F,B,K){if(m!==null){var re=m.memoizedProps;if(Uf(re,B)&&m.ref===x.ref)if(vs=!1,x.pendingProps=B=re,(m.lanes&K)!==0)(m.flags&131072)!==0&&(vs=!0);else return x.lanes=m.lanes,Io(m,x,K)}return ro(m,x,F,B,K)}function kn(m,x,F){var B=x.pendingProps,K=B.children,re=m!==null?m.memoizedState:null;if(B.mode==="hidden")if((x.mode&1)===0)x.memoizedState={baseLanes:0,cachePool:null,transitions:null},or(_l,ws),ws|=F;else{if((F&1073741824)===0)return m=re!==null?re.baseLanes|F:F,x.lanes=x.childLanes=1073741824,x.memoizedState={baseLanes:m,cachePool:null,transitions:null},x.updateQueue=null,or(_l,ws),ws|=m,null;x.memoizedState={baseLanes:0,cachePool:null,transitions:null},B=re!==null?re.baseLanes:F,or(_l,ws),ws|=B}else re!==null?(B=re.baseLanes|F,x.memoizedState=null):B=F,or(_l,ws),ws|=B;return Fs(m,x,K,F),x.child}function pn(m,x){var F=x.ref;(m===null&&F!==null||m!==null&&m.ref!==F)&&(x.flags|=512,x.flags|=2097152)}function ro(m,x,F,B,K){var re=je(F)?tt:ht.current;return re=St(x,re),qc(x,K),F=pd(m,x,F,B,re,K),B=Kf(),m!==null&&!vs?(x.updateQueue=m.updateQueue,x.flags&=-2053,m.lanes&=~K,Io(m,x,K)):(En&&B&&cd(x),x.flags|=1,Fs(m,x,F,K),x.child)}function zs(m,x,F,B,K){if(je(F)){var re=!0;_r(x)}else re=!1;if(qc(x,K),x.stateNode===null)bd(m,x),bx(x,F,B),eo(x,F,B,K),B=!0;else if(m===null){var ve=x.stateNode,$e=x.memoizedProps;ve.props=$e;var ct=ve.context,$t=F.contextType;typeof $t=="object"&&$t!==null?$t=Za($t):($t=je(F)?tt:ht.current,$t=St(x,$t));var ar=F.getDerivedStateFromProps,Dr=typeof ar=="function"||typeof ve.getSnapshotBeforeUpdate=="function";Dr||typeof ve.UNSAFE_componentWillReceiveProps!="function"&&typeof ve.componentWillReceiveProps!="function"||($e!==B||ct!==$t)&&th(x,ve,B,$t),ei=!1;var Zt=x.memoizedState;ve.state=Zt,cl(x,B,ve,K),ct=x.memoizedState,$e!==B||Zt!==ct||Ee.current||ei?(typeof ar=="function"&&(cg(x,F,ar,B),ct=x.memoizedState),($e=ei||_x(x,F,$e,B,Zt,ct,$t))?(Dr||typeof ve.UNSAFE_componentWillMount!="function"&&typeof ve.componentWillMount!="function"||(typeof ve.componentWillMount=="function"&&ve.componentWillMount(),typeof ve.UNSAFE_componentWillMount=="function"&&ve.UNSAFE_componentWillMount()),typeof ve.componentDidMount=="function"&&(x.flags|=4194308)):(typeof ve.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=B,x.memoizedState=ct),ve.props=B,ve.state=ct,ve.context=$t,B=$e):(typeof ve.componentDidMount=="function"&&(x.flags|=4194308),B=!1)}else{ve=x.stateNode,mx(m,x),$e=x.memoizedProps,$t=x.type===x.elementType?$e:ri(x.type,$e),ve.props=$t,Dr=x.pendingProps,Zt=ve.context,ct=F.contextType,typeof ct=="object"&&ct!==null?ct=Za(ct):(ct=je(F)?tt:ht.current,ct=St(x,ct));var Tn=F.getDerivedStateFromProps;(ar=typeof Tn=="function"||typeof ve.getSnapshotBeforeUpdate=="function")||typeof ve.UNSAFE_componentWillReceiveProps!="function"&&typeof ve.componentWillReceiveProps!="function"||($e!==Dr||Zt!==ct)&&th(x,ve,B,ct),ei=!1,Zt=x.memoizedState,ve.state=Zt,cl(x,B,ve,K);var dn=x.memoizedState;$e!==Dr||Zt!==dn||Ee.current||ei?(typeof Tn=="function"&&(cg(x,F,Tn,B),dn=x.memoizedState),($t=ei||_x(x,F,$t,B,Zt,dn,ct)||!1)?(ar||typeof ve.UNSAFE_componentWillUpdate!="function"&&typeof ve.componentWillUpdate!="function"||(typeof ve.componentWillUpdate=="function"&&ve.componentWillUpdate(B,dn,ct),typeof ve.UNSAFE_componentWillUpdate=="function"&&ve.UNSAFE_componentWillUpdate(B,dn,ct)),typeof ve.componentDidUpdate=="function"&&(x.flags|=4),typeof ve.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof ve.componentDidUpdate!="function"||$e===m.memoizedProps&&Zt===m.memoizedState||(x.flags|=4),typeof ve.getSnapshotBeforeUpdate!="function"||$e===m.memoizedProps&&Zt===m.memoizedState||(x.flags|=1024),x.memoizedProps=B,x.memoizedState=dn),ve.props=B,ve.state=dn,ve.context=ct,B=$t):(typeof ve.componentDidUpdate!="function"||$e===m.memoizedProps&&Zt===m.memoizedState||(x.flags|=4),typeof ve.getSnapshotBeforeUpdate!="function"||$e===m.memoizedProps&&Zt===m.memoizedState||(x.flags|=1024),B=!1)}return Js(m,x,F,B,re,K)}function Js(m,x,F,B,K,re){pn(m,x);var ve=(x.flags&128)!==0;if(!B&&!ve)return K&&Ut(x,F,!1),Io(m,x,re);B=x.stateNode,_d.current=x;var $e=ve&&typeof F.getDerivedStateFromError!="function"?null:B.render();return x.flags|=1,m!==null&&ve?(x.child=ql(x,m.child,null,re),x.child=ql(x,null,$e,re)):Fs(m,x,$e,re),x.memoizedState=B.state,K&&Ut(x,F,!0),x.child}function pl(m){var x=m.stateNode;x.pendingContext?Mt(m,x.pendingContext,x.pendingContext!==x.context):x.context&&Mt(m,x.context,!1),Gf(m,x.containerInfo)}function ic(m,x,F,B,K){return Vl(),W0(K),x.flags|=256,Fs(m,x,F,B),x.child}var Qs={dehydrated:null,treeContext:null,retryLane:0};function tu(m){return{baseLanes:m,cachePool:null,transitions:null}}function ug(m,x,F){var B=x.pendingProps,K=Mn.current,re=!1,ve=(x.flags&128)!==0,$e;if(($e=ve)||($e=m!==null&&m.memoizedState===null?!1:(K&2)!==0),$e?(re=!0,x.flags&=-129):(m===null||m.memoizedState!==null)&&(K|=1),or(Mn,K&1),m===null)return $0(x),m=x.memoizedState,m!==null&&(m=m.dehydrated,m!==null)?((x.mode&1)===0?x.lanes=1:yr(m)?x.lanes=8:x.lanes=1073741824,null):(ve=B.children,m=B.fallback,re?(B=x.mode,re=x.child,ve={mode:"hidden",children:ve},(B&1)===0&&re!==null?(re.childLanes=0,re.pendingProps=ve):re=pu(ve,B,0,null),m=Hs(m,B,F,null),re.return=x,m.return=x,re.sibling=m,x.child=re,x.child.memoizedState=tu(F),x.memoizedState=Qs,m):sh(x,ve));if(K=m.memoizedState,K!==null&&($e=K.dehydrated,$e!==null))return Cx(m,x,ve,B,$e,K,F);if(re){re=B.fallback,ve=x.mode,K=m.child,$e=K.sibling;var ct={mode:"hidden",children:B.children};return(ve&1)===0&&x.child!==K?(B=x.child,B.childLanes=0,B.pendingProps=ct,x.deletions=null):(B=Cl(K,ct),B.subtreeFlags=K.subtreeFlags&14680064),$e!==null?re=Cl($e,re):(re=Hs(re,ve,F,null),re.flags|=2),re.return=x,B.return=x,B.sibling=re,x.child=B,B=re,re=x.child,ve=m.child.memoizedState,ve=ve===null?tu(F):{baseLanes:ve.baseLanes|F,cachePool:null,transitions:ve.transitions},re.memoizedState=ve,re.childLanes=m.childLanes&~F,x.memoizedState=Qs,B}return re=m.child,m=re.sibling,B=Cl(re,{mode:"visible",children:B.children}),(x.mode&1)===0&&(B.lanes=F),B.return=x,B.sibling=null,m!==null&&(F=x.deletions,F===null?(x.deletions=[m],x.flags|=16):F.push(m)),x.child=B,x.memoizedState=null,B}function sh(m,x){return x=pu({mode:"visible",children:x},m.mode,0,null),x.return=m,m.child=x}function oc(m,x,F,B){return B!==null&&W0(B),ql(x,m.child,null,F),m=sh(x,x.pendingProps.children),m.flags|=2,x.memoizedState=null,m}function Cx(m,x,F,B,K,re,ve){if(F)return x.flags&256?(x.flags&=-257,B=gl(Error(i(422))),oc(m,x,ve,B)):x.memoizedState!==null?(x.child=m.child,x.flags|=128,null):(re=B.fallback,K=x.mode,B=pu({mode:"visible",children:B.children},K,0,null),re=Hs(re,K,ve,null),re.flags|=2,B.return=x,re.return=x,B.sibling=re,x.child=B,(x.mode&1)!==0&&ql(x,m.child,null,ve),x.child.memoizedState=tu(ve),x.memoizedState=Qs,re);if((x.mode&1)===0)return oc(m,x,ve,null);if(yr(K))return B=ur(K).digest,re=Error(i(419)),B=gl(re,B,void 0),oc(m,x,ve,B);if(F=(ve&m.childLanes)!==0,vs||F){if(B=xn,B!==null){switch(ve&-ve){case 4:K=2;break;case 16:K=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:K=32;break;case 536870912:K=268435456;break;default:K=0}K=(K&(B.suspendedLanes|ve))!==0?0:K,K!==0&&K!==re.retryLane&&(re.retryLane=K,Ui(m,K),ea(B,m,K,-1))}return gu(),B=gl(Error(i(421))),oc(m,x,ve,B)}return Ur(K)?(x.flags|=128,x.child=m.child,x=Rx.bind(null,m),oe(K,x),null):(m=re.treeContext,ye&&(ma=Se(K),$s=x,En=!0,Bi=null,dd=!1,m!==null&&(ga[Qa++]=Da,ga[Qa++]=Oi,ga[Qa++]=xs,Da=m.id,Oi=m.overflow,xs=x)),x=sh(x,B.children),x.flags|=4096,x)}function no(m,x,F){m.lanes|=x;var B=m.alternate;B!==null&&(B.lanes|=x),Xl(m.return,x,F)}function ru(m,x,F,B,K){var re=m.memoizedState;re===null?m.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:B,tail:F,tailMode:K}:(re.isBackwards=x,re.rendering=null,re.renderingStartTime=0,re.last=B,re.tail=F,re.tailMode=K)}function ah(m,x,F){var B=x.pendingProps,K=B.revealOrder,re=B.tail;if(Fs(m,x,B.children,F),B=Mn.current,(B&2)!==0)B=B&1|2,x.flags|=128;else{if(m!==null&&(m.flags&128)!==0)e:for(m=x.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&no(m,F,x);else if(m.tag===19)no(m,F,x);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===x)break e;for(;m.sibling===null;){if(m.return===null||m.return===x)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}B&=1}if(or(Mn,B),(x.mode&1)===0)x.memoizedState=null;else switch(K){case"forwards":for(F=x.child,K=null;F!==null;)m=F.alternate,m!==null&&Vf(m)===null&&(K=F),F=F.sibling;F=K,F===null?(K=x.child,x.child=null):(K=F.sibling,F.sibling=null),ru(x,!1,K,F,re);break;case"backwards":for(F=null,K=x.child,x.child=null;K!==null;){if(m=K.alternate,m!==null&&Vf(m)===null){x.child=K;break}m=K.sibling,K.sibling=F,F=K,K=m}ru(x,!0,F,null,re);break;case"together":ru(x,!1,null,null,void 0);break;default:x.memoizedState=null}return x.child}function bd(m,x){(x.mode&1)===0&&m!==null&&(m.alternate=null,x.alternate=null,x.flags|=2)}function Io(m,x,F){if(m!==null&&(x.dependencies=m.dependencies),Oo|=x.lanes,(F&x.childLanes)===0)return null;if(m!==null&&x.child!==m.child)throw Error(i(153));if(x.child!==null){for(m=x.child,F=Cl(m,m.pendingProps),x.child=F,F.return=x;m.sibling!==null;)m=m.sibling,F=F.sibling=Cl(m,m.pendingProps),F.return=x;F.sibling=null}return x.child}function xl(m,x,F){switch(x.tag){case 3:pl(x),Vl();break;case 5:K0(x);break;case 1:je(x.type)&&_r(x);break;case 4:Gf(x,x.stateNode.containerInfo);break;case 10:gx(x,x.type._context,x.memoizedProps.value);break;case 13:var B=x.memoizedState;if(B!==null)return B.dehydrated!==null?(or(Mn,Mn.current&1),x.flags|=128,null):(F&x.child.childLanes)!==0?ug(m,x,F):(or(Mn,Mn.current&1),m=Io(m,x,F),m!==null?m.sibling:null);or(Mn,Mn.current&1);break;case 19:if(B=(F&x.childLanes)!==0,(m.flags&128)!==0){if(B)return ah(m,x,F);x.flags|=128}var K=x.memoizedState;if(K!==null&&(K.rendering=null,K.tail=null,K.lastEffect=null),or(Mn,Mn.current),B)break;return null;case 22:case 23:return x.lanes=0,kn(m,x,F)}return Io(m,x,F)}function pa(m){m.flags|=4}function lc(m,x){if(m!==null&&m.child===x.child)return!0;if((x.flags&16)!==0)return!1;for(m=x.child;m!==null;){if((m.flags&12854)!==0||(m.subtreeFlags&12854)!==0)return!1;m=m.sibling}return!0}var yl,vl,xa,ya;if(Pe)yl=function(m,x){for(var F=x.child;F!==null;){if(F.tag===5||F.tag===6)O(m,F.stateNode);else if(F.tag!==4&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===x)break;for(;F.sibling===null;){if(F.return===null||F.return===x)return;F=F.return}F.sibling.return=F.return,F=F.sibling}},vl=function(){},xa=function(m,x,F,B,K){if(m=m.memoizedProps,m!==B){var re=x.stateNode,ve=wi(vi.current);F=q(re,F,m,B,K,ve),(x.updateQueue=F)&&pa(x)}},ya=function(m,x,F,B){F!==B&&pa(x)};else if(ce){yl=function(m,x,F,B){for(var K=x.child;K!==null;){if(K.tag===5){var re=K.stateNode;F&&B&&(re=at(re,K.type,K.memoizedProps,K)),O(m,re)}else if(K.tag===6)re=K.stateNode,F&&B&&(re=dt(re,K.memoizedProps,K)),O(m,re);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)re=K.child,re!==null&&(re.return=K),yl(m,K,!0,!0);else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===x)break;for(;K.sibling===null;){if(K.return===null||K.return===x)return;K=K.return}K.sibling.return=K.return,K=K.sibling}};var wl=function(m,x,F,B){for(var K=x.child;K!==null;){if(K.tag===5){var re=K.stateNode;F&&B&&(re=at(re,K.type,K.memoizedProps,K)),Ct(m,re)}else if(K.tag===6)re=K.stateNode,F&&B&&(re=dt(re,K.memoizedProps,K)),Ct(m,re);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)re=K.child,re!==null&&(re.return=K),wl(m,K,!0,!0);else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===x)break;for(;K.sibling===null;){if(K.return===null||K.return===x)return;K=K.return}K.sibling.return=K.return,K=K.sibling}};vl=function(m,x){var F=x.stateNode;if(!lc(m,x)){m=F.containerInfo;var B=Ve(m);wl(B,x,!1,!1),F.pendingChildren=B,pa(x),Et(m,B)}},xa=function(m,x,F,B,K){var re=m.stateNode,ve=m.memoizedProps;if((m=lc(m,x))&&ve===B)x.stateNode=re;else{var $e=x.stateNode,ct=wi(vi.current),$t=null;ve!==B&&($t=q($e,F,ve,B,K,ct)),m&&$t===null?x.stateNode=re:(re=be(re,$t,F,ve,B,x,m,$e),W(re,F,B,K,ct)&&pa(x),x.stateNode=re,m?pa(x):yl(re,x,!1,!1))}},ya=function(m,x,F,B){F!==B?(m=wi(dl.current),F=wi(vi.current),x.stateNode=ee(B,m,F,x),pa(x)):x.stateNode=m.stateNode}}else vl=function(){},xa=function(){},ya=function(){};function ni(m,x){if(!En)switch(m.tailMode){case"hidden":x=m.tail;for(var F=null;x!==null;)x.alternate!==null&&(F=x),x=x.sibling;F===null?m.tail=null:F.sibling=null;break;case"collapsed":F=m.tail;for(var B=null;F!==null;)F.alternate!==null&&(B=F),F=F.sibling;B===null?x||m.tail===null?m.tail=null:m.tail.sibling=null:B.sibling=null}}function Pn(m){var x=m.alternate!==null&&m.alternate.child===m.child,F=0,B=0;if(x)for(var K=m.child;K!==null;)F|=K.lanes|K.childLanes,B|=K.subtreeFlags&14680064,B|=K.flags&14680064,K.return=m,K=K.sibling;else for(K=m.child;K!==null;)F|=K.lanes|K.childLanes,B|=K.subtreeFlags,B|=K.flags,K.return=m,K=K.sibling;return m.subtreeFlags|=B,m.childLanes=F,x}function cc(m,x,F){var B=x.pendingProps;switch(ud(x),x.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pn(x),null;case 1:return je(x.type)&&Ke(),Pn(x),null;case 3:return F=x.stateNode,Yl(),$r(Ee),$r(ht),Y0(),F.pendingContext&&(F.context=F.pendingContext,F.pendingContext=null),(m===null||m.child===null)&&(Bf(x)?pa(x):m===null||m.memoizedState.isDehydrated&&(x.flags&256)===0||(x.flags|=1024,Bi!==null&&(xh(Bi),Bi=null))),vl(m,x),Pn(x),null;case 5:q0(x),F=wi(dl.current);var K=x.type;if(m!==null&&x.stateNode!=null)xa(m,x,K,B,F),m.ref!==x.ref&&(x.flags|=512,x.flags|=2097152);else{if(!B){if(x.stateNode===null)throw Error(i(166));return Pn(x),null}if(m=wi(vi.current),Bf(x)){if(!ye)throw Error(i(175));m=ke(x.stateNode,x.type,x.memoizedProps,F,m,x,!dd),x.updateQueue=m,m!==null&&pa(x)}else{var re=V(K,B,F,m,x);yl(re,x,!1,!1),x.stateNode=re,W(re,K,B,F,m)&&pa(x)}x.ref!==null&&(x.flags|=512,x.flags|=2097152)}return Pn(x),null;case 6:if(m&&x.stateNode!=null)ya(m,x,m.memoizedProps,B);else{if(typeof B!="string"&&x.stateNode===null)throw Error(i(166));if(m=wi(dl.current),F=wi(vi.current),Bf(x)){if(!ye)throw Error(i(176));if(m=x.stateNode,F=x.memoizedProps,(B=We(m,F,x,!dd))&&(K=$s,K!==null))switch(K.tag){case 3:Je(K.stateNode.containerInfo,m,F,(K.mode&1)!==0);break;case 5:yt(K.type,K.memoizedProps,K.stateNode,m,F,(K.mode&1)!==0)}B&&pa(x)}else x.stateNode=ee(B,m,F,x)}return Pn(x),null;case 13:if($r(Mn),B=x.memoizedState,m===null||m.memoizedState!==null&&m.memoizedState.dehydrated!==null){if(En&&ma!==null&&(x.mode&1)!==0&&(x.flags&128)===0)ux(),Vl(),x.flags|=98560,K=!1;else if(K=Bf(x),B!==null&&B.dehydrated!==null){if(m===null){if(!K)throw Error(i(318));if(!ye)throw Error(i(344));if(K=x.memoizedState,K=K!==null?K.dehydrated:null,!K)throw Error(i(317));ft(K,x)}else Vl(),(x.flags&128)===0&&(x.memoizedState=null),x.flags|=4;Pn(x),K=!1}else Bi!==null&&(xh(Bi),Bi=null),K=!0;if(!K)return x.flags&65536?x:null}return(x.flags&128)!==0?(x.lanes=F,x):(F=B!==null,F!==(m!==null&&m.memoizedState!==null)&&F&&(x.child.flags|=8192,(x.mode&1)!==0&&(m===null||(Mn.current&1)!==0?Dn===0&&(Dn=3):gu())),x.updateQueue!==null&&(x.flags|=4),Pn(x),null);case 4:return Yl(),vl(m,x),m===null&&Me(x.stateNode.containerInfo),Pn(x),null;case 10:return fd(x.type._context),Pn(x),null;case 17:return je(x.type)&&Ke(),Pn(x),null;case 19:if($r(Mn),K=x.memoizedState,K===null)return Pn(x),null;if(B=(x.flags&128)!==0,re=K.rendering,re===null)if(B)ni(K,!1);else{if(Dn!==0||m!==null&&(m.flags&128)!==0)for(m=x.child;m!==null;){if(re=Vf(m),re!==null){for(x.flags|=128,ni(K,!1),m=re.updateQueue,m!==null&&(x.updateQueue=m,x.flags|=4),x.subtreeFlags=0,m=F,F=x.child;F!==null;)B=F,K=m,B.flags&=14680066,re=B.alternate,re===null?(B.childLanes=0,B.lanes=K,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=re.childLanes,B.lanes=re.lanes,B.child=re.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=re.memoizedProps,B.memoizedState=re.memoizedState,B.updateQueue=re.updateQueue,B.type=re.type,K=re.dependencies,B.dependencies=K===null?null:{lanes:K.lanes,firstContext:K.firstContext}),F=F.sibling;return or(Mn,Mn.current&1|2),x.child}m=m.sibling}K.tail!==null&&js()>jd&&(x.flags|=128,B=!0,ni(K,!1),x.lanes=4194304)}else{if(!B)if(m=Vf(re),m!==null){if(x.flags|=128,B=!0,m=m.updateQueue,m!==null&&(x.updateQueue=m,x.flags|=4),ni(K,!0),K.tail===null&&K.tailMode==="hidden"&&!re.alternate&&!En)return Pn(x),null}else 2*js()-K.renderingStartTime>jd&&F!==1073741824&&(x.flags|=128,B=!0,ni(K,!1),x.lanes=4194304);K.isBackwards?(re.sibling=x.child,x.child=re):(m=K.last,m!==null?m.sibling=re:x.child=re,K.last=re)}return K.tail!==null?(x=K.tail,K.rendering=x,K.tail=x.sibling,K.renderingStartTime=js(),x.sibling=null,m=Mn.current,or(Mn,B?m&1|2:m&1),x):(Pn(x),null);case 22:case 23:return yh(),F=x.memoizedState!==null,m!==null&&m.memoizedState!==null!==F&&(x.flags|=8192),F&&(x.mode&1)!==0?(ws&1073741824)!==0&&(Pn(x),Pe&&x.subtreeFlags&6&&(x.flags|=8192)):Pn(x),null;case 24:return null;case 25:return null}throw Error(i(156,x.tag))}function Tx(m,x){switch(ud(x),x.tag){case 1:return je(x.type)&&Ke(),m=x.flags,m&65536?(x.flags=m&-65537|128,x):null;case 3:return Yl(),$r(Ee),$r(ht),Y0(),m=x.flags,(m&65536)!==0&&(m&128)===0?(x.flags=m&-65537|128,x):null;case 5:return q0(x),null;case 13:if($r(Mn),m=x.memoizedState,m!==null&&m.dehydrated!==null){if(x.alternate===null)throw Error(i(340));Vl()}return m=x.flags,m&65536?(x.flags=m&-65537|128,x):null;case 19:return $r(Mn),null;case 4:return Yl(),null;case 10:return fd(x.type._context),null;case 22:case 23:return yh(),null;case 24:return null;default:return null}}var nu=!1,Ps=!1,si=typeof WeakSet=="function"?WeakSet:Set,Jt=null;function un(m,x){var F=m.ref;if(F!==null)if(typeof F=="function")try{F(null)}catch(B){An(m,x,B)}else F.current=null}function ai(m,x,F){try{F()}catch(B){An(m,x,B)}}var dg=!1;function Nx(m,x){for(I(m.containerInfo),Jt=x;Jt!==null;)if(m=Jt,x=m.child,(m.subtreeFlags&1028)!==0&&x!==null)x.return=m,Jt=x;else for(;Jt!==null;){m=Jt;try{var F=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(F!==null){var B=F.memoizedProps,K=F.memoizedState,re=m.stateNode,ve=re.getSnapshotBeforeUpdate(m.elementType===m.type?B:ri(m.type,B),K);re.__reactInternalSnapshotBeforeUpdate=ve}break;case 3:Pe&&pe(m.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch($e){An(m,m.return,$e)}if(x=m.sibling,x!==null){x.return=m.return,Jt=x;break}Jt=m.return}return F=dg,dg=!1,F}function uc(m,x,F){var B=x.updateQueue;if(B=B!==null?B.lastEffect:null,B!==null){var K=B=B.next;do{if((K.tag&m)===m){var re=K.destroy;K.destroy=void 0,re!==void 0&&ai(x,F,re)}K=K.next}while(K!==B)}}function su(m,x){if(x=x.updateQueue,x=x!==null?x.lastEffect:null,x!==null){var F=x=x.next;do{if((F.tag&m)===m){var B=F.create;F.destroy=B()}F=F.next}while(F!==x)}}function ih(m){var x=m.ref;if(x!==null){var F=m.stateNode;switch(m.tag){case 5:m=se(F);break;default:m=F}typeof x=="function"?x(m):x.current=m}}function Sd(m){var x=m.alternate;x!==null&&(m.alternate=null,Sd(x)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(x=m.stateNode,x!==null&&He(x)),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function fg(m){return m.tag===5||m.tag===3||m.tag===4}function dc(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||fg(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function kd(m,x,F){var B=m.tag;if(B===5||B===6)m=m.stateNode,x?nr(F,m,x):pt(F,m);else if(B!==4&&(m=m.child,m!==null))for(kd(m,x,F),m=m.sibling;m!==null;)kd(m,x,F),m=m.sibling}function hg(m,x,F){var B=m.tag;if(B===5||B===6)m=m.stateNode,x?Qt(F,m,x):Ye(F,m);else if(B!==4&&(m=m.child,m!==null))for(hg(m,x,F),m=m.sibling;m!==null;)hg(m,x,F),m=m.sibling}var Xn=null,Ma=!1;function $i(m,x,F){for(F=F.child;F!==null;)oh(m,x,F),F=F.sibling}function oh(m,x,F){if(Ra&&typeof Ra.onCommitFiberUnmount=="function")try{Ra.onCommitFiberUnmount(il,F)}catch{}switch(F.tag){case 5:Ps||un(F,x);case 6:if(Pe){var B=Xn,K=Ma;Xn=null,$i(m,x,F),Xn=B,Ma=K,Xn!==null&&(Ma?fr(Xn,F.stateNode):Nr(Xn,F.stateNode))}else $i(m,x,F);break;case 18:Pe&&Xn!==null&&(Ma?Ne(Xn,F.stateNode):Ce(Xn,F.stateNode));break;case 4:Pe?(B=Xn,K=Ma,Xn=F.stateNode.containerInfo,Ma=!0,$i(m,x,F),Xn=B,Ma=K):(ce&&(B=F.stateNode.containerInfo,K=Ve(B),Be(B,K)),$i(m,x,F));break;case 0:case 11:case 14:case 15:if(!Ps&&(B=F.updateQueue,B!==null&&(B=B.lastEffect,B!==null))){K=B=B.next;do{var re=K,ve=re.destroy;re=re.tag,ve!==void 0&&((re&2)!==0||(re&4)!==0)&&ai(F,x,ve),K=K.next}while(K!==B)}$i(m,x,F);break;case 1:if(!Ps&&(un(F,x),B=F.stateNode,typeof B.componentWillUnmount=="function"))try{B.props=F.memoizedProps,B.state=F.memoizedState,B.componentWillUnmount()}catch($e){An(F,x,$e)}$i(m,x,F);break;case 21:$i(m,x,F);break;case 22:F.mode&1?(Ps=(B=Ps)||F.memoizedState!==null,$i(m,x,F),Ps=B):$i(m,x,F);break;default:$i(m,x,F)}}function fc(m){var x=m.updateQueue;if(x!==null){m.updateQueue=null;var F=m.stateNode;F===null&&(F=m.stateNode=new si),x.forEach(function(B){var K=pv.bind(null,m,B);F.has(B)||(F.add(B),B.then(K,K))})}}function bi(m,x){var F=x.deletions;if(F!==null)for(var B=0;B<F.length;B++){var K=F[B];try{var re=m,ve=x;if(Pe){var $e=ve;e:for(;$e!==null;){switch($e.tag){case 5:Xn=$e.stateNode,Ma=!1;break e;case 3:Xn=$e.stateNode.containerInfo,Ma=!0;break e;case 4:Xn=$e.stateNode.containerInfo,Ma=!0;break e}$e=$e.return}if(Xn===null)throw Error(i(160));oh(re,ve,K),Xn=null,Ma=!1}else oh(re,ve,K);var ct=K.alternate;ct!==null&&(ct.return=null),K.return=null}catch($t){An(K,x,$t)}}if(x.subtreeFlags&12854)for(x=x.child;x!==null;)Cd(x,m),x=x.sibling}function Cd(m,x){var F=m.alternate,B=m.flags;switch(m.tag){case 0:case 11:case 14:case 15:if(bi(x,m),ii(m),B&4){try{uc(3,m,m.return),su(3,m)}catch(Zt){An(m,m.return,Zt)}try{uc(5,m,m.return)}catch(Zt){An(m,m.return,Zt)}}break;case 1:bi(x,m),ii(m),B&512&&F!==null&&un(F,F.return);break;case 5:if(bi(x,m),ii(m),B&512&&F!==null&&un(F,F.return),Pe){if(m.flags&32){var K=m.stateNode;try{hr(K)}catch(Zt){An(m,m.return,Zt)}}if(B&4&&(K=m.stateNode,K!=null)){var re=m.memoizedProps;if(F=F!==null?F.memoizedProps:re,B=m.type,x=m.updateQueue,m.updateQueue=null,x!==null)try{Ht(K,x,B,F,re,m)}catch(Zt){An(m,m.return,Zt)}}}break;case 6:if(bi(x,m),ii(m),B&4&&Pe){if(m.stateNode===null)throw Error(i(162));K=m.stateNode,re=m.memoizedProps,F=F!==null?F.memoizedProps:re;try{mt(K,F,re)}catch(Zt){An(m,m.return,Zt)}}break;case 3:if(bi(x,m),ii(m),B&4){if(Pe&&ye&&F!==null&&F.memoizedState.isDehydrated)try{ie(x.containerInfo)}catch(Zt){An(m,m.return,Zt)}if(ce){K=x.containerInfo,re=x.pendingChildren;try{Be(K,re)}catch(Zt){An(m,m.return,Zt)}}}break;case 4:if(bi(x,m),ii(m),B&4&&ce){re=m.stateNode,K=re.containerInfo,re=re.pendingChildren;try{Be(K,re)}catch(Zt){An(m,m.return,Zt)}}break;case 13:bi(x,m),ii(m),K=m.child,K.flags&8192&&(re=K.memoizedState!==null,K.stateNode.isHidden=re,!re||K.alternate!==null&&K.alternate.memoizedState!==null||(uu=js())),B&4&&fc(m);break;case 22:var ve=F!==null&&F.memoizedState!==null;if(m.mode&1?(Ps=(F=Ps)||ve,bi(x,m),Ps=F):bi(x,m),ii(m),B&8192){if(F=m.memoizedState!==null,(m.stateNode.isHidden=F)&&!ve&&(m.mode&1)!==0)for(Jt=m,B=m.child;B!==null;){for(x=Jt=B;Jt!==null;){ve=Jt;var $e=ve.child;switch(ve.tag){case 0:case 11:case 14:case 15:uc(4,ve,ve.return);break;case 1:un(ve,ve.return);var ct=ve.stateNode;if(typeof ct.componentWillUnmount=="function"){var $t=ve,ar=ve.return;try{var Dr=$t;ct.props=Dr.memoizedProps,ct.state=Dr.memoizedState,ct.componentWillUnmount()}catch(Zt){An($t,ar,Zt)}}break;case 5:un(ve,ve.return);break;case 22:if(ve.memoizedState!==null){uh(x);continue}}$e!==null?($e.return=ve,Jt=$e):uh(x)}B=B.sibling}if(Pe){e:if(B=null,Pe)for(x=m;;){if(x.tag===5){if(B===null){B=x;try{K=x.stateNode,F?sr(K):he(x.stateNode,x.memoizedProps)}catch(Zt){An(m,m.return,Zt)}}}else if(x.tag===6){if(B===null)try{re=x.stateNode,F?Er(re):le(re,x.memoizedProps)}catch(Zt){An(m,m.return,Zt)}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===m)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===m)break e;for(;x.sibling===null;){if(x.return===null||x.return===m)break e;B===x&&(B=null),x=x.return}B===x&&(B=null),x.sibling.return=x.return,x=x.sibling}}}break;case 19:bi(x,m),ii(m),B&4&&fc(m);break;case 21:break;default:bi(x,m),ii(m)}}function ii(m){var x=m.flags;if(x&2){try{if(Pe){e:{for(var F=m.return;F!==null;){if(fg(F)){var B=F;break e}F=F.return}throw Error(i(160))}switch(B.tag){case 5:var K=B.stateNode;B.flags&32&&(hr(K),B.flags&=-33);var re=dc(m);hg(m,re,K);break;case 3:case 4:var ve=B.stateNode.containerInfo,$e=dc(m);kd(m,$e,ve);break;default:throw Error(i(161))}}}catch(ct){An(m,m.return,ct)}m.flags&=-3}x&4096&&(m.flags&=-4097)}function au(m,x,F){Jt=m,lh(m)}function lh(m,x,F){for(var B=(m.mode&1)!==0;Jt!==null;){var K=Jt,re=K.child;if(K.tag===22&&B){var ve=K.memoizedState!==null||nu;if(!ve){var $e=K.alternate,ct=$e!==null&&$e.memoizedState!==null||Ps;$e=nu;var $t=Ps;if(nu=ve,(Ps=ct)&&!$t)for(Jt=K;Jt!==null;)ve=Jt,ct=ve.child,ve.tag===22&&ve.memoizedState!==null?dh(K):ct!==null?(ct.return=ve,Jt=ct):dh(K);for(;re!==null;)Jt=re,lh(re),re=re.sibling;Jt=K,nu=$e,Ps=$t}ch(m)}else(K.subtreeFlags&8772)!==0&&re!==null?(re.return=K,Jt=re):ch(m)}}function ch(m){for(;Jt!==null;){var x=Jt;if((x.flags&8772)!==0){var F=x.alternate;try{if((x.flags&8772)!==0)switch(x.tag){case 0:case 11:case 15:Ps||su(5,x);break;case 1:var B=x.stateNode;if(x.flags&4&&!Ps)if(F===null)B.componentDidMount();else{var K=x.elementType===x.type?F.memoizedProps:ri(x.type,F.memoizedProps);B.componentDidUpdate(K,F.memoizedState,B.__reactInternalSnapshotBeforeUpdate)}var re=x.updateQueue;re!==null&&px(x,re,B);break;case 3:var ve=x.updateQueue;if(ve!==null){if(F=null,x.child!==null)switch(x.child.tag){case 5:F=se(x.child.stateNode);break;case 1:F=x.child.stateNode}px(x,ve,F)}break;case 5:var $e=x.stateNode;F===null&&x.flags&4&&_t($e,x.type,x.memoizedProps,x);break;case 6:break;case 4:break;case 12:break;case 13:if(ye&&x.memoizedState===null){var ct=x.alternate;if(ct!==null){var $t=ct.memoizedState;if($t!==null){var ar=$t.dehydrated;ar!==null&&de(ar)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Ps||x.flags&512&&ih(x)}catch(Dr){An(x,x.return,Dr)}}if(x===m){Jt=null;break}if(F=x.sibling,F!==null){F.return=x.return,Jt=F;break}Jt=x.return}}function uh(m){for(;Jt!==null;){var x=Jt;if(x===m){Jt=null;break}var F=x.sibling;if(F!==null){F.return=x.return,Jt=F;break}Jt=x.return}}function dh(m){for(;Jt!==null;){var x=Jt;try{switch(x.tag){case 0:case 11:case 15:var F=x.return;try{su(4,x)}catch(ct){An(x,F,ct)}break;case 1:var B=x.stateNode;if(typeof B.componentDidMount=="function"){var K=x.return;try{B.componentDidMount()}catch(ct){An(x,K,ct)}}var re=x.return;try{ih(x)}catch(ct){An(x,re,ct)}break;case 5:var ve=x.return;try{ih(x)}catch(ct){An(x,ve,ct)}}}catch(ct){An(x,x.return,ct)}if(x===m){Jt=null;break}var $e=x.sibling;if($e!==null){$e.return=x.return,Jt=$e;break}Jt=x.return}}var Mo=0,va=1,so=2,iu=3,Td=4;if(typeof Symbol=="function"&&Symbol.for){var oi=Symbol.for;Mo=oi("selector.component"),va=oi("selector.has_pseudo_class"),so=oi("selector.role"),iu=oi("selector.test_id"),Td=oi("selector.text")}function ao(m){var x=Fe(m);if(x!=null){if(typeof x.memoizedProps["data-testname"]!="string")throw Error(i(364));return x}if(m=De(m),m===null)throw Error(i(362));return m.stateNode.current}function Nd(m,x){switch(x.$$typeof){case Mo:if(m.type===x.value)return!0;break;case va:e:{x=x.value,m=[m,0];for(var F=0;F<m.length;){var B=m[F++],K=m[F++],re=x[K];if(B.tag!==5||!ut(B)){for(;re!=null&&Nd(B,re);)K++,re=x[K];if(K===x.length){x=!0;break e}else for(B=B.child;B!==null;)m.push(B,K),B=B.sibling}}x=!1}return x;case so:if(m.tag===5&&jt(m.stateNode,x.value))return!0;break;case Td:if((m.tag===5||m.tag===6)&&(m=bt(m),m!==null&&0<=m.indexOf(x.value)))return!0;break;case iu:if(m.tag===5&&(m=m.memoizedProps["data-testname"],typeof m=="string"&&m.toLowerCase()===x.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function fh(m){switch(m.$$typeof){case Mo:return"<"+(R(m.value)||"Unknown")+">";case va:return":has("+(fh(m)||"")+")";case so:return'[role="'+m.value+'"]';case Td:return'"'+m.value+'"';case iu:return'[data-testname="'+m.value+'"]';default:throw Error(i(365))}}function io(m,x){var F=[];m=[m,0];for(var B=0;B<m.length;){var K=m[B++],re=m[B++],ve=x[re];if(K.tag!==5||!ut(K)){for(;ve!=null&&Nd(K,ve);)re++,ve=x[re];if(re===x.length)F.push(K);else for(K=K.child;K!==null;)m.push(K,re),K=K.sibling}}return F}function oo(m,x){if(!Le)throw Error(i(363));m=ao(m),m=io(m,x),x=[],m=Array.from(m);for(var F=0;F<m.length;){var B=m[F++];if(B.tag===5)ut(B)||x.push(B.stateNode);else for(B=B.child;B!==null;)m.push(B),B=B.sibling}return x}var hh=Math.ceil,Ed=l.ReactCurrentDispatcher,ou=l.ReactCurrentOwner,Hn=l.ReactCurrentBatchConfig,Or=0,xn=null,Rn=null,Yn=0,ws=0,_l=Kr(0),Dn=0,lu=null,Oo=0,Cn=0,cu=0,hc=null,Zs=null,uu=0,jd=1/0,wa=null;function gn(){jd=js()+500}var Gn=!1,ss=null,Wi=null,bl=!1,Si=null,gh=0,as=0,Ad=null,du=-1,fu=0;function jn(){return(Or&6)!==0?js():du!==-1?du:du=js()}function _s(m){return(m.mode&1)===0?1:(Or&2)!==0&&Yn!==0?Yn&-Yn:hv.transition!==null?(fu===0&&(fu=Wc()),fu):(m=qr,m!==0?m:Oe())}function ea(m,x,F,B){if(50<as)throw as=0,Ad=null,Error(i(185));yi(m,F,B),((Or&2)===0||m!==xn)&&(m===xn&&((Or&2)===0&&(Cn|=F),Dn===4&&Lo(m,Yn)),ta(m,B),F===1&&Or===0&&(x.mode&1)===0&&(gn(),Gc&&Us()))}function ta(m,x){var F=m.callbackNode;ha(m,x);var B=mn(m,m===xn?Yn:0);if(B===0)F!==null&&sx(F),m.callbackNode=null,m.callbackPriority=0;else if(x=B&-B,m.callbackPriority!==x){if(F!=null&&sx(F),x===1)m.tag===0?ix(gg.bind(null,m)):Of(gg.bind(null,m)),It?Ze(function(){(Or&6)===0&&Us()}):Zi(Rf,Us),F=null;else{switch(zc(B)){case 1:F=Rf;break;case 4:F=Df;break;case 16:F=If;break;case 536870912:F=fv;break;default:F=If}F=_g(F,mh.bind(null,m))}m.callbackPriority=x,m.callbackNode=F}}function mh(m,x){if(du=-1,fu=0,(Or&6)!==0)throw Error(i(327));var F=m.callbackNode;if(Bo()&&m.callbackNode!==F)return null;var B=mn(m,m===xn?Yn:0);if(B===0)return null;if((B&30)!==0||(B&m.expiredLanes)!==0||x)x=gc(m,B);else{x=B;var K=Or;Or|=2;var re=pg();(xn!==m||Yn!==x)&&(wa=null,gn(),Sl(m,x));do try{xg();break}catch($e){hu(m,$e)}while(!0);H0(),Ed.current=re,Or=K,Rn!==null?x=0:(xn=null,Yn=0,x=Dn)}if(x!==0){if(x===2&&(K=nl(m),K!==0&&(B=K,x=ph(m,K))),x===1)throw F=lu,Sl(m,0),Lo(m,B),ta(m,js()),F;if(x===6)Lo(m,B);else{if(K=m.current.alternate,(B&30)===0&&!Ex(K)&&(x=gc(m,B),x===2&&(re=nl(m),re!==0&&(B=re,x=ph(m,re))),x===1))throw F=lu,Sl(m,0),Lo(m,B),ta(m,js()),F;switch(m.finishedWork=K,m.finishedLanes=B,x){case 0:case 1:throw Error(i(345));case 2:kl(m,Zs,wa);break;case 3:if(Lo(m,B),(B&130023424)===B&&(x=uu+500-js(),10<x)){if(mn(m,0)!==0)break;if(K=m.suspendedLanes,(K&B)!==B){jn(),m.pingedLanes|=m.suspendedLanes&K;break}m.timeoutHandle=X(kl.bind(null,m,Zs,wa),x);break}kl(m,Zs,wa);break;case 4:if(Lo(m,B),(B&4194240)===B)break;for(x=m.eventTimes,K=-1;0<B;){var ve=31-mr(B);re=1<<ve,ve=x[ve],ve>K&&(K=ve),B&=~re}if(B=K,B=js()-B,B=(120>B?120:480>B?480:1080>B?1080:1920>B?1920:3e3>B?3e3:4320>B?4320:1960*hh(B/1960))-B,10<B){m.timeoutHandle=X(kl.bind(null,m,Zs,wa),B);break}kl(m,Zs,wa);break;case 5:kl(m,Zs,wa);break;default:throw Error(i(329))}}}return ta(m,js()),m.callbackNode===F?mh.bind(null,m):null}function ph(m,x){var F=hc;return m.current.memoizedState.isDehydrated&&(Sl(m,x).flags|=256),m=gc(m,x),m!==2&&(x=Zs,Zs=F,x!==null&&xh(x)),m}function xh(m){Zs===null?Zs=m:Zs.push.apply(Zs,m)}function Ex(m){for(var x=m;;){if(x.flags&16384){var F=x.updateQueue;if(F!==null&&(F=F.stores,F!==null))for(var B=0;B<F.length;B++){var K=F[B],re=K.getSnapshot;K=K.value;try{if(!Mi(re(),K))return!1}catch{return!1}}}if(F=x.child,x.subtreeFlags&16384&&F!==null)F.return=x,x=F;else{if(x===m)break;for(;x.sibling===null;){if(x.return===null||x.return===m)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function Lo(m,x){for(x&=~cu,x&=~Cn,m.suspendedLanes|=x,m.pingedLanes&=~x,m=m.expirationTimes;0<x;){var F=31-mr(x),B=1<<F;m[F]=-1,x&=~B}}function gg(m){if((Or&6)!==0)throw Error(i(327));Bo();var x=mn(m,0);if((x&1)===0)return ta(m,js()),null;var F=gc(m,x);if(m.tag!==0&&F===2){var B=nl(m);B!==0&&(x=B,F=ph(m,B))}if(F===1)throw F=lu,Sl(m,0),Lo(m,x),ta(m,js()),F;if(F===6)throw Error(i(345));return m.finishedWork=m.current.alternate,m.finishedLanes=x,kl(m,Zs,wa),ta(m,js()),null}function mg(m){Si!==null&&Si.tag===0&&(Or&6)===0&&Bo();var x=Or;Or|=1;var F=Hn.transition,B=qr;try{if(Hn.transition=null,qr=1,m)return m()}finally{qr=B,Hn.transition=F,Or=x,(Or&6)===0&&Us()}}function yh(){ws=_l.current,$r(_l)}function Sl(m,x){m.finishedWork=null,m.finishedLanes=0;var F=m.timeoutHandle;if(F!==ge&&(m.timeoutHandle=ge,ne(F)),Rn!==null)for(F=Rn.return;F!==null;){var B=F;switch(ud(B),B.tag){case 1:B=B.type.childContextTypes,B!=null&&Ke();break;case 3:Yl(),$r(Ee),$r(ht),Y0();break;case 5:q0(B);break;case 4:Yl();break;case 13:$r(Mn);break;case 19:$r(Mn);break;case 10:fd(B.type._context);break;case 22:case 23:yh()}F=F.return}if(xn=m,Rn=m=Cl(m.current,null),Yn=ws=x,Dn=0,lu=null,cu=Cn=Oo=0,Zs=hc=null,ll!==null){for(x=0;x<ll.length;x++)if(F=ll[x],B=F.interleaved,B!==null){F.interleaved=null;var K=B.next,re=F.pending;if(re!==null){var ve=re.next;re.next=K,B.next=ve}F.pending=B}ll=null}return m}function hu(m,x){do{var F=Rn;try{if(H0(),Ia.current=nc,Jc){for(var B=Fn.memoizedState;B!==null;){var K=B.queue;K!==null&&(K.pending=null),B=B.next}Jc=!1}if(fl=0,ys=ns=Fn=null,gd=!1,md=0,ou.current=null,F===null||F.return===null){Dn=1,lu=x,Rn=null;break}e:{var re=m,ve=F.return,$e=F,ct=x;if(x=Yn,$e.flags|=32768,ct!==null&&typeof ct=="object"&&typeof ct.then=="function"){var $t=ct,ar=$e,Dr=ar.tag;if((ar.mode&1)===0&&(Dr===0||Dr===11||Dr===15)){var Zt=ar.alternate;Zt?(ar.updateQueue=Zt.updateQueue,ar.memoizedState=Zt.memoizedState,ar.lanes=Zt.lanes):(ar.updateQueue=null,ar.memoizedState=null)}var Tn=kx(ve);if(Tn!==null){Tn.flags&=-257,ml(Tn,ve,$e,re,x),Tn.mode&1&&Sx(re,$t,x),x=Tn,ct=$t;var dn=x.updateQueue;if(dn===null){var _a=new Set;_a.add(ct),x.updateQueue=_a}else dn.add(ct);break e}else{if((x&1)===0){Sx(re,$t,x),gu();break e}ct=Error(i(426))}}else if(En&&$e.mode&1){var lo=kx(ve);if(lo!==null){(lo.flags&65536)===0&&(lo.flags|=256),ml(lo,ve,$e,re,x),W0(sc(ct,$e));break e}}re=ct=sc(ct,$e),Dn!==4&&(Dn=2),hc===null?hc=[re]:hc.push(re),re=ve;do{switch(re.tag){case 3:re.flags|=65536,x&=-x,re.lanes|=x;var st=to(re,ct,x);Xc(re,st);break e;case 1:$e=ct;var ze=re.type,xt=re.stateNode;if((re.flags&128)===0&&(typeof ze.getDerivedStateFromError=="function"||xt!==null&&typeof xt.componentDidCatch=="function"&&(Wi===null||!Wi.has(xt)))){re.flags|=65536,x&=-x,re.lanes|=x;var er=rh(re,$e,x);Xc(re,er);break e}}re=re.return}while(re!==null)}vg(F)}catch(gr){x=gr,Rn===F&&F!==null&&(Rn=F=F.return);continue}break}while(!0)}function pg(){var m=Ed.current;return Ed.current=nc,m===null?nc:m}function gu(){(Dn===0||Dn===3||Dn===2)&&(Dn=4),xn===null||(Oo&268435455)===0&&(Cn&268435455)===0||Lo(xn,Yn)}function gc(m,x){var F=Or;Or|=2;var B=pg();(xn!==m||Yn!==x)&&(wa=null,Sl(m,x));do try{jx();break}catch(K){hu(m,K)}while(!0);if(H0(),Or=F,Ed.current=B,Rn!==null)throw Error(i(261));return xn=null,Yn=0,Dn}function jx(){for(;Rn!==null;)yg(Rn)}function xg(){for(;Rn!==null&&!ax();)yg(Rn)}function yg(m){var x=Dx(m.alternate,m,ws);m.memoizedProps=m.pendingProps,x===null?vg(m):Rn=x,ou.current=null}function vg(m){var x=m;do{var F=x.alternate;if(m=x.return,(x.flags&32768)===0){if(F=cc(F,x,ws),F!==null){Rn=F;return}}else{if(F=Tx(F,x),F!==null){F.flags&=32767,Rn=F;return}if(m!==null)m.flags|=32768,m.subtreeFlags=0,m.deletions=null;else{Dn=6,Rn=null;return}}if(x=x.sibling,x!==null){Rn=x;return}Rn=x=m}while(x!==null);Dn===0&&(Dn=5)}function kl(m,x,F){var B=qr,K=Hn.transition;try{Hn.transition=null,qr=1,Ax(m,x,F,B)}finally{Hn.transition=K,qr=B}return null}function Ax(m,x,F,B){do Bo();while(Si!==null);if((Or&6)!==0)throw Error(i(327));F=m.finishedWork;var K=m.finishedLanes;if(F===null)return null;if(m.finishedWork=null,m.finishedLanes=0,F===m.current)throw Error(i(177));m.callbackNode=null,m.callbackPriority=0;var re=F.lanes|F.childLanes;if(al(m,re),m===xn&&(Rn=xn=null,Yn=0),(F.subtreeFlags&2064)===0&&(F.flags&2064)===0||bl||(bl=!0,_g(If,function(){return Bo(),null})),re=(F.flags&15990)!==0,(F.subtreeFlags&15990)!==0||re){re=Hn.transition,Hn.transition=null;var ve=qr;qr=1;var $e=Or;Or|=4,ou.current=null,Nx(m,F),Cd(F,m),z(m.containerInfo),m.current=F,au(F),od(),Or=$e,qr=ve,Hn.transition=re}else m.current=F;if(bl&&(bl=!1,Si=m,gh=K),re=m.pendingLanes,re===0&&(Wi=null),Hc(F.stateNode),ta(m,js()),x!==null)for(B=m.onRecoverableError,F=0;F<x.length;F++)K=x[F],B(K.value,{componentStack:K.stack,digest:K.digest});if(Gn)throw Gn=!1,m=ss,ss=null,m;return(gh&1)!==0&&m.tag!==0&&Bo(),re=m.pendingLanes,(re&1)!==0?m===Ad?as++:(as=0,Ad=m):as=0,Us(),null}function Bo(){if(Si!==null){var m=zc(gh),x=Hn.transition,F=qr;try{if(Hn.transition=null,qr=16>m?16:m,Si===null)var B=!1;else{if(m=Si,Si=null,gh=0,(Or&6)!==0)throw Error(i(331));var K=Or;for(Or|=4,Jt=m.current;Jt!==null;){var re=Jt,ve=re.child;if((Jt.flags&16)!==0){var $e=re.deletions;if($e!==null){for(var ct=0;ct<$e.length;ct++){var $t=$e[ct];for(Jt=$t;Jt!==null;){var ar=Jt;switch(ar.tag){case 0:case 11:case 15:uc(8,ar,re)}var Dr=ar.child;if(Dr!==null)Dr.return=ar,Jt=Dr;else for(;Jt!==null;){ar=Jt;var Zt=ar.sibling,Tn=ar.return;if(Sd(ar),ar===$t){Jt=null;break}if(Zt!==null){Zt.return=Tn,Jt=Zt;break}Jt=Tn}}}var dn=re.alternate;if(dn!==null){var _a=dn.child;if(_a!==null){dn.child=null;do{var lo=_a.sibling;_a.sibling=null,_a=lo}while(_a!==null)}}Jt=re}}if((re.subtreeFlags&2064)!==0&&ve!==null)ve.return=re,Jt=ve;else e:for(;Jt!==null;){if(re=Jt,(re.flags&2048)!==0)switch(re.tag){case 0:case 11:case 15:uc(9,re,re.return)}var st=re.sibling;if(st!==null){st.return=re.return,Jt=st;break e}Jt=re.return}}var ze=m.current;for(Jt=ze;Jt!==null;){ve=Jt;var xt=ve.child;if((ve.subtreeFlags&2064)!==0&&xt!==null)xt.return=ve,Jt=xt;else e:for(ve=ze;Jt!==null;){if($e=Jt,($e.flags&2048)!==0)try{switch($e.tag){case 0:case 11:case 15:su(9,$e)}}catch(gr){An($e,$e.return,gr)}if($e===ve){Jt=null;break e}var er=$e.sibling;if(er!==null){er.return=$e.return,Jt=er;break e}Jt=$e.return}}if(Or=K,Us(),Ra&&typeof Ra.onPostCommitFiberRoot=="function")try{Ra.onPostCommitFiberRoot(il,m)}catch{}B=!0}return B}finally{qr=F,Hn.transition=x}}return!1}function wg(m,x,F){x=sc(F,x),x=to(m,x,1),m=Po(m,x,1),x=jn(),m!==null&&(yi(m,1,x),ta(m,x))}function An(m,x,F){if(m.tag===3)wg(m,m,F);else for(;x!==null;){if(x.tag===3){wg(x,m,F);break}else if(x.tag===1){var B=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof B.componentDidCatch=="function"&&(Wi===null||!Wi.has(B))){m=sc(F,m),m=rh(x,m,1),x=Po(x,m,1),m=jn(),x!==null&&(yi(x,1,m),ta(x,m));break}}x=x.return}}function Fx(m,x,F){var B=m.pingCache;B!==null&&B.delete(x),x=jn(),m.pingedLanes|=m.suspendedLanes&F,xn===m&&(Yn&F)===F&&(Dn===4||Dn===3&&(Yn&130023424)===Yn&&500>js()-uu?Sl(m,0):cu|=F),ta(m,x)}function Px(m,x){x===0&&((m.mode&1)===0?x=1:(x=zn,zn<<=1,(zn&130023424)===0&&(zn=4194304)));var F=jn();m=Ui(m,x),m!==null&&(yi(m,x,F),ta(m,F))}function Rx(m){var x=m.memoizedState,F=0;x!==null&&(F=x.retryLane),Px(m,F)}function pv(m,x){var F=0;switch(m.tag){case 13:var B=m.stateNode,K=m.memoizedState;K!==null&&(F=K.retryLane);break;case 19:B=m.stateNode;break;default:throw Error(i(314))}B!==null&&B.delete(x),Px(m,F)}var Dx;Dx=function(m,x,F){if(m!==null)if(m.memoizedProps!==x.pendingProps||Ee.current)vs=!0;else{if((m.lanes&F)===0&&(x.flags&128)===0)return vs=!1,xl(m,x,F);vs=(m.flags&131072)!==0}else vs=!1,En&&(x.flags&1048576)!==0&&ox(x,Gl,x.index);switch(x.lanes=0,x.tag){case 2:var B=x.type;bd(m,x),m=x.pendingProps;var K=St(x,ht.current);qc(x,F),K=pd(null,x,B,m,K,F);var re=Kf();return x.flags|=1,typeof K=="object"&&K!==null&&typeof K.render=="function"&&K.$$typeof===void 0?(x.tag=1,x.memoizedState=null,x.updateQueue=null,je(B)?(re=!0,_r(x)):re=!1,x.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,V0(x),K.updater=vd,x.stateNode=K,K._reactInternals=x,eo(x,B,m,F),x=Js(null,x,B,!0,re,F)):(x.tag=0,En&&re&&cd(x),Fs(null,x,K,F),x=x.child),x;case 16:B=x.elementType;e:{switch(bd(m,x),m=x.pendingProps,K=B._init,B=K(B._payload),x.type=B,K=x.tag=xv(B),m=ri(B,m),K){case 0:x=ro(null,x,B,m,F);break e;case 1:x=zs(null,x,B,m,F);break e;case 11:x=nh(null,x,B,m,F);break e;case 14:x=ac(null,x,B,ri(B.type,m),F);break e}throw Error(i(306,B,""))}return x;case 0:return B=x.type,K=x.pendingProps,K=x.elementType===B?K:ri(B,K),ro(m,x,B,K,F);case 1:return B=x.type,K=x.pendingProps,K=x.elementType===B?K:ri(B,K),zs(m,x,B,K,F);case 3:e:{if(pl(x),m===null)throw Error(i(387));B=x.pendingProps,re=x.memoizedState,K=re.element,mx(m,x),cl(x,B,null,F);var ve=x.memoizedState;if(B=ve.element,ye&&re.isDehydrated)if(re={element:B,isDehydrated:!1,cache:ve.cache,pendingSuspenseBoundaries:ve.pendingSuspenseBoundaries,transitions:ve.transitions},x.updateQueue.baseState=re,x.memoizedState=re,x.flags&256){K=sc(Error(i(423)),x),x=ic(m,x,B,F,K);break e}else if(B!==K){K=sc(Error(i(424)),x),x=ic(m,x,B,F,K);break e}else for(ye&&(ma=me(x.stateNode.containerInfo),$s=x,En=!0,Bi=null,dd=!1),F=hx(x,null,B,F),x.child=F;F;)F.flags=F.flags&-3|4096,F=F.sibling;else{if(Vl(),B===K){x=Io(m,x,F);break e}Fs(m,x,B,F)}x=x.child}return x;case 5:return K0(x),m===null&&$0(x),B=x.type,K=x.pendingProps,re=m!==null?m.memoizedProps:null,ve=K.children,Y(B,K)?ve=null:re!==null&&Y(B,re)&&(x.flags|=32),pn(m,x),Fs(m,x,ve,F),x.child;case 6:return m===null&&$0(x),null;case 13:return ug(m,x,F);case 4:return Gf(x,x.stateNode.containerInfo),B=x.pendingProps,m===null?x.child=ql(x,null,B,F):Fs(m,x,B,F),x.child;case 11:return B=x.type,K=x.pendingProps,K=x.elementType===B?K:ri(B,K),nh(m,x,B,K,F);case 7:return Fs(m,x,x.pendingProps,F),x.child;case 8:return Fs(m,x,x.pendingProps.children,F),x.child;case 12:return Fs(m,x,x.pendingProps.children,F),x.child;case 10:e:{if(B=x.type._context,K=x.pendingProps,re=x.memoizedProps,ve=K.value,gx(x,B,ve),re!==null)if(Mi(re.value,ve)){if(re.children===K.children&&!Ee.current){x=Io(m,x,F);break e}}else for(re=x.child,re!==null&&(re.return=x);re!==null;){var $e=re.dependencies;if($e!==null){ve=re.child;for(var ct=$e.firstContext;ct!==null;){if(ct.context===B){if(re.tag===1){ct=Fo(-1,F&-F),ct.tag=2;var $t=re.updateQueue;if($t!==null){$t=$t.shared;var ar=$t.pending;ar===null?ct.next=ct:(ct.next=ar.next,ar.next=ct),$t.pending=ct}}re.lanes|=F,ct=re.alternate,ct!==null&&(ct.lanes|=F),Xl(re.return,F,x),$e.lanes|=F;break}ct=ct.next}}else if(re.tag===10)ve=re.type===x.type?null:re.child;else if(re.tag===18){if(ve=re.return,ve===null)throw Error(i(341));ve.lanes|=F,$e=ve.alternate,$e!==null&&($e.lanes|=F),Xl(ve,F,x),ve=re.sibling}else ve=re.child;if(ve!==null)ve.return=re;else for(ve=re;ve!==null;){if(ve===x){ve=null;break}if(re=ve.sibling,re!==null){re.return=ve.return,ve=re;break}ve=ve.return}re=ve}Fs(m,x,K.children,F),x=x.child}return x;case 9:return K=x.type,B=x.pendingProps.children,qc(x,F),K=Za(K),B=B(K),x.flags|=1,Fs(m,x,B,F),x.child;case 14:return B=x.type,K=ri(B,x.pendingProps),K=ri(B.type,K),ac(m,x,B,K,F);case 15:return Do(m,x,x.type,x.pendingProps,F);case 17:return B=x.type,K=x.pendingProps,K=x.elementType===B?K:ri(B,K),bd(m,x),x.tag=1,je(B)?(m=!0,_r(x)):m=!1,qc(x,F),bx(x,B,K),eo(x,B,K,F),Js(null,x,B,!0,m,F);case 19:return ah(m,x,F);case 22:return kn(m,x,F)}throw Error(i(156,x.tag))};function _g(m,x){return Zi(m,x)}function Ix(m,x,F,B){this.tag=m,this.key=F,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=B,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function li(m,x,F,B){return new Ix(m,x,F,B)}function mu(m){return m=m.prototype,!(!m||!m.isReactComponent)}function xv(m){if(typeof m=="function")return mu(m)?1:0;if(m!=null){if(m=m.$$typeof,m===w)return 11;if(m===k)return 14}return 2}function Cl(m,x){var F=m.alternate;return F===null?(F=li(m.tag,x,m.key,m.mode),F.elementType=m.elementType,F.type=m.type,F.stateNode=m.stateNode,F.alternate=m,m.alternate=F):(F.pendingProps=x,F.type=m.type,F.flags=0,F.subtreeFlags=0,F.deletions=null),F.flags=m.flags&14680064,F.childLanes=m.childLanes,F.lanes=m.lanes,F.child=m.child,F.memoizedProps=m.memoizedProps,F.memoizedState=m.memoizedState,F.updateQueue=m.updateQueue,x=m.dependencies,F.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},F.sibling=m.sibling,F.index=m.index,F.ref=m.ref,F}function vh(m,x,F,B,K,re){var ve=2;if(B=m,typeof m=="function")mu(m)&&(ve=1);else if(typeof m=="string")ve=5;else e:switch(m){case f:return Hs(F.children,K,re,x);case p:ve=8,K|=8;break;case g:return m=li(12,F,x,K|2),m.elementType=g,m.lanes=re,m;case b:return m=li(13,F,x,K),m.elementType=b,m.lanes=re,m;case E:return m=li(19,F,x,K),m.elementType=E,m.lanes=re,m;case T:return pu(F,K,re,x);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case y:ve=10;break e;case v:ve=9;break e;case w:ve=11;break e;case k:ve=14;break e;case _:ve=16,B=null;break e}throw Error(i(130,m==null?m:typeof m,""))}return x=li(ve,F,x,K),x.elementType=m,x.type=B,x.lanes=re,x}function Hs(m,x,F,B){return m=li(7,m,B,x),m.lanes=F,m}function pu(m,x,F,B){return m=li(22,m,B,x),m.elementType=T,m.lanes=F,m.stateNode={isHidden:!1},m}function xu(m,x,F){return m=li(6,m,null,x),m.lanes=F,m}function wh(m,x,F){return x=li(4,m.children!==null?m.children:[],m.key,x),x.lanes=F,x.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},x}function Mx(m,x,F,B,K){this.tag=x,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ge,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sl(0),this.expirationTimes=sl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sl(0),this.identifierPrefix=B,this.onRecoverableError=K,ye&&(this.mutableSourceEagerHydrationData=null)}function bg(m,x,F,B,K,re,ve,$e,ct){return m=new Mx(m,x,F,$e,ct),x===1?(x=1,re===!0&&(x|=8)):x=0,re=li(3,null,null,x),m.current=re,re.stateNode=m,re.memoizedState={element:B,isDehydrated:F,cache:null,transitions:null,pendingSuspenseBoundaries:null},V0(re),m}function _h(m){if(!m)return xe;m=m._reactInternals;e:{if(A(m)!==m||m.tag!==1)throw Error(i(170));var x=m;do{switch(x.tag){case 3:x=x.stateNode.context;break e;case 1:if(je(x.type)){x=x.stateNode.__reactInternalMemoizedMergedChildContext;break e}}x=x.return}while(x!==null);throw Error(i(171))}if(m.tag===1){var F=m.type;if(je(F))return it(m,F,x)}return x}function mc(m){var x=m._reactInternals;if(x===void 0)throw typeof m.render=="function"?Error(i(188)):(m=Object.keys(m).join(","),Error(i(268,m)));return m=Q(x),m===null?null:m.stateNode}function bh(m,x){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var F=m.retryLane;m.retryLane=F!==0&&F<x?F:x}}function yu(m,x){bh(m,x),(m=m.alternate)&&bh(m,x)}function yv(m){return m=Q(m),m===null?null:m.stateNode}function Ox(){return null}return r.attemptContinuousHydration=function(m){if(m.tag===13){var x=Ui(m,134217728);if(x!==null){var F=jn();ea(x,m,134217728,F)}yu(m,134217728)}},r.attemptDiscreteHydration=function(m){if(m.tag===13){var x=Ui(m,1);if(x!==null){var F=jn();ea(x,m,1,F)}yu(m,1)}},r.attemptHydrationAtCurrentPriority=function(m){if(m.tag===13){var x=_s(m),F=Ui(m,x);if(F!==null){var B=jn();ea(F,m,x,B)}yu(m,x)}},r.attemptSynchronousHydration=function(m){switch(m.tag){case 3:var x=m.stateNode;if(x.current.memoizedState.isDehydrated){var F=pr(x.pendingLanes);F!==0&&(Qi(x,F|1),ta(x,js()),(Or&6)===0&&(gn(),Us()))}break;case 13:mg(function(){var B=Ui(m,1);if(B!==null){var K=jn();ea(B,m,1,K)}}),yu(m,1)}},r.batchedUpdates=function(m,x){var F=Or;Or|=1;try{return m(x)}finally{Or=F,Or===0&&(gn(),Gc&&Us())}},r.createComponentSelector=function(m){return{$$typeof:Mo,value:m}},r.createContainer=function(m,x,F,B,K,re,ve){return bg(m,x,!1,null,F,B,K,re,ve)},r.createHasPseudoClassSelector=function(m){return{$$typeof:va,value:m}},r.createHydrationContainer=function(m,x,F,B,K,re,ve,$e,ct){return m=bg(F,B,!0,m,K,re,ve,$e,ct),m.context=_h(null),F=m.current,B=jn(),K=_s(F),re=Fo(B,K),re.callback=x??null,Po(F,re,K),m.current.lanes=K,yi(m,K,B),ta(m,B),m},r.createPortal=function(m,x,F){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:B==null?null:""+B,children:m,containerInfo:x,implementation:F}},r.createRoleSelector=function(m){return{$$typeof:so,value:m}},r.createTestNameSelector=function(m){return{$$typeof:iu,value:m}},r.createTextSelector=function(m){return{$$typeof:Td,value:m}},r.deferredUpdates=function(m){var x=qr,F=Hn.transition;try{return Hn.transition=null,qr=16,m()}finally{qr=x,Hn.transition=F}},r.discreteUpdates=function(m,x,F,B,K){var re=qr,ve=Hn.transition;try{return Hn.transition=null,qr=1,m(x,F,B,K)}finally{qr=re,Hn.transition=ve,Or===0&&gn()}},r.findAllNodes=oo,r.findBoundingRects=function(m,x){if(!Le)throw Error(i(363));x=oo(m,x),m=[];for(var F=0;F<x.length;F++)m.push(et(x[F]));for(x=m.length-1;0<x;x--){F=m[x];for(var B=F.x,K=B+F.width,re=F.y,ve=re+F.height,$e=x-1;0<=$e;$e--)if(x!==$e){var ct=m[$e],$t=ct.x,ar=$t+ct.width,Dr=ct.y,Zt=Dr+ct.height;if(B>=$t&&re>=Dr&&K<=ar&&ve<=Zt){m.splice(x,1);break}else if(B!==$t||F.width!==ct.width||Zt<re||Dr>ve){if(!(re!==Dr||F.height!==ct.height||ar<B||$t>K)){$t>B&&(ct.width+=$t-B,ct.x=B),ar<K&&(ct.width=K-$t),m.splice(x,1);break}}else{Dr>re&&(ct.height+=Dr-re,ct.y=re),Zt<ve&&(ct.height=ve-Dr),m.splice(x,1);break}}}return m},r.findHostInstance=mc,r.findHostInstanceWithNoPortals=function(m){return m=H(m),m=m!==null?ae(m):null,m===null?null:m.stateNode},r.findHostInstanceWithWarning=function(m){return mc(m)},r.flushControlled=function(m){var x=Or;Or|=1;var F=Hn.transition,B=qr;try{Hn.transition=null,qr=1,m()}finally{qr=B,Hn.transition=F,Or=x,Or===0&&(gn(),Us())}},r.flushPassiveEffects=Bo,r.flushSync=mg,r.focusWithin=function(m,x){if(!Le)throw Error(i(363));for(m=ao(m),x=io(m,x),x=Array.from(x),m=0;m<x.length;){var F=x[m++];if(!ut(F)){if(F.tag===5&&Rt(F.stateNode))return!0;for(F=F.child;F!==null;)x.push(F),F=F.sibling}}return!1},r.getCurrentUpdatePriority=function(){return qr},r.getFindAllNodesFailureDescription=function(m,x){if(!Le)throw Error(i(363));var F=0,B=[];m=[ao(m),0];for(var K=0;K<m.length;){var re=m[K++],ve=m[K++],$e=x[ve];if((re.tag!==5||!ut(re))&&(Nd(re,$e)&&(B.push(fh($e)),ve++,ve>F&&(F=ve)),ve<x.length))for(re=re.child;re!==null;)m.push(re,ve),re=re.sibling}if(F<x.length){for(m=[];F<x.length;F++)m.push(fh(x[F]));return`findAllNodes was able to match part of the selector:
  `+(B.join(" > ")+`

No matching component was found for:
  `)+m.join(" > ")}return null},r.getPublicRootInstance=function(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 5:return se(m.child.stateNode);default:return m.child.stateNode}},r.injectIntoDevTools=function(m){if(m={bundleType:m.bundleType,version:m.version,rendererPackageName:m.rendererPackageName,rendererConfig:m.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:l.ReactCurrentDispatcher,findHostInstanceByFiber:yv,findFiberByHostInstance:m.findFiberByHostInstance||Ox,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")m=!1;else{var x=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(x.isDisabled||!x.supportsFiber)m=!0;else{try{il=x.inject(m),Ra=x}catch{}m=!!x.checkDCE}}return m},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(m,x,F,B){if(!Le)throw Error(i(363));m=oo(m,x);var K=Xe(m,F,B).disconnect;return{disconnect:function(){K()}}},r.registerMutableSourceForHydration=function(m,x){var F=x._getVersion;F=F(x._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[x,F]:m.mutableSourceEagerHydrationData.push(x,F)},r.runWithPriority=function(m,x){var F=qr;try{return qr=m,x()}finally{qr=F}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(m,x,F,B){var K=x.current,re=jn(),ve=_s(K);return F=_h(F),x.context===null?x.context=F:x.pendingContext=F,x=Fo(re,ve),x.payload={element:m},B=B===void 0?null:B,B!==null&&(x.callback=B),m=Po(K,x,ve),m!==null&&(ea(m,K,ve,re),hd(m,K,ve)),ve},r}),vw}var s4;function cO(){return s4||(s4=1,yw.exports=lO()),yw.exports}var uO=cO();const dO=Ep(uO);var ww={exports:{}},Nu={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a4;function fO(){return a4||(a4=1,Nu.ConcurrentRoot=1,Nu.ContinuousEventPriority=4,Nu.DefaultEventPriority=16,Nu.DiscreteEventPriority=1,Nu.IdleEventPriority=536870912,Nu.LegacyRoot=0),Nu}var i4;function hO(){return i4||(i4=1,ww.exports=fO()),ww.exports}var F6=hO(),gO=Vr();const o4={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let l4=!1,c4=!1;const ub=".react-konva-event";let P6=!1;function mO(e){P6=e}const pO=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,xO=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,yO={};function L1(e,t,r=yO){if(!l4&&"zIndex"in t&&(console.warn(xO),l4=!0),!c4&&t.draggable){var n=t.x!==void 0||t.y!==void 0,s=t.onDragEnd||t.onDragMove;n&&!s&&(console.warn(pO),c4=!0)}for(var a in r)if(!o4[a]){var i=a.slice(0,2)==="on",l=r[a]!==t[a];if(i&&l){var c=a.substr(2).toLowerCase();c.substr(0,7)==="content"&&(c="content"+c.substr(7,1).toUpperCase()+c.substr(8)),e.off(c,r[a])}var d=!t.hasOwnProperty(a);d&&e.setAttr(a,void 0)}var f=P6||t._useStrictMode,p={},g=!1;const y={};for(var a in t)if(!o4[a]){var i=a.slice(0,2)==="on",v=r[a]!==t[a];if(i&&v){var c=a.substr(2).toLowerCase();c.substr(0,7)==="content"&&(c="content"+c.substr(7,1).toUpperCase()+c.substr(8)),t[a]&&(y[c]=t[a])}!i&&(t[a]!==r[a]||f&&t[a]!==e.getAttr(a))&&(g=!0,p[a]=t[a])}g&&(e.setAttrs(p),Zu(e));for(var c in y)e.on(c+ub,y[c])}function Zu(e){if(!gO.Konva.autoDrawEnabled){var t=e.getLayer()||e.getStage();t&&t.batchDraw()}}var _w=b2();const R6={},vO={};sp.Node.prototype._applyProps=L1;function wO(e,t){if(typeof t=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${t}`);return}e.add(t),Zu(e)}function _O(e,t,r){let n=sp[e];n||(console.error(`Konva has no node with the type ${e}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${e}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),n=sp.Group);const s={},a={};for(var i in t){var l=i.slice(0,2)==="on";l?a[i]=t[i]:s[i]=t[i]}const c=new n(s);return L1(c,a),c}function bO(e,t,r){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${e}"`)}function SO(e,t,r){return!1}function kO(e){return e}function CO(){return null}function TO(){return null}function NO(e,t,r,n){return vO}function EO(){}function jO(e){}function AO(e,t){return!1}function FO(){return R6}function PO(){return R6}const RO=setTimeout,DO=clearTimeout,IO=-1;function MO(e,t){return!1}const OO=!1,LO=!0,BO=!0;function UO(e,t){t.parent===e?t.moveToTop():e.add(t),Zu(e)}function $O(e,t){t.parent===e?t.moveToTop():e.add(t),Zu(e)}function D6(e,t,r){t._remove(),e.add(t),t.setZIndex(r.getZIndex()),Zu(e)}function WO(e,t,r){D6(e,t,r)}function zO(e,t){t.destroy(),t.off(ub),Zu(e)}function HO(e,t){t.destroy(),t.off(ub),Zu(e)}function GO(e,t,r){console.error(`Text components are not yet supported in ReactKonva. You text is: "${r}"`)}function VO(e,t,r){}function KO(e,t,r,n,s){L1(e,s,n)}function qO(e){e.hide(),Zu(e)}function XO(e){}function YO(e,t){(t.visible==null||t.visible)&&e.show()}function JO(e,t){}function QO(e){}function ZO(){}const eL=()=>F6.DefaultEventPriority,tL=Object.freeze(Object.defineProperty({__proto__:null,appendChild:UO,appendChildToContainer:$O,appendInitialChild:wO,cancelTimeout:DO,clearContainer:QO,commitMount:VO,commitTextUpdate:GO,commitUpdate:KO,createInstance:_O,createTextInstance:bO,detachDeletedInstance:ZO,finalizeInitialChildren:SO,getChildHostContext:PO,getCurrentEventPriority:eL,getPublicInstance:kO,getRootHostContext:FO,hideInstance:qO,hideTextInstance:XO,idlePriority:_w.unstable_IdlePriority,insertBefore:D6,insertInContainerBefore:WO,isPrimaryRenderer:OO,noTimeout:IO,now:_w.unstable_now,prepareForCommit:CO,preparePortalMount:TO,prepareUpdate:NO,removeChild:zO,removeChildFromContainer:HO,resetAfterCommit:EO,resetTextContent:jO,run:_w.unstable_runWithPriority,scheduleTimeout:RO,shouldDeprioritizeSubtree:AO,shouldSetTextContent:MO,supportsMutation:BO,unhideInstance:YO,unhideTextInstance:JO,warnsIfNotActing:LO},Symbol.toStringTag,{value:"Module"}));var rL=Object.defineProperty,nL=Object.defineProperties,sL=Object.getOwnPropertyDescriptors,u4=Object.getOwnPropertySymbols,aL=Object.prototype.hasOwnProperty,iL=Object.prototype.propertyIsEnumerable,d4=(e,t,r)=>t in e?rL(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f4=(e,t)=>{for(var r in t||(t={}))aL.call(t,r)&&d4(e,r,t[r]);if(u4)for(var r of u4(t))iL.call(t,r)&&d4(e,r,t[r]);return e},oL=(e,t)=>nL(e,sL(t)),h4,g4;typeof window<"u"&&((h4=window.document)!=null&&h4.createElement||((g4=window.navigator)==null?void 0:g4.product)==="ReactNative")?C.useLayoutEffect:C.useEffect;function I6(e,t,r){if(!e)return;if(r(e)===!0)return e;let n=e.child;for(;n;){const s=I6(n,t,r);if(s)return s;n=n.sibling}}function M6(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const m4=console.error;console.error=function(){const e=[...arguments].join("");if(e?.startsWith("Warning:")&&e.includes("useContext")){console.error=m4;return}return m4.apply(this,arguments)};const db=M6(C.createContext(null));class O6 extends C.Component{render(){return C.createElement(db.Provider,{value:this._reactInternals},this.props.children)}}function lL(){const e=C.useContext(db);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=C.useId();return C.useMemo(()=>{for(const n of[e,e?.alternate]){if(!n)continue;const s=I6(n,!1,a=>{let i=a.memoizedState;for(;i;){if(i.memoizedState===t)return!0;i=i.next}});if(s)return s}},[e,t])}function cL(){const e=lL(),[t]=C.useState(()=>new Map);t.clear();let r=e;for(;r;){if(r.type&&typeof r.type=="object"){const s=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;s&&s!==db&&!t.has(s)&&t.set(s,C.useContext(M6(s)))}r=r.return}return t}function L6(){const e=cL();return C.useMemo(()=>Array.from(e.keys()).reduce((t,r)=>n=>C.createElement(t,null,C.createElement(r.Provider,oL(f4({},n),{value:e.get(r)}))),t=>C.createElement(O6,f4({},t))),[e])}function uL(e){const t=us.useRef({});return us.useLayoutEffect(()=>{t.current=e}),us.useLayoutEffect(()=>()=>{t.current={}},[]),t.current}const dL=e=>{const t=us.useRef(null),r=us.useRef(null),n=us.useRef(null),s=uL(e),a=L6(),i=l=>{const{forwardedRef:c}=e;c&&(typeof c=="function"?c(l):c.current=l)};return us.useLayoutEffect(()=>(r.current=new sp.Stage({width:e.width,height:e.height,container:t.current}),i(r.current),n.current=Vh.createContainer(r.current,F6.LegacyRoot,!1,null),Vh.updateContainer(us.createElement(a,{},e.children),n.current),()=>{sp.isBrowser&&(i(null),Vh.updateContainer(null,n.current,null),r.current.destroy())}),[]),us.useLayoutEffect(()=>{i(r.current),L1(r.current,e,s),Vh.updateContainer(us.createElement(a,{},e.children),n.current,null)}),us.createElement("div",{ref:t,id:e.id,accessKey:e.accessKey,className:e.className,role:e.role,style:e.style,tabIndex:e.tabIndex,title:e.title})},nf="Layer",fL="FastLayer",qo="Group",hL="Label",ca="Rect",Ou="Circle",gL="Ellipse",mL="Wedge",Ta="Line",pL="Sprite",B6="Image",Rl="Text",xL="TextPath",yL="Star",vL="Ring",wL="Arc",_L="Tag",bL="Path",SL="RegularPolygon",E_="Arrow",kL="Shape",U6="Transformer",CL="18.2.13",Vh=dO(tL);Vh.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:us.version,rendererPackageName:"react-konva"});const sf=us.forwardRef((e,t)=>us.createElement(O6,{},us.createElement(dL,{...e,forwardedRef:t}))),TL=mO,NL=Object.freeze(Object.defineProperty({__proto__:null,Arc:wL,Arrow:E_,Circle:Ou,Ellipse:gL,FastLayer:fL,Group:qo,Image:B6,KonvaRenderer:Vh,Label:hL,Layer:nf,Line:Ta,Path:bL,Rect:ca,RegularPolygon:SL,Ring:vL,Shape:kL,Sprite:pL,Stage:sf,Star:yL,Tag:_L,Text:Rl,TextPath:xL,Transformer:U6,Wedge:mL,useContextBridge:L6,useStrictMode:TL,version:CL},Symbol.toStringTag,{value:"Module"})),kt=({children:e,hover:t=!0,className:r="",paddingClass:n="p-6",...s})=>{const a=`
    bg-white rounded-xl shadow-md border border-gray-200 ${n}
    ${t?"hover:shadow-lg hover:-translate-y-1 transition-all duration-200":""}
    ${r}
  `;return o.jsx(Qe.div,{className:a,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},...s,children:e})},EL=({children:e,className:t=""})=>o.jsx("div",{className:`border-b border-gray-200 pb-4 mb-4 ${t}`,children:e}),jL=({children:e,className:t=""})=>o.jsx("h3",{className:`text-xl font-semibold text-gray-800 ${t}`,children:e}),AL=({children:e,className:t=""})=>o.jsx("div",{className:`py-4 ${t}`,children:e}),FL=({children:e,className:t=""})=>o.jsx("div",{className:`border-t border-gray-200 pt-4 mt-4 ${t}`,children:e});kt.Header=EL;kt.Title=jL;kt.Body=AL;kt.Footer=FL;const PL=e=>{const[t,r]=C.useState({width:800,height:600}),n=C.useRef(null),s=C.useCallback(()=>{if(e.current){e.current.getBoundingClientRect();const a=Math.min(1200,window.innerWidth*.8),i=Math.min(800,window.innerHeight*.6),l=4/3;let c=a,d=c/l;d>i&&(d=i,c=d*l),r({width:c,height:d})}},[e]);return C.useEffect(()=>(s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)),[s]),{canvasSize:t,stageRef:n,updateCanvasSize:s}},j_={convertToOriginal:(e,t,r)=>r?{x:Number(((e-r.x)/r.scale).toFixed(4)),y:Number(((t-r.y)/r.scale).toFixed(4))}:{x:e,y:t},convertToCanvas:(e,t,r)=>r?{x:Number((r.x+e*r.scale).toFixed(4)),y:Number((r.y+t*r.scale).toFixed(4))}:{x:e,y:t},isPointInImage:(e,t)=>t?e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height:!1,calculateImageScale:(e,t)=>{if(!e||!t)return 1;const r=40,n=t.width-r,s=t.height-r;return Math.min(n/e.width,s/e.height)},calculateImageInfo:(e,t)=>{if(!e||!t)return null;const r=40,n=t.width-r,s=t.height-r,a=Math.min(n/e.width,s/e.height),i=e.width*a,l=e.height*a,c=(t.width-i)/2,d=(t.height-l)/2;return{x:c,y:d,width:i,height:l,scale:a,originalWidth:e.width,originalHeight:e.height}}},RL=(e,t)=>{const[r,n]=C.useState(null),s=C.useCallback((a,i)=>j_.calculateImageInfo(a,i),[]);return C.useEffect(()=>{if(e&&t){const a=s(e,t);n(a)}},[e,t,s]),r},DL=e=>{const t=C.useCallback((n,s)=>j_.convertToOriginal(n,s,e),[e]),r=C.useCallback((n,s)=>j_.convertToCanvas(n,s,e),[e]);return{convertToOriginal:t,convertToCanvas:r}},ym={create:(e,t,r,n,s)=>({id:s,x:e-r/2,y:t-n/2,width:Math.max(r,30),height:Math.max(n,10),fill:"rgba(0, 123, 255, 0.15)",stroke:"#007bff",strokeWidth:2,cornerRadius:6,shadowColor:"rgba(0, 123, 255, 0.3)",shadowBlur:10,shadowOffset:{x:0,y:2},shadowOpacity:.5}),validate:e=>e.width>0&&e.height>0,findAtPosition:(e,t,r)=>e.find(n=>t>=n.x&&t<=n.x+n.width&&r>=n.y&&r<=n.y+n.height),generateId:()=>`block_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},Dh={create:(e,t,r,n,s,a,i)=>({id:i,startX:e,startY:t,endX:r,endY:n,startBlock:s,endBlock:a,stroke:"#dc3545",fill:"#dc3545",strokeWidth:3,pointerLength:10,pointerWidth:10}),snapToNearestBlock:(e,t,r,n=60)=>{let s=null,a=1/0;for(const i of r){const l=i.x+i.width/2,c=i.y+i.height/2,d=Math.sqrt(Math.pow(e-l,2)+Math.pow(t-c,2));d<=n&&d<a&&(a=d,s=i)}return s?{x:s.x+s.width/2,y:s.y+s.height/2,blockId:s.id,block:s,distance:a}:null},validate:(e,t,r,n,s)=>Dh.snapToNearestBlock(e,t,s)!==null,generateId:()=>`arrow_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},bw={create:(e,t,r)=>({id:r,blockId:e,word:t}),update:(e,t,r)=>e.map(n=>n.blockId===t?{...n,word:r}:n),delete:(e,t)=>e.filter(r=>r.blockId!==t),generateId:e=>`word_${e}`,validate:e=>e&&e.trim().length>0},IL={testData:{blocks:[],words:[],arrows:[],imageUrl:null},canvas:{size:{width:800,height:600},image:null,imageInfo:null,selectedTool:"edit"},creation:{isCreatingBlock:!1,isDrawingArrow:!1,blockCreationStart:null,arrowStart:null,previewBlock:null,previewArrow:null},ui:{selectedBlock:null,showWordPanel:!1,isLoading:!1,error:null}},ML=(e,t)=>{switch(t.type){case"SET_CANVAS_SIZE":return{...e,canvas:{...e.canvas,size:t.payload}};case"SET_IMAGE":return{...e,canvas:{...e.canvas,image:t.payload}};case"SET_IMAGE_INFO":return{...e,canvas:{...e.canvas,imageInfo:t.payload}};case"SET_SELECTED_TOOL":return{...e,canvas:{...e.canvas,selectedTool:t.payload}};case"ADD_BLOCK":return{...e,testData:{...e.testData,blocks:[...e.testData.blocks,t.payload]}};case"ADD_WORD":return{...e,testData:{...e.testData,words:[...e.testData.words,t.payload]}};case"ADD_ARROW":return{...e,testData:{...e.testData,arrows:[...e.testData.arrows,t.payload]}};case"UPDATE_BLOCK":return{...e,testData:{...e.testData,blocks:e.testData.blocks.map(r=>r.id===t.payload.id?{...r,...t.payload.updates}:r)}};case"DELETE_BLOCK":return{...e,testData:{...e.testData,blocks:e.testData.blocks.filter(r=>r.id!==t.payload),words:e.testData.words.filter(r=>r.blockId!==t.payload),arrows:e.testData.arrows.filter(r=>r.startBlock!==t.payload&&r.endBlock!==t.payload)}};case"UPDATE_WORDS":return{...e,testData:{...e.testData,words:t.payload}};case"SET_CREATION_STATE":return{...e,creation:{...e.creation,...t.payload}};case"SET_UI_STATE":return{...e,ui:{...e.ui,...t.payload}};case"SET_LOADING":return{...e,ui:{...e.ui,isLoading:t.payload}};case"SET_ERROR":return{...e,ui:{...e.ui,error:t.payload}};case"RESET_TESTDATA":return{...e,testData:{blocks:[],words:[],arrows:[],imageUrl:e.testData.imageUrl}};default:return e}},OL=({testName:e="",showQuestionCount:t=!0,onTestSaved:r,onCancel:n,onBackToCabinet:s,isSaving:a=!1,validationErrors:i={}})=>{const[l,c]=C.useReducer(ML,IL),{showNotification:d}=da(),{makeAuthenticatedRequest:f}=Ji(),{user:p}=Wn(),g=C.useRef(null),y=C.useRef(null),v=C.useRef(null),w=C.useRef({}),b=C.useRef({}),{canvasSize:E,stageRef:k}=PL(g),_=RL(l.canvas.image,E),{convertToOriginal:T}=DL(_);C.useEffect(()=>{c({type:"SET_CANVAS_SIZE",payload:E})},[E]),C.useEffect(()=>{_&&c({type:"SET_IMAGE_INFO",payload:_})},[_]),C.useEffect(()=>{const te=v.current;if(!te)return;const se=l.ui.selectedBlock?.id?w.current[l.ui.selectedBlock.id]:null;se?(te.nodes([se]),te.getLayer()?.batchDraw()):(te.nodes([]),te.getLayer()?.batchDraw())},[l.ui.selectedBlock]);const j=C.useCallback(()=>{c({type:"SET_UI_STATE",payload:{selectedBlock:null}}),c({type:"SET_CREATION_STATE",payload:{isCreatingBlock:!1,isDrawingArrow:!1,blockCreationStart:null,arrowStart:null,previewBlock:null,previewArrow:null}}),c({type:"RESET_TESTDATA"}),c({type:"SET_ERROR",payload:null})},[]),P=C.useCallback(te=>{const se=te.target.files[0];if(!se||!se.type.startsWith("image/")){d("Please select a valid image file","error");return}const L=new FileReader;L.onload=G=>{const I=G.target.result,z=new Image;z.crossOrigin="anonymous",z.onload=()=>{c({type:"SET_IMAGE",payload:z}),c({type:"SET_UI_STATE",payload:{imageUrl:I}})},z.src=I},L.readAsDataURL(se)},[d]),R=C.useCallback(te=>{const se=k.current;if(!se)return;const L=se.getPointerPosition();if(L){if(l.canvas.selectedTool==="create"){const G=ym.findAtPosition(l.testData.blocks,L.x,L.y);if(G){c({type:"SET_UI_STATE",payload:{selectedBlock:G}});return}c({type:"SET_CREATION_STATE",payload:{isCreatingBlock:!0,blockCreationStart:{x:L.x,y:L.y}}})}else if(l.canvas.selectedTool==="edit"){const G=ym.findAtPosition(l.testData.blocks,L.x,L.y);c(G?{type:"SET_UI_STATE",payload:{selectedBlock:G}}:{type:"SET_UI_STATE",payload:{selectedBlock:null}})}else if(l.canvas.selectedTool==="arrow"){const G=te.target===se,I=ym.findAtPosition(l.testData.blocks,L.x,L.y);(G||!I)&&c({type:"SET_CREATION_STATE",payload:{isDrawingArrow:!0,arrowStart:{x:L.x,y:L.y}}})}}},[l.canvas.selectedTool,_,l.testData.blocks]),N=C.useCallback(te=>{if(l.creation.isCreatingBlock&&l.creation.blockCreationStart){const se=k.current;if(!se)return;const L=se.getPointerPosition();if(!L)return;const G=Math.abs(L.x-l.creation.blockCreationStart.x),I=Math.abs(L.y-l.creation.blockCreationStart.y),z=10,V=Math.max(G,z),O=Math.max(I,z);c({type:"SET_CREATION_STATE",payload:{previewBlock:{x:Math.min(L.x,l.creation.blockCreationStart.x),y:Math.min(L.y,l.creation.blockCreationStart.y),width:V,height:O,fill:"rgba(0, 123, 255, 0.3)",stroke:"#007bff",strokeWidth:2,dash:[5,5],opacity:.7}}})}else if(l.creation.isDrawingArrow&&l.creation.arrowStart){const se=k.current;if(!se)return;const L=se.getPointerPosition();if(!L)return;c({type:"SET_CREATION_STATE",payload:{previewArrow:{startX:l.creation.arrowStart.x,startY:l.creation.arrowStart.y,endX:L.x,endY:L.y,stroke:"#dc3545",fill:"#dc3545",strokeWidth:3,dash:[5,5],opacity:.7}}})}},[l.creation]),A=C.useCallback(te=>{if(l.creation.isCreatingBlock&&l.creation.blockCreationStart){const se=k.current;if(!se)return;const L=se.getPointerPosition();if(!L)return;const G=Math.abs(L.x-l.creation.blockCreationStart.x),I=Math.abs(L.y-l.creation.blockCreationStart.y),z=10,V=Math.max(G,z),O=Math.max(I,z),W=Math.min(L.x,l.creation.blockCreationStart.x)+V/2,q=Math.min(L.y,l.creation.blockCreationStart.y)+O/2,Y=ym.generateId(),ee=ym.create(W,q,V,O,Y),X=bw.create(Y,`Word ${l.testData.blocks.length+1}`,bw.generateId(Y));c({type:"ADD_BLOCK",payload:ee}),c({type:"ADD_WORD",payload:X}),c({type:"SET_CREATION_STATE",payload:{isCreatingBlock:!1,blockCreationStart:null,previewBlock:null}}),l.testData.blocks.length===0&&c({type:"SET_UI_STATE",payload:{showWordPanel:!0}})}else if(l.creation.isDrawingArrow&&l.creation.arrowStart){const se=k.current;if(!se)return;const L=se.getPointerPosition();if(!L)return;if(Dh.validate(l.creation.arrowStart.x,l.creation.arrowStart.y,L.x,L.y,l.testData.blocks)){const G=Dh.snapToNearestBlock(l.creation.arrowStart.x,l.creation.arrowStart.y,l.testData.blocks),I=Dh.snapToNearestBlock(L.x,L.y,l.testData.blocks),z=G?G.x:l.creation.arrowStart.x,V=G?G.y:l.creation.arrowStart.y,O=I?I.x:L.x,W=I?I.y:L.y,q=Dh.generateId(),Y=Dh.create(z,V,O,W,G?G.blockId:null,I?I.blockId:null,q);c({type:"ADD_ARROW",payload:Y}),d("Arrow created successfully!","success")}else d("Arrow must start near a block!","error");c({type:"SET_CREATION_STATE",payload:{isDrawingArrow:!1,arrowStart:null,previewArrow:null}})}},[l.creation,l.testData.blocks,d]),M=C.useCallback(async()=>{console.log("🟢 [MatchingTestCreator] handleSaveTest clicked");const te=H();if(Object.keys(te).length>0){console.warn("⚠️ [MatchingTestCreator] Validation errors:",te),d("Please fix validation errors before saving","error");return}try{console.log("🟢 [MatchingTestCreator] Preparing data to save...",{blocks:l.testData.blocks.length,words:l.testData.words.length,arrows:l.testData.arrows.length,imageUrl:l.ui.imageUrl?"present":"missing"}),c({type:"SET_LOADING",payload:!0});let se=l.ui.imageUrl;if(l.ui.imageUrl&&l.ui.imageUrl.startsWith("data:")){const G=await f("/.netlify/functions/upload-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataUrl:l.ui.imageUrl,folder:"matching_tests"})}),I=await G.json();if(G.ok&&I.success&&I.url)se=I.url;else throw new Error(I.message||"Upload failed")}const L=l.testData.blocks.map((G,I)=>{let z;if(_){const W=T(G.x,G.y),q=T(G.x+G.width,G.y+G.height);z={x:W.x,y:W.y,width:Number((q.x-W.x).toFixed(4)),height:Number((q.y-W.y).toFixed(4))}}else z={x:Number(G.x.toFixed(4)),y:Number(G.y.toFixed(4)),width:Number(G.width.toFixed(4)),height:Number(G.height.toFixed(4))};const V=l.testData.words.find(W=>W.blockId===G.id),O=l.testData.arrows.find(W=>W.startBlock===G.id);return{question_id:I+1,word:V?.word||`Word ${I+1}`,block_coordinates:z,has_arrow:!!O,arrow:O&&_?(()=>{const W=T(O.startX,O.startY),q=T(O.endX,O.endY),Y=W.x/_.originalWidth*100,ee=W.y/_.originalHeight*100,X=q.x/_.originalWidth*100,ne=q.y/_.originalHeight*100;return{start_x:Number(W.x.toFixed(4)),start_y:Number(W.y.toFixed(4)),end_x:Number(q.x.toFixed(4)),end_y:Number(q.y.toFixed(4)),rel_start_x:Number(Y.toFixed(4)),rel_start_y:Number(ee.toFixed(4)),rel_end_x:Number(X.toFixed(4)),rel_end_y:Number(ne.toFixed(4)),image_width:_.originalWidth,image_height:_.originalHeight,style:O.style||{color:"#dc3545",thickness:3}}})():null}});r&&(console.log("🟢 [MatchingTestCreator] Calling onTestSaved with processed data"),r({success:!0,message:"Test data prepared for assignment",blocks:l.testData.blocks,words:l.testData.words,arrows:l.testData.arrows,imageUrl:se,processedQuestions:L}))}catch(se){console.error("Save error:",se),d(`Error saving test: ${se.message}`,"error")}finally{c({type:"SET_LOADING",payload:!1})}},[l.testData,l.ui.imageUrl,_,T,f,r,d,e,p]),H=C.useCallback(()=>{const te={};return e.trim()||(te.testName="Test name is required"),l.testData.blocks.length===0&&(te.blocks="At least one block is required"),te},[e,l.testData.blocks.length]),Q=()=>o.jsxs("div",{className:"flex flex-wrap gap-2 p-4 bg-gray-50 border-b",children:[o.jsx(rt,{onClick:()=>c({type:"SET_SELECTED_TOOL",payload:"create"}),variant:l.canvas.selectedTool==="create"?"primary":"secondary",size:"sm",children:"📦 Create Blocks"}),o.jsx(rt,{onClick:()=>c({type:"SET_SELECTED_TOOL",payload:"edit"}),variant:l.canvas.selectedTool==="edit"?"primary":"secondary",size:"sm",children:"🛠️ Edit Blocks"}),o.jsx(rt,{onClick:()=>c({type:"SET_SELECTED_TOOL",payload:"arrow"}),variant:l.canvas.selectedTool==="arrow"?"primary":"secondary",size:"sm",children:"🏹 Draw Arrows"}),o.jsx(rt,{onClick:j,variant:"secondary",size:"sm",children:"♻️ Reset"}),o.jsx(rt,{onClick:()=>y.current?.click(),variant:"secondary",size:"sm",children:"🖼️ Upload Image"})]}),Z=()=>o.jsx(sf,{width:E.width,height:E.height,ref:k,onMouseDown:R,onMouseMove:N,onMouseUp:A,className:l.canvas.selectedTool==="arrow"||l.canvas.selectedTool==="create"?"cursor-crosshair":"cursor-default",children:o.jsxs(nf,{children:[l.canvas.image&&_&&o.jsx(B6,{image:l.canvas.image,x:_.x,y:_.y,width:_.width,height:_.height}),l.testData.blocks.map(te=>o.jsxs(qo,{ref:se=>{se&&(b.current[te.id]=se)},draggable:l.canvas.selectedTool==="edit",x:te.x,y:te.y,onMouseEnter:se=>{const L=se.target.getStage()?.container();L&&(L.style.cursor=l.ui.selectedBlock?.id===te.id?"nwse-resize":"move")},onMouseLeave:se=>{const L=se.target.getStage()?.container();L&&(L.style.cursor=l.canvas.selectedTool==="arrow"?"crosshair":"default")},onDragStart:()=>{c({type:"SET_UI_STATE",payload:{selectedBlock:te}})},onDragEnd:se=>{const{x:L,y:G}=se.target.position();c({type:"UPDATE_BLOCK",payload:{id:te.id,updates:{x:L,y:G}}})},onClick:()=>{c({type:"SET_UI_STATE",payload:{selectedBlock:te}})},onTap:()=>{c({type:"SET_UI_STATE",payload:{selectedBlock:te}})},children:[o.jsx(ca,{ref:se=>{se&&(w.current[te.id]=se)},width:te.width,height:te.height,fill:te.fill,stroke:te.stroke,strokeWidth:te.strokeWidth,cornerRadius:te.cornerRadius,shadowColor:te.shadowColor,shadowBlur:te.shadowBlur,shadowOffset:te.shadowOffset,shadowOpacity:te.shadowOpacity,draggable:l.canvas.selectedTool==="edit",onDragEnd:se=>{const{x:L,y:G}=se.target.getParent().position();c({type:"UPDATE_BLOCK",payload:{id:te.id,updates:{x:L,y:G}}})},onMouseEnter:se=>{const L=se.target.getStage()?.container();L&&(L.style.cursor=l.ui.selectedBlock?.id===te.id?"nwse-resize":"move")},onMouseLeave:se=>{const L=se.target.getStage()?.container();L&&(L.style.cursor=l.canvas.selectedTool==="arrow"?"crosshair":"default")},onTransformEnd:se=>{const L=w.current[te.id];if(!L)return;const G=Math.max(10,L.width()*L.scaleX()),I=Math.max(10,L.height()*L.scaleY());L.scaleX(1),L.scaleY(1),c({type:"UPDATE_BLOCK",payload:{id:te.id,updates:{width:G,height:I}}})}}),o.jsx(Rl,{x:2,y:2,text:`${l.testData.blocks.indexOf(te)+1}`,fontSize:Math.min(12,Math.max(8,te.width/4)),fontFamily:"Arial",fill:"#333",fontStyle:"bold",listening:!1})]},te.id)),o.jsx(U6,{ref:v,rotateEnabled:!1,flipEnabled:!1,boundBoxFunc:(te,se)=>({...se,width:Math.max(se.width,10),height:Math.max(se.height,10)})}),l.testData.arrows.map(te=>o.jsx(E_,{points:[te.startX,te.startY,te.endX,te.endY],stroke:te.stroke,fill:te.fill,strokeWidth:te.strokeWidth,pointerLength:te.pointerLength,pointerWidth:te.pointerWidth},te.id)),l.creation.previewBlock&&o.jsx(ca,{x:l.creation.previewBlock.x,y:l.creation.previewBlock.y,width:l.creation.previewBlock.width,height:l.creation.previewBlock.height,fill:l.creation.previewBlock.fill,stroke:l.creation.previewBlock.stroke,strokeWidth:l.creation.previewBlock.strokeWidth,dash:l.creation.previewBlock.dash,opacity:l.creation.previewBlock.opacity}),l.creation.previewArrow&&o.jsx(E_,{points:[l.creation.previewArrow.startX,l.creation.previewArrow.startY,l.creation.previewArrow.endX,l.creation.previewArrow.endY],stroke:l.creation.previewArrow.stroke,fill:l.creation.previewArrow.fill,strokeWidth:l.creation.previewArrow.strokeWidth,dash:l.creation.previewArrow.dash,opacity:l.creation.previewArrow.opacity})]})}),ae=C.useMemo(()=>l.testData.blocks.length===0?null:o.jsxs("div",{className:"word-panel bg-gray-50 border-t border-gray-200 p-4 w-full",style:{height:"min(400px, 40vh)",overflowY:"auto"},children:[o.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Words (Auto-created with blocks)"}),o.jsx("div",{className:"space-y-2",children:l.testData.words.map(te=>{const se=l.testData.blocks.find(L=>L.id===te.blockId);return o.jsxs("div",{className:"p-2 bg-white rounded border",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsxs("span",{className:"text-xs text-gray-500",children:["Block ",l.testData.blocks.indexOf(se)+1]}),o.jsx("button",{onClick:()=>c({type:"DELETE_BLOCK",payload:se.id}),className:"text-red-500 hover:text-red-700 text-xs",children:"×"})]}),o.jsx("input",{type:"text",value:te.word,onChange:L=>{const G=bw.update(l.testData.words,te.blockId,L.target.value);c({type:"UPDATE_WORDS",payload:G})},className:"w-full text-sm px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter word text"})]},te.blockId)})})]}),[l.testData.words,l.testData.blocks]);return o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex flex-col h-screen bg-gray-100",children:[o.jsx("div",{className:"bg-white shadow-sm border-b p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("div",{children:o.jsx("div",{className:"mt-2 text-sm text-gray-600",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("span",{children:[o.jsx("strong",{children:"Test Name:"})," ",e||"Untitled Test"]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Questions:"})," ",l.testData.blocks.length," (auto-generated from blocks)"]})]})})}),o.jsx("div",{className:"flex gap-2",children:o.jsx(rt,{onClick:M,disabled:a||l.ui.isLoading,variant:"primary",children:a||l.ui.isLoading?o.jsx(Br,{size:"sm"}):"Save Test"})})]})}),Q(),o.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[o.jsx("div",{ref:g,className:"bg-white border overflow-auto",style:{minHeight:"400px",maxHeight:"calc(100vh - 200px)",height:"auto"},children:Z()}),ae]}),o.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:P,className:"hidden"})]})},k0=C.createContext(null);function LL(e,t){return{getTheme:function(){return t??null}}}function Wl(){const e=C.useContext(k0);return e==null&&(function(t,...r){const n=new URL("https://lexical.dev/docs/error"),s=new URLSearchParams;s.append("code",t);for(const a of r)s.append("v",a);throw n.search=s.toString(),Error(`Minified Lexical error #${t}; visit ${n.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(8),e}function Lt(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const rl=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,BL=rl&&"documentMode"in document?document.documentMode:null,Pl=rl&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),af=rl&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),Ky=!(!rl||!("InputEvent"in window)||BL)&&"getTargetRanges"in new window.InputEvent("input"),ap=rl&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),u0=rl&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,UL=rl&&/Android/.test(navigator.userAgent),$6=rl&&/^(?=.*Chrome).*/i.test(navigator.userAgent),p4=rl&&UL&&$6,qy=rl&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!$6;function W6(...e){const t=[];for(const r of e)if(r&&typeof r=="string")for(const[n]of r.matchAll(/\S+/g))t.push(n);return t}const $L=1,WL=3,zL=9,HL=11,of=0,z6=1,d0=2,GL=0,VL=1,KL=2,Xy=4,Yy=8,fb=128,qL=1792|(112|(3|Xy|Yy)|fb),hb=1,gb=2,mb=3,pb=4,xb=5,yb=6,B1=ap||u0||qy?" ":"​",Rc=`

`,XL=af?" ":B1,lf={bold:1,capitalize:1024,code:16,highlight:fb,italic:2,lowercase:256,strikethrough:Xy,subscript:32,superscript:64,underline:Yy,uppercase:512},YL={directionless:1,unmergeable:2},x4={center:gb,end:yb,justify:pb,left:hb,right:mb,start:xb},JL={[gb]:"center",[yb]:"end",[pb]:"justify",[hb]:"left",[mb]:"right",[xb]:"start"},QL={normal:0,segmented:2,token:1},ZL={[GL]:"normal",[KL]:"segmented",[VL]:"token"},y4="$config";function H6(e,t,r,n,s,a){let i=e.getFirstChild();for(;i!==null;){const l=i.__key;i.__parent===t&&(vt(i)&&H6(i,l,r,n,s,a),r.has(l)||a.delete(l),s.push(l)),i=i.getNextSibling()}}const eB=100;let A_=!1,vb=0;function tB(e){vb=e.timeStamp}function Sw(e,t,r){const n=e.nodeName==="BR",s=t.__lexicalLineBreak;return s&&(e===s||n&&e.previousSibling===s)||n&&X1(e,r)!==void 0}function rB(e,t,r){const n=tl(Co(r));let s=null,a=null;n!==null&&n.anchorNode===e&&(s=n.anchorOffset,a=n.focusOffset);const i=e.nodeValue;i!==null&&Bb(t,i,s,a,!1)}function nB(e,t,r){if(At(e)){const n=e.anchor.getNode();if(n.is(r)&&e.format!==n.getFormat())return!1}return Oc(t)&&r.isAttached()}function sB(e,t,r,n){for(let s=e;s&&!sU(s);s=$p(s)){const a=X1(s,t);if(a!==void 0){const i=Ls(a,r);if(i)return cn(i)||!Bn(s)?void 0:[s,i]}else if(s===n)return[n,Uj(r)]}}function G6(e,t,r){A_=!0;const n=performance.now()-vb>eB;try{Hi(e,(()=>{const s=qt()||(function(g){return g.getEditorState().read((()=>{const y=qt();return y!==null?y.clone():null}))})(e),a=new Map,i=e.getRootElement(),l=e._editorState,c=e._blockCursorElement;let d=!1,f="";for(let g=0;g<t.length;g++){const y=t[g],v=y.type,w=y.target,b=sB(w,e,l,i);if(!b)continue;const[E,k]=b;if(v==="characterData")n&&Xt(k)&&Oc(w)&&nB(s,w,k)&&rB(w,k,e);else if(v==="childList"){d=!0;const _=y.addedNodes;for(let P=0;P<_.length;P++){const R=_[P],N=Lj(R),A=R.parentNode;if(A!=null&&R!==c&&N===null&&!Sw(R,A,e)){if(af){const M=(Bn(R)?R.innerText:null)||R.nodeValue;M&&(f+=M)}A.removeChild(R)}}const T=y.removedNodes,j=T.length;if(j>0){let P=0;for(let R=0;R<j;R++){const N=T[R];(Sw(N,w,e)||c===N)&&(w.appendChild(N),P++)}j!==P&&a.set(E,k)}}}if(a.size>0)for(const[g,y]of a)y.reconcileObservedMutation(g,e);const p=r.takeRecords();if(p.length>0){for(let g=0;g<p.length;g++){const y=p[g],v=y.addedNodes,w=y.target;for(let b=0;b<v.length;b++){const E=v[b],k=E.parentNode;k==null||E.nodeName!=="BR"||Sw(E,w,e)||k.removeChild(E)}}r.takeRecords()}s!==null&&(d&&Pa(s),af&&Hj(e)&&s.insertRawText(f))}))}finally{A_=!1}}function V6(e){const t=e._observer;t!==null&&G6(e,t.takeRecords(),t)}function K6(e){(function(t){vb===0&&Co(t).addEventListener("textInput",tB,!0)})(e),e._observer=new MutationObserver(((t,r)=>{G6(e,t,r)}))}function aB(e){const t=new Map,r=new Set;for(let n=typeof e=="function"?e:e.replace;n.prototype&&n.prototype.getType!==void 0;n=Object.getPrototypeOf(n)){const{ownNodeConfig:s}=Hb(n);if(s&&s.stateConfigs)for(const a of s.stateConfigs){let i;"stateConfig"in a?(i=a.stateConfig,a.flat&&r.add(i.key)):i=a,t.set(i.key,i)}}return{flatKeys:r,sharedConfigMap:t}}let iB=class q6{constructor(t,r,n=void 0,s=new Map,a=void 0){this.node=t,this.sharedNodeState=r,this.unknownState=n,this.knownState=s;const{sharedConfigMap:i}=this.sharedNodeState,l=a!==void 0?a:(function(c,d,f){let p=f.size;if(d)for(const g in d){const y=c.get(g);y&&f.has(y)||p++}return p})(i,n,s);this.size=l}getValue(t){const r=this.knownState.get(t);if(r!==void 0)return r;this.sharedNodeState.sharedConfigMap.set(t.key,t);let n=t.defaultValue;if(this.unknownState&&t.key in this.unknownState){const s=this.unknownState[t.key];s!==void 0&&(n=t.parse(s)),this.updateFromKnown(t,n)}return n}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const t={...this.unknownState},r={};for(const[n,s]of this.knownState)n.isEqual(s,n.defaultValue)?delete t[n.key]:t[n.key]=n.unparse(s);for(const n of this.sharedNodeState.flatKeys)n in t&&(r[n]=t[n],delete t[n]);return v4(t)&&(r.$=t),r}getWritable(t){if(this.node===t)return this;const{sharedNodeState:r,unknownState:n}=this,s=new Map(this.knownState);return new q6(t,r,(function(a,i,l){let c;if(l)for(const[d,f]of Object.entries(l)){const p=a.get(d);p?i.has(p)||i.set(p,p.parse(f)):(c=c||{},c[d]=f)}return c})(r.sharedConfigMap,s,n),s,this.size)}updateFromKnown(t,r){const n=t.key;this.sharedNodeState.sharedConfigMap.set(n,t);const{knownState:s,unknownState:a}=this;s.has(t)||a&&n in a||(a&&(delete a[n],this.unknownState=v4(a)),this.size++),s.set(t,r)}updateFromUnknown(t,r){const n=this.sharedNodeState.sharedConfigMap.get(t);n?this.updateFromKnown(n,n.parse(r)):(this.unknownState=this.unknownState||{},t in this.unknownState||this.size++,this.unknownState[t]=r)}updateFromJSON(t){const{knownState:r}=this;for(const n of r.keys())r.set(n,n.defaultValue);if(this.size=r.size,this.unknownState=void 0,t)for(const[n,s]of Object.entries(t))this.updateFromUnknown(n,s)}};function oB(e){const t=e.getWritable(),r=t.__state?t.__state.getWritable(t):new iB(t,X6(t));return t.__state=r,r}function X6(e){return e.__state?e.__state.sharedNodeState:Ij(Wp(),e.getType()).sharedNodeState}function v4(e){if(e)for(const t in e)return e}function w4(e,t,r){for(const[n,s]of t.knownState){if(e.has(n.key))continue;e.add(n.key);const a=r?r.getValue(n):n.defaultValue;if(a!==s&&!n.isEqual(a,s))return!0}return!1}function _4(e,t,r){const{unknownState:n}=t,s=r?r.unknownState:void 0;if(n){for(const[a,i]of Object.entries(n))if(!e.has(a)&&(e.add(a),i!==(s?s[a]:void 0)))return!0}return!1}function b4(e,t){const r=e.__state;return r&&r.node===e?r.getWritable(t):r}function S4(e,t){const r=e.__mode,n=e.__format,s=e.__style,a=t.__mode,i=t.__format,l=t.__style,c=e.__state,d=t.__state;return(r===null||r===a)&&(n===null||n===i)&&(s===null||s===l)&&(e.__state===null||c===d||(function(f,p){if(f===p)return!0;if(f&&p&&f.size!==p.size)return!1;const g=new Set;return!(f&&w4(g,f,p)||p&&w4(g,p,f)||f&&_4(g,f,p)||p&&_4(g,p,f))})(c,d))}function k4(e,t){const r=e.mergeWithSibling(t),n=rs()._normalizedNodes;return n.add(e.__key),n.add(t.__key),r}function C4(e){let t,r,n=e;if(n.__text!==""||!n.isSimpleText()||n.isUnmergeable()){for(;(t=n.getPreviousSibling())!==null&&Xt(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(S4(t,n)){n=k4(t,n);break}break}t.remove()}for(;(r=n.getNextSibling())!==null&&Xt(r)&&r.isSimpleText()&&!r.isUnmergeable();){if(r.__text!==""){if(S4(n,r)){n=k4(n,r);break}break}r.remove()}}else n.remove()}function Jy(e){return T4(e.anchor),T4(e.focus),e}function T4(e){for(;e.type==="element";){const t=e.getNode(),r=e.offset;let n,s;if(r===t.getChildrenSize()?(n=t.getChildAtIndex(r-1),s=!0):(n=t.getChildAtIndex(r),s=!1),Xt(n)){e.set(n.__key,s?n.getTextContentSize():0,"text",!0);break}if(!vt(n))break;e.set(n.__key,s?n.getChildrenSize():0,"element",!0)}}let cf,Ka,ip,U1,F_,P_,uf,Jo,R_,op,Vs="",Al=null,Fl="",Sc="",Ih=!1,Qy=!1;function Zy(e,t){const r=uf.get(e);if(t!==null){const n=O_(e);n.parentNode===t&&t.removeChild(n)}if(Jo.has(e)||Ka._keyToDOMMap.delete(e),vt(r)){const n=t1(r,uf);D_(n,0,n.length-1,null)}r!==void 0&&Ub(op,ip,U1,r,"destroyed")}function D_(e,t,r,n){let s=t;for(;s<=r;++s){const a=e[s];a!==void 0&&Zy(a,n)}}function Ld(e,t){e.setProperty("text-align",t)}const lB="40px";function Y6(e,t){const r=cf.theme.indent;if(typeof r=="string"){const s=e.classList.contains(r);t>0&&!s?e.classList.add(r):t<1&&s&&e.classList.remove(r)}const n=getComputedStyle(e).getPropertyValue("--lexical-indent-base-value")||lB;e.style.setProperty("padding-inline-start",t===0?"":`calc(${t} * ${n})`)}function J6(e,t){const r=e.style;t===0?Ld(r,""):t===hb?Ld(r,"left"):t===gb?Ld(r,"center"):t===mb?Ld(r,"right"):t===pb?Ld(r,"justify"):t===xb?Ld(r,"start"):t===yb&&Ld(r,"end")}function I_(e,t){const r=(function(n){const s=n.__dir;if(s!==null)return s;if(Xs(n))return null;const a=n.getParentOrThrow();return Xs(a)&&a.__dir===null?"auto":null})(t);r!==null?e.dir=r:e.removeAttribute("dir")}function e1(e,t){const r=Jo.get(e);r===void 0&&Lt(60);const n=r.createDOM(cf,Ka);if((function(s,a,i){const l=i._keyToDOMMap;(function(c,d,f){const p=`__lexicalKey_${d._key}`;c[p]=f})(a,i,s),l.set(s,a)})(e,n,Ka),Xt(r)?n.setAttribute("data-lexical-text","true"):cn(r)&&n.setAttribute("data-lexical-decorator","true"),vt(r)){const s=r.__indent,a=r.__size;if(I_(n,r),s!==0&&Y6(n,s),a!==0){const l=a-1;M_(t1(r,Jo),r,0,l,r.getDOMSlot(n))}const i=r.__format;i!==0&&J6(n,i),r.isInline()||Q6(null,r,n),Y1(r)&&(Vs+=Rc,Sc+=Rc)}else{const s=r.getTextContent();if(cn(r)){const a=r.decorate(Ka,cf);a!==null&&Z6(e,a),n.contentEditable="false"}Vs+=s,Sc+=s}return t!==null&&t.insertChild(n),Ub(op,ip,U1,r,"created"),n}function M_(e,t,r,n,s){const a=Vs;Vs="";let i=r;for(;i<=n;++i){e1(e[i],s);const l=Jo.get(e[i]);l!==null&&Xt(l)&&(Al===null&&(Al=l.getFormat()),Fl===""&&(Fl=l.getStyle()))}Y1(t)&&(Vs+=Rc),s.element.__lexicalTextContent=Vs,Vs=a+Vs}function N4(e,t){if(e){const r=e.__last;if(r){const n=t.get(r);if(n)return Nc(n)?"line-break":cn(n)&&n.isInline()?"decorator":null}return"empty"}return null}function Q6(e,t,r){const n=N4(e,uf),s=N4(t,Jo);n!==s&&t.getDOMSlot(r).setManagedLineBreak(s)}function cB(e,t,r){var n;Al=null,Fl="",(function(s,a,i){const l=Vs,c=s.__size,d=a.__size;Vs="";const f=i.element;if(c===1&&d===1){const p=s.__first,g=a.__first;if(p===g)Nm(p,f);else{const v=O_(p),w=e1(g,null);try{f.replaceChild(w,v)}catch(b){if(typeof b=="object"&&b!=null){const E=`${b.toString()} Parent: ${f.tagName}, new child: {tag: ${w.tagName} key: ${g}}, old child: {tag: ${v.tagName}, key: ${p}}.`;throw new Error(E)}throw b}Zy(p,null)}const y=Jo.get(g);Xt(y)&&(Al===null&&(Al=y.getFormat()),Fl===""&&(Fl=y.getStyle()))}else{const p=t1(s,uf),g=t1(a,Jo);if(p.length!==c&&Lt(227),g.length!==d&&Lt(228),c===0)d!==0&&M_(g,a,0,d-1,i);else if(d===0){if(c!==0){const y=i.after==null&&i.before==null&&i.element.__lexicalLineBreak==null;D_(p,0,c-1,y?null:f),y&&(f.textContent="")}}else(function(y,v,w,b,E,k){const _=b-1,T=E-1;let j,P,R=k.getFirstChild(),N=0,A=0;for(;N<=_&&A<=T;){const Q=v[N],Z=w[A];if(Q===Z)R=kw(Nm(Z,k.element)),N++,A++;else{j===void 0&&(j=new Set(v)),P===void 0&&(P=new Set(w));const te=P.has(Q),se=j.has(Z);if(te)if(se){const L=df(Ka,Z);L===R?R=kw(Nm(Z,k.element)):(k.withBefore(R).insertChild(L),Nm(Z,k.element)),N++,A++}else e1(Z,k.withBefore(R)),A++;else R=kw(O_(Q)),Zy(Q,k.element),N++}const ae=Jo.get(Z);ae!==null&&Xt(ae)&&(Al===null&&(Al=ae.getFormat()),Fl===""&&(Fl=ae.getStyle()))}const M=N>_,H=A>T;if(M&&!H){const Q=w[T+1],Z=Q===void 0?null:Ka.getElementByKey(Q);M_(w,y,A,T,k.withBefore(Z))}else H&&!M&&D_(v,N,_,k.element)})(a,p,g,c,d,i)}Y1(a)&&(Vs+=Rc),f.__lexicalTextContent=Vs,Vs=l+Vs})(e,t,t.getDOMSlot(r)),n=t,Al==null||Al===n.__textFormat||Qy||n.setTextFormat(Al),(function(s){Fl===""||Fl===s.__textStyle||Qy||s.setTextStyle(Fl)})(t)}function t1(e,t){const r=[];let n=e.__first;for(;n!==null;){const s=t.get(n);s===void 0&&Lt(101),r.push(n),n=s.__next}return r}function Nm(e,t){const r=uf.get(e);let n=Jo.get(e);r!==void 0&&n!==void 0||Lt(61);const s=Ih||P_.has(e)||F_.has(e),a=df(Ka,e);if(r===n&&!s){if(vt(r)){const i=a.__lexicalTextContent;i!==void 0&&(Vs+=i,Sc+=i)}else{const i=r.getTextContent();Sc+=i,Vs+=i}return a}if(r!==n&&s&&Ub(op,ip,U1,n,"updated"),n.updateDOM(r,a,cf)){const i=e1(e,null);return t===null&&Lt(62),t.replaceChild(i,a),Zy(e,null),i}if(vt(r)&&vt(n)){const i=n.__indent;(Ih||i!==r.__indent)&&Y6(a,i);const l=n.__format;if((Ih||l!==r.__format)&&J6(a,l),s&&(cB(r,n,a),Xs(n)||n.isInline()||Q6(r,n,a)),Y1(n)&&(Vs+=Rc,Sc+=Rc),(Ih||n.__dir!==r.__dir)&&(I_(a,n),Xs(n)&&!Ih))for(const c of n.getChildren())vt(c)&&I_(df(Ka,c.getKey()),c)}else{const i=n.getTextContent();if(cn(n)){const l=n.decorate(Ka,cf);l!==null&&Z6(e,l)}Vs+=i,Sc+=i}if(!Qy&&Xs(n)&&n.__cachedText!==Sc){const i=n.getWritable();i.__cachedText=Sc,n=i}return a}function Z6(e,t){let r=Ka._pendingDecorators;const n=Ka._decorators;if(r===null){if(n[e]===t)return;r=Bj(Ka)}r[e]=t}function kw(e){let t=e.nextSibling;return t!==null&&t===Ka._blockCursorElement&&(t=t.nextSibling),t}function uB(e,t,r,n,s,a){Vs="",Sc="",Ih=n===d0,Ka=r,cf=r._config,ip=r._nodes,U1=Ka._listeners.mutation,F_=s,P_=a,uf=e._nodeMap,Jo=t._nodeMap,Qy=t._readOnly,R_=new Map(r._keyToDOMMap);const i=new Map;return op=i,Nm("root",null),Ka=void 0,ip=void 0,F_=void 0,P_=void 0,uf=void 0,Jo=void 0,cf=void 0,R_=void 0,op=void 0,i}function O_(e){const t=R_.get(e);return t===void 0&&Lt(75,e),t}function Tr(e){return{type:e}}const ej=Tr("SELECTION_CHANGE_COMMAND"),dB=Tr("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),wb=Tr("CLICK_COMMAND"),Yd=Tr("DELETE_CHARACTER_COMMAND"),Jh=Tr("INSERT_LINE_BREAK_COMMAND"),lp=Tr("INSERT_PARAGRAPH_COMMAND"),Qh=Tr("CONTROLLED_TEXT_INSERTION_COMMAND"),_b=Tr("PASTE_COMMAND"),L_=Tr("REMOVE_TEXT_COMMAND"),cp=Tr("DELETE_WORD_COMMAND"),up=Tr("DELETE_LINE_COMMAND"),Va=Tr("FORMAT_TEXT_COMMAND"),bb=Tr("UNDO_COMMAND"),Sb=Tr("REDO_COMMAND"),fB=Tr("KEYDOWN_COMMAND"),tj=Tr("KEY_ARROW_RIGHT_COMMAND"),hB=Tr("MOVE_TO_END"),rj=Tr("KEY_ARROW_LEFT_COMMAND"),gB=Tr("MOVE_TO_START"),nj=Tr("KEY_ARROW_UP_COMMAND"),sj=Tr("KEY_ARROW_DOWN_COMMAND"),r1=Tr("KEY_ENTER_COMMAND"),aj=Tr("KEY_SPACE_COMMAND"),ij=Tr("KEY_BACKSPACE_COMMAND"),oj=Tr("KEY_ESCAPE_COMMAND"),lj=Tr("KEY_DELETE_COMMAND"),cj=Tr("KEY_TAB_COMMAND"),mB=Tr("INSERT_TAB_COMMAND"),pB=Tr("INDENT_CONTENT_COMMAND"),E4=Tr("OUTDENT_CONTENT_COMMAND"),uj=Tr("DROP_COMMAND"),dj=Tr("FORMAT_ELEMENT_COMMAND"),fj=Tr("DRAGSTART_COMMAND"),hj=Tr("DRAGOVER_COMMAND"),xB=Tr("DRAGEND_COMMAND"),$1=Tr("COPY_COMMAND"),kb=Tr("CUT_COMMAND"),B_=Tr("SELECT_ALL_COMMAND"),yB=Tr("CLEAR_EDITOR_COMMAND"),vB=Tr("CLEAR_HISTORY_COMMAND"),ly=Tr("CAN_REDO_COMMAND"),cy=Tr("CAN_UNDO_COMMAND"),wB=Tr("FOCUS_COMMAND"),_B=Tr("BLUR_COMMAND"),bB=Tr("KEY_MODIFIER_COMMAND"),vc=Object.freeze({}),U_=30,$_=[["keydown",function(e,t){if(Om=e.timeStamp,gj=e.key,!t.isComposing()&&!rr(t,fB,e)&&e.key!=null){if(Cw&&rN(e))return Hi(t,(()=>{uy(t,Tw)})),Cw=!1,void(Tw="");if((function(r){return yn(r,"ArrowRight",{shiftKey:"any"})})(e))rr(t,tj,e);else if((function(r){return yn(r,"ArrowRight",_c)})(e))rr(t,hB,e);else if((function(r){return yn(r,"ArrowLeft",{shiftKey:"any"})})(e))rr(t,rj,e);else if((function(r){return yn(r,"ArrowLeft",_c)})(e))rr(t,gB,e);else if((function(r){return yn(r,"ArrowUp",{altKey:"any",shiftKey:"any"})})(e))rr(t,nj,e);else if((function(r){return yn(r,"ArrowDown",{altKey:"any",shiftKey:"any"})})(e))rr(t,sj,e);else if((function(r){return yn(r,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})})(e))Lm=!0,rr(t,r1,e);else if((function(r){return r.key===" "})(e))rr(t,aj,e);else if((function(r){return Pl&&yn(r,"o",{ctrlKey:!0})})(e))e.preventDefault(),Lm=!0,rr(t,Jh,!0);else if((function(r){return yn(r,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})})(e))Lm=!1,rr(t,r1,e);else if((function(r){return yn(r,"Backspace",{shiftKey:"any"})||Pl&&yn(r,"h",{ctrlKey:!0})})(e))rN(e)?rr(t,ij,e):(e.preventDefault(),rr(t,Yd,!0));else if((function(r){return r.key==="Escape"})(e))rr(t,oj,e);else if((function(r){return yn(r,"Delete",{})||Pl&&yn(r,"d",{ctrlKey:!0})})(e))(function(r){return r.key==="Delete"})(e)?rr(t,lj,e):(e.preventDefault(),rr(t,Yd,!1));else if((function(r){return yn(r,"Backspace",tN)})(e))e.preventDefault(),rr(t,cp,!0);else if((function(r){return yn(r,"Delete",tN)})(e))e.preventDefault(),rr(t,cp,!1);else if((function(r){return Pl&&yn(r,"Backspace",{metaKey:!0})})(e))e.preventDefault(),rr(t,up,!0);else if((function(r){return Pl&&(yn(r,"Delete",{metaKey:!0})||yn(r,"k",{ctrlKey:!0}))})(e))e.preventDefault(),rr(t,up,!1);else if((function(r){return yn(r,"b",_c)})(e))e.preventDefault(),rr(t,Va,"bold");else if((function(r){return yn(r,"u",_c)})(e))e.preventDefault(),rr(t,Va,"underline");else if((function(r){return yn(r,"i",_c)})(e))e.preventDefault(),rr(t,Va,"italic");else if((function(r){return yn(r,"Tab",{shiftKey:"any"})})(e))rr(t,cj,e);else if((function(r){return yn(r,"z",_c)})(e))e.preventDefault(),rr(t,bb,void 0);else if((function(r){return Pl?yn(r,"z",{metaKey:!0,shiftKey:!0}):yn(r,"y",{ctrlKey:!0})||yn(r,"z",{ctrlKey:!0,shiftKey:!0})})(e))e.preventDefault(),rr(t,Sb,void 0);else{const r=t._editorState._selection;r===null||At(r)?nN(e)&&(e.preventDefault(),rr(t,B_,e)):(function(n){return yn(n,"c",_c)})(e)?(e.preventDefault(),rr(t,$1,e)):(function(n){return yn(n,"x",_c)})(e)?(e.preventDefault(),rr(t,kb,e)):nN(e)&&(e.preventDefault(),rr(t,B_,e))}(function(r){return r.ctrlKey||r.shiftKey||r.altKey||r.metaKey})(e)&&rr(t,bB,e)}}],["pointerdown",function(e,t){const r=e.target,n=e.pointerType;E0(r)&&n!=="touch"&&n!=="pen"&&e.button===0&&Hi(t,(()=>{Q4(r)||(z_=!0)}))}],["compositionstart",function(e,t){Hi(t,(()=>{const r=qt();if(At(r)&&!t.isComposing()){const n=r.anchor,s=r.anchor.getNode();ja(n.key),(e.timeStamp<Om+U_||n.type==="element"||!r.isCollapsed()||s.getFormat()!==r.format||Xt(s)&&s.getStyle()!==r.style)&&rr(t,Qh,XL)}}))}],["compositionend",function(e,t){af?vm=!0:u0||!ap&&!qy?Hi(t,(()=>{uy(t,e.data)})):(Cw=!0,Tw=e.data)}],["input",function(e,t){e.stopPropagation(),Hi(t,(()=>{if(Bn(e.target)&&Q4(e.target))return;const r=qt(),n=e.data,s=vj(e);if(n!=null&&At(r)&&xj(r,s,n,e.timeStamp,!1)){vm&&(uy(t,n),vm=!1);const a=r.anchor.getNode(),i=tl(Co(t));if(i===null)return;const l=r.isBackward(),c=l?r.anchor.offset:r.focus.offset,d=l?r.focus.offset:r.anchor.offset;Ky&&!r.isCollapsed()&&Xt(a)&&i.anchorNode!==null&&a.getTextContent().slice(0,c)+n+a.getTextContent().slice(c+d)===zj(i.anchorNode)||rr(t,Qh,n);const f=n.length;af&&f>1&&e.inputType==="insertCompositionText"&&!t.isComposing()&&(r.anchor.offset-=f),ap||u0||qy||!t.isComposing()||(Om=0,ja(null))}else Lb(!1,t,n!==null?n:void 0),vm&&(uy(t,n||void 0),vm=!1);(function(){Ea();const a=rs();V6(a)})()}),{event:e}),Mh=null}],["click",function(e,t){Hi(t,(()=>{const r=qt(),n=tl(Co(t)),s=N0();if(n){if(At(r)){const a=r.anchor,i=a.getNode();if(a.type==="element"&&a.offset===0&&r.isCollapsed()&&!Xs(i)&&qn().getChildrenSize()===1&&i.getTopLevelElementOrThrow().isEmpty()&&s!==null&&r.is(s))n.removeAllRanges(),r.dirty=!0;else if(e.detail===3&&!r.isCollapsed()&&i!==r.focus.getNode()){const l=(function(c,d){let f=c;for(;f!==qn()&&f!=null;){if(d(f))return f;f=f.getParent()}return null})(i,(c=>vt(c)&&!c.isInline()));vt(l)&&l.select(0)}}else if(e.pointerType==="touch"||e.pointerType==="pen"){const a=n.anchorNode;(Bn(a)||Oc(a))&&Pa(Nb(s,n,t,e))}}rr(t,wb,e)}))}],["cut",vc],["copy",vc],["dragstart",vc],["dragover",vc],["dragend",vc],["paste",vc],["focus",vc],["blur",vc],["drop",vc]];Ky&&$_.push(["beforeinput",(e,t)=>(function(r,n){const s=r.inputType,a=vj(r);s==="deleteCompositionText"||af&&Hj(n)||s!=="insertCompositionText"&&Hi(n,(()=>{const i=qt();if(s==="deleteContentBackward"){if(i===null){const y=N0();if(!At(y))return;Pa(y.clone())}if(At(i)){const y=i.anchor.key===i.focus.key;if(l=r.timeStamp,gj==="MediaLast"&&l<Om+U_&&n.isComposing()&&y){if(ja(null),Om=0,setTimeout((()=>{Hi(n,(()=>{ja(null)}))}),U_),At(i)){const v=i.anchor.getNode();v.markDirty(),Xt(v)||Lt(142),yj(i,v)}}else{ja(null),r.preventDefault();const v=i.anchor.getNode(),w=v.getTextContent(),b=v.canInsertTextAfter(),E=i.anchor.offset===0&&i.focus.offset===w.length;let k=p4&&y&&!E&&b;if(k&&i.isCollapsed()&&(k=!cn(q_(i.anchor,!0))),!k){rr(n,Yd,!0);const _=qt();p4&&At(_)&&_.isCollapsed()&&($d=_,setTimeout((()=>$d=null)))}}return}}var l;if(!At(i))return;const c=r.data;Mh!==null&&Lb(!1,n,Mh),i.dirty&&Mh===null||!i.isCollapsed()||Xs(i.anchor.getNode())||a===null||i.applyDOMRange(a),Mh=null;const d=i.anchor,f=i.focus,p=d.getNode(),g=f.getNode();if(s!=="insertText"&&s!=="insertTranspose")switch(r.preventDefault(),s){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":rr(n,Qh,r);break;case"insertFromComposition":ja(null),rr(n,Qh,r);break;case"insertLineBreak":ja(null),rr(n,Jh,!1);break;case"insertParagraph":ja(null),Lm&&!u0?(Lm=!1,rr(n,Jh,!1)):rr(n,lp,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":rr(n,_b,r);break;case"deleteByComposition":(function(y,v){return y!==v||vt(y)||vt(v)||!Jd(y)||!Jd(v)})(p,g)&&rr(n,L_,r);break;case"deleteByDrag":case"deleteByCut":rr(n,L_,r);break;case"deleteContent":rr(n,Yd,!1);break;case"deleteWordBackward":rr(n,cp,!0);break;case"deleteWordForward":rr(n,cp,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":rr(n,up,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":rr(n,up,!1);break;case"formatStrikeThrough":rr(n,Va,"strikethrough");break;case"formatBold":rr(n,Va,"bold");break;case"formatItalic":rr(n,Va,"italic");break;case"formatUnderline":rr(n,Va,"underline");break;case"historyUndo":rr(n,bb,void 0);break;case"historyRedo":rr(n,Sb,void 0)}else{if(c===`
`)r.preventDefault(),rr(n,Jh,!1);else if(c===Rc)r.preventDefault(),rr(n,lp,void 0);else if(c==null&&r.dataTransfer){const y=r.dataTransfer.getData("text/plain");r.preventDefault(),i.insertRawText(y)}else c!=null&&xj(i,a,c,r.timeStamp,!0)?(r.preventDefault(),rr(n,Qh,c)):Mh=c;mj=r.timeStamp}}))})(e,t)]);let Om=0,gj=null,mj=0,Mh=null;const n1=new WeakMap;let W_=!1,z_=!1,Lm=!1,vm=!1,Cw=!1,Tw="",$d=null,pj=[0,"",0,"root",0];function xj(e,t,r,n,s){const a=e.anchor,i=e.focus,l=a.getNode(),c=rs(),d=tl(Co(c)),f=d!==null?d.anchorNode:null,p=a.key,g=c.getElementByKey(p),y=r.length;return p!==i.key||!Xt(l)||(!s&&(!Ky||mj<n+50)||l.isDirty()&&y<2||$j(r))&&a.offset!==i.offset&&!l.isComposing()||bc(l)||l.isDirty()&&y>1||(s||!Ky)&&g!==null&&!l.isComposing()&&f!==f0(g)||d!==null&&t!==null&&(!t.collapsed||t.startContainer!==d.anchorNode||t.startOffset!==d.anchorOffset)||l.getFormat()!==e.format||l.getStyle()!==e.style||(function(v,w){if(w.isSegmented())return!0;if(!v.isCollapsed())return!1;const b=v.anchor.offset,E=w.getParentOrThrow(),k=Jd(w);return b===0?!w.canInsertTextBefore()||!E.canInsertTextBefore()&&!w.isComposing()||k||(function(_){const T=_.getPreviousSibling();return(Xt(T)||vt(T)&&T.isInline())&&!T.canInsertTextAfter()})(w):b===w.getTextContentSize()&&(!w.canInsertTextAfter()||!E.canInsertTextAfter()&&!w.isComposing()||k)})(e,l)}function j4(e,t){return Oc(e)&&e.nodeValue!==null&&t!==0&&t!==e.nodeValue.length}function A4(e,t,r){const{anchorNode:n,anchorOffset:s,focusNode:a,focusOffset:i}=e;W_&&(W_=!1,j4(n,s)&&j4(a,i)&&!$d)||Hi(t,(()=>{if(!r)return void Pa(null);if(!Up(t,n,a))return;let l=qt();if($d&&At(l)&&l.isCollapsed()){const c=l.anchor,d=$d.anchor;(c.key===d.key&&c.offset===d.offset+1||c.offset===1&&d.getNode().is(c.getNode().getPreviousSibling()))&&(l=$d.clone(),Pa(l))}if($d=null,At(l)){const c=l.anchor,d=c.getNode();if(l.isCollapsed()){e.type==="Range"&&e.anchorNode===e.focusNode&&(l.dirty=!0);const f=Co(t).event,p=f?f.timeStamp:performance.now(),[g,y,v,w,b]=pj,E=qn(),k=t.isComposing()===!1&&E.getTextContent()==="";if(p<b+200&&c.offset===v&&c.key===w)Iy(l,g,y);else if(c.type==="text")Xt(d)||Lt(141),yj(l,d);else if(c.type==="element"&&!k){vt(d)||Lt(259);const _=c.getNode();_.isEmpty()?(function(T,j){const P=j.getTextFormat(),R=j.getTextStyle();Iy(T,P,R)})(l,_):Iy(l,0,"")}}else{const f=c.key,p=l.focus.key,g=l.getNodes(),y=g.length,v=l.isBackward(),w=v?i:s,b=v?s:i,E=v?p:f,k=v?f:p;let _=qL,T=!1;for(let j=0;j<y;j++){const P=g[j],R=P.getTextContentSize();if(Xt(P)&&R!==0&&!(j===0&&P.__key===E&&w===R||j===y-1&&P.__key===k&&b===0)&&(T=!0,_&=P.getFormat(),_===0))break}l.format=T?_:0}}rr(t,ej,void 0)}))}function Iy(e,t,r){e.format===t&&e.style===r||(e.format=t,e.style=r,e.dirty=!0)}function yj(e,t){Iy(e,t.getFormat(),t.getStyle())}function vj(e){if(!e.getTargetRanges)return null;const t=e.getTargetRanges();return t.length===0?null:t[0]}function uy(e,t){const r=e._compositionKey;if(ja(null),r!==null&&t!=null){if(t===""){const n=Ls(r),s=f0(e.getElementByKey(r));return void(s!==null&&s.nodeValue!==null&&Xt(n)&&Bb(n,s.nodeValue,null,null,!0))}if(t[t.length-1]===`
`){const n=qt();if(At(n)){const s=n.focus;return n.anchor.set(s.key,s.offset,s.type),void rr(e,r1,null)}}}Lb(!0,e,t)}function wj(e){let t=e.__lexicalEventHandles;return t===void 0&&(t=[],e.__lexicalEventHandles=t),t}const Zh=new Map;function _j(e){const t=tU(e.target);if(t===null)return;const r=Mj(t.anchorNode);if(r===null)return;z_&&(z_=!1,Hi(r,(()=>{const c=N0(),d=t.anchorNode;(Bn(d)||Oc(d))&&Pa(Nb(c,t,r,e))})));const n=Ob(r),s=n[n.length-1],a=s._key,i=Zh.get(a),l=i||s;l!==r&&A4(t,l,!1),A4(t,r,!0),r!==s?Zh.set(a,r):i&&Zh.delete(a)}function F4(e){e._lexicalHandled=!0}function P4(e){return e._lexicalHandled===!0}function SB(e){const t=e.ownerDocument,r=n1.get(t);if(r===void 0)return;const n=r-1;n>=0||Lt(164),n1.set(t,n),n===0&&t.removeEventListener("selectionchange",_j);const s=q1(e);Mb(s)?((function(i){if(i._parentEditor!==null){const l=Ob(i),c=l[l.length-1]._key;Zh.get(c)===i&&Zh.delete(c)}else Zh.delete(i._key)})(s),e.__lexicalEditor=null):s&&Lt(198);const a=wj(e);for(let i=0;i<a.length;i++)a[i]();e.__lexicalEventHandles=[]}function H_(e,t,r){Ea();const n=e.__key,s=e.getParent();if(s===null)return;const a=(function(l){const c=qt();if(!At(c)||!vt(l))return c;const{anchor:d,focus:f}=c,p=d.getNode(),g=f.getNode();return X_(p,l)&&d.set(l.__key,0,"element"),X_(g,l)&&f.set(l.__key,0,"element"),c})(e);let i=!1;if(At(a)&&t){const l=a.anchor,c=a.focus;l.key===n&&(a1(l,e,s,e.getPreviousSibling(),e.getNextSibling()),i=!0),c.key===n&&(a1(c,e,s,e.getPreviousSibling(),e.getNextSibling()),i=!0)}else Ua(a)&&t&&e.isSelected()&&e.selectPrevious();if(At(a)&&t&&!i){const l=e.getIndexWithinParent();Qd(e),s1(a,s,l,-1)}else Qd(e);r||mi(s)||s.canBeEmpty()||!s.isEmpty()||H_(s,t),t&&a&&Xs(s)&&s.isEmpty()&&s.selectEnd()}class C0{static getType(){const{ownNodeType:t}=Hb(this);return t===void 0&&Lt(64,this.name),t}static clone(t){Lt(65,this.name)}$config(){return{}}config(t,r){const n=r.extends||Object.getPrototypeOf(this.constructor);return Object.assign(r,{extends:n,type:t}),{[t]:r}}afterCloneFrom(t){this.__key===t.__key?(this.__parent=t.__parent,this.__next=t.__next,this.__prev=t.__prev,this.__state=t.__state):t.__state&&(this.__state=t.__state.getWritable(this))}constructor(t){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),KB(this,t)}getType(){return this.__type}isInline(){Lt(137,this.constructor.name)}isAttached(){let t=this.__key;for(;t!==null;){if(t==="root")return!0;const r=Ls(t);if(r===null)break;t=r.__parent}return!1}isSelected(t){const r=t||qt();if(r==null)return!1;const n=r.getNodes().some((s=>s.__key===this.__key));if(Xt(this))return n;if(At(r)&&r.anchor.type==="element"&&r.focus.type==="element"){if(r.isCollapsed())return!1;const s=this.getParent();if(cn(this)&&this.isInline()&&s){const a=r.isBackward()?r.focus:r.anchor;if(s.is(a.getNode())&&a.offset===s.getChildrenSize()&&this.is(s.getLastChild()))return!1}}return n}getKey(){return this.__key}getIndexWithinParent(){const t=this.getParent();if(t===null)return-1;let r=t.getFirstChild(),n=0;for(;r!==null;){if(this.is(r))return n;n++,r=r.getNextSibling()}return-1}getParent(){const t=this.getLatest().__parent;return t===null?null:Ls(t)}getParentOrThrow(){const t=this.getParent();return t===null&&Lt(66,this.__key),t}getTopLevelElement(){let t=this;for(;t!==null;){const r=t.getParent();if(mi(r))return vt(t)||t===this&&cn(t)||Lt(194),t;t=r}return null}getTopLevelElementOrThrow(){const t=this.getTopLevelElement();return t===null&&Lt(67,this.__key),t}getParents(){const t=[];let r=this.getParent();for(;r!==null;)t.push(r),r=r.getParent();return t}getParentKeys(){const t=[];let r=this.getParent();for(;r!==null;)t.push(r.__key),r=r.getParent();return t}getPreviousSibling(){const t=this.getLatest().__prev;return t===null?null:Ls(t)}getPreviousSiblings(){const t=[],r=this.getParent();if(r===null)return t;let n=r.getFirstChild();for(;n!==null&&!n.is(this);)t.push(n),n=n.getNextSibling();return t}getNextSibling(){const t=this.getLatest().__next;return t===null?null:Ls(t)}getNextSiblings(){const t=[];let r=this.getNextSibling();for(;r!==null;)t.push(r),r=r.getNextSibling();return t}getCommonAncestor(t){const r=vt(this)?this:this.getParent(),n=vt(t)?t:t.getParent(),s=r&&n?Oy(r,n):null;return s?s.commonAncestor:null}is(t){return t!=null&&this.__key===t.__key}isBefore(t){const r=Oy(this,t);return r!==null&&(r.type==="descendant"||(r.type==="branch"?qj(r)===-1:(r.type!=="same"&&r.type!=="ancestor"&&Lt(279),!1)))}isParentOf(t){const r=Oy(this,t);return r!==null&&r.type==="ancestor"}getNodesBetween(t){const r=this.isBefore(t),n=[],s=new Set;let a=this;for(;a!==null;){const i=a.__key;if(s.has(i)||(s.add(i),n.push(a)),a===t)break;const l=vt(a)?r?a.getFirstChild():a.getLastChild():null;if(l!==null){a=l;continue}const c=r?a.getNextSibling():a.getPreviousSibling();if(c!==null){a=c;continue}const d=a.getParentOrThrow();if(s.has(d.__key)||n.push(d),d===t)break;let f=null,p=d;do{if(p===null&&Lt(68),f=r?p.getNextSibling():p.getPreviousSibling(),p=p.getParent(),p===null)break;f!==null||s.has(p.__key)||n.push(p)}while(f===null);a=f}return r||n.reverse(),n}isDirty(){const t=rs()._dirtyLeaves;return t!==null&&t.has(this.__key)}getLatest(){const t=Ls(this.__key);return t===null&&Lt(113),t}getWritable(){Ea();const t=td(),r=rs(),n=t._nodeMap,s=this.__key,a=this.getLatest(),i=r._cloneNotNeeded,l=qt();if(l!==null&&l.setCachedNodes(null),i.has(s))return l1(a),a;const c=Wb(a);return i.add(s),l1(c),n.set(s,c),c}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(t,r){Lt(70)}updateDOM(t,r,n){Lt(71)}exportDOM(t){return{element:this.createDOM(t._config,t)}}exportJSON(){const t=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...t}}static importJSON(t){Lt(18,this.name)}updateFromJSON(t){return(function(r,n){const s=r.getWritable(),a=n.$;let i=a;for(const l of X6(s).flatKeys)l in n&&(i!==void 0&&i!==a||(i={...a}),i[l]=n[l]);return(s.__state||i)&&oB(r).updateFromJSON(i),s})(this,t)}static transform(){return null}remove(t){H_(this,!0,t)}replace(t,r){Ea();let n=qt();n!==null&&(n=n.clone()),Pw(this,t);const s=this.getLatest(),a=this.__key,i=t.__key,l=t.getWritable(),c=this.getParentOrThrow().getWritable(),d=c.__size;Qd(l);const f=s.getPreviousSibling(),p=s.getNextSibling(),g=s.__prev,y=s.__next,v=s.__parent;if(H_(s,!1,!0),f===null?c.__first=i:f.getWritable().__next=i,l.__prev=g,p===null?c.__last=i:p.getWritable().__prev=i,l.__next=y,l.__parent=v,c.__size=d,r&&(vt(this)&&vt(l)||Lt(139),this.getChildren().forEach((w=>{l.append(w)}))),At(n)){Pa(n);const w=n.anchor,b=n.focus;w.key===a&&M4(w,l),b.key===a&&M4(b,l)}return Pu()===a&&ja(i),l}insertAfter(t,r=!0){Ea(),Pw(this,t);const n=this.getWritable(),s=t.getWritable(),a=s.getParent(),i=qt();let l=!1,c=!1;if(a!==null){const y=t.getIndexWithinParent();if(Qd(s),At(i)){const v=a.__key,w=i.anchor,b=i.focus;l=w.type==="element"&&w.key===v&&w.offset===y+1,c=b.type==="element"&&b.key===v&&b.offset===y+1}}const d=this.getNextSibling(),f=this.getParentOrThrow().getWritable(),p=s.__key,g=n.__next;if(d===null?f.__last=p:d.getWritable().__prev=p,f.__size++,n.__next=p,s.__next=g,s.__prev=n.__key,s.__parent=n.__parent,r&&At(i)){const y=this.getIndexWithinParent();s1(i,f,y+1);const v=f.__key;l&&i.anchor.set(v,y+2,"element"),c&&i.focus.set(v,y+2,"element")}return t}insertBefore(t,r=!0){Ea(),Pw(this,t);const n=this.getWritable(),s=t.getWritable(),a=s.__key;Qd(s);const i=this.getPreviousSibling(),l=this.getParentOrThrow().getWritable(),c=n.__prev,d=this.getIndexWithinParent();i===null?l.__first=a:i.getWritable().__next=a,l.__size++,n.__prev=a,s.__prev=c,s.__next=n.__key,s.__parent=n.__parent;const f=qt();return r&&At(f)&&s1(f,this.getParentOrThrow(),d),t}isParentRequired(){return!1}createParentElementNode(){return Ln()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(t,r){Ea();const n=this.getPreviousSibling(),s=this.getParentOrThrow();if(n===null)return s.select(0,0);if(vt(n))return n.select();if(!Xt(n)){const a=n.getIndexWithinParent()+1;return s.select(a,a)}return n.select(t,r)}selectNext(t,r){Ea();const n=this.getNextSibling(),s=this.getParentOrThrow();if(n===null)return s.select();if(vt(n))return n.select(0,0);if(!Xt(n)){const a=n.getIndexWithinParent();return s.select(a,a)}return n.select(t,r)}markDirty(){this.getWritable()}reconcileObservedMutation(t,r){this.markDirty()}}class Ip extends C0{static getType(){return"linebreak"}static clone(t){return new Ip(t.__key)}constructor(t){super(t)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:t=>(function(r){const n=r.parentElement;if(n!==null&&c1(n)){const s=n.firstChild;if(s===r||s.nextSibling===r&&dy(s)){const a=n.lastChild;if(a===r||a.previousSibling===r&&dy(a))return!0}}return!1})(t)||(function(r){const n=r.parentElement;if(n!==null&&c1(n)){const s=n.firstChild;if(s===r||s.nextSibling===r&&dy(s))return!1;const a=n.lastChild;if(a===r||a.previousSibling===r&&dy(a))return!0}return!1})(t)?null:{conversion:kB,priority:0}}}static importJSON(t){return Ul().updateFromJSON(t)}}function kB(e){return{node:Ul()}}function Ul(){return xi(new Ip)}function Nc(e){return e instanceof Ip}function dy(e){return Oc(e)&&/^( |\t|\r?\n)+$/.test(e.textContent||"")}function Nw(e,t){return 16&t?"code":t&fb?"mark":32&t?"sub":64&t?"sup":null}function Ew(e,t){return 1&t?"strong":2&t?"em":"span"}function bj(e,t,r,n,s){const a=n.classList;let i=e0(s,"base");i!==void 0&&a.add(...i),i=e0(s,"underlineStrikethrough");let l=!1;const c=t&Yy&&t&Xy;i!==void 0&&(r&Yy&&r&Xy?(l=!0,c||a.add(...i)):c&&a.remove(...i));for(const d in lf){const f=lf[d];if(i=e0(s,d),i!==void 0)if(r&f){if(l&&(d==="underline"||d==="strikethrough")){t&f&&a.remove(...i);continue}t&f&&(!c||d!=="underline")&&d!=="strikethrough"||a.add(...i)}else t&f&&a.remove(...i)}}function Sj(e,t,r){const n=t.firstChild,s=r.isComposing(),a=e+(s?B1:"");if(n==null)t.textContent=a;else{const i=n.nodeValue;if(i!==a)if(s||af){const[l,c,d]=(function(f,p){const g=f.length,y=p.length;let v=0,w=0;for(;v<g&&v<y&&f[v]===p[v];)v++;for(;w+v<g&&w+v<y&&f[g-w-1]===p[y-w-1];)w++;return[v,g-v-w,p.slice(v,y-w)]})(i,a);c!==0&&n.deleteData(l,c),n.insertData(l,d)}else n.nodeValue=a}}function R4(e,t,r,n,s,a){Sj(s,e,t);const i=a.theme.text;i!==void 0&&bj(0,0,n,e,i)}function fy(e,t){const r=document.createElement(t);return r.appendChild(e),r}class ed extends C0{static getType(){return"text"}static clone(t){return new ed(t.__text,t.__key)}afterCloneFrom(t){super.afterCloneFrom(t),this.__text=t.__text,this.__format=t.__format,this.__style=t.__style,this.__mode=t.__mode,this.__detail=t.__detail}constructor(t="",r){super(r),this.__text=t,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const t=this.getLatest();return ZL[t.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===Pu()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(t){const r=lf[t];return!!(this.getFormat()&r)}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(t,r){return o1(this.getLatest().__format,t,r)}canHaveFormat(){return!0}isInline(){return!0}createDOM(t,r){const n=this.__format,s=Nw(0,n),a=Ew(0,n),i=s===null?a:s,l=document.createElement(i);let c=l;this.hasFormat("code")&&l.setAttribute("spellcheck","false"),s!==null&&(c=document.createElement(a),l.appendChild(c)),R4(c,this,0,n,this.__text,t);const d=this.__style;return d!==""&&(l.style.cssText=d),l}updateDOM(t,r,n){const s=this.__text,a=t.__format,i=this.__format,l=Nw(0,a),c=Nw(0,i),d=Ew(0,a),f=Ew(0,i);if((l===null?d:l)!==(c===null?f:c))return!0;if(l===c&&d!==f){const w=r.firstChild;w==null&&Lt(48);const b=document.createElement(f);return R4(b,this,0,i,s,n),r.replaceChild(b,w),!1}let p=r;c!==null&&l!==null&&(p=r.firstChild,p==null&&Lt(49)),Sj(s,p,this);const g=n.theme.text;g!==void 0&&a!==i&&bj(0,a,i,p,g);const y=t.__style,v=this.__style;return y!==v&&(r.style.cssText=v),!1}static importDOM(){return{"#text":()=>({conversion:EB,priority:0}),b:()=>({conversion:TB,priority:0}),code:()=>({conversion:wc,priority:0}),em:()=>({conversion:wc,priority:0}),i:()=>({conversion:wc,priority:0}),mark:()=>({conversion:wc,priority:0}),s:()=>({conversion:wc,priority:0}),span:()=>({conversion:CB,priority:0}),strong:()=>({conversion:wc,priority:0}),sub:()=>({conversion:wc,priority:0}),sup:()=>({conversion:wc,priority:0}),u:()=>({conversion:wc,priority:0})}}static importJSON(t){return cs().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setTextContent(t.text).setFormat(t.format).setDetail(t.detail).setMode(t.mode).setStyle(t.style)}exportDOM(t){let{element:r}=super.exportDOM(t);return Bn(r)||Lt(132),r.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?r.style.textTransform="lowercase":this.hasFormat("uppercase")?r.style.textTransform="uppercase":this.hasFormat("capitalize")&&(r.style.textTransform="capitalize"),this.hasFormat("bold")&&(r=fy(r,"b")),this.hasFormat("italic")&&(r=fy(r,"i")),this.hasFormat("strikethrough")&&(r=fy(r,"s")),this.hasFormat("underline")&&(r=fy(r,"u")),{element:r}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(t,r){}setFormat(t){const r=this.getWritable();return r.__format=typeof t=="string"?lf[t]:t,r}setDetail(t){const r=this.getWritable();return r.__detail=typeof t=="string"?YL[t]:t,r}setStyle(t){const r=this.getWritable();return r.__style=t,r}toggleFormat(t){const r=o1(this.getFormat(),t,null);return this.setFormat(r)}toggleDirectionless(){const t=this.getWritable();return t.__detail^=1,t}toggleUnmergeable(){const t=this.getWritable();return t.__detail^=2,t}setMode(t){const r=QL[t];if(this.__mode===r)return this;const n=this.getWritable();return n.__mode=r,n}setTextContent(t){if(this.__text===t)return this;const r=this.getWritable();return r.__text=t,r}select(t,r){Ea();let n=t,s=r;const a=qt(),i=this.getTextContent(),l=this.__key;if(typeof i=="string"){const c=i.length;n===void 0&&(n=c),s===void 0&&(s=c)}else n=0,s=0;if(!At(a))return Tj(l,n,l,s,"text","text");{const c=Pu();c!==a.anchor.key&&c!==a.focus.key||ja(l),a.setTextNodeRange(this,n,this,s)}return a}selectStart(){return this.select(0,0)}selectEnd(){const t=this.getTextContentSize();return this.select(t,t)}spliceText(t,r,n,s){const a=this.getWritable(),i=a.__text,l=n.length;let c=t;c<0&&(c=l+c,c<0&&(c=0));const d=qt();if(s&&At(d)){const p=t+l;d.setTextNodeRange(a,p,a,p)}const f=i.slice(0,c)+n+i.slice(c+r);return a.__text=f,a}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...t){Ea();const r=this.getLatest(),n=r.getTextContent();if(n==="")return[];const s=r.__key,a=Pu(),i=n.length;t.sort(((N,A)=>N-A)),t.push(i);const l=[],c=t.length;for(let N=0,A=0;N<i&&A<=c;A++){const M=t[A];M>N&&(l.push(n.slice(N,M)),N=M)}const d=l.length;if(d===1)return[r];const f=l[0],p=r.getParent();let g;const y=r.getFormat(),v=r.getStyle(),w=r.__detail;let b=!1,E=null,k=null;const _=qt();if(At(_)){const[N,A]=_.isBackward()?[_.focus,_.anchor]:[_.anchor,_.focus];N.type==="text"&&N.key===s&&(E=N),A.type==="text"&&A.key===s&&(k=A)}r.isSegmented()?(g=cs(f),g.__format=y,g.__style=v,g.__detail=w,g.__state=b4(r,g),b=!0):g=r.setTextContent(f);const T=[g];for(let N=1;N<d;N++){const A=cs(l[N]);A.__format=y,A.__style=v,A.__detail=w,A.__state=b4(r,A);const M=A.__key;a===s&&ja(M),T.push(A)}const j=E?E.offset:null,P=k?k.offset:null;let R=0;for(const N of T){if(!E&&!k)break;const A=R+N.getTextContentSize();if(E!==null&&j!==null&&j<=A&&j>=R&&(E.set(N.getKey(),j-R,"text"),j<A&&(E=null)),k!==null&&P!==null&&P<=A&&P>=R){k.set(N.getKey(),P-R,"text");break}R=A}if(p!==null){(function(M){const H=M.getPreviousSibling(),Q=M.getNextSibling();H!==null&&l1(H),Q!==null&&l1(Q)})(this);const N=p.getWritable(),A=this.getIndexWithinParent();b?(N.splice(A,0,T),this.remove()):N.splice(A,1,T),At(_)&&s1(_,p,A,d-1)}return T}mergeWithSibling(t){const r=t===this.getPreviousSibling();r||t===this.getNextSibling()||Lt(50);const n=this.__key,s=t.__key,a=this.__text,i=a.length;Pu()===s&&ja(n);const l=qt();if(At(l)){const p=l.anchor,g=l.focus;p!==null&&p.key===s&&z4(p,r,n,t,i),g!==null&&g.key===s&&z4(g,r,n,t,i)}const c=t.__text,d=r?c+a:a+c;this.setTextContent(d);const f=this.getWritable();return t.remove(),f}isTextEntity(){return!1}}function CB(e){return{forChild:Cb(e.style),node:null}}function TB(e){const t=e,r=t.style.fontWeight==="normal";return{forChild:Cb(t.style,r?void 0:"bold"),node:null}}const D4=new WeakMap;function NB(e){if(!Bn(e))return!1;if(e.nodeName==="PRE")return!0;const t=e.style.whiteSpace;return typeof t=="string"&&t.startsWith("pre")}function EB(e){const t=e;e.parentElement===null&&Lt(129);let r=t.textContent||"";if((function(n){let s,a=n.parentNode;const i=[n];for(;a!==null&&(s=D4.get(a))===void 0&&!NB(a);)i.push(a),a=a.parentNode;const l=s===void 0?a:s;for(let c=0;c<i.length;c++)D4.set(i[c],l);return l})(t)!==null){const n=r.split(/(\r?\n|\t)/),s=[],a=n.length;for(let i=0;i<a;i++){const l=n[i];l===`
`||l===`\r
`?s.push(Ul()):l==="	"?s.push(T0()):l!==""&&s.push(cs(l))}return{node:s}}if(r=r.replace(/\r/g,"").replace(/[ \t\n]+/g," "),r==="")return{node:null};if(r[0]===" "){let n=t,s=!0;for(;n!==null&&(n=I4(n,!1))!==null;){const a=n.textContent||"";if(a.length>0){/[ \t\n]$/.test(a)&&(r=r.slice(1)),s=!1;break}}s&&(r=r.slice(1))}if(r[r.length-1]===" "){let n=t,s=!0;for(;n!==null&&(n=I4(n,!0))!==null;)if((n.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){s=!1;break}s&&(r=r.slice(0,r.length-1))}return r===""?{node:null}:{node:cs(r)}}function I4(e,t){let r=e;for(;;){let n;for(;(n=t?r.nextSibling:r.previousSibling)===null;){const a=r.parentElement;if(a===null)return null;r=a}if(r=n,Bn(r)){const a=r.style.display;if(a===""&&!Q_(r)||a!==""&&!a.startsWith("inline"))return null}let s=r;for(;(s=t?r.firstChild:r.lastChild)!==null;)r=s;if(Oc(r))return r;if(r.nodeName==="BR")return null}}const jB={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function wc(e){const t=jB[e.nodeName.toLowerCase()];return t===void 0?{node:null}:{forChild:Cb(e.style,t),node:null}}function cs(e=""){return xi(new ed(e))}function Xt(e){return e instanceof ed}function Cb(e,t){const r=e.fontWeight,n=e.textDecoration.split(" "),s=r==="700"||r==="bold",a=n.includes("line-through"),i=e.fontStyle==="italic",l=n.includes("underline"),c=e.verticalAlign;return d=>(Xt(d)&&(s&&!d.hasFormat("bold")&&d.toggleFormat("bold"),a&&!d.hasFormat("strikethrough")&&d.toggleFormat("strikethrough"),i&&!d.hasFormat("italic")&&d.toggleFormat("italic"),l&&!d.hasFormat("underline")&&d.toggleFormat("underline"),c!=="sub"||d.hasFormat("subscript")||d.toggleFormat("subscript"),c!=="super"||d.hasFormat("superscript")||d.toggleFormat("superscript"),t&&!d.hasFormat(t)&&d.toggleFormat(t)),d)}class Mp extends ed{static getType(){return"tab"}static clone(t){return new Mp(t.__key)}constructor(t){super("	",t),this.__detail=2}static importDOM(){return null}createDOM(t){const r=super.createDOM(t),n=e0(t.theme,"tab");return n!==void 0&&r.classList.add(...n),r}static importJSON(t){return T0().updateFromJSON(t)}setTextContent(t){return t!=="	"&&t!==""&&Lt(126),super.setTextContent("	")}spliceText(t,r,n,s){return n===""&&r===0||n==="	"&&r===1||Lt(286),this}setDetail(t){return t!==2&&Lt(127),this}setMode(t){return t!=="normal"&&Lt(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}}function T0(){return xi(new Mp)}function W1(e){return e instanceof Mp}class AB{constructor(t,r,n){this._selection=null,this.key=t,this.offset=r,this.type=n}is(t){return this.key===t.key&&this.offset===t.offset&&this.type===t.type}isBefore(t){return this.key===t.key?this.offset<t.offset:Kj(bo(Dc(this,"next")),bo(Dc(t,"next")))<0}getNode(){const t=Ls(this.key);return t===null&&Lt(20),t}set(t,r,n,s){const a=this._selection,i=this.key;s&&this.key===t&&this.offset===r&&this.type===n||(this.key=t,this.offset=r,this.type=n,Op()||(Pu()===i&&ja(t),a!==null&&(a.setCachedNodes(null),a.dirty=!0)))}}function $l(e,t,r){return new AB(e,t,r)}function jw(e,t){let r=t.__key,n=e.offset,s="element";if(Xt(t)){s="text";const a=t.getTextContentSize();n>a&&(n=a)}else if(!vt(t)){const a=t.getNextSibling();if(Xt(a))r=a.__key,n=0,s="text";else{const i=t.getParent();i&&(r=i.__key,n=t.getIndexWithinParent()+1)}}e.set(r,n,s)}function M4(e,t){if(vt(t)){const r=t.getLastDescendant();vt(r)||Xt(r)?jw(e,r):jw(e,t)}else jw(e,t)}class z1{constructor(t){this._cachedNodes=null,this._nodes=t,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(t){this._cachedNodes=t}is(t){if(!Ua(t))return!1;const r=this._nodes,n=t._nodes;return r.size===n.size&&Array.from(r).every((s=>n.has(s)))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(t){this.dirty=!0,this._nodes.add(t),this._cachedNodes=null}delete(t){this.dirty=!0,this._nodes.delete(t),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(t){return this._nodes.has(t)}clone(){return new z1(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(t){}insertText(){}insertNodes(t){const r=this.getNodes(),n=r.length,s=r[n-1];let a;if(Xt(s))a=s.select();else{const i=s.getIndexWithinParent()+1;a=s.getParentOrThrow().select(i,i)}a.insertNodes(t);for(let i=0;i<n;i++)r[i].remove()}getNodes(){const t=this._cachedNodes;if(t!==null)return t;const r=this._nodes,n=[];for(const s of r){const a=Ls(s);a!==null&&n.push(a)}return Op()||(this._cachedNodes=n),n}getTextContent(){const t=this.getNodes();let r="";for(let n=0;n<t.length;n++)r+=t[n].getTextContent();return r}deleteNodes(){const t=this.getNodes();if((qt()||N0())===this&&t[0]){const r=Fa(t[0],"next");gU(Gu(r,r))}for(const r of t)r.remove()}}function At(e){return e instanceof kf}class kf{constructor(t,r,n,s){this.anchor=t,this.focus=r,t._selection=this,r._selection=this,this._cachedNodes=null,this.format=n,this.style=s,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(t){this._cachedNodes=t}is(t){return!!At(t)&&this.anchor.is(t.anchor)&&this.focus.is(t.focus)&&this.format===t.format&&this.style===t.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const t=this._cachedNodes;if(t!==null)return t;const r=(function(n){const s=[],[a,i]=n.getTextSlices();a&&s.push(a.caret.origin);const l=new Set,c=new Set;for(const d of n)if(Bl(d)){const{origin:f}=d;s.length===0?l.add(f):(c.add(f),s.push(f))}else{const{origin:f}=d;vt(f)&&c.has(f)||s.push(f)}if(i&&s.push(i.caret.origin),gf(n.focus)&&vt(n.focus.origin)&&n.focus.getNodeAtCaret()===null)for(let d=To(n.focus.origin,"previous");Bl(d)&&l.has(d.origin)&&!d.origin.isEmpty()&&d.origin.is(s[s.length-1]);d=Kb(d))l.delete(d.origin),s.pop();for(;s.length>1;){const d=s[s.length-1];if(!vt(d)||c.has(d)||d.isEmpty()||l.has(d))break;s.pop()}if(s.length===0&&n.isCollapsed()){const d=bo(n.anchor),f=bo(n.anchor.getFlipped()),p=y=>Lu(y)?y.origin:y.getNodeAtCaret(),g=p(d)||p(f)||(n.anchor.getNodeAtCaret()?d.origin:f.origin);s.push(g)}return s})(Yj(cN(this),"next"));return Op()||(this._cachedNodes=r),r}setTextNodeRange(t,r,n,s){this.anchor.set(t.__key,r,"text"),this.focus.set(n.__key,s,"text")}getTextContent(){const t=this.getNodes();if(t.length===0)return"";const r=t[0],n=t[t.length-1],s=this.anchor,a=this.focus,i=s.isBefore(a),[l,c]=G_(this);let d="",f=!0;for(let p=0;p<t.length;p++){const g=t[p];if(vt(g)&&!g.isInline())f||(d+=`
`),f=!g.isEmpty();else if(f=!1,Xt(g)){let y=g.getTextContent();g===r?g===n?s.type==="element"&&a.type==="element"&&a.offset!==s.offset||(y=l<c?y.slice(l,c):y.slice(c,l)):y=i?y.slice(l):y.slice(c):g===n&&(y=i?y.slice(0,c):y.slice(0,l)),d+=y}else!cn(g)&&!Nc(g)||g===n&&this.isCollapsed()||(d+=g.getTextContent())}return d}applyDOMRange(t){const r=rs(),n=r.getEditorState()._selection,s=Cj(t.startContainer,t.startOffset,t.endContainer,t.endOffset,r,n);if(s===null)return;const[a,i]=s;this.anchor.set(a.key,a.offset,a.type,!0),this.focus.set(i.key,i.offset,i.type,!0),Jy(this)}clone(){const t=this.anchor,r=this.focus;return new kf($l(t.key,t.offset,t.type),$l(r.key,r.offset,r.type),this.format,this.style)}toggleFormat(t){this.format=o1(this.format,t,null),this.dirty=!0}setFormat(t){this.format=t,this.dirty=!0}setStyle(t){this.style=t,this.dirty=!0}hasFormat(t){const r=lf[t];return!!(this.format&r)}insertRawText(t){const r=t.split(/(\r?\n|\t)/),n=[],s=r.length;for(let a=0;a<s;a++){const i=r[a];i===`
`||i===`\r
`?n.push(Ul()):i==="	"?n.push(T0()):n.push(cs(i))}this.insertNodes(n)}insertText(t){const r=this.anchor,n=this.focus,s=this.format,a=this.style;let i=r,l=n;!this.isCollapsed()&&n.isBefore(r)&&(i=n,l=r),i.type==="element"&&(function(b,E,k,_){const T=b.getNode(),j=T.getChildAtIndex(b.offset),P=cs();if(P.setFormat(k),P.setStyle(_),Pb(j))j.splice(0,0,[P]);else{const R=Xs(T)?Ln().append(P):P;j===null?T.append(R):j.insertBefore(R)}b.is(E)&&E.set(P.__key,0,"text"),b.set(P.__key,0,"text")})(i,l,s,a),l.type==="element"&&pf(l,bo(Dc(l,"next")));const c=i.offset;let d=l.offset;const f=this.getNodes(),p=f.length;let g=f[0];Xt(g)||Lt(26);const y=g.getTextContent().length,v=g.getParentOrThrow();let w=f[p-1];if(p===1&&l.type==="element"&&(d=y,l.set(i.key,d,"text")),this.isCollapsed()&&c===y&&(bc(g)||!g.canInsertTextAfter()||!v.canInsertTextAfter()&&g.getNextSibling()===null)){let b=g.getNextSibling();if(Xt(b)&&b.canInsertTextBefore()&&!bc(b)||(b=cs(),b.setFormat(s),b.setStyle(a),v.canInsertTextAfter()?g.insertAfter(b):v.insertAfter(b)),b.select(0,0),g=b,t!=="")return void this.insertText(t)}else if(this.isCollapsed()&&c===0&&(bc(g)||!g.canInsertTextBefore()||!v.canInsertTextBefore()&&g.getPreviousSibling()===null)){let b=g.getPreviousSibling();if(Xt(b)&&!bc(b)||(b=cs(),b.setFormat(s),v.canInsertTextBefore()?g.insertBefore(b):v.insertBefore(b)),b.select(),g=b,t!=="")return void this.insertText(t)}else if(g.isSegmented()&&c!==y){const b=cs(g.getTextContent());b.setFormat(s),g.replace(b),g=b}else if(!this.isCollapsed()&&t!==""){const b=w.getParent();if(!v.canInsertTextBefore()||!v.canInsertTextAfter()||vt(b)&&(!b.canInsertTextBefore()||!b.canInsertTextAfter()))return this.insertText(""),kj(this.anchor,this.focus,null),void this.insertText(t)}if(p===1){if(Jd(g)){const _=cs(t);return _.select(),void g.replace(_)}const b=g.getFormat(),E=g.getStyle();if(c!==d||b===s&&E===a){if(W1(g)){const _=cs(t);return _.setFormat(s),_.setStyle(a),_.select(),void g.replace(_)}}else{if(g.getTextContent()!==""){const _=cs(t);if(_.setFormat(s),_.setStyle(a),_.select(),c===0)g.insertBefore(_,!1);else{const[T]=g.splitText(c);T.insertAfter(_,!1)}return void(_.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=t.length))}g.setFormat(s),g.setStyle(a)}const k=d-c;g=g.spliceText(c,k,t,!0),g.getTextContent()===""?g.remove():this.anchor.type==="text"&&(g.isComposing()?this.anchor.offset-=t.length:(this.format=b,this.style=E))}else{const b=new Set([...g.getParentKeys(),...w.getParentKeys()]),E=vt(g)?g:g.getParentOrThrow();let k=vt(w)?w:w.getParentOrThrow(),_=w;if(!E.is(k)&&k.isInline())do _=k,k=k.getParentOrThrow();while(k.isInline());if(l.type==="text"&&(d!==0||w.getTextContent()==="")||l.type==="element"&&w.getIndexWithinParent()<d)if(Xt(w)&&!Jd(w)&&d!==w.getTextContentSize()){if(w.isSegmented()){const N=cs(w.getTextContent());w.replace(N),w=N}Xs(l.getNode())||l.type!=="text"||(w=w.spliceText(0,d,"")),b.add(w.__key)}else{const N=w.getParentOrThrow();N.canBeEmpty()||N.getChildrenSize()!==1?w.remove():N.remove()}else b.add(w.__key);const T=k.getChildren(),j=new Set(f),P=E.is(k),R=E.isInline()&&g.getNextSibling()===null?E:g;for(let N=T.length-1;N>=0;N--){const A=T[N];if(A.is(g)||vt(A)&&A.isParentOf(g))break;A.isAttached()&&(!j.has(A)||A.is(_)?P||R.insertAfter(A,!1):A.remove())}if(!P){let N=k,A=null;for(;N!==null;){const M=N.getChildren(),H=M.length;(H===0||M[H-1].is(A))&&(b.delete(N.__key),A=N),N=N.getParent()}}if(Jd(g))if(c===y)g.select();else{const N=cs(t);N.select(),g.replace(N)}else g=g.spliceText(c,y-c,t,!0),g.getTextContent()===""?g.remove():g.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=t.length);for(let N=1;N<p;N++){const A=f[N],M=A.__key;b.has(M)||A.remove()}}}removeText(){const t=qt()===this;Ly(this,mU(cN(this))),t&&qt()!==this&&Pa(this)}formatText(t,r=null){if(this.isCollapsed())return this.toggleFormat(t),void ja(null);const n=this.getNodes(),s=[];for(const T of n)Xt(T)&&s.push(T);const a=T=>{n.forEach((j=>{if(vt(j)){const P=j.getFormatFlags(t,T);j.setTextFormat(P)}}))},i=s.length;if(i===0)return this.toggleFormat(t),ja(null),void a(r);const l=this.anchor,c=this.focus,d=this.isBackward(),f=d?c:l,p=d?l:c;let g=0,y=s[0],v=f.type==="element"?0:f.offset;if(f.type==="text"&&v===y.getTextContentSize()&&(g=1,y=s[1],v=0),y==null)return;const w=y.getFormatFlags(t,r);a(w);const b=i-1;let E=s[b];const k=p.type==="text"?p.offset:E.getTextContentSize();if(y.is(E)){if(v===k)return;if(bc(y)||v===0&&k===y.getTextContentSize())y.setFormat(w);else{const T=y.splitText(v,k),j=v===0?T[0]:T[1];j.setFormat(w),f.type==="text"&&f.set(j.__key,0,"text"),p.type==="text"&&p.set(j.__key,k-v,"text")}return void(this.format=w)}v===0||bc(y)||([,y]=y.splitText(v),v=0),y.setFormat(w);const _=E.getFormatFlags(t,w);k>0&&(k===E.getTextContentSize()||bc(E)||([E]=E.splitText(k)),E.setFormat(_));for(let T=g+1;T<b;T++){const j=s[T],P=j.getFormatFlags(t,_);j.setFormat(P)}f.type==="text"&&f.set(y.__key,v,"text"),p.type==="text"&&p.set(E.__key,k,"text"),this.format=w|_}insertNodes(t){if(t.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const v=qt();return At(v)||Lt(134),v.insertNodes(t)}const r=(this.isBackward()?this.focus:this.anchor).getNode(),n=Dw(r,_o),s=t[t.length-1];if(vt(n)&&"__language"in n){if("__language"in t[0])this.insertText(t[0].getTextContent());else{const v=Aw(this);n.splice(v,0,t),s.selectEnd()}return}if(!t.some((v=>(vt(v)||cn(v))&&!v.isInline()))){vt(n)||Lt(211,r.constructor.name,r.getType());const v=Aw(this);return n.splice(v,0,t),void s.selectEnd()}const a=(function(v){const w=Ln();let b=null;for(let E=0;E<v.length;E++){const k=v[E],_=Nc(k);if(_||cn(k)&&k.isInline()||vt(k)&&k.isInline()||Xt(k)||k.isParentRequired()){if(b===null&&(b=k.createParentElementNode(),w.append(b),_))continue;b!==null&&b.append(k)}else w.append(k),b=null}return w})(t),i=a.getLastDescendant(),l=a.getChildren(),c=!vt(n)||!n.isEmpty()?this.insertParagraph():null,d=l[l.length-1];let f=l[0];var p;vt(p=f)&&_o(p)&&!p.isEmpty()&&vt(n)&&(!n.isEmpty()||n.canMergeWhenEmpty())&&(vt(n)||Lt(211,r.constructor.name,r.getType()),n.append(...f.getChildren()),f=l[1]),f&&(n===null&&Lt(212,r.constructor.name,r.getType()),(function(v,w,b){const E=w.getParentOrThrow().getLastChild();let k=w;const _=[w];for(;k!==E;)k.getNextSibling()||Lt(140),k=k.getNextSibling(),_.push(k);let T=v;for(const j of _)T=T.insertAfter(j)})(n,f));const g=Dw(i,_o);c&&vt(g)&&(c.canMergeWhenEmpty()||_o(d))&&(g.append(...c.getChildren()),c.remove()),vt(n)&&n.isEmpty()&&n.remove(),i.selectEnd();const y=vt(n)?n.getLastChild():null;Nc(y)&&g!==n&&y.remove()}insertParagraph(){if(this.anchor.key==="root"){const i=Ln();return qn().splice(this.anchor.offset,0,[i]),i.select(),i}const t=Aw(this),r=Dw(this.anchor.getNode(),_o);vt(r)||Lt(213);const n=r.getChildAtIndex(t),s=n?[n,...n.getNextSiblings()]:[],a=r.insertNewAfter(this,!1);return a?(a.append(...s),a.selectStart(),a):null}insertLineBreak(t){const r=Ul();if(this.insertNodes([r]),t){const n=r.getParentOrThrow(),s=r.getIndexWithinParent();n.select(s,s)}}extract(){const t=this.getNodes(),r=t.length,n=r-1,s=this.anchor,a=this.focus;let i=t[0],l=t[n];const[c,d]=G_(this);if(r===0)return[];if(r===1){if(Xt(i)&&!this.isCollapsed()){const p=c>d?d:c,g=c>d?c:d,y=i.splitText(p,g),v=p===0?y[0]:y[1];return v!=null?[v]:[]}return[i]}const f=s.isBefore(a);if(Xt(i)){const p=f?c:d;p===i.getTextContentSize()?t.shift():p!==0&&([,i]=i.splitText(p),t[0]=i)}if(Xt(l)){const p=l.getTextContent().length,g=f?d:c;g===0?t.pop():g!==p&&([l]=l.splitText(g),t[n]=l)}return t}modify(t,r,n){if(H4(this,t,r,n))return;const s=t==="move",a=rs(),i=tl(Co(a));if(!i)return;const l=a._blockCursorElement,c=a._rootElement,d=this.focus.getNode();if(c===null||l===null||!vt(d)||d.isInline()||d.canBeEmpty()||Y_(l,a,c),this.dirty){let f=df(a,this.anchor.key),p=df(a,this.focus.key);this.anchor.type==="text"&&(f=f0(f)),this.focus.type==="text"&&(p=f0(p)),f&&p&&Nj(i,f,this.anchor.offset,p,this.focus.offset)}if((function(f,p,g,y){f.modify(p,g,y)})(i,t,r?"backward":"forward",n),i.rangeCount>0){const f=i.getRangeAt(0),p=this.anchor.getNode(),g=Xs(p)?p:ZB(p);if(this.applyDOMRange(f),this.dirty=!0,!s){const y=this.getNodes(),v=[];let w=!1;for(let b=0;b<y.length;b++){const E=y[b];X_(E,g)?v.push(E):w=!0}if(w&&v.length>0)if(r){const b=v[0];vt(b)?b.selectStart():b.getParentOrThrow().selectStart()}else{const b=v[v.length-1];vt(b)?b.selectEnd():b.getParentOrThrow().selectEnd()}i.anchorNode===f.startContainer&&i.anchorOffset===f.startOffset||(function(b){const E=b.focus,k=b.anchor,_=k.key,T=k.offset,j=k.type;k.set(E.key,E.offset,E.type,!0),E.set(_,T,j,!0)})(this)}}n==="lineboundary"&&H4(this,t,r,n,"decorators")}forwardDeletion(t,r,n){if(!n&&(t.type==="element"&&vt(r)&&t.offset===r.getChildrenSize()||t.type==="text"&&t.offset===r.getTextContentSize())){const s=r.getParent(),a=r.getNextSibling()||(s===null?null:s.getNextSibling());if(vt(a)&&a.isShadowRoot())return!0}return!1}deleteCharacter(t){const r=this.isCollapsed();if(this.isCollapsed()){const n=this.anchor;let s=n.getNode();if(this.forwardDeletion(n,s,t))return;const a=Xb(Dc(n,t?"previous":"next"));if(a.getTextSlices().every((l=>l===null||l.distance===0))){let l={type:"initial"};for(const c of a.iterNodeCarets("shadowRoot"))if(Bl(c)){if(!c.origin.isInline()){if(c.origin.isShadowRoot()){if(l.type==="merge-block")break;if(vt(a.anchor.origin)&&a.anchor.origin.isEmpty()){const d=bo(c);Ly(this,Gu(d,d)),a.anchor.origin.remove()}return}l.type!=="merge-next-block"&&l.type!=="merge-block"||(l={block:l.block,caret:c,type:"merge-block"})}}else{if(l.type==="merge-block")break;if(gf(c)){if(vt(c.origin)){if(c.origin.isInline()){if(!c.origin.isParentOf(a.anchor.origin))break}else l={block:c.origin,type:"merge-next-block"};continue}if(cn(c.origin)){if(!c.origin.isIsolated())if(l.type==="merge-next-block"&&(c.origin.isKeyboardSelectable()||!c.origin.isInline())&&vt(a.anchor.origin)&&a.anchor.origin.isEmpty()){a.anchor.origin.remove();const d=Tb();d.add(c.origin.getKey()),Pa(d)}else c.origin.remove();return}break}}if(l.type==="merge-block"){const{caret:c,block:d}=l;return Ly(this,Gu(!c.origin.isEmpty()&&d.isEmpty()?Jb(Fa(d,c.direction)):a.anchor,c)),this.removeText()}}const i=this.focus;if(this.modify("extend",t,"character"),this.isCollapsed()){if(t&&n.offset===0&&L4(this,n.getNode()))return}else{const l=i.type==="text"?i.getNode():null;if(s=n.type==="text"?n.getNode():null,l!==null&&l.isSegmented()){const c=i.offset,d=l.getTextContentSize();if(l.is(s)||t&&c!==d||!t&&c!==0)return void B4(l,t,c)}else if(s!==null&&s.isSegmented()){const c=n.offset,d=s.getTextContentSize();if(s.is(l)||t&&c!==0||!t&&c!==d)return void B4(s,t,c)}(function(c,d){const f=c.anchor,p=c.focus,g=f.getNode(),y=p.getNode();if(g===y&&f.type==="text"&&p.type==="text"){const v=f.offset,w=p.offset,b=v<w,E=b?v:w,k=b?w:v,_=k-1;E!==_&&(function(T){return!($j(T)||FB(T))})(g.getTextContent().slice(E,k))&&(d?p.set(p.key,_,p.type):f.set(f.key,_,f.type))}})(this,t)}}if(this.removeText(),t&&!r&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const n=this.anchor.getNode();n.isEmpty()&&Xs(n.getParent())&&n.getPreviousSibling()===null&&L4(this,n)}}deleteLine(t){this.isCollapsed()&&this.modify("extend",t,"lineboundary"),this.isCollapsed()?this.deleteCharacter(t):this.removeText()}deleteWord(t){if(this.isCollapsed()){const r=this.anchor,n=r.getNode();if(this.forwardDeletion(r,n,t))return;this.modify("extend",t,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}}function Ua(e){return e instanceof z1}function O4(e){const t=e.offset;if(e.type==="text")return t;const r=e.getNode();return t===r.getChildrenSize()?r.getTextContent().length:0}function G_(e){const t=e.getStartEndPoints();if(t===null)return[0,0];const[r,n]=t;return r.type==="element"&&n.type==="element"&&r.key===n.key&&r.offset===n.offset?[0,0]:[O4(r),O4(n)]}function L4(e,t){for(let r=t;r;r=r.getParent()){if(vt(r)){if(r.collapseAtStart(e))return!0;if(mi(r))break}if(r.getPreviousSibling())break}return!1}const FB=(()=>{try{const e=new RegExp("\\p{Emoji}","u"),t=e.test.bind(e);if(t("❤️")&&t("#️⃣")&&t("👍"))return t}catch{}return()=>!1})();function B4(e,t,r){const n=e,s=n.getTextContent().split(/(?=\s)/g),a=s.length;let i=0,l=0;for(let d=0;d<a;d++){const f=d===a-1;if(l=i,i+=s[d].length,t&&i===r||i>r||f){s.splice(d,1),f&&(l=void 0);break}}const c=s.join("").trim();c===""?n.remove():(n.setTextContent(c),n.select(l,l))}function U4(e,t,r,n){let s,a=t;if(Bn(e)){let i=!1;const l=e.childNodes,c=l.length,d=n._blockCursorElement;a===c&&(i=!0,a=c-1);let f=l[a],p=!1;if(f===d)f=l[a+1],p=!0;else if(d!==null){const g=d.parentNode;e===g&&t>Array.prototype.indexOf.call(g.children,d)&&a--}if(s=Kh(f),Xt(s))a=Bu(s,i?"next":"previous");else{let g=Kh(e);if(g===null)return null;if(vt(g)){const y=n.getElementByKey(g.getKey());y===null&&Lt(214),[g,a]=g.getDOMSlot(y).resolveChildIndex(g,y,e,t),vt(g)||Lt(215),i&&a>=g.getChildrenSize()&&(a=Math.max(0,g.getChildrenSize()-1));let w=g.getChildAtIndex(a);if(vt(w)&&(function(b,E,k){const _=b.getParent();return k===null||_===null||!_.canBeEmpty()||_!==k.getNode()})(w,0,r)){const b=i?w.getLastDescendant():w.getFirstDescendant();b===null?g=w:(w=b,g=vt(w)?w:w.getParentOrThrow()),a=0}Xt(w)?(s=w,g=null,a=Bu(w,i?"next":"previous")):w!==g&&i&&!p&&(vt(g)||Lt(216),a=Math.min(g.getChildrenSize(),a+1))}else{const y=g.getIndexWithinParent();a=t===0&&cn(g)&&Kh(e)===g?y:y+1,g=g.getParentOrThrow()}if(vt(g))return $l(g.__key,a,"element")}}else s=Kh(e);return Xt(s)?$l(s.__key,Bu(s,a,"clamp"),"text"):null}function $4(e,t,r){const n=e.offset,s=e.getNode();if(n===0){const a=s.getPreviousSibling(),i=s.getParent();if(t){if((r||!t)&&a===null&&vt(i)&&i.isInline()){const l=i.getPreviousSibling();Xt(l)&&e.set(l.__key,l.getTextContent().length,"text")}}else vt(a)&&!r&&a.isInline()?e.set(a.__key,a.getChildrenSize(),"element"):Xt(a)&&e.set(a.__key,a.getTextContent().length,"text")}else if(n===s.getTextContent().length){const a=s.getNextSibling(),i=s.getParent();if(t&&vt(a)&&a.isInline())e.set(a.__key,0,"element");else if((r||t)&&a===null&&vt(i)&&i.isInline()&&!i.canInsertTextAfter()){const l=i.getNextSibling();Xt(l)&&e.set(l.__key,0,"text")}}}function kj(e,t,r){if(e.type==="text"&&t.type==="text"){const n=e.isBefore(t),s=e.is(t);$4(e,n,s),$4(t,!n,s),s&&t.set(e.key,e.offset,e.type);const a=rs();if(a.isComposing()&&a._compositionKey!==e.key&&At(r)){const i=r.anchor,l=r.focus;e.set(i.key,i.offset,i.type,!0),t.set(l.key,l.offset,l.type,!0)}}}function Cj(e,t,r,n,s,a){if(e===null||r===null||!Up(s,e,r))return null;const i=U4(e,t,At(a)?a.anchor:null,s);if(i===null)return null;const l=U4(r,n,At(a)?a.focus:null,s);if(l===null)return null;if(i.type==="element"&&l.type==="element"){const c=Kh(e),d=Kh(r);if(cn(c)&&cn(d))return null}return kj(i,l,a),[i,l]}function V_(e){return vt(e)&&!e.isInline()}function Tj(e,t,r,n,s,a){const i=td(),l=new kf($l(e,t,s),$l(r,n,a),0,"");return l.dirty=!0,i._selection=l,l}function H1(){const e=$l("root",0,"element"),t=$l("root",0,"element");return new kf(e,t,0,"")}function Tb(){return new z1(new Set)}function Nb(e,t,r,n){const s=r._window;if(s===null)return null;const a=n||s.event,i=a?a.type:void 0,l=i==="selectionchange",c=!A_&&(l||i==="beforeinput"||i==="compositionstart"||i==="compositionend"||i==="click"&&a&&a.detail===3||i==="drop"||i===void 0);let d,f,p,g;if(At(e)&&!c)return e.clone();if(t===null)return null;if(d=t.anchorNode,f=t.focusNode,p=t.anchorOffset,g=t.focusOffset,l&&At(e)&&!Up(r,d,f))return e.clone();const y=Cj(d,p,f,g,r,e);if(y===null)return null;const[v,w]=y;return new kf(v,w,At(e)?e.format:0,At(e)?e.style:"")}function qt(){return td()._selection}function N0(){return rs()._editorState._selection}function s1(e,t,r,n=1){const s=e.anchor,a=e.focus,i=s.getNode(),l=a.getNode();if(!t.is(i)&&!t.is(l))return;const c=t.__key;if(e.isCollapsed()){const d=s.offset;if(r<=d&&n>0||r<d&&n<0){const f=Math.max(0,d+n);s.set(c,f,"element"),a.set(c,f,"element"),W4(e)}}else{const d=e.isBackward(),f=d?a:s,p=f.getNode(),g=d?s:a,y=g.getNode();if(t.is(p)){const v=f.offset;(r<=v&&n>0||r<v&&n<0)&&f.set(c,Math.max(0,v+n),"element")}if(t.is(y)){const v=g.offset;(r<=v&&n>0||r<v&&n<0)&&g.set(c,Math.max(0,v+n),"element")}}W4(e)}function W4(e){const t=e.anchor,r=t.offset,n=e.focus,s=n.offset,a=t.getNode(),i=n.getNode();if(e.isCollapsed()){if(!vt(a))return;const l=a.getChildrenSize(),c=r>=l,d=c?a.getChildAtIndex(l-1):a.getChildAtIndex(r);if(Xt(d)){let f=0;c&&(f=d.getTextContentSize()),t.set(d.__key,f,"text"),n.set(d.__key,f,"text")}}else{if(vt(a)){const l=a.getChildrenSize(),c=r>=l,d=c?a.getChildAtIndex(l-1):a.getChildAtIndex(r);if(Xt(d)){let f=0;c&&(f=d.getTextContentSize()),t.set(d.__key,f,"text")}}if(vt(i)){const l=i.getChildrenSize(),c=s>=l,d=c?i.getChildAtIndex(l-1):i.getChildAtIndex(s);if(Xt(d)){let f=0;c&&(f=d.getTextContentSize()),n.set(d.__key,f,"text")}}}}function a1(e,t,r,n,s){let a=null,i=0,l=null;n!==null?(a=n.__key,Xt(n)?(i=n.getTextContentSize(),l="text"):vt(n)&&(i=n.getChildrenSize(),l="element")):s!==null&&(a=s.__key,Xt(s)?l="text":vt(s)&&(l="element")),a!==null&&l!==null?e.set(a,i,l):(i=t.getIndexWithinParent(),i===-1&&(i=r.getChildrenSize()),e.set(r.__key,i,"element"))}function z4(e,t,r,n,s){e.type==="text"?e.set(r,e.offset+(t?0:s),"text"):e.offset>n.getIndexWithinParent()&&e.set(e.key,e.offset-1,"element")}function Nj(e,t,r,n,s){try{e.setBaseAndExtent(t,r,n,s)}catch{}}function PB(e,t,r,n,s,a,i){const l=n.anchorNode,c=n.focusNode,d=n.anchorOffset,f=n.focusOffset,p=document.activeElement;if(s.has(Rj)&&p!==a||p!==null&&Ib(p))return;if(!At(t))return void(e!==null&&Up(r,l,c)&&n.removeAllRanges());const g=t.anchor,y=t.focus,v=g.key,w=y.key,b=df(r,v),E=df(r,w),k=g.offset,_=y.offset,T=t.format,j=t.style,P=t.isCollapsed();let R=b,N=E,A=!1;if(g.type==="text"){R=f0(b);const te=g.getNode();A=te.getFormat()!==T||te.getStyle()!==j}else At(e)&&e.anchor.type==="text"&&(A=!0);var M,H,Q,Z,ae;if(y.type==="text"&&(N=f0(E)),R!==null&&N!==null&&(P&&(e===null||A||At(e)&&(e.format!==T||e.style!==j))&&(M=T,H=j,Q=k,Z=v,ae=performance.now(),pj=[M,H,Q,Z,ae]),d!==k||f!==_||l!==R||c!==N||n.type==="Range"&&P||(p!==null&&a.contains(p)||a.focus({preventScroll:!0}),g.type==="element"))){if(Nj(n,R,k,N,_),!s.has(BB)&&t.isCollapsed()&&a!==null&&a===document.activeElement){const te=At(t)&&t.anchor.type==="element"?R.childNodes[k]||null:n.rangeCount>0?n.getRangeAt(0):null;if(te!==null){let se;if(te instanceof Text){const L=document.createRange();L.selectNode(te),se=L.getBoundingClientRect()}else se=te.getBoundingClientRect();(function(L,G,I){const z=Gj(I),V=$b(z);if(z===null||V===null)return;let{top:O,bottom:W}=G,q=0,Y=0,ee=I;for(;ee!==null;){const X=ee===z.body;if(X)q=0,Y=Co(L).innerHeight;else{const ge=ee.getBoundingClientRect();q=ge.top,Y=ge.bottom}let ne=0;if(O<q?ne=-(q-O):W>Y&&(ne=W-Y),ne!==0)if(X)V.scrollBy(0,ne);else{const ge=ee.scrollTop;ee.scrollTop+=ne;const _e=ee.scrollTop-ge;O-=_e,W-=_e}if(X)break;ee=$p(ee)}})(r,se,a)}}W_=!0}}function RB(e){let t=qt()||N0();t===null&&(t=qn().selectEnd()),t.insertNodes(e)}function Aw(e){let t=e;e.isCollapsed()||t.removeText();const r=qt();At(r)&&(t=r),At(t)||Lt(161);const n=t.anchor;let s=n.getNode(),a=n.offset;for(;!_o(s);){const i=s;if([s,a]=DB(s,a),i.is(s))break}return a}function DB(e,t){const r=e.getParent();if(!r){const s=Ln();return qn().append(s),s.select(),[qn(),0]}if(Xt(e)){const s=e.splitText(t);if(s.length===0)return[r,e.getIndexWithinParent()];const a=t===0?0:1;return[r,s[0].getIndexWithinParent()+a]}if(!vt(e)||t===0)return[r,e.getIndexWithinParent()];const n=e.getChildAtIndex(t);if(n){const s=new kf($l(e.__key,t,"element"),$l(e.__key,t,"element"),0,""),a=e.insertNewAfter(s);a&&a.append(n,...n.getNextSiblings())}return[r,e.getIndexWithinParent()+1]}function H4(e,t,r,n,s="decorators-and-blocks"){if(t==="move"&&n==="character"&&!e.isCollapsed()){const[f,p]=r===e.isBackward()?[e.focus,e.anchor]:[e.anchor,e.focus];return p.set(f.key,f.offset,f.type),!0}const a=Dc(e.focus,r?"previous":"next"),i=n==="lineboundary",l=t==="move";let c=a,d=s==="decorators-and-blocks";if(!Xj(c)){for(const f of c){d=!1;const{origin:p}=f;if(!cn(p)||p.isIsolated()||(c=f,!i||!p.isInline()))break}if(d)for(const f of Xb(a).iterNodeCarets(t==="extend"?"shadowRoot":"root")){if(Bl(f))f.origin.isInline()||(c=f);else{if(vt(f.origin))continue;cn(f.origin)&&!f.origin.isInline()&&(c=f)}break}}if(c===a)return!1;if(l&&!i&&cn(c.origin)&&c.origin.isKeyboardSelectable()){const f=Tb();return f.add(c.origin.getKey()),Pa(f),!0}return c=bo(c),l&&pf(e.anchor,c),pf(e.focus,c),d||!i}let ia=null,oa=null,Fi=!1,Fw=!1,My=0;const G4={characterData:!0,childList:!0,subtree:!0};function Op(){return Fi||ia!==null&&ia._readOnly}function Ea(){Fi&&Lt(13)}function Ej(){My>99&&Lt(14)}function td(){return ia===null&&Lt(195,jj()),ia}function rs(){return oa===null&&Lt(196,jj()),oa}function jj(){let e=0;const t=new Set,r=K1.version;if(typeof window<"u")for(const s of document.querySelectorAll("[contenteditable]")){const a=q1(s);if(Mb(a))e++;else if(a){let i=String(a.constructor.version||"<0.17.1");i===r&&(i+=" (separately built, likely a bundler configuration issue)"),t.add(i)}}let n=` Detected on the page: ${e} compatible editor(s) with version ${r}`;return t.size&&(n+=` and incompatible editors with versions ${Array.from(t).join(", ")}`),n}function IB(){return oa}function V4(e,t,r){const n=t.__type,s=Ij(e,n);let a=r.get(n);a===void 0&&(a=Array.from(s.transforms),r.set(n,a));const i=a.length;for(let l=0;l<i&&(a[l](t),t.isAttached());l++);}function K4(e,t){return e!==void 0&&e.__key!==t&&e.isAttached()}function Aj(e,t){if(!t)return;const r=e._updateTags;let n=t;Array.isArray(t)||(n=[t]);for(const s of n)r.add(s)}function MB(e){return Eb(e,rs()._nodes)}function Eb(e,t){const r=e.type,n=t.get(r);n===void 0&&Lt(17,r);const s=n.klass;e.type!==s.getType()&&Lt(18,s.name);const a=s.importJSON(e),i=e.children;if(vt(a)&&Array.isArray(i))for(let l=0;l<i.length;l++){const c=Eb(i[l],t);a.append(c)}return a}function q4(e,t,r){const n=ia,s=Fi,a=oa;ia=t,Fi=!0,oa=e;try{return r()}finally{ia=n,Fi=s,oa=a}}function kc(e,t){const r=e._pendingEditorState,n=e._rootElement,s=e._headless||n===null;if(r===null)return;const a=e._editorState,i=a._selection,l=r._selection,c=e._dirtyType!==of,d=ia,f=Fi,p=oa,g=e._updating,y=e._observer;let v=null;if(e._pendingEditorState=null,e._editorState=r,!s&&c&&y!==null){oa=e,ia=r,Fi=!1,e._updating=!0;try{const P=e._dirtyType,R=e._dirtyElements,N=e._dirtyLeaves;y.disconnect(),v=uB(a,r,e,P,R,N)}catch(P){if(P instanceof Error&&e._onError(P),Fw)throw P;return Dj(e,null,n,r),K6(e),e._dirtyType=d0,Fw=!0,kc(e,a),void(Fw=!1)}finally{y.observe(n,G4),e._updating=g,ia=d,Fi=f,oa=p}}r._readOnly||(r._readOnly=!0);const w=e._dirtyLeaves,b=e._dirtyElements,E=e._normalizedNodes,k=e._updateTags,_=e._deferred;c&&(e._dirtyType=of,e._cloneNotNeeded.clear(),e._dirtyLeaves=new Set,e._dirtyElements=new Map,e._normalizedNodes=new Set,e._updateTags=new Set),(function(P,R){const N=P._decorators;let A=P._pendingDecorators||N;const M=R._nodeMap;let H;for(H in A)M.has(H)||(A===N&&(A=Bj(P)),delete A[H])})(e,r);const T=s?null:tl(Co(e));if(e._editable&&T!==null&&(c||l===null||l.dirty)&&n!==null&&!k.has(UB)){oa=e,ia=r;try{if(y!==null&&y.disconnect(),c||l===null||l.dirty){const P=e._blockCursorElement;P!==null&&Y_(P,e,n),PB(i,l,e,T,k,n)}(function(P,R,N){let A=P._blockCursorElement;if(At(N)&&N.isCollapsed()&&N.anchor.type==="element"&&R.contains(document.activeElement)){const M=N.anchor,H=M.getNode(),Q=M.offset;let Z=!1,ae=null;if(Q===H.getChildrenSize())Rw(H.getChildAtIndex(Q-1))&&(Z=!0);else{const te=H.getChildAtIndex(Q);if(te!==null&&Rw(te)){const se=te.getPreviousSibling();(se===null||Rw(se))&&(Z=!0,ae=P.getElementByKey(te.__key))}}if(Z){const te=P.getElementByKey(H.__key);return A===null&&(P._blockCursorElement=A=(function(se){const L=se.theme,G=document.createElement("div");G.contentEditable="false",G.setAttribute("data-lexical-cursor","true");let I=L.blockCursor;if(I!==void 0){if(typeof I=="string"){const z=W6(I);I=L.blockCursor=z}I!==void 0&&G.classList.add(...I)}return G})(P._config)),R.style.caretColor="transparent",void(ae===null?te.appendChild(A):te.insertBefore(A,ae))}}A!==null&&Y_(A,P,R)})(e,n,l)}finally{y!==null&&y.observe(n,G4),oa=p,ia=d}}v!==null&&(function(P,R,N,A,M){const H=Array.from(P._listeners.mutation),Q=H.length;for(let Z=0;Z<Q;Z++){const[ae,te]=H[Z];for(const se of te){const L=R.get(se);L!==void 0&&ae(L,{dirtyLeaves:A,prevEditorState:M,updateTags:N})}}})(e,v,k,w,a),At(l)||l===null||i!==null&&i.is(l)||e.dispatchCommand(ej,void 0);const j=e._pendingDecorators;j!==null&&(e._decorators=j,e._pendingDecorators=null,Bm("decorator",e,!0,j)),(function(P,R,N){const A=Z4(R),M=Z4(N);A!==M&&Bm("textcontent",P,!0,M)})(e,t||a,r),Bm("update",e,!0,{dirtyElements:b,dirtyLeaves:w,editorState:r,mutatedNodes:v,normalizedNodes:E,prevEditorState:t||a,tags:k}),(function(P,R){if(P._deferred=[],R.length!==0){const N=P._updating;P._updating=!0;try{for(let A=0;A<R.length;A++)R[A]()}finally{P._updating=N}}})(e,_),(function(P){const R=P._updates;if(R.length!==0){const N=R.shift();if(N){const[A,M]=N;G1(P,A,M)}}})(e)}function Bm(e,t,r,...n){const s=t._updating;t._updating=r;try{const a=Array.from(t._listeners[e]);for(let i=0;i<a.length;i++)a[i].apply(null,n)}finally{t._updating=s}}function X4(e,t){const r=e._updates;let n=t||!1;for(;r.length!==0;){const s=r.shift();if(s){const[a,i]=s,l=e._pendingEditorState;let c;i!==void 0&&(c=i.onUpdate,i.skipTransforms&&(n=!0),i.discrete&&(l===null&&Lt(191),l._flushSync=!0),c&&e._deferred.push(c),Aj(e,i.tag)),l==null?G1(e,a,i):a()}}return n}function G1(e,t,r){const n=e._updateTags;let s,a=!1,i=!1;r!==void 0&&(s=r.onUpdate,Aj(e,r.tag),a=r.skipTransforms||!1,i=r.discrete||!1),s&&e._deferred.push(s);const l=e._editorState;let c=e._pendingEditorState,d=!1;(c===null||c._readOnly)&&(c=e._pendingEditorState=Fj(c||l),d=!0),c._flushSync=i;const f=ia,p=Fi,g=oa,y=e._updating;ia=c,Fi=!1,e._updating=!0,oa=e;const v=e._headless||e.getRootElement()===null;Rb(null);try{d&&(v?l._selection!==null&&(c._selection=l._selection.clone()):c._selection=(function(k,_){const T=k.getEditorState()._selection,j=tl(Co(k));return At(T)||T==null?Nb(T,j,k,_):T.clone()})(e,r&&r.event||null));const b=e._compositionKey;t(),a=X4(e,a),(function(k,_){const T=_.getEditorState()._selection,j=k._selection;if(At(j)){const P=j.anchor,R=j.focus;let N;if(P.type==="text"&&(N=P.getNode(),N.selectionTransform(T,j)),R.type==="text"){const A=R.getNode();N!==A&&A.selectionTransform(T,j)}}})(c,e),e._dirtyType!==of&&(a?(function(k,_){const T=_._dirtyLeaves,j=k._nodeMap;for(const P of T){const R=j.get(P);Xt(R)&&R.isAttached()&&R.isSimpleText()&&!R.isUnmergeable()&&C4(R)}})(c,e):(function(k,_){const T=_._dirtyLeaves,j=_._dirtyElements,P=k._nodeMap,R=Pu(),N=new Map;let A=T,M=A.size,H=j,Q=H.size;for(;M>0||Q>0;){if(M>0){_._dirtyLeaves=new Set;for(const Z of A){const ae=P.get(Z);Xt(ae)&&ae.isAttached()&&ae.isSimpleText()&&!ae.isUnmergeable()&&C4(ae),ae!==void 0&&K4(ae,R)&&V4(_,ae,N),T.add(Z)}if(A=_._dirtyLeaves,M=A.size,M>0){My++;continue}}_._dirtyLeaves=new Set,_._dirtyElements=new Map,H.delete("root")&&H.set("root",!0);for(const Z of H){const ae=Z[0],te=Z[1];if(j.set(ae,te),!te)continue;const se=P.get(ae);se!==void 0&&K4(se,R)&&V4(_,se,N)}A=_._dirtyLeaves,M=A.size,H=_._dirtyElements,Q=H.size,My++}_._dirtyLeaves=T,_._dirtyElements=j})(c,e),X4(e),(function(k,_,T,j){const P=k._nodeMap,R=_._nodeMap,N=[];for(const[A]of j){const M=R.get(A);M!==void 0&&(M.isAttached()||(vt(M)&&H6(M,A,P,R,N,j),P.has(A)||j.delete(A),N.push(A)))}for(const A of N)R.delete(A);for(const A of T){const M=R.get(A);M===void 0||M.isAttached()||(P.has(A)||T.delete(A),R.delete(A))}})(l,c,e._dirtyLeaves,e._dirtyElements)),b!==e._compositionKey&&(c._flushSync=!0);const E=c._selection;if(At(E)){const k=c._nodeMap,_=E.anchor.key,T=E.focus.key;k.get(_)!==void 0&&k.get(T)!==void 0||Lt(19)}else Ua(E)&&E._nodes.size===0&&(c._selection=null)}catch(b){return b instanceof Error&&e._onError(b),e._pendingEditorState=l,e._dirtyType=d0,e._cloneNotNeeded.clear(),e._dirtyLeaves=new Set,e._dirtyElements.clear(),void kc(e)}finally{ia=f,Fi=p,oa=g,e._updating=y,My=0}e._dirtyType!==of||e._deferred.length>0||(function(b,E){const k=E.getEditorState()._selection,_=b._selection;if(_!==null){if(_.dirty||!_.is(k))return!0}else if(k!==null)return!0;return!1})(c,e)?c._flushSync?(c._flushSync=!1,kc(e)):d&&GB((()=>{kc(e)})):(c._flushSync=!1,d&&(n.clear(),e._deferred=[],e._pendingEditorState=null))}function Hi(e,t,r){oa===e&&r===void 0?t():G1(e,t,r)}class Um{constructor(t,r,n){this.element=t,this.before=r||null,this.after=n||null}withBefore(t){return new Um(this.element,t,this.after)}withAfter(t){return new Um(this.element,this.before,t)}withElement(t){return this.element===t?this:new Um(t,this.before,this.after)}insertChild(t){const r=this.before||this.getManagedLineBreak();return r!==null&&r.parentElement!==this.element&&Lt(222),this.element.insertBefore(t,r),this}removeChild(t){return t.parentElement!==this.element&&Lt(223),this.element.removeChild(t),this}replaceChild(t,r){return r.parentElement!==this.element&&Lt(224),this.element.replaceChild(t,r),this}getFirstChild(){const t=this.after?this.after.nextSibling:this.element.firstChild;return t===this.before||t===this.getManagedLineBreak()?null:t}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(t){if(t===null)this.removeManagedLineBreak();else{const r=t==="decorator"&&(u0||ap);this.insertManagedLineBreak(r)}}removeManagedLineBreak(){const t=this.getManagedLineBreak();if(t){const r=this.element,n=t.nodeName==="IMG"?t.nextSibling:null;n&&r.removeChild(n),r.removeChild(t),r.__lexicalLineBreak=void 0}}insertManagedLineBreak(t){const r=this.getManagedLineBreak();if(r){if(t===(r.nodeName==="IMG"))return;this.removeManagedLineBreak()}const n=this.element,s=this.before,a=document.createElement("br");if(n.insertBefore(a,s),t){const i=document.createElement("img");i.setAttribute("data-lexical-linebreak","true"),i.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",i.alt="",n.insertBefore(i,a),n.__lexicalLineBreak=i}else n.__lexicalLineBreak=a}getFirstChildOffset(){let t=0;for(let r=this.after;r!==null;r=r.previousSibling)t++;return t}resolveChildIndex(t,r,n,s){if(n===this.element){const c=this.getFirstChildOffset();return[t,Math.min(c+t.getChildrenSize(),Math.max(c,s))]}const a=Y4(r,n);a.push(s);const i=Y4(r,this.element);let l=t.getIndexWithinParent();for(let c=0;c<i.length;c++){const d=a[c],f=i[c];if(d===void 0||d<f)break;if(d>f){l+=1;break}}return[t.getParentOrThrow(),l]}}function Y4(e,t){const r=[];let n=t;for(;n!==e&&n!==null;n=n.parentNode){let s=0;for(let a=n.previousSibling;a!==null;a=a.previousSibling)s++;r.push(s)}return n!==e&&Lt(225),r.reverse()}class Xa extends C0{constructor(t){super(t),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(t){super.afterCloneFrom(t),this.__key===t.__key&&(this.__first=t.__first,this.__last=t.__last,this.__size=t.__size),this.__indent=t.__indent,this.__format=t.__format,this.__style=t.__style,this.__dir=t.__dir,this.__textFormat=t.__textFormat,this.__textStyle=t.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const t=this.getFormat();return JL[t]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const t=[];let r=this.getFirstChild();for(;r!==null;)t.push(r),r=r.getNextSibling();return t}getChildrenKeys(){const t=[];let r=this.getFirstChild();for(;r!==null;)t.push(r.__key),r=r.getNextSibling();return t}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const t=rs()._dirtyElements;return t!==null&&t.has(this.__key)}isLastChild(){const t=this.getLatest(),r=this.getParentOrThrow().getLastChild();return r!==null&&r.is(t)}getAllTextNodes(){const t=[];let r=this.getFirstChild();for(;r!==null;){if(Xt(r)&&t.push(r),vt(r)){const n=r.getAllTextNodes();t.push(...n)}r=r.getNextSibling()}return t}getFirstDescendant(){let t=this.getFirstChild();for(;vt(t);){const r=t.getFirstChild();if(r===null)break;t=r}return t}getLastDescendant(){let t=this.getLastChild();for(;vt(t);){const r=t.getLastChild();if(r===null)break;t=r}return t}getDescendantByIndex(t){const r=this.getChildren(),n=r.length;if(t>=n){const a=r[n-1];return vt(a)&&a.getLastDescendant()||a||null}const s=r[t];return vt(s)&&s.getFirstDescendant()||s||null}getFirstChild(){const t=this.getLatest().__first;return t===null?null:Ls(t)}getFirstChildOrThrow(){const t=this.getFirstChild();return t===null&&Lt(45,this.__key),t}getLastChild(){const t=this.getLatest().__last;return t===null?null:Ls(t)}getLastChildOrThrow(){const t=this.getLastChild();return t===null&&Lt(96,this.__key),t}getChildAtIndex(t){const r=this.getChildrenSize();let n,s;if(t<r/2){for(n=this.getFirstChild(),s=0;n!==null&&s<=t;){if(s===t)return n;n=n.getNextSibling(),s++}return null}for(n=this.getLastChild(),s=r-1;n!==null&&s>=t;){if(s===t)return n;n=n.getPreviousSibling(),s--}return null}getTextContent(){let t="";const r=this.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];t+=a.getTextContent(),vt(a)&&s!==n-1&&!a.isInline()&&(t+=Rc)}return t}getTextContentSize(){let t=0;const r=this.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];t+=a.getTextContentSize(),vt(a)&&s!==n-1&&!a.isInline()&&(t+=Rc.length)}return t}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(t){if(t!==""){const r=x4[t];return!!(this.getFormat()&r)}return!1}hasTextFormat(t){const r=lf[t];return!!(this.getTextFormat()&r)}getFormatFlags(t,r){return o1(this.getLatest().__textFormat,t,r)}getTextStyle(){return this.getLatest().__textStyle}select(t,r){Ea();const n=qt();let s=t,a=r;const i=this.getChildrenSize();if(!this.canBeEmpty()){if(t===0&&r===0){const c=this.getFirstChild();if(Xt(c)||vt(c))return c.select(0,0)}else if(!(t!==void 0&&t!==i||r!==void 0&&r!==i)){const c=this.getLastChild();if(Xt(c)||vt(c))return c.select()}}s===void 0&&(s=i),a===void 0&&(a=i);const l=this.__key;return At(n)?(n.anchor.set(l,s,"element"),n.focus.set(l,a,"element"),n.dirty=!0,n):Tj(l,s,l,a,"element","element")}selectStart(){const t=this.getFirstDescendant();return t?t.selectStart():this.select()}selectEnd(){const t=this.getLastDescendant();return t?t.selectEnd():this.select()}clear(){const t=this.getWritable();return this.getChildren().forEach((r=>r.remove())),t}append(...t){return this.splice(this.getChildrenSize(),0,t)}setDirection(t){const r=this.getWritable();return r.__dir=t,r}setFormat(t){return this.getWritable().__format=t!==""?x4[t]:0,this}setStyle(t){return this.getWritable().__style=t||"",this}setTextFormat(t){const r=this.getWritable();return r.__textFormat=t,r}setTextStyle(t){const r=this.getWritable();return r.__textStyle=t,r}setIndent(t){return this.getWritable().__indent=t,this}splice(t,r,n){const s=n.length,a=this.getChildrenSize(),i=this.getWritable();t+r<=a||Lt(226,String(t),String(r),String(a));const l=i.__key,c=[],d=[],f=this.getChildAtIndex(t+r);let p=null,g=a-r+s;if(t!==0)if(t===a)p=this.getLastChild();else{const v=this.getChildAtIndex(t);v!==null&&(p=v.getPreviousSibling())}if(r>0){let v=p===null?this.getFirstChild():p.getNextSibling();for(let w=0;w<r;w++){v===null&&Lt(100);const b=v.getNextSibling(),E=v.__key;Qd(v.getWritable()),d.push(E),v=b}}let y=p;for(let v=0;v<s;v++){const w=n[v];y!==null&&w.is(y)&&(p=y=y.getPreviousSibling());const b=w.getWritable();b.__parent===l&&g--,Qd(b);const E=w.__key;if(y===null)i.__first=E,b.__prev=null;else{const k=y.getWritable();k.__next=E,b.__prev=k.__key}w.__key===l&&Lt(76),b.__parent=l,c.push(E),y=w}if(t+r===a)y!==null&&(y.getWritable().__next=null,i.__last=y.__key);else if(f!==null){const v=f.getWritable();if(y!==null){const w=y.getWritable();v.__prev=y.__key,w.__next=f.__key}else v.__prev=null}if(i.__size=g,d.length){const v=qt();if(At(v)){const w=new Set(d),b=new Set(c),{anchor:E,focus:k}=v;J4(E,w,b)&&a1(E,E.getNode(),this,p,f),J4(k,w,b)&&a1(k,k.getNode(),this,p,f),g!==0||this.canBeEmpty()||mi(this)||this.remove()}}return i}getDOMSlot(t){return new Um(t)}exportDOM(t){const{element:r}=super.exportDOM(t);if(Bn(r)){const n=this.getIndent();n>0&&(r.style.paddingInlineStart=40*n+"px");const s=this.getDirection();s&&(r.dir=s)}return{element:r}}exportJSON(){const t={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},r=this.getTextFormat(),n=this.getTextStyle();return r!==0&&(t.textFormat=r),n!==""&&(t.textStyle=n),t}updateFromJSON(t){return super.updateFromJSON(t).setFormat(t.format).setIndent(t.indent).setDirection(t.direction).setTextFormat(t.textFormat||0).setTextStyle(t.textStyle||"")}insertNewAfter(t,r){return null}canIndent(){return!0}collapseAtStart(t){return!1}excludeFromCopy(t){return!1}canReplaceWith(t){return!0}canInsertAfter(t){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(t){return!1}extractWithChild(t,r,n){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(t,r){const n=this.getDOMSlot(t);let s=n.getFirstChild();for(let a=this.getFirstChild();a;a=a.getNextSibling()){const i=r.getElementByKey(a.getKey());i!==null&&(s==null?(n.insertChild(i),s=i):s!==i&&n.replaceChild(i,s),s=s.nextSibling)}}}function vt(e){return e instanceof Xa}function J4(e,t,r){let n=e.getNode();for(;n;){const s=n.__key;if(t.has(s)&&!r.has(s))return!0;n=n.getParent()}return!1}class jb extends C0{decorate(t,r){Lt(47)}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}}function cn(e){return e instanceof jb}class Lp extends Xa{static getType(){return"root"}static clone(){return new Lp}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){Lt(51)}getTextContent(){const t=this.__cachedText;return!Op()&&rs()._dirtyType!==of||t===null?super.getTextContent():t}remove(){Lt(52)}replace(t){Lt(53)}insertBefore(t){Lt(54)}insertAfter(t){Lt(55)}updateDOM(t,r){return!1}splice(t,r,n){for(const s of n)vt(s)||cn(s)||Lt(282);return super.splice(t,r,n)}static importJSON(t){return qn().updateFromJSON(t)}collapseAtStart(){return!0}}function Xs(e){return e instanceof Lp}function Fj(e){return new V1(new Map(e._nodeMap))}function Ab(){return new V1(new Map([["root",new Lp]]))}function Pj(e){const t=e.exportJSON(),r=e.constructor;if(t.type!==r.getType()&&Lt(130,r.name),vt(e)){const n=t.children;Array.isArray(n)||Lt(59,r.name);const s=e.getChildren();for(let a=0;a<s.length;a++){const i=Pj(s[a]);n.push(i)}}return t}class V1{constructor(t,r){this._nodeMap=t,this._selection=r||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(t,r){return q4(r&&r.editor||null,this,t)}clone(t){const r=new V1(this._nodeMap,t===void 0?this._selection:t);return r._readOnly=!0,r}toJSON(){return q4(null,this,(()=>({root:Pj(qn())})))}}const i1="historic",OB="history-push",$m="history-merge",LB="paste",Rj="collaboration",BB="skip-scroll-into-view",UB="skip-dom-selection";class Fb extends Xa{static getType(){return"artificial"}createDOM(t){return document.createElement("div")}}class Bp extends Xa{static getType(){return"paragraph"}static clone(t){return new Bp(t.__key)}createDOM(t){const r=document.createElement("p"),n=e0(t.theme,"paragraph");return n!==void 0&&r.classList.add(...n),r}updateDOM(t,r,n){return!1}static importDOM(){return{p:t=>({conversion:$B,priority:0})}}exportDOM(t){const{element:r}=super.exportDOM(t);if(Bn(r)){this.isEmpty()&&r.append(document.createElement("br"));const n=this.getFormatType();n&&(r.style.textAlign=n)}return{element:r}}static importJSON(t){return Ln().updateFromJSON(t)}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),textStyle:this.getTextStyle()}}insertNewAfter(t,r){const n=Ln();n.setTextFormat(t.format),n.setTextStyle(t.style);const s=this.getDirection();return n.setDirection(s),n.setFormat(this.getFormatType()),n.setStyle(this.getStyle()),this.insertAfter(n,r),n}collapseAtStart(){const t=this.getChildren();if(t.length===0||Xt(t[0])&&t[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}}function $B(e){const t=Ln();return e.style&&(t.setFormat(e.style.textAlign),zb(e,t)),{node:t}}function Ln(){return xi(new Bp)}function Pb(e){return e instanceof Bp}const tn=0,Oh=1,WB=4;function Dj(e,t,r,n){const s=e._keyToDOMMap;s.clear(),e._editorState=Ab(),e._pendingEditorState=n,e._compositionKey=null,e._dirtyType=of,e._cloneNotNeeded.clear(),e._dirtyLeaves=new Set,e._dirtyElements.clear(),e._normalizedNodes=new Set,e._updateTags=new Set,e._updates=[],e._blockCursorElement=null;const a=e._observer;a!==null&&(a.disconnect(),e._observer=null),t!==null&&(t.textContent=""),r!==null&&(r.textContent="",s.set("root",r))}function zB(e){const t=e||{},r=IB(),n=t.theme||{},s=e===void 0?r:t.parentEditor||null,a=t.disableEvents||!1,i=Ab(),l=t.namespace||(s!==null?s._config.namespace:Wj()),c=t.editorState,d=[Lp,ed,Ip,Mp,Bp,Fb,...t.nodes||[]],{onError:f,html:p}=t,g=t.editable===void 0||t.editable;let y;if(e===void 0&&r!==null)y=r._nodes;else{y=new Map;for(let w=0;w<d.length;w++){let b=d[w],E=null,k=null;if(typeof b!="function"){const R=b;b=R.replace,E=R.with,k=R.withKlass||null}const{ownNodeConfig:_}=Hb(b),T=b.getType(),j=b.transform(),P=new Set;_&&_.$transform&&P.add(_.$transform),j!==null&&P.add(j),y.set(T,{exportDOM:p&&p.export?p.export.get(b):void 0,klass:b,replace:E,replaceWithKlass:k,sharedNodeState:aB(d[w]),transforms:P})}}const v=new K1(i,s,y,{disableEvents:a,namespace:l,theme:n},f||console.error,(function(w,b){const E=new Map,k=new Set,_=T=>{Object.keys(T).forEach((j=>{let P=E.get(j);P===void 0&&(P=[],E.set(j,P)),P.push(T[j])}))};return w.forEach((T=>{const j=T.klass.importDOM;if(j==null||k.has(j))return;k.add(j);const P=j.call(T.klass);P!==null&&_(P)})),b&&_(b),E})(y,p?p.import:void 0),g,e);return c!==void 0&&(v._pendingEditorState=c,v._dirtyType=d0),v}class K1{constructor(t,r,n,s,a,i,l,c){this._createEditorArgs=c,this._parentEditor=r,this._rootElement=null,this._editorState=t,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=s,this._nodes=n,this._decorators={},this._pendingDecorators=null,this._dirtyType=of,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=Wj(),this._onError=a,this._htmlConversions=i,this._editable=l,this._headless=r!==null&&r._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(t){const r=this._listeners.update;return r.add(t),()=>{r.delete(t)}}registerEditableListener(t){const r=this._listeners.editable;return r.add(t),()=>{r.delete(t)}}registerDecoratorListener(t){const r=this._listeners.decorator;return r.add(t),()=>{r.delete(t)}}registerTextContentListener(t){const r=this._listeners.textcontent;return r.add(t),()=>{r.delete(t)}}registerRootListener(t){const r=this._listeners.root;return t(this._rootElement,null),r.add(t),()=>{t(null,this._rootElement),r.delete(t)}}registerCommand(t,r,n){n===void 0&&Lt(35);const s=this._commands;s.has(t)||s.set(t,[new Set,new Set,new Set,new Set,new Set]);const a=s.get(t);a===void 0&&Lt(36,String(t));const i=a[n];return i.add(r),()=>{i.delete(r),a.every((l=>l.size===0))&&s.delete(t)}}registerMutationListener(t,r,n){const s=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(t)).klass,a=this._listeners.mutation;let i=a.get(r);i===void 0&&(i=new Set,a.set(r,i)),i.add(s);const l=n&&n.skipInitialization;return l!==void 0&&l||this.initializeMutationListener(r,s),()=>{i.delete(s),i.size===0&&a.delete(r)}}getRegisteredNode(t){const r=this._nodes.get(t.getType());return r===void 0&&Lt(37,t.name),r}resolveRegisteredNodeAfterReplacements(t){for(;t.replaceWithKlass;)t=this.getRegisteredNode(t.replaceWithKlass);return t}initializeMutationListener(t,r){const n=this._editorState,s=iN(n).get(r.getType());if(!s)return;const a=new Map;for(const i of s.keys())a.set(i,"created");a.size>0&&t(a,{dirtyLeaves:new Set,prevEditorState:n,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(t,r){const n=this.getRegisteredNode(t);return n.transforms.add(r),n}registerNodeTransform(t,r){const n=this.registerNodeTransformToKlass(t,r),s=[n],a=n.replaceWithKlass;if(a!=null){const i=this.registerNodeTransformToKlass(a,r);s.push(i)}return(function(i,l){const c=iN(i.getEditorState()),d=[];for(const f of l){const p=c.get(f);p&&d.push(p)}d.length!==0&&i.update((()=>{for(const f of d)for(const p of f.keys()){const g=Ls(p);g&&g.markDirty()}}),i._pendingEditorState===null?{tag:$m}:void 0)})(this,s.map((i=>i.klass.getType()))),()=>{s.forEach((i=>i.transforms.delete(r)))}}hasNode(t){return this._nodes.has(t.getType())}hasNodes(t){return t.every(this.hasNode.bind(this))}dispatchCommand(t,r){return rr(this,t,r)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(t){const r=this._rootElement;if(t!==r){const n=e0(this._config.theme,"root"),s=this._pendingEditorState||this._editorState;if(this._rootElement=t,Dj(this,r,t,s),r!==null&&(this._config.disableEvents||SB(r),n!=null&&r.classList.remove(...n)),t!==null){const a=$b(t),i=t.style;i.userSelect="text",i.whiteSpace="pre-wrap",i.wordBreak="break-word",t.setAttribute("data-lexical-editor","true"),this._window=a,this._dirtyType=d0,K6(this),this._updateTags.add($m),kc(this),this._config.disableEvents||(function(l,c){const d=l.ownerDocument,f=n1.get(d);(f===void 0||f<1)&&d.addEventListener("selectionchange",_j),n1.set(d,(f||0)+1),l.__lexicalEditor=c;const p=wj(l);for(let g=0;g<$_.length;g++){const[y,v]=$_[g],w=typeof v=="function"?b=>{P4(b)||(F4(b),(c.isEditable()||y==="click")&&v(b,c))}:b=>{if(P4(b))return;F4(b);const E=c.isEditable();switch(y){case"cut":return E&&rr(c,kb,b);case"copy":return rr(c,$1,b);case"paste":return E&&rr(c,_b,b);case"dragstart":return E&&rr(c,fj,b);case"dragover":return E&&rr(c,hj,b);case"dragend":return E&&rr(c,xB,b);case"focus":return E&&rr(c,wB,b);case"blur":return E&&rr(c,_B,b);case"drop":return E&&rr(c,uj,b)}};l.addEventListener(y,w),p.push((()=>{l.removeEventListener(y,w)}))}})(t,this),n!=null&&t.classList.add(...n)}else this._window=null,this._updateTags.add($m),kc(this);Bm("root",this,!1,t,r)}}getElementByKey(t){return this._keyToDOMMap.get(t)||null}getEditorState(){return this._editorState}setEditorState(t,r){t.isEmpty()&&Lt(38);let n=t;n._readOnly&&(n=Fj(t),n._selection=t._selection?t._selection.clone():null),V6(this);const s=this._pendingEditorState,a=this._updateTags,i=r!==void 0?r.tag:null;s===null||s.isEmpty()||(i!=null&&a.add(i),kc(this)),this._pendingEditorState=n,this._dirtyType=d0,this._dirtyElements.set("root",!1),this._compositionKey=null,i!=null&&a.add(i),this._updating||kc(this)}parseEditorState(t,r){return(function(n,s,a){const i=Ab(),l=ia,c=Fi,d=oa,f=s._dirtyElements,p=s._dirtyLeaves,g=s._cloneNotNeeded,y=s._dirtyType;s._dirtyElements=new Map,s._dirtyLeaves=new Set,s._cloneNotNeeded=new Set,s._dirtyType=0,ia=i,Fi=!1,oa=s,Rb(null);try{const v=s._nodes;Eb(n.root,v),a&&a(),i._readOnly=!0}catch(v){v instanceof Error&&s._onError(v)}finally{s._dirtyElements=f,s._dirtyLeaves=p,s._cloneNotNeeded=g,s._dirtyType=y,ia=l,Fi=c,oa=d}return i})(typeof t=="string"?JSON.parse(t):t,this,r)}read(t){return kc(this),this.getEditorState().read(t,{editor:this})}update(t,r){(function(n,s,a){n._updating?n._updates.push([s,a]):G1(n,s,a)})(this,t,r)}focus(t,r={}){const n=this._rootElement;n!==null&&(n.setAttribute("autocapitalize","off"),Hi(this,(()=>{const s=qt(),a=qn();s!==null?s.dirty||Pa(s.clone()):a.getChildrenSize()!==0&&(r.defaultSelection==="rootStart"?a.selectStart():a.selectEnd()),YB("focus"),JB((()=>{n.removeAttribute("autocapitalize"),t&&t()}))})),this._pendingEditorState===null&&n.removeAttribute("autocapitalize"))}blur(){const t=this._rootElement;t!==null&&t.blur();const r=tl(this._window);r!==null&&r.removeAllRanges()}isEditable(){return this._editable}setEditable(t){this._editable!==t&&(this._editable=t,Bm("editable",this,!0,t))}toJSON(){return{editorState:this._editorState.toJSON()}}}K1.version="0.35.0+prod.esm";let K_=null;function Rb(e){K_=e}let HB=1;function Ij(e,t){const r=Db(e,t);return r===void 0&&Lt(30,t),r}function Db(e,t){return e._nodes.get(t)}const GB=typeof queueMicrotask=="function"?queueMicrotask:e=>{Promise.resolve().then(e)};function Q4(e){return cn(Hu(e))}function Ib(e){const t=document.activeElement;if(!Bn(t))return!1;const r=t.nodeName;return cn(Hu(e))&&(r==="INPUT"||r==="TEXTAREA"||t.contentEditable==="true"&&q1(t)==null)}function Up(e,t,r){const n=e.getRootElement();try{return n!==null&&n.contains(t)&&n.contains(r)&&t!==null&&!Ib(t)&&Mj(t)===e}catch{return!1}}function Mb(e){return e instanceof K1}function Mj(e){let t=e;for(;t!=null;){const r=q1(t);if(Mb(r))return r;t=$p(t)}return null}function q1(e){return e?e.__lexicalEditor:null}function Jd(e){return W1(e)||e.isToken()}function bc(e){return Jd(e)||e.isSegmented()}function Oc(e){return E0(e)&&e.nodeType===WL}function VB(e){return E0(e)&&e.nodeType===zL}function f0(e){let t=e;for(;t!=null;){if(Oc(t))return t;t=t.firstChild}return null}function o1(e,t,r){const n=lf[t];if(r!==null&&(e&n)==(r&n))return e;let s=e^n;return t==="subscript"?s&=-65:t==="superscript"?s&=-33:t==="lowercase"?(s&=-513,s&=-1025):t==="uppercase"?(s&=-257,s&=-1025):t==="capitalize"&&(s&=-257,s&=-513),s}function Oj(e){return Xt(e)||Nc(e)||cn(e)}function KB(e,t){const r=(function(){const i=K_;return K_=null,i})();if((t=t||r&&r.__key)!=null)return void(e.__key=t);Ea(),Ej();const n=rs(),s=td(),a=""+HB++;s._nodeMap.set(a,e),vt(e)?n._dirtyElements.set(a,!0):n._dirtyLeaves.add(a),n._cloneNotNeeded.add(a),n._dirtyType=z6,e.__key=a}function Qd(e){const t=e.getParent();if(t!==null){const r=e.getWritable(),n=t.getWritable(),s=e.getPreviousSibling(),a=e.getNextSibling(),i=a!==null?a.__key:null,l=s!==null?s.__key:null,c=s!==null?s.getWritable():null,d=a!==null?a.getWritable():null;s===null&&(n.__first=i),a===null&&(n.__last=l),c!==null&&(c.__next=i),d!==null&&(d.__prev=l),r.__prev=null,r.__next=null,r.__parent=null,n.__size--}}function l1(e){Ej();const t=e.getLatest(),r=t.__parent,n=td(),s=rs(),a=n._nodeMap,i=s._dirtyElements;r!==null&&(function(c,d,f){let p=c;for(;p!==null;){if(f.has(p))return;const g=d.get(p);if(g===void 0)break;f.set(p,!1),p=g.__parent}})(r,a,i);const l=t.__key;s._dirtyType=z6,vt(e)?i.set(l,!0):s._dirtyLeaves.add(l)}function ja(e){Ea();const t=rs(),r=t._compositionKey;if(e!==r){if(t._compositionKey=e,r!==null){const n=Ls(r);n!==null&&n.getWritable()}if(e!==null){const n=Ls(e);n!==null&&n.getWritable()}}}function Pu(){return Op()?null:rs()._compositionKey}function Ls(e,t){const r=(t||td())._nodeMap.get(e);return r===void 0?null:r}function Lj(e,t){const r=X1(e,rs());return r!==void 0?Ls(r,t):null}function X1(e,t){return e[`__lexicalKey_${t._key}`]}function Hu(e,t){let r=e;for(;r!=null;){const n=Lj(r,t);if(n!==null)return n;r=$p(r)}return null}function Bj(e){const t=e._decorators,r=Object.assign({},t);return e._pendingDecorators=r,r}function Z4(e){return e.read((()=>qn().getTextContent()))}function qn(){return Uj(td())}function Uj(e){return e._nodeMap.get("root")}function Pa(e){Ea();const t=td();e!==null&&(e.dirty=!0,e.setCachedNodes(null)),t._selection=e}function Kh(e){const t=rs(),r=(function(n,s){let a=n;for(;a!=null;){const i=X1(a,s);if(i!==void 0)return i;a=$p(a)}return null})(e,t);return r===null?e===t.getRootElement()?Ls("root"):null:Ls(r)}function $j(e){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(e)}function Ob(e){const t=[];let r=e;for(;r!==null;)t.push(r),r=r._parentEditor;return t}function Wj(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function zj(e){return Oc(e)?e.nodeValue:null}function Lb(e,t,r){const n=tl(Co(t));if(n===null)return;const s=n.anchorNode;let{anchorOffset:a,focusOffset:i}=n;if(s!==null){let l=zj(s);const c=Hu(s);if(l!==null&&Xt(c)){if(l===B1&&r){const d=r.length;l=r,a=d,i=d}l!==null&&Bb(c,l,a,i,e)}}}function Bb(e,t,r,n,s){let a=e;if(a.isAttached()&&(s||!a.isDirty())){const i=a.isComposing();let l=t;(i||s)&&t[t.length-1]===B1&&(l=t.slice(0,-1));const c=a.getTextContent();if(s||l!==c){if(l===""){if(ja(null),ap||u0||qy)a.remove();else{const w=rs();setTimeout((()=>{w.update((()=>{a.isAttached()&&a.remove()}))}),20)}return}const d=a.getParent(),f=N0(),p=a.getTextContentSize(),g=Pu(),y=a.getKey();if(a.isToken()||g!==null&&y===g&&!i||At(f)&&(d!==null&&!d.canInsertTextBefore()&&f.anchor.offset===0||f.anchor.key===e.__key&&f.anchor.offset===0&&!a.canInsertTextBefore()&&!i||f.focus.key===e.__key&&f.focus.offset===p&&!a.canInsertTextAfter()&&!i))return void a.markDirty();const v=qt();if(!At(v)||r===null||n===null)return void eN(a,l,v);if(v.setTextNodeRange(a,r,a,n),a.isSegmented()){const w=cs(a.getTextContent());a.replace(w),a=w}eN(a,l,v)}}}function eN(e,t,r){if(e.setTextContent(t),At(r)){const n=e.getKey();for(const s of["anchor","focus"]){const a=r[s];a.type==="text"&&a.key===n&&(a.offset=Bu(e,a.offset,"clamp"))}}}function hy(e,t,r){const n=t[r]||!1;return n==="any"||n===e[r]}function qB(e,t){return hy(e,t,"altKey")&&hy(e,t,"ctrlKey")&&hy(e,t,"shiftKey")&&hy(e,t,"metaKey")}function yn(e,t,r){return qB(e,r)&&e.key.toLowerCase()===t.toLowerCase()}const _c={ctrlKey:!Pl,metaKey:Pl},tN={altKey:Pl,ctrlKey:!Pl};function rN(e){return e.key==="Backspace"}function nN(e){return yn(e,"a",_c)}function XB(e){const t=qn();if(At(e)){const r=e.anchor,n=e.focus,s=r.getNode().getTopLevelElementOrThrow().getParentOrThrow();return r.set(s.getKey(),0,"element"),n.set(s.getKey(),s.getChildrenSize(),"element"),Jy(e),e}{const r=t.select(0,t.getChildrenSize());return Pa(Jy(r)),r}}function e0(e,t){e.__lexicalClassNameCache===void 0&&(e.__lexicalClassNameCache={});const r=e.__lexicalClassNameCache,n=r[t];if(n!==void 0)return n;const s=e[t];if(typeof s=="string"){const a=W6(s);return r[t]=a,a}return s}function Ub(e,t,r,n,s){if(r.size===0)return;const a=n.__type,i=n.__key,l=t.get(a);l===void 0&&Lt(33,a);const c=l.klass;let d=e.get(c);d===void 0&&(d=new Map,e.set(c,d));const f=d.get(i),p=f==="destroyed"&&s==="created";(f===void 0||p)&&d.set(i,p?"updated":s)}function sN(e,t,r){const n=e.getParent();let s=r,a=e;return n!==null&&(t&&r===0?(s=a.getIndexWithinParent(),a=n):t||r!==a.getChildrenSize()||(s=a.getIndexWithinParent()+1,a=n)),a.getChildAtIndex(t?s-1:s)}function q_(e,t){const r=e.offset;if(e.type==="element")return sN(e.getNode(),t,r);{const n=e.getNode();if(t&&r===0||!t&&r===n.getTextContentSize()){const s=t?n.getPreviousSibling():n.getNextSibling();return s===null?sN(n.getParentOrThrow(),t,n.getIndexWithinParent()+(t?0:1)):s}}return null}function Hj(e){const t=Co(e).event,r=t&&t.inputType;return r==="insertFromPaste"||r==="insertFromPasteAsQuotation"}function rr(e,t,r){return(function(n,s,a){const i=Ob(n);for(let l=4;l>=0;l--)for(let c=0;c<i.length;c++){const d=i[c],f=d._commands.get(s);if(f!==void 0){const p=f[l];if(p!==void 0){const g=Array.from(p),y=g.length;let v=!1;if(Hi(d,(()=>{for(let w=0;w<y;w++)if(g[w](a,n))return void(v=!0)})),v)return v}}}return!1})(e,t,r)}function Y1(e){return!Xs(e)&&!e.isLastChild()&&!e.isInline()}function df(e,t){const r=e._keyToDOMMap.get(t);return r===void 0&&Lt(75,t),r}function $p(e){const t=e.assignedSlot||e.parentElement;return J_(t)?t.host:t}function Gj(e){return VB(e)?e:Bn(e)?e.ownerDocument:null}function YB(e){Ea(),rs()._updateTags.add(e)}function JB(e){Ea(),rs()._deferred.push(e)}function X_(e,t){let r=e.getParent();for(;r!==null;){if(r.is(t))return!0;r=r.getParent()}return!1}function $b(e){const t=Gj(e);return t?t.defaultView:null}function Co(e){const t=e._window;return t===null&&Lt(78),t}function QB(e){return vt(e)&&e.isInline()||cn(e)&&e.isInline()}function ZB(e){let t=e.getParentOrThrow();for(;t!==null;){if(mi(t))return t;t=t.getParentOrThrow()}return t}function mi(e){return Xs(e)||vt(e)&&e.isShadowRoot()}function xi(e){const t=rs(),r=e.getType(),n=Db(t,r);n===void 0&&Lt(200,e.constructor.name,r);const{replace:s,replaceWithKlass:a}=n;if(s!==null){const i=s(e),l=i.constructor;return a!==null?i instanceof a||Lt(201,a.name,a.getType(),l.name,l.getType(),e.constructor.name,r):i instanceof e.constructor&&l!==e.constructor||Lt(202,l.name,l.getType(),e.constructor.name,r),i.__key===e.__key&&Lt(203,e.constructor.name,r,l.name,l.getType()),i}return e}function Pw(e,t){!Xs(e.getParent())||vt(t)||cn(t)||Lt(99)}function eU(e){const t=Ls(e);return t===null&&Lt(63,e),t}function Rw(e){return(cn(e)||vt(e)&&!e.canBeEmpty())&&!e.isInline()}function Y_(e,t,r){r.style.removeProperty("caret-color"),t._blockCursorElement=null;const n=e.parentElement;n!==null&&n.removeChild(e)}function tl(e){return rl?(e||window).getSelection():null}function tU(e){const t=$b(e);return t?t.getSelection():null}function Vj(e){return Bn(e)&&e.tagName==="A"}function Bn(e){return E0(e)&&e.nodeType===$L}function E0(e){return typeof e=="object"&&e!==null&&"nodeType"in e&&typeof e.nodeType=="number"}function J_(e){return E0(e)&&e.nodeType===HL}function Q_(e){const t=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return e.nodeName.match(t)!==null}function c1(e){const t=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return e.nodeName.match(t)!==null}function _o(e){if(cn(e)&&!e.isInline())return!0;if(!vt(e)||mi(e))return!1;const t=e.getFirstChild(),r=t===null||Nc(t)||Xt(t)||t.isInline();return!e.isInline()&&e.canBeEmpty()!==!1&&r}function Dw(e,t){let r=e;for(;r!==null&&r.getParent()!==null&&!t(r);)r=r.getParentOrThrow();return t(r)?r:null}function Wp(){return rs()}const aN=new WeakMap,rU=new Map;function iN(e){if(!e._readOnly&&e.isEmpty())return rU;e._readOnly||Lt(192);let t=aN.get(e);return t||(t=(function(r){const n=new Map;for(const[s,a]of r._nodeMap){const i=a.__type;let l=n.get(i);l||(l=new Map,n.set(i,l)),l.set(s,a)}return n})(e),aN.set(e,t)),t}function Wb(e){const t=e.constructor.clone(e);return t.afterCloneFrom(e),t}function zb(e,t){const r=parseInt(e.style.paddingInlineStart,10)||0,n=Math.round(r/40);t.setIndent(n)}function nU(e){e.__lexicalUnmanaged=!0}function sU(e){return e.__lexicalUnmanaged===!0}function wm(e,t){return(function(r,n){return Object.prototype.hasOwnProperty.call(r,n)})(e,t)&&e[t]!==C0[t]}function Hb(e){const t=y4 in e.prototype?e.prototype[y4]():void 0,r=(function(i){return i===jb||i===Xa||i===C0})(e),n=!r&&wm(e,"getType")?e.getType():void 0;let s,a=n;if(t)if(n)s=t[n];else for(const[i,l]of Object.entries(t))a=i,s=l;if(!r&&a&&(wm(e,"getType")||(e.getType=()=>a),wm(e,"clone")||(e.clone=i=>(Rb(i),new e)),wm(e,"importJSON")||(e.importJSON=s&&s.$importJSON||(i=>new e().updateFromJSON(i))),!wm(e,"importDOM")&&s)){const{importDOM:i}=s;i&&(e.importDOM=()=>i)}return{ownNodeConfig:s,ownNodeType:a}}function aU(e){const t=Wp();return Ea(),new(t.resolveRegisteredNodeAfterReplacements(t.getRegisteredNode(e))).klass}const iU={next:"previous",previous:"next"};class Gb{constructor(t){this.origin=t}[Symbol.iterator](){return Yb({hasNext:gf,initial:this.getAdjacentCaret(),map:t=>t,step:t=>t.getAdjacentCaret()})}getAdjacentCaret(){return Fa(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return Fa(this.origin,this.direction)}remove(){const t=this.getNodeAtCaret();return t&&t.remove(),this}replaceOrInsert(t,r){const n=this.getNodeAtCaret();return t.is(this.origin)||t.is(n)||(n===null?this.insert(t):n.replace(t,r)),this}splice(t,r,n="next"){const s=n===this.direction?r:Array.from(r).reverse();let a=this;const i=this.getParentAtCaret(),l=new Map;for(let c=a.getAdjacentCaret();c!==null&&l.size<t;c=c.getAdjacentCaret()){const d=c.origin.getWritable();l.set(d.getKey(),d)}for(const c of s){if(l.size>0){const d=a.getNodeAtCaret();if(d){if(l.delete(d.getKey()),l.delete(c.getKey()),!(d.is(c)||a.origin.is(c))){const f=c.getParent();f&&f.is(i)&&c.remove(),d.replace(c)}}else d===null&&Lt(263,Array.from(l).join(" "))}else a.insert(c);a=Fa(c,this.direction)}for(const c of l.values())c.remove();return this}}class dp extends Gb{type="child";getLatest(){const t=this.origin.getLatest();return t===this.origin?this:To(t,this.direction)}getParentCaret(t="root"){return Fa(Vb(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=j0(this.direction);return Fa(this.getNodeAtCaret(),t)||To(this.origin,t)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(t){return t instanceof dp&&this.direction===t.direction&&this.origin.is(t.origin)}isSamePointCaret(t){return this.isSameNodeCaret(t)}}const oU={root:Xs,shadowRoot:mi};function j0(e){return iU[e]}function Vb(e,t="root"){return oU[t](e)?null:e}class ff extends Gb{type="sibling";getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Fa(t,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return vt(this.origin)?To(this.origin,this.direction):null}getParentCaret(t="root"){return Fa(Vb(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=j0(this.direction);return Fa(this.getNodeAtCaret(),t)||To(this.origin.getParentOrThrow(),t)}isSamePointCaret(t){return t instanceof ff&&this.direction===t.direction&&this.origin.is(t.origin)}isSameNodeCaret(t){return(t instanceof ff||t instanceof hf)&&this.direction===t.direction&&this.origin.is(t.origin)}}class hf extends Gb{type="text";constructor(t,r){super(t),this.offset=r}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:mf(t,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(t="root"){return Fa(Vb(this.getParentAtCaret(),t),this.direction)}getFlipped(){return mf(this.origin,j0(this.direction),this.offset)}isSamePointCaret(t){return t instanceof hf&&this.direction===t.direction&&this.origin.is(t.origin)&&this.offset===t.offset}isSameNodeCaret(t){return(t instanceof ff||t instanceof hf)&&this.direction===t.direction&&this.origin.is(t.origin)}getSiblingCaret(){return Fa(this.origin,this.direction)}}function Lu(e){return e instanceof hf}function gf(e){return e instanceof ff}function Bl(e){return e instanceof dp}const lU={next:class extends hf{direction="next";getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends hf{direction="previous";getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},cU={next:class extends ff{direction="next";getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends ff{direction="previous";getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},uU={next:class extends dp{direction="next";getNodeAtCaret(){return this.origin.getFirstChild()}insert(e){return this.origin.splice(0,0,[e]),this}},previous:class extends dp{direction="previous";getNodeAtCaret(){return this.origin.getLastChild()}insert(e){return this.origin.splice(this.origin.getChildrenSize(),0,[e]),this}}};function Fa(e,t){return e?new cU[t](e):null}function mf(e,t,r){return e?new lU[t](e,Bu(e,r)):null}function Bu(e,t,r="error"){const n=e.getTextContentSize();let s=t==="next"?n:t==="previous"?0:t;return(s<0||s>n)&&(r!=="clamp"&&(function(a,...i){const l=new URL("https://lexical.dev/docs/error"),c=new URLSearchParams;c.append("code",a);for(const d of i)c.append("v",d);l.search=c.toString(),console.warn(`Minified Lexical warning #${a}; visit ${l.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(284,String(t),String(n),e.getKey()),s=s<0?0:n),s}function oN(e,t){return new fU(e,t)}function To(e,t){return vt(e)?new uU[t](e):null}function dU(e){return e&&e.getChildCaret()||e}function Kb(e){return e&&dU(e.getAdjacentCaret())}class qb{type="node-caret-range";constructor(t,r,n){this.anchor=t,this.focus=r,this.direction=n}getLatest(){const t=this.anchor.getLatest(),r=this.focus.getLatest();return t===this.anchor&&r===this.focus?this:new qb(t,r,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const t=s=>{const a=this[s].getLatest();return Lu(a)?(function(i,l){const{direction:c,origin:d}=i,f=Bu(d,l==="focus"?j0(c):c);return oN(i,f-i.offset)})(a,s):null},r=t("anchor"),n=t("focus");if(r&&n){const{caret:s}=r,{caret:a}=n;if(s.isSameNodeCaret(a))return[oN(s,a.offset-s.offset),null]}return[r,n]}iterNodeCarets(t="root"){const r=Lu(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),n=this.focus.getLatest(),s=Lu(n),a=i=>i.isSameNodeCaret(n)?null:Kb(i)||i.getParentCaret(t);return Yb({hasNext:i=>i!==null&&!(s&&n.isSameNodeCaret(i)),initial:r.isSameNodeCaret(n)?null:a(r),map:i=>i,step:a})}[Symbol.iterator](){return this.iterNodeCarets("root")}}class fU{type="slice";constructor(t,r){this.caret=t,this.distance=r}getSliceIndices(){const{distance:t,caret:{offset:r}}=this,n=r+t;return n<r?[n,r]:[r,n]}getTextContent(){const[t,r]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(t,r)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:t,direction:r}}=this,[n,s]=this.getSliceIndices(),a=t.getTextContent();return mf(t.setTextContent(a.slice(0,n)+a.slice(s)),r,n)}}function Xb(e){return Gu(e,Fa(qn(),e.direction))}function hU(e){return Gu(e,e)}function Gu(e,t){return e.direction!==t.direction&&Lt(265),new qb(e,t,e.direction)}function Yb(e){const{initial:t,hasNext:r,step:n,map:s}=e;let a=t;return{[Symbol.iterator](){return this},next(){if(!r(a))return{done:!0,value:void 0};const i={done:!1,value:s(a)};return a=n(a),i}}}function Kj(e,t){const r=Oy(e.origin,t.origin);switch(r===null&&Lt(275,e.origin.getKey(),t.origin.getKey()),r.type){case"same":{const n=e.type==="text",s=t.type==="text";return n&&s?(function(a,i){return Math.sign(a-i)})(e.offset,t.offset):e.type===t.type?0:n?-1:s?1:e.type==="child"?-1:1}case"ancestor":return e.type==="child"?-1:1;case"descendant":return t.type==="child"?1:-1;case"branch":return qj(r)}}function qj(e){const{a:t,b:r}=e,n=t.__key,s=r.__key;let a=t,i=r;for(;a&&i;a=a.getNextSibling(),i=i.getNextSibling()){if(a.__key===s)return-1;if(i.__key===n)return 1}return a===null?1:-1}function gy(e,t){return t.is(e)}function lN(e){return vt(e)?[e.getLatest(),null]:[e.getParent(),e.getLatest()]}function Oy(e,t){if(e.is(t))return{commonAncestor:e,type:"same"};const r=new Map;for(let[n,s]=lN(e);n;s=n,n=n.getParent())r.set(n,s);for(let[n,s]=lN(t);n;s=n,n=n.getParent()){const a=r.get(n);if(a!==void 0)return a===null?(gy(e,n)||Lt(276),{commonAncestor:n,type:"ancestor"}):s===null?(gy(t,n)||Lt(277),{commonAncestor:n,type:"descendant"}):((vt(a)||gy(e,a))&&(vt(s)||gy(t,s))&&n.is(a.getParent())&&n.is(s.getParent())||Lt(278),{a,b:s,commonAncestor:n,type:"branch"})}return null}function Dc(e,t){const{type:r,key:n,offset:s}=e,a=eU(e.key);return r==="text"?(Xt(a)||Lt(266,a.getType(),n),mf(a,t,s)):(vt(a)||Lt(267,a.getType(),n),pU(a,e.offset,t))}function pf(e,t){const{origin:r,direction:n}=t,s=n==="next";Lu(t)?e.set(r.getKey(),t.offset,"text"):gf(t)?Xt(r)?e.set(r.getKey(),Bu(r,n),"text"):e.set(r.getParentOrThrow().getKey(),r.getIndexWithinParent()+(s?1:0),"element"):(Bl(t)&&vt(r)||Lt(268),e.set(r.getKey(),s?0:r.getChildrenSize(),"element"))}function gU(e){const t=qt(),r=At(t)?t:H1();return Ly(r,e),Pa(r),r}function Ly(e,t){pf(e.anchor,t.anchor),pf(e.focus,t.focus)}function cN(e){const{anchor:t,focus:r}=e,n=Dc(t,"next"),s=Dc(r,"next"),a=Kj(n,s)<=0?"next":"previous";return Gu(h0(n,a),h0(s,a))}function Jb(e){const{direction:t,origin:r}=e,n=Fa(r,j0(t)).getNodeAtCaret();return n?Fa(n,t):To(r.getParentOrThrow(),t)}function uN(e,t="root"){const r=[e];for(let n=Bl(e)?e.getParentCaret(t):e.getSiblingCaret();n!==null;n=n.getParentCaret(t))r.push(Jb(n));return r}function Iw(e){return!!e&&e.origin.isAttached()}function mU(e,t="removeEmptySlices"){if(e.isCollapsed())return e;const r="root",n="next";let s=t;const a=Yj(e,n),i=uN(a.anchor,r),l=uN(a.focus.getFlipped(),r),c=new Set,d=[];for(const v of a.iterNodeCarets(r))if(Bl(v))c.add(v.origin.getKey());else if(gf(v)){const{origin:w}=v;vt(w)&&!c.has(w.getKey())||d.push(w)}for(const v of d)v.remove();for(const v of a.getTextSlices()){if(!v)continue;const{origin:w}=v.caret,b=w.getTextContentSize(),E=Jb(Fa(w,n)),k=w.getMode();if(Math.abs(v.distance)===b&&s==="removeEmptySlices"||k==="token"&&v.distance!==0)E.remove();else if(v.distance!==0){s="removeEmptySlices";let _=v.removeTextSlice();const T=v.caret.origin;if(k==="segmented"){const j=_.origin,P=cs(j.getTextContent()).setStyle(j.getStyle()).setFormat(j.getFormat());E.replaceOrInsert(P),_=mf(P,n,_.offset)}T.is(i[0].origin)&&(i[0]=_),T.is(l[0].origin)&&(l[0]=_.getFlipped())}}let f,p;for(const v of i)if(Iw(v)){f=bo(v);break}for(const v of l)if(Iw(v)){p=bo(v);break}const g=(function(v,w,b){if(!v||!w)return null;const E=v.getParentAtCaret(),k=w.getParentAtCaret();if(!E||!k)return null;const _=E.getParents().reverse();_.push(E);const T=k.getParents().reverse();T.push(k);const j=Math.min(_.length,T.length);let P;for(P=0;P<j&&_[P]===T[P];P++);const R=(M,H)=>{let Q;for(let Z=P;Z<M.length;Z++){const ae=M[Z];if(mi(ae))return;!Q&&H(ae)&&(Q=ae)}return Q},N=R(_,_o),A=N&&R(T,(M=>b.has(M.getKey())&&_o(M)));return N&&A?[N,A]:null})(f,p,c);if(g){const[v,w]=g;To(v,"previous").splice(0,w.getChildren()),w.remove()}const y=[f,p,...i,...l].find(Iw);if(y)return hU(h0(bo(y),e.direction));Lt(269,JSON.stringify(i.map((v=>v.origin.__key))))}function bo(e){const t=(function(s){let a=s;for(;Bl(a);){const i=Kb(a);if(!Bl(i))break;a=i}return a})(e.getLatest()),{direction:r}=t;if(Xt(t.origin))return Lu(t)?t:mf(t.origin,r,r);const n=t.getAdjacentCaret();return gf(n)&&Xt(n.origin)?mf(n.origin,r,j0(r)):t}function Xj(e){return Lu(e)&&e.offset!==Bu(e.origin,e.direction)}function h0(e,t){return e.direction===t?e:e.getFlipped()}function Yj(e,t){return e.direction===t?e:Gu(h0(e.focus,t),h0(e.anchor,t))}function pU(e,t,r){let n=To(e,"next");for(let s=0;s<t;s++){const a=n.getAdjacentCaret();if(a===null)break;n=a}return h0(n,r)}const Jj=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,xU=Jj?C.useLayoutEffect:C.useEffect,my={tag:$m};function Qj({initialConfig:e,children:t}){const r=C.useMemo((()=>{const{theme:n,namespace:s,nodes:a,onError:i,editorState:l,html:c}=e,d=LL(null,n),f=zB({editable:e.editable,html:c,namespace:s,nodes:a,onError:p=>i(p,f),theme:n});return(function(p,g){if(g!==null){if(g===void 0)p.update((()=>{const y=qn();if(y.isEmpty()){const v=Ln();y.append(v);const w=Jj?document.activeElement:null;(qt()!==null||w!==null&&w===p.getRootElement())&&v.select()}}),my);else if(g!==null)switch(typeof g){case"string":{const y=p.parseEditorState(g);p.setEditorState(y,my);break}case"object":p.setEditorState(g,my);break;case"function":p.update((()=>{qn().isEmpty()&&g(p)}),my)}}})(f,l),[f,d]}),[]);return xU((()=>{const n=e.editable,[s]=r;s.setEditable(n===void 0||n)}),[]),o.jsx(k0.Provider,{value:r,children:t})}const yU=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function vU(e){return{initialValueFn:()=>e.isEditable(),subscribe:t=>e.registerEditableListener(t)}}function wU(){return(function(e){const[t]=Wl(),r=C.useMemo((()=>e(t)),[t,e]),[n,s]=C.useState((()=>r.initialValueFn())),a=C.useRef(n);return yU((()=>{const{initialValueFn:i,subscribe:l}=r,c=i();return a.current!==c&&(a.current=c,s(c)),l((d=>{a.current=d,s(d)}))}),[r,e]),n})(vU)}function _U(){return qn().getTextContent()}function bU(e,t=!0){if(e)return!1;let r=_U();return t&&(r=r.trim()),r===""}function SU(e){if(!bU(e,!1))return!1;const t=qn().getChildren(),r=t.length;if(r>1)return!1;for(let n=0;n<r;n++){const s=t[n];if(cn(s))return!1;if(vt(s)){if(!Pb(s)||s.__indent!==0)return!1;const a=s.getChildren(),i=a.length;for(let l=0;l<i;l++){const c=a[n];if(!Xt(c))return!1}}}return!0}function Zj(e){return()=>SU(e)}const Z_=new Map;function eA(e){const t={};if(!e)return t;const r=e.split(";");for(const n of r)if(n!==""){const[s,a]=n.split(/:([^]+)/);s&&a&&(t[s.trim()]=a.trim())}return t}function dN(e){let t=Z_.get(e);return t===void 0&&(t=eA(e),Z_.set(e,t)),t}function tA(e){const t=Wp().getElementByKey(e.getKey());if(t===null)return null;const r=t.ownerDocument.defaultView;return r===null?null:r.getComputedStyle(t)}function rA(e){return tA(Xs(e)?e:e.getParentOrThrow())}function fN(e){const t=rA(e);return t!==null&&t.direction==="rtl"}function nA(e,t){const r=e.getStartEndPoints();if(t.isSelected(e)&&!bc(t)&&r!==null){const[n,s]=r,a=e.isBackward(),i=n.getNode(),l=s.getNode(),c=t.is(i),d=t.is(l);if(c||d){const[f,p]=G_(e),g=i.is(l),y=t.is(a?l:i),v=t.is(a?i:l);let w,b=0;g?(b=f>p?p:f,w=f>p?f:p):y?(b=a?p:f,w=void 0):v&&(b=0,w=a?f:p),t.__text=t.__text.slice(b,w)}}return t}function kU(e){const t=e.getStyle(),r=eA(t);Z_.set(t,r)}function CU(e,t){const r=e.getFormatType(),n=e.getIndent();r!==t.getFormatType()&&t.setFormat(r),n!==t.getIndent()&&t.setIndent(n)}function t0(e,t,r=CU){if(e===null)return;const n=e.getStartEndPoints(),s=new Map;let a=null;if(n){const[i,l]=n;a=H1(),a.anchor.set(i.key,i.offset,i.type),a.focus.set(l.key,l.offset,l.type);const c=Mw(i.getNode(),_o),d=Mw(l.getNode(),_o);vt(c)&&s.set(c.getKey(),c),vt(d)&&s.set(d.getKey(),d)}for(const i of e.getNodes())if(vt(i)&&_o(i))s.set(i.getKey(),i);else if(n===null){const l=Mw(i,_o);vt(l)&&s.set(l.getKey(),l)}for(const[i,l]of s){const c=t();r(l,c),l.replace(c,!0),a&&(i===a.anchor.key&&a.anchor.set(c.getKey(),a.anchor.offset,a.anchor.type),i===a.focus.key&&a.focus.set(c.getKey(),a.focus.offset,a.focus.type))}a&&e.is(qt())&&Pa(a)}function sA(e){const t=aA(e);return t!==null&&t.writingMode==="vertical-rl"}function aA(e){const t=e.anchor.getNode();return vt(t)?tA(t):rA(t)}function hN(e,t){let r=sA(e)?!t:t;iA(e)&&(r=!r);const n=Dc(e.focus,r?"previous":"next");if(Xj(n))return!1;for(const s of Xb(n)){if(Bl(s))return!s.origin.isInline();if(!vt(s.origin)){if(cn(s.origin))return!0;break}}return!1}function TU(e,t,r,n){e.modify(t?"extend":"move",r,n)}function iA(e){const t=aA(e);return t!==null&&t.direction==="rtl"}function gN(e,t,r){const n=iA(e);let s;s=sA(e)||n?!r:r,TU(e,t,s,"character")}function Mw(e,t){let r=e;for(;r!==null&&r.getParent()!==null&&!t(r);)r=r.getParentOrThrow();return t(r)?r:null}function NU(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const oA=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,EU=oA&&"documentMode"in document?document.documentMode:null;!(!oA||!("InputEvent"in window)||EU)&&"getTargetRanges"in new window.InputEvent("input");function lA(...e){const t=[];for(const r of e)if(r&&typeof r=="string")for(const[n]of r.matchAll(/\S+/g))t.push(n);return t}function Cf(...e){return()=>{for(let t=e.length-1;t>=0;t--)e[t]();e.length=0}}function Ks(e,...t){const r=lA(...t);r.length>0&&e.classList.add(...r)}function Uu(e,...t){const r=lA(...t);r.length>0&&e.classList.remove(...r)}function jU(e){return e?e.getAdjacentCaret():null}function AU(e,t){let r=e;for(;r!=null;){if(r instanceof t)return r;r=r.getParent()}return null}function FU(e){const t=J1(e,(r=>vt(r)&&!r.isInline()));return vt(t)||NU(4,e.__key),t}const J1=(e,t)=>{let r=e;for(;r!==qn()&&r!=null;){if(t(r))return r;r=r.getParent()}return null};function Gd(e,t){return e!==null&&Object.getPrototypeOf(e).constructor.name===t.name}function cA(e,t){const r=[],n=Array.from(e).reverse();for(let s=n.pop();s!==void 0;s=n.pop())if(t(s))r.push(s);else if(vt(s))for(const a of PU(s))n.push(a);return r}function PU(e){return RU(To(e,"previous"))}function RU(e){return Yb({hasNext:gf,initial:e.getAdjacentCaret(),map:t=>t.origin.getLatest(),step:t=>t.getAdjacentCaret()})}function DU(e){const t=window.location.origin,r=n=>{if(n.origin!==t)return;const s=e.getRootElement();if(document.activeElement!==s)return;const a=n.data;if(typeof a=="string"){let i;try{i=JSON.parse(a)}catch{return}if(i&&i.protocol==="nuanria_messaging"&&i.type==="request"){const l=i.payload;if(l&&l.functionId==="makeChanges"){const c=l.args;if(c){const[d,f,p,g,y,v]=c;e.update((()=>{const w=qt();if(At(w)){const b=w.anchor;let E=b.getNode(),k=0,_=0;if(Xt(E)&&d>=0&&f>=0&&(k=d,_=d+f,w.setTextNodeRange(E,k,E,_)),k===_&&p===""||(w.insertRawText(p),E=b.getNode()),Xt(E)){k=g,_=g+y;const T=E.getTextContentSize();k=k>T?T:k,_=_>T?T:_,w.setTextNodeRange(E,k,E,_)}n.stopImmediatePropagation()}}))}}}}};return window.addEventListener("message",r,!0),()=>{window.removeEventListener("message",r,!0)}}function IU(e,t){const r=t.body?t.body.childNodes:[];let n=[];const s=[];for(let a=0;a<r.length;a++){const i=r[a];if(!dA.has(i.nodeName)){const l=fA(i,e,s,!1);l!==null&&(n=n.concat(l))}}return(function(a){for(const i of a)i.getNextSibling()instanceof Fb&&i.insertAfter(Ul());for(const i of a){const l=i.getChildren();for(const c of l)i.insertBefore(c);i.remove()}})(s),n}function MU(e,t){if(typeof document>"u"||typeof window>"u"&&global.window===void 0)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const r=document.createElement("div"),n=qn().getChildren();for(let s=0;s<n.length;s++)uA(e,n[s],r,t);return r.innerHTML}function uA(e,t,r,n=null){let s=n===null||t.isSelected(n);const a=vt(t)&&t.excludeFromCopy("html");let i=t;if(n!==null){let y=Wb(t);y=Xt(y)&&n!==null?nA(n,y):y,i=y}const l=vt(i)?i.getChildren():[],c=Db(e,i.getType());let d;d=c&&c.exportDOM!==void 0?c.exportDOM(e,i):i.exportDOM(e);const{element:f,after:p}=d;if(!f)return!1;const g=document.createDocumentFragment();for(let y=0;y<l.length;y++){const v=l[y],w=uA(e,v,g,n);!s&&vt(t)&&w&&t.extractWithChild(v,n,"html")&&(s=!0)}if(s&&!a){if((Bn(f)||J_(f))&&f.append(g),r.append(f),p){const y=p.call(i,f);y&&(J_(f)?f.replaceChildren(y):f.replaceWith(y))}}else r.append(g);return s}const dA=new Set(["STYLE","SCRIPT"]);function fA(e,t,r,n,s=new Map,a){let i=[];if(dA.has(e.nodeName))return i;let l=null;const c=(function(v,w){const{nodeName:b}=v,E=w._htmlConversions.get(b.toLowerCase());let k=null;if(E!==void 0)for(const _ of E){const T=_(v);T!==null&&(k===null||(k.priority||0)<=(T.priority||0))&&(k=T)}return k!==null?k.conversion:null})(e,t),d=c?c(e):null;let f=null;if(d!==null){f=d.after;const v=d.node;if(l=Array.isArray(v)?v[v.length-1]:v,l!==null){for(const[,w]of s)if(l=w(l,a),!l)break;l&&i.push(...Array.isArray(v)?v:[l])}d.forChild!=null&&s.set(e.nodeName,d.forChild)}const p=e.childNodes;let g=[];const y=(l==null||!mi(l))&&(l!=null&&V_(l)||n);for(let v=0;v<p.length;v++)g.push(...fA(p[v],t,r,y,new Map(s),l));return f!=null&&(g=f(g)),c1(e)&&(g=OU(e,g,y?()=>{const v=new Fb;return r.push(v),v}:Ln)),l==null?g.length>0?i=i.concat(g):c1(e)&&(function(v){return v.nextSibling==null||v.previousSibling==null?!1:Q_(v.nextSibling)&&Q_(v.previousSibling)})(e)&&(i=i.concat(Ul())):vt(l)&&l.append(...g),i}function OU(e,t,r){const n=e.style.textAlign,s=[];let a=[];for(let i=0;i<t.length;i++){const l=t[i];if(V_(l))n&&!l.getFormat()&&l.setFormat(n),s.push(l);else if(a.push(l),i===t.length-1||i<t.length-1&&V_(t[i+1])){const c=r();c.setFormat(n),c.append(...a),s.push(c),a=[]}}return s}function u1(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function LU(e,t=qt()){return t==null&&u1(166),At(t)&&t.isCollapsed()||t.getNodes().length===0?"":MU(e,t)}function BU(e,t=qt()){return t==null&&u1(166),At(t)&&t.isCollapsed()||t.getNodes().length===0?null:JSON.stringify(UU(e,t))}function mN(e,t,r){const n=e.getData("application/x-lexical-editor");if(n)try{const l=JSON.parse(n);if(l.namespace===r._config.namespace&&Array.isArray(l.nodes))return pN(r,$U(l.nodes),t)}catch{}const s=e.getData("text/html"),a=e.getData("text/plain");if(s&&a!==s)try{const l=new DOMParser().parseFromString((function(c){return window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("lexical",{createHTML:d=>d}).createHTML(c):c})(s),"text/html");return pN(r,IU(r,l),t)}catch{}const i=a||e.getData("text/uri-list");if(i!=null)if(At(t)){const l=i.split(/(\r?\n|\t)/);l[l.length-1]===""&&l.pop();for(let c=0;c<l.length;c++){const d=qt();if(At(d)){const f=l[c];f===`
`||f===`\r
`?d.insertParagraph():f==="	"?d.insertNodes([T0()]):d.insertText(f)}}}else t.insertRawText(i)}function pN(e,t,r){e.dispatchCommand(dB,{nodes:t,selection:r})||(r.insertNodes(t),(function(n){if(At(n)&&n.isCollapsed()){const s=n.anchor;let a=null;const i=Dc(s,"previous");if(i)if(Lu(i))a=i.origin;else{const l=Gu(i,To(qn(),"next").getFlipped());for(const c of l){if(Xt(c.origin)){a=c.origin;break}if(vt(c.origin)&&!c.origin.isInline())break}}if(a&&Xt(a)){const l=a.getFormat(),c=a.getStyle();n.format===l&&n.style===c||(n.format=l,n.style=c,n.dirty=!0)}}})(r))}function hA(e,t,r,n=[]){let s=t===null||r.isSelected(t);const a=vt(r)&&r.excludeFromCopy("html");let i=r;if(t!==null){let d=Wb(r);d=Xt(d)&&t!==null?nA(t,d):d,i=d}const l=vt(i)?i.getChildren():[],c=(function(d){const f=d.exportJSON(),p=d.constructor;if(f.type!==p.getType()&&u1(58,p.name),vt(d)){const g=f.children;Array.isArray(g)||u1(59,p.name)}return f})(i);if(Xt(i)){const d=i.__text;d.length>0?c.text=d:s=!1}for(let d=0;d<l.length;d++){const f=l[d],p=hA(e,t,f,c.children);!s&&vt(r)&&p&&r.extractWithChild(f,t,"clone")&&(s=!0)}if(s&&!a)n.push(c);else if(Array.isArray(c.children))for(let d=0;d<c.children.length;d++){const f=c.children[d];n.push(f)}return s}function UU(e,t){const r=[],n=qn().getChildren();for(let s=0;s<n.length;s++)hA(e,t,n[s],r);return{namespace:e._config.namespace,nodes:r}}function $U(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r],s=MB(n);Xt(s)&&kU(s),t.push(s)}return t}let Eh=null;async function xN(e,t,r){if(Eh!==null)return!1;if(t!==null)return new Promise(((d,f)=>{e.update((()=>{d(yN(e,t,r))}))}));const n=e.getRootElement(),s=e._window||window,a=window.document,i=tl(s);if(n===null||i===null)return!1;const l=a.createElement("span");l.style.cssText="position: fixed; top: -1000px;",l.append(a.createTextNode("#")),n.append(l);const c=new Range;return c.setStart(l,0),c.setEnd(l,1),i.removeAllRanges(),i.addRange(c),new Promise(((d,f)=>{const p=e.registerCommand($1,(g=>(Gd(g,ClipboardEvent)&&(p(),Eh!==null&&(window.clearTimeout(Eh),Eh=null),d(yN(e,g,r))),!0)),WB);Eh=window.setTimeout((()=>{p(),Eh=null,d(!1)}),50),a.execCommand("copy"),l.remove()}))}function yN(e,t,r){if(r===void 0){const s=tl(e._window);if(!s)return!1;const a=s.anchorNode,i=s.focusNode;if(a!==null&&i!==null&&!Up(e,a,i))return!1;const l=qt();if(l===null)return!1;r=zU(l)}t.preventDefault();const n=t.clipboardData;return n!==null&&(HU(n,r),!0)}const WU=[["text/html",LU],["application/x-lexical-editor",BU]];function zU(e=qt()){const t={"text/plain":e?e.getTextContent():""};if(e){const r=Wp();for(const[n,s]of WU){const a=s(r,e);a!==null&&(t[n]=a)}}return t}function HU(e,t){for(const r in t){const n=t[r];n!==void 0&&e.setData(r,n)}}function vN(e,t){if(document.caretRangeFromPoint!==void 0){const r=document.caretRangeFromPoint(e,t);return r===null?null:{node:r.startContainer,offset:r.startOffset}}if(document.caretPositionFromPoint!=="undefined"){const r=document.caretPositionFromPoint(e,t);return r===null?null:{node:r.offsetNode,offset:r.offset}}return null}const A0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,GU=A0&&"documentMode"in document?document.documentMode:null,VU=!(!A0||!("InputEvent"in window)||GU)&&"getTargetRanges"in new window.InputEvent("input"),KU=A0&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),wN=A0&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,qU=A0&&/^(?=.*Chrome).*/i.test(navigator.userAgent),XU=A0&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!qU,_N=Tr("DRAG_DROP_PASTE_FILE");let zp=class gA extends Xa{static getType(){return"quote"}static clone(t){return new gA(t.__key)}createDOM(t){const r=document.createElement("blockquote");return Ks(r,t.theme.quote),r}updateDOM(t,r){return!1}static importDOM(){return{blockquote:t=>({conversion:YU,priority:0})}}exportDOM(t){const{element:r}=super.exportDOM(t);if(Bn(r)){this.isEmpty()&&r.append(document.createElement("br"));const n=this.getFormatType();n&&(r.style.textAlign=n);const s=this.getDirection();s&&(r.dir=s)}return{element:r}}static importJSON(t){return Hp().updateFromJSON(t)}insertNewAfter(t,r){const n=Ln(),s=this.getDirection();return n.setDirection(s),this.insertAfter(n,r),n}collapseAtStart(){const t=Ln();return this.getChildren().forEach((r=>t.append(r))),this.replace(t),!0}canMergeWhenEmpty(){return!0}};function Hp(){return xi(new zp)}function bN(e){return e instanceof zp}let Gp=class mA extends Xa{static getType(){return"heading"}static clone(t){return new mA(t.__tag,t.__key)}constructor(t,r){super(r),this.__tag=t}getTag(){return this.__tag}setTag(t){const r=this.getWritable();return this.__tag=t,r}createDOM(t){const r=this.__tag,n=document.createElement(r),s=t.theme.heading;if(s!==void 0){const a=s[r];Ks(n,a)}return n}updateDOM(t,r,n){return t.__tag!==this.__tag}static importDOM(){return{h1:t=>({conversion:jh,priority:0}),h2:t=>({conversion:jh,priority:0}),h3:t=>({conversion:jh,priority:0}),h4:t=>({conversion:jh,priority:0}),h5:t=>({conversion:jh,priority:0}),h6:t=>({conversion:jh,priority:0}),p:t=>{const r=t.firstChild;return r!==null&&SN(r)?{conversion:()=>({node:null}),priority:3}:null},span:t=>SN(t)?{conversion:r=>({node:Ru("h1")}),priority:3}:null}}exportDOM(t){const{element:r}=super.exportDOM(t);if(Bn(r)){this.isEmpty()&&r.append(document.createElement("br"));const n=this.getFormatType();n&&(r.style.textAlign=n);const s=this.getDirection();s&&(r.dir=s)}return{element:r}}static importJSON(t){return Ru(t.tag).updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setTag(t.tag)}exportJSON(){return{...super.exportJSON(),tag:this.getTag()}}insertNewAfter(t,r=!0){const n=t?t.anchor.offset:0,s=this.getLastDescendant(),a=!s||t&&t.anchor.key===s.getKey()&&n===s.getTextContentSize()||!t?Ln():Ru(this.getTag()),i=this.getDirection();if(a.setDirection(i),this.insertAfter(a,r),n===0&&!this.isEmpty()&&t){const l=Ln();l.select(),this.replace(l,!0)}return a}collapseAtStart(){const t=this.isEmpty()?Ln():Ru(this.getTag());return this.getChildren().forEach((r=>t.append(r))),this.replace(t),!0}extractWithChild(){return!0}};function SN(e){return e.nodeName.toLowerCase()==="span"&&e.style.fontSize==="26pt"}function jh(e){const t=e.nodeName.toLowerCase();let r=null;return t!=="h1"&&t!=="h2"&&t!=="h3"&&t!=="h4"&&t!=="h5"&&t!=="h6"||(r=Ru(t),e.style!==null&&(zb(e,r),r.setFormat(e.style.textAlign))),{node:r}}function YU(e){const t=Hp();return e.style!==null&&(t.setFormat(e.style.textAlign),zb(e,t)),{node:t}}function Ru(e="h1"){return xi(new Gp(e))}function JU(e){return e instanceof Gp}function py(e){let t=null;if(Gd(e,DragEvent)?t=e.dataTransfer:Gd(e,ClipboardEvent)&&(t=e.clipboardData),t===null)return[!1,[],!1];const r=t.types,n=r.includes("Files"),s=r.includes("text/html")||r.includes("text/plain");return[n,Array.from(t.files),s]}function kN(e){const t=qt();if(!At(t))return!1;const r=new Set,n=t.getNodes();for(let s=0;s<n.length;s++){const a=n[s],i=a.getKey();if(r.has(i))continue;const l=J1(a,(d=>vt(d)&&!d.isInline()));if(l===null)continue;const c=l.getKey();l.canIndent()&&!r.has(c)&&(r.add(c),e(l))}return r.size>0}function CN(e){const t=Hu(e);return cn(t)}function Ow(e){for(const t of["lowercase","uppercase","capitalize"])e.hasFormat(t)&&e.toggleFormat(t)}function QU(e){return Cf(e.registerCommand(wb,(t=>{const r=qt();return!!Ua(r)&&(r.clear(),!0)}),tn),e.registerCommand(Yd,(t=>{const r=qt();return At(r)?(r.deleteCharacter(t),!0):!!Ua(r)&&(r.deleteNodes(),!0)}),tn),e.registerCommand(cp,(t=>{const r=qt();return!!At(r)&&(r.deleteWord(t),!0)}),tn),e.registerCommand(up,(t=>{const r=qt();return!!At(r)&&(r.deleteLine(t),!0)}),tn),e.registerCommand(Qh,(t=>{const r=qt();if(typeof t=="string")r!==null&&r.insertText(t);else{if(r===null)return!1;const n=t.dataTransfer;if(n!=null)mN(n,r,e);else if(At(r)){const s=t.data;return s&&r.insertText(s),!0}}return!0}),tn),e.registerCommand(L_,(()=>{const t=qt();return!!At(t)&&(t.removeText(),!0)}),tn),e.registerCommand(Va,(t=>{const r=qt();return!!At(r)&&(r.formatText(t),!0)}),tn),e.registerCommand(dj,(t=>{const r=qt();if(!At(r)&&!Ua(r))return!1;const n=r.getNodes();for(const s of n){const a=J1(s,(i=>vt(i)&&!i.isInline()));a!==null&&a.setFormat(t)}return!0}),tn),e.registerCommand(Jh,(t=>{const r=qt();return!!At(r)&&(r.insertLineBreak(t),!0)}),tn),e.registerCommand(lp,(()=>{const t=qt();return!!At(t)&&(t.insertParagraph(),!0)}),tn),e.registerCommand(mB,(()=>(RB([T0()]),!0)),tn),e.registerCommand(pB,(()=>kN((t=>{const r=t.getIndent();t.setIndent(r+1)}))),tn),e.registerCommand(E4,(()=>kN((t=>{const r=t.getIndent();r>0&&t.setIndent(Math.max(0,r-1))}))),tn),e.registerCommand(nj,(t=>{const r=qt();if(Ua(r)){const n=r.getNodes();if(n.length>0)return n[0].selectPrevious(),!0}else if(At(r)){const n=q_(r.focus,!0);if(!t.shiftKey&&cn(n)&&!n.isIsolated()&&!n.isInline())return n.selectPrevious(),t.preventDefault(),!0}return!1}),tn),e.registerCommand(sj,(t=>{const r=qt();if(Ua(r)){const n=r.getNodes();if(n.length>0)return n[0].selectNext(0,0),!0}else if(At(r)){if((function(s){const a=s.focus;return a.key==="root"&&a.offset===qn().getChildrenSize()})(r))return t.preventDefault(),!0;const n=q_(r.focus,!1);if(!t.shiftKey&&cn(n)&&!n.isIsolated()&&!n.isInline())return n.selectNext(),t.preventDefault(),!0}return!1}),tn),e.registerCommand(rj,(t=>{const r=qt();if(Ua(r)){const n=r.getNodes();if(n.length>0)return t.preventDefault(),fN(n[0])?n[0].selectNext(0,0):n[0].selectPrevious(),!0}if(!At(r))return!1;if(hN(r,!0)){const n=t.shiftKey;return t.preventDefault(),gN(r,n,!0),!0}return!1}),tn),e.registerCommand(tj,(t=>{const r=qt();if(Ua(r)){const s=r.getNodes();if(s.length>0)return t.preventDefault(),fN(s[0])?s[0].selectPrevious():s[0].selectNext(0,0),!0}if(!At(r))return!1;const n=t.shiftKey;return!!hN(r,!1)&&(t.preventDefault(),gN(r,n,!1),!0)}),tn),e.registerCommand(ij,(t=>{if(CN(t.target))return!1;const r=qt();if(At(r)){if((function(n){if(!n.isCollapsed())return!1;const{anchor:s}=n;if(s.offset!==0)return!1;const a=s.getNode();if(Xs(a))return!1;const i=FU(a);return i.getIndent()>0&&(i.is(a)||a.is(i.getFirstDescendant()))})(r))return t.preventDefault(),e.dispatchCommand(E4,void 0);if(wN&&navigator.language==="ko-KR")return!1}else if(!Ua(r))return!1;return t.preventDefault(),e.dispatchCommand(Yd,!0)}),tn),e.registerCommand(lj,(t=>{if(CN(t.target))return!1;const r=qt();return!(!At(r)&&!Ua(r))&&(t.preventDefault(),e.dispatchCommand(Yd,!1))}),tn),e.registerCommand(r1,(t=>{const r=qt();if(!At(r))return!1;if(Ow(r),t!==null){if((wN||KU||XU)&&VU)return!1;if(t.preventDefault(),t.shiftKey)return e.dispatchCommand(Jh,!1)}return e.dispatchCommand(lp,void 0)}),tn),e.registerCommand(oj,(()=>{const t=qt();return!!At(t)&&(e.blur(),!0)}),tn),e.registerCommand(uj,(t=>{const[,r]=py(t);if(r.length>0){const s=vN(t.clientX,t.clientY);if(s!==null){const{offset:a,node:i}=s,l=Hu(i);if(l!==null){const c=H1();if(Xt(l))c.anchor.set(l.getKey(),a,"text"),c.focus.set(l.getKey(),a,"text");else{const f=l.getParentOrThrow().getKey(),p=l.getIndexWithinParent()+1;c.anchor.set(f,p,"element"),c.focus.set(f,p,"element")}const d=Jy(c);Pa(d)}e.dispatchCommand(_N,r)}return t.preventDefault(),!0}const n=qt();return!!At(n)}),tn),e.registerCommand(fj,(t=>{const[r]=py(t),n=qt();return!(r&&!At(n))}),tn),e.registerCommand(hj,(t=>{const[r]=py(t),n=qt();if(r&&!At(n))return!1;const s=vN(t.clientX,t.clientY);if(s!==null){const a=Hu(s.node);cn(a)&&t.preventDefault()}return!0}),tn),e.registerCommand(B_,(()=>(XB(),!0)),tn),e.registerCommand($1,(t=>(xN(e,Gd(t,ClipboardEvent)?t:null),!0)),tn),e.registerCommand(kb,(t=>((async function(r,n){await xN(n,Gd(r,ClipboardEvent)?r:null),n.update((()=>{const s=qt();At(s)?s.removeText():Ua(s)&&s.getNodes().forEach((a=>a.remove()))}))})(t,e),!0)),tn),e.registerCommand(_b,(t=>{const[,r,n]=py(t);return r.length>0&&!n?(e.dispatchCommand(_N,r),!0):E0(t.target)&&Ib(t.target)?!1:qt()!==null&&((function(s,a){s.preventDefault(),a.update((()=>{const i=qt(),l=Gd(s,InputEvent)||Gd(s,KeyboardEvent)?null:s.clipboardData;l!=null&&i!==null&&mN(l,i,a)}),{tag:LB})})(t,e),!0)}),tn),e.registerCommand(aj,(t=>{const r=qt();return At(r)&&Ow(r),!1}),tn),e.registerCommand(cj,(t=>{const r=qt();return At(r)&&Ow(r),!1}),tn))}const e2=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function TN(e){return e.getEditorState().read(Zj(e.isComposing()))}function pA({contentEditable:e,placeholder:t=null,ErrorBoundary:r}){const[n]=Wl(),s=(function(a,i){const[l,c]=C.useState((()=>a.getDecorators()));return e2((()=>a.registerDecoratorListener((d=>{Fk.flushSync((()=>{c(d)}))}))),[a]),C.useEffect((()=>{c(a.getDecorators())}),[a]),C.useMemo((()=>{const d=[],f=Object.keys(l);for(let p=0;p<f.length;p++){const g=f[p],y=o.jsx(i,{onError:w=>a._onError(w),children:o.jsx(C.Suspense,{fallback:null,children:l[g]})}),v=a.getElementByKey(g);v!==null&&d.push(Fk.createPortal(y,v,g))}return d}),[i,l,a])})(n,r);return(function(a){e2((()=>Cf(QU(a),DU(a))),[a])})(n),o.jsxs(o.Fragment,{children:[e,o.jsx(ZU,{content:t}),s]})}function ZU({content:e}){const[t]=Wl(),r=(function(s){const[a,i]=C.useState((()=>TN(s)));return e2((()=>{function l(){const c=TN(s);i(c)}return l(),Cf(s.registerUpdateListener((()=>{l()})),s.registerEditableListener((()=>{l()})))}),[s]),a})(t),n=wU();return r?typeof e=="function"?e(n):e:null}const xA=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function e$({editor:e,ariaActiveDescendant:t,ariaAutoComplete:r,ariaControls:n,ariaDescribedBy:s,ariaErrorMessage:a,ariaExpanded:i,ariaInvalid:l,ariaLabel:c,ariaLabelledBy:d,ariaMultiline:f,ariaOwns:p,ariaRequired:g,autoCapitalize:y,className:v,id:w,role:b="textbox",spellCheck:E=!0,style:k,tabIndex:_,"data-testid":T,...j},P){const[R,N]=C.useState(e.isEditable()),A=C.useCallback((H=>{H&&H.ownerDocument&&H.ownerDocument.defaultView?e.setRootElement(H):e.setRootElement(null)}),[e]),M=C.useMemo((()=>(function(...H){return Q=>{H.forEach((Z=>{typeof Z=="function"?Z(Q):Z!=null&&(Z.current=Q)}))}})(P,A)),[A,P]);return xA((()=>(N(e.isEditable()),e.registerEditableListener((H=>{N(H)})))),[e]),o.jsx("div",{"aria-activedescendant":R?t:void 0,"aria-autocomplete":R?r:"none","aria-controls":R?n:void 0,"aria-describedby":s,...a!=null?{"aria-errormessage":a}:{},"aria-expanded":R&&b==="combobox"?!!i:void 0,...l!=null?{"aria-invalid":l}:{},"aria-label":c,"aria-labelledby":d,"aria-multiline":f,"aria-owns":R?p:void 0,"aria-readonly":!R||void 0,"aria-required":g,autoCapitalize:y,className:v,contentEditable:R,"data-testid":T,id:w,ref:M,role:b,spellCheck:E,style:k,tabIndex:_,...j})}const t$=C.forwardRef(e$);function NN(e){return e.getEditorState().read(Zj(e.isComposing()))}const yA=C.forwardRef(r$);function r$(e,t){const{placeholder:r,...n}=e,[s]=Wl();return o.jsxs(o.Fragment,{children:[o.jsx(t$,{editor:s,...n,ref:t}),r!=null&&o.jsx(n$,{editor:s,content:r})]})}function n$({content:e,editor:t}){const r=(function(i){const[l,c]=C.useState((()=>NN(i)));return xA((()=>{function d(){const f=NN(i);c(f)}return d(),Cf(i.registerUpdateListener((()=>{d()})),i.registerEditableListener((()=>{d()})))}),[i]),l})(t),[n,s]=C.useState(t.isEditable());if(C.useLayoutEffect((()=>(s(t.isEditable()),t.registerEditableListener((i=>{s(i)})))),[t]),!r)return null;let a=null;return typeof e=="function"?a=e(n):e!==null&&(a=e),a===null?null:o.jsx("div",{"aria-hidden":!0,children:a})}const xy=0,t2=1,r2=2,Vo=0,s$=1,EN=2,a$=3,i$=4;function o$(e,t,r,n,s){if(e===null||r.size===0&&n.size===0&&!s)return Vo;const a=t._selection,i=e._selection;if(s)return s$;if(!(At(a)&&At(i)&&i.isCollapsed()&&a.isCollapsed()))return Vo;const l=(function(E,k,_){const T=E._nodeMap,j=[];for(const P of k){const R=T.get(P);R!==void 0&&j.push(R)}for(const[P,R]of _){if(!R)continue;const N=T.get(P);N===void 0||Xs(N)||j.push(N)}return j})(t,r,n);if(l.length===0)return Vo;if(l.length>1){const E=t._nodeMap,k=E.get(a.anchor.key),_=E.get(i.anchor.key);return k&&_&&!e._nodeMap.has(k.__key)&&Xt(k)&&k.__text.length===1&&a.anchor.offset===1?EN:Vo}const c=l[0],d=e._nodeMap.get(c.__key);if(!Xt(d)||!Xt(c)||d.__mode!==c.__mode)return Vo;const f=d.__text,p=c.__text;if(f===p)return Vo;const g=a.anchor,y=i.anchor;if(g.key!==y.key||g.type!=="text")return Vo;const v=g.offset,w=y.offset,b=p.length-f.length;return b===1&&w===v-1?EN:b===-1&&w===v+1?a$:b===-1&&w===v?i$:Vo}function l$(e,t){let r=Date.now(),n=Vo;return(s,a,i,l,c,d)=>{const f=Date.now();if(d.has(i1))return n=Vo,r=f,r2;const p=o$(s,a,l,c,e.isComposing()),g=(()=>{const y=i===null||i.editor===e,v=d.has(OB);if(!v&&y&&d.has($m))return xy;if(s===null)return t2;const w=a._selection;return l.size>0||c.size>0?v===!1&&p!==Vo&&p===n&&f<r+t&&y||l.size===1&&(function(b,E,k){const _=E._nodeMap.get(b),T=k._nodeMap.get(b),j=E._selection,P=k._selection;return!(At(j)&&At(P)&&j.anchor.type==="element"&&j.focus.type==="element"&&P.anchor.type==="text"&&P.focus.type==="text"||!Xt(_)||!Xt(T)||_.__parent!==T.__parent)&&JSON.stringify(E.read((()=>_.exportJSON())))===JSON.stringify(k.read((()=>T.exportJSON())))})(Array.from(l)[0],s,a)?xy:t2:w!==null?xy:r2})();return r=f,n=p,g}}function jN(e){e.undoStack=[],e.redoStack=[],e.current=null}function c$(e,t,r){const n=l$(e,r);return Cf(e.registerCommand(bb,(()=>((function(a,i){const l=i.redoStack,c=i.undoStack;if(c.length!==0){const d=i.current,f=c.pop();d!==null&&(l.push(d),a.dispatchCommand(ly,!0)),c.length===0&&a.dispatchCommand(cy,!1),i.current=f||null,f&&f.editor.setEditorState(f.editorState,{tag:i1})}})(e,t),!0)),tn),e.registerCommand(Sb,(()=>((function(a,i){const l=i.redoStack,c=i.undoStack;if(l.length!==0){const d=i.current;d!==null&&(c.push(d),a.dispatchCommand(cy,!0));const f=l.pop();l.length===0&&a.dispatchCommand(ly,!1),i.current=f||null,f&&f.editor.setEditorState(f.editorState,{tag:i1})}})(e,t),!0)),tn),e.registerCommand(yB,(()=>(jN(t),!1)),tn),e.registerCommand(vB,(()=>(jN(t),e.dispatchCommand(ly,!1),e.dispatchCommand(cy,!1),!0)),tn),e.registerUpdateListener((({editorState:a,prevEditorState:i,dirtyLeaves:l,dirtyElements:c,tags:d})=>{const f=t.current,p=t.redoStack,g=t.undoStack,y=f===null?null:f.editorState;if(f!==null&&a===y)return;const v=n(i,a,f,l,c,d);if(v===t2)p.length!==0&&(t.redoStack=[],e.dispatchCommand(ly,!1)),f!==null&&(g.push({...f}),e.dispatchCommand(cy,!0));else if(v===r2)return;t.current={editor:e,editorState:a}})))}function u$(){return{current:null,redoStack:[],undoStack:[]}}function vA({delay:e,externalHistoryState:t}){const[r]=Wl();return(function(n,s,a=1e3){const i=C.useMemo((()=>s||u$()),[s]);C.useEffect((()=>c$(n,i,a)),[a,n,i])})(r,t,e),null}function wA({defaultSelection:e}){const[t]=Wl();return C.useEffect((()=>{t.focus((()=>{const r=document.activeElement,n=t.getRootElement();n===null||r!==null&&n.contains(r)||n.focus({preventScroll:!0})}),{defaultSelection:e})}),[e,t]),null}function n2(e,t){return n2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},n2(e,t)}var AN={error:null},d$=(function(e){var t,r;function n(){for(var a,i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return(a=e.call.apply(e,[this].concat(l))||this).state=AN,a.resetErrorBoundary=function(){for(var d,f=arguments.length,p=new Array(f),g=0;g<f;g++)p[g]=arguments[g];a.props.onReset==null||(d=a.props).onReset.apply(d,p),a.reset()},a}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,n2(t,r),n.getDerivedStateFromError=function(a){return{error:a}};var s=n.prototype;return s.reset=function(){this.setState(AN)},s.componentDidCatch=function(a,i){var l,c;(l=(c=this.props).onError)==null||l.call(c,a,i)},s.componentDidUpdate=function(a,i){var l,c,d,f,p=this.state.error,g=this.props.resetKeys;p!==null&&i.error!==null&&((d=a.resetKeys)===void 0&&(d=[]),(f=g)===void 0&&(f=[]),d.length!==f.length||d.some((function(y,v){return!Object.is(y,f[v])})))&&((l=(c=this.props).onResetKeysChange)==null||l.call(c,a.resetKeys,g),this.reset())},s.render=function(){var a=this.state.error,i=this.props,l=i.fallbackRender,c=i.FallbackComponent,d=i.fallback;if(a!==null){var f={error:a,resetErrorBoundary:this.resetErrorBoundary};if(C.isValidElement(d))return d;if(typeof l=="function")return l(f);if(c)return C.createElement(c,f);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},n})(C.Component);function _A({children:e,onError:t}){return o.jsx(d$,{fallback:o.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:t,children:e})}const Qb=/^(\d+(?:\.\d+)?)px$/,r0={BOTH:3,NO_STATUS:0,ROW:1};class F0 extends Xa{static getType(){return"tablecell"}static clone(t){return new F0(t.__headerState,t.__colSpan,t.__width,t.__key)}afterCloneFrom(t){super.afterCloneFrom(t),this.__rowSpan=t.__rowSpan,this.__backgroundColor=t.__backgroundColor,this.__verticalAlign=t.__verticalAlign}static importDOM(){return{td:t=>({conversion:FN,priority:0}),th:t=>({conversion:FN,priority:0})}}static importJSON(t){return bA().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setHeaderStyles(t.headerState).setColSpan(t.colSpan||1).setRowSpan(t.rowSpan||1).setWidth(t.width||void 0).setBackgroundColor(t.backgroundColor||null).setVerticalAlign(t.verticalAlign||void 0)}constructor(t=r0.NO_STATUS,r=1,n,s){super(s),this.__colSpan=r,this.__rowSpan=1,this.__headerState=t,this.__width=n,this.__backgroundColor=null,this.__verticalAlign=void 0}createDOM(t){const r=document.createElement(this.getTag());return this.__width&&(r.style.width=`${this.__width}px`),this.__colSpan>1&&(r.colSpan=this.__colSpan),this.__rowSpan>1&&(r.rowSpan=this.__rowSpan),this.__backgroundColor!==null&&(r.style.backgroundColor=this.__backgroundColor),s2(this.__verticalAlign)&&(r.style.verticalAlign=this.__verticalAlign),Ks(r,t.theme.tableCell,this.hasHeader()&&t.theme.tableCellHeader),r}exportDOM(t){const r=super.exportDOM(t);if(Bn(r.element)){const n=r.element;n.setAttribute("data-temporary-table-cell-lexical-key",this.getKey()),n.style.border="1px solid black",this.__colSpan>1&&(n.colSpan=this.__colSpan),this.__rowSpan>1&&(n.rowSpan=this.__rowSpan),n.style.width=`${this.getWidth()||75}px`,n.style.verticalAlign=this.getVerticalAlign()||"top",n.style.textAlign="start",this.__backgroundColor===null&&this.hasHeader()&&(n.style.backgroundColor="#f2f3f5")}return r}exportJSON(){return{...super.exportJSON(),...s2(this.__verticalAlign)&&{verticalAlign:this.__verticalAlign},backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(t){const r=this.getWritable();return r.__colSpan=t,r}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(t){const r=this.getWritable();return r.__rowSpan=t,r}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(t,r=r0.BOTH){const n=this.getWritable();return n.__headerState=t&r|n.__headerState&~r,n}getHeaderStyles(){return this.getLatest().__headerState}setWidth(t){const r=this.getWritable();return r.__width=t,r}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(t){const r=this.getWritable();return r.__backgroundColor=t,r}getVerticalAlign(){return this.getLatest().__verticalAlign}setVerticalAlign(t){const r=this.getWritable();return r.__verticalAlign=t||void 0,r}toggleHeaderStyle(t){const r=this.getWritable();return(r.__headerState&t)===t?r.__headerState-=t:r.__headerState+=t,r}hasHeaderState(t){return(this.getHeaderStyles()&t)===t}hasHeader(){return this.getLatest().__headerState!==r0.NO_STATUS}updateDOM(t){return t.__headerState!==this.__headerState||t.__width!==this.__width||t.__colSpan!==this.__colSpan||t.__rowSpan!==this.__rowSpan||t.__backgroundColor!==this.__backgroundColor||t.__verticalAlign!==this.__verticalAlign}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}}function s2(e){return e==="middle"||e==="bottom"}function FN(e){const t=e,r=e.nodeName.toLowerCase();let n;Qb.test(t.style.width)&&(n=parseFloat(t.style.width));const s=bA(r==="th"?r0.ROW:r0.NO_STATUS,t.colSpan,n);s.__rowSpan=t.rowSpan;const a=t.style.backgroundColor;a!==""&&(s.__backgroundColor=a);const i=t.style.verticalAlign;s2(i)&&(s.__verticalAlign=i);const l=t.style,c=(l&&l.textDecoration||"").split(" "),d=l.fontWeight==="700"||l.fontWeight==="bold",f=c.includes("line-through"),p=l.fontStyle==="italic",g=c.includes("underline");return{after:y=>{const v=[];let w=null;const b=()=>{if(w){const E=w.getFirstChild();Nc(E)&&w.getChildrenSize()===1&&E.remove()}};for(const E of y)QB(E)||Xt(E)||Nc(E)?(Xt(E)&&(d&&E.toggleFormat("bold"),f&&E.toggleFormat("strikethrough"),p&&E.toggleFormat("italic"),g&&E.toggleFormat("underline")),w?w.append(E):(w=Ln().append(E),v.push(w))):(v.push(E),b(),w=null);return b(),v.length===0&&v.push(Ln()),v},node:s}}function bA(e=r0.NO_STATUS,t=1,r){return xi(new F0(e,t,r))}function fp(e){return e instanceof F0}function a2(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}class P0 extends Xa{static getType(){return"tablerow"}static clone(t){return new P0(t.__height,t.__key)}static importDOM(){return{tr:t=>({conversion:f$,priority:0})}}static importJSON(t){return SA().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setHeight(t.height)}constructor(t,r){super(r),this.__height=t}exportJSON(){const t=this.getHeight();return{...super.exportJSON(),...t===void 0?void 0:{height:t}}}createDOM(t){const r=document.createElement("tr");return this.__height&&(r.style.height=`${this.__height}px`),Ks(r,t.theme.tableRow),r}extractWithChild(t,r,n){return n==="html"}isShadowRoot(){return!0}setHeight(t){const r=this.getWritable();return r.__height=t,r}getHeight(){return this.getLatest().__height}updateDOM(t){return t.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function f$(e){const t=e;let r;return Qb.test(t.style.height)&&(r=parseFloat(t.style.height)),{after:n=>cA(n,fp),node:SA(r)}}function SA(e){return xi(new P0(e))}function kA(e){return e instanceof P0}const CA=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,h$=CA&&"documentMode"in document?document.documentMode:null;CA&&"InputEvent"in window&&!h$&&new window.InputEvent("input");function g$(e,t,r){const n=[];let s=null,a=null;function i(c){let d=n[c];return d===void 0&&(n[c]=d=[]),d}const l=e.getChildren();for(let c=0;c<l.length;c++){const d=l[c];kA(d)||a2(209);const f=i(c);for(let p=d.getFirstChild(),g=0;p!=null;p=p.getNextSibling()){for(fp(p)||a2(147);f[g]!==void 0;)g++;const y={cell:p,startColumn:g,startRow:c},{__rowSpan:v,__colSpan:w}=p;for(let b=0;b<v&&!(c+b>=l.length);b++){const E=i(c+b);for(let k=0;k<w;k++)E[g+k]=y}}}return[n,s,a]}function _m(e){return Bn(e)&&e.nodeName==="TABLE"}function m$(e,t){for(let r=t,n=null;r!==null;r=r.getParent()){if(e.is(r))return n;fp(r)&&(n=r)}return null}function p$(e,t,r){return m$(e,Hu(t,r))}function PN(e,t,r){if(!t.theme.tableAlignment)return;const n=[],s=[];for(const a of["center","right"]){const i=t.theme.tableAlignment[a];i&&(a===r?s:n).push(i)}Uu(e,...n),Ks(e,...s)}const x$=new WeakSet;function RN(e=Wp()){return x$.has(e)}class Vp extends Xa{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(t){const r=this.getWritable();return r.__colWidths=t,r}static clone(t){return new Vp(t.__key)}afterCloneFrom(t){super.afterCloneFrom(t),this.__colWidths=t.__colWidths,this.__rowStriping=t.__rowStriping,this.__frozenColumnCount=t.__frozenColumnCount,this.__frozenRowCount=t.__frozenRowCount}static importDOM(){return{table:t=>({conversion:y$,priority:1})}}static importJSON(t){return TA().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setRowStriping(t.rowStriping||!1).setFrozenColumns(t.frozenColumnCount||0).setFrozenRows(t.frozenRowCount||0).setColWidths(t.colWidths)}constructor(t){super(t),this.__rowStriping=!1,this.__frozenColumnCount=0,this.__frozenRowCount=0}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),frozenColumnCount:this.__frozenColumnCount?this.__frozenColumnCount:void 0,frozenRowCount:this.__frozenRowCount?this.__frozenRowCount:void 0,rowStriping:this.__rowStriping?this.__rowStriping:void 0}}extractWithChild(t,r,n){return n==="html"}getDOMSlot(t){const r=_m(t)?t:t.querySelector("table");return _m(r)||a2(229),super.getDOMSlot(t).withElement(r).withAfter(r.querySelector("colgroup"))}createDOM(t,r){const n=document.createElement("table");this.__style&&(n.style.cssText=this.__style);const s=document.createElement("colgroup");if(n.appendChild(s),nU(s),Ks(n,t.theme.table),this.updateTableElement(null,n,t),RN(r)){const a=document.createElement("div"),i=t.theme.tableScrollableWrapper;return i?Ks(a,i):a.style.cssText="overflow-x: auto;",a.appendChild(n),this.updateTableWrapper(null,a,n,t),a}return n}updateTableWrapper(t,r,n,s){this.__frozenColumnCount!==(t?t.__frozenColumnCount:0)&&(function(a,i,l,c){c>0?(Ks(a,l.theme.tableFrozenColumn),i.setAttribute("data-lexical-frozen-column","true")):(Uu(a,l.theme.tableFrozenColumn),i.removeAttribute("data-lexical-frozen-column"))})(r,n,s,this.__frozenColumnCount),this.__frozenRowCount!==(t?t.__frozenRowCount:0)&&(function(a,i,l,c){c>0?(Ks(a,l.theme.tableFrozenRow),i.setAttribute("data-lexical-frozen-row","true")):(Uu(a,l.theme.tableFrozenRow),i.removeAttribute("data-lexical-frozen-row"))})(r,n,s,this.__frozenRowCount)}updateTableElement(t,r,n){this.__style!==(t?t.__style:"")&&(r.style.cssText=this.__style),this.__rowStriping!==(!!t&&t.__rowStriping)&&(function(s,a,i){i?(Ks(s,a.theme.tableRowStriping),s.setAttribute("data-lexical-row-striping","true")):(Uu(s,a.theme.tableRowStriping),s.removeAttribute("data-lexical-row-striping"))})(r,n,this.__rowStriping),(function(s,a,i,l){const c=s.querySelector("colgroup");if(!c)return;const d=[];for(let f=0;f<i;f++){const p=document.createElement("col"),g=l&&l[f];g&&(p.style.width=`${g}px`),d.push(p)}c.replaceChildren(...d)})(r,0,this.getColumnCount(),this.getColWidths()),PN(r,n,this.getFormatType())}updateDOM(t,r,n){const s=this.getDOMSlot(r).element;return r===s===RN()||(Bn(a=r)&&a.nodeName==="DIV"&&this.updateTableWrapper(t,r,s,n),this.updateTableElement(t,s,n),!1);var a}exportDOM(t){const r=super.exportDOM(t),{element:n}=r;return{after:s=>{if(r.after&&(s=r.after(s)),!_m(s)&&Bn(s)&&(s=s.querySelector("table")),!_m(s))return null;PN(s,t._config,this.getFormatType());const[a]=g$(this),i=new Map;for(const f of a)for(const p of f){const g=p.cell.getKey();i.has(g)||i.set(g,{colSpan:p.cell.getColSpan(),startColumn:p.startColumn})}const l=new Set;for(const f of s.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]")){const p=f.getAttribute("data-temporary-table-cell-lexical-key");if(p){const g=i.get(p);if(f.removeAttribute("data-temporary-table-cell-lexical-key"),g){i.delete(p);for(let y=0;y<g.colSpan;y++)l.add(y+g.startColumn)}}}const c=s.querySelector(":scope > colgroup");if(c){const f=Array.from(s.querySelectorAll(":scope > colgroup > col")).filter(((p,g)=>l.has(g)));c.replaceChildren(...f)}const d=s.querySelectorAll(":scope > tr");if(d.length>0){const f=document.createElement("tbody");for(const p of d)f.appendChild(p);s.append(f)}return s},element:!_m(n)&&Bn(n)?n.querySelector("table"):n}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(t,r){const{rows:n,domRows:s}=r;for(let a=0;a<n;a++){const i=s[a];if(i!=null)for(let l=0;l<i.length;l++){const c=i[l];if(c==null)continue;const{elem:d}=c,f=p$(this,d);if(f!==null&&t.is(f))return{x:l,y:a}}}throw new Error("Cell not found in table.")}getDOMCellFromCords(t,r,n){const{domRows:s}=n,a=s[r];if(a==null)return null;const i=a[t<a.length?t:a.length-1];return i??null}getDOMCellFromCordsOrThrow(t,r,n){const s=this.getDOMCellFromCords(t,r,n);if(!s)throw new Error("Cell not found at cords.");return s}getCellNodeFromCords(t,r,n){const s=this.getDOMCellFromCords(t,r,n);if(s==null)return null;const a=Hu(s.elem);return fp(a)?a:null}getCellNodeFromCordsOrThrow(t,r,n){const s=this.getCellNodeFromCords(t,r,n);if(!s)throw new Error("Node at cords not TableCellNode.");return s}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(t){const r=this.getWritable();return r.__rowStriping=t,r}setFrozenColumns(t){const r=this.getWritable();return r.__frozenColumnCount=t,r}getFrozenColumns(){return this.getLatest().__frozenColumnCount}setFrozenRows(t){const r=this.getWritable();return r.__frozenRowCount=t,r}getFrozenRows(){return this.getLatest().__frozenRowCount}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){const t=this.getFirstChild();if(!t)return 0;let r=0;return t.getChildren().forEach((n=>{fp(n)&&(r+=n.getColSpan())})),r}}function y$(e){const t=TA();e.hasAttribute("data-lexical-row-striping")&&t.setRowStriping(!0),e.hasAttribute("data-lexical-frozen-column")&&t.setFrozenColumns(1),e.hasAttribute("data-lexical-frozen-row")&&t.setFrozenRows(1);const r=e.querySelector(":scope > colgroup");if(r){let n=[];for(const s of r.querySelectorAll(":scope > col")){let a=s.style.width||"";if(!Qb.test(a)&&(a=s.getAttribute("width")||"",!/^\d+$/.test(a))){n=void 0;break}n.push(parseFloat(a))}n&&t.setColWidths(n)}return{after:n=>cA(n,kA),node:t}}function TA(){return xi(new Vp)}function Du(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function i2(e){let t=1,r=e.getParent();for(;r!=null;){if(fn(r)){const n=r.getParent();if(Lr(n)){t++,r=n.getParent();continue}Du(40)}return t}return t}function o2(e){let t=e.getParent();Lr(t)||Du(40);let r=t;for(;r!==null;)r=r.getParent(),Lr(r)&&(t=r);return t}function NA(e){let t=[];const r=e.getChildren().filter(fn);for(let n=0;n<r.length;n++){const s=r[n],a=s.getFirstChild();Lr(a)?t=t.concat(NA(a)):t.push(s)}return t}function Dl(e){return fn(e)&&Lr(e.getFirstChild())}function DN(e){return Xi().append(e)}function EA(e,t){return fn(e)&&(t.length===0||t.length===1&&e.is(t[0])&&e.getChildrenSize()===0)}function IN(e){const t=qt();if(t!==null){let r=t.getNodes();if(At(t)){const s=t.getStartEndPoints();s===null&&Du(143);const[a]=s,i=a.getNode(),l=i.getParent();if(mi(i)){const c=i.getFirstChild();if(c)r=c.selectStart().getNodes();else{const d=Ln();i.append(d),r=d.select().getNodes()}}else if(EA(i,r)){const c=Pi(e);if(mi(l)){i.replace(c);const d=Xi();vt(i)&&(d.setFormat(i.getFormatType()),d.setIndent(i.getIndent())),c.append(d)}else if(fn(i)){const d=i.getParentOrThrow();xf(c,d.getChildren()),d.replace(c)}return}}const n=new Set;for(let s=0;s<r.length;s++){const a=r[s];if(vt(a)&&a.isEmpty()&&!fn(a)&&!n.has(a.getKey())){MN(a,e);continue}let i=Oj(a)?a.getParent():fn(a)&&a.isEmpty()?a:null;for(;i!=null;){const l=i.getKey();if(Lr(i)){if(!n.has(l)){const c=Pi(e);xf(c,i.getChildren()),i.replace(c),n.add(l)}break}{const c=i.getParent();if(mi(c)&&!n.has(l)){n.add(l),MN(i,e);break}i=c}}}}}function xf(e,t){e.splice(e.getChildrenSize(),0,t)}function MN(e,t){if(Lr(e))return e;const r=e.getPreviousSibling(),n=e.getNextSibling(),s=Xi();let a;if(xf(s,e.getChildren()),Lr(r)&&t===r.getListType())r.append(s),Lr(n)&&t===n.getListType()&&(xf(r,n.getChildren()),n.remove()),a=r;else if(Lr(n)&&t===n.getListType())n.getFirstChildOrThrow().insertBefore(s),a=n;else{const i=Pi(t);i.append(s),e.replace(i),a=i}return s.setFormat(e.getFormatType()),s.setIndent(e.getIndent()),e.remove(),a}function Zb(e,t){const r=e.getLastChild(),n=t.getFirstChild();r&&n&&Dl(r)&&Dl(n)&&(Zb(r.getFirstChild(),n.getFirstChild()),n.remove());const s=t.getChildren();s.length>0&&e.append(...s),t.remove()}function v$(){const e=qt();if(At(e)){const t=new Set,r=e.getNodes(),n=e.anchor.getNode();if(EA(n,r))t.add(o2(n));else for(let s=0;s<r.length;s++){const a=r[s];if(Oj(a)){const i=AU(a,Lc);i!=null&&t.add(o2(i))}}for(const s of t){let a=s;const i=NA(s);for(const l of i){const c=Ln().setTextStyle(e.style).setTextFormat(e.format);xf(c,l.getChildren()),a.insertAfter(c),a=c,l.__key===e.anchor.key&&pf(e.anchor,bo(To(c,"next"))),l.__key===e.focus.key&&pf(e.focus,bo(To(c,"next"))),l.remove()}s.remove()}}}function jA(e){const t=e.getListType()!=="check";let r=e.getStart();for(const n of e.getChildren())fn(n)&&(n.getValue()!==r&&n.setValue(r),t&&n.getLatest().__checked!=null&&n.setChecked(void 0),Lr(n.getFirstChild())||r++)}function w$(e){const t=new Set;if(Dl(e)||t.has(e.getKey()))return;const r=e.getParent(),n=e.getNextSibling(),s=e.getPreviousSibling();if(Dl(n)&&Dl(s)){const a=s.getFirstChild();if(Lr(a)){a.append(e);const i=n.getFirstChild();Lr(i)&&(xf(a,i.getChildren()),n.remove(),t.add(n.getKey()))}}else if(Dl(n)){const a=n.getFirstChild();if(Lr(a)){const i=a.getFirstChild();i!==null&&i.insertBefore(e)}}else if(Dl(s)){const a=s.getFirstChild();Lr(a)&&a.append(e)}else if(Lr(r)){const a=Xi().setTextFormat(e.getTextFormat()).setTextStyle(e.getTextStyle()),i=Pi(r.getListType()).setTextFormat(r.getTextFormat()).setTextStyle(r.getTextStyle());a.append(i),i.append(e),s?s.insertAfter(a):n?n.insertBefore(a):r.append(a)}}function _$(e){if(Dl(e))return;const t=e.getParent(),r=t?t.getParent():void 0;if(Lr(r?r.getParent():void 0)&&fn(r)&&Lr(t)){const n=t?t.getFirstChild():void 0,s=t?t.getLastChild():void 0;if(e.is(n))r.insertBefore(e),t.isEmpty()&&r.remove();else if(e.is(s))r.insertAfter(e),t.isEmpty()&&r.remove();else{const a=t.getListType(),i=Xi(),l=Pi(a);i.append(l),e.getPreviousSiblings().forEach((f=>l.append(f)));const c=Xi(),d=Pi(a);c.append(d),xf(d,e.getNextSiblings()),r.insertBefore(i),r.insertAfter(c),r.replace(e)}}}function b$(){const e=qt();if(!At(e)||!e.isCollapsed())return!1;const t=e.anchor.getNode();if(!fn(t)||t.getChildrenSize()!==0)return!1;const r=o2(t),n=t.getParent();Lr(n)||Du(40);const s=n.getParent();let a;if(mi(s))a=Ln(),r.insertAfter(a);else{if(!fn(s))return!1;a=Xi(),s.insertAfter(a)}a.setTextStyle(e.style).setTextFormat(e.format).select();const i=t.getNextSiblings();if(i.length>0){const l=Pi(n.getListType());if(fn(a)){const c=Xi();c.append(l),a.insertAfter(c)}else a.insertAfter(l);l.append(...i)}return(function(l){let c=l;for(;c.getNextSibling()==null&&c.getPreviousSibling()==null;){const d=c.getParent();if(d==null||!fn(d)&&!Lr(d))break;c=d}c.remove()})(t),!0}function d1(...e){const t=[];for(const r of e)if(r&&typeof r=="string")for(const[n]of r.matchAll(/\S+/g))t.push(n);return t}let Lc=class extends Xa{$config(){return this.config("listitem",{$transform:t=>{if(t.__checked==null)return;const r=t.getParent();Lr(r)&&r.getListType()!=="check"&&t.getChecked()!=null&&t.setChecked(void 0)},extends:Xa,importDOM:{li:()=>({conversion:S$,priority:0})}})}constructor(t=1,r=void 0,n){super(n),this.__value=t===void 0?1:t,this.__checked=r}afterCloneFrom(t){super.afterCloneFrom(t),this.__value=t.__value,this.__checked=t.__checked}createDOM(t){const r=document.createElement("li");return this.updateListItemDOM(null,r,t),r}updateListItemDOM(t,r,n){const s=this.getParent();Lr(s)&&s.getListType()==="check"&&(function(l,c,d,f){Lr(c.getFirstChild())?(l.removeAttribute("role"),l.removeAttribute("tabIndex"),l.removeAttribute("aria-checked")):(l.setAttribute("role","checkbox"),l.setAttribute("tabIndex","-1"),d&&c.__checked===d.__checked||l.setAttribute("aria-checked",c.getChecked()?"true":"false"))})(r,this,t),r.value=this.__value,(function(l,c,d){const f=[],p=[],g=c.list,y=g?g.listitem:void 0;let v;if(g&&g.nested&&(v=g.nested.listitem),y!==void 0&&f.push(...d1(y)),g){const w=d.getParent(),b=Lr(w)&&w.getListType()==="check",E=d.getChecked();b&&!E||p.push(g.listitemUnchecked),b&&E||p.push(g.listitemChecked),b&&f.push(E?g.listitemChecked:g.listitemUnchecked)}if(v!==void 0){const w=d1(v);d.getChildren().some((b=>Lr(b)))?f.push(...w):p.push(...w)}p.length>0&&Uu(l,...p),f.length>0&&Ks(l,...f)})(r,n.theme,this);const a=t?t.__style:"",i=this.__style;a!==i&&(i===""?r.removeAttribute("style"):r.style.cssText=i),(function(l,c,d){const f=dN(c.__textStyle);for(const p in f)l.style.setProperty(`--listitem-marker-${p}`,f[p]);if(d)for(const p in dN(d.__textStyle))p in f||l.style.removeProperty(`--listitem-marker-${p}`)})(r,this,t)}updateDOM(t,r,n){const s=r;return this.updateListItemDOM(t,s,n),!1}updateFromJSON(t){return super.updateFromJSON(t).setValue(t.value).setChecked(t.checked)}exportDOM(t){const r=this.createDOM(t._config),n=this.getFormatType();n&&(r.style.textAlign=n);const s=this.getDirection();return s&&(r.dir=s),{element:r}}exportJSON(){return{...super.exportJSON(),checked:this.getChecked(),value:this.getValue()}}append(...t){for(let r=0;r<t.length;r++){const n=t[r];if(vt(n)&&this.canMergeWith(n)){const s=n.getChildren();this.append(...s),n.remove()}else super.append(n)}return this}replace(t,r){if(fn(t))return super.replace(t);this.setIndent(0);const n=this.getParentOrThrow();if(!Lr(n))return t;if(n.__first===this.getKey())n.insertBefore(t);else if(n.__last===this.getKey())n.insertAfter(t);else{const s=Pi(n.getListType());let a=this.getNextSibling();for(;a;){const i=a;a=a.getNextSibling(),s.append(i)}n.insertAfter(t),t.insertAfter(s)}return r&&(vt(t)||Du(139),this.getChildren().forEach((s=>{t.append(s)}))),this.remove(),n.getChildrenSize()===0&&n.remove(),t}insertAfter(t,r=!0){const n=this.getParentOrThrow();if(Lr(n)||Du(39),fn(t))return super.insertAfter(t,r);const s=this.getNextSiblings();if(n.insertAfter(t,r),s.length!==0){const a=Pi(n.getListType());s.forEach((i=>a.append(i))),t.insertAfter(a,r)}return t}remove(t){const r=this.getPreviousSibling(),n=this.getNextSibling();super.remove(t),r&&n&&Dl(r)&&Dl(n)&&(Zb(r.getFirstChild(),n.getFirstChild()),n.remove())}insertNewAfter(t,r=!0){const n=Xi().updateFromJSON(this.exportJSON()).setChecked(!this.getChecked()&&void 0);return this.insertAfter(n,r),n}collapseAtStart(t){const r=Ln();this.getChildren().forEach((i=>r.append(i)));const n=this.getParentOrThrow(),s=n.getParentOrThrow(),a=fn(s);if(n.getChildrenSize()===1)if(a)n.remove(),s.select();else{n.insertBefore(r),n.remove();const i=t.anchor,l=t.focus,c=r.getKey();i.type==="element"&&i.getNode().is(this)&&i.set(c,i.offset,"element"),l.type==="element"&&l.getNode().is(this)&&l.set(c,l.offset,"element")}else n.insertBefore(r),this.remove();return!0}getValue(){return this.getLatest().__value}setValue(t){const r=this.getWritable();return r.__value=t,r}getChecked(){const t=this.getLatest();let r;const n=this.getParent();return Lr(n)&&(r=n.getListType()),r==="check"?!!t.__checked:void 0}setChecked(t){const r=this.getWritable();return r.__checked=t,r}toggleChecked(){const t=this.getWritable();return t.setChecked(!t.__checked)}getIndent(){const t=this.getParent();if(t===null||!this.isAttached())return this.getLatest().__indent;let r=t.getParentOrThrow(),n=0;for(;fn(r);)r=r.getParentOrThrow().getParentOrThrow(),n++;return n}setIndent(t){typeof t!="number"&&Du(117),(t=Math.floor(t))>=0||Du(199);let r=this.getIndent();for(;r!==t;)r<t?(w$(this),r++):(_$(this),r--);return this}canInsertAfter(t){return fn(t)}canReplaceWith(t){return fn(t)}canMergeWith(t){return fn(t)||Pb(t)}extractWithChild(t,r){if(!At(r))return!1;const n=r.anchor.getNode(),s=r.focus.getNode();return this.isParentOf(n)&&this.isParentOf(s)&&this.getTextContent().length===r.getTextContent().length}isParentRequired(){return!0}createParentElementNode(){return Pi("bullet")}canMergeWhenEmpty(){return!0}};function S$(e){if(e.classList.contains("task-list-item")){for(const r of e.children)if(r.tagName==="INPUT")return k$(r)}const t=e.getAttribute("aria-checked");return{node:Xi(t==="true"||t!=="false"&&void 0)}}function k$(e){return e.getAttribute("type")!=="checkbox"?{node:null}:{node:Xi(e.hasAttribute("checked"))}}function Xi(e){return xi(new Lc(void 0,e))}function fn(e){return e instanceof Lc}let rd=class extends Xa{$config(){return this.config("list",{$transform:t=>{(function(r){const n=r.getNextSibling();Lr(n)&&r.getListType()===n.getListType()&&Zb(r,n)})(t),jA(t)},extends:Xa,importDOM:{ol:()=>({conversion:LN,priority:0}),ul:()=>({conversion:LN,priority:0})}})}constructor(t="number",r=1,n){super(n);const s=T$[t]||t;this.__listType=s,this.__tag=s==="number"?"ol":"ul",this.__start=r}afterCloneFrom(t){super.afterCloneFrom(t),this.__listType=t.__listType,this.__tag=t.__tag,this.__start=t.__start}getTag(){return this.getLatest().__tag}setListType(t){const r=this.getWritable();return r.__listType=t,r.__tag=t==="number"?"ol":"ul",r}getListType(){return this.getLatest().__listType}getStart(){return this.getLatest().__start}setStart(t){const r=this.getWritable();return r.__start=t,r}createDOM(t,r){const n=this.__tag,s=document.createElement(n);return this.__start!==1&&s.setAttribute("start",String(this.__start)),s.__lexicalListType=this.__listType,ON(s,t.theme,this),s}updateDOM(t,r,n){return t.__tag!==this.__tag||(ON(r,n.theme,this),!1)}updateFromJSON(t){return super.updateFromJSON(t).setListType(t.listType).setStart(t.start)}exportDOM(t){const r=this.createDOM(t._config,t);return Bn(r)&&(this.__start!==1&&r.setAttribute("start",String(this.__start)),this.__listType==="check"&&r.setAttribute("__lexicalListType","check")),{element:r}}exportJSON(){return{...super.exportJSON(),listType:this.getListType(),start:this.getStart(),tag:this.getTag()}}canBeEmpty(){return!1}canIndent(){return!1}splice(t,r,n){let s=n;for(let a=0;a<n.length;a++){const i=n[a];fn(i)||(s===n&&(s=[...n]),s[a]=Xi().append(!vt(i)||Lr(i)||i.isInline()?i:cs(i.getTextContent())))}return super.splice(t,r,s)}extractWithChild(t){return fn(t)}};function ON(e,t,r){const n=[],s=[],a=t.list;if(a!==void 0){const i=a[`${r.__tag}Depth`]||[],l=i2(r)-1,c=l%i.length,d=i[c],f=a[r.__tag];let p;const g=a.nested,y=a.checklist;if(g!==void 0&&g.list&&(p=g.list),f!==void 0&&n.push(f),y!==void 0&&r.__listType==="check"&&n.push(y),d!==void 0){n.push(...d1(d));for(let v=0;v<i.length;v++)v!==c&&s.push(r.__tag+v)}if(p!==void 0){const v=d1(p);l>1?n.push(...v):s.push(...v)}}s.length>0&&Uu(e,...s),n.length>0&&Ks(e,...n)}function C$(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(fn(n)){t.push(n);const s=n.getChildren();s.length>1&&s.forEach((a=>{Lr(a)&&t.push(DN(a))}))}else t.push(DN(n))}return t}function LN(e){const t=e.nodeName.toLowerCase();let r=null;return t==="ol"?r=Pi("number",e.start):t==="ul"&&(r=(function(n){if(n.getAttribute("__lexicallisttype")==="check"||n.classList.contains("contains-task-list"))return!0;for(const s of n.childNodes)if(Bn(s)&&s.hasAttribute("aria-checked"))return!0;return!1})(e)?Pi("check"):Pi("bullet")),{after:C$,node:r}}const T$={ol:"number",ul:"bullet"};function Pi(e="number",t=1){return xi(new rd(e,t))}function Lr(e){return e instanceof rd}const N$=Tr("UPDATE_LIST_START_COMMAND"),eS=Tr("INSERT_UNORDERED_LIST_COMMAND"),tS=Tr("INSERT_ORDERED_LIST_COMMAND"),rS=Tr("REMOVE_LIST_COMMAND");function E$(e){return Cf(e.registerCommand(tS,(()=>(IN("number"),!0)),Oh),e.registerCommand(N$,(t=>{const{listNodeKey:r,newStart:n}=t,s=Ls(r);return!!Lr(s)&&(s.getListType()==="number"&&(s.setStart(n),jA(s)),!0)}),Oh),e.registerCommand(eS,(()=>(IN("bullet"),!0)),Oh),e.registerCommand(rS,(()=>(v$(),!0)),Oh),e.registerCommand(lp,(()=>b$()),Oh),e.registerNodeTransform(Lc,(t=>{const r=t.getFirstChild();if(r){if(Xt(r)){const n=r.getStyle(),s=r.getFormat();t.getTextStyle()!==n&&t.setTextStyle(n),t.getTextFormat()!==s&&t.setTextFormat(s)}}else{const n=qt();At(n)&&(n.style!==t.getTextStyle()||n.format!==t.getTextFormat())&&n.isCollapsed()&&t.is(n.anchor.getNode())&&t.setTextStyle(n.style).setTextFormat(n.format)}})),e.registerNodeTransform(ed,(t=>{const r=t.getParent();if(fn(r)&&t.is(r.getFirstChild())){const n=t.getStyle(),s=t.getFormat();n===r.getTextStyle()&&s===r.getTextFormat()||r.setTextStyle(n).setTextFormat(s)}})))}function j$(e){const t=r=>{const n=r.getParent();if(Lr(r.getFirstChild())||!Lr(n))return;const s=J1(r,(a=>fn(a)&&Lr(a.getParent())&&fn(a.getPreviousSibling())));if(s===null&&r.getIndent()>0)r.setIndent(0);else if(fn(s)){const a=s.getPreviousSibling();if(fn(a)){const i=(function(c){let d=c,f=d.getFirstChild();for(;Lr(f);){const p=f.getLastChild();if(!fn(p))break;d=p,f=d.getFirstChild()}return d})(a),l=i.getParent();if(Lr(l)){const c=i2(l);c+1<i2(n)&&r.setIndent(c)}}}};return e.registerNodeTransform(rd,(r=>{const n=[r];for(;n.length>0;){const s=n.shift();if(Lr(s)){for(const a of s.getChildren())if(fn(a)){t(a);const i=a.getFirstChild();Lr(i)&&n.push(i)}}}}))}var Lw={exports:{}},BN;function A$(){return BN||(BN=1,(function(e){var t=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var r=(function(n){var s=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,a=0,i={},l={manual:n.Prism&&n.Prism.manual,disableWorkerMessageHandler:n.Prism&&n.Prism.disableWorkerMessageHandler,util:{encode:function k(_){return _ instanceof c?new c(_.type,k(_.content),_.alias):Array.isArray(_)?_.map(k):_.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(k){return Object.prototype.toString.call(k).slice(8,-1)},objId:function(k){return k.__id||Object.defineProperty(k,"__id",{value:++a}),k.__id},clone:function k(_,T){T=T||{};var j,P;switch(l.util.type(_)){case"Object":if(P=l.util.objId(_),T[P])return T[P];j={},T[P]=j;for(var R in _)_.hasOwnProperty(R)&&(j[R]=k(_[R],T));return j;case"Array":return P=l.util.objId(_),T[P]?T[P]:(j=[],T[P]=j,_.forEach(function(N,A){j[A]=k(N,T)}),j);default:return _}},getLanguage:function(k){for(;k;){var _=s.exec(k.className);if(_)return _[1].toLowerCase();k=k.parentElement}return"none"},setLanguage:function(k,_){k.className=k.className.replace(RegExp(s,"gi"),""),k.classList.add("language-"+_)},currentScript:function(){if(typeof document>"u")return null;if(document.currentScript&&document.currentScript.tagName==="SCRIPT")return document.currentScript;try{throw new Error}catch(j){var k=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(j.stack)||[])[1];if(k){var _=document.getElementsByTagName("script");for(var T in _)if(_[T].src==k)return _[T]}return null}},isActive:function(k,_,T){for(var j="no-"+_;k;){var P=k.classList;if(P.contains(_))return!0;if(P.contains(j))return!1;k=k.parentElement}return!!T}},languages:{plain:i,plaintext:i,text:i,txt:i,extend:function(k,_){var T=l.util.clone(l.languages[k]);for(var j in _)T[j]=_[j];return T},insertBefore:function(k,_,T,j){j=j||l.languages;var P=j[k],R={};for(var N in P)if(P.hasOwnProperty(N)){if(N==_)for(var A in T)T.hasOwnProperty(A)&&(R[A]=T[A]);T.hasOwnProperty(N)||(R[N]=P[N])}var M=j[k];return j[k]=R,l.languages.DFS(l.languages,function(H,Q){Q===M&&H!=k&&(this[H]=R)}),R},DFS:function k(_,T,j,P){P=P||{};var R=l.util.objId;for(var N in _)if(_.hasOwnProperty(N)){T.call(_,N,_[N],j||N);var A=_[N],M=l.util.type(A);M==="Object"&&!P[R(A)]?(P[R(A)]=!0,k(A,T,null,P)):M==="Array"&&!P[R(A)]&&(P[R(A)]=!0,k(A,T,N,P))}}},plugins:{},highlightAll:function(k,_){l.highlightAllUnder(document,k,_)},highlightAllUnder:function(k,_,T){var j={callback:T,container:k,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};l.hooks.run("before-highlightall",j),j.elements=Array.prototype.slice.apply(j.container.querySelectorAll(j.selector)),l.hooks.run("before-all-elements-highlight",j);for(var P=0,R;R=j.elements[P++];)l.highlightElement(R,_===!0,j.callback)},highlightElement:function(k,_,T){var j=l.util.getLanguage(k),P=l.languages[j];l.util.setLanguage(k,j);var R=k.parentElement;R&&R.nodeName.toLowerCase()==="pre"&&l.util.setLanguage(R,j);var N=k.textContent,A={element:k,language:j,grammar:P,code:N};function M(Q){A.highlightedCode=Q,l.hooks.run("before-insert",A),A.element.innerHTML=A.highlightedCode,l.hooks.run("after-highlight",A),l.hooks.run("complete",A),T&&T.call(A.element)}if(l.hooks.run("before-sanity-check",A),R=A.element.parentElement,R&&R.nodeName.toLowerCase()==="pre"&&!R.hasAttribute("tabindex")&&R.setAttribute("tabindex","0"),!A.code){l.hooks.run("complete",A),T&&T.call(A.element);return}if(l.hooks.run("before-highlight",A),!A.grammar){M(l.util.encode(A.code));return}if(_&&n.Worker){var H=new Worker(l.filename);H.onmessage=function(Q){M(Q.data)},H.postMessage(JSON.stringify({language:A.language,code:A.code,immediateClose:!0}))}else M(l.highlight(A.code,A.grammar,A.language))},highlight:function(k,_,T){var j={code:k,grammar:_,language:T};if(l.hooks.run("before-tokenize",j),!j.grammar)throw new Error('The language "'+j.language+'" has no grammar.');return j.tokens=l.tokenize(j.code,j.grammar),l.hooks.run("after-tokenize",j),c.stringify(l.util.encode(j.tokens),j.language)},tokenize:function(k,_){var T=_.rest;if(T){for(var j in T)_[j]=T[j];delete _.rest}var P=new p;return g(P,P.head,k),f(k,P,_,P.head,0),v(P)},hooks:{all:{},add:function(k,_){var T=l.hooks.all;T[k]=T[k]||[],T[k].push(_)},run:function(k,_){var T=l.hooks.all[k];if(!(!T||!T.length))for(var j=0,P;P=T[j++];)P(_)}},Token:c};n.Prism=l;function c(k,_,T,j){this.type=k,this.content=_,this.alias=T,this.length=(j||"").length|0}c.stringify=function k(_,T){if(typeof _=="string")return _;if(Array.isArray(_)){var j="";return _.forEach(function(M){j+=k(M,T)}),j}var P={type:_.type,content:k(_.content,T),tag:"span",classes:["token",_.type],attributes:{},language:T},R=_.alias;R&&(Array.isArray(R)?Array.prototype.push.apply(P.classes,R):P.classes.push(R)),l.hooks.run("wrap",P);var N="";for(var A in P.attributes)N+=" "+A+'="'+(P.attributes[A]||"").replace(/"/g,"&quot;")+'"';return"<"+P.tag+' class="'+P.classes.join(" ")+'"'+N+">"+P.content+"</"+P.tag+">"};function d(k,_,T,j){k.lastIndex=_;var P=k.exec(T);if(P&&j&&P[1]){var R=P[1].length;P.index+=R,P[0]=P[0].slice(R)}return P}function f(k,_,T,j,P,R){for(var N in T)if(!(!T.hasOwnProperty(N)||!T[N])){var A=T[N];A=Array.isArray(A)?A:[A];for(var M=0;M<A.length;++M){if(R&&R.cause==N+","+M)return;var H=A[M],Q=H.inside,Z=!!H.lookbehind,ae=!!H.greedy,te=H.alias;if(ae&&!H.pattern.global){var se=H.pattern.toString().match(/[imsuy]*$/)[0];H.pattern=RegExp(H.pattern.source,se+"g")}for(var L=H.pattern||H,G=j.next,I=P;G!==_.tail&&!(R&&I>=R.reach);I+=G.value.length,G=G.next){var z=G.value;if(_.length>k.length)return;if(!(z instanceof c)){var V=1,O;if(ae){if(O=d(L,I,k,Z),!O||O.index>=k.length)break;var ee=O.index,W=O.index+O[0].length,q=I;for(q+=G.value.length;ee>=q;)G=G.next,q+=G.value.length;if(q-=G.value.length,I=q,G.value instanceof c)continue;for(var Y=G;Y!==_.tail&&(q<W||typeof Y.value=="string");Y=Y.next)V++,q+=Y.value.length;V--,z=k.slice(I,q),O.index-=I}else if(O=d(L,0,z,Z),!O)continue;var ee=O.index,X=O[0],ne=z.slice(0,ee),ge=z.slice(ee+X.length),_e=I+z.length;R&&_e>R.reach&&(R.reach=_e);var Pe=G.prev;ne&&(Pe=g(_,Pe,ne),I+=ne.length),y(_,Pe,V);var ce=new c(N,Q?l.tokenize(X,Q):X,te,X);if(G=g(_,Pe,ce),ge&&g(_,G,ge),V>1){var ye={cause:N+","+M,reach:_e};f(k,_,T,G.prev,I,ye),R&&ye.reach>R.reach&&(R.reach=ye.reach)}}}}}}function p(){var k={value:null,prev:null,next:null},_={value:null,prev:k,next:null};k.next=_,this.head=k,this.tail=_,this.length=0}function g(k,_,T){var j=_.next,P={value:T,prev:_,next:j};return _.next=P,j.prev=P,k.length++,P}function y(k,_,T){for(var j=_.next,P=0;P<T&&j!==k.tail;P++)j=j.next;_.next=j,j.prev=_,k.length-=P}function v(k){for(var _=[],T=k.head.next;T!==k.tail;)_.push(T.value),T=T.next;return _}if(!n.document)return n.addEventListener&&(l.disableWorkerMessageHandler||n.addEventListener("message",function(k){var _=JSON.parse(k.data),T=_.language,j=_.code,P=_.immediateClose;n.postMessage(l.highlight(j,l.languages[T],T)),P&&n.close()},!1)),l;var w=l.util.currentScript();w&&(l.filename=w.src,w.hasAttribute("data-manual")&&(l.manual=!0));function b(){l.manual||l.highlightAll()}if(!l.manual){var E=document.readyState;E==="loading"||E==="interactive"&&w&&w.defer?document.addEventListener("DOMContentLoaded",b):window.requestAnimationFrame?window.requestAnimationFrame(b):window.setTimeout(b,16)}return l})(t);e.exports&&(e.exports=r),typeof $y<"u"&&($y.Prism=r),r.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},r.languages.markup.tag.inside["attr-value"].inside.entity=r.languages.markup.entity,r.languages.markup.doctype.inside["internal-subset"].inside=r.languages.markup,r.hooks.add("wrap",function(n){n.type==="entity"&&(n.attributes.title=n.content.replace(/&amp;/,"&"))}),Object.defineProperty(r.languages.markup.tag,"addInlined",{value:function(s,a){var i={};i["language-"+a]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:r.languages[a]},i.cdata=/^<!\[CDATA\[|\]\]>$/i;var l={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:i}};l["language-"+a]={pattern:/[\s\S]+/,inside:r.languages[a]};var c={};c[s]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return s}),"i"),lookbehind:!0,greedy:!0,inside:l},r.languages.insertBefore("markup","cdata",c)}}),Object.defineProperty(r.languages.markup.tag,"addAttribute",{value:function(n,s){r.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+n+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[s,"language-"+s],inside:r.languages[s]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),r.languages.html=r.languages.markup,r.languages.mathml=r.languages.markup,r.languages.svg=r.languages.markup,r.languages.xml=r.languages.extend("markup",{}),r.languages.ssml=r.languages.xml,r.languages.atom=r.languages.xml,r.languages.rss=r.languages.xml,(function(n){var s=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;n.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+s.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+s.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+s.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+s.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:s,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},n.languages.css.atrule.inside.rest=n.languages.css;var a=n.languages.markup;a&&(a.tag.addInlined("style","css"),a.tag.addAttribute("style","css"))})(r),r.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},r.languages.javascript=r.languages.extend("clike",{"class-name":[r.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),r.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,r.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:r.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:r.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:r.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:r.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:r.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),r.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:r.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),r.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),r.languages.markup&&(r.languages.markup.tag.addInlined("script","javascript"),r.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),r.languages.js=r.languages.javascript,(function(){if(typeof r>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var n="Loading…",s=function(w,b){return"✖ Error "+w+" while fetching file: "+b},a="✖ Error: File does not exist or is empty",i={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},l="data-src-status",c="loading",d="loaded",f="failed",p="pre[data-src]:not(["+l+'="'+d+'"]):not(['+l+'="'+c+'"])';function g(w,b,E){var k=new XMLHttpRequest;k.open("GET",w,!0),k.onreadystatechange=function(){k.readyState==4&&(k.status<400&&k.responseText?b(k.responseText):k.status>=400?E(s(k.status,k.statusText)):E(a))},k.send(null)}function y(w){var b=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(w||"");if(b){var E=Number(b[1]),k=b[2],_=b[3];return k?_?[E,Number(_)]:[E,void 0]:[E,E]}}r.hooks.add("before-highlightall",function(w){w.selector+=", "+p}),r.hooks.add("before-sanity-check",function(w){var b=w.element;if(b.matches(p)){w.code="",b.setAttribute(l,c);var E=b.appendChild(document.createElement("CODE"));E.textContent=n;var k=b.getAttribute("data-src"),_=w.language;if(_==="none"){var T=(/\.(\w+)$/.exec(k)||[,"none"])[1];_=i[T]||T}r.util.setLanguage(E,_),r.util.setLanguage(b,_);var j=r.plugins.autoloader;j&&j.loadLanguages(_),g(k,function(P){b.setAttribute(l,d);var R=y(b.getAttribute("data-range"));if(R){var N=P.split(/\r\n?|\n/g),A=R[0],M=R[1]==null?N.length:R[1];A<0&&(A+=N.length),A=Math.max(0,Math.min(A-1,N.length)),M<0&&(M+=N.length),M=Math.max(0,Math.min(M,N.length)),P=N.slice(A,M).join(`
`),b.hasAttribute("data-start")||b.setAttribute("data-start",String(A+1))}E.textContent=P,r.highlightElement(E)},function(P){b.setAttribute(l,f),E.textContent=P})}}),r.plugins.fileHighlight={highlight:function(b){for(var E=(b||document).querySelectorAll(p),k=0,_;_=E[k++];)r.highlightElement(_)}};var v=!1;r.fileHighlight=function(){v||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),v=!0),r.plugins.fileHighlight.highlight.apply(this,arguments)}})()})(Lw)),Lw.exports}A$();Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/};Prism.languages.javascript=Prism.languages.extend("clike",{"class-name":[Prism.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/});Prism.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/;Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:Prism.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:Prism.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/});Prism.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}});Prism.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}});Prism.languages.markup&&(Prism.languages.markup.tag.addInlined("script","javascript"),Prism.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript"));Prism.languages.js=Prism.languages.javascript;Prism.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]};Prism.languages.markup.tag.inside["attr-value"].inside.entity=Prism.languages.markup.entity;Prism.languages.markup.doctype.inside["internal-subset"].inside=Prism.languages.markup;Prism.hooks.add("wrap",function(e){e.type==="entity"&&(e.attributes.title=e.content.replace(/&amp;/,"&"))});Object.defineProperty(Prism.languages.markup.tag,"addInlined",{value:function(t,r){var n={};n["language-"+r]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:Prism.languages[r]},n.cdata=/^<!\[CDATA\[|\]\]>$/i;var s={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:n}};s["language-"+r]={pattern:/[\s\S]+/,inside:Prism.languages[r]};var a={};a[t]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return t}),"i"),lookbehind:!0,greedy:!0,inside:s},Prism.languages.insertBefore("markup","cdata",a)}});Object.defineProperty(Prism.languages.markup.tag,"addAttribute",{value:function(e,t){Prism.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+e+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[t,"language-"+t],inside:Prism.languages[t]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}});Prism.languages.html=Prism.languages.markup;Prism.languages.mathml=Prism.languages.markup;Prism.languages.svg=Prism.languages.markup;Prism.languages.xml=Prism.languages.extend("markup",{});Prism.languages.ssml=Prism.languages.xml;Prism.languages.atom=Prism.languages.xml;Prism.languages.rss=Prism.languages.xml;(function(e){var t=/(?:\\.|[^\\\n\r]|(?:\n|\r\n?)(?![\r\n]))/.source;function r(f){return f=f.replace(/<inner>/g,function(){return t}),RegExp(/((?:^|[^\\])(?:\\{2})*)/.source+"(?:"+f+")")}var n=/(?:\\.|``(?:[^`\r\n]|`(?!`))+``|`[^`\r\n]+`|[^\\|\r\n`])+/.source,s=/\|?__(?:\|__)+\|?(?:(?:\n|\r\n?)|(?![\s\S]))/.source.replace(/__/g,function(){return n}),a=/\|?[ \t]*:?-{3,}:?[ \t]*(?:\|[ \t]*:?-{3,}:?[ \t]*)+\|?(?:\n|\r\n?)/.source;e.languages.markdown=e.languages.extend("markup",{}),e.languages.insertBefore("markdown","prolog",{"front-matter-block":{pattern:/(^(?:\s*[\r\n])?)---(?!.)[\s\S]*?[\r\n]---(?!.)/,lookbehind:!0,greedy:!0,inside:{punctuation:/^---|---$/,"front-matter":{pattern:/\S+(?:\s+\S+)*/,alias:["yaml","language-yaml"],inside:e.languages.yaml}}},blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},table:{pattern:RegExp("^"+s+a+"(?:"+s+")*","m"),inside:{"table-data-rows":{pattern:RegExp("^("+s+a+")(?:"+s+")*$"),lookbehind:!0,inside:{"table-data":{pattern:RegExp(n),inside:e.languages.markdown},punctuation:/\|/}},"table-line":{pattern:RegExp("^("+s+")"+a+"$"),lookbehind:!0,inside:{punctuation:/\||:?-{3,}:?/}},"table-header-row":{pattern:RegExp("^"+s+"$"),inside:{"table-header":{pattern:RegExp(n),alias:"important",inside:e.languages.markdown},punctuation:/\|/}}}},code:[{pattern:/((?:^|\n)[ \t]*\n|(?:^|\r\n?)[ \t]*\r\n?)(?: {4}|\t).+(?:(?:\n|\r\n?)(?: {4}|\t).+)*/,lookbehind:!0,alias:"keyword"},{pattern:/^```[\s\S]*?^```$/m,greedy:!0,inside:{"code-block":{pattern:/^(```.*(?:\n|\r\n?))[\s\S]+?(?=(?:\n|\r\n?)^```$)/m,lookbehind:!0},"code-language":{pattern:/^(```).+/,lookbehind:!0},punctuation:/```/}}],title:[{pattern:/\S.*(?:\n|\r\n?)(?:==+|--+)(?=[ \t]*$)/m,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])(?:[\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:r(/\b__(?:(?!_)<inner>|_(?:(?!_)<inner>)+_)+__\b|\*\*(?:(?!\*)<inner>|\*(?:(?!\*)<inner>)+\*)+\*\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^..)[\s\S]+(?=..$)/,lookbehind:!0,inside:{}},punctuation:/\*\*|__/}},italic:{pattern:r(/\b_(?:(?!_)<inner>|__(?:(?!_)<inner>)+__)+_\b|\*(?:(?!\*)<inner>|\*\*(?:(?!\*)<inner>)+\*\*)+\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^.)[\s\S]+(?=.$)/,lookbehind:!0,inside:{}},punctuation:/[*_]/}},strike:{pattern:r(/(~~?)(?:(?!~)<inner>)+\2/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^~~?)[\s\S]+(?=\1$)/,lookbehind:!0,inside:{}},punctuation:/~~?/}},"code-snippet":{pattern:/(^|[^\\`])(?:``[^`\r\n]+(?:`[^`\r\n]+)*``(?!`)|`[^`\r\n]+`(?!`))/,lookbehind:!0,greedy:!0,alias:["code","keyword"]},url:{pattern:r(/!?\[(?:(?!\])<inner>)+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)|[ \t]?\[(?:(?!\])<inner>)+\])/.source),lookbehind:!0,greedy:!0,inside:{operator:/^!/,content:{pattern:/(^\[)[^\]]+(?=\])/,lookbehind:!0,inside:{}},variable:{pattern:/(^\][ \t]?\[)[^\]]+(?=\]$)/,lookbehind:!0},url:{pattern:/(^\]\()[^\s)]+/,lookbehind:!0},string:{pattern:/(^[ \t]+)"(?:\\.|[^"\\])*"(?=\)$)/,lookbehind:!0}}}}),["url","bold","italic","strike"].forEach(function(f){["url","bold","italic","strike","code-snippet"].forEach(function(p){f!==p&&(e.languages.markdown[f].inside.content.inside[p]=e.languages.markdown[p])})}),e.hooks.add("after-tokenize",function(f){if(f.language!=="markdown"&&f.language!=="md")return;function p(g){if(!(!g||typeof g=="string"))for(var y=0,v=g.length;y<v;y++){var w=g[y];if(w.type!=="code"){p(w.content);continue}var b=w.content[1],E=w.content[3];if(b&&E&&b.type==="code-language"&&E.type==="code-block"&&typeof b.content=="string"){var k=b.content.replace(/\b#/g,"sharp").replace(/\b\+\+/g,"pp");k=(/[a-z][\w-]*/i.exec(k)||[""])[0].toLowerCase();var _="language-"+k;E.alias?typeof E.alias=="string"?E.alias=[E.alias,_]:E.alias.push(_):E.alias=[_]}}}p(f.tokens)}),e.hooks.add("wrap",function(f){if(f.type==="code-block"){for(var p="",g=0,y=f.classes.length;g<y;g++){var v=f.classes[g],w=/language-(.+)/.exec(v);if(w){p=w[1];break}}var b=e.languages[p];if(b)f.content=e.highlight(d(f.content),b,p);else if(p&&p!=="none"&&e.plugins.autoloader){var E="md-"+new Date().valueOf()+"-"+Math.floor(Math.random()*1e16);f.attributes.id=E,e.plugins.autoloader.loadLanguages(p,function(){var k=document.getElementById(E);k&&(k.innerHTML=e.highlight(k.textContent,e.languages[p],p))})}}});var i=RegExp(e.languages.markup.tag.pattern.source,"gi"),l={amp:"&",lt:"<",gt:">",quot:'"'},c=String.fromCodePoint||String.fromCharCode;function d(f){var p=f.replace(i,"");return p=p.replace(/&(\w{1,8}|#x?[\da-f]{1,8});/gi,function(g,y){if(y=y.toLowerCase(),y[0]==="#"){var v;return y[1]==="x"?v=parseInt(y.slice(2),16):v=Number(y.slice(1)),c(v)}else{var w=l[y];return w||g}}),p}e.languages.md=e.languages.markdown})(Prism);Prism.languages.c=Prism.languages.extend("clike",{comment:{pattern:/\/\/(?:[^\r\n\\]|\\(?:\r\n?|\n|(?![\r\n])))*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},"class-name":{pattern:/(\b(?:enum|struct)\s+(?:__attribute__\s*\(\([\s\S]*?\)\)\s*)?)\w+|\b[a-z]\w*_t\b/,lookbehind:!0},keyword:/\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|__attribute__|asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|inline|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|typeof|union|unsigned|void|volatile|while)\b/,function:/\b[a-z_]\w*(?=\s*\()/i,number:/(?:\b0x(?:[\da-f]+(?:\.[\da-f]*)?|\.[\da-f]+)(?:p[+-]?\d+)?|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?)[ful]{0,4}/i,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*/%&|^!=<>]=?/});Prism.languages.insertBefore("c","string",{char:{pattern:/'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n]){0,32}'/,greedy:!0}});Prism.languages.insertBefore("c","string",{macro:{pattern:/(^[\t ]*)#\s*[a-z](?:[^\r\n\\/]|\/(?!\*)|\/\*(?:[^*]|\*(?!\/))*\*\/|\\(?:\r\n|[\s\S]))*/im,lookbehind:!0,greedy:!0,alias:"property",inside:{string:[{pattern:/^(#\s*include\s*)<[^>]+>/,lookbehind:!0},Prism.languages.c.string],char:Prism.languages.c.char,comment:Prism.languages.c.comment,"macro-name":[{pattern:/(^#\s*define\s+)\w+\b(?!\()/i,lookbehind:!0},{pattern:/(^#\s*define\s+)\w+\b(?=\()/i,lookbehind:!0,alias:"function"}],directive:{pattern:/^(#\s*)[a-z]+/,lookbehind:!0,alias:"keyword"},"directive-hash":/^#/,punctuation:/##|\\(?=[\r\n])/,expression:{pattern:/\S[\s\S]*/,inside:Prism.languages.c}}}});Prism.languages.insertBefore("c","function",{constant:/\b(?:EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|__DATE__|__FILE__|__LINE__|__TIMESTAMP__|__TIME__|__func__|stderr|stdin|stdout)\b/});delete Prism.languages.c.boolean;(function(e){var t=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;e.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+t.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+t.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+t.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+t.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:t,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},e.languages.css.atrule.inside.rest=e.languages.css;var r=e.languages.markup;r&&(r.tag.addInlined("style","css"),r.tag.addAttribute("style","css"))})(Prism);Prism.languages.objectivec=Prism.languages.extend("c",{string:{pattern:/@?"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},keyword:/\b(?:asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|in|inline|int|long|register|return|self|short|signed|sizeof|static|struct|super|switch|typedef|typeof|union|unsigned|void|volatile|while)\b|(?:@interface|@end|@implementation|@protocol|@class|@public|@protected|@private|@property|@try|@catch|@finally|@throw|@synthesize|@dynamic|@selector)\b/,operator:/-[->]?|\+\+?|!=?|<<?=?|>>?=?|==?|&&?|\|\|?|[~^%?*\/@]/});delete Prism.languages.objectivec["class-name"];Prism.languages.objc=Prism.languages.objectivec;Prism.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},identifier:{pattern:/(^|[^@\\])`(?:\\[\s\S]|[^`\\]|``)*`/,greedy:!0,lookbehind:!0,inside:{punctuation:/^`|`$/}},function:/\b(?:AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:COL|_INSERT)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:ING|S)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/i,boolean:/\b(?:FALSE|NULL|TRUE)\b/i,number:/\b0x[\da-f]+\b|\b\d+(?:\.\d*)?|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|ILIKE|IN|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/};(function(e){var t=e.languages.powershell={comment:[{pattern:/(^|[^`])<#[\s\S]*?#>/,lookbehind:!0},{pattern:/(^|[^`])#.*/,lookbehind:!0}],string:[{pattern:/"(?:`[\s\S]|[^`"])*"/,greedy:!0,inside:null},{pattern:/'(?:[^']|'')*'/,greedy:!0}],namespace:/\[[a-z](?:\[(?:\[[^\]]*\]|[^\[\]])*\]|[^\[\]])*\]/i,boolean:/\$(?:false|true)\b/i,variable:/\$\w+\b/,function:[/\b(?:Add|Approve|Assert|Backup|Block|Checkpoint|Clear|Close|Compare|Complete|Compress|Confirm|Connect|Convert|ConvertFrom|ConvertTo|Copy|Debug|Deny|Disable|Disconnect|Dismount|Edit|Enable|Enter|Exit|Expand|Export|Find|ForEach|Format|Get|Grant|Group|Hide|Import|Initialize|Install|Invoke|Join|Limit|Lock|Measure|Merge|Move|New|Open|Optimize|Out|Ping|Pop|Protect|Publish|Push|Read|Receive|Redo|Register|Remove|Rename|Repair|Request|Reset|Resize|Resolve|Restart|Restore|Resume|Revoke|Save|Search|Select|Send|Set|Show|Skip|Sort|Split|Start|Step|Stop|Submit|Suspend|Switch|Sync|Tee|Test|Trace|Unblock|Undo|Uninstall|Unlock|Unprotect|Unpublish|Unregister|Update|Use|Wait|Watch|Where|Write)-[a-z]+\b/i,/\b(?:ac|cat|chdir|clc|cli|clp|clv|compare|copy|cp|cpi|cpp|cvpa|dbp|del|diff|dir|ebp|echo|epal|epcsv|epsn|erase|fc|fl|ft|fw|gal|gbp|gc|gci|gcs|gdr|gi|gl|gm|gp|gps|group|gsv|gu|gv|gwmi|iex|ii|ipal|ipcsv|ipsn|irm|iwmi|iwr|kill|lp|ls|measure|mi|mount|move|mp|mv|nal|ndr|ni|nv|ogv|popd|ps|pushd|pwd|rbp|rd|rdr|ren|ri|rm|rmdir|rni|rnp|rp|rv|rvpa|rwmi|sal|saps|sasv|sbp|sc|select|set|shcm|si|sl|sleep|sls|sort|sp|spps|spsv|start|sv|swmi|tee|trcm|type|write)\b/i],keyword:/\b(?:Begin|Break|Catch|Class|Continue|Data|Define|Do|DynamicParam|Else|ElseIf|End|Exit|Filter|Finally|For|ForEach|From|Function|If|InlineScript|Parallel|Param|Process|Return|Sequence|Switch|Throw|Trap|Try|Until|Using|Var|While|Workflow)\b/i,operator:{pattern:/(^|\W)(?:!|-(?:b?(?:and|x?or)|as|(?:Not)?(?:Contains|In|Like|Match)|eq|ge|gt|is(?:Not)?|Join|le|lt|ne|not|Replace|sh[lr])\b|-[-=]?|\+[+=]?|[*\/%]=?)/i,lookbehind:!0},punctuation:/[|{}[\];(),.]/};t.string[0].inside={function:{pattern:/(^|[^`])\$\((?:\$\([^\r\n()]*\)|(?!\$\()[^\r\n)])*\)/,lookbehind:!0,inside:t},boolean:t.boolean,variable:t.variable}})(Prism);var UN={},$N;function F$(){return $N||($N=1,Prism.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/},Prism.languages.python["string-interpolation"].inside.interpolation.inside.rest=Prism.languages.python,Prism.languages.py=Prism.languages.python),UN}F$();var WN={},zN;function P$(){return zN||(zN=1,(function(e){for(var t=/\/\*(?:[^*/]|\*(?!\/)|\/(?!\*)|<self>)*\*\//.source,r=0;r<2;r++)t=t.replace(/<self>/g,function(){return t});t=t.replace(/<self>/g,function(){return/[^\s\S]/.source}),e.languages.rust={comment:[{pattern:RegExp(/(^|[^\\])/.source+t),lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/b?"(?:\\[\s\S]|[^\\"])*"|b?r(#*)"(?:[^"]|"(?!\1))*"\1/,greedy:!0},char:{pattern:/b?'(?:\\(?:x[0-7][\da-fA-F]|u\{(?:[\da-fA-F]_*){1,6}\}|.)|[^\\\r\n\t'])'/,greedy:!0},attribute:{pattern:/#!?\[(?:[^\[\]"]|"(?:\\[\s\S]|[^\\"])*")*\]/,greedy:!0,alias:"attr-name",inside:{string:null}},"closure-params":{pattern:/([=(,:]\s*|\bmove\s*)\|[^|]*\||\|[^|]*\|(?=\s*(?:\{|->))/,lookbehind:!0,greedy:!0,inside:{"closure-punctuation":{pattern:/^\||\|$/,alias:"punctuation"},rest:null}},"lifetime-annotation":{pattern:/'\w+/,alias:"symbol"},"fragment-specifier":{pattern:/(\$\w+:)[a-z]+/,lookbehind:!0,alias:"punctuation"},variable:/\$\w+/,"function-definition":{pattern:/(\bfn\s+)\w+/,lookbehind:!0,alias:"function"},"type-definition":{pattern:/(\b(?:enum|struct|trait|type|union)\s+)\w+/,lookbehind:!0,alias:"class-name"},"module-declaration":[{pattern:/(\b(?:crate|mod)\s+)[a-z][a-z_\d]*/,lookbehind:!0,alias:"namespace"},{pattern:/(\b(?:crate|self|super)\s*)::\s*[a-z][a-z_\d]*\b(?:\s*::(?:\s*[a-z][a-z_\d]*\s*::)*)?/,lookbehind:!0,alias:"namespace",inside:{punctuation:/::/}}],keyword:[/\b(?:Self|abstract|as|async|await|become|box|break|const|continue|crate|do|dyn|else|enum|extern|final|fn|for|if|impl|in|let|loop|macro|match|mod|move|mut|override|priv|pub|ref|return|self|static|struct|super|trait|try|type|typeof|union|unsafe|unsized|use|virtual|where|while|yield)\b/,/\b(?:bool|char|f(?:32|64)|[ui](?:8|16|32|64|128|size)|str)\b/],function:/\b[a-z_]\w*(?=\s*(?:::\s*<|\())/,macro:{pattern:/\b\w+!/,alias:"property"},constant:/\b[A-Z_][A-Z_\d]+\b/,"class-name":/\b[A-Z]\w*\b/,namespace:{pattern:/(?:\b[a-z][a-z_\d]*\s*::\s*)*\b[a-z][a-z_\d]*\s*::(?!\s*<)/,inside:{punctuation:/::/}},number:/\b(?:0x[\dA-Fa-f](?:_?[\dA-Fa-f])*|0o[0-7](?:_?[0-7])*|0b[01](?:_?[01])*|(?:(?:\d(?:_?\d)*)?\.)?\d(?:_?\d)*(?:[Ee][+-]?\d+)?)(?:_?(?:f32|f64|[iu](?:8|16|32|64|size)?))?\b/,boolean:/\b(?:false|true)\b/,punctuation:/->|\.\.=|\.{1,3}|::|[{}[\];(),:]/,operator:/[-+*\/%!^]=?|=[=>]?|&[&=]?|\|[|=]?|<<?=?|>>?=?|[@?]/},e.languages.rust["closure-params"].inside.rest=e.languages.rust,e.languages.rust.attribute.inside.string=e.languages.rust.string})(Prism)),WN}P$();Prism.languages.swift={comment:{pattern:/(^|[^\\:])(?:\/\/.*|\/\*(?:[^/*]|\/(?!\*)|\*(?!\/)|\/\*(?:[^*]|\*(?!\/))*\*\/)*\*\/)/,lookbehind:!0,greedy:!0},"string-literal":[{pattern:RegExp(/(^|[^"#])/.source+"(?:"+/"(?:\\(?:\((?:[^()]|\([^()]*\))*\)|\r\n|[^(])|[^\\\r\n"])*"/.source+"|"+/"""(?:\\(?:\((?:[^()]|\([^()]*\))*\)|[^(])|[^\\"]|"(?!""))*"""/.source+")"+/(?!["#])/.source),lookbehind:!0,greedy:!0,inside:{interpolation:{pattern:/(\\\()(?:[^()]|\([^()]*\))*(?=\))/,lookbehind:!0,inside:null},"interpolation-punctuation":{pattern:/^\)|\\\($/,alias:"punctuation"},punctuation:/\\(?=[\r\n])/,string:/[\s\S]+/}},{pattern:RegExp(/(^|[^"#])(#+)/.source+"(?:"+/"(?:\\(?:#+\((?:[^()]|\([^()]*\))*\)|\r\n|[^#])|[^\\\r\n])*?"/.source+"|"+/"""(?:\\(?:#+\((?:[^()]|\([^()]*\))*\)|[^#])|[^\\])*?"""/.source+")\\2"),lookbehind:!0,greedy:!0,inside:{interpolation:{pattern:/(\\#+\()(?:[^()]|\([^()]*\))*(?=\))/,lookbehind:!0,inside:null},"interpolation-punctuation":{pattern:/^\)|\\#+\($/,alias:"punctuation"},string:/[\s\S]+/}}],directive:{pattern:RegExp(/#/.source+"(?:"+(/(?:elseif|if)\b/.source+"(?:[ 	]*"+/(?:![ \t]*)?(?:\b\w+\b(?:[ \t]*\((?:[^()]|\([^()]*\))*\))?|\((?:[^()]|\([^()]*\))*\))(?:[ \t]*(?:&&|\|\|))?/.source+")+")+"|"+/(?:else|endif)\b/.source+")"),alias:"property",inside:{"directive-name":/^#\w+/,boolean:/\b(?:false|true)\b/,number:/\b\d+(?:\.\d+)*\b/,operator:/!|&&|\|\||[<>]=?/,punctuation:/[(),]/}},literal:{pattern:/#(?:colorLiteral|column|dsohandle|file(?:ID|Literal|Path)?|function|imageLiteral|line)\b/,alias:"constant"},"other-directive":{pattern:/#\w+\b/,alias:"property"},attribute:{pattern:/@\w+/,alias:"atrule"},"function-definition":{pattern:/(\bfunc\s+)\w+/,lookbehind:!0,alias:"function"},label:{pattern:/\b(break|continue)\s+\w+|\b[a-zA-Z_]\w*(?=\s*:\s*(?:for|repeat|while)\b)/,lookbehind:!0,alias:"important"},keyword:/\b(?:Any|Protocol|Self|Type|actor|as|assignment|associatedtype|associativity|async|await|break|case|catch|class|continue|convenience|default|defer|deinit|didSet|do|dynamic|else|enum|extension|fallthrough|fileprivate|final|for|func|get|guard|higherThan|if|import|in|indirect|infix|init|inout|internal|is|isolated|lazy|left|let|lowerThan|mutating|none|nonisolated|nonmutating|open|operator|optional|override|postfix|precedencegroup|prefix|private|protocol|public|repeat|required|rethrows|return|right|safe|self|set|some|static|struct|subscript|super|switch|throw|throws|try|typealias|unowned|unsafe|var|weak|where|while|willSet)\b/,boolean:/\b(?:false|true)\b/,nil:{pattern:/\bnil\b/,alias:"constant"},"short-argument":/\$\d+\b/,omit:{pattern:/\b_\b/,alias:"keyword"},number:/\b(?:[\d_]+(?:\.[\de_]+)?|0x[a-f0-9_]+(?:\.[a-f0-9p_]+)?|0b[01_]+|0o[0-7_]+)\b/i,"class-name":/\b[A-Z](?:[A-Z_\d]*[a-z]\w*)?\b/,function:/\b[a-z_]\w*(?=\s*\()/i,constant:/\b(?:[A-Z_]{2,}|k[A-Z][A-Za-z_]+)\b/,operator:/[-+*/%=!<>&|^~?]+|\.[.\-+*/%=!<>&|^~?]+/,punctuation:/[{}[\]();,.:\\]/};Prism.languages.swift["string-literal"].forEach(function(e){e.inside.interpolation.inside=Prism.languages.swift});var HN={},GN;function R$(){return GN||(GN=1,(function(e){e.languages.typescript=e.languages.extend("javascript",{"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|type)\s+)(?!keyof\b)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?:\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>)?/,lookbehind:!0,greedy:!0,inside:null},builtin:/\b(?:Array|Function|Promise|any|boolean|console|never|number|string|symbol|unknown)\b/}),e.languages.typescript.keyword.push(/\b(?:abstract|declare|is|keyof|readonly|require)\b/,/\b(?:asserts|infer|interface|module|namespace|type)\b(?=\s*(?:[{_$a-zA-Z\xA0-\uFFFF]|$))/,/\btype\b(?=\s*(?:[\{*]|$))/),delete e.languages.typescript.parameter,delete e.languages.typescript["literal-property"];var t=e.languages.extend("typescript",{});delete t["class-name"],e.languages.typescript["class-name"].inside=t,e.languages.insertBefore("typescript","function",{decorator:{pattern:/@[$\w\xA0-\uFFFF]+/,inside:{at:{pattern:/^@/,alias:"operator"},function:/^[\s\S]+/}},"generic-function":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>(?=\s*\()/,greedy:!0,inside:{function:/^#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:t}}}}),e.languages.ts=e.languages.typescript})(Prism)),HN}R$();var VN={},KN;function D$(){return KN||(KN=1,(function(e){var t=/\b(?:abstract|assert|boolean|break|byte|case|catch|char|class|const|continue|default|do|double|else|enum|exports|extends|final|finally|float|for|goto|if|implements|import|instanceof|int|interface|long|module|native|new|non-sealed|null|open|opens|package|permits|private|protected|provides|public|record(?!\s*[(){}[\]<>=%~.:,;?+\-*/&|^])|requires|return|sealed|short|static|strictfp|super|switch|synchronized|this|throw|throws|to|transient|transitive|try|uses|var|void|volatile|while|with|yield)\b/,r=/(?:[a-z]\w*\s*\.\s*)*(?:[A-Z]\w*\s*\.\s*)*/.source,n={pattern:RegExp(/(^|[^\w.])/.source+r+/[A-Z](?:[\d_A-Z]*[a-z]\w*)?\b/.source),lookbehind:!0,inside:{namespace:{pattern:/^[a-z]\w*(?:\s*\.\s*[a-z]\w*)*(?:\s*\.)?/,inside:{punctuation:/\./}},punctuation:/\./}};e.languages.java=e.languages.extend("clike",{string:{pattern:/(^|[^\\])"(?:\\.|[^"\\\r\n])*"/,lookbehind:!0,greedy:!0},"class-name":[n,{pattern:RegExp(/(^|[^\w.])/.source+r+/[A-Z]\w*(?=\s+\w+\s*[;,=()]|\s*(?:\[[\s,]*\]\s*)?::\s*new\b)/.source),lookbehind:!0,inside:n.inside},{pattern:RegExp(/(\b(?:class|enum|extends|implements|instanceof|interface|new|record|throws)\s+)/.source+r+/[A-Z]\w*\b/.source),lookbehind:!0,inside:n.inside}],keyword:t,function:[e.languages.clike.function,{pattern:/(::\s*)[a-z_]\w*/,lookbehind:!0}],number:/\b0b[01][01_]*L?\b|\b0x(?:\.[\da-f_p+-]+|[\da-f_]+(?:\.[\da-f_p+-]+)?)\b|(?:\b\d[\d_]*(?:\.[\d_]*)?|\B\.\d[\d_]*)(?:e[+-]?\d[\d_]*)?[dfl]?/i,operator:{pattern:/(^|[^.])(?:<<=?|>>>?=?|->|--|\+\+|&&|\|\||::|[?:~]|[-+*/%&|^!=<>]=?)/m,lookbehind:!0},constant:/\b[A-Z][A-Z_\d]+\b/}),e.languages.insertBefore("java","string",{"triple-quoted-string":{pattern:/"""[ \t]*[\r\n](?:(?:"|"")?(?:\\.|[^"\\]))*"""/,greedy:!0,alias:"string"},char:{pattern:/'(?:\\.|[^'\\\r\n]){1,6}'/,greedy:!0}}),e.languages.insertBefore("java","class-name",{annotation:{pattern:/(^|[^.])@\w+(?:\s*\.\s*\w+)*/,lookbehind:!0,alias:"punctuation"},generics:{pattern:/<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&))*>)*>)*>)*>/,inside:{"class-name":n,keyword:t,punctuation:/[<>(),.:]/,operator:/[?&|]/}},import:[{pattern:RegExp(/(\bimport\s+)/.source+r+/(?:[A-Z]\w*|\*)(?=\s*;)/.source),lookbehind:!0,inside:{namespace:n.inside.namespace,punctuation:/\./,operator:/\*/,"class-name":/\w+/}},{pattern:RegExp(/(\bimport\s+static\s+)/.source+r+/(?:\w+|\*)(?=\s*;)/.source),lookbehind:!0,alias:"static",inside:{namespace:n.inside.namespace,static:/\b\w+$/,punctuation:/\./,operator:/\*/,"class-name":/\w+/}}],namespace:{pattern:RegExp(/(\b(?:exports|import(?:\s+static)?|module|open|opens|package|provides|requires|to|transitive|uses|with)\s+)(?!<keyword>)[a-z]\w*(?:\.[a-z]\w*)*\.?/.source.replace(/<keyword>/g,function(){return t.source})),lookbehind:!0,inside:{punctuation:/\./}}})})(Prism)),VN}D$();var qN={},XN;function I$(){return XN||(XN=1,(function(e){var t=/\b(?:alignas|alignof|asm|auto|bool|break|case|catch|char|char16_t|char32_t|char8_t|class|co_await|co_return|co_yield|compl|concept|const|const_cast|consteval|constexpr|constinit|continue|decltype|default|delete|do|double|dynamic_cast|else|enum|explicit|export|extern|final|float|for|friend|goto|if|import|inline|int|int16_t|int32_t|int64_t|int8_t|long|module|mutable|namespace|new|noexcept|nullptr|operator|override|private|protected|public|register|reinterpret_cast|requires|return|short|signed|sizeof|static|static_assert|static_cast|struct|switch|template|this|thread_local|throw|try|typedef|typeid|typename|uint16_t|uint32_t|uint64_t|uint8_t|union|unsigned|using|virtual|void|volatile|wchar_t|while)\b/,r=/\b(?!<keyword>)\w+(?:\s*\.\s*\w+)*\b/.source.replace(/<keyword>/g,function(){return t.source});e.languages.cpp=e.languages.extend("c",{"class-name":[{pattern:RegExp(/(\b(?:class|concept|enum|struct|typename)\s+)(?!<keyword>)\w+/.source.replace(/<keyword>/g,function(){return t.source})),lookbehind:!0},/\b[A-Z]\w*(?=\s*::\s*\w+\s*\()/,/\b[A-Z_]\w*(?=\s*::\s*~\w+\s*\()/i,/\b\w+(?=\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>\s*::\s*\w+\s*\()/],keyword:t,number:{pattern:/(?:\b0b[01']+|\b0x(?:[\da-f']+(?:\.[\da-f']*)?|\.[\da-f']+)(?:p[+-]?[\d']+)?|(?:\b[\d']+(?:\.[\d']*)?|\B\.[\d']+)(?:e[+-]?[\d']+)?)[ful]{0,4}/i,greedy:!0},operator:/>>=?|<<=?|->|--|\+\+|&&|\|\||[?:~]|<=>|[-+*/%&|^!=<>]=?|\b(?:and|and_eq|bitand|bitor|not|not_eq|or|or_eq|xor|xor_eq)\b/,boolean:/\b(?:false|true)\b/}),e.languages.insertBefore("cpp","string",{module:{pattern:RegExp(/(\b(?:import|module)\s+)/.source+"(?:"+/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|<[^<>\r\n]*>/.source+"|"+/<mod-name>(?:\s*:\s*<mod-name>)?|:\s*<mod-name>/.source.replace(/<mod-name>/g,function(){return r})+")"),lookbehind:!0,greedy:!0,inside:{string:/^[<"][\s\S]+/,operator:/:/,punctuation:/\./}},"raw-string":{pattern:/R"([^()\\ ]{0,16})\([\s\S]*?\)\1"/,alias:"string",greedy:!0}}),e.languages.insertBefore("cpp","keyword",{"generic-function":{pattern:/\b(?!operator\b)[a-z_]\w*\s*<(?:[^<>]|<[^<>]*>)*>(?=\s*\()/i,inside:{function:/^\w+/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:e.languages.cpp}}}}),e.languages.insertBefore("cpp","operator",{"double-colon":{pattern:/::/,alias:"punctuation"}}),e.languages.insertBefore("cpp","class-name",{"base-clause":{pattern:/(\b(?:class|struct)\s+\w+\s*:\s*)[^;{}"'\s]+(?:\s+[^;{}"'\s]+)*(?=\s*[;{])/,lookbehind:!0,greedy:!0,inside:e.languages.extend("cpp",{})}}),e.languages.insertBefore("inside","double-colon",{"class-name":/\b[a-z_]\w*\b(?!\s*::)/i},e.languages.cpp["base-clause"])})(Prism)),qN}I$();function AA(e,t){for(const r of e.childNodes){if(Bn(r)&&r.tagName===t)return!0;AA(r,t)}return!1}const Em="data-language",bm="data-highlight-language",yy="data-theme";class Tf extends Xa{static getType(){return"code"}static clone(t){return new Tf(t.__language,t.__key)}constructor(t,r){super(r),this.__language=t||void 0,this.__isSyntaxHighlightSupported=!1,this.__theme=void 0}afterCloneFrom(t){super.afterCloneFrom(t),this.__language=t.__language,this.__theme=t.__theme,this.__isSyntaxHighlightSupported=t.__isSyntaxHighlightSupported}createDOM(t){const r=document.createElement("code");Ks(r,t.theme.code),r.setAttribute("spellcheck","false");const n=this.getLanguage();n&&(r.setAttribute(Em,n),this.getIsSyntaxHighlightSupported()&&r.setAttribute(bm,n));const s=this.getTheme();s&&r.setAttribute(yy,s);const a=this.getStyle();return a&&r.setAttribute("style",a),r}updateDOM(t,r,n){const s=this.__language,a=t.__language;s?s!==a&&r.setAttribute(Em,s):a&&r.removeAttribute(Em);const i=this.__isSyntaxHighlightSupported;t.__isSyntaxHighlightSupported&&a?i&&s?s!==a&&r.setAttribute(bm,s):r.removeAttribute(bm):i&&s&&r.setAttribute(bm,s);const l=this.__theme,c=t.__theme;l?l!==c&&r.setAttribute(yy,l):c&&r.removeAttribute(yy);const d=this.__style,f=t.__style;return d?d!==f&&r.setAttribute("style",d):f&&r.removeAttribute("style"),!1}exportDOM(t){const r=document.createElement("pre");Ks(r,t._config.theme.code),r.setAttribute("spellcheck","false");const n=this.getLanguage();n&&(r.setAttribute(Em,n),this.getIsSyntaxHighlightSupported()&&r.setAttribute(bm,n));const s=this.getTheme();s&&r.setAttribute(yy,s);const a=this.getStyle();return a&&r.setAttribute("style",a),{element:r}}static importDOM(){return{code:t=>t.textContent!=null&&(/\r?\n/.test(t.textContent)||AA(t,"BR"))?{conversion:YN,priority:1}:null,div:()=>({conversion:M$,priority:1}),pre:()=>({conversion:YN,priority:0}),table:t=>Bw(t)?{conversion:O$,priority:3}:null,td:t=>{const r=t,n=r.closest("table");return r.classList.contains("js-file-line")||n&&Bw(n)?{conversion:JN,priority:3}:null},tr:t=>{const r=t.closest("table");return r&&Bw(r)?{conversion:JN,priority:3}:null}}}static importJSON(t){return Cc().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setLanguage(t.language).setTheme(t.theme)}exportJSON(){return{...super.exportJSON(),language:this.getLanguage(),theme:this.getTheme()}}insertNewAfter(t,r=!0){const n=this.getChildren(),s=n.length;if(s>=2&&n[s-1].getTextContent()===`
`&&n[s-2].getTextContent()===`
`&&t.isCollapsed()&&t.anchor.key===this.__key&&t.anchor.offset===s){n[s-1].remove(),n[s-2].remove();const c=Ln();return this.insertAfter(c,r),c}const{anchor:a,focus:i}=t,l=(a.isBefore(i)?a:i).getNode();if(Xt(l)){let c=B$(l);const d=[];for(;;)if(W1(c))d.push(T0()),c=c.getNextSibling();else{if(!RA(c))break;{let b=0;const E=c.getTextContent(),k=c.getTextContentSize();for(;b<k&&E[b]===" ";)b++;if(b!==0&&d.push(PA(" ".repeat(b))),b!==k)break;c=c.getNextSibling()}}const f=l.splitText(a.offset)[0],p=a.offset===0?0:1,g=f.getIndexWithinParent()+p,y=l.getParentOrThrow(),v=[Ul(),...d];y.splice(g,0,v);const w=d[d.length-1];w?w.select():a.offset===0?f.selectPrevious():f.getNextSibling().selectNext(0,0)}if(nS(l)){const{offset:c}=t.anchor;l.splice(c,0,[Ul()]),l.select(c+1,c+1)}return null}canIndent(){return!1}collapseAtStart(){const t=Ln();return this.getChildren().forEach((r=>t.append(r))),this.replace(t),!0}setLanguage(t){const r=this.getWritable();return r.__language=t||void 0,r}getLanguage(){return this.getLatest().__language}setIsSyntaxHighlightSupported(t){const r=this.getWritable();return r.__isSyntaxHighlightSupported=t,r}getIsSyntaxHighlightSupported(){return this.getLatest().__isSyntaxHighlightSupported}setTheme(t){const r=this.getWritable();return r.__theme=t||void 0,r}getTheme(){return this.getLatest().__theme}}function Cc(e,t){return aU(Tf).setLanguage(e).setTheme(t)}function nS(e){return e instanceof Tf}function YN(e){return{node:Cc(e.getAttribute(Em))}}function M$(e){const t=e,r=QN(t);return r||(function(n){let s=n.parentElement;for(;s!==null;){if(QN(s))return!0;s=s.parentElement}return!1})(t)?{node:r?Cc():null}:{node:null}}function O$(){return{node:Cc()}}function JN(){return{node:null}}function QN(e){return e.style.fontFamily.match("monospace")!==null}function Bw(e){return e.classList.contains("js-file-line-container")}let Q1=class FA extends ed{constructor(t="",r,n){super(t,n),this.__highlightType=r}static getType(){return"code-highlight"}static clone(t){return new FA(t.__text,t.__highlightType||void 0,t.__key)}getHighlightType(){return this.getLatest().__highlightType}setHighlightType(t){const r=this.getWritable();return r.__highlightType=t||void 0,r}canHaveFormat(){return!1}createDOM(t){const r=super.createDOM(t),n=Uw(t.theme,this.__highlightType);return Ks(r,n),r}updateDOM(t,r,n){const s=super.updateDOM(t,r,n),a=Uw(n.theme,t.__highlightType),i=Uw(n.theme,this.__highlightType);return a!==i&&(a&&Uu(r,a),i&&Ks(r,i)),s}static importJSON(t){return PA().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setHighlightType(t.highlightType)}exportJSON(){return{...super.exportJSON(),highlightType:this.getHighlightType()}}setFormat(t){return this}isParentRequired(){return!0}createParentElementNode(){return Cc()}};function Uw(e,t){return t&&e&&e.codeHighlight&&e.codeHighlight[t]}function PA(e="",t){return xi(new Q1(e,t))}function RA(e){return e instanceof Q1}function L$(e,t){let r=e;for(let n=Fa(e,t);n&&(RA(n.origin)||W1(n.origin));n=jU(n))r=n.origin;return r}function B$(e){return L$(e,"previous")}(function(e){e.languages.diff={coord:[/^(?:\*{3}|-{3}|\+{3}).*$/m,/^@@.*@@$/m,/^\d.*$/m]};var t={"deleted-sign":"-","deleted-arrow":"<","inserted-sign":"+","inserted-arrow":">",unchanged:" ",diff:"!"};Object.keys(t).forEach((function(r){var n=t[r],s=[];/^\w+$/.test(r)||s.push(/\w+/.exec(r)[0]),r==="diff"&&s.push("bold"),e.languages.diff[r]={pattern:RegExp("^(?:["+n+`].*(?:\r
?|
|(?![\\s\\S])))+`,"m"),alias:s,inside:{line:{pattern:/(.)(?=[\s\S]).*(?:\r\n?|\n)?/,lookbehind:!0},prefix:{pattern:/[\s\S]/,alias:/\w+/.exec(r)[0]}}}})),Object.defineProperty(e.languages.diff,"PREFIXES",{value:t})})(Prism);const U$=new Set(["http:","https:","mailto:","sms:","tel:"]);class nd extends Xa{static getType(){return"link"}static clone(t){return new nd(t.__url,{rel:t.__rel,target:t.__target,title:t.__title},t.__key)}constructor(t="",r={},n){super(n);const{target:s=null,rel:a=null,title:i=null}=r;this.__url=t,this.__target=s,this.__rel=a,this.__title=i}createDOM(t){const r=document.createElement("a");return this.updateLinkDOM(null,r,t),Ks(r,t.theme.link),r}updateLinkDOM(t,r,n){if(Vj(r)){t&&t.__url===this.__url||(r.href=this.sanitizeUrl(this.__url));for(const s of["target","rel","title"]){const a=`__${s}`,i=this[a];t&&t[a]===i||(i?r[s]=i:r.removeAttribute(s))}}}updateDOM(t,r,n){return this.updateLinkDOM(t,r,n),!1}static importDOM(){return{a:t=>({conversion:$$,priority:1})}}static importJSON(t){return f1().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setURL(t.url).setRel(t.rel||null).setTarget(t.target||null).setTitle(t.title||null)}sanitizeUrl(t){t=eE(t);try{const r=new URL(eE(t));if(!U$.has(r.protocol))return"about:blank"}catch{return t}return t}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(t){const r=this.getWritable();return r.__url=t,r}getTarget(){return this.getLatest().__target}setTarget(t){const r=this.getWritable();return r.__target=t,r}getRel(){return this.getLatest().__rel}setRel(t){const r=this.getWritable();return r.__rel=t,r}getTitle(){return this.getLatest().__title}setTitle(t){const r=this.getWritable();return r.__title=t,r}insertNewAfter(t,r=!0){const n=f1(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(n,r),n}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(t,r,n){if(!At(r))return!1;const s=r.anchor.getNode(),a=r.focus.getNode();return this.isParentOf(s)&&this.isParentOf(a)&&r.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}}function $$(e){let t=null;if(Vj(e)){const r=e.textContent;(r!==null&&r!==""||e.children.length>0)&&(t=f1(e.getAttribute("href")||"",{rel:e.getAttribute("rel"),target:e.getAttribute("target"),title:e.getAttribute("title")}))}return{node:t}}function f1(e="",t){return xi(new nd(e,t))}function W$(e){return e instanceof nd}class R0 extends nd{constructor(t="",r={},n){super(t,r,n),this.__isUnlinked=r.isUnlinked!==void 0&&r.isUnlinked!==null&&r.isUnlinked}static getType(){return"autolink"}static clone(t){return new R0(t.__url,{isUnlinked:t.__isUnlinked,rel:t.__rel,target:t.__target,title:t.__title},t.__key)}getIsUnlinked(){return this.__isUnlinked}setIsUnlinked(t){const r=this.getWritable();return r.__isUnlinked=t,r}createDOM(t){return this.__isUnlinked?document.createElement("span"):super.createDOM(t)}updateDOM(t,r,n){return super.updateDOM(t,r,n)||t.__isUnlinked!==this.__isUnlinked}static importJSON(t){return ZN().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setIsUnlinked(t.isUnlinked||!1)}static importDOM(){return null}exportJSON(){return{...super.exportJSON(),isUnlinked:this.__isUnlinked}}insertNewAfter(t,r=!0){const n=this.getParentOrThrow().insertNewAfter(t,r);if(vt(n)){const s=ZN(this.__url,{isUnlinked:this.__isUnlinked,rel:this.__rel,target:this.__target,title:this.__title});return n.append(s),s}return null}}function ZN(e="",t){return xi(new R0(e,t))}function z$(e){return e instanceof R0}const H$=/^\+?[0-9\s()-]{5,}$/;function eE(e){return e.match(/^[a-z][a-z0-9+.-]*:/i)||e.match(/^[/#.]/)?e:e.includes("@")?`mailto:${e}`:H$.test(e)?`tel:${e}`:`https://${e}`}function l2(e,t){const r={};for(const n of e){const s=t(n);s&&(r[s]?r[s].push(n):r[s]=[n])}return r}function G$(e){const t=l2(e,(r=>r.type));return{element:t.element||[],multilineElement:t["multiline-element"]||[],textFormat:t["text-format"]||[],textMatch:t["text-match"]||[]}}const tE=/[!-/:-@[-`{-~\s]/;function V$(e){return Xt(e)&&!e.hasFormat("code")}function K$(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function rE(e,t,r){const n=r.length;for(let s=t;s>=n;s--){const a=s-n;if(DA(e,a,r,0,n)&&e[a+n]!==" ")return a}return-1}function DA(e,t,r,n,s){for(let a=0;a<s;a++)if(e[t+a]!==r[n+a])return!1;return!0}function q$(e,t=Z1){const r=G$(t),n=l2(r.textFormat,(({tag:i})=>i[i.length-1])),s=l2(r.textMatch,(({trigger:i})=>i));for(const i of t){const l=i.type;if(l==="element"||l==="text-match"||l==="multiline-element"){const c=i.dependencies;for(const d of c)e.hasNode(d)||K$(173,d.getType())}}const a=(i,l,c)=>{(function(d,f,p,g){const y=d.getParent();if(!mi(y)||d.getFirstChild()!==f)return!1;const v=f.getTextContent();if(v[p-1]!==" ")return!1;for(const{regExp:w,replace:b}of g){const E=v.match(w);if(E&&E[0].length===(E[0].endsWith(" ")?p:p-1)){const k=f.getNextSiblings(),[_,T]=f.splitText(p);if(b(d,T?[T,...k]:k,E,!1)!==!1)return _.remove(),!0}}return!1})(i,l,c,r.element)||(function(d,f,p,g){const y=d.getParent();if(!mi(y)||d.getFirstChild()!==f)return!1;const v=f.getTextContent();if(v[p-1]!==" ")return!1;for(const{regExpStart:w,replace:b,regExpEnd:E}of g){if(E&&!("optional"in E)||E&&"optional"in E&&!E.optional)continue;const k=v.match(w);if(k&&k[0].length===(k[0].endsWith(" ")?p:p-1)){const _=f.getNextSiblings(),[T,j]=f.splitText(p);if(b(d,j?[j,..._]:_,k,null,null,!1)!==!1)return T.remove(),!0}}return!1})(i,l,c,r.multilineElement)||(function(d,f,p){let g=d.getTextContent();const y=p[g[f-1]];if(y==null)return!1;f<g.length&&(g=g.slice(0,f));for(const v of y){if(!v.replace||!v.regExp)continue;const w=g.match(v.regExp);if(w===null)continue;const b=w.index||0,E=b+w[0].length;let k;return b===0?[k]=d.splitText(E):[,k]=d.splitText(b,E),k.selectNext(0,0),v.replace(k,w),!0}return!1})(l,c,s)||(function(d,f,p){const g=d.getTextContent(),y=f-1,v=g[y],w=p[v];if(!w)return!1;for(const b of w){const{tag:E}=b,k=E.length,_=y-k+1;if(k>1&&!DA(g,_,E,0,k)||g[_-1]===" ")continue;const T=g[y+1];if(b.intraword===!1&&T&&!tE.test(T))continue;const j=d;let P=j,R=rE(g,_,E),N=P;for(;R<0&&(N=N.getPreviousSibling())&&!Nc(N);)if(Xt(N)){if(N.hasFormat("code"))continue;const L=N.getTextContent();P=N,R=rE(L,L.length,E)}if(R<0||P===j&&R+k===_)continue;const A=P.getTextContent();if(R>0&&A[R-1]===v)continue;const M=A[R-1];if(b.intraword===!1&&M&&!tE.test(M))continue;const H=j.getTextContent(),Q=H.slice(0,_)+H.slice(y+1);j.setTextContent(Q);const Z=P===j?Q:A;P.setTextContent(Z.slice(0,R)+Z.slice(R+k));const ae=qt(),te=H1();Pa(te);const se=y-k*(P===j?2:1)+1;te.anchor.set(P.__key,R,"text"),te.focus.set(j.__key,se,"text");for(const L of b.format)te.hasFormat(L)||te.formatText(L);te.anchor.set(te.focus.key,te.focus.offset,te.focus.type);for(const L of b.format)te.hasFormat(L)&&te.toggleFormat(L);return At(ae)&&(te.format=ae.format),!0}})(l,c,n)};return e.registerUpdateListener((({tags:i,dirtyLeaves:l,editorState:c,prevEditorState:d})=>{if(i.has(Rj)||i.has(i1)||e.isComposing())return;const f=c.read(qt),p=d.read(qt);if(!At(p)||!At(f)||!f.isCollapsed()||f.is(p))return;const g=f.anchor.key,y=f.anchor.offset,v=c._nodeMap.get(g);!Xt(v)||!l.has(g)||y!==1&&y>p.anchor.offset+1||e.update((()=>{if(!V$(v))return;const w=v.getParent();w===null||nS(w)||a(w,v,f.anchor.offset)}))}))}const X$=/^(\s*)(\d{1,})\.\s/,Y$=/^(\s*)[-*+]\s/,J$=/^(#{1,6})\s/,Q$=/^>\s/,Z$=/^[ \t]*```([\w-]+)?/,eW=/[ \t]*```$/,IA=e=>(t,r,n,s)=>{const a=e(n);a.append(...r),t.replace(a),s||a.select(0,0)},MA=e=>(t,r,n,s)=>{const a=t.getPreviousSibling(),i=t.getNextSibling(),l=Xi(e==="check"?n[3]==="x":void 0);if(Lr(i)&&i.getListType()===e){const d=i.getFirstChild();d!==null?d.insertBefore(l):i.append(l),t.remove()}else if(Lr(a)&&a.getListType()===e)a.append(l),t.remove();else{const d=Pi(e,e==="number"?Number(n[2]):void 0);d.append(l),t.replace(d)}l.append(...r),s||l.select(0,0);const c=(function(d){const f=d.match(/\t/g),p=d.match(/ /g);let g=0;return f&&(g+=f.length),p&&(g+=Math.floor(p.length/4)),g})(n[1]);c&&l.setIndent(c)},sS=(e,t,r)=>{const n=[],s=e.getChildren();let a=0;for(const i of s)if(fn(i)){if(i.getChildrenSize()===1){const f=i.getFirstChild();if(Lr(f)){n.push(sS(f,t,r+1));continue}}const l=" ".repeat(4*r),c=e.getListType(),d=c==="number"?`${e.getStart()+a}. `:c==="check"?`- [${i.getChecked()?"x":" "}] `:"- ";n.push(l+d+t(i)),a++}return n.join(`
`)},tW={dependencies:[Gp],export:(e,t)=>{if(!JU(e))return null;const r=Number(e.getTag().slice(1));return"#".repeat(r)+" "+t(e)},regExp:J$,replace:IA((e=>{const t="h"+e[1].length;return Ru(t)})),type:"element"},rW={dependencies:[zp],export:(e,t)=>{if(!bN(e))return null;const r=t(e).split(`
`),n=[];for(const s of r)n.push("> "+s);return n.join(`
`)},regExp:Q$,replace:(e,t,r,n)=>{if(n){const a=e.getPreviousSibling();if(bN(a))return a.splice(a.getChildrenSize(),0,[Ul(),...t]),void e.remove()}const s=Hp();s.append(...t),e.replace(s),n||s.select(0,0)},type:"element"},nW={dependencies:[Tf],export:e=>{if(!nS(e))return null;const t=e.getTextContent();return"```"+(e.getLanguage()||"")+(t?`
`+t:"")+"\n```"},regExpEnd:{optional:!0,regExp:eW},regExpStart:Z$,replace:(e,t,r,n,s,a)=>{let i,l;if(!t&&s){if(s.length===1)n?(i=Cc(),l=r[1]+s[0]):(i=Cc(r[1]),l=s[0].startsWith(" ")?s[0].slice(1):s[0]);else{if(i=Cc(r[1]),s[0].trim().length===0)for(;s.length>0&&!s[0].length;)s.shift();else s[0]=s[0].startsWith(" ")?s[0].slice(1):s[0];for(;s.length>0&&!s[s.length-1].length;)s.pop();l=s.join(`
`)}const c=cs(l);i.append(c),e.append(i)}else t&&IA((c=>Cc(c?c[1]:void 0)))(e,t,r,a)},type:"multiline-element"},sW={dependencies:[rd,Lc],export:(e,t)=>Lr(e)?sS(e,t,0):null,regExp:Y$,replace:MA("bullet"),type:"element"},aW={dependencies:[rd,Lc],export:(e,t)=>Lr(e)?sS(e,t,0):null,regExp:X$,replace:MA("number"),type:"element"},iW={format:["code"],tag:"`",type:"text-format"},oW={format:["highlight"],tag:"==",type:"text-format"},lW={format:["bold","italic"],tag:"***",type:"text-format"},cW={format:["bold","italic"],intraword:!1,tag:"___",type:"text-format"},uW={format:["bold"],tag:"**",type:"text-format"},dW={format:["bold"],intraword:!1,tag:"__",type:"text-format"},fW={format:["strikethrough"],tag:"~~",type:"text-format"},hW={format:["italic"],tag:"*",type:"text-format"},gW={format:["italic"],intraword:!1,tag:"_",type:"text-format"},mW={dependencies:[nd],export:(e,t,r)=>{if(!W$(e)||z$(e))return null;const n=e.getTitle(),s=t(e);return n?`[${s}](${e.getURL()} "${n}")`:`[${s}](${e.getURL()})`},importRegExp:/(?:\[(.*?)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))/,regExp:/(?:\[(.*?)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))$/,replace:(e,t)=>{const[,r,n,s]=t,a=f1(n,{title:s}),i=r.split("[").length-1,l=r.split("]").length-1;let c=r,d="";if(i<l)return;if(i>l){const p=r.split("[");d="["+p[0],c=p.slice(1).join("[")}const f=cs(c);return f.setFormat(e.getFormat()),a.append(f),e.replace(a),d&&a.insertBefore(cs(d)),f},trigger:")",type:"text-match"},pW=[tW,rW,sW,aW],xW=[nW],yW=[iW,lW,cW,uW,dW,oW,hW,gW,fW],vW=[mW],Z1=[...pW,...xW,...yW,...vW];function nE(e,t){return e.getEditorState().read((()=>{const r=Ls(t);return r!==null&&r.isSelected()}))}function wW(e){const[t]=Wl(),[r,n]=C.useState((()=>nE(t,e)));return C.useEffect((()=>{let s=!0;const a=t.registerUpdateListener((()=>{s&&n(nE(t,e))}));return()=>{s=!1,a()}}),[t,e]),[r,C.useCallback((s=>{t.update((()=>{let a=qt();Ua(a)||(a=Tb(),Pa(a)),Ua(a)&&(s?a.add(e):a.delete(e))}))}),[t,e]),C.useCallback((()=>{t.update((()=>{const s=qt();Ua(s)&&s.clear()}))}),[t])]}function _W({nodeKey:e}){const[t]=Wl(),[r,n,s]=wW(e);return C.useEffect((()=>Cf(t.registerCommand(wb,(a=>{const i=t.getElementByKey(e);return a.target===i&&(a.shiftKey||s(),n(!r),!0)}),Oh))),[s,t,r,e,n]),C.useEffect((()=>{const a=t.getElementByKey(e),i=t._config.theme.hrSelected??"selected";a!==null&&(r?Ks(a,i):Uu(a,i))}),[t,r,e]),null}class Kp extends jb{static getType(){return"horizontalrule"}static clone(t){return new Kp(t.__key)}static importJSON(t){return aS().updateFromJSON(t)}static importDOM(){return{hr:()=>({conversion:bW,priority:0})}}exportDOM(){return{element:document.createElement("hr")}}createDOM(t){const r=document.createElement("hr");return Ks(r,t.theme.hr),r}getTextContent(){return`
`}isInline(){return!1}updateDOM(){return!1}decorate(){return o.jsx(_W,{nodeKey:this.__key})}}function bW(){return{node:aS()}}function aS(){return xi(new Kp)}function SW(e){return e instanceof Kp}const kW=[{dependencies:[Kp],export:e=>SW(e)?"***":null,regExp:/^(---|\*\*\*|___)\s?$/,replace:(e,t,r,n)=>{const s=aS();n||e.getNextSibling()!=null?e.replace(s):e.insertBefore(s),s.selectNext()},type:"element"},...Z1];function OA({transformers:e=kW}){const[t]=Wl();return C.useEffect((()=>q$(t,e)),[t,e]),null}function LA({hasStrictIndent:e=!1}){const[t]=Wl();return C.useEffect((()=>{if(!t.hasNodes([rd,Lc]))throw new Error("ListPlugin: ListNode and/or ListItemNode not registered on editor")}),[t]),C.useEffect((()=>{if(e)return j$(t)}),[t,e]),(function(r){C.useEffect((()=>E$(r)),[r])})(t),null}const CW=({onChange:e})=>{const[t]=C.useContext(k0)||[];return C.useEffect(()=>{if(e&&t)return t.registerUpdateListener(({editorState:r})=>{r.read(()=>{qn().getTextContent();const s=r.toJSON();e(JSON.stringify(s))})})},[t,e]),null},TW=()=>{const[e]=C.useContext(k0)||[],t=C.useCallback(()=>{e&&e.dispatchCommand(Va,"bold")},[e]),r=C.useCallback(()=>{e&&e.dispatchCommand(Va,"italic")},[e]),n=C.useCallback(()=>{e&&e.dispatchCommand(Va,"underline")},[e]),s=C.useCallback(()=>{e&&e.dispatchCommand(Va,"strikethrough")},[e]),a=C.useCallback(y=>{e&&e.update(()=>{const v=qt();At(v)&&t0(v,()=>Ru(y))})},[e]),i=C.useCallback(()=>{e&&e.update(()=>{const y=qt();At(y)&&t0(y,()=>Ln())})},[e]);C.useCallback(()=>{e&&e.update(()=>{const y=qt();At(y)&&t0(y,()=>Hp())})},[e]);const l=C.useCallback(()=>{e&&e.dispatchCommand(eS)},[e]),c=C.useCallback(()=>{e&&e.dispatchCommand(tS)},[e]),d=C.useCallback(()=>{e&&e.dispatchCommand(rS)},[e]),f=C.useCallback(y=>{e&&e.update(()=>{const v=qt();At(v)&&v.getNodes().forEach(w=>{Xt(w)&&w.setStyle(`color: ${y}`)})})},[e]),p=C.useCallback(y=>{e&&e.update(()=>{const v=qt();At(v)&&v.getNodes().forEach(b=>{if(Xt(b)){const E=b.getStyle(),k=E?E.replace(/font-size:\s*\d+px;?\s*/g,"").trim():"",_=k?`${k}; font-size: ${y}px;`:`font-size: ${y}px;`;b.setStyle(_)}})})},[e]),g=C.useCallback(y=>{e&&e.dispatchCommand(dj,y)},[e]);return o.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 border-b border-gray-300 bg-gray-50",children:[o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:t,className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Bold",children:"B"}),o.jsx("button",{type:"button",onClick:r,className:"px-2 py-1 text-sm italic border border-gray-300 rounded hover:bg-gray-200",title:"Italic",children:"I"}),o.jsx("button",{type:"button",onClick:n,className:"px-2 py-1 text-sm underline border border-gray-300 rounded hover:bg-gray-200",title:"Underline",children:"U"}),o.jsx("button",{type:"button",onClick:s,className:"px-2 py-1 text-sm line-through border border-gray-300 rounded hover:bg-gray-200",title:"Strikethrough",children:"S"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:()=>a("h1"),className:"px-2 py-1 text-xs font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 1",children:"H1"}),o.jsx("button",{type:"button",onClick:()=>a("h2"),className:"px-2 py-1 text-xs font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 2",children:"H2"}),o.jsx("button",{type:"button",onClick:()=>a("h3"),className:"px-2 py-1 text-xs font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 3",children:"H3"}),o.jsx("button",{type:"button",onClick:i,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Paragraph",children:"P"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:l,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Bullet List",children:"• List"}),o.jsx("button",{type:"button",onClick:c,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Numbered List",children:"1. List"}),o.jsx("button",{type:"button",onClick:d,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Remove List",children:"No List"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Color:"}),o.jsx("button",{type:"button",onClick:()=>f("#000000"),className:"w-6 h-6 bg-black border border-gray-300 rounded hover:bg-gray-800",title:"Black"}),o.jsx("button",{type:"button",onClick:()=>f("#ff0000"),className:"w-6 h-6 bg-red-500 border border-gray-300 rounded hover:bg-red-600",title:"Red"}),o.jsx("button",{type:"button",onClick:()=>f("#0000ff"),className:"w-6 h-6 bg-blue-500 border border-gray-300 rounded hover:bg-blue-600",title:"Blue"}),o.jsx("button",{type:"button",onClick:()=>f("#008000"),className:"w-6 h-6 bg-green-500 border border-gray-300 rounded hover:bg-green-600",title:"Green"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Size:"}),o.jsx("button",{type:"button",onClick:()=>p(12),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Small",children:"12px"}),o.jsx("button",{type:"button",onClick:()=>p(16),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Normal",children:"16px"}),o.jsx("button",{type:"button",onClick:()=>p(20),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Large",children:"20px"}),o.jsx("button",{type:"button",onClick:()=>p(24),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Extra Large",children:"24px"})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Align:"}),o.jsx("button",{type:"button",onClick:()=>g("left"),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Align Left",children:"←"}),o.jsx("button",{type:"button",onClick:()=>g("center"),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Align Center",children:"↔"}),o.jsx("button",{type:"button",onClick:()=>g("right"),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Align Right",children:"→"})]})]})},NW=({value:e,onChange:t,placeholder:r})=>{const n={namespace:"LexicalEditor",theme:{root:"p-4 min-h-32 focus:outline-none",paragraph:"mb-2",heading:{h1:"text-3xl font-bold mb-4",h2:"text-2xl font-bold mb-3",h3:"text-xl font-bold mb-2"},quote:"border-l-4 border-gray-300 pl-4 italic text-gray-600 mb-2",list:{nested:{listitem:"list-none"},ol:"list-decimal list-inside mb-2",ul:"list-disc list-inside mb-2",listitem:"mb-1"},text:{bold:"font-bold",italic:"italic",underline:"underline",strikethrough:"line-through"}},nodes:[Gp,rd,Lc,zp,Tf,Q1,Vp,F0,P0,R0,nd],onError:s=>{console.error("Lexical error:",s)},editorState:e?(()=>{try{const s=JSON.parse(e);return JSON.stringify(s)}catch{return JSON.stringify({root:{children:[{children:[{detail:0,format:0,mode:"normal",style:"",text:e,type:"text",version:1}],direction:"ltr",format:"",indent:0,type:"paragraph",version:1}],direction:"ltr",format:"",indent:0,type:"root",version:1}})}})():void 0};return o.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:o.jsxs(Qj,{initialConfig:n,children:[o.jsx(TW,{}),o.jsx(CW,{onChange:t}),o.jsxs("div",{className:"relative",children:[o.jsx(pA,{contentEditable:o.jsx(yA,{className:"p-4 min-h-32 focus:outline-none",placeholder:r}),placeholder:o.jsx("div",{className:"absolute top-4 left-4 text-gray-400 pointer-events-none",children:r}),ErrorBoundary:_A}),o.jsx(vA,{}),o.jsx(wA,{}),o.jsx(LA,{}),o.jsx(OA,{transformers:Z1})]})]})})},EW=({testName:e="",onTestSaved:t,onCancel:r,onBackToCabinet:n,isSaving:s=!1,validationErrors:a={}})=>{const{user:i}=Wn(),{post:l}=Ji(),{showNotification:c}=da(),[d,f]=C.useState({test_name:e,num_questions:1,passing_score:100,questions:[{id:1,question_json:"",canvas_width:600,canvas_height:800,max_canvas_width:1536,max_canvas_height:2048}]}),[p,g]=C.useState({isLoading:!1,error:null,showPreview:!0});C.useEffect(()=>{f(_=>({..._,test_name:e||""}))},[e]);const y=()=>{if(d.num_questions>=3){g(j=>({...j,error:"Maximum 3 questions allowed for performance reasons"}));return}const T={id:Math.max(...d.questions.map(j=>j.id))+1,question_json:"",canvas_width:600,canvas_height:800,max_canvas_width:1536,max_canvas_height:2048};f(j=>({...j,num_questions:j.num_questions+1,questions:[...j.questions,T]}))},v=_=>{d.questions.length<=1||f(T=>({...T,num_questions:T.num_questions-1,questions:T.questions.filter(j=>j.id!==_)}))},w=(_,T)=>{f(j=>({...j,questions:j.questions.map(P=>P.id===_?{...P,question_json:T}:P)}))},b=(_,T,j)=>{f(P=>({...P,questions:P.questions.map(R=>R.id===_?{...R,canvas_width:T,canvas_height:j}:R)}))},E=(_,T,j)=>{f(P=>({...P,questions:P.questions.map(R=>R.id===_?{...R,max_canvas_width:T,max_canvas_height:j}:R)}))},k=async()=>{if(!d.test_name.trim()){g(_=>({..._,error:"Test name is required"}));return}if(d.questions.some(_=>!_.question_json.trim())){g(_=>({..._,error:"All questions must have content"}));return}g(_=>({..._,isLoading:!0,error:null}));try{const _={test_name:d.test_name,num_questions:d.num_questions,passing_score:d.passing_score,questions:d.questions.map((T,j)=>({question_id:j+1,question_json:T.question_json,canvas_width:T.canvas_width,canvas_height:T.canvas_height,max_canvas_width:T.max_canvas_width,max_canvas_height:T.max_canvas_height}))};t&&t(_)}catch(_){console.error("Error preparing drawing test:",_),g(T=>({...T,error:"Failed to prepare drawing test. Please try again."})),c("Failed to prepare drawing test","error")}finally{g(_=>({..._,isLoading:!1}))}};return o.jsx("div",{className:"drawing-test-creator max-w-4xl mx-auto p-6",children:o.jsxs(kt,{className:"p-6",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Create Drawing Test"}),o.jsx("p",{className:"text-gray-600",children:"Create a test where students draw based on your instructions"})]}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Drawing Questions (",d.num_questions,"/3)"]}),o.jsx("p",{className:"text-sm text-gray-500",children:"Maximum 3 questions for optimal performance"})]}),o.jsxs(rt,{onClick:y,disabled:d.num_questions>=3,variant:"primary",size:"sm",className:"flex items-center gap-2",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),"Add Question"]})]}),o.jsx("div",{className:"space-y-4",children:d.questions.map((_,T)=>o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("h4",{className:"text-md font-medium text-gray-800",children:["Text ",T+1]}),d.questions.length>1&&o.jsx(rt,{onClick:()=>v(_.id),variant:"secondary",size:"sm",className:"text-red-600 hover:text-red-700",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Text Content *"}),o.jsx(NW,{value:_.question_json,onChange:j=>w(_.id,j),placeholder:""})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Canvas Dimensions"}),o.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Canvas is the actual drawing area, viewport is the initial display size"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Viewport Width"}),o.jsx("input",{type:"number",value:_.canvas_width,onChange:j=>b(_.id,parseInt(j.target.value),_.canvas_height),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"200",max:"2048"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Viewport Height"}),o.jsx("input",{type:"number",value:_.canvas_height,onChange:j=>b(_.id,_.canvas_width,parseInt(j.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"200",max:"2048"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Canvas Width"}),o.jsx("input",{type:"number",value:_.max_canvas_width,onChange:j=>E(_.id,parseInt(j.target.value),_.max_canvas_height),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"200",max:"4096"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Canvas Height"}),o.jsx("input",{type:"number",value:_.max_canvas_height,onChange:j=>E(_.id,_.max_canvas_width,parseInt(j.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"200",max:"4096"})]})]})]})]},_.id))})]}),p.error&&o.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg text-red-700",children:p.error}),o.jsxs("div",{className:"flex justify-end gap-3",children:[o.jsx(rt,{onClick:r,variant:"secondary",disabled:p.isLoading,children:"Cancel"}),o.jsx(rt,{onClick:k,variant:"primary",disabled:p.isLoading||!d.test_name.trim(),className:"flex items-center gap-2",children:p.isLoading?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",color:"white"}),"Saving..."]}):"Save Test"})]})]})})},jW=({onChange:e})=>{const[t]=C.useContext(k0)||[];return C.useEffect(()=>{if(e&&t)return t.registerUpdateListener(({editorState:r})=>{r.read(()=>{qn().getTextContent();const s=r.toJSON();e(JSON.stringify(s))})})},[t,e]),null},AW=({onAddBlank:e,blankCount:t})=>{const[r]=C.useContext(k0)||[],n=C.useCallback(()=>{r&&r.dispatchCommand(Va,"bold")},[r]),s=C.useCallback(()=>{r&&r.dispatchCommand(Va,"italic")},[r]),a=C.useCallback(()=>{r&&r.dispatchCommand(Va,"underline")},[r]),i=C.useCallback(()=>{r&&r.dispatchCommand(Va,"strikethrough")},[r]),l=C.useCallback(v=>{r&&r.update(()=>{const w=qt();At(w)&&t0(w,()=>Ru(v))})},[r]),c=C.useCallback(()=>{r&&r.update(()=>{const v=qt();At(v)&&t0(v,()=>Ln())})},[r]),d=C.useCallback(()=>{r&&r.update(()=>{const v=qt();At(v)&&t0(v,()=>Hp())})},[r]),f=C.useCallback(()=>{r&&r.dispatchCommand(eS)},[r]),p=C.useCallback(()=>{r&&r.dispatchCommand(tS)},[r]),g=C.useCallback(()=>{r&&r.dispatchCommand(rS)},[r]),y=C.useCallback(()=>{!r||!e||(r.update(()=>{const v=qt();if(At(v)){const b=`${t+1}_________`,E=cs(b);E.setStyle("background-color: #f0f9ff; border: 1px dashed #3b82f6; padding: 2px 4px; border-radius: 4px; font-family: monospace;"),v.insertNodes([E])}}),e())},[r,e,t]);return o.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 border-b border-gray-300 bg-gray-50",children:[o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:n,className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Bold",children:"B"}),o.jsx("button",{type:"button",onClick:s,className:"px-2 py-1 text-sm italic border border-gray-300 rounded hover:bg-gray-200",title:"Italic",children:"I"}),o.jsx("button",{type:"button",onClick:a,className:"px-2 py-1 text-sm underline border border-gray-300 rounded hover:bg-gray-200",title:"Underline",children:"U"}),o.jsx("button",{type:"button",onClick:i,className:"px-2 py-1 text-sm line-through border border-gray-300 rounded hover:bg-gray-200",title:"Strikethrough",children:"S"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:()=>l("h1"),className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 1",children:"H1"}),o.jsx("button",{type:"button",onClick:()=>l("h2"),className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 2",children:"H2"}),o.jsx("button",{type:"button",onClick:()=>l("h3"),className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 3",children:"H3"}),o.jsx("button",{type:"button",onClick:c,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Paragraph",children:"P"}),o.jsx("button",{type:"button",onClick:d,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Quote",children:'"'})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:f,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Bullet List",children:"•"}),o.jsx("button",{type:"button",onClick:p,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Numbered List",children:"1."}),o.jsx("button",{type:"button",onClick:g,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Remove List",children:"↶"})]}),e&&o.jsx("div",{className:"flex items-center gap-1 border-l border-gray-300 pl-2",children:o.jsxs("button",{type:"button",onClick:y,className:"px-3 py-1 text-sm font-medium bg-blue-500 text-white border border-blue-600 rounded hover:bg-blue-600 transition-colors",title:"Add Blank",children:[o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",className:"inline mr-1",children:o.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),"Add Blank"]})})]})},FW=({value:e,onChange:t,placeholder:r,onAddBlank:n,blankCount:s=0})=>{const a={namespace:"FillBlanksLexicalEditor",theme:{root:"p-4 min-h-32 focus:outline-none",paragraph:"mb-2",heading:{h1:"text-3xl font-bold mb-4",h2:"text-2xl font-bold mb-3",h3:"text-xl font-bold mb-2"},quote:"border-l-4 border-gray-300 pl-4 italic text-gray-600 mb-2",list:{nested:{listitem:"list-none"},ol:"list-decimal list-inside mb-2",ul:"list-disc list-inside mb-2",listitem:"mb-1"},text:{bold:"font-bold",italic:"italic",underline:"underline",strikethrough:"line-through"}},nodes:[Gp,rd,Lc,zp,Tf,Q1,Vp,F0,P0,R0,nd],onError:i=>{console.error("Lexical error:",i)},editorState:e?(()=>{try{const i=JSON.parse(e);return JSON.stringify(i)}catch{return JSON.stringify({root:{children:[{children:[{detail:0,format:0,mode:"normal",style:"",text:e,type:"text",version:1}],direction:"ltr",format:"",indent:0,type:"paragraph",version:1}],direction:"ltr",format:"",indent:0,type:"root",version:1}})}})():void 0};return o.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:o.jsxs(Qj,{initialConfig:a,children:[o.jsx(AW,{onAddBlank:n,blankCount:s}),o.jsx(jW,{onChange:t}),o.jsxs("div",{className:"relative",children:[o.jsx(pA,{contentEditable:o.jsx(yA,{className:"p-4 min-h-32 focus:outline-none"}),placeholder:o.jsx("div",{className:"absolute top-4 left-4 text-gray-400 pointer-events-none",children:r}),ErrorBoundary:_A}),o.jsx(vA,{}),o.jsx(wA,{}),o.jsx(LA,{}),o.jsx(OA,{transformers:Z1})]})]})})},PW=({testName:e="",allowedTime:t=null,onTestSaved:r,onCancel:n,onBackToCabinet:s,isSaving:a=!1,validationErrors:i={}})=>{const{user:l}=Wn(),{post:c}=Ji(),{showNotification:d}=da(),[f,p]=C.useState({test_name:e,test_text:"",num_questions:1,num_blanks:0,passing_score:100,separate_type:!0,allowed_time:t,blanks:[]}),[g,y]=C.useState({isLoading:!1,error:null,showPreview:!0});C.useEffect(()=>{p(R=>({...R,test_name:e||"",allowed_time:t}))},[e,t]);const v=R=>{p(N=>({...N,test_text:R}))},w=()=>{const N={id:f.blanks.length+1,position:0,question:"",options:["","","",""],correct_answer:""};p(A=>({...A,blanks:[...A.blanks,N],num_blanks:A.num_blanks+1}))},b=R=>{p(N=>({...N,blanks:N.blanks.filter(A=>A.id!==R),num_blanks:N.num_blanks-1}))},E=R=>{p(N=>({...N,blanks:N.blanks.map(A=>A.id===R?{...A,options:[...A.options,""]}:A)}))},k=(R,N)=>{p(A=>({...A,blanks:A.blanks.map(M=>M.id===R?{...M,options:M.options.filter((H,Q)=>Q!==N),correct_answer:M.correct_answer===String.fromCharCode(65+N)?"":M.correct_answer}:M)}))},_=(R,N,A)=>{p(M=>({...M,blanks:M.blanks.map(H=>H.id===R?{...H,options:H.options.map((Q,Z)=>Z===N?A:Q)}:H)}))},T=(R,N)=>{console.log("🔍 [DEBUG] updateBlankQuestion called:",{blankId:R,question:N}),p(A=>({...A,blanks:A.blanks.map(M=>M.id===R?{...M,question:N}:M)})),console.log("🔍 [DEBUG] updateBlankQuestion completed")},j=(R,N)=>{p(A=>({...A,blanks:A.blanks.map(M=>M.id===R?{...M,correct_answer:N}:M)}))},P=async()=>{if(!f.test_name.trim()){y(R=>({...R,error:"Test name is required"}));return}if(!f.test_text.trim()){y(R=>({...R,error:"Test text is required"}));return}if(f.blanks.length===0){y(R=>({...R,error:"At least one blank is required"}));return}if(console.log("🔍 [DEBUG] Validating blanks:",f.blanks),f.blanks.forEach((R,N)=>{console.log(`🔍 [DEBUG] Blank ${N+1}:`,{question:R.question,questionTrimmed:R.question?.trim(),correct_answer:R.correct_answer,options:R.options})}),f.separate_type===!1){if(f.blanks.some(R=>!R.correct_answer)){console.log("❌ [DEBUG] Validation failed - some blanks missing correct answer"),y(R=>({...R,error:"All blanks must have correct answers"}));return}}else if(f.blanks.some(R=>!R.question.trim()||!R.correct_answer)){console.log("❌ [DEBUG] Validation failed - some blanks missing question or correct answer"),y(R=>({...R,error:"All blanks must have question text and correct answer"}));return}console.log("✅ [DEBUG] Validation passed - all blanks have question and correct answer"),y(R=>({...R,isLoading:!0,error:null}));try{const R={test_name:f.test_name,test_text:f.test_text,num_questions:f.blanks.length,num_blanks:f.blanks.length,separate_type:f.separate_type,passing_score:f.passing_score,allowed_time:f.allowed_time,blanks:f.blanks.map((N,A)=>({question_id:A+1,question_json:N.question,question:N.question,options:N.options,correct_answer:N.correct_answer,blank_positions:{},blank_options:N.options||[],correct_answers:[N.correct_answer]}))};console.log("🎯 [DEBUG] Calling onTestSaved with data:",R),r?(console.log("🎯 [DEBUG] onTestSaved function exists, calling it..."),r(R),console.log("🎯 [DEBUG] onTestSaved called successfully")):console.log("❌ [DEBUG] onTestSaved function is null/undefined")}catch(R){console.error("Error preparing fill blanks test:",R),y(N=>({...N,error:"Failed to prepare fill blanks test. Please try again."})),d("Failed to prepare fill blanks test","error")}finally{y(R=>({...R,isLoading:!1}))}};return o.jsx("div",{className:"fill-blanks-test-creator max-w-4xl mx-auto p-6",children:o.jsxs(kt,{className:"p-6",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Create Fill Blanks Test"}),o.jsx("p",{className:"text-gray-600",children:"Create a test with rich text content and multiple choice blanks"}),o.jsx("div",{className:"mt-2 text-sm text-gray-600",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("span",{children:[o.jsx("strong",{children:"Test Name:"})," ",e||"Untitled Test"]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Blanks:"})," ",f.num_blanks," (auto-calculated)"]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Timer:"})," ",f.allowed_time?`${f.allowed_time} minutes`:"No timer"]})]})}),g.error&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-600 text-sm",children:g.error})})]}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Text Content with Blanks"}),o.jsx("p",{className:"text-sm text-gray-500",children:"Type your text and add blanks where needed"})]}),o.jsx("div",{className:"flex items-center space-x-4",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Mode:"}),o.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[o.jsx("button",{onClick:()=>p(R=>({...R,separate_type:!0})),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors ${f.separate_type===!0?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Separate"}),o.jsx("button",{onClick:()=>p(R=>({...R,separate_type:!1})),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors ${f.separate_type===!1?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Inline"})]})]})})]}),o.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:f.separate_type===!0?"Separate Mode:":"Inline Mode:"})," ",f.separate_type===!0?"Students see numbered blanks in text and answer questions below":"Students see clickable blanks in text with dropdown options"]})}),o.jsx(FW,{value:f.test_text,onChange:v,placeholder:"Type your text here. Use the 'Add Blank' button in the toolbar to insert blanks.",onAddBlank:w,blankCount:f.blanks.length})]}),f.separate_type===!0&&o.jsx("div",{className:"space-y-4",children:f.blanks.map((R,N)=>o.jsxs(kt,{className:"p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-md font-medium",children:["Blank ",R.id," Configuration"]}),o.jsx(rt,{variant:"danger",size:"small",onClick:()=>b(R.id),className:"px-2 py-1 text-sm",children:"Remove Blank"})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Question Text for Blank ",R.id," *"]}),o.jsx("input",{type:"text",placeholder:"Enter question text for this blank",value:R.question,onChange:A=>T(R.id,A.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Answer Options:"}),R.options.map((A,M)=>o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:String.fromCharCode(65+M)}),o.jsx("input",{type:"text",placeholder:`Option ${String.fromCharCode(65+M)}`,value:A||"",onChange:H=>_(R.id,M,H.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"}),R.options.length>2&&o.jsx(rt,{variant:"danger",size:"small",onClick:()=>k(R.id,M),className:"px-2 py-1 text-sm",children:"×"})]},M)),R.options.length<6&&o.jsx(rt,{variant:"secondary",size:"small",onClick:()=>E(R.id),className:"w-full",children:"+ Add Option"})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correct Answer *"}),o.jsxs("select",{value:R.correct_answer||"",onChange:A=>j(R.id,A.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[o.jsx("option",{value:"",children:"Select correct answer"}),R.options.filter(A=>A.trim().length>0).map((A,M)=>o.jsxs("option",{value:String.fromCharCode(65+M),children:[String.fromCharCode(65+M),") ",A]},M))]})]})]},R.id))}),f.separate_type===!1&&o.jsx("div",{className:"space-y-4",children:f.blanks.map((R,N)=>o.jsxs(kt,{className:"p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-md font-medium",children:["Blank ",R.id," Options"]}),o.jsx(rt,{variant:"danger",size:"small",onClick:()=>b(R.id),className:"px-2 py-1 text-sm",children:"Remove Blank"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Answer Options:"}),R.options.map((A,M)=>o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:String.fromCharCode(65+M)}),o.jsx("input",{type:"text",placeholder:`Option ${String.fromCharCode(65+M)}`,value:A||"",onChange:H=>_(R.id,M,H.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"}),R.options.length>2&&o.jsx(rt,{variant:"danger",size:"small",onClick:()=>k(R.id,M),className:"px-2 py-1 text-sm",children:"×"})]},M)),R.options.length<6&&o.jsx(rt,{variant:"secondary",size:"small",onClick:()=>E(R.id),className:"w-full",children:"+ Add Option"})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correct Answer *"}),o.jsxs("select",{value:R.correct_answer||"",onChange:A=>j(R.id,A.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[o.jsx("option",{value:"",children:"Select correct answer"}),R.options.filter(A=>A.trim().length>0).map((A,M)=>o.jsxs("option",{value:String.fromCharCode(65+M),children:[String.fromCharCode(65+M),") ",A]},M))]})]})]},R.id))}),o.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[o.jsx(rt,{onClick:n,variant:"secondary",disabled:a,children:"Cancel"}),o.jsx(rt,{onClick:P,variant:"primary",disabled:a||f.blanks.length===0,children:a?o.jsx(Br,{size:"sm"}):"Save Test"})]})]})})},RW=[{value:"A1",label:"A1 (Beginner)",description:"Basic vocabulary, simple sentences"},{value:"A2",label:"A2 (Elementary)",description:"Everyday vocabulary, present/past tenses"},{value:"B1",label:"B1 (Intermediate)",description:"Varied vocabulary, complex sentences"},{value:"B2",label:"B2 (Upper-Intermediate)",description:"Advanced vocabulary, sophisticated structures"},{value:"C1",label:"C1 (Advanced)",description:"Nuanced vocabulary, complex discourse"},{value:"C2",label:"C2 (Proficiency)",description:"Native-like fluency and accuracy"}],DW=({testName:e="",onTestSaved:t,onCancel:r,onBackToCabinet:n,isSaving:s=!1,validationErrors:a={}})=>{const{showNotification:i}=da(),[l,c]=C.useState({min_words:50,questions:[{question_id:1,prompt:"",expected_duration:null,difficulty_level:"B1"}]}),[d,f]=C.useState(!1),p=C.useCallback((E,k)=>{c(_=>({..._,[E]:k}))},[]),g=C.useCallback((E,k,_)=>{c(T=>({...T,questions:T.questions.map((j,P)=>P===E?{...j,[k]:_}:j)}))},[]),y=C.useCallback(()=>{c(E=>({...E,questions:[...E.questions,{question_id:E.questions.length+1,prompt:"",expected_duration:null,difficulty_level:"B1"}]}))},[]),v=C.useCallback(E=>{l.questions.length>1&&c(k=>({...k,questions:k.questions.filter((_,T)=>T!==E)}))},[l.questions.length]),w=C.useCallback(()=>{const E={};return l.min_words<10&&(E.min_words="Minimum word count must be at least 10 words"),l.questions.forEach((k,_)=>{k.prompt.trim()||(E[`question_${_}_prompt`]="Question prompt is required")}),E},[l]),b=C.useCallback(async E=>{E.preventDefault();const k=w();if(Object.keys(k).length>0){i("Please fix the validation errors","error");return}f(!0);try{const _={test_name:e,time_limit:300,min_duration:30,max_duration:600,max_attempts:3,min_words:l.min_words,passing_score:50,allowed_time:null,questions:l.questions.map((T,j)=>({question_id:j+1,prompt:T.prompt,expected_duration:T.expected_duration,difficulty_level:T.difficulty_level}))};console.log("🎯 [DEBUG] Calling onTestSaved with data:",_),t?(console.log("🎯 [DEBUG] onTestSaved function exists, calling it..."),t(_),console.log("🎯 [DEBUG] onTestSaved called successfully")):console.log("❌ [DEBUG] onTestSaved function is null/undefined")}catch(_){console.error("Error preparing speaking test:",_),i("Failed to prepare speaking test","error")}finally{f(!1)}},[l,w,i,t,e]);return d||s?o.jsxs("div",{className:"flex items-center justify-center p-8",children:[o.jsx(Br,{}),o.jsx("span",{className:"ml-2",children:"Creating speaking test..."})]}):o.jsxs("div",{className:"speaking-test-creator max-w-4xl mx-auto",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Create Speaking Test"}),o.jsx("p",{className:"text-gray-600",children:"Create a speaking test where students record audio responses with AI-powered feedback"})]}),o.jsxs("form",{onSubmit:b,className:"space-y-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Scoring Settings"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Word Count *"}),o.jsx("input",{type:"number",min:"10",max:"1000",value:l.min_words,onChange:E=>p("min_words",parseInt(E.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),a.min_words&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.min_words})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Questions"}),o.jsx(rt,{type:"button",variant:"outline",onClick:y,children:"Add Question"})]}),l.questions.length>1&&o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:o.jsxs("div",{className:"flex items-start",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),o.jsxs("div",{className:"ml-3",children:[o.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Multiple Questions Detected"}),o.jsx("div",{className:"mt-1 text-sm text-blue-700",children:o.jsxs("p",{children:["You have ",l.questions.length," questions in this test.",o.jsx("strong",{children:" Only one question will be randomly selected"})," and shown to each student. This ensures fair distribution across your question pool."]})})]})]})}),l.questions.map((E,k)=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("h4",{className:"font-medium",children:["Question ",k+1]}),l.questions.length>1&&o.jsx(rt,{type:"button",variant:"outline",size:"sm",onClick:()=>v(k),className:"text-red-600 hover:text-red-700",children:"Remove"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question Prompt *"}),o.jsx("textarea",{value:E.prompt,onChange:_=>g(k,"prompt",_.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Enter the question prompt for students"}),a[`question_${k}_prompt`]&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:a[`question_${k}_prompt`]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Duration (seconds)"}),o.jsx("input",{type:"number",min:"10",max:"600",value:E.expected_duration||"",onChange:_=>g(k,"expected_duration",_.target.value?parseInt(_.target.value):null),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEFR Level"}),o.jsx("select",{value:E.difficulty_level,onChange:_=>g(k,"difficulty_level",_.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:RW.map(_=>o.jsxs("option",{value:_.value,children:[_.label," - ",_.description]},_.value))}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select the appropriate CEFR level for this question. This will be used by AI to evaluate students appropriately."})]})]})]})]},k))]}),o.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[o.jsx(rt,{type:"button",variant:"secondary",onClick:r,children:"Cancel"}),o.jsx(rt,{type:"submit",variant:"primary",disabled:d||s,children:d||s?"Creating...":"Create Speaking Test"})]})]})]})},BA=(e,t)=>{const[r,n]=C.useState(()=>{try{const i=window.localStorage.getItem(e);return i?JSON.parse(i):t}catch(i){return console.error(`Error reading localStorage key "${e}":`,i),t}}),s=C.useCallback(i=>{try{const l=i instanceof Function?i(r):i;n(l),window.localStorage.setItem(e,JSON.stringify(l))}catch(l){console.error(`Error setting localStorage key "${e}":`,l)}},[e,r]),a=C.useCallback(()=>{try{window.localStorage.removeItem(e),n(t)}catch(i){console.error(`Error removing localStorage key "${e}":`,i)}},[e,t]);return[r,s,a]},ev=()=>{const e=C.useCallback((c,d=null)=>{try{const f=window.localStorage.getItem(c);return f?JSON.parse(f):d}catch(f){return console.error(`Error reading localStorage key "${c}":`,f),d}},[]),t=C.useCallback((c,d)=>{try{window.localStorage.setItem(c,JSON.stringify(d))}catch(f){console.error(`Error setting localStorage key "${c}":`,f)}},[]),r=C.useCallback(c=>{try{window.localStorage.removeItem(c)}catch(d){console.error(`Error removing localStorage key "${c}":`,d)}},[]),n=C.useCallback(()=>{if(confirm("Are you sure you want to clear all local storage? This cannot be undone."))try{window.localStorage.clear(),window.showNotification?window.showNotification("All local storage cleared!","success"):console.log("All local storage cleared!")}catch(c){console.error("Error clearing localStorage:",c)}},[]),s=C.useCallback(()=>{try{const c={};for(let g=0;g<window.localStorage.length;g++){const y=window.localStorage.key(g);y&&(c[y]=window.localStorage.getItem(y))}const d=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),f=URL.createObjectURL(d),p=document.createElement("a");p.href=f,p.download="localStorage_backup.json",p.click(),URL.revokeObjectURL(f),window.showNotification?window.showNotification("Local storage exported!","success"):console.log("Local storage exported!")}catch(c){console.error("Error exporting localStorage data:",c)}},[]),a=C.useCallback(()=>{try{window.localStorage.clear()}catch(c){console.error("Error clearing localStorage:",c)}},[]),i=C.useCallback(()=>{try{const c={};for(let d=0;d<window.localStorage.length;d++){const f=window.localStorage.key(d);f&&(c[f]=window.localStorage.getItem(f))}return c}catch(c){return console.error("Error exporting localStorage data:",c),{}}},[]),l=C.useCallback(c=>{try{Object.entries(c).forEach(([d,f])=>{window.localStorage.setItem(d,f)})}catch(d){console.error("Error importing localStorage data:",d)}},[]);return{getItem:e,setItem:t,removeItem:r,clearAll:a,clearAllLocalStorage:n,exportLocalStorage:s,exportData:i,importData:l}},IW=({question:e,testId:t,testType:r="true_false",mode:n="student",displayNumber:s,studentAnswer:a,onAnswerChange:i,onQuestionChange:l,onSave:c,isEditing:d=!1,isSaving:f=!1,validationErrors:p={},showCorrectAnswers:g=!1,studentId:y=null})=>{const{getItem:v,setItem:w}=ev();da(),C.useRef(null);const[b,E]=C.useState(""),[k,_]=C.useState(""),[T,j]=C.useState(""),[P,R]=C.useState(!1),[N,A]=C.useState(!0),[M,H]=C.useState(""),[Q,Z]=C.useState(!1),[ae,te]=C.useState(null);C.useEffect(()=>{if(e&&(j(e.question||""),_(e.correct_answer||""),n==="student"&&y)){const ee=v(`test_progress_${y}_${r}_${t}_${e.question_id}`);ee&&E(ee)}},[e,t,r,n,v]),C.useEffect(()=>{n==="student"&&a!==void 0&&a!==null&&(console.log("🔄 TrueFalseQuestion syncing with parent studentAnswer:",a),E(a))},[a,n]),C.useEffect(()=>{if(n==="student"&&b&&t&&e?.question_id&&y){const ee=setTimeout(()=>{Z(!0),w(`test_progress_${y}_${r}_${t}_${e.question_id}`,b),te(new Date().toLocaleTimeString()),setTimeout(()=>Z(!1),1e3)},1e3);return()=>clearTimeout(ee)}},[b,t,r,e?.question_id,n,y,w]),C.useEffect(()=>{if(n==="teacher"&&(T||k)){const ee=setTimeout(()=>{Z(!0);const X={question:T,correct_answer:k,timestamp:Date.now()};w(`teacher_form_${r}_${t}`,X),te(new Date().toLocaleTimeString()),setTimeout(()=>Z(!1),1e3)},2e3);return()=>clearTimeout(ee)}},[T,k,t,r,n,w]);const se=C.useCallback(ee=>{n==="student"&&(E(ee),i&&i(e.question_id,ee),I(ee))},[n,e?.question_id,i]),L=C.useCallback(ee=>{j(ee),l&&l(e.question_id,ee),z(ee)},[e?.question_id,l]),G=C.useCallback(ee=>{_(ee),l&&l(e.question_id,{...e,correct_answer:ee}),V(ee)},[e,l]),I=C.useCallback(ee=>{if(n==="student"){if(!ee){A(!1),H("Please select an answer");return}A(!0),H("")}},[n]),z=C.useCallback(ee=>{if(n==="teacher"){if(!ee||ee.trim().length<10){A(!1),H("Question must be at least 10 characters long");return}A(!0),H("")}},[n]),V=C.useCallback(ee=>{if(n==="teacher"){if(!ee){A(!1),H("Please select a correct answer");return}A(!0),H("")}},[n]),O=C.useCallback(()=>{if(n!=="teacher"||!c)return;const ee={question_id:e.question_id,question:T,correct_answer:k,type:"true_false"};c(ee)},[n,c,e?.question_id,T,k]),W=C.useCallback(ee=>ee?ee.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"):"",[]),q=()=>o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",typeof s=="number"?s:e?.question_id]}),o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[Q&&o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Br,{size:"small"}),o.jsx("span",{children:"Saving..."})]}),ae&&!Q&&o.jsxs("div",{className:"text-green-600",children:["✓ Saved at ",ae]})]})]}),o.jsx("div",{className:"question-text mb-6 text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:W(T)}}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${b==="true"?"border-blue-500 bg-blue-50":"border-gray-200"} ${g&&k==="true"?"ring-2 ring-green-400":""}`,children:[o.jsx("input",{type:"radio",name:`question_${e?.question_id}`,value:"true",checked:b==="true",onChange:()=>se("true"),className:"sr-only","aria-label":"True"}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${b==="true"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:b==="true"&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),o.jsx("span",{className:"text-gray-800 font-medium",children:"True"})]}),o.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${b==="false"?"border-blue-500 bg-blue-50":"border-gray-200"} ${g&&k==="false"?"ring-2 ring-green-400":""}`,children:[o.jsx("input",{type:"radio",name:`question_${e?.question_id}`,value:"false",checked:b==="false",onChange:()=>se("false"),className:"sr-only","aria-label":"False"}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${b==="false"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:b==="false"&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),o.jsx("span",{className:"text-gray-800 font-medium",children:"False"})]})]}),!N&&M&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:M})]}),Y=()=>o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",e?.question_id||"New Question"]}),o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[Q&&o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Br,{size:"small"}),o.jsx("span",{children:"Saving..."})]}),ae&&!Q&&o.jsxs("div",{className:"text-green-600",children:["✓ Saved at ",ae]})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:`question_${e?.question_id}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text *"}),o.jsx("textarea",{id:`question_${e?.question_id}`,value:T,onChange:ee=>L(ee.target.value),placeholder:"Enter your question here...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 resize-none",rows:3,required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Correct Answer *"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${k==="true"?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[o.jsx("input",{type:"radio",name:`correct_${e?.question_id}`,value:"true",checked:k==="true",onChange:()=>G("true"),className:"sr-only","aria-label":"True"}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${k==="true"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:k==="true"&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),o.jsx("span",{className:"text-gray-800 font-medium",children:"True"})]}),o.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${k==="false"?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[o.jsx("input",{type:"radio",name:`correct_${e?.question_id}`,value:"false",checked:k==="false",onChange:()=>G("false"),className:"sr-only","aria-label":"False"}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${k==="false"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:k==="false"&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),o.jsx("span",{className:"text-gray-800 font-medium",children:"False"})]})]})]})]}),!N&&M&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:M}),o.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:o.jsx(rt,{variant:"success",onClick:O,disabled:!N||f,className:"w-full sm:w-auto",children:f?o.jsx(Br,{size:"small"}):"Save Question"})})]});return o.jsx("div",{className:"true-false-question-container",children:n==="student"?q():Y()})},MW=({question:e,testId:t,testType:r="multiple_choice",mode:n="student",studentAnswer:s,onAnswerChange:a,onQuestionChange:i,onOptionAdd:l,onOptionRemove:c,onSave:d,isEditing:f=!1,isSaving:p=!1,validationErrors:g={},showCorrectAnswers:y=!1,studentId:v=null,displayNumber:w})=>{const{getItem:b,setItem:E}=ev(),{showNotification:k}=da();C.useRef(null);const[_,T]=C.useState(""),[j,P]=C.useState(["","","",""]),[R,N]=C.useState(""),[A,M]=C.useState(""),[H,Q]=C.useState(!1),[Z,ae]=C.useState(!0),[te,se]=C.useState(""),[L,G]=C.useState(!1),[I,z]=C.useState(null);C.useEffect(()=>{if(e&&(M(e.question||""),P(e.options||["","","",""]),N(e.correct_answer||""),n==="student"&&v)){const Fe=b(`test_progress_${v}_${r}_${t}_${e.question_id}`);Fe&&T(Fe)}},[e,t,r,n,b]),C.useEffect(()=>{n==="student"&&s!==void 0&&s!==null&&(console.log("🔄 MultipleChoiceQuestion syncing with parent studentAnswer:",s),T(s))},[s,n]),C.useEffect(()=>{if(n==="student"&&_&&t&&e?.question_id&&v){const Fe=setTimeout(()=>{G(!0),E(`test_progress_${v}_${r}_${t}_${e.question_id}`,_),z(new Date().toLocaleTimeString()),setTimeout(()=>G(!1),1e3)},1e3);return()=>clearTimeout(Fe)}},[_,t,r,e?.question_id,n,v,E]),C.useEffect(()=>{if(n==="teacher"&&(A||j.some(Fe=>Fe.trim()))){const Fe=setTimeout(()=>{G(!0);const Me={question:A,options:j,correct_answer:R,timestamp:Date.now()};E(`teacher_form_${r}_${t}`,Me),z(new Date().toLocaleTimeString()),setTimeout(()=>G(!1),1e3)},2e3);return()=>clearTimeout(Fe)}},[A,j,R,t,r,n,E]),C.useCallback(Fe=>{if(n!=="student")return;const Me=String(Fe);T(Me),a&&a(e.question_id,Me),ee(Me)},[n,e?.question_id,a]);const V=C.useCallback(Fe=>{M(Fe),i&&i(e.question_id,Fe),X(Fe)},[e?.question_id,i]),O=C.useCallback((Fe,Me)=>{const Oe=[...j];Oe[Fe]=Me,P(Oe),i&&i(e.question_id,{...e,options:Oe}),ne(Oe)},[j,e,i]),W=C.useCallback(Fe=>{N(Fe),i&&i(e.question_id,{...e,correct_answer:Fe}),ge(Fe)},[e,i]),q=C.useCallback(()=>{if(j.length<6){const Fe=[...j,""];P(Fe),l&&l(e.question_id,Fe)}else k("Maximum 6 options allowed","warning")},[j,e?.question_id,l,k]),Y=C.useCallback(Fe=>{if(j.length>2){const Me=j.filter((Oe,He)=>He!==Fe);if(P(Me),R===String.fromCharCode(65+Fe))N("");else if(R&&String.fromCharCode(65+Fe)<R){const Oe=String.fromCharCode(65+Fe-1);N(Oe)}c&&c(e.question_id,Me)}else k("Minimum 2 options required","warning")},[j,R,e?.question_id,c,k]),ee=C.useCallback(Fe=>{if(n==="student"){if(!Fe){ae(!1),se("Please select an answer");return}ae(!0),e?.correct_answer&&Fe===e.correct_answer?se("✅ Correct answer!"):e?.correct_answer?se("❌ Incorrect answer"):se("Answer selected")}},[n,e?.correct_answer]),X=C.useCallback(Fe=>!Fe||Fe.trim().length<10?(ae(!1),se("Question must be at least 10 characters long"),!1):(ae(!0),se(""),!0),[]),ne=C.useCallback(Fe=>{if(n!=="teacher")return;if(Fe.filter(Oe=>Oe.trim().length>0).length<2){ae(!1),se("At least 2 options must be filled");return}if(Fe.some(Oe=>Oe.trim().length>0&&Oe.trim().length<3)){ae(!1),se("Each option must be at least 3 characters long");return}ae(!0),se("")},[n]),ge=C.useCallback(Fe=>{if(n==="teacher"){if(!Fe){ae(!1),se("Please select a correct answer");return}ae(!0),se("")}},[n]),_e=C.useCallback(()=>{if(n!=="teacher"||!d)return;const Fe={question_id:e.question_id,question:A,options:j.filter(Me=>Me.trim().length>0),correct_answer:R,type:"multiple_choice"};d(Fe)},[n,d,e?.question_id,A,j,R]),Pe=C.useCallback(Fe=>Fe?Fe.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"):"",[]);return n==="teacher"?o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",e?.question_id||"New Question"]}),o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[L&&o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Br,{size:"small"}),o.jsx("span",{children:"Saving..."})]}),I&&!L&&o.jsxs("div",{className:"text-green-600",children:["✓ Saved at ",I]})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:`question_${e?.question_id}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text *"}),o.jsx("textarea",{id:`question_${e?.question_id}`,value:A,onChange:Fe=>V(Fe.target.value),placeholder:"Enter your question here...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 resize-none",rows:3,required:!0})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Answer Options *"}),o.jsx(rt,{variant:"secondary",size:"small",onClick:q,disabled:j.length>=6,className:"px-3 py-1 text-sm",children:"+ Add Option"})]}),o.jsx("div",{className:"space-y-3",children:j.map((Fe,Me)=>o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:String.fromCharCode(65+Me)}),o.jsx("input",{type:"text",value:Fe,onChange:Oe=>O(Me,Oe.target.value),placeholder:`Option ${String.fromCharCode(65+Me)}`,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200",required:!0}),j.length>2&&o.jsx(rt,{variant:"danger",size:"small",onClick:()=>Y(Me),className:"px-2 py-1 text-sm",children:"×"})]},Me))})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:`correct_${e?.question_id}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Correct Answer *"}),o.jsxs("select",{id:`correct_${e?.question_id}`,value:R,onChange:Fe=>W(Fe.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200",required:!0,children:[o.jsx("option",{value:"",children:"Select correct answer"}),j.map((Fe,Me)=>{if(!Fe.trim())return null;const Oe=String.fromCharCode(65+Me);return o.jsxs("option",{value:Oe,children:[Oe,") ",Fe]},Me)})]})]})]}),!Z&&te&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:te}),o.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:o.jsx(rt,{variant:"success",onClick:_e,disabled:!Z||p,className:"w-full sm:w-auto",children:p?o.jsx(Br,{size:"small"}):"Save Question"})})]}):o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",typeof w=="number"?w:e?.question_id]}),o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[L&&o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Br,{size:"small"}),o.jsx("span",{children:"Saving..."})]}),I&&!L&&o.jsxs("div",{className:"text-green-600",children:["✓ Saved at ",I]})]})]}),o.jsx("div",{className:"question-text mb-6 text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:Pe(A)}}),o.jsx("div",{className:"space-y-3",children:j.map((Fe,Me)=>o.jsxs("label",{className:`flex items-center p-3 rounded-lg border-2 cursor-pointer transition-all duration-200 ${_===String.fromCharCode(65+Me)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[o.jsx("input",{type:"radio",name:`mcq_${t}_${e?.question_id}`,value:String.fromCharCode(65+Me),checked:_===String.fromCharCode(65+Me),onChange:Oe=>{T(Oe.target.value),a&&a(e?.question_id,Oe.target.value)},className:"mr-3"}),o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600 mr-3",children:String.fromCharCode(65+Me)}),o.jsx("span",{className:"flex-1",children:Fe||`Option ${String.fromCharCode(65+Me)}`})]},Me))}),!Z&&te&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:te})]})},OW=({question:e,testId:t,testType:r="input",mode:n="student",displayNumber:s,studentAnswer:a,onAnswerChange:i,onQuestionChange:l,onAnswerAdd:c,onAnswerRemove:d,onSave:f,isEditing:p=!1,isSaving:g=!1,validationErrors:y={},showCorrectAnswers:v=!1,studentId:w=null})=>{const{getItem:b,setItem:E}=ev(),{showNotification:k}=da(),_=C.useRef(null),[T,j]=C.useState(""),[P,R]=C.useState([""]),[N,A]=C.useState(!1),[M,H]=C.useState(!0),[Q,Z]=C.useState(""),[ae,te]=C.useState(!1);C.useEffect(()=>{if(n==="student"&&e?.question_id&&t&&r&&w){const X=`test_progress_${w}_${r}_${t}_${e.question_id}`,ne=b(X);ne&&j(ne)}},[e?.question_id,r,t,n,w,b]),C.useEffect(()=>{n==="student"&&a!==void 0&&a!==null&&(console.log("🔄 InputQuestion syncing with parent studentAnswer:",a),j(a))},[a,n]),C.useEffect(()=>{n==="teacher"&&e?.answers&&R(e.answers.length>0?e.answers:[""])},[e?.answers,n]),C.useEffect(()=>{if(n==="student"&&T&&e?.question_id&&t&&r&&w){const X=setTimeout(()=>{te(!0),E(`test_progress_${w}_${r}_${t}_${e.question_id}`,T),setTimeout(()=>te(!1),1e3)},1e3);return()=>clearTimeout(X)}},[T,e?.question_id,r,t,n,w,E]),C.useEffect(()=>{if(n==="teacher"&&P&&l){const X=setTimeout(()=>{l({...e,answers:P.filter(ne=>ne.trim())})},500);return()=>clearTimeout(X)}},[P,e,n,l]);const se=C.useCallback(X=>{j(X);const ne=X.trim().length>0;H(ne),Z(ne?"":"Please enter an answer"),i&&i(e.question_id,X)},[e?.question_id,i]),L=C.useCallback((X,ne)=>{const ge=[...P];ge[X]=ne,R(ge),i&&i(e.question_id,ge)},[P,e?.question_id,i]),G=C.useCallback(()=>{if(n==="teacher"){const X=[...P,""];R(X),c&&c(e.question_id,X)}},[P,e?.question_id,n,c]),I=C.useCallback(X=>{if(n==="teacher"&&P.length>1){const ne=P.filter((ge,_e)=>_e!==X);R(ne),d&&d(e.question_id,ne)}},[P,e?.question_id,n,d]),z=C.useCallback(()=>{if(n==="student"){const X=T.trim().length>0;return H(X),Z(X?"":"Please enter an answer"),X}else if(n==="teacher"){const X=P.some(ne=>ne.trim().length>0);return H(X),Z(X?"":"Please enter at least one correct answer"),X}return!0},[T,P,n]),V=C.useCallback(X=>X?X.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>"):"",[]),O=C.useCallback(()=>{A(!0)},[]),W=C.useCallback(()=>{A(!1),z()},[z]),q=C.useCallback(X=>{X.key==="Enter"&&n==="student"&&T.trim()&&(E(`test_progress_${r}_${t}_${e.question_id}`,T),k("Answer saved","success"))},[T,r,t,e?.question_id,n,E,k]),Y=()=>o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",typeof s=="number"?s:e.question_id]}),ae&&o.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[o.jsx(Br,{size:"small"}),o.jsx("span",{children:"Saving..."})]})]}),o.jsx("div",{className:"question-text mb-6 text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:V(e.question)}}),o.jsx("div",{className:"space-y-3",children:o.jsx("input",{ref:_,type:"text",id:`input_${e.question_id}`,placeholder:"Enter your answer here...",value:T,onChange:X=>se(X.target.value),onFocus:O,onBlur:W,onKeyPress:q,className:`w-full px-4 py-3 border-2 rounded-lg text-gray-800 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${M?N?"border-blue-500":"border-gray-300 hover:border-gray-400":"border-red-300 focus:border-red-500 focus:ring-red-500"}`,"data-question-id":e.question_id,"aria-label":`Answer for question ${e.question_id}`,"aria-invalid":!M,"aria-describedby":M?void 0:`error-${e.question_id}`})}),v&&e.correct_answers&&o.jsxs("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[o.jsx("h5",{className:"text-sm font-semibold text-green-800 mb-2",children:"Correct Answers:"}),o.jsx("ul",{className:"space-y-1",children:e.correct_answers.map((X,ne)=>o.jsxs("li",{className:"text-green-700 text-sm",children:["• ",X]},ne))})]})]}),ee=()=>o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",e.question_id||"New"]}),g&&o.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[o.jsx(Br,{size:"small"}),o.jsx("span",{children:"Saving..."})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:`question_${e.question_id||"new"}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text *"}),o.jsx("input",{type:"text",id:`question_${e.question_id||"new"}`,value:e.question||"",onChange:X=>l&&l({...e,question:X.target.value}),placeholder:"Enter question text",className:`w-full px-4 py-3 border-2 rounded-lg text-gray-800 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${y.question?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 hover:border-gray-400 focus:border-blue-500"}`}),y.question&&o.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:y.question})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Correct Answers *"}),o.jsx(rt,{type:"button",variant:"secondary",size:"small",onClick:G,className:"px-3 py-1 text-sm",children:"+ Add Answer"})]}),o.jsx("div",{className:"space-y-3",children:P.map((X,ne)=>o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:ne+1}),o.jsx("input",{type:"text",value:X,onChange:ge=>L(ne,ge.target.value),placeholder:`Correct answer ${ne+1}`,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200","data-question-id":e.question_id,"data-answer-index":ne}),P.length>1&&o.jsx(rt,{type:"button",variant:"danger",size:"small",onClick:()=>I(ne),className:"px-2 py-1 text-sm",children:"× Remove"})]},ne))}),y.answers&&o.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:y.answers})]})]}),f&&o.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:o.jsx(rt,{type:"button",variant:"success",onClick:f,disabled:g,className:"w-full sm:w-auto",children:g?o.jsx(Br,{size:"small"}):"Save Question"})})]});return o.jsx("div",{className:`input-question-container ${n} ${N?"focused":""}`,children:n==="student"?Y():ee()})},Ko=({isOpen:e=!1,onClose:t,title:r="",children:n,size:s="medium",showCloseButton:a=!0,closeOnBackdropClick:i=!0,className:l="",...c})=>{if(!e)return null;const d=p=>{i&&p.target===p.currentTarget&&t()};us.useEffect(()=>{const p=g=>{g.key==="Escape"&&t()};return e&&(document.addEventListener("keydown",p),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",p),document.body.style.overflow="unset"}},[e,t]);const f={small:"max-w-md",medium:"max-w-lg",large:"max-w-4xl"};return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:d,role:"dialog","aria-modal":"true","aria-label":r,...c,children:o.jsxs("div",{className:`
          bg-white rounded-xl shadow-md border border-gray-200 p-8
          hover:shadow-lg hover:-translate-y-1 transition-all duration-200
          w-full ${f[s]} mx-auto
          ${l}
        `,onClick:p=>p.stopPropagation(),children:[(r||a)&&o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r&&o.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:r}),a&&o.jsx("button",{onClick:t,className:"text-red-500 hover:text-red-700 hover:bg-red-50 transition-all duration-200 rounded-full p-2 text-2xl font-bold leading-none","aria-label":"Close modal",children:"×"})]}),o.jsx("div",{className:"space-y-6",children:n})]})})},D0=(e,t,r)=>{const[n,s]=C.useState(!1),[a,i]=C.useState(0),[l,c]=C.useState(!1),d=C.useRef(!1);C.useEffect(()=>{if(!e||!t||!r)return;const b=`anti_cheating_${r}_${e}_${t}`,E=Jn(b);E&&(i(E.tabSwitches||0),c(E.isCheating||!1))},[e,t,r]);const f=C.useCallback(()=>{if(console.log("🛡️ handleTabSwitch called - isTracking:",d.current),!d.current){console.log("🛡️ Not tracking, returning early");return}console.log("🛡️ Tab switch detected - starting 7 second timer...");const b=Date.now();setTimeout(()=>{const E=Date.now()-b;console.log("🛡️ Timer completed - time hidden:",E,"ms"),E>=6500?(console.log("🛡️ Tab was hidden for sufficient time - counting as tab switch"),i(k=>{const _=k+1,T=_>=2;console.log("🛡️ Tab switch count updated:",{newCount:_,cheating:T}),c(T);const j=`anti_cheating_${r}_${e}_${t}`;return Qn(j,{tabSwitches:_,isCheating:T},120*1e3),_})):console.log("🛡️ Tab was not hidden long enough - not counting as switch")},7e3)},[e,t,r]),p=C.useCallback(()=>{d.current&&(console.log("🛡️ Visibility change detected:",{hidden:document.hidden,isTracking:d.current}),document.hidden?f():console.log("🛡️ Tab became visible"))},[f]),g=C.useCallback(()=>{console.log("🛡️ startTracking called - setting up anti-cheating detection"),console.log("🛡️ Current document.hidden state:",document.hidden),console.log("🛡️ Current document.visibilityState:",document.visibilityState),s(!0),d.current=!0,document.addEventListener("visibilitychange",p),console.log("🛡️ Anti-cheating event listeners added (visibilitychange only)")},[p]),y=C.useCallback(()=>{console.log("🛡️ stopTracking called - removing anti-cheating detection"),s(!1),d.current=!1,document.removeEventListener("visibilitychange",p),console.log("🛡️ Anti-cheating event listeners removed")},[p]),v=C.useCallback(()=>{const b={caught_cheating:l,visibility_change_times:a};return console.log("🛡️ getCheatingData called:",b),b},[l,a]),w=C.useCallback(()=>{r&&e&&t&&w0(r,e,t),i(0),c(!1),console.log("🗑️ Anti-cheating data deleted from localStorage")},[r,e,t]);return{startTracking:g,stopTracking:y,clearData:w,getCheatingData:v,tabSwitches:a,isCheating:l,isTracking:n}},LW=({testData:e,onTestComplete:t,onBackToCabinet:r,isTestComplete:n=!1,testScore:s=null})=>{const[a,i]=C.useState(null),[l,c]=C.useState(null);C.useEffect(()=>{(async()=>{try{const[De,et]=await Promise.all([hi(()=>Promise.resolve().then(()=>NL),void 0),hi(()=>Promise.resolve().then(()=>aO),void 0)]);i(De),c(et.default)}catch(De){console.error("Failed to load Konva:",De)}})()},[]);const d=()=>a?{Stage:a.Stage,Layer:a.Layer,Rect:a.Rect,Arrow:a.Arrow,KonvaImage:a.Image,KonvaText:a.Text,Group:a.Group}:null,[f,p]=C.useState({}),[g,y]=C.useState({}),[v,w]=C.useState(0),[b,E]=C.useState(!1),[k,_]=C.useState(null),[T,j]=C.useState(0),[P,R]=C.useState(0),[N,A]=C.useState(null),[M,H]=C.useState(null),[Q,Z]=C.useState(!1),[ae,te]=C.useState(!1),{showNotification:se}=da(),{makeAuthenticatedRequest:L}=Ji(),{user:G}=Wn(),{startTracking:I,stopTracking:z,getCheatingData:V,clearData:O}=D0("matching_type",e?.id,G?.student_id||G?.id),W=C.useRef(null),q=C.useRef(null),Y=C.useRef(null),ee=C.useRef(0),[X,ne]=C.useState(400);C.useRef({});const ge=C.useCallback(()=>{Z(!0)},[]),_e=C.useCallback(()=>{y({}),p({}),Z(!1)},[]),Pe=C.useCallback(()=>{te(!0)},[]),ce=C.useCallback(()=>{te(!1),r()},[r]),ye=C.useMemo(()=>{if(!e)return null;const Le=e.blocks.map(bt=>{let ut=bt.coordinates;if(typeof ut=="string")try{ut=JSON.parse(ut)}catch(jt){console.error("❌ Failed to parse coordinates:",jt),ut={x:0,y:0,width:100,height:100}}return ut={x:(typeof ut.x=="number"?ut.x:Number(ut.x))||0,y:(typeof ut.y=="number"?ut.y:Number(ut.y))||0,width:(typeof ut.width=="number"?ut.width:Number(ut.width))||30,height:(typeof ut.height=="number"?ut.height:Number(ut.height))||10},{id:bt.id,word:bt.word,coordinates:ut,hasArrow:bt.hasArrow,arrow:bt.arrow}}),De=Array.isArray(e.arrows)?e.arrows:[],et=e.words.map(bt=>({id:bt.id,word:bt.word,blockId:null,isPlaced:!1,isCorrect:!1}));return{blocks:Le,arrows:De,words:et}},[e]);C.useEffect(()=>{if(!e?.image_url)return;const Le=new Image;Le.crossOrigin="anonymous",Le.onload=()=>{console.log("🖼️ Image loaded successfully"),j(Le.width),R(Le.height);const De=W.current?.clientWidth||800,et=W.current?.clientHeight||600,bt=De/Le.width,ut=et/Le.height,jt=Math.min(bt,ut,1),Rt=Le.width*jt,Xe=Le.height*jt,Ye=(De-Rt)/2,pt=(et-Xe)/2;_({x:Ye,y:pt,width:Rt,height:Xe,scaleX:jt,scaleY:jt,scale:jt,image:Le}),ee.current=W.current?.clientWidth||800,console.log("🔍 Image info calculated:",{x:Ye,y:pt,width:Rt,height:Xe,scaleX:jt,scaleY:jt})},Le.onerror=()=>{console.error("❌ Failed to load image"),se("Failed to load test image","error")},Le.src=e.image_url},[e?.image_url,se]),C.useEffect(()=>{if(!ye||!k)return;const Le=ee.current||W.current?.clientWidth||800,De=12,et=38;let bt=k.x,ut=k.y+k.height+De;const jt=k.x+k.width,Rt={};ye.words.forEach(pt=>{if(!Object.prototype.hasOwnProperty.call(g,pt.id)){const mt=typeof pt.word=="string"?pt.word:"",_t=Math.max(60,mt.length*8+20);bt+_t>Math.min(Le-De,jt)&&(bt=k.x,ut+=et),f[pt.id]||(Rt[pt.id]={x:bt,y:ut}),bt+=_t+De}}),Object.keys(Rt).length&&p(pt=>({...pt,...Rt}));const Xe=Object.values(Rt).reduce((pt,mt)=>Math.max(pt,mt.y),ut),Ye=Math.max(k.y+k.height+De,Xe+et+De);ne(Math.max(400,Math.ceil(Ye)))},[ye,k,g,f]);const Fe=C.useCallback(()=>{if(!k||!ye)return[];const Le=d();return Le?ye.blocks.map(De=>{const et=De.coordinates;let bt,ut,jt,Rt;bt=k.x+et.x*(k.scale??k.scaleX),ut=k.y+et.y*(k.scale??k.scaleY),jt=et.width*(k.scale??k.scaleX),Rt=et.height*(k.scale??k.scaleY);const Xe=g[De.id];return o.jsxs(Le.Group,{children:[o.jsx(Le.Rect,{x:bt,y:ut,width:jt,height:Rt,fill:Xe?"rgba(40, 167, 69, 0.4)":N===De.id?"rgba(0, 123, 255, 0.25)":"rgba(0, 123, 255, 0.15)",stroke:Xe?"#28a745":N===De.id?"#0056b3":"#007bff",strokeWidth:2,cornerRadius:6,shadowColor:Xe?"rgba(40, 167, 69, 0.3)":"rgba(0, 123, 255, 0.3)",shadowBlur:10,shadowOffset:{x:0,y:2},shadowOpacity:.5}),Xe&&o.jsx(Le.KonvaText,{x:bt+5,y:ut+Rt/2-10,width:jt-10,height:20,text:ye.words.find(Ye=>Ye.id===Xe)?.word||"",fontSize:Math.min(12,jt/8),fontFamily:"Arial",fill:"#2c3e50",align:"center",verticalAlign:"middle",listening:!1})]},De.id)}):[]},[k,ye,g,a]),Me=C.useCallback(()=>{if(!k||!ye)return[];const Le=d();return Le?(console.log("🔍 Processing arrows:",ye.arrows),ye.arrows.map(De=>{if(console.log("🔍 Arrow data:",De),!De.start||!De.end)return console.warn("⚠️ Arrow missing start/end coordinates:",De),null;let et,bt,ut,jt;if(De.rel_start_x!==null&&De.rel_start_y!==null&&De.rel_end_x!==null&&De.rel_end_y!==null&&De.image_width&&De.image_height&&De.image_width>0&&De.image_height>0){const Rt=De.image_width,Xe=De.image_height,Ye=k.width/Rt,pt=k.height/Xe;et=k.x+Number(De.rel_start_x)/100*Rt*Ye,bt=k.y+Number(De.rel_start_y)/100*Xe*pt,ut=k.x+Number(De.rel_end_x)/100*Rt*Ye,jt=k.y+Number(De.rel_end_y)/100*Xe*pt}else{const Rt=k.scale??k.scaleX??1,Xe=Number(De.start.x),Ye=Number(De.start.y),pt=Number(De.end.x),mt=Number(De.end.y);Xe<=k.width+1&&pt<=k.width+1&&Ye<=k.height+1&&mt<=k.height+1?(et=k.x+(isNaN(Xe)?0:Xe),bt=k.y+(isNaN(Ye)?0:Ye),ut=k.x+(isNaN(pt)?0:pt),jt=k.y+(isNaN(mt)?0:mt)):(et=k.x+(isNaN(Xe)?0:Xe)*Rt,bt=k.y+(isNaN(Ye)?0:Ye)*Rt,ut=k.x+(isNaN(pt)?0:pt)*Rt,jt=k.y+(isNaN(mt)?0:mt)*Rt)}return o.jsx(Le.Arrow,{points:[et,bt,ut,jt],stroke:De.style?.color||"#dc3545",fill:De.style?.color||"#dc3545",strokeWidth:De.style?.thickness||3,pointerLength:10,pointerWidth:10},De.id)}).filter(Boolean)):[]},[k,ye,a]),Oe=C.useCallback(()=>{if(!ye)return[];const Le=d();return Le?ye.words.map(De=>{const et=f[De.id]||{x:0,y:0},bt=typeof De.word=="string"?De.word:"",ut=Math.max(60,bt.length*8+20);return Object.values(g).includes(De.id)?null:o.jsxs(Le.Group,{x:et.x,y:et.y,draggable:!0,onDragEnd:Rt=>He(Rt,De.id),children:[o.jsx(Le.Rect,{width:ut,height:34,fill:"#ffffff",stroke:"#ced4da",strokeWidth:1,cornerRadius:4,shadowColor:"rgba(0,0,0,0.1)",shadowBlur:5,shadowOffset:{x:0,y:2},shadowOpacity:.3,listening:!0}),o.jsx(Le.KonvaText,{text:bt,fontSize:14,fontFamily:"Arial",fill:"#343a40",padding:8,align:"center",verticalAlign:"middle",width:ut,height:34,listening:!1})]},De.id)}):[]},[ye,f,g,k,a]),He=C.useCallback((Le,De)=>{const et=Le.target.x(),bt=Le.target.y();if(p(_t=>({..._t,[De]:{x:et,y:bt}})),!k||!ye)return;const ut=ye.words.find(_t=>_t.id===De);if(!ut)return;const jt=typeof ut.word=="string"?ut.word:"",Rt=Math.max(60,jt.length*8+20),Xe={x:et,y:bt,width:Rt,height:34},Ye=k.scale??k.scaleX??1,pt=(_t,Ht)=>!(Ht.x>_t.x+_t.width||Ht.x+Ht.width<_t.x||Ht.y>_t.y+_t.height||Ht.y+Ht.height<_t.y),mt=ye.blocks.find(_t=>{const Ht=_t.coordinates,Qt={x:k.x+Ht.x*Ye,y:k.y+Ht.y*Ye,width:Ht.width*Ye,height:Ht.height*Ye};return pt(Xe,Qt)});if(mt){y(fr=>({...fr,[mt.id]:De}));const _t=mt.coordinates,Ht=k.x+_t.x*Ye,Qt=k.y+_t.y*Ye,nr=_t.width*Ye,Nr=_t.height*Ye;p(fr=>({...fr,[De]:{x:Ht+(nr-Rt)/2,y:Qt+(Nr-34)/2}})),se(`Word "${ut.word}" placed in block`,"success")}},[k,ye,se]),It=C.useCallback(()=>{if(!ye)return 0;const Le=ye.words.length,De=Object.keys(g).length;return Le>0?De/Le*100:0},[ye,g]);C.useEffect(()=>{const Le=It();w(Le)},[It]),C.useEffect(()=>{if(e&&!M){const Le=new Date;H(Le),console.log("⏱️ Test timer started at:",Le.toISOString()),I(),console.log("🛡️ Anti-cheating tracking started")}},[e,M,I]);const Ze=C.useCallback(async()=>{if(ye){E(!0);try{const Le=ye.words.length;let De=0;console.log("🔍 Scoring check - placedWords:",g),console.log("🔍 Scoring check - blocks:",ye.blocks.map(hr=>({id:hr.id,word:hr.word}))),console.log("🔍 Scoring check - words:",ye.words.map(hr=>({id:hr.id,word:hr.word}))),ye.blocks.forEach(hr=>{const sr=g[hr.id];if(console.log(`🔍 Block ${hr.id} (expects "${hr.word}") has placed word ID: ${sr}`),sr){const Er=ye.words.find(he=>he.id===sr);console.log("🔍 Placed word:",Er),Er&&Er.word===hr.word?(De++,console.log(`✅ Correct! Block ${hr.id} has correct word "${Er.word}"`)):console.log(`❌ Incorrect! Block ${hr.id} expected "${hr.word}" but got "${Er?.word||"nothing"}"`)}else console.log(`❌ Block ${hr.id} has no word placed`)});const et=De,bt=Le;console.log(`🎯 Final Score: ${et}/${bt} (${Math.round(et/bt*100)}%)`);const ut=new Date,jt=M?Math.round((ut-M)/1e3):0,Rt=M?M.toISOString():ut.toISOString();console.log("⏱️ Test timing:",{startedAt:Rt,endTime:ut.toISOString(),timeTaken:`${jt} seconds`});const Xe=V();console.log("🛡️ Anti-cheating data for submission:",Xe);const Ye=G.student_id,pt=`retest_assignment_id_${Ye}_matching_type_${e.id}`,mt=localStorage.getItem(pt),{academicCalendarService:_t}=await hi(async()=>{const{academicCalendarService:hr}=await Promise.resolve().then(()=>rv);return{academicCalendarService:hr}},void 0);await _t.loadAcademicCalendar();const Qt=_t.getCurrentTerm()?.id;if(!Qt)throw new Error("No current academic period found");const nr={test_id:e.id,test_name:e.test_name,teacher_id:e.teacher_id||null,subject_id:e.subject_id||null,student_id:Ye,academic_period_id:Qt,answers:g,score:et,maxScore:bt,time_taken:jt,started_at:Rt,submitted_at:ut.toISOString(),caught_cheating:Xe.caught_cheating,visibility_change_times:Xe.visibility_change_times,retest_assignment_id:mt?Number(mt):null,parent_test_id:e.id};console.log("🔍 Submitting test data:",nr);const fr=await(await L("/.netlify/functions/submit-matching-type-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(nr)})).json();if(console.log("🔍 Submission response:",fr),fr.success){if(se("Test submitted successfully!","success"),z(),O(),G?.student_id&&w0(G.student_id,"matching_type",e.id),G?.student_id){const sr=`test_completed_${G.student_id}_matching_type_${e.id}`;localStorage.setItem(sr,"true"),console.log("✅ Test marked as completed in localStorage:",sr)}if(G?.student_id){const{setCachedData:sr,CACHE_TTL:Er}=await hi(async()=>{const{setCachedData:le,CACHE_TTL:pe}=await Promise.resolve().then(()=>Uh);return{setCachedData:le,CACHE_TTL:pe}},void 0),he=`student_results_table_${G.student_id}`;sr(he,fr,Er.student_results_table),console.log("🎓 Test results cached with key:",he)}const hr=`retest1_${Ye}_matching_type_${e.id}`;localStorage.removeItem(hr),localStorage.removeItem(pt),t&&t(et)}else throw new Error(fr.message||"Failed to submit test")}catch(Le){console.error("❌ Error submitting test:",Le),se(`Error submitting test: ${Le.message}`,"error")}finally{E(!1)}}},[ye,g,e,G,M,L,se,t]);return!e||!ye?o.jsx(Br,{}):o.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:o.jsxs("div",{className:"max-w-6xl mx-auto",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:e.test_name})}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-sm text-gray-500",children:"Progress"}),o.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(v),"%"]})]})]}),o.jsx("div",{className:"mt-4 w-full bg-gray-200 rounded-full h-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${v}%`}})})]}),o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:o.jsx("div",{className:"lg:col-span-3",children:o.jsxs(kt,{className:"p-4",children:[o.jsxs("div",{className:"mb-4 text-center space-x-4",children:[o.jsx(rt,{onClick:ge,variant:"secondary",children:"Reset"}),o.jsx(rt,{onClick:Pe,variant:"secondary",children:"Back to Cabinet"})]}),o.jsx("div",{ref:W,className:"w-full bg-gray-100 rounded-lg overflow-hidden",style:{height:`${X}px`},children:k&&a?(()=>{const{Stage:Le,Layer:De,KonvaImage:et}=d();return o.jsxs(Le,{ref:q,width:W.current?.clientWidth||800,height:X,children:[o.jsxs(De,{children:[o.jsx(et,{ref:Y,image:k.image,x:k.x,y:k.y,width:k.width,height:k.height,listening:!1}),Fe(),Me()]}),o.jsx(De,{listening:!0,children:Oe()})]})})():k?o.jsxs("div",{className:"flex items-center justify-center h-full",children:[o.jsx(Br,{size:"lg"}),o.jsx("span",{className:"ml-2 text-gray-600",children:"Loading Konva canvas..."})]}):null}),o.jsx("div",{className:"mt-4 text-center",children:o.jsx(rt,{onClick:Ze,disabled:b||v<100,children:b?"Submitting...":"Submit Test"})})]})})}),o.jsx(Ko,{isOpen:Q,onClose:()=>Z(!1),title:"Reset Test",size:"small",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to reset? This will clear all your progress and placed words."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(rt,{onClick:()=>Z(!1),variant:"secondary",children:"Cancel"}),o.jsx(rt,{onClick:_e,variant:"primary",children:"Reset"})]})]})}),o.jsx(Ko,{isOpen:ae,onClose:()=>te(!1),title:"Exit Test",size:"small",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to go back to cabinet? Your progress will be saved but you will exit the test."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(rt,{onClick:()=>te(!1),variant:"secondary",children:"Cancel"}),o.jsx(rt,{onClick:ce,variant:"primary",children:"Go Back"})]})]})})]})})},BW=({testName:e="",onTestSaved:t,onCancel:r,onBackToCabinet:n,isSaving:s=!1,validationErrors:a={}})=>{const{user:i}=Wn(),{makeAuthenticatedRequest:l}=Ji(),{showNotification:c}=da(),[d,f]=C.useState([{leftWord:"",rightWord:""},{leftWord:"",rightWord:""},{leftWord:"",rightWord:""}]),[p,g]=C.useState("drag"),[y,v]=C.useState(!1),[w,b]=C.useState(null),E=C.useCallback(()=>{f(R=>[...R,{leftWord:"",rightWord:""}])},[]),k=C.useCallback(R=>{d.length>1&&f(N=>N.filter((A,M)=>M!==R))},[d.length]),_=C.useCallback((R,N)=>{f(A=>A.map((M,H)=>H===R?{...M,leftWord:N}:M))},[]),T=C.useCallback((R,N)=>{f(A=>A.map((M,H)=>H===R?{...M,rightWord:N}:M))},[]),j=C.useCallback(()=>d.every(R=>R.leftWord.trim()&&R.rightWord.trim()),[d]),P=C.useCallback(async()=>{if(!j()){c("Please fill in all word pairs","error");return}v(!0),b(null);try{const R=d.map((A,M)=>({question_id:M+1,left_word:A.leftWord.trim(),right_word:A.rightWord.trim()})),N={test_name:e,num_questions:R.length,interaction_type:p,questions:R};console.log("🎯 Saving word matching test:",N),t({testName:e,numQuestions:R.length,interactionType:p,wordPairs:d,questions:R})}catch(R){console.error("Error saving word matching test:",R),b(R.message),c("Failed to save test: "+R.message,"error")}finally{v(!1)}},[e,d,p,j,l,c,t]);return o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"max-w-6xl mx-auto p-6",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Create Word Matching Test"}),o.jsx("p",{className:"text-gray-600",children:"Enter word pairs - position 1 left matches position 1 right"})]}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Choose Interaction Type"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:` p-4 border-2 rounded-lg cursor-pointer transition-all ${p==="drag"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>g("drag"),children:[o.jsxs("div",{className:"flex items-center mb-2",children:[o.jsx("input",{type:"radio",checked:p==="drag",onChange:()=>g("drag"),className:"mr-3"}),o.jsx("h4",{className:"font-medium",children:"Drag & Drop"})]}),o.jsx("p",{className:"text-sm text-gray-600",children:"Students drag words from left list to right list"}),o.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["• Easier for younger students",o.jsx("br",{}),"• Visual feedback on placement",o.jsx("br",{}),"• Mobile-friendly"]})]}),o.jsxs("div",{className:` p-4 border-2 rounded-lg cursor-pointer transition-all ${p==="arrow"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>g("arrow"),children:[o.jsxs("div",{className:"flex items-center mb-2",children:[o.jsx("input",{type:"radio",checked:p==="arrow",onChange:()=>g("arrow"),className:"mr-3"}),o.jsx("h4",{className:"font-medium",children:"Draw Arrows"})]}),o.jsx("p",{className:"text-sm text-gray-600",children:"Students draw arrows connecting matching words"}),o.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["• More challenging",o.jsx("br",{}),"• Better for visual learners",o.jsx("br",{}),"• Requires precision"]})]})]})]})}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"word-pairs-section",children:[o.jsxs("div",{className:"pairs-header flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Word Pairs"}),o.jsx(rt,{onClick:E,size:"sm",children:"+ Add Pair"})]}),o.jsx("div",{className:"pairs-list space-y-3",children:d.map((R,N)=>o.jsxs("div",{className:"word-pair-row flex items-center space-x-4 p-4 bg-gray-50 rounded-lg border",children:[o.jsx("div",{className:"pair-number flex-shrink-0",children:o.jsx("span",{className:"number-badge w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-semibold",children:N+1})}),o.jsx("div",{className:"left-word flex-1",children:o.jsx("input",{type:"text",value:R.leftWord,onChange:A=>_(N,A.target.value),placeholder:"Left word...",className:"word-input w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),o.jsx("div",{className:"pair-arrow flex-shrink-0 text-gray-500 text-xl",children:"→"}),o.jsx("div",{className:"right-word flex-1",children:o.jsx("input",{type:"text",value:R.rightWord,onChange:A=>T(N,A.target.value),placeholder:"Right word...",className:"word-input w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),o.jsx("div",{className:"pair-actions flex-shrink-0",children:o.jsx(rt,{onClick:()=>k(N),variant:"outline",size:"sm",className:"remove-btn w-8 h-8 p-0 text-red-500 hover:bg-red-50",disabled:d.length<=1,children:"×"})})]},N))})]})}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"preview-section",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Preview"}),o.jsx("div",{className:"preview-pairs space-y-2",children:d.map((R,N)=>o.jsxs("div",{className:"preview-pair flex items-center space-x-2 text-sm",children:[o.jsxs("span",{className:"preview-number font-semibold text-blue-600",children:[N+1,"."]}),o.jsx("span",{className:"preview-left px-2 py-1 bg-white rounded border",children:R.leftWord||"Left word"}),o.jsx("span",{className:"preview-arrow text-gray-500",children:"→"}),o.jsx("span",{className:"preview-right px-2 py-1 bg-white rounded border",children:R.rightWord||"Right word"})]},N))})]})}),o.jsxs("div",{className:"flex justify-center space-x-4",children:[o.jsx(rt,{onClick:P,disabled:!j()||y,className:"px-8",children:y?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",color:"white",className:"mr-2"}),"Saving Test..."]}):"Save Test"}),o.jsx(rt,{onClick:r,variant:"secondary",children:"Cancel"})]}),w&&o.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-600",children:w})})]})},UW=(e,t)=>{const[r,n,s]=BA(`test_progress_${e}_${t}`,{}),[a,i]=C.useState(!1),[l,c]=C.useState(0),[d,f]=C.useState(0),[p,g]=C.useState(!1),[y,v]=C.useState(null),w=C.useRef(null),b=C.useRef(null),E=C.useCallback((I,z)=>{if(!window.tokenManager||!window.tokenManager.isAuthenticated()){console.warn("[WARN] Cannot save progress: No valid JWT token");return}n(V=>({...V,[I]:z})),console.log(`Saved progress for question ${I}:`,z)},[n]),k=C.useCallback(I=>!window.tokenManager||!window.tokenManager.isAuthenticated()?(console.warn("[WARN] Cannot get progress: No valid JWT token"),null):r[I]||null,[r]),_=C.useCallback(()=>{if(console.log(`[DEBUG] clearTestProgress called with testType: ${e}, testId: ${t}`),!window.tokenManager||!window.tokenManager.isAuthenticated()){console.warn("[WARN] Cannot clear progress: No valid JWT token");return}const I=`test_progress_${e}_${t}`;console.log(`[DEBUG] Removing localStorage key: ${I}`);const z=Object.keys(r).length>0;s(),console.log(z?`[DEBUG] Progress cleared for test ${e}_${t}`:`[DEBUG] No progress found to clear for test ${e}_${t}`)},[s,e,t,r]),T=C.useCallback(()=>{w.current&&(T(w.current),w.current=null),b.current&&(T(b.current),b.current=null)},[]),j=C.useCallback(()=>{console.log(`[DEBUG] setupProgressTrackingForPage called with testType: ${e}, testId: ${t}`),b.current=setInterval(()=>{console.log("[DEBUG] Auto-saving progress..."),M()},3e4),console.log("[DEBUG] Progress tracking interval set up (30 seconds)")},[e,t]),P=C.useCallback(()=>{console.log(`[DEBUG] updateProgressDisplayForPage called with testType: ${e}, testId: ${t}`);const I=A(),z=d>0?Math.round(I/d*100):0;return console.log(`[DEBUG] Progress: ${I}/${d} questions answered`),console.log(`[DEBUG] Progress bar updated: ${z}%`),{answeredQuestions:I,totalQuestions:d,percentage:z}},[e,t,d]),R=C.useCallback(()=>{console.log("[DEBUG] updateSubmitButtonStateForPage called");const I=A();console.log(`[DEBUG] Submit button state check: ${I}/${d} questions answered`);const z=I===d&&d>0;return console.log(z?"[DEBUG] Submit button enabled - all questions answered":"[DEBUG] Submit button disabled - not all questions answered"),z},[d]),N=C.useCallback(()=>{console.log(`[DEBUG] loadSavedProgressForPage called with testType: ${e}, testId: ${t}`);try{if(console.log("[DEBUG] Loaded progress from localStorage:",r),Object.keys(r).length===0){console.log("[DEBUG] No saved progress found");return}const I=Object.keys(r).length;c(I),console.log(`[DEBUG] Restored ${I} answered questions`)}catch(I){console.error("[ERROR] Failed to load saved progress:",I),v(I.message)}},[e,t,r]),A=C.useCallback(()=>{console.log(`[DEBUG] getAnsweredQuestionsCountForPage called with testType: ${e}`);const I=Object.keys(r).length;return c(I),console.log(`[DEBUG] Found ${I} answered questions`),I},[e,r]),M=C.useCallback(()=>{console.log(`[DEBUG] saveProgressForPage called with testType: ${e}, testId: ${t}`);try{console.log("[DEBUG] Progress saved:",r)}catch(I){console.error("[ERROR] Failed to save progress:",I),v(I.message)}},[e,t,r]),H=C.useCallback(()=>{try{const I=`test_completed_${e}_${t}`,z=localStorage.getItem(I)==="true";return i(z),z}catch(I){return console.error("Error checking test completion:",I),!1}},[e,t]),Q=C.useCallback(()=>{try{const I=`test_completed_${e}_${t}`;localStorage.setItem(I,"true"),i(!0),console.log(`Test ${e}_${t} marked as completed`)}catch(I){console.error("Error marking test completed:",I)}},[e,t]),Z=C.useCallback(()=>{console.log("Marking test completed in UI:",{testType:e,testId:t}),Q()},[e,t,Q]),ae=C.useCallback(I=>{try{const z=`test_creation_state_${e}_${t}`;localStorage.setItem(z,JSON.stringify(I)),console.log("Test creation state saved:",I)}catch(z){console.error("Error saving test creation state:",z)}},[e,t]),te=C.useCallback(()=>{try{const I=`test_creation_state_${e}_${t}`;localStorage.removeItem(I),console.log("Test creation state cleared")}catch(I){console.error("Error clearing test creation state:",I)}},[e,t]),se=C.useCallback((I,z)=>{try{const V=`test_step_${e}_${t}_${I}`;localStorage.setItem(V,JSON.stringify(z)),console.log(`Step ${I} data saved:`,z)}catch(V){console.error(`Error saving step ${I} data:`,V)}},[e,t]),L=C.useCallback(I=>{try{const z=`test_step_${e}_${t}_${I}`,V=localStorage.getItem(z);return V?JSON.parse(V):null}catch(z){return console.error(`Error restoring step ${I} data:`,z),null}},[e,t]),G=C.useCallback(()=>{try{const I=`test_creation_state_${e}_${t}`,z=localStorage.getItem(I);return z?JSON.parse(z):null}catch(I){return console.error("Error restoring test creation state:",I),null}},[e,t]);return C.useEffect(()=>()=>{T()},[e,t,j,N,T]),C.useEffect(()=>{A()},[r,A]),{progress:r,isCompleted:a,answeredCount:l,totalQuestions:d,isLoading:p,error:y,saveProgress:E,getProgress:k,clearProgress:_,clearInterval:T,setupProgressTracking:j,updateProgress:P,updateSubmitButton:R,loadProgress:N,getAnsweredCount:A,saveProgressForPage:M,checkCompleted:H,markCompleted:Q,markCompletedUI:Z,saveState:ae,clearState:te,saveStepData:se,restoreStepData:L,restoreState:G,setTotalQuestions:f,setError:v}},$W=({testData:e,onTestComplete:t,onBackToCabinet:r})=>{const{user:n}=Wn(),{makeAuthenticatedRequest:s}=Ji(),[a,i]=C.useState({width:window.innerWidth,height:window.innerHeight});C.useEffect(()=>{const Le=()=>{i({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",Le),()=>window.removeEventListener("resize",Le)},[]);const{getCheatingData:l,stopTracking:c,clearData:d}=D0(),[f,p]=C.useState(null),[g,y]=C.useState({}),[v,w]=C.useState(null),b=C.useRef(null),[E,k]=C.useState(800),_={VERY_SMALL:400,MOBILE:600,TABLET:900},T={VERY_SMALL:.6,MOBILE:.8,TABLET:.9,DESKTOP:1},j={CANVAS_HEIGHT:400,BLOCK_WIDTH:140,BLOCK_HEIGHT:50,BLOCK_SPACING:100,MARGIN:50,PADDING:20},P=a.width<_.VERY_SMALL,R=a.width>=_.VERY_SMALL&&a.width<_.MOBILE,N=a.width>=_.MOBILE&&a.width<_.TABLET;a.width>=_.TABLET;const A=P?T.VERY_SMALL:R?T.MOBILE:N?T.TABLET:T.DESKTOP;C.useEffect(()=>{const Le=()=>{if(b.current){const et=b.current.clientWidth;console.log("🎯 Container width detected:",et),et>0&&k(et)}};Le();const De=[setTimeout(Le,50),setTimeout(Le,100),setTimeout(Le,200),setTimeout(Le,500)];return window.addEventListener("resize",Le),()=>{De.forEach(et=>clearTimeout(et)),window.removeEventListener("resize",Le)}},[f]);const M=Math.max(j.CANVAS_HEIGHT*A,(f?.leftWords?.length||3)*j.BLOCK_SPACING*A+j.PADDING*2),H=j.BLOCK_WIDTH*A,Q=j.BLOCK_HEIGHT*A,Z=j.BLOCK_SPACING*A,ae=j.MARGIN*A,te=ae;console.log("🎯 Mobile Debug:",{screenWidth:a.width,containerWidth:b.current?.clientWidth,canvasWidth:E,scale:A,blockWidth:H,margin:ae,leftBlockX:te,displayDataLoaded:!!f});const se=te+H+20+H+ae,L=se<=E;let G,I=H,z=Q;if(L)G=Math.min(Math.max(te+H+20,E-H-ae),E-H-ae);else{const Le=E-ae*2,De=Math.floor((Le-20)/2);I=Math.max(60,De),z=Math.max(30,z*(I/H)),G=te+I+20,console.log("🎯 Very small screen - adjusted block size:",{availableWidth:Le,maxBlockWidth:De,actualBlockWidth:I,actualBlockHeight:z})}console.log("🎯 Right Block Position:",{rightBlockX:G,rightBlockRightEdge:G+I,canvasWidth:E,fits:G+I<=E,canFitSideBySide:L,minRequiredWidth:se});const V=ae,O={DRAGGED_WORD:Math.max(8,14*A),ORIGINAL_WORD:Math.max(10,16*A),LEFT_WORD:Math.max(10,14*A)},W=Math.max(1,3*A),[q,Y]=C.useState([]),[ee,X]=C.useState(!1),[ne,ge]=C.useState(null),[_e,Pe]=C.useState(!1),[ce,ye]=C.useState(!1);C.useEffect(()=>{if(e&&(p(e),ge(new Date),n?.student_id)){const Le=`test_progress_${n.student_id}_word_matching_${e.id}`,De=Jn(Le);De&&(y(De.answers||{}),Y(De.arrows||[]),ge(new Date(De.startTime)),console.log("🎯 Test progress restored:",De))}},[e,n?.student_id]),C.useEffect(()=>{if(f&&ne&&n?.student_id){const Le=setInterval(()=>{const De={answers:g,arrows:q,startTime:ne.toISOString()},et=`test_progress_${n.student_id}_word_matching_${e.id}`;Qn(et,De,hs.test_progress),console.log("🎯 Progress auto-saved")},3e4);return()=>clearInterval(Le)}},[f,g,q,ne,n?.student_id,e?.id]);const Fe=C.useCallback((Le,De)=>{if(e.interaction_type==="arrow")if(v){if(v.side===Le&&v.index===De)w(null);else if(v.side!==Le){const et={id:Date.now().toString(),startWord:v,endWord:{side:Le,index:De},color:"#3B82F6"};Y(bt=>[...bt,et]),y(bt=>({...bt,[v.index]:De})),w(null)}}else w({side:Le,index:De})},[v,e?.interaction_type]);C.useCallback((Le,De)=>{e.interaction_type==="drag"&&y(et=>({...et,[Le]:De}))},[e?.interaction_type]);const Me=C.useCallback(()=>{Pe(!0)},[]),Oe=C.useCallback(()=>{y({}),Y([]),w(null),Pe(!1)},[]),He=C.useCallback(()=>{ye(!0)},[]),It=C.useCallback(()=>{ye(!1),r&&r()},[r]),Ze=C.useCallback(async()=>{if(f){X(!0);try{const Le=f.leftWords.length;let De=0,et={};e.interaction_type==="drag"?Object.entries(g).forEach(([sr,Er])=>{const he=f.correctPairs[sr];Er===he&&De++,et[sr]=Er}):q.forEach(sr=>{const Er=sr.startWord.side==="left"?sr.startWord.index:sr.endWord.index,he=sr.startWord.side==="right"?sr.startWord.index:sr.endWord.index;f.correctPairs[Er]===he&&De++,et[Er]=he});const bt=De,ut=Le;console.log(`🎯 Final Score: ${bt}/${ut} (${Math.round(bt/ut*100)}%)`);const jt=new Date,Rt=ne?Math.round((jt-ne)/1e3):0,Xe=ne?ne.toISOString():jt.toISOString(),Ye=l(),pt=n.student_id,mt=`retest_assignment_id_${pt}_word_matching_${e.id}`,_t=localStorage.getItem(mt),{academicCalendarService:Ht}=await hi(async()=>{const{academicCalendarService:sr}=await Promise.resolve().then(()=>rv);return{academicCalendarService:sr}},void 0);await Ht.loadAcademicCalendar();const nr=Ht.getCurrentTerm()?.id;if(!nr)throw new Error("No current academic period found");const Nr={test_id:e.id,test_name:e.test_name,teacher_id:e.teacher_id||null,subject_id:e.subject_id||null,student_id:pt,academic_period_id:nr,parent_test_id:e.id,retest_assignment_id:_t?Number(_t):null,interaction_type:e.interaction_type,answers:et,score:bt,maxScore:ut,time_taken:Rt,started_at:Xe,submitted_at:jt.toISOString(),caught_cheating:Ye.caught_cheating,visibility_change_times:Ye.visibility_change_times};console.log("🎯 Submission data being sent:",Nr),console.log("🎯 TestData structure:",e),console.log("🎯 Submitting test results...");const fr=await s("/.netlify/functions/submit-word-matching-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Nr)});console.log("🎯 Submission response received:",fr.status);const hr=await fr.json();if(hr.success){if(c(),d(),n?.student_id){const sr=`test_completed_${n.student_id}_word_matching_${e.id}`;localStorage.setItem(sr,"true"),console.log("✅ Test marked as completed in localStorage:",sr);const Er=`retest1_${pt}_word_matching_${e.id}`;localStorage.removeItem(Er),localStorage.removeItem(mt),w0(n.student_id,"word_matching",e.id),console.log("🎓 Test data cleared from cache");const he=`student_results_table_${n.student_id}`;Qn(he,hr,hs.student_results_table),console.log("🎓 Test results cached with key:",he)}setTimeout(()=>{t&&t(bt)},2e3)}else throw new Error(hr.message||"Failed to submit test")}catch(Le){console.error("Error submitting test:",Le)}finally{X(!1)}}},[f,g,q,e,n,ne,l,c,d,s,t]);return f?o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"max-w-4xl mx-auto p-6",children:[o.jsx(Ko,{isOpen:ee,onClose:()=>{},title:"Submitting",size:"small",children:o.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[o.jsx(Br,{size:"lg",className:"mb-3"}),o.jsx("p",{className:"text-blue-600 font-semibold text-lg",children:"Submitting test..."}),o.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Please wait while we process your results"})]})}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.test_name}),o.jsx("p",{className:"text-gray-600",children:e.interaction_type==="drag"?"Drag words from left to right to match them":"Click on the word or phrase on the left, then click on the matching word or phrase on the right to connect them"})]})}),e.interaction_type==="drag"?o.jsx(kt,{className:"mb-6",children:o.jsx("div",{ref:b,className:"relative w-full",children:o.jsx(sf,{width:E,height:M,className:`border-2 border-gray-200 rounded-lg ${ee?"pointer-events-none opacity-50":""}`,children:o.jsxs(nf,{children:[f.leftWords.map((Le,De)=>{const et=g[De]!==void 0,bt=V+De*Z;return o.jsxs(qo,{x:te,y:bt,draggable:!et,onDragStart:ut=>{ut.target.moveToTop()},onDragEnd:ut=>{ut.target.getStage();const jt=f.rightWords,Rt=I+60,Xe=z+30,Ye=G-30,pt=V-15;console.log("🎯 Drop detection - Word dropped at:",ut.target.x(),ut.target.y());for(let mt=0;mt<jt.length;mt++){const _t=pt+mt*Z,Ht=Ye,Qt=Ye+Rt,nr=_t,Nr=_t+Xe;if(console.log(`🎯 Checking drop zone ${mt}:`,{left:Ht,right:Qt,top:nr,bottom:Nr,word:jt[mt]}),ut.target.x()>=Ht&&ut.target.x()<=Qt&&ut.target.y()>=nr&&ut.target.y()<=Nr){console.log(`✅ Match found! Word "${f.leftWords[De]}" matched with "${jt[mt]}"`),y(fr=>({...fr,[De]:mt}));break}}console.log("❌ No match found, resetting position"),ut.target.position({x:te,y:bt})},children:[o.jsx(ca,{width:I,height:z,fill:et?"#e5e7eb":"#3b82f6",stroke:et?"#9ca3af":"#1d4ed8",strokeWidth:2,cornerRadius:8,opacity:et?.5:1}),o.jsx(Rl,{text:Le,x:I/2,y:z/2,fontSize:O.LEFT_WORD,fontFamily:"Arial",fill:et?"#dc2626":"white",align:"center",verticalAlign:"middle",width:I,offsetX:I/2,offsetY:z/2,wrap:"word",ellipsis:!0,listening:!1})]},`left-${De}`)}),f.rightWords.map((Le,De)=>{const et=V+De*Z,bt=Object.keys(g).find(ut=>g[ut]===De);return o.jsxs(qo,{x:G,y:et,children:[o.jsx(ca,{width:I,height:z,fill:bt?"#10b981":"#f3f4f6",stroke:bt?"#059669":"#d1d5db",strokeWidth:2,cornerRadius:8}),o.jsx(Rl,{text:Le,x:I/2,y:z/2,fontSize:O.ORIGINAL_WORD,fontFamily:"Arial",fill:"#000000",align:"center",verticalAlign:"middle",width:I,offsetX:I/2,offsetY:z/2,wrap:"word",ellipsis:!0,listening:!1}),bt&&o.jsx(Rl,{text:f.leftWords[bt],x:H/2,y:Q/4,fontSize:O.DRAGGED_WORD,fontFamily:"Arial",fill:"#dc2626",align:"center",verticalAlign:"middle",width:I,offsetX:I/2,offsetY:z/8,wrap:"word",ellipsis:!0})]},`right-${De}`)})]})})})}):o.jsx(kt,{className:"mb-6",children:o.jsx("div",{ref:b,className:"relative w-full",children:o.jsx(sf,{width:E,height:M,className:`border-2 border-gray-200 rounded-lg ${ee?"pointer-events-none opacity-50":""}`,children:o.jsxs(nf,{children:[f.leftWords.map((Le,De)=>{const et=V+De*Z,bt=v?.side==="left"&&v?.index===De;return o.jsxs(qo,{x:te,y:et,onClick:()=>Fe("left",De),children:[o.jsx(ca,{width:I,height:z,fill:bt?"#3b82f6":"#f3f4f6",stroke:bt?"#1d4ed8":"#d1d5db",strokeWidth:bt?3:2,cornerRadius:8}),o.jsx(Rl,{text:Le,x:H/2,y:Q/2,fontSize:O.LEFT_WORD,fontFamily:"Arial",fill:bt?"white":"#374151",align:"center",verticalAlign:"middle",width:I,offsetX:I/2,offsetY:z/2,wrap:"word",ellipsis:!0,listening:!1})]},`left-${De}`)}),f.rightWords.map((Le,De)=>{const et=V+De*Z,bt=v?.side==="right"&&v?.index===De;return o.jsxs(qo,{x:G,y:et,onClick:()=>Fe("right",De),children:[o.jsx(ca,{width:I,height:z,fill:bt?"#3b82f6":"#f3f4f6",stroke:bt?"#1d4ed8":"#d1d5db",strokeWidth:bt?3:2,cornerRadius:8}),o.jsx(Rl,{text:Le,x:H/2,y:Q/2,fontSize:O.ORIGINAL_WORD,fontFamily:"Arial",fill:"#000000",align:"center",verticalAlign:"middle",width:I,offsetX:I/2,offsetY:z/2,wrap:"word",ellipsis:!0,listening:!1})]},`right-${De}`)}),q.map((Le,De)=>{const et=V+Le.startWord.index*Z+Q/2,bt=V+Le.endWord.index*Z+Q/2;return o.jsx(Ta,{points:[te+H+20,et,G-20,bt],stroke:Le.color||"#3b82f6",strokeWidth:W,lineCap:"round",lineJoin:"round"},De)})]})})})}),o.jsx(kt,{children:o.jsxs("div",{className:`submit-section flex justify-center space-x-4 ${ee?"pointer-events-none opacity-50":""}`,children:[o.jsx(rt,{onClick:Me,variant:"outline",disabled:ee,children:"Reset"}),o.jsx(rt,{onClick:He,variant:"outline",disabled:ee,children:"Back to Cabinet"}),o.jsx(rt,{onClick:Ze,disabled:ee,className:"px-8",children:ee?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",color:"white",className:"mr-2"}),"Submitting..."]}):"Submit Test"})]})}),o.jsx(Ko,{isOpen:_e&&!ee,onClose:()=>Pe(!1),title:"Reset Test",size:"small",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to reset? This will clear all your progress and answers."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(rt,{onClick:()=>Pe(!1),variant:"secondary",children:"Cancel"}),o.jsx(rt,{onClick:Oe,variant:"primary",children:"Reset"})]})]})}),o.jsx(Ko,{isOpen:ce&&!ee,onClose:()=>ye(!1),title:"Exit Test",size:"small",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to leave the test? Your progress will be saved."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(rt,{onClick:()=>ye(!1),variant:"secondary",children:"Cancel"}),o.jsx(rt,{onClick:It,variant:"primary",children:"Leave"})]})]})})]}):o.jsx("div",{className:"flex justify-center items-center min-h-screen",children:o.jsx(Br,{size:"lg"})})},WW=({id:e,x:t,y:r,width:n,height:s,text:a,fontSize:i,color:l,isSelected:c,onSelect:d,onUpdate:f,onDelete:p})=>{const[g,y]=C.useState(!1),v=C.useRef(!1),w=C.useRef(null),b=C.useRef({x:0,y:0}),E=C.useRef(null),k=5,_=()=>{v.current=!0,y(!0)},T=()=>{if(v.current=!1,y(!1),E.current)try{E.current.draggable(!1)}catch{}},j=()=>{w.current&&(clearTimeout(w.current),w.current=null)};C.useEffect(()=>()=>{j()},[]),C.useEffect(()=>{if(E.current)try{E.current.draggable(v.current)}catch{}},[g]);const P=N=>{N.cancelBubble=!0,f(e,{isEditing:!0})},R=N=>{f(e,{x:N.target.x(),y:N.target.y()})};return o.jsxs(qo,{ref:E,x:t,y:r,draggable:g,dragBoundFunc:N=>v.current?N:{x:t,y:r},name:"textbox-group",onClick:N=>{N.cancelBubble=!0,d(e)},onTap:N=>{N.cancelBubble=!0,d(e),j()},onDblClick:P,onDblTap:P,onPointerDown:N=>{N.cancelBubble=!0;const A=N.evt||{};b.current={x:A.clientX??0,y:A.clientY??0},j(),w.current=setTimeout(()=>{_()},400)},onPointerMove:N=>{if(!w.current)return;const A=N.evt||{},M=Math.abs((A.clientX??0)-b.current.x),H=Math.abs((A.clientY??0)-b.current.y);(M>k||H>k)&&j()},onPointerUp:N=>{N.cancelBubble=!0,j(),T()},onPointerLeave:()=>{j(),T()},onDragEnd:N=>{R(N),T()},children:[o.jsx(ca,{width:n,height:s,fill:c?"#fef3c7":"#ffffff",stroke:c?"#f59e0b":"#d1d5db",strokeWidth:c?2:1,cornerRadius:6,shadowColor:"black",shadowBlur:2,shadowOffset:{x:1,y:1},name:"textbox-rect",onTap:N=>{N.cancelBubble=!0,d(e),j()},onDblTap:N=>{N.cancelBubble=!0,P(N)}}),o.jsx(Rl,{text:a,width:n,height:s,padding:8,align:"left",verticalAlign:"top",fontSize:i,fill:l,wrap:"word",name:"textbox-text",onTap:N=>{N.cancelBubble=!0,d(e),j()},onDblTap:N=>{N.cancelBubble=!0,P(N)}})]})},zW=({x:e,y:t,width:r,height:n,initialText:s,onSave:a,onCancel:i})=>{const l=C.useRef(null);C.useEffect(()=>{l.current&&(l.current.focus(),l.current.select())},[]);const c=d=>{d.key==="Enter"&&!d.shiftKey?(d.preventDefault(),a(l.current.value)):d.key==="Escape"&&i()};return o.jsx("textarea",{ref:l,defaultValue:s,style:{position:"absolute",top:t,left:e,width:r,height:n,fontSize:"14px",border:"2px solid #f59e0b",borderRadius:"6px",padding:"8px",background:"white",resize:"none",outline:"none",fontFamily:"inherit",lineHeight:"1.4",zIndex:1e3},onKeyDown:c,onBlur:()=>a(l.current.value)})},HW=({width:e,height:t,lines:r,onDrawingChange:n,currentTool:s,currentColor:a,currentThickness:i,zoom:l,onZoomChange:c,isPanning:d,isFullscreen:f,constrainPanPosition:p,handleWheel:g,stageRef:y,setIsPanning:v,responsiveDimensions:w,canvasSize:b,question:E,textBoxes:k,setTextBoxes:_,selectedTextBox:T,setSelectedTextBox:j,handleTextBoxSelect:P,handleTextBoxUpdate:R,handleTextBoxDelete:N,isEditingText:A,editingTextBox:M,setIsEditingText:H,setEditingTextBox:Q,setCurrentTool:Z})=>{const[ae,te]=C.useState(!1),[se,L]=C.useState([]),[G,I]=C.useState(null),[z,V]=C.useState(null),O=C.useRef(null),[W,q]=C.useState(.25),[Y,ee]=C.useState({x:0,y:0}),X=C.useRef(null),ne=C.useRef(null),ge=C.useRef(!1),_e=6;C.useEffect(()=>{const Be=()=>{const at=O.current;if(!at)return;const dt=at.clientWidth||1,zt=at.clientHeight||1,Yt=Math.min(dt/(b.width||1),zt/(b.height||1));q(Math.min(Yt,1))};return Be(),window.addEventListener("resize",Be),()=>window.removeEventListener("resize",Be)},[b.width,b.height,f]);const Pe=Be=>{const at=y.current,dt=at.getPointerPosition();if(s==="pan"){if(be(Be.target))try{at.draggable(!1),ge.current=!0}catch{}return}if(s==="text"){const Yt={x:(dt.x-at.x())/at.scaleX(),y:(dt.y-at.y())/at.scaleY()};X.current={...Yt},ne.current={x:dt.x,y:dt.y};return}te(!0);const zt={x:(dt.x-at.x())/at.scaleX(),y:(dt.y-at.y())/at.scaleY()};V(zt),s==="pencil"?L([{x:zt.x,y:zt.y,color:a,thickness:i}]):s==="eraser"?L([{x:zt.x,y:zt.y,color:a,thickness:i,tool:"eraser"}]):["line","rectangle","circle"].includes(s)&&I({type:s,startX:zt.x,startY:zt.y,endX:zt.x,endY:zt.y,color:a,thickness:i})},ce=Be=>{const at=y.current,dt=at.getPointerPosition(),zt={x:(dt.x-at.x())/at.scaleX(),y:(dt.y-at.y())/at.scaleY()};if(ee(zt),s!=="pan"){if(s==="text"&&X.current&&ne.current){const Yt=Math.abs(dt.x-ne.current.x),wr=Math.abs(dt.y-ne.current.y);(Yt>_e||wr>_e)&&(X.current=null)}if(ae)if(s==="pencil"){const Yt=[...se,{x:zt.x,y:zt.y,color:a,thickness:i}];L(Yt)}else if(s==="eraser"){const Yt=[...se,{x:zt.x,y:zt.y,color:a,thickness:i,tool:"eraser"}];L(Yt)}else["line","rectangle","circle"].includes(s)&&G&&I({...G,endX:zt.x,endY:zt.y})}},ye=Be=>{const at=y.current;if(s==="pan"){if(ge.current){try{at.draggable(!0)}catch{}ge.current=!1}return}if(s==="text"&&X.current){const dt=Be&&Be.target;if(dt&&typeof dt.name=="function"&&dt.name()==="canvas-bg"){const Yt={id:Date.now(),x:X.current.x,y:X.current.y,width:150,height:60,text:"Double-click to edit",fontSize:14,color:"#000000"};_(wr=>[...wr,Yt]),j(Yt.id)}X.current=null,ne.current=null}if(ae){if(s==="pencil"){const dt=[...r,se];n(dt),L([])}else if(s==="eraser"){const dt=[...r,se];n(dt),L([])}else if(["line","rectangle","circle"].includes(s)&&G){const dt=[...r,G];n(dt),I(null)}te(!1),V(null)}},[Fe,Me]=C.useState(null),[Oe,He]=C.useState(null),[It,Ze]=C.useState(!1),[Le,De]=C.useState(null),[et,bt]=C.useState(!1),[ut,jt]=C.useState(!1),[Rt,Xe]=C.useState([]),[Ye,pt]=C.useState(null),[mt,_t]=C.useState({totalGestures:0,zoomGestures:0,panGestures:0,combinedGestures:0,averageResponseTime:0});let Ht=null;const nr=(window.devicePixelRatio||1)>1.5,Nr={scaleDelta:nr?.03:.04,centerDelta:nr?4:6,minTouchDistance:8,gestureHysteresis:.02},fr=()=>{bt(!1),De(null),Me(null),He(null),te(!1),V(null),jt(!1),pt(null),Ht&&(cancelAnimationFrame(Ht),Ht=null),y.current&&y.current.stop()},hr=Be=>{if(Be.length<2)return 0;const at=Be[0],dt=Be[1];return Math.sqrt(Math.pow(dt.clientX-at.clientX,2)+Math.pow(dt.clientY-at.clientY,2))},sr=Be=>{if(Be.length<2)return null;const at=Be[0],dt=Be[1];return{x:(at.clientX+dt.clientX)/2,y:(at.clientY+dt.clientY)/2}},Er=Be=>{Xe(at=>[...at,{type:Be,timestamp:Date.now()}].slice(-5))},he=()=>{const Be=Date.now(),at=Rt.filter(Yt=>Be-Yt.timestamp<500);if(at.length<2)return 0;const dt=at[at.length-1],zt=at[at.length-2];return dt.type===zt.type?Nr.gestureHysteresis:0},le=(Be,at)=>{_t(dt=>({totalGestures:dt.totalGestures+1,zoomGestures:Be.includes("zoom")?dt.zoomGestures+1:dt.zoomGestures,panGestures:Be.includes("pan")?dt.panGestures+1:dt.panGestures,combinedGestures:Be==="zoom+pan"?dt.combinedGestures+1:dt.combinedGestures,averageResponseTime:(dt.averageResponseTime+at)/2}))},pe=(Be,at,dt,zt)=>{const Yt=y.current,wr=Yt.scaleX(),Ur=Yt.position();let yr=wr,ur=Ur;if(Be){const fe=dt/Fe,me=wr*fe,Se=E?.max_canvas_width||1536,ke=E?.max_canvas_height||2048,We=Se/b.width,ft=ke/b.height,Re=Math.min(We,ft,1);yr=Math.max(.25,Math.min(Re,me));const ie=zt,de={x:(ie.x-Yt.x())/wr,y:(ie.y-Yt.y())/wr};ur={x:ie.x-de.x*yr,y:ie.y-de.y*yr}}if(at){const fe=zt.x-Oe.x,me=zt.y-Oe.y;Be?ur={x:ur.x+fe,y:ur.y+me}:ur={x:Ur.x+fe,y:Ur.y+me}}Ht||(Ht=requestAnimationFrame(()=>{Yt.scale({x:yr,y:yr}),Yt.position(ur),Yt.batchDraw(),Ht=null})),Be&&at?(De("zoom+pan"),jt(!0)):Be?(De("zoom"),jt(!0)):at&&De("pan");const we=Date.now()-(Ye||Date.now());le(Be&&at?"zoom+pan":Be?"zoom":"pan",we),console.log("🎨 Combined gesture",{doZoom:Be,doPan:at,scale:yr.toFixed(2),pos:ur})},be=Be=>{if(!Be||typeof Be.name!="function")return!1;if((Be.name()||"").includes("textbox-"))return!0;const dt=Be.getParent&&Be.getParent();return dt&&typeof dt.name=="function"&&(dt.name()||"").includes("textbox-")},Ve=Be=>{const at=Be.evt.touches,dt=Be.target;if(be(dt)){if(s==="pan"&&y.current)try{y.current.draggable(!1),ge.current=!0}catch{}return}at.length===2?(Be.evt.preventDefault(),bt(!0),De(null),Me(hr(at)),He(sr(at)),te(!1),pt(Date.now())):at.length===1&&(bt(!1),De(null),Pe(Be))},Ct=Be=>{const at=Be.evt.touches,dt=Be.target;if(!be(dt))if(at.length===2&&et){Be.evt.preventDefault();const zt=y.current,Yt=hr(at),wr=sr(at);if(Fe&&Oe&&zt&&Yt>Nr.minTouchDistance){const Ur=Math.abs(Yt/Fe-1),yr=Math.sqrt(Math.pow(wr.x-Oe.x,2)+Math.pow(wr.y-Oe.y,2)),ur=he(),oe=Nr.scaleDelta-ur,we=Nr.centerDelta-ur*10,fe=Ur>oe,me=yr>we;(fe||me)&&(pe(fe,me,Yt,wr),fe&&me?Er("zoom+pan"):fe?Er("zoom"):me&&Er("pan")),console.log("🎨 Gesture Debug",{scaleDelta:Ur.toFixed(3),centerDelta:yr.toFixed(1),doZoom:fe,doPan:me,hysteresis:ur.toFixed(3),adjustedScaleDelta:oe.toFixed(3),adjustedCenterDelta:we.toFixed(1),gestureHistory:Rt.slice(-3)})}Me(Yt),He(wr)}else at.length===1&&!et&&(Be.evt.preventDefault(),ce())},Et=Be=>{const at=Be.evt.touches,dt=Be.target;be(dt)||(at.length===0?(ye(Be),fr(),jt(!1)):at.length===1&&(bt(!1),De(null),Me(null),He(null),jt(!1)))};return o.jsx("div",{className:"relative w-full block sm:flex sm:justify-center",children:o.jsx("div",{className:"w-full max-w-full block sm:flex sm:justify-center",children:o.jsxs("div",{className:"relative",style:{border:f&&(w.width<window.innerWidth-40||w.height<window.innerHeight-40)?"2px solid #000000":"none",borderRadius:"8px",overflow:"hidden"},children:[o.jsx("div",{ref:O,className:"w-full h-full",style:{touchAction:"manipulation"},children:o.jsx(sf,{ref:y,width:w.width,height:w.height,scaleX:f?w.zoom:l,scaleY:f?w.zoom:l,onMouseDown:Pe,onMousemove:ce,onMouseup:ye,onTouchStart:Ve,onTouchMove:Ct,onTouchEnd:Et,onWheel:g||(()=>{}),onDragStart:()=>{console.log("🎯 Drag started"),s==="pan"&&v(!0)},onDragEnd:()=>{if(console.log("🎯 Drag ended"),s==="pan"&&(v(!1),p)){const Be=y.current,at=O.current,dt=at?.clientWidth||w.width,zt=at?.clientHeight||w.height,Yt=b.width*Be.scaleX(),wr=b.height*Be.scaleY(),Ur=Be.x(),yr=Be.y();(Ur>dt||Ur<-Yt||yr>zt||yr<-wr)&&p(Be)}},draggable:s==="pan"&&l>.25,className:`border-0 rounded-none shadow-none sm:border sm:rounded-lg sm:shadow-sm ${s==="pan"?"cursor-grab":d?"cursor-grabbing":"cursor-crosshair"}`,style:{width:"100%",height:"auto"},onLoad:()=>{console.log("�� DrawingTestStudent - Stage loaded with dimensions:",w.width,"x",w.height),console.log("�� DrawingTestStudent - Canvas size:",b.width,"x",b.height),console.log("�� DrawingTestStudent - Current zoom level:",l),console.log("�� DrawingTestStudent - Effective display size:",Math.round(b.width*l),"x",Math.round(b.height*l)),console.log("�� DrawingTestStudent - Total pixels displayed:",Math.round(b.width*l*b.height*l))},children:o.jsxs(nf,{children:[o.jsx(ca,{x:0,y:0,width:b.width,height:b.height,fill:"white",name:"canvas-bg"}),r.map((Be,at)=>{if(Array.isArray(Be)){const dt=Be[0]?.tool==="eraser";return o.jsx(Ta,{points:Be.flatMap(zt=>[zt.x,zt.y]),stroke:dt?"black":Be[0]?.color||"#000000",strokeWidth:dt?(Be[0]?.thickness||2)*7:Be[0]?.thickness||2,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:dt?"destination-out":"source-over"},at)}else{if(Be.type==="line")return o.jsx(Ta,{points:[Be.startX,Be.startY,Be.endX,Be.endY],stroke:Be.color,strokeWidth:Be.thickness,lineCap:"round"},at);if(Be.type==="rectangle"){const dt=Math.abs(Be.endX-Be.startX),zt=Math.abs(Be.endY-Be.startY),Yt=Math.min(Be.startX,Be.endX),wr=Math.min(Be.startY,Be.endY);return o.jsx(ca,{x:Yt,y:wr,width:dt,height:zt,stroke:Be.color,strokeWidth:Be.thickness,fill:"transparent"},at)}else if(Be.type==="circle"){const dt=Math.sqrt(Math.pow(Be.endX-Be.startX,2)+Math.pow(Be.endY-Be.startY,2))/2,zt=(Be.startX+Be.endX)/2,Yt=(Be.startY+Be.endY)/2;return o.jsx(Ou,{x:zt,y:Yt,radius:dt,stroke:Be.color,strokeWidth:Be.thickness,fill:"transparent"},at)}}return null}),k.map(Be=>o.jsx(WW,{...Be,isSelected:T===Be.id,onSelect:P,onUpdate:R,onDelete:N},Be.id)),s==="pencil"&&o.jsx(Ta,{points:se.flatMap(Be=>[Be.x,Be.y]),stroke:a,strokeWidth:i,tension:.5,lineCap:"round",lineJoin:"round"}),s==="eraser"&&o.jsx(Ta,{points:se.flatMap(Be=>[Be.x,Be.y]),stroke:"black",strokeWidth:i*7,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:"destination-out"}),G&&G.type==="line"&&o.jsx(Ta,{points:[G.startX,G.startY,G.endX,G.endY],stroke:G.color,strokeWidth:G.thickness,lineCap:"round"}),G&&G.type==="rectangle"&&o.jsx(ca,{x:Math.min(G.startX,G.endX),y:Math.min(G.startY,G.endY),width:Math.abs(G.endX-G.startX),height:Math.abs(G.endY-G.startY),stroke:G.color,strokeWidth:G.thickness,fill:"transparent"}),G&&G.type==="circle"&&o.jsx(Ou,{x:(G.startX+G.endX)/2,y:(G.startY+G.endY)/2,radius:Math.sqrt(Math.pow(G.endX-G.startX,2)+Math.pow(G.endY-G.startY,2))/2,stroke:G.color,strokeWidth:G.thickness,fill:"transparent"}),s==="eraser"&&o.jsx(Ou,{x:Y.x,y:Y.y,radius:i*7/2,stroke:"#666666",strokeWidth:2,fill:"rgba(102, 102, 102, 0.2)",dash:[5,5],listening:!1}),s==="pencil"&&o.jsx(Ta,{points:[Y.x-10,Y.y,Y.x+10,Y.y,Y.x,Y.y-10,Y.x,Y.y+10],stroke:"#666666",strokeWidth:1,listening:!1}),s==="line"&&o.jsx(Ta,{points:[Y.x-10,Y.y,Y.x+10,Y.y,Y.x,Y.y-10,Y.x,Y.y+10],stroke:"#666666",strokeWidth:1,listening:!1}),s==="rectangle"&&o.jsx(Ta,{points:[Y.x-10,Y.y,Y.x+10,Y.y,Y.x,Y.y-10,Y.x,Y.y+10],stroke:"#666666",strokeWidth:1,listening:!1}),s==="circle"&&o.jsx(Ta,{points:[Y.x-10,Y.y,Y.x+10,Y.y,Y.x,Y.y-10,Y.x,Y.y+10],stroke:"#666666",strokeWidth:1,listening:!1})]})})}),A&&M&&o.jsx(zW,{x:M.x,y:M.y,width:M.width,height:M.height,initialText:M.text,onSave:Be=>{R(M.id,{text:Be}),H(!1),Q(null)},onCancel:()=>{H(!1),Q(null)}}),o.jsxs("div",{className:"absolute top-2 right-2 flex flex-col gap-1",children:[o.jsx("button",{onClick:()=>{const Be=y.current,at=Be.scaleX(),dt=E?.max_canvas_width||1536,zt=E?.max_canvas_height||2048,Yt=dt/b.width,wr=zt/b.height,Ur=Math.min(Yt,wr,5),yr=Math.min(Ur,Be.scaleX()*1.2);Be.scale({x:yr,y:yr}),Be.batchDraw(),console.log("�� DrawingTestStudent - Zoom In button:",at.toFixed(2),"->",yr.toFixed(2)),console.log("�� DrawingTestStudent - New effective size:",Math.round(b.width*yr),"x",Math.round(b.height*yr)),console.log("�� DrawingTestStudent - New resolution:",Math.round(b.width*yr*b.height*yr),"pixels"),c(yr)},className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center text-gray-600 font-bold",title:"Zoom In",children:"+"}),o.jsx("button",{onClick:()=>{const Be=y.current,at=Be.scaleX(),dt=Math.max(.25,Be.scaleX()*.8);Be.scale({x:dt,y:dt}),Be.batchDraw(),console.log("�� DrawingTestStudent - Zoom Out button:",at.toFixed(2),"->",dt.toFixed(2)),console.log("�� DrawingTestStudent - New effective size:",Math.round(b.width*dt),"x",Math.round(b.height*dt)),console.log("�� DrawingTestStudent - New resolution:",Math.round(b.width*dt*b.height*dt),"pixels"),c(dt)},className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center text-gray-600 font-bold",title:"Zoom Out",children:"−"}),o.jsx("button",{onClick:()=>{const Be=y.current,at=Be.scaleX();Be.scale({x:1,y:1}),Be.position({x:0,y:0}),Be.batchDraw(),console.log("�� DrawingTestStudent - Reset zoom:",at.toFixed(2),"-> 1.00"),console.log("�� DrawingTestStudent - Reset effective size:",b.width,"x",b.height),console.log("�� DrawingTestStudent - Reset resolution:",b.width*b.height,"pixels"),c(1)},className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center text-gray-600 text-xs",title:"Reset Zoom",children:"1:1"})]}),o.jsxs("div",{className:"absolute bottom-2 left-2 bg-white border border-gray-300 rounded px-2 py-1 text-xs text-gray-600 shadow-sm",children:[Math.round(l*100),"%"]})]})})})},GW=({content:e})=>{if(!e)return o.jsx("div",{className:"text-gray-500 italic",children:"No instructions provided"});const t=n=>{if(!n)return"";if(n.type==="text"){let s=n.text||"";if(n.format&&(n.format&1&&(s=`<strong>${s}</strong>`),n.format&2&&(s=`<em>${s}</em>`),n.format&8&&(s=`<u>${s}</u>`),n.format&16&&(s=`<s>${s}</s>`)),n.style){const a=n.style.match(/color:\s*([^;]+)/);a&&(s=`<span style="color: ${a[1].trim()}">${s}</span>`)}if(n.textStyle){const a=n.textStyle.match(/color:\s*([^;]+)/);a&&(s=`<span style="color: ${a[1].trim()}">${s}</span>`)}return s}if(n.type==="paragraph"){const s=n.children?n.children.map(t).join(""):"";let a="text-left";return n.format&&(n.format==="center"?a="text-center":n.format==="right"?a="text-right":n.format==="left"&&(a="text-left")),`<p class="${a}">${s}</p>`}if(n.type==="heading"){const s=n.tag||"h1",a=n.children?n.children.map(t).join(""):"";return`<${s}>${a}</${s}>`}if(n.type==="list"){const s=n.listType==="bullet"?"ul":"ol",a=n.children?n.children.map(i=>{if(i.type==="listitem"){const l=i.children?i.children.map(t).join(""):"";let c="margin: 4px 0; display: list-item;";return i.format&&(i.format==="center"?c+=" text-align: center;":i.format==="right"?c+=" text-align: right;":i.format==="left"&&(c+=" text-align: left;")),`<li style="${c}">${l}</li>`}return""}).join(""):"";return`<${s} style="margin: 8px 0; padding-left: 20px; list-style-type: ${n.listType==="bullet"?"disc":"decimal"}; display: block;">${a}</${s}>`}return n.children?n.children.map(t).join(""):""};let r=e;if(typeof e=="string"&&e.startsWith("{"))try{const n=JSON.parse(e);n.text?r=n.text:n.content?r=n.content:n.root&&n.root.children&&(r=n.root.children.map(t).join(""))}catch(n){console.log("Failed to parse Lexical content:",n)}return o.jsx("div",{className:"max-w-none rich-text-content",style:{lineHeight:"1.6",fontSize:"14px"},dangerouslySetInnerHTML:{__html:r}})},VW=({question:e,questionIndex:t,studentAnswer:r,onAnswerChange:n,mode:s,testId:a,testType:i})=>{da();const[l,c]=C.useState([]),[d,f]=C.useState(!0),[p,g]=C.useState("pencil"),[y,v]=C.useState("#000000"),[w,b]=C.useState(2),[E,k]=C.useState([]),[_,T]=C.useState(-1),[j,P]=C.useState({width:600,height:800}),[R,N]=C.useState(1),[A,M]=C.useState(!1),[H,Q]=C.useState(!1),[Z,ae]=C.useState(!1),[te,se]=C.useState([]),[L,G]=C.useState(null),[I,z]=C.useState(!1),[V,O]=C.useState(null),W=_>0,q=_<E.length-1,[Y,ee]=C.useState(!1),X=C.useRef(null),ne=C.useRef(null),[ge,_e]=C.useState({width:600,height:800}),Pe=C.useRef(!1),[ce,ye]=C.useState(.25),Fe=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#008000","#808080","#FFC0CB","#A52A2A","#000080"];C.useEffect(()=>{const Xe=()=>{ae(window.innerWidth>=1024)};return Xe(),window.addEventListener("resize",Xe),()=>window.removeEventListener("resize",Xe)},[]),C.useEffect(()=>{if(e){const Xe=e.max_canvas_width||1536,Ye=e.max_canvas_height||2048,pt=e.canvas_width||600,mt=e.canvas_height||800;if(P({width:Xe,height:Ye}),Pe.current)console.log("🎨 DrawingTestStudent - Preserving user zoom:",R.toFixed(2));else{N(1),Pe.current=!0;const Ht=(pt-Xe*1)/2,Qt=(mt-Ye*1)/2;if(!isNaN(Ht)&&!isNaN(Qt)&&X.current){const nr={x:Ht,y:Qt};X.current.position(nr),X.current.batchDraw()}console.log("🎨 DrawingTestStudent - Canvas size set:",Xe,"x",Ye),console.log("🎨 DrawingTestStudent - Viewport size:",pt,"x",mt),console.log("🎨 DrawingTestStudent - Initial zoom:",1 .toFixed(2)),console.log("🎨 DrawingTestStudent - Image resolution:",Xe*Ye,"pixels"),console.log("🎨 DrawingTestStudent - Aspect ratio:",(Xe/Ye).toFixed(2))}if(r&&typeof r=="string")try{const _t=JSON.parse(r);_t.lines?c(_t.lines):c(_t),_t.textBoxes&&se(_t.textBoxes)}catch{console.log("No valid drawing data found")}f(!1)}},[e,r]),C.useEffect(()=>{const Xe=()=>{const Ye=ne.current;if(!Ye)return;const pt=Ye.clientWidth||1,mt=Ye.clientHeight||1,_t=Math.min(pt/(j.width||1),mt/(j.height||1));ye(Math.min(_t,1))};return Xe(),window.addEventListener("resize",Xe),()=>window.removeEventListener("resize",Xe)},[j.width,j.height,Y]);const Me=Xe=>{c(Xe);const Ye={lines:Xe,textBoxes:te};n(e.question_id,JSON.stringify(Ye)),Oe(Xe,te)},Oe=(Xe,Ye=te)=>{const pt=E.slice(0,_+1);pt.push({lines:[...Xe],textBoxes:[...Ye]}),k(pt),T(pt.length-1)},He=()=>{if(W){const Xe=_-1,Ye=E[Xe];if(Ye&&typeof Ye=="object"&&Ye.lines){c([...Ye.lines]),se([...Ye.textBoxes]);const pt={lines:Ye.lines,textBoxes:Ye.textBoxes};n(e.question_id,JSON.stringify(pt))}else{const pt=Ye||[];c([...pt]),n(e.question_id,JSON.stringify(pt))}T(Xe)}},It=()=>{if(q){const Xe=_+1,Ye=E[Xe];if(Ye&&typeof Ye=="object"&&Ye.lines){c([...Ye.lines]),se([...Ye.textBoxes]);const pt={lines:Ye.lines,textBoxes:Ye.textBoxes};n(e.question_id,JSON.stringify(pt))}else{const pt=Ye||[];c([...pt]),n(e.question_id,JSON.stringify(pt))}T(Xe)}},Ze=()=>{c([]),se([]),G(null),n(e.question_id,"")},Le=Xe=>{G(Xe)},De=(Xe,Ye)=>{const pt=te.map(_t=>_t.id===Xe?{..._t,...Ye}:_t);se(pt),Oe(l,pt);const mt={lines:l,textBoxes:pt};if(n(e.question_id,JSON.stringify(mt)),Ye.isEditing){const _t=te.find(Ht=>Ht.id===Xe);O(_t),z(!0)}},et=Xe=>{const Ye=te.filter(mt=>mt.id!==Xe);se(Ye),L===Xe&&G(null),Oe(l,Ye);const pt={lines:l,textBoxes:Ye};n(e.question_id,JSON.stringify(pt))},bt=()=>{if(Y){const pt=e?.canvas_width||600,mt=e?.canvas_height||800,_t=window.innerWidth-40,Ht=window.innerHeight-40,Qt=_t/pt,nr=Ht/mt,Nr=Math.min(Qt,nr,1);return{width:pt,height:mt,zoom:Nr}}const Xe=e?.canvas_width||600,Ye=e?.canvas_height||800;return{width:Xe,height:Ye,zoom:1}};C.useEffect(()=>{const Xe=()=>{_e(bt())};return Xe(),window.addEventListener("resize",Xe),()=>window.removeEventListener("resize",Xe)},[Y,j]);const ut=Xe=>{Xe.evt.preventDefault();const Ye=X.current,pt=Ye.scaleX(),mt=Ye.getPointerPosition(),_t={x:(mt.x-Ye.x())/pt,y:(mt.y-Ye.y())/pt},Ht=Xe.evt.deltaY>0?pt*.9:pt*1.1,Qt=e?.max_canvas_width||1536,nr=e?.max_canvas_height||2048,Nr=Qt/j.width,fr=nr/j.height,hr=Math.min(Nr,fr,1),sr=Math.max(ce,Math.min(hr,Ht)),Er={x:mt.x-_t.x*sr,y:mt.y-_t.y*sr};if(sr<=ce&&ne.current){const he=ne.current.clientWidth||1,le=ne.current.clientHeight||1;Er.x=(he-j.width*sr)/2,Er.y=(le-j.height*sr)/2}Ye.scale({x:sr,y:sr}),Ye.position(Er),Ye.batchDraw(),console.log("🎨 DrawingTestStudent - Wheel zoom:",pt.toFixed(2),"->",sr.toFixed(2)),console.log("🎨 DrawingTestStudent - New effective size:",Math.round(j.width*sr),"x",Math.round(j.height*sr)),console.log("🎨 DrawingTestStudent - New resolution:",Math.round(j.width*sr*j.height*sr),"pixels"),N(sr),Pe.current=!0},jt=Xe=>{const Ye=Xe.scaleX(),pt=ne.current,mt=pt?.clientWidth||ge.width,_t=pt?.clientHeight||ge.height,Ht=j.width*Ye,Qt=j.height*Ye;if(Ye<=ce){const pe=(mt-Ht)/2,be=(_t-Qt)/2;Xe.position({x:pe,y:be}),Xe.batchDraw();return}if(Ht<=mt&&Qt<=_t){const pe=(mt-Ht)/2,be=(_t-Qt)/2;Xe.position({x:pe,y:be}),Xe.batchDraw();return}const nr=Math.max(0,Ht-mt),Nr=Math.max(0,Qt-_t),fr=-nr,hr=-Nr,sr=Xe.x(),Er=Xe.y(),he=Math.max(fr,Math.min(nr,sr)),le=Math.max(hr,Math.min(Nr,Er));(he!==sr||le!==Er)&&(Xe.position({x:he,y:le}),Xe.batchDraw())},Rt=()=>{if(Y)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();else{const Xe=document.querySelector(".drawing-canvas-container");Xe&&(Xe.requestFullscreen?Xe.requestFullscreen():Xe.webkitRequestFullscreen?Xe.webkitRequestFullscreen():Xe.msRequestFullscreen&&Xe.msRequestFullscreen())}};return C.useEffect(()=>{const Xe=()=>{ee(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",Xe),document.addEventListener("webkitfullscreenchange",Xe),document.addEventListener("msfullscreenchange",Xe),()=>{document.removeEventListener("fullscreenchange",Xe),document.removeEventListener("webkitfullscreenchange",Xe),document.removeEventListener("msfullscreenchange",Xe)}},[]),C.useEffect(()=>()=>{X.current&&X.current.stop()},[]),d?o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsx(Br,{})}):e?o.jsxs("div",{className:`drawing-question w-full max-w-full mx-0 p-0 sm:p-2 ${Y?"fixed inset-0 z-50 bg-white overflow-y-auto":""}`,children:[!Y&&o.jsx("div",{className:"mb-4",children:o.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Question ",t+1]})}),!Y&&e.question_json&&e.question_json.trim()&&o.jsxs("div",{className:"mb-2 p-2 bg-gray-50 border border-gray-200 rounded-lg",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Task:"}),o.jsx("div",{className:"text-gray-700",children:o.jsx(GW,{content:e.question_json})})]}),!Y&&o.jsx(kt,{className:"p-1 sm:p-2 mb-2",children:o.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"hidden sm:block text-sm text-gray-700",children:"Tool:"}),o.jsxs("div",{className:"flex flex-nowrap sm:flex-wrap gap-1 overflow-x-auto",children:[o.jsx("button",{onClick:()=>g("pencil"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="pencil"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Pencil (Freehand drawing)",children:"✏️"}),o.jsx("button",{onClick:()=>g("line"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="line"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Line",children:"📏"}),o.jsx("button",{onClick:()=>g("rectangle"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="rectangle"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Rectangle",children:"⬜"}),o.jsx("button",{onClick:()=>g("circle"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="circle"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Circle",children:"⭕"}),o.jsx("button",{onClick:()=>g("eraser"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="eraser"?"bg-red-500 text-white border-red-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Eraser",children:"🧽"}),o.jsx("button",{onClick:()=>g("text"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="text"?"bg-green-500 text-white border-green-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Text Box",children:"📝"}),o.jsx("button",{onClick:()=>g("pan"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="pan"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Pan (Move canvas)",children:"✋"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"text-sm text-gray-700",children:"History:"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:He,disabled:!W,className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${W?"bg-white text-gray-700 border-gray-300 hover:bg-gray-50":"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed"}`,title:"Undo (Ctrl+Z)",children:"↶"}),o.jsx("button",{onClick:It,disabled:!q,className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${q?"bg-white text-gray-700 border-gray-300 hover:bg-gray-50":"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed"}`,title:"Redo (Ctrl+Y)",children:"↷"})]})]}),o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>M(!A),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[o.jsx("div",{className:"w-6 h-6 rounded border border-gray-300",style:{backgroundColor:y}}),o.jsx("span",{className:"text-xs sm:text-sm text-gray-700",children:"Color"})]}),A&&o.jsx("div",{className:"absolute top-full left-0 mt-2 p-4 bg-white border border-gray-300 rounded-lg shadow-lg z-30 min-w-max",children:o.jsx("div",{className:"flex flex-wrap gap-2 max-w-xs",children:Fe.map(Xe=>o.jsx("button",{onClick:()=>{v(Xe),M(!1)},className:`w-10 h-10 rounded border-2 hover:scale-110 transition-transform flex-shrink-0 ${y===Xe?"border-gray-800":"border-gray-300"}`,style:{backgroundColor:Xe},title:Xe},Xe))})})]}),o.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[o.jsx("label",{className:"text-xs sm:text-sm text-gray-700",children:"Thickness:"}),o.jsx("input",{type:"range",min:"1",max:"10",value:w,onChange:Xe=>b(parseInt(Xe.target.value)),className:"w-16 sm:w-20"}),o.jsxs("span",{className:"text-xs text-gray-500 w-6 sm:w-8",children:[w,"px"]})]}),o.jsx(rt,{onClick:Ze,variant:"secondary",size:"sm",children:"Clear"})]})}),o.jsx(kt,{paddingClass:"p-0 sm:p-2",children:o.jsxs("div",{className:"w-full drawing-canvas-container relative p-0 m-0",children:[o.jsx(HW,{width:j.width,height:j.height,lines:l,onDrawingChange:Me,currentTool:p,currentColor:y,currentThickness:w,zoom:R,onZoomChange:N,isPanning:H,isFullscreen:Y,constrainPanPosition:jt,handleWheel:ut,stageRef:X,setIsPanning:Q,responsiveDimensions:ge,canvasSize:j,question:e,textBoxes:te,setTextBoxes:se,selectedTextBox:L,setSelectedTextBox:G,handleTextBoxSelect:Le,handleTextBoxUpdate:De,handleTextBoxDelete:et,isEditingText:I,editingTextBox:V,setIsEditingText:z,setEditingTextBox:O,setCurrentTool:g}),o.jsx("button",{onClick:Rt,className:"absolute top-2 left-2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-lg transition-all duration-200 z-10",title:Y?"Exit Fullscreen":"Enter Fullscreen",children:Y?o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"})}):o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})})})]})})]}):o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsx("div",{className:"text-center",children:o.jsx("p",{className:"text-gray-500",children:"No drawing question data available"})})})},$w={enhanceUserData(e,t){const r={id:e.id||e.student_id||e.teacher_id,username:e.username||e.student_id,name:e.name||e.first_name,surname:e.surname||e.last_name,nickname:e.nickname,role:t,is_active:e.is_active!==void 0?e.is_active:!0,created_at:e.created_at,updated_at:e.updated_at};switch(t){case"student":return{...r,student_id:e.student_id,grade:e.grade,class:e.class,number:e.number,subjects:e.subjects||[]};case"teacher":return{...r,teacher_id:e.teacher_id,first_name:e.first_name,last_name:e.last_name,email:e.email,phone:e.phone,subjects:e.subjects||[]};case"admin":return{...r,admin_id:e.admin_id,permissions:e.permissions||["all"]};default:return r}},async studentLogin(e){console.log("Trying student login...");try{const t=await fetch("/.netlify/functions/student-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:e.username,password:e.password})}),r=await t.json();if(t.ok&&r.success)return{success:!0,token:r.accessToken,refreshToken:r.refreshToken,data:r.student,role:"student",response:t};throw new Error(r.message||"Student login failed")}catch(t){throw console.error("Student login error:",t),new Error(t.message||"Student login failed")}},async teacherLogin(e){console.log("Trying teacher login...");try{const t=await fetch("/.netlify/functions/teacher-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(t.ok&&r.success)return{success:!0,token:r.accessToken,refreshToken:r.refreshToken,data:r.teacher,role:"teacher",response:t};throw new Error(r.message||"Teacher login failed")}catch(t){throw console.error("Teacher login error:",t),new Error(t.message||"Teacher login failed")}},async adminLogin(e){console.log("Trying admin login...");try{const t=await fetch("/.netlify/functions/admin-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(t.ok&&r.success)return{success:!0,token:r.accessToken,refreshToken:r.refreshToken,data:r.admin,role:"admin",response:t};throw new Error(r.message||"Admin login failed")}catch(t){throw console.error("Admin login error:",t),new Error(t.message||"Admin login failed")}},async login(e){const{username:t,password:r}=e;console.log("Attempting login with:",t,r);try{if(t==="admin"){const l=await this.adminLogin(e),c=await l.json();return await this.handleLoginResponse(l,"admin",c)}const n=await this.teacherLogin(e),s=await n.json();if(n.ok&&s.success)return await this.handleLoginResponse(n,"teacher",s);const a=await this.studentLogin(e),i=await a.json();return a.ok&&i.success?await this.handleLoginResponse(a,"student",i):(this.handleLoginFailure(),{success:!1,message:"Login failed. Please check your credentials and try again."})}catch(n){return console.error("Login error:",n),this.handleLoginFailure(),{success:!1,message:n.message||"Login failed"}}},async handleLoginResponse(e,t,r){if(e.ok&&r.success){if(!window.tokenManager||!window.roleBasedLoader)return console.error("[ERROR] JWT system not available during login response handling"),this.handleLoginFailure(),{success:!1,message:"JWT system not available"};if(r.accessToken&&r.role)try{window.tokenManager.setTokens(r.accessToken,r.role),window.roleBasedLoader.setupAccessAfterLogin()}catch(n){return console.error("[ERROR] Failed to initialize JWT system:",n),this.handleLoginFailure(),{success:!1,message:"Failed to initialize JWT system"}}return this.resetLoginForm(),await this.handlePostLoginActions(r,t),{success:!0,data:r,role:t}}return{success:!1,message:"Login failed"}},async handlePostLoginActions(e,t){console.log(`Handling post-login actions for role: ${t}`);try{switch(t){case"student":e.student&&(this.populateStudentInfo(e.student),window.loadStudentData&&await window.loadStudentData());break;case"teacher":e.teacher&&(this.populateTeacherInfo(e.teacher),window.loadTeacherData&&await window.loadTeacherData());break;case"admin":e.admin&&window.loadAdminData&&await window.loadAdminData();break;default:console.warn(`Unknown role for post-login actions: ${t}`)}}catch(r){console.error("Error in post-login actions:",r)}},handleLoginFailure(){console.log("All login attempts failed"),this.resetLoginForm(),window.showNotification&&window.showNotification("Login failed. Please check your credentials and try again.","error")},resetLoginForm(){const e=document.getElementById("unifiedLoginForm");if(e){e.querySelectorAll("input").forEach(n=>{n.disabled=!1,n.style.opacity="1",n.style.cursor="text",n.removeAttribute("readonly"),n.style.pointerEvents="auto"});const r=e.querySelector('button[type="submit"]');r&&(r.disabled=!1,r.style.opacity="1",r.style.cursor="pointer",r.style.pointerEvents="auto",r.innerHTML="Login"),e.classList.remove("test-submitting","disabled"),e.style.pointerEvents="auto",console.log("Login form reset successfully - all inputs re-enabled")}},async logout(){console.log("🚪 Logout initiated...");try{return window.tokenManager&&window.tokenManager.logout(),window.roleBasedLoader&&window.roleBasedLoader.reloadRoleAccess(),window.clearTestLocalStorage&&window.clearTestLocalStorage(),this.resetInterfaceAfterSessionClear(),console.log("✅ Logout completed - user session cleared, test data cleared, and interface reset"),{success:!0}}catch(e){return console.error("Logout error:",e),this.resetInterfaceAfterSessionClear(),{success:!0}}},resetInterfaceAfterSessionClear(){try{window.forceLogout=!0,window.preventAutoLogin=!0,window.isClearingSession=!0,window.forceLogoutComplete=!0,document.querySelectorAll(".section").forEach(s=>{s.classList.remove("active"),s.style.display="none",s.style.visibility="hidden",s.style.opacity="0"}),document.querySelectorAll('[id$="-cabinet"], [id$="-container"], [id*="cabinet"], [id*="container"]').forEach(s=>{s.id&&s.id!=="login-section"&&(s.classList.remove("active"),s.style.display="none",s.style.visibility="hidden",s.style.opacity="0")}),document.body.classList.remove("student-logged-in","teacher-logged-in","admin-logged-in"),document.body.classList.add("force-logout");const r=document.getElementById("login-section");r&&(r.classList.add("active"),r.style.display="block",r.style.visibility="visible",r.style.opacity="1"),document.querySelectorAll("input, select, textarea").forEach(s=>{s.type!=="hidden"&&(s.value="",s.checked=!1)}),console.log("✅ Interface reset to login state")}catch(e){console.error("Error resetting interface:",e),localStorage.clear(),sessionStorage.clear(),window.location.reload()}},async changePassword(e){try{return{success:!0,message:(await os.post("/auth/change-password",{currentPassword:e.currentPassword,newPassword:e.newPassword,confirmPassword:e.confirmPassword})).data.message}}catch(t){throw new Error(t.response?.data?.message||"Password change failed")}},async verifyToken(e){try{const t=await os.get("/auth/verify",{headers:{Authorization:`Bearer ${e}`}});return{success:!0,valid:t.data.valid,user:t.data.user}}catch(t){return{success:!1,valid:!1,error:t.message}}},async refreshToken(e){try{const t=await os.post("/auth/refresh",{refreshToken:e});return{success:!0,token:t.data.token,refreshToken:t.data.refreshToken}}catch(t){throw new Error(t.response?.data?.message||"Token refresh failed")}},async getUserProfile(){try{return{success:!0,user:(await os.get("/auth/profile")).data.user}}catch(e){throw new Error(e.response?.data?.message||"Failed to get user profile")}},async updateUserProfile(e){try{return{success:!0,user:(await os.put("/auth/profile",e)).data.user}}catch(t){throw new Error(t.response?.data?.message||"Failed to update user profile")}},populateStudentInfo(e){console.log("=== populateStudentInfo called ==="),console.log("Student object:",e);const t=document.getElementById("studentName");if(t){const s=`${e?.name||""} ${e?.surname||""}`.trim();t.textContent=s,console.log("Set student name to:",s)}const r=document.getElementById("studentGrade");r&&(r.textContent=e?.grade||"",console.log("Set student grade to:",e?.grade));const n=document.getElementById("studentClass");n&&(n.textContent=e?.class||"",console.log("Set student class to:",e?.class)),console.log("Student info populated successfully")},populateTeacherInfo(e){console.log("=== populateTeacherInfo called ==="),console.log("Teacher object:",e);const t=document.getElementById("teacherName");if(t){const n=`${e?.name||""} ${e?.surname||""}`.trim();t.textContent=n,console.log("Set teacher name to:",n)}const r=document.getElementById("teacherUsername");r&&(r.textContent=e?.username||"",console.log("Set teacher username to:",e?.username)),console.log("Teacher info populated successfully")},getCurrentTeacherId(){try{if(!window.tokenManager||!window.tokenManager.isAuthenticated())return console.warn("[WARN] No valid JWT token found for teacher"),null;const e=window.tokenManager.decodeToken(window.tokenManager.getAccessToken());return e&&e.sub?e.role==="teacher"?(console.log(`[DEBUG] Found teacher ID from JWT: ${e.sub}`),e.sub):(console.warn(`[WARN] Unsupported role for teacher function: ${e.role}`),null):(console.warn("[WARN] No teacher ID found in JWT token"),null)}catch(e){return console.error("[ERROR] Error getting current teacher ID from JWT:",e),null}},getCurrentAdmin(){const e=window.tokenManager?.getToken();if(!e)return null;const t=window.tokenManager.decodeToken(e);if(!t||t.role!=="admin")throw new Error("getCurrentAdmin() called by non-admin user");return{id:t.sub,username:t.username,role:t.role}},getCurrentTeacherUsername(){try{if(!window.tokenManager||!window.tokenManager.isAuthenticated())return console.warn("[WARN] No valid JWT token found for teacher"),null;const e=window.tokenManager.decodeToken(window.tokenManager.getAccessToken());return e&&e.username?(console.log(`[DEBUG] Found teacher username from JWT: ${e.username}`),e.username):(console.warn("[WARN] No teacher username found in JWT token"),null)}catch(e){return console.error("[ERROR] Error getting current teacher username from JWT:",e),null}},isAdmin(){try{const e=window.tokenManager?.getToken();if(!e)return!1;const t=window.tokenManager.decodeToken(e);return t&&t.role==="admin"}catch(e){return console.error("[ERROR] Error checking admin status:",e),!1}},getCurrentAdminId(){try{const e=this.getCurrentAdmin();return e?e.id:null}catch(e){return console.error("[ERROR] Error getting admin ID:",e),null}}},KW=()=>{const e=Ii(),{login:t,setUserData:r,isAuthenticated:n,user:s}=Wn(),[a,i]=C.useState({username:"",password:""}),[l,c]=C.useState(!1),[d,f]=C.useState(""),[p,g]=C.useState([]),[y,v]=C.useState(!1);C.useEffect(()=>{w()},[]);const w=C.useCallback(()=>{console.log("Checking for existing JWT session...");try{(window.forceLogout||window.preventAutoLogin)&&(window.forceLogout=!1,window.preventAutoLogin=!1)}catch{}if(window.tokenManager&&window.tokenManager.isAuthenticated()){console.log("JWT session valid, checking user role...");try{const H=window.tokenManager.decodeToken(window.tokenManager.getAccessToken());H&&H.role?console.log("User role from JWT:",H.role):console.log("No valid role found in JWT, showing login")}catch(H){console.error("Error decoding JWT token:",H)}}else console.log("No valid JWT session found, showing login")},[]),b=C.useCallback(async H=>{if(H.preventDefault(),window.forceLogout||window.preventAutoLogin){console.log("⚠️ Login blocked - force logout in progress"),N("Please wait for the logout process to complete.","warning");return}const{username:Q,password:Z}=a;if(!Q||!Z){f("Please enter both username and password");return}c(!0),f("");try{let ae,te;Q==="admin"?(ae=await $w.adminLogin({username:Q,password:Z}),te=fi.ADMIN):/^\d+$/.test(Q)?(ae=await $w.studentLogin({username:Q,password:Z}),te=fi.STUDENT):(ae=await $w.teacherLogin({username:Q,password:Z}),te=fi.TEACHER);let se,L;if(ae.response?(se=ae,L=ae.response):(se=await ae.json(),L=ae),await E(L,te,se)){N("Login successful!","success");try{window.forceLogout=!1,window.preventAutoLogin=!1}catch{}}}catch(ae){console.error("Login error:",ae),f("Invalid username or password")}finally{c(!1)}},[a]),E=C.useCallback(async(H,Q,Z)=>{if(H.ok&&Z.success){if(!window.tokenManager||!window.roleBasedLoader)return console.error("[ERROR] JWT system not available during login response handling"),P(),!1;try{Z.token&&(window.tokenManager.setTokens(Z.token,Q),Z.refreshToken&&window.tokenManager.setRefreshToken(Z.refreshToken),console.log("JWT token stored successfully"));const ae={...Z.data,...Z,role:Q};return r(ae),await k(ae),!0}catch(ae){return console.error("Error handling login response:",ae),P(ae),!1}}else return console.error("Login failed:",Z.error||"Unknown error"),f(Z.error||"Login failed. Please check your credentials."),!1},[t]),k=C.useCallback(async H=>{if(console.log("Handling post-login actions for role:",H.role),y){console.log("⚠️ Post-login already handled, skipping");return}v(!0);try{switch(H.role){case fi.STUDENT:await _(H),e("/student");break;case fi.TEACHER:await T(H),e("/teacher");break;case fi.ADMIN:await j(H),e("/admin");break;default:console.error("Unknown user role:",H.role),P()}}catch(Q){console.error("Error in post-login actions:",Q),P(Q)}},[e,y]);C.useEffect(()=>{n||v(!1)},[n]);const _=C.useCallback(async H=>{console.log("Populating student info:",H)},[]),T=C.useCallback(async H=>{console.log("Populating teacher info:",H)},[]),j=C.useCallback(async H=>{console.log("Populating admin info:",H)},[]),P=C.useCallback((H=null)=>{console.error("Login failure:",H),f("Login failed. Please check your credentials and try again."),R()},[]),R=C.useCallback(()=>{i({username:"",password:""}),f(""),c(!1)},[]),N=C.useCallback((H,Q)=>{const Z={id:Date.now(),message:H,type:Q,timestamp:new Date};g(ae=>[...ae,Z]),setTimeout(()=>{g(ae=>ae.filter(te=>te.id!==Z.id))},Vu.NOTIFICATION_DURATION)},[]),A=C.useCallback(H=>{const{name:Q,value:Z}=H.target;i(ae=>({...ae,[Q]:Z})),d&&f("")},[d]),M=C.useCallback(H=>{H.key==="Enter"&&!l&&b(H)},[b,l]);return o.jsxs(Qe.div,{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[o.jsxs(Qe.div,{className:"w-full max-w-md",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsxs(Qe.div,{className:"text-center mb-8",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.5},children:[o.jsx(Qe.div,{className:"flex justify-center mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.4,duration:.5,type:"spring"},children:o.jsx("img",{src:"/pics/logo_mws.png",alt:"MWS Logo",className:"h-16 w-16 object-contain"})}),o.jsx(Qe.h1,{className:"text-3xl font-bold text-gray-900 mb-2",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5,duration:.3},children:"Mathayom Watsing School"}),o.jsx(Qe.p,{className:"text-lg text-gray-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.3},children:"Test Management System"})]}),o.jsxs(Qe.div,{className:"bg-white rounded-xl shadow-2xl p-8",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.7,duration:.5,type:"spring"},children:[o.jsx(Qe.h2,{className:"text-2xl font-semibold text-gray-900 text-center mb-6",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.8,duration:.3},children:"Login"}),o.jsxs("form",{onSubmit:b,className:"space-y-6",children:[o.jsxs(Qe.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.9,duration:.3},children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Student ID"}),o.jsx(Qe.input,{type:"text",id:"username",name:"username",value:a.username,onChange:A,onKeyDown:M,placeholder:"Enter student ID",required:!0,autoComplete:"username",disabled:l,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed","aria-describedby":d?"error-message":void 0,whileFocus:{scale:1.02},transition:{duration:.2}})]}),o.jsxs(Qe.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:1,duration:.3},children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),o.jsx(Qe.input,{type:"password",id:"password",name:"password",value:a.password,onChange:A,onKeyDown:M,placeholder:"Enter your password",required:!0,autoComplete:"current-password",disabled:l,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed","aria-describedby":d?"error-message":void 0,whileFocus:{scale:1.02},transition:{duration:.2}})]}),o.jsx(ji,{children:d&&o.jsx(Qe.div,{id:"error-message",className:"bg-red-50 border border-red-200 rounded-lg p-3",role:"alert","aria-live":"polite",initial:{opacity:0,height:0,y:-10},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-10},transition:{duration:.3},children:o.jsx("p",{className:"text-sm text-red-600",children:d})})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.1,duration:.3},children:o.jsx(rt,{type:"submit",variant:"primary",size:"lg",disabled:l,className:"w-full",children:l?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",className:"mr-2"}),"Logging in..."]}):"Login"})})]})]}),Vu.DEBUG_MODE]}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:o.jsx(ji,{children:p.map(H=>o.jsx(Qe.div,{initial:{opacity:0,x:300,scale:.8},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:300,scale:.8},transition:{duration:.3,type:"spring"},children:o.jsx(el,{type:H.type,message:H.message,onClose:()=>g(Q=>Q.filter(Z=>Z.id!==H.id))})},H.id))})})]})},Vn={async getStudentData(){console.log("getStudentData called - loading student subjects");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-student-subjects")).json();if(t.success)return console.log("Student data loaded successfully:",t.subjects),t.subjects;throw new Error(t.error||"Failed to load student data")}catch(e){throw console.error("Error loading student data:",e),e}},getStudentSubjects(e){return console.log("getStudentSubjects called with subjects:",e),e.map(t=>({id:t.id||t.subject_id,name:t.subject,grade:t.grade,class:t.class,testResults:t.test_results||[]}))},async getTeacherData(){console.log("getTeacherData called - loading teacher subjects");try{const e=await this.getCurrentTeacherId();if(!e)throw new Error("No valid teacher session found");const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-teacher-subjects")).json();if(r.success)return console.log("Teacher data loaded successfully:",r.subjects),{teacher_id:e,subjects:r.subjects,hasSubjects:r.subjects.length>0};throw new Error(r.error||"Failed to load teacher data")}catch(e){throw console.error("Error loading teacher data:",e),e}},getTeacherSubjects(e){return console.log("getTeacherSubjects called with subjects:",e),e.map(t=>{let r=[];return t.classes&&Array.isArray(t.classes)&&(r=t.classes.map(n=>({grade:n.grade,class:n.class,className:n.class}))),{id:t.subject_id,name:t.subject,classes:r,assignments:t.assignments||[],description:t.description||""}})},getGradeButtons(){return console.log("getGradeButtons called"),["M1","M2","M3","M4","M5","M6"].map(t=>({id:t,name:t,classes:this.generateClassButtons(t)}))},generateClassButtons(e){const t=[];for(let r=1;r<=10;r++)t.push({id:`${e}_${r}`,name:`${e}/${r}`,grade:e,class:r});return t},async getAdminData(){console.log("getAdminData called - loading admin data");try{if(!await this.getCurrentAdminId())throw new Error("No valid admin session found");const[t,r,n]=await Promise.allSettled([this.getAllTeachers(),this.getAllSubjects(),this.getAllUsers()]);return{teachers:t.status==="fulfilled"?t.value:[],subjects:r.status==="fulfilled"?r.value:[],users:n.status==="fulfilled"?n.value:[],loadedAt:new Date().toISOString()}}catch(e){throw console.error("Error loading admin data:",e),e}},async saveTeacherSubjects(e){console.log("saveTeacherSubjects called with subjects:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-teacher-subjects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subjects:e})})).json();if(r.success)return console.log("Teacher subjects saved successfully"),r;throw new Error(r.error||"Failed to save teacher subjects")}catch(t){throw console.error("Error saving teacher subjects:",t),t}},async deleteTeacherSubject(e){console.log("deleteTeacherSubject called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/delete-teacher-subject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("Teacher subject assignment deleted successfully"),r;throw new Error(r.error||"Failed to delete teacher subject assignment")}catch(t){throw console.error("Error deleting teacher subject assignment:",t),t}},async getSubjectsDropdown(){console.log("getSubjectsDropdown called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-all-subjects")).json();if(t.success)return console.log("Subjects dropdown data loaded successfully"),t.subjects.map(r=>({id:r.id,name:r.subject_name,value:r.subject_name}));throw new Error(t.error||"Failed to load subjects dropdown")}catch(e){throw console.error("Error loading subjects dropdown:",e),e}},async getGradesAndClasses(){console.log("getGradesAndClasses called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-teacher-grades-classes")).json();if(t.success)return console.log("Grades and classes loaded successfully"),t.data;throw new Error(t.message||"Failed to load grades and classes")}catch(e){throw console.error("Error loading grades and classes:",e),e}},async saveSubjectClasses(e,t){console.log("saveSubjectClasses called with subjectId:",e,"classes:",t);try{const r=await this.getCurrentTeacherId();if(!r)throw new Error("No valid teacher session found");const s=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-subject-classes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teacher_id:r,subject_id:e,classes:t})})).json();if(s.success)return console.log("Subject classes saved successfully"),s;throw new Error(s.error||"Failed to save subject classes")}catch(r){throw console.error("Error saving subject classes:",r),r}},async getAllSubjects(){console.log("getAllSubjects called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-all-subjects")).json();if(t.success)return console.log("All subjects loaded successfully"),t.subjects.map(r=>({id:r.id,name:r.subject_name,description:r.description||"",created_at:r.created_at,updated_at:r.updated_at}));throw new Error(t.error||"Failed to load all subjects")}catch(e){throw console.error("Error loading all subjects:",e),e}},async getSubjectsForSelection(){console.log("getSubjectsForSelection called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-subjects")).json();if(t.success)return console.log("Subjects for selection loaded successfully"),t.subjects;throw new Error(t.message||"Failed to load subjects for selection")}catch(e){throw console.error("Error loading subjects for selection:",e),e}},async addAcademicYear(e){console.log("addAcademicYear called with data:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/add-academic-year",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("Academic year added successfully"),r;throw new Error(r.error||"Failed to add academic year")}catch(t){throw console.error("Error adding academic year:",t),t}},async getAllUsers(){console.log("getAllUsers called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-all-users")).json();if(t.success)return console.log("All users loaded successfully"),t.users.map(r=>({id:r.id,student_id:r.student_id,grade:r.grade,class:r.class,number:r.number,name:r.name,surname:r.surname,nickname:r.nickname,created_at:r.created_at,updated_at:r.updated_at}));throw new Error(t.error||"Failed to load all users")}catch(e){throw console.error("Error loading all users:",e),e}},async getAllTeachers(){console.log("getAllTeachers called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-all-teachers")).json();if(t.success)return console.log("All teachers loaded successfully"),t.teachers.map(r=>({id:r.id,teacher_id:r.teacher_id,username:r.username,name:r.name,surname:r.surname,email:r.email,created_at:r.created_at,updated_at:r.updated_at}));throw new Error(t.error||"Failed to load all teachers")}catch(e){throw console.error("Error loading all teachers:",e),e}},async createUser(e){console.log("createUser called with data:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/create-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("User created successfully"),r;throw new Error(r.error||"Failed to create user")}catch(t){throw console.error("Error creating user:",t),t}},async updateUser(e,t){console.log("updateUser called with userId:",e,"data:",t);try{const n=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/update-user/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();if(n.success)return console.log("User updated successfully"),n;throw new Error(n.error||"Failed to update user")}catch(r){throw console.error("Error updating user:",r),r}},async createTeacher(e){console.log("createTeacher called with data:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/create-teacher",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("Teacher created successfully"),r;throw new Error(r.error||"Failed to create teacher")}catch(t){throw console.error("Error creating teacher:",t),t}},async updateTeacher(e,t){console.log("updateTeacher called with teacherId:",e,"data:",t);try{const n=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/update-teacher/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();if(n.success)return console.log("Teacher updated successfully"),n;throw new Error(n.error||"Failed to update teacher")}catch(r){throw console.error("Error updating teacher:",r),r}},async updateStudentInfo(e){console.log("updateStudentInfo called with data:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/update-student-info",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("Student info updated successfully"),r;throw new Error(r.error||"Failed to update student info")}catch(t){throw console.error("Error updating student info:",t),t}},async changePassword(e){console.log("changePassword called");let t;if(e.studentId)t="/.netlify/functions/change-student-password";else if(e.username)t="/.netlify/functions/change-teacher-password";else throw new Error("Invalid password data: missing studentId or username");try{const n=await(await window.tokenManager.makeAuthenticatedRequest(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(n.success)return console.log("Password changed successfully"),n;throw new Error(n.error||"Failed to change password")}catch(r){throw console.error("Error changing password:",r),r}},async getCurrentTeacherId(){try{const e=localStorage.getItem("accessToken");if(!e)return null;const t=JSON.parse(atob(e.split(".")[1]));return t.teacher_id||t.sub||null}catch(e){return console.error("Error getting current teacher ID:",e),null}},async getCurrentAdminId(){try{const e=localStorage.getItem("accessToken");if(!e)return null;const t=JSON.parse(atob(e.split(".")[1]));return t.admin_id||t.sub||null}catch(e){return console.error("Error getting current admin ID:",e),null}}},UA=C.createContext(),$A=({children:e})=>{const[t,r]=C.useState(null),[n,s]=C.useState([]),[a,i]=C.useState([]),[l,c]=C.useState([]),[d,f]=C.useState([]),[p,g]=C.useState([]),[y,v]=C.useState([]),[w,b]=C.useState([]),[E,k]=C.useState(!1),[_,T]=C.useState(null),[j,P]=C.useState(!1),[R,N]=C.useState(!1),[A,M]=C.useState(!1),[H,Q]=C.useState(null),[Z,ae]=C.useState(null),[te,se]=C.useState(null),L=C.useCallback(async()=>{try{k(!0),T(null);const le=`student_subjects_${t?.student_id||t?.id||""}`;console.log("🎓 UserContext: Checking cache for key:",le);const pe=Jn(le);if(pe){console.log("🎓 UserContext: Cache HIT! Using cached student data"),s(pe),G(pe);return}console.log("🎓 UserContext: Cache MISS! Fetching from API");const be=await Vn.getStudentData();if(be)s(be),G(be),console.log("🎓 UserContext: Caching student data with key:",le),Qn(le,be,hs.student_subjects);else throw new Error("No subjects data received")}catch(he){T(he.message||"Failed to load student data"),console.error("Error loading student data:",he)}finally{k(!1)}},[t?.student_id,t?.id]),G=he=>{console.log("Displaying student subjects:",he),s(he)},I=C.useCallback(async()=>{try{if(k(!0),T(null),window.tokenManager&&!window.tokenManager.isAuthenticated()){console.error("No valid teacher session found in loadTeacherData, redirecting to login"),T("No valid teacher session found");return}const le=`teacher_subjects_${t?.teacher_id||t?.id||""}`,pe=Jn(le);if(pe){s(pe),pe.length===0?nr():z(pe);return}const be=await Vn.getTeacherSubjects();if(be.success)s(be.subjects),Qn(le,be.subjects,hs.teacher_subjects),be.subjects.length===0?nr():z(be.subjects);else throw new Error(be.message||"Failed to load teacher data")}catch(he){T(he.message||"Failed to load teacher data"),console.error("Error loading teacher data:",he)}finally{k(!1)}},[t?.teacher_id,t?.id]),z=he=>{console.log("Showing main cabinet with subjects:",he),s(he)},V=he=>{console.log("Displaying grade buttons:",he),c(he)},O=async()=>{try{if(k(!0),T(null),window.tokenManager&&!window.tokenManager.isAuthenticated()){console.error("No valid admin session found in loadAdminData, redirecting to login"),T("No valid admin session found");return}await Promise.all([ye(),De(),ee()])}catch(he){T(he.message||"Failed to load admin data"),console.error("Error loading admin data:",he)}finally{k(!1)}},W=he=>{console.log("🎓 populateStudentInfoDirectly called with:",he);try{r(he),console.log("🎓 Set student profile:",he)}catch(le){console.error("Error populating student info:",le)}},q=he=>{console.log("=== populateStudentInfo called ==="),r(he)},Y=he=>{console.log("=== populateTeacherInfo called ==="),r(he)},ee=C.useCallback(async()=>{try{k(!0);const he="admin_users_",le=Jn(he);if(le){f(le),X(le);return}const pe=await Vn.getAllUsers();if(pe.success)f(pe.users),X(pe.users),Qn(he,pe.users,hs.admin_users);else throw new Error(pe.message||"Failed to load users")}catch(he){T(he.message||"Failed to load users"),console.error("Error loading users:",he)}finally{k(!1)}},[]),X=he=>{console.log("Displaying all users:",he),f(he)},ne=(he,le)=>{console.log("Displaying users table:",he,le),f(he)},ge=()=>{console.log("Toggling users content")},_e=()=>{console.log("Showing add user form"),P(!0)},Pe=()=>{console.log("Hiding add user form"),P(!1)},ce=he=>{console.log("Editing user row:",he);const le=d.find(pe=>pe.id===he);Q(le)},ye=C.useCallback(async()=>{try{const he="admin_teachers_",le=Jn(he);if(le){g(le),Fe(le);return}const pe=await Vn.getAllTeachers();if(pe.success)g(pe.teachers),Fe(pe.teachers),Qn(he,pe.teachers,hs.admin_teachers);else throw new Error(pe.message||"Failed to load teachers")}catch(he){T(he.message||"Failed to load teachers"),console.error("Error loading teachers:",he)}},[]),Fe=he=>{console.log("Displaying all teachers:",he),g(he)},Me=(he,le)=>{console.log("Displaying teachers table:",he,le),g(he)},Oe=()=>{console.log("Toggling teachers content")},He=()=>{console.log("Showing add teacher form"),N(!0)},It=()=>{console.log("Hiding add teacher form"),N(!1)},Ze=he=>{console.log("Editing teacher:",he);const le=p.find(pe=>pe.id===he);ae(le)},Le=he=>{console.log("Editing teacher row:",he);const le=p.find(pe=>pe.id===he);ae(le)},De=C.useCallback(async()=>{try{const he="admin_subjects_",le=Jn(he);if(le){v(le),et(le);return}const pe=await Vn.getAllSubjects();if(pe.success)v(pe.subjects),et(pe.subjects),Qn(he,pe.subjects,hs.admin_subjects);else throw new Error(pe.message||"Failed to load subjects")}catch(he){T(he.message||"Failed to load subjects"),console.error("Error loading subjects:",he)}},[]),et=he=>{console.log("Displaying all subjects:",he),v(he)},bt=(he,le)=>{console.log("Displaying subjects table:",he,le),v(he)},ut=()=>{console.log("Toggling subjects content")},jt=()=>{console.log("Showing add subject form"),M(!0)},Rt=()=>{console.log("Hiding add subject form"),M(!1)},Xe=he=>{console.log("Editing subject row:",he);const le=y.find(pe=>pe.id===he);se(le)},Ye=he=>{console.log("Displaying academic year:",he),b(he)},pt=()=>{console.log("Showing add academic year form")},mt=()=>{console.log("Hiding add academic year form")},_t=he=>{console.log("Handling add academic year:",he)},Ht=()=>{console.log("Toggling academic year content")},Qt=()=>{console.log("Showing academic year editor")},nr=()=>{console.log("Showing subject selection")},Nr=()=>{console.log("Showing main cabinet")},fr=he=>{r(le=>({...le,...he}))},hr=()=>{r(null),s([]),i([]),c([]),f([]),g([]),v([]),b([]),T(null)},sr=C.useCallback(he=>{hr(),he&&C2(he)},[]),Er={userProfile:t,userSubjects:n,userClasses:a,userGrades:l,allUsers:d,allTeachers:p,allSubjects:y,academicYears:w,isLoading:E,error:_,showUserForm:j,showTeacherForm:R,showSubjectForm:A,editingUser:H,editingTeacher:Z,editingSubject:te,loadStudentData:L,displayStudentSubjects:G,populateStudentInfoDirectly:W,populateStudentInfo:q,loadTeacherData:I,showMainCabinetWithSubjects:z,displayGradeButtons:V,populateTeacherInfo:Y,showSubjectSelection:nr,showMainCabinet:Nr,loadAdminData:O,getAllUsers:ee,displayAllUsers:X,displayUsersTable:ne,toggleUsersContent:ge,showAddUserForm:_e,hideAddUserForm:Pe,editUserRow:ce,loadAllTeachers:ye,displayAllTeachers:Fe,displayTeachersTable:Me,toggleTeachersContent:Oe,showAddTeacherForm:He,hideAddTeacherForm:It,editTeacher:Ze,editTeacherRow:Le,loadAllSubjects:De,displayAllSubjects:et,displaySubjectsTable:bt,toggleSubjectsContent:ut,showAddSubjectForm:jt,hideAddSubjectForm:Rt,editSubjectRow:Xe,displayAcademicYear:Ye,showAddAcademicYearForm:pt,hideAddAcademicYearForm:mt,handleAddAcademicYear:_t,toggleAcademicYearContent:Ht,showAcademicYearEditor:Qt,updateUserProfile:fr,clearUserData:hr,clearUserDataWithCache:sr,setUserProfile:r,setUserSubjects:s,setUserClasses:i,setUserGrades:c,setAllUsers:f,setAllTeachers:g,setAllSubjects:v,setAcademicYears:b,setError:T};return o.jsx(UA.Provider,{value:Er,children:e})},tv=()=>{const e=C.useContext(UA);if(!e)throw new Error("useUser must be used within a UserProvider");return e},Sm={STUDENT_LOGIN:"/.netlify/functions/student-login",TEACHER_LOGIN:"/.netlify/functions/teacher-login",ADMIN_LOGIN:"/.netlify/functions/admin-login",CHANGE_PASSWORD:"/.netlify/functions/change-password",GET_TEST_QUESTIONS:"/.netlify/functions/get-test-questions",SUBMIT_MULTIPLE_CHOICE_TEST:"/.netlify/functions/submit-multiple-choice-test",SUBMIT_TRUE_FALSE_TEST:"/.netlify/functions/submit-true-false-test",SUBMIT_INPUT_TEST:"/.netlify/functions/submit-input-test",SUBMIT_MATCHING_TEST:"/.netlify/functions/submit-matching-test",SUBMIT_DRAWING_TEST:"/.netlify/functions/submit-drawing-test",GET_STUDENT_SUBJECTS:"/.netlify/functions/get-student-subjects",GET_TEACHER_SUBJECTS:"/.netlify/functions/get-teacher-subjects",GET_ALL_USERS:"/.netlify/functions/get-all-users",GET_ALL_TEACHERS:"/.netlify/functions/get-all-teachers",GET_ALL_SUBJECTS:"/.netlify/functions/get-all-subjects",GET_ACADEMIC_YEAR:"/.netlify/functions/get-academic-year",SAVE_MULTIPLE_CHOICE_TEST:"/.netlify/functions/save-multiple-choice-test",SAVE_TRUE_FALSE_TEST:"/.netlify/functions/save-true-false-test",SAVE_INPUT_TEST:"/.netlify/functions/save-input-test",SAVE_MATCHING_TEST:"/.netlify/functions/save-matching-test",SAVE_DRAWING_TEST:"/.netlify/functions/save-drawing-test",UPDATE_DRAWING_TEST_SCORE:"/.netlify/functions/update-drawing-test-score",UPDATE_SPEAKING_TEST_SCORE:"/.netlify/functions/update-speaking-test-score",ASSIGN_TEST_TO_CLASSES:"/.netlify/functions/assign-test-to-classes",GET_TEACHER_ACTIVE_TESTS:"/.netlify/functions/get-teacher-active-tests",GET_STUDENT_ACTIVE_TESTS:"/.netlify/functions/get-student-active-tests"},wn={MULTIPLE_CHOICE:"multiple_choice",TRUE_FALSE:"true_false",INPUT:"input",MATCHING:"matching_type",WORD_MATCHING:"word_matching",DRAWING:"drawing",FILL_BLANKS:"fill_blanks"},fi={STUDENT:"student",TEACHER:"teacher",ADMIN:"admin"};Array.from({length:10},(e,t)=>t+1);const Vu={DEBUG_MODE:!1,NOTIFICATION_DURATION:3e3},$u=(e,t,r)=>{if(!e||!Array.isArray(e)||e.length===0)return{score:0,total:0,percentage:0};let n=0;return e.forEach((s,a)=>{const i=Array.isArray(t)?t[a]:t[String(s.question_id||s.id||a)];i!=null&&g0(s,i,r)&&n++}),{score:n,total:e.length,percentage:Math.round(n/e.length*100)}},hp=(e,t)=>{console.log("🎓 Getting correct answer for question:",e,"testType:",t);let r="";switch(t){case wn.TRUE_FALSE:r=e.correct_answer?"true":"false",console.log("🎓 TRUE_FALSE correct_answer from question:",r,typeof r);break;case wn.MULTIPLE_CHOICE:const n=e.correct_answer.charCodeAt(0)-65,s=`option_${String.fromCharCode(97+n)}`,a=e[s];a?r=a:r=`Option ${e.correct_answer}`;break;case wn.INPUT:e.correct_answers&&Array.isArray(e.correct_answers)?r=e.correct_answers.join(", "):r=e.correct_answer||"Unknown";break;case wn.MATCHING:r=e.correct_answer||e.answer;break;case wn.WORD_MATCHING:r=e.correct_answer||e.answer;break;case wn.DRAWING:r="Drawing required";break;case wn.FILL_BLANKS:e.correct_answers&&Array.isArray(e.correct_answers)&&e.correct_answers.length>0?r=e.correct_answers[0]:r=e.correct_answer||"Unknown";break;default:r="Unknown"}return console.log("🎓 Correct answer:",r),r},g0=(e,t,r)=>{if(console.log("[DEBUG] checkAnswerCorrectness called for question:",e,"studentAnswer:",t,"testType:",r),!t||t==="")return console.log("[DEBUG] No student answer provided"),!1;let n=!1;switch(r){case wn.TRUE_FALSE:n=t.toLowerCase()==="true"===e.correct_answer;break;case wn.MULTIPLE_CHOICE:let a="";if(typeof t=="string"){const l=t.trim();if(/^[a-z]$/i.test(l))a=l.toUpperCase();else if(/^\d+$/.test(l)){const c=parseInt(l,10),d=c>=0?c:NaN;Number.isNaN(d)||(a=String.fromCharCode(65+d))}}else if(typeof t=="number"){const l=t;Number.isNaN(l)||(a=String.fromCharCode(65+l))}n=a!==""&&a===String(e.correct_answer||"").toUpperCase();break;case wn.INPUT:if(e.correct_answers&&Array.isArray(e.correct_answers)){const l=t.replace(/[.,/*';:!@#$%^&*()_+=\[\]{}|\\:";'<>?,.\s-]+/g,"").toLowerCase().trim();n=e.correct_answers.some(c=>{const d=c.replace(/[.,/*';:!@#$%^&*()_+=\[\]{}|\\:";'<>?,.\s-]+/g,"").toLowerCase().trim();return l===d})}else n=t.toLowerCase().trim()===e.correct_answer.toLowerCase().trim();break;case wn.MATCHING:if(e.correct_answer&&typeof e.correct_answer=="object"){const l=typeof t=="string"?JSON.parse(t||"{}"):t;n=JSON.stringify(l)===JSON.stringify(e.correct_answer)}break;case wn.WORD_MATCHING:if(e.correct_answer&&typeof e.correct_answer=="object"){const l=typeof t=="string"?JSON.parse(t||"{}"):t;n=JSON.stringify(l)===JSON.stringify(e.correct_answer)}break;case wn.DRAWING:console.warn("Drawing tests should not be auto-scored!"),n=!1;break;case wn.FILL_BLANKS:const i=e.correct_answers&&Array.isArray(e.correct_answers)&&e.correct_answers.length>0?e.correct_answers[0]:e.correct_answer;if(i&&t){let l="";if(typeof t=="string"){const c=t.trim();if(/^[a-z]$/i.test(c))l=c.toUpperCase();else if(/^\d+$/.test(c)){const d=parseInt(c,10),f=d>=0?d:NaN;Number.isNaN(f)||(l=String.fromCharCode(65+f))}}else if(typeof t=="number"){const c=t;Number.isNaN(c)||(l=String.fromCharCode(65+c))}n=l!==""&&l===String(i||"").toUpperCase()}break;default:console.warn(`[WARN] Unknown test type for answer checking: ${r}`),n=!1}return console.log(`[DEBUG] Answer correctness: ${n}`),n};class qW{constructor(){this.academicCalendar=null,this.loaded=!1}async loadAcademicCalendar(){if(this.loaded)return this.academicCalendar;try{const t=async n=>{const s=await fetch(n,{headers:{Accept:"application/json"},credentials:"include"}),a=s.headers&&s.headers.get&&s.headers.get("content-type")||"";if(!s.ok)throw new Error(`HTTP ${s.status}`);if(!a.includes("application/json"))throw new Error("Non-JSON response");return await s.json()};let r=null;if(r=await t("/academic_year.json"),!Array.isArray(r))throw new Error("Invalid academic calendar format");return this.academicCalendar=r,this.loaded=!0,console.log("📅 Academic calendar loaded:",this.academicCalendar.length,"terms"),this.academicCalendar}catch(t){return console.error("📅 Error loading academic calendar:",t),null}}getCurrentTerm(){if(!this.academicCalendar)return null;const t=new Date;return this.academicCalendar.find(n=>{const s=new Date(n.start_date),a=new Date(n.end_date);return t>=s&&t<=a})}getCurrentSemester(){const t=this.getCurrentTerm();if(!t)return null;const r=t.semester,n=this.academicCalendar.filter(s=>s.semester===r&&s.academic_year===t.academic_year);return{semester:r,currentTerm:t,allTerms:n}}getCurrentAcademicPeriodId(){return this.getCurrentTerm()?.id||null}getSemesterTerms(t){return this.academicCalendar?this.academicCalendar.filter(r=>r.semester===t):[]}getAcademicYearTerms(t){return this.academicCalendar?this.academicCalendar.filter(r=>r.academic_year===t):[]}getCurrentSemesterWithTerms(){const t=this.getCurrentSemester();if(!t)return null;const{semester:r,currentTerm:n,allTerms:s}=t;return{semester:r,currentTerm:n,allTerms:s,terms:s.map(a=>({id:a.id,term:a.term,start_date:a.start_date,end_date:a.end_date,isCurrent:a.id===n.id,label:`Term ${a.term}${a.id===n.id?" (Current)":""}`}))}}getCurrentSemesterTerms(){const t=this.getCurrentSemester();if(!t)return null;const{semester:r,currentTerm:n,allTerms:s}=t;return{semester:r,currentTerm:n,terms:s.map(a=>({id:a.id,term:a.term,start_date:a.start_date,end_date:a.end_date,isCurrent:a.id===n.id,label:`Term ${a.term}${a.id===n.id?" (Current)":""}`}))}}getTermById(t){return this.academicCalendar?this.academicCalendar.find(r=>r.id===t):null}isCurrentTerm(t){return this.getCurrentTerm()?.id===t}getAcademicYears(){return this.academicCalendar?[...new Set(this.academicCalendar.map(r=>r.academic_year))].sort():[]}getAcademicYearSemesterTerms(t,r){return this.academicCalendar?this.academicCalendar.filter(n=>n.academic_year===t&&n.semester===r):[]}}const Ic=new qW,rv=Object.freeze(Object.defineProperty({__proto__:null,academicCalendarService:Ic},Symbol.toStringTag,{value:"Module"})),ln={async getTestInfo(e,t){console.log(`[DEBUG] getTestInfo called with testType: ${e}, testId: ${t}`);try{const r=`/.netlify/functions/get-test-questions?test_type=${e}&test_id=${t}`;console.log("[DEBUG] Fetching test info from:",r);const n=await window.tokenManager.makeAuthenticatedRequest(r);if(console.log("[DEBUG] Response status:",n.status),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(console.log("[DEBUG] Test info data received:",s),s.success)return console.log("[DEBUG] Test info retrieved successfully"),s.test_info;throw new Error(s.error||"Failed to get test info")}catch(r){throw console.error("[ERROR] Failed to get test info:",r),r}},async getTestQuestions(e,t){console.log(`[DEBUG] getTestQuestions called with testType: ${e}, testId: ${t}`);try{const r=`/.netlify/functions/get-test-questions?test_type=${e}&test_id=${t}`;console.log("[DEBUG] Fetching test questions from:",r);const n=await window.tokenManager.makeAuthenticatedRequest(r);if(console.log("[DEBUG] Response status:",n.status),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(console.log("[DEBUG] Test questions data received:",s),s.success)return console.log("[DEBUG] Test questions retrieved successfully"),s.questions;throw new Error(s.error||"Failed to get test questions")}catch(r){throw console.error("[ERROR] Failed to get test questions:",r),r}},async getActiveTests(){console.log("getActiveTests called - extracting studentId from JWT token");try{const e="/.netlify/functions/get-student-active-tests";console.log("[DEBUG] Fetching active tests from:",e);const t=await window.tokenManager.makeAuthenticatedRequest(e);if(console.log("[DEBUG] Response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(console.log("[DEBUG] Active tests data received:",r),r.success)return console.log("[DEBUG] Active tests retrieved successfully"),r.tests;throw new Error(r.error||"Failed to get active tests")}catch(e){throw console.error("[ERROR] Failed to get active tests:",e),e}},async getTeacherTests(){console.log("getTeacherTests called - extracting teacherId from JWT token");try{const e="/.netlify/functions/get-teacher-active-tests";console.log("[DEBUG] Fetching teacher tests from:",e);const t=await window.tokenManager.makeAuthenticatedRequest(e);if(console.log("[DEBUG] Response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(console.log("[DEBUG] Teacher tests data received:",r),r.success)return console.log("[DEBUG] Teacher tests retrieved successfully"),r.tests;throw new Error(r.error||"Failed to get teacher tests")}catch(e){throw console.error("[ERROR] Failed to get teacher tests:",e),e}},async submitTest(e,t,r,n={},s=null){console.log("Submitting test:",{testType:e,testId:t});try{if(Object.keys(r).length===0)throw new Error("Please answer at least one question before submitting.");let a;try{const T=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-test-questions?test_type=${e}&test_id=${t}`)).json();if(T.success)a=T.test_info;else throw new Error("Failed to get test information")}catch(_){console.error("Error getting test info:",_);const T=await this.getTestQuestions(e,t);a={test_name:`Test ${t}`,num_questions:T.length}}const i=await this.getTestQuestions(e,t);let l,c;if(e==="drawing")l=null,c=null;else{const _=n?.answers_by_id?n.answers_by_id:r;l=$u(i,_,e).score,c=a.num_questions}const d=this.transformAnswersForSubmission(r,e),f=a.teacher_id||null,p=a.subject_id||null,g=s?.student_id||s?.id||(window.tokenManager?.getCurrentUser?window.tokenManager.getCurrentUser()?.student_id||window.tokenManager.getCurrentUser()?.id:null);await Ic.loadAcademicCalendar();const v=Ic.getCurrentTerm()?.id;if(!v)throw new Error("No current academic period found");const w={test_id:t,test_name:a.test_name,test_type:e,teacher_id:f,subject_id:p,student_id:g,academic_period_id:v,answers:d,score:l,maxScore:c,time_taken:n.time_taken||null,started_at:n.started_at||null,submitted_at:n.submitted_at||new Date().toISOString(),caught_cheating:n.caught_cheating||!1,visibility_change_times:n.visibility_change_times||0,answers_by_id:n.answers_by_id||null,question_order:n.question_order||null,retest_assignment_id:n.retest_assignment_id||null,parent_test_id:n.parent_test_id||t};console.log("🎨 testService retest_assignment_id:",n.retest_assignment_id),console.log("🎨 testService timingData:",n),console.log("🎨 testService commonData.retest_assignment_id:",w.retest_assignment_id);let b;switch(e){case"multiple_choice":b="/.netlify/functions/submit-multiple-choice-test";break;case"true_false":b="/.netlify/functions/submit-true-false-test";break;case"input":b="/.netlify/functions/submit-input-test";break;case"matching_type":b="/.netlify/functions/submit-matching-type-test";break;case"word_matching":b="/.netlify/functions/submit-word-matching-test";break;case"drawing":b="/.netlify/functions/submit-drawing-test";break;case"fill_blanks":b="/.netlify/functions/submit-fill-blanks-test";break;default:throw new Error(`Unsupported test type: ${e}`)}console.log("Submitting to:",b),console.log("Submission data:",w),console.log("Submission data JSON:",JSON.stringify(w,null,2)),console.log("🎨 Final submission retest_assignment_id:",w.retest_assignment_id);const E=await window.tokenManager.makeAuthenticatedRequest(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(!E.ok)throw new Error(`HTTP error! status: ${E.status}`);const k=await E.json();if(console.log("Test submission result:",k),k.success)return this.clearTestProgress(e,t),{success:!0,score:l,maxScore:c,result:k};throw new Error(k.error||"Failed to submit test")}catch(a){throw console.error("Error submitting test:",a),a}},async createTest(e){try{return(await os.post("/tests/create",e)).data}catch(t){throw new Error(t.message||"Failed to create test")}},async updateTest(e,t,r){try{return(await os.put(`/tests/${e}/${t}`,r)).data}catch(n){throw new Error(n.message||"Failed to update test")}},async deleteTest(e,t){try{return(await os.delete(`/tests/${e}/${t}`)).data}catch(r){throw new Error(r.message||"Failed to delete test")}},async duplicateTest(e,t){try{return(await os.post(`/tests/${e}/${t}/duplicate`)).data}catch(r){throw new Error(r.message||"Failed to duplicate test")}},async publishTest(e,t){try{return(await os.post(`/tests/${e}/${t}/publish`)).data}catch(r){throw new Error(r.message||"Failed to publish test")}},async unpublishTest(e,t){try{return(await os.post(`/tests/${e}/${t}/unpublish`)).data}catch(r){throw new Error(r.message||"Failed to unpublish test")}},async removeClassAssignment(e,t,r){try{return(await os.delete(`/tests/${e}/${t}/assignments/${r}`)).data}catch(n){throw new Error(n.message||"Failed to remove class assignment")}},async getTestStatistics(e,t){try{return(await os.get(`/tests/${e}/${t}/statistics`)).data}catch(r){throw new Error(r.message||"Failed to get test statistics")}},async exportTest(e,t,r="json"){try{return(await os.get(`/tests/${e}/${t}/export?format=${r}`)).data}catch(n){throw new Error(n.message||"Failed to export test")}},async importTest(e,t){try{return(await os.uploadFile(`/tests/import?type=${t}`,e)).data}catch(r){throw new Error(r.message||"Failed to import test")}},async getTestResults(e,t){try{return(await os.get(`/tests/${e}/${t}/results`)).data}catch(r){throw new Error(r.message||"Failed to get test results")}},async getStudentTestResults(){try{console.log("[DEBUG] Fetching student test results from: /.netlify/functions/get-student-test-results");const e=await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-student-test-results");if(console.log("[DEBUG] Response status:",e.status),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if(console.log("[DEBUG] Student test results data received:",t),t.success)return console.log("[DEBUG] Student test results retrieved successfully"),t;throw new Error(t.error||"Failed to get student test results")}catch(e){throw console.error("[ERROR] Failed to get student test results:",e),new Error(e.message||"Failed to get student test results")}},async getClassResults(e,t,r){try{return(await os.get(`/tests/class-results/${e}/${t}/${r}`)).data}catch(n){throw new Error(n.message||"Failed to get class results")}},async saveTestProgress(e,t,r){try{return(await os.post(`/tests/${e}/${t}/progress`,{progress:r})).data}catch(n){throw new Error(n.message||"Failed to save test progress")}},async getTestProgress(e,t){try{return(await os.get(`/tests/${e}/${t}/progress`)).data}catch(r){throw new Error(r.message||"Failed to get test progress")}},async clearTestProgress(e,t){try{return(await os.delete(`/tests/${e}/${t}/progress`)).data}catch(r){throw new Error(r.message||"Failed to clear test progress")}},async validateTestData(e){try{return(await os.post("/tests/validate",e)).data}catch(t){throw new Error(t.message||"Failed to validate test data")}},async getTestPreview(e,t){try{return(await os.get(`/tests/${e}/${t}/preview`)).data}catch(r){throw new Error(r.message||"Failed to get test preview")}},isAnswerCorrect(e,t,r,n){switch(n){case"multiple_choice":return String.fromCharCode(65+parseInt(t))===r.correct_answer;case"true_false":return t.toLowerCase()==="true"===r.correct_answer;case"input":return(r.correct_answers||[]).some(l=>t.toLowerCase().trim()===l.toLowerCase().trim());case"matching_type":return JSON.stringify(t)===JSON.stringify(r.correct_answer);case"word_matching":return JSON.stringify(t)===JSON.stringify(r.correct_answer);case"drawing":return t&&t!=="No answer";default:return!1}},transformAnswersForSubmission(e,t){switch(t){case"multiple_choice":return e;case"true_false":return e;case"input":return e;case"matching_type":return e;case"word_matching":return e;case"drawing":if(Array.isArray(e)&&e.length>0)try{const r=e[0];return typeof r=="string"&&r.startsWith("[")?JSON.parse(r):e}catch(r){return console.warn("Failed to parse drawing answers:",r),e}return e;default:return e}},async markTestCompleted(e,t){try{console.log(`[DEBUG] markTestCompleted called with testType: ${e}, testId: ${t}`);const r=await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/mark-test-completed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_type:e,test_id:t})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();if(console.log("[DEBUG] Mark test completed response:",n),n.success)return console.log(`Test ${e}_${t} marked as completed successfully`),{success:!0,message:n.message};throw new Error(n.error||"Failed to mark test as completed")}catch(r){throw console.error("Error marking test completed:",r),r}},clearTestProgress(e,t){try{const r=`test_progress_${e}_${t}`;localStorage.removeItem(r),console.log(`Test progress cleared for ${e}_${t}`)}catch(r){console.error("Error clearing test progress:",r)}},async saveMultipleChoiceTest(e){console.log("[DEBUG] saveMultipleChoiceTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-multiple-choice-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return console.log("[DEBUG] Save multiple choice test response:",r),r.success?{success:!0,test_id:r.test_id,message:"Test saved successfully"}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving multiple choice test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveTrueFalseTest(e){console.log("[DEBUG] saveTrueFalseTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-true-false-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return console.log("[DEBUG] Save true/false test response:",r),r.success?{success:!0,test_id:r.test_id,message:"Test saved successfully"}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving true/false test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveInputTest(e){console.log("[DEBUG] saveInputTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-input-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return console.log("[DEBUG] Save input test response:",r),r.success?{success:!0,test_id:r.test_id,message:"Test saved successfully"}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving input test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveMatchingTest(e){console.log("[DEBUG] saveMatchingTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,test_type:"matching_type",num_questions:e.num_blocks})})).json();return console.log("[DEBUG] Save matching test response:",r),r.success?{success:!0,test_id:r.test_id,message:r.message,assignments_count:r.assignments_count}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving matching test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveWordMatchingTest(e){console.log("[DEBUG] saveWordMatchingTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,test_type:"word_matching"})})).json();return console.log("[DEBUG] Save word matching test response:",r),r.success?{success:!0,test_id:r.test_id,message:r.message,assignments_count:r.assignments_count}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving word matching test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveDrawingTest(e){console.log("[DEBUG] saveDrawingTest called with:",e);try{const t={...e,test_type:"drawing"},n=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return console.log("[DEBUG] Save drawing test response:",n),n.success?{success:!0,data:{test_id:n.test_id}}:{success:!1,message:n.message||"Failed to save test"}}catch(t){return console.error("Error saving drawing test:",t),{success:!1,message:"Error saving test: "+t.message}}},async getDrawingTest(e){console.log("[DEBUG] getDrawingTest called with testId:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-drawing-test?test_id=${e}`,{method:"GET"})).json();return console.log("[DEBUG] Get drawing test response:",r),r.success?{success:!0,data:r.data}:{success:!1,message:r.message||"Failed to get test"}}catch(t){return console.error("Error getting drawing test:",t),{success:!1,message:"Error getting test: "+t.message}}},async submitDrawingTest(e,t,r,n){console.log("[DEBUG] submitDrawingTest called with:",{testId:e,answers:t,timeTaken:r,antiCheatingData:n});try{const a=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/submit-drawing-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_id:e,answers:t,time_taken:r,caught_cheating:n?.caught_cheating||!1,visibility_change_times:n?.visibility_change_times||0})})).json();return console.log("[DEBUG] Submit drawing test response:",a),a.success?{success:!0,data:a.data}:{success:!1,message:a.message||"Failed to submit test"}}catch(s){return console.error("Error submitting drawing test:",s),{success:!1,message:"Error submitting test: "+s.message}}},async updateDrawingTestScore(e,t,r){console.log("[DEBUG] updateDrawingTestScore called with:",{resultId:e,score:t,maxScore:r});try{const s=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/update-drawing-test-score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({result_id:e,score:t,max_score:r})})).json();return console.log("[DEBUG] Update drawing test score response:",s),s.success?{success:!0,data:s.data}:{success:!1,message:s.message||"Failed to update score"}}catch(n){return console.error("Error updating drawing test score:",n),{success:!1,message:"Error updating score: "+n.message}}},async getWordMatchingTest(e){console.log("[DEBUG] getWordMatchingTest called with testId:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-word-matching-test?test_id=${e}`,{method:"GET"})).json();return console.log("[DEBUG] Get word matching test response:",r),r.success?{success:!0,data:r.data}:{success:!1,message:r.message||"Failed to get test"}}catch(t){return console.error("Error getting word matching test:",t),{success:!1,message:"Error getting test: "+t.message}}},async submitWordMatchingTest(e,t,r,n){console.log("[DEBUG] submitWordMatchingTest called with:",{testId:e,answers:t,timeTaken:r,antiCheatingData:n});try{const a=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/submit-word-matching-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_id:e,answers:t,time_taken:r,caught_cheating:n?.caught_cheating||!1,visibility_change_times:n?.visibility_change_times||0})})).json();return console.log("[DEBUG] Submit word matching test response:",a),a.success?{success:!0,result:a.result}:{success:!1,message:a.message||"Failed to submit test"}}catch(s){return console.error("Error submitting word matching test:",s),{success:!1,message:"Error submitting test: "+s.message}}},async assignTestToClasses(e){console.log("[DEBUG] assignTestToClasses called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return console.log("[DEBUG] Save test with assignments response:",r),r.success?{success:!0,message:"Test assigned successfully"}:{success:!1,message:r.message||"Failed to assign test"}}catch(t){return console.error("Error assigning test to classes:",t),{success:!1,message:"Error assigning test: "+t.message}}},async removeClassAssignment(e){console.log("[DEBUG] removeClassAssignment called with assignmentId:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/remove-class-assignment?assignment_id=${e}`,{method:"DELETE"})).json();return console.log("[DEBUG] Remove class assignment response:",r),r.success?{success:!0,message:"Assignment removed successfully"}:{success:!1,message:r.message||"Failed to remove assignment"}}catch(t){return console.error("Error removing class assignment:",t),{success:!1,message:"Error removing assignment: "+t.message}}}},WA=C.createContext(),zA=({children:e})=>{const[t,r]=C.useState(null),[n,s]=C.useState([]),[a,i]=C.useState({}),[l,c]=C.useState({}),[d,f]=C.useState(!1),[p,g]=C.useState(null),[y,v]=C.useState([]),[w,b]=C.useState(!1),[E,k]=C.useState(null),[_,T]=C.useState({isOpen:!1,testType:null,testId:null,testName:null,questions:[]}),[j,P]=C.useState(null),[R,N]=C.useState(0),{getItem:A,setItem:M,removeItem:H}=BA();C.useEffect(()=>{let he;return d&&j&&(he=setInterval(()=>{const le=Math.floor((Date.now()-j)/1e3);N(le)},1e3)),()=>{he&&clearInterval(he)}},[d,j]);const Q=async(he,le)=>{try{b(!0),k(null),console.log(`[DEBUG] loadTestForPage called with testType: ${he}, testId: ${le}`);const pe=await ln.getTestInfo(he,le);console.log("[DEBUG] Test info retrieved:",pe);const be=await ln.getTestQuestions(he,le);console.log("[DEBUG] Test questions retrieved:",be),r({...pe,testType:he,testId:le}),s(be),f(!0),P(Date.now()),N(0),Z(he,le),console.log("[DEBUG] Test loaded successfully")}catch(pe){k(pe.message||"Failed to load test"),console.error("Error loading test:",pe)}finally{b(!1)}},Z=(he,le)=>{try{const pe=`test_progress_${he}_${le}`,be=A(pe);be&&(i(be.answers||{}),c(be.progress||{}))}catch(pe){console.error("Error loading saved progress:",pe)}},ae=(he,le,pe,be)=>{try{if(window.tokenManager&&!window.tokenManager.isAuthenticated()){console.warn("[WARN] Cannot save progress: No valid JWT token");return}const Ct=`test_progress_${window.tokenManager?.getDecodedToken()?.sub||"unknown"}_${he}_${le}`,Et={...a,[pe]:be},Be={...l,[pe]:{answered:!0,timestamp:Date.now()}};i(Et),c(Be),M(Ct,{answers:Et,progress:Be,lastSaved:Date.now()}),console.log(`Saved progress for question ${pe}:`,be)}catch(Ve){console.error("Error saving test progress:",Ve)}},te=(he,le,pe)=>{try{if(window.tokenManager&&!window.tokenManager.isAuthenticated())return console.warn("[WARN] Cannot get progress: No valid JWT token"),null;const Ve=`test_progress_${window.tokenManager?.getDecodedToken()?.sub||"unknown"}_${he}_${le}`;return A(Ve)?.answers?.[pe]||null}catch(be){return console.error("Error getting test progress:",be),null}},se=(he,le)=>{try{if(console.log(`[DEBUG] clearTestProgress called with testType: ${he}, testId: ${le}`),window.tokenManager&&!window.tokenManager.isAuthenticated()){console.warn("[WARN] Cannot clear progress: No valid JWT token");return}const pe=window.tokenManager?.getDecodedToken()?.sub||"unknown",be=`test_progress_${pe}_${he}_${le}`;console.log(`[DEBUG] Removing localStorage key: ${be}`);const Ve=A(be)!==null;H(be),i({}),c({});for(let Ct=0;Ct<localStorage.length;Ct++){const Et=localStorage.key(Ct);Et&&Et.startsWith(`test_progress_${pe}_${he}_${le}_`)&&(localStorage.removeItem(Et),console.log(`[DEBUG] Cleared individual question key: ${Et}`))}console.log(Ve?`[DEBUG] Progress cleared for test ${he}_${le}`:`[DEBUG] No progress found to clear for test ${he}_${le}`)}catch(pe){console.error("Error clearing test progress:",pe)}},L=async(he,le,pe="")=>{try{b(!0),k(null),console.log("Submitting test:",{testType:he,testId:le});const be=ee(he,le);if(Object.keys(be).length===0){k("Please answer at least one question before submitting.");return}let Ve;try{Ve=await ln.getTestInfo(he,le)}catch(Yt){console.error("Error getting test info:",Yt);const wr=await ln.getTestQuestions(he,le);Ve={test_name:`Test ${le}`,num_questions:wr.length}}const Ct=await ln.getTestQuestions(he,le),Et=$u(Ct,be,he),Be=Ve.num_questions,at=ne(be,he),dt={test_id:le,test_name:Ve.test_name,score:Et,maxScore:Be,answers:at},zt=await ln.submitTest(he,le,dt);if(zt.success){if(g(zt.result),V(he,le,pe),se(he,le),pe){const Yt=`student_results_table_${pe}`;he!=="drawing"?(console.log("🎓 TestContext: Caching test results after submission with key:",Yt),Qn(Yt,zt.result,hs.student_results_table)):console.log("🎨 TestContext: Skipping cache for drawing test submission (teacher-scored).")}return pe&&w0(pe,he,le),f(!1),zt.results}else throw new Error(zt.message||"Test submission failed")}catch(be){throw k(be.message||"Failed to submit test"),be}finally{b(!1)}},G=(he,le,pe)=>{g({testType:he,testId:le,answers:pe}),f(!1)},I=()=>{r(null),s([]),i({}),c({}),f(!1),g(null),k(null),P(null),N(0)},z=(he,le,pe="")=>{try{const be=`test_completed_${pe}_${he}_${le}`;return A(be)===!0}catch(be){return console.error("Error checking test completion:",be),!1}},V=(he,le,pe="")=>{try{const be=`test_completed_${pe}_${he}_${le}`;M(be,!0)}catch(be){console.error("Error marking test completed:",be)}},O=he=>Object.keys(a).length,W=()=>{const he=O(t?.testType),le=n.length;return{canSubmit:he===le,answeredCount:he,totalQuestions:le}},q=()=>{t&&se(t.testType,t.testId),I()},Y=(he="")=>{try{const le=`student_results_table_${he}`;console.log("🎓 TestContext: Clearing test results cache:",le),localStorage.removeItem(le),console.log("🎓 TestContext: Test results cache cleared")}catch(le){console.error("Error clearing test results cache:",le)}},ee=(he,le)=>({...a}),X=(he,le,pe=null)=>{try{if(!he)return"No answer";switch(le){case"true_false":return he?"True":"False";case"multiple_choice":if(pe&&typeof he=="string"&&!isNaN(parseInt(he))){const be=parseInt(he),Ve=`option_${String.fromCharCode(97+be)}`,Ct=pe[Ve];if(Ct)return Ct}return String(he).toUpperCase();case"input":return String(he);case"matching_type":return typeof he=="object"?Object.entries(he).map(([be,Ve])=>`${be} → ${Ve}`).join(", "):String(he);case"word_matching":return typeof he=="object"?Object.entries(he).map(([be,Ve])=>`${be} → ${Ve}`).join(", "):String(he);case"drawing":return"Drawing submitted";default:return String(he)}}catch(be){return console.error("Error formatting student answer:",be),"Error displaying answer"}},ne=(he,le)=>{try{if(!he||typeof he!="object")return{};const pe={};return Object.entries(he).forEach(([be,Ve])=>{if(Ve!=null)switch(le){case"true_false":pe[be]=!!Ve;break;case"multiple_choice":pe[be]=String(Ve).toUpperCase();break;case"input":pe[be]=String(Ve).trim();break;case"matching_type":typeof Ve=="object"?pe[be]=Ve:pe[be]=String(Ve);break;case"word_matching":typeof Ve=="object"?pe[be]=Ve:pe[be]=String(Ve);break;case"drawing":pe[be]=Ve;break;default:pe[be]=Ve}}),pe}catch(pe){return console.error("Error transforming answers for submission:",pe),he||{}}},ge=C.useCallback(async(he="")=>{try{b(!0);const le=`student_active_tests_${he}`,pe=Jn(le);if(pe)return v(pe),pe;const be=await ln.getActiveTests();return v(be),Qn(le,be,hs.student_active_tests),be}catch(le){return k(le.message||"Failed to load active tests"),v([]),[]}finally{b(!1)}},[]),_e=async()=>{try{return b(!0),await ln.getTeacherTests()}catch(he){return k(he.message||"Failed to load teacher tests"),[]}finally{b(!1)}},Pe=async he=>{try{return b(!0),await ln.createTest(he)}catch(le){throw k(le.message||"Failed to create test"),le}finally{b(!1)}},ce=async(he,le)=>{try{return b(!0),await ln.deleteTest(he,le)}catch(pe){throw k(pe.message||"Failed to delete test"),pe}finally{b(!1)}},ye=async(he,le)=>{try{return await ln.getTestInfo(he,le)}catch(pe){throw console.error("Error getting test info:",pe),pe}},Fe=async(he,le)=>{try{return await ln.getTestQuestions(he,le)}catch(pe){throw console.error("Error getting test questions:",pe),pe}},Me=async(he,le,pe)=>{try{console.log("Showing test results:",{testType:he,testId:le,studentAnswers:pe});const be=await ye(he,le),Ve=await Fe(he,le);It(be,Ve,he,pe),f(!1),console.log("Test results displayed successfully")}catch(be){console.error("Error showing test results:",be),k("Failed to display test results"),g({testType:he,testId:le,answers:pe,showResults:!0,error:"Could not load detailed results"}),f(!1)}},Oe=async(he,le,pe)=>{try{b(!0);const be=await ye(he,le),Ve=await Fe(he,le);It(be,Ve,he,pe)}catch(be){k(be.message||"Failed to load test results")}finally{b(!1)}},He=C.useCallback(async(he="")=>{try{b(!0);const le=`student_results_table_${he}`;console.log("🎓 TestContext: Checking cache for key:",le);const pe=Jn(le);if(pe)return console.log("🎓 TestContext: Cache HIT! Using cached test results"),g(pe),pe;console.log("🎓 TestContext: Cache MISS! Fetching from API");const be=await ln.getStudentTestResults();return console.log("🎓 TestContext: Test results loaded:",be),console.log("🎓 TestContext: Results data:",be?.results||be),console.log("🎓 TestContext: Results length:",be?.results?.length||0),g(be),console.log("🎓 TestContext: Caching test results with key:",le),console.log("🎓 TestContext: Results being cached:",be),console.log("🎓 TestContext: Results.results being cached:",be.results),Qn(le,be,hs.student_results_table),be}catch(le){throw console.error("Error loading test results:",le),k(le.message||"Failed to load test results"),le}finally{b(!1)}},[]),It=(he,le,pe,be)=>{try{console.log("Displaying test results:",{testInfo:he,questions:le,testType:pe,studentAnswers:be});const Ve=$u(le,be,pe),Ct=he?.num_questions||le?.length||0,Et=Ct>0?Math.round(Ve/Ct*100):0,Be=Et>=60,at=le.map((dt,zt)=>{const Yt=dt.question_id||dt.id,wr=be[Yt],Ur=g0(dt,wr,pe);return{questionNumber:zt+1,question:dt.question||dt.question_text,userAnswer:X(wr,pe),correctAnswer:hp(dt,pe),isCorrect:Ur,questionType:pe}});g({testInfo:he,questions:le,testType:pe,studentAnswers:be,showResults:!0,score:Ve,totalQuestions:Ct,percentage:Et,passed:Be,questionAnalysis:at,timestamp:new Date().toISOString()}),c(dt=>({...dt,score:Ve,totalQuestions:Ct,percentage:Et,passed:Be,lastUpdated:Date.now()})),Ze(),console.log(`Test results displayed: ${Ve}/${Ct} (${Et}%) - ${Be?"PASSED":"FAILED"}`)}catch(Ve){console.error("Error displaying test results:",Ve),k("Failed to display test results")}},Ze=C.useCallback(()=>{try{console.log("Setting up test results page event listeners");const he=Ct=>{if(Ct.key==="Escape"&&q(),Ct.ctrlKey&&Ct.key==="p"&&(Ct.preventDefault(),window.print()),Ct.key==="Enter"&&p&&!p.passed){const Et=document.getElementById("retake-test-button");Et&&Et.click()}},le=()=>{window.print()},pe=()=>{if(p){const Ct=`Test: ${p.testInfo?.test_name||"Test"}
Score: ${p.score}/${p.totalQuestions} (${p.percentage}%)
Status: ${p.passed?"PASSED":"FAILED"}
Completed: ${new Date(p.timestamp).toLocaleString()}`;navigator.clipboard.writeText(Ct).then(()=>{console.log("Results copied to clipboard")}).catch(Et=>{console.error("Failed to copy results:",Et)})}};document.addEventListener("keydown",he);const be=document.getElementById("print-results");be&&be.addEventListener("click",le);const Ve=document.getElementById("copy-results");return Ve&&Ve.addEventListener("click",pe),()=>{document.removeEventListener("keydown",he),be&&be.removeEventListener("click",le),Ve&&Ve.removeEventListener("click",pe)}}catch(he){console.error("Error setting up test results page event listeners:",he)}},[q,p]),Le=async(he,le,pe)=>{try{b(!0),k(null),console.log("Viewing test details:",{testType:he,testId:le,testName:pe}),T({isOpen:!0,testType:he,testId:le,testName:pe,questions:[],isLoading:!0});const be=await ln.getTestQuestions(he,le);be&&be.length>0?(T({isOpen:!0,testType:he,testId:le,testName:pe,questions:be,isLoading:!1}),console.log(`Test details loaded: ${be.length} questions`)):(k("Could not load test questions. Please try again."),T({isOpen:!0,testType:he,testId:le,testName:pe,questions:[],isLoading:!1,error:"No questions available for this test"}))}catch(be){console.error("Error loading test details:",be),k("Error loading test details. Please try again."),T({isOpen:!0,testType:he,testId:le,testName:pe,questions:[],isLoading:!1,error:be.message||"Failed to load test details"})}finally{b(!1)}},De=(he,le,pe,be)=>{try{console.log("Showing test details modal:",{testType:he,testId:le,testName:pe,questions:be}),T({isOpen:!0,testType:he,testId:le,testName:pe,questions:be||[],isLoading:!1,error:null})}catch(Ve){console.error("Error showing test details modal:",Ve),k("Failed to show test details modal")}},et=()=>{try{console.log("Closing test details modal"),T({isOpen:!1,testType:null,testId:null,testName:null,questions:[],isLoading:!1,error:null})}catch(he){console.error("Error closing test details modal:",he)}},bt=(he,le)=>{try{switch(le){case"multiple_choice":return o.jsxs("div",{className:"answer-options",children:[o.jsx("p",{children:o.jsx("strong",{children:"Options:"})}),o.jsxs("p",{children:["A) ",he.option_a||"No text"]}),o.jsxs("p",{children:["B) ",he.option_b||"No text"]}),he.option_c&&o.jsxs("p",{children:["C) ",he.option_c]}),he.option_d&&o.jsxs("p",{children:["D) ",he.option_d]}),he.option_e&&o.jsxs("p",{children:["E) ",he.option_e]}),he.option_f&&o.jsxs("p",{children:["F) ",he.option_f]}),o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",he.correct_answer||"Not specified"]})})]});case"true_false":return o.jsx("div",{className:"answer-options",children:o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",he.correct_answer?"True":"False"]})})});case"input":return o.jsx("div",{className:"answer-options",children:o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",he.correct_answer||"Not specified"]})})});case"matching_type":return o.jsx("div",{className:"answer-options",children:o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",he.correct_answer?JSON.stringify(he.correct_answer):"Not specified"]})})});case"word_matching":return o.jsx("div",{className:"answer-options",children:o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",he.correct_answer?JSON.stringify(he.correct_answer):"Not specified"]})})});default:return o.jsx("p",{children:"Unknown question type"})}}catch(pe){return console.error("Error formatting question answer display:",pe),o.jsx("p",{children:"Error displaying question"})}},ut=(he,le)=>{try{console.log("Navigating to test:",{testType:he,testId:le}),r({testType:he,testId:le}),f(!0),Q(he,le)}catch(pe){console.error("Error navigating to test:",pe),k("Failed to navigate to test")}},jt=()=>{try{console.log("Hiding test sections"),r(null),s([]),i({}),c({}),f(!1),g(null),k(null)}catch(he){console.error("Error hiding test sections:",he)}},Rt=(he,le,pe,be)=>{try{console.log("Displaying test on page:",{testInfo:he,questions:le,testType:pe,testId:be}),r({...he,testType:pe,testId:be}),s(le),f(!0),Z(pe,be),Qt(pe,be),_t(pe,be)}catch(Ve){console.error("Error displaying test on page:",Ve),k("Failed to display test on page")}},Xe=(he,le,pe)=>{try{return console.log("Rendering questions for page:",{questions:he,testType:le,testId:pe}),!he||!Array.isArray(he)?(console.warn("Invalid questions array for rendering"),[]):he.map((be,Ve)=>{const Ct=Et=>{const Be={...a,[be.question_id]:Et};i(Be),ae(le,pe,be.question_id,Et)};return{question:be,index:Ve,testType:le,testId:pe,studentAnswer:a[be.question_id]||"",onAnswerChange:Ct}})}catch(be){return console.error("Error rendering questions for page:",be),[]}},Ye=C.useCallback((he,le)=>{try{if(!he||!le){console.warn("Cannot save progress: missing testType or testId");return}const pe=`test_progress_${he}_${le}`,be={answers:a,progress:l,lastSaved:Date.now(),testType:he,testId:le};M(pe,be),console.log(`Progress saved for test ${he}_${le}:`,be)}catch(pe){console.error("Error saving progress for page:",pe)}},[a,l,M]),pt=C.useCallback(he=>{try{return!a||Object.keys(a).length===0?0:Object.values(a).filter(pe=>pe==null?!1:typeof pe=="string"?pe.trim()!=="":typeof pe=="object"?Object.keys(pe).length>0:!0).length}catch(le){return console.error("Error getting answered questions count for page:",le),0}},[a]),mt=C.useCallback((he,le)=>{try{console.log("Updating progress display for page:",{testType:he,testId:le});const pe=pt(he),be=n.length,Ve=be>0?Math.round(pe/be*100):0,Ct=pe===be&&be>0;c(dt=>({...dt,answeredCount:pe,totalQuestions:be,percentage:Ve,canSubmit:Ct,remainingQuestions:be-pe,lastUpdated:Date.now()}));const Et=document.getElementById("progress-bar"),Be=document.getElementById("progress-text"),at=document.getElementById("submit-test-button");return Et&&(Et.style.width=`${Ve}%`,Et.className=Et.className.replace(/bg-\w+-\d+/,""),Ve>=100?Et.classList.add("bg-green-500"):Ve>=80?Et.classList.add("bg-blue-500"):Ve>=60?Et.classList.add("bg-yellow-500"):Ve>=40?Et.classList.add("bg-orange-500"):Et.classList.add("bg-red-500")),Be&&(Be.textContent=`${pe}/${be} questions answered (${Ve}%)`),at&&(at.disabled=!Ct,Ct?(at.textContent="✅ Submit Test",at.classList.remove("bg-gray-400"),at.classList.add("bg-green-600","hover:bg-green-700")):(at.textContent=`⏳ Complete ${be-pe} more question${be-pe!==1?"s":""}`,at.classList.remove("bg-green-600","hover:bg-green-700"),at.classList.add("bg-gray-400"))),{answeredCount:pe,totalQuestions:be,percentage:Ve,canSubmit:Ct}}catch(pe){return console.error("Error updating progress display for page:",pe),{answeredCount:0,totalQuestions:0,percentage:0,canSubmit:!1}}},[n.length,pt]),_t=C.useCallback((he,le)=>{try{console.log("Setting up test page event listeners:",{testType:he,testId:le});const pe=setInterval(()=>{Object.keys(a).length>0&&(Ye(he,le),console.log("Auto-saved progress for test:",he,le))},3e4),be=setInterval(()=>{mt(he,le)},2e3),Ve=dt=>{dt.key==="Escape"&&window.confirm("Are you sure you want to exit the test? Your progress will be saved.")&&q(),dt.ctrlKey&&dt.key==="s"&&(dt.preventDefault(),Ye(he,le),console.log("Manual save triggered")),dt.key},Ct=dt=>{Object.keys(a).length>0&&(dt.preventDefault(),dt.returnValue="Your test progress will be saved. Are you sure you want to leave?")},Et=()=>{document.hidden&&(console.log("Tab became hidden - saving progress"),Ye(he,le))},Be=()=>{console.log("Window focused - updating progress"),mt(he,le)},at=()=>{console.log("Window blurred - saving progress"),Ye(he,le)};return document.addEventListener("keydown",Ve),window.addEventListener("beforeunload",Ct),document.addEventListener("visibilitychange",Et),window.addEventListener("focus",Be),window.addEventListener("blur",at),window.testIntervals||(window.testIntervals={}),window.testIntervals[`autosave_${he}_${le}`]=pe,window.testIntervals[`progress_${he}_${le}`]=be,()=>{clearInterval(pe),clearInterval(be),document.removeEventListener("keydown",Ve),window.removeEventListener("beforeunload",Ct),document.removeEventListener("visibilitychange",Et),window.removeEventListener("focus",Be),window.removeEventListener("blur",at),window.testIntervals&&(delete window.testIntervals[`autosave_${he}_${le}`],delete window.testIntervals[`progress_${he}_${le}`])}}catch(pe){console.error("Error setting up test page event listeners:",pe)}},[a,Ye,mt,q]),Ht=C.useCallback(()=>{try{const he=pt(t?.testType),le=n.length,pe=he===le&&le>0,be=document.getElementById("submit-test-button");return be&&(be.disabled=!pe,be.textContent=pe?"Submit Test":`Complete ${le-he} more questions`),{canSubmit:pe,answeredCount:he,totalQuestions:le}}catch(he){return console.error("Error updating submit button state for page:",he),{canSubmit:!1,answeredCount:0,totalQuestions:0}}},[t,n.length,pt]),Qt=C.useCallback((he,le)=>{try{console.log("Setting up progress tracking for page:",{testType:he,testId:le});const pe=setInterval(()=>{mt(he,le),Ht()},1e3),be=setInterval(()=>{Object.keys(a).length>0&&Ye(he,le)},3e4);return window.testIntervals||(window.testIntervals={}),window.testIntervals[`progress_${he}_${le}`]=pe,window.testIntervals[`autosave_${he}_${le}`]=be,()=>{clearInterval(pe),clearInterval(be),window.testIntervals&&(delete window.testIntervals[`progress_${he}_${le}`],delete window.testIntervals[`autosave_${he}_${le}`])}}catch(pe){console.error("Error setting up progress tracking for page:",pe)}},[a,mt,Ht,Ye]),nr=C.useCallback(async(he,le)=>{const pe=document.getElementById("submit-test-button");try{const be=pt(he),Ve=n.length;if(be<Ve){k(`Please answer all ${Ve} questions before submitting.`);return}if(!window.confirm("Are you sure you want to submit your test? This action cannot be undone."))return;pe&&(pe.disabled=!0,pe.innerHTML=`
          <div class="flex items-center justify-center space-x-2">
            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
            <span>Submitting...</span>
          </div>
        `),await L(he,le)&&(se(he,le),G(he,le,a),console.log("Test submitted successfully!"))}catch(be){console.error("Error submitting test from page:",be),k("Failed to submit test. Please try again."),pe&&(pe.disabled=!1,pe.textContent="Submit Test")}},[pt,n.length,L,se,G,a]),Nr=C.useCallback(()=>{try{if(!t)return null;const he=["true_false","multiple_choice","input","matching_type","word_matching"];return he.includes(t.testType)?t.testType:he.includes(t.test_type)?t.test_type:null}catch(he){return console.error("Error getting current test type:",he),null}},[t]),fr=C.useCallback((he,le)=>{try{console.log("Clearing progress tracking interval:",{testType:he,testId:le});const pe=`progress_interval_${he}_${le}`,be=`autosave_interval_${he}_${le}`;window.testIntervals&&(window.testIntervals[pe]&&(clearInterval(window.testIntervals[pe]),delete window.testIntervals[pe]),window.testIntervals[be]&&(clearInterval(window.testIntervals[be]),delete window.testIntervals[be])),console.log(`Cleared progress tracking intervals for test ${he}_${le}`)}catch(pe){console.error("Error clearing progress tracking interval:",pe)}},[]),Er={currentTest:t,testQuestions:n,studentAnswers:a,testProgress:l,isTestActive:d,testResults:p,activeTests:y,isLoading:w,error:E,testDetailsModal:_,testStartTime:j,timeElapsed:R,loadTestForPage:Q,submitTest:L,navigateToTestResults:G,navigateBackToCabinet:I,clearTestDataAndReturnToCabinet:q,saveTestProgress:ae,getTestProgress:te,clearTestProgress:se,loadSavedProgressForPage:Z,isTestCompleted:z,markTestCompleted:V,markTestCompletedInUI:(he,le)=>{console.log("Marking test completed in UI:",{testType:he,testId:le}),V(he,le)},getAnsweredQuestionsCount:O,updateSubmitButtonState:W,updateSubmitButtonStateForPage:Ht,loadStudentActiveTests:ge,loadActiveTests:ge,loadTeacherActiveTests:_e,getTestInfo:ye,getTestQuestions:Fe,createTest:Pe,deleteTest:ce,showTestResults:Me,loadTestResults:He,loadTestResultsForPage:Oe,displayTestResultsOnPage:It,setupTestResultsPageEventListeners:Ze,clearTestResultsCache:Y,viewTestDetails:Le,showTestDetailsModal:De,closeTestDetailsModal:et,getQuestionAnswerDisplay:bt,navigateToTest:ut,hideTestSections:jt,displayTestOnPage:Rt,renderQuestionsForPage:Xe,setupTestPageEventListeners:_t,setupProgressTrackingForPage:Qt,updateProgressDisplayForPage:mt,submitTestFromPage:nr,getAnsweredQuestionsCountForPage:pt,getCurrentTestType:Nr,saveProgressForPage:Ye,clearProgressTrackingInterval:fr,collectTestAnswers:ee,calculateTestScore:$u,checkAnswerCorrectness:g0,formatStudentAnswerForDisplay:X,getCorrectAnswer:hp,transformAnswersForSubmission:ne,clearAllTestData:()=>{try{console.log("Clearing old test data from localStorage (older than 15 days)...");const le=Date.now()-360*60*60*1e3,pe=[];for(let be=0;be<localStorage.length;be++){const Ve=localStorage.key(be);if(!(!Ve||!((Ve.startsWith("test_")||Ve.startsWith("student_")||Ve.startsWith("teacher_")||Ve.startsWith("admin_")||Ve.includes("progress")||Ve.includes("answers"))&&!Ve.includes("test_completed_"))))try{const Et=localStorage.getItem(Ve);if(!Et){pe.push(Ve);continue}let Be=null;if(Et.startsWith("{")||Et.startsWith("[")){const at=JSON.parse(Et),dt=at.timestamp||at.lastSaved||at.lastTickAt||at.createdAt||at.updatedAt||at.startedAt||at.started_at||at.created_at;dt&&(Be=new Date(dt).getTime())}if(!Be){const at=`${Ve}__ts`,dt=localStorage.getItem(at);dt&&(Be=parseInt(dt)||null)}if(!Be)continue;Be<le&&pe.push(Ve)}catch{continue}}return pe.forEach(be=>{console.log(`Removing old localStorage key: ${be}`),H(be)}),console.log(`Cleared ${pe.length} old test-related items from localStorage`),{success:!0,clearedCount:pe.length}}catch(he){return console.error("Error clearing old test data:",he),{success:!1,error:he.message}}},setCurrentTest:r,setTestQuestions:s,setStudentAnswers:i,setTestProgress:c,setIsTestActive:f,setTestResults:g,setError:k};return o.jsx(WA.Provider,{value:Er,children:e})},qp=()=>{const e=C.useContext(WA);if(!e)throw new Error("useTest must be used within a TestProvider");return e},Xp=({testResults:e,onBackToCabinet:t,onRetakeTest:r,isLoading:n=!1,caught_cheating:s=!1,visibility_change_times:a=0})=>{if(!e||!e.showResults)return o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsx("div",{className:"text-center",children:o.jsx("p",{className:"text-gray-500",children:"No test results to display"})})});const{testInfo:i,testType:l,score:c,totalQuestions:d,percentage:f,passed:p,questionAnalysis:g,timestamp:y}=e,v=E=>({multiple_choice:"Multiple Choice",true_false:"True/False",input:"Input",matching_type:"Matching"})[E]||E,w=E=>E>=80?"text-green-600 bg-green-50":E>=60?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50",b=E=>E?"text-green-600 bg-green-100 border-green-200":"text-red-600 bg-red-100 border-red-200";return n?o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading test results..."})]})}):o.jsx("div",{className:"bg-gray-50 py-8 overflow-y-auto",children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[o.jsxs(Qe.div,{className:"bg-white rounded-lg shadow-lg p-6 mb-6",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(e?.caught_cheating||s)&&o.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 p-4 mb-6",children:o.jsxs("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),o.jsx("div",{className:"ml-3",children:o.jsxs("p",{className:"text-sm text-red-700",children:[o.jsx("strong",{children:"Academic Integrity Warning:"}),"This test has been flagged for suspicious behavior. You have switched tabs ",e?.visibility_change_times||a||0," times during the test."]})})]})}),o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Test Results"}),o.jsx("h2",{className:"text-xl text-gray-700 mb-1",children:i?.test_name||"Test"}),o.jsxs("p",{className:"text-sm text-gray-500",children:[v(l)," • Completed on ",new Date(y).toLocaleDateString()]})]}),o.jsx("div",{className:"text-right",children:o.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-full text-sm font-medium border ${b(p)}`,children:p?"✓ PASSED":"✗ FAILED"})})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[o.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[o.jsx("div",{className:"text-3xl font-bold text-gray-900",children:c}),o.jsx("div",{className:"text-sm text-gray-600",children:"Correct Answers"})]}),o.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[o.jsx("div",{className:"text-3xl font-bold text-gray-900",children:d}),o.jsx("div",{className:"text-sm text-gray-600",children:"Total Questions"})]}),o.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:`text-3xl font-bold ${w(f).split(" ")[0]}`,children:[f,"%"]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Score"})]})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-6",children:o.jsx(Qe.div,{className:`h-3 rounded-full ${w(f).split(" ")[1]}`,initial:{width:0},animate:{width:`${f}%`},transition:{duration:1,ease:"easeOut"}})}),o.jsx("div",{className:"flex flex-wrap gap-3",children:o.jsx(rt,{onClick:t,variant:"primary",className:"flex items-center gap-2",children:"← Back to Cabinet"})})]}),l!=="matching_type"&&l!=="word_matching"&&o.jsxs(Qe.div,{className:"bg-white rounded-lg shadow-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[o.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Question Review"}),o.jsx("div",{className:"space-y-4",children:g.map((E,k)=>o.jsxs(Qe.div,{className:`p-4 rounded-lg border-2 ${E.isCorrect?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:k*.1},children:[o.jsxs("div",{className:"flex items-start justify-between mb-3",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:["Question ",E.questionNumber]}),o.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${E.isCorrect?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:E.isCorrect?"✓ Correct":"✗ Incorrect"})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("p",{className:"text-gray-800 font-medium mb-2",children:"Question:"}),o.jsx("p",{className:"text-gray-700 bg-gray-100 p-3 rounded",children:E.question})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-800 font-medium mb-2",children:"Your Answer:"}),o.jsx("p",{className:`p-3 rounded ${E.isCorrect?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:E.userAnswer||"No answer provided"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-800 font-medium mb-2",children:"Correct Answer:"}),o.jsx("p",{className:"bg-blue-100 text-blue-800 p-3 rounded",children:E.correctAnswer})]})]})]},k))})]}),o.jsxs(Qe.div,{className:"bg-white rounded-lg shadow-lg p-6 mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:[o.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Summary Statistics"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.filter(E=>E.isCorrect).length}),o.jsx("div",{className:"text-sm text-blue-600",children:"Correct"})]}),o.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:g.filter(E=>!E.isCorrect).length}),o.jsx("div",{className:"text-sm text-red-600",children:"Incorrect"})]}),o.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"text-2xl font-bold text-gray-600",children:[Math.round(g.filter(E=>E.isCorrect).length/d*100),"%"]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Accuracy"})]}),o.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-purple-600",children:d}),o.jsx("div",{className:"text-sm text-purple-600",children:"Total"})]})]})]})]})})},HA=({isOpen:e,onClose:t,testType:r,testId:n,testName:s,questions:a=[],isLoading:i=!1})=>{if(!e)return null;const l=p=>({multiple_choice:"Multiple Choice",true_false:"True/False",input:"Input",matching_type:"Matching"})[p]||p,c=p=>({multiple_choice:"🔘",true_false:"✅",input:"✏️",matching_type:"🔗"})[p]||"❓",d=(p,g)=>{switch(g){case"multiple_choice":return o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Options:"}),o.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[p.option_a&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"A"}),o.jsx("span",{className:"text-gray-700",children:p.option_a})]}),p.option_b&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"B"}),o.jsx("span",{className:"text-gray-700",children:p.option_b})]}),p.option_c&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"C"}),o.jsx("span",{className:"text-gray-700",children:p.option_c})]}),p.option_d&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"D"}),o.jsx("span",{className:"text-gray-700",children:p.option_d})]}),p.option_e&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"E"}),o.jsx("span",{className:"text-gray-700",children:p.option_e})]}),p.option_f&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"F"}),o.jsx("span",{className:"text-gray-700",children:p.option_f})]})]})]});case"true_false":return o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Options:"}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"T"}),o.jsx("span",{className:"text-gray-700",children:"True"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"F"}),o.jsx("span",{className:"text-gray-700",children:"False"})]})]})]});case"input":return o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Answer Format:"}),o.jsx("div",{className:"bg-gray-100 p-3 rounded",children:o.jsx("span",{className:"text-gray-600 italic",children:"Type your answer in the text input field"})})]});case"matching_type":return o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Instructions:"}),o.jsx("div",{className:"bg-gray-100 p-3 rounded",children:o.jsx("span",{className:"text-gray-600 italic",children:"Match the items by connecting them with lines or selecting pairs"})})]});default:return null}},f=(p,g)=>{if(!p.correct_answer)return null;let y="";switch(g){case"multiple_choice":y=p.correct_answer.toUpperCase();break;case"true_false":y=p.correct_answer?"True":"False";break;case"input":y=p.correct_answer;break;case"matching_type":y=typeof p.correct_answer=="object"?JSON.stringify(p.correct_answer):p.correct_answer;break;default:y=String(p.correct_answer)}return o.jsxs("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded",children:[o.jsx("p",{className:"font-medium text-green-800 mb-1",children:"Correct Answer:"}),o.jsx("p",{className:"text-green-700 font-mono",children:y})]})};return o.jsx(ji,{children:o.jsxs(Qe.div,{className:"fixed inset-0 z-50 overflow-y-auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[o.jsx(Qe.div,{className:"fixed inset-0 bg-black bg-opacity-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t}),o.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:o.jsxs(Qe.div,{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.3},children:[o.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("span",{className:"text-2xl",children:c(r)}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s||"Test Details"}),o.jsxs("p",{className:"text-sm text-gray-600",children:[l(r)," • ",a.length," Questions"]})]})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(rt,{onClick:()=>window.print(),variant:"outline",size:"sm",className:"flex items-center space-x-1",children:"🖨️ Print"}),o.jsx(rt,{onClick:t,variant:"outline",size:"sm",className:"flex items-center space-x-1",children:"✕ Close"})]})]}),o.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:i?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading test details..."})]})}):a.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📝"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No Questions Available"}),o.jsx("p",{className:"text-gray-500",children:"This test doesn't have any questions yet."})]}):o.jsx("div",{className:"space-y-6",children:a.map((p,g)=>o.jsxs(Qe.div,{className:"bg-gray-50 rounded-lg p-6 border border-gray-200",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:g*.1,duration:.3},children:[o.jsx("div",{className:"flex items-start justify-between mb-4",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsxs("span",{className:"bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full",children:["Question ",g+1]}),o.jsx("span",{className:"text-gray-500 text-sm",children:l(r)})]})}),o.jsx("div",{className:"mb-4",children:o.jsx("p",{className:"text-gray-800 font-medium text-lg leading-relaxed",children:p.question||p.question_text})}),d(p,r),f(p,r)]},p.id||p.question_id||g))})}),o.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[o.jsx("div",{className:"text-sm text-gray-600",children:a.length>0&&o.jsxs("span",{children:["Showing ",a.length," question",a.length!==1?"s":""]})}),o.jsx("div",{className:"flex items-center space-x-3",children:o.jsx(rt,{onClick:t,variant:"primary",className:"flex items-center space-x-2",children:"Close"})})]})]})})]})})},XW=({answeredCount:e=0,totalQuestions:t=0,timeElapsed:r=0,onSubmitTest:n,isSubmitting:s=!1,canSubmit:a=!1,className:i=""})=>{const l=t>0?Math.round(e/t*100):0,c=t-e,d=g=>{const y=Math.floor(g/3600),v=Math.floor(g%3600/60),w=g%60;return y>0?`${y}:${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`:`${v}:${w.toString().padStart(2,"0")}`},f=g=>g>=100?"bg-green-500":g>=80?"bg-blue-500":g>=60?"bg-yellow-500":g>=40?"bg-orange-500":"bg-red-500",p=g=>g>=100?"text-green-600":g>=80?"text-blue-600":g>=60?"text-yellow-600":g>=40?"text-orange-600":"text-red-600";return o.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-6 ${i}`,children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Test Progress"}),o.jsx("div",{className:"flex items-center space-x-4",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-2xl",children:"⏱️"}),o.jsx("span",{className:"text-sm font-mono text-gray-600",children:d(r)})]})})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),o.jsxs("span",{className:`text-sm font-semibold ${p(l)}`,children:[l,"%"]})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:o.jsx(Qe.div,{className:`h-full ${f(l)} transition-colors duration-300`,initial:{width:0},animate:{width:`${l}%`},transition:{duration:.5,ease:"easeOut"}})})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 mb-4",children:[o.jsxs("div",{className:"text-center p-2 sm:p-3 bg-blue-50 rounded-lg",children:[o.jsx("div",{className:"text-lg sm:text-2xl font-bold text-blue-600",children:e}),o.jsx("div",{className:"text-xs text-blue-600",children:"Answered"})]}),o.jsxs("div",{className:"text-center p-2 sm:p-3 bg-gray-50 rounded-lg",children:[o.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-600",children:c}),o.jsx("div",{className:"text-xs text-gray-600",children:"Remaining"})]}),o.jsxs("div",{className:"text-center p-2 sm:p-3 bg-purple-50 rounded-lg",children:[o.jsx("div",{className:"text-lg sm:text-2xl font-bold text-purple-600",children:t}),o.jsx("div",{className:"text-xs text-purple-600",children:"Total"})]})]}),o.jsx("div",{className:"mb-4",children:e===t?o.jsx(Qe.div,{className:"flex items-center justify-center p-3 bg-green-50 border border-green-200 rounded-lg",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:o.jsx("span",{className:"text-green-600 font-medium",children:"🎉 All questions answered! Ready to submit."})}):c===1?o.jsx(Qe.div,{className:"flex items-center justify-center p-3 bg-yellow-50 border border-yellow-200 rounded-lg",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:o.jsx("span",{className:"text-yellow-600 font-medium",children:"Almost there! 1 question remaining."})}):o.jsx("div",{className:"flex items-center justify-center p-3 bg-gray-50 border border-gray-200 rounded-lg",children:o.jsxs("span",{className:"text-gray-600 font-medium",children:[c," questions remaining"]})})}),a&&o.jsx("div",{className:"flex justify-center",children:o.jsx(Qe.button,{onClick:n,disabled:s,className:`px-8 py-3 rounded-lg font-semibold text-white transition-all duration-300 ${s?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 shadow-lg hover:shadow-xl"}`,whileHover:s?{}:{scale:1.05},whileTap:s?{}:{scale:.95},children:s?o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),o.jsx("span",{children:"Submitting..."})]}):o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{children:"✅"}),o.jsx("span",{children:"Submit Test"})]})})})]})},YW=({testText:e,blanks:t,separateType:r=!0,testId:n,testName:s="Unknown Test",teacherId:a="Unknown Teacher",subjectId:i,onTestComplete:l,onAnswerChange:c})=>{if(console.log("🔍 FillBlanksTestStudent Props Debug:"),console.log("- testText:",e),console.log("- blanks:",t),console.log("- separateType:",r),console.log("- testId:",n),console.log("- testName:",s),console.log("- teacherId:",a),console.log("- subjectId:",i),!e||!t||!Array.isArray(t))return console.log("❌ FillBlanksTestStudent: Missing test data"),o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx(kt,{className:"max-w-md w-full",children:o.jsxs(kt.Body,{className:"text-center",children:[o.jsx("div",{className:"text-gray-500 text-6xl mb-4",children:"📝"}),o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Test Data"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Unable to load fill blanks test data"}),o.jsx(rt,{onClick:()=>window.history.back(),variant:"primary",children:"Back to Dashboard"})]})})});const[d,f]=C.useState({}),[p,g]=C.useState(!1),[y,v]=C.useState(null),[w,b]=C.useState(null),[E,k]=C.useState(!1),[_,T]=C.useState(null),{showNotification:j}=da(),{makeAuthenticatedRequest:P}=Ji(),{user:R}=Wn(),{startTracking:N,stopTracking:A,getCheatingData:M,clearData:H}=D0("fill_blanks",n,R?.student_id||R?.id);ev();const Q=C.useCallback((se,L)=>{try{let G=se;if(typeof se=="string"&&se.startsWith("{"))try{const O=JSON.parse(se);O.root&&O.root.children&&(G=O.root.children.map(W=>W.children?W.children.map(q=>q.style&&q.style.includes("background-color: #f0f9ff")?"[BLANK_PLACEHOLDER]":q.text||"").join(""):"").join(" "))}catch(O){console.error("Error parsing Lexical JSON:",O)}let I=G;L.forEach((O,W)=>{const q=`[${W+1}_________]`;I=I.replace("[BLANK_PLACEHOLDER]",q)});const V=I.split(/(\[\d+_________\])/).map((O,W)=>O.match(/\[\d+_________\]/)?o.jsx("span",{className:"inline-block px-3 py-1 mx-1 bg-purple-100 text-purple-800 border-2 border-purple-400 rounded-lg font-mono font-bold shadow-sm",children:O},W):o.jsx("span",{children:O},W));return o.jsx("div",{className:"prose max-w-none mb-6",children:o.jsx("div",{className:"text-lg leading-relaxed whitespace-pre-wrap",children:V})})}catch(G){return console.error("Error rendering text with blanks:",G),o.jsx("div",{className:"text-red-500",children:"Error loading test content"})}},[]),Z=C.useCallback((se,L)=>{try{let G=se;if(typeof se=="string"&&se.startsWith("{"))try{const O=JSON.parse(se);O.root&&O.root.children&&(G=O.root.children.map(W=>W.children?W.children.map(q=>q.style&&q.style.includes("background-color: #f0f9ff")?"[BLANK_PLACEHOLDER]":q.text||"").join(""):"").join(" "))}catch(O){console.error("Error parsing Lexical JSON:",O)}const I=[];L.forEach((O,W)=>{const q=d[O.id],Y=q?O.options[q.charCodeAt(0)-65]:null,ee=Y?o.jsx("span",{className:"inline-block px-3 py-2 bg-green-100 text-green-800 rounded-lg border-2 border-green-400 cursor-pointer hover:bg-green-200 hover:border-green-500 transition-all duration-200 font-bold shadow-sm",onClick:()=>b(O.id),children:Y},W):o.jsxs("span",{className:"inline-block px-3 py-2 bg-purple-100 text-purple-800 rounded-lg border-2 border-purple-400 cursor-pointer hover:bg-purple-200 hover:border-purple-500 transition-all duration-200 font-bold shadow-sm",onClick:()=>b(O.id),children:[W+1,"_________"]},W);I.push(ee),G=G.replace("[BLANK_PLACEHOLDER]",`__BLANK_${O.id}__`)});const z=G.split(/__BLANK_\d+__/),V=[];for(let O=0;O<z.length;O++)z[O]&&V.push(o.jsx("span",{children:z[O]},`text-${O}`)),O<I.length&&V.push(I[O]);return o.jsx("div",{className:"prose max-w-none mb-6",children:o.jsx("div",{className:"text-lg leading-relaxed whitespace-pre-wrap",children:V})})}catch(G){return console.error("Error rendering text with inline blanks:",G),o.jsx("div",{className:"text-red-500",children:"Error loading test content"})}},[d]),ae=C.useCallback((se,L)=>{const G={...d,[se]:L};f(G),c&&c(se,L)},[d,c]),te=C.useCallback(se=>o.jsx("div",{className:"space-y-6",children:se.map((L,G)=>{const I=L.blank_options||L.options||[];L.correct_answers;const z=L.question_json||L.question||`Blank ${G+1}`;return console.log(`🔍 Blank ${G+1} question text:`,z),o.jsxs(kt,{className:"p-4",children:[o.jsxs("div",{className:"mb-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Question ",G+1]}),o.jsx("p",{className:"text-gray-600 mb-4",children:z})]}),o.jsx("div",{className:"space-y-3",children:I.filter(V=>V&&V.trim().length>0).map((V,O)=>o.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors",children:[o.jsx("input",{type:"radio",name:`blank_${L.question_id||L.id||G}`,value:String.fromCharCode(65+O),checked:d[L.question_id||L.id||G]===String.fromCharCode(65+O),onChange:W=>ae(L.question_id||L.id||G,W.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),o.jsxs("span",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:String.fromCharCode(65+O)}),o.jsx("span",{className:"text-gray-700",children:V})]})]},O))})]},L.question_id||L.id||G)})}),[d,ae]);return C.useEffect(()=>{if(n&&R?.student_id){v(new Date),N(),console.log("🛡️ Anti-cheating tracking started for fill blanks test");const L=`test_progress_${R.student_id}_fill_blanks_${n}`,G=Jn(L);G&&(f(G.answers||{}),v(new Date(G.startTime)),console.log("🎯 Fill blanks test progress restored:",G))}},[n,R?.student_id,t,N]),C.useEffect(()=>{if(y&&R?.student_id&&n){const se=setInterval(()=>{const L={answers:d,startTime:y.toISOString()},G=`test_progress_${R.student_id}_fill_blanks_${n}`;Qn(G,L,hs.test_progress),console.log("🎯 Fill blanks progress auto-saved")},3e4);return()=>clearInterval(se)}},[y,d,R?.student_id,n]),C.useEffect(()=>()=>{A(),H(),console.log("🛡️ Fill blanks test component unmounted - anti-cheating cleanup")},[A,H]),C.useCallback(async()=>{g(!0);try{const se=t.length;let L=0;t.forEach((ye,Fe)=>{const Me=d[ye.id];Me&&Me===ye.correct_answer&&L++});const G=L,I=se;console.log(`🎯 Fill Blanks Score: ${G}/${I} (${Math.round(G/I*100)}%)`);const z=new Date,V=y?Math.round((z-y)/1e3):0,O=y?y.toISOString():z.toISOString(),W=M();console.log("🛡️ Anti-cheating data for fill blanks submission:",W);const q=R.student_id,Y=`retest_assignment_id_${q}_fill_blanks_${n}`,ee=localStorage.getItem(Y),{academicCalendarService:X}=await hi(async()=>{const{academicCalendarService:ye}=await Promise.resolve().then(()=>rv);return{academicCalendarService:ye}},void 0);await X.loadAcademicCalendar();const ge=X.getCurrentTerm()?.id;if(!ge)throw new Error("No current academic period found");const _e={test_id:n,test_name:s,teacher_id:a||null,subject_id:i||null,student_id:q,academic_period_id:ge,parent_test_id:n,retest_assignment_id:ee?Number(ee):null,answers:d,score:G,maxScore:I,time_taken:V,started_at:O,submitted_at:z.toISOString(),caught_cheating:W.caught_cheating,visibility_change_times:W.visibility_change_times};console.log("🎯 Submitting fill blanks test:",_e);const ce=await(await P("/.netlify/functions/submit-fill-blanks-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)})).json();if(ce.success){if(j("Test submitted successfully!","success"),A(),H(),console.log("🛡️ Anti-cheating tracking stopped and data cleared for fill blanks test"),R?.student_id&&(w0(R.student_id,"fill_blanks",n),console.log("🎓 Fill blanks test data cleared from cache")),R?.student_id){const ye=`test_completed_${R.student_id}_fill_blanks_${n}`;localStorage.setItem(ye,"true"),console.log("✅ Fill blanks test marked as completed in localStorage:",ye);const Fe=`retest1_${q}_fill_blanks_${n}`;localStorage.removeItem(Fe),localStorage.removeItem(Y)}if(R?.student_id){const ye=`student_results_table_${R.student_id}`;Qn(ye,ce,hs.student_results_table),console.log("🎓 Fill blanks test results cached with key:",ye)}setShowSubmitModal(!1),setTimeout(()=>{l&&l(G)},2e3)}else throw new Error(ce.message||"Failed to submit test")}catch(se){console.error("Error submitting test:",se),j("Error submitting test. Please try again.","error")}finally{g(!1)}},[d,t,n,s,a,i,y,M,A,H,P,j,l,R]),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:o.jsxs(kt,{children:[p&&o.jsx(kt.Header,{children:o.jsx("div",{className:"flex items-center justify-center",children:o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[o.jsx(Br,{size:"small"}),o.jsx("span",{children:"Submitting..."})]})})}),o.jsx(kt.Body,{children:r===!0?o.jsxs(o.Fragment,{children:[Q(e,t),te(t)]}):o.jsx(o.Fragment,{children:Z(e,t)})}),r===!1&&w&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Select Answer"}),o.jsx("div",{className:"space-y-2",children:t.find(se=>se.id===w)?.options.filter(se=>se.trim().length>0).map((se,L)=>o.jsxs("button",{onClick:()=>{ae(w,String.fromCharCode(65+L)),b(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-100 rounded-lg border border-gray-200",children:[o.jsxs("span",{className:"font-semibold text-blue-600 mr-2",children:[String.fromCharCode(65+L),")"]}),se]},L))}),o.jsx("div",{className:"mt-4 flex justify-end",children:o.jsx(rt,{onClick:()=>b(null),variant:"secondary",size:"sm",children:"Cancel"})})]})}),o.jsx(kt.Footer,{children:o.jsx("div",{className:"flex gap-3"})})]})})};let JW=class{constructor(){this.tokenKey="auth_token",this.refreshTokenKey="refresh_token",this.userKey="user_data"}getToken(){return localStorage.getItem(this.tokenKey)}getRefreshToken(){return localStorage.getItem(this.refreshTokenKey)}getUserData(){const t=localStorage.getItem(this.userKey);return t?JSON.parse(t):null}setToken(t){localStorage.setItem(this.tokenKey,t)}setRefreshToken(t){localStorage.setItem(this.refreshTokenKey,t)}setUserData(t){localStorage.setItem(this.userKey,JSON.stringify(t))}setTokens(t,r){this.setToken(t),this.setUserData({role:r}),localStorage.setItem("accessToken",t)}isAuthenticated(){const t=this.getToken();if(!t)return!1;try{const r=JSON.parse(atob(t.split(".")[1])),n=Date.now()/1e3;return r.exp>n}catch(r){return console.error("Error decoding token:",r),!1}}getUserRole(){const t=this.getUserData();return t?t.role:null}isAdmin(){return this.getUserRole()==="admin"}isTeacher(){return this.getUserRole()==="teacher"}isStudent(){return this.getUserRole()==="student"}clearAuth(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.refreshTokenKey),localStorage.removeItem(this.userKey)}logout(){this.clearAuth(),window.location.href="/login"}getAuthHeader(){const t=this.getToken();return t?`Bearer ${t}`:null}async makeAuthenticatedRequest(t,r={}){const n=this.getToken();if(!n)throw new Error("No authentication token found");const s={"Content-Type":"application/json",Authorization:`Bearer ${n}`,...r.headers},a=await fetch(t,{...r,headers:s});if(a.status===401){if(await this.refreshToken())return s.Authorization=`Bearer ${this.getToken()}`,fetch(t,{...r,headers:s});throw this.logout(),new Error("Authentication failed")}return a}async refreshToken(){const t=this.getRefreshToken();if(!t)return!1;try{const r=await fetch("/.netlify/functions/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(r.ok){const n=await r.json();return this.setToken(n.accessToken),n.refreshToken&&this.setRefreshToken(n.refreshToken),!0}}catch(r){console.error("Error refreshing token:",r)}return!1}getAccessToken(){return this.getToken()}decodeToken(t){try{return JSON.parse(atob(t.split(".")[1]))}catch(r){return console.error("Error decoding token:",r),null}}init(){return this.isAuthenticated()?(this.setupTokenRefresh(),!0):(window.location.pathname!=="/login"&&(window.location.href="/login"),!1)}setupTokenRefresh(){setInterval(async()=>{this.isAuthenticated()&&await this.refreshToken()},3e3*1e3)}};const m0=new JW;window.tokenManager=m0;typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{m0.init()}):m0.init());const GA=async(e,t,r,n)=>{try{console.log("📊 Fetching teacher student results:",{teacherId:e,grade:t,className:r,termId:n});const a=await(await m0.makeAuthenticatedRequest(`/.netlify/functions/get-teacher-student-results?teacher_id=${e}&grade=${t}&class=${r}&academic_period_id=${n}`)).json();if(a.success)return console.log("📊 Teacher student results loaded:",a.results.length,"results"),console.log("📊 Students loaded:",a.students?.length||0,"students"),{success:!0,results:a.results,students:a.students||[],count:a.results.length,student_count:a.student_count||0};throw new Error(a.error||"Failed to load teacher student results")}catch(s){return console.error("Error fetching teacher student results:",s),{success:!1,error:s.message,results:[]}}},VA=async(e,t)=>{try{console.log("📊 Fetching student results view:",{studentId:e,academicPeriodId:t});const r=t?`&academic_period_id=${t}`:"",s=await(await m0.makeAuthenticatedRequest(`/.netlify/functions/get-student-results-view?student_id=${e}${r}`)).json();if(s.success)return console.log("📊 Student results view loaded:",s.results.length,"results"),{success:!0,results:s.results,count:s.results.length};throw new Error(s.error||"Failed to load student results view")}catch(r){return console.error("Error fetching student results view:",r),{success:!1,error:r.message,results:[]}}},QW=async(e,t,r,n)=>{try{console.log("📊 Fetching class summary:",{teacherId:e,grade:t,className:r,academicPeriodId:n});const a=await(await m0.makeAuthenticatedRequest(`/.netlify/functions/get-class-summary?teacher_id=${e}&grade=${t}&class=${r}&academic_period_id=${n}`)).json();if(a.success)return console.log("📊 Class summary loaded:",a.summary),{success:!0,summary:a.summary,hasData:!!a.summary};throw new Error(a.error||"Failed to load class summary")}catch(s){return console.error("Error fetching class summary:",s),{success:!1,error:s.message,summary:null}}},ZW=async(e,t,r,n,s={})=>{try{const a=await GA(e,t,r,n);if(!a.success)return a;let i=a.results;return s.subject&&(i=i.filter(l=>l.subject&&l.subject.toLowerCase().includes(s.subject.toLowerCase()))),s.testType&&(i=i.filter(l=>l.test_type===s.testType)),s.minScore!==void 0&&(i=i.filter(l=>l.score/l.max_score*100>=s.minScore)),s.maxScore!==void 0&&(i=i.filter(l=>l.score/l.max_score*100<=s.maxScore)),s.passed!==void 0&&(i=i.filter(l=>l.score>=l.passing_score===s.passed)),{success:!0,results:i,count:i.length,originalCount:a.results.length}}catch(a){return console.error("Error filtering teacher student results:",a),{success:!1,error:a.message,results:[]}}},ez=async(e,t,r={})=>{try{const n=await VA(e,t);if(!n.success)return n;let s=n.results;return r.subject&&(s=s.filter(a=>a.subject&&a.subject.toLowerCase().includes(r.subject.toLowerCase()))),r.testType&&(s=s.filter(a=>a.test_type===r.testType)),r.semester&&(s=s.filter(a=>a.semester===r.semester)),r.passed!==void 0&&(s=s.filter(a=>a.score>=a.passing_score===r.passed)),{success:!0,results:s,count:s.length,originalCount:n.results.length}}catch(n){return console.error("Error filtering student results view:",n),{success:!1,error:n.message,results:[]}}},tz={getTeacherStudentResults:GA,getStudentResultsView:VA,getClassSummary:QW,getTeacherStudentResultsFiltered:ZW,getStudentResultsViewFiltered:ez};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rz=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),nz=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),sE=e=>{const t=nz(e);return t.charAt(0).toUpperCase()+t.slice(1)},KA=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),sz=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var az={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iz=C.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:a,iconNode:i,...l},c)=>C.createElement("svg",{ref:c,...az,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:KA("lucide",s),...!a&&!sz(l)&&{"aria-hidden":"true"},...l},[...i.map(([d,f])=>C.createElement(d,f)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=(e,t)=>{const r=C.forwardRef(({className:n,...s},a)=>C.createElement(iz,{ref:a,iconNode:t,className:KA(`lucide-${rz(sE(e))}`,`lucide-${e}`,n),...s}));return r.displayName=sE(e),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oz=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],lz=I0("download",oz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cz=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],uz=I0("maximize-2",cz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dz=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],fz=I0("rotate-cw",dz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hz=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],qA=I0("x",hz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gz=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],mz=I0("zoom-in",gz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pz=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],xz=I0("zoom-out",pz),zo={WIDTH:1536,HEIGHT:2048,ASPECT_RATIO:1536/2048},XA={MIN:.25,MAX:1,INITIAL:.25,STEP:.1},Bd={PENCIL:"pencil",LINE:"line",RECTANGLE:"rectangle",CIRCLE:"circle",ERASER:"eraser"},aE={CURSOR_COLOR:"#ff0000",CURSOR_OPACITY:.3},iE={ERASER_TO_THICKNESS_RATIO:2.5,THICKNESS_TO_ERASER_RATIO:.4},h1={MAX_ENTRIES:10,MAX_MEMORY_KB:500,COMPRESSION_THRESHOLD:200},YA=e=>{try{const t=JSON.stringify(e);return new Blob([t]).size/1024}catch(t){return console.warn("Error calculating memory usage:",t),0}},yz=e=>Array.isArray(e)?e.map(t=>Array.isArray(t)?vz(t):t):e,vz=e=>{if(e.length<=2)return e;const t=[e[0]],r=2;for(let n=1;n<e.length-1;n++){const s=e[n-1],a=e[n];e[n+1],Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2))>r&&t.push(a)}return t.push(e[e.length-1]),t},wz=(e,t=Date.now())=>{const r=YA(e);return{data:[...e],timestamp:t,memoryUsage:r,compressed:r>h1.COMPRESSION_THRESHOLD}},oE=(e,t,r)=>{const n=wz(t),s=YA(t),a=e.slice(0,r+1);a.push(n);let i=a;return s>h1.MAX_MEMORY_KB&&(i=_z(a)),i.length>h1.MAX_ENTRIES&&(i=i.slice(-10)),{history:i,index:i.length-1}},_z=e=>e.map(t=>t.memoryUsage>h1.COMPRESSION_THRESHOLD?{...t,data:yz(t.data),compressed:!0}:t),lE=(e,t)=>{if(t<0||t>=e.length)return[];const r=e[t];return r?r.compressed?bz(r.data):[...r.data]:[]},bz=e=>[...e],cE=e=>e>0,uE=(e,t)=>e<t-1,Sz=()=>({history:[],index:-1}),kz=()=>{const[e,t]=C.useState({zoom:1,position:{x:0,y:0},rotation:0,currentTool:"pencil",currentColor:"#000000",currentThickness:2,eraserSize:10,isDrawing:!1,currentLine:[],currentShape:null,drawingHistory:[],historyIndex:-1,isFullscreen:!1,preFullscreenState:null}),[r,n]=C.useState([]),[s,a]=C.useState([]),i=C.useCallback(j=>{t(P=>({...P,...j}))},[]),l=C.useCallback(()=>{t({zoom:1,position:{x:0,y:0},rotation:0,currentTool:"pencil",currentColor:"#000000",currentThickness:2,eraserSize:10,isDrawing:!1,currentLine:[],currentShape:null,drawingHistory:[],historyIndex:-1,isFullscreen:!1,preFullscreenState:null})},[]),c=C.useCallback(j=>{const P={x:j.x,y:j.y,color:e.currentColor,thickness:e.currentThickness};e.currentTool==="pencil"?t(R=>({...R,isDrawing:!0,currentLine:[P]})):["line","rectangle","circle"].includes(e.currentTool)&&t(R=>({...R,isDrawing:!0,currentShape:{type:e.currentTool,startX:j.x,startY:j.y,endX:j.x,endY:j.y,color:e.currentColor,thickness:e.currentThickness}}))},[e.currentTool,e.currentColor,e.currentThickness]),d=C.useCallback(j=>{if(!e.isDrawing)return;const P={x:j.x,y:j.y,color:e.currentColor,thickness:e.currentThickness};e.currentTool==="pencil"?t(R=>({...R,currentLine:[...R.currentLine,P]})):e.currentShape&&t(R=>({...R,currentShape:{...R.currentShape,endX:j.x,endY:j.y}}))},[e.isDrawing,e.currentTool,e.currentColor,e.currentThickness,e.currentShape]),f=C.useCallback(()=>{if(!e.isDrawing)return;let j=r;if(e.currentTool==="pencil"&&e.currentLine.length>0?(j=[...r,e.currentLine],n(j)):e.currentShape&&(j=[...r,e.currentShape],n(j)),j!==r){const P=oE(e.drawingHistory,j,e.historyIndex);t(R=>({...R,isDrawing:!1,currentLine:[],currentShape:null,drawingHistory:P.history,historyIndex:P.index}))}else t(P=>({...P,isDrawing:!1,currentLine:[],currentShape:null}))},[e.isDrawing,e.currentTool,e.currentLine,e.currentShape,r,e.drawingHistory,e.historyIndex]),p=C.useCallback(j=>Math.round(j*iE.ERASER_TO_THICKNESS_RATIO),[]),g=C.useCallback(j=>Math.round(j*iE.THICKNESS_TO_ERASER_RATIO),[]),y=C.useCallback(j=>{t(P=>({...P,currentThickness:j,eraserSize:p(j)}))},[p]),v=C.useCallback(j=>{t(P=>({...P,eraserSize:j,currentThickness:g(j)}))},[g]),w=C.useCallback(j=>{const P=oE(e.drawingHistory,j,e.historyIndex);t(R=>({...R,drawingHistory:P.history,historyIndex:P.index}))},[e.drawingHistory,e.historyIndex]),b=C.useCallback(()=>{if(cE(e.historyIndex)){const j=e.historyIndex-1,P=lE(e.drawingHistory,j);n([...P]),t(R=>({...R,historyIndex:j}))}},[e.historyIndex,e.drawingHistory]),E=C.useCallback(()=>{if(uE(e.historyIndex,e.drawingHistory.length)){const j=e.historyIndex+1,P=lE(e.drawingHistory,j);n([...P]),t(R=>({...R,historyIndex:j}))}},[e.historyIndex,e.drawingHistory]),k=C.useCallback(()=>{const j=Sz();t(P=>({...P,drawingHistory:j.history,historyIndex:j.index}))},[]),_=cE(e.historyIndex),T=uE(e.historyIndex,e.drawingHistory.length);return{drawingState:e,setDrawingState:t,drawingData:r,setDrawingData:n,textBoxes:s,setTextBoxes:a,updateDrawingState:i,resetDrawingState:l,startDrawing:c,continueDrawing:d,finishDrawing:f,handleThicknessChange:y,handleEraserSizeChange:v,saveToHistoryState:w,undo:b,redo:E,clearHistoryState:k,canUndoState:_,canRedoState:T}},dE={SCALE_DELTA:.05,CENTER_DELTA:20},qh=e=>{if(e.length<2)return 0;const t=e[0],r=e[1];return Math.sqrt(Math.pow(r.clientX-t.clientX,2)+Math.pow(r.clientY-t.clientY,2))},Au=e=>{if(e.length<2)return null;const t=e[0],r=e[1];return{x:(t.clientX+r.clientX)/2,y:(t.clientY+r.clientY)/2}},Cz=(e,t)=>{if(e.length!==2||!t)return null;const r=qh(e),n=qh(t),s=Au(e),a=Au(t);if(n===0)return null;const i=Math.abs(r/n-1),l=Math.sqrt(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2));return i>dE.SCALE_DELTA?"zoom":l>dE.CENTER_DELTA?"pan":null},Tz=e=>{let t;return function(){const r=arguments,n=this;t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{e.apply(n,r),t=null})}},Lh=(e,t)=>{const r=t.getPointerPosition();return{x:(r.x-t.x())/t.scaleX(),y:(r.y-t.y())/t.scaleY()}},ho={PENCIL:"pencil",LINE:"line",RECTANGLE:"rectangle",CIRCLE:"circle",PAN:"pan"},g1={color:"#000000",thickness:2},fE=(e,t,r)=>({x:e.x,y:e.y,color:t||g1.color,thickness:r||g1.thickness}),Nz=(e,t,r,n,s)=>({type:e,startX:t.x,startY:t.y,endX:r.x,endY:r.y,color:n||g1.color,thickness:s||g1.thickness}),JA=(e,t,r,n,s,a)=>{const i=e-r,l=t-n,c=s-r,d=a-n,f=i*c+l*d,p=c*c+d*d;let g=-1;p!==0&&(g=f/p);let y,v;g<0?(y=r,v=n):g>1?(y=s,v=a):(y=r+g*c,v=n+g*d);const w=e-y,b=t-v;return Math.sqrt(w*w+b*b)},Ez=(e,t)=>{if(t.length===0)return[e];const r=t.sort((a,i)=>a.index-i.index),n=[];let s=0;for(const a of r)a.index>s&&n.push(e.slice(s,a.index+1)),s=a.index+1;return s<e.length&&n.push(e.slice(s)),n.filter(a=>a.length>0)},jz=(e,t,r,n)=>{const s=[],a=r/2;for(let i=0;i<n.length-1;i++){const l=n[i],c=n[i+1],d=JA(e,t,l.x,l.y,c.x,c.y);d<=a&&s.push({index:i,point:{x:l.x,y:l.y},distance:d})}return s},Az=(e,t,r,n)=>{const s=jz(t,r,n,e);return s.length===0?[e]:Ez(e,s)},Fz=(e,t,r,n)=>{if(n.type==="rectangle"){const s=Math.min(n.startX,n.endX),a=Math.min(n.startY,n.endY),i=Math.abs(n.endX-n.startX),l=Math.abs(n.endY-n.startY);return e>=s&&e<=s+i&&t>=a&&t<=a+l}else if(n.type==="circle"){const s=(n.startX+n.endX)/2,a=(n.startY+n.endY)/2,i=Math.sqrt(Math.pow(n.endX-n.startX,2)+Math.pow(n.endY-n.startY,2))/2;return Math.sqrt(Math.pow(e-s,2)+Math.pow(t-a,2))<=i}return!1},hE=(e,t,r,n)=>{const s=[];for(const a of n)if(Array.isArray(a)){const i=Az(a,e,t,r);s.push(...i)}else a.type==="line"?JA(e,t,a.startX,a.startY,a.endX,a.endY)>r/2&&s.push(a):(a.type==="rectangle"||a.type==="circle")&&(Fz(e,t,r,a)||s.push(a));return s},Pz=(e,t,r,n,s,a,i,l,c)=>{const[d,f]=C.useState({isActive:!1,type:null,lastDistance:null,lastCenter:null}),p=C.useCallback(P=>{if(P.evt.preventDefault(),P.evt.stopPropagation(),e.currentTool===ho.PAN)return;const R=P.target.getStage(),N=Lh(P,R),A=fE(N,e.currentColor,e.currentThickness);e.currentTool===ho.PENCIL?t(M=>({...M,isDrawing:!0,currentLine:[A]})):[ho.LINE,ho.RECTANGLE,ho.CIRCLE].includes(e.currentTool)&&t(M=>({...M,isDrawing:!0,currentShape:Nz(e.currentTool,N,N,e.currentColor,e.currentThickness)}))},[e.currentTool,e.currentColor,e.currentThickness,t]),g=C.useCallback(P=>{const R=hE(P.x,P.y,e.eraserSize,r);n(R),s(R)},[e.eraserSize,r,n,s]),y=C.useCallback(P=>{l&&(a(),w("Undo",P))},[l,a]),v=C.useCallback(P=>{c&&(i(),w("Redo",P))},[c,i]),w=C.useCallback((P,R)=>{const N=R.target.getStage(),A=Lh(R,N),M=new Konva.Circle({x:A.x,y:A.y,radius:20,stroke:"#4CAF50",strokeWidth:3,opacity:.8,listening:!1});N.add(M),M.to({scaleX:2,scaleY:2,opacity:0,duration:.3,onFinish:()=>{M.destroy()}})},[]),b=C.useCallback(P=>{if(P.evt.preventDefault(),P.evt.stopPropagation(),!e.isDrawing)return;const R=P.target.getStage(),N=Lh(P,R),A=fE(N,e.currentColor,e.currentThickness);e.currentTool===ho.PENCIL?t(M=>({...M,currentLine:[...M.currentLine,A]})):e.currentShape&&t(M=>({...M,currentShape:{...M.currentShape,endX:N.x,endY:N.y}}))},[e.isDrawing,e.currentTool,e.currentColor,e.currentThickness,e.currentShape,t]),E=C.useCallback(P=>{P&&P.evt&&(P.evt.preventDefault(),P.evt.stopPropagation()),e.isDrawing&&(e.currentTool===ho.PENCIL&&e.currentLine.length>0?n(R=>[...R,e.currentLine]):e.currentShape&&n(R=>[...R,e.currentShape]),t(R=>({...R,isDrawing:!1,currentLine:[],currentShape:null})))},[e.isDrawing,e.currentTool,e.currentLine,e.currentShape,n,t]),k=C.useCallback(P=>{P.evt.preventDefault(),P.evt.stopPropagation();const R=P.evt.touches;if(R.length===2)f({isActive:!0,type:"pan",lastDistance:qh(R),lastCenter:Au(R)});else if(R.length===1)if(e.currentTool===ho.ERASER){const N=P.target.getStage(),A=Lh(P,N);g(A)}else e.currentTool===ho.UNDO?y(P):e.currentTool===ho.REDO?v(P):p(P)},[qh,Au,p,e.currentTool,g,y,v]),_=C.useCallback(Tz(P=>{P.evt.preventDefault(),P.evt.stopPropagation();const R=P.evt.touches;if(R.length===2&&d.isActive){const N=Cz(R,d);if(N==="zoom"){const A=qh(R),M=Au(R),H=A/d.lastDistance,Q=Math.max(.25,Math.min(1,e.zoom*H));t(Z=>({...Z,zoom:Q,position:{x:M.x-(M.x-Z.position.x)*(Q/Z.zoom),y:M.y-(M.y-Z.position.y)*(Q/Z.zoom)}}))}else if(N==="pan"){const A=Au(R),M=A.x-d.lastCenter.x,H=A.y-d.lastCenter.y;t(Q=>({...Q,position:{x:Q.position.x+M,y:Q.position.y+H}}))}f(A=>({...A,lastDistance:qh(R),lastCenter:Au(R)}))}else if(R.length===1)if(e.currentTool===ho.ERASER){const N=P.target.getStage(),A=Lh(P,N),M=hE(A.x,A.y,e.eraserSize,r);n(M)}else if(e.currentTool===ho.PAN){const N=Au(R),A=N.x-d.lastCenter.x,M=N.y-d.lastCenter.y;t(H=>({...H,position:{x:H.position.x+A,y:H.position.y+M}})),f(H=>({...H,lastCenter:N}))}else b(P)}),[d,e.zoom,t,b]),T=C.useCallback(P=>{_(P)},[_]),j=C.useCallback(P=>{P.evt.preventDefault(),P.evt.stopPropagation();const R=P.evt.touches;R.length===0?(E(P),f({isActive:!1,type:null,lastDistance:null,lastCenter:null})):R.length===1&&f(N=>({...N,isActive:!1}))},[E]);return{handleTouchStart:k,handleTouchMove:T,handleTouchEnd:j,handleEraserStart:g,handleUndoTouch:y,handleRedoTouch:v,showTouchFeedback:w}},Rz=(e,t)=>{const[r,n]=C.useState(e.MIN),[s,a]=C.useState({x:0,y:0}),i=C.useCallback((g,y,v)=>{const w=Math.max(e.MIN,Math.min(e.MAX,g));if(y){const b=w/r,E={x:y.x-(y.x-s.x)*b,y:y.y-(y.y-s.y)*b};return{zoom:w,position:E}}else{const b=t.width*w,E=t.height*w,k={x:(v.width-b)/2,y:(v.height-E)/2};return{zoom:w,position:k}}},[r,s,e,t]),l=C.useCallback(()=>{const g=Math.min(r*(1+e.STEP),e.MAX);n(g)},[r,e]),c=C.useCallback(()=>{const g=Math.max(r/(1+e.STEP),e.MIN);n(g)},[r,e]),d=C.useCallback((g,y,v)=>{const w=i(g,y,v);n(w.zoom),a(w.position)},[i]),f=C.useCallback((g,y)=>{a(v=>({x:v.x+g,y:v.y+y}))},[]),p=C.useCallback(()=>{n(e.INITIAL),a({x:0,y:0})},[e.INITIAL]);return{zoom:r,setZoom:n,position:s,setPosition:a,handleZoomIn:l,handleZoomOut:c,handleZoomToPoint:d,handlePan:f,resetZoom:p}},Dz=e=>{const[t,r]=C.useState([]),[n,s]=C.useState(0),a=C.useCallback(p=>{if(console.log("parseDrawingData - input drawing:",p),console.log("parseDrawingData - drawing.answers:",p?.answers),!p?.answers)return console.log("parseDrawingData - no answers found, returning empty array"),[];try{if(typeof p.answers=="string"){console.log("parseDrawingData - parsing string answers");const g=JSON.parse(p.answers);return console.log("parseDrawingData - parsed string result:",g),g&&typeof g=="object"&&g.lines&&console.log("parseDrawingData - new format detected with lines and textBoxes"),g}if(p.answers&&typeof p.answers=="object"&&p.answers.lines)return console.log("parseDrawingData - answers is new format object"),p.answers;if(Array.isArray(p.answers)){if(console.log("parseDrawingData - answers is array"),p.answers.every(y=>typeof y=="string"))try{const y=p.answers.map(v=>{try{return JSON.parse(v)}catch{return v}});return console.log("parseDrawingData - parsed array elements"),y}catch{return console.log("parseDrawingData - failed to parse array elements, returning raw"),p.answers}return p.answers}return console.log("parseDrawingData - answers is neither string nor array, returning empty array"),[]}catch(g){return console.error("Error parsing drawing data:",g),[]}},[]),i=C.useCallback(p=>{if(console.log("processQuestions - input answers:",p),console.log("processQuestions - answers type:",typeof p),console.log("processQuestions - answers isArray:",Array.isArray(p)),p&&typeof p=="object"&&p.lines){console.log("processQuestions - new format detected with lines and textBoxes"),console.log("processQuestions - lines count:",p.lines?.length),console.log("processQuestions - textBoxes count:",p.textBoxes?.length);const y=l(p.lines);return console.log("processQuestions - canvas groups:",y),console.log("processQuestions - number of canvas groups:",y.length),y.map((v,w)=>(console.log(`processQuestions - canvas ${w} strokes:`,v),console.log(`processQuestions - canvas ${w} stroke count:`,v.length),{questionNumber:w+1,drawingData:v,textBoxes:p.textBoxes||[]}))}if(Array.isArray(p)&&p.every(y=>y&&typeof y=="object"&&y.lines))return console.log("processQuestions - array of {lines,textBoxes} detected"),p.map((y,v)=>({questionNumber:v+1,drawingData:y.lines||[],textBoxes:y.textBoxes||[]}));if(!Array.isArray(p))return console.log("processQuestions - answers is not array or object, returning empty array"),[];console.log("processQuestions - processing",p.length,"answers (old format)");const g=l(p);return console.log("processQuestions - canvas groups:",g),console.log("processQuestions - number of canvas groups:",g.length),g.map((y,v)=>(console.log(`processQuestions - canvas ${v} strokes:`,y),console.log(`processQuestions - canvas ${v} stroke count:`,y.length),{questionNumber:v+1,drawingData:y,textBoxes:[]}))},[]),l=C.useCallback(p=>{console.log("groupStrokesByCanvas - input answers:",p);const g=c(p);return console.log("groupStrokesByCanvas - using strategy:",g),g==="by_question_boundary"?d(p):g==="by_stroke_type"?f(p):[p]},[]),c=C.useCallback(p=>{console.log("determineGroupingStrategy - analyzing answers:",p);let g=0,y=0;return p.forEach(v=>{Array.isArray(v)?g++:typeof v=="object"&&y++}),console.log("determineGroupingStrategy - arrayCount:",g,"objectCount:",y),g>0&&y>0?"by_stroke_type":p.length>3?"by_question_boundary":"single_canvas"},[]),d=C.useCallback(p=>{console.log("groupByQuestionBoundary - grouping answers:",p);const g=[];let y=[];const v=Math.ceil(p.length/2);for(let w=0;w<p.length;w++)y.push(p[w]),(w+1)%v===0&&w<p.length-1&&(g.push([...y]),y=[]);return y.length>0&&g.push(y),console.log("groupByQuestionBoundary - result:",g),g},[]),f=C.useCallback(p=>{console.log("groupByStrokeType - grouping answers:",p);const g=[],y=[];p.forEach(w=>{Array.isArray(w)?g.push(w):typeof w=="object"&&y.push(w)});const v=[];return g.length>0&&v.push(g),y.length>0&&v.push(y),console.log("groupByStrokeType - result:",v),v},[]);return C.useEffect(()=>{if(e){console.log("useDataParsing - drawing object:",e),console.log("useDataParsing - drawing.answers:",e.answers),console.log("useDataParsing - drawing.answers type:",typeof e.answers),console.log("useDataParsing - drawing.answers length:",e.answers?.length);const p=a(e);console.log("useDataParsing - parsed answers:",p),console.log("useDataParsing - parsed answers type:",typeof p),console.log("useDataParsing - parsed answers length:",p?.length);const g=i(p);console.log("useDataParsing - processed questions:",g),console.log("useDataParsing - processed questions length:",g?.length),g.length>0&&(console.log("useDataParsing - first question drawingData:",g[0]?.drawingData),console.log("useDataParsing - first question drawingData length:",g[0]?.drawingData?.length)),r(g),s(0)}},[e,a,i]),{questionsData:t,setQuestionsData:r,currentQuestionIndex:n,setCurrentQuestionIndex:s,parseDrawingData:a,processQuestions:i}},gE={MIN:.25,INITIAL:1},Iz=(e,t)=>{const[r,n]=C.useState(!1),[s,a]=C.useState(null),i=C.useCallback(()=>{document.fullscreenElement||(a({zoom:e.zoom,position:{...e.position}}),document.documentElement.requestFullscreen().then(()=>{n(!0),t(c=>({...c,zoom:gE.MIN,position:{x:0,y:0},isFullscreen:!0}))}).catch(c=>{console.error("Error entering fullscreen:",c)}))},[e.zoom,e.position,t]),l=C.useCallback(()=>{document.fullscreenElement&&document.exitFullscreen().then(()=>{n(!1),s?(t(c=>({...c,zoom:s.zoom,position:s.position,isFullscreen:!1})),a(null)):t(c=>({...c,zoom:gE.INITIAL,position:{x:0,y:0},isFullscreen:!1}))}).catch(c=>{console.error("Error exiting fullscreen:",c)})},[s,t]);return{isFullscreen:r,enterFullscreen:i,exitFullscreen:l}},QA=C.forwardRef(({drawingData:e,textBoxes:t=[],drawingState:r,canvasSize:n,zoom:s,position:a,onTouchStart:i,onTouchMove:l,onTouchEnd:c,mousePosition:d,isMouseOverCanvas:f,isEraserDrawing:p},g)=>{const y=C.useRef(null),[v,w]=C.useState(.25),[b,E]=C.useState(null),[k,_]=C.useState({x:0,y:0}),[T,j]=C.useState(!1),P=C.useCallback(({x:z,y:V,size:O,visible:W,isDrawing:q})=>!W||!z||!V?null:o.jsx(Ou,{x:z,y:V,radius:O/2,stroke:aE.CURSOR_COLOR,strokeWidth:2,dash:[5,5],opacity:q?.8:aE.CURSOR_OPACITY,listening:!1,zIndex:1e3}),[]),R=C.useCallback(z=>{if(r.currentTool===Bd.ERASER){const V=z.target.getStage(),O=Lh(z,V);_(O)}},[r.currentTool]),N=C.useCallback(()=>{r.currentTool===Bd.ERASER&&j(!0)},[r.currentTool]),A=C.useCallback(()=>{j(!1)},[]);C.useEffect(()=>{const z=g.current;if(z)return z.on("mousemove",R),z.on("mouseenter",N),z.on("mouseleave",A),()=>{z.off("mousemove",R),z.off("mouseenter",N),z.off("mouseleave",A)}},[R,N,A,g]),C.useEffect(()=>{const z=n.width??n.WIDTH,V=n.height??n.HEIGHT,O=()=>{const W=y.current;if(!W)return;const q=W.clientWidth||1,Y=W.clientHeight||1,ee=Math.abs(r.rotation%180)===90,X=ee?V:z,ne=ee?z:V,ge=Math.min(q/(X||1),Y/(ne||1));w(Math.min(ge,1))};return O(),window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[n.width,n.height,n.WIDTH,n.HEIGHT,r.rotation]);const M=C.useMemo(()=>{const z=y.current;if(!z||!b)return 0;const V=z.clientWidth||1,O=z.clientHeight||1,W=Math.min(V/Math.max(b.width,1),O/Math.max(b.height,1));return Math.min(W,XA.MAX)},[b]),H=C.useMemo(()=>Math.max(s,v||1),[s,v]),Q=C.useMemo(()=>{const z=n.width??n.WIDTH,V=n.height??n.HEIGHT;if(!y.current)return{x:0,y:0};const O=y.current.clientWidth||1,W=y.current.clientHeight||1,q=(O-z*H)/2,Y=(W-V*H)/2;return s<=v?{x:q,y:Y}:{x:a.x!==void 0?a.x:q,y:a.y!==void 0?a.y:Y}},[a,s,v,H,n.width,n.height,b,M]);C.useEffect(()=>{if(!Array.isArray(e)||e.length===0){E(null);return}let z=1/0,V=1/0,O=-1/0,W=-1/0;const q=(ne,ge)=>{Number.isFinite(ne)&&Number.isFinite(ge)&&(ne<z&&(z=ne),ge<V&&(V=ge),ne>O&&(O=ne),ge>W&&(W=ge))};if(e.forEach(ne=>{if(Array.isArray(ne))ne.forEach(ge=>q(ge.x,ge.y));else if(ne&&typeof ne=="object"){if(ne.type==="line")q(ne.startX,ne.startY),q(ne.endX,ne.endY);else if(ne.type==="rectangle")q(ne.startX,ne.startY),q(ne.endX,ne.endY);else if(ne.type==="circle"){const ge=Math.sqrt(Math.pow(ne.endX-ne.startX,2)+Math.pow(ne.endY-ne.startY,2))/2,_e=(ne.startX+ne.endX)/2,Pe=(ne.startY+ne.endY)/2;q(_e-ge,Pe-ge),q(_e+ge,Pe+ge)}}}),!Number.isFinite(z)||!Number.isFinite(V)||!Number.isFinite(O)||!Number.isFinite(W)){E(null);return}const Y=16,ee=Math.max(1,O-z+Y*2),X=Math.max(1,W-V+Y*2);E({minX:z-Y,minY:V-Y,width:ee,height:X})},[e]),C.useEffect(()=>{console.log("CanvasViewer - drawingData:",e),console.log("CanvasViewer - drawingData length:",e?.length),console.log("CanvasViewer - textBoxes:",t),console.log("CanvasViewer - textBoxes length:",t?.length),e&&e.length>0&&console.log("CanvasViewer - first item:",e[0]),t&&t.length>0&&console.log("CanvasViewer - first textBox:",t[0])},[e,t]),C.useEffect(()=>{const z=n.width??n.WIDTH,V=n.height??n.HEIGHT;console.log("CanvasViewer - canvas dimensions:",{width:z,height:V}),console.log("CanvasViewer - zoom:",s,"fitZoom:",v,"displayScale:",H),console.log("CanvasViewer - stagePosition:",Q)},[n,s,v,H,Q]);const Z=(z,V)=>{if(console.log(`CanvasViewer - rendering element ${V}:`,z),Array.isArray(z))return console.log(`CanvasViewer - rendering line with ${z.length} points`),o.jsx(Ta,{points:z.flatMap(O=>[O.x,O.y]),stroke:z[0]?.color||"#000000",strokeWidth:z[0]?.thickness||2,tension:.5,lineCap:"round",lineJoin:"round"},V);if(z.type==="line")return o.jsx(Ta,{points:[z.startX,z.startY,z.endX,z.endY],stroke:z.color,strokeWidth:z.thickness,lineCap:"round"},V);if(z.type==="rectangle"){const O=Math.abs(z.endX-z.startX),W=Math.abs(z.endY-z.startY),q=Math.min(z.startX,z.endX),Y=Math.min(z.startY,z.endY);return o.jsx(ca,{x:q,y:Y,width:O,height:W,stroke:z.color,strokeWidth:z.thickness,fill:"transparent"},V)}else if(z.type==="circle"){const O=Math.sqrt(Math.pow(z.endX-z.startX,2)+Math.pow(z.endY-z.startY,2))/2,W=(z.startX+z.endX)/2,q=(z.startY+z.endY)/2;return o.jsx(Ou,{x:W,y:q,radius:O,stroke:z.color,strokeWidth:z.thickness,fill:"transparent"},V)}return null},ae=()=>{if(!r.isDrawing)return null;if(r.currentTool===Bd.PENCIL&&r.currentLine.length>0)return o.jsx(Ta,{points:r.currentLine.flatMap(z=>[z.x,z.y]),stroke:r.currentColor,strokeWidth:r.currentThickness,tension:.5,lineCap:"round",lineJoin:"round"});if(r.currentShape){const{type:z,startX:V,startY:O,endX:W,endY:q,color:Y,thickness:ee}=r.currentShape;if(z===Bd.LINE)return o.jsx(Ta,{points:[V,O,W,q],stroke:Y,strokeWidth:ee,lineCap:"round"});if(z===Bd.RECTANGLE){const X=Math.abs(W-V),ne=Math.abs(q-O),ge=Math.min(V,W),_e=Math.min(O,q);return o.jsx(ca,{x:ge,y:_e,width:X,height:ne,stroke:Y,strokeWidth:ee,fill:"transparent"})}else if(z===Bd.CIRCLE){const X=Math.sqrt(Math.pow(W-V,2)+Math.pow(q-O,2))/2,ne=(V+W)/2,ge=(O+q)/2;return o.jsx(Ou,{x:ne,y:ge,radius:X,stroke:Y,strokeWidth:ee,fill:"transparent"})}}return null},te=r.isFullscreen?{position:"fixed",inset:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f3f4f6",zIndex:60}:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent"},se={transform:`rotate(${r.rotation}deg)`,transformOrigin:"center center"},L=C.useCallback(z=>{z.preventDefault(),z.stopPropagation()},[]),G=C.useCallback(z=>{z.preventDefault(),z.stopPropagation()},[]),I=C.useCallback(z=>{z.preventDefault(),z.stopPropagation()},[]);return o.jsx("div",{style:{...te,touchAction:"none",WebkitTouchCallout:"none"},ref:y,className:"select-none",onTouchStart:L,onTouchMove:G,onTouchEnd:I,children:o.jsx("div",{style:{...se,touchAction:"none",WebkitTouchCallout:"none"},className:"select-none",onTouchStart:L,onTouchMove:G,onTouchEnd:I,children:o.jsx(sf,{ref:g,width:Math.max((n.width??n.WIDTH)||0,1536),height:Math.max((n.height??n.HEIGHT)||0,2048),scaleX:H,scaleY:H,x:Q.x,y:Q.y,onTouchStart:i,onTouchMove:l,onTouchEnd:c,children:o.jsxs(nf,{children:[o.jsx(ca,{x:0,y:0,width:Math.max((n.width??n.WIDTH)||0,1536),height:Math.max((n.height??n.HEIGHT)||0,2048),fill:"white"}),e.map((z,V)=>(console.log(`CanvasViewer - mapping item ${V}:`,z),Z(z,V))),t&&t.map((z,V)=>o.jsx(ca,{x:z.x,y:z.y,width:z.width,height:z.height,fill:"#ffffff",stroke:"#d1d5db",strokeWidth:1,cornerRadius:6,shadowColor:"black",shadowBlur:2,shadowOffset:{x:1,y:1}},`textbox-${V}`)),t&&t.map((z,V)=>o.jsx(Rl,{x:z.x+8,y:z.y+8,width:z.width-16,height:z.height-16,text:z.text,fontSize:z.fontSize||14,fill:z.color||"#000000",wrap:"word",align:"left",verticalAlign:"top"},`text-${V}`)),ae(),r.currentTool===Bd.ERASER&&o.jsx(P,{x:k.x,y:k.y,size:r.eraserSize,visible:T,isDrawing:p})]})})})})});QA.displayName="CanvasViewer";function Mz({containerRef:e,canvasSize:t,rotation:r=0}){const[n,s]=C.useState(1),[a,i]=C.useState({x:0,y:0}),l=C.useRef({width:1,height:1}),c=C.useRef(.01),d=C.useRef(0),f=C.useRef(!1),p=C.useCallback(()=>{const T=t?.width??t?.WIDTH??0,j=t?.height??t?.HEIGHT??0,P=Math.abs(r%180)===90;return{width:P?j:T,height:P?T:j}},[t,r]),g=C.useCallback(()=>{const T=e?.current;if(!T)return{width:1,height:1};const j=T.clientWidth||1,P=T.clientHeight||1;return l.current={width:j,height:P},{width:j,height:P}},[e]),y=C.useCallback(()=>{const{width:T,height:j}=l.current,{width:P,height:R}=p(),N=T/Math.max(P,1),A=j/Math.max(R,1);return Math.min(N,A,1)*.98},[p]),v=C.useCallback(T=>{const{width:j,height:P}=l.current,{width:R,height:N}=p(),A=Math.max(c.current,Math.min(T,1.5));let M=(j-R*A)/2,H=(P-N*A)/2;const Q=j-R*A,Z=P-N*A;M=Math.min(Math.max(0,M),Math.max(0,Q)),H=Math.min(Math.max(0,H),Math.max(0,Z));try{console.log("[Camera] centerAtScale",{targetScale:T,clampedScale:A,container:{containerW:j,containerH:P},canvas:{canvasW:R,canvasH:N},translate:{x:M,y:H},rotation:r})}catch{}i({x:M,y:H}),s(A)},[p]),w=C.useCallback(()=>{const{width:T,height:j}=g(),{width:P,height:R}=p(),N=y();let A=(T-P*N)/2,M=(j-R*N)/2;const H=T-P*N,Q=j-R*N;A=Math.min(Math.max(0,A),Math.max(0,H)),M=Math.min(Math.max(0,M),Math.max(0,Q));try{console.log("[Camera] fitCanvas",{scale:N,container:{containerW:T,containerH:j},canvas:{canvasW:P,canvasH:R},translate:{x:A,y:M},rotation:r})}catch{}s(N),i({x:A,y:M}),c.current=N,f.current=!1},[p,g,y]),b=C.useCallback(()=>{const{width:T,height:j}=g(),{width:P,height:R}=p(),N=(T-P)/2,A=(j-R)/2;s(1),i({x:N,y:A})},[p,g]),E=C.useCallback((T,j)=>{const{width:P,height:R}=l.current,{width:N,height:A}=p(),M=Math.max(c.current,Math.min(T,1.5));if(j&&Number.isFinite(j.x)&&Number.isFinite(j.y)){const H={x:(j.x-a.x)/n,y:(j.y-a.y)/n},Q=j.x-H.x*M,Z=j.y-H.y*M;try{console.log("[Camera] zoomTo(pointer) ->",{from:n,to:M})}catch{}s(M),i({x:Q,y:Z}),d.current=Date.now()+400,f.current=!0}else{let H=(P-N*M)/2,Q=(R-A*M)/2;const Z=P-N*M,ae=R-A*M;H=Math.min(Math.max(0,H),Math.max(0,Z)),Q=Math.min(Math.max(0,Q),Math.max(0,ae));try{console.log("[Camera] zoomTo(center) ->",{from:n,to:M})}catch{}s(M),i({x:H,y:Q}),d.current=Date.now()+400,f.current=!0}},[p,n,a]),k=C.useCallback((T,j)=>{const P=n*T,{width:R,height:N}=l.current,A={x:R/2,y:N/2};E(P,j||A)},[n,E]),_=C.useCallback((T,j)=>{i(P=>({x:P.x+T,y:P.y+j})),d.current=Date.now()+200,f.current=!0},[]);return C.useEffect(()=>{const T=e?.current;if(!T)return;const j=new ResizeObserver(()=>{g();const P=y();if(c.current=P,!(Date.now()<d.current)&&!f.current){try{console.log("[Camera] resize centerAtScale",{scale:n})}catch{}v(n)}});return j.observe(T),g(),()=>j.disconnect()},[e,g,y,v,n]),C.useEffect(()=>{f.current=!1,c.current=y(),v(n)},[r,t?.width,t?.height,t?.WIDTH,t?.HEIGHT,y,v,n]),C.useMemo(()=>({scale:n,translate:a,setScale:s,setTranslate:i,centerAtScale:v,fitCanvas:w,oneToOne:b,zoomTo:E,zoomByFactor:k,panBy:_}),[n,a,v,w,b,E,k,_])}const km=new Map,ZA=C.forwardRef(({drawingData:e,textBoxes:t=[],canvasSize:r,rotation:n=0,onScaleChange:s,persistKey:a="viewer",onTextBoxEdit:i},l)=>{const c=C.useRef(null),d=C.useRef(null),f=Mz({containerRef:c,canvasSize:r,rotation:n}),[p,g]=C.useState({width:1,height:1}),y=C.useRef(null),v=C.useRef(null),[w,b]=C.useState(null);C.useEffect(()=>{console.log("[ViewerCanvas] drawingData received:",e),console.log("[ViewerCanvas] drawingData length:",e?.length),e&&e.length>0&&console.log("[ViewerCanvas] First drawing element:",e[0]),console.log("[ViewerCanvas] textBoxes:",t),console.log("[ViewerCanvas] textBoxes length:",t?.length)},[e]),C.useEffect(()=>{typeof s=="function"&&s(f.scale);try{console.log("[ViewerCanvas] scale changed",{scale:f.scale})}catch{}if(a){const I=km.get(a)||{};km.set(a,{...I,scale:f.scale})}},[f.scale,s]),C.useEffect(()=>{if(a){const I=km.get(a)||{};km.set(a,{...I,translate:{x:f.translate.x,y:f.translate.y}})}},[a,f.translate.x,f.translate.y]),C.useImperativeHandle(l,()=>({zoomIn:I=>f.zoomByFactor(1.1,I),zoomOut:I=>f.zoomByFactor(1/1.1,I),fitCanvas:()=>f.fitCanvas(),oneToOne:()=>f.oneToOne(),getScale:()=>f.scale,getStage:()=>d.current,getPointerPosition:()=>d.current?.getPointerPosition?.(),exportPNGFullCanvas:()=>{const I=d.current;if(!I)return null;const z=r?.width??r?.WIDTH??1536,V=r?.height??r?.HEIGHT??2048,O={scaleX:I.scaleX(),scaleY:I.scaleY(),x:I.x(),y:I.y(),width:I.width(),height:I.height()},W=y.current,q=v.current,Y=W?{x:W.x(),y:W.y(),scaleX:W.scaleX(),scaleY:W.scaleY()}:null,ee=q?{x:q.x(),y:q.y(),rotation:q.rotation()}:null;try{return I.scale({x:1,y:1}),I.position({x:0,y:0}),I.size({width:z,height:V}),W&&(W.position({x:0,y:0}),W.scale({x:1,y:1})),q&&(q.position({x:0,y:0}),q.rotation(0)),I.batchDraw(),I.toDataURL({mimeType:"image/png",quality:1,pixelRatio:1,x:0,y:0,width:z,height:V})}finally{q&&ee&&(q.position({x:ee.x,y:ee.y}),q.rotation(ee.rotation)),W&&Y&&(W.position({x:Y.x,y:Y.y}),W.scale({x:Y.scaleX,y:Y.scaleY})),I.scale({x:O.scaleX,y:O.scaleY}),I.position({x:O.x,y:O.y}),I.size({width:O.width,height:O.height}),I.batchDraw()}}}),[f]),C.useEffect(()=>{const I=c.current;if(!I)return;const z=()=>{g({width:I.clientWidth||1,height:I.clientHeight||1})};z();const V=new ResizeObserver(z);return V.observe(I),()=>V.disconnect()},[]),C.useEffect(()=>{if(!Array.isArray(e)||e.length===0){b(null);return}let I=1/0,z=1/0,V=-1/0,O=-1/0;const W=(X,ne)=>{Number.isFinite(X)&&Number.isFinite(ne)&&(X<I&&(I=X),ne<z&&(z=ne),X>V&&(V=X),ne>O&&(O=ne))};if(e.forEach(X=>{if(Array.isArray(X))X.forEach(ne=>W(ne.x,ne.y));else if(X&&typeof X=="object"){if(X.type==="line")W(X.startX,X.startY),W(X.endX,X.endY);else if(X.type==="rectangle")W(X.startX,X.startY),W(X.endX,X.endY);else if(X.type==="circle"){const ne=Math.hypot(X.endX-X.startX,X.endY-X.startY)/2,ge=(X.startX+X.endX)/2,_e=(X.startY+X.endY)/2;W(ge-ne,_e-ne),W(ge+ne,_e+ne)}}}),!Number.isFinite(I)||!Number.isFinite(z)||!Number.isFinite(V)||!Number.isFinite(O)){b(null);return}const q=16,Y=Math.max(1,V-I+q*2),ee=Math.max(1,O-z+q*2);b({minX:I-q,minY:z-q,width:Y,height:ee,centerX:I-q+Y/2,centerY:z-q+ee/2})},[e]);const E=C.useMemo(()=>{if(!w)return{scale:1,x:0,y:0};const I=r?.width??r?.WIDTH??1536,z=r?.height??r?.HEIGHT??2048,V=Math.min(I/Math.max(1,w.width),z/Math.max(1,w.height),1),O=w.width*V,W=w.height*V,q=(I-O)/2,Y=(z-W)/2,ee=q-w.minX*V,X=Y-w.minY*V;return{scale:V,x:ee,y:X}},[w,r?.width,r?.height,r?.WIDTH,r?.HEIGHT]),k=C.useRef(!1);C.useEffect(()=>{if(k.current)return;const I=a?km.get(a):null;I&&Number.isFinite(I.scale)&&I.translate&&Number.isFinite(I.translate.x)&&Number.isFinite(I.translate.y)?(f.setScale(I.scale),f.setTranslate(I.translate)):f.fitCanvas(),k.current=!0},[a,f]),C.useEffect(()=>{try{console.log("[ViewerCanvas] rotation changed",{rotation:n,scale:f.scale,translate:f.translate})}catch{}f.fitCanvas()},[n]),C.useEffect(()=>{f.centerAtScale(f.scale)},[n]);const _=I=>{I.evt.preventDefault();const z=d.current;if(!z)return;const V=z.getPointerPosition(),O=Math.pow(1.0015,-I.evt.deltaY);f.zoomByFactor(O,V)},T=C.useRef(!1),j=C.useRef({x:0,y:0}),P=()=>{const I=c.current;if(!I)return 1;const z=I.clientWidth||1,V=I.clientHeight||1,O=r?.width??r?.WIDTH??1,W=r?.height??r?.HEIGHT??1,q=Math.abs(n%180)===90,Y=q?W:O,ee=q?O:W,X=Math.min(z/Y,V/ee);return Math.min(X,1)},R=I=>{const z=P();f.scale<=z||(T.current=!0,j.current={x:I.evt.clientX,y:I.evt.clientY})},N=I=>{if(!T.current)return;const z=I.evt.clientX-j.current.x,V=I.evt.clientY-j.current.y;j.current={x:I.evt.clientX,y:I.evt.clientY},f.panBy(z,V)},A=()=>{T.current=!1},M=1536,H=2048,Q=(I,z)=>{if(console.log(`[ViewerCanvas] Rendering drawing element ${z}:`,I),Array.isArray(I))return console.log(`[ViewerCanvas] Array item with ${I.length} points:`,I.slice(0,3)),o.jsx(Ta,{points:I.flatMap(V=>[V.x,V.y]),stroke:I[0]?.color||"#000000",strokeWidth:I[0]?.thickness||2,tension:.5,lineCap:"round",lineJoin:"round"},z);if(I?.type==="line")return o.jsx(Ta,{points:[I.startX,I.startY,I.endX,I.endY],stroke:I.color,strokeWidth:I.thickness,lineCap:"round"},z);if(I?.type==="rectangle"){const V=Math.abs(I.endX-I.startX),O=Math.abs(I.endY-I.startY),W=Math.min(I.startX,I.endX),q=Math.min(I.startY,I.endY);return o.jsx(ca,{x:W,y:q,width:V,height:O,stroke:I.color,strokeWidth:I.thickness,fill:"transparent"},z)}else if(I?.type==="circle"){const V=Math.sqrt(Math.pow(I.endX-I.startX,2)+Math.pow(I.endY-I.startY,2))/2,O=(I.startX+I.endX)/2,W=(I.startY+I.endY)/2;return o.jsx(Ou,{x:O,y:W,radius:V,stroke:I.color,strokeWidth:I.thickness,fill:"transparent"},z)}return null},Z=C.useRef(new Map),ae=C.useRef(null),te=C.useRef({x:0,y:0}),se=C.useCallback(I=>{const z=c.current;z&&(z.setPointerCapture?.(I.pointerId),Z.current.set(I.pointerId,{x:I.clientX,y:I.clientY}),j.current={x:I.clientX,y:I.clientY})},[]),L=C.useCallback(I=>{const z=Z.current;if(z.has(I.pointerId)){if(z.set(I.pointerId,{x:I.clientX,y:I.clientY}),z.size===2){const V=Array.from(z.values()),O=V[1].x-V[0].x,W=V[1].y-V[0].y,q=Math.hypot(O,W),Y={x:(V[0].x+V[1].x)/2,y:(V[0].y+V[1].y)/2},ee=d.current,X=ee&&ee.getPointerPosition()||Y;if(ae.current!=null){const ne=q/Math.max(1,ae.current);f.zoomByFactor(ne,X)}ae.current=q,te.current=X}else if(z.size===1){const V=P();if(f.scale<=V)return;const O=I.clientX-j.current.x,W=I.clientY-j.current.y;j.current={x:I.clientX,y:I.clientY},f.panBy(O,W)}}},[]),G=C.useCallback(I=>{const z=c.current;z&&(z.releasePointerCapture?.(I.pointerId),Z.current.delete(I.pointerId),Z.current.size<2&&(ae.current=null),T.current=!1)},[]);return o.jsx("div",{ref:c,style:{width:"100%",height:"100%",display:"block",backgroundColor:"transparent",touchAction:"none",WebkitTouchCallout:"none"},className:"select-none",onPointerDown:se,onPointerMove:L,onPointerUp:G,children:o.jsx(sf,{ref:d,width:p.width,height:p.height,onWheel:_,onMouseDown:R,onMouseMove:N,onMouseUp:A,onMouseLeave:A,children:o.jsx(nf,{children:o.jsx(qo,{ref:y,x:f.translate.x,y:f.translate.y,scaleX:f.scale,scaleY:f.scale,children:(()=>{const I=(n%360+360)%360;let z=0,V=0;I===90?z=H:I===180?(z=M,V=H):I===270&&(V=M);try{console.log("[ViewerCanvas] rotatedGroup offset",{rotation:n,norm:I,tx:z,ty:V,canvasW:M,canvasH:H})}catch{}return o.jsxs(qo,{ref:v,x:z,y:V,rotation:n,children:[o.jsx(ca,{x:0,y:0,width:M,height:H,fill:"white"}),o.jsxs(qo,{x:E.x,y:E.y,scaleX:E.scale,scaleY:E.scale,children:[Array.isArray(e)?(console.log("[ViewerCanvas] Rendering",e.length,"drawing elements"),e.map((O,W)=>Q(O,W))):null,Array.isArray(t)&&t.map((O,W)=>o.jsxs(qo,{x:O.x,y:O.y,children:[o.jsx(ca,{width:O.width,height:O.height,fill:"#ffffff",stroke:"#d1d5db",strokeWidth:1,cornerRadius:6,shadowColor:"black",shadowBlur:2,shadowOffset:{x:1,y:1}}),o.jsx(Rl,{text:O.text,x:8,y:8,width:Math.max(0,(O.width||0)-16),height:Math.max(0,(O.height||0)-16),fontSize:O.fontSize||14,fill:O.color||"#000000",wrap:"word",align:"left",verticalAlign:"top"})]},`tb-${W}`))]})]})})()})})})})});ZA.displayName="ViewerCanvas";const Oz=({zoom:e,onZoomIn:t,onZoomOut:r,onRotate:n,onDownload:s,onFullscreen:a,isFullscreen:i})=>o.jsxs("div",{className:"absolute top-4 right-4 flex flex-col space-y-2 items-center justify-center",children:[o.jsx(rt,{onClick:t,variant:"secondary",size:"icon",className:"w-10 h-10",title:"Zoom In",children:o.jsx(mz,{className:"w-4 h-4 mx-auto my-auto"})}),o.jsx(rt,{onClick:r,variant:"secondary",size:"icon",className:"w-10 h-10",title:"Zoom Out",children:o.jsx(xz,{className:"w-4 h-4 mx-auto my-auto"})}),o.jsx(rt,{onClick:n,variant:"secondary",size:"icon",className:"w-10 h-10",title:"Rotate",children:o.jsx(fz,{className:"w-4 h-4 mx-auto my-auto"})}),o.jsx(rt,{onClick:s,variant:"secondary",size:"icon",className:"w-10 h-10",title:"Download",children:o.jsx(lz,{className:"w-4 h-4 mx-auto my-auto"})}),o.jsx(rt,{onClick:a,variant:"secondary",size:"icon",className:"w-10 h-10",title:i?"Exit Fullscreen":"Enter Fullscreen",children:i?o.jsx(qA,{className:"w-4 h-4 mx-auto my-auto"}):o.jsx(uz,{className:"w-4 h-4 mx-auto my-auto"})})]}),Lz=({currentQuestion:e,totalQuestions:t,onPrevious:r,onNext:n,drawingDataLength:s})=>t<=1?null:o.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(rt,{onClick:r,disabled:e===0,variant:"outline",size:"sm",children:"Previous"}),o.jsxs("span",{className:"text-sm text-gray-600",children:["Question ",e+1," of ",t]}),o.jsx(rt,{onClick:n,disabled:e===t-1,variant:"outline",size:"sm",children:"Next"})]}),o.jsxs("div",{className:"text-sm text-gray-500",children:[s," lines"]})]})}),e8=({drawing:e,isOpen:t,onClose:r,onScoreChange:n,onMaxScoreChange:s,isTeacherView:a=!1,onSaveScore:i})=>{const{drawingState:l,setDrawingState:c,drawingData:d,setDrawingData:f,textBoxes:p,setTextBoxes:g,saveToHistoryState:y,undo:v,redo:w,canUndoState:b,canRedoState:E}=kz(),{questionsData:k,currentQuestionIndex:_,setCurrentQuestionIndex:T}=Dz(e),{zoom:j,position:P,handleZoomIn:R,handleZoomOut:N}=Rz(XA,zo),{isFullscreen:A,enterFullscreen:M,exitFullscreen:H}=Iz(l,c),{handleTouchStart:Q,handleTouchMove:Z,handleTouchEnd:ae}=Pz(l,c,d,f,y,v,w,b,E),te=C.useRef(null),se=C.useRef(null),[L,G]=C.useState(1),[I,z]=C.useState(""),[V,O]=C.useState("");C.useEffect(()=>{if(console.log("DrawingModal - questionsData:",k),console.log("DrawingModal - currentQuestionIndex:",_),k.length>0){const _e=k[_]?.drawingData||[],Pe=k[_]?.textBoxes||[];console.log("DrawingModal - setting drawingData:",_e),console.log("DrawingModal - setting textBoxes:",Pe),f(_e),g(Pe)}},[k,_,f,g]),C.useEffect(()=>{t&&e&&(z((Number.isFinite(e.score)?e.score:0).toString()),O("10"))},[t,e]);const W=()=>{_>0&&T(_-1)},q=()=>{_<k.length-1&&T(_+1)},Y=()=>{b&&v()},ee=()=>{E&&w()};C.useEffect(()=>{const _e=Pe=>{(Pe.ctrlKey||Pe.metaKey)&&(Pe.key==="z"&&!Pe.shiftKey?(Pe.preventDefault(),Y()):(Pe.key==="y"||Pe.key==="z"&&Pe.shiftKey)&&(Pe.preventDefault(),ee()))};return document.addEventListener("keydown",_e),()=>document.removeEventListener("keydown",_e)},[Y,ee]);const X=()=>{c(_e=>({..._e,rotation:(_e.rotation+90)%360}))},ne=()=>{if(a&&se.current){const ye=se.current.exportPNGFullCanvas();if(!ye)return;const Fe=document.createElement("a");Fe.href=ye,Fe.download=`drawing-${e?.name||"student"}-${new Date().toISOString().split("T")[0]}.png`,document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe);return}const _e=te.current;if(!_e)return;const Pe=_e.toDataURL({mimeType:"image/png",quality:1,pixelRatio:1,x:0,y:0,width:zo.WIDTH,height:zo.HEIGHT}),ce=document.createElement("a");ce.href=Pe,ce.download=`drawing-${e?.name||"student"}-${new Date().toISOString().split("T")[0]}.png`,document.body.appendChild(ce),ce.click(),document.body.removeChild(ce)},ge=async()=>{if(!a)return r();const _e=parseInt(I,10),Pe=10;Number.isFinite(_e)&&(typeof i=="function"?await i({resultId:e.id,score:Math.max(0,Math.min(10,_e)),maxScore:Pe}):(n&&n(e.id,_e),s&&s(e.id,Pe))),r()};return!t||!e?null:o.jsx(ji,{children:o.jsx(Qe.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,children:o.jsxs(Qe.div,{className:"bg-white rounded-lg shadow-xl max-w-4xl h-[90vh] w-full mx-4 flex flex-col select-none",style:{touchAction:"none",WebkitTouchCallout:"none"},initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:_e=>_e.stopPropagation(),children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Drawing Submission"}),o.jsxs("p",{className:"text-sm text-gray-600",children:[e.name," ",e.surname," - ",e.test_name]})]}),o.jsx(rt,{onClick:r,variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",children:o.jsx(qA,{className:"w-5 h-5"})})]}),k.length>1&&o.jsx(Lz,{currentQuestion:_,totalQuestions:k.length,onPrevious:W,onNext:q,drawingDataLength:k[_]?.drawingData?.length||0}),o.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[o.jsxs("div",{className:"flex-1 min-h-0 relative overflow-hidden bg-gray-100 p-0 sm:p-4 select-none",style:{touchAction:"none",WebkitTouchCallout:"none"},children:[a?o.jsx(ZA,{ref:se,drawingData:d,textBoxes:p,canvasSize:{width:zo.WIDTH,height:zo.HEIGHT,WIDTH:zo.WIDTH,HEIGHT:zo.HEIGHT},rotation:l.rotation,onScaleChange:G}):o.jsx(QA,{ref:te,drawingData:d,textBoxes:p,drawingState:l,canvasSize:{width:zo.WIDTH,height:zo.HEIGHT,WIDTH:zo.WIDTH,HEIGHT:zo.HEIGHT},zoom:j,position:P,onTouchStart:Q,onTouchMove:Z,onTouchEnd:ae,mousePosition:{x:0,y:0},isMouseOverCanvas:!1,isEraserDrawing:!1}),o.jsx(Oz,{zoom:a?L:j,onZoomIn:()=>{if(a&&se.current){try{console.log("[ZoomButton] ZoomIn click (teacher)",{before:se.current.getScale?.()})}catch{}se.current.zoomIn(void 0),setTimeout(()=>{try{console.log("[ZoomButton] ZoomIn after",{after:se.current.getScale?.()})}catch{}},0)}else R()},onZoomOut:()=>{if(a&&se.current){try{console.log("[ZoomButton] ZoomOut click (teacher)",{before:se.current.getScale?.()})}catch{}se.current.zoomOut(void 0),setTimeout(()=>{try{console.log("[ZoomButton] ZoomOut after",{after:se.current.getScale?.()})}catch{}},0)}else N()},onRotate:X,onDownload:ne,onFullscreen:A?H:M,isFullscreen:A}),o.jsxs("div",{className:"absolute bottom-4 left-4 bg-gray-800 bg-opacity-70 text-white px-3 py-1 rounded-full text-sm",children:[Math.round((a?L:j)*100),"%"]})]}),a&&o.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Score:"}),o.jsx("input",{type:"number",min:"0",max:10,value:I,onChange:_e=>z(_e.target.value),className:"w-20 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Max:"}),o.jsx("input",{type:"number",value:10,disabled:!0,className:"w-20 px-3 py-1 text-sm border border-gray-300 rounded bg-gray-100"})]}),o.jsx(rt,{onClick:ge,variant:"primary",size:"sm",children:"Save"})]})})]})]})})})},t8=({testType:e,testId:t,studentAnswers:r,onBackToCabinet:n,compact:s=!1,showAll:a=!1,onToggleShowAll:i,maxInitial:l=3})=>{const c=Ii(),{user:d,isAuthenticated:f}=Wn(),{testResults:p,loadTestResults:g}=qp(),[y,v]=C.useState(!0),[w,b]=C.useState(""),[E,k]=C.useState([]),[_,T]=C.useState([]),[j,P]=C.useState(null),[R,N]=C.useState([]),[A,M]=C.useState(0),[H,Q]=C.useState(0),[Z,ae]=C.useState(!1),[te,se]=C.useState(null);C.useEffect(()=>{L()},[e,t]),C.useEffect(()=>{!e&&!t&&(p&&p.results?(console.log("🎓 Using cached test results from TestContext"),T(p.results),v(!1)):I())},[e,t,p]);const L=C.useCallback(async()=>{console.log("🎓 Initializing Student Results...");try{if(v(!0),b(""),!f||!d){console.log("🎓 User not authenticated"),b("User not authenticated");return}if(d.role!==fi.STUDENT){console.error("🎓 Invalid user role for student results:",d.role),b("Access denied. Student role required.");return}console.log("🎓 Loading test results..."),await g(d?.student_id||d?.id||""),e&&t&&r&&(console.log("🎓 Loading specific test results..."),await G(e,t,r)),console.log("🎓 Student Results initialization complete!")}catch(ee){console.error("🎓 Error initializing student results:",ee),b("Failed to initialize student results")}finally{v(!1)}},[f,d,e,t,r,g]),G=C.useCallback(async(ee,X,ne)=>{console.log("🎓 Loading specific test results:",ee,X);try{const ge=await ln.getTestInfo(ee,X);console.log("🎓 Test info loaded:",ge),P(ge);const _e=await ln.getTestQuestions(ee,X);console.log("🎓 Test questions loaded:",_e),N(_e);const Pe=$u(_e,ne,ee).score,ce=_e.length>0?Math.round(Pe/_e.length*100):0;M(Pe),Q(ce),console.log("🎓 Test results calculated:",{score:Pe,percentage:ce})}catch(ge){throw console.error("🎓 Error loading specific test results:",ge),ge}},[]),I=C.useCallback(async(ee=0)=>{console.log("🎓 Loading all student results using existing test results API...",ee>0?`(retry ${ee})`:"");try{if(!(d?.student_id||d?.sub))throw new Error("Student ID not found");const ne=await ln.getStudentTestResults();if(ne.success){console.log("🎓 All student results loaded:",ne.results.length,"results");const ge=ne.results.map(_e=>({..._e,caught_cheating:_e.caught_cheating||!1,visibility_change_times:_e.visibility_change_times||0}));T(ge),se(new Date),ne.results.length===0&&ee===0&&(console.log("🎓 No results found, retrying in 2 seconds..."),setTimeout(()=>{I(1)},2e3))}else throw new Error(ne.error||"Failed to load student results")}catch(X){console.error("🎓 Error loading all student results:",X),b(X.message)}},[d]),z=C.useCallback(ee=>({"Listening and Speaking":"L&S","Reading and Writing":"R&W","English for Career":"Eng for Career","Science Fundamental":"Science F","Science Supplementary":"Science S","Math Fundamental":"Math F","Math Supplementary":"Math S","English for Communication":"Eng for Comm"})[ee]||ee,[]),V=C.useCallback(ee=>{if(!ee||ee.length===0)return o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No results available"})});const X=a?ee:ee.slice(0,l);return o.jsxs("div",{className:"overflow-x-auto",children:[o.jsxs("table",{className:"w-full divide-y divide-gray-200",children:[o.jsx("thead",{className:"bg-gray-50",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),o.jsx("th",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),o.jsx("th",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Test Name"}),o.jsx("th",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Result"}),o.jsx("th",{className:"hidden sm:table-cell px-2 sm:px-4 lg:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),o.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:X.map((ne,ge)=>o.jsxs("tr",{className:"hover:bg-gray-50",children:[o.jsx("td",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-4 whitespace-nowrap text-xs font-medium text-gray-900",children:o.jsx("span",{className:"bg-blue-100 text-blue-800 px-0.5 sm:px-2 py-0.5 rounded text-xs",children:z(ne.subject)})}),o.jsx("td",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-4 whitespace-nowrap text-xs text-gray-500 truncate max-w-12 sm:max-w-none",children:ne.teacher_name}),o.jsx("td",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-4 whitespace-nowrap text-xs text-gray-500 truncate max-w-16 sm:max-w-none",children:ne.test_name}),o.jsx("td",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-4 whitespace-nowrap text-xs text-gray-500",children:o.jsx("div",{className:"flex flex-col items-center space-y-1",children:ne.test_type==="drawing"?ne.score!==null?o.jsxs("span",{className:`px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold ${Math.round(ne.score/ne.max_score*100)>=80?"bg-green-100 text-green-800":Math.round(ne.score/ne.max_score*100)>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[ne.score,"/",ne.max_score," (",Math.round(ne.score/ne.max_score*100),"%)"]}):o.jsx("span",{className:"px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-800",children:"Pending Review"}):ne.test_type==="speaking"?ne.score!==null?o.jsxs("span",{className:`px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold ${Math.round(ne.score/ne.max_score*100)>=80?"bg-green-100 text-green-800":Math.round(ne.score/ne.max_score*100)>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[ne.score,"/",ne.max_score," (",Math.round(ne.score/ne.max_score*100),"%)"]}):o.jsx("span",{className:"px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-800",children:"Pending Review"}):o.jsxs("span",{className:`px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold ${Math.round(ne.score/ne.max_score*100)>=80?"bg-green-100 text-green-800":Math.round(ne.score/ne.max_score*100)>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[ne.score,"/",ne.max_score," (",Math.round(ne.score/ne.max_score*100),"%)"]})})}),o.jsx("td",{className:"hidden sm:table-cell px-2 sm:px-4 lg:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:new Date(ne.submitted_at).toLocaleDateString()})]},ge))})]}),ee.length>l&&i&&o.jsx("div",{className:"text-center pt-4",children:o.jsx("button",{onClick:i,className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:a?"Show Less":`Show ${ee.length-l} More`})})]})},[z,a,l,i]),O=C.useCallback((ee,X)=>{if(console.log("🔍 formatAnswer called with:",{answer:ee,testType:X,answerType:typeof ee}),!ee)return"No answer";switch(X){case"true_false":const ne=typeof ee=="boolean"?ee:ee==="true";return console.log("🔍 Boolean answer processed:",ne),ne?"True":"False";case"multiple_choice":return ee.toUpperCase();case"input":return ee;case"word_matching":return typeof ee=="object"?Object.entries(ee).map(([ge,_e])=>`${ge} → ${_e}`).join(", "):ee;case"drawing":return"Drawing submitted";default:return ee}},[]),W=C.useCallback(()=>!j||!R||!r?null:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:["Test Results: ",j.test_name||j.title||"Test"]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold text-blue-600",children:A}),o.jsx("p",{className:"text-sm text-gray-500",children:"Correct Answers"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold text-gray-900",children:R.length}),o.jsx("p",{className:"text-sm text-gray-500",children:"Total Questions"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:`text-3xl font-bold ${H>=80?"text-green-600":H>=60?"text-yellow-600":"text-red-600"}`,children:[H,"%"]}),o.jsx("p",{className:"text-sm text-gray-500",children:"Score"})]})]})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Questions Review"}),o.jsx("div",{className:"space-y-4",children:R.map((ee,X)=>{const ne=r[X],ge=hp(ee,e),_e=g0(ee,ne,e);return o.jsxs("div",{className:`border rounded-lg p-4 ${_e?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("h4",{className:"font-medium text-gray-900",children:["Question ",X+1]}),o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${_e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:_e?"Correct":"Incorrect"})]}),o.jsx("p",{className:"text-gray-700 mb-3",children:ee.question}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Your Answer:"}),o.jsx("p",{className:"text-sm text-gray-900",children:O(ne,e)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Correct Answer:"}),o.jsx("p",{className:"text-sm text-gray-900",children:O(ge,e)})]})]})]},X)})})]})]}),[j,R,r,e,A,H,hp,g0,O]),q=C.useCallback(()=>{if(!_||_.length===0)return o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No test results available yet."})});const ee={};return _.forEach(X=>{const ne=X.subject||"Unknown Subject";ee[ne]||(ee[ne]=[]),ee[ne].push(X)}),o.jsx("div",{className:"space-y-6",children:Object.entries(ee).map(([X,ne])=>o.jsxs("div",{className:"bg-white rounded-lg shadow",children:[o.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:X})}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[o.jsx("thead",{className:"bg-gray-50",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Test Name"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Score"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),o.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ne.map((ge,_e)=>{const Pe=Math.round(ge.score/ge.max_score*100),ce=Pe>=80?"text-green-600":Pe>=60?"text-yellow-600":"text-red-600";return o.jsxs("tr",{className:"hover:bg-gray-50",children:[o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:ge.test_name}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:ge.teacher_name||"Unknown"}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:o.jsxs("span",{className:ce,children:[ge.score,"/",ge.max_score," (",Pe,"%)"]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(ge.submitted_at).toLocaleDateString()})]},_e)})})]})})]},X))})},[_]);C.useCallback(()=>{console.log("🎓 Clearing test data and returning to cabinet..."),P(null),N([]),setStudentAnswers(null),M(0),Q(0),ae(!1),n?n():c("/student")},[n,c]);const Y=C.useCallback(()=>{console.log("🎓 Navigating back to cabinet..."),n?n():c("/student")},[n,c]);return C.useCallback((ee,X)=>{const ne={id:Date.now(),message:ee,type:X,timestamp:new Date};k(ge=>[...ge,ne]),setTimeout(()=>{k(ge=>ge.filter(_e=>_e.id!==ne.id))},Vu.NOTIFICATION_DURATION)},[]),y?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Student Results..."})]})}):w?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Results Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:w}),o.jsx(rt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):s?o.jsxs("div",{children:[y?o.jsxs("div",{className:"text-center py-8",children:[o.jsx(Br,{size:"md"}),o.jsx("p",{className:"mt-2 text-gray-600",children:"Loading results..."})]}):w?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-red-500 text-4xl mb-2",children:"⚠️"}),o.jsx("p",{className:"text-red-600",children:w})]}):V(_),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:E.map(ee=>o.jsx(el,{type:ee.type,message:ee.message,onClose:()=>k(X=>X.filter(ne=>ne.id!==ee.id))},ee.id))})]}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Student Results"}),o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",te?te.toLocaleString():"Never"]})]}),o.jsxs("div",{className:"flex space-x-3",children:[j&&o.jsx(rt,{variant:"outline",onClick:()=>ae(!Z),children:Z?"Hide Details":"Show Details"}),o.jsx(rt,{variant:"outline",onClick:Y,children:"Back to Cabinet"})]})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:Z&&j?W():q()}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:E.map(ee=>o.jsx(el,{type:ee.type,message:ee.message,onClose:()=>k(X=>X.filter(ne=>ne.id!==ee.id))},ee.id))}),selectedDrawing&&o.jsx(e8,{drawing:selectedDrawing,isOpen:isDrawingModalOpen,onClose:()=>setIsDrawingModalOpen(!1)})]})},Bz=({isMenuOpen:e,onToggleMenu:t,onShowPasswordChange:r})=>{const n=Ii(),{user:s,isAuthenticated:a,logout:i}=Wn(),{studentData:l,loadStudentData:c}=tv(),{activeTests:d,testResults:f,loadActiveTests:p,loadTestResults:g,viewTestDetails:y,testDetailsModal:v,closeTestDetailsModal:w}=qp(),[b,E]=C.useState(!0),[k,_]=C.useState(""),[T,j]=C.useState([]),[P,R]=C.useState(null),[N,A]=C.useState(!1),[M,H]=C.useState(null),[Q,Z]=C.useState(null),[ae,te]=C.useState(new Set),[se,L]=C.useState(!1),[G,I]=C.useState(!1),[z,V]=C.useState(!1),[O,W]=C.useState(!1);C.useEffect(()=>{q()},[]),C.useEffect(()=>()=>{V(!1)},[]),C.useEffect(()=>{if(z){const ye=setTimeout(()=>{V(!1)},1e3);return()=>clearTimeout(ye)}},[z]);const q=C.useCallback(async()=>{console.log("🎓 Initializing Student Cabinet...");try{if(E(!0),_(""),!a||!s){console.log("🎓 User not authenticated, redirecting to login"),n("/login");return}if(s.role!==fi.STUDENT){console.error("🎓 Invalid user role for student cabinet:",s.role),_("Access denied. Student role required.");return}console.log("🎓 Loading active tests (single API call)...");const ye=s?.student_id||s?.id||"";if(Y(ye)){console.log("🎓 Cache refresh triggered - clearing cache");try{const Me=`student_active_tests_${ye}`,Oe=`student_results_table_${ye}`;localStorage.removeItem(Me),localStorage.removeItem(Oe)}catch{}}else console.log("🎓 Using existing cache - no refresh needed");try{localStorage.removeItem(`student_active_tests_${ye}`)}catch{}await p(ye),console.log("🎓 Student Cabinet initialization complete!")}catch(ye){console.error("🎓 Error initializing student cabinet:",ye),_("Failed to initialize student cabinet")}finally{E(!1)}},[a,s,n]),Y=C.useCallback(ye=>{if(window.studentCabinetRefreshRequested)return window.studentCabinetRefreshRequested=!1,console.log("🎓 Manual refresh requested"),!0;if(window.recentTestCompleted)return window.recentTestCompleted=!1,console.log("🎓 Test completed - cache refresh triggered"),!0;const Fe=localStorage.getItem(`last_cabinet_refresh_${ye}`);if(Fe&&Date.now()-parseInt(Fe)>1800*1e3)return console.log("🎓 Time-based refresh triggered"),!0;try{for(let Me=0;Me<localStorage.length;Me++){const Oe=localStorage.key(Me);if(Oe&&Oe.startsWith(`retest_assignment_id_${ye}_`))return console.log("🎓 Retest assignment key detected, forcing cache refresh:",Oe),!0}}catch{}return console.log("🎓 No refresh triggers - using existing cache"),!1},[]);C.useCallback(async()=>{console.log("🎓 Calculating average score...");try{if(f&&f.length>0){const ye=f.reduce((Me,Oe)=>typeof Oe.score=="number"&&typeof Oe.max_score=="number"&&Oe.max_score>0?Me+Math.round(Oe.score/Oe.max_score*100):Me,0),Fe=Math.round(ye/f.length);Z(Fe),console.log("🎓 Average score calculated:",Fe)}}catch(ye){console.error("🎓 Error calculating average score:",ye)}},[f]),C.useEffect(()=>{if(z){console.log("🎓 Skipping completed tests initialization during navigation");return}const ye=s?.student_id||s?.id;if(!ye){console.log("🎓 Student ID not available yet, skipping localStorage initialization");return}const Fe=new Set;for(let Me=0;Me<localStorage.length;Me++){const Oe=localStorage.key(Me);if(Oe&&Oe.startsWith(`test_completed_${ye}_`)&&localStorage.getItem(Oe)==="true"){const It=Oe.replace(`test_completed_${ye}_`,"").split("_");if(It.length>=2){const Ze=It[0],Le=It.slice(1).join("_"),De=`${Ze}_${Le}`;Fe.add(De),console.log("🎓 Found completed test in localStorage:",De)}}}te(Fe),W(!0),console.log("🎓 Initialized completed tests from localStorage:",Array.from(Fe))},[s?.student_id,s?.id,z]),C.useEffect(()=>{console.log("🎓 testResults structure:",f);const ye=f?.results||f;if(console.log("🎓 resultsArray:",ye),ye&&ye.length>0){const Fe=s?.student_id||s?.id||"",Me=new Set;ye.forEach(Oe=>{const He=`${Oe.test_type}_${Oe.test_id}`;Me.add(He),localStorage.setItem(`test_completed_${Fe}_${Oe.test_type}_${Oe.test_id}`,"true")}),te(Oe=>{const He=new Set([...Oe,...Me]);return console.log("🎓 Updated completed tests (merged):",Array.from(He)),He})}},[f,s?.student_id,s?.id]);const ee=C.useCallback(async(ye,Fe,Me=!1,Oe=null)=>{console.log("🎓 Checking test completion:",ye,Fe,"retestAvailable:",Me);try{const He=s?.student_id||s?.id||"";if(Me){console.log("🎓 Retest available from backend, checking attempt limits.");const De=[];for(let ut=1;ut<=10;ut++){const jt=`retest_attempt${ut}_${He}_${ye}_${Fe}`;localStorage.getItem(jt)==="true"&&De.push(jt)}const et=De.length,bt=Oe?.retest_attempts_left||Oe?.max_attempts||3;return console.log("🎓 Current attempts:",et,"Max attempts:",bt,"Attempt keys:",De),et>=bt?(console.log("🎓 Maximum retest attempts reached in localStorage"),!0):(console.log("🎓 Retest attempts available, allowing start."),!1)}const It=`test_completed_${He}_${ye}_${Fe}`,Ze=localStorage.getItem(It);if(console.log("🎓 localStorage key:",It),console.log("🎓 localStorage value:",Ze),ye==="word_matching"){console.log("🎓 Debug: All localStorage keys for student",He);for(let De=0;De<localStorage.length;De++){const et=localStorage.key(De);et&&et.includes(He)&&et.includes("word_matching")&&console.log("🎓 Found word_matching key:",et,"=",localStorage.getItem(et))}}if(Ze==="true")return console.log("✅ Found completion status in local storage:",Ze),!0;const Le=f?.results||f;return Le&&Le.length>0&&(console.log("🎓 Checking database results:",Le.length,"results"),Le.some(et=>(console.log("🎓 Checking result:",et.test_type,et.test_id,"vs",ye,Fe),et.test_type===ye&&et.test_id===Fe)))?(console.log("✅ Found completion status in database results"),localStorage.setItem(It,"true"),!0):(console.log("❌ Test not completed according to local storage or database"),!1)}catch(He){return console.error("🎓 Error checking test completion:",He),!1}},[f,s?.student_id,s?.id]),X=C.useCallback((ye,Fe)=>{const Me={id:Date.now(),message:ye,type:Fe,timestamp:new Date};j(Oe=>[...Oe,Me]),setTimeout(()=>{j(Oe=>Oe.filter(He=>He.id!==Me.id))},Vu.NOTIFICATION_DURATION)},[]),ne=C.useCallback(async ye=>{console.log("🎓 Showing test details:",ye);try{await y(ye.test_type,ye.test_id,ye.test_name)}catch(Fe){console.error("Error loading test details:",Fe),X("Failed to load test details","error")}},[y,X]),ge=C.useCallback(ye=>{console.log("🎓 Starting test:",ye);const Fe=`${ye.test_type}_${ye.test_id}`;if(ae.has(Fe)&&!ye?.retest_available){X("This test has already been completed","warning");return}if(console.log("🎓 Checking retest conditions:"),console.log("🎓 test.retest_available:",ye?.retest_available),console.log("🎓 testKey:",Fe),console.log("🎓 completedTests.has(testKey):",ae.has(Fe)),console.log("🎓 completedTests:",Array.from(ae)),ye?.retest_available){const Me=s?.student_id||s?.id||"",Oe=`retest1_${Me}_${ye.test_type}_${ye.test_id}`;localStorage.setItem(Oe,"true"),console.log("🎓 Set retest key:",Oe);try{const He=`test_completed_${Me}_${ye.test_type}_${ye.test_id}`;localStorage.removeItem(He);const It=`${ye.test_type}_${ye.test_id}`;localStorage.removeItem(It),console.log("🗑️ Cleared completion keys for retest:",He,It);const Ze=`retest_in_progress_${Me}_${ye.test_type}_${ye.test_id}`;localStorage.setItem(Ze,"1"),console.log("🔒 Set in-progress retest lock:",Ze);try{const Le=`anti_cheating_${Me}_${ye.test_type}_${ye.test_id}`;localStorage.removeItem(Le);const De=`speaking_test_data_${Me}_${ye.test_id}`;localStorage.removeItem(De);const et=`speaking_progress_${ye.test_id}`;localStorage.removeItem(et);const bt=`_${Me}_${ye.test_type}_${ye.test_id}`,ut=[];for(let Rt=0;Rt<localStorage.length;Rt++){const Xe=localStorage.key(Rt);Xe&&(Xe.endsWith(bt)||Xe.includes(`answers_${Me}_${ye.test_type}_${ye.test_id}`)||Xe.includes(`progress_${Me}_${ye.test_type}_${ye.test_id}`)||Xe.includes(`state_${Me}_${ye.test_type}_${ye.test_id}`)||Xe.includes(`selected_${Me}_${ye.test_type}_${ye.test_id}`))&&ut.push(Xe)}ut.forEach(Rt=>localStorage.removeItem(Rt)),console.log("🗑️ Cleared generic cached keys for retest start:",ut);const jt=`retest_attempts_${Me}_${ye.test_type}_${ye.test_id}`;console.log("🗑️ Cleared per-test cached keys for retest start:",{antiCheatKey:Le,speakingCacheKey:De,speakingProgressKey:et})}catch{}}catch{}if(console.log("🎓 Test retest_assignment_id:",ye.retest_assignment_id),console.log("🎓 Test retest_assignment_id type:",typeof ye.retest_assignment_id),ye?.retest_assignment_id){const He=`retest_assignment_id_${Me}_${ye.test_type}_${ye.test_id}`;localStorage.setItem(He,String(ye.retest_assignment_id)),console.log("🎓 Set retest assignment ID:",He,"=",ye.retest_assignment_id)}else console.log("🎓 No retest assignment ID found in test data")}else console.log("🎓 Retest assignment ID storage skipped - retest not available");if(V(!0),console.log("🎓 Set isStartingTest to true for test:",ye.test_type),ye.test_type==="matching_type"){console.log("🎯 Redirecting to matching test page for testId:",ye.test_id),n(`/student/matching-test/${ye.test_id}`);return}if(ye.test_type==="word_matching"){console.log("🎯 Redirecting to word matching test page for testId:",ye.test_id),n(`/student/word-matching-test/${ye.test_id}`);return}if(ye.test_type==="speaking"){console.log("🎤 Redirecting to speaking test page for testId:",ye.test_id),n(`/student/speaking-test/${ye.test_id}`);return}n(`/student/test/${ye.test_type}/${ye.test_id}`)},[n,ae,X,s?.student_id,s?.id]),_e=C.useCallback(()=>{L(ye=>!ye)},[]),Pe=C.useCallback(()=>{I(ye=>!ye)},[]),ce=C.useCallback(async ye=>{if(console.log("🎓 Starting test:",ye),z){console.log("🎓 Test already starting, ignoring click");return}try{if(await ee(ye.test_type,ye.test_id,ye?.retest_available,ye)&&!ye?.retest_available){X("This test has already been completed","warning");return}ge(ye)}catch(Fe){console.error("🎓 Error starting test:",Fe),X("Failed to start test. Please try again.","error")}},[ee,ge,X,z]);return C.useCallback(ye=>{console.log("🎓 Viewing test details:",ye),ne(ye)},[ne]),b?o.jsx(Qe.div,{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:o.jsxs(Qe.div,{className:"text-center",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsx(Br,{size:"lg"}),o.jsx(Qe.p,{className:"mt-4 text-gray-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.3},children:"Loading Student Cabinet..."})]})}):k?o.jsx(Qe.div,{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:o.jsx(Qe.div,{className:"text-center",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.5},children:o.jsxs(Qe.div,{className:"bg-white border border-red-200 rounded-xl p-8 max-w-md shadow-lg",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3,duration:.3},children:[o.jsx(Qe.div,{className:"text-4xl mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.4,duration:.3,type:"spring"},children:"⚠️"}),o.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Cabinet Error"}),o.jsx("p",{className:"text-red-600 mb-6",children:k}),o.jsx(rt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):o.jsxs(Qe.div,{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[o.jsx(Qe.div,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-6",children:[o.jsxs(Qe.div,{className:"flex items-center space-x-4",initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(Qe.div,{className:"h-12 w-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.3,type:"spring"},whileHover:{scale:1.1},children:o.jsx("span",{className:"text-white font-semibold text-xl",children:s?.name?.charAt(0)||"S"})})}),o.jsxs("div",{children:[o.jsxs("h1",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white",children:[s?.name," ",s?.surname]}),o.jsxs("p",{className:"text-blue-100 text-sm sm:text-base md:text-lg",children:["Grade ",s?.grade," - Class ",s?.class]})]})]}),o.jsxs(Qe.div,{className:"relative",initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3,duration:.5},children:[o.jsxs("button",{onClick:t,className:"flex items-center space-x-1 sm:space-x-2 bg-white/10 border-white/20 text-white hover:bg-white/20 font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm border-2",style:{zIndex:1e3},children:[o.jsx("span",{className:"hidden sm:inline",children:"Menu"}),o.jsx(Qe.svg,{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:{rotate:e?180:0},transition:{duration:.2},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]}),o.jsx(ji,{children:e&&o.jsx(Qe.div,{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg z-50 overflow-hidden",initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},children:o.jsxs("div",{className:"py-2",children:[o.jsx(Qe.button,{onClick:r,className:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 transition-colors",whileHover:{x:4},transition:{duration:.2},children:"Change Password"}),o.jsx(Qe.button,{onClick:()=>{t(),i()},className:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-red-50 transition-colors",whileHover:{x:4},transition:{duration:.2},children:"Logout"})]})})})]})]})})}),o.jsxs(Qe.div,{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.5},children:[o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:o.jsx("div",{className:"lg:col-span-1 space-y-6",children:Q!==null&&o.jsx(Qe.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.7,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{children:"Average Score"})}),o.jsx(kt.Body,{children:o.jsxs(Qe.div,{className:"text-center",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.8,duration:.3},children:[o.jsxs(Qe.div,{className:"text-4xl font-bold text-blue-600 mb-2",initial:{scale:0},animate:{scale:1},transition:{delay:.9,duration:.5,type:"spring"},children:[Q,"%"]}),o.jsx("p",{className:"text-sm text-gray-500",children:"Overall Performance"})]})})]})})})}),o.jsxs("div",{className:"space-y-6",children:[o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{className:"text-center",children:"Active Tests"})}),o.jsx(kt.Body,{children:d&&d.length>0?o.jsxs("div",{className:"relative",children:[console.log("🎓 Rendering overlay, isStartingTest:",z),z&&o.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50 rounded-lg border-2 border-blue-200",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-blue-600 font-semibold text-lg",children:"Starting test..."}),o.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Please wait..."})]})}),o.jsxs("div",{className:"space-y-4",children:[(se?d:d.slice(0,3)).map((ye,Fe)=>o.jsx(Qe.div,{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:se?0:.7+Fe*.1,duration:.3},whileHover:{scale:1.02},children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("div",{className:"flex-1",children:o.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[o.jsx("h3",{className:"text-sm sm:text-lg font-medium text-gray-900 w-16 sm:w-auto break-words leading-tight line-clamp-2 sm:line-clamp-none",children:ye.test_name}),o.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:ye.subject}),o.jsx("span",{className:"text-gray-500",children:ye.teacher_name}),o.jsxs("span",{className:"text-gray-500",children:[o.jsx("span",{className:"sm:hidden",children:new Date(ye.assigned_at).toLocaleDateString("en-US",{year:"2-digit",month:"numeric",day:"numeric"})}),o.jsx("span",{className:"hidden sm:inline",children:new Date(ye.assigned_at).toLocaleDateString()})]})]})}),o.jsx("div",{className:"flex space-x-2 ml-4",children:(()=>{const Me=`${ye.test_type}_${ye.test_id}`,Oe=ae.has(Me);if(!O)return o.jsx(rt,{variant:"secondary",size:"sm",disabled:!0,className:"bg-gray-100 text-gray-500 border-gray-200",children:"Loading..."});if(Oe&&ye?.retest_available){const He=s?.student_id||s?.id||"";let It=!1;try{const Ze=localStorage.getItem(`retest_attempts_${He}_${ye.test_type}_${ye.test_id}`);if(Ze){const Le=JSON.parse(Ze);typeof Le?.used=="number"&&typeof Le?.max=="number"&&Le.used>=Le.max&&(It=!0)}}catch{}return It?o.jsx(rt,{variant:"secondary",size:"xs",disabled:!0,className:"bg-green-100 text-green-800 border-green-200",children:"✓ Completed"}):o.jsx(rt,{variant:"primary",size:"sm",onClick:()=>ce(ye),disabled:z,children:"Start Retest"})}return Oe?o.jsx(rt,{variant:"secondary",size:"xs",disabled:!0,className:"bg-green-100 text-green-800 border-green-200",children:"✓ Completed"}):(console.log("🎓 Button render, isStartingTest:",z,"test:",ye.test_type),o.jsx(rt,{variant:"primary",size:"sm",onClick:()=>ce(ye),disabled:z,children:"Start Test"}))})()})]})},`${ye.test_type}_${ye.test_id}`)),d.length>3&&o.jsx("div",{className:"text-center pt-2",children:o.jsx("button",{onClick:_e,className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:se?"Show Less":`Show ${d.length-3} More`})})]})]}):o.jsxs(Qe.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7,duration:.3},children:[o.jsx(Qe.div,{className:"text-6xl mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.8,duration:.5,type:"spring"},children:"📝"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No Active Tests"}),o.jsx("p",{className:"text-gray-500",children:"No active tests available for your class at the moment."})]})})]})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{children:"Test Results"})}),o.jsx(kt.Body,{children:f&&f.showResults?o.jsx(Xp,{testResults:f,onBackToCabinet:()=>{setTestResults(null)},onRetakeTest:(ye,Fe)=>{p(),setTestResults(null)},isLoading:b}):o.jsx(t8,{compact:!0,showAll:G,onToggleShowAll:Pe,maxInitial:3})})]})})]})]}),o.jsx(HA,{isOpen:v.isOpen,onClose:w,testType:v.testType,testId:v.testId,testName:v.testName,questions:v.questions||[],isLoading:v.isLoading||!1}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:T.map(ye=>o.jsx(el,{type:ye.type,message:ye.message,onClose:()=>j(Fe=>Fe.filter(Me=>Me.id!==ye.id))},ye.id))})]})},Uz=({testInfo:e,questions:t,testType:r,studentAnswers:n,onBackToCabinet:s,checkAnswerCorrectness:a,formatStudentAnswerForDisplay:i,getCorrectAnswer:l})=>{const[c,d]=C.useState(0),[f,p]=C.useState(0),[g,y]=C.useState(!0);if(C.useEffect(()=>{const b=()=>{try{const E=$u(t,n,r).score,k=e?.num_questions||t?.length||0,_=k>0?Math.round(E/k*100):0;d(E),p(_),y(!1)}catch(E){console.error("Error calculating test results:",E),d(0),p(0),y(!1)}};t&&t.length>0?b():y(!1)},[t,n,r,e,$u]),g)return o.jsx("div",{className:"flex justify-center items-center min-h-64",children:o.jsx("div",{className:"text-lg",children:"Calculating results..."})});const v=e?.num_questions||t?.length||0,w=e?.test_name||e?.title||"Test";return o.jsxs("div",{className:"test-results-page max-w-4xl mx-auto p-6 overflow-y-auto min-h-screen",children:[o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"results-header text-center",children:[o.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:["Test Results: ",w]}),o.jsx("p",{className:"text-gray-600",children:r==="matching_type"?"Matching Test":r==="multiple_choice"?"Multiple Choice Test":r==="true_false"?"True/False Test":r==="input"?"Input Test":r==="drawing"?"Drawing Test":"Test"})]})}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"results-summary",children:[o.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 text-center",children:["Your Score: ",c," / ",v," (",f,"%)"]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-4",children:o.jsx("div",{className:`h-4 rounded-full transition-all duration-500 ${f>=80?"bg-green-500":f>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${f}%`}})}),o.jsx("div",{className:"text-center",children:o.jsx("p",{className:`text-lg font-medium ${f>=80?"text-green-600":f>=60?"text-yellow-600":"text-red-600"}`,children:f>=80?"Excellent!":f>=60?"Good job!":"Keep practicing!"})})]})}),t&&t.length>0&&o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"questions-review",children:[o.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Question Review"}),o.jsx("div",{className:"space-y-4",children:t.map((b,E)=>{const k=n[String(b.question_id)]||"No answer";console.log("🔍 TestResultsDisplay - Question",E+1,":",{question:b,studentAnswer:k,testType:r});const _=a(b,k,r);return console.log("🔍 TestResultsDisplay - isCorrect result:",_),o.jsxs("div",{className:`question-review p-4 rounded-lg border-2 ${_?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[o.jsxs("div",{className:"question-review-header flex justify-between items-start mb-3",children:[o.jsxs("h4",{className:"text-lg font-medium text-gray-800",children:["Question ",E+1]}),o.jsx("span",{className:`text-2xl font-bold ${_?"text-green-600":"text-red-600"}`,children:_?"✓":"✗"})]}),o.jsx("div",{className:"question-text mb-3",children:o.jsx("p",{className:"text-gray-700 font-medium",children:b.question})}),o.jsxs("div",{className:"answer-section space-y-2",children:[o.jsxs("p",{className:"student-answer",children:[o.jsx("strong",{className:"text-gray-600",children:"Your Answer:"})," ",o.jsx("span",{className:`font-medium ${_?"text-green-700":"text-red-700"}`,children:i(k,r,b)})]}),!_&&o.jsxs("p",{className:"correct-answer",children:[o.jsx("strong",{className:"text-gray-600",children:"Correct Answer:"})," ",o.jsx("span",{className:"text-green-700 font-medium",children:r==="multiple_choice"?String(b.correct_answer||"").toUpperCase():i(l(b,r),r,b)})]})]})]},b.question_id||E)})})]})}),o.jsx(kt,{children:o.jsx("div",{className:"results-actions text-center",children:o.jsx(rt,{onClick:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 text-lg font-medium",children:"Back to Cabinet"})})})]})};class $z{constructor(){this.activeRequests=new Map,this.completedRequests=new Map,this.maxCacheSize=100,this.cacheTimeout=3e4}generateKey(t,r,n={}){const s=Object.keys(n).sort().reduce((a,i)=>(a[i]=n[i],a),{});return`${t}_${r}_${JSON.stringify(s)}`}isRequestInProgress(t){return this.activeRequests.has(t)}getCachedResult(t){const r=this.completedRequests.get(t);return r&&Date.now()-r.timestamp<this.cacheTimeout?r.result:null}startRequest(t,r){return this.activeRequests.set(t,r),r.finally(()=>{this.activeRequests.delete(t)}),r}cacheResult(t,r){if(this.completedRequests.size>=this.maxCacheSize){const n=this.completedRequests.keys().next().value;this.completedRequests.delete(n)}this.completedRequests.set(t,{result:r,timestamp:Date.now()})}async deduplicateApiCall(t,r,n,s){const a=this.generateKey(t,r,n);if(this.isRequestInProgress(a))return console.log("🔄 API deduplication: Request already in progress, waiting...",a),this.activeRequests.get(a);const i=this.getCachedResult(a);if(i)return console.log("🔄 API deduplication: Using cached result",a),i;console.log("🔄 API deduplication: Making new request",a);const l=this.startRequest(a,s());try{const c=await l;return this.cacheResult(a,c),c}catch(c){throw c}}clearCache(){this.activeRequests.clear(),this.completedRequests.clear(),console.log("🧹 API deduplication: Cache cleared")}}const mE=new $z,Wz=(e,t)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout(()=>e.apply(null,n),t)}},zz=({onBackToCabinet:e,currentTest:t})=>{const r=Ii(),{user:n,isAuthenticated:s}=Wn(),{activeTests:a,loadActiveTests:i}=qp(),l=C.useCallback(Wz((le,pe,be)=>{try{if(window.skipInitialProgressSave&&be.answers&&be.answers.length===0){console.log("🛡️ Skipping empty progress save during restoration"),window.skipInitialProgressSave=!1;return}const Ct=`test_progress_${n?.student_id||n?.id||"unknown"}_${le}_${pe}`,Et=localStorage.getItem(Ct);if(Et&&be.answers&&be.answers.length===0)try{const Be=JSON.parse(Et);if(Be.answers&&Be.answers.length>0){console.log("🛡️ Skipping empty progress save - existing progress is better:",Be.answers);return}}catch{}localStorage.setItem(Ct,JSON.stringify(be)),console.log(`Saved test progress for ${le}_${pe}:`,be)}catch(Ve){console.error("Error saving test progress:",Ve)}},1e3),[n?.student_id,n?.id]),c=C.useCallback((le,pe,be)=>{l(le,pe,be)},[l]),d=C.useCallback((le,pe)=>{try{const Ve=`test_progress_${n?.student_id||n?.id||"unknown"}_${le}_${pe}`,Ct=localStorage.getItem(Ve);return Ct?JSON.parse(Ct):null}catch(be){return console.error("Error getting test progress:",be),null}},[n?.student_id,n?.id]),f=C.useCallback((le,pe)=>{try{const be=n?.student_id||n?.id||"unknown",Ve=`test_progress_${be}_${le}_${pe}`;localStorage.removeItem(Ve);for(let Ct=0;Ct<localStorage.length;Ct++){const Et=localStorage.key(Ct);Et&&Et.startsWith(`test_progress_${be}_${le}_${pe}_`)&&(localStorage.removeItem(Et),console.log(`🧹 Cleared individual question key: ${Et}`))}console.log(`Cleared test progress for ${le}_${pe}`)}catch(be){console.error("Error clearing test progress:",be)}},[n?.student_id,n?.id]),[p,g]=C.useState(!0),[y,v]=C.useState(!1),[w,b]=C.useState(""),[E,k]=C.useState(!1),[_,T]=C.useState(""),[j,P]=C.useState([]),[R,N]=C.useState(t?"test":"list"),[A,M]=C.useState(null),[H,Q]=C.useState(null),[Z,ae]=C.useState(null),[te,se]=C.useState([]),[L,G]=C.useState([]),[I,z]=C.useState(0),[V,O]=C.useState(0),[W,q]=C.useState(null),Y=us.useRef(null),ee=us.useRef(null),[X,ne]=C.useState(!1),[ge,_e]=C.useState(!1),[Pe,ce]=C.useState(null),[ye,Fe]=C.useState(null),[Me,Oe]=C.useState({isInitialized:!1,initializationId:null,lastTestId:null,initializationCount:0}),[He,It]=C.useState({isRestored:!1,restoredTestId:null,restorationCount:0}),{startTracking:Ze,stopTracking:Le,getCheatingData:De,clearData:et,isCheating:bt,tabSwitches:ut}=D0(A?.test_type,A?.test_id,n?.student_id||n?.id);C.useEffect(()=>{(()=>{const pe=[];for(let be=0;be<localStorage.length;be++){const Ve=localStorage.key(be);if(Ve&&Ve.startsWith("test_progress_")&&!Ve.includes("_51712_")&&!Ve.includes("_51736_")){const Ct=Ve.split("_");Ct.length===4&&Ct[0]==="test"&&Ct[1]==="progress"&&pe.push(Ve)}}pe.forEach(be=>{localStorage.removeItem(be),console.log("🧹 Cleared old cache key:",be)})})()},[]);const jt=C.useCallback(()=>{const le=A?.test_id,pe=n?.student_id||n?.id;if(!pe||!le)return console.log("🛡️ Skipping initialization - missing required data:",{studentId:pe,currentTestId:le}),!1;const be=`${pe}_${le}_${Date.now()}`;return Me.isInitialized&&Me.lastTestId===le?(console.log("🛡️ Already initialized for this test - skipping"),!1):Me.initializationId?(console.log("🛡️ Initialization in progress - skipping duplicate"),!1):(console.log("🚀 Starting initialization:",be),Oe({isInitialized:!1,initializationId:be,lastTestId:le}),!0)},[Me,A,n?.student_id,n?.id]),Rt=C.useCallback(()=>{Oe(le=>({...le,isInitialized:!0,initializationId:null})),console.log("✅ Initialization completed")},[]),Xe=C.useCallback(async()=>{console.log("🎓 Initializing Student Tests...");try{if(g(!0),T(""),!s||!n){console.log("🎓 User not authenticated"),T("User not authenticated");return}if(n.role!==fi.STUDENT){console.error("🎓 Invalid user role for student tests:",n.role),T("Access denied. Student role required.");return}console.log("🎓 Loading active tests..."),await i(),Rt(),console.log("🎓 Student Tests initialization complete!")}catch(le){console.error("🎓 Error initializing student tests:",le),T("Failed to initialize student tests")}finally{g(!1)}},[s,n,i,Rt]);C.useEffect(()=>{jt()&&Xe()},[jt,Xe]),C.useEffect(()=>{t&&(console.log("🎯 Auto-starting test from prop:",t),k(!0),mt(t))},[t]),C.useCallback(async()=>{console.log("🎓 Loading student active tests...");try{const le=await ln.getActiveTests();console.log("🎓 Active tests loaded:",le);const pe=le.map(be=>({...be,subject_id:be.subject_id||be.subjectId,teacher_id:be.teacher_id||be.teacherId,is_active:be.is_active!==void 0?be.is_active:!0,created_at:be.created_at||be.createdAt,updated_at:be.updated_at||be.updatedAt}));return Fe(new Date),pe}catch(le){throw console.error("🎓 Error loading active tests:",le),le}},[]),C.useCallback(async(le,pe)=>{console.log("🎓 Checking test completion:",le,pe);try{const be=d(le,pe);return be&&be.completed}catch(be){return console.error("🎓 Error checking test completion:",be),!1}},[d]),C.useEffect(()=>{if(te.length>0&&A?.test_id){const le=setTimeout(()=>{let pe=!1;const be=new Array(te.length).fill("");if(te.forEach((Ve,Ct)=>{const Be=`test_progress_${n?.student_id||n?.id||"unknown"}_${H}_${A?.test_id}_${Ve.question_id}`,at=localStorage.getItem(Be);if(at){const dt=at.replace(/^"(.*)"$/,"$1");be[Ct]=dt,pe=!0}}),pe){G(be);const Ve=be.filter(Et=>Et&&typeof Et=="string"&&Et.trim()!=="").length,Ct=te.length>0?Ve/te.length*100:0;z(Ct)}},100);return()=>clearTimeout(le)}},[te,H,A?.test_id]);const Ye=C.useCallback(async(le,pe)=>{console.log("🎓 Marking test as completed:",le,pe);try{const be=d(le,pe)||{};be.completed=!0,be.completedAt=new Date().toISOString(),c(le,pe,be);const Ct=`test_completed_${n?.student_id||n?.id||""}_${le}_${pe}`;localStorage.setItem(Ct,"true"),console.log("🎓 Test completion marked in localStorage:",Ct),console.log("🎓 localStorage value after setting:",localStorage.getItem(Ct)),fr("Test marked as completed","success")}catch(be){console.error("🎓 Error marking test as completed:",be),fr("Failed to mark test as completed","error")}},[d,c]),pt=C.useCallback(le=>{console.log("🎓 Showing test details:",le),ce(le),_e(!0)},[]),mt=C.useCallback(async le=>{console.log("🎓 Starting test:",le);let pe=Date.now(),be;try{b(""),v(!0),pe=Date.now();const Ve=()=>{const Re=Date.now()-pe,de=Math.max(0,250-Re);setTimeout(()=>{g(!1),v(!1)},de)};let Ct=!1;be=setTimeout(()=>{Ct=!0,b("Loading is taking longer than expected...")},15e3);const Be=`test_completed_${n?.student_id||n?.id||""}_${le.test_type}_${le.test_id}`,at=localStorage.getItem(Be)==="true";if(at&&!le?.retest_available){console.log("🎓 Test already completed, redirecting to main cabinet"),fr("This test has already been completed","info"),r("/student");return}if(at&&le?.retest_available&&console.log("🎓 Test completed but retest available, allowing retest"),le.test_type===wn.MATCHING){console.log("🎯 Redirecting to matching test page for testId:",le.test_id),r(`/student/matching-test/${le.test_id}`);return}if(le.test_type===wn.WORD_MATCHING){console.log("🎯 Redirecting to word matching test page for testId:",le.test_id),r(`/student/word-matching-test/${le.test_id}`);return}M(le),Q(le.test_type),It({isRestored:!1,restoredTestId:null,restorationCount:0});const[dt,zt]=await Promise.all([mE.deduplicateApiCall("GET",`test-info-${le.test_type}-${le.test_id}`,{testType:le.test_type,testId:le.test_id},()=>ln.getTestInfo(le.test_type,le.test_id)),mE.deduplicateApiCall("GET",`test-questions-${le.test_type}-${le.test_id}`,{testType:le.test_type,testId:le.test_id},()=>ln.getTestQuestions(le.test_type,le.test_id))]);ae(dt);let Yt=zt;try{if(!!dt?.is_shuffled){const ie=n?.student_id||n?.id||"unknown",de=`${ie}:${le.test_type}:${le.test_id}`,Ce=Array.from(de).reduce((Je,yt)=>(Je<<5)-Je+yt.charCodeAt(0),0)>>>0,Ne=`test_shuffle_order_${ie}_${le.test_type}_${le.test_id}`,Ge=localStorage.getItem(Ne);if(Ge){const Je=JSON.parse(Ge),yt=new Map(zt.map(Vt=>[Vt.question_id,Vt]));Yt=Je.map(Vt=>yt.get(Vt)).filter(Boolean)}else{const yt=function(gt){return function(){var Ot=gt+=1831565813;return Ot=Math.imul(Ot^Ot>>>15,Ot|1),Ot^=Ot+Math.imul(Ot^Ot>>>7,Ot|61),((Ot^Ot>>>14)>>>0)/4294967296}}(Ce);Yt=[...zt];for(let gt=Yt.length-1;gt>0;gt--){const Ot=Math.floor(yt()*(gt+1));[Yt[gt],Yt[Ot]]=[Yt[Ot],Yt[gt]]}const Vt=Yt.map(gt=>gt.question_id);localStorage.setItem(Ne,JSON.stringify(Vt))}}}catch(Re){console.error("Shuffle error (ignored):",Re)}se(Yt),Ve();const wr=le.test_id;if(He.isRestored&&He.restoredTestId===wr){console.log("🛡️ Progress already restored for this test - skipping");return}console.log("🔄 Starting progress restoration for test:",le.test_type,le.test_id),It(Re=>({...Re,restorationCount:Re.restorationCount+1}));const Ur=n?.student_id||n?.id||"unknown",yr=`test_progress_${Ur}_${le.test_type}_${le.test_id}`,ur=localStorage.getItem(yr);console.log("🔍 Checking main progress key:",yr),console.log("🔍 Main progress data:",ur);let oe=new Array(zt.length).fill("");if(ur)try{const Re=JSON.parse(ur);console.log("🔍 Parsed progress data:",Re),Re.answers&&Array.isArray(Re.answers)&&(oe=Re.answers,console.log("✅ Loaded answers from main progress:",oe))}catch(Re){console.error("🔍 Error parsing main progress:",Re)}zt.forEach((Re,ie)=>{const de=`test_progress_${Ur}_${le.test_type}_${le.test_id}_${Re.question_id}`,Ce=localStorage.getItem(de);if(console.log(`🔍 Checking individual answer for question ${Re.question_id}:`,Ce),Ce){const Ne=Ce.replace(/^"(.*)"$/,"$1");oe[ie]=Ne,console.log(`✅ Loaded individual answer for question ${Re.question_id}:`,Ne)}}),console.log("🔍 Final initial answers after loading all sources:",oe);const we=oe.filter(Re=>Re&&typeof Re=="string"&&Re.trim()!=="").length;if(we>0){console.log(`🔄 Restoring progress: ${we}/${zt.length} questions answered`),G(oe);const Re=zt.length>0?we/zt.length*100:0;z(Re),console.log(`🔄 Progress restored: ${Re}% complete`)}else console.log("🆕 No existing progress found - starting fresh"),G(oe),z(0);It(Re=>({...Re,isRestored:!0,restoredTestId:wr})),we>0&&(console.log("🛡️ Existing progress found - preventing overwrite during initialization"),window.skipInitialProgressSave=!0);const fe=Number(dt?.allowed_time||0),me=n?.student_id||n?.id||"unknown";if(Y.current=`test_timer_${me}_${le.test_type}_${le.test_id}`,fe>0)try{const Re=localStorage.getItem(Y.current),ie=Date.now();if(Re){const de=JSON.parse(Re),Ce=Math.floor((ie-new Date(de.lastTickAt).getTime())/1e3),Ne=Math.max(0,Number(de.remainingSeconds||fe)-Math.max(0,Ce));O(Ne),ee.current=ie}else O(fe),ee.current=ie,localStorage.setItem(Y.current,JSON.stringify({remainingSeconds:fe,lastTickAt:new Date(ie).toISOString(),startedAt:new Date(ie).toISOString()}))}catch(Re){console.error("Timer cache init error:",Re),O(fe)}else O(0);const Se=new Date;q(Se),console.log("⏱️ Test timer started at:",Se.toISOString());const ke=n?.student_id||n?.id||"unknown",We=`anti_cheating_${ke}_${le.test_type}_${le.test_id}`,ft=localStorage.getItem(We);if(console.log("🛡️ Checking for anti-cheating data with key:",We),console.log("🛡️ Key format: anti_cheating_{studentId}_{testType}_{testId}"),console.log("🛡️ Current test details:",{testType:le.test_type,testId:le.test_id,studentId:ke}),ft)try{const Re=JSON.parse(ft);console.log("🛡️ Found existing anti-cheating data for THIS test:",Re),console.log("🛡️ Visibility change times for this test:",Re.tabSwitches||0),console.log("🛡️ Cheating status for this test:",Re.isCheating||!1),Re.isCheating&&(console.log("⚠️ WARNING: Student has been flagged for cheating in THIS test!"),console.log("⚠️ Tab switches detected in this test:",Re.tabSwitches),fr(`⚠️ Warning: Suspicious activity detected in this test (${Re.tabSwitches} tab switches). Continued violations may result in test disqualification.`,"warning"))}catch(Re){console.error("🛡️ Error parsing existing anti-cheating data:",Re)}else console.log("🛡️ No existing anti-cheating data found for this test - starting fresh");Ze(),console.log("🛡️ Anti-cheating tracking started"),N("test"),console.log("🎓 Test started successfully")}catch(Ve){console.error("🎓 Error starting test:",Ve),fr("Failed to start test","error"),b("Failed to load test data. Please try again.")}finally{const Ve=Date.now()-pe,Et=Math.max(0,250-Ve);setTimeout(()=>{g(!1),v(!1)},Et),k(!1);try{be&&clearTimeout(be)}catch{}}},[d]),_t=C.useCallback(async()=>{if(!A||!Z||!te||!L){fr("No test data to submit","error");return}console.log("🎓 Submitting test:",A);try{ne(!0);const le=$u(te,L,A.test_type),pe=new Date,be=W?Math.round((pe-W)/1e3):0,Ve=W?W.toISOString():pe.toISOString();console.log("⏱️ Test timing:",{startedAt:Ve,endTime:pe.toISOString(),timeTaken:`${be} seconds`});const Ct=De();console.log("🛡️ Anti-cheating data for submission:",Ct);const Et={};te.forEach((at,dt)=>{Et[at.question_id]=L[dt]??""}),A.test_type==="drawing"&&(console.log("🎨 Drawing test answers being submitted:",L),console.log("🎨 Drawing test answers type:",typeof L[0]),console.log("🎨 Drawing test answers content:",L[0]));const Be=await ln.submitTest(A.test_type,A.test_id,L,{time_taken:(()=>{const at=Number(Z?.allowed_time||0);return at>0?Math.min(be,at):be})(),started_at:Ve,submitted_at:pe.toISOString(),answers_by_id:Et,question_order:te.map(at=>at.question_id),caught_cheating:Ct.caught_cheating,visibility_change_times:Ct.visibility_change_times,retest_assignment_id:(()=>{const dt=`retest_assignment_id_${n?.student_id||n?.id||""}_${A.test_type}_${A.test_id}`,zt=localStorage.getItem(dt);return console.log("🎨 Frontend retest key:",dt),console.log("🎨 Frontend retest assignment ID from localStorage:",zt),console.log("🎨 Frontend retest assignment ID converted:",zt?Number(zt):null),console.log("🎨 Frontend current test data:",A),console.log("🎨 Frontend current test retest_assignment_id:",A.retest_assignment_id),zt?Number(zt):null})(),parent_test_id:A.test_id},n);if(console.log("🎓 Test submission result:",Be),Be.success){window.recentTestCompleted=!0,console.log("🎓 Test completed - cache refresh triggered");const at=n?.student_id||n?.id||"",dt=`retest1_${at}_${A.test_type}_${A.test_id}`;if(localStorage.getItem(dt)==="true"){const ur=A?.retest_attempts_left||A?.max_attempts||3;if((Be?.percentage_score??0)>=50){const we=`retest_attempt${ur}_${at}_${A.test_type}_${A.test_id}`;localStorage.setItem(we,"true"),console.log("🎓 Passed retest, marking last-slot key:",we),localStorage.removeItem(dt)}else{let we=1;for(let me=1;me<=10;me++){const Se=`retest_attempt${me}_${at}_${A.test_type}_${A.test_id}`;if(localStorage.getItem(Se)!=="true"){we=me;break}}const fe=`retest_attempt${we}_${at}_${A.test_type}_${A.test_id}`;localStorage.setItem(fe,"true"),console.log("🎓 Marked retest attempt as completed:",fe),we>=ur&&localStorage.removeItem(dt)}}if(console.log("🎓 Marking test as completed..."),await Ye(A.test_type,A.test_id),A.test_type!=="drawing"){console.log("🎓 Caching test results after submission...");const oe=`student_results_table_${n?.student_id||n?.id||"unknown"}`,{setCachedData:we,CACHE_TTL:fe}=await hi(async()=>{const{setCachedData:me,CACHE_TTL:Se}=await Promise.resolve().then(()=>Uh);return{setCachedData:me,CACHE_TTL:Se}},void 0);we(oe,Be,fe.student_results_table),console.log("🎓 Test results cached with key:",oe)}else console.log("🎓 Drawing test submitted - not caching results (will appear after teacher grades)");console.log("🎓 Clearing test progress..."),f(A.test_type,A.test_id);try{const ur=n?.student_id||n?.id||"unknown",oe=`test_timer_${ur}_${A.test_type}_${A.test_id}`;localStorage.removeItem(oe);const we=`test_shuffle_order_${ur}_${A.test_type}_${A.test_id}`;localStorage.removeItem(we)}catch{}if(n?.student_id){const ur=`test_completed_${n.student_id}_${A.test_type}_${A.test_id}`;localStorage.setItem(ur,"true"),console.log("✅ Test marked as completed in localStorage:",ur)}try{const ur=n?.student_id||n?.id||"",oe=`retest1_${ur}_${A.test_type}_${A.test_id}`,we=`retest_assignment_id_${ur}_${A.test_type}_${A.test_id}`;localStorage.removeItem(oe),localStorage.removeItem(we),console.log("🧹 Cleared retest keys:",oe,we)}catch(ur){console.warn("Failed to clear retest keys:",ur)}console.log("🧹 Clearing test progress and anti-cheating data for THIS test only...");const Yt=n?.student_id||n?.id||"unknown",wr=[],Ur=`test_progress_${Yt}_${A.test_type}_${A.test_id}`,yr=`anti_cheating_${Yt}_${A.test_type}_${A.test_id}`;for(let ur=0;ur<localStorage.length;ur++){const oe=localStorage.key(ur);oe&&(oe===Ur||oe===yr)&&wr.push(oe)}wr.forEach(ur=>{localStorage.removeItem(ur),console.log(`🧹 Cleared for THIS test only: ${ur}`)}),console.log("🛡️ Clearing anti-cheating data..."),Le(),et(),A.test_type!=="drawing"?N("results"):r("/student"),fr("Test submitted successfully!","success"),console.log("🎓 Test submitted successfully")}else throw console.error("🎓 Test submission failed:",Be.error),new Error(Be.error||"Failed to submit test")}catch(le){console.error("🎓 Error submitting test:",le),fr("Failed to submit test","error")}finally{ne(!1)}},[A,Z,te,L,Ye,f]);C.useCallback(()=>(console.log("🎓 Collecting test answers..."),L),[L]);const Ht=C.useCallback(()=>{if(!te||!L)return;const le=L.filter(be=>be&&typeof be=="string"&&be.trim()!=="").length,pe=te.length>0?le/te.length*100:0;if(z(pe),console.log(`🎓 Progress updated: ${le}/${te.length} questions answered (${Math.round(pe)}%)`),A){const be={answers:L,progress:pe,lastSaved:new Date().toISOString()};c(A.test_type,A.test_id,be)}},[te,L,A,c]);C.useEffect(()=>{Ht()},[Ht]);const Qt=C.useCallback(()=>{if(!L)return 0;const le=L.filter(pe=>pe&&typeof pe=="string"&&pe.trim()!=="").length;return console.log("🎓 getAnsweredCount:",{studentAnswers:L,answeredCount:le,totalQuestions:te?.length}),le},[L,te]),nr=C.useCallback(()=>{if(console.log("🎓 Navigating back to cabinet..."),A&&n?.student_id){console.log("🛡️ Cabinet navigation detected - counting as cheating attempt");const pe=`anti_cheating_${n?.student_id||n?.id||"unknown"}_${A.test_type}_${A.test_id}`,be=localStorage.getItem(pe);let Ve=0,Ct=!1;if(be)try{const dt=JSON.parse(be);Ve=dt.tabSwitches||0,Ct=dt.isCheating||!1}catch(dt){console.error("🛡️ Error parsing existing anti-cheating data:",dt)}const Et=Ve+1,Be=Et>=2;console.log(`🛡️ Tab switch count: ${Ve} → ${Et} (cheating: ${Be})`);const at={tabSwitches:Et,isCheating:Be,lastUpdated:new Date().toISOString()};localStorage.setItem(pe,JSON.stringify(at)),console.log("🛡️ Anti-cheating data updated for cabinet navigation:",at)}e?e():r("/student")},[e,r,A,n?.student_id]);C.useCallback(()=>{console.log("🎓 Showing test results..."),N("results")},[]);const Nr=C.useCallback((le,pe,be=null)=>{switch(console.log("🎓 Formatting student answer for display:",le,"testType:",pe,"question:",be),pe){case wn.MULTIPLE_CHOICE:if(le.toString().startsWith("Option "))return le;if(be&&typeof le=="string"&&!isNaN(parseInt(le))){const Ve=parseInt(le),Ct=`option_${String.fromCharCode(97+Ve)}`,Et=be[Ct];if(Et)return console.log("🎓 Converted",le,"to option text:",Et),Et;{const Be=String.fromCharCode(65+Ve);return console.log("🎓 Converted",le,"to",Be),Be}}else{if(typeof le=="string"&&isNaN(parseInt(le)))return console.log("🎓 Already formatted text:",le),le;{const Ve=String.fromCharCode(65+parseInt(le));return console.log("🎓 Converted",le,"to",Ve),Ve}}case wn.TRUE_FALSE:return le==="true"?"True":"False";case wn.INPUT:return le;case wn.MATCHING:return typeof le=="object"?JSON.stringify(le):le;case wn.WORD_MATCHING:return typeof le=="object"?JSON.stringify(le):le;case wn.DRAWING:return le&&le.trim()!==""?"Drawing submitted":"No drawing";case wn.FILL_BLANKS:return le;default:return console.warn("🎓 Unknown test type for answer formatting:",pe),le}},[]),fr=C.useCallback((le,pe)=>{const be={id:Date.now(),message:le,type:pe,timestamp:new Date};P(Ve=>[...Ve,be]),setTimeout(()=>{P(Ve=>Ve.filter(Ct=>Ct.id!==be.id))},Vu.NOTIFICATION_DURATION)},[]);C.useEffect(()=>{Ht()},[Ht]),C.useEffect(()=>{if(R!=="test")return;const le=Number(Z?.allowed_time||0);if(!le)return;const pe=setInterval(()=>{O(be=>{const Ve=Math.max(0,be-1);try{const Ct=Date.now();ee.current||(ee.current=Ct),Y.current&&localStorage.setItem(Y.current,JSON.stringify({remainingSeconds:Ve,lastTickAt:new Date(Ct).toISOString(),startedAt:W?W.toISOString():new Date(Ct-(le-Ve)*1e3).toISOString()}))}catch{}return Ve===0&&_t(),Ve})},1e3);return()=>clearInterval(pe)},[R,Z?.allowed_time,_t,W]);const hr=C.useCallback((le,pe)=>{if(!le)return null;const be=(Ve,Ct)=>{const Et=[...L];Et[pe]=Ct,G(Et),console.log(`🎓 Answer changed: question ${Ve} = ${Ct}`),console.log("🎓 Updated studentAnswers:",Et)};switch(A.test_type){case wn.TRUE_FALSE:return o.jsx(IW,{question:le,questionIndex:pe,studentAnswer:L[pe]||"",onAnswerChange:be,mode:"student",testId:A?.test_id,testType:H,displayNumber:pe+1});case wn.MULTIPLE_CHOICE:return o.jsx(MW,{question:le,questionIndex:pe,studentAnswer:L[pe]||"",onAnswerChange:be,mode:"student",testId:A?.test_id,testType:H,displayNumber:pe+1});case wn.INPUT:return o.jsx(OW,{question:le,questionIndex:pe,studentAnswer:L[pe]||"",onAnswerChange:be,mode:"student",testId:A?.test_id,testType:H,displayNumber:pe+1});case wn.MATCHING:return console.error("Matching test reached renderQuestion - this should not happen"),o.jsxs("div",{className:"text-center p-8",children:[o.jsx("h2",{className:"text-xl font-semibold text-gray-600 mb-4",children:"Matching Test"}),o.jsx("p",{className:"text-gray-500 mb-4",children:"Redirecting to matching test page..."}),o.jsx(rt,{onClick:()=>r("/student"),variant:"primary",children:"Back to Dashboard"})]});case wn.DRAWING:return o.jsx(VW,{question:le,questionIndex:pe,studentAnswer:L[pe]||"",onAnswerChange:be,mode:"student",testId:A?.test_id,testType:H});case wn.FILL_BLANKS:return pe===0?o.jsx(YW,{testText:Z?.test_text,blanks:(te||[]).map((Ve,Ct)=>({id:Ve.question_id||Ct+1,options:Ve.blank_options||[],correct_answer:Ve.correct_answers?.[0]||Ve.correct_answer,question:Ve.question_json||""})),separateType:Z?.separate_type,testId:A?.test_id,testName:Z?.test_name||A?.test_name,teacherId:Z?.teacher_id||A?.teacher_id,subjectId:Z?.subject_id||A?.subject_id,onTestComplete:_t,onAnswerChange:(Ve,Ct)=>{const Et=te.findIndex(Be=>Be.question_id===Ve);if(Et!==-1){const Be=[...L];Be[Et]=Ct,G(Be),console.log(`🎓 Fill Blanks answer changed: question ${Ve} = ${Ct}`)}}},`fill-blanks-${A?.test_id}-${Z?.test_name}`):null;default:return o.jsx("div",{children:"Unsupported question type"})}},[A,L,H]);function sr(){return!A||!Z||!te?null:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("div",{className:"flex justify-between items-center mb-4",children:o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:Z.test_name||Z.title||"Test"})}),o.jsx("div",{className:"mb-4",children:o.jsx(XW,{answeredCount:Qt(),totalQuestions:te.length,percentage:Math.round(I),timeElapsed:Number(Z?.allowed_time||0)>0?V:0,showDetails:!0})})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Answer all questions below:"}),o.jsx("div",{className:"space-y-8",children:te.map((le,pe)=>o.jsx("div",{className:"question-container",children:hr(le,pe)},le.question_id||pe))})]}),o.jsx("div",{className:"flex justify-center",children:o.jsx(rt,{variant:"primary",size:"lg",onClick:_t,disabled:X||Qt()<te.length,loading:X,children:X?"Submitting...":`Submit Test (${Qt()}/${te.length})`})})]})}if(p)return o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:t?"Starting Test...":"Loading Student Tests..."})]})});if(_)return o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Tests Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:_}),o.jsx(rt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})});return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Student Test"})}),o.jsx(rt,{variant:"outline",onClick:nr,children:"Back to Cabinet"})]})})}),bt&&R==="results"&&o.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 p-4 mx-4 sm:mx-6 lg:mx-8 mt-4",children:o.jsxs("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),o.jsx("div",{className:"ml-3",children:o.jsxs("p",{className:"text-sm text-red-700",children:[o.jsx("strong",{children:"Academic Integrity Warning:"}),"This test has been flagged for suspicious behavior. You have switched tabs ",ut," times during the test."]})})]})}),o.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 overflow-y-auto",children:[!t&&R==="list"&&Er(),R==="test"&&sr(),R==="results"&&he()]}),R==="test"&&y&&o.jsxs("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-[1px] flex flex-col items-center justify-center z-50",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-3 text-gray-700",children:"Preparing your test…"}),w&&o.jsx("div",{className:"mt-3 text-sm text-gray-500",children:w})]}),o.jsx(HA,{isOpen:ge,onClose:()=>_e(!1),testType:Pe?.test_type,testId:Pe?.test_id,testName:Pe?.test_name,questions:Pe?.questions,isLoading:p}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:j.map(le=>o.jsx(el,{type:le.type,message:le.message,onClose:()=>P(pe=>pe.filter(be=>be.id!==le.id))},le.id))})]});function Er(){return!a||a.length===0?o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No active tests available for your class."})}):o.jsx("div",{className:"space-y-6",children:a.map((le,pe)=>o.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:le.test_name}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Subject:"})," ",le.subject]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Teacher:"})," ",le.teacher_name]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Type:"})," ",le.test_type]})]}),o.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Assigned: ",new Date(le.assigned_at).toLocaleDateString()]})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx(rt,{variant:"outline",onClick:()=>pt(le),disabled:E||p,children:"View Details"}),o.jsx(rt,{variant:"primary",onClick:()=>mt(le),disabled:E||p,children:E?"Starting...":"Start Test"})]})]})},pe))})}function he(){if(!A||!Z||!te||!L)return null;const le={};return L.forEach((pe,be)=>{if(te[be]){const Ve=te[be].question_id||te[be].id||be;le[String(Ve)]=pe,console.log("🔍 Converting answer:",{index:be,questionId:Ve,answer:pe,question:te[be]})}}),console.log("🔍 Final answersObject:",le),console.log("🔍 Questions structure:",te.map(pe=>({id:pe.question_id,correct_answer:pe.correct_answer}))),o.jsx(Uz,{testInfo:Z,questions:te,testType:A.test_type,studentAnswers:le,onBackToCabinet:nr,checkAnswerCorrectness:g0,formatStudentAnswerForDisplay:Nr,getCorrectAnswer:hp})}},Hz=()=>{const{testId:e}=F1(),t=Ii(),{user:r}=Wn(),{makeAuthenticatedRequest:n}=Ji(),{showNotification:s}=da(),[a,i]=C.useState(null),[l,c]=C.useState(!0),[d,f]=C.useState(null),[p,g]=C.useState(null),[y,v]=C.useState(!1);D0("matching_type",a?.id);const w=C.useCallback(()=>{if(!r?.student_id||!e)return!1;const T=`test_completed_${r.student_id}_matching_type_${e}`,j=localStorage.getItem(T)==="true",P=`retest1_${r.student_id}_matching_type_${e}`,R=localStorage.getItem(P)==="true";return j&&!R?(console.log("🎓 Test already completed, redirecting to cabinet"),s("This test has already been completed","info"),t("/student"),!0):!1},[r?.student_id,e,t,s]),b=C.useCallback(async()=>{if(!e){f("Test ID is required"),c(!1);return}if(!w())try{c(!0),f(null);const T=await n(`/.netlify/functions/get-matching-type-test?test_id=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!T.ok)throw new Error("Failed to load test data");const j=await T.json();if(!j.success)throw new Error(j.message||"Failed to load test");const P=j.data;console.log("🔍 Test data from get-matching-type-test:",P);const R=await n(`/.netlify/functions/get-test-questions?test_id=${e}&test_type=matching_type`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!R.ok)throw new Error("Failed to load test questions");const N=await R.json();if(!N.success)throw new Error(N.message||"Failed to load test questions");console.log("🔍 Questions data from get-test-questions:",N);const A={id:P.test_id,test_name:P.test_name,teacher_id:P.teacher_id,subject_id:P.subject_id,image_url:P.image_url,image:null,blocks:(()=>{if(Array.isArray(N.questions)&&N.questions.length>0){const M=N.questions[0];return Array.isArray(M.blocks)?M.blocks.map((H,Q)=>{let Z=H.block_coordinates||H.coordinates||(typeof H.x=="number"?{x:H.x,y:H.y,width:H.width,height:H.height}:null);if(typeof Z=="string")try{Z=JSON.parse(Z)}catch{Z=null}return(!Z||typeof Z!="object")&&(Z={x:0,y:0,width:30,height:10}),Z={x:(typeof Z.x=="number"?Z.x:Number(Z.x))||0,y:(typeof Z.y=="number"?Z.y:Number(Z.y))||0,width:(typeof Z.width=="number"?Z.width:Number(Z.width))||30,height:(typeof Z.height=="number"?Z.height:Number(Z.height))||10},{id:H.block_id||H.question_id||H.id||Q+1,word:H.word||`Word ${Q+1}`,coordinates:Z,hasArrow:!!H.has_arrow,arrow:H.arrow||null}}):N.questions.map(H=>{console.log("🔍 Processing question:",H);let Q;try{Q=typeof H.block_coordinates=="string"?JSON.parse(H.block_coordinates):H.block_coordinates}catch{Q={x:0,y:0,width:100,height:100}}return(!Q||typeof Q!="object")&&(Q={x:0,y:0,width:100,height:100}),Q={x:(typeof Q.x=="number"?Q.x:Number(Q.x))||0,y:(typeof Q.y=="number"?Q.y:Number(Q.y))||0,width:(typeof Q.width=="number"?Q.width:Number(Q.width))||100,height:(typeof Q.height=="number"?Q.height:Number(Q.height))||100},{id:H.question_id,word:H.word,coordinates:Q,hasArrow:H.has_arrow,arrow:H.arrow}})}return[]})(),words:(()=>{if(Array.isArray(N.questions)&&N.questions.length>0){const M=N.questions[0];if(Array.isArray(M.words)){const H=M.words,Q=Array.isArray(M.blocks)?M.blocks:[];return typeof H[0]=="string"?H.map((ae,te)=>({id:`w_${Q[te]?.question_id||Q[te]?.block_id||N.questions[te]?.question_id||te+1}_${te}`,word:String(ae),blockId:null,isPlaced:!1,isCorrect:!1})):H.map((ae,te)=>({id:`w_${ae.question_id||ae.id||te+1}_${te}`,word:ae.word||String(ae.text||""),blockId:null,isPlaced:!1,isCorrect:!1}))}return N.questions.map(H=>({id:`w_${H.question_id}`,word:H.word,blockId:null,isPlaced:!1,isCorrect:!1}))}return[]})(),arrows:P.arrows?P.arrows.map(M=>(console.log("🔍 Processing arrow:",M),{id:M.id,questionId:M.question_id,blockId:M.block_id||M.question_id,start:{x:Number(M.start_x)||0,y:Number(M.start_y)||0},end:{x:Number(M.end_x)||0,y:Number(M.end_y)||0},rel_start_x:M.rel_start_x!==null?Number(M.rel_start_x):null,rel_start_y:M.rel_start_y!==null?Number(M.rel_start_y):null,rel_end_x:M.rel_end_x!==null?Number(M.rel_end_x):null,rel_end_y:M.rel_end_y!==null?Number(M.rel_end_y):null,image_width:M.image_width?Number(M.image_width):null,image_height:M.image_height?Number(M.image_height):null,style:(typeof M.style=="string"?JSON.parse(M.style):M.style)||{color:"#dc3545",thickness:3}})):[]};if(P.image_url){const M=new Image;M.crossOrigin="anonymous",M.onload=()=>{A.image=M,i(A),c(!1)},M.onerror=()=>{console.warn("Failed to load test image"),i(A),c(!1)},M.src=P.image_url}else i(A),c(!1)}catch(T){console.error("Error loading test data:",T),f(T.message||"Failed to load test"),c(!1)}},[e,n]);C.useEffect(()=>{r?.student_id&&b()},[b,r?.student_id]);const E=C.useCallback(async T=>{console.log("Test completed:",T),s("Test completed successfully!","success");const j=parseInt(T)||0,P=a?.blocks?.length||a?.words?.length||0,R=P>0?Math.round(j/P*100):0,N={showResults:!0,testInfo:{test_name:a?.test_name||"Test",id:a?.id,test_id:a?.id},testType:"matching_type",score:j,totalQuestions:P,percentage:R,passed:R>=60,questionAnalysis:a?.questions?.map((A,M)=>({questionNumber:M+1,isCorrect:M<j,userAnswer:M<j?`Matched: ${A.word}`:"Not answered",correctAnswer:`Match: ${A.word}`}))||Array.from({length:P},(A,M)=>({questionNumber:M+1,isCorrect:M<j,userAnswer:M<j?"Matched":"Not answered",correctAnswer:"Match required"})),timestamp:new Date().toISOString(),caught_cheating:!1,visibility_change_times:0};console.log("🎯 Using test results data:",N),g(N),v(!0)},[a,s]),k=C.useCallback(()=>{t("/student")},[t]),_=C.useCallback(()=>{v(!1),g(null),b()},[b]);return l?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx(kt,{className:"max-w-md w-full",children:o.jsxs(kt.Body,{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading test..."})]})})}):d?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx(kt,{className:"max-w-md w-full",children:o.jsxs(kt.Body,{className:"text-center",children:[o.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Test"}),o.jsx("p",{className:"text-gray-600 mb-4",children:d}),o.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Dashboard"})]})})}):a?y&&p?o.jsx("div",{className:"bg-gray-50 overflow-y-auto min-h-screen",children:o.jsx(Xp,{testResults:p,onBackToCabinet:k,onRetakeTest:_,isLoading:!1})}):o.jsx(LW,{testData:a,onTestComplete:E,onBackToCabinet:k}):o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx(kt,{className:"max-w-md w-full",children:o.jsxs(kt.Body,{className:"text-center",children:[o.jsx("div",{className:"text-gray-500 text-6xl mb-4",children:"📝"}),o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Test Data"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Unable to load test data"}),o.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Dashboard"})]})})})},Gz=()=>{const{testId:e}=F1(),t=Ii(),{user:r}=Wn(),{makeAuthenticatedRequest:n}=Ji(),{showNotification:s}=da(),[a,i]=C.useState(null),[l,c]=C.useState(!0),[d,f]=C.useState(null),[p,g]=C.useState(null),[y,v]=C.useState(!1),w=C.useCallback(()=>{if(!r?.student_id||!e)return!1;const _=`test_completed_${r.student_id}_word_matching_${e}`,T=`retest1_${r.student_id}_word_matching_${e}`;return localStorage.getItem(T)==="true"?!1:localStorage.getItem(_)==="true"},[r?.student_id,e]),b=C.useCallback(async()=>{if(!e){f("Test ID is required"),c(!1);return}if(w()){s("This test has already been completed","warning"),t("/student");return}c(!0),f(null);try{const _=`word_matching_test_${e}`,T=Jn(_);if(T){if(console.log("🎯 Word matching test loaded from cache:",T),T.id){let R=T;if(Array.isArray(R.rightWords)&&Array.isArray(R.correctPairs)){const N=R.rightWords.map((Q,Z)=>Z);for(let Q=N.length-1;Q>0;Q--){const Z=Math.floor(Math.random()*(Q+1));[N[Q],N[Z]]=[N[Z],N[Q]]}const A=N.map(Q=>R.rightWords[Q]),M=new Map(N.map((Q,Z)=>[Q,Z])),H=R.correctPairs.map(Q=>M.get(Q));R={...R,rightWords:A,correctPairs:H}}i(R)}else{let N={id:T.test_id,test_id:T.test_id,test_name:T.test_name,teacher_id:T.teacher_id,subject_id:T.subject_id,num_questions:T.num_questions,interaction_type:T.interaction_type,passing_score:T.passing_score,created_at:T.created_at,updated_at:T.updated_at,leftWords:T.leftWords,rightWords:T.rightWords,correctPairs:T.correctPairs,originalPairs:T.originalPairs};if(Array.isArray(N.rightWords)&&Array.isArray(N.correctPairs)){const A=N.rightWords.map((Z,ae)=>ae);for(let Z=A.length-1;Z>0;Z--){const ae=Math.floor(Math.random()*(Z+1));[A[Z],A[ae]]=[A[ae],A[Z]]}const M=A.map(Z=>N.rightWords[Z]),H=new Map(A.map((Z,ae)=>[Z,ae])),Q=N.correctPairs.map(Z=>H.get(Z));N={...N,rightWords:M,correctPairs:Q}}i(N)}c(!1);return}const P=await(await n(`/.netlify/functions/get-word-matching-test?test_id=${e}`)).json();if(P.success){const R={id:P.data.test_id,test_id:P.data.test_id,test_name:P.data.test_name,teacher_id:P.data.teacher_id,subject_id:P.data.subject_id,num_questions:P.data.num_questions,interaction_type:P.data.interaction_type,passing_score:P.data.passing_score,created_at:P.data.created_at,updated_at:P.data.updated_at,leftWords:P.data.leftWords,rightWords:P.data.rightWords,correctPairs:P.data.correctPairs,originalPairs:P.data.originalPairs};let N=R;if(Array.isArray(N.rightWords)&&Array.isArray(N.correctPairs)){const A=N.rightWords.map((Z,ae)=>ae);for(let Z=A.length-1;Z>0;Z--){const ae=Math.floor(Math.random()*(Z+1));[A[Z],A[ae]]=[A[ae],A[Z]]}const M=A.map(Z=>N.rightWords[Z]),H=new Map(A.map((Z,ae)=>[Z,ae])),Q=N.correctPairs.map(Z=>H.get(Z));N={...N,rightWords:M,correctPairs:Q}}i(N),Qn(_,N,hs.word_matching_test),console.log("🎯 Word matching test loaded from API and cached:",R)}else throw new Error(P.message||"Failed to load test")}catch(_){console.error("Error loading word matching test:",_),f(_.message),s("Failed to load test: "+_.message,"error")}finally{c(!1)}},[e,w,n,s,t]),E=C.useCallback(async _=>{console.log("Test completed:",_),s("Test completed successfully!","success");const T=parseInt(_)||0,j=a?.num_questions||0,P=j>0?Math.round(T/j*100):0,R={showResults:!0,testInfo:{test_name:a?.test_name||"Test",id:a?.id,test_id:a?.id},testType:"word_matching",score:T,totalQuestions:j,percentage:P,passed:P>=60,questionAnalysis:Array.isArray(a?.correctPairs)?a.correctPairs.map((N,A)=>({questionNumber:A+1,isCorrect:A<T,userAnswer:A<T?`${N.left} → ${N.right}`:"Not answered",correctAnswer:`${N.left} → ${N.right}`})):Array.from({length:j},(N,A)=>({questionNumber:A+1,isCorrect:A<T,userAnswer:A<T?"Matched":"Not answered",correctAnswer:"Match required"})),timestamp:new Date().toISOString(),caught_cheating:!1,visibility_change_times:0};console.log("🎯 Using test results data:",R),g(R),v(!0)},[a,s]),k=C.useCallback(()=>{t("/student")},[t]);return C.useEffect(()=>{b()},[b]),l?o.jsx("div",{className:"flex justify-center items-center min-h-screen",children:o.jsxs(kt,{className:"p-8 text-center",children:[o.jsx(Br,{size:"lg",className:"mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading word matching test..."})]})}):d?o.jsx("div",{className:"flex justify-center items-center min-h-screen",children:o.jsx(kt,{className:"p-8 text-center",children:o.jsxs("div",{className:"text-red-600 mb-4",children:[o.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),o.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Loading Test"}),o.jsx("p",{className:"text-gray-600 mb-4",children:d}),o.jsx("button",{onClick:()=>t("/student"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Cabinet"})]})})}):a?y&&p?o.jsx("div",{className:"bg-gray-50 overflow-y-auto min-h-screen",children:o.jsx(Xp,{testResults:p,onBackToCabinet:()=>{g(null),v(!1),t("/student")},onRetakeTest:(_,T)=>{g(null),v(!1),b()},isLoading:!1})}):o.jsx(Qe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"min-h-screen bg-gray-50 py-8",children:o.jsx($W,{testData:a,onTestComplete:E,onBackToCabinet:k})}):o.jsx("div",{className:"flex justify-center items-center min-h-screen",children:o.jsx(kt,{className:"p-8 text-center",children:o.jsxs("div",{className:"text-gray-600 mb-4",children:[o.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Test Not Found"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"The requested test could not be found."}),o.jsx("button",{onClick:()=>t("/student"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Cabinet"})]})})})},Vz=C.forwardRef(({onRecordingComplete:e,minDuration:t=0,maxDuration:r=600,minWords:n=50,maxAttempts:s=3,currentAttempt:a=1},i)=>{const[l,c]=C.useState(!1),[d,f]=C.useState(!1),[p,g]=C.useState(0),[y,v]=C.useState(null),[w,b]=C.useState(null),[E,k]=C.useState("good"),_=C.useRef(null),T=C.useRef([]),j=C.useRef(null),P=C.useRef(null),R=C.useRef(null),N=C.useRef(null),A=C.useRef(null);C.useImperativeHandle(i,()=>({startRecording:()=>M(),stopRecording:()=>H(),pauseRecording:()=>Q(),resumeRecording:()=>Z()}));const M=C.useCallback(async()=>{try{if(b(null),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Microphone access is not supported in this browser. Please use a modern browser like Chrome, Safari, or Firefox.");if(!window.isSecureContext&&!window.location.hostname.includes("localhost"))throw new Error("Microphone access requires HTTPS. Please use a secure connection.");const G=window.AudioContext||window.webkitAudioContext;R.current||(R.current=new G),R.current.state!=="running"&&await R.current.resume().catch(()=>{}),console.log("🎤 Requesting microphone permission...");const I=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:1}});console.log("🎤 Microphone permission granted"),j.current=I;try{let q=document.getElementById("ios-audio-sink");q||(q=document.createElement("audio"),q.id="ios-audio-sink",q.muted=!0,q.playsInline=!0,q.style.display="none",document.body.appendChild(q)),q.srcObject=I,await q.play().catch(()=>{})}catch{}const z=R.current.createAnalyser();R.current.createMediaStreamSource(I).connect(z),z.fftSize=256,N.current=z,ae();let O="audio/webm;codecs=opus";typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported&&!MediaRecorder.isTypeSupported(O)&&(MediaRecorder.isTypeSupported("audio/mp4")?O="audio/mp4":MediaRecorder.isTypeSupported("audio/aac")?O="audio/aac":O="");const W=new MediaRecorder(I,O?{mimeType:O}:void 0);_.current=W,T.current=[],W.ondataavailable=q=>{q.data.size>0&&T.current.push(q.data)},W.onstop=()=>{const q=O&&O.startsWith("audio/")?O:"audio/webm",Y=new Blob(T.current,{type:q});v(Y),e(Y,p),j.current&&j.current.getTracks().forEach(ee=>ee.stop()),A.current&&cancelAnimationFrame(A.current)},W.start(1e3),c(!0),g(0),P.current=setInterval(()=>{g(q=>{const Y=q+1;return Y>=r&&H(),Y})},1e3)}catch(G){console.error("Error starting recording:",G);const I=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;G.name==="NotAllowedError"?b(I?"Microphone access denied. Please go to Settings > Safari > Microphone and allow access, then refresh the page.":"Microphone access denied. Please allow microphone access in your browser settings and try again."):G.name==="NotFoundError"?b("No microphone found. Please connect a microphone and try again."):G.name==="NotSupportedError"?b("Microphone access is not supported in this browser. Please use a modern browser like Chrome, Safari, or Firefox."):G.message.includes("HTTPS")?b("Microphone access requires HTTPS. Please use a secure connection."):b(`Failed to access microphone: ${G.message}`)}},[r]),H=C.useCallback(()=>{if(_.current&&l&&(_.current.stop(),c(!1),f(!1),P.current&&clearInterval(P.current),p<t)){b(`Recording must be at least ${t} seconds long.`);return}},[l,p,t,y,e]),Q=C.useCallback(()=>{_.current&&l&&!d&&(_.current.pause(),f(!0),P.current&&clearInterval(P.current))},[l,d]),Z=C.useCallback(()=>{_.current&&l&&d&&(_.current.resume(),f(!1),P.current=setInterval(()=>{g(G=>{const I=G+1;return I>=r&&H(),I})},1e3))},[l,d,r,H]),ae=C.useCallback(()=>{if(!N.current)return;const G=N.current,I=new Uint8Array(G.frequencyBinCount),z=()=>{G.getByteFrequencyData(I);const V=I.reduce((O,W)=>O+W,0)/I.length;V<10?k("poor"):V<30?k("fair"):k("good"),l&&(A.current=requestAnimationFrame(z))};z()},[l]),te=G=>{const I=Math.floor(G/60),z=G%60;return`${I}:${z.toString().padStart(2,"0")}`},se=()=>{switch(E){case"poor":return"text-red-600";case"fair":return"text-yellow-600";case"good":return"text-green-600";default:return"text-gray-600"}},L=()=>{switch(E){case"poor":return"Poor audio quality - speak closer to microphone";case"fair":return"Fair audio quality - good for recording";case"good":return"Excellent audio quality";default:return"Monitoring audio quality..."}};return o.jsxs("div",{className:"audio-recorder bg-white rounded-lg shadow-lg p-3 sm:p-6",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Record Your Response"}),o.jsx("p",{className:"text-gray-600",children:"Speak clearly and at a normal pace. You can pause and resume if needed."})]}),o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:te(p)}),o.jsx("div",{className:`text-sm ${se()}`,children:L()}),d&&o.jsx("div",{className:"text-yellow-600 font-semibold mt-2",children:"⏸️ Recording Paused"})]}),l&&o.jsx("div",{className:"mb-6",children:o.jsx("div",{className:"flex justify-center items-center space-x-1 h-8",children:Array.from({length:20},(G,I)=>o.jsx("div",{className:"bg-blue-400 rounded-sm",style:{width:"4px",height:`${Math.random()*20+4}px`,animation:"pulse 0.5s ease-in-out infinite"}},I))})}),o.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-center mb-6",children:l?o.jsxs(o.Fragment,{children:[d?o.jsxs("button",{onClick:Z,className:"w-full sm:w-auto bg-green-600 text-white px-6 py-4 rounded-full hover:bg-green-700 flex items-center justify-center space-x-2 min-h-[48px] text-lg font-semibold",children:[o.jsx("span",{className:"text-xl",children:"▶️"}),o.jsx("span",{children:"Resume"})]}):o.jsxs("button",{onClick:Q,className:"w-full sm:w-auto bg-yellow-600 text-white px-6 py-4 rounded-full hover:bg-yellow-700 flex items-center justify-center space-x-2 min-h-[48px] text-lg font-semibold",children:[o.jsx("span",{className:"text-xl",children:"⏸️"}),o.jsx("span",{children:"Pause"})]}),o.jsxs("button",{onClick:H,className:"w-full sm:w-auto bg-gray-600 text-white px-6 py-4 rounded-full hover:bg-gray-700 flex items-center justify-center space-x-2 min-h-[48px] text-lg font-semibold",children:[o.jsx("span",{className:"text-xl",children:"⏹️"}),o.jsx("span",{children:"Stop & Submit"})]})]}):o.jsxs("button",{onClick:M,className:"w-full sm:w-auto bg-red-600 text-white px-6 py-4 rounded-full hover:bg-red-700 flex items-center justify-center space-x-2 min-h-[48px] text-lg font-semibold",children:[o.jsx("span",{className:"text-xl",children:"🎤"}),o.jsx("span",{children:"Start Recording"})]})}),w&&o.jsx("div",{className:"mt-4 p-3 sm:p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-800",children:w})}),o.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:["Attempt ",a," of ",s,a<s&&o.jsx("span",{className:"ml-2 text-blue-600",children:"(You can re-record if needed)"})]})]})}),r8=({audioBlob:e,audioUrl:t,recordingTime:r,className:n=""})=>{const[s,a]=C.useState(!1),[i,l]=C.useState(0),[c,d]=C.useState(0),[f,p]=C.useState(1),[g,y]=C.useState(1),[v,w]=C.useState(!0),[b,E]=C.useState(""),[k,_]=C.useState(!1),[T,j]=C.useState(null),[P,R]=C.useState(!1),N=C.useRef(null),A=C.useRef(null),M=C.useRef(!1);C.useEffect(()=>()=>{M.current=!0},[]),C.useEffect(()=>{let I=!1;if(t)I||E(t);else if(e){if(!e||e.size===0){I||w(!1);return}if(!(e instanceof Blob)){console.error("audioBlob is not a Blob:",typeof e,e),I||w(!1);return}const z=URL.createObjectURL(e);return I||E(z),()=>{I=!0,URL.revokeObjectURL(z)}}return()=>{I=!0}},[e,t]),C.useEffect(()=>{let I=!1;const z=O=>{try{const W=new URL(O);return/\/storage\/v1\/object\/public\//.test(W.pathname)}catch{return!1}};async function V(O){if(!O||P||/\/object\/sign\//.test(O)||!z(O))return O;try{const q=new URL(O).pathname.replace(/^\/storage\/v1\/object\/public\//,""),Y=q.split("/")[0],ee=q.substring(Y.length+1),X=await fetch(`/.netlify/functions/get-speaking-test-new?action=sign-audio&bucket=${encodeURIComponent(Y)}&file_path=${encodeURIComponent(ee)}`);if(X.ok){const{url:ne}=await X.json();if(!I&&!M.current){R(!0);try{await fetch(ne,{headers:{Range:"bytes=0-1"},mode:"cors"})}catch{}E(ne)}return ne}}catch{}return O}return(async()=>{if(t){const O=await V(t);try{await fetch(O,{headers:{Range:"bytes=0-1"},mode:"cors"})}catch{}!I&&!M.current&&!P&&E(O)}})(),()=>{I=!0}},[t,P]),C.useEffect(()=>{let I=!1;return b&&(I||(_(!1),j(null),w(!0))),()=>{I=!0}},[b]),C.useEffect(()=>{if(N.current&&b){const I=N.current;let z=!1;try{I.src=b}catch{}I.load();const V=()=>{if(z||M.current)return;let ce=I.duration;if(ce===1/0)try{I.currentTime=1e101,I.ontimeupdate=()=>{if(z||M.current)return;I.ontimeupdate=null;const ye=I.duration;z||(d(isFinite(ye)&&ye>0?ye:0),I.currentTime=0,w(!1))};return}catch(ye){console.warn("Seek trick failed:",ye)}if(isNaN(ce)||!isFinite(ce)||ce<=0){const ye=I.seekable&&I.seekable.length>0&&isFinite(I.seekable.end(0)),Fe=!ye&&I.buffered&&I.buffered.length>0&&isFinite(I.buffered.end(I.buffered.length-1));ye?ce=I.seekable.end(0):Fe&&(ce=I.buffered.end(I.buffered.length-1))}isNaN(ce)||!isFinite(ce)||ce<=0?(console.warn("Invalid audio duration after fallbacks:",ce),r&&r>0?z||d(r):z||d(0)):z||d(ce),z||w(!1)},O=()=>{z||M.current||V()},W=()=>{z||M.current||V()},q=()=>{z||M.current||V()},Y=()=>{z||M.current||V()},ee=()=>{z||M.current||l(I.currentTime)},X=()=>{z||M.current||(a(!1),l(0))},ne=()=>{z||M.current||a(!0)},ge=()=>{z||M.current||a(!1)},_e=ce=>{if(z||M.current)return;console.error("Audio loading error:",ce),console.error("Audio error details:",{error:I.error,networkState:I.networkState,readyState:I.readyState,src:I.src,currentSrc:I.currentSrc});const ye=I.error?.code;ye===4&&_(!0),j(I.error||{code:ye}),w(!1)},Pe=setTimeout(()=>{z||M.current||I.readyState===0&&w(!1)},6e3);return I.addEventListener("loadedmetadata",O),I.addEventListener("durationchange",W),I.addEventListener("canplay",q),I.addEventListener("canplaythrough",Y),I.addEventListener("timeupdate",ee),I.addEventListener("ended",X),I.addEventListener("play",ne),I.addEventListener("pause",ge),I.addEventListener("error",_e),()=>{z=!0,clearTimeout(Pe),I.removeEventListener("loadedmetadata",O),I.removeEventListener("durationchange",W),I.removeEventListener("canplay",q),I.removeEventListener("canplaythrough",Y),I.removeEventListener("timeupdate",ee),I.removeEventListener("ended",X),I.removeEventListener("play",ne),I.removeEventListener("pause",ge),I.removeEventListener("error",_e),I.pause(),I.src="",I.load()}}},[b,r]),C.useEffect(()=>{let I=!1;return r&&r>0&&(isNaN(c)||!isFinite(c)||c<=0)&&(I||d(r)),()=>{I=!0}},[r,c]);const H=()=>{N.current&&(s?N.current.pause():N.current.play().catch(I=>{console.error("Play failed:",I)}))},Q=I=>{if(N.current&&A.current&&c>0){const z=A.current.getBoundingClientRect(),V=I.clientX-z.left,O=z.width,W=Math.max(0,Math.min(c,V/O*c));isFinite(W)&&W>=0&&(N.current.currentTime=W,l(W))}},Z=I=>{const z=parseFloat(I.target.value);p(z),N.current&&(N.current.volume=z)},ae=I=>{const z=parseFloat(I.target.value);y(z),N.current&&(N.current.playbackRate=z)},te=I=>{if(isNaN(I))return"0:00";const z=Math.floor(I/60),V=Math.floor(I%60);return`${z}:${V.toString().padStart(2,"0")}`};if(!e&&!t)return o.jsx("div",{className:`audio-player ${n}`,children:o.jsx("div",{className:"text-center text-gray-500 py-8",children:"No audio available"})});const L=(I=>{try{const V=(I||"").toLowerCase().split("?")[0].split("#")[0];return V.endsWith(".webm")?"audio/webm":V.endsWith(".mp3")?"audio/mpeg":V.endsWith(".m4a")?"audio/mp4":V.endsWith(".aac")?"audio/aac":V.endsWith(".wav")?"audio/wav":void 0}catch{return}})(b||t),G=us.useMemo(()=>typeof window>"u"?!0:document.createElement("audio").canPlayType("audio/webm")!=="",[]);return o.jsxs("div",{className:`audio-player bg-gray-50 rounded-lg p-4 ${n}`,children:[o.jsx("audio",{ref:N,preload:"metadata",controls:!1,style:{display:"none"},crossOrigin:"anonymous",children:o.jsx("source",{src:b,type:L})}),v?o.jsxs("div",{className:"text-center py-4",children:[o.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),o.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading audio..."})]}):k?o.jsxs("div",{className:"text-center py-4",children:[o.jsx("p",{className:"text-sm text-red-600",children:"This audio format isn't supported by your browser."}),b?o.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-sm",children:"Open in new tab"}):null,L?o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Detected type: ",L]}):null,o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Browser WebM support: ",G?"Yes":"No",!G&&" - Try using Chrome, Firefox, or Edge"]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Preferred format: WebM"})]}):T?o.jsxs("div",{className:"text-center py-4",children:[o.jsx("p",{className:"text-sm text-red-600",children:"Playback failed. Please try opening the audio directly."}),b?o.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-sm",children:"Open in new tab"}):null,L?o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Detected type: ",L]}):null]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"mb-4",children:[o.jsx("div",{ref:A,className:"w-full bg-gray-200 rounded-full h-3 cursor-pointer hover:h-4 transition-all min-h-[24px]",onClick:Q,children:o.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all",style:{width:`${i/c*100}%`}})}),o.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-2 font-medium",children:[o.jsx("span",{children:te(i)}),o.jsx("span",{children:te(c)})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("button",{onClick:H,className:"bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:s?o.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:o.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):o.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:o.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.617l3.766-3.793a1 1 0 011.617.793zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:f,onChange:Z,className:"w-24 h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer min-h-[20px]"}),o.jsxs("span",{className:"text-sm text-gray-600 w-10 font-medium",children:[Math.round(f*100),"%"]})]})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Speed:"}),o.jsxs("select",{value:g,onChange:ae,className:"text-sm border border-gray-300 rounded px-2 py-1",children:[o.jsx("option",{value:"0.5",children:"0.5x"}),o.jsx("option",{value:"0.75",children:"0.75x"}),o.jsx("option",{value:"1",children:"1x"}),o.jsx("option",{value:"1.25",children:"1.25x"}),o.jsx("option",{value:"1.5",children:"1.5x"}),o.jsx("option",{value:"2",children:"2x"})]})]})]})]})]})},Kz=({transcript:e,scores:t,audioBlob:r,recordingTime:n,onReRecord:s,onFinalSubmit:a,canReRecord:i,attemptNumber:l,maxAttempts:c,isSubmitting:d=!1})=>{const[f,p]=C.useState(!1);console.log("🎤 FeedbackDisplay received recordingTime:",n);const g=(b,E)=>{const k=b/E*100;return k>=80?"text-green-600":k>=60?"text-yellow-600":"text-red-600"},y=(b,E)=>{const k=b/E*100;return k>=90?"A+":k>=80?"A":k>=70?"B":k>=60?"C":k>=50?"D":"F"},v=()=>y(t?.overall_score||0,100),w=()=>g(t?.overall_score||0,100);return console.log("🎯 FeedbackDisplay received scores:",t),console.log("🎯 Individual score values:",{grammar_score:t?.grammar_score,vocabulary_score:t?.vocabulary_score,pronunciation_score:t?.pronunciation_score,fluency_score:t?.fluency_score,content_score:t?.content_score}),o.jsxs("div",{className:"feedback-display bg-white rounded-lg shadow-lg p-3 sm:p-6",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Speaking Test Results"}),o.jsx("p",{className:"text-gray-600",children:"Review your performance and decide whether to submit or re-record."})]}),o.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-3 sm:p-6 rounded-lg mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:`text-4xl font-bold ${w()}`,children:[t?.overall_score||0,"/100"]}),o.jsxs("div",{className:`text-2xl font-semibold ${w()} mt-2`,children:["Grade: ",v()]}),o.jsx("div",{className:"text-gray-600 mt-2",children:t?.overall_score>=80?"Excellent work!":t?.overall_score>=60?"Good job!":t?.overall_score>=50?"Not bad, but could be better.":"Keep practicing!"})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Grammar"}),o.jsxs("span",{className:`font-bold ${g(t?.grammar_score||0,25)}`,children:[t?.grammar_score||0,"/25"]})]}),o.jsxs("div",{className:"text-sm text-gray-600",children:[t?.grammar_mistakes||0," mistakes found"]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min((t?.grammar_score||0)/25*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Vocabulary"}),o.jsxs("span",{className:`font-bold ${g(t?.vocabulary_score||0,20)}`,children:[t?.vocabulary_score||0,"/20"]})]}),o.jsxs("div",{className:"text-sm text-gray-600",children:[t?.vocabulary_mistakes||0," vocabulary issues"]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min((t?.vocabulary_score||0)/20*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Pronunciation"}),o.jsxs("span",{className:`font-bold ${g(t?.pronunciation_score||0,15)}`,children:[t?.pronunciation_score||0,"/15"]})]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Clarity and accuracy"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-orange-600 h-2 rounded-full",style:{width:`${Math.min((t?.pronunciation_score||0)/15*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Fluency"}),o.jsxs("span",{className:`font-bold ${g(t?.fluency_score||0,20)}`,children:[t?.fluency_score||0,"/20"]})]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Pace, pauses, and flow"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min((t?.fluency_score||0)/20*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Content"}),o.jsxs("span",{className:`font-bold ${g(t?.content_score||0,20)}`,children:[t?.content_score||0,"/20"]})]}),o.jsx("div",{className:"text-sm text-gray-600",children:"How well addressed the prompt"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-indigo-600 h-2 rounded-full",style:{width:`${Math.min((t?.content_score||0)/20*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Word Count"}),o.jsxs("span",{className:"font-bold text-gray-700",children:[t?.word_count||0," words"]})]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Total words spoken"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-gray-600 h-2 rounded-full",style:{width:`${Math.min((t?.word_count||0)/100*100,100)}%`}})})]})]}),r&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Your Recording"}),o.jsx(r8,{audioBlob:r,recordingTime:n})]}),t?.feedback&&o.jsx("div",{className:"mb-6 bg-gradient-to-r from-green-50 to-blue-50 p-3 sm:p-6 rounded-lg border border-green-200",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("span",{className:"text-green-600 text-2xl",children:"🤖"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-semibold text-green-800 mb-3 text-lg",children:"AI Feedback"}),o.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.feedback})]})]})}),t?.improved_transcript&&o.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex items-start space-x-2 mb-3",children:[o.jsx("span",{className:"text-green-600 text-lg",children:"✨"}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"Improved Version"}),o.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Here's how your response could be improved with better grammar and vocabulary:"})]})]}),o.jsx("div",{className:"bg-white border border-green-200 rounded p-3",children:o.jsx("p",{className:"text-gray-800 leading-relaxed",children:t.improved_transcript})})]}),o.jsx("div",{className:"mb-6",children:o.jsx("button",{onClick:()=>p(!f),className:"text-blue-600 hover:text-blue-800 text-sm",children:f?"Hide Details":"Show Details"})}),f&&o.jsxs("div",{className:"mb-6 bg-blue-50 p-3 sm:p-4 rounded-lg",children:[o.jsx("h4",{className:"font-semibold mb-3",children:"Detailed Analysis"}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Word Count Analysis:"}),o.jsxs("span",{className:"ml-2 text-gray-700",children:["You spoke ",t?.word_count||0," words.",t?.word_count>=50?" Great job meeting the minimum requirement!":" Consider speaking more to meet the minimum word requirement."]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Grammar Analysis:"}),o.jsx("span",{className:"ml-2 text-gray-700",children:t?.grammar_mistakes===0?"Perfect grammar!":`Found ${t?.grammar_mistakes||0} grammar ${t?.grammar_mistakes===1?"mistake":"mistakes"}.`}),t?.grammar_corrections&&t.grammar_corrections.length>0&&o.jsx("div",{className:"mt-2 space-y-2",children:t.grammar_corrections.map((b,E)=>o.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-2 sm:p-3",children:o.jsxs("div",{className:"flex items-start space-x-2",children:[o.jsx("span",{className:"text-red-600 font-mono text-sm",children:"✗"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-red-600",children:b.mistake}),o.jsx("span",{className:"mx-2",children:"→"}),o.jsx("span",{className:"font-medium text-green-600",children:b.correction})]}),o.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[o.jsx("strong",{children:"Explanation:"})," ",b.explanation]})]})]})},E))})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Vocabulary Analysis:"}),o.jsx("span",{className:"ml-2 text-gray-700",children:t?.vocabulary_mistakes===0?"Excellent vocabulary usage!":`Found ${t?.vocabulary_mistakes||0} vocabulary ${t?.vocabulary_mistakes===1?"issue":"issues"}.`}),t?.vocabulary_corrections&&t.vocabulary_corrections.length>0&&o.jsx("div",{className:"mt-2 space-y-2",children:t.vocabulary_corrections.map((b,E)=>o.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded p-2 sm:p-3",children:o.jsxs("div",{className:"flex items-start space-x-2",children:[o.jsx("span",{className:"text-purple-600 font-mono text-sm",children:"📝"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-purple-600",children:b.mistake}),o.jsx("span",{className:"mx-2",children:"→"}),o.jsx("span",{className:"font-medium text-green-600",children:b.correction})]}),o.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[o.jsx("strong",{children:"Explanation:"})," ",b.explanation]})]})]})},E))})]}),t?.language_use_corrections&&t.language_use_corrections.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Language Use Suggestions:"}),o.jsx("div",{className:"mt-2 space-y-2",children:t.language_use_corrections.map((b,E)=>o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded p-2 sm:p-3",children:o.jsxs("div",{className:"flex items-start space-x-2",children:[o.jsx("span",{className:"text-blue-600 font-mono text-sm",children:"💡"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-blue-700",children:b.mistake}),o.jsx("span",{className:"mx-2",children:"→"}),o.jsx("span",{className:"font-medium text-green-700",children:b.suggestion})]}),b.explanation&&o.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:[o.jsx("strong",{children:"Why:"})," ",b.explanation]})]})]})},E))})]})]})]}),o.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:["Attempt ",l," of ",c]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-center justify-center",children:[i&&o.jsxs("button",{onClick:s,className:"w-full sm:w-auto bg-yellow-600 text-white px-4 py-2.5 rounded-lg hover:bg-yellow-700 flex items-center justify-center space-x-2 min-h-[40px] text-base font-medium",children:[o.jsx("span",{children:"🔄"}),o.jsx("span",{children:"Re-record"})]}),o.jsx("button",{onClick:a,disabled:d,className:`w-full sm:w-auto px-4 py-2.5 rounded-lg flex items-center justify-center space-x-2 min-h-[40px] text-base font-medium ${d?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} text-white`,children:d?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),o.jsx("span",{children:"Submitting..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"✅"}),o.jsx("span",{children:"Submit Final"})]})})]}),!i&&o.jsx("div",{className:"mt-4 p-2 sm:p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:o.jsxs("p",{className:"text-yellow-800 text-sm",children:[o.jsx("strong",{children:"Maximum attempts reached."}),' This is your final attempt. Click "Submit Final" to complete the test.']})})]})},qz=({testData:e,onComplete:t,onExit:r,onTestComplete:n})=>{const[s,a]=C.useState("recording"),[i,l]=C.useState(null),[c,d]=C.useState(""),[f,p]=C.useState(null),[g,y]=C.useState(!1),[v,w]=C.useState(null),[b,E]=C.useState(1),[k]=C.useState(e.max_attempts||3),[_,T]=C.useState(!1),[j,P]=C.useState(0),R=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,[N,A]=C.useState(0),[M,H]=C.useState(null),Q=Ji(),{user:Z}=Wn(),{makeAuthenticatedRequest:ae}=Q,te=C.useRef(null);C.useEffect(()=>{if(e?.test_id&&Z?.student_id){const Y=`speaking_attempts_${Z.student_id}_${e.test_id}`,ee=localStorage.getItem(Y);if(ee){const X=parseInt(ee,10);X>0&&X<=k&&(E(X),console.log("🔄 Loaded attempts from localStorage:",X))}}},[e,Z,k]),C.useEffect(()=>{if(e&&!M){const Y=new Date;H(Y),console.log("⏱️ Speaking test timer started at:",Y.toISOString())}},[e,M]),C.useEffect(()=>{let Y=0;s==="recording"?Y=25:s==="processing"?Y=50:s==="feedback"?Y=75:s==="completed"&&(Y=100),A(Y)},[s]),C.useEffect(()=>{(async()=>{try{if(console.log("🎤 Automatically requesting microphone permission..."),!window.isSecureContext&&!window.location.hostname.includes("localhost")){w("Microphone access requires HTTPS. Please use a secure connection.");return}if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){w("Microphone access is not supported in this browser. Please use a modern browser like Chrome, Safari, or Firefox.");return}if(R())return;const ee=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});console.log("🎤 Microphone permission granted!"),T(!0),ee.getTracks().forEach(X=>X.stop())}catch(ee){console.error("🎤 Microphone permission denied:",ee),ee.name==="NotAllowedError"?w("Microphone access denied. Please allow microphone access in your browser settings and refresh the page."):ee.name==="NotFoundError"?w("No microphone found. Please connect a microphone and try again."):w("Microphone access failed. Please check your browser settings and try again.")}})()},[]),C.useEffect(()=>{const Y=setInterval(()=>{i&&s==="recording"&&se()},3e4);return()=>clearInterval(Y)},[i,s]);const se=C.useCallback(async()=>{try{const Y={test_id:e.test_id,audio_blob:i?await L(i):null,attempt_number:b,step:s,timestamp:new Date().toISOString()};localStorage.setItem(`speaking_progress_${e.test_id}`,JSON.stringify(Y))}catch(Y){console.error("Failed to save progress:",Y)}},[e.test_id,i,b,s]),L=Y=>new Promise((ee,X)=>{const ne=new FileReader;ne.onloadend=()=>{const _e=ne.result.split(",")[1];ee(_e)},ne.onerror=X,ne.readAsDataURL(Y)}),G=C.useCallback(Y=>{if(e?.test_id&&Z?.student_id){const ee=`speaking_attempts_${Z.student_id}_${e.test_id}`;localStorage.setItem(ee,Y.toString()),console.log("💾 Saved attempts to localStorage:",Y)}},[e,Z]),I=C.useCallback(async(Y,ee,X,ne,ge)=>{if(e?.test_id&&Z?.student_id)try{const{setCachedData:_e,CACHE_TTL:Pe}=await hi(async()=>{const{setCachedData:Me,CACHE_TTL:Oe}=await Promise.resolve().then(()=>Uh);return{setCachedData:Me,CACHE_TTL:Oe}},void 0),ce=`speaking_test_data_${Z.student_id}_${e.test_id}`,Fe={audioBlob:Y?await L(Y):null,transcript:ee,scores:X,recordingTime:ne,currentStep:ge,timestamp:Date.now()};_e(ce,Fe,Pe.speaking_test_data),console.log("💾 Saved speaking test data to cache:",ce)}catch(_e){console.error("Failed to save speaking test data to cache:",_e)}},[e,Z]),z=C.useCallback(async()=>{if(e?.test_id&&Z?.student_id)try{const{getCachedData:Y}=await hi(async()=>{const{getCachedData:ne}=await Promise.resolve().then(()=>Uh);return{getCachedData:ne}},void 0),ee=`speaking_test_data_${Z.student_id}_${e.test_id}`,X=Y(ee);if(X){if(console.log("💾 Loaded speaking test data from cache:",X),X.audioBlob){const ne=new Blob([Uint8Array.from(atob(X.audioBlob),ge=>ge.charCodeAt(0))],{type:"audio/webm"});l(ne)}return X.transcript&&d(X.transcript),X.scores&&p(X.scores),X.recordingTime&&P(X.recordingTime),X.currentStep&&a(X.currentStep),!0}}catch(Y){console.error("Failed to load speaking test data from cache:",Y)}return!1},[e,Z]);C.useEffect(()=>{if(e?.test_id&&Z?.student_id){try{const Y=Z.student_id,ee=`retest_assignment_id_${Y}_speaking_${e.test_id}`,X=`retest_in_progress_${Y}_speaking_${e.test_id}`;if(!!localStorage.getItem(ee)||!!localStorage.getItem(X)){const ge=`speaking_test_data_${Y}_${e.test_id}`,_e=`anti_cheating_${Y}_speaking_${e.test_id}`,Pe=`speaking_progress_${e.test_id}`;localStorage.removeItem(ge),localStorage.removeItem(_e),localStorage.removeItem(Pe),console.log("🧹 Cleared speaking per-test cache for retest start:",{cacheKey:ge,antiCheatKey:_e,progressKey:Pe})}}catch{}z()}},[e,Z,z]),C.useEffect(()=>{e?.test_id&&Z?.student_id&&(i||c||f)&&I(i,c,f,j,s)},[i,c,f,j,s,e,Z,I]);const V=C.useCallback(async(Y,ee)=>{console.log("🎤 Recording completed, duration:",ee),l(Y),P(ee),a("processing"),w(null);try{const X=await L(Y),ne=new Date,ge=e.start_time?Math.round((ne-e.start_time)/1e3):0,_e=e.start_time?new Date(e.start_time).toISOString():ne.toISOString(),Pe=Z.student_id,ce=`retest_assignment_id_${Pe}_speaking_${e.test_id}`,ye=localStorage.getItem(ce),Fe={test_id:e.test_id,test_name:e.test_name,teacher_id:e.teacher_id||null,subject_id:e.subject_id||null,student_id:Pe,question_id:e.question_id||1,audio_blob:X,audio_duration:Y.duration||0,time_taken:ge,started_at:_e,submitted_at:ne.toISOString(),caught_cheating:!1,visibility_change_times:0,is_completed:!0,retest_assignment_id:ye?Number(ye):null,parent_test_id:e.test_id};console.log("🎤 Submitting speaking test:",Fe),console.log("🎤 Processing audio with AI...");try{const Oe=await(await ae("/.netlify/functions/process-speaking-audio-ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_id:e.test_id,question_id:e.question_id||1,audio_blob:X})})).json();if(Oe.success){console.log("🎤 AI Analysis Result:",Oe),d(Oe.transcript);const He=Oe.transcript?Oe.transcript.split(/\s+/).filter(Le=>Le.length>0).length:0;console.log("🎤 Word Count Verification:",{aiCount:Oe.word_count,actualCount:He,transcript:Oe.transcript});const It=He,Ze={overall_score:Oe.overall_score,word_count:It,grammar_score:Oe.grammar_score,vocabulary_score:Oe.vocabulary_score,pronunciation_score:Oe.pronunciation_score,fluency_score:Oe.fluency_score,content_score:Oe.content_score,grammar_mistakes:Oe.grammar_mistakes,vocabulary_mistakes:Oe.vocabulary_mistakes,feedback:Oe.feedback,improved_transcript:Oe.improved_transcript,grammar_corrections:Oe.grammar_corrections||[],vocabulary_corrections:Oe.vocabulary_corrections||[],language_use_corrections:Oe.language_use_corrections||[],ai_feedback:Oe.ai_feedback||null};console.log("🎤 Mapped Scores:",Ze),console.log("🎤 Individual scores check:",{grammar_score:Oe.grammar_score,vocabulary_score:Oe.vocabulary_score,pronunciation_score:Oe.pronunciation_score,fluency_score:Oe.fluency_score,content_score:Oe.content_score}),p(Ze),a("feedback")}else throw new Error(Oe.message||"Failed to process audio with AI");localStorage.removeItem(`speaking_progress_${e.test_id}`)}catch(Me){console.error("Speaking test submission error:",Me),Me.message.includes("No valid authentication token found")?(w("Your session has expired. Please refresh the page and try again."),setTimeout(()=>{window.location.reload()},3e3)):w(Me.message),a("recording")}}catch(X){console.error("Speaking test submission error:",X),w(X.message),a("recording")}},[e,Z,ae,b,G]),O=C.useCallback(()=>{if(b<k){l(null),d(""),p(null),w(null);const Y=b+1;E(Y),G(Y),a("recording")}else w("Maximum attempts reached")},[b,k,G]),W=C.useCallback(async()=>{if(!(!c||!f)){y(!0);try{const Y=new Date,ee=e.start_time?Math.round((Y-e.start_time)/1e3):0,X=e.start_time?new Date(e.start_time).toISOString():Y.toISOString(),ne=Z.student_id,ge=`retest_assignment_id_${ne}_speaking_${e.test_id}`,_e=localStorage.getItem(ge),{academicCalendarService:Pe}=await hi(async()=>{const{academicCalendarService:He}=await Promise.resolve().then(()=>rv);return{academicCalendarService:He}},void 0);await Pe.loadAcademicCalendar();const ye=Pe.getCurrentTerm()?.id;if(!ye)throw new Error("No current academic period found");const Fe={test_id:e.test_id,test_name:e.test_name,teacher_id:e.teacher_id||null,subject_id:e.subject_id||null,student_id:ne,academic_period_id:ye,question_id:e.question_id||1,audio_blob:i?await L(i):null,audio_duration:i?.duration||0,time_taken:ee,started_at:X,submitted_at:Y.toISOString(),caught_cheating:!1,visibility_change_times:0,is_completed:!0,retest_assignment_id:_e?Number(_e):null,parent_test_id:e.test_id,transcript:c,scores:f,final_submission:!0};console.log("🎤 Final submission:",Fe),console.log("🎤 Making final submission request...");const Me=await ae("/.netlify/functions/submit-speaking-test-final",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Fe)});console.log("🎤 Final submission response status:",Me.status);const Oe=await Me.json();if(console.log("🎤 Final submission result:",Oe),Oe.success){if(Z?.student_id){const jt=`test_completed_${Z.student_id}_speaking_${e.test_id}`;localStorage.setItem(jt,"true"),console.log("✅ Speaking test marked as completed in localStorage:",jt);const Rt=`retest_in_progress_${Z.student_id}_speaking_${e.test_id}`;localStorage.removeItem(Rt),console.log("🗑️ Cleared in-progress retest lock:",Rt);const Xe=`speaking_attempts_${Z.student_id}_${e.test_id}`;localStorage.removeItem(Xe),console.log("🗑️ Cleared attempts from localStorage upon submission");const{clearTestData:Ye}=await hi(async()=>{const{clearTestData:pt}=await Promise.resolve().then(()=>Uh);return{clearTestData:pt}},void 0);Ye(Z.student_id,"speaking_test_data",e.test_id),console.log("🗑️ Cleared speaking test data from cache upon submission");try{const pt=`anti_cheating_${Z.student_id}_speaking_${e.test_id}`;localStorage.removeItem(pt),console.log("🗑️ Cleared anti-cheating key:",pt)}catch{}}console.log("🎤 Caching speaking test results after submission...");const It=`student_results_table_${Z?.student_id||Z?.id||"unknown"}`,{setCachedData:Ze,getCachedData:Le,CACHE_TTL:De,clearTestData:et}=await hi(async()=>{const{setCachedData:jt,getCachedData:Rt,CACHE_TTL:Xe,clearTestData:Ye}=await Promise.resolve().then(()=>Uh);return{setCachedData:jt,getCachedData:Rt,CACHE_TTL:Xe,clearTestData:Ye}},void 0),bt={id:Date.now(),test_id:e.test_id,test_type:"speaking",test_name:e.test_name,score:Math.round(f.overall_score/10),max_score:10,percentage:f.overall_score,caught_cheating:!1,visibility_change_times:0,is_completed:!0,submitted_at:new Date().toISOString(),subject:"Listening and Speaking",teacher_name:e.teacher_name||"Unknown"};let ut={success:!0,results:[],count:0};try{const jt=Le(It);jt&&Array.isArray(jt.results)&&(ut.results=jt.results.slice())}catch{}ut.results.unshift(bt),ut.count=ut.results.length,Ze(It,ut,De.student_results_table),console.log("🎤 Speaking test results cached (merged) with key:",It),Z?.student_id&&et(Z.student_id,"speaking",e.test_id);try{const jt=`retest_attempts_${Z.student_id}_speaking_${e.test_id}`,Rt=localStorage.getItem(jt);let Xe=0;if(Rt)try{Xe=JSON.parse(Rt)?.used||0}catch{Xe=0}const Ye={used:Xe+1,max:k};localStorage.setItem(jt,JSON.stringify(Ye));const pt=`retest1_${Z.student_id}_speaking_${e.test_id}`,mt=`retest_assignment_id_${Z.student_id}_speaking_${e.test_id}`;localStorage.removeItem(pt),localStorage.removeItem(mt),console.log("💾 Updated retest attempts meta and cleared retest keys:",Ye)}catch(jt){console.warn("⚠️ Failed to update retest attempts meta/keys",jt)}try{n&&n(f.overall_score),typeof r=="function"&&r()}catch{}return}else throw new Error(Oe.message||"Failed to submit speaking test")}catch(Y){console.error("Speaking test submission error:",Y),w(Y.message)}finally{y(!1)}}},[e,Z,ae,c,f,i,b,t]);C.useCallback(()=>{a("completed"),t({test_id:e.test_id,transcript:c,scores:f,attempt_number:b})},[e.test_id,c,f,b,t]);const q=()=>{switch(s){case"recording":return o.jsxs("div",{className:"speaking-test-recording",children:[o.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:e.test_name}),o.jsxs("div",{className:"mb-6 text-center",children:[o.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Instructions:"}),o.jsx("p",{className:"text-gray-700 mb-4",children:e.prompt}),o.jsx("div",{className:"bg-blue-50 p-3 sm:p-4 rounded-lg",children:o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Requirements:"})," Minimum ",e.min_words||50," words, 0-",e.max_duration||600," seconds duration"]})})]}),o.jsx(Vz,{ref:te,onRecordingComplete:V,minDuration:0,maxDuration:e.max_duration||600,minWords:e.min_words||50,maxAttempts:k,currentAttempt:b}),v&&o.jsx("div",{className:"mt-4 p-3 sm:p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-800",children:v})})]});case"processing":return o.jsxs("div",{className:"transcription-status bg-white rounded-lg shadow-lg p-4 sm:p-8 text-center",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("div",{className:"text-6xl mb-4",children:"⏳"}),o.jsx("h3",{className:"text-2xl font-semibold mb-2",children:"Processing Your Speech"}),o.jsx("p",{className:"text-lg text-blue-600",children:"Please wait while we process your audio..."})]}),o.jsxs("div",{className:"inline-flex space-x-1",children:[o.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce"}),o.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),o.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]});case"feedback":return console.log("🎤 Rendering feedback step with Submit Final button"),o.jsx(Kz,{transcript:c,scores:f,audioBlob:i,recordingTime:j,onReRecord:O,onFinalSubmit:W,canReRecord:b<k,attemptNumber:b,maxAttempts:k,isSubmitting:g});case"completed":const Y={showResults:!0,testInfo:{test_name:e?.test_name||"Speaking Test",id:e?.test_id,test_id:e?.test_id},testType:"speaking",score:f?.overall_score||0,totalQuestions:1,percentage:f?.overall_score||0,passed:(f?.overall_score||0)>=50,questionAnalysis:[{questionNumber:1,userAnswer:c,correctAnswer:"Speaking test completed",isCorrect:!0,score:f?.overall_score||0,maxScore:100,feedback:`Word Count: ${f?.word_count||0}, Grammar: ${f?.grammar_score||0}/40, Vocabulary: ${f?.vocab_score||0}/30`}],timestamp:new Date().toISOString(),caught_cheating:!1,visibility_change_times:0};return o.jsx("div",{className:"speaking-test-completed",children:o.jsx(Xp,{testResults:Y,onBackToCabinet:r,onRetakeTest:()=>{a("recording"),d(""),p(null),l(null),E(1)},isLoading:!1})});default:return null}};return o.jsx("div",{children:o.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-3 sm:p-6",children:[v&&o.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-800",children:v})}),q()]})})},Xz=()=>{const{testId:e}=F1(),t=Ii(),{user:r}=Wn(),n=Ji(),{showNotification:s}=da(),[a,i]=C.useState(null),[l,c]=C.useState([]),[d,f]=C.useState(!0),[p,g]=C.useState(null),[y,v]=C.useState(!1),[w,b]=C.useState(null),{startTracking:E,stopTracking:k}=D0("speaking",e,r?.student_id||r?.id);C.useEffect(()=>{_(),T()},[e]),C.useEffect(()=>{if(a&&!y){console.log("🛡️ Speaking test - initializing anti-cheating tracking");const N=r?.student_id||r?.id||"unknown",A=`anti_cheating_${N}_speaking_${e}`,M=localStorage.getItem(A);if(console.log("🛡️ Checking for anti-cheating data with key:",A),console.log("🛡️ Key format: anti_cheating_{studentId}_{testType}_{testId}"),console.log("🛡️ Current test details:",{testType:"speaking",testId:e,studentId:N}),M)try{const H=JSON.parse(M);console.log("🛡️ Found existing anti-cheating data for THIS speaking test:",H),console.log("🛡️ Visibility change times for this test:",H.tabSwitches||0),console.log("🛡️ Cheating status for this test:",H.isCheating||!1),H.isCheating&&(console.log("⚠️ WARNING: Student has been flagged for cheating in THIS speaking test!"),console.log("⚠️ Tab switches detected in this test:",H.tabSwitches),s(`⚠️ Warning: Suspicious activity detected in this speaking test (${H.tabSwitches} tab switches). Continued violations may result in test disqualification.`,"warning"))}catch(H){console.error("🛡️ Error parsing existing anti-cheating data:",H)}else console.log("🛡️ No existing anti-cheating data found for this speaking test - starting fresh");E(),console.log("🛡️ Anti-cheating tracking started for speaking test")}return()=>{a&&(console.log("🛡️ Cleaning up anti-cheating tracking for speaking test"),k())}},[a,y,e,r?.student_id,r?.id,E,k,s]);const _=async()=>{try{f(!0);const N=await n.getSpeakingTest(e);if(N.success)i(N.test);else throw new Error(N.message||"Failed to load test");const A=await n.getSpeakingTestQuestions(e);A.success&&c(A.questions)}catch(N){console.error("Error loading test data:",N),g(N.message)}finally{f(!1)}},T=()=>{const A=`test_completed_${r?.student_id||r?.id}_speaking_${e}`;if(localStorage.getItem(A)==="true"){v(!0);const H=localStorage.getItem(`speaking_test_result_${e}`);H&&b(JSON.parse(H))}},j=async N=>{try{v(!0),b(N),localStorage.setItem(`speaking_test_result_${e}`,JSON.stringify(N)),window.dispatchEvent(new CustomEvent("testCompleted",{detail:{testId:e,testType:"speaking"}})),setTimeout(()=>{t("/student")},2e3)}catch(A){console.error("Error handling test completion:",A)}},P=()=>{if(console.log("🎓 Navigating back to cabinet from speaking test..."),a&&r?.student_id){console.log("🛡️ Cabinet navigation detected - counting as cheating attempt");const A=`anti_cheating_${r?.student_id||r?.id||"unknown"}_speaking_${e}`,M=localStorage.getItem(A);let H=0,Q=!1;if(M)try{const se=JSON.parse(M);H=se.tabSwitches||0,Q=se.isCheating||!1}catch(se){console.error("🛡️ Error parsing existing anti-cheating data:",se)}const Z=H+1,ae=Z>=2;console.log(`🛡️ Tab switch count: ${H} → ${Z} (cheating: ${ae})`);const te={tabSwitches:Z,isCheating:ae,lastUpdated:new Date().toISOString()};localStorage.setItem(A,JSON.stringify(te)),console.log("🛡️ Anti-cheating data updated for cabinet navigation:",te)}t("/student")};if(d)return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test"})}),o.jsx(rt,{variant:"outline",onClick:P,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),o.jsx("p",{className:"text-gray-600 mt-4",children:"Loading speaking test..."})]})})})]});if(p)return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test"})}),o.jsx(rt,{variant:"outline",onClick:P,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-red-600 text-6xl mb-4",children:"⚠️"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error Loading Test"}),o.jsx("p",{className:"text-gray-600 mb-6",children:p})]})})})]});if(y&&w)return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test Results"})}),o.jsx(rt,{variant:"outline",onClick:P,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx(Xp,{testType:"speaking",testData:a,result:w,onRetake:()=>{v(!1),b(null);const N=JSON.parse(localStorage.getItem("userData")||"{}").student_id;localStorage.removeItem(`test_completed_${N}_speaking_${e}`)}})})]});if(!a||l.length===0)return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test"})}),o.jsx(rt,{variant:"outline",onClick:P,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📝"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Test Data"}),o.jsx("p",{className:"text-gray-600 mb-6",children:"Unable to load test information"})]})})})]});const R=l[0];return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test"})}),o.jsx(rt,{variant:"outline",onClick:P,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx(qz,{testData:{...a,test_id:parseInt(e),question_id:R?.id,prompt:R?.prompt,start_time:Date.now()},onComplete:j,onExit:P,onTestComplete:j})})]})},Yz=()=>{const{testType:e,testId:t}=F1(),r=Ii(),{activeTests:n}=qp(),s=()=>{r("/student")},a=n.find(i=>i.test_type===e&&i.test_id===parseInt(t));return o.jsx(zz,{onBackToCabinet:s,currentTest:a||{test_type:e,test_id:parseInt(t)}})},Jz=()=>{const e=Ii(),{user:t,isAuthenticated:r,isLoading:n}=Wn(),[s,a]=C.useState(!1),[i,l]=C.useState(!0),[c,d]=C.useState(""),[f,p]=C.useState([]),[g,y]=C.useState(!1),[v,w]=C.useState(!1),[b,E]=C.useState({currentPassword:"",newPassword:"",confirmPassword:""}),k=C.useCallback(async()=>{console.log("🎓 Initializing Student Application...");try{if(l(!0),d(""),!r||!t){console.log("🎓 User not authenticated, redirecting to login"),e("/login");return}if(t.role!==fi.STUDENT){console.error("🎓 Invalid user role for student app:",t.role),d("Access denied. Student role required.");return}console.log("🎓 Initializing event listeners..."),_(),console.log("🎓 Setting up back to cabinet button listeners..."),T(),console.log("🎓 Setting up password change form listener..."),j(),console.log("🎓 Loading student data..."),await P(),console.log("🎓 Exposing student functions globally..."),R(),console.log("🎓 Populating student info from user data..."),Z(t),a(!0),console.log("🎓 Student Application initialization complete!")}catch(se){console.error("🎓 Error initializing student app:",se),d("Failed to initialize student application")}finally{l(!1)}},[r,t,e]);C.useEffect(()=>{n||k()},[n,r,t,k]);const _=C.useCallback(()=>{console.log("🎓 Setting up student event listeners...");const se=G=>{g&&!G.target.closest(".student-menu")&&y(!1)},L=G=>{G.key==="Escape"&&g&&y(!1)};return document.addEventListener("click",se),document.addEventListener("keydown",L),()=>{document.removeEventListener("click",se),document.removeEventListener("keydown",L)}},[g]),T=C.useCallback(()=>{console.log("🎓 Setting up back to cabinet listeners...")},[]),j=C.useCallback(()=>{console.log("🎓 Setting up password change form...")},[]),P=C.useCallback(async()=>{console.log("🎓 Loading student data...");try{console.log("🎓 Student data loaded successfully")}catch(se){throw console.error("🎓 Error loading student data:",se),se}},[]),R=C.useCallback(()=>{console.log("🎓 Exposing student functions globally..."),window.toggleStudentMenu=N,window.showChangePasswordTab=A,window.hideChangePasswordTab=M,window.navigateBackToCabinet=Q,window.handlePasswordChange=H,window.populateStudentInfoDirectly=Z,console.log("🎓 All student functions exposed globally")},[]),N=C.useCallback(()=>{console.log("🔧 toggleStudentMenu called"),y(se=>{const L=!se;return console.log("🔧 Menu state changed from",se,"to",L),L}),console.log("🔧 Toggled dropdown menu")},[]),A=C.useCallback(()=>{console.log("🔧 showChangePasswordTab called"),w(!0),y(!1)},[]),M=C.useCallback(()=>{console.log("🔧 hideChangePasswordTab called"),w(!1),E({currentPassword:"",newPassword:"",confirmPassword:""})},[]),H=C.useCallback(async se=>{se.preventDefault(),console.log("🔧 handlePasswordChange called");const{currentPassword:L,newPassword:G,confirmPassword:I}=b;if(!L||!G||!I){ae("Please fill in all fields","error");return}if(G!==I){ae("New passwords do not match","error");return}if(G.length<6){ae("New password must be at least 6 characters long","error");return}const z=/[a-zA-Z]/.test(G),V=/[0-9]/.test(G);if(!z||!V){ae("New password must contain both letters and numbers","error");return}if(!t||!t.student_id){ae("Session expired. Please login again.","error");return}const O=t.student_id;if(window.confirm("Are you sure you want to change your password?"))try{l(!0);const W=await Vn.changePassword({studentId:O,currentPassword:L,newPassword:G});W.success?(ae("Password changed successfully!","success"),M()):ae(W.message||"Failed to change password","error")}catch(W){console.error("Password change error:",W),ae("Failed to change password. Please try again.","error")}finally{l(!1)}},[b,t]),Q=C.useCallback(()=>{if(console.log("[DEBUG] navigateBackToCabinet called"),!r||!t){console.warn("[WARN] No valid user found, redirecting to login"),e("/login");return}t.role===fi.STUDENT?(console.log("[DEBUG] Navigating to student cabinet"),e("/student")):(console.warn("[WARN] Unknown user role, redirecting to login"),e("/login"))},[r,t,e]),Z=C.useCallback(se=>{console.log("🎓 populateStudentInfoDirectly called with:",se);try{console.log("🎓 Student info populated successfully")}catch(L){console.error("🎓 Error populating student info:",L)}},[]),ae=C.useCallback((se,L)=>{const G={id:Date.now(),message:se,type:L,timestamp:new Date};p(I=>[...I,G]),setTimeout(()=>{p(I=>I.filter(z=>z.id!==G.id))},Vu.NOTIFICATION_DURATION)},[]),te=C.useCallback(se=>{const{name:L,value:G}=se.target;E(I=>({...I,[L]:G}))},[]);return i?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Initializing Student Application..."})]})}):c?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Initialization Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:c}),o.jsx(rt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):s?o.jsxs("div",{className:"bg-gray-50",children:[o.jsxs(k2,{children:[o.jsx(ds,{path:"/",element:o.jsxs("div",{className:"student-app",children:[o.jsx(Bz,{isMenuOpen:g,onToggleMenu:N,onShowPasswordChange:A}),v&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Change Password"}),o.jsxs("form",{onSubmit:H,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),o.jsx("input",{type:"password",id:"currentPassword",name:"currentPassword",value:b.currentPassword,onChange:te,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),o.jsx("input",{type:"password",id:"newPassword",name:"newPassword",value:b.newPassword,onChange:te,required:!0,minLength:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),o.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:b.confirmPassword,onChange:te,required:!0,minLength:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),o.jsxs("div",{className:"flex space-x-3 pt-4",children:[o.jsx(rt,{type:"button",variant:"secondary",onClick:M,className:"flex-1",children:"Cancel"}),o.jsx(rt,{type:"submit",variant:"primary",disabled:i,className:"flex-1",children:i?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",className:"mr-2"}),"Changing..."]}):"Change Password"})]})]})]})})]})}),o.jsx(ds,{path:"/test/:testType/:testId",element:o.jsx(Yz,{})}),o.jsx(ds,{path:"matching-test/:testId",element:o.jsx(Hz,{})}),o.jsx(ds,{path:"word-matching-test/:testId",element:o.jsx(Gz,{})}),o.jsx(ds,{path:"speaking-test/:testId",element:o.jsx(Xz,{})}),o.jsx(ds,{path:"/results",element:o.jsx(t8,{})})]}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:f.map(se=>o.jsx(el,{type:se.type,message:se.message,onClose:()=>p(L=>L.filter(G=>G.id!==se.id))},se.id))})]}):o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Setting up Student Application..."})]})})},Qz=()=>o.jsx(G3,{children:o.jsx(zA,{children:o.jsx($A,{children:o.jsx(Jz,{})})})}),Zz=({result:e,isOpen:t,onClose:r,initialTab:n="overview",editingSpeakingScore:s,tempSpeakingScore:a,isSavingSpeakingScore:i,onStartSpeakingScoreEdit:l,onSaveSpeakingScore:c,onCancelSpeakingScoreEdit:d,onTempSpeakingScoreChange:f})=>{const[p,g]=C.useState(n),y=C.useRef(!1);if(C.useEffect(()=>()=>{y.current=!0},[]),C.useEffect(()=>{t&&g(n)},[t,n]),!t||!e)return null;const v={test_id:e.test_id,test_name:e.test_name,subject_id:e.subject_id};let w=e?.__audioUrl||void 0;const b=w?void 0:e?.answers;typeof b=="string"?w=b:b&&typeof b=="object"&&(w=b.audio_url),C.useEffect(()=>{console.log("[SpeakingReview] Transcript sources",{fromResult:e?.transcript,fromAnswersObject:typeof b=="object"&&b?.transcript?b.transcript:void 0,hasAnswers:!!b,test_id:e?.test_id,student_id:e?.student_id})},[e?.test_id,e?.student_id]);const[E,k]=C.useState("");C.useEffect(()=>{const T=new AbortController;let j=!1;const P=e?.__studentId||e?.student_id;return!e?.transcript&&!(typeof b=="object"&&b?.transcript)&&e?.test_id&&P&&(async()=>{try{const R=`/.netlify/functions/get-speaking-test-new?action=transcript&test_id=${encodeURIComponent(e.test_id)}&student_id=${encodeURIComponent(P)}`;console.log("[SpeakingReview] Fetching transcript from API:",{url:R});const N=localStorage.getItem("auth_token")||localStorage.getItem("accessToken")||localStorage.getItem("token"),A=await fetch(R,{headers:{Authorization:N?`Bearer ${N}`:""},signal:T.signal});console.log("[SpeakingReview] Transcript API response:",{ok:A.ok,status:A.status});const M=await A.json().catch(()=>({}));console.log("[SpeakingReview] Transcript API body:",M),!j&&!y.current&&(A.ok?k(M.transcript||""):console.warn("[SpeakingReview] Transcript API failed:",M?.error||"unknown error"))}catch(R){R.name!=="AbortError"&&!y.current&&console.error("[SpeakingReview] Transcript fetch error:",R)}})(),()=>{j=!0;try{T.abort()}catch{}}},[e]);const _={score:e.score,max_score:e.max_score,percentage:e.percentage,audio_url:w,transcript:e.transcript||E||(typeof b=="object"&&b?.transcript?b.transcript:void 0),time_taken:e.time_taken,started_at:e.started_at,submitted_at:e.submitted_at};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center",children:[o.jsxs("h2",{className:"text-xl font-semibold",children:["Speaking Test Review - ",v.test_name]}),o.jsx("button",{onClick:r,className:"text-white hover:text-gray-200 text-2xl font-bold",children:"×"})]}),o.jsx("div",{className:"border-b border-gray-200",children:o.jsx("nav",{className:"flex space-x-8 px-6",children:[{id:"audio",label:"Audio"},{id:"transcript",label:"Transcript"},{id:"analysis",label:"AI Analysis"},{id:"scoring",label:"Scoring"}].map(T=>o.jsx("button",{onClick:()=>g(T.id),className:`py-4 px-1 border-b-2 font-medium text-sm ${p===T.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:T.label},T.id))})}),o.jsxs("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:[p==="overview"&&o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Test Name"}),o.jsx("p",{className:"mt-1 text-sm text-gray-900",children:v.test_name})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Score"}),o.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[_.score," / ",_.max_score]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Time Taken"}),o.jsx("p",{className:"mt-1 text-sm text-gray-900",children:_.time_taken?`${Math.floor(_.time_taken/60)}:${(_.time_taken%60).toString().padStart(2,"0")}`:"N/A"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Submitted At"}),o.jsx("p",{className:"mt-1 text-sm text-gray-900",children:_.submitted_at?new Date(_.submitted_at).toLocaleString():"N/A"})]})]})}),p==="audio"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Audio Recording"}),_.audio_url?o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-sm text-gray-600",children:"Click the play button to listen to the student's recording:"}),o.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:o.jsx(r8,{audioUrl:_.audio_url,className:"w-full"})})]}):o.jsx("div",{className:"text-center py-8 text-gray-500",children:o.jsx("p",{children:"No audio recording available"})})]}),p==="transcript"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transcript"}),_.transcript?o.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:o.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:_.transcript})}):o.jsx("div",{className:"text-center py-8 text-gray-500",children:o.jsx("p",{children:"No transcript available"})})]}),p==="analysis"&&o.jsxs("div",{className:"space-y-6",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"AI Analysis Results"}),(()=>{let T=e.ai_feedback;if(T&&typeof T=="string")try{T=JSON.parse(T)}catch{T=null}return T?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-4",children:"Overall Performance"}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold text-gray-800",children:T.overall_score||0}),o.jsx("div",{className:"text-sm text-gray-600",children:"Overall Score (0-100)"})]})]}),o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-4",children:"Category Breakdown"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-lg font-bold text-blue-600",children:[T.grammar_score||0,"/25"]}),o.jsx("div",{className:"text-xs text-gray-600",children:"Grammar"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-lg font-bold text-green-600",children:[T.vocabulary_score||0,"/20"]}),o.jsx("div",{className:"text-xs text-gray-600",children:"Vocabulary"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-lg font-bold text-purple-600",children:[T.pronunciation_score||0,"/15"]}),o.jsx("div",{className:"text-xs text-gray-600",children:"Pronunciation"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-lg font-bold text-orange-600",children:[T.fluency_score||0,"/20"]}),o.jsx("div",{className:"text-xs text-gray-600",children:"Fluency"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-lg font-bold text-red-600",children:[T.content_score||0,"/20"]}),o.jsx("div",{className:"text-xs text-gray-600",children:"Content"})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"Performance Metrics"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Word Count:"}),o.jsx("span",{className:"text-sm font-medium",children:T.word_count||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Grammar Mistakes:"}),o.jsx("span",{className:"text-sm font-medium text-red-600",children:T.grammar_mistakes||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Vocabulary Issues:"}),o.jsx("span",{className:"text-sm font-medium text-red-600",children:T.vocabulary_mistakes||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Difficulty Level:"}),o.jsx("span",{className:"text-sm font-medium",children:T.difficulty_level||"N/A"})]})]})]}),o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"AI Feedback"}),T.feedback?o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:o.jsx("p",{className:"text-sm text-gray-700",children:T.feedback})}):o.jsx("div",{className:"text-center py-4 text-gray-500",children:o.jsx("p",{className:"text-sm",children:"No AI feedback available"})})]})]}),T.improved_transcript&&o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"Improved Transcript"}),o.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:o.jsx("p",{className:"text-sm text-gray-700",children:T.improved_transcript})})]}),T.grammar_corrections&&T.grammar_corrections.length>0&&o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"Grammar Corrections"}),o.jsx("div",{className:"space-y-3",children:T.grammar_corrections.map((j,P)=>o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[o.jsxs("div",{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-red-800",children:"Mistake:"})," ",j.mistake]}),o.jsxs("div",{className:"text-sm mt-1",children:[o.jsx("span",{className:"font-medium text-green-800",children:"Correction:"})," ",j.correction]}),j.explanation&&o.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[o.jsx("span",{className:"font-medium",children:"Explanation:"})," ",j.explanation]})]},P))})]}),T.vocabulary_corrections&&T.vocabulary_corrections.length>0&&o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"Vocabulary Improvements"}),o.jsx("div",{className:"space-y-3",children:T.vocabulary_corrections.map((j,P)=>o.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[o.jsxs("div",{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-yellow-800",children:"Original:"})," ",j.mistake]}),o.jsxs("div",{className:"text-sm mt-1",children:[o.jsx("span",{className:"font-medium text-green-800",children:"Better:"})," ",j.correction]}),j.explanation&&o.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[o.jsx("span",{className:"font-medium",children:"Explanation:"})," ",j.explanation]})]},P))})]}),T.language_use_corrections&&T.language_use_corrections.length>0&&o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"Language Use Suggestions"}),o.jsx("div",{className:"space-y-3",children:T.language_use_corrections.map((j,P)=>o.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[o.jsxs("div",{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-blue-800",children:"Original:"})," ",j.mistake]}),o.jsxs("div",{className:"text-sm mt-1",children:[o.jsx("span",{className:"font-medium text-blue-800",children:"Suggestion:"})," ",j.suggestion]}),j.explanation&&o.jsx("div",{className:"text-xs text-blue-700 mt-1",children:j.explanation})]},P))})]})]}):o.jsx("div",{className:"text-center py-8 text-gray-500",children:o.jsx("p",{children:"No AI analysis available for this result"})})})()]}),p==="scoring"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900 text-center",children:"Score Details"}),s?o.jsxs("div",{className:"space-y-4 text-center",children:[o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 place-items-center",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 text-center",children:"Score"}),o.jsx("input",{type:"number",min:"0",max:_.max_score,value:a,onChange:T=>f(T.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 text-center",children:"Max Score"}),o.jsxs("p",{className:"mt-1 text-sm text-gray-900 text-center",children:[_.max_score," (Fixed)"]})]})]}),o.jsxs("div",{className:"flex justify-center space-x-3",children:[o.jsx("button",{onClick:c,disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:i?"Saving...":"Save Score"}),o.jsx("button",{onClick:d,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Cancel"})]})]}):o.jsxs("div",{className:"space-y-4 text-center",children:[o.jsx("div",{className:"grid grid-cols-1 place-items-center gap-2",children:o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 text-center",children:"Current Score"}),o.jsxs("p",{className:"mt-1 text-sm text-gray-900 text-center",children:[_.score," / ",_.max_score]})]})}),o.jsx("button",{onClick:()=>l(e.id,_.score),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 mx-auto",children:"Edit Score"})]})]})]}),o.jsx("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3",children:o.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Close"})})]})})};class pE extends us.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){if(console.error("ErrorBoundary caught an error:",t,r),t.message&&t.message.includes("Minified React error #300")){console.warn("React error #300 caught and handled by ErrorBoundary");return}}render(){return this.state.hasError?o.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[o.jsx("h3",{className:"text-red-800 font-medium",children:"Something went wrong"}),o.jsx("p",{className:"text-red-600 text-sm mt-1",children:"An error occurred while rendering this component."})]}):this.props.children}}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var m1={};m1.version="0.18.5";var n8=1252,eH=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],iS={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},oS=function(e){eH.indexOf(e)!=-1&&(n8=iS[0]=e)};function tH(){oS(1252)}var Xo=function(e){oS(e)};function lS(){Xo(1200),tH()}function xE(e){for(var t=[],r=0,n=e.length;r<n;++r)t[r]=e.charCodeAt(r);return t}function rH(e){for(var t=[],r=0;r<e.length>>1;++r)t[r]=String.fromCharCode(e.charCodeAt(2*r)+(e.charCodeAt(2*r+1)<<8));return t.join("")}function s8(e){for(var t=[],r=0;r<e.length>>1;++r)t[r]=String.fromCharCode(e.charCodeAt(2*r+1)+(e.charCodeAt(2*r)<<8));return t.join("")}var jm=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1);return t==255&&r==254?rH(e.slice(2)):t==254&&r==255?s8(e.slice(2)):t==65279?e.slice(1):e},vy=function(t){return String.fromCharCode(t)},yE=function(t){return String.fromCharCode(t)},gp,Iu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function mp(e){for(var t="",r=0,n=0,s=0,a=0,i=0,l=0,c=0,d=0;d<e.length;)r=e.charCodeAt(d++),a=r>>2,n=e.charCodeAt(d++),i=(r&3)<<4|n>>4,s=e.charCodeAt(d++),l=(n&15)<<2|s>>6,c=s&63,isNaN(n)?l=c=64:isNaN(s)&&(c=64),t+=Iu.charAt(a)+Iu.charAt(i)+Iu.charAt(l)+Iu.charAt(c);return t}function Yi(e){var t="",r=0,n=0,s=0,a=0,i=0,l=0,c=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var d=0;d<e.length;)a=Iu.indexOf(e.charAt(d++)),i=Iu.indexOf(e.charAt(d++)),r=a<<2|i>>4,t+=String.fromCharCode(r),l=Iu.indexOf(e.charAt(d++)),n=(i&15)<<4|l>>2,l!==64&&(t+=String.fromCharCode(n)),c=Iu.indexOf(e.charAt(d++)),s=(l&3)<<6|c,c!==64&&(t+=String.fromCharCode(s));return t}var Gr=(function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node})(),Bc=(function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(t,r){return r?new Buffer(t,r):new Buffer(t)}:Buffer.from.bind(Buffer)}return function(){}})();function Ku(e){return Gr?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function vE(e){return Gr?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var Ki=function(t){return Gr?Bc(t,"binary"):t.split("").map(function(r){return r.charCodeAt(0)&255})};function nv(e){if(typeof ArrayBuffer>"u")return Ki(e);for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n!=e.length;++n)r[n]=e.charCodeAt(n)&255;return t}function sd(e){if(Array.isArray(e))return e.map(function(n){return String.fromCharCode(n)}).join("");for(var t=[],r=0;r<e.length;++r)t[r]=String.fromCharCode(e[r]);return t.join("")}function nH(e){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(e)}function cS(e){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(e instanceof ArrayBuffer)return cS(new Uint8Array(e));for(var t=new Array(e.length),r=0;r<e.length;++r)t[r]=e[r];return t}var la=Gr?function(e){return Buffer.concat(e.map(function(t){return Buffer.isBuffer(t)?t:Bc(t)}))}:function(e){if(typeof Uint8Array<"u"){var t=0,r=0;for(t=0;t<e.length;++t)r+=e[t].length;var n=new Uint8Array(r),s=0;for(t=0,r=0;t<e.length;r+=s,++t)if(s=e[t].length,e[t]instanceof Uint8Array)n.set(e[t],r);else{if(typeof e[t]=="string")throw"wtf";n.set(new Uint8Array(e[t]),r)}return n}return[].concat.apply([],e.map(function(a){return Array.isArray(a)?a:[].slice.call(a)}))};function sH(e){for(var t=[],r=0,n=e.length+250,s=Ku(e.length+255),a=0;a<e.length;++a){var i=e.charCodeAt(a);if(i<128)s[r++]=i;else if(i<2048)s[r++]=192|i>>6&31,s[r++]=128|i&63;else if(i>=55296&&i<57344){i=(i&1023)+64;var l=e.charCodeAt(++a)&1023;s[r++]=240|i>>8&7,s[r++]=128|i>>2&63,s[r++]=128|l>>6&15|(i&3)<<4,s[r++]=128|l&63}else s[r++]=224|i>>12&15,s[r++]=128|i>>6&63,s[r++]=128|i&63;r>n&&(t.push(s.slice(0,r)),r=0,s=Ku(65535),n=65530)}return t.push(s.slice(0,r)),la(t)}var pi=/\u0000/g,Am=/[\u0001-\u0006]/g;function n0(e){for(var t="",r=e.length-1;r>=0;)t+=e.charAt(r--);return t}function Yo(e,t){var r=""+e;return r.length>=t?r:fs("0",t-r.length)+r}function uS(e,t){var r=""+e;return r.length>=t?r:fs(" ",t-r.length)+r}function p1(e,t){var r=""+e;return r.length>=t?r:r+fs(" ",t-r.length)}function aH(e,t){var r=""+Math.round(e);return r.length>=t?r:fs("0",t-r.length)+r}function iH(e,t){var r=""+e;return r.length>=t?r:fs("0",t-r.length)+r}var wE=Math.pow(2,32);function Ah(e,t){if(e>wE||e<-wE)return aH(e,t);var r=Math.round(e);return iH(r,t)}function x1(e,t){return t=t||0,e.length>=7+t&&(e.charCodeAt(t)|32)===103&&(e.charCodeAt(t+1)|32)===101&&(e.charCodeAt(t+2)|32)===110&&(e.charCodeAt(t+3)|32)===101&&(e.charCodeAt(t+4)|32)===114&&(e.charCodeAt(t+5)|32)===97&&(e.charCodeAt(t+6)|32)===108}var _E=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Ww=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function oH(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',e}var Cr={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},bE={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},lH={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function y1(e,t,r){for(var n=e<0?-1:1,s=e*n,a=0,i=1,l=0,c=1,d=0,f=0,p=Math.floor(s);d<t&&(p=Math.floor(s),l=p*i+a,f=p*d+c,!(s-p<5e-8));)s=1/(s-p),a=i,i=l,c=d,d=f;if(f>t&&(d>t?(f=c,l=a):(f=d,l=i)),!r)return[0,n*l,f];var g=Math.floor(n*l/f);return[g,n*l-g*f,f]}function Vd(e,t,r){if(e>2958465||e<0)return null;var n=e|0,s=Math.floor(86400*(e-n)),a=0,i=[],l={D:n,T:s,u:86400*(e-n)-s,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(l.u)<1e-6&&(l.u=0),t&&t.date1904&&(n+=1462),l.u>.9999&&(l.u=0,++s==86400&&(l.T=s=0,++n,++l.D)),n===60)i=r?[1317,10,29]:[1900,2,29],a=3;else if(n===0)i=r?[1317,8,29]:[1900,1,0],a=6;else{n>60&&--n;var c=new Date(1900,0,1);c.setDate(c.getDate()+n-1),i=[c.getFullYear(),c.getMonth()+1,c.getDate()],a=c.getDay(),n<60&&(a=(a+6)%7),r&&(a=gH(c,i))}return l.y=i[0],l.m=i[1],l.d=i[2],l.S=s%60,s=Math.floor(s/60),l.M=s%60,s=Math.floor(s/60),l.H=s,l.q=a,l}var a8=new Date(1899,11,31,0,0,0),cH=a8.getTime(),uH=new Date(1900,2,1,0,0,0);function i8(e,t){var r=e.getTime();return t?r-=1461*24*60*60*1e3:e>=uH&&(r+=1440*60*1e3),(r-(cH+(e.getTimezoneOffset()-a8.getTimezoneOffset())*6e4))/(1440*60*1e3)}function dS(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function dH(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function fH(e){var t=e<0?12:11,r=dS(e.toFixed(12));return r.length<=t||(r=e.toPrecision(10),r.length<=t)?r:e.toExponential(5)}function hH(e){var t=dS(e.toFixed(11));return t.length>(e<0?12:11)||t==="0"||t==="-0"?e.toPrecision(6):t}function pp(e){var t=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),r;return t>=-4&&t<=-1?r=e.toPrecision(10+t):Math.abs(t)<=9?r=fH(e):t===10?r=e.toFixed(10).substr(0,12):r=hH(e),dS(dH(r.toUpperCase()))}function yf(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):pp(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return No(14,i8(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function gH(e,t){t[0]-=581;var r=e.getDay();return e<60&&(r=(r+6)%7),r}function mH(e,t,r,n){var s="",a=0,i=0,l=r.y,c,d=0;switch(e){case 98:l=r.y+543;case 121:switch(t.length){case 1:case 2:c=l%100,d=2;break;default:c=l%1e4,d=4;break}break;case 109:switch(t.length){case 1:case 2:c=r.m,d=t.length;break;case 3:return Ww[r.m-1][1];case 5:return Ww[r.m-1][0];default:return Ww[r.m-1][2]}break;case 100:switch(t.length){case 1:case 2:c=r.d,d=t.length;break;case 3:return _E[r.q][0];default:return _E[r.q][1]}break;case 104:switch(t.length){case 1:case 2:c=1+(r.H+11)%12,d=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:c=r.H,d=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:c=r.M,d=t.length;break;default:throw"bad minute format: "+t}break;case 115:if(t!="s"&&t!="ss"&&t!=".0"&&t!=".00"&&t!=".000")throw"bad second format: "+t;return r.u===0&&(t=="s"||t=="ss")?Yo(r.S,t.length):(n>=2?i=n===3?1e3:100:i=n===1?10:1,a=Math.round(i*(r.S+r.u)),a>=60*i&&(a=0),t==="s"?a===0?"0":""+a/i:(s=Yo(a,2+n),t==="ss"?s.substr(0,2):"."+s.substr(2,t.length-1)));case 90:switch(t){case"[h]":case"[hh]":c=r.D*24+r.H;break;case"[m]":case"[mm]":c=(r.D*24+r.H)*60+r.M;break;case"[s]":case"[ss]":c=((r.D*24+r.H)*60+r.M)*60+Math.round(r.S+r.u);break;default:throw"bad abstime format: "+t}d=t.length===3?1:2;break;case 101:c=l,d=1;break}var f=d>0?Yo(c,d):"";return f}function Mu(e){var t=3;if(e.length<=t)return e;for(var r=e.length%t,n=e.substr(0,r);r!=e.length;r+=t)n+=(n.length>0?",":"")+e.substr(r,t);return n}var o8=/%/g;function pH(e,t,r){var n=t.replace(o8,""),s=t.length-n.length;return Ec(e,n,r*Math.pow(10,2*s))+fs("%",s)}function xH(e,t,r){for(var n=t.length-1;t.charCodeAt(n-1)===44;)--n;return Ec(e,t.substr(0,n),r/Math.pow(10,3*(t.length-n)))}function l8(e,t){var r,n=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+l8(e,-t);var s=e.indexOf(".");s===-1&&(s=e.indexOf("E"));var a=Math.floor(Math.log(t)*Math.LOG10E)%s;if(a<0&&(a+=s),r=(t/Math.pow(10,a)).toPrecision(n+1+(s+a)%s),r.indexOf("e")===-1){var i=Math.floor(Math.log(t)*Math.LOG10E);for(r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(i-r.length+a):r+="E+"+(i-a);r.substr(0,2)==="0.";)r=r.charAt(0)+r.substr(2,s)+"."+r.substr(2+s),r=r.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,d,f){return c+d+f.substr(0,(s+a)%s)+"."+f.substr(a)+"E"})}else r=t.toExponential(n);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}var c8=/# (\?+)( ?)\/( ?)(\d+)/;function yH(e,t,r){var n=parseInt(e[4],10),s=Math.round(t*n),a=Math.floor(s/n),i=s-a*n,l=n;return r+(a===0?"":""+a)+" "+(i===0?fs(" ",e[1].length+1+e[4].length):uS(i,e[1].length)+e[2]+"/"+e[3]+Yo(l,e[4].length))}function vH(e,t,r){return r+(t===0?"":""+t)+fs(" ",e[1].length+2+e[4].length)}var u8=/^#*0*\.([0#]+)/,d8=/\).*[0#]/,f8=/\(###\) ###\\?-####/;function ui(e){for(var t="",r,n=0;n!=e.length;++n)switch(r=e.charCodeAt(n)){case 35:break;case 63:t+=" ";break;case 48:t+="0";break;default:t+=String.fromCharCode(r)}return t}function SE(e,t){var r=Math.pow(10,t);return""+Math.round(e*r)/r}function kE(e,t){var r=e-Math.floor(e),n=Math.pow(10,t);return t<(""+Math.round(r*n)).length?0:Math.round(r*n)}function wH(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}function _H(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function mo(e,t,r){if(e.charCodeAt(0)===40&&!t.match(d8)){var n=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?mo("n",n,r):"("+mo("n",n,-r)+")"}if(t.charCodeAt(t.length-1)===44)return xH(e,t,r);if(t.indexOf("%")!==-1)return pH(e,t,r);if(t.indexOf("E")!==-1)return l8(t,r);if(t.charCodeAt(0)===36)return"$"+mo(e,t.substr(t.charAt(1)==" "?2:1),r);var s,a,i,l,c=Math.abs(r),d=r<0?"-":"";if(t.match(/^00+$/))return d+Ah(c,t.length);if(t.match(/^[#?]+$/))return s=Ah(r,0),s==="0"&&(s=""),s.length>t.length?s:ui(t.substr(0,t.length-s.length))+s;if(a=t.match(c8))return yH(a,c,d);if(t.match(/^#+0+$/))return d+Ah(c,t.length-t.indexOf("0"));if(a=t.match(u8))return s=SE(r,a[1].length).replace(/^([^\.]+)$/,"$1."+ui(a[1])).replace(/\.$/,"."+ui(a[1])).replace(/\.(\d*)$/,function(v,w){return"."+w+fs("0",ui(a[1]).length-w.length)}),t.indexOf("0.")!==-1?s:s.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),a=t.match(/^(0*)\.(#*)$/))return d+SE(c,a[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=t.match(/^#{1,3},##0(\.?)$/))return d+Mu(Ah(c,0));if(a=t.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+mo(e,t,-r):Mu(""+(Math.floor(r)+wH(r,a[1].length)))+"."+Yo(kE(r,a[1].length),a[1].length);if(a=t.match(/^#,#*,#0/))return mo(e,t.replace(/^#,#*,/,""),r);if(a=t.match(/^([0#]+)(\\?-([0#]+))+$/))return s=n0(mo(e,t.replace(/[\\-]/g,""),r)),i=0,n0(n0(t.replace(/\\/g,"")).replace(/[0#]/g,function(v){return i<s.length?s.charAt(i++):v==="0"?"0":""}));if(t.match(f8))return s=mo(e,"##########",r),"("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var f="";if(a=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(a[4].length,7),l=y1(c,Math.pow(10,i)-1,!1),s=""+d,f=Ec("n",a[1],l[1]),f.charAt(f.length-1)==" "&&(f=f.substr(0,f.length-1)+"0"),s+=f+a[2]+"/"+a[3],f=p1(l[2],i),f.length<a[4].length&&(f=ui(a[4].substr(a[4].length-f.length))+f),s+=f,s;if(a=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(a[1].length,a[4].length),7),l=y1(c,Math.pow(10,i)-1,!0),d+(l[0]||(l[1]?"":"0"))+" "+(l[1]?uS(l[1],i)+a[2]+"/"+a[3]+p1(l[2],i):fs(" ",2*i+1+a[2].length+a[3].length));if(a=t.match(/^[#0?]+$/))return s=Ah(r,0),t.length<=s.length?s:ui(t.substr(0,t.length-s.length))+s;if(a=t.match(/^([#0?]+)\.([#0]+)$/)){s=""+r.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),i=s.indexOf(".");var p=t.indexOf(".")-i,g=t.length-s.length-p;return ui(t.substr(0,p)+s+t.substr(t.length-g))}if(a=t.match(/^00,000\.([#0]*0)$/))return i=kE(r,a[1].length),r<0?"-"+mo(e,t,-r):Mu(_H(r)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(v){return"00,"+(v.length<3?Yo(0,3-v.length):"")+v})+"."+Yo(i,a[1].length);switch(t){case"###,##0.00":return mo(e,"#,##0.00",r);case"###,###":case"##,###":case"#,###":var y=Mu(Ah(c,0));return y!=="0"?d+y:"";case"###,###.00":return mo(e,"###,##0.00",r).replace(/^0\./,".");case"#,###.00":return mo(e,"#,##0.00",r).replace(/^0\./,".")}throw new Error("unsupported format |"+t+"|")}function bH(e,t,r){for(var n=t.length-1;t.charCodeAt(n-1)===44;)--n;return Ec(e,t.substr(0,n),r/Math.pow(10,3*(t.length-n)))}function SH(e,t,r){var n=t.replace(o8,""),s=t.length-n.length;return Ec(e,n,r*Math.pow(10,2*s))+fs("%",s)}function h8(e,t){var r,n=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+h8(e,-t);var s=e.indexOf(".");s===-1&&(s=e.indexOf("E"));var a=Math.floor(Math.log(t)*Math.LOG10E)%s;if(a<0&&(a+=s),r=(t/Math.pow(10,a)).toPrecision(n+1+(s+a)%s),!r.match(/[Ee]/)){var i=Math.floor(Math.log(t)*Math.LOG10E);r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(i-r.length+a):r+="E+"+(i-a),r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,d,f){return c+d+f.substr(0,(s+a)%s)+"."+f.substr(a)+"E"})}else r=t.toExponential(n);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}function El(e,t,r){if(e.charCodeAt(0)===40&&!t.match(d8)){var n=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?El("n",n,r):"("+El("n",n,-r)+")"}if(t.charCodeAt(t.length-1)===44)return bH(e,t,r);if(t.indexOf("%")!==-1)return SH(e,t,r);if(t.indexOf("E")!==-1)return h8(t,r);if(t.charCodeAt(0)===36)return"$"+El(e,t.substr(t.charAt(1)==" "?2:1),r);var s,a,i,l,c=Math.abs(r),d=r<0?"-":"";if(t.match(/^00+$/))return d+Yo(c,t.length);if(t.match(/^[#?]+$/))return s=""+r,r===0&&(s=""),s.length>t.length?s:ui(t.substr(0,t.length-s.length))+s;if(a=t.match(c8))return vH(a,c,d);if(t.match(/^#+0+$/))return d+Yo(c,t.length-t.indexOf("0"));if(a=t.match(u8))return s=(""+r).replace(/^([^\.]+)$/,"$1."+ui(a[1])).replace(/\.$/,"."+ui(a[1])),s=s.replace(/\.(\d*)$/,function(v,w){return"."+w+fs("0",ui(a[1]).length-w.length)}),t.indexOf("0.")!==-1?s:s.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),a=t.match(/^(0*)\.(#*)$/))return d+(""+c).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=t.match(/^#{1,3},##0(\.?)$/))return d+Mu(""+c);if(a=t.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+El(e,t,-r):Mu(""+r)+"."+fs("0",a[1].length);if(a=t.match(/^#,#*,#0/))return El(e,t.replace(/^#,#*,/,""),r);if(a=t.match(/^([0#]+)(\\?-([0#]+))+$/))return s=n0(El(e,t.replace(/[\\-]/g,""),r)),i=0,n0(n0(t.replace(/\\/g,"")).replace(/[0#]/g,function(v){return i<s.length?s.charAt(i++):v==="0"?"0":""}));if(t.match(f8))return s=El(e,"##########",r),"("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var f="";if(a=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(a[4].length,7),l=y1(c,Math.pow(10,i)-1,!1),s=""+d,f=Ec("n",a[1],l[1]),f.charAt(f.length-1)==" "&&(f=f.substr(0,f.length-1)+"0"),s+=f+a[2]+"/"+a[3],f=p1(l[2],i),f.length<a[4].length&&(f=ui(a[4].substr(a[4].length-f.length))+f),s+=f,s;if(a=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(a[1].length,a[4].length),7),l=y1(c,Math.pow(10,i)-1,!0),d+(l[0]||(l[1]?"":"0"))+" "+(l[1]?uS(l[1],i)+a[2]+"/"+a[3]+p1(l[2],i):fs(" ",2*i+1+a[2].length+a[3].length));if(a=t.match(/^[#0?]+$/))return s=""+r,t.length<=s.length?s:ui(t.substr(0,t.length-s.length))+s;if(a=t.match(/^([#0]+)\.([#0]+)$/)){s=""+r.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),i=s.indexOf(".");var p=t.indexOf(".")-i,g=t.length-s.length-p;return ui(t.substr(0,p)+s+t.substr(t.length-g))}if(a=t.match(/^00,000\.([#0]*0)$/))return r<0?"-"+El(e,t,-r):Mu(""+r).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(v){return"00,"+(v.length<3?Yo(0,3-v.length):"")+v})+"."+Yo(0,a[1].length);switch(t){case"###,###":case"##,###":case"#,###":var y=Mu(""+c);return y!=="0"?d+y:"";default:if(t.match(/\.[0#?]*$/))return El(e,t.slice(0,t.lastIndexOf(".")),r)+ui(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function Ec(e,t,r){return(r|0)===r?El(e,t,r):mo(e,t,r)}function kH(e){for(var t=[],r=!1,n=0,s=0;n<e.length;++n)switch(e.charCodeAt(n)){case 34:r=!r;break;case 95:case 42:case 92:++n;break;case 59:t[t.length]=e.substr(s,n-s),s=n+1}if(t[t.length]=e.substr(s),r===!0)throw new Error("Format |"+e+"| unterminated string ");return t}var g8=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function M0(e){for(var t=0,r="",n="";t<e.length;)switch(r=e.charAt(t)){case"G":x1(e,t)&&(t+=6),t++;break;case'"':for(;e.charCodeAt(++t)!==34&&t<e.length;);++t;break;case"\\":t+=2;break;case"_":t+=2;break;case"@":++t;break;case"B":case"b":if(e.charAt(t+1)==="1"||e.charAt(t+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(e.substr(t,3).toUpperCase()==="A/P"||e.substr(t,5).toUpperCase()==="AM/PM"||e.substr(t,5).toUpperCase()==="上午/下午")return!0;++t;break;case"[":for(n=r;e.charAt(t++)!=="]"&&t<e.length;)n+=e.charAt(t);if(n.match(g8))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(r=e.charAt(++t))>-1||r=="\\"&&e.charAt(t+1)=="-"&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===r;);break;case"*":++t,(e.charAt(t)==" "||e.charAt(t)=="*")&&++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;case" ":++t;break;default:++t;break}return!1}function CH(e,t,r,n){for(var s=[],a="",i=0,l="",c="t",d,f,p,g="H";i<e.length;)switch(l=e.charAt(i)){case"G":if(!x1(e,i))throw new Error("unrecognized character "+l+" in "+e);s[s.length]={t:"G",v:"General"},i+=7;break;case'"':for(a="";(p=e.charCodeAt(++i))!==34&&i<e.length;)a+=String.fromCharCode(p);s[s.length]={t:"t",v:a},++i;break;case"\\":var y=e.charAt(++i),v=y==="("||y===")"?y:"t";s[s.length]={t:v,v:y},++i;break;case"_":s[s.length]={t:"t",v:" "},i+=2;break;case"@":s[s.length]={t:"T",v:t},++i;break;case"B":case"b":if(e.charAt(i+1)==="1"||e.charAt(i+1)==="2"){if(d==null&&(d=Vd(t,r,e.charAt(i+1)==="2"),d==null))return"";s[s.length]={t:"X",v:e.substr(i,2)},c=l,i+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":l=l.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0||d==null&&(d=Vd(t,r),d==null))return"";for(a=l;++i<e.length&&e.charAt(i).toLowerCase()===l;)a+=l;l==="m"&&c.toLowerCase()==="h"&&(l="M"),l==="h"&&(l=g),s[s.length]={t:l,v:a},c=l;break;case"A":case"a":case"上":var w={t:l,v:l};if(d==null&&(d=Vd(t,r)),e.substr(i,3).toUpperCase()==="A/P"?(d!=null&&(w.v=d.H>=12?"P":"A"),w.t="T",g="h",i+=3):e.substr(i,5).toUpperCase()==="AM/PM"?(d!=null&&(w.v=d.H>=12?"PM":"AM"),w.t="T",i+=5,g="h"):e.substr(i,5).toUpperCase()==="上午/下午"?(d!=null&&(w.v=d.H>=12?"下午":"上午"),w.t="T",i+=5,g="h"):(w.t="t",++i),d==null&&w.t==="T")return"";s[s.length]=w,c=l;break;case"[":for(a=l;e.charAt(i++)!=="]"&&i<e.length;)a+=e.charAt(i);if(a.slice(-1)!=="]")throw'unterminated "[" block: |'+a+"|";if(a.match(g8)){if(d==null&&(d=Vd(t,r),d==null))return"";s[s.length]={t:"Z",v:a.toLowerCase()},c=a.charAt(1)}else a.indexOf("$")>-1&&(a=(a.match(/\$([^-\[\]]*)/)||[])[1]||"$",M0(e)||(s[s.length]={t:"t",v:a}));break;case".":if(d!=null){for(a=l;++i<e.length&&(l=e.charAt(i))==="0";)a+=l;s[s.length]={t:"s",v:a};break}case"0":case"#":for(a=l;++i<e.length&&"0#?.,E+-%".indexOf(l=e.charAt(i))>-1;)a+=l;s[s.length]={t:"n",v:a};break;case"?":for(a=l;e.charAt(++i)===l;)a+=l;s[s.length]={t:l,v:a},c=l;break;case"*":++i,(e.charAt(i)==" "||e.charAt(i)=="*")&&++i;break;case"(":case")":s[s.length]={t:n===1?"t":l,v:l},++i;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(a=l;i<e.length&&"0123456789".indexOf(e.charAt(++i))>-1;)a+=e.charAt(i);s[s.length]={t:"D",v:a};break;case" ":s[s.length]={t:l,v:l},++i;break;case"$":s[s.length]={t:"t",v:"$"},++i;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(l)===-1)throw new Error("unrecognized character "+l+" in "+e);s[s.length]={t:"t",v:l},++i;break}var b=0,E=0,k;for(i=s.length-1,c="t";i>=0;--i)switch(s[i].t){case"h":case"H":s[i].t=g,c="h",b<1&&(b=1);break;case"s":(k=s[i].v.match(/\.0+$/))&&(E=Math.max(E,k[0].length-1)),b<3&&(b=3);case"d":case"y":case"M":case"e":c=s[i].t;break;case"m":c==="s"&&(s[i].t="M",b<2&&(b=2));break;case"X":break;case"Z":b<1&&s[i].v.match(/[Hh]/)&&(b=1),b<2&&s[i].v.match(/[Mm]/)&&(b=2),b<3&&s[i].v.match(/[Ss]/)&&(b=3)}switch(b){case 0:break;case 1:d.u>=.5&&(d.u=0,++d.S),d.S>=60&&(d.S=0,++d.M),d.M>=60&&(d.M=0,++d.H);break;case 2:d.u>=.5&&(d.u=0,++d.S),d.S>=60&&(d.S=0,++d.M);break}var _="",T;for(i=0;i<s.length;++i)switch(s[i].t){case"t":case"T":case" ":case"D":break;case"X":s[i].v="",s[i].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":s[i].v=mH(s[i].t.charCodeAt(0),s[i].v,d,E),s[i].t="t";break;case"n":case"?":for(T=i+1;s[T]!=null&&((l=s[T].t)==="?"||l==="D"||(l===" "||l==="t")&&s[T+1]!=null&&(s[T+1].t==="?"||s[T+1].t==="t"&&s[T+1].v==="/")||s[i].t==="("&&(l===" "||l==="n"||l===")")||l==="t"&&(s[T].v==="/"||s[T].v===" "&&s[T+1]!=null&&s[T+1].t=="?"));)s[i].v+=s[T].v,s[T]={v:"",t:";"},++T;_+=s[i].v,i=T-1;break;case"G":s[i].t="t",s[i].v=yf(t,r);break}var j="",P,R;if(_.length>0){_.charCodeAt(0)==40?(P=t<0&&_.charCodeAt(0)===45?-t:t,R=Ec("n",_,P)):(P=t<0&&n>1?-t:t,R=Ec("n",_,P),P<0&&s[0]&&s[0].t=="t"&&(R=R.substr(1),s[0].v="-"+s[0].v)),T=R.length-1;var N=s.length;for(i=0;i<s.length;++i)if(s[i]!=null&&s[i].t!="t"&&s[i].v.indexOf(".")>-1){N=i;break}var A=s.length;if(N===s.length&&R.indexOf("E")===-1){for(i=s.length-1;i>=0;--i)s[i]==null||"n?".indexOf(s[i].t)===-1||(T>=s[i].v.length-1?(T-=s[i].v.length,s[i].v=R.substr(T+1,s[i].v.length)):T<0?s[i].v="":(s[i].v=R.substr(0,T+1),T=-1),s[i].t="t",A=i);T>=0&&A<s.length&&(s[A].v=R.substr(0,T+1)+s[A].v)}else if(N!==s.length&&R.indexOf("E")===-1){for(T=R.indexOf(".")-1,i=N;i>=0;--i)if(!(s[i]==null||"n?".indexOf(s[i].t)===-1)){for(f=s[i].v.indexOf(".")>-1&&i===N?s[i].v.indexOf(".")-1:s[i].v.length-1,j=s[i].v.substr(f+1);f>=0;--f)T>=0&&(s[i].v.charAt(f)==="0"||s[i].v.charAt(f)==="#")&&(j=R.charAt(T--)+j);s[i].v=j,s[i].t="t",A=i}for(T>=0&&A<s.length&&(s[A].v=R.substr(0,T+1)+s[A].v),T=R.indexOf(".")+1,i=N;i<s.length;++i)if(!(s[i]==null||"n?(".indexOf(s[i].t)===-1&&i!==N)){for(f=s[i].v.indexOf(".")>-1&&i===N?s[i].v.indexOf(".")+1:0,j=s[i].v.substr(0,f);f<s[i].v.length;++f)T<R.length&&(j+=R.charAt(T++));s[i].v=j,s[i].t="t",A=i}}}for(i=0;i<s.length;++i)s[i]!=null&&"n?".indexOf(s[i].t)>-1&&(P=n>1&&t<0&&i>0&&s[i-1].v==="-"?-t:t,s[i].v=Ec(s[i].t,s[i].v,P),s[i].t="t");var M="";for(i=0;i!==s.length;++i)s[i]!=null&&(M+=s[i].v);return M}var CE=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function TE(e,t){if(t==null)return!1;var r=parseFloat(t[2]);switch(t[1]){case"=":if(e==r)return!0;break;case">":if(e>r)return!0;break;case"<":if(e<r)return!0;break;case"<>":if(e!=r)return!0;break;case">=":if(e>=r)return!0;break;case"<=":if(e<=r)return!0;break}return!1}function TH(e,t){var r=kH(e),n=r.length,s=r[n-1].indexOf("@");if(n<4&&s>-1&&--n,r.length>4)throw new Error("cannot find right format for |"+r.join("|")+"|");if(typeof t!="number")return[4,r.length===4||s>-1?r[r.length-1]:"@"];switch(r.length){case 1:r=s>-1?["General","General","General",r[0]]:[r[0],r[0],r[0],"@"];break;case 2:r=s>-1?[r[0],r[0],r[0],r[1]]:[r[0],r[1],r[0],"@"];break;case 3:r=s>-1?[r[0],r[1],r[0],r[2]]:[r[0],r[1],r[2],"@"];break}var a=t>0?r[0]:t<0?r[1]:r[2];if(r[0].indexOf("[")===-1&&r[1].indexOf("[")===-1)return[n,a];if(r[0].match(/\[[=<>]/)!=null||r[1].match(/\[[=<>]/)!=null){var i=r[0].match(CE),l=r[1].match(CE);return TE(t,i)?[n,r[0]]:TE(t,l)?[n,r[1]]:[n,r[i!=null&&l!=null?2:1]]}return[n,a]}function No(e,t,r){r==null&&(r={});var n="";switch(typeof e){case"string":e=="m/d/yy"&&r.dateNF?n=r.dateNF:n=e;break;case"number":e==14&&r.dateNF?n=r.dateNF:n=(r.table!=null?r.table:Cr)[e],n==null&&(n=r.table&&r.table[bE[e]]||Cr[bE[e]]),n==null&&(n=lH[e]||"General");break}if(x1(n,0))return yf(t,r);t instanceof Date&&(t=i8(t,r.date1904));var s=TH(n,t);if(x1(s[1]))return yf(t,r);if(t===!0)t="TRUE";else if(t===!1)t="FALSE";else if(t===""||t==null)return"";return CH(s[1],t,r,s[0])}function jc(e,t){if(typeof t!="number"){t=+t||-1;for(var r=0;r<392;++r){if(Cr[r]==null){t<0&&(t=r);continue}if(Cr[r]==e){t=r;break}}t<0&&(t=391)}return Cr[t]=e,t}function sv(e){for(var t=0;t!=392;++t)e[t]!==void 0&&jc(e[t],t)}function O0(){Cr=oH()}var NH={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},m8=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function EH(e){var t=typeof e=="number"?Cr[e]:e;return t=t.replace(m8,"(\\d+)"),new RegExp("^"+t+"$")}function jH(e,t,r){var n=-1,s=-1,a=-1,i=-1,l=-1,c=-1;(t.match(m8)||[]).forEach(function(p,g){var y=parseInt(r[g+1],10);switch(p.toLowerCase().charAt(0)){case"y":n=y;break;case"d":a=y;break;case"h":i=y;break;case"s":c=y;break;case"m":i>=0?l=y:s=y;break}}),c>=0&&l==-1&&s>=0&&(l=s,s=-1);var d=(""+(n>=0?n:new Date().getFullYear())).slice(-4)+"-"+("00"+(s>=1?s:1)).slice(-2)+"-"+("00"+(a>=1?a:1)).slice(-2);d.length==7&&(d="0"+d),d.length==8&&(d="20"+d);var f=("00"+(i>=0?i:0)).slice(-2)+":"+("00"+(l>=0?l:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2);return i==-1&&l==-1&&c==-1?d:n==-1&&s==-1&&a==-1?f:d+"T"+f}var AH=(function(){var e={};e.version="1.2.0";function t(){for(var R=0,N=new Array(256),A=0;A!=256;++A)R=A,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,N[A]=R;return typeof Int32Array<"u"?new Int32Array(N):N}var r=t();function n(R){var N=0,A=0,M=0,H=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(M=0;M!=256;++M)H[M]=R[M];for(M=0;M!=256;++M)for(A=R[M],N=256+M;N<4096;N+=256)A=H[N]=A>>>8^R[A&255];var Q=[];for(M=1;M!=16;++M)Q[M-1]=typeof Int32Array<"u"?H.subarray(M*256,M*256+256):H.slice(M*256,M*256+256);return Q}var s=n(r),a=s[0],i=s[1],l=s[2],c=s[3],d=s[4],f=s[5],p=s[6],g=s[7],y=s[8],v=s[9],w=s[10],b=s[11],E=s[12],k=s[13],_=s[14];function T(R,N){for(var A=N^-1,M=0,H=R.length;M<H;)A=A>>>8^r[(A^R.charCodeAt(M++))&255];return~A}function j(R,N){for(var A=N^-1,M=R.length-15,H=0;H<M;)A=_[R[H++]^A&255]^k[R[H++]^A>>8&255]^E[R[H++]^A>>16&255]^b[R[H++]^A>>>24]^w[R[H++]]^v[R[H++]]^y[R[H++]]^g[R[H++]]^p[R[H++]]^f[R[H++]]^d[R[H++]]^c[R[H++]]^l[R[H++]]^i[R[H++]]^a[R[H++]]^r[R[H++]];for(M+=15;H<M;)A=A>>>8^r[(A^R[H++])&255];return~A}function P(R,N){for(var A=N^-1,M=0,H=R.length,Q=0,Z=0;M<H;)Q=R.charCodeAt(M++),Q<128?A=A>>>8^r[(A^Q)&255]:Q<2048?(A=A>>>8^r[(A^(192|Q>>6&31))&255],A=A>>>8^r[(A^(128|Q&63))&255]):Q>=55296&&Q<57344?(Q=(Q&1023)+64,Z=R.charCodeAt(M++)&1023,A=A>>>8^r[(A^(240|Q>>8&7))&255],A=A>>>8^r[(A^(128|Q>>2&63))&255],A=A>>>8^r[(A^(128|Z>>6&15|(Q&3)<<4))&255],A=A>>>8^r[(A^(128|Z&63))&255]):(A=A>>>8^r[(A^(224|Q>>12&15))&255],A=A>>>8^r[(A^(128|Q>>6&63))&255],A=A>>>8^r[(A^(128|Q&63))&255]);return~A}return e.table=r,e.bstr=T,e.buf=j,e.str=P,e})(),xr=(function(){var t={};t.version="1.2.1";function r(oe,we){for(var fe=oe.split("/"),me=we.split("/"),Se=0,ke=0,We=Math.min(fe.length,me.length);Se<We;++Se){if(ke=fe[Se].length-me[Se].length)return ke;if(fe[Se]!=me[Se])return fe[Se]<me[Se]?-1:1}return fe.length-me.length}function n(oe){if(oe.charAt(oe.length-1)=="/")return oe.slice(0,-1).indexOf("/")===-1?oe:n(oe.slice(0,-1));var we=oe.lastIndexOf("/");return we===-1?oe:oe.slice(0,we+1)}function s(oe){if(oe.charAt(oe.length-1)=="/")return s(oe.slice(0,-1));var we=oe.lastIndexOf("/");return we===-1?oe:oe.slice(we+1)}function a(oe,we){typeof we=="string"&&(we=new Date(we));var fe=we.getHours();fe=fe<<6|we.getMinutes(),fe=fe<<5|we.getSeconds()>>>1,oe.write_shift(2,fe);var me=we.getFullYear()-1980;me=me<<4|we.getMonth()+1,me=me<<5|we.getDate(),oe.write_shift(2,me)}function i(oe){var we=oe.read_shift(2)&65535,fe=oe.read_shift(2)&65535,me=new Date,Se=fe&31;fe>>>=5;var ke=fe&15;fe>>>=4,me.setMilliseconds(0),me.setFullYear(fe+1980),me.setMonth(ke-1),me.setDate(Se);var We=we&31;we>>>=5;var ft=we&63;return we>>>=6,me.setHours(we),me.setMinutes(ft),me.setSeconds(We<<1),me}function l(oe){Na(oe,0);for(var we={},fe=0;oe.l<=oe.length-4;){var me=oe.read_shift(2),Se=oe.read_shift(2),ke=oe.l+Se,We={};switch(me){case 21589:fe=oe.read_shift(1),fe&1&&(We.mtime=oe.read_shift(4)),Se>5&&(fe&2&&(We.atime=oe.read_shift(4)),fe&4&&(We.ctime=oe.read_shift(4))),We.mtime&&(We.mt=new Date(We.mtime*1e3));break}oe.l=ke,we[me]=We}return we}var c;function d(){return c||(c={})}function f(oe,we){if(oe[0]==80&&oe[1]==75)return he(oe,we);if((oe[0]|32)==109&&(oe[1]|32)==105)return dt(oe,we);if(oe.length<512)throw new Error("CFB file size "+oe.length+" < 512");var fe=3,me=512,Se=0,ke=0,We=0,ft=0,Re=0,ie=[],de=oe.slice(0,512);Na(de,0);var Ce=p(de);switch(fe=Ce[0],fe){case 3:me=512;break;case 4:me=4096;break;case 0:if(Ce[1]==0)return he(oe,we);default:throw new Error("Major Version: Expected 3 or 4 saw "+fe)}me!==512&&(de=oe.slice(0,me),Na(de,28));var Ne=oe.slice(0,me);g(de,fe);var Ge=de.read_shift(4,"i");if(fe===3&&Ge!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Ge);de.l+=4,We=de.read_shift(4,"i"),de.l+=4,de.chk("00100000","Mini Stream Cutoff Size: "),ft=de.read_shift(4,"i"),Se=de.read_shift(4,"i"),Re=de.read_shift(4,"i"),ke=de.read_shift(4,"i");for(var Je=-1,yt=0;yt<109&&(Je=de.read_shift(4,"i"),!(Je<0));++yt)ie[yt]=Je;var Vt=y(oe,me);b(Re,ke,Vt,me,ie);var gt=k(Vt,We,ie,me);gt[We].name="!Directory",Se>0&&ft!==Z&&(gt[ft].name="!MiniFAT"),gt[ie[0]].name="!FAT",gt.fat_addrs=ie,gt.ssz=me;var Ot={},vr=[],kr=[],Pr=[];_(We,gt,Vt,vr,Se,Ot,kr,ft),v(kr,Pr,vr),vr.shift();var hn={FileIndex:kr,FullPaths:Pr};return we&&we.raw&&(hn.raw={header:Ne,sectors:Vt}),hn}function p(oe){if(oe[oe.l]==80&&oe[oe.l+1]==75)return[0,0];oe.chk(ae,"Header Signature: "),oe.l+=16;var we=oe.read_shift(2,"u");return[oe.read_shift(2,"u"),we]}function g(oe,we){var fe=9;switch(oe.l+=2,fe=oe.read_shift(2)){case 9:if(we!=3)throw new Error("Sector Shift: Expected 9 saw "+fe);break;case 12:if(we!=4)throw new Error("Sector Shift: Expected 12 saw "+fe);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+fe)}oe.chk("0600","Mini Sector Shift: "),oe.chk("000000000000","Reserved: ")}function y(oe,we){for(var fe=Math.ceil(oe.length/we)-1,me=[],Se=1;Se<fe;++Se)me[Se-1]=oe.slice(Se*we,(Se+1)*we);return me[fe-1]=oe.slice(fe*we),me}function v(oe,we,fe){for(var me=0,Se=0,ke=0,We=0,ft=0,Re=fe.length,ie=[],de=[];me<Re;++me)ie[me]=de[me]=me,we[me]=fe[me];for(;ft<de.length;++ft)me=de[ft],Se=oe[me].L,ke=oe[me].R,We=oe[me].C,ie[me]===me&&(Se!==-1&&ie[Se]!==Se&&(ie[me]=ie[Se]),ke!==-1&&ie[ke]!==ke&&(ie[me]=ie[ke])),We!==-1&&(ie[We]=me),Se!==-1&&me!=ie[me]&&(ie[Se]=ie[me],de.lastIndexOf(Se)<ft&&de.push(Se)),ke!==-1&&me!=ie[me]&&(ie[ke]=ie[me],de.lastIndexOf(ke)<ft&&de.push(ke));for(me=1;me<Re;++me)ie[me]===me&&(ke!==-1&&ie[ke]!==ke?ie[me]=ie[ke]:Se!==-1&&ie[Se]!==Se&&(ie[me]=ie[Se]));for(me=1;me<Re;++me)if(oe[me].type!==0){if(ft=me,ft!=ie[ft])do ft=ie[ft],we[me]=we[ft]+"/"+we[me];while(ft!==0&&ie[ft]!==-1&&ft!=ie[ft]);ie[me]=-1}for(we[0]+="/",me=1;me<Re;++me)oe[me].type!==2&&(we[me]+="/")}function w(oe,we,fe){for(var me=oe.start,Se=oe.size,ke=[],We=me;fe&&Se>0&&We>=0;)ke.push(we.slice(We*Q,We*Q+Q)),Se-=Q,We=Wd(fe,We*4);return ke.length===0?wt(0):la(ke).slice(0,oe.size)}function b(oe,we,fe,me,Se){var ke=Z;if(oe===Z){if(we!==0)throw new Error("DIFAT chain shorter than expected")}else if(oe!==-1){var We=fe[oe],ft=(me>>>2)-1;if(!We)return;for(var Re=0;Re<ft&&(ke=Wd(We,Re*4))!==Z;++Re)Se.push(ke);b(Wd(We,me-4),we-1,fe,me,Se)}}function E(oe,we,fe,me,Se){var ke=[],We=[];Se||(Se=[]);var ft=me-1,Re=0,ie=0;for(Re=we;Re>=0;){Se[Re]=!0,ke[ke.length]=Re,We.push(oe[Re]);var de=fe[Math.floor(Re*4/me)];if(ie=Re*4&ft,me<4+ie)throw new Error("FAT boundary crossed: "+Re+" 4 "+me);if(!oe[de])break;Re=Wd(oe[de],ie)}return{nodes:ke,data:LE([We])}}function k(oe,we,fe,me){var Se=oe.length,ke=[],We=[],ft=[],Re=[],ie=me-1,de=0,Ce=0,Ne=0,Ge=0;for(de=0;de<Se;++de)if(ft=[],Ne=de+we,Ne>=Se&&(Ne-=Se),!We[Ne]){Re=[];var Je=[];for(Ce=Ne;Ce>=0;){Je[Ce]=!0,We[Ce]=!0,ft[ft.length]=Ce,Re.push(oe[Ce]);var yt=fe[Math.floor(Ce*4/me)];if(Ge=Ce*4&ie,me<4+Ge)throw new Error("FAT boundary crossed: "+Ce+" 4 "+me);if(!oe[yt]||(Ce=Wd(oe[yt],Ge),Je[Ce]))break}ke[Ne]={nodes:ft,data:LE([Re])}}return ke}function _(oe,we,fe,me,Se,ke,We,ft){for(var Re=0,ie=me.length?2:0,de=we[oe].data,Ce=0,Ne=0,Ge;Ce<de.length;Ce+=128){var Je=de.slice(Ce,Ce+128);Na(Je,64),Ne=Je.read_shift(2),Ge=yS(Je,0,Ne-ie),me.push(Ge);var yt={name:Ge,type:Je.read_shift(1),color:Je.read_shift(1),L:Je.read_shift(4,"i"),R:Je.read_shift(4,"i"),C:Je.read_shift(4,"i"),clsid:Je.read_shift(16),state:Je.read_shift(4,"i"),start:0,size:0},Vt=Je.read_shift(2)+Je.read_shift(2)+Je.read_shift(2)+Je.read_shift(2);Vt!==0&&(yt.ct=T(Je,Je.l-8));var gt=Je.read_shift(2)+Je.read_shift(2)+Je.read_shift(2)+Je.read_shift(2);gt!==0&&(yt.mt=T(Je,Je.l-8)),yt.start=Je.read_shift(4,"i"),yt.size=Je.read_shift(4,"i"),yt.size<0&&yt.start<0&&(yt.size=yt.type=0,yt.start=Z,yt.name=""),yt.type===5?(Re=yt.start,Se>0&&Re!==Z&&(we[Re].name="!StreamData")):yt.size>=4096?(yt.storage="fat",we[yt.start]===void 0&&(we[yt.start]=E(fe,yt.start,we.fat_addrs,we.ssz)),we[yt.start].name=yt.name,yt.content=we[yt.start].data.slice(0,yt.size)):(yt.storage="minifat",yt.size<0?yt.size=0:Re!==Z&&yt.start!==Z&&we[Re]&&(yt.content=w(yt,we[Re].data,(we[ft]||{}).data))),yt.content&&Na(yt.content,0),ke[Ge]=yt,We.push(yt)}}function T(oe,we){return new Date((Vi(oe,we+4)/1e7*Math.pow(2,32)+Vi(oe,we)/1e7-11644473600)*1e3)}function j(oe,we){return d(),f(c.readFileSync(oe),we)}function P(oe,we){var fe=we&&we.type;switch(fe||Gr&&Buffer.isBuffer(oe)&&(fe="buffer"),fe||"base64"){case"file":return j(oe,we);case"base64":return f(Ki(Yi(oe)),we);case"binary":return f(Ki(oe),we)}return f(oe,we)}function R(oe,we){var fe=we||{},me=fe.root||"Root Entry";if(oe.FullPaths||(oe.FullPaths=[]),oe.FileIndex||(oe.FileIndex=[]),oe.FullPaths.length!==oe.FileIndex.length)throw new Error("inconsistent CFB structure");oe.FullPaths.length===0&&(oe.FullPaths[0]=me+"/",oe.FileIndex[0]={name:me,type:5}),fe.CLSID&&(oe.FileIndex[0].clsid=fe.CLSID),N(oe)}function N(oe){var we="Sh33tJ5";if(!xr.find(oe,"/"+we)){var fe=wt(4);fe[0]=55,fe[1]=fe[3]=50,fe[2]=54,oe.FileIndex.push({name:we,type:2,content:fe,size:4,L:69,R:69,C:69}),oe.FullPaths.push(oe.FullPaths[0]+we),A(oe)}}function A(oe,we){R(oe);for(var fe=!1,me=!1,Se=oe.FullPaths.length-1;Se>=0;--Se){var ke=oe.FileIndex[Se];switch(ke.type){case 0:me?fe=!0:(oe.FileIndex.pop(),oe.FullPaths.pop());break;case 1:case 2:case 5:me=!0,isNaN(ke.R*ke.L*ke.C)&&(fe=!0),ke.R>-1&&ke.L>-1&&ke.R==ke.L&&(fe=!0);break;default:fe=!0;break}}if(!(!fe&&!we)){var We=new Date(1987,1,19),ft=0,Re=Object.create?Object.create(null):{},ie=[];for(Se=0;Se<oe.FullPaths.length;++Se)Re[oe.FullPaths[Se]]=!0,oe.FileIndex[Se].type!==0&&ie.push([oe.FullPaths[Se],oe.FileIndex[Se]]);for(Se=0;Se<ie.length;++Se){var de=n(ie[Se][0]);me=Re[de],me||(ie.push([de,{name:s(de).replace("/",""),type:1,clsid:se,ct:We,mt:We,content:null}]),Re[de]=!0)}for(ie.sort(function(Ge,Je){return r(Ge[0],Je[0])}),oe.FullPaths=[],oe.FileIndex=[],Se=0;Se<ie.length;++Se)oe.FullPaths[Se]=ie[Se][0],oe.FileIndex[Se]=ie[Se][1];for(Se=0;Se<ie.length;++Se){var Ce=oe.FileIndex[Se],Ne=oe.FullPaths[Se];if(Ce.name=s(Ne).replace("/",""),Ce.L=Ce.R=Ce.C=-(Ce.color=1),Ce.size=Ce.content?Ce.content.length:0,Ce.start=0,Ce.clsid=Ce.clsid||se,Se===0)Ce.C=ie.length>1?1:-1,Ce.size=0,Ce.type=5;else if(Ne.slice(-1)=="/"){for(ft=Se+1;ft<ie.length&&n(oe.FullPaths[ft])!=Ne;++ft);for(Ce.C=ft>=ie.length?-1:ft,ft=Se+1;ft<ie.length&&n(oe.FullPaths[ft])!=n(Ne);++ft);Ce.R=ft>=ie.length?-1:ft,Ce.type=1}else n(oe.FullPaths[Se+1]||"")==n(Ne)&&(Ce.R=Se+1),Ce.type=2}}}function M(oe,we){var fe=we||{};if(fe.fileType=="mad")return zt(oe,fe);switch(A(oe),fe.fileType){case"zip":return pe(oe,fe)}var me=(function(Ge){for(var Je=0,yt=0,Vt=0;Vt<Ge.FileIndex.length;++Vt){var gt=Ge.FileIndex[Vt];if(gt.content){var Ot=gt.content.length;Ot>0&&(Ot<4096?Je+=Ot+63>>6:yt+=Ot+511>>9)}}for(var vr=Ge.FullPaths.length+3>>2,kr=Je+7>>3,Pr=Je+127>>7,hn=kr+yt+vr+Pr,Kr=hn+127>>7,$r=Kr<=109?0:Math.ceil((Kr-109)/127);hn+Kr+$r+127>>7>Kr;)$r=++Kr<=109?0:Math.ceil((Kr-109)/127);var or=[1,$r,Kr,Pr,vr,yt,Je,0];return Ge.FileIndex[0].size=Je<<6,or[7]=(Ge.FileIndex[0].start=or[0]+or[1]+or[2]+or[3]+or[4]+or[5])+(or[6]+7>>3),or})(oe),Se=wt(me[7]<<9),ke=0,We=0;{for(ke=0;ke<8;++ke)Se.write_shift(1,te[ke]);for(ke=0;ke<8;++ke)Se.write_shift(2,0);for(Se.write_shift(2,62),Se.write_shift(2,3),Se.write_shift(2,65534),Se.write_shift(2,9),Se.write_shift(2,6),ke=0;ke<3;++ke)Se.write_shift(2,0);for(Se.write_shift(4,0),Se.write_shift(4,me[2]),Se.write_shift(4,me[0]+me[1]+me[2]+me[3]-1),Se.write_shift(4,0),Se.write_shift(4,4096),Se.write_shift(4,me[3]?me[0]+me[1]+me[2]-1:Z),Se.write_shift(4,me[3]),Se.write_shift(-4,me[1]?me[0]-1:Z),Se.write_shift(4,me[1]),ke=0;ke<109;++ke)Se.write_shift(-4,ke<me[2]?me[1]+ke:-1)}if(me[1])for(We=0;We<me[1];++We){for(;ke<236+We*127;++ke)Se.write_shift(-4,ke<me[2]?me[1]+ke:-1);Se.write_shift(-4,We===me[1]-1?Z:We+1)}var ft=function(Ge){for(We+=Ge;ke<We-1;++ke)Se.write_shift(-4,ke+1);Ge&&(++ke,Se.write_shift(-4,Z))};for(We=ke=0,We+=me[1];ke<We;++ke)Se.write_shift(-4,L.DIFSECT);for(We+=me[2];ke<We;++ke)Se.write_shift(-4,L.FATSECT);ft(me[3]),ft(me[4]);for(var Re=0,ie=0,de=oe.FileIndex[0];Re<oe.FileIndex.length;++Re)de=oe.FileIndex[Re],de.content&&(ie=de.content.length,!(ie<4096)&&(de.start=We,ft(ie+511>>9)));for(ft(me[6]+7>>3);Se.l&511;)Se.write_shift(-4,L.ENDOFCHAIN);for(We=ke=0,Re=0;Re<oe.FileIndex.length;++Re)de=oe.FileIndex[Re],de.content&&(ie=de.content.length,!(!ie||ie>=4096)&&(de.start=We,ft(ie+63>>6)));for(;Se.l&511;)Se.write_shift(-4,L.ENDOFCHAIN);for(ke=0;ke<me[4]<<2;++ke){var Ce=oe.FullPaths[ke];if(!Ce||Ce.length===0){for(Re=0;Re<17;++Re)Se.write_shift(4,0);for(Re=0;Re<3;++Re)Se.write_shift(4,-1);for(Re=0;Re<12;++Re)Se.write_shift(4,0);continue}de=oe.FileIndex[ke],ke===0&&(de.start=de.size?de.start-1:Z);var Ne=ke===0&&fe.root||de.name;if(ie=2*(Ne.length+1),Se.write_shift(64,Ne,"utf16le"),Se.write_shift(2,ie),Se.write_shift(1,de.type),Se.write_shift(1,de.color),Se.write_shift(-4,de.L),Se.write_shift(-4,de.R),Se.write_shift(-4,de.C),de.clsid)Se.write_shift(16,de.clsid,"hex");else for(Re=0;Re<4;++Re)Se.write_shift(4,0);Se.write_shift(4,de.state||0),Se.write_shift(4,0),Se.write_shift(4,0),Se.write_shift(4,0),Se.write_shift(4,0),Se.write_shift(4,de.start),Se.write_shift(4,de.size),Se.write_shift(4,0)}for(ke=1;ke<oe.FileIndex.length;++ke)if(de=oe.FileIndex[ke],de.size>=4096)if(Se.l=de.start+1<<9,Gr&&Buffer.isBuffer(de.content))de.content.copy(Se,Se.l,0,de.size),Se.l+=de.size+511&-512;else{for(Re=0;Re<de.size;++Re)Se.write_shift(1,de.content[Re]);for(;Re&511;++Re)Se.write_shift(1,0)}for(ke=1;ke<oe.FileIndex.length;++ke)if(de=oe.FileIndex[ke],de.size>0&&de.size<4096)if(Gr&&Buffer.isBuffer(de.content))de.content.copy(Se,Se.l,0,de.size),Se.l+=de.size+63&-64;else{for(Re=0;Re<de.size;++Re)Se.write_shift(1,de.content[Re]);for(;Re&63;++Re)Se.write_shift(1,0)}if(Gr)Se.l=Se.length;else for(;Se.l<Se.length;)Se.write_shift(1,0);return Se}function H(oe,we){var fe=oe.FullPaths.map(function(Re){return Re.toUpperCase()}),me=fe.map(function(Re){var ie=Re.split("/");return ie[ie.length-(Re.slice(-1)=="/"?2:1)]}),Se=!1;we.charCodeAt(0)===47?(Se=!0,we=fe[0].slice(0,-1)+we):Se=we.indexOf("/")!==-1;var ke=we.toUpperCase(),We=Se===!0?fe.indexOf(ke):me.indexOf(ke);if(We!==-1)return oe.FileIndex[We];var ft=!ke.match(Am);for(ke=ke.replace(pi,""),ft&&(ke=ke.replace(Am,"!")),We=0;We<fe.length;++We)if((ft?fe[We].replace(Am,"!"):fe[We]).replace(pi,"")==ke||(ft?me[We].replace(Am,"!"):me[We]).replace(pi,"")==ke)return oe.FileIndex[We];return null}var Q=64,Z=-2,ae="d0cf11e0a1b11ae1",te=[208,207,17,224,161,177,26,225],se="00000000000000000000000000000000",L={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Z,FREESECT:-1,HEADER_SIGNATURE:ae,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:se,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function G(oe,we,fe){d();var me=M(oe,fe);c.writeFileSync(we,me)}function I(oe){for(var we=new Array(oe.length),fe=0;fe<oe.length;++fe)we[fe]=String.fromCharCode(oe[fe]);return we.join("")}function z(oe,we){var fe=M(oe,we);switch(we&&we.type||"buffer"){case"file":return d(),c.writeFileSync(we.filename,fe),fe;case"binary":return typeof fe=="string"?fe:I(fe);case"base64":return mp(typeof fe=="string"?fe:I(fe));case"buffer":if(Gr)return Buffer.isBuffer(fe)?fe:Bc(fe);case"array":return typeof fe=="string"?Ki(fe):fe}return fe}var V;function O(oe){try{var we=oe.InflateRaw,fe=new we;if(fe._processChunk(new Uint8Array([3,0]),fe._finishFlushFlag),fe.bytesRead)V=oe;else throw new Error("zlib does not expose bytesRead")}catch(me){console.error("cannot use native zlib: "+(me.message||me))}}function W(oe,we){if(!V)return sr(oe,we);var fe=V.InflateRaw,me=new fe,Se=me._processChunk(oe.slice(oe.l),me._finishFlushFlag);return oe.l+=me.bytesRead,Se}function q(oe){return V?V.deflateRawSync(oe):mt(oe)}var Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ee=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],X=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function ne(oe){var we=(oe<<1|oe<<11)&139536|(oe<<5|oe<<15)&558144;return(we>>16|we>>8|we)&255}for(var ge=typeof Uint8Array<"u",_e=ge?new Uint8Array(256):[],Pe=0;Pe<256;++Pe)_e[Pe]=ne(Pe);function ce(oe,we){var fe=_e[oe&255];return we<=8?fe>>>8-we:(fe=fe<<8|_e[oe>>8&255],we<=16?fe>>>16-we:(fe=fe<<8|_e[oe>>16&255],fe>>>24-we))}function ye(oe,we){var fe=we&7,me=we>>>3;return(oe[me]|(fe<=6?0:oe[me+1]<<8))>>>fe&3}function Fe(oe,we){var fe=we&7,me=we>>>3;return(oe[me]|(fe<=5?0:oe[me+1]<<8))>>>fe&7}function Me(oe,we){var fe=we&7,me=we>>>3;return(oe[me]|(fe<=4?0:oe[me+1]<<8))>>>fe&15}function Oe(oe,we){var fe=we&7,me=we>>>3;return(oe[me]|(fe<=3?0:oe[me+1]<<8))>>>fe&31}function He(oe,we){var fe=we&7,me=we>>>3;return(oe[me]|(fe<=1?0:oe[me+1]<<8))>>>fe&127}function It(oe,we,fe){var me=we&7,Se=we>>>3,ke=(1<<fe)-1,We=oe[Se]>>>me;return fe<8-me||(We|=oe[Se+1]<<8-me,fe<16-me)||(We|=oe[Se+2]<<16-me,fe<24-me)||(We|=oe[Se+3]<<24-me),We&ke}function Ze(oe,we,fe){var me=we&7,Se=we>>>3;return me<=5?oe[Se]|=(fe&7)<<me:(oe[Se]|=fe<<me&255,oe[Se+1]=(fe&7)>>8-me),we+3}function Le(oe,we,fe){var me=we&7,Se=we>>>3;return fe=(fe&1)<<me,oe[Se]|=fe,we+1}function De(oe,we,fe){var me=we&7,Se=we>>>3;return fe<<=me,oe[Se]|=fe&255,fe>>>=8,oe[Se+1]=fe,we+8}function et(oe,we,fe){var me=we&7,Se=we>>>3;return fe<<=me,oe[Se]|=fe&255,fe>>>=8,oe[Se+1]=fe&255,oe[Se+2]=fe>>>8,we+16}function bt(oe,we){var fe=oe.length,me=2*fe>we?2*fe:we+5,Se=0;if(fe>=we)return oe;if(Gr){var ke=vE(me);if(oe.copy)oe.copy(ke);else for(;Se<oe.length;++Se)ke[Se]=oe[Se];return ke}else if(ge){var We=new Uint8Array(me);if(We.set)We.set(oe);else for(;Se<fe;++Se)We[Se]=oe[Se];return We}return oe.length=me,oe}function ut(oe){for(var we=new Array(oe),fe=0;fe<oe;++fe)we[fe]=0;return we}function jt(oe,we,fe){var me=1,Se=0,ke=0,We=0,ft=0,Re=oe.length,ie=ge?new Uint16Array(32):ut(32);for(ke=0;ke<32;++ke)ie[ke]=0;for(ke=Re;ke<fe;++ke)oe[ke]=0;Re=oe.length;var de=ge?new Uint16Array(Re):ut(Re);for(ke=0;ke<Re;++ke)ie[Se=oe[ke]]++,me<Se&&(me=Se),de[ke]=0;for(ie[0]=0,ke=1;ke<=me;++ke)ie[ke+16]=ft=ft+ie[ke-1]<<1;for(ke=0;ke<Re;++ke)ft=oe[ke],ft!=0&&(de[ke]=ie[ft+16]++);var Ce=0;for(ke=0;ke<Re;++ke)if(Ce=oe[ke],Ce!=0)for(ft=ce(de[ke],me)>>me-Ce,We=(1<<me+4-Ce)-1;We>=0;--We)we[ft|We<<Ce]=Ce&15|ke<<4;return me}var Rt=ge?new Uint16Array(512):ut(512),Xe=ge?new Uint16Array(32):ut(32);if(!ge){for(var Ye=0;Ye<512;++Ye)Rt[Ye]=0;for(Ye=0;Ye<32;++Ye)Xe[Ye]=0}(function(){for(var oe=[],we=0;we<32;we++)oe.push(5);jt(oe,Xe,32);var fe=[];for(we=0;we<=143;we++)fe.push(8);for(;we<=255;we++)fe.push(9);for(;we<=279;we++)fe.push(7);for(;we<=287;we++)fe.push(8);jt(fe,Rt,288)})();var pt=(function(){for(var we=ge?new Uint8Array(32768):[],fe=0,me=0;fe<X.length-1;++fe)for(;me<X[fe+1];++me)we[me]=fe;for(;me<32768;++me)we[me]=29;var Se=ge?new Uint8Array(259):[];for(fe=0,me=0;fe<ee.length-1;++fe)for(;me<ee[fe+1];++me)Se[me]=fe;function ke(ft,Re){for(var ie=0;ie<ft.length;){var de=Math.min(65535,ft.length-ie),Ce=ie+de==ft.length;for(Re.write_shift(1,+Ce),Re.write_shift(2,de),Re.write_shift(2,~de&65535);de-- >0;)Re[Re.l++]=ft[ie++]}return Re.l}function We(ft,Re){for(var ie=0,de=0,Ce=ge?new Uint16Array(32768):[];de<ft.length;){var Ne=Math.min(65535,ft.length-de);if(Ne<10){for(ie=Ze(Re,ie,+(de+Ne==ft.length)),ie&7&&(ie+=8-(ie&7)),Re.l=ie/8|0,Re.write_shift(2,Ne),Re.write_shift(2,~Ne&65535);Ne-- >0;)Re[Re.l++]=ft[de++];ie=Re.l*8;continue}ie=Ze(Re,ie,+(de+Ne==ft.length)+2);for(var Ge=0;Ne-- >0;){var Je=ft[de];Ge=(Ge<<5^Je)&32767;var yt=-1,Vt=0;if((yt=Ce[Ge])&&(yt|=de&-32768,yt>de&&(yt-=32768),yt<de))for(;ft[yt+Vt]==ft[de+Vt]&&Vt<250;)++Vt;if(Vt>2){Je=Se[Vt],Je<=22?ie=De(Re,ie,_e[Je+1]>>1)-1:(De(Re,ie,3),ie+=5,De(Re,ie,_e[Je-23]>>5),ie+=3);var gt=Je<8?0:Je-4>>2;gt>0&&(et(Re,ie,Vt-ee[Je]),ie+=gt),Je=we[de-yt],ie=De(Re,ie,_e[Je]>>3),ie-=3;var Ot=Je<4?0:Je-2>>1;Ot>0&&(et(Re,ie,de-yt-X[Je]),ie+=Ot);for(var vr=0;vr<Vt;++vr)Ce[Ge]=de&32767,Ge=(Ge<<5^ft[de])&32767,++de;Ne-=Vt-1}else Je<=143?Je=Je+48:ie=Le(Re,ie,1),ie=De(Re,ie,_e[Je]),Ce[Ge]=de&32767,++de}ie=De(Re,ie,0)-1}return Re.l=(ie+7)/8|0,Re.l}return function(Re,ie){return Re.length<8?ke(Re,ie):We(Re,ie)}})();function mt(oe){var we=wt(50+Math.floor(oe.length*1.1)),fe=pt(oe,we);return we.slice(0,fe)}var _t=ge?new Uint16Array(32768):ut(32768),Ht=ge?new Uint16Array(32768):ut(32768),Qt=ge?new Uint16Array(128):ut(128),nr=1,Nr=1;function fr(oe,we){var fe=Oe(oe,we)+257;we+=5;var me=Oe(oe,we)+1;we+=5;var Se=Me(oe,we)+4;we+=4;for(var ke=0,We=ge?new Uint8Array(19):ut(19),ft=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Re=1,ie=ge?new Uint8Array(8):ut(8),de=ge?new Uint8Array(8):ut(8),Ce=We.length,Ne=0;Ne<Se;++Ne)We[Y[Ne]]=ke=Fe(oe,we),Re<ke&&(Re=ke),ie[ke]++,we+=3;var Ge=0;for(ie[0]=0,Ne=1;Ne<=Re;++Ne)de[Ne]=Ge=Ge+ie[Ne-1]<<1;for(Ne=0;Ne<Ce;++Ne)(Ge=We[Ne])!=0&&(ft[Ne]=de[Ge]++);var Je=0;for(Ne=0;Ne<Ce;++Ne)if(Je=We[Ne],Je!=0){Ge=_e[ft[Ne]]>>8-Je;for(var yt=(1<<7-Je)-1;yt>=0;--yt)Qt[Ge|yt<<Je]=Je&7|Ne<<3}var Vt=[];for(Re=1;Vt.length<fe+me;)switch(Ge=Qt[He(oe,we)],we+=Ge&7,Ge>>>=3){case 16:for(ke=3+ye(oe,we),we+=2,Ge=Vt[Vt.length-1];ke-- >0;)Vt.push(Ge);break;case 17:for(ke=3+Fe(oe,we),we+=3;ke-- >0;)Vt.push(0);break;case 18:for(ke=11+He(oe,we),we+=7;ke-- >0;)Vt.push(0);break;default:Vt.push(Ge),Re<Ge&&(Re=Ge);break}var gt=Vt.slice(0,fe),Ot=Vt.slice(fe);for(Ne=fe;Ne<286;++Ne)gt[Ne]=0;for(Ne=me;Ne<30;++Ne)Ot[Ne]=0;return nr=jt(gt,_t,286),Nr=jt(Ot,Ht,30),we}function hr(oe,we){if(oe[0]==3&&!(oe[1]&3))return[Ku(we),2];for(var fe=0,me=0,Se=vE(we||1<<18),ke=0,We=Se.length>>>0,ft=0,Re=0;(me&1)==0;){if(me=Fe(oe,fe),fe+=3,me>>>1)me>>1==1?(ft=9,Re=5):(fe=fr(oe,fe),ft=nr,Re=Nr);else{fe&7&&(fe+=8-(fe&7));var ie=oe[fe>>>3]|oe[(fe>>>3)+1]<<8;if(fe+=32,ie>0)for(!we&&We<ke+ie&&(Se=bt(Se,ke+ie),We=Se.length);ie-- >0;)Se[ke++]=oe[fe>>>3],fe+=8;continue}for(;;){!we&&We<ke+32767&&(Se=bt(Se,ke+32767),We=Se.length);var de=It(oe,fe,ft),Ce=me>>>1==1?Rt[de]:_t[de];if(fe+=Ce&15,Ce>>>=4,(Ce>>>8&255)===0)Se[ke++]=Ce;else{if(Ce==256)break;Ce-=257;var Ne=Ce<8?0:Ce-4>>2;Ne>5&&(Ne=0);var Ge=ke+ee[Ce];Ne>0&&(Ge+=It(oe,fe,Ne),fe+=Ne),de=It(oe,fe,Re),Ce=me>>>1==1?Xe[de]:Ht[de],fe+=Ce&15,Ce>>>=4;var Je=Ce<4?0:Ce-2>>1,yt=X[Ce];for(Je>0&&(yt+=It(oe,fe,Je),fe+=Je),!we&&We<Ge&&(Se=bt(Se,Ge+100),We=Se.length);ke<Ge;)Se[ke]=Se[ke-yt],++ke}}}return we?[Se,fe+7>>>3]:[Se.slice(0,ke),fe+7>>>3]}function sr(oe,we){var fe=oe.slice(oe.l||0),me=hr(fe,we);return oe.l+=me[1],me[0]}function Er(oe,we){if(oe)typeof console<"u"&&console.error(we);else throw new Error(we)}function he(oe,we){var fe=oe;Na(fe,0);var me=[],Se=[],ke={FileIndex:me,FullPaths:Se};R(ke,{root:we.root});for(var We=fe.length-4;(fe[We]!=80||fe[We+1]!=75||fe[We+2]!=5||fe[We+3]!=6)&&We>=0;)--We;fe.l=We+4,fe.l+=4;var ft=fe.read_shift(2);fe.l+=6;var Re=fe.read_shift(4);for(fe.l=Re,We=0;We<ft;++We){fe.l+=20;var ie=fe.read_shift(4),de=fe.read_shift(4),Ce=fe.read_shift(2),Ne=fe.read_shift(2),Ge=fe.read_shift(2);fe.l+=8;var Je=fe.read_shift(4),yt=l(fe.slice(fe.l+Ce,fe.l+Ce+Ne));fe.l+=Ce+Ne+Ge;var Vt=fe.l;fe.l=Je+4,le(fe,ie,de,ke,yt),fe.l=Vt}return ke}function le(oe,we,fe,me,Se){oe.l+=2;var ke=oe.read_shift(2),We=oe.read_shift(2),ft=i(oe);if(ke&8257)throw new Error("Unsupported ZIP encryption");for(var Re=oe.read_shift(4),ie=oe.read_shift(4),de=oe.read_shift(4),Ce=oe.read_shift(2),Ne=oe.read_shift(2),Ge="",Je=0;Je<Ce;++Je)Ge+=String.fromCharCode(oe[oe.l++]);if(Ne){var yt=l(oe.slice(oe.l,oe.l+Ne));(yt[21589]||{}).mt&&(ft=yt[21589].mt),((Se||{})[21589]||{}).mt&&(ft=Se[21589].mt)}oe.l+=Ne;var Vt=oe.slice(oe.l,oe.l+ie);switch(We){case 8:Vt=W(oe,de);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+We)}var gt=!1;ke&8&&(Re=oe.read_shift(4),Re==134695760&&(Re=oe.read_shift(4),gt=!0),ie=oe.read_shift(4),de=oe.read_shift(4)),ie!=we&&Er(gt,"Bad compressed size: "+we+" != "+ie),de!=fe&&Er(gt,"Bad uncompressed size: "+fe+" != "+de),wr(me,Ge,Vt,{unsafe:!0,mt:ft})}function pe(oe,we){var fe=we||{},me=[],Se=[],ke=wt(1),We=fe.compression?8:0,ft=0,Re=0,ie=0,de=0,Ce=0,Ne=oe.FullPaths[0],Ge=Ne,Je=oe.FileIndex[0],yt=[],Vt=0;for(Re=1;Re<oe.FullPaths.length;++Re)if(Ge=oe.FullPaths[Re].slice(Ne.length),Je=oe.FileIndex[Re],!(!Je.size||!Je.content||Ge=="Sh33tJ5")){var gt=de,Ot=wt(Ge.length);for(ie=0;ie<Ge.length;++ie)Ot.write_shift(1,Ge.charCodeAt(ie)&127);Ot=Ot.slice(0,Ot.l),yt[Ce]=AH.buf(Je.content,0);var vr=Je.content;We==8&&(vr=q(vr)),ke=wt(30),ke.write_shift(4,67324752),ke.write_shift(2,20),ke.write_shift(2,ft),ke.write_shift(2,We),Je.mt?a(ke,Je.mt):ke.write_shift(4,0),ke.write_shift(-4,yt[Ce]),ke.write_shift(4,vr.length),ke.write_shift(4,Je.content.length),ke.write_shift(2,Ot.length),ke.write_shift(2,0),de+=ke.length,me.push(ke),de+=Ot.length,me.push(Ot),de+=vr.length,me.push(vr),ke=wt(46),ke.write_shift(4,33639248),ke.write_shift(2,0),ke.write_shift(2,20),ke.write_shift(2,ft),ke.write_shift(2,We),ke.write_shift(4,0),ke.write_shift(-4,yt[Ce]),ke.write_shift(4,vr.length),ke.write_shift(4,Je.content.length),ke.write_shift(2,Ot.length),ke.write_shift(2,0),ke.write_shift(2,0),ke.write_shift(2,0),ke.write_shift(2,0),ke.write_shift(4,0),ke.write_shift(4,gt),Vt+=ke.l,Se.push(ke),Vt+=Ot.length,Se.push(Ot),++Ce}return ke=wt(22),ke.write_shift(4,101010256),ke.write_shift(2,0),ke.write_shift(2,0),ke.write_shift(2,Ce),ke.write_shift(2,Ce),ke.write_shift(4,Vt),ke.write_shift(4,de),ke.write_shift(2,0),la([la(me),la(Se),ke])}var be={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Ve(oe,we){if(oe.ctype)return oe.ctype;var fe=oe.name||"",me=fe.match(/\.([^\.]+)$/);return me&&be[me[1]]||we&&(me=(fe=we).match(/[\.\\]([^\.\\])+$/),me&&be[me[1]])?be[me[1]]:"application/octet-stream"}function Ct(oe){for(var we=mp(oe),fe=[],me=0;me<we.length;me+=76)fe.push(we.slice(me,me+76));return fe.join(`\r
`)+`\r
`}function Et(oe){var we=oe.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(ie){var de=ie.charCodeAt(0).toString(16).toUpperCase();return"="+(de.length==1?"0"+de:de)});we=we.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),we.charAt(0)==`
`&&(we="=0D"+we.slice(1)),we=we.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var fe=[],me=we.split(`\r
`),Se=0;Se<me.length;++Se){var ke=me[Se];if(ke.length==0){fe.push("");continue}for(var We=0;We<ke.length;){var ft=76,Re=ke.slice(We,We+ft);Re.charAt(ft-1)=="="?ft--:Re.charAt(ft-2)=="="?ft-=2:Re.charAt(ft-3)=="="&&(ft-=3),Re=ke.slice(We,We+ft),We+=ft,We<ke.length&&(Re+="="),fe.push(Re)}}return fe.join(`\r
`)}function Be(oe){for(var we=[],fe=0;fe<oe.length;++fe){for(var me=oe[fe];fe<=oe.length&&me.charAt(me.length-1)=="=";)me=me.slice(0,me.length-1)+oe[++fe];we.push(me)}for(var Se=0;Se<we.length;++Se)we[Se]=we[Se].replace(/[=][0-9A-Fa-f]{2}/g,function(ke){return String.fromCharCode(parseInt(ke.slice(1),16))});return Ki(we.join(`\r
`))}function at(oe,we,fe){for(var me="",Se="",ke="",We,ft=0;ft<10;++ft){var Re=we[ft];if(!Re||Re.match(/^\s*$/))break;var ie=Re.match(/^(.*?):\s*([^\s].*)$/);if(ie)switch(ie[1].toLowerCase()){case"content-location":me=ie[2].trim();break;case"content-type":ke=ie[2].trim();break;case"content-transfer-encoding":Se=ie[2].trim();break}}switch(++ft,Se.toLowerCase()){case"base64":We=Ki(Yi(we.slice(ft).join("")));break;case"quoted-printable":We=Be(we.slice(ft));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+Se)}var de=wr(oe,me.slice(fe.length),We,{unsafe:!0});ke&&(de.ctype=ke)}function dt(oe,we){if(I(oe.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var fe=we&&we.root||"",me=(Gr&&Buffer.isBuffer(oe)?oe.toString("binary"):I(oe)).split(`\r
`),Se=0,ke="";for(Se=0;Se<me.length;++Se)if(ke=me[Se],!!/^Content-Location:/i.test(ke)&&(ke=ke.slice(ke.indexOf("file")),fe||(fe=ke.slice(0,ke.lastIndexOf("/")+1)),ke.slice(0,fe.length)!=fe))for(;fe.length>0&&(fe=fe.slice(0,fe.length-1),fe=fe.slice(0,fe.lastIndexOf("/")+1),ke.slice(0,fe.length)!=fe););var We=(me[1]||"").match(/boundary="(.*?)"/);if(!We)throw new Error("MAD cannot find boundary");var ft="--"+(We[1]||""),Re=[],ie=[],de={FileIndex:Re,FullPaths:ie};R(de);var Ce,Ne=0;for(Se=0;Se<me.length;++Se){var Ge=me[Se];Ge!==ft&&Ge!==ft+"--"||(Ne++&&at(de,me.slice(Ce,Se),fe),Ce=Se)}return de}function zt(oe,we){var fe=we||{},me=fe.boundary||"SheetJS";me="------="+me;for(var Se=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+me.slice(2)+'"',"","",""],ke=oe.FullPaths[0],We=ke,ft=oe.FileIndex[0],Re=1;Re<oe.FullPaths.length;++Re)if(We=oe.FullPaths[Re].slice(ke.length),ft=oe.FileIndex[Re],!(!ft.size||!ft.content||We=="Sh33tJ5")){We=We.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Vt){return"_x"+Vt.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Vt){return"_u"+Vt.charCodeAt(0).toString(16)+"_"});for(var ie=ft.content,de=Gr&&Buffer.isBuffer(ie)?ie.toString("binary"):I(ie),Ce=0,Ne=Math.min(1024,de.length),Ge=0,Je=0;Je<=Ne;++Je)(Ge=de.charCodeAt(Je))>=32&&Ge<128&&++Ce;var yt=Ce>=Ne*4/5;Se.push(me),Se.push("Content-Location: "+(fe.root||"file:///C:/SheetJS/")+We),Se.push("Content-Transfer-Encoding: "+(yt?"quoted-printable":"base64")),Se.push("Content-Type: "+Ve(ft,We)),Se.push(""),Se.push(yt?Et(de):Ct(de))}return Se.push(me+`--\r
`),Se.join(`\r
`)}function Yt(oe){var we={};return R(we,oe),we}function wr(oe,we,fe,me){var Se=me&&me.unsafe;Se||R(oe);var ke=!Se&&xr.find(oe,we);if(!ke){var We=oe.FullPaths[0];we.slice(0,We.length)==We?We=we:(We.slice(-1)!="/"&&(We+="/"),We=(We+we).replace("//","/")),ke={name:s(we),type:2},oe.FileIndex.push(ke),oe.FullPaths.push(We),Se||xr.utils.cfb_gc(oe)}return ke.content=fe,ke.size=fe?fe.length:0,me&&(me.CLSID&&(ke.clsid=me.CLSID),me.mt&&(ke.mt=me.mt),me.ct&&(ke.ct=me.ct)),ke}function Ur(oe,we){R(oe);var fe=xr.find(oe,we);if(fe){for(var me=0;me<oe.FileIndex.length;++me)if(oe.FileIndex[me]==fe)return oe.FileIndex.splice(me,1),oe.FullPaths.splice(me,1),!0}return!1}function yr(oe,we,fe){R(oe);var me=xr.find(oe,we);if(me){for(var Se=0;Se<oe.FileIndex.length;++Se)if(oe.FileIndex[Se]==me)return oe.FileIndex[Se].name=s(fe),oe.FullPaths[Se]=fe,!0}return!1}function ur(oe){A(oe,!0)}return t.find=H,t.read=P,t.parse=f,t.write=z,t.writeFile=G,t.utils={cfb_new:Yt,cfb_add:wr,cfb_del:Ur,cfb_mov:yr,cfb_gc:ur,ReadShift:Wm,CheckField:O8,prep_blob:Na,bconcat:la,use_zlib:O,_deflateRaw:mt,_inflateRaw:sr,consts:L},t})();function FH(e){return typeof e=="string"?nv(e):Array.isArray(e)?nH(e):e}function Yp(e,t,r){if(typeof Deno<"u"){if(r&&typeof t=="string")switch(r){case"utf8":t=new TextEncoder(r).encode(t);break;case"binary":t=nv(t);break;default:throw new Error("Unsupported encoding "+r)}return Deno.writeFileSync(e,t)}var n=r=="utf8"?Il(t):t;if(typeof IE_SaveFile<"u")return IE_SaveFile(n,e);if(typeof Blob<"u"){var s=new Blob([FH(n)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(s,e);if(typeof saveAs<"u")return saveAs(s,e);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var a=URL.createObjectURL(s);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),chrome.downloads.download({url:a,filename:e,saveAs:!0});var i=document.createElement("a");if(i.download!=null)return i.download=e,i.href=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),a}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var l=File(e);return l.open("w"),l.encoding="binary",Array.isArray(t)&&(t=sd(t)),l.write(t),l.close(),t}catch(c){if(!c.message||!c.message.match(/onstruct/))throw c}throw new Error("cannot save file "+e)}function PH(e){if(typeof Deno<"u")return Deno.readFileSync(e);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var t=File(e);t.open("r"),t.encoding="binary";var r=t.read();return t.close(),r}catch(n){if(!n.message||!n.message.match(/onstruct/))throw n}throw new Error("Cannot access file "+e)}function ms(e){for(var t=Object.keys(e),r=[],n=0;n<t.length;++n)Object.prototype.hasOwnProperty.call(e,t[n])&&r.push(t[n]);return r}function NE(e,t){for(var r=[],n=ms(e),s=0;s!==n.length;++s)r[e[n[s]][t]]==null&&(r[e[n[s]][t]]=n[s]);return r}function av(e){for(var t=[],r=ms(e),n=0;n!==r.length;++n)t[e[r[n]]]=r[n];return t}function iv(e){for(var t=[],r=ms(e),n=0;n!==r.length;++n)t[e[r[n]]]=parseInt(r[n],10);return t}function RH(e){for(var t=[],r=ms(e),n=0;n!==r.length;++n)t[e[r[n]]]==null&&(t[e[r[n]]]=[]),t[e[r[n]]].push(r[n]);return t}var v1=new Date(1899,11,30,0,0,0);function Ys(e,t){var r=e.getTime(),n=v1.getTime()+(e.getTimezoneOffset()-v1.getTimezoneOffset())*6e4;return(r-n)/(1440*60*1e3)}var p8=new Date,DH=v1.getTime()+(p8.getTimezoneOffset()-v1.getTimezoneOffset())*6e4,EE=p8.getTimezoneOffset();function ov(e){var t=new Date;return t.setTime(e*24*60*60*1e3+DH),t.getTimezoneOffset()!==EE&&t.setTime(t.getTime()+(t.getTimezoneOffset()-EE)*6e4),t}function IH(e){var t=0,r=0,n=!1,s=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!s)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var a=1;a!=s.length;++a)if(s[a]){switch(r=1,a>3&&(n=!0),s[a].slice(s[a].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+s[a].slice(s[a].length-1));case"D":r*=24;case"H":r*=60;case"M":if(n)r*=60;else throw new Error("Unsupported ISO Duration Field: M")}t+=r*parseInt(s[a],10)}return t}var jE=new Date("2017-02-19T19:06:09.000Z"),x8=isNaN(jE.getFullYear())?new Date("2/19/17"):jE,MH=x8.getFullYear()==2017;function Un(e,t){var r=new Date(e);if(MH)return t>0?r.setTime(r.getTime()+r.getTimezoneOffset()*60*1e3):t<0&&r.setTime(r.getTime()-r.getTimezoneOffset()*60*1e3),r;if(e instanceof Date)return e;if(x8.getFullYear()==1917&&!isNaN(r.getFullYear())){var n=r.getFullYear();return e.indexOf(""+n)>-1||r.setFullYear(r.getFullYear()+100),r}var s=e.match(/\d+/g)||["2017","2","19","0","0","0"],a=new Date(+s[0],+s[1]-1,+s[2],+s[3]||0,+s[4]||0,+s[5]||0);return e.indexOf("Z")>-1&&(a=new Date(a.getTime()-a.getTimezoneOffset()*60*1e3)),a}function vf(e,t){if(Gr&&Buffer.isBuffer(e)){if(t){if(e[0]==255&&e[1]==254)return Il(e.slice(2).toString("utf16le"));if(e[1]==254&&e[2]==255)return Il(s8(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(t){if(e[0]==255&&e[1]==254)return Il(new TextDecoder("utf-16le").decode(e.slice(2)));if(e[0]==254&&e[1]==255)return Il(new TextDecoder("utf-16be").decode(e.slice(2)))}var r={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(a){return r[a]||a})}catch{}for(var n=[],s=0;s!=e.length;++s)n.push(String.fromCharCode(e[s]));return n.join("")}function $n(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=$n(e[r]));return t}function fs(e,t){for(var r="";r.length<t;)r+=e;return r}function Qo(e){var t=Number(e);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(e))return t;var r=1,n=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return r*=100,""});return!isNaN(t=Number(n))||(n=n.replace(/[(](.*)[)]/,function(s,a){return r=-r,a}),!isNaN(t=Number(n)))?t/r:t}var OH=["january","february","march","april","may","june","july","august","september","october","november","december"];function p0(e){var t=new Date(e),r=new Date(NaN),n=t.getYear(),s=t.getMonth(),a=t.getDate();if(isNaN(a))return r;var i=e.toLowerCase();if(i.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(i=i.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),i.length>3&&OH.indexOf(i)==-1)return r}else if(i.match(/[a-z]/))return r;return n<0||n>8099?r:(s>0||a>1)&&n!=101?t:e.match(/[^-0-9:,\/\\]/)?r:t}var LH=(function(){var e="abacaba".split(/(:?b)/i).length==5;return function(r,n,s){if(e||typeof n=="string")return r.split(n);for(var a=r.split(n),i=[a[0]],l=1;l<a.length;++l)i.push(s),i.push(a[l]);return i}})();function y8(e){return e?e.content&&e.type?vf(e.content,!0):e.data?jm(e.data):e.asNodeBuffer&&Gr?jm(e.asNodeBuffer().toString("binary")):e.asBinary?jm(e.asBinary()):e._data&&e._data.getContent?jm(vf(Array.prototype.slice.call(e._data.getContent(),0))):null:null}function v8(e){if(!e)return null;if(e.data)return xE(e.data);if(e.asNodeBuffer&&Gr)return e.asNodeBuffer();if(e._data&&e._data.getContent){var t=e._data.getContent();return typeof t=="string"?xE(t):Array.prototype.slice.call(t)}return e.content&&e.type?e.content:null}function BH(e){return e&&e.name.slice(-4)===".bin"?v8(e):y8(e)}function vo(e,t){for(var r=e.FullPaths||ms(e.files),n=t.toLowerCase().replace(/[\/]/g,"\\"),s=n.replace(/\\/g,"/"),a=0;a<r.length;++a){var i=r[a].replace(/^Root Entry[\/]/,"").toLowerCase();if(n==i||s==i)return e.files?e.files[r[a]]:e.FileIndex[a]}return null}function fS(e,t){var r=vo(e,t);if(r==null)throw new Error("Cannot find file "+t+" in zip");return r}function Is(e,t,r){if(!r)return BH(fS(e,t));if(!t)return null;try{return Is(e,t)}catch{return null}}function qi(e,t,r){if(!r)return y8(fS(e,t));if(!t)return null;try{return qi(e,t)}catch{return null}}function UH(e,t,r){return v8(fS(e,t))}function AE(e){for(var t=e.FullPaths||ms(e.files),r=[],n=0;n<t.length;++n)t[n].slice(-1)!="/"&&r.push(t[n].replace(/^Root Entry[\/]/,""));return r.sort()}function Hr(e,t,r){if(e.FullPaths){if(typeof r=="string"){var n;return Gr?n=Bc(r):n=sH(r),xr.utils.cfb_add(e,t,n)}xr.utils.cfb_add(e,t,r)}else e.file(t,r)}function hS(){return xr.utils.cfb_new()}function w8(e,t){switch(t.type){case"base64":return xr.read(e,{type:"base64"});case"binary":return xr.read(e,{type:"binary"});case"buffer":case"array":return xr.read(e,{type:"buffer"})}throw new Error("Unrecognized type "+t.type)}function Fm(e,t){if(e.charAt(0)=="/")return e.slice(1);var r=t.split("/");t.slice(-1)!="/"&&r.pop();for(var n=e.split("/");n.length!==0;){var s=n.shift();s===".."?r.pop():s!=="."&&r.push(s)}return r.join("/")}var Es=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,$H=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,FE=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,WH=/<[^>]*>/g,Ja=Es.match(FE)?FE:WH,zH=/<\w*:/,HH=/<(\/?)\w+:/;function Fr(e,t,r){for(var n={},s=0,a=0;s!==e.length&&!((a=e.charCodeAt(s))===32||a===10||a===13);++s);if(t||(n[0]=e.slice(0,s)),s===e.length)return n;var i=e.match($H),l=0,c="",d=0,f="",p="",g=1;if(i)for(d=0;d!=i.length;++d){for(p=i[d],a=0;a!=p.length&&p.charCodeAt(a)!==61;++a);for(f=p.slice(0,a).trim();p.charCodeAt(a+1)==32;)++a;for(g=(s=p.charCodeAt(a+1))==34||s==39?1:0,c=p.slice(a+1+g,p.length-g),l=0;l!=f.length&&f.charCodeAt(l)!==58;++l);if(l===f.length)f.indexOf("_")>0&&(f=f.slice(0,f.indexOf("_"))),n[f]=c,n[f.toLowerCase()]=c;else{var y=(l===5&&f.slice(0,5)==="xmlns"?"xmlns":"")+f.slice(l+1);if(n[y]&&f.slice(l-3,l)=="ext")continue;n[y]=c,n[y.toLowerCase()]=c}}return n}function zl(e){return e.replace(HH,"<$1")}var _8={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},gS=av(_8),nn=(function(){var e=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,t=/_x([\da-fA-F]{4})_/ig;return function r(n){var s=n+"",a=s.indexOf("<![CDATA[");if(a==-1)return s.replace(e,function(l,c){return _8[l]||String.fromCharCode(parseInt(c,l.indexOf("x")>-1?16:10))||l}).replace(t,function(l,c){return String.fromCharCode(parseInt(c,16))});var i=s.indexOf("]]>");return r(s.slice(0,a))+s.slice(a+9,i)+r(s.slice(i+3))}})(),mS=/[&<>'"]/g,GH=/[\u0000-\u0008\u000b-\u001f]/g;function bn(e){var t=e+"";return t.replace(mS,function(r){return gS[r]}).replace(GH,function(r){return"_x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+"_"})}function PE(e){return bn(e).replace(/ /g,"_x0020_")}var b8=/[\u0000-\u001f]/g;function pS(e){var t=e+"";return t.replace(mS,function(r){return gS[r]}).replace(/\n/g,"<br/>").replace(b8,function(r){return"&#x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+";"})}function VH(e){var t=e+"";return t.replace(mS,function(r){return gS[r]}).replace(b8,function(r){return"&#x"+r.charCodeAt(0).toString(16).toUpperCase()+";"})}var RE=(function(){var e=/&#(\d+);/g;function t(r,n){return String.fromCharCode(parseInt(n,10))}return function(n){return n.replace(e,t)}})();function KH(e){return e.replace(/(\r\n|[\r\n])/g,"&#10;")}function On(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function zw(e){for(var t="",r=0,n=0,s=0,a=0,i=0,l=0;r<e.length;){if(n=e.charCodeAt(r++),n<128){t+=String.fromCharCode(n);continue}if(s=e.charCodeAt(r++),n>191&&n<224){i=(n&31)<<6,i|=s&63,t+=String.fromCharCode(i);continue}if(a=e.charCodeAt(r++),n<240){t+=String.fromCharCode((n&15)<<12|(s&63)<<6|a&63);continue}i=e.charCodeAt(r++),l=((n&7)<<18|(s&63)<<12|(a&63)<<6|i&63)-65536,t+=String.fromCharCode(55296+(l>>>10&1023)),t+=String.fromCharCode(56320+(l&1023))}return t}function DE(e){var t=Ku(2*e.length),r,n,s=1,a=0,i=0,l;for(n=0;n<e.length;n+=s)s=1,(l=e.charCodeAt(n))<128?r=l:l<224?(r=(l&31)*64+(e.charCodeAt(n+1)&63),s=2):l<240?(r=(l&15)*4096+(e.charCodeAt(n+1)&63)*64+(e.charCodeAt(n+2)&63),s=3):(s=4,r=(l&7)*262144+(e.charCodeAt(n+1)&63)*4096+(e.charCodeAt(n+2)&63)*64+(e.charCodeAt(n+3)&63),r-=65536,i=55296+(r>>>10&1023),r=56320+(r&1023)),i!==0&&(t[a++]=i&255,t[a++]=i>>>8,i=0),t[a++]=r%256,t[a++]=r>>>8;return t.slice(0,a).toString("ucs2")}function IE(e){return Bc(e,"binary").toString("utf8")}var wy="foo bar bazâð£",Nn=Gr&&(IE(wy)==zw(wy)&&IE||DE(wy)==zw(wy)&&DE)||zw,Il=Gr?function(e){return Bc(e,"utf8").toString("binary")}:function(e){for(var t=[],r=0,n=0,s=0;r<e.length;)switch(n=e.charCodeAt(r++),!0){case n<128:t.push(String.fromCharCode(n));break;case n<2048:t.push(String.fromCharCode(192+(n>>6))),t.push(String.fromCharCode(128+(n&63)));break;case(n>=55296&&n<57344):n-=55296,s=e.charCodeAt(r++)-56320+(n<<10),t.push(String.fromCharCode(240+(s>>18&7))),t.push(String.fromCharCode(144+(s>>12&63))),t.push(String.fromCharCode(128+(s>>6&63))),t.push(String.fromCharCode(128+(s&63)));break;default:t.push(String.fromCharCode(224+(n>>12))),t.push(String.fromCharCode(128+(n>>6&63))),t.push(String.fromCharCode(128+(n&63)))}return t.join("")},xp=(function(){var e={};return function(r,n){var s=r+"|"+(n||"");return e[s]?e[s]:e[s]=new RegExp("<(?:\\w+:)?"+r+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+r+">",n||"")}})(),S8=(function(){var e=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(t){return[new RegExp("&"+t[0]+";","ig"),t[1]]});return function(r){for(var n=r.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),s=0;s<e.length;++s)n=n.replace(e[s][0],e[s][1]);return n}})(),qH=(function(){var e={};return function(r){return e[r]!==void 0?e[r]:e[r]=new RegExp("<(?:vt:)?"+r+">([\\s\\S]*?)</(?:vt:)?"+r+">","g")}})(),XH=/<\/?(?:vt:)?variant>/g,YH=/<(?:vt:)([^>]*)>([\s\S]*)</;function ME(e,t){var r=Fr(e),n=e.match(qH(r.baseType))||[],s=[];if(n.length!=r.size){if(t.WTF)throw new Error("unexpected vector length "+n.length+" != "+r.size);return s}return n.forEach(function(a){var i=a.replace(XH,"").match(YH);i&&s.push({v:Nn(i[2]),t:i[1]})}),s}var k8=/(^\s|\s$|\n)/;function Aa(e,t){return"<"+e+(t.match(k8)?' xml:space="preserve"':"")+">"+t+"</"+e+">"}function yp(e){return ms(e).map(function(t){return" "+t+'="'+e[t]+'"'}).join("")}function Gt(e,t,r){return"<"+e+(r!=null?yp(r):"")+(t!=null?(t.match(k8)?' xml:space="preserve"':"")+">"+t+"</"+e:"/")+">"}function c2(e,t){try{return e.toISOString().replace(/\.\d*/,"")}catch(r){if(t)throw r}return""}function JH(e,t){switch(typeof e){case"string":var r=Gt("vt:lpwstr",bn(e));return r=r.replace(/&quot;/g,"_x0022_"),r;case"number":return Gt((e|0)==e?"vt:i4":"vt:r8",bn(String(e)));case"boolean":return Gt("vt:bool",e?"true":"false")}if(e instanceof Date)return Gt("vt:filetime",c2(e));throw new Error("Unable to serialize "+e)}function xS(e){if(Gr&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e=="string")return e;if(typeof Uint8Array<"u"&&e instanceof Uint8Array)return Nn(sd(cS(e)));throw new Error("Bad input format: expected Buffer or string")}var vp=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,qs={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},Nf=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],Gi={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function QH(e,t){for(var r=1-2*(e[t+7]>>>7),n=((e[t+7]&127)<<4)+(e[t+6]>>>4&15),s=e[t+6]&15,a=5;a>=0;--a)s=s*256+e[t+a];return n==2047?s==0?r*(1/0):NaN:(n==0?n=-1022:(n-=1023,s+=Math.pow(2,52)),r*Math.pow(2,n-52)*s)}function ZH(e,t,r){var n=(t<0||1/t==-1/0?1:0)<<7,s=0,a=0,i=n?-t:t;isFinite(i)?i==0?s=a=0:(s=Math.floor(Math.log(i)/Math.LN2),a=i*Math.pow(2,52-s),s<=-1023&&(!isFinite(a)||a<Math.pow(2,52))?s=-1022:(a-=Math.pow(2,52),s+=1023)):(s=2047,a=isNaN(t)?26985:0);for(var l=0;l<=5;++l,a/=256)e[r+l]=a&255;e[r+6]=(s&15)<<4|a&15,e[r+7]=s>>4|n}var OE=function(e){for(var t=[],r=10240,n=0;n<e[0].length;++n)if(e[0][n])for(var s=0,a=e[0][n].length;s<a;s+=r)t.push.apply(t,e[0][n].slice(s,s+r));return t},LE=Gr?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(t){return Buffer.isBuffer(t)?t:Bc(t)})):OE(e)}:OE,BE=function(e,t,r){for(var n=[],s=t;s<r;s+=2)n.push(String.fromCharCode(Tc(e,s)));return n.join("").replace(pi,"")},yS=Gr?function(e,t,r){return Buffer.isBuffer(e)?e.toString("utf16le",t,r).replace(pi,""):BE(e,t,r)}:BE,UE=function(e,t,r){for(var n=[],s=t;s<t+r;++s)n.push(("0"+e[s].toString(16)).slice(-2));return n.join("")},C8=Gr?function(e,t,r){return Buffer.isBuffer(e)?e.toString("hex",t,t+r):UE(e,t,r)}:UE,$E=function(e,t,r){for(var n=[],s=t;s<r;s++)n.push(String.fromCharCode(Bh(e,s)));return n.join("")},Jp=Gr?function(t,r,n){return Buffer.isBuffer(t)?t.toString("utf8",r,n):$E(t,r,n)}:$E,T8=function(e,t){var r=Vi(e,t);return r>0?Jp(e,t+4,t+4+r-1):""},N8=T8,E8=function(e,t){var r=Vi(e,t);return r>0?Jp(e,t+4,t+4+r-1):""},j8=E8,A8=function(e,t){var r=2*Vi(e,t);return r>0?Jp(e,t+4,t+4+r-1):""},F8=A8,P8=function(t,r){var n=Vi(t,r);return n>0?yS(t,r+4,r+4+n):""},R8=P8,D8=function(e,t){var r=Vi(e,t);return r>0?Jp(e,t+4,t+4+r):""},I8=D8,M8=function(e,t){return QH(e,t)},w1=M8,vS=function(t){return Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array};Gr&&(N8=function(t,r){if(!Buffer.isBuffer(t))return T8(t,r);var n=t.readUInt32LE(r);return n>0?t.toString("utf8",r+4,r+4+n-1):""},j8=function(t,r){if(!Buffer.isBuffer(t))return E8(t,r);var n=t.readUInt32LE(r);return n>0?t.toString("utf8",r+4,r+4+n-1):""},F8=function(t,r){if(!Buffer.isBuffer(t))return A8(t,r);var n=2*t.readUInt32LE(r);return t.toString("utf16le",r+4,r+4+n-1)},R8=function(t,r){if(!Buffer.isBuffer(t))return P8(t,r);var n=t.readUInt32LE(r);return t.toString("utf16le",r+4,r+4+n)},I8=function(t,r){if(!Buffer.isBuffer(t))return D8(t,r);var n=t.readUInt32LE(r);return t.toString("utf8",r+4,r+4+n)},w1=function(t,r){return Buffer.isBuffer(t)?t.readDoubleLE(r):M8(t,r)},vS=function(t){return Buffer.isBuffer(t)||Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array});var Bh=function(e,t){return e[t]},Tc=function(e,t){return e[t+1]*256+e[t]},eG=function(e,t){var r=e[t+1]*256+e[t];return r<32768?r:(65535-r+1)*-1},Vi=function(e,t){return e[t+3]*(1<<24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]},Wd=function(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]},tG=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]};function Wm(e,t){var r="",n,s,a=[],i,l,c,d;switch(t){case"dbcs":if(d=this.l,Gr&&Buffer.isBuffer(this))r=this.slice(this.l,this.l+2*e).toString("utf16le");else for(c=0;c<e;++c)r+=String.fromCharCode(Tc(this,d)),d+=2;e*=2;break;case"utf8":r=Jp(this,this.l,this.l+e);break;case"utf16le":e*=2,r=yS(this,this.l,this.l+e);break;case"wstr":return Wm.call(this,e,"dbcs");case"lpstr-ansi":r=N8(this,this.l),e=4+Vi(this,this.l);break;case"lpstr-cp":r=j8(this,this.l),e=4+Vi(this,this.l);break;case"lpwstr":r=F8(this,this.l),e=4+2*Vi(this,this.l);break;case"lpp4":e=4+Vi(this,this.l),r=R8(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+Vi(this,this.l),r=I8(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,r="";(i=Bh(this,this.l+e++))!==0;)a.push(vy(i));r=a.join("");break;case"_wstr":for(e=0,r="";(i=Tc(this,this.l+e))!==0;)a.push(vy(i)),e+=2;e+=2,r=a.join("");break;case"dbcs-cont":for(r="",d=this.l,c=0;c<e;++c){if(this.lens&&this.lens.indexOf(d)!==-1)return i=Bh(this,d),this.l=d+1,l=Wm.call(this,e-c,i?"dbcs-cont":"sbcs-cont"),a.join("")+l;a.push(vy(Tc(this,d))),d+=2}r=a.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(r="",d=this.l,c=0;c!=e;++c){if(this.lens&&this.lens.indexOf(d)!==-1)return i=Bh(this,d),this.l=d+1,l=Wm.call(this,e-c,i?"dbcs-cont":"sbcs-cont"),a.join("")+l;a.push(vy(Bh(this,d))),d+=1}r=a.join("");break;default:switch(e){case 1:return n=Bh(this,this.l),this.l++,n;case 2:return n=(t==="i"?eG:Tc)(this,this.l),this.l+=2,n;case 4:case-4:return t==="i"||(this[this.l+3]&128)===0?(n=(e>0?Wd:tG)(this,this.l),this.l+=4,n):(s=Vi(this,this.l),this.l+=4,s);case 8:case-8:if(t==="f")return e==8?s=w1(this,this.l):s=w1([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,s;e=8;case 16:r=C8(this,this.l,e);break}}return this.l+=e,r}var rG=function(e,t,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24&255},nG=function(e,t,r){e[r]=t&255,e[r+1]=t>>8&255,e[r+2]=t>>16&255,e[r+3]=t>>24&255},sG=function(e,t,r){e[r]=t&255,e[r+1]=t>>>8&255};function aG(e,t,r){var n=0,s=0;if(r==="dbcs"){for(s=0;s!=t.length;++s)sG(this,t.charCodeAt(s),this.l+2*s);n=2*t.length}else if(r==="sbcs"){for(t=t.replace(/[^\x00-\x7F]/g,"_"),s=0;s!=t.length;++s)this[this.l+s]=t.charCodeAt(s)&255;n=t.length}else if(r==="hex"){for(;s<e;++s)this[this.l++]=parseInt(t.slice(2*s,2*s+2),16)||0;return this}else if(r==="utf16le"){var a=Math.min(this.l+e,this.length);for(s=0;s<Math.min(t.length,e);++s){var i=t.charCodeAt(s);this[this.l++]=i&255,this[this.l++]=i>>8}for(;this.l<a;)this[this.l++]=0;return this}else switch(e){case 1:n=1,this[this.l]=t&255;break;case 2:n=2,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255;break;case 3:n=3,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255,t>>>=8,this[this.l+2]=t&255;break;case 4:n=4,rG(this,t,this.l);break;case 8:if(n=8,r==="f"){ZH(this,t,this.l);break}case 16:break;case-4:n=4,nG(this,t,this.l);break}return this.l+=n,this}function O8(e,t){var r=C8(this,this.l,e.length>>1);if(r!==e)throw new Error(t+"Expected "+e+" saw "+r);this.l+=e.length>>1}function Na(e,t){e.l=t,e.read_shift=Wm,e.chk=O8,e.write_shift=aG}function Ya(e,t){e.l+=t}function wt(e){var t=Ku(e);return Na(t,0),t}function Uc(e,t,r){if(e){var n,s,a;Na(e,e.l||0);for(var i=e.length,l=0,c=0;e.l<i;){l=e.read_shift(1),l&128&&(l=(l&127)+((e.read_shift(1)&127)<<7));var d=Cp[l]||Cp[65535];for(n=e.read_shift(1),a=n&127,s=1;s<4&&n&128;++s)a+=((n=e.read_shift(1))&127)<<7*s;c=e.l+a;var f=d.f&&d.f(e,a,r);if(e.l=c,t(f,d,l))return}}}function Ri(){var e=[],t=Gr?256:2048,r=function(d){var f=wt(d);return Na(f,0),f},n=r(t),s=function(){n&&(n.length>n.l&&(n=n.slice(0,n.l),n.l=n.length),n.length>0&&e.push(n),n=null)},a=function(d){return n&&d<n.length-n.l?n:(s(),n=r(Math.max(d+1,t)))},i=function(){return s(),la(e)},l=function(d){s(),n=d,n.l==null&&(n.l=n.length),a(t)};return{next:a,push:l,end:i,_bufs:e}}function Nt(e,t,r,n){var s=+t,a;if(!isNaN(s)){n||(n=Cp[s].p||(r||[]).length||0),a=1+(s>=128?1:0)+1,n>=128&&++a,n>=16384&&++a,n>=2097152&&++a;var i=e.next(a);s<=127?i.write_shift(1,s):(i.write_shift(1,(s&127)+128),i.write_shift(1,s>>7));for(var l=0;l!=4;++l)if(n>=128)i.write_shift(1,(n&127)+128),n>>=7;else{i.write_shift(1,n);break}n>0&&vS(r)&&e.push(r)}}function zm(e,t,r){var n=$n(e);if(t.s?(n.cRel&&(n.c+=t.s.c),n.rRel&&(n.r+=t.s.r)):(n.cRel&&(n.c+=t.c),n.rRel&&(n.r+=t.r)),!r||r.biff<12){for(;n.c>=256;)n.c-=256;for(;n.r>=65536;)n.r-=65536}return n}function WE(e,t,r){var n=$n(e);return n.s=zm(n.s,t.s,r),n.e=zm(n.e,t.s,r),n}function Hm(e,t){if(e.cRel&&e.c<0)for(e=$n(e);e.c<0;)e.c+=t>8?16384:256;if(e.rRel&&e.r<0)for(e=$n(e);e.r<0;)e.r+=t>8?1048576:t>5?65536:16384;var r=jr(e);return!e.cRel&&e.cRel!=null&&(r=lG(r)),!e.rRel&&e.rRel!=null&&(r=iG(r)),r}function Hw(e,t){return e.s.r==0&&!e.s.rRel&&e.e.r==(t.biff>=12?1048575:t.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+es(e.s.c)+":"+(e.e.cRel?"":"$")+es(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(t.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+Ts(e.s.r)+":"+(e.e.rRel?"":"$")+Ts(e.e.r):Hm(e.s,t.biff)+":"+Hm(e.e,t.biff)}function wS(e){return parseInt(oG(e),10)-1}function Ts(e){return""+(e+1)}function iG(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function oG(e){return e.replace(/\$(\d+)$/,"$1")}function _S(e){for(var t=cG(e),r=0,n=0;n!==t.length;++n)r=26*r+t.charCodeAt(n)-64;return r-1}function es(e){if(e<0)throw new Error("invalid column "+e);var t="";for(++e;e;e=Math.floor((e-1)/26))t=String.fromCharCode((e-1)%26+65)+t;return t}function lG(e){return e.replace(/^([A-Z])/,"$$$1")}function cG(e){return e.replace(/^\$([A-Z])/,"$1")}function uG(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function ts(e){for(var t=0,r=0,n=0;n<e.length;++n){var s=e.charCodeAt(n);s>=48&&s<=57?t=10*t+(s-48):s>=65&&s<=90&&(r=26*r+(s-64))}return{c:r-1,r:t-1}}function jr(e){for(var t=e.c+1,r="";t;t=(t-1)/26|0)r=String.fromCharCode((t-1)%26+65)+r;return r+(e.r+1)}function Di(e){var t=e.indexOf(":");return t==-1?{s:ts(e),e:ts(e)}:{s:ts(e.slice(0,t)),e:ts(e.slice(t+1))}}function zr(e,t){return typeof t>"u"||typeof t=="number"?zr(e.s,e.e):(typeof e!="string"&&(e=jr(e)),typeof t!="string"&&(t=jr(t)),e==t?e:e+":"+t)}function sn(e){var t={s:{c:0,r:0},e:{c:0,r:0}},r=0,n=0,s=0,a=e.length;for(r=0;n<a&&!((s=e.charCodeAt(n)-64)<1||s>26);++n)r=26*r+s;for(t.s.c=--r,r=0;n<a&&!((s=e.charCodeAt(n)-48)<0||s>9);++n)r=10*r+s;if(t.s.r=--r,n===a||s!=10)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++n,r=0;n!=a&&!((s=e.charCodeAt(n)-64)<1||s>26);++n)r=26*r+s;for(t.e.c=--r,r=0;n!=a&&!((s=e.charCodeAt(n)-48)<0||s>9);++n)r=10*r+s;return t.e.r=--r,t}function zE(e,t){var r=e.t=="d"&&t instanceof Date;if(e.z!=null)try{return e.w=No(e.z,r?Ys(t):t)}catch{}try{return e.w=No((e.XF||{}).numFmtId||(r?14:0),r?Ys(t):t)}catch{return""+t}}function Mc(e,t,r){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&r&&r.dateNF&&(e.z=r.dateNF),e.t=="e"?$c[e.v]||e.v:t==null?zE(e,e.v):zE(e,t))}function ad(e,t){var r=t&&t.sheet?t.sheet:"Sheet1",n={};return n[r]=e,{SheetNames:[r],Sheets:n}}function L8(e,t,r){var n=r||{},s=e?Array.isArray(e):n.dense,a=e||(s?[]:{}),i=0,l=0;if(a&&n.origin!=null){if(typeof n.origin=="number")i=n.origin;else{var c=typeof n.origin=="string"?ts(n.origin):n.origin;i=c.r,l=c.c}a["!ref"]||(a["!ref"]="A1:A1")}var d={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(a["!ref"]){var f=sn(a["!ref"]);d.s.c=f.s.c,d.s.r=f.s.r,d.e.c=Math.max(d.e.c,f.e.c),d.e.r=Math.max(d.e.r,f.e.r),i==-1&&(d.e.r=i=f.e.r+1)}for(var p=0;p!=t.length;++p)if(t[p]){if(!Array.isArray(t[p]))throw new Error("aoa_to_sheet expects an array of arrays");for(var g=0;g!=t[p].length;++g)if(!(typeof t[p][g]>"u")){var y={v:t[p][g]},v=i+p,w=l+g;if(d.s.r>v&&(d.s.r=v),d.s.c>w&&(d.s.c=w),d.e.r<v&&(d.e.r=v),d.e.c<w&&(d.e.c=w),t[p][g]&&typeof t[p][g]=="object"&&!Array.isArray(t[p][g])&&!(t[p][g]instanceof Date))y=t[p][g];else if(Array.isArray(y.v)&&(y.f=t[p][g][1],y.v=y.v[0]),y.v===null)if(y.f)y.t="n";else if(n.nullError)y.t="e",y.v=0;else if(n.sheetStubs)y.t="z";else continue;else typeof y.v=="number"?y.t="n":typeof y.v=="boolean"?y.t="b":y.v instanceof Date?(y.z=n.dateNF||Cr[14],n.cellDates?(y.t="d",y.w=No(y.z,Ys(y.v))):(y.t="n",y.v=Ys(y.v),y.w=No(y.z,y.v))):y.t="s";if(s)a[v]||(a[v]=[]),a[v][w]&&a[v][w].z&&(y.z=a[v][w].z),a[v][w]=y;else{var b=jr({c:w,r:v});a[b]&&a[b].z&&(y.z=a[b].z),a[b]=y}}}return d.s.c<1e7&&(a["!ref"]=zr(d)),a}function L0(e,t){return L8(null,e,t)}function dG(e){return e.read_shift(4,"i")}function Zo(e,t){return t||(t=wt(4)),t.write_shift(4,e),t}function qa(e){var t=e.read_shift(4);return t===0?"":e.read_shift(t,"dbcs")}function ua(e,t){var r=!1;return t==null&&(r=!0,t=wt(4+2*e.length)),t.write_shift(4,e.length),e.length>0&&t.write_shift(0,e,"dbcs"),r?t.slice(0,t.l):t}function fG(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function hG(e,t){return t||(t=wt(4)),t.write_shift(2,0),t.write_shift(2,0),t}function bS(e,t){var r=e.l,n=e.read_shift(1),s=qa(e),a=[],i={t:s,h:s};if((n&1)!==0){for(var l=e.read_shift(4),c=0;c!=l;++c)a.push(fG(e));i.r=a}else i.r=[{ich:0,ifnt:0}];return e.l=r+t,i}function gG(e,t){var r=!1;return t==null&&(r=!0,t=wt(15+4*e.t.length)),t.write_shift(1,0),ua(e.t,t),r?t.slice(0,t.l):t}var mG=bS;function pG(e,t){var r=!1;return t==null&&(r=!0,t=wt(23+4*e.t.length)),t.write_shift(1,1),ua(e.t,t),t.write_shift(4,1),hG({},t),r?t.slice(0,t.l):t}function Eo(e){var t=e.read_shift(4),r=e.read_shift(2);return r+=e.read_shift(1)<<16,e.l++,{c:t,iStyleRef:r}}function Ef(e,t){return t==null&&(t=wt(8)),t.write_shift(-4,e.c),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}function jf(e){var t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:t}}function Af(e,t){return t==null&&(t=wt(4)),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}var xG=qa,B8=ua;function SS(e){var t=e.read_shift(4);return t===0||t===4294967295?"":e.read_shift(t,"dbcs")}function _1(e,t){var r=!1;return t==null&&(r=!0,t=wt(127)),t.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&t.write_shift(0,e,"dbcs"),r?t.slice(0,t.l):t}var yG=qa,u2=SS,kS=_1;function CS(e){var t=e.slice(e.l,e.l+4),r=t[0]&1,n=t[0]&2;e.l+=4;var s=n===0?w1([0,0,0,0,t[0]&252,t[1],t[2],t[3]],0):Wd(t,0)>>2;return r?s/100:s}function U8(e,t){t==null&&(t=wt(4));var r=0,n=0,s=e*100;if(e==(e|0)&&e>=-536870912&&e<1<<29?n=1:s==(s|0)&&s>=-536870912&&s<1<<29&&(n=1,r=1),n)t.write_shift(-4,((r?s:e)<<2)+(r+2));else throw new Error("unsupported RkNumber "+e)}function $8(e){var t={s:{},e:{}};return t.s.r=e.read_shift(4),t.e.r=e.read_shift(4),t.s.c=e.read_shift(4),t.e.c=e.read_shift(4),t}function vG(e,t){return t||(t=wt(16)),t.write_shift(4,e.s.r),t.write_shift(4,e.e.r),t.write_shift(4,e.s.c),t.write_shift(4,e.e.c),t}var Ff=$8,B0=vG;function Ha(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function wf(e,t){return(t||wt(8)).write_shift(8,e,"f")}function wG(e){var t={},r=e.read_shift(1),n=r>>>1,s=e.read_shift(1),a=e.read_shift(2,"i"),i=e.read_shift(1),l=e.read_shift(1),c=e.read_shift(1);switch(e.l++,n){case 0:t.auto=1;break;case 1:t.index=s;var d=Zd[s];d&&(t.rgb=_p(d));break;case 2:t.rgb=_p([i,l,c]);break;case 3:t.theme=s;break}return a!=0&&(t.tint=a>0?a/32767:a/32768),t}function b1(e,t){if(t||(t=wt(8)),!e||e.auto)return t.write_shift(4,0),t.write_shift(4,0),t;e.index!=null?(t.write_shift(1,2),t.write_shift(1,e.index)):e.theme!=null?(t.write_shift(1,6),t.write_shift(1,e.theme)):(t.write_shift(1,5),t.write_shift(1,0));var r=e.tint||0;if(r>0?r*=32767:r<0&&(r*=32768),t.write_shift(2,r),!e.rgb||e.theme!=null)t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);else{var n=e.rgb||"FFFFFF";typeof n=="number"&&(n=("000000"+n.toString(16)).slice(-6)),t.write_shift(1,parseInt(n.slice(0,2),16)),t.write_shift(1,parseInt(n.slice(2,4),16)),t.write_shift(1,parseInt(n.slice(4,6),16)),t.write_shift(1,255)}return t}function _G(e){var t=e.read_shift(1);e.l++;var r={fBold:t&1,fItalic:t&2,fUnderline:t&4,fStrikeout:t&8,fOutline:t&16,fShadow:t&32,fCondense:t&64,fExtend:t&128};return r}function bG(e,t){t||(t=wt(2));var r=(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0);return t.write_shift(1,r),t.write_shift(1,0),t}function W8(e,t){var r={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},n=e.read_shift(4);switch(n){case 0:return"";case 4294967295:case 4294967294:return r[e.read_shift(4)]||""}if(n>400)throw new Error("Unsupported Clipboard: "+n.toString(16));return e.l-=4,e.read_shift(0,t==1?"lpstr":"lpwstr")}function SG(e){return W8(e,1)}function kG(e){return W8(e,2)}var TS=2,Ei=3,_y=11,HE=12,S1=19,by=64,CG=65,TG=71,NG=4108,EG=4126,aa=80,z8=81,jG=[aa,z8],d2={1:{n:"CodePage",t:TS},2:{n:"Category",t:aa},3:{n:"PresentationFormat",t:aa},4:{n:"ByteCount",t:Ei},5:{n:"LineCount",t:Ei},6:{n:"ParagraphCount",t:Ei},7:{n:"SlideCount",t:Ei},8:{n:"NoteCount",t:Ei},9:{n:"HiddenCount",t:Ei},10:{n:"MultimediaClipCount",t:Ei},11:{n:"ScaleCrop",t:_y},12:{n:"HeadingPairs",t:NG},13:{n:"TitlesOfParts",t:EG},14:{n:"Manager",t:aa},15:{n:"Company",t:aa},16:{n:"LinksUpToDate",t:_y},17:{n:"CharacterCount",t:Ei},19:{n:"SharedDoc",t:_y},22:{n:"HyperlinksChanged",t:_y},23:{n:"AppVersion",t:Ei,p:"version"},24:{n:"DigSig",t:CG},26:{n:"ContentType",t:aa},27:{n:"ContentStatus",t:aa},28:{n:"Language",t:aa},29:{n:"Version",t:aa},255:{},2147483648:{n:"Locale",t:S1},2147483651:{n:"Behavior",t:S1},1919054434:{}},f2={1:{n:"CodePage",t:TS},2:{n:"Title",t:aa},3:{n:"Subject",t:aa},4:{n:"Author",t:aa},5:{n:"Keywords",t:aa},6:{n:"Comments",t:aa},7:{n:"Template",t:aa},8:{n:"LastAuthor",t:aa},9:{n:"RevNumber",t:aa},10:{n:"EditTime",t:by},11:{n:"LastPrinted",t:by},12:{n:"CreatedDate",t:by},13:{n:"ModifiedDate",t:by},14:{n:"PageCount",t:Ei},15:{n:"WordCount",t:Ei},16:{n:"CharCount",t:Ei},17:{n:"Thumbnail",t:TG},18:{n:"Application",t:aa},19:{n:"DocSecurity",t:Ei},255:{},2147483648:{n:"Locale",t:S1},2147483651:{n:"Behavior",t:S1},1919054434:{}},GE={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},AG=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function FG(e){return e.map(function(t){return[t>>16&255,t>>8&255,t&255]})}var PG=FG([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Zd=$n(PG),$c={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},H8={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},h2={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},Sy={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function NS(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function RG(e){var t=NS();if(!e||!e.match)return t;var r={};if((e.match(Ja)||[]).forEach(function(n){var s=Fr(n);switch(s[0].replace(zH,"<")){case"<?xml":break;case"<Types":t.xmlns=s["xmlns"+(s[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":r[s.Extension]=s.ContentType;break;case"<Override":t[h2[s.ContentType]]!==void 0&&t[h2[s.ContentType]].push(s.PartName);break}}),t.xmlns!==qs.CT)throw new Error("Unknown Namespace: "+t.xmlns);return t.calcchain=t.calcchains.length>0?t.calcchains[0]:"",t.sst=t.strs.length>0?t.strs[0]:"",t.style=t.styles.length>0?t.styles[0]:"",t.defaults=r,delete t.calcchains,t}function G8(e,t){var r=RH(h2),n=[],s;n[n.length]=Es,n[n.length]=Gt("Types",null,{xmlns:qs.CT,"xmlns:xsd":qs.xsd,"xmlns:xsi":qs.xsi}),n=n.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(c){return Gt("Default",null,{Extension:c[0],ContentType:c[1]})}));var a=function(c){e[c]&&e[c].length>0&&(s=e[c][0],n[n.length]=Gt("Override",null,{PartName:(s[0]=="/"?"":"/")+s,ContentType:Sy[c][t.bookType]||Sy[c].xlsx}))},i=function(c){(e[c]||[]).forEach(function(d){n[n.length]=Gt("Override",null,{PartName:(d[0]=="/"?"":"/")+d,ContentType:Sy[c][t.bookType]||Sy[c].xlsx})})},l=function(c){(e[c]||[]).forEach(function(d){n[n.length]=Gt("Override",null,{PartName:(d[0]=="/"?"":"/")+d,ContentType:r[c][0]})})};return a("workbooks"),i("sheets"),i("charts"),l("themes"),["strs","styles"].forEach(a),["coreprops","extprops","custprops"].forEach(l),l("vba"),l("comments"),l("threadedcomments"),l("drawings"),i("metadata"),l("people"),n.length>2&&(n[n.length]="</Types>",n[1]=n[1].replace("/>",">")),n.join("")}var Yr={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function wp(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)+"_rels/"+e.slice(t+1)+".rels"}function Gm(e,t){var r={"!id":{}};if(!e)return r;t.charAt(0)!=="/"&&(t="/"+t);var n={};return(e.match(Ja)||[]).forEach(function(s){var a=Fr(s);if(a[0]==="<Relationship"){var i={};i.Type=a.Type,i.Target=a.Target,i.Id=a.Id,a.TargetMode&&(i.TargetMode=a.TargetMode);var l=a.TargetMode==="External"?a.Target:Fm(a.Target,t);r[l]=i,n[a.Id]=i}}),r["!id"]=n,r}function s0(e){var t=[Es,Gt("Relationships",null,{xmlns:qs.RELS})];return ms(e["!id"]).forEach(function(r){t[t.length]=Gt("Relationship",null,e["!id"][r])}),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function _n(e,t,r,n,s,a){if(s||(s={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),t<0)for(t=e["!idx"];e["!id"]["rId"+t];++t);if(e["!idx"]=t+1,s.Id="rId"+t,s.Type=n,s.Target=r,[Yr.HLINK,Yr.XPATH,Yr.XMISS].indexOf(s.Type)>-1&&(s.TargetMode="External"),e["!id"][s.Id])throw new Error("Cannot rewrite rId "+t);return e["!id"][s.Id]=s,e[("/"+s.Target).replace("//","/")]=s,t}var DG="application/vnd.oasis.opendocument.spreadsheet";function IG(e,t){for(var r=xS(e),n,s;n=vp.exec(r);)switch(n[3]){case"manifest":break;case"file-entry":if(s=Fr(n[0],!1),s.path=="/"&&s.type!==DG)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(t&&t.WTF)throw n}}function MG(e){var t=[Es];t.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),t.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var r=0;r<e.length;++r)t.push('  <manifest:file-entry manifest:full-path="'+e[r][0]+'" manifest:media-type="'+e[r][1]+`"/>
`);return t.push("</manifest:manifest>"),t.join("")}function VE(e,t,r){return['  <rdf:Description rdf:about="'+e+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(r||"odf")+"#"+t+`"/>
`,`  </rdf:Description>
`].join("")}function OG(e,t){return['  <rdf:Description rdf:about="'+e+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+t+`"/>
`,`  </rdf:Description>
`].join("")}function LG(e){var t=[Es];t.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var r=0;r!=e.length;++r)t.push(VE(e[r][0],e[r][1])),t.push(OG("",e[r][0]));return t.push(VE("","Document","pkg")),t.push("</rdf:RDF>"),t.join("")}function V8(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+m1.version+"</meta:generator></office:meta></office:document-meta>"}var ko=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],BG=(function(){for(var e=new Array(ko.length),t=0;t<ko.length;++t){var r=ko[t],n="(?:"+r[0].slice(0,r[0].indexOf(":"))+":)"+r[0].slice(r[0].indexOf(":")+1);e[t]=new RegExp("<"+n+"[^>]*>([\\s\\S]*?)</"+n+">")}return e})();function K8(e){var t={};e=Nn(e);for(var r=0;r<ko.length;++r){var n=ko[r],s=e.match(BG[r]);s!=null&&s.length>0&&(t[n[1]]=nn(s[1])),n[2]==="date"&&t[n[1]]&&(t[n[1]]=Un(t[n[1]]))}return t}function Gw(e,t,r,n,s){s[e]!=null||t==null||t===""||(s[e]=t,t=bn(t),n[n.length]=r?Gt(e,t,r):Aa(e,t))}function q8(e,t){var r=t||{},n=[Es,Gt("cp:coreProperties",null,{"xmlns:cp":qs.CORE_PROPS,"xmlns:dc":qs.dc,"xmlns:dcterms":qs.dcterms,"xmlns:dcmitype":qs.dcmitype,"xmlns:xsi":qs.xsi})],s={};if(!e&&!r.Props)return n.join("");e&&(e.CreatedDate!=null&&Gw("dcterms:created",typeof e.CreatedDate=="string"?e.CreatedDate:c2(e.CreatedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},n,s),e.ModifiedDate!=null&&Gw("dcterms:modified",typeof e.ModifiedDate=="string"?e.ModifiedDate:c2(e.ModifiedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},n,s));for(var a=0;a!=ko.length;++a){var i=ko[a],l=r.Props&&r.Props[i[1]]!=null?r.Props[i[1]]:e?e[i[1]]:null;l===!0?l="1":l===!1?l="0":typeof l=="number"&&(l=String(l)),l!=null&&Gw(i[0],l,null,n,s)}return n.length>2&&(n[n.length]="</cp:coreProperties>",n[1]=n[1].replace("/>",">")),n.join("")}var ef=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],X8=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function Y8(e,t,r,n){var s=[];if(typeof e=="string")s=ME(e,n);else for(var a=0;a<e.length;++a)s=s.concat(e[a].map(function(f){return{v:f}}));var i=typeof t=="string"?ME(t,n).map(function(f){return f.v}):t,l=0,c=0;if(i.length>0)for(var d=0;d!==s.length;d+=2){switch(c=+s[d+1].v,s[d].v){case"Worksheets":case"工作表":case"Листы":case"أوراق العمل":case"ワークシート":case"גליונות עבודה":case"Arbeitsblätter":case"Çalışma Sayfaları":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de cálculo":case"Planilhas":case"Regneark":case"Hojas de cálculo":case"Werkbladen":r.Worksheets=c,r.SheetNames=i.slice(l,l+c);break;case"Named Ranges":case"Rangos con nombre":case"名前付き一覧":case"Benannte Bereiche":case"Navngivne områder":r.NamedRanges=c,r.DefinedNames=i.slice(l,l+c);break;case"Charts":case"Diagramme":r.Chartsheets=c,r.ChartNames=i.slice(l,l+c);break}l+=c}}function UG(e,t,r){var n={};return t||(t={}),e=Nn(e),ef.forEach(function(s){var a=(e.match(xp(s[0]))||[])[1];switch(s[2]){case"string":a&&(t[s[1]]=nn(a));break;case"bool":t[s[1]]=a==="true";break;case"raw":var i=e.match(new RegExp("<"+s[0]+"[^>]*>([\\s\\S]*?)</"+s[0]+">"));i&&i.length>0&&(n[s[1]]=i[1]);break}}),n.HeadingPairs&&n.TitlesOfParts&&Y8(n.HeadingPairs,n.TitlesOfParts,t,r),t}function J8(e){var t=[],r=Gt;return e||(e={}),e.Application="SheetJS",t[t.length]=Es,t[t.length]=Gt("Properties",null,{xmlns:qs.EXT_PROPS,"xmlns:vt":qs.vt}),ef.forEach(function(n){if(e[n[1]]!==void 0){var s;switch(n[2]){case"string":s=bn(String(e[n[1]]));break;case"bool":s=e[n[1]]?"true":"false";break}s!==void 0&&(t[t.length]=r(n[0],s))}}),t[t.length]=r("HeadingPairs",r("vt:vector",r("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+r("vt:variant",r("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=r("TitlesOfParts",r("vt:vector",e.SheetNames.map(function(n){return"<vt:lpstr>"+bn(n)+"</vt:lpstr>"}).join(""),{size:e.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var $G=/<[^>]+>[^<]*/g;function WG(e,t){var r={},n="",s=e.match($G);if(s)for(var a=0;a!=s.length;++a){var i=s[a],l=Fr(i);switch(l[0]){case"<?xml":break;case"<Properties":break;case"<property":n=nn(l.name);break;case"</property>":n=null;break;default:if(i.indexOf("<vt:")===0){var c=i.split(">"),d=c[0].slice(4),f=c[1];switch(d){case"lpstr":case"bstr":case"lpwstr":r[n]=nn(f);break;case"bool":r[n]=On(f);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":r[n]=parseInt(f,10);break;case"r4":case"r8":case"decimal":r[n]=parseFloat(f);break;case"filetime":case"date":r[n]=Un(f);break;case"cy":case"error":r[n]=nn(f);break;default:if(d.slice(-1)=="/")break;t.WTF&&typeof console<"u"&&console.warn("Unexpected",i,d,c)}}else if(i.slice(0,2)!=="</"){if(t.WTF)throw new Error(i)}}}return r}function Q8(e){var t=[Es,Gt("Properties",null,{xmlns:qs.CUST_PROPS,"xmlns:vt":qs.vt})];if(!e)return t.join("");var r=1;return ms(e).forEach(function(s){++r,t[t.length]=Gt("property",JH(e[s]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:r,name:bn(s)})}),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var g2={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},Vw;function zG(e,t,r){Vw||(Vw=av(g2)),t=Vw[t]||t,e[t]=r}function HG(e,t){var r=[];return ms(g2).map(function(n){for(var s=0;s<ko.length;++s)if(ko[s][1]==n)return ko[s];for(s=0;s<ef.length;++s)if(ef[s][1]==n)return ef[s];throw n}).forEach(function(n){if(e[n[1]]!=null){var s=t&&t.Props&&t.Props[n[1]]!=null?t.Props[n[1]]:e[n[1]];switch(n[2]){case"date":s=new Date(s).toISOString().replace(/\.\d*Z/,"Z");break}typeof s=="number"?s=String(s):s===!0||s===!1?s=s?"1":"0":s instanceof Date&&(s=new Date(s).toISOString().replace(/\.\d*Z/,"")),r.push(Aa(g2[n[1]]||n[1],s))}}),Gt("DocumentProperties",r.join(""),{xmlns:Gi.o})}function GG(e,t){var r=["Worksheets","SheetNames"],n="CustomDocumentProperties",s=[];return e&&ms(e).forEach(function(a){if(Object.prototype.hasOwnProperty.call(e,a)){for(var i=0;i<ko.length;++i)if(a==ko[i][1])return;for(i=0;i<ef.length;++i)if(a==ef[i][1])return;for(i=0;i<r.length;++i)if(a==r[i])return;var l=e[a],c="string";typeof l=="number"?(c="float",l=String(l)):l===!0||l===!1?(c="boolean",l=l?"1":"0"):l=String(l),s.push(Gt(PE(a),l,{"dt:dt":c}))}}),t&&ms(t).forEach(function(a){if(Object.prototype.hasOwnProperty.call(t,a)&&!(e&&Object.prototype.hasOwnProperty.call(e,a))){var i=t[a],l="string";typeof i=="number"?(l="float",i=String(i)):i===!0||i===!1?(l="boolean",i=i?"1":"0"):i instanceof Date?(l="dateTime.tz",i=i.toISOString()):i=String(i),s.push(Gt(PE(a),i,{"dt:dt":l}))}}),"<"+n+' xmlns="'+Gi.o+'">'+s.join("")+"</"+n+">"}function ES(e){var t=e.read_shift(4),r=e.read_shift(4);return new Date((r/1e7*Math.pow(2,32)+t/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function VG(e){var t=typeof e=="string"?new Date(Date.parse(e)):e,r=t.getTime()/1e3+11644473600,n=r%Math.pow(2,32),s=(r-n)/Math.pow(2,32);n*=1e7,s*=1e7;var a=n/Math.pow(2,32)|0;a>0&&(n=n%Math.pow(2,32),s+=a);var i=wt(8);return i.write_shift(4,n),i.write_shift(4,s),i}function Z8(e,t,r){var n=e.l,s=e.read_shift(0,"lpstr-cp");if(r)for(;e.l-n&3;)++e.l;return s}function eF(e,t,r){var n=e.read_shift(0,"lpwstr");return n}function tF(e,t,r){return t===31?eF(e):Z8(e,t,r)}function m2(e,t,r){return tF(e,t,r===!1?0:4)}function KG(e,t){if(!t)throw new Error("VtUnalignedString must have positive length");return tF(e,t,0)}function qG(e){for(var t=e.read_shift(4),r=[],n=0;n!=t;++n){var s=e.l;r[n]=e.read_shift(0,"lpwstr").replace(pi,""),e.l-s&2&&(e.l+=2)}return r}function XG(e){for(var t=e.read_shift(4),r=[],n=0;n!=t;++n)r[n]=e.read_shift(0,"lpstr-cp").replace(pi,"");return r}function YG(e){var t=e.l,r=k1(e,z8);e[e.l]==0&&e[e.l+1]==0&&e.l-t&2&&(e.l+=2);var n=k1(e,Ei);return[r,n]}function JG(e){for(var t=e.read_shift(4),r=[],n=0;n<t/2;++n)r.push(YG(e));return r}function KE(e,t){for(var r=e.read_shift(4),n={},s=0;s!=r;++s){var a=e.read_shift(4),i=e.read_shift(4);n[a]=e.read_shift(i,t===1200?"utf16le":"utf8").replace(pi,"").replace(Am,"!"),t===1200&&i%2&&(e.l+=2)}return e.l&3&&(e.l=e.l>>3<<2),n}function rF(e){var t=e.read_shift(4),r=e.slice(e.l,e.l+t);return e.l+=t,(t&3)>0&&(e.l+=4-(t&3)&3),r}function QG(e){var t={};return t.Size=e.read_shift(4),e.l+=t.Size+3-(t.Size-1)%4,t}function k1(e,t,r){var n=e.read_shift(2),s,a=r||{};if(e.l+=2,t!==HE&&n!==t&&jG.indexOf(t)===-1&&!((t&65534)==4126&&(n&65534)==4126))throw new Error("Expected type "+t+" saw "+n);switch(t===HE?n:t){case 2:return s=e.read_shift(2,"i"),a.raw||(e.l+=2),s;case 3:return s=e.read_shift(4,"i"),s;case 11:return e.read_shift(4)!==0;case 19:return s=e.read_shift(4),s;case 30:return Z8(e,n,4).replace(pi,"");case 31:return eF(e);case 64:return ES(e);case 65:return rF(e);case 71:return QG(e);case 80:return m2(e,n,!a.raw).replace(pi,"");case 81:return KG(e,n).replace(pi,"");case 4108:return JG(e);case 4126:case 4127:return n==4127?qG(e):XG(e);default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+n)}}function qE(e,t){var r=wt(4),n=wt(4);switch(r.write_shift(4,e==80?31:e),e){case 3:n.write_shift(-4,t);break;case 5:n=wt(8),n.write_shift(8,t,"f");break;case 11:n.write_shift(4,t?1:0);break;case 64:n=VG(t);break;case 31:case 80:for(n=wt(4+2*(t.length+1)+(t.length%2?0:2)),n.write_shift(4,t.length+1),n.write_shift(0,t,"dbcs");n.l!=n.length;)n.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+t)}return la([r,n])}function XE(e,t){var r=e.l,n=e.read_shift(4),s=e.read_shift(4),a=[],i=0,l=0,c=-1,d={};for(i=0;i!=s;++i){var f=e.read_shift(4),p=e.read_shift(4);a[i]=[f,p+r]}a.sort(function(k,_){return k[1]-_[1]});var g={};for(i=0;i!=s;++i){if(e.l!==a[i][1]){var y=!0;if(i>0&&t)switch(t[a[i-1][0]].t){case 2:e.l+2===a[i][1]&&(e.l+=2,y=!1);break;case 80:e.l<=a[i][1]&&(e.l=a[i][1],y=!1);break;case 4108:e.l<=a[i][1]&&(e.l=a[i][1],y=!1);break}if((!t||i==0)&&e.l<=a[i][1]&&(y=!1,e.l=a[i][1]),y)throw new Error("Read Error: Expected address "+a[i][1]+" at "+e.l+" :"+i)}if(t){var v=t[a[i][0]];if(g[v.n]=k1(e,v.t,{raw:!0}),v.p==="version"&&(g[v.n]=String(g[v.n]>>16)+"."+("0000"+String(g[v.n]&65535)).slice(-4)),v.n=="CodePage")switch(g[v.n]){case 0:g[v.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:Xo(l=g[v.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+g[v.n])}}else if(a[i][0]===1){if(l=g.CodePage=k1(e,TS),Xo(l),c!==-1){var w=e.l;e.l=a[c][1],d=KE(e,l),e.l=w}}else if(a[i][0]===0){if(l===0){c=i,e.l=a[i+1][1];continue}d=KE(e,l)}else{var b=d[a[i][0]],E;switch(e[e.l]){case 65:e.l+=4,E=rF(e);break;case 30:e.l+=4,E=m2(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 31:e.l+=4,E=m2(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 3:e.l+=4,E=e.read_shift(4,"i");break;case 19:e.l+=4,E=e.read_shift(4);break;case 5:e.l+=4,E=e.read_shift(8,"f");break;case 11:e.l+=4,E=ks(e,4);break;case 64:e.l+=4,E=Un(ES(e));break;default:throw new Error("unparsed value: "+e[e.l])}g[b]=E}}return e.l=r+n,g}var nF=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function ZG(e){switch(typeof e){case"boolean":return 11;case"number":return(e|0)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64;break}return-1}function YE(e,t,r){var n=wt(8),s=[],a=[],i=8,l=0,c=wt(8),d=wt(8);if(c.write_shift(4,2),c.write_shift(4,1200),d.write_shift(4,1),a.push(c),s.push(d),i+=8+c.length,!t){d=wt(8),d.write_shift(4,0),s.unshift(d);var f=[wt(4)];for(f[0].write_shift(4,e.length),l=0;l<e.length;++l){var p=e[l][0];for(c=wt(8+2*(p.length+1)+(p.length%2?0:2)),c.write_shift(4,l+2),c.write_shift(4,p.length+1),c.write_shift(0,p,"dbcs");c.l!=c.length;)c.write_shift(1,0);f.push(c)}c=la(f),a.unshift(c),i+=8+c.length}for(l=0;l<e.length;++l)if(!(t&&!t[e[l][0]])&&!(nF.indexOf(e[l][0])>-1||X8.indexOf(e[l][0])>-1)&&e[l][1]!=null){var g=e[l][1],y=0;if(t){y=+t[e[l][0]];var v=r[y];if(v.p=="version"&&typeof g=="string"){var w=g.split(".");g=(+w[0]<<16)+(+w[1]||0)}c=qE(v.t,g)}else{var b=ZG(g);b==-1&&(b=31,g=String(g)),c=qE(b,g)}a.push(c),d=wt(8),d.write_shift(4,t?y:2+l),s.push(d),i+=8+c.length}var E=8*(a.length+1);for(l=0;l<a.length;++l)s[l].write_shift(4,E),E+=a[l].length;return n.write_shift(4,i),n.write_shift(4,a.length),la([n].concat(s).concat(a))}function JE(e,t,r){var n=e.content;if(!n)return{};Na(n,0);var s,a,i,l,c=0;n.chk("feff","Byte Order: "),n.read_shift(2);var d=n.read_shift(4),f=n.read_shift(16);if(f!==xr.utils.consts.HEADER_CLSID&&f!==r)throw new Error("Bad PropertySet CLSID "+f);if(s=n.read_shift(4),s!==1&&s!==2)throw new Error("Unrecognized #Sets: "+s);if(a=n.read_shift(16),l=n.read_shift(4),s===1&&l!==n.l)throw new Error("Length mismatch: "+l+" !== "+n.l);s===2&&(i=n.read_shift(16),c=n.read_shift(4));var p=XE(n,t),g={SystemIdentifier:d};for(var y in p)g[y]=p[y];if(g.FMTID=a,s===1)return g;if(c-n.l==2&&(n.l+=2),n.l!==c)throw new Error("Length mismatch 2: "+n.l+" !== "+c);var v;try{v=XE(n,null)}catch{}for(y in v)g[y]=v[y];return g.FMTID=[a,i],g}function QE(e,t,r,n,s,a){var i=wt(s?68:48),l=[i];i.write_shift(2,65534),i.write_shift(2,0),i.write_shift(4,842412599),i.write_shift(16,xr.utils.consts.HEADER_CLSID,"hex"),i.write_shift(4,s?2:1),i.write_shift(16,t,"hex"),i.write_shift(4,s?68:48);var c=YE(e,r,n);if(l.push(c),s){var d=YE(s,null,null);i.write_shift(16,a,"hex"),i.write_shift(4,68+c.length),l.push(d)}return la(l)}function Eu(e,t){return e.read_shift(t),null}function eV(e,t){t||(t=wt(e));for(var r=0;r<e;++r)t.write_shift(1,0);return t}function tV(e,t,r){for(var n=[],s=e.l+t;e.l<s;)n.push(r(e,s-e.l));if(s!==e.l)throw new Error("Slurp error");return n}function ks(e,t){return e.read_shift(t)===1}function di(e,t){return t||(t=wt(2)),t.write_shift(2,+!!e),t}function Ms(e){return e.read_shift(2,"u")}function wo(e,t){return t||(t=wt(2)),t.write_shift(2,e),t}function sF(e,t){return tV(e,t,Ms)}function rV(e){var t=e.read_shift(1),r=e.read_shift(1);return r===1?t:t===1}function aF(e,t,r){return r||(r=wt(2)),r.write_shift(1,t=="e"?+e:+!!e),r.write_shift(1,t=="e"?1:0),r}function Qp(e,t,r){var n=e.read_shift(r&&r.biff>=12?2:1),s="sbcs-cont";if(r&&r.biff>=8,!r||r.biff==8){var a=e.read_shift(1);a&&(s="dbcs-cont")}else r.biff==12&&(s="wstr");r.biff>=2&&r.biff<=5&&(s="cpstr");var i=n?e.read_shift(n,s):"";return i}function nV(e){var t=e.read_shift(2),r=e.read_shift(1),n=r&4,s=r&8,a=1+(r&1),i=0,l,c={};s&&(i=e.read_shift(2)),n&&(l=e.read_shift(4));var d=a==2?"dbcs-cont":"sbcs-cont",f=t===0?"":e.read_shift(t,d);return s&&(e.l+=4*i),n&&(e.l+=l),c.t=f,s||(c.raw="<t>"+c.t+"</t>",c.r=c.t),c}function sV(e){var t=e.t||"",r=wt(3);r.write_shift(2,t.length),r.write_shift(1,1);var n=wt(2*t.length);n.write_shift(2*t.length,t,"utf16le");var s=[r,n];return la(s)}function _f(e,t,r){var n;if(r){if(r.biff>=2&&r.biff<=5)return e.read_shift(t,"cpstr");if(r.biff>=12)return e.read_shift(t,"dbcs-cont")}var s=e.read_shift(1);return s===0?n=e.read_shift(t,"sbcs-cont"):n=e.read_shift(t,"dbcs-cont"),n}function Zp(e,t,r){var n=e.read_shift(r&&r.biff==2?1:2);return n===0?(e.l++,""):_f(e,n,r)}function Pf(e,t,r){if(r.biff>5)return Zp(e,t,r);var n=e.read_shift(1);return n===0?(e.l++,""):e.read_shift(n,r.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function iF(e,t,r){return r||(r=wt(3+2*e.length)),r.write_shift(2,e.length),r.write_shift(1,1),r.write_shift(31,e,"utf16le"),r}function aV(e){var t=e.read_shift(1);e.l++;var r=e.read_shift(2);return e.l+=2,[t,r]}function iV(e){var t=e.read_shift(4),r=e.l,n=!1;t>24&&(e.l+=t-24,e.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(n=!0),e.l=r);var s=e.read_shift((n?t-24:t)>>1,"utf16le").replace(pi,"");return n&&(e.l+=24),s}function oV(e){for(var t=e.read_shift(2),r="";t-- >0;)r+="../";var n=e.read_shift(0,"lpstr-ansi");if(e.l+=2,e.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var s=e.read_shift(4);if(s===0)return r+n.replace(/\\/g,"/");var a=e.read_shift(4);if(e.read_shift(2)!=3)throw new Error("Bad FileMoniker");var i=e.read_shift(a>>1,"utf16le").replace(pi,"");return r+i}function lV(e,t){var r=e.read_shift(16);switch(r){case"e0c9ea79f9bace118c8200aa004ba90b":return iV(e);case"0303000000000000c000000000000046":return oV(e);default:throw new Error("Unsupported Moniker "+r)}}function ky(e){var t=e.read_shift(4),r=t>0?e.read_shift(t,"utf16le").replace(pi,""):"";return r}function ZE(e,t){t||(t=wt(6+e.length*2)),t.write_shift(4,1+e.length);for(var r=0;r<e.length;++r)t.write_shift(2,e.charCodeAt(r));return t.write_shift(2,0),t}function cV(e,t){var r=e.l+t,n=e.read_shift(4);if(n!==2)throw new Error("Unrecognized streamVersion: "+n);var s=e.read_shift(2);e.l+=2;var a,i,l,c,d="",f,p;s&16&&(a=ky(e,r-e.l)),s&128&&(i=ky(e,r-e.l)),(s&257)===257&&(l=ky(e,r-e.l)),(s&257)===1&&(c=lV(e,r-e.l)),s&8&&(d=ky(e,r-e.l)),s&32&&(f=e.read_shift(16)),s&64&&(p=ES(e)),e.l=r;var g=i||l||c||"";g&&d&&(g+="#"+d),g||(g="#"+d),s&2&&g.charAt(0)=="/"&&g.charAt(1)!="/"&&(g="file://"+g);var y={Target:g};return f&&(y.guid=f),p&&(y.time=p),a&&(y.Tooltip=a),y}function uV(e){var t=wt(512),r=0,n=e.Target;n.slice(0,7)=="file://"&&(n=n.slice(7));var s=n.indexOf("#"),a=s>-1?31:23;switch(n.charAt(0)){case"#":a=28;break;case".":a&=-3;break}t.write_shift(4,2),t.write_shift(4,a);var i=[8,6815827,6619237,4849780,83];for(r=0;r<i.length;++r)t.write_shift(4,i[r]);if(a==28)n=n.slice(1),ZE(n,t);else if(a&2){for(i="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<i.length;++r)t.write_shift(1,parseInt(i[r],16));var l=s>-1?n.slice(0,s):n;for(t.write_shift(4,2*(l.length+1)),r=0;r<l.length;++r)t.write_shift(2,l.charCodeAt(r));t.write_shift(2,0),a&8&&ZE(s>-1?n.slice(s+1):"",t)}else{for(i="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),r=0;r<i.length;++r)t.write_shift(1,parseInt(i[r],16));for(var c=0;n.slice(c*3,c*3+3)=="../"||n.slice(c*3,c*3+3)=="..\\";)++c;for(t.write_shift(2,c),t.write_shift(4,n.length-3*c+1),r=0;r<n.length-3*c;++r)t.write_shift(1,n.charCodeAt(r+3*c)&255);for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),r=0;r<6;++r)t.write_shift(4,0)}return t.slice(0,t.l)}function oF(e){var t=e.read_shift(1),r=e.read_shift(1),n=e.read_shift(1),s=e.read_shift(1);return[t,r,n,s]}function lF(e,t){var r=oF(e);return r[3]=0,r}function Hl(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(2);return{r:t,c:r,ixfe:n}}function bf(e,t,r,n){return n||(n=wt(6)),n.write_shift(2,e),n.write_shift(2,t),n.write_shift(2,r||0),n}function dV(e){var t=e.read_shift(2),r=e.read_shift(2);return e.l+=8,{type:t,flags:r}}function fV(e,t,r){return t===0?"":Pf(e,t,r)}function hV(e,t,r){var n=r.biff>8?4:2,s=e.read_shift(n),a=e.read_shift(n,"i"),i=e.read_shift(n,"i");return[s,a,i]}function cF(e){var t=e.read_shift(2),r=CS(e);return[t,r]}function gV(e,t,r){e.l+=4,t-=4;var n=e.l+t,s=Qp(e,t,r),a=e.read_shift(2);if(n-=e.l,a!==n)throw new Error("Malformed AddinUdf: padding = "+n+" != "+a);return e.l+=a,s}function lv(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(2),s=e.read_shift(2);return{s:{c:n,r:t},e:{c:s,r}}}function uF(e,t){return t||(t=wt(8)),t.write_shift(2,e.s.r),t.write_shift(2,e.e.r),t.write_shift(2,e.s.c),t.write_shift(2,e.e.c),t}function dF(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(1),s=e.read_shift(1);return{s:{c:n,r:t},e:{c:s,r}}}var mV=dF;function fF(e){e.l+=4;var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(2);return e.l+=12,[r,t,n]}function pV(e){var t={};return e.l+=4,e.l+=16,t.fSharedNote=e.read_shift(2),e.l+=4,t}function xV(e){var t={};return e.l+=4,e.cf=e.read_shift(2),t}function Ba(e){e.l+=2,e.l+=e.read_shift(2)}var yV={0:Ba,4:Ba,5:Ba,6:Ba,7:xV,8:Ba,9:Ba,10:Ba,11:Ba,12:Ba,13:pV,14:Ba,15:Ba,16:Ba,17:Ba,18:Ba,19:Ba,20:Ba,21:fF};function vV(e,t){for(var r=e.l+t,n=[];e.l<r;){var s=e.read_shift(2);e.l-=2;try{n.push(yV[s](e,r-e.l))}catch{return e.l=r,n}}return e.l!=r&&(e.l=r),n}function Cy(e,t){var r={BIFFVer:0,dt:0};switch(r.BIFFVer=e.read_shift(2),t-=2,t>=2&&(r.dt=e.read_shift(2),e.l-=2),r.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(t>6)throw new Error("Unexpected BIFF Ver "+r.BIFFVer)}return e.read_shift(t),r}function jS(e,t,r){var n=1536,s=16;switch(r.bookType){case"biff8":break;case"biff5":n=1280,s=8;break;case"biff4":n=4,s=6;break;case"biff3":n=3,s=6;break;case"biff2":n=2,s=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var a=wt(s);return a.write_shift(2,n),a.write_shift(2,t),s>4&&a.write_shift(2,29282),s>6&&a.write_shift(2,1997),s>8&&(a.write_shift(2,49161),a.write_shift(2,1),a.write_shift(2,1798),a.write_shift(2,0)),a}function wV(e,t){return t===0||e.read_shift(2),1200}function _V(e,t,r){if(r.enc)return e.l+=t,"";var n=e.l,s=Pf(e,0,r);return e.read_shift(t+n-e.l),s}function bV(e,t){var r=!t||t.biff==8,n=wt(r?112:54);for(n.write_shift(t.biff==8?2:1,7),r&&n.write_shift(1,0),n.write_shift(4,859007059),n.write_shift(4,5458548|(r?0:536870912));n.l<n.length;)n.write_shift(1,r?0:32);return n}function SV(e,t,r){var n=r&&r.biff==8||t==2?e.read_shift(2):(e.l+=t,0);return{fDialog:n&16,fBelow:n&64,fRight:n&128}}function kV(e,t,r){var n=e.read_shift(4),s=e.read_shift(1)&3,a=e.read_shift(1);switch(a){case 0:a="Worksheet";break;case 1:a="Macrosheet";break;case 2:a="Chartsheet";break;case 6:a="VBAModule";break}var i=Qp(e,0,r);return i.length===0&&(i="Sheet1"),{pos:n,hs:s,dt:a,name:i}}function CV(e,t){var r=!t||t.biff>=8?2:1,n=wt(8+r*e.name.length);n.write_shift(4,e.pos),n.write_shift(1,e.hs||0),n.write_shift(1,e.dt),n.write_shift(1,e.name.length),t.biff>=8&&n.write_shift(1,1),n.write_shift(r*e.name.length,e.name,t.biff<8?"sbcs":"utf16le");var s=n.slice(0,n.l);return s.l=n.l,s}function TV(e,t){for(var r=e.l+t,n=e.read_shift(4),s=e.read_shift(4),a=[],i=0;i!=s&&e.l<r;++i)a.push(nV(e));return a.Count=n,a.Unique=s,a}function NV(e,t){var r=wt(8);r.write_shift(4,e.Count),r.write_shift(4,e.Unique);for(var n=[],s=0;s<e.length;++s)n[s]=sV(e[s]);var a=la([r].concat(n));return a.parts=[r.length].concat(n.map(function(i){return i.length})),a}function EV(e,t){var r={};return r.dsst=e.read_shift(2),e.l+=t-2,r}function jV(e){var t={};t.r=e.read_shift(2),t.c=e.read_shift(2),t.cnt=e.read_shift(2)-t.c;var r=e.read_shift(2);e.l+=4;var n=e.read_shift(1);return e.l+=3,n&7&&(t.level=n&7),n&32&&(t.hidden=!0),n&64&&(t.hpt=r/20),t}function AV(e){var t=dV(e);if(t.type!=2211)throw new Error("Invalid Future Record "+t.type);var r=e.read_shift(4);return r!==0}function FV(e){return e.read_shift(2),e.read_shift(4)}function e3(e,t,r){var n=0;r&&r.biff==2||(n=e.read_shift(2));var s=e.read_shift(2);r&&r.biff==2&&(n=1-(s>>15),s&=32767);var a={Unsynced:n&1,DyZero:(n&2)>>1,ExAsc:(n&4)>>2,ExDsc:(n&8)>>3};return[a,s]}function PV(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(2),s=e.read_shift(2),a=e.read_shift(2),i=e.read_shift(2),l=e.read_shift(2),c=e.read_shift(2),d=e.read_shift(2);return{Pos:[t,r],Dim:[n,s],Flags:a,CurTab:i,FirstTab:l,Selected:c,TabRatio:d}}function RV(){var e=wt(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}function DV(e,t,r){if(r&&r.biff>=2&&r.biff<5)return{};var n=e.read_shift(2);return{RTL:n&64}}function IV(e){var t=wt(18),r=1718;return e&&e.RTL&&(r|=64),t.write_shift(2,r),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}function MV(){}function OV(e,t,r){var n={dyHeight:e.read_shift(2),fl:e.read_shift(2)};switch(r&&r.biff||8){case 2:break;case 3:case 4:e.l+=2;break;default:e.l+=10;break}return n.name=Qp(e,0,r),n}function LV(e,t){var r=e.name||"Arial",n=t&&t.biff==5,s=n?15+r.length:16+2*r.length,a=wt(s);return a.write_shift(2,e.sz*20),a.write_shift(4,0),a.write_shift(2,400),a.write_shift(4,0),a.write_shift(2,0),a.write_shift(1,r.length),n||a.write_shift(1,1),a.write_shift((n?1:2)*r.length,r,n?"sbcs":"utf16le"),a}function BV(e){var t=Hl(e);return t.isst=e.read_shift(4),t}function UV(e,t,r,n){var s=wt(10);return bf(e,t,n,s),s.write_shift(4,r),s}function $V(e,t,r){r.biffguess&&r.biff==2&&(r.biff=5);var n=e.l+t,s=Hl(e);r.biff==2&&e.l++;var a=Zp(e,n-e.l,r);return s.val=a,s}function WV(e,t,r,n,s){var a=!s||s.biff==8,i=wt(8+ +a+(1+a)*r.length);return bf(e,t,n,i),i.write_shift(2,r.length),a&&i.write_shift(1,1),i.write_shift((1+a)*r.length,r,a?"utf16le":"sbcs"),i}function zV(e,t,r){var n=e.read_shift(2),s=Pf(e,0,r);return[n,s]}function HV(e,t,r,n){var s=r&&r.biff==5;n||(n=wt(s?3+t.length:5+2*t.length)),n.write_shift(2,e),n.write_shift(s?1:2,t.length),s||n.write_shift(1,1),n.write_shift((s?1:2)*t.length,t,s?"sbcs":"utf16le");var a=n.length>n.l?n.slice(0,n.l):n;return a.l==null&&(a.l=a.length),a}var GV=Pf;function t3(e,t,r){var n=e.l+t,s=r.biff==8||!r.biff?4:2,a=e.read_shift(s),i=e.read_shift(s),l=e.read_shift(2),c=e.read_shift(2);return e.l=n,{s:{r:a,c:l},e:{r:i,c}}}function VV(e,t){var r=t.biff==8||!t.biff?4:2,n=wt(2*r+6);return n.write_shift(r,e.s.r),n.write_shift(r,e.e.r+1),n.write_shift(2,e.s.c),n.write_shift(2,e.e.c+1),n.write_shift(2,0),n}function KV(e){var t=e.read_shift(2),r=e.read_shift(2),n=cF(e);return{r:t,c:r,ixfe:n[0],rknum:n[1]}}function qV(e,t){for(var r=e.l+t-2,n=e.read_shift(2),s=e.read_shift(2),a=[];e.l<r;)a.push(cF(e));if(e.l!==r)throw new Error("MulRK read error");var i=e.read_shift(2);if(a.length!=i-s+1)throw new Error("MulRK length mismatch");return{r:n,c:s,C:i,rkrec:a}}function XV(e,t){for(var r=e.l+t-2,n=e.read_shift(2),s=e.read_shift(2),a=[];e.l<r;)a.push(e.read_shift(2));if(e.l!==r)throw new Error("MulBlank read error");var i=e.read_shift(2);if(a.length!=i-s+1)throw new Error("MulBlank length mismatch");return{r:n,c:s,C:i,ixfe:a}}function YV(e,t,r,n){var s={},a=e.read_shift(4),i=e.read_shift(4),l=e.read_shift(4),c=e.read_shift(2);return s.patternType=AG[l>>26],n.cellStyles&&(s.alc=a&7,s.fWrap=a>>3&1,s.alcV=a>>4&7,s.fJustLast=a>>7&1,s.trot=a>>8&255,s.cIndent=a>>16&15,s.fShrinkToFit=a>>20&1,s.iReadOrder=a>>22&2,s.fAtrNum=a>>26&1,s.fAtrFnt=a>>27&1,s.fAtrAlc=a>>28&1,s.fAtrBdr=a>>29&1,s.fAtrPat=a>>30&1,s.fAtrProt=a>>31&1,s.dgLeft=i&15,s.dgRight=i>>4&15,s.dgTop=i>>8&15,s.dgBottom=i>>12&15,s.icvLeft=i>>16&127,s.icvRight=i>>23&127,s.grbitDiag=i>>30&3,s.icvTop=l&127,s.icvBottom=l>>7&127,s.icvDiag=l>>14&127,s.dgDiag=l>>21&15,s.icvFore=c&127,s.icvBack=c>>7&127,s.fsxButton=c>>14&1),s}function JV(e,t,r){var n={};return n.ifnt=e.read_shift(2),n.numFmtId=e.read_shift(2),n.flags=e.read_shift(2),n.fStyle=n.flags>>2&1,t-=6,n.data=YV(e,t,n.fStyle,r),n}function r3(e,t,r,n){var s=r&&r.biff==5;n||(n=wt(s?16:20)),n.write_shift(2,0),e.style?(n.write_shift(2,e.numFmtId||0),n.write_shift(2,65524)):(n.write_shift(2,e.numFmtId||0),n.write_shift(2,t<<4));var a=0;return e.numFmtId>0&&s&&(a|=1024),n.write_shift(4,a),n.write_shift(4,0),s||n.write_shift(4,0),n.write_shift(2,0),n}function QV(e){e.l+=4;var t=[e.read_shift(2),e.read_shift(2)];if(t[0]!==0&&t[0]--,t[1]!==0&&t[1]--,t[0]>7||t[1]>7)throw new Error("Bad Gutters: "+t.join("|"));return t}function ZV(e){var t=wt(8);return t.write_shift(4,0),t.write_shift(2,0),t.write_shift(2,0),t}function n3(e,t,r){var n=Hl(e);(r.biff==2||t==9)&&++e.l;var s=rV(e);return n.val=s,n.t=s===!0||s===!1?"b":"e",n}function eK(e,t,r,n,s,a){var i=wt(8);return bf(e,t,n,i),aF(r,a,i),i}function tK(e,t,r){r.biffguess&&r.biff==2&&(r.biff=5);var n=Hl(e),s=Ha(e);return n.val=s,n}function rK(e,t,r,n){var s=wt(14);return bf(e,t,n,s),wf(r,s),s}var s3=fV;function nK(e,t,r){var n=e.l+t,s=e.read_shift(2),a=e.read_shift(2);if(r.sbcch=a,a==1025||a==14849)return[a,s];if(a<1||a>255)throw new Error("Unexpected SupBook type: "+a);for(var i=_f(e,a),l=[];n>e.l;)l.push(Zp(e));return[a,s,i,l]}function a3(e,t,r){var n=e.read_shift(2),s,a={fBuiltIn:n&1,fWantAdvise:n>>>1&1,fWantPict:n>>>2&1,fOle:n>>>3&1,fOleLink:n>>>4&1,cf:n>>>5&1023,fIcon:n>>>15&1};return r.sbcch===14849&&(s=gV(e,t-2,r)),a.body=s||e.read_shift(t-2),typeof s=="string"&&(a.Name=s),a}var sK=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function i3(e,t,r){var n=e.l+t,s=e.read_shift(2),a=e.read_shift(1),i=e.read_shift(1),l=e.read_shift(r&&r.biff==2?1:2),c=0;(!r||r.biff>=5)&&(r.biff!=5&&(e.l+=2),c=e.read_shift(2),r.biff==5&&(e.l+=2),e.l+=4);var d=_f(e,i,r);s&32&&(d=sK[d.charCodeAt(0)]);var f=n-e.l;r&&r.biff==2&&--f;var p=n==e.l||l===0||!(f>0)?[]:vJ(e,f,r,l);return{chKey:a,Name:d,itab:c,rgce:p}}function hF(e,t,r){if(r.biff<8)return aK(e,t,r);for(var n=[],s=e.l+t,a=e.read_shift(r.biff>8?4:2);a--!==0;)n.push(hV(e,r.biff>8?12:6,r));if(e.l!=s)throw new Error("Bad ExternSheet: "+e.l+" != "+s);return n}function aK(e,t,r){e[e.l+1]==3&&e[e.l]++;var n=Qp(e,t,r);return n.charCodeAt(0)==3?n.slice(1):n}function iK(e,t,r){if(r.biff<8){e.l+=t;return}var n=e.read_shift(2),s=e.read_shift(2),a=_f(e,n,r),i=_f(e,s,r);return[a,i]}function oK(e,t,r){var n=dF(e);e.l++;var s=e.read_shift(1);return t-=8,[wJ(e,t,r),s,n]}function o3(e,t,r){var n=mV(e);switch(r.biff){case 2:e.l++,t-=7;break;case 3:case 4:e.l+=2,t-=8;break;default:e.l+=6,t-=12}return[n,xJ(e,t,r)]}function lK(e){var t=e.read_shift(4)!==0,r=e.read_shift(4)!==0,n=e.read_shift(4);return[t,r,n]}function cK(e,t,r){if(!(r.biff<8)){var n=e.read_shift(2),s=e.read_shift(2),a=e.read_shift(2),i=e.read_shift(2),l=Pf(e,0,r);return r.biff<8&&e.read_shift(1),[{r:n,c:s},l,i,a]}}function uK(e,t,r){return cK(e,t,r)}function dK(e,t){for(var r=[],n=e.read_shift(2);n--;)r.push(lv(e));return r}function fK(e){var t=wt(2+e.length*8);t.write_shift(2,e.length);for(var r=0;r<e.length;++r)uF(e[r],t);return t}function hK(e,t,r){if(r&&r.biff<8)return mK(e,t,r);var n=fF(e),s=vV(e,t-22,n[1]);return{cmo:n,ft:s}}var gK={8:function(e,t){var r=e.l+t;e.l+=10;var n=e.read_shift(2);e.l+=4,e.l+=2,e.l+=2,e.l+=2,e.l+=4;var s=e.read_shift(1);return e.l+=s,e.l=r,{fmt:n}}};function mK(e,t,r){e.l+=4;var n=e.read_shift(2),s=e.read_shift(2),a=e.read_shift(2);e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=6,t-=36;var i=[];return i.push((gK[n]||Ya)(e,t,r)),{cmo:[s,n,a],ft:i}}function pK(e,t,r){var n=e.l,s="";try{e.l+=4;var a=(r.lastobj||{cmo:[0,0]}).cmo[1],i;[0,5,7,11,12,14].indexOf(a)==-1?e.l+=6:i=aV(e,6,r);var l=e.read_shift(2);e.read_shift(2),Ms(e,2);var c=e.read_shift(2);e.l+=c;for(var d=1;d<e.lens.length-1;++d){if(e.l-n!=e.lens[d])throw new Error("TxO: bad continue record");var f=e[e.l],p=_f(e,e.lens[d+1]-e.lens[d]-1);if(s+=p,s.length>=(f?l:2*l))break}if(s.length!==l&&s.length!==l*2)throw new Error("cchText: "+l+" != "+s.length);return e.l=n+t,{t:s}}catch{return e.l=n+t,{t:s}}}function xK(e,t){var r=lv(e);e.l+=16;var n=cV(e,t-24);return[r,n]}function yK(e){var t=wt(24),r=ts(e[0]);t.write_shift(2,r.r),t.write_shift(2,r.r),t.write_shift(2,r.c),t.write_shift(2,r.c);for(var n="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),s=0;s<16;++s)t.write_shift(1,parseInt(n[s],16));return la([t,uV(e[1])])}function vK(e,t){e.read_shift(2);var r=lv(e),n=e.read_shift((t-10)/2,"dbcs-cont");return n=n.replace(pi,""),[r,n]}function wK(e){var t=e[1].Tooltip,r=wt(10+2*(t.length+1));r.write_shift(2,2048);var n=ts(e[0]);r.write_shift(2,n.r),r.write_shift(2,n.r),r.write_shift(2,n.c),r.write_shift(2,n.c);for(var s=0;s<t.length;++s)r.write_shift(2,t.charCodeAt(s));return r.write_shift(2,0),r}function _K(e){var t=[0,0],r;return r=e.read_shift(2),t[0]=GE[r]||r,r=e.read_shift(2),t[1]=GE[r]||r,t}function bK(e){return e||(e=wt(4)),e.write_shift(2,1),e.write_shift(2,1),e}function SK(e){for(var t=e.read_shift(2),r=[];t-- >0;)r.push(lF(e));return r}function kK(e){for(var t=e.read_shift(2),r=[];t-- >0;)r.push(lF(e));return r}function CK(e){e.l+=2;var t={cxfs:0,crc:0};return t.cxfs=e.read_shift(2),t.crc=e.read_shift(4),t}function gF(e,t,r){if(!r.cellStyles)return Ya(e,t);var n=r&&r.biff>=12?4:2,s=e.read_shift(n),a=e.read_shift(n),i=e.read_shift(n),l=e.read_shift(n),c=e.read_shift(2);n==2&&(e.l+=2);var d={s,e:a,w:i,ixfe:l,flags:c};return(r.biff>=5||!r.biff)&&(d.level=c>>8&7),d}function TK(e,t){var r=wt(12);r.write_shift(2,t),r.write_shift(2,t),r.write_shift(2,e.width*256),r.write_shift(2,0);var n=0;return e.hidden&&(n|=1),r.write_shift(1,n),n=e.level||0,r.write_shift(1,n),r.write_shift(2,0),r}function NK(e,t){var r={};return t<32||(e.l+=16,r.header=Ha(e),r.footer=Ha(e),e.l+=2),r}function EK(e,t,r){var n={area:!1};if(r.biff!=5)return e.l+=t,n;var s=e.read_shift(1);return e.l+=3,s&16&&(n.area=!0),n}function jK(e){for(var t=wt(2*e),r=0;r<e;++r)t.write_shift(2,r+1);return t}var AK=Hl,FK=sF,PK=Zp;function RK(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(4),s={fmt:t,env:r,len:n,data:e.slice(e.l,e.l+n)};return e.l+=n,s}function DK(e,t,r){r.biffguess&&r.biff==5&&(r.biff=2);var n=Hl(e);++e.l;var s=Pf(e,t-7,r);return n.t="str",n.val=s,n}function IK(e){var t=Hl(e);++e.l;var r=Ha(e);return t.t="n",t.val=r,t}function MK(e,t,r){var n=wt(15);return nx(n,e,t),n.write_shift(8,r,"f"),n}function OK(e){var t=Hl(e);++e.l;var r=e.read_shift(2);return t.t="n",t.val=r,t}function LK(e,t,r){var n=wt(9);return nx(n,e,t),n.write_shift(2,r),n}function BK(e){var t=e.read_shift(1);return t===0?(e.l++,""):e.read_shift(t,"sbcs-cont")}function UK(e,t){e.l+=6,e.l+=2,e.l+=1,e.l+=3,e.l+=1,e.l+=t-13}function $K(e,t,r){var n=e.l+t,s=Hl(e),a=e.read_shift(2),i=_f(e,a,r);return e.l=n,s.t="str",s.val=i,s}var WK=[2,3,48,49,131,139,140,245],p2=(function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=av({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(l,c){var d=[],f=Ku(1);switch(c.type){case"base64":f=Ki(Yi(l));break;case"binary":f=Ki(l);break;case"buffer":case"array":f=l;break}Na(f,0);var p=f.read_shift(1),g=!!(p&136),y=!1,v=!1;switch(p){case 2:break;case 3:break;case 48:y=!0,g=!0;break;case 49:y=!0,g=!0;break;case 131:break;case 139:break;case 140:v=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+p.toString(16))}var w=0,b=521;p==2&&(w=f.read_shift(2)),f.l+=3,p!=2&&(w=f.read_shift(4)),w>1048576&&(w=1e6),p!=2&&(b=f.read_shift(2));var E=f.read_shift(2),k=c.codepage||1252;p!=2&&(f.l+=16,f.read_shift(1),f[f.l]!==0&&(k=e[f[f.l]]),f.l+=1,f.l+=2),v&&(f.l+=36);for(var _=[],T={},j=Math.min(f.length,p==2?521:b-10-(y?264:0)),P=v?32:11;f.l<j&&f[f.l]!=13;)switch(T={},T.name=gp.utils.decode(k,f.slice(f.l,f.l+P)).replace(/[\u0000\r\n].*$/g,""),f.l+=P,T.type=String.fromCharCode(f.read_shift(1)),p!=2&&!v&&(T.offset=f.read_shift(4)),T.len=f.read_shift(1),p==2&&(T.offset=f.read_shift(2)),T.dec=f.read_shift(1),T.name.length&&_.push(T),p!=2&&(f.l+=v?13:14),T.type){case"B":(!y||T.len!=8)&&c.WTF&&console.log("Skipping "+T.name+":"+T.type);break;case"G":case"P":c.WTF&&console.log("Skipping "+T.name+":"+T.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+T.type)}if(f[f.l]!==13&&(f.l=b-1),f.read_shift(1)!==13)throw new Error("DBF Terminator not found "+f.l+" "+f[f.l]);f.l=b;var R=0,N=0;for(d[0]=[],N=0;N!=_.length;++N)d[0][N]=_[N].name;for(;w-- >0;){if(f[f.l]===42){f.l+=E;continue}for(++f.l,d[++R]=[],N=0,N=0;N!=_.length;++N){var A=f.slice(f.l,f.l+_[N].len);f.l+=_[N].len,Na(A,0);var M=gp.utils.decode(k,A);switch(_[N].type){case"C":M.trim().length&&(d[R][N]=M.replace(/\s+$/,""));break;case"D":M.length===8?d[R][N]=new Date(+M.slice(0,4),+M.slice(4,6)-1,+M.slice(6,8)):d[R][N]=M;break;case"F":d[R][N]=parseFloat(M.trim());break;case"+":case"I":d[R][N]=v?A.read_shift(-4,"i")^2147483648:A.read_shift(4,"i");break;case"L":switch(M.trim().toUpperCase()){case"Y":case"T":d[R][N]=!0;break;case"N":case"F":d[R][N]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+M+"|")}break;case"M":if(!g)throw new Error("DBF Unexpected MEMO for type "+p.toString(16));d[R][N]="##MEMO##"+(v?parseInt(M.trim(),10):A.read_shift(4));break;case"N":M=M.replace(/\u0000/g,"").trim(),M&&M!="."&&(d[R][N]=+M||0);break;case"@":d[R][N]=new Date(A.read_shift(-8,"f")-621356832e5);break;case"T":d[R][N]=new Date((A.read_shift(4)-2440588)*864e5+A.read_shift(4));break;case"Y":d[R][N]=A.read_shift(4,"i")/1e4+A.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":d[R][N]=-A.read_shift(-8,"f");break;case"B":if(y&&_[N].len==8){d[R][N]=A.read_shift(8,"f");break}case"G":case"P":A.l+=_[N].len;break;case"0":if(_[N].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+_[N].type)}}}if(p!=2&&f.l<f.length&&f[f.l++]!=26)throw new Error("DBF EOF Marker missing "+(f.l-1)+" of "+f.length+" "+f[f.l-1].toString(16));return c&&c.sheetRows&&(d=d.slice(0,c.sheetRows)),c.DBF=_,d}function n(l,c){var d=c||{};d.dateNF||(d.dateNF="yyyymmdd");var f=L0(r(l,d),d);return f["!cols"]=d.DBF.map(function(p){return{wch:p.len,DBF:p}}),delete d.DBF,f}function s(l,c){try{return ad(n(l,c),c)}catch(d){if(c&&c.WTF)throw d}return{SheetNames:[],Sheets:{}}}var a={B:8,C:250,L:1,D:8,"?":0,"":0};function i(l,c){var d=c||{};if(+d.codepage>=0&&Xo(+d.codepage),d.type=="string")throw new Error("Cannot write DBF to JS string");var f=Ri(),p=N1(l,{header:1,raw:!0,cellDates:!0}),g=p[0],y=p.slice(1),v=l["!cols"]||[],w=0,b=0,E=0,k=1;for(w=0;w<g.length;++w){if(((v[w]||{}).DBF||{}).name){g[w]=v[w].DBF.name,++E;continue}if(g[w]!=null){if(++E,typeof g[w]=="number"&&(g[w]=g[w].toString(10)),typeof g[w]!="string")throw new Error("DBF Invalid column name "+g[w]+" |"+typeof g[w]+"|");if(g.indexOf(g[w])!==w){for(b=0;b<1024;++b)if(g.indexOf(g[w]+"_"+b)==-1){g[w]+="_"+b;break}}}}var _=sn(l["!ref"]),T=[],j=[],P=[];for(w=0;w<=_.e.c-_.s.c;++w){var R="",N="",A=0,M=[];for(b=0;b<y.length;++b)y[b][w]!=null&&M.push(y[b][w]);if(M.length==0||g[w]==null){T[w]="?";continue}for(b=0;b<M.length;++b){switch(typeof M[b]){case"number":N="B";break;case"string":N="C";break;case"boolean":N="L";break;case"object":N=M[b]instanceof Date?"D":"C";break;default:N="C"}A=Math.max(A,String(M[b]).length),R=R&&R!=N?"C":N}A>250&&(A=250),N=((v[w]||{}).DBF||{}).type,N=="C"&&v[w].DBF.len>A&&(A=v[w].DBF.len),R=="B"&&N=="N"&&(R="N",P[w]=v[w].DBF.dec,A=v[w].DBF.len),j[w]=R=="C"||N=="N"?A:a[R]||0,k+=j[w],T[w]=R}var H=f.next(32);for(H.write_shift(4,318902576),H.write_shift(4,y.length),H.write_shift(2,296+32*E),H.write_shift(2,k),w=0;w<4;++w)H.write_shift(4,0);for(H.write_shift(4,0|(+t[n8]||3)<<8),w=0,b=0;w<g.length;++w)if(g[w]!=null){var Q=f.next(32),Z=(g[w].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Q.write_shift(1,Z,"sbcs"),Q.write_shift(1,T[w]=="?"?"C":T[w],"sbcs"),Q.write_shift(4,b),Q.write_shift(1,j[w]||a[T[w]]||0),Q.write_shift(1,P[w]||0),Q.write_shift(1,2),Q.write_shift(4,0),Q.write_shift(1,0),Q.write_shift(4,0),Q.write_shift(4,0),b+=j[w]||a[T[w]]||0}var ae=f.next(264);for(ae.write_shift(4,13),w=0;w<65;++w)ae.write_shift(4,0);for(w=0;w<y.length;++w){var te=f.next(k);for(te.write_shift(1,0),b=0;b<g.length;++b)if(g[b]!=null)switch(T[b]){case"L":te.write_shift(1,y[w][b]==null?63:y[w][b]?84:70);break;case"B":te.write_shift(8,y[w][b]||0,"f");break;case"N":var se="0";for(typeof y[w][b]=="number"&&(se=y[w][b].toFixed(P[b]||0)),E=0;E<j[b]-se.length;++E)te.write_shift(1,32);te.write_shift(1,se,"sbcs");break;case"D":y[w][b]?(te.write_shift(4,("0000"+y[w][b].getFullYear()).slice(-4),"sbcs"),te.write_shift(2,("00"+(y[w][b].getMonth()+1)).slice(-2),"sbcs"),te.write_shift(2,("00"+y[w][b].getDate()).slice(-2),"sbcs")):te.write_shift(8,"00000000","sbcs");break;case"C":var L=String(y[w][b]!=null?y[w][b]:"").slice(0,j[b]);for(te.write_shift(1,L,"sbcs"),E=0;E<j[b]-L.length;++E)te.write_shift(1,32);break}}return f.next(1).write_shift(1,26),f.end()}return{to_workbook:s,to_sheet:n,from_sheet:i}})(),mF=(function(){var e={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("\x1BN("+ms(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),r=function(g,y){var v=e[y];return typeof v=="number"?yE(v):v},n=function(g,y,v){var w=y.charCodeAt(0)-32<<4|v.charCodeAt(0)-48;return w==59?g:yE(w)};e["|"]=254;function s(g,y){switch(y.type){case"base64":return a(Yi(g),y);case"binary":return a(g,y);case"buffer":return a(Gr&&Buffer.isBuffer(g)?g.toString("binary"):sd(g),y);case"array":return a(vf(g),y)}throw new Error("Unrecognized type "+y.type)}function a(g,y){var v=g.split(/[\n\r]+/),w=-1,b=-1,E=0,k=0,_=[],T=[],j=null,P={},R=[],N=[],A=[],M=0,H;for(+y.codepage>=0&&Xo(+y.codepage);E!==v.length;++E){M=0;var Q=v[E].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,n).replace(t,r),Z=Q.replace(/;;/g,"\0").split(";").map(function(Y){return Y.replace(/\u0000/g,";")}),ae=Z[0],te;if(Q.length>0)switch(ae){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":Z[1].charAt(0)=="P"&&T.push(Q.slice(3).replace(/;;/g,";"));break;case"C":var se=!1,L=!1,G=!1,I=!1,z=-1,V=-1;for(k=1;k<Z.length;++k)switch(Z[k].charAt(0)){case"A":break;case"X":b=parseInt(Z[k].slice(1))-1,L=!0;break;case"Y":for(w=parseInt(Z[k].slice(1))-1,L||(b=0),H=_.length;H<=w;++H)_[H]=[];break;case"K":te=Z[k].slice(1),te.charAt(0)==='"'?te=te.slice(1,te.length-1):te==="TRUE"?te=!0:te==="FALSE"?te=!1:isNaN(Qo(te))?isNaN(p0(te).getDate())||(te=Un(te)):(te=Qo(te),j!==null&&M0(j)&&(te=ov(te))),se=!0;break;case"E":I=!0;var O=a0(Z[k].slice(1),{r:w,c:b});_[w][b]=[_[w][b],O];break;case"S":G=!0,_[w][b]=[_[w][b],"S5S"];break;case"G":break;case"R":z=parseInt(Z[k].slice(1))-1;break;case"C":V=parseInt(Z[k].slice(1))-1;break;default:if(y&&y.WTF)throw new Error("SYLK bad record "+Q)}if(se&&(_[w][b]&&_[w][b].length==2?_[w][b][0]=te:_[w][b]=te,j=null),G){if(I)throw new Error("SYLK shared formula cannot have own formula");var W=z>-1&&_[z][V];if(!W||!W[1])throw new Error("SYLK shared formula cannot find base");_[w][b][1]=RF(W[1],{r:w-z,c:b-V})}break;case"F":var q=0;for(k=1;k<Z.length;++k)switch(Z[k].charAt(0)){case"X":b=parseInt(Z[k].slice(1))-1,++q;break;case"Y":for(w=parseInt(Z[k].slice(1))-1,H=_.length;H<=w;++H)_[H]=[];break;case"M":M=parseInt(Z[k].slice(1))/20;break;case"F":break;case"G":break;case"P":j=T[parseInt(Z[k].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(A=Z[k].slice(1).split(" "),H=parseInt(A[0],10);H<=parseInt(A[1],10);++H)M=parseInt(A[2],10),N[H-1]=M===0?{hidden:!0}:{wch:M},qu(N[H-1]);break;case"C":b=parseInt(Z[k].slice(1))-1,N[b]||(N[b]={});break;case"R":w=parseInt(Z[k].slice(1))-1,R[w]||(R[w]={}),M>0?(R[w].hpt=M,R[w].hpx=y0(M)):M===0&&(R[w].hidden=!0);break;default:if(y&&y.WTF)throw new Error("SYLK bad record "+Q)}q<1&&(j=null);break;default:if(y&&y.WTF)throw new Error("SYLK bad record "+Q)}}return R.length>0&&(P["!rows"]=R),N.length>0&&(P["!cols"]=N),y&&y.sheetRows&&(_=_.slice(0,y.sheetRows)),[_,P]}function i(g,y){var v=s(g,y),w=v[0],b=v[1],E=L0(w,y);return ms(b).forEach(function(k){E[k]=b[k]}),E}function l(g,y){return ad(i(g,y),y)}function c(g,y,v,w){var b="C;Y"+(v+1)+";X"+(w+1)+";K";switch(g.t){case"n":b+=g.v||0,g.f&&!g.F&&(b+=";E"+IS(g.f,{r:v,c:w}));break;case"b":b+=g.v?"TRUE":"FALSE";break;case"e":b+=g.w||g.v;break;case"d":b+='"'+(g.w||g.v)+'"';break;case"s":b+='"'+g.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return b}function d(g,y){y.forEach(function(v,w){var b="F;W"+(w+1)+" "+(w+1)+" ";v.hidden?b+="0":(typeof v.width=="number"&&!v.wpx&&(v.wpx=bp(v.width)),typeof v.wpx=="number"&&!v.wch&&(v.wch=Sp(v.wpx)),typeof v.wch=="number"&&(b+=Math.round(v.wch))),b.charAt(b.length-1)!=" "&&g.push(b)})}function f(g,y){y.forEach(function(v,w){var b="F;";v.hidden?b+="M0;":v.hpt?b+="M"+20*v.hpt+";":v.hpx&&(b+="M"+20*kp(v.hpx)+";"),b.length>2&&g.push(b+"R"+(w+1))})}function p(g,y){var v=["ID;PWXL;N;E"],w=[],b=sn(g["!ref"]),E,k=Array.isArray(g),_=`\r
`;v.push("P;PGeneral"),v.push("F;P0;DG0G8;M255"),g["!cols"]&&d(v,g["!cols"]),g["!rows"]&&f(v,g["!rows"]),v.push("B;Y"+(b.e.r-b.s.r+1)+";X"+(b.e.c-b.s.c+1)+";D"+[b.s.c,b.s.r,b.e.c,b.e.r].join(" "));for(var T=b.s.r;T<=b.e.r;++T)for(var j=b.s.c;j<=b.e.c;++j){var P=jr({r:T,c:j});E=k?(g[T]||[])[j]:g[P],!(!E||E.v==null&&(!E.f||E.F))&&w.push(c(E,g,T,j))}return v.join(_)+_+w.join(_)+_+"E"+_}return{to_workbook:l,to_sheet:i,from_sheet:p}})(),pF=(function(){function e(a,i){switch(i.type){case"base64":return t(Yi(a),i);case"binary":return t(a,i);case"buffer":return t(Gr&&Buffer.isBuffer(a)?a.toString("binary"):sd(a),i);case"array":return t(vf(a),i)}throw new Error("Unrecognized type "+i.type)}function t(a,i){for(var l=a.split(`
`),c=-1,d=-1,f=0,p=[];f!==l.length;++f){if(l[f].trim()==="BOT"){p[++c]=[],d=0;continue}if(!(c<0)){var g=l[f].trim().split(","),y=g[0],v=g[1];++f;for(var w=l[f]||"";(w.match(/["]/g)||[]).length&1&&f<l.length-1;)w+=`
`+l[++f];switch(w=w.trim(),+y){case-1:if(w==="BOT"){p[++c]=[],d=0;continue}else if(w!=="EOD")throw new Error("Unrecognized DIF special command "+w);break;case 0:w==="TRUE"?p[c][d]=!0:w==="FALSE"?p[c][d]=!1:isNaN(Qo(v))?isNaN(p0(v).getDate())?p[c][d]=v:p[c][d]=Un(v):p[c][d]=Qo(v),++d;break;case 1:w=w.slice(1,w.length-1),w=w.replace(/""/g,'"'),w&&w.match(/^=".*"$/)&&(w=w.slice(2,-1)),p[c][d++]=w!==""?w:null;break}if(w==="EOD")break}}return i&&i.sheetRows&&(p=p.slice(0,i.sheetRows)),p}function r(a,i){return L0(e(a,i),i)}function n(a,i){return ad(r(a,i),i)}var s=(function(){var a=function(c,d,f,p,g){c.push(d),c.push(f+","+p),c.push('"'+g.replace(/"/g,'""')+'"')},i=function(c,d,f,p){c.push(d+","+f),c.push(d==1?'"'+p.replace(/"/g,'""')+'"':p)};return function(c){var d=[],f=sn(c["!ref"]),p,g=Array.isArray(c);a(d,"TABLE",0,1,"sheetjs"),a(d,"VECTORS",0,f.e.r-f.s.r+1,""),a(d,"TUPLES",0,f.e.c-f.s.c+1,""),a(d,"DATA",0,0,"");for(var y=f.s.r;y<=f.e.r;++y){i(d,-1,0,"BOT");for(var v=f.s.c;v<=f.e.c;++v){var w=jr({r:y,c:v});if(p=g?(c[y]||[])[v]:c[w],!p){i(d,1,0,"");continue}switch(p.t){case"n":var b=p.w;!b&&p.v!=null&&(b=p.v),b==null?p.f&&!p.F?i(d,1,0,"="+p.f):i(d,1,0,""):i(d,0,b,"V");break;case"b":i(d,0,p.v?1:0,p.v?"TRUE":"FALSE");break;case"s":i(d,1,0,isNaN(p.v)?p.v:'="'+p.v+'"');break;case"d":p.w||(p.w=No(p.z||Cr[14],Ys(Un(p.v)))),i(d,0,p.w,"V");break;default:i(d,1,0,"")}}}i(d,-1,0,"EOD");var E=`\r
`,k=d.join(E);return k}})();return{to_workbook:n,to_sheet:r,from_sheet:s}})(),xF=(function(){function e(p){return p.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function t(p){return p.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function r(p,g){for(var y=p.split(`
`),v=-1,w=-1,b=0,E=[];b!==y.length;++b){var k=y[b].trim().split(":");if(k[0]==="cell"){var _=ts(k[1]);if(E.length<=_.r)for(v=E.length;v<=_.r;++v)E[v]||(E[v]=[]);switch(v=_.r,w=_.c,k[2]){case"t":E[v][w]=e(k[3]);break;case"v":E[v][w]=+k[3];break;case"vtf":var T=k[k.length-1];case"vtc":switch(k[3]){case"nl":E[v][w]=!!+k[4];break;default:E[v][w]=+k[4];break}k[2]=="vtf"&&(E[v][w]=[E[v][w],T])}}}return g&&g.sheetRows&&(E=E.slice(0,g.sheetRows)),E}function n(p,g){return L0(r(p,g),g)}function s(p,g){return ad(n(p,g),g)}var a=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),i=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,l=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),c="--SocialCalcSpreadsheetControlSave--";function d(p){if(!p||!p["!ref"])return"";for(var g=[],y=[],v,w="",b=Di(p["!ref"]),E=Array.isArray(p),k=b.s.r;k<=b.e.r;++k)for(var _=b.s.c;_<=b.e.c;++_)if(w=jr({r:k,c:_}),v=E?(p[k]||[])[_]:p[w],!(!v||v.v==null||v.t==="z")){switch(y=["cell",w,"t"],v.t){case"s":case"str":y.push(t(v.v));break;case"n":v.f?(y[2]="vtf",y[3]="n",y[4]=v.v,y[5]=t(v.f)):(y[2]="v",y[3]=v.v);break;case"b":y[2]="vt"+(v.f?"f":"c"),y[3]="nl",y[4]=v.v?"1":"0",y[5]=t(v.f||(v.v?"TRUE":"FALSE"));break;case"d":var T=Ys(Un(v.v));y[2]="vtc",y[3]="nd",y[4]=""+T,y[5]=v.w||No(v.z||Cr[14],T);break;case"e":continue}g.push(y.join(":"))}return g.push("sheet:c:"+(b.e.c-b.s.c+1)+":r:"+(b.e.r-b.s.r+1)+":tvf:1"),g.push("valueformat:1:text-wiki"),g.join(`
`)}function f(p){return[a,i,l,i,d(p),c].join(`
`)}return{to_workbook:s,to_sheet:n,from_sheet:f}})(),x0=(function(){function e(f,p,g,y,v){v.raw?p[g][y]=f:f===""||(f==="TRUE"?p[g][y]=!0:f==="FALSE"?p[g][y]=!1:isNaN(Qo(f))?isNaN(p0(f).getDate())?p[g][y]=f:p[g][y]=Un(f):p[g][y]=Qo(f))}function t(f,p){var g=p||{},y=[];if(!f||f.length===0)return y;for(var v=f.split(/[\r\n]/),w=v.length-1;w>=0&&v[w].length===0;)--w;for(var b=10,E=0,k=0;k<=w;++k)E=v[k].indexOf(" "),E==-1?E=v[k].length:E++,b=Math.max(b,E);for(k=0;k<=w;++k){y[k]=[];var _=0;for(e(v[k].slice(0,b).trim(),y,k,_,g),_=1;_<=(v[k].length-b)/10+1;++_)e(v[k].slice(b+(_-1)*10,b+_*10).trim(),y,k,_,g)}return g.sheetRows&&(y=y.slice(0,g.sheetRows)),y}var r={44:",",9:"	",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function s(f){for(var p={},g=!1,y=0,v=0;y<f.length;++y)(v=f.charCodeAt(y))==34?g=!g:!g&&v in r&&(p[v]=(p[v]||0)+1);v=[];for(y in p)Object.prototype.hasOwnProperty.call(p,y)&&v.push([p[y],y]);if(!v.length){p=n;for(y in p)Object.prototype.hasOwnProperty.call(p,y)&&v.push([p[y],y])}return v.sort(function(w,b){return w[0]-b[0]||n[w[1]]-n[b[1]]}),r[v.pop()[1]]||44}function a(f,p){var g=p||{},y="",v=g.dense?[]:{},w={s:{c:0,r:0},e:{c:0,r:0}};f.slice(0,4)=="sep="?f.charCodeAt(5)==13&&f.charCodeAt(6)==10?(y=f.charAt(4),f=f.slice(7)):f.charCodeAt(5)==13||f.charCodeAt(5)==10?(y=f.charAt(4),f=f.slice(6)):y=s(f.slice(0,1024)):g&&g.FS?y=g.FS:y=s(f.slice(0,1024));var b=0,E=0,k=0,_=0,T=0,j=y.charCodeAt(0),P=!1,R=0,N=f.charCodeAt(0);f=f.replace(/\r\n/mg,`
`);var A=g.dateNF!=null?EH(g.dateNF):null;function M(){var H=f.slice(_,T),Q={};if(H.charAt(0)=='"'&&H.charAt(H.length-1)=='"'&&(H=H.slice(1,-1).replace(/""/g,'"')),H.length===0)Q.t="z";else if(g.raw)Q.t="s",Q.v=H;else if(H.trim().length===0)Q.t="s",Q.v=H;else if(H.charCodeAt(0)==61)H.charCodeAt(1)==34&&H.charCodeAt(H.length-1)==34?(Q.t="s",Q.v=H.slice(2,-1).replace(/""/g,'"')):nY(H)?(Q.t="n",Q.f=H.slice(1)):(Q.t="s",Q.v=H);else if(H=="TRUE")Q.t="b",Q.v=!0;else if(H=="FALSE")Q.t="b",Q.v=!1;else if(!isNaN(k=Qo(H)))Q.t="n",g.cellText!==!1&&(Q.w=H),Q.v=k;else if(!isNaN(p0(H).getDate())||A&&H.match(A)){Q.z=g.dateNF||Cr[14];var Z=0;A&&H.match(A)&&(H=jH(H,g.dateNF,H.match(A)||[]),Z=1),g.cellDates?(Q.t="d",Q.v=Un(H,Z)):(Q.t="n",Q.v=Ys(Un(H,Z))),g.cellText!==!1&&(Q.w=No(Q.z,Q.v instanceof Date?Ys(Q.v):Q.v)),g.cellNF||delete Q.z}else Q.t="s",Q.v=H;if(Q.t=="z"||(g.dense?(v[b]||(v[b]=[]),v[b][E]=Q):v[jr({c:E,r:b})]=Q),_=T+1,N=f.charCodeAt(_),w.e.c<E&&(w.e.c=E),w.e.r<b&&(w.e.r=b),R==j)++E;else if(E=0,++b,g.sheetRows&&g.sheetRows<=b)return!0}e:for(;T<f.length;++T)switch(R=f.charCodeAt(T)){case 34:N===34&&(P=!P);break;case j:case 10:case 13:if(!P&&M())break e;break}return T-_>0&&M(),v["!ref"]=zr(w),v}function i(f,p){return!(p&&p.PRN)||p.FS||f.slice(0,4)=="sep="||f.indexOf("	")>=0||f.indexOf(",")>=0||f.indexOf(";")>=0?a(f,p):L0(t(f,p),p)}function l(f,p){var g="",y=p.type=="string"?[0,0,0,0]:zS(f,p);switch(p.type){case"base64":g=Yi(f);break;case"binary":g=f;break;case"buffer":p.codepage==65001?g=f.toString("utf8"):p.codepage&&typeof gp<"u"||(g=Gr&&Buffer.isBuffer(f)?f.toString("binary"):sd(f));break;case"array":g=vf(f);break;case"string":g=f;break;default:throw new Error("Unrecognized type "+p.type)}return y[0]==239&&y[1]==187&&y[2]==191?g=Nn(g.slice(3)):p.type!="string"&&p.type!="buffer"&&p.codepage==65001?g=Nn(g):p.type=="binary"&&typeof gp<"u",g.slice(0,19)=="socialcalc:version:"?xF.to_sheet(p.type=="string"?g:Nn(g),p):i(g,p)}function c(f,p){return ad(l(f,p),p)}function d(f){for(var p=[],g=sn(f["!ref"]),y,v=Array.isArray(f),w=g.s.r;w<=g.e.r;++w){for(var b=[],E=g.s.c;E<=g.e.c;++E){var k=jr({r:w,c:E});if(y=v?(f[w]||[])[E]:f[k],!y||y.v==null){b.push("          ");continue}for(var _=(y.w||(Mc(y),y.w)||"").slice(0,10);_.length<10;)_+=" ";b.push(_+(E===0?" ":""))}p.push(b.join(""))}return p.join(`
`)}return{to_workbook:c,to_sheet:l,from_sheet:d}})();function zK(e,t){var r=t||{},n=!!r.WTF;r.WTF=!0;try{var s=mF.to_workbook(e,r);return r.WTF=n,s}catch(a){if(r.WTF=n,!a.message.match(/SYLK bad record ID/)&&n)throw a;return x0.to_workbook(e,t)}}var tf=(function(){function e(O,W,q){if(O){Na(O,O.l||0);for(var Y=q.Enum||z;O.l<O.length;){var ee=O.read_shift(2),X=Y[ee]||Y[65535],ne=O.read_shift(2),ge=O.l+ne,_e=X.f&&X.f(O,ne,q);if(O.l=ge,W(_e,X,ee))return}}}function t(O,W){switch(W.type){case"base64":return r(Ki(Yi(O)),W);case"binary":return r(Ki(O),W);case"buffer":case"array":return r(O,W)}throw"Unsupported type "+W.type}function r(O,W){if(!O)return O;var q=W||{},Y=q.dense?[]:{},ee="Sheet1",X="",ne=0,ge={},_e=[],Pe=[],ce={s:{r:0,c:0},e:{r:0,c:0}},ye=q.sheetRows||0;if(O[2]==0&&(O[3]==8||O[3]==9)&&O.length>=16&&O[14]==5&&O[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(O[2]==2)q.Enum=z,e(O,function(He,It,Ze){switch(Ze){case 0:q.vers=He,He>=4096&&(q.qpro=!0);break;case 6:ce=He;break;case 204:He&&(X=He);break;case 222:X=He;break;case 15:case 51:q.qpro||(He[1].v=He[1].v.slice(1));case 13:case 14:case 16:Ze==14&&(He[2]&112)==112&&(He[2]&15)>1&&(He[2]&15)<15&&(He[1].z=q.dateNF||Cr[14],q.cellDates&&(He[1].t="d",He[1].v=ov(He[1].v))),q.qpro&&He[3]>ne&&(Y["!ref"]=zr(ce),ge[ee]=Y,_e.push(ee),Y=q.dense?[]:{},ce={s:{r:0,c:0},e:{r:0,c:0}},ne=He[3],ee=X||"Sheet"+(ne+1),X="");var Le=q.dense?(Y[He[0].r]||[])[He[0].c]:Y[jr(He[0])];if(Le){Le.t=He[1].t,Le.v=He[1].v,He[1].z!=null&&(Le.z=He[1].z),He[1].f!=null&&(Le.f=He[1].f);break}q.dense?(Y[He[0].r]||(Y[He[0].r]=[]),Y[He[0].r][He[0].c]=He[1]):Y[jr(He[0])]=He[1];break}},q);else if(O[2]==26||O[2]==14)q.Enum=V,O[2]==14&&(q.qpro=!0,O.l=0),e(O,function(He,It,Ze){switch(Ze){case 204:ee=He;break;case 22:He[1].v=He[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(He[3]>ne&&(Y["!ref"]=zr(ce),ge[ee]=Y,_e.push(ee),Y=q.dense?[]:{},ce={s:{r:0,c:0},e:{r:0,c:0}},ne=He[3],ee="Sheet"+(ne+1)),ye>0&&He[0].r>=ye)break;q.dense?(Y[He[0].r]||(Y[He[0].r]=[]),Y[He[0].r][He[0].c]=He[1]):Y[jr(He[0])]=He[1],ce.e.c<He[0].c&&(ce.e.c=He[0].c),ce.e.r<He[0].r&&(ce.e.r=He[0].r);break;case 27:He[14e3]&&(Pe[He[14e3][0]]=He[14e3][1]);break;case 1537:Pe[He[0]]=He[1],He[0]==ne&&(ee=He[1]);break}},q);else throw new Error("Unrecognized LOTUS BOF "+O[2]);if(Y["!ref"]=zr(ce),ge[X||ee]=Y,_e.push(X||ee),!Pe.length)return{SheetNames:_e,Sheets:ge};for(var Fe={},Me=[],Oe=0;Oe<Pe.length;++Oe)ge[_e[Oe]]?(Me.push(Pe[Oe]||_e[Oe]),Fe[Pe[Oe]]=ge[Pe[Oe]]||ge[_e[Oe]]):(Me.push(Pe[Oe]),Fe[Pe[Oe]]={"!ref":"A1"});return{SheetNames:Me,Sheets:Fe}}function n(O,W){var q=W||{};if(+q.codepage>=0&&Xo(+q.codepage),q.type=="string")throw new Error("Cannot write WK1 to JS string");var Y=Ri(),ee=sn(O["!ref"]),X=Array.isArray(O),ne=[];Kt(Y,0,a(1030)),Kt(Y,6,c(ee));for(var ge=Math.min(ee.e.r,8191),_e=ee.s.r;_e<=ge;++_e)for(var Pe=Ts(_e),ce=ee.s.c;ce<=ee.e.c;++ce){_e===ee.s.r&&(ne[ce]=es(ce));var ye=ne[ce]+Pe,Fe=X?(O[_e]||[])[ce]:O[ye];if(!(!Fe||Fe.t=="z"))if(Fe.t=="n")(Fe.v|0)==Fe.v&&Fe.v>=-32768&&Fe.v<=32767?Kt(Y,13,y(_e,ce,Fe.v)):Kt(Y,14,w(_e,ce,Fe.v));else{var Me=Mc(Fe);Kt(Y,15,p(_e,ce,Me.slice(0,239)))}}return Kt(Y,1),Y.end()}function s(O,W){var q=W||{};if(+q.codepage>=0&&Xo(+q.codepage),q.type=="string")throw new Error("Cannot write WK3 to JS string");var Y=Ri();Kt(Y,0,i(O));for(var ee=0,X=0;ee<O.SheetNames.length;++ee)(O.Sheets[O.SheetNames[ee]]||{})["!ref"]&&Kt(Y,27,I(O.SheetNames[ee],X++));var ne=0;for(ee=0;ee<O.SheetNames.length;++ee){var ge=O.Sheets[O.SheetNames[ee]];if(!(!ge||!ge["!ref"])){for(var _e=sn(ge["!ref"]),Pe=Array.isArray(ge),ce=[],ye=Math.min(_e.e.r,8191),Fe=_e.s.r;Fe<=ye;++Fe)for(var Me=Ts(Fe),Oe=_e.s.c;Oe<=_e.e.c;++Oe){Fe===_e.s.r&&(ce[Oe]=es(Oe));var He=ce[Oe]+Me,It=Pe?(ge[Fe]||[])[Oe]:ge[He];if(!(!It||It.t=="z"))if(It.t=="n")Kt(Y,23,M(Fe,Oe,ne,It.v));else{var Ze=Mc(It);Kt(Y,22,R(Fe,Oe,ne,Ze.slice(0,239)))}}++ne}}return Kt(Y,1),Y.end()}function a(O){var W=wt(2);return W.write_shift(2,O),W}function i(O){var W=wt(26);W.write_shift(2,4096),W.write_shift(2,4),W.write_shift(4,0);for(var q=0,Y=0,ee=0,X=0;X<O.SheetNames.length;++X){var ne=O.SheetNames[X],ge=O.Sheets[ne];if(!(!ge||!ge["!ref"])){++ee;var _e=Di(ge["!ref"]);q<_e.e.r&&(q=_e.e.r),Y<_e.e.c&&(Y=_e.e.c)}}return q>8191&&(q=8191),W.write_shift(2,q),W.write_shift(1,ee),W.write_shift(1,Y),W.write_shift(2,0),W.write_shift(2,0),W.write_shift(1,1),W.write_shift(1,2),W.write_shift(4,0),W.write_shift(4,0),W}function l(O,W,q){var Y={s:{c:0,r:0},e:{c:0,r:0}};return W==8&&q.qpro?(Y.s.c=O.read_shift(1),O.l++,Y.s.r=O.read_shift(2),Y.e.c=O.read_shift(1),O.l++,Y.e.r=O.read_shift(2),Y):(Y.s.c=O.read_shift(2),Y.s.r=O.read_shift(2),W==12&&q.qpro&&(O.l+=2),Y.e.c=O.read_shift(2),Y.e.r=O.read_shift(2),W==12&&q.qpro&&(O.l+=2),Y.s.c==65535&&(Y.s.c=Y.e.c=Y.s.r=Y.e.r=0),Y)}function c(O){var W=wt(8);return W.write_shift(2,O.s.c),W.write_shift(2,O.s.r),W.write_shift(2,O.e.c),W.write_shift(2,O.e.r),W}function d(O,W,q){var Y=[{c:0,r:0},{t:"n",v:0},0,0];return q.qpro&&q.vers!=20768?(Y[0].c=O.read_shift(1),Y[3]=O.read_shift(1),Y[0].r=O.read_shift(2),O.l+=2):(Y[2]=O.read_shift(1),Y[0].c=O.read_shift(2),Y[0].r=O.read_shift(2)),Y}function f(O,W,q){var Y=O.l+W,ee=d(O,W,q);if(ee[1].t="s",q.vers==20768){O.l++;var X=O.read_shift(1);return ee[1].v=O.read_shift(X,"utf8"),ee}return q.qpro&&O.l++,ee[1].v=O.read_shift(Y-O.l,"cstr"),ee}function p(O,W,q){var Y=wt(7+q.length);Y.write_shift(1,255),Y.write_shift(2,W),Y.write_shift(2,O),Y.write_shift(1,39);for(var ee=0;ee<Y.length;++ee){var X=q.charCodeAt(ee);Y.write_shift(1,X>=128?95:X)}return Y.write_shift(1,0),Y}function g(O,W,q){var Y=d(O,W,q);return Y[1].v=O.read_shift(2,"i"),Y}function y(O,W,q){var Y=wt(7);return Y.write_shift(1,255),Y.write_shift(2,W),Y.write_shift(2,O),Y.write_shift(2,q,"i"),Y}function v(O,W,q){var Y=d(O,W,q);return Y[1].v=O.read_shift(8,"f"),Y}function w(O,W,q){var Y=wt(13);return Y.write_shift(1,255),Y.write_shift(2,W),Y.write_shift(2,O),Y.write_shift(8,q,"f"),Y}function b(O,W,q){var Y=O.l+W,ee=d(O,W,q);if(ee[1].v=O.read_shift(8,"f"),q.qpro)O.l=Y;else{var X=O.read_shift(2);T(O.slice(O.l,O.l+X),ee),O.l+=X}return ee}function E(O,W,q){var Y=W&32768;return W&=-32769,W=(Y?O:0)+(W>=8192?W-16384:W),(Y?"":"$")+(q?es(W):Ts(W))}var k={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},_=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function T(O,W){Na(O,0);for(var q=[],Y=0,ee="",X="",ne="",ge="";O.l<O.length;){var _e=O[O.l++];switch(_e){case 0:q.push(O.read_shift(8,"f"));break;case 1:X=E(W[0].c,O.read_shift(2),!0),ee=E(W[0].r,O.read_shift(2),!1),q.push(X+ee);break;case 2:{var Pe=E(W[0].c,O.read_shift(2),!0),ce=E(W[0].r,O.read_shift(2),!1);X=E(W[0].c,O.read_shift(2),!0),ee=E(W[0].r,O.read_shift(2),!1),q.push(Pe+ce+":"+X+ee)}break;case 3:if(O.l<O.length){console.error("WK1 premature formula end");return}break;case 4:q.push("("+q.pop()+")");break;case 5:q.push(O.read_shift(2));break;case 6:{for(var ye="";_e=O[O.l++];)ye+=String.fromCharCode(_e);q.push('"'+ye.replace(/"/g,'""')+'"')}break;case 8:q.push("-"+q.pop());break;case 23:q.push("+"+q.pop());break;case 22:q.push("NOT("+q.pop()+")");break;case 20:case 21:ge=q.pop(),ne=q.pop(),q.push(["AND","OR"][_e-20]+"("+ne+","+ge+")");break;default:if(_e<32&&_[_e])ge=q.pop(),ne=q.pop(),q.push(ne+_[_e]+ge);else if(k[_e]){if(Y=k[_e][1],Y==69&&(Y=O[O.l++]),Y>q.length){console.error("WK1 bad formula parse 0x"+_e.toString(16)+":|"+q.join("|")+"|");return}var Fe=q.slice(-Y);q.length-=Y,q.push(k[_e][0]+"("+Fe.join(",")+")")}else return _e<=7?console.error("WK1 invalid opcode "+_e.toString(16)):_e<=24?console.error("WK1 unsupported op "+_e.toString(16)):_e<=30?console.error("WK1 invalid opcode "+_e.toString(16)):_e<=115?console.error("WK1 unsupported function opcode "+_e.toString(16)):console.error("WK1 unrecognized opcode "+_e.toString(16))}}q.length==1?W[1].f=""+q[0]:console.error("WK1 bad formula parse |"+q.join("|")+"|")}function j(O){var W=[{c:0,r:0},{t:"n",v:0},0];return W[0].r=O.read_shift(2),W[3]=O[O.l++],W[0].c=O[O.l++],W}function P(O,W){var q=j(O);return q[1].t="s",q[1].v=O.read_shift(W-4,"cstr"),q}function R(O,W,q,Y){var ee=wt(6+Y.length);ee.write_shift(2,O),ee.write_shift(1,q),ee.write_shift(1,W),ee.write_shift(1,39);for(var X=0;X<Y.length;++X){var ne=Y.charCodeAt(X);ee.write_shift(1,ne>=128?95:ne)}return ee.write_shift(1,0),ee}function N(O,W){var q=j(O);q[1].v=O.read_shift(2);var Y=q[1].v>>1;if(q[1].v&1)switch(Y&7){case 0:Y=(Y>>3)*5e3;break;case 1:Y=(Y>>3)*500;break;case 2:Y=(Y>>3)/20;break;case 3:Y=(Y>>3)/200;break;case 4:Y=(Y>>3)/2e3;break;case 5:Y=(Y>>3)/2e4;break;case 6:Y=(Y>>3)/16;break;case 7:Y=(Y>>3)/64;break}return q[1].v=Y,q}function A(O,W){var q=j(O),Y=O.read_shift(4),ee=O.read_shift(4),X=O.read_shift(2);if(X==65535)return Y===0&&ee===3221225472?(q[1].t="e",q[1].v=15):Y===0&&ee===3489660928?(q[1].t="e",q[1].v=42):q[1].v=0,q;var ne=X&32768;return X=(X&32767)-16446,q[1].v=(1-ne*2)*(ee*Math.pow(2,X+32)+Y*Math.pow(2,X)),q}function M(O,W,q,Y){var ee=wt(14);if(ee.write_shift(2,O),ee.write_shift(1,q),ee.write_shift(1,W),Y==0)return ee.write_shift(4,0),ee.write_shift(4,0),ee.write_shift(2,65535),ee;var X=0,ne=0,ge=0,_e=0;return Y<0&&(X=1,Y=-Y),ne=Math.log2(Y)|0,Y/=Math.pow(2,ne-31),_e=Y>>>0,(_e&2147483648)==0&&(Y/=2,++ne,_e=Y>>>0),Y-=_e,_e|=2147483648,_e>>>=0,Y*=Math.pow(2,32),ge=Y>>>0,ee.write_shift(4,ge),ee.write_shift(4,_e),ne+=16383+(X?32768:0),ee.write_shift(2,ne),ee}function H(O,W){var q=A(O);return O.l+=W-14,q}function Q(O,W){var q=j(O),Y=O.read_shift(4);return q[1].v=Y>>6,q}function Z(O,W){var q=j(O),Y=O.read_shift(8,"f");return q[1].v=Y,q}function ae(O,W){var q=Z(O);return O.l+=W-10,q}function te(O,W){return O[O.l+W-1]==0?O.read_shift(W,"cstr"):""}function se(O,W){var q=O[O.l++];q>W-1&&(q=W-1);for(var Y="";Y.length<q;)Y+=String.fromCharCode(O[O.l++]);return Y}function L(O,W,q){if(!(!q.qpro||W<21)){var Y=O.read_shift(1);O.l+=17,O.l+=1,O.l+=2;var ee=O.read_shift(W-21,"cstr");return[Y,ee]}}function G(O,W){for(var q={},Y=O.l+W;O.l<Y;){var ee=O.read_shift(2);if(ee==14e3){for(q[ee]=[0,""],q[ee][0]=O.read_shift(2);O[O.l];)q[ee][1]+=String.fromCharCode(O[O.l]),O.l++;O.l++}}return q}function I(O,W){var q=wt(5+O.length);q.write_shift(2,14e3),q.write_shift(2,W);for(var Y=0;Y<O.length;++Y){var ee=O.charCodeAt(Y);q[q.l++]=ee>127?95:ee}return q[q.l++]=0,q}var z={0:{n:"BOF",f:Ms},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:l},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:g},14:{n:"NUMBER",f:v},15:{n:"LABEL",f},16:{n:"FORMULA",f:b},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:te},222:{n:"SHEETNAMELP",f:se},65535:{n:""}},V={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:P},23:{n:"NUMBER17",f:A},24:{n:"NUMBER18",f:N},25:{n:"FORMULA19",f:H},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:G},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Q},38:{n:"??"},39:{n:"NUMBER27",f:Z},40:{n:"FORMULA28",f:ae},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:te},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:L},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:n,book_to_wk3:s,to_workbook:t}})();function HK(e){var t={},r=e.match(Ja),n=0,s=!1;if(r)for(;n!=r.length;++n){var a=Fr(r[n]);switch(a[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!a.val)break;case"<shadow>":case"<shadow/>":t.shadow=1;break;case"</shadow>":break;case"<charset":if(a.val=="1")break;t.cp=iS[parseInt(a.val,10)];break;case"<outline":if(!a.val)break;case"<outline>":case"<outline/>":t.outline=1;break;case"</outline>":break;case"<rFont":t.name=a.val;break;case"<sz":t.sz=a.val;break;case"<strike":if(!a.val)break;case"<strike>":case"<strike/>":t.strike=1;break;case"</strike>":break;case"<u":if(!a.val)break;switch(a.val){case"double":t.uval="double";break;case"singleAccounting":t.uval="single-accounting";break;case"doubleAccounting":t.uval="double-accounting";break}case"<u>":case"<u/>":t.u=1;break;case"</u>":break;case"<b":if(a.val=="0")break;case"<b>":case"<b/>":t.b=1;break;case"</b>":break;case"<i":if(a.val=="0")break;case"<i>":case"<i/>":t.i=1;break;case"</i>":break;case"<color":a.rgb&&(t.color=a.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":t.family=a.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":t.valign=a.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(a[0].charCodeAt(1)!==47&&!s)throw new Error("Unrecognized rich format "+a[0])}}return t}var GK=(function(){var e=xp("t"),t=xp("rPr");function r(a){var i=a.match(e);if(!i)return{t:"s",v:""};var l={t:"s",v:nn(i[1])},c=a.match(t);return c&&(l.s=HK(c[1])),l}var n=/<(?:\w+:)?r>/g,s=/<\/(?:\w+:)?r>/;return function(i){return i.replace(n,"").split(s).map(r).filter(function(l){return l.v})}})(),VK=(function(){var t=/(\r\n|\n)/g;function r(s,a,i){var l=[];s.u&&l.push("text-decoration: underline;"),s.uval&&l.push("text-underline-style:"+s.uval+";"),s.sz&&l.push("font-size:"+s.sz+"pt;"),s.outline&&l.push("text-effect: outline;"),s.shadow&&l.push("text-shadow: auto;"),a.push('<span style="'+l.join("")+'">'),s.b&&(a.push("<b>"),i.push("</b>")),s.i&&(a.push("<i>"),i.push("</i>")),s.strike&&(a.push("<s>"),i.push("</s>"));var c=s.valign||"";return c=="superscript"||c=="super"?c="sup":c=="subscript"&&(c="sub"),c!=""&&(a.push("<"+c+">"),i.push("</"+c+">")),i.push("</span>"),s}function n(s){var a=[[],s.v,[]];return s.v?(s.s&&r(s.s,a[0],a[2]),a[0].join("")+a[1].replace(t,"<br/>")+a[2].join("")):""}return function(a){return a.map(n).join("")}})(),KK=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,qK=/<(?:\w+:)?r>/,XK=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function AS(e,t){var r=t?t.cellHTML:!0,n={};return e?(e.match(/^\s*<(?:\w+:)?t[^>]*>/)?(n.t=nn(Nn(e.slice(e.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),n.r=Nn(e),r&&(n.h=pS(n.t))):e.match(qK)&&(n.r=Nn(e),n.t=nn(Nn((e.replace(XK,"").match(KK)||[]).join("").replace(Ja,""))),r&&(n.h=VK(GK(n.r)))),n):{t:""}}var YK=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,JK=/<(?:\w+:)?(?:si|sstItem)>/g,QK=/<\/(?:\w+:)?(?:si|sstItem)>/;function ZK(e,t){var r=[],n="";if(!e)return r;var s=e.match(YK);if(s){n=s[2].replace(JK,"").split(QK);for(var a=0;a!=n.length;++a){var i=AS(n[a].trim(),t);i!=null&&(r[r.length]=i)}s=Fr(s[1]),r.Count=s.count,r.Unique=s.uniqueCount}return r}var eq=/^\s|\s$|[\t\n\r]/;function yF(e,t){if(!t.bookSST)return"";var r=[Es];r[r.length]=Gt("sst",null,{xmlns:Nf[0],count:e.Count,uniqueCount:e.Unique});for(var n=0;n!=e.length;++n)if(e[n]!=null){var s=e[n],a="<si>";s.r?a+=s.r:(a+="<t",s.t||(s.t=""),s.t.match(eq)&&(a+=' xml:space="preserve"'),a+=">"+bn(s.t)+"</t>"),a+="</si>",r[r.length]=a}return r.length>2&&(r[r.length]="</sst>",r[1]=r[1].replace("/>",">")),r.join("")}function tq(e){return[e.read_shift(4),e.read_shift(4)]}function rq(e,t){var r=[],n=!1;return Uc(e,function(a,i,l){switch(l){case 159:r.Count=a[0],r.Unique=a[1];break;case 19:r.push(a);break;case 160:return!0;case 35:n=!0;break;case 36:n=!1;break;default:if(i.T,!n||t.WTF)throw new Error("Unexpected record 0x"+l.toString(16))}}),r}function nq(e,t){return t||(t=wt(8)),t.write_shift(4,e.Count),t.write_shift(4,e.Unique),t}var sq=gG;function aq(e){var t=Ri();Nt(t,159,nq(e));for(var r=0;r<e.length;++r)Nt(t,19,sq(e[r]));return Nt(t,160),t.end()}function vF(e){for(var t=[],r=e.split(""),n=0;n<r.length;++n)t[n]=r[n].charCodeAt(0);return t}function Ac(e,t){var r={};return r.Major=e.read_shift(2),r.Minor=e.read_shift(2),t>=4&&(e.l+=t-4),r}function iq(e){var t={};return t.id=e.read_shift(0,"lpp4"),t.R=Ac(e,4),t.U=Ac(e,4),t.W=Ac(e,4),t}function oq(e){for(var t=e.read_shift(4),r=e.l+t-4,n={},s=e.read_shift(4),a=[];s-- >0;)a.push({t:e.read_shift(4),v:e.read_shift(0,"lpp4")});if(n.name=e.read_shift(0,"lpp4"),n.comps=a,e.l!=r)throw new Error("Bad DataSpaceMapEntry: "+e.l+" != "+r);return n}function lq(e){var t=[];e.l+=4;for(var r=e.read_shift(4);r-- >0;)t.push(oq(e));return t}function cq(e){var t=[];e.l+=4;for(var r=e.read_shift(4);r-- >0;)t.push(e.read_shift(0,"lpp4"));return t}function uq(e){var t={};return e.read_shift(4),e.l+=4,t.id=e.read_shift(0,"lpp4"),t.name=e.read_shift(0,"lpp4"),t.R=Ac(e,4),t.U=Ac(e,4),t.W=Ac(e,4),t}function dq(e){var t=uq(e);if(t.ename=e.read_shift(0,"8lpp4"),t.blksz=e.read_shift(4),t.cmode=e.read_shift(4),e.read_shift(4)!=4)throw new Error("Bad !Primary record");return t}function wF(e,t){var r=e.l+t,n={};n.Flags=e.read_shift(4)&63,e.l+=4,n.AlgID=e.read_shift(4);var s=!1;switch(n.AlgID){case 26126:case 26127:case 26128:s=n.Flags==36;break;case 26625:s=n.Flags==4;break;case 0:s=n.Flags==16||n.Flags==4||n.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+n.AlgID}if(!s)throw new Error("Encryption Flags/AlgID mismatch");return n.AlgIDHash=e.read_shift(4),n.KeySize=e.read_shift(4),n.ProviderType=e.read_shift(4),e.l+=8,n.CSPName=e.read_shift(r-e.l>>1,"utf16le"),e.l=r,n}function _F(e,t){var r={},n=e.l+t;return e.l+=4,r.Salt=e.slice(e.l,e.l+16),e.l+=16,r.Verifier=e.slice(e.l,e.l+16),e.l+=16,e.read_shift(4),r.VerifierHash=e.slice(e.l,n),e.l=n,r}function fq(e){var t=Ac(e);switch(t.Minor){case 2:return[t.Minor,hq(e)];case 3:return[t.Minor,gq()];case 4:return[t.Minor,mq(e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+t.Minor)}function hq(e){var t=e.read_shift(4);if((t&63)!=36)throw new Error("EncryptionInfo mismatch");var r=e.read_shift(4),n=wF(e,r),s=_F(e,e.length-e.l);return{t:"Std",h:n,v:s}}function gq(){throw new Error("File is password-protected: ECMA-376 Extensible")}function mq(e){var t=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];e.l+=4;var r=e.read_shift(e.length-e.l,"utf8"),n={};return r.replace(Ja,function(a){var i=Fr(a);switch(zl(i[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":t.forEach(function(l){n[l]=i[l]});break;case"<dataIntegrity":n.encryptedHmacKey=i.encryptedHmacKey,n.encryptedHmacValue=i.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":n.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":n.uri=i.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":n.encs.push(i);break;default:throw i[0]}}),n}function pq(e,t){var r={},n=r.EncryptionVersionInfo=Ac(e,4);if(t-=4,n.Minor!=2)throw new Error("unrecognized minor version code: "+n.Minor);if(n.Major>4||n.Major<2)throw new Error("unrecognized major version code: "+n.Major);r.Flags=e.read_shift(4),t-=4;var s=e.read_shift(4);return t-=4,r.EncryptionHeader=wF(e,s),t-=s,r.EncryptionVerifier=_F(e,t),r}function xq(e){var t={},r=t.EncryptionVersionInfo=Ac(e,4);if(r.Major!=1||r.Minor!=1)throw"unrecognized version code "+r.Major+" : "+r.Minor;return t.Salt=e.read_shift(16),t.EncryptedVerifier=e.read_shift(16),t.EncryptedVerifierHash=e.read_shift(16),t}function FS(e){var t=0,r,n=vF(e),s=n.length+1,a,i,l,c,d;for(r=Ku(s),r[0]=n.length,a=1;a!=s;++a)r[a]=n[a-1];for(a=s-1;a>=0;--a)i=r[a],l=(t&16384)===0?0:1,c=t<<1&32767,d=l|c,t=d^i;return t^52811}var bF=(function(){var e=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],t=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],r=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],n=function(i){return(i/2|i*128)&255},s=function(i,l){return n(i^l)},a=function(i){for(var l=t[i.length-1],c=104,d=i.length-1;d>=0;--d)for(var f=i[d],p=0;p!=7;++p)f&64&&(l^=r[c]),f*=2,--c;return l};return function(i){for(var l=vF(i),c=a(l),d=l.length,f=Ku(16),p=0;p!=16;++p)f[p]=0;var g,y,v;for((d&1)===1&&(g=c>>8,f[d]=s(e[0],g),--d,g=c&255,y=l[l.length-1],f[d]=s(y,g));d>0;)--d,g=c>>8,f[d]=s(l[d],g),--d,g=c&255,f[d]=s(l[d],g);for(d=15,v=15-l.length;v>0;)g=c>>8,f[d]=s(e[v],g),--d,--v,g=c&255,f[d]=s(l[d],g),--d,--v;return f}})(),yq=function(e,t,r,n,s){s||(s=t),n||(n=bF(e));var a,i;for(a=0;a!=t.length;++a)i=t[a],i^=n[r],i=(i>>5|i<<3)&255,s[a]=i,++r;return[s,r,n]},vq=function(e){var t=0,r=bF(e);return function(n){var s=yq("",n,t,r);return t=s[1],s[0]}};function wq(e,t,r,n){var s={key:Ms(e),verificationBytes:Ms(e)};return r.password&&(s.verifier=FS(r.password)),n.valid=s.verificationBytes===s.verifier,n.valid&&(n.insitu=vq(r.password)),s}function _q(e,t,r){var n=r||{};return n.Info=e.read_shift(2),e.l-=2,n.Info===1?n.Data=xq(e):n.Data=pq(e,t),n}function bq(e,t,r){var n={Type:r.biff>=8?e.read_shift(2):0};return n.Type?_q(e,t-2,n):wq(e,r.biff>=8?t:t-2,r,n),n}var SF=(function(){function e(s,a){switch(a.type){case"base64":return t(Yi(s),a);case"binary":return t(s,a);case"buffer":return t(Gr&&Buffer.isBuffer(s)?s.toString("binary"):sd(s),a);case"array":return t(vf(s),a)}throw new Error("Unrecognized type "+a.type)}function t(s,a){var i=a||{},l=i.dense?[]:{},c=s.match(/\\trowd.*?\\row\b/g);if(!c.length)throw new Error("RTF missing table");var d={s:{c:0,r:0},e:{c:0,r:c.length-1}};return c.forEach(function(f,p){Array.isArray(l)&&(l[p]=[]);for(var g=/\\\w+\b/g,y=0,v,w=-1;v=g.exec(f);){switch(v[0]){case"\\cell":var b=f.slice(y,g.lastIndex-v[0].length);if(b[0]==" "&&(b=b.slice(1)),++w,b.length){var E={v:b,t:"s"};Array.isArray(l)?l[p][w]=E:l[jr({r:p,c:w})]=E}break}y=g.lastIndex}w>d.e.c&&(d.e.c=w)}),l["!ref"]=zr(d),l}function r(s,a){return ad(e(s,a),a)}function n(s){for(var a=["{\\rtf1\\ansi"],i=sn(s["!ref"]),l,c=Array.isArray(s),d=i.s.r;d<=i.e.r;++d){a.push("\\trowd\\trautofit1");for(var f=i.s.c;f<=i.e.c;++f)a.push("\\cellx"+(f+1));for(a.push("\\pard\\intbl"),f=i.s.c;f<=i.e.c;++f){var p=jr({r:d,c:f});l=c?(s[d]||[])[f]:s[p],!(!l||l.v==null&&(!l.f||l.F))&&(a.push(" "+(l.w||(Mc(l),l.w))),a.push("\\cell"))}a.push("\\pard\\intbl\\row")}return a.join("")+"}"}return{to_workbook:r,to_sheet:e,from_sheet:n}})();function Sq(e){var t=e.slice(e[0]==="#"?1:0).slice(0,6);return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function _p(e){for(var t=0,r=1;t!=3;++t)r=r*256+(e[t]>255?255:e[t]<0?0:e[t]);return r.toString(16).toUpperCase().slice(1)}function kq(e){var t=e[0]/255,r=e[1]/255,n=e[2]/255,s=Math.max(t,r,n),a=Math.min(t,r,n),i=s-a;if(i===0)return[0,0,t];var l=0,c=0,d=s+a;switch(c=i/(d>1?2-d:d),s){case t:l=((r-n)/i+6)%6;break;case r:l=(n-t)/i+2;break;case n:l=(t-r)/i+4;break}return[l/6,c,d/2]}function Cq(e){var t=e[0],r=e[1],n=e[2],s=r*2*(n<.5?n:1-n),a=n-s/2,i=[a,a,a],l=6*t,c;if(r!==0)switch(l|0){case 0:case 6:c=s*l,i[0]+=s,i[1]+=c;break;case 1:c=s*(2-l),i[0]+=c,i[1]+=s;break;case 2:c=s*(l-2),i[1]+=s,i[2]+=c;break;case 3:c=s*(4-l),i[1]+=c,i[2]+=s;break;case 4:c=s*(l-4),i[2]+=s,i[0]+=c;break;case 5:c=s*(6-l),i[2]+=c,i[0]+=s;break}for(var d=0;d!=3;++d)i[d]=Math.round(i[d]*255);return i}function C1(e,t){if(t===0)return e;var r=kq(Sq(e));return t<0?r[2]=r[2]*(1+t):r[2]=1-(1-r[2])*(1-t),_p(Cq(r))}var kF=6,Tq=15,Nq=1,za=kF;function bp(e){return Math.floor((e+Math.round(128/za)/256)*za)}function Sp(e){return Math.floor((e-5)/za*100+.5)/100}function T1(e){return Math.round((e*za+5)/za*256)/256}function Kw(e){return T1(Sp(bp(e)))}function PS(e){var t=Math.abs(e-Kw(e)),r=za;if(t>.005)for(za=Nq;za<Tq;++za)Math.abs(e-Kw(e))<=t&&(t=Math.abs(e-Kw(e)),r=za);za=r}function qu(e){e.width?(e.wpx=bp(e.width),e.wch=Sp(e.wpx),e.MDW=za):e.wpx?(e.wch=Sp(e.wpx),e.width=T1(e.wch),e.MDW=za):typeof e.wch=="number"&&(e.width=T1(e.wch),e.wpx=bp(e.width),e.MDW=za),e.customWidth&&delete e.customWidth}var Eq=96,CF=Eq;function kp(e){return e*96/CF}function y0(e){return e*CF/96}var jq={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function Aq(e,t,r,n){t.Borders=[];var s={},a=!1;(e[0].match(Ja)||[]).forEach(function(i){var l=Fr(i);switch(zl(l[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":s={},l.diagonalUp&&(s.diagonalUp=On(l.diagonalUp)),l.diagonalDown&&(s.diagonalDown=On(l.diagonalDown)),t.Borders.push(s);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(n&&n.WTF&&!a)throw new Error("unrecognized "+l[0]+" in borders")}})}function Fq(e,t,r,n){t.Fills=[];var s={},a=!1;(e[0].match(Ja)||[]).forEach(function(i){var l=Fr(i);switch(zl(l[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":s={},t.Fills.push(s);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":t.Fills.push(s),s={};break;case"<patternFill":case"<patternFill>":l.patternType&&(s.patternType=l.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":s.bgColor||(s.bgColor={}),l.indexed&&(s.bgColor.indexed=parseInt(l.indexed,10)),l.theme&&(s.bgColor.theme=parseInt(l.theme,10)),l.tint&&(s.bgColor.tint=parseFloat(l.tint)),l.rgb&&(s.bgColor.rgb=l.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":s.fgColor||(s.fgColor={}),l.theme&&(s.fgColor.theme=parseInt(l.theme,10)),l.tint&&(s.fgColor.tint=parseFloat(l.tint)),l.rgb!=null&&(s.fgColor.rgb=l.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(n&&n.WTF&&!a)throw new Error("unrecognized "+l[0]+" in fills")}})}function Pq(e,t,r,n){t.Fonts=[];var s={},a=!1;(e[0].match(Ja)||[]).forEach(function(i){var l=Fr(i);switch(zl(l[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":t.Fonts.push(s),s={};break;case"<name":l.val&&(s.name=Nn(l.val));break;case"<name/>":case"</name>":break;case"<b":s.bold=l.val?On(l.val):1;break;case"<b/>":s.bold=1;break;case"<i":s.italic=l.val?On(l.val):1;break;case"<i/>":s.italic=1;break;case"<u":switch(l.val){case"none":s.underline=0;break;case"single":s.underline=1;break;case"double":s.underline=2;break;case"singleAccounting":s.underline=33;break;case"doubleAccounting":s.underline=34;break}break;case"<u/>":s.underline=1;break;case"<strike":s.strike=l.val?On(l.val):1;break;case"<strike/>":s.strike=1;break;case"<outline":s.outline=l.val?On(l.val):1;break;case"<outline/>":s.outline=1;break;case"<shadow":s.shadow=l.val?On(l.val):1;break;case"<shadow/>":s.shadow=1;break;case"<condense":s.condense=l.val?On(l.val):1;break;case"<condense/>":s.condense=1;break;case"<extend":s.extend=l.val?On(l.val):1;break;case"<extend/>":s.extend=1;break;case"<sz":l.val&&(s.sz=+l.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":l.val&&(s.vertAlign=l.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":l.val&&(s.family=parseInt(l.val,10));break;case"<family/>":case"</family>":break;case"<scheme":l.val&&(s.scheme=l.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(l.val=="1")break;l.codepage=iS[parseInt(l.val,10)];break;case"<color":if(s.color||(s.color={}),l.auto&&(s.color.auto=On(l.auto)),l.rgb)s.color.rgb=l.rgb.slice(-6);else if(l.indexed){s.color.index=parseInt(l.indexed,10);var c=Zd[s.color.index];s.color.index==81&&(c=Zd[1]),c||(c=Zd[1]),s.color.rgb=c[0].toString(16)+c[1].toString(16)+c[2].toString(16)}else l.theme&&(s.color.theme=parseInt(l.theme,10),l.tint&&(s.color.tint=parseFloat(l.tint)),l.theme&&r.themeElements&&r.themeElements.clrScheme&&(s.color.rgb=C1(r.themeElements.clrScheme[s.color.theme].rgb,s.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":a=!0;break;case"</AlternateContent>":a=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(n&&n.WTF&&!a)throw new Error("unrecognized "+l[0]+" in fonts")}})}function Rq(e,t,r){t.NumberFmt=[];for(var n=ms(Cr),s=0;s<n.length;++s)t.NumberFmt[n[s]]=Cr[n[s]];var a=e[0].match(Ja);if(a)for(s=0;s<a.length;++s){var i=Fr(a[s]);switch(zl(i[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var l=nn(Nn(i.formatCode)),c=parseInt(i.numFmtId,10);if(t.NumberFmt[c]=l,c>0){if(c>392){for(c=392;c>60&&t.NumberFmt[c]!=null;--c);t.NumberFmt[c]=l}jc(l,c)}}break;case"</numFmt>":break;default:if(r.WTF)throw new Error("unrecognized "+i[0]+" in numFmts")}}}function Dq(e){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var n=r[0];n<=r[1];++n)e[n]!=null&&(t[t.length]=Gt("numFmt",null,{numFmtId:n,formatCode:bn(e[n])}))}),t.length===1?"":(t[t.length]="</numFmts>",t[0]=Gt("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}var Ty=["numFmtId","fillId","fontId","borderId","xfId"],Ny=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function Iq(e,t,r){t.CellXf=[];var n,s=!1;(e[0].match(Ja)||[]).forEach(function(a){var i=Fr(a),l=0;switch(zl(i[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(n=i,delete n[0],l=0;l<Ty.length;++l)n[Ty[l]]&&(n[Ty[l]]=parseInt(n[Ty[l]],10));for(l=0;l<Ny.length;++l)n[Ny[l]]&&(n[Ny[l]]=On(n[Ny[l]]));if(t.NumberFmt&&n.numFmtId>392){for(l=392;l>60;--l)if(t.NumberFmt[n.numFmtId]==t.NumberFmt[l]){n.numFmtId=l;break}}t.CellXf.push(n);break;case"</xf>":break;case"<alignment":case"<alignment/>":var c={};i.vertical&&(c.vertical=i.vertical),i.horizontal&&(c.horizontal=i.horizontal),i.textRotation!=null&&(c.textRotation=i.textRotation),i.indent&&(c.indent=i.indent),i.wrapText&&(c.wrapText=On(i.wrapText)),n.alignment=c;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":s=!0;break;case"</AlternateContent>":s=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(r&&r.WTF&&!s)throw new Error("unrecognized "+i[0]+" in cellXfs")}})}function Mq(e){var t=[];return t[t.length]=Gt("cellXfs",null),e.forEach(function(r){t[t.length]=Gt("xf",null,r)}),t[t.length]="</cellXfs>",t.length===2?"":(t[0]=Gt("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}var Oq=(function(){var t=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,r=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,n=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,s=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,a=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(l,c,d){var f={};if(!l)return f;l=l.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var p;return(p=l.match(t))&&Rq(p,f,d),(p=l.match(s))&&Pq(p,f,c,d),(p=l.match(n))&&Fq(p,f,c,d),(p=l.match(a))&&Aq(p,f,c,d),(p=l.match(r))&&Iq(p,f,d),f}})();function TF(e,t){var r=[Es,Gt("styleSheet",null,{xmlns:Nf[0],"xmlns:vt":qs.vt})],n;return e.SSF&&(n=Dq(e.SSF))!=null&&(r[r.length]=n),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(n=Mq(t.cellXfs))&&(r[r.length]=n),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function Lq(e,t){var r=e.read_shift(2),n=qa(e);return[r,n]}function Bq(e,t,r){r||(r=wt(6+4*t.length)),r.write_shift(2,e),ua(t,r);var n=r.length>r.l?r.slice(0,r.l):r;return r.l==null&&(r.l=r.length),n}function Uq(e,t,r){var n={};n.sz=e.read_shift(2)/20;var s=_G(e);s.fItalic&&(n.italic=1),s.fCondense&&(n.condense=1),s.fExtend&&(n.extend=1),s.fShadow&&(n.shadow=1),s.fOutline&&(n.outline=1),s.fStrikeout&&(n.strike=1);var a=e.read_shift(2);switch(a===700&&(n.bold=1),e.read_shift(2)){case 1:n.vertAlign="superscript";break;case 2:n.vertAlign="subscript";break}var i=e.read_shift(1);i!=0&&(n.underline=i);var l=e.read_shift(1);l>0&&(n.family=l);var c=e.read_shift(1);switch(c>0&&(n.charset=c),e.l++,n.color=wG(e),e.read_shift(1)){case 1:n.scheme="major";break;case 2:n.scheme="minor";break}return n.name=qa(e),n}function $q(e,t){t||(t=wt(153)),t.write_shift(2,e.sz*20),bG(e,t),t.write_shift(2,e.bold?700:400);var r=0;e.vertAlign=="superscript"?r=1:e.vertAlign=="subscript"&&(r=2),t.write_shift(2,r),t.write_shift(1,e.underline||0),t.write_shift(1,e.family||0),t.write_shift(1,e.charset||0),t.write_shift(1,0),b1(e.color,t);var n=0;return n=2,t.write_shift(1,n),ua(e.name,t),t.length>t.l?t.slice(0,t.l):t}var Wq=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],qw,zq=Ya;function l3(e,t){t||(t=wt(84)),qw||(qw=av(Wq));var r=qw[e.patternType];r==null&&(r=40),t.write_shift(4,r);var n=0;if(r!=40)for(b1({auto:1},t),b1({auto:1},t);n<12;++n)t.write_shift(4,0);else{for(;n<4;++n)t.write_shift(4,0);for(;n<12;++n)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function Hq(e,t){var r=e.l+t,n=e.read_shift(2),s=e.read_shift(2);return e.l=r,{ixfe:n,numFmtId:s}}function NF(e,t,r){r||(r=wt(16)),r.write_shift(2,t||0),r.write_shift(2,e.numFmtId||0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);var n=0;return r.write_shift(1,n),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r}function Cm(e,t){return t||(t=wt(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var Gq=Ya;function Vq(e,t){return t||(t=wt(51)),t.write_shift(1,0),Cm(null,t),Cm(null,t),Cm(null,t),Cm(null,t),Cm(null,t),t.length>t.l?t.slice(0,t.l):t}function Kq(e,t){return t||(t=wt(52)),t.write_shift(4,e.xfId),t.write_shift(2,1),t.write_shift(1,0),t.write_shift(1,0),_1(e.name||"",t),t.length>t.l?t.slice(0,t.l):t}function qq(e,t,r){var n=wt(2052);return n.write_shift(4,e),_1(t,n),_1(r,n),n.length>n.l?n.slice(0,n.l):n}function Xq(e,t,r){var n={};n.NumberFmt=[];for(var s in Cr)n.NumberFmt[s]=Cr[s];n.CellXf=[],n.Fonts=[];var a=[],i=!1;return Uc(e,function(c,d,f){switch(f){case 44:n.NumberFmt[c[0]]=c[1],jc(c[1],c[0]);break;case 43:n.Fonts.push(c),c.color.theme!=null&&t&&t.themeElements&&t.themeElements.clrScheme&&(c.color.rgb=C1(t.themeElements.clrScheme[c.color.theme].rgb,c.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:a[a.length-1]==617&&n.CellXf.push(c);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:i=!0;break;case 36:i=!1;break;case 37:a.push(f),i=!0;break;case 38:a.pop(),i=!1;break;default:if(d.T>0)a.push(f);else if(d.T<0)a.pop();else if(!i||r.WTF&&a[a.length-1]!=37)throw new Error("Unexpected record 0x"+f.toString(16))}}),n}function Yq(e,t){if(t){var r=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)t[s]!=null&&++r}),r!=0&&(Nt(e,615,Zo(r)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)t[s]!=null&&Nt(e,44,Bq(s,t[s]))}),Nt(e,616))}}function Jq(e){var t=1;Nt(e,611,Zo(t)),Nt(e,43,$q({sz:12,color:{theme:1},name:"Calibri",family:2})),Nt(e,612)}function Qq(e){var t=2;Nt(e,603,Zo(t)),Nt(e,45,l3({patternType:"none"})),Nt(e,45,l3({patternType:"gray125"})),Nt(e,604)}function Zq(e){var t=1;Nt(e,613,Zo(t)),Nt(e,46,Vq()),Nt(e,614)}function eX(e){var t=1;Nt(e,626,Zo(t)),Nt(e,47,NF({numFmtId:0},65535)),Nt(e,627)}function tX(e,t){Nt(e,617,Zo(t.length)),t.forEach(function(r){Nt(e,47,NF(r,0))}),Nt(e,618)}function rX(e){var t=1;Nt(e,619,Zo(t)),Nt(e,48,Kq({xfId:0,name:"Normal"})),Nt(e,620)}function nX(e){var t=0;Nt(e,505,Zo(t)),Nt(e,506)}function sX(e){var t=0;Nt(e,508,qq(t,"TableStyleMedium9","PivotStyleMedium4")),Nt(e,509)}function aX(e,t){var r=Ri();return Nt(r,278),Yq(r,e.SSF),Jq(r),Qq(r),Zq(r),eX(r),tX(r,t.cellXfs),rX(r),nX(r),sX(r),Nt(r,279),r.end()}var iX=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function oX(e,t,r){t.themeElements.clrScheme=[];var n={};(e[0].match(Ja)||[]).forEach(function(s){var a=Fr(s);switch(a[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":n.rgb=a.val;break;case"<a:sysClr":n.rgb=a.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":a[0].charAt(1)==="/"?(t.themeElements.clrScheme[iX.indexOf(a[0])]=n,n={}):n.name=a[0].slice(3,a[0].length-1);break;default:if(r&&r.WTF)throw new Error("Unrecognized "+a[0]+" in clrScheme")}})}function lX(){}function cX(){}var uX=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,dX=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,fX=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function hX(e,t,r){t.themeElements={};var n;[["clrScheme",uX,oX],["fontScheme",dX,lX],["fmtScheme",fX,cX]].forEach(function(s){if(!(n=e.match(s[1])))throw new Error(s[0]+" not found in themeElements");s[2](n,t,r)})}var gX=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function EF(e,t){(!e||e.length===0)&&(e=RS());var r,n={};if(!(r=e.match(gX)))throw new Error("themeElements not found in theme");return hX(r[0],n,t),n.raw=e,n}function RS(e,t){if(t&&t.themeXLSX)return t.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var r=[Es];return r[r.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',r[r.length]="<a:themeElements>",r[r.length]='<a:clrScheme name="Office">',r[r.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',r[r.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',r[r.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',r[r.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',r[r.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',r[r.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',r[r.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',r[r.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',r[r.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',r[r.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',r[r.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',r[r.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',r[r.length]="</a:clrScheme>",r[r.length]='<a:fontScheme name="Office">',r[r.length]="<a:majorFont>",r[r.length]='<a:latin typeface="Cambria"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',r[r.length]='<a:font script="Hang" typeface="맑은 고딕"/>',r[r.length]='<a:font script="Hans" typeface="宋体"/>',r[r.length]='<a:font script="Hant" typeface="新細明體"/>',r[r.length]='<a:font script="Arab" typeface="Times New Roman"/>',r[r.length]='<a:font script="Hebr" typeface="Times New Roman"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="MoolBoran"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Times New Roman"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:majorFont>",r[r.length]="<a:minorFont>",r[r.length]='<a:latin typeface="Calibri"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',r[r.length]='<a:font script="Hang" typeface="맑은 고딕"/>',r[r.length]='<a:font script="Hans" typeface="宋体"/>',r[r.length]='<a:font script="Hant" typeface="新細明體"/>',r[r.length]='<a:font script="Arab" typeface="Arial"/>',r[r.length]='<a:font script="Hebr" typeface="Arial"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="DaunPenh"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Arial"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:minorFont>",r[r.length]="</a:fontScheme>",r[r.length]='<a:fmtScheme name="Office">',r[r.length]="<a:fillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="1"/>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="0"/>',r[r.length]="</a:gradFill>",r[r.length]="</a:fillStyleLst>",r[r.length]="<a:lnStyleLst>",r[r.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]="</a:lnStyleLst>",r[r.length]="<a:effectStyleLst>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',r[r.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',r[r.length]="</a:effectStyle>",r[r.length]="</a:effectStyleLst>",r[r.length]="<a:bgFillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]="</a:bgFillStyleLst>",r[r.length]="</a:fmtScheme>",r[r.length]="</a:themeElements>",r[r.length]="<a:objectDefaults>",r[r.length]="<a:spDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',r[r.length]="</a:spDef>",r[r.length]="<a:lnDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',r[r.length]="</a:lnDef>",r[r.length]="</a:objectDefaults>",r[r.length]="<a:extraClrSchemeLst/>",r[r.length]="</a:theme>",r.join("")}function mX(e,t,r){var n=e.l+t,s=e.read_shift(4);if(s!==124226){if(!r.cellStyles){e.l=n;return}var a=e.slice(e.l);e.l=n;var i;try{i=w8(a,{type:"array"})}catch{return}var l=qi(i,"theme/theme/theme1.xml",!0);if(l)return EF(l,r)}}function pX(e){return e.read_shift(4)}function xX(e){var t={};switch(t.xclrType=e.read_shift(2),t.nTintShade=e.read_shift(2),t.xclrType){case 0:e.l+=4;break;case 1:t.xclrValue=yX(e,4);break;case 2:t.xclrValue=oF(e);break;case 3:t.xclrValue=pX(e);break;case 4:e.l+=4;break}return e.l+=8,t}function yX(e,t){return Ya(e,t)}function vX(e,t){return Ya(e,t)}function wX(e){var t=e.read_shift(2),r=e.read_shift(2)-4,n=[t];switch(t){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:n[1]=xX(e);break;case 6:n[1]=vX(e,r);break;case 14:case 15:n[1]=e.read_shift(r===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+t+" "+r)}return n}function _X(e,t){var r=e.l+t;e.l+=2;var n=e.read_shift(2);e.l+=2;for(var s=e.read_shift(2),a=[];s-- >0;)a.push(wX(e,r-e.l));return{ixfe:n,ext:a}}function bX(e,t){t.forEach(function(r){r[0]})}function SX(e,t){return{flags:e.read_shift(4),version:e.read_shift(4),name:qa(e)}}function kX(e){var t=wt(12+2*e.name.length);return t.write_shift(4,e.flags),t.write_shift(4,e.version),ua(e.name,t),t.slice(0,t.l)}function CX(e){for(var t=[],r=e.read_shift(4);r-- >0;)t.push([e.read_shift(4),e.read_shift(4)]);return t}function TX(e){var t=wt(4+8*e.length);t.write_shift(4,e.length);for(var r=0;r<e.length;++r)t.write_shift(4,e[r][0]),t.write_shift(4,e[r][1]);return t}function NX(e,t){var r=wt(8+2*t.length);return r.write_shift(4,e),ua(t,r),r.slice(0,r.l)}function EX(e){return e.l+=4,e.read_shift(4)!=0}function jX(e,t){var r=wt(8);return r.write_shift(4,e),r.write_shift(4,1),r}function AX(e,t,r){var n={Types:[],Cell:[],Value:[]},s=r||{},a=[],i=!1,l=2;return Uc(e,function(c,d,f){switch(f){case 335:n.Types.push({name:c.name});break;case 51:c.forEach(function(p){l==1?n.Cell.push({type:n.Types[p[0]-1].name,index:p[1]}):l==0&&n.Value.push({type:n.Types[p[0]-1].name,index:p[1]})});break;case 337:l=c?1:0;break;case 338:l=2;break;case 35:a.push(f),i=!0;break;case 36:a.pop(),i=!1;break;default:if(!d.T){if(!i||s.WTF&&a[a.length-1]!=35)throw new Error("Unexpected record 0x"+f.toString(16))}}}),n}function FX(){var e=Ri();return Nt(e,332),Nt(e,334,Zo(1)),Nt(e,335,kX({name:"XLDAPR",version:12e4,flags:3496657072})),Nt(e,336),Nt(e,339,NX(1,"XLDAPR")),Nt(e,52),Nt(e,35,Zo(514)),Nt(e,4096,Zo(0)),Nt(e,4097,wo(1)),Nt(e,36),Nt(e,53),Nt(e,340),Nt(e,337,jX(1)),Nt(e,51,TX([[1,0]])),Nt(e,338),Nt(e,333),e.end()}function PX(e,t,r){var n={Types:[],Cell:[],Value:[]};if(!e)return n;var s=!1,a=2,i;return e.replace(Ja,function(l){var c=Fr(l);switch(zl(c[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":n.Types.push({name:c.name});break;case"</metadataType>":break;case"<futureMetadata":for(var d=0;d<n.Types.length;++d)n.Types[d].name==c.name&&(i=n.Types[d]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":a==1?n.Cell.push({type:n.Types[c.t-1].name,index:+c.v}):a==0&&n.Value.push({type:n.Types[c.t-1].name,index:+c.v});break;case"</rc>":break;case"<cellMetadata":a=1;break;case"</cellMetadata>":a=2;break;case"<valueMetadata":a=0;break;case"</valueMetadata>":a=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;case"<rvb":if(!i)break;i.offsets||(i.offsets=[]),i.offsets.push(+c.i);break;default:if(!s&&r.WTF)throw new Error("unrecognized "+c[0]+" in metadata")}return l}),n}function jF(){var e=[Es];return e.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),e.join("")}function RX(e){var t=[];if(!e)return t;var r=1;return(e.match(Ja)||[]).forEach(function(n){var s=Fr(n);switch(s[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete s[0],s.i?r=s.i:s.i=r,t.push(s);break}}),t}function DX(e){var t={};t.i=e.read_shift(4);var r={};r.r=e.read_shift(4),r.c=e.read_shift(4),t.r=jr(r);var n=e.read_shift(1);return n&2&&(t.l="1"),n&8&&(t.a="1"),t}function IX(e,t,r){var n=[];return Uc(e,function(a,i,l){switch(l){case 63:n.push(a);break;default:if(!i.T)throw new Error("Unexpected record 0x"+l.toString(16))}}),n}function MX(e,t,r,n){if(!e)return e;var s=n||{},a=!1;Uc(e,function(l,c,d){switch(d){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:a=!0;break;case 36:a=!1;break;default:if(!c.T){if(!a||s.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}},s)}function OX(e,t){if(!e)return"??";var r=(e.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return t["!id"][r].Target}var Xh=1024;function AF(e,t){for(var r=[21600,21600],n=["m0,0l0",r[1],r[0],r[1],r[0],"0xe"].join(","),s=[Gt("xml",null,{"xmlns:v":Gi.v,"xmlns:o":Gi.o,"xmlns:x":Gi.x,"xmlns:mv":Gi.mv}).replace(/\/>/,">"),Gt("o:shapelayout",Gt("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),Gt("v:shapetype",[Gt("v:stroke",null,{joinstyle:"miter"}),Gt("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:r.join(","),path:n})];Xh<e*1e3;)Xh+=1e3;return t.forEach(function(a){var i=ts(a[0]),l={color2:"#BEFF82",type:"gradient"};l.type=="gradient"&&(l.angle="-180");var c=l.type=="gradient"?Gt("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,d=Gt("v:fill",c,l),f={on:"t",obscured:"t"};++Xh,s=s.concat(["<v:shape"+yp({id:"_x0000_s"+Xh,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(a[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",d,Gt("v:shadow",null,f),Gt("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",Aa("x:Anchor",[i.c+1,0,i.r+1,0,i.c+3,20,i.r+5,20].join(",")),Aa("x:AutoFill","False"),Aa("x:Row",String(i.r)),Aa("x:Column",String(i.c)),a[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),s.push("</xml>"),s.join("")}function c3(e,t,r,n){var s=Array.isArray(e),a;t.forEach(function(i){var l=ts(i.ref);if(s?(e[l.r]||(e[l.r]=[]),a=e[l.r][l.c]):a=e[i.ref],!a){a={t:"z"},s?e[l.r][l.c]=a:e[i.ref]=a;var c=sn(e["!ref"]||"BDWGO1000001:A1");c.s.r>l.r&&(c.s.r=l.r),c.e.r<l.r&&(c.e.r=l.r),c.s.c>l.c&&(c.s.c=l.c),c.e.c<l.c&&(c.e.c=l.c);var d=zr(c);d!==e["!ref"]&&(e["!ref"]=d)}a.c||(a.c=[]);var f={a:i.author,t:i.t,r:i.r,T:r};i.h&&(f.h=i.h);for(var p=a.c.length-1;p>=0;--p){if(!r&&a.c[p].T)return;r&&!a.c[p].T&&a.c.splice(p,1)}if(r&&n){for(p=0;p<n.length;++p)if(f.a==n[p].id){f.a=n[p].name||f.a;break}}a.c.push(f)})}function LX(e,t){if(e.match(/<(?:\w+:)?comments *\/>/))return[];var r=[],n=[],s=e.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);s&&s[1]&&s[1].split(/<\/\w*:?author>/).forEach(function(i){if(!(i===""||i.trim()==="")){var l=i.match(/<(?:\w+:)?author[^>]*>(.*)/);l&&r.push(l[1])}});var a=e.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return a&&a[1]&&a[1].split(/<\/\w*:?comment>/).forEach(function(i){if(!(i===""||i.trim()==="")){var l=i.match(/<(?:\w+:)?comment[^>]*>/);if(l){var c=Fr(l[0]),d={author:c.authorId&&r[c.authorId]||"sheetjsghost",ref:c.ref,guid:c.guid},f=ts(c.ref);if(!(t.sheetRows&&t.sheetRows<=f.r)){var p=i.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),g=!!p&&!!p[1]&&AS(p[1])||{r:"",t:"",h:""};d.r=g.r,g.r=="<t></t>"&&(g.t=g.h=""),d.t=(g.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),t.cellHTML&&(d.h=g.h),n.push(d)}}}}),n}function FF(e){var t=[Es,Gt("comments",null,{xmlns:Nf[0]})],r=[];return t.push("<authors>"),e.forEach(function(n){n[1].forEach(function(s){var a=bn(s.a);r.indexOf(a)==-1&&(r.push(a),t.push("<author>"+a+"</author>")),s.T&&s.ID&&r.indexOf("tc="+s.ID)==-1&&(r.push("tc="+s.ID),t.push("<author>tc="+s.ID+"</author>"))})}),r.length==0&&(r.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),e.forEach(function(n){var s=0,a=[];if(n[1][0]&&n[1][0].T&&n[1][0].ID?s=r.indexOf("tc="+n[1][0].ID):n[1].forEach(function(c){c.a&&(s=r.indexOf(bn(c.a))),a.push(c.t||"")}),t.push('<comment ref="'+n[0]+'" authorId="'+s+'"><text>'),a.length<=1)t.push(Aa("t",bn(a[0]||"")));else{for(var i=`Comment:
    `+a[0]+`
`,l=1;l<a.length;++l)i+=`Reply:
    `+a[l]+`
`;t.push(Aa("t",bn(i)))}t.push("</text></comment>")}),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function BX(e,t){var r=[],n=!1,s={},a=0;return e.replace(Ja,function(l,c){var d=Fr(l);switch(zl(d[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":s={author:d.personId,guid:d.id,ref:d.ref,T:1};break;case"</threadedComment>":s.t!=null&&r.push(s);break;case"<text>":case"<text":a=c+l.length;break;case"</text>":s.t=e.slice(a,c).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":n=!0;break;case"</mentions>":n=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(!n&&t.WTF)throw new Error("unrecognized "+d[0]+" in threaded comments")}return l}),r}function UX(e,t,r){var n=[Es,Gt("ThreadedComments",null,{xmlns:qs.TCMNT}).replace(/[\/]>/,">")];return e.forEach(function(s){var a="";(s[1]||[]).forEach(function(i,l){if(!i.T){delete i.ID;return}i.a&&t.indexOf(i.a)==-1&&t.push(i.a);var c={ref:s[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+r.tcid++).slice(-12)+"}"};l==0?a=c.id:c.parentId=a,i.ID=c.id,i.a&&(c.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(i.a)).slice(-12)+"}"),n.push(Gt("threadedComment",Aa("text",i.t||""),c))})}),n.push("</ThreadedComments>"),n.join("")}function $X(e,t){var r=[],n=!1;return e.replace(Ja,function(a){var i=Fr(a);switch(zl(i[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":r.push({name:i.displayname,id:i.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(!n&&t.WTF)throw new Error("unrecognized "+i[0]+" in threaded comments")}return a}),r}function WX(e){var t=[Es,Gt("personList",null,{xmlns:qs.TCMNT,"xmlns:x":Nf[0]}).replace(/[\/]>/,">")];return e.forEach(function(r,n){t.push(Gt("person",null,{displayName:r,id:"{54EE7950-7262-4200-6969-"+("000000000000"+n).slice(-12)+"}",userId:r,providerId:"None"}))}),t.push("</personList>"),t.join("")}function zX(e){var t={};t.iauthor=e.read_shift(4);var r=Ff(e);return t.rfx=r.s,t.ref=jr(r.s),e.l+=16,t}function HX(e,t){return t==null&&(t=wt(36)),t.write_shift(4,e[1].iauthor),B0(e[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}var GX=qa;function VX(e){return ua(e.slice(0,54))}function KX(e,t){var r=[],n=[],s={},a=!1;return Uc(e,function(l,c,d){switch(d){case 632:n.push(l);break;case 635:s=l;break;case 637:s.t=l.t,s.h=l.h,s.r=l.r;break;case 636:if(s.author=n[s.iauthor],delete s.iauthor,t.sheetRows&&s.rfx&&t.sheetRows<=s.rfx.r)break;s.t||(s.t=""),delete s.rfx,r.push(s);break;case 3072:break;case 35:a=!0;break;case 36:a=!1;break;case 37:break;case 38:break;default:if(!c.T){if(!a||t.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}}),r}function qX(e){var t=Ri(),r=[];return Nt(t,628),Nt(t,630),e.forEach(function(n){n[1].forEach(function(s){r.indexOf(s.a)>-1||(r.push(s.a.slice(0,54)),Nt(t,632,VX(s.a)))})}),Nt(t,631),Nt(t,633),e.forEach(function(n){n[1].forEach(function(s){s.iauthor=r.indexOf(s.a);var a={s:ts(n[0]),e:ts(n[0])};Nt(t,635,HX([a,s])),s.t&&s.t.length>0&&Nt(t,637,pG(s)),Nt(t,636),delete s.iauthor})}),Nt(t,634),Nt(t,629),t.end()}var XX="application/vnd.ms-office.vbaProject";function YX(e){var t=xr.utils.cfb_new({root:"R"});return e.FullPaths.forEach(function(r,n){if(!(r.slice(-1)==="/"||!r.match(/_VBA_PROJECT_CUR/))){var s=r.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");xr.utils.cfb_add(t,s,e.FileIndex[n].content)}}),xr.write(t)}function JX(e,t){t.FullPaths.forEach(function(r,n){if(n!=0){var s=r.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");s.slice(-1)!=="/"&&xr.utils.cfb_add(e,s,t.FileIndex[n].content)}})}var PF=["xlsb","xlsm","xlam","biff8","xla"];function QX(){return{"!type":"dialog"}}function ZX(){return{"!type":"dialog"}}function eY(){return{"!type":"macro"}}function tY(){return{"!type":"macro"}}var a0=(function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function r(n,s,a,i){var l=!1,c=!1;a.length==0?c=!0:a.charAt(0)=="["&&(c=!0,a=a.slice(1,-1)),i.length==0?l=!0:i.charAt(0)=="["&&(l=!0,i=i.slice(1,-1));var d=a.length>0?parseInt(a,10)|0:0,f=i.length>0?parseInt(i,10)|0:0;return l?f+=t.c:--f,c?d+=t.r:--d,s+(l?"":"$")+es(f)+(c?"":"$")+Ts(d)}return function(s,a){return t=a,s.replace(e,r)}})(),DS=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,IS=(function(){return function(t,r){return t.replace(DS,function(n,s,a,i,l,c){var d=_S(i)-(a?0:r.c),f=wS(c)-(l?0:r.r),p=f==0?"":l?f+1:"["+f+"]",g=d==0?"":a?d+1:"["+d+"]";return s+"R"+p+"C"+g})}})();function RF(e,t){return e.replace(DS,function(r,n,s,a,i,l){return n+(s=="$"?s+a:es(_S(a)+t.c))+(i=="$"?i+l:Ts(wS(l)+t.r))})}function rY(e,t,r){var n=Di(t),s=n.s,a=ts(r),i={r:a.r-s.r,c:a.c-s.c};return RF(e,i)}function nY(e){return e.length!=1}function u3(e){return e.replace(/_xlfn\./g,"")}function Ds(e){e.l+=1}function Xu(e,t){var r=e.read_shift(2);return[r&16383,r>>14&1,r>>15&1]}function DF(e,t,r){var n=2;if(r){if(r.biff>=2&&r.biff<=5)return IF(e);r.biff==12&&(n=4)}var s=e.read_shift(n),a=e.read_shift(n),i=Xu(e),l=Xu(e);return{s:{r:s,c:i[0],cRel:i[1],rRel:i[2]},e:{r:a,c:l[0],cRel:l[1],rRel:l[2]}}}function IF(e){var t=Xu(e),r=Xu(e),n=e.read_shift(1),s=e.read_shift(1);return{s:{r:t[0],c:n,cRel:t[1],rRel:t[2]},e:{r:r[0],c:s,cRel:r[1],rRel:r[2]}}}function sY(e,t,r){if(r.biff<8)return IF(e);var n=e.read_shift(r.biff==12?4:2),s=e.read_shift(r.biff==12?4:2),a=Xu(e),i=Xu(e);return{s:{r:n,c:a[0],cRel:a[1],rRel:a[2]},e:{r:s,c:i[0],cRel:i[1],rRel:i[2]}}}function MF(e,t,r){if(r&&r.biff>=2&&r.biff<=5)return aY(e);var n=e.read_shift(r&&r.biff==12?4:2),s=Xu(e);return{r:n,c:s[0],cRel:s[1],rRel:s[2]}}function aY(e){var t=Xu(e),r=e.read_shift(1);return{r:t[0],c:r,cRel:t[1],rRel:t[2]}}function iY(e){var t=e.read_shift(2),r=e.read_shift(2);return{r:t,c:r&255,fQuoted:!!(r&16384),cRel:r>>15,rRel:r>>15}}function oY(e,t,r){var n=r&&r.biff?r.biff:8;if(n>=2&&n<=5)return lY(e);var s=e.read_shift(n>=12?4:2),a=e.read_shift(2),i=(a&16384)>>14,l=(a&32768)>>15;if(a&=16383,l==1)for(;s>524287;)s-=1048576;if(i==1)for(;a>8191;)a=a-16384;return{r:s,c:a,cRel:i,rRel:l}}function lY(e){var t=e.read_shift(2),r=e.read_shift(1),n=(t&32768)>>15,s=(t&16384)>>14;return t&=16383,n==1&&t>=8192&&(t=t-16384),s==1&&r>=128&&(r=r-256),{r:t,c:r,cRel:s,rRel:n}}function cY(e,t,r){var n=(e[e.l++]&96)>>5,s=DF(e,r.biff>=2&&r.biff<=5?6:8,r);return[n,s]}function uY(e,t,r){var n=(e[e.l++]&96)>>5,s=e.read_shift(2,"i"),a=8;if(r)switch(r.biff){case 5:e.l+=12,a=6;break;case 12:a=12;break}var i=DF(e,a,r);return[n,s,i]}function dY(e,t,r){var n=(e[e.l++]&96)>>5;return e.l+=r&&r.biff>8?12:r.biff<8?6:8,[n]}function fY(e,t,r){var n=(e[e.l++]&96)>>5,s=e.read_shift(2),a=8;if(r)switch(r.biff){case 5:e.l+=12,a=6;break;case 12:a=12;break}return e.l+=a,[n,s]}function hY(e,t,r){var n=(e[e.l++]&96)>>5,s=sY(e,t-1,r);return[n,s]}function gY(e,t,r){var n=(e[e.l++]&96)>>5;return e.l+=r.biff==2?6:r.biff==12?14:7,[n]}function d3(e){var t=e[e.l+1]&1,r=1;return e.l+=4,[t,r]}function mY(e,t,r){e.l+=2;for(var n=e.read_shift(r&&r.biff==2?1:2),s=[],a=0;a<=n;++a)s.push(e.read_shift(r&&r.biff==2?1:2));return s}function pY(e,t,r){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(r&&r.biff==2?1:2)]}function xY(e,t,r){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(r&&r.biff==2?1:2)]}function yY(e){var t=e[e.l+1]&255?1:0;return e.l+=2,[t,e.read_shift(2)]}function vY(e,t,r){var n=e[e.l+1]&255?1:0;return e.l+=r&&r.biff==2?3:4,[n]}function OF(e){var t=e.read_shift(1),r=e.read_shift(1);return[t,r]}function wY(e){return e.read_shift(2),OF(e)}function _Y(e){return e.read_shift(2),OF(e)}function bY(e,t,r){var n=(e[e.l]&96)>>5;e.l+=1;var s=MF(e,0,r);return[n,s]}function SY(e,t,r){var n=(e[e.l]&96)>>5;e.l+=1;var s=oY(e,0,r);return[n,s]}function kY(e,t,r){var n=(e[e.l]&96)>>5;e.l+=1;var s=e.read_shift(2);r&&r.biff==5&&(e.l+=12);var a=MF(e,0,r);return[n,s,a]}function CY(e,t,r){var n=(e[e.l]&96)>>5;e.l+=1;var s=e.read_shift(r&&r.biff<=3?1:2);return[EJ[s],UF[s],n]}function TY(e,t,r){var n=e[e.l++],s=e.read_shift(1),a=r&&r.biff<=3?[n==88?-1:0,e.read_shift(1)]:NY(e);return[s,(a[0]===0?UF:NJ)[a[1]]]}function NY(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function EY(e,t,r){e.l+=r&&r.biff==2?3:4}function jY(e,t,r){if(e.l++,r&&r.biff==12)return[e.read_shift(4,"i"),0];var n=e.read_shift(2),s=e.read_shift(r&&r.biff==2?1:2);return[n,s]}function AY(e){return e.l++,$c[e.read_shift(1)]}function FY(e){return e.l++,e.read_shift(2)}function PY(e){return e.l++,e.read_shift(1)!==0}function RY(e){return e.l++,Ha(e)}function DY(e,t,r){return e.l++,Qp(e,t-1,r)}function IY(e,t){var r=[e.read_shift(1)];if(t==12)switch(r[0]){case 2:r[0]=4;break;case 4:r[0]=16;break;case 0:r[0]=1;break;case 1:r[0]=2;break}switch(r[0]){case 4:r[1]=ks(e,1)?"TRUE":"FALSE",t!=12&&(e.l+=7);break;case 37:case 16:r[1]=$c[e[e.l]],e.l+=t==12?4:8;break;case 0:e.l+=8;break;case 1:r[1]=Ha(e);break;case 2:r[1]=Pf(e,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+r[0])}return r}function MY(e,t,r){for(var n=e.read_shift(r.biff==12?4:2),s=[],a=0;a!=n;++a)s.push((r.biff==12?Ff:lv)(e));return s}function OY(e,t,r){var n=0,s=0;r.biff==12?(n=e.read_shift(4),s=e.read_shift(4)):(s=1+e.read_shift(1),n=1+e.read_shift(2)),r.biff>=2&&r.biff<8&&(--n,--s==0&&(s=256));for(var a=0,i=[];a!=n&&(i[a]=[]);++a)for(var l=0;l!=s;++l)i[a][l]=IY(e,r.biff);return i}function LY(e,t,r){var n=e.read_shift(1)>>>5&3,s=!r||r.biff>=8?4:2,a=e.read_shift(s);switch(r.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[n,0,a]}function BY(e,t,r){if(r.biff==5)return UY(e);var n=e.read_shift(1)>>>5&3,s=e.read_shift(2),a=e.read_shift(4);return[n,s,a]}function UY(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2,"i");e.l+=8;var n=e.read_shift(2);return e.l+=12,[t,r,n]}function $Y(e,t,r){var n=e.read_shift(1)>>>5&3;e.l+=r&&r.biff==2?3:4;var s=e.read_shift(r&&r.biff==2?1:2);return[n,s]}function WY(e,t,r){var n=e.read_shift(1)>>>5&3,s=e.read_shift(r&&r.biff==2?1:2);return[n,s]}function zY(e,t,r){var n=e.read_shift(1)>>>5&3;return e.l+=4,r.biff<8&&e.l--,r.biff==12&&(e.l+=2),[n]}function HY(e,t,r){var n=(e[e.l++]&96)>>5,s=e.read_shift(2),a=4;if(r)switch(r.biff){case 5:a=15;break;case 12:a=6;break}return e.l+=a,[n,s]}var GY=Ya,VY=Ya,KY=Ya;function ex(e,t,r){return e.l+=2,[iY(e)]}function MS(e){return e.l+=6,[]}var qY=ex,XY=MS,YY=MS,JY=ex;function LF(e){return e.l+=2,[Ms(e),e.read_shift(2)&1]}var QY=ex,ZY=LF,eJ=MS,tJ=ex,rJ=ex,nJ=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function sJ(e){e.l+=2;var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(4),s=e.read_shift(2),a=e.read_shift(2),i=nJ[r>>2&31];return{ixti:t,coltype:r&3,rt:i,idx:n,c:s,C:a}}function aJ(e){return e.l+=2,[e.read_shift(4)]}function iJ(e,t,r){return e.l+=5,e.l+=2,e.l+=r.biff==2?1:4,["PTGSHEET"]}function oJ(e,t,r){return e.l+=r.biff==2?4:5,["PTGENDSHEET"]}function lJ(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2);return[t,r]}function cJ(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2);return[t,r]}function uJ(e){return e.l+=4,[0,0]}var f3={1:{n:"PtgExp",f:jY},2:{n:"PtgTbl",f:KY},3:{n:"PtgAdd",f:Ds},4:{n:"PtgSub",f:Ds},5:{n:"PtgMul",f:Ds},6:{n:"PtgDiv",f:Ds},7:{n:"PtgPower",f:Ds},8:{n:"PtgConcat",f:Ds},9:{n:"PtgLt",f:Ds},10:{n:"PtgLe",f:Ds},11:{n:"PtgEq",f:Ds},12:{n:"PtgGe",f:Ds},13:{n:"PtgGt",f:Ds},14:{n:"PtgNe",f:Ds},15:{n:"PtgIsect",f:Ds},16:{n:"PtgUnion",f:Ds},17:{n:"PtgRange",f:Ds},18:{n:"PtgUplus",f:Ds},19:{n:"PtgUminus",f:Ds},20:{n:"PtgPercent",f:Ds},21:{n:"PtgParen",f:Ds},22:{n:"PtgMissArg",f:Ds},23:{n:"PtgStr",f:DY},26:{n:"PtgSheet",f:iJ},27:{n:"PtgEndSheet",f:oJ},28:{n:"PtgErr",f:AY},29:{n:"PtgBool",f:PY},30:{n:"PtgInt",f:FY},31:{n:"PtgNum",f:RY},32:{n:"PtgArray",f:gY},33:{n:"PtgFunc",f:CY},34:{n:"PtgFuncVar",f:TY},35:{n:"PtgName",f:LY},36:{n:"PtgRef",f:bY},37:{n:"PtgArea",f:cY},38:{n:"PtgMemArea",f:$Y},39:{n:"PtgMemErr",f:GY},40:{n:"PtgMemNoMem",f:VY},41:{n:"PtgMemFunc",f:WY},42:{n:"PtgRefErr",f:zY},43:{n:"PtgAreaErr",f:dY},44:{n:"PtgRefN",f:SY},45:{n:"PtgAreaN",f:hY},46:{n:"PtgMemAreaN",f:lJ},47:{n:"PtgMemNoMemN",f:cJ},57:{n:"PtgNameX",f:BY},58:{n:"PtgRef3d",f:kY},59:{n:"PtgArea3d",f:uY},60:{n:"PtgRefErr3d",f:HY},61:{n:"PtgAreaErr3d",f:fY},255:{}},dJ={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},fJ={1:{n:"PtgElfLel",f:LF},2:{n:"PtgElfRw",f:tJ},3:{n:"PtgElfCol",f:qY},6:{n:"PtgElfRwV",f:rJ},7:{n:"PtgElfColV",f:JY},10:{n:"PtgElfRadical",f:QY},11:{n:"PtgElfRadicalS",f:eJ},13:{n:"PtgElfColS",f:XY},15:{n:"PtgElfColSV",f:YY},16:{n:"PtgElfRadicalLel",f:ZY},25:{n:"PtgList",f:sJ},29:{n:"PtgSxName",f:aJ},255:{}},hJ={0:{n:"PtgAttrNoop",f:uJ},1:{n:"PtgAttrSemi",f:vY},2:{n:"PtgAttrIf",f:xY},4:{n:"PtgAttrChoose",f:mY},8:{n:"PtgAttrGoto",f:pY},16:{n:"PtgAttrSum",f:EY},32:{n:"PtgAttrBaxcel",f:d3},33:{n:"PtgAttrBaxcel",f:d3},64:{n:"PtgAttrSpace",f:wY},65:{n:"PtgAttrSpaceSemi",f:_Y},128:{n:"PtgAttrIfError",f:yY},255:{}};function tx(e,t,r,n){if(n.biff<8)return Ya(e,t);for(var s=e.l+t,a=[],i=0;i!==r.length;++i)switch(r[i][0]){case"PtgArray":r[i][1]=OY(e,0,n),a.push(r[i][1]);break;case"PtgMemArea":r[i][2]=MY(e,r[i][1],n),a.push(r[i][2]);break;case"PtgExp":n&&n.biff==12&&(r[i][1][1]=e.read_shift(4),a.push(r[i][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+r[i][0]}return t=s-e.l,t!==0&&a.push(Ya(e,t)),a}function rx(e,t,r){for(var n=e.l+t,s,a,i=[];n!=e.l;)t=n-e.l,a=e[e.l],s=f3[a]||f3[dJ[a]],(a===24||a===25)&&(s=(a===24?fJ:hJ)[e[e.l+1]]),!s||!s.f?Ya(e,t):i.push([s.n,s.f(e,t,r)]);return i}function gJ(e){for(var t=[],r=0;r<e.length;++r){for(var n=e[r],s=[],a=0;a<n.length;++a){var i=n[a];if(i)switch(i[0]){case 2:s.push('"'+i[1].replace(/"/g,'""')+'"');break;default:s.push(i[1])}else s.push("")}t.push(s.join(","))}return t.join(";")}var mJ={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function pJ(e,t){if(!e&&!(t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function BF(e,t,r){if(!e)return"SH33TJSERR0";if(r.biff>8&&(!e.XTI||!e.XTI[t]))return e.SheetNames[t];if(!e.XTI)return"SH33TJSERR6";var n=e.XTI[t];if(r.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),t==0?"":e.XTI[t-1];if(!n)return"SH33TJSERR1";var s="";if(r.biff>8)switch(e[n[0]][0]){case 357:return s=n[1]==-1?"#REF":e.SheetNames[n[1]],n[1]==n[2]?s:s+":"+e.SheetNames[n[2]];case 358:return r.SID!=null?e.SheetNames[r.SID]:"SH33TJSSAME"+e[n[0]][0];case 355:default:return"SH33TJSSRC"+e[n[0]][0]}switch(e[n[0]][0][0]){case 1025:return s=n[1]==-1?"#REF":e.SheetNames[n[1]]||"SH33TJSERR3",n[1]==n[2]?s:s+":"+e.SheetNames[n[2]];case 14849:return e[n[0]].slice(1).map(function(a){return a.Name}).join(";;");default:return e[n[0]][0][3]?(s=n[1]==-1?"#REF":e[n[0]][0][3][n[1]]||"SH33TJSERR4",n[1]==n[2]?s:s+":"+e[n[0]][0][3][n[2]]):"SH33TJSERR2"}}function h3(e,t,r){var n=BF(e,t,r);return n=="#REF"?n:pJ(n,r)}function Wa(e,t,r,n,s){var a=s&&s.biff||8,i={s:{c:0,r:0}},l=[],c,d,f,p=0,g=0,y,v="";if(!e[0]||!e[0][0])return"";for(var w=-1,b="",E=0,k=e[0].length;E<k;++E){var _=e[0][E];switch(_[0]){case"PtgUminus":l.push("-"+l.pop());break;case"PtgUplus":l.push("+"+l.pop());break;case"PtgPercent":l.push(l.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(c=l.pop(),d=l.pop(),w>=0){switch(e[0][w][1][0]){case 0:b=fs(" ",e[0][w][1][1]);break;case 1:b=fs("\r",e[0][w][1][1]);break;default:if(b="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][w][1][0])}d=d+b,w=-1}l.push(d+mJ[_[0]]+c);break;case"PtgIsect":c=l.pop(),d=l.pop(),l.push(d+" "+c);break;case"PtgUnion":c=l.pop(),d=l.pop(),l.push(d+","+c);break;case"PtgRange":c=l.pop(),d=l.pop(),l.push(d+":"+c);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":f=zm(_[1][1],i,s),l.push(Hm(f,a));break;case"PtgRefN":f=r?zm(_[1][1],r,s):_[1][1],l.push(Hm(f,a));break;case"PtgRef3d":p=_[1][1],f=zm(_[1][2],i,s),v=h3(n,p,s),l.push(v+"!"+Hm(f,a));break;case"PtgFunc":case"PtgFuncVar":var T=_[1][0],j=_[1][1];T||(T=0),T&=127;var P=T==0?[]:l.slice(-T);l.length-=T,j==="User"&&(j=P.shift()),l.push(j+"("+P.join(",")+")");break;case"PtgBool":l.push(_[1]?"TRUE":"FALSE");break;case"PtgInt":l.push(_[1]);break;case"PtgNum":l.push(String(_[1]));break;case"PtgStr":l.push('"'+_[1].replace(/"/g,'""')+'"');break;case"PtgErr":l.push(_[1]);break;case"PtgAreaN":y=WE(_[1][1],r?{s:r}:i,s),l.push(Hw(y,s));break;case"PtgArea":y=WE(_[1][1],i,s),l.push(Hw(y,s));break;case"PtgArea3d":p=_[1][1],y=_[1][2],v=h3(n,p,s),l.push(v+"!"+Hw(y,s));break;case"PtgAttrSum":l.push("SUM("+l.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":g=_[1][2];var R=(n.names||[])[g-1]||(n[0]||[])[g],N=R?R.Name:"SH33TJSNAME"+String(g);N&&N.slice(0,6)=="_xlfn."&&!s.xlfn&&(N=N.slice(6)),l.push(N);break;case"PtgNameX":var A=_[1][1];g=_[1][2];var M;if(s.biff<=5)A<0&&(A=-A),n[A]&&(M=n[A][g]);else{var H="";if(((n[A]||[])[0]||[])[0]==14849||(((n[A]||[])[0]||[])[0]==1025?n[A][g]&&n[A][g].itab>0&&(H=n.SheetNames[n[A][g].itab-1]+"!"):H=n.SheetNames[g-1]+"!"),n[A]&&n[A][g])H+=n[A][g].Name;else if(n[0]&&n[0][g])H+=n[0][g].Name;else{var Q=(BF(n,A,s)||"").split(";;");Q[g-1]?H=Q[g-1]:H+="SH33TJSERRX"}l.push(H);break}M||(M={Name:"SH33TJSERRY"}),l.push(M.Name);break;case"PtgParen":var Z="(",ae=")";if(w>=0){switch(b="",e[0][w][1][0]){case 2:Z=fs(" ",e[0][w][1][1])+Z;break;case 3:Z=fs("\r",e[0][w][1][1])+Z;break;case 4:ae=fs(" ",e[0][w][1][1])+ae;break;case 5:ae=fs("\r",e[0][w][1][1])+ae;break;default:if(s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][w][1][0])}w=-1}l.push(Z+l.pop()+ae);break;case"PtgRefErr":l.push("#REF!");break;case"PtgRefErr3d":l.push("#REF!");break;case"PtgExp":f={c:_[1][1],r:_[1][0]};var te={c:r.c,r:r.r};if(n.sharedf[jr(f)]){var se=n.sharedf[jr(f)];l.push(Wa(se,i,te,n,s))}else{var L=!1;for(c=0;c!=n.arrayf.length;++c)if(d=n.arrayf[c],!(f.c<d[0].s.c||f.c>d[0].e.c)&&!(f.r<d[0].s.r||f.r>d[0].e.r)){l.push(Wa(d[1],i,te,n,s)),L=!0;break}L||l.push(_[1])}break;case"PtgArray":l.push("{"+gJ(_[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":w=E;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":l.push("");break;case"PtgAreaErr":l.push("#REF!");break;case"PtgAreaErr3d":l.push("#REF!");break;case"PtgList":l.push("Table"+_[1].idx+"[#"+_[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(_));default:throw new Error("Unrecognized Formula Token: "+String(_))}var G=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(s.biff!=3&&w>=0&&G.indexOf(e[0][E][0])==-1){_=e[0][w];var I=!0;switch(_[1][0]){case 4:I=!1;case 0:b=fs(" ",_[1][1]);break;case 5:I=!1;case 1:b=fs("\r",_[1][1]);break;default:if(b="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+_[1][0])}l.push((I?b:"")+l.pop()+(I?"":b)),w=-1}}if(l.length>1&&s.WTF)throw new Error("bad formula stack");return l[0]}function xJ(e,t,r){var n=e.l+t,s=r.biff==2?1:2,a,i=e.read_shift(s);if(i==65535)return[[],Ya(e,t-2)];var l=rx(e,i,r);return t!==i+s&&(a=tx(e,t-i-s,l,r)),e.l=n,[l,a]}function yJ(e,t,r){var n=e.l+t,s=r.biff==2?1:2,a,i=e.read_shift(s);if(i==65535)return[[],Ya(e,t-2)];var l=rx(e,i,r);return t!==i+s&&(a=tx(e,t-i-s,l,r)),e.l=n,[l,a]}function vJ(e,t,r,n){var s=e.l+t,a=rx(e,n,r),i;return s!==e.l&&(i=tx(e,s-e.l,a,r)),[a,i]}function wJ(e,t,r){var n=e.l+t,s,a=e.read_shift(2),i=rx(e,a,r);return a==65535?[[],Ya(e,t-2)]:(t!==a+2&&(s=tx(e,n-a-2,i,r)),[i,s])}function _J(e){var t;if(Tc(e,e.l+6)!==65535)return[Ha(e),"n"];switch(e[e.l]){case 0:return e.l+=8,["String","s"];case 1:return t=e[e.l+2]===1,e.l+=8,[t,"b"];case 2:return t=e[e.l+2],e.l+=8,[t,"e"];case 3:return e.l+=8,["","s"]}return[]}function bJ(e){if(e==null){var t=wt(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}else if(typeof e=="number")return wf(e);return wf(0)}function Xw(e,t,r){var n=e.l+t,s=Hl(e);r.biff==2&&++e.l;var a=_J(e),i=e.read_shift(1);r.biff!=2&&(e.read_shift(1),r.biff>=5&&e.read_shift(4));var l=yJ(e,n-e.l,r);return{cell:s,val:a[0],formula:l,shared:i>>3&1,tt:a[1]}}function SJ(e,t,r,n,s){var a=bf(t,r,s),i=bJ(e.v),l=wt(6),c=33;l.write_shift(2,c),l.write_shift(4,0);for(var d=wt(e.bf.length),f=0;f<e.bf.length;++f)d[f]=e.bf[f];var p=la([a,i,l,d]);return p}function cv(e,t,r){var n=e.read_shift(4),s=rx(e,n,r),a=e.read_shift(4),i=a>0?tx(e,a,s,r):null;return[s,i]}var kJ=cv,uv=cv,CJ=cv,TJ=cv,NJ={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},UF={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},EJ={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function g3(e){return e.slice(0,3)=="of:"&&(e=e.slice(3)),e.charCodeAt(0)==61&&(e=e.slice(1),e.charCodeAt(0)==61&&(e=e.slice(1))),e=e.replace(/COM\.MICROSOFT\./g,""),e=e.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(t,r){return r.replace(/\./g,"")}),e=e.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),e.replace(/[;~]/g,",").replace(/\|/g,";")}function jJ(e){var t="of:="+e.replace(DS,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return t.replace(/;/g,"|").replace(/,/g,";")}function Yw(e){var t=e.split(":"),r=t[0].split(".")[0];return[r,t[0].split(".")[1]+(t.length>1?":"+(t[1].split(".")[1]||t[1].split(".")[0]):"")]}function AJ(e){return e.replace(/\./,"!")}var Vm={},i0={},Km=typeof Map<"u";function OS(e,t,r){var n=0,s=e.length;if(r){if(Km?r.has(t):Object.prototype.hasOwnProperty.call(r,t)){for(var a=Km?r.get(t):r[t];n<a.length;++n)if(e[a[n]].t===t)return e.Count++,a[n]}}else for(;n<s;++n)if(e[n].t===t)return e.Count++,n;return e[s]={t},e.Count++,e.Unique++,r&&(Km?(r.has(t)||r.set(t,[]),r.get(t).push(s)):(Object.prototype.hasOwnProperty.call(r,t)||(r[t]=[]),r[t].push(s))),s}function dv(e,t){var r={min:e+1,max:e+1},n=-1;return t.MDW&&(za=t.MDW),t.width!=null?r.customWidth=1:t.wpx!=null?n=Sp(t.wpx):t.wch!=null&&(n=t.wch),n>-1?(r.width=T1(n),r.customWidth=1):t.width!=null&&(r.width=t.width),t.hidden&&(r.hidden=!0),t.level!=null&&(r.outlineLevel=r.level=t.level),r}function rf(e,t){if(e){var r=[.7,.7,.75,.75,.3,.3];t=="xlml"&&(r=[1,1,1,1,.5,.5]),e.left==null&&(e.left=r[0]),e.right==null&&(e.right=r[1]),e.top==null&&(e.top=r[2]),e.bottom==null&&(e.bottom=r[3]),e.header==null&&(e.header=r[4]),e.footer==null&&(e.footer=r[5])}}function id(e,t,r){var n=r.revssf[t.z!=null?t.z:"General"],s=60,a=e.length;if(n==null&&r.ssf){for(;s<392;++s)if(r.ssf[s]==null){jc(t.z,s),r.ssf[s]=t.z,r.revssf[t.z]=n=s;break}}for(s=0;s!=a;++s)if(e[s].numFmtId===n)return s;return e[a]={numFmtId:n,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},a}function $F(e,t,r,n,s,a){try{n.cellNF&&(e.z=Cr[t])}catch(l){if(n.WTF)throw l}if(!(e.t==="z"&&!n.cellStyles)){if(e.t==="d"&&typeof e.v=="string"&&(e.v=Un(e.v)),(!n||n.cellText!==!1)&&e.t!=="z")try{if(Cr[t]==null&&jc(NH[t]||"General",t),e.t==="e")e.w=e.w||$c[e.v];else if(t===0)if(e.t==="n")(e.v|0)===e.v?e.w=e.v.toString(10):e.w=pp(e.v);else if(e.t==="d"){var i=Ys(e.v);(i|0)===i?e.w=i.toString(10):e.w=pp(i)}else{if(e.v===void 0)return"";e.w=yf(e.v,i0)}else e.t==="d"?e.w=No(t,Ys(e.v),i0):e.w=No(t,e.v,i0)}catch(l){if(n.WTF)throw l}if(n.cellStyles&&r!=null)try{e.s=a.Fills[r],e.s.fgColor&&e.s.fgColor.theme&&!e.s.fgColor.rgb&&(e.s.fgColor.rgb=C1(s.themeElements.clrScheme[e.s.fgColor.theme].rgb,e.s.fgColor.tint||0),n.WTF&&(e.s.fgColor.raw_rgb=s.themeElements.clrScheme[e.s.fgColor.theme].rgb)),e.s.bgColor&&e.s.bgColor.theme&&(e.s.bgColor.rgb=C1(s.themeElements.clrScheme[e.s.bgColor.theme].rgb,e.s.bgColor.tint||0),n.WTF&&(e.s.bgColor.raw_rgb=s.themeElements.clrScheme[e.s.bgColor.theme].rgb))}catch(l){if(n.WTF&&a.Fills)throw l}}}function FJ(e,t,r){if(e&&e["!ref"]){var n=sn(e["!ref"]);if(n.e.c<n.s.c||n.e.r<n.s.r)throw new Error("Bad range ("+r+"): "+e["!ref"])}}function PJ(e,t){var r=sn(t);r.s.r<=r.e.r&&r.s.c<=r.e.c&&r.s.r>=0&&r.s.c>=0&&(e["!ref"]=zr(r))}var RJ=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,DJ=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,IJ=/<(?:\w:)?hyperlink [^>]*>/mg,MJ=/"(\w*:\w*)"/,OJ=/<(?:\w:)?col\b[^>]*[\/]?>/g,LJ=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,BJ=/<(?:\w:)?pageMargins[^>]*\/>/g,WF=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,UJ=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,$J=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function WJ(e,t,r,n,s,a,i){if(!e)return e;n||(n={"!id":{}});var l=t.dense?[]:{},c={s:{r:2e6,c:2e6},e:{r:0,c:0}},d="",f="",p=e.match(DJ);p?(d=e.slice(0,p.index),f=e.slice(p.index+p[0].length)):d=f=e;var g=d.match(WF);g?LS(g[0],l,s,r):(g=d.match(UJ))&&HJ(g[0],g[1]||"",l,s,r);var y=(d.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(y>0){var v=d.slice(y,y+50).match(MJ);v&&PJ(l,v[1])}var w=d.match($J);w&&w[1]&&nQ(w[1],s);var b=[];if(t.cellStyles){var E=d.match(OJ);E&&QJ(b,E)}p&&iQ(p[1],l,t,c,a,i);var k=f.match(LJ);k&&(l["!autofilter"]=eQ(k[0]));var _=[],T=f.match(RJ);if(T)for(y=0;y!=T.length;++y)_[y]=sn(T[y].slice(T[y].indexOf('"')+1));var j=f.match(IJ);j&&XJ(l,j,n);var P=f.match(BJ);if(P&&(l["!margins"]=YJ(Fr(P[0]))),!l["!ref"]&&c.e.c>=c.s.c&&c.e.r>=c.s.r&&(l["!ref"]=zr(c)),t.sheetRows>0&&l["!ref"]){var R=sn(l["!ref"]);t.sheetRows<=+R.e.r&&(R.e.r=t.sheetRows-1,R.e.r>c.e.r&&(R.e.r=c.e.r),R.e.r<R.s.r&&(R.s.r=R.e.r),R.e.c>c.e.c&&(R.e.c=c.e.c),R.e.c<R.s.c&&(R.s.c=R.e.c),l["!fullref"]=l["!ref"],l["!ref"]=zr(R))}return b.length>0&&(l["!cols"]=b),_.length>0&&(l["!merges"]=_),l}function zJ(e){if(e.length===0)return"";for(var t='<mergeCells count="'+e.length+'">',r=0;r!=e.length;++r)t+='<mergeCell ref="'+zr(e[r])+'"/>';return t+"</mergeCells>"}function LS(e,t,r,n){var s=Fr(e);r.Sheets[n]||(r.Sheets[n]={}),s.codeName&&(r.Sheets[n].CodeName=nn(Nn(s.codeName)))}function HJ(e,t,r,n,s){LS(e.slice(0,e.indexOf(">")),r,n,s)}function GJ(e,t,r,n,s){var a=!1,i={},l=null;if(n.bookType!=="xlsx"&&t.vbaraw){var c=t.SheetNames[r];try{t.Workbook&&(c=t.Workbook.Sheets[r].CodeName||c)}catch{}a=!0,i.codeName=Il(bn(c))}if(e&&e["!outline"]){var d={summaryBelow:1,summaryRight:1};e["!outline"].above&&(d.summaryBelow=0),e["!outline"].left&&(d.summaryRight=0),l=(l||"")+Gt("outlinePr",null,d)}!a&&!l||(s[s.length]=Gt("sheetPr",l,i))}var VJ=["objects","scenarios","selectLockedCells","selectUnlockedCells"],KJ=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function qJ(e){var t={sheet:1};return VJ.forEach(function(r){e[r]!=null&&e[r]&&(t[r]="1")}),KJ.forEach(function(r){e[r]!=null&&!e[r]&&(t[r]="0")}),e.password&&(t.password=FS(e.password).toString(16).toUpperCase()),Gt("sheetProtection",null,t)}function XJ(e,t,r){for(var n=Array.isArray(e),s=0;s!=t.length;++s){var a=Fr(Nn(t[s]),!0);if(!a.ref)return;var i=((r||{})["!id"]||[])[a.id];i?(a.Target=i.Target,a.location&&(a.Target+="#"+nn(a.location))):(a.Target="#"+nn(a.location),i={Target:a.Target,TargetMode:"Internal"}),a.Rel=i,a.tooltip&&(a.Tooltip=a.tooltip,delete a.tooltip);for(var l=sn(a.ref),c=l.s.r;c<=l.e.r;++c)for(var d=l.s.c;d<=l.e.c;++d){var f=jr({c:d,r:c});n?(e[c]||(e[c]=[]),e[c][d]||(e[c][d]={t:"z",v:void 0}),e[c][d].l=a):(e[f]||(e[f]={t:"z",v:void 0}),e[f].l=a)}}}function YJ(e){var t={};return["left","right","top","bottom","header","footer"].forEach(function(r){e[r]&&(t[r]=parseFloat(e[r]))}),t}function JJ(e){return rf(e),Gt("pageMargins",null,e)}function QJ(e,t){for(var r=!1,n=0;n!=t.length;++n){var s=Fr(t[n],!0);s.hidden&&(s.hidden=On(s.hidden));var a=parseInt(s.min,10)-1,i=parseInt(s.max,10)-1;for(s.outlineLevel&&(s.level=+s.outlineLevel||0),delete s.min,delete s.max,s.width=+s.width,!r&&s.width&&(r=!0,PS(s.width)),qu(s);a<=i;)e[a++]=$n(s)}}function ZJ(e,t){for(var r=["<cols>"],n,s=0;s!=t.length;++s)(n=t[s])&&(r[r.length]=Gt("col",null,dv(s,n)));return r[r.length]="</cols>",r.join("")}function eQ(e){var t={ref:(e.match(/ref="([^"]*)"/)||[])[1]};return t}function tQ(e,t,r,n){var s=typeof e.ref=="string"?e.ref:zr(e.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var a=r.Workbook.Names,i=Di(s);i.s.r==i.e.r&&(i.e.r=Di(t["!ref"]).e.r,s=zr(i));for(var l=0;l<a.length;++l){var c=a[l];if(c.Name=="_xlnm._FilterDatabase"&&c.Sheet==n){c.Ref="'"+r.SheetNames[n]+"'!"+s;break}}return l==a.length&&a.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+r.SheetNames[n]+"'!"+s}),Gt("autoFilter",null,{ref:s})}var rQ=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function nQ(e,t){t.Views||(t.Views=[{}]),(e.match(rQ)||[]).forEach(function(r,n){var s=Fr(r);t.Views[n]||(t.Views[n]={}),+s.zoomScale&&(t.Views[n].zoom=+s.zoomScale),On(s.rightToLeft)&&(t.Views[n].RTL=!0)})}function sQ(e,t,r,n){var s={workbookViewId:"0"};return(((n||{}).Workbook||{}).Views||[])[0]&&(s.rightToLeft=n.Workbook.Views[0].RTL?"1":"0"),Gt("sheetViews",Gt("sheetView",null,s),{})}function aQ(e,t,r,n){if(e.c&&r["!comments"].push([t,e.c]),e.v===void 0&&typeof e.f!="string"||e.t==="z"&&!e.f)return"";var s="",a=e.t,i=e.v;if(e.t!=="z")switch(e.t){case"b":s=e.v?"1":"0";break;case"n":s=""+e.v;break;case"e":s=$c[e.v];break;case"d":n&&n.cellDates?s=Un(e.v,-1).toISOString():(e=$n(e),e.t="n",s=""+(e.v=Ys(Un(e.v)))),typeof e.z>"u"&&(e.z=Cr[14]);break;default:s=e.v;break}var l=Aa("v",bn(s)),c={r:t},d=id(n.cellXfs,e,n);switch(d!==0&&(c.s=d),e.t){case"n":break;case"d":c.t="d";break;case"b":c.t="b";break;case"e":c.t="e";break;case"z":break;default:if(e.v==null){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(n&&n.bookSST){l=Aa("v",""+OS(n.Strings,e.v,n.revStrings)),c.t="s";break}c.t="str";break}if(e.t!=a&&(e.t=a,e.v=i),typeof e.f=="string"&&e.f){var f=e.F&&e.F.slice(0,t.length)==t?{t:"array",ref:e.F}:null;l=Gt("f",bn(e.f),f)+(e.v!=null?l:"")}return e.l&&r["!links"].push([t,e.l]),e.D&&(c.cm=1),Gt("c",l,c)}var iQ=(function(){var e=/<(?:\w+:)?c[ \/>]/,t=/<\/(?:\w+:)?row>/,r=/r=["']([^"']*)["']/,n=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,s=/ref=["']([^"']*)["']/,a=xp("v"),i=xp("f");return function(c,d,f,p,g,y){for(var v=0,w="",b=[],E=[],k=0,_=0,T=0,j="",P,R,N=0,A=0,M,H,Q=0,Z=0,ae=Array.isArray(y.CellXf),te,se=[],L=[],G=Array.isArray(d),I=[],z={},V=!1,O=!!f.sheetStubs,W=c.split(t),q=0,Y=W.length;q!=Y;++q){w=W[q].trim();var ee=w.length;if(ee!==0){var X=0;e:for(v=0;v<ee;++v)switch(w[v]){case">":if(w[v-1]!="/"){++v;break e}if(f&&f.cellStyles){if(R=Fr(w.slice(X,v),!0),N=R.r!=null?parseInt(R.r,10):N+1,A=-1,f.sheetRows&&f.sheetRows<N)continue;z={},V=!1,R.ht&&(V=!0,z.hpt=parseFloat(R.ht),z.hpx=y0(z.hpt)),R.hidden=="1"&&(V=!0,z.hidden=!0),R.outlineLevel!=null&&(V=!0,z.level=+R.outlineLevel),V&&(I[N-1]=z)}break;case"<":X=v;break}if(X>=v)break;if(R=Fr(w.slice(X,v),!0),N=R.r!=null?parseInt(R.r,10):N+1,A=-1,!(f.sheetRows&&f.sheetRows<N)){p.s.r>N-1&&(p.s.r=N-1),p.e.r<N-1&&(p.e.r=N-1),f&&f.cellStyles&&(z={},V=!1,R.ht&&(V=!0,z.hpt=parseFloat(R.ht),z.hpx=y0(z.hpt)),R.hidden=="1"&&(V=!0,z.hidden=!0),R.outlineLevel!=null&&(V=!0,z.level=+R.outlineLevel),V&&(I[N-1]=z)),b=w.slice(v).split(e);for(var ne=0;ne!=b.length&&b[ne].trim().charAt(0)=="<";++ne);for(b=b.slice(ne),v=0;v!=b.length;++v)if(w=b[v].trim(),w.length!==0){if(E=w.match(r),k=v,_=0,T=0,w="<c "+(w.slice(0,1)=="<"?">":"")+w,E!=null&&E.length===2){for(k=0,j=E[1],_=0;_!=j.length&&!((T=j.charCodeAt(_)-64)<1||T>26);++_)k=26*k+T;--k,A=k}else++A;for(_=0;_!=w.length&&w.charCodeAt(_)!==62;++_);if(++_,R=Fr(w.slice(0,_),!0),R.r||(R.r=jr({r:N-1,c:A})),j=w.slice(_),P={t:""},(E=j.match(a))!=null&&E[1]!==""&&(P.v=nn(E[1])),f.cellFormula){if((E=j.match(i))!=null&&E[1]!==""){if(P.f=nn(Nn(E[1])).replace(/\r\n/g,`
`),f.xlfn||(P.f=u3(P.f)),E[0].indexOf('t="array"')>-1)P.F=(j.match(s)||[])[1],P.F.indexOf(":")>-1&&se.push([sn(P.F),P.F]);else if(E[0].indexOf('t="shared"')>-1){H=Fr(E[0]);var ge=nn(Nn(E[1]));f.xlfn||(ge=u3(ge)),L[parseInt(H.si,10)]=[H,ge,R.r]}}else(E=j.match(/<f[^>]*\/>/))&&(H=Fr(E[0]),L[H.si]&&(P.f=rY(L[H.si][1],L[H.si][2],R.r)));var _e=ts(R.r);for(_=0;_<se.length;++_)_e.r>=se[_][0].s.r&&_e.r<=se[_][0].e.r&&_e.c>=se[_][0].s.c&&_e.c<=se[_][0].e.c&&(P.F=se[_][1])}if(R.t==null&&P.v===void 0)if(P.f||P.F)P.v=0,P.t="n";else if(O)P.t="z";else continue;else P.t=R.t||"n";switch(p.s.c>A&&(p.s.c=A),p.e.c<A&&(p.e.c=A),P.t){case"n":if(P.v==""||P.v==null){if(!O)continue;P.t="z"}else P.v=parseFloat(P.v);break;case"s":if(typeof P.v>"u"){if(!O)continue;P.t="z"}else M=Vm[parseInt(P.v,10)],P.v=M.t,P.r=M.r,f.cellHTML&&(P.h=M.h);break;case"str":P.t="s",P.v=P.v!=null?Nn(P.v):"",f.cellHTML&&(P.h=pS(P.v));break;case"inlineStr":E=j.match(n),P.t="s",E!=null&&(M=AS(E[1]))?(P.v=M.t,f.cellHTML&&(P.h=M.h)):P.v="";break;case"b":P.v=On(P.v);break;case"d":f.cellDates?P.v=Un(P.v,1):(P.v=Ys(Un(P.v,1)),P.t="n");break;case"e":(!f||f.cellText!==!1)&&(P.w=P.v),P.v=H8[P.v];break}if(Q=Z=0,te=null,ae&&R.s!==void 0&&(te=y.CellXf[R.s],te!=null&&(te.numFmtId!=null&&(Q=te.numFmtId),f.cellStyles&&te.fillId!=null&&(Z=te.fillId))),$F(P,Q,Z,f,g,y),f.cellDates&&ae&&P.t=="n"&&M0(Cr[Q])&&(P.t="d",P.v=ov(P.v)),R.cm&&f.xlmeta){var Pe=(f.xlmeta.Cell||[])[+R.cm-1];Pe&&Pe.type=="XLDAPR"&&(P.D=!0)}if(G){var ce=ts(R.r);d[ce.r]||(d[ce.r]=[]),d[ce.r][ce.c]=P}else d[R.r]=P}}}}I.length>0&&(d["!rows"]=I)}})();function oQ(e,t,r,n){var s=[],a=[],i=sn(e["!ref"]),l="",c,d="",f=[],p=0,g=0,y=e["!rows"],v=Array.isArray(e),w={r:d},b,E=-1;for(g=i.s.c;g<=i.e.c;++g)f[g]=es(g);for(p=i.s.r;p<=i.e.r;++p){for(a=[],d=Ts(p),g=i.s.c;g<=i.e.c;++g){c=f[g]+d;var k=v?(e[p]||[])[g]:e[c];k!==void 0&&(l=aQ(k,c,e,t))!=null&&a.push(l)}(a.length>0||y&&y[p])&&(w={r:d},y&&y[p]&&(b=y[p],b.hidden&&(w.hidden=1),E=-1,b.hpx?E=kp(b.hpx):b.hpt&&(E=b.hpt),E>-1&&(w.ht=E,w.customHeight=1),b.level&&(w.outlineLevel=b.level)),s[s.length]=Gt("row",a.join(""),w))}if(y)for(;p<y.length;++p)y&&y[p]&&(w={r:p+1},b=y[p],b.hidden&&(w.hidden=1),E=-1,b.hpx?E=kp(b.hpx):b.hpt&&(E=b.hpt),E>-1&&(w.ht=E,w.customHeight=1),b.level&&(w.outlineLevel=b.level),s[s.length]=Gt("row","",w));return s.join("")}function zF(e,t,r,n){var s=[Es,Gt("worksheet",null,{xmlns:Nf[0],"xmlns:r":qs.r})],a=r.SheetNames[e],i=0,l="",c=r.Sheets[a];c==null&&(c={});var d=c["!ref"]||"A1",f=sn(d);if(f.e.c>16383||f.e.r>1048575){if(t.WTF)throw new Error("Range "+d+" exceeds format limit A1:XFD1048576");f.e.c=Math.min(f.e.c,16383),f.e.r=Math.min(f.e.c,1048575),d=zr(f)}n||(n={}),c["!comments"]=[];var p=[];GJ(c,r,e,t,s),s[s.length]=Gt("dimension",null,{ref:d}),s[s.length]=sQ(c,t,e,r),t.sheetFormat&&(s[s.length]=Gt("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),c["!cols"]!=null&&c["!cols"].length>0&&(s[s.length]=ZJ(c,c["!cols"])),s[i=s.length]="<sheetData/>",c["!links"]=[],c["!ref"]!=null&&(l=oQ(c,t),l.length>0&&(s[s.length]=l)),s.length>i+1&&(s[s.length]="</sheetData>",s[i]=s[i].replace("/>",">")),c["!protect"]&&(s[s.length]=qJ(c["!protect"])),c["!autofilter"]!=null&&(s[s.length]=tQ(c["!autofilter"],c,r,e)),c["!merges"]!=null&&c["!merges"].length>0&&(s[s.length]=zJ(c["!merges"]));var g=-1,y,v=-1;return c["!links"].length>0&&(s[s.length]="<hyperlinks>",c["!links"].forEach(function(w){w[1].Target&&(y={ref:w[0]},w[1].Target.charAt(0)!="#"&&(v=_n(n,-1,bn(w[1].Target).replace(/#.*$/,""),Yr.HLINK),y["r:id"]="rId"+v),(g=w[1].Target.indexOf("#"))>-1&&(y.location=bn(w[1].Target.slice(g+1))),w[1].Tooltip&&(y.tooltip=bn(w[1].Tooltip)),s[s.length]=Gt("hyperlink",null,y))}),s[s.length]="</hyperlinks>"),delete c["!links"],c["!margins"]!=null&&(s[s.length]=JJ(c["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&(s[s.length]=Aa("ignoredErrors",Gt("ignoredError",null,{numberStoredAsText:1,sqref:d}))),p.length>0&&(v=_n(n,-1,"../drawings/drawing"+(e+1)+".xml",Yr.DRAW),s[s.length]=Gt("drawing",null,{"r:id":"rId"+v}),c["!drawing"]=p),c["!comments"].length>0&&(v=_n(n,-1,"../drawings/vmlDrawing"+(e+1)+".vml",Yr.VML),s[s.length]=Gt("legacyDrawing",null,{"r:id":"rId"+v}),c["!legacy"]=v),s.length>1&&(s[s.length]="</worksheet>",s[1]=s[1].replace("/>",">")),s.join("")}function lQ(e,t){var r={},n=e.l+t;r.r=e.read_shift(4),e.l+=4;var s=e.read_shift(2);e.l+=1;var a=e.read_shift(1);return e.l=n,a&7&&(r.level=a&7),a&16&&(r.hidden=!0),a&32&&(r.hpt=s/20),r}function cQ(e,t,r){var n=wt(145),s=(r["!rows"]||[])[e]||{};n.write_shift(4,e),n.write_shift(4,0);var a=320;s.hpx?a=kp(s.hpx)*20:s.hpt&&(a=s.hpt*20),n.write_shift(2,a),n.write_shift(1,0);var i=0;s.level&&(i|=s.level),s.hidden&&(i|=16),(s.hpx||s.hpt)&&(i|=32),n.write_shift(1,i),n.write_shift(1,0);var l=0,c=n.l;n.l+=4;for(var d={r:e,c:0},f=0;f<16;++f)if(!(t.s.c>f+1<<10||t.e.c<f<<10)){for(var p=-1,g=-1,y=f<<10;y<f+1<<10;++y){d.c=y;var v=Array.isArray(r)?(r[d.r]||[])[d.c]:r[jr(d)];v&&(p<0&&(p=y),g=y)}p<0||(++l,n.write_shift(4,p),n.write_shift(4,g))}var w=n.l;return n.l=c,n.write_shift(4,l),n.l=w,n.length>n.l?n.slice(0,n.l):n}function uQ(e,t,r,n){var s=cQ(n,r,t);(s.length>17||(t["!rows"]||[])[n])&&Nt(e,0,s)}var dQ=Ff,fQ=B0;function hQ(){}function gQ(e,t){var r={},n=e[e.l];return++e.l,r.above=!(n&64),r.left=!(n&128),e.l+=18,r.name=xG(e),r}function mQ(e,t,r){r==null&&(r=wt(84+4*e.length));var n=192;t&&(t.above&&(n&=-65),t.left&&(n&=-129)),r.write_shift(1,n);for(var s=1;s<3;++s)r.write_shift(1,0);return b1({auto:1},r),r.write_shift(-4,-1),r.write_shift(-4,-1),B8(e,r),r.slice(0,r.l)}function pQ(e){var t=Eo(e);return[t]}function xQ(e,t,r){return r==null&&(r=wt(8)),Ef(t,r)}function yQ(e){var t=jf(e);return[t]}function vQ(e,t,r){return r==null&&(r=wt(4)),Af(t,r)}function wQ(e){var t=Eo(e),r=e.read_shift(1);return[t,r,"b"]}function _Q(e,t,r){return r==null&&(r=wt(9)),Ef(t,r),r.write_shift(1,e.v?1:0),r}function bQ(e){var t=jf(e),r=e.read_shift(1);return[t,r,"b"]}function SQ(e,t,r){return r==null&&(r=wt(5)),Af(t,r),r.write_shift(1,e.v?1:0),r}function kQ(e){var t=Eo(e),r=e.read_shift(1);return[t,r,"e"]}function CQ(e,t,r){return r==null&&(r=wt(9)),Ef(t,r),r.write_shift(1,e.v),r}function TQ(e){var t=jf(e),r=e.read_shift(1);return[t,r,"e"]}function NQ(e,t,r){return r==null&&(r=wt(8)),Af(t,r),r.write_shift(1,e.v),r.write_shift(2,0),r.write_shift(1,0),r}function EQ(e){var t=Eo(e),r=e.read_shift(4);return[t,r,"s"]}function jQ(e,t,r){return r==null&&(r=wt(12)),Ef(t,r),r.write_shift(4,t.v),r}function AQ(e){var t=jf(e),r=e.read_shift(4);return[t,r,"s"]}function FQ(e,t,r){return r==null&&(r=wt(8)),Af(t,r),r.write_shift(4,t.v),r}function PQ(e){var t=Eo(e),r=Ha(e);return[t,r,"n"]}function RQ(e,t,r){return r==null&&(r=wt(16)),Ef(t,r),wf(e.v,r),r}function HF(e){var t=jf(e),r=Ha(e);return[t,r,"n"]}function DQ(e,t,r){return r==null&&(r=wt(12)),Af(t,r),wf(e.v,r),r}function IQ(e){var t=Eo(e),r=CS(e);return[t,r,"n"]}function MQ(e,t,r){return r==null&&(r=wt(12)),Ef(t,r),U8(e.v,r),r}function OQ(e){var t=jf(e),r=CS(e);return[t,r,"n"]}function LQ(e,t,r){return r==null&&(r=wt(8)),Af(t,r),U8(e.v,r),r}function BQ(e){var t=Eo(e),r=bS(e);return[t,r,"is"]}function UQ(e){var t=Eo(e),r=qa(e);return[t,r,"str"]}function $Q(e,t,r){return r==null&&(r=wt(12+4*e.v.length)),Ef(t,r),ua(e.v,r),r.length>r.l?r.slice(0,r.l):r}function WQ(e){var t=jf(e),r=qa(e);return[t,r,"str"]}function zQ(e,t,r){return r==null&&(r=wt(8+4*e.v.length)),Af(t,r),ua(e.v,r),r.length>r.l?r.slice(0,r.l):r}function HQ(e,t,r){var n=e.l+t,s=Eo(e);s.r=r["!row"];var a=e.read_shift(1),i=[s,a,"b"];if(r.cellFormula){e.l+=2;var l=uv(e,n-e.l,r);i[3]=Wa(l,null,s,r.supbooks,r)}else e.l=n;return i}function GQ(e,t,r){var n=e.l+t,s=Eo(e);s.r=r["!row"];var a=e.read_shift(1),i=[s,a,"e"];if(r.cellFormula){e.l+=2;var l=uv(e,n-e.l,r);i[3]=Wa(l,null,s,r.supbooks,r)}else e.l=n;return i}function VQ(e,t,r){var n=e.l+t,s=Eo(e);s.r=r["!row"];var a=Ha(e),i=[s,a,"n"];if(r.cellFormula){e.l+=2;var l=uv(e,n-e.l,r);i[3]=Wa(l,null,s,r.supbooks,r)}else e.l=n;return i}function KQ(e,t,r){var n=e.l+t,s=Eo(e);s.r=r["!row"];var a=qa(e),i=[s,a,"str"];if(r.cellFormula){e.l+=2;var l=uv(e,n-e.l,r);i[3]=Wa(l,null,s,r.supbooks,r)}else e.l=n;return i}var qQ=Ff,XQ=B0;function YQ(e,t){return t==null&&(t=wt(4)),t.write_shift(4,e),t}function JQ(e,t){var r=e.l+t,n=Ff(e),s=SS(e),a=qa(e),i=qa(e),l=qa(e);e.l=r;var c={rfx:n,relId:s,loc:a,display:l};return i&&(c.Tooltip=i),c}function QQ(e,t){var r=wt(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));B0({s:ts(e[0]),e:ts(e[0])},r),kS("rId"+t,r);var n=e[1].Target.indexOf("#"),s=n==-1?"":e[1].Target.slice(n+1);return ua(s||"",r),ua(e[1].Tooltip||"",r),ua("",r),r.slice(0,r.l)}function ZQ(){}function eZ(e,t,r){var n=e.l+t,s=$8(e),a=e.read_shift(1),i=[s];if(i[2]=a,r.cellFormula){var l=kJ(e,n-e.l,r);i[1]=l}else e.l=n;return i}function tZ(e,t,r){var n=e.l+t,s=Ff(e),a=[s];if(r.cellFormula){var i=TJ(e,n-e.l,r);a[1]=i,e.l=n}else e.l=n;return a}function rZ(e,t,r){r==null&&(r=wt(18));var n=dv(e,t);r.write_shift(-4,e),r.write_shift(-4,e),r.write_shift(4,(n.width||10)*256),r.write_shift(4,0);var s=0;return t.hidden&&(s|=1),typeof n.width=="number"&&(s|=2),t.level&&(s|=t.level<<8),r.write_shift(2,s),r}var GF=["left","right","top","bottom","header","footer"];function nZ(e){var t={};return GF.forEach(function(r){t[r]=Ha(e)}),t}function sZ(e,t){return t==null&&(t=wt(48)),rf(e),GF.forEach(function(r){wf(e[r],t)}),t}function aZ(e){var t=e.read_shift(2);return e.l+=28,{RTL:t&32}}function iZ(e,t,r){r==null&&(r=wt(30));var n=924;return(((t||{}).Views||[])[0]||{}).RTL&&(n|=32),r.write_shift(2,n),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,100),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(4,0),r}function oZ(e){var t=wt(24);return t.write_shift(4,4),t.write_shift(4,1),B0(e,t),t}function lZ(e,t){return t==null&&(t=wt(66)),t.write_shift(2,e.password?FS(e.password):0),t.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(r){r[1]?t.write_shift(4,e[r[0]]!=null&&!e[r[0]]?1:0):t.write_shift(4,e[r[0]]!=null&&e[r[0]]?0:1)}),t}function cZ(){}function uZ(){}function dZ(e,t,r,n,s,a,i){if(!e)return e;var l=t||{};n||(n={"!id":{}});var c=l.dense?[]:{},d,f={s:{r:2e6,c:2e6},e:{r:0,c:0}},p=!1,g=!1,y,v,w,b,E,k,_,T,j,P=[];l.biff=12,l["!row"]=0;var R=0,N=!1,A=[],M={},H=l.supbooks||s.supbooks||[[]];if(H.sharedf=M,H.arrayf=A,H.SheetNames=s.SheetNames||s.Sheets.map(function(G){return G.name}),!l.supbooks&&(l.supbooks=H,s.Names))for(var Q=0;Q<s.Names.length;++Q)H[0][Q+1]=s.Names[Q];var Z=[],ae=[],te=!1;Cp[16]={n:"BrtShortReal",f:HF};var se;if(Uc(e,function(I,z,V){if(!g)switch(V){case 148:d=I;break;case 0:y=I,l.sheetRows&&l.sheetRows<=y.r&&(g=!0),T=Ts(b=y.r),l["!row"]=y.r,(I.hidden||I.hpt||I.level!=null)&&(I.hpt&&(I.hpx=y0(I.hpt)),ae[I.r]=I);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(v={t:I[2]},I[2]){case"n":v.v=I[1];break;case"s":_=Vm[I[1]],v.v=_.t,v.r=_.r;break;case"b":v.v=!!I[1];break;case"e":v.v=I[1],l.cellText!==!1&&(v.w=$c[v.v]);break;case"str":v.t="s",v.v=I[1];break;case"is":v.t="s",v.v=I[1].t;break}if((w=i.CellXf[I[0].iStyleRef])&&$F(v,w.numFmtId,null,l,a,i),E=I[0].c==-1?E+1:I[0].c,l.dense?(c[b]||(c[b]=[]),c[b][E]=v):c[es(E)+T]=v,l.cellFormula){for(N=!1,R=0;R<A.length;++R){var O=A[R];y.r>=O[0].s.r&&y.r<=O[0].e.r&&E>=O[0].s.c&&E<=O[0].e.c&&(v.F=zr(O[0]),N=!0)}!N&&I.length>3&&(v.f=I[3])}if(f.s.r>y.r&&(f.s.r=y.r),f.s.c>E&&(f.s.c=E),f.e.r<y.r&&(f.e.r=y.r),f.e.c<E&&(f.e.c=E),l.cellDates&&w&&v.t=="n"&&M0(Cr[w.numFmtId])){var W=Vd(v.v);W&&(v.t="d",v.v=new Date(W.y,W.m-1,W.d,W.H,W.M,W.S,W.u))}se&&(se.type=="XLDAPR"&&(v.D=!0),se=void 0);break;case 1:case 12:if(!l.sheetStubs||p)break;v={t:"z",v:void 0},E=I[0].c==-1?E+1:I[0].c,l.dense?(c[b]||(c[b]=[]),c[b][E]=v):c[es(E)+T]=v,f.s.r>y.r&&(f.s.r=y.r),f.s.c>E&&(f.s.c=E),f.e.r<y.r&&(f.e.r=y.r),f.e.c<E&&(f.e.c=E),se&&(se.type=="XLDAPR"&&(v.D=!0),se=void 0);break;case 176:P.push(I);break;case 49:se=((l.xlmeta||{}).Cell||[])[I-1];break;case 494:var q=n["!id"][I.relId];for(q?(I.Target=q.Target,I.loc&&(I.Target+="#"+I.loc),I.Rel=q):I.relId==""&&(I.Target="#"+I.loc),b=I.rfx.s.r;b<=I.rfx.e.r;++b)for(E=I.rfx.s.c;E<=I.rfx.e.c;++E)l.dense?(c[b]||(c[b]=[]),c[b][E]||(c[b][E]={t:"z",v:void 0}),c[b][E].l=I):(k=jr({c:E,r:b}),c[k]||(c[k]={t:"z",v:void 0}),c[k].l=I);break;case 426:if(!l.cellFormula)break;A.push(I),j=l.dense?c[b][E]:c[es(E)+T],j.f=Wa(I[1],f,{r:y.r,c:E},H,l),j.F=zr(I[0]);break;case 427:if(!l.cellFormula)break;M[jr(I[0].s)]=I[1],j=l.dense?c[b][E]:c[es(E)+T],j.f=Wa(I[1],f,{r:y.r,c:E},H,l);break;case 60:if(!l.cellStyles)break;for(;I.e>=I.s;)Z[I.e--]={width:I.w/256,hidden:!!(I.flags&1),level:I.level},te||(te=!0,PS(I.w/256)),qu(Z[I.e+1]);break;case 161:c["!autofilter"]={ref:zr(I)};break;case 476:c["!margins"]=I;break;case 147:s.Sheets[r]||(s.Sheets[r]={}),I.name&&(s.Sheets[r].CodeName=I.name),(I.above||I.left)&&(c["!outline"]={above:I.above,left:I.left});break;case 137:s.Views||(s.Views=[{}]),s.Views[0]||(s.Views[0]={}),I.RTL&&(s.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:p=!0;break;case 36:p=!1;break;case 37:p=!0;break;case 38:p=!1;break;default:if(!z.T){if(!p||l.WTF)throw new Error("Unexpected record 0x"+V.toString(16))}}},l),delete l.supbooks,delete l["!row"],!c["!ref"]&&(f.s.r<2e6||d&&(d.e.r>0||d.e.c>0||d.s.r>0||d.s.c>0))&&(c["!ref"]=zr(d||f)),l.sheetRows&&c["!ref"]){var L=sn(c["!ref"]);l.sheetRows<=+L.e.r&&(L.e.r=l.sheetRows-1,L.e.r>f.e.r&&(L.e.r=f.e.r),L.e.r<L.s.r&&(L.s.r=L.e.r),L.e.c>f.e.c&&(L.e.c=f.e.c),L.e.c<L.s.c&&(L.s.c=L.e.c),c["!fullref"]=c["!ref"],c["!ref"]=zr(L))}return P.length>0&&(c["!merges"]=P),Z.length>0&&(c["!cols"]=Z),ae.length>0&&(c["!rows"]=ae),c}function fZ(e,t,r,n,s,a,i){if(t.v===void 0)return!1;var l="";switch(t.t){case"b":l=t.v?"1":"0";break;case"d":t=$n(t),t.z=t.z||Cr[14],t.v=Ys(Un(t.v)),t.t="n";break;case"n":case"e":l=""+t.v;break;default:l=t.v;break}var c={r,c:n};switch(c.s=id(s.cellXfs,t,s),t.l&&a["!links"].push([jr(c),t.l]),t.c&&a["!comments"].push([jr(c),t.c]),t.t){case"s":case"str":return s.bookSST?(l=OS(s.Strings,t.v,s.revStrings),c.t="s",c.v=l,i?Nt(e,18,FQ(t,c)):Nt(e,7,jQ(t,c))):(c.t="str",i?Nt(e,17,zQ(t,c)):Nt(e,6,$Q(t,c))),!0;case"n":return t.v==(t.v|0)&&t.v>-1e3&&t.v<1e3?i?Nt(e,13,LQ(t,c)):Nt(e,2,MQ(t,c)):i?Nt(e,16,DQ(t,c)):Nt(e,5,RQ(t,c)),!0;case"b":return c.t="b",i?Nt(e,15,SQ(t,c)):Nt(e,4,_Q(t,c)),!0;case"e":return c.t="e",i?Nt(e,14,NQ(t,c)):Nt(e,3,CQ(t,c)),!0}return i?Nt(e,12,vQ(t,c)):Nt(e,1,xQ(t,c)),!0}function hZ(e,t,r,n){var s=sn(t["!ref"]||"A1"),a,i="",l=[];Nt(e,145);var c=Array.isArray(t),d=s.e.r;t["!rows"]&&(d=Math.max(s.e.r,t["!rows"].length-1));for(var f=s.s.r;f<=d;++f){i=Ts(f),uQ(e,t,s,f);var p=!1;if(f<=s.e.r)for(var g=s.s.c;g<=s.e.c;++g){f===s.s.r&&(l[g]=es(g)),a=l[g]+i;var y=c?(t[f]||[])[g]:t[a];if(!y){p=!1;continue}p=fZ(e,y,f,g,n,t,p)}}Nt(e,146)}function gZ(e,t){!t||!t["!merges"]||(Nt(e,177,YQ(t["!merges"].length)),t["!merges"].forEach(function(r){Nt(e,176,XQ(r))}),Nt(e,178))}function mZ(e,t){!t||!t["!cols"]||(Nt(e,390),t["!cols"].forEach(function(r,n){r&&Nt(e,60,rZ(n,r))}),Nt(e,391))}function pZ(e,t){!t||!t["!ref"]||(Nt(e,648),Nt(e,649,oZ(sn(t["!ref"]))),Nt(e,650))}function xZ(e,t,r){t["!links"].forEach(function(n){if(n[1].Target){var s=_n(r,-1,n[1].Target.replace(/#.*$/,""),Yr.HLINK);Nt(e,494,QQ(n,s))}}),delete t["!links"]}function yZ(e,t,r,n){if(t["!comments"].length>0){var s=_n(n,-1,"../drawings/vmlDrawing"+(r+1)+".vml",Yr.VML);Nt(e,551,kS("rId"+s)),t["!legacy"]=s}}function vZ(e,t,r,n){if(t["!autofilter"]){var s=t["!autofilter"],a=typeof s.ref=="string"?s.ref:zr(s.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var i=r.Workbook.Names,l=Di(a);l.s.r==l.e.r&&(l.e.r=Di(t["!ref"]).e.r,a=zr(l));for(var c=0;c<i.length;++c){var d=i[c];if(d.Name=="_xlnm._FilterDatabase"&&d.Sheet==n){d.Ref="'"+r.SheetNames[n]+"'!"+a;break}}c==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+r.SheetNames[n]+"'!"+a}),Nt(e,161,B0(sn(a))),Nt(e,162)}}function wZ(e,t,r){Nt(e,133),Nt(e,137,iZ(t,r)),Nt(e,138),Nt(e,134)}function _Z(e,t){t["!protect"]&&Nt(e,535,lZ(t["!protect"]))}function bZ(e,t,r,n){var s=Ri(),a=r.SheetNames[e],i=r.Sheets[a]||{},l=a;try{r&&r.Workbook&&(l=r.Workbook.Sheets[e].CodeName||l)}catch{}var c=sn(i["!ref"]||"A1");if(c.e.c>16383||c.e.r>1048575){if(t.WTF)throw new Error("Range "+(i["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");c.e.c=Math.min(c.e.c,16383),c.e.r=Math.min(c.e.c,1048575)}return i["!links"]=[],i["!comments"]=[],Nt(s,129),(r.vbaraw||i["!outline"])&&Nt(s,147,mQ(l,i["!outline"])),Nt(s,148,fQ(c)),wZ(s,i,r.Workbook),mZ(s,i),hZ(s,i,e,t),_Z(s,i),vZ(s,i,r,e),gZ(s,i),xZ(s,i,n),i["!margins"]&&Nt(s,476,sZ(i["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&pZ(s,i),yZ(s,i,e,n),Nt(s,130),s.end()}function SZ(e){var t=[],r=e.match(/^<c:numCache>/),n;(e.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(a){var i=a.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);i&&(t[+i[1]]=r?+i[2]:i[2])});var s=nn((e.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(e.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(a){n=a.replace(/<.*?>/g,"")}),[t,s,n]}function kZ(e,t,r,n,s,a){var i=a||{"!type":"chart"};if(!e)return a;var l=0,c=0,d="A",f={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(e.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(p){var g=SZ(p);f.s.r=f.s.c=0,f.e.c=l,d=es(l),g[0].forEach(function(y,v){i[d+Ts(v)]={t:"n",v:y,z:g[1]},c=v}),f.e.r<c&&(f.e.r=c),++l}),l>0&&(i["!ref"]=zr(f)),i}function CZ(e,t,r,n,s){if(!e)return e;n||(n={"!id":{}});var a={"!type":"chart","!drawel":null,"!rel":""},i,l=e.match(WF);return l&&LS(l[0],a,s,r),(i=e.match(/drawing r:id="(.*?)"/))&&(a["!rel"]=i[1]),n["!id"][a["!rel"]]&&(a["!drawel"]=n["!id"][a["!rel"]]),a}function TZ(e,t){e.l+=10;var r=qa(e);return{name:r}}function NZ(e,t,r,n,s){if(!e)return e;n||(n={"!id":{}});var a={"!type":"chart","!drawel":null,"!rel":""},i=!1;return Uc(e,function(c,d,f){switch(f){case 550:a["!rel"]=c;break;case 651:s.Sheets[r]||(s.Sheets[r]={}),c.name&&(s.Sheets[r].CodeName=c.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:i=!0;break;case 36:i=!1;break;case 37:break;case 38:break;default:if(!(d.T>0)){if(!(d.T<0)){if(!i||t.WTF)throw new Error("Unexpected record 0x"+f.toString(16))}}}},t),n["!id"][a["!rel"]]&&(a["!drawel"]=n["!id"][a["!rel"]]),a}var BS=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],EZ=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],jZ=[],AZ=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function m3(e,t){for(var r=0;r!=e.length;++r)for(var n=e[r],s=0;s!=t.length;++s){var a=t[s];if(n[a[0]]==null)n[a[0]]=a[1];else switch(a[2]){case"bool":typeof n[a[0]]=="string"&&(n[a[0]]=On(n[a[0]]));break;case"int":typeof n[a[0]]=="string"&&(n[a[0]]=parseInt(n[a[0]],10));break}}}function p3(e,t){for(var r=0;r!=t.length;++r){var n=t[r];if(e[n[0]]==null)e[n[0]]=n[1];else switch(n[2]){case"bool":typeof e[n[0]]=="string"&&(e[n[0]]=On(e[n[0]]));break;case"int":typeof e[n[0]]=="string"&&(e[n[0]]=parseInt(e[n[0]],10));break}}}function VF(e){p3(e.WBProps,BS),p3(e.CalcPr,AZ),m3(e.WBView,EZ),m3(e.Sheets,jZ),i0.date1904=On(e.WBProps.date1904)}function FZ(e){return!e.Workbook||!e.Workbook.WBProps?"false":On(e.Workbook.WBProps.date1904)?"true":"false"}var PZ="][*?/\\".split("");function KF(e,t){if(e.length>31)throw new Error("Sheet names cannot exceed 31 chars");var r=!0;return PZ.forEach(function(n){if(e.indexOf(n)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),r}function RZ(e,t,r){e.forEach(function(n,s){KF(n);for(var a=0;a<s;++a)if(n==e[a])throw new Error("Duplicate Sheet Name: "+n);if(r){var i=t&&t[s]&&t[s].CodeName||n;if(i.charCodeAt(0)==95&&i.length>22)throw new Error("Bad Code Name: Worksheet"+i)}})}function DZ(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");var t=e.Workbook&&e.Workbook.Sheets||[];RZ(e.SheetNames,t,!!e.vbaraw);for(var r=0;r<e.SheetNames.length;++r)FJ(e.Sheets[e.SheetNames[r]],e.SheetNames[r],r)}var IZ=/<\w+:workbook/;function MZ(e,t){if(!e)throw new Error("Could not find file");var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},n=!1,s="xmlns",a={},i=0;if(e.replace(Ja,function(c,d){var f=Fr(c);switch(zl(f[0])){case"<?xml":break;case"<workbook":c.match(IZ)&&(s="xmlns"+c.match(/<(\w+):/)[1]),r.xmlns=f[s];break;case"</workbook>":break;case"<fileVersion":delete f[0],r.AppVersion=f;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":BS.forEach(function(p){if(f[p[0]]!=null)switch(p[2]){case"bool":r.WBProps[p[0]]=On(f[p[0]]);break;case"int":r.WBProps[p[0]]=parseInt(f[p[0]],10);break;default:r.WBProps[p[0]]=f[p[0]]}}),f.codeName&&(r.WBProps.CodeName=Nn(f.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete f[0],r.WBView.push(f);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(f.state){case"hidden":f.Hidden=1;break;case"veryHidden":f.Hidden=2;break;default:f.Hidden=0}delete f.state,f.name=nn(Nn(f.name)),delete f[0],r.Sheets.push(f);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":n=!0;break;case"</definedNames>":n=!1;break;case"<definedName":a={},a.Name=Nn(f.name),f.comment&&(a.Comment=f.comment),f.localSheetId&&(a.Sheet=+f.localSheetId),On(f.hidden||"0")&&(a.Hidden=!0),i=d+c.length;break;case"</definedName>":a.Ref=nn(Nn(e.slice(i,d))),r.Names.push(a);break;case"<definedName/>":break;case"<calcPr":delete f[0],r.CalcPr=f;break;case"<calcPr/>":delete f[0],r.CalcPr=f;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":n=!0;break;case"</AlternateContent>":n=!1;break;case"<revisionPtr":break;default:if(!n&&t.WTF)throw new Error("unrecognized "+f[0]+" in workbook")}return c}),Nf.indexOf(r.xmlns)===-1)throw new Error("Unknown Namespace: "+r.xmlns);return VF(r),r}function qF(e){var t=[Es];t[t.length]=Gt("workbook",null,{xmlns:Nf[0],"xmlns:r":qs.r});var r=e.Workbook&&(e.Workbook.Names||[]).length>0,n={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(BS.forEach(function(l){e.Workbook.WBProps[l[0]]!=null&&e.Workbook.WBProps[l[0]]!=l[1]&&(n[l[0]]=e.Workbook.WBProps[l[0]])}),e.Workbook.WBProps.CodeName&&(n.codeName=e.Workbook.WBProps.CodeName,delete n.CodeName)),t[t.length]=Gt("workbookPr",null,n);var s=e.Workbook&&e.Workbook.Sheets||[],a=0;if(s&&s[0]&&s[0].Hidden){for(t[t.length]="<bookViews>",a=0;a!=e.SheetNames.length&&!(!s[a]||!s[a].Hidden);++a);a==e.SheetNames.length&&(a=0),t[t.length]='<workbookView firstSheet="'+a+'" activeTab="'+a+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",a=0;a!=e.SheetNames.length;++a){var i={name:bn(e.SheetNames[a].slice(0,31))};if(i.sheetId=""+(a+1),i["r:id"]="rId"+(a+1),s[a])switch(s[a].Hidden){case 1:i.state="hidden";break;case 2:i.state="veryHidden";break}t[t.length]=Gt("sheet",null,i)}return t[t.length]="</sheets>",r&&(t[t.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach(function(l){var c={name:l.Name};l.Comment&&(c.comment=l.Comment),l.Sheet!=null&&(c.localSheetId=""+l.Sheet),l.Hidden&&(c.hidden="1"),l.Ref&&(t[t.length]=Gt("definedName",bn(l.Ref),c))}),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function OZ(e,t){var r={};return r.Hidden=e.read_shift(4),r.iTabID=e.read_shift(4),r.strRelID=u2(e),r.name=qa(e),r}function LZ(e,t){return t||(t=wt(127)),t.write_shift(4,e.Hidden),t.write_shift(4,e.iTabID),kS(e.strRelID,t),ua(e.name.slice(0,31),t),t.length>t.l?t.slice(0,t.l):t}function BZ(e,t){var r={},n=e.read_shift(4);r.defaultThemeVersion=e.read_shift(4);var s=t>8?qa(e):"";return s.length>0&&(r.CodeName=s),r.autoCompressPictures=!!(n&65536),r.backupFile=!!(n&64),r.checkCompatibility=!!(n&4096),r.date1904=!!(n&1),r.filterPrivacy=!!(n&8),r.hidePivotFieldList=!!(n&1024),r.promptedSolutions=!!(n&16),r.publishItems=!!(n&2048),r.refreshAllConnections=!!(n&262144),r.saveExternalLinkValues=!!(n&128),r.showBorderUnselectedTables=!!(n&4),r.showInkAnnotation=!!(n&32),r.showObjects=["all","placeholders","none"][n>>13&3],r.showPivotChartFilter=!!(n&32768),r.updateLinks=["userSet","never","always"][n>>8&3],r}function UZ(e,t){t||(t=wt(72));var r=0;return e&&e.filterPrivacy&&(r|=8),t.write_shift(4,r),t.write_shift(4,0),B8(e&&e.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}function $Z(e,t){var r={};return e.read_shift(4),r.ArchID=e.read_shift(4),e.l+=t-8,r}function WZ(e,t,r){var n=e.l+t;e.l+=4,e.l+=1;var s=e.read_shift(4),a=yG(e),i=CJ(e,0,r),l=SS(e);e.l=n;var c={Name:a,Ptg:i};return s<268435455&&(c.Sheet=s),l&&(c.Comment=l),c}function zZ(e,t){var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},n=[],s=!1;t||(t={}),t.biff=12;var a=[],i=[[]];return i.SheetNames=[],i.XTI=[],Cp[16]={n:"BrtFRTArchID$",f:$Z},Uc(e,function(c,d,f){switch(f){case 156:i.SheetNames.push(c.name),r.Sheets.push(c);break;case 153:r.WBProps=c;break;case 39:c.Sheet!=null&&(t.SID=c.Sheet),c.Ref=Wa(c.Ptg,null,null,i,t),delete t.SID,delete c.Ptg,a.push(c);break;case 1036:break;case 357:case 358:case 355:case 667:i[0].length?i.push([f,c]):i[0]=[f,c],i[i.length-1].XTI=[];break;case 362:i.length===0&&(i[0]=[],i[0].XTI=[]),i[i.length-1].XTI=i[i.length-1].XTI.concat(c),i.XTI=i.XTI.concat(c);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:n.push(f),s=!0;break;case 36:n.pop(),s=!1;break;case 37:n.push(f),s=!0;break;case 38:n.pop(),s=!1;break;case 16:break;default:if(!d.T){if(!s||t.WTF&&n[n.length-1]!=37&&n[n.length-1]!=35)throw new Error("Unexpected record 0x"+f.toString(16))}}},t),VF(r),r.Names=a,r.supbooks=i,r}function HZ(e,t){Nt(e,143);for(var r=0;r!=t.SheetNames.length;++r){var n=t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[r]&&t.Workbook.Sheets[r].Hidden||0,s={Hidden:n,iTabID:r+1,strRelID:"rId"+(r+1),name:t.SheetNames[r]};Nt(e,156,LZ(s))}Nt(e,144)}function GZ(e,t){t||(t=wt(127));for(var r=0;r!=4;++r)t.write_shift(4,0);return ua("SheetJS",t),ua(m1.version,t),ua(m1.version,t),ua("7262",t),t.length>t.l?t.slice(0,t.l):t}function VZ(e,t){t||(t=wt(29)),t.write_shift(-4,0),t.write_shift(-4,460),t.write_shift(4,28800),t.write_shift(4,17600),t.write_shift(4,500),t.write_shift(4,e),t.write_shift(4,e);var r=120;return t.write_shift(1,r),t.length>t.l?t.slice(0,t.l):t}function KZ(e,t){if(!(!t.Workbook||!t.Workbook.Sheets)){for(var r=t.Workbook.Sheets,n=0,s=-1,a=-1;n<r.length;++n)!r[n]||!r[n].Hidden&&s==-1?s=n:r[n].Hidden==1&&a==-1&&(a=n);a>s||(Nt(e,135),Nt(e,158,VZ(s)),Nt(e,136))}}function qZ(e,t){var r=Ri();return Nt(r,131),Nt(r,128,GZ()),Nt(r,153,UZ(e.Workbook&&e.Workbook.WBProps||null)),KZ(r,e),HZ(r,e),Nt(r,132),r.end()}function XZ(e,t,r){return t.slice(-4)===".bin"?zZ(e,r):MZ(e,r)}function YZ(e,t,r,n,s,a,i,l){return t.slice(-4)===".bin"?dZ(e,n,r,s,a,i,l):WJ(e,n,r,s,a,i,l)}function JZ(e,t,r,n,s,a,i,l){return t.slice(-4)===".bin"?NZ(e,n,r,s,a):CZ(e,n,r,s,a)}function QZ(e,t,r,n,s,a,i,l){return t.slice(-4)===".bin"?eY():tY()}function ZZ(e,t,r,n,s,a,i,l){return t.slice(-4)===".bin"?QX():ZX()}function eee(e,t,r,n){return t.slice(-4)===".bin"?Xq(e,r,n):Oq(e,r,n)}function tee(e,t,r){return EF(e,r)}function ree(e,t,r){return t.slice(-4)===".bin"?rq(e,r):ZK(e,r)}function nee(e,t,r){return t.slice(-4)===".bin"?KX(e,r):LX(e,r)}function see(e,t,r){return t.slice(-4)===".bin"?IX(e):RX(e)}function aee(e,t,r,n){return r.slice(-4)===".bin"?MX(e,t,r,n):void 0}function iee(e,t,r){return t.slice(-4)===".bin"?AX(e,t,r):PX(e,t,r)}function oee(e,t,r){return(t.slice(-4)===".bin"?qZ:qF)(e)}function lee(e,t,r,n,s){return(t.slice(-4)===".bin"?bZ:zF)(e,r,n,s)}function cee(e,t,r){return(t.slice(-4)===".bin"?aX:TF)(e,r)}function uee(e,t,r){return(t.slice(-4)===".bin"?aq:yF)(e,r)}function dee(e,t,r){return(t.slice(-4)===".bin"?qX:FF)(e)}function fee(e){return(e.slice(-4)===".bin"?FX:jF)()}var XF=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,YF=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function Ho(e,t){var r=e.split(/\s+/),n=[];if(n[0]=r[0],r.length===1)return n;var s=e.match(XF),a,i,l,c;if(s)for(c=0;c!=s.length;++c)a=s[c].match(YF),(i=a[1].indexOf(":"))===-1?n[a[1]]=a[2].slice(1,a[2].length-1):(a[1].slice(0,6)==="xmlns:"?l="xmlns"+a[1].slice(6):l=a[1].slice(i+1),n[l]=a[2].slice(1,a[2].length-1));return n}function hee(e){var t=e.split(/\s+/),r={};if(t.length===1)return r;var n=e.match(XF),s,a,i,l;if(n)for(l=0;l!=n.length;++l)s=n[l].match(YF),(a=s[1].indexOf(":"))===-1?r[s[1]]=s[2].slice(1,s[2].length-1):(s[1].slice(0,6)==="xmlns:"?i="xmlns"+s[1].slice(6):i=s[1].slice(a+1),r[i]=s[2].slice(1,s[2].length-1));return r}var qm;function gee(e,t){var r=qm[e]||nn(e);return r==="General"?yf(t):No(r,t)}function mee(e,t,r,n){var s=n;switch((r[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":s=On(n);break;case"i2":case"int":s=parseInt(n,10);break;case"r4":case"float":s=parseFloat(n);break;case"date":case"dateTime.tz":s=Un(n);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+r[0])}e[nn(t)]=s}function pee(e,t,r){if(e.t!=="z"){if(!r||r.cellText!==!1)try{e.t==="e"?e.w=e.w||$c[e.v]:t==="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=pp(e.v):e.w=yf(e.v):e.w=gee(t||"General",e.v)}catch(a){if(r.WTF)throw a}try{var n=qm[t]||t||"General";if(r.cellNF&&(e.z=n),r.cellDates&&e.t=="n"&&M0(n)){var s=Vd(e.v);s&&(e.t="d",e.v=new Date(s.y,s.m-1,s.d,s.H,s.M,s.S,s.u))}}catch(a){if(r.WTF)throw a}}}function xee(e,t,r){if(r.cellStyles&&t.Interior){var n=t.Interior;n.Pattern&&(n.patternType=jq[n.Pattern]||n.Pattern)}e[t.ID]=t}function yee(e,t,r,n,s,a,i,l,c,d){var f="General",p=n.StyleID,g={};d=d||{};var y=[],v=0;for(p===void 0&&l&&(p=l.StyleID),p===void 0&&i&&(p=i.StyleID);a[p]!==void 0&&(a[p].nf&&(f=a[p].nf),a[p].Interior&&y.push(a[p].Interior),!!a[p].Parent);)p=a[p].Parent;switch(r.Type){case"Boolean":n.t="b",n.v=On(e);break;case"String":n.t="s",n.r=RE(nn(e)),n.v=e.indexOf("<")>-1?nn(t||e).replace(/<.*?>/g,""):n.r;break;case"DateTime":e.slice(-1)!="Z"&&(e+="Z"),n.v=(Un(e)-new Date(Date.UTC(1899,11,30)))/(1440*60*1e3),n.v!==n.v?n.v=nn(e):n.v<60&&(n.v=n.v-1),(!f||f=="General")&&(f="yyyy-mm-dd");case"Number":n.v===void 0&&(n.v=+e),n.t||(n.t="n");break;case"Error":n.t="e",n.v=H8[e],d.cellText!==!1&&(n.w=e);break;default:e==""&&t==""?n.t="z":(n.t="s",n.v=RE(t||e));break}if(pee(n,f,d),d.cellFormula!==!1)if(n.Formula){var w=nn(n.Formula);w.charCodeAt(0)==61&&(w=w.slice(1)),n.f=a0(w,s),delete n.Formula,n.ArrayRange=="RC"?n.F=a0("RC:RC",s):n.ArrayRange&&(n.F=a0(n.ArrayRange,s),c.push([sn(n.F),n.F]))}else for(v=0;v<c.length;++v)s.r>=c[v][0].s.r&&s.r<=c[v][0].e.r&&s.c>=c[v][0].s.c&&s.c<=c[v][0].e.c&&(n.F=c[v][1]);d.cellStyles&&(y.forEach(function(b){!g.patternType&&b.patternType&&(g.patternType=b.patternType)}),n.s=g),n.StyleID!==void 0&&(n.ixfe=n.StyleID)}function vee(e){e.t=e.v||"",e.t=e.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.v=e.w=e.ixfe=void 0}function Jw(e,t){var r=t||{};O0();var n=jm(xS(e));(r.type=="binary"||r.type=="array"||r.type=="base64")&&(n=Nn(n));var s=n.slice(0,1024).toLowerCase(),a=!1;if(s=s.replace(/".*?"/g,""),(s.indexOf(">")&1023)>Math.min(s.indexOf(",")&1023,s.indexOf(";")&1023)){var i=$n(r);return i.type="string",x0.to_workbook(n,i)}if(s.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(It){s.indexOf("<"+It)>=0&&(a=!0)}),a)return ste(n,r);qm={"General Number":"General","General Date":Cr[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":Cr[15],"Short Date":Cr[14],"Long Time":Cr[19],"Medium Time":Cr[18],"Short Time":Cr[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:Cr[2],Standard:Cr[4],Percent:Cr[10],Scientific:Cr[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var l,c=[],d,f={},p=[],g=r.dense?[]:{},y="",v={},w={},b=Ho('<Data ss:Type="String">'),E=0,k=0,_=0,T={s:{r:2e6,c:2e6},e:{r:0,c:0}},j={},P={},R="",N=0,A=[],M={},H={},Q=0,Z=[],ae=[],te={},se=[],L,G=!1,I=[],z=[],V={},O=0,W=0,q={Sheets:[],WBProps:{date1904:!1}},Y={};vp.lastIndex=0,n=n.replace(/<!--([\s\S]*?)-->/mg,"");for(var ee="";l=vp.exec(n);)switch(l[3]=(ee=l[3]).toLowerCase()){case"data":if(ee=="data"){if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break}if(c[c.length-1][1])break;l[1]==="/"?yee(n.slice(E,l.index),R,b,c[c.length-1][0]=="comment"?te:v,{c:k,r:_},j,se[k],w,I,r):(R="",b=Ho(l[0]),E=l.index+l[0].length);break;case"cell":if(l[1]==="/")if(ae.length>0&&(v.c=ae),(!r.sheetRows||r.sheetRows>_)&&v.v!==void 0&&(r.dense?(g[_]||(g[_]=[]),g[_][k]=v):g[es(k)+Ts(_)]=v),v.HRef&&(v.l={Target:nn(v.HRef)},v.HRefScreenTip&&(v.l.Tooltip=v.HRefScreenTip),delete v.HRef,delete v.HRefScreenTip),(v.MergeAcross||v.MergeDown)&&(O=k+(parseInt(v.MergeAcross,10)|0),W=_+(parseInt(v.MergeDown,10)|0),A.push({s:{c:k,r:_},e:{c:O,r:W}})),!r.sheetStubs)v.MergeAcross?k=O+1:++k;else if(v.MergeAcross||v.MergeDown){for(var X=k;X<=O;++X)for(var ne=_;ne<=W;++ne)(X>k||ne>_)&&(r.dense?(g[ne]||(g[ne]=[]),g[ne][X]={t:"z"}):g[es(X)+Ts(ne)]={t:"z"});k=O+1}else++k;else v=hee(l[0]),v.Index&&(k=+v.Index-1),k<T.s.c&&(T.s.c=k),k>T.e.c&&(T.e.c=k),l[0].slice(-2)==="/>"&&++k,ae=[];break;case"row":l[1]==="/"||l[0].slice(-2)==="/>"?(_<T.s.r&&(T.s.r=_),_>T.e.r&&(T.e.r=_),l[0].slice(-2)==="/>"&&(w=Ho(l[0]),w.Index&&(_=+w.Index-1)),k=0,++_):(w=Ho(l[0]),w.Index&&(_=+w.Index-1),V={},(w.AutoFitHeight=="0"||w.Height)&&(V.hpx=parseInt(w.Height,10),V.hpt=kp(V.hpx),z[_]=V),w.Hidden=="1"&&(V.hidden=!0,z[_]=V));break;case"worksheet":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"));p.push(y),T.s.r<=T.e.r&&T.s.c<=T.e.c&&(g["!ref"]=zr(T),r.sheetRows&&r.sheetRows<=T.e.r&&(g["!fullref"]=g["!ref"],T.e.r=r.sheetRows-1,g["!ref"]=zr(T))),A.length&&(g["!merges"]=A),se.length>0&&(g["!cols"]=se),z.length>0&&(g["!rows"]=z),f[y]=g}else T={s:{r:2e6,c:2e6},e:{r:0,c:0}},_=k=0,c.push([l[3],!1]),d=Ho(l[0]),y=nn(d.Name),g=r.dense?[]:{},A=[],I=[],z=[],Y={name:y,Hidden:0},q.Sheets.push(Y);break;case"table":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else{if(l[0].slice(-2)=="/>")break;c.push([l[3],!1]),se=[],G=!1}break;case"style":l[1]==="/"?xee(j,P,r):P=Ho(l[0]);break;case"numberformat":P.nf=nn(Ho(l[0]).Format||"General"),qm[P.nf]&&(P.nf=qm[P.nf]);for(var ge=0;ge!=392&&Cr[ge]!=P.nf;++ge);if(ge==392){for(ge=57;ge!=392;++ge)if(Cr[ge]==null){jc(P.nf,ge);break}}break;case"column":if(c[c.length-1][0]!=="table")break;if(L=Ho(l[0]),L.Hidden&&(L.hidden=!0,delete L.Hidden),L.Width&&(L.wpx=parseInt(L.Width,10)),!G&&L.wpx>10){G=!0,za=kF;for(var _e=0;_e<se.length;++_e)se[_e]&&qu(se[_e])}G&&qu(L),se[L.Index-1||se.length]=L;for(var Pe=0;Pe<+L.Span;++Pe)se[se.length]=$n(L);break;case"namedrange":if(l[1]==="/")break;q.Names||(q.Names=[]);var ce=Fr(l[0]),ye={Name:ce.Name,Ref:a0(ce.RefersTo.slice(1),{r:0,c:0})};q.Sheets.length>0&&(ye.Sheet=q.Sheets.length-1),q.Names.push(ye);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(l[0].slice(-2)==="/>")break;l[1]==="/"?R+=n.slice(N,l.index):N=l.index+l[0].length;break;case"interior":if(!r.cellStyles)break;P.Interior=Ho(l[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(l[0].slice(-2)==="/>")break;l[1]==="/"?zG(M,ee,n.slice(Q,l.index)):Q=l.index+l[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else c.push([l[3],!1]);break;case"comment":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"));vee(te),ae.push(te)}else c.push([l[3],!1]),d=Ho(l[0]),te={a:d.Author};break;case"autofilter":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else if(l[0].charAt(l[0].length-2)!=="/"){var Fe=Ho(l[0]);g["!autofilter"]={ref:a0(Fe.Range).replace(/\$/g,"")},c.push([l[3],!0])}break;case"name":break;case"datavalidation":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break;case"null":break;default:if(c.length==0&&l[3]=="document"||c.length==0&&l[3]=="uof")return _3(n,r);var Me=!0;switch(c[c.length-1][0]){case"officedocumentsettings":switch(l[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:Me=!1}break;case"componentoptions":switch(l[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:Me=!1}break;case"excelworkbook":switch(l[3]){case"date1904":q.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:Me=!1}break;case"workbookoptions":switch(l[3]){case"owcversion":break;case"height":break;case"width":break;default:Me=!1}break;case"worksheetoptions":switch(l[3]){case"visible":if(l[0].slice(-2)!=="/>")if(l[1]==="/")switch(n.slice(Q,l.index)){case"SheetHidden":Y.Hidden=1;break;case"SheetVeryHidden":Y.Hidden=2;break}else Q=l.index+l[0].length;break;case"header":g["!margins"]||rf(g["!margins"]={},"xlml"),isNaN(+Fr(l[0]).Margin)||(g["!margins"].header=+Fr(l[0]).Margin);break;case"footer":g["!margins"]||rf(g["!margins"]={},"xlml"),isNaN(+Fr(l[0]).Margin)||(g["!margins"].footer=+Fr(l[0]).Margin);break;case"pagemargins":var Oe=Fr(l[0]);g["!margins"]||rf(g["!margins"]={},"xlml"),isNaN(+Oe.Top)||(g["!margins"].top=+Oe.Top),isNaN(+Oe.Left)||(g["!margins"].left=+Oe.Left),isNaN(+Oe.Right)||(g["!margins"].right=+Oe.Right),isNaN(+Oe.Bottom)||(g["!margins"].bottom=+Oe.Bottom);break;case"displayrighttoleft":q.Views||(q.Views=[]),q.Views[0]||(q.Views[0]={}),q.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":g["!outline"]||(g["!outline"]={}),g["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":g["!outline"]||(g["!outline"]={}),g["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:Me=!1}break;case"pivottable":case"pivotcache":switch(l[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:Me=!1}break;case"pagebreaks":switch(l[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:Me=!1}break;case"autofilter":switch(l[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:Me=!1}break;case"querytable":switch(l[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:Me=!1}break;case"datavalidation":switch(l[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:Me=!1}break;case"sorting":case"conditionalformatting":switch(l[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:Me=!1}break;case"mapinfo":case"schema":case"data":switch(l[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:Me=!1}break;case"smarttags":break;default:Me=!1;break}if(Me||l[3].match(/!\[CDATA/))break;if(!c[c.length-1][1])throw"Unrecognized tag: "+l[3]+"|"+c.join("|");if(c[c.length-1][0]==="customdocumentproperties"){if(l[0].slice(-2)==="/>")break;l[1]==="/"?mee(H,ee,Z,n.slice(Q,l.index)):(Z=l,Q=l.index+l[0].length);break}if(r.WTF)throw"Unrecognized tag: "+l[3]+"|"+c.join("|")}var He={};return!r.bookSheets&&!r.bookProps&&(He.Sheets=f),He.SheetNames=p,He.Workbook=q,He.SSF=$n(Cr),He.Props=M,He.Custprops=H,He}function x2(e,t){switch($S(t=t||{}),t.type||"base64"){case"base64":return Jw(Yi(e),t);case"binary":case"buffer":case"file":return Jw(e,t);case"array":return Jw(sd(e),t)}}function wee(e,t){var r=[];return e.Props&&r.push(HG(e.Props,t)),e.Custprops&&r.push(GG(e.Props,e.Custprops)),r.join("")}function _ee(){return""}function bee(e,t){var r=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach(function(n,s){var a=[];a.push(Gt("NumberFormat",null,{"ss:Format":bn(Cr[n.numFmtId])}));var i={"ss:ID":"s"+(21+s)};r.push(Gt("Style",a.join(""),i))}),Gt("Styles",r.join(""))}function JF(e){return Gt("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+IS(e.Ref,{r:0,c:0})})}function See(e){if(!((e||{}).Workbook||{}).Names)return"";for(var t=e.Workbook.Names,r=[],n=0;n<t.length;++n){var s=t[n];s.Sheet==null&&(s.Name.match(/^_xlfn\./)||r.push(JF(s)))}return Gt("Names",r.join(""))}function kee(e,t,r,n){if(!e||!((n||{}).Workbook||{}).Names)return"";for(var s=n.Workbook.Names,a=[],i=0;i<s.length;++i){var l=s[i];l.Sheet==r&&(l.Name.match(/^_xlfn\./)||a.push(JF(l)))}return a.join("")}function Cee(e,t,r,n){if(!e)return"";var s=[];if(e["!margins"]&&(s.push("<PageSetup>"),e["!margins"].header&&s.push(Gt("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&s.push(Gt("Footer",null,{"x:Margin":e["!margins"].footer})),s.push(Gt("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),s.push("</PageSetup>")),n&&n.Workbook&&n.Workbook.Sheets&&n.Workbook.Sheets[r])if(n.Workbook.Sheets[r].Hidden)s.push(Gt("Visible",n.Workbook.Sheets[r].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var a=0;a<r&&!(n.Workbook.Sheets[a]&&!n.Workbook.Sheets[a].Hidden);++a);a==r&&s.push("<Selected/>")}return((((n||{}).Workbook||{}).Views||[])[0]||{}).RTL&&s.push("<DisplayRightToLeft/>"),e["!protect"]&&(s.push(Aa("ProtectContents","True")),e["!protect"].objects&&s.push(Aa("ProtectObjects","True")),e["!protect"].scenarios&&s.push(Aa("ProtectScenarios","True")),e["!protect"].selectLockedCells!=null&&!e["!protect"].selectLockedCells?s.push(Aa("EnableSelection","NoSelection")):e["!protect"].selectUnlockedCells!=null&&!e["!protect"].selectUnlockedCells&&s.push(Aa("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(i){e["!protect"][i[0]]&&s.push("<"+i[1]+"/>")})),s.length==0?"":Gt("WorksheetOptions",s.join(""),{xmlns:Gi.x})}function Tee(e){return e.map(function(t){var r=KH(t.t||""),n=Gt("ss:Data",r,{xmlns:"http://www.w3.org/TR/REC-html40"});return Gt("Comment",n,{"ss:Author":t.a})}).join("")}function Nee(e,t,r,n,s,a,i){if(!e||e.v==null&&e.f==null)return"";var l={};if(e.f&&(l["ss:Formula"]="="+bn(IS(e.f,i))),e.F&&e.F.slice(0,t.length)==t){var c=ts(e.F.slice(t.length+1));l["ss:ArrayRange"]="RC:R"+(c.r==i.r?"":"["+(c.r-i.r)+"]")+"C"+(c.c==i.c?"":"["+(c.c-i.c)+"]")}if(e.l&&e.l.Target&&(l["ss:HRef"]=bn(e.l.Target),e.l.Tooltip&&(l["x:HRefScreenTip"]=bn(e.l.Tooltip))),r["!merges"])for(var d=r["!merges"],f=0;f!=d.length;++f)d[f].s.c!=i.c||d[f].s.r!=i.r||(d[f].e.c>d[f].s.c&&(l["ss:MergeAcross"]=d[f].e.c-d[f].s.c),d[f].e.r>d[f].s.r&&(l["ss:MergeDown"]=d[f].e.r-d[f].s.r));var p="",g="";switch(e.t){case"z":if(!n.sheetStubs)return"";break;case"n":p="Number",g=String(e.v);break;case"b":p="Boolean",g=e.v?"1":"0";break;case"e":p="Error",g=$c[e.v];break;case"d":p="DateTime",g=new Date(e.v).toISOString(),e.z==null&&(e.z=e.z||Cr[14]);break;case"s":p="String",g=VH(e.v||"");break}var y=id(n.cellXfs,e,n);l["ss:StyleID"]="s"+(21+y),l["ss:Index"]=i.c+1;var v=e.v!=null?g:"",w=e.t=="z"?"":'<Data ss:Type="'+p+'">'+v+"</Data>";return(e.c||[]).length>0&&(w+=Tee(e.c)),Gt("Cell",w,l)}function Eee(e,t){var r='<Row ss:Index="'+(e+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=y0(t.hpt)),t.hpx&&(r+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(r+=' ss:Hidden="1"')),r+">"}function jee(e,t,r,n){if(!e["!ref"])return"";var s=sn(e["!ref"]),a=e["!merges"]||[],i=0,l=[];e["!cols"]&&e["!cols"].forEach(function(b,E){qu(b);var k=!!b.width,_=dv(E,b),T={"ss:Index":E+1};k&&(T["ss:Width"]=bp(_.width)),b.hidden&&(T["ss:Hidden"]="1"),l.push(Gt("Column",null,T))});for(var c=Array.isArray(e),d=s.s.r;d<=s.e.r;++d){for(var f=[Eee(d,(e["!rows"]||[])[d])],p=s.s.c;p<=s.e.c;++p){var g=!1;for(i=0;i!=a.length;++i)if(!(a[i].s.c>p)&&!(a[i].s.r>d)&&!(a[i].e.c<p)&&!(a[i].e.r<d)){(a[i].s.c!=p||a[i].s.r!=d)&&(g=!0);break}if(!g){var y={r:d,c:p},v=jr(y),w=c?(e[d]||[])[p]:e[v];f.push(Nee(w,v,e,t,r,n,y))}}f.push("</Row>"),f.length>2&&l.push(f.join(""))}return l.join("")}function Aee(e,t,r){var n=[],s=r.SheetNames[e],a=r.Sheets[s],i=a?kee(a,t,e,r):"";return i.length>0&&n.push("<Names>"+i+"</Names>"),i=a?jee(a,t,e,r):"",i.length>0&&n.push("<Table>"+i+"</Table>"),n.push(Cee(a,t,e,r)),n.join("")}function Fee(e,t){t||(t={}),e.SSF||(e.SSF=$n(Cr)),e.SSF&&(O0(),sv(e.SSF),t.revssf=iv(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF,t.cellXfs=[],id(t.cellXfs,{},{revssf:{General:0}}));var r=[];r.push(wee(e,t)),r.push(_ee()),r.push(""),r.push("");for(var n=0;n<e.SheetNames.length;++n)r.push(Gt("Worksheet",Aee(n,t,e),{"ss:Name":bn(e.SheetNames[n])}));return r[2]=bee(e,t),r[3]=See(e),Es+Gt("Workbook",r.join(""),{xmlns:Gi.ss,"xmlns:o":Gi.o,"xmlns:x":Gi.x,"xmlns:ss":Gi.ss,"xmlns:dt":Gi.dt,"xmlns:html":Gi.html})}function Pee(e){var t={},r=e.content;if(r.l=28,t.AnsiUserType=r.read_shift(0,"lpstr-ansi"),t.AnsiClipboardFormat=SG(r),r.length-r.l<=4)return t;var n=r.read_shift(4);if(n==0||n>40||(r.l-=4,t.Reserved1=r.read_shift(0,"lpstr-ansi"),r.length-r.l<=4)||(n=r.read_shift(4),n!==1907505652)||(t.UnicodeClipboardFormat=kG(r),n=r.read_shift(4),n==0||n>40))return t;r.l-=4,t.Reserved2=r.read_shift(0,"lpwstr")}var Ree=[60,1084,2066,2165,2175];function Dee(e,t,r,n,s){var a=n,i=[],l=r.slice(r.l,r.l+a);if(s&&s.enc&&s.enc.insitu&&l.length>0)switch(e){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:s.enc.insitu(l)}i.push(l),r.l+=a;for(var c=Tc(r,r.l),d=y2[c],f=0;d!=null&&Ree.indexOf(c)>-1;)a=Tc(r,r.l+2),f=r.l+4,c==2066?f+=4:(c==2165||c==2175)&&(f+=12),l=r.slice(f,r.l+4+a),i.push(l),r.l+=4+a,d=y2[c=Tc(r,r.l)];var p=la(i);Na(p,0);var g=0;p.lens=[];for(var y=0;y<i.length;++y)p.lens.push(g),g+=i[y].length;if(p.length<n)throw"XLS Record 0x"+e.toString(16)+" Truncated: "+p.length+" < "+n;return t.f(p,p.length,s)}function Nl(e,t,r){if(e.t!=="z"&&e.XF){var n=0;try{n=e.z||e.XF.numFmtId||0,t.cellNF&&(e.z=Cr[n])}catch(a){if(t.WTF)throw a}if(!t||t.cellText!==!1)try{e.t==="e"?e.w=e.w||$c[e.v]:n===0||n=="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=pp(e.v):e.w=yf(e.v):e.w=No(n,e.v,{date1904:!!r,dateNF:t&&t.dateNF})}catch(a){if(t.WTF)throw a}if(t.cellDates&&n&&e.t=="n"&&M0(Cr[n]||String(n))){var s=Vd(e.v);s&&(e.t="d",e.v=new Date(s.y,s.m-1,s.d,s.H,s.M,s.S,s.u))}}}function Ey(e,t,r){return{v:e,ixfe:t,t:r}}function Iee(e,t){var r={opts:{}},n={},s=t.dense?[]:{},a={},i={},l=null,c=[],d="",f={},p,g="",y,v,w,b,E={},k=[],_,T,j=[],P=[],R={Sheets:[],WBProps:{date1904:!1},Views:[{}]},N={},A=function(mt){return mt<8?Zd[mt]:mt<64&&P[mt-8]||Zd[mt]},M=function(mt,_t,Ht){var Qt=_t.XF.data;if(!(!Qt||!Qt.patternType||!Ht||!Ht.cellStyles)){_t.s={},_t.s.patternType=Qt.patternType;var nr;(nr=_p(A(Qt.icvFore)))&&(_t.s.fgColor={rgb:nr}),(nr=_p(A(Qt.icvBack)))&&(_t.s.bgColor={rgb:nr})}},H=function(mt,_t,Ht){if(!(V>1)&&!(Ht.sheetRows&&mt.r>=Ht.sheetRows)){if(Ht.cellStyles&&_t.XF&&_t.XF.data&&M(mt,_t,Ht),delete _t.ixfe,delete _t.XF,p=mt,g=jr(mt),(!i||!i.s||!i.e)&&(i={s:{r:0,c:0},e:{r:0,c:0}}),mt.r<i.s.r&&(i.s.r=mt.r),mt.c<i.s.c&&(i.s.c=mt.c),mt.r+1>i.e.r&&(i.e.r=mt.r+1),mt.c+1>i.e.c&&(i.e.c=mt.c+1),Ht.cellFormula&&_t.f){for(var Qt=0;Qt<k.length;++Qt)if(!(k[Qt][0].s.c>mt.c||k[Qt][0].s.r>mt.r)&&!(k[Qt][0].e.c<mt.c||k[Qt][0].e.r<mt.r)){_t.F=zr(k[Qt][0]),(k[Qt][0].s.c!=mt.c||k[Qt][0].s.r!=mt.r)&&delete _t.f,_t.f&&(_t.f=""+Wa(k[Qt][1],i,mt,I,Q));break}}Ht.dense?(s[mt.r]||(s[mt.r]=[]),s[mt.r][mt.c]=_t):s[g]=_t}},Q={enc:!1,sbcch:0,snames:[],sharedf:E,arrayf:k,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!t&&!!t.cellStyles,WTF:!!t&&!!t.wtf};t.password&&(Q.password=t.password);var Z,ae=[],te=[],se=[],L=[],G=!1,I=[];I.SheetNames=Q.snames,I.sharedf=Q.sharedf,I.arrayf=Q.arrayf,I.names=[],I.XTI=[];var z=0,V=0,O=0,W=[],q=[],Y;Q.codepage=1200,Xo(1200);for(var ee=!1;e.l<e.length-1;){var X=e.l,ne=e.read_shift(2);if(ne===0&&z===10)break;var ge=e.l===e.length?0:e.read_shift(2),_e=y2[ne];if(_e&&_e.f){if(t.bookSheets&&z===133&&ne!==133)break;if(z=ne,_e.r===2||_e.r==12){var Pe=e.read_shift(2);if(ge-=2,!Q.enc&&Pe!==ne&&((Pe&255)<<8|Pe>>8)!==ne)throw new Error("rt mismatch: "+Pe+"!="+ne);_e.r==12&&(e.l+=10,ge-=10)}var ce={};if(ne===10?ce=_e.f(e,ge,Q):ce=Dee(ne,_e,e,ge,Q),V==0&&[9,521,1033,2057].indexOf(z)===-1)continue;switch(ne){case 34:r.opts.Date1904=R.WBProps.date1904=ce;break;case 134:r.opts.WriteProtect=!0;break;case 47:if(Q.enc||(e.l=0),Q.enc=ce,!t.password)throw new Error("File is password-protected");if(ce.valid==null)throw new Error("Encryption scheme unsupported");if(!ce.valid)throw new Error("Password is incorrect");break;case 92:Q.lastuser=ce;break;case 66:var ye=Number(ce);switch(ye){case 21010:ye=1200;break;case 32768:ye=1e4;break;case 32769:ye=1252;break}Xo(Q.codepage=ye),ee=!0;break;case 317:Q.rrtabid=ce;break;case 25:Q.winlocked=ce;break;case 439:r.opts.RefreshAll=ce;break;case 12:r.opts.CalcCount=ce;break;case 16:r.opts.CalcDelta=ce;break;case 17:r.opts.CalcIter=ce;break;case 13:r.opts.CalcMode=ce;break;case 14:r.opts.CalcPrecision=ce;break;case 95:r.opts.CalcSaveRecalc=ce;break;case 15:Q.CalcRefMode=ce;break;case 2211:r.opts.FullCalc=ce;break;case 129:ce.fDialog&&(s["!type"]="dialog"),ce.fBelow||((s["!outline"]||(s["!outline"]={})).above=!0),ce.fRight||((s["!outline"]||(s["!outline"]={})).left=!0);break;case 224:j.push(ce);break;case 430:I.push([ce]),I[I.length-1].XTI=[];break;case 35:case 547:I[I.length-1].push(ce);break;case 24:case 536:Y={Name:ce.Name,Ref:Wa(ce.rgce,i,null,I,Q)},ce.itab>0&&(Y.Sheet=ce.itab-1),I.names.push(Y),I[0]||(I[0]=[],I[0].XTI=[]),I[I.length-1].push(ce),ce.Name=="_xlnm._FilterDatabase"&&ce.itab>0&&ce.rgce&&ce.rgce[0]&&ce.rgce[0][0]&&ce.rgce[0][0][0]=="PtgArea3d"&&(q[ce.itab-1]={ref:zr(ce.rgce[0][0][1][2])});break;case 22:Q.ExternCount=ce;break;case 23:I.length==0&&(I[0]=[],I[0].XTI=[]),I[I.length-1].XTI=I[I.length-1].XTI.concat(ce),I.XTI=I.XTI.concat(ce);break;case 2196:if(Q.biff<8)break;Y!=null&&(Y.Comment=ce[1]);break;case 18:s["!protect"]=ce;break;case 19:ce!==0&&Q.WTF&&console.error("Password verifier: "+ce);break;case 133:a[ce.pos]=ce,Q.snames.push(ce.name);break;case 10:{if(--V)break;if(i.e){if(i.e.r>0&&i.e.c>0){if(i.e.r--,i.e.c--,s["!ref"]=zr(i),t.sheetRows&&t.sheetRows<=i.e.r){var Fe=i.e.r;i.e.r=t.sheetRows-1,s["!fullref"]=s["!ref"],s["!ref"]=zr(i),i.e.r=Fe}i.e.r++,i.e.c++}ae.length>0&&(s["!merges"]=ae),te.length>0&&(s["!objects"]=te),se.length>0&&(s["!cols"]=se),L.length>0&&(s["!rows"]=L),R.Sheets.push(N)}d===""?f=s:n[d]=s,s=t.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(Q.biff===8&&(Q.biff={9:2,521:3,1033:4}[ne]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[ce.BIFFVer]||8),Q.biffguess=ce.BIFFVer==0,ce.BIFFVer==0&&ce.dt==4096&&(Q.biff=5,ee=!0,Xo(Q.codepage=28591)),Q.biff==8&&ce.BIFFVer==0&&ce.dt==16&&(Q.biff=2),V++)break;if(s=t.dense?[]:{},Q.biff<8&&!ee&&(ee=!0,Xo(Q.codepage=t.codepage||1252)),Q.biff<5||ce.BIFFVer==0&&ce.dt==4096){d===""&&(d="Sheet1"),i={s:{r:0,c:0},e:{r:0,c:0}};var Me={pos:e.l-ge,name:d};a[Me.pos]=Me,Q.snames.push(d)}else d=(a[X]||{name:""}).name;ce.dt==32&&(s["!type"]="chart"),ce.dt==64&&(s["!type"]="macro"),ae=[],te=[],Q.arrayf=k=[],se=[],L=[],G=!1,N={Hidden:(a[X]||{hs:0}).hs,name:d}}break;case 515:case 3:case 2:s["!type"]=="chart"&&(t.dense?(s[ce.r]||[])[ce.c]:s[jr({c:ce.c,r:ce.r})])&&++ce.c,_={ixfe:ce.ixfe,XF:j[ce.ixfe]||{},v:ce.val,t:"n"},O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H({c:ce.c,r:ce.r},_,t);break;case 5:case 517:_={ixfe:ce.ixfe,XF:j[ce.ixfe],v:ce.val,t:ce.t},O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H({c:ce.c,r:ce.r},_,t);break;case 638:_={ixfe:ce.ixfe,XF:j[ce.ixfe],v:ce.rknum,t:"n"},O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H({c:ce.c,r:ce.r},_,t);break;case 189:for(var Oe=ce.c;Oe<=ce.C;++Oe){var He=ce.rkrec[Oe-ce.c][0];_={ixfe:He,XF:j[He],v:ce.rkrec[Oe-ce.c][1],t:"n"},O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H({c:Oe,r:ce.r},_,t)}break;case 6:case 518:case 1030:{if(ce.val=="String"){l=ce;break}if(_=Ey(ce.val,ce.cell.ixfe,ce.tt),_.XF=j[_.ixfe],t.cellFormula){var It=ce.formula;if(It&&It[0]&&It[0][0]&&It[0][0][0]=="PtgExp"){var Ze=It[0][0][1][0],Le=It[0][0][1][1],De=jr({r:Ze,c:Le});E[De]?_.f=""+Wa(ce.formula,i,ce.cell,I,Q):_.F=((t.dense?(s[Ze]||[])[Le]:s[De])||{}).F}else _.f=""+Wa(ce.formula,i,ce.cell,I,Q)}O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H(ce.cell,_,t),l=ce}break;case 7:case 519:if(l)l.val=ce,_=Ey(ce,l.cell.ixfe,"s"),_.XF=j[_.ixfe],t.cellFormula&&(_.f=""+Wa(l.formula,i,l.cell,I,Q)),O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H(l.cell,_,t),l=null;else throw new Error("String record expects Formula");break;case 33:case 545:{k.push(ce);var et=jr(ce[0].s);if(y=t.dense?(s[ce[0].s.r]||[])[ce[0].s.c]:s[et],t.cellFormula&&y){if(!l||!et||!y)break;y.f=""+Wa(ce[1],i,ce[0],I,Q),y.F=zr(ce[0])}}break;case 1212:{if(!t.cellFormula)break;if(g){if(!l)break;E[jr(l.cell)]=ce[0],y=t.dense?(s[l.cell.r]||[])[l.cell.c]:s[jr(l.cell)],(y||{}).f=""+Wa(ce[0],i,p,I,Q)}}break;case 253:_=Ey(c[ce.isst].t,ce.ixfe,"s"),c[ce.isst].h&&(_.h=c[ce.isst].h),_.XF=j[_.ixfe],O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H({c:ce.c,r:ce.r},_,t);break;case 513:t.sheetStubs&&(_={ixfe:ce.ixfe,XF:j[ce.ixfe],t:"z"},O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H({c:ce.c,r:ce.r},_,t));break;case 190:if(t.sheetStubs)for(var bt=ce.c;bt<=ce.C;++bt){var ut=ce.ixfe[bt-ce.c];_={ixfe:ut,XF:j[ut],t:"z"},O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H({c:bt,r:ce.r},_,t)}break;case 214:case 516:case 4:_=Ey(ce.val,ce.ixfe,"s"),_.XF=j[_.ixfe],O>0&&(_.z=W[_.ixfe>>8&63]),Nl(_,t,r.opts.Date1904),H({c:ce.c,r:ce.r},_,t);break;case 0:case 512:V===1&&(i=ce);break;case 252:c=ce;break;case 1054:if(Q.biff==4){W[O++]=ce[1];for(var jt=0;jt<O+163&&Cr[jt]!=ce[1];++jt);jt>=163&&jc(ce[1],O+163)}else jc(ce[1],ce[0]);break;case 30:{W[O++]=ce;for(var Rt=0;Rt<O+163&&Cr[Rt]!=ce;++Rt);Rt>=163&&jc(ce,O+163)}break;case 229:ae=ae.concat(ce);break;case 93:te[ce.cmo[0]]=Q.lastobj=ce;break;case 438:Q.lastobj.TxO=ce;break;case 127:Q.lastobj.ImData=ce;break;case 440:for(b=ce[0].s.r;b<=ce[0].e.r;++b)for(w=ce[0].s.c;w<=ce[0].e.c;++w)y=t.dense?(s[b]||[])[w]:s[jr({c:w,r:b})],y&&(y.l=ce[1]);break;case 2048:for(b=ce[0].s.r;b<=ce[0].e.r;++b)for(w=ce[0].s.c;w<=ce[0].e.c;++w)y=t.dense?(s[b]||[])[w]:s[jr({c:w,r:b})],y&&y.l&&(y.l.Tooltip=ce[1]);break;case 28:{if(Q.biff<=5&&Q.biff>=2)break;y=t.dense?(s[ce[0].r]||[])[ce[0].c]:s[jr(ce[0])];var Xe=te[ce[2]];y||(t.dense?(s[ce[0].r]||(s[ce[0].r]=[]),y=s[ce[0].r][ce[0].c]={t:"z"}):y=s[jr(ce[0])]={t:"z"},i.e.r=Math.max(i.e.r,ce[0].r),i.s.r=Math.min(i.s.r,ce[0].r),i.e.c=Math.max(i.e.c,ce[0].c),i.s.c=Math.min(i.s.c,ce[0].c)),y.c||(y.c=[]),v={a:ce[1],t:Xe.TxO.t},y.c.push(v)}break;case 2173:bX(j[ce.ixfe],ce.ext);break;case 125:{if(!Q.cellStyles)break;for(;ce.e>=ce.s;)se[ce.e--]={width:ce.w/256,level:ce.level||0,hidden:!!(ce.flags&1)},G||(G=!0,PS(ce.w/256)),qu(se[ce.e+1])}break;case 520:{var Ye={};ce.level!=null&&(L[ce.r]=Ye,Ye.level=ce.level),ce.hidden&&(L[ce.r]=Ye,Ye.hidden=!0),ce.hpt&&(L[ce.r]=Ye,Ye.hpt=ce.hpt,Ye.hpx=y0(ce.hpt))}break;case 38:case 39:case 40:case 41:s["!margins"]||rf(s["!margins"]={}),s["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[ne]]=ce;break;case 161:s["!margins"]||rf(s["!margins"]={}),s["!margins"].header=ce.header,s["!margins"].footer=ce.footer;break;case 574:ce.RTL&&(R.Views[0].RTL=!0);break;case 146:P=ce;break;case 2198:Z=ce;break;case 140:T=ce;break;case 442:d?N.CodeName=ce||N.name:R.WBProps.CodeName=ce||"ThisWorkbook";break}}else _e||console.error("Missing Info for XLS Record 0x"+ne.toString(16)),e.l+=ge}return r.SheetNames=ms(a).sort(function(pt,mt){return Number(pt)-Number(mt)}).map(function(pt){return a[pt].name}),t.bookSheets||(r.Sheets=n),!r.SheetNames.length&&f["!ref"]?(r.SheetNames.push("Sheet1"),r.Sheets&&(r.Sheets.Sheet1=f)):r.Preamble=f,r.Sheets&&q.forEach(function(pt,mt){r.Sheets[r.SheetNames[mt]]["!autofilter"]=pt}),r.Strings=c,r.SSF=$n(Cr),Q.enc&&(r.Encryption=Q.enc),Z&&(r.Themes=Z),r.Metadata={},T!==void 0&&(r.Metadata.Country=T),I.names.length>0&&(R.Names=I.names),r.Workbook=R,r}var Xm={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function Mee(e,t,r){var n=xr.find(e,"/!DocumentSummaryInformation");if(n&&n.size>0)try{var s=JE(n,d2,Xm.DSI);for(var a in s)t[a]=s[a]}catch(d){if(r.WTF)throw d}var i=xr.find(e,"/!SummaryInformation");if(i&&i.size>0)try{var l=JE(i,f2,Xm.SI);for(var c in l)t[c]==null&&(t[c]=l[c])}catch(d){if(r.WTF)throw d}t.HeadingPairs&&t.TitlesOfParts&&(Y8(t.HeadingPairs,t.TitlesOfParts,t,r),delete t.HeadingPairs,delete t.TitlesOfParts)}function Oee(e,t){var r=[],n=[],s=[],a=0,i,l=NE(d2,"n"),c=NE(f2,"n");if(e.Props)for(i=ms(e.Props),a=0;a<i.length;++a)(Object.prototype.hasOwnProperty.call(l,i[a])?r:Object.prototype.hasOwnProperty.call(c,i[a])?n:s).push([i[a],e.Props[i[a]]]);if(e.Custprops)for(i=ms(e.Custprops),a=0;a<i.length;++a)Object.prototype.hasOwnProperty.call(e.Props||{},i[a])||(Object.prototype.hasOwnProperty.call(l,i[a])?r:Object.prototype.hasOwnProperty.call(c,i[a])?n:s).push([i[a],e.Custprops[i[a]]]);var d=[];for(a=0;a<s.length;++a)nF.indexOf(s[a][0])>-1||X8.indexOf(s[a][0])>-1||s[a][1]!=null&&d.push(s[a]);n.length&&xr.utils.cfb_add(t,"/SummaryInformation",QE(n,Xm.SI,c,f2)),(r.length||d.length)&&xr.utils.cfb_add(t,"/DocumentSummaryInformation",QE(r,Xm.DSI,l,d2,d.length?d:null,Xm.UDI))}function QF(e,t){t||(t={}),$S(t),lS(),t.codepage&&oS(t.codepage);var r,n;if(e.FullPaths){if(xr.find(e,"/encryption"))throw new Error("File is password-protected");r=xr.find(e,"!CompObj"),n=xr.find(e,"/Workbook")||xr.find(e,"/Book")}else{switch(t.type){case"base64":e=Ki(Yi(e));break;case"binary":e=Ki(e);break;case"buffer":break;case"array":Array.isArray(e)||(e=Array.prototype.slice.call(e));break}Na(e,0),n={content:e}}var s,a;if(r&&Pee(r),t.bookProps&&!t.bookSheets)s={};else{var i=Gr?"buffer":"array";if(n&&n.content)s=Iee(n.content,t);else if((a=xr.find(e,"PerfectOffice_MAIN"))&&a.content)s=tf.to_workbook(a.content,(t.type=i,t));else if((a=xr.find(e,"NativeContent_MAIN"))&&a.content)s=tf.to_workbook(a.content,(t.type=i,t));else throw(a=xr.find(e,"MN0"))&&a.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");t.bookVBA&&e.FullPaths&&xr.find(e,"/_VBA_PROJECT_CUR/VBA/dir")&&(s.vbaraw=YX(e))}var l={};return e.FullPaths&&Mee(e,l,t),s.Props=s.Custprops=l,t.bookFiles&&(s.cfb=e),s}function Lee(e,t){var r=t||{},n=xr.utils.cfb_new({root:"R"}),s="/Workbook";switch(r.bookType||"xls"){case"xls":r.bookType="biff8";case"xla":r.bookType||(r.bookType="xla");case"biff8":s="/Workbook",r.biff=8;break;case"biff5":s="/Book",r.biff=5;break;default:throw new Error("invalid type "+r.bookType+" for XLS CFB")}return xr.utils.cfb_add(n,s,ZF(e,r)),r.biff==8&&(e.Props||e.Custprops)&&Oee(e,n),r.biff==8&&e.vbaraw&&JX(n,xr.read(e.vbaraw,{type:typeof e.vbaraw=="string"?"binary":"buffer"})),n}var Cp={0:{f:lQ},1:{f:pQ},2:{f:IQ},3:{f:kQ},4:{f:wQ},5:{f:PQ},6:{f:UQ},7:{f:EQ},8:{f:KQ},9:{f:VQ},10:{f:HQ},11:{f:GQ},12:{f:yQ},13:{f:OQ},14:{f:TQ},15:{f:bQ},16:{f:HF},17:{f:WQ},18:{f:AQ},19:{f:bS},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:WZ},40:{},42:{},43:{f:Uq},44:{f:Lq},45:{f:zq},46:{f:Gq},47:{f:Hq},48:{},49:{f:dG},50:{},51:{f:CX},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:gF},62:{f:BQ},63:{f:DX},64:{f:cZ},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:Ya,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:aZ},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:gQ},148:{f:dQ,p:16},151:{f:ZQ},152:{},153:{f:BZ},154:{},155:{},156:{f:OZ},157:{},158:{},159:{T:1,f:tq},160:{T:-1},161:{T:1,f:Ff},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:qQ},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:SX},336:{T:-1},337:{f:EX,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:u2},357:{},358:{},359:{},360:{T:1},361:{},362:{f:hF},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:eZ},427:{f:tZ},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:nZ},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:hQ},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:JQ},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:u2},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:GX},633:{T:1},634:{T:-1},635:{T:1,f:zX},636:{T:-1},637:{f:mG},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:TZ},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:uZ},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},y2={6:{f:Xw},10:{f:Eu},12:{f:Ms},13:{f:Ms},14:{f:ks},15:{f:ks},16:{f:Ha},17:{f:ks},18:{f:ks},19:{f:Ms},20:{f:s3},21:{f:s3},23:{f:hF},24:{f:i3},25:{f:ks},26:{},27:{},28:{f:uK},29:{},34:{f:ks},35:{f:a3},38:{f:Ha},39:{f:Ha},40:{f:Ha},41:{f:Ha},42:{f:ks},43:{f:ks},47:{f:bq},49:{f:OV},51:{f:Ms},60:{},61:{f:PV},64:{f:ks},65:{f:MV},66:{f:Ms},77:{},80:{},81:{},82:{},85:{f:Ms},89:{},90:{},91:{},92:{f:_V},93:{f:hK},94:{},95:{f:ks},96:{},97:{},99:{f:ks},125:{f:gF},128:{f:QV},129:{f:SV},130:{f:Ms},131:{f:ks},132:{f:ks},133:{f:kV},134:{},140:{f:_K},141:{f:Ms},144:{},146:{f:kK},151:{},152:{},153:{},154:{},155:{},156:{f:Ms},157:{},158:{},160:{f:FK},161:{f:NK},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:qV},190:{f:XV},193:{f:Eu},197:{},198:{},199:{},200:{},201:{},202:{f:ks},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:Ms},220:{},221:{f:ks},222:{},224:{f:JV},225:{f:wV},226:{f:Eu},227:{},229:{f:dK},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:TV},253:{f:BV},255:{f:EV},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:sF},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:ks},353:{f:Eu},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:nK},431:{f:ks},432:{},433:{},434:{},437:{},438:{f:pK},439:{f:ks},440:{f:xK},441:{},442:{f:Zp},443:{},444:{f:Ms},445:{},446:{},448:{f:Eu},449:{f:FV,r:2},450:{f:Eu},512:{f:t3},513:{f:AK},515:{f:tK},516:{f:$V},517:{f:n3},519:{f:PK},520:{f:jV},523:{},545:{f:o3},549:{f:e3},566:{},574:{f:DV},638:{f:KV},659:{},1048:{},1054:{f:zV},1084:{},1212:{f:oK},2048:{f:vK},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:Cy},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:Eu},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:CK,r:12},2173:{f:_X,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:ks,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:iK,r:12},2197:{},2198:{f:mX,r:12},2199:{},2200:{},2201:{},2202:{f:lK,r:12},2203:{f:Eu},2204:{},2205:{},2206:{},2207:{},2211:{f:AV},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:Ms},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:EK},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:SK},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:t3},1:{},2:{f:OK},3:{f:IK},4:{f:DK},5:{f:n3},7:{f:BK},8:{},9:{f:Cy},11:{},22:{f:Ms},30:{f:GV},31:{},32:{},33:{f:o3},36:{},37:{f:e3},50:{f:UK},62:{},52:{},67:{},68:{f:Ms},69:{},86:{},126:{},127:{f:RK},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:$K},223:{},234:{},354:{},421:{},518:{f:Xw},521:{f:Cy},536:{f:i3},547:{f:a3},561:{},579:{},1030:{f:Xw},1033:{f:Cy},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function Kt(e,t,r,n){var s=t;if(!isNaN(s)){var a=n||(r||[]).length||0,i=e.next(4);i.write_shift(2,s),i.write_shift(2,a),a>0&&vS(r)&&e.push(r)}}function Bee(e,t,r,n){var s=(r||[]).length||0;if(s<=8224)return Kt(e,t,r,s);var a=t;if(!isNaN(a)){for(var i=r.parts||[],l=0,c=0,d=0;d+(i[l]||8224)<=8224;)d+=i[l]||8224,l++;var f=e.next(4);for(f.write_shift(2,a),f.write_shift(2,d),e.push(r.slice(c,c+d)),c+=d;c<s;){for(f=e.next(4),f.write_shift(2,60),d=0;d+(i[l]||8224)<=8224;)d+=i[l]||8224,l++;f.write_shift(2,d),e.push(r.slice(c,c+d)),c+=d}}}function nx(e,t,r){return e||(e=wt(7)),e.write_shift(2,t),e.write_shift(2,r),e.write_shift(2,0),e.write_shift(1,0),e}function Uee(e,t,r,n){var s=wt(9);return nx(s,e,t),aF(r,n||"b",s),s}function $ee(e,t,r){var n=wt(8+2*r.length);return nx(n,e,t),n.write_shift(1,r.length),n.write_shift(r.length,r,"sbcs"),n.l<n.length?n.slice(0,n.l):n}function Wee(e,t,r,n){if(t.v!=null)switch(t.t){case"d":case"n":var s=t.t=="d"?Ys(Un(t.v)):t.v;s==(s|0)&&s>=0&&s<65536?Kt(e,2,LK(r,n,s)):Kt(e,3,MK(r,n,s));return;case"b":case"e":Kt(e,5,Uee(r,n,t.v,t.t));return;case"s":case"str":Kt(e,4,$ee(r,n,(t.v||"").slice(0,255)));return}Kt(e,1,nx(null,r,n))}function zee(e,t,r,n){var s=Array.isArray(t),a=sn(t["!ref"]||"A1"),i,l="",c=[];if(a.e.c>255||a.e.r>16383){if(n.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");a.e.c=Math.min(a.e.c,255),a.e.r=Math.min(a.e.c,16383),i=zr(a)}for(var d=a.s.r;d<=a.e.r;++d){l=Ts(d);for(var f=a.s.c;f<=a.e.c;++f){d===a.s.r&&(c[f]=es(f)),i=c[f]+l;var p=s?(t[d]||[])[f]:t[i];p&&Wee(e,p,d,f)}}}function Hee(e,t){for(var r=t||{},n=Ri(),s=0,a=0;a<e.SheetNames.length;++a)e.SheetNames[a]==r.sheet&&(s=a);if(s==0&&r.sheet&&e.SheetNames[0]!=r.sheet)throw new Error("Sheet not found: "+r.sheet);return Kt(n,r.biff==4?1033:r.biff==3?521:9,jS(e,16,r)),zee(n,e.Sheets[e.SheetNames[s]],s,r),Kt(n,10),n.end()}function Gee(e,t,r){Kt(e,49,LV({sz:12,name:"Arial"},r))}function Vee(e,t,r){t&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)t[s]!=null&&Kt(e,1054,HV(s,t[s],r))})}function Kee(e,t){var r=wt(19);r.write_shift(4,2151),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,1),r.write_shift(4,0),Kt(e,2151,r),r=wt(39),r.write_shift(4,2152),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(2,1),r.write_shift(4,4),r.write_shift(2,0),uF(sn(t["!ref"]||"A1"),r),r.write_shift(4,4),Kt(e,2152,r)}function qee(e,t){for(var r=0;r<16;++r)Kt(e,224,r3({numFmtId:0,style:!0},0,t));t.cellXfs.forEach(function(n){Kt(e,224,r3(n,0,t))})}function Xee(e,t){for(var r=0;r<t["!links"].length;++r){var n=t["!links"][r];Kt(e,440,yK(n)),n[1].Tooltip&&Kt(e,2048,wK(n))}delete t["!links"]}function Yee(e,t){if(t){var r=0;t.forEach(function(n,s){++r<=256&&n&&Kt(e,125,TK(dv(s,n),s))})}}function Jee(e,t,r,n,s){var a=16+id(s.cellXfs,t,s);if(t.v==null&&!t.bf){Kt(e,513,bf(r,n,a));return}if(t.bf)Kt(e,6,SJ(t,r,n,s,a));else switch(t.t){case"d":case"n":var i=t.t=="d"?Ys(Un(t.v)):t.v;Kt(e,515,rK(r,n,i,a));break;case"b":case"e":Kt(e,517,eK(r,n,t.v,a,s,t.t));break;case"s":case"str":if(s.bookSST){var l=OS(s.Strings,t.v,s.revStrings);Kt(e,253,UV(r,n,l,a))}else Kt(e,516,WV(r,n,(t.v||"").slice(0,255),a,s));break;default:Kt(e,513,bf(r,n,a))}}function Qee(e,t,r){var n=Ri(),s=r.SheetNames[e],a=r.Sheets[s]||{},i=(r||{}).Workbook||{},l=(i.Sheets||[])[e]||{},c=Array.isArray(a),d=t.biff==8,f,p="",g=[],y=sn(a["!ref"]||"A1"),v=d?65536:16384;if(y.e.c>255||y.e.r>=v){if(t.WTF)throw new Error("Range "+(a["!ref"]||"A1")+" exceeds format limit A1:IV16384");y.e.c=Math.min(y.e.c,255),y.e.r=Math.min(y.e.c,v-1)}Kt(n,2057,jS(r,16,t)),Kt(n,13,wo(1)),Kt(n,12,wo(100)),Kt(n,15,di(!0)),Kt(n,17,di(!1)),Kt(n,16,wf(.001)),Kt(n,95,di(!0)),Kt(n,42,di(!1)),Kt(n,43,di(!1)),Kt(n,130,wo(1)),Kt(n,128,ZV()),Kt(n,131,di(!1)),Kt(n,132,di(!1)),d&&Yee(n,a["!cols"]),Kt(n,512,VV(y,t)),d&&(a["!links"]=[]);for(var w=y.s.r;w<=y.e.r;++w){p=Ts(w);for(var b=y.s.c;b<=y.e.c;++b){w===y.s.r&&(g[b]=es(b)),f=g[b]+p;var E=c?(a[w]||[])[b]:a[f];E&&(Jee(n,E,w,b,t),d&&E.l&&a["!links"].push([f,E.l]))}}var k=l.CodeName||l.name||s;return d&&Kt(n,574,IV((i.Views||[])[0])),d&&(a["!merges"]||[]).length&&Kt(n,229,fK(a["!merges"])),d&&Xee(n,a),Kt(n,442,iF(k)),d&&Kee(n,a),Kt(n,10),n.end()}function Zee(e,t,r){var n=Ri(),s=(e||{}).Workbook||{},a=s.Sheets||[],i=s.WBProps||{},l=r.biff==8,c=r.biff==5;if(Kt(n,2057,jS(e,5,r)),r.bookType=="xla"&&Kt(n,135),Kt(n,225,l?wo(1200):null),Kt(n,193,eV(2)),c&&Kt(n,191),c&&Kt(n,192),Kt(n,226),Kt(n,92,bV("SheetJS",r)),Kt(n,66,wo(l?1200:1252)),l&&Kt(n,353,wo(0)),l&&Kt(n,448),Kt(n,317,jK(e.SheetNames.length)),l&&e.vbaraw&&Kt(n,211),l&&e.vbaraw){var d=i.CodeName||"ThisWorkbook";Kt(n,442,iF(d))}Kt(n,156,wo(17)),Kt(n,25,di(!1)),Kt(n,18,di(!1)),Kt(n,19,wo(0)),l&&Kt(n,431,di(!1)),l&&Kt(n,444,wo(0)),Kt(n,61,RV()),Kt(n,64,di(!1)),Kt(n,141,wo(0)),Kt(n,34,di(FZ(e)=="true")),Kt(n,14,di(!0)),l&&Kt(n,439,di(!1)),Kt(n,218,wo(0)),Gee(n,e,r),Vee(n,e.SSF,r),qee(n,r),l&&Kt(n,352,di(!1));var f=n.end(),p=Ri();l&&Kt(p,140,bK()),l&&r.Strings&&Bee(p,252,NV(r.Strings)),Kt(p,10);var g=p.end(),y=Ri(),v=0,w=0;for(w=0;w<e.SheetNames.length;++w)v+=(l?12:11)+(l?2:1)*e.SheetNames[w].length;var b=f.length+v+g.length;for(w=0;w<e.SheetNames.length;++w){var E=a[w]||{};Kt(y,133,CV({pos:b,hs:E.Hidden||0,dt:0,name:e.SheetNames[w]},r)),b+=t[w].length}var k=y.end();if(v!=k.length)throw new Error("BS8 "+v+" != "+k.length);var _=[];return f.length&&_.push(f),k.length&&_.push(k),g.length&&_.push(g),la(_)}function ete(e,t){var r=t||{},n=[];e&&!e.SSF&&(e.SSF=$n(Cr)),e&&e.SSF&&(O0(),sv(e.SSF),r.revssf=iv(e.SSF),r.revssf[e.SSF[65535]]=0,r.ssf=e.SSF),r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,WS(r),r.cellXfs=[],id(r.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var s=0;s<e.SheetNames.length;++s)n[n.length]=Qee(s,r,e);return n.unshift(Zee(e,n,r)),la(n)}function ZF(e,t){for(var r=0;r<=e.SheetNames.length;++r){var n=e.Sheets[e.SheetNames[r]];if(!(!n||!n["!ref"])){var s=Di(n["!ref"]);s.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+e.SheetNames[r]+"' extends beyond column IV (255).  Data may be lost.")}}var a=t||{};switch(a.biff||2){case 8:case 5:return ete(e,t);case 4:case 3:case 2:return Hee(e,t)}throw new Error("invalid type "+a.bookType+" for BIFF")}function x3(e,t){var r=t||{},n=r.dense?[]:{};e=e.replace(/<!--.*?-->/g,"");var s=e.match(/<table/i);if(!s)throw new Error("Invalid HTML: could not find <table>");var a=e.match(/<\/table/i),i=s.index,l=a&&a.index||e.length,c=LH(e.slice(i,l),/(:?<tr[^>]*>)/i,"<tr>"),d=-1,f=0,p=0,g=0,y={s:{r:1e7,c:1e7},e:{r:0,c:0}},v=[];for(i=0;i<c.length;++i){var w=c[i].trim(),b=w.slice(0,3).toLowerCase();if(b=="<tr"){if(++d,r.sheetRows&&r.sheetRows<=d){--d;break}f=0;continue}if(!(b!="<td"&&b!="<th")){var E=w.split(/<\/t[dh]>/i);for(l=0;l<E.length;++l){var k=E[l].trim();if(k.match(/<t[dh]/i)){for(var _=k,T=0;_.charAt(0)=="<"&&(T=_.indexOf(">"))>-1;)_=_.slice(T+1);for(var j=0;j<v.length;++j){var P=v[j];P.s.c==f&&P.s.r<d&&d<=P.e.r&&(f=P.e.c+1,j=-1)}var R=Fr(k.slice(0,k.indexOf(">")));g=R.colspan?+R.colspan:1,((p=+R.rowspan)>1||g>1)&&v.push({s:{r:d,c:f},e:{r:d+(p||1)-1,c:f+g-1}});var N=R.t||R["data-t"]||"";if(!_.length){f+=g;continue}if(_=S8(_),y.s.r>d&&(y.s.r=d),y.e.r<d&&(y.e.r=d),y.s.c>f&&(y.s.c=f),y.e.c<f&&(y.e.c=f),!_.length){f+=g;continue}var A={t:"s",v:_};r.raw||!_.trim().length||N=="s"||(_==="TRUE"?A={t:"b",v:!0}:_==="FALSE"?A={t:"b",v:!1}:isNaN(Qo(_))?isNaN(p0(_).getDate())||(A={t:"d",v:Un(_)},r.cellDates||(A={t:"n",v:Ys(A.v)}),A.z=r.dateNF||Cr[14]):A={t:"n",v:Qo(_)}),r.dense?(n[d]||(n[d]=[]),n[d][f]=A):n[jr({r:d,c:f})]=A,f+=g}}}}return n["!ref"]=zr(y),v.length&&(n["!merges"]=v),n}function tte(e,t,r,n){for(var s=e["!merges"]||[],a=[],i=t.s.c;i<=t.e.c;++i){for(var l=0,c=0,d=0;d<s.length;++d)if(!(s[d].s.r>r||s[d].s.c>i)&&!(s[d].e.r<r||s[d].e.c<i)){if(s[d].s.r<r||s[d].s.c<i){l=-1;break}l=s[d].e.r-s[d].s.r+1,c=s[d].e.c-s[d].s.c+1;break}if(!(l<0)){var f=jr({r,c:i}),p=n.dense?(e[r]||[])[i]:e[f],g=p&&p.v!=null&&(p.h||pS(p.w||(Mc(p),p.w)||""))||"",y={};l>1&&(y.rowspan=l),c>1&&(y.colspan=c),n.editable?g='<span contenteditable="true">'+g+"</span>":p&&(y["data-t"]=p&&p.t||"z",p.v!=null&&(y["data-v"]=p.v),p.z!=null&&(y["data-z"]=p.z),p.l&&(p.l.Target||"#").charAt(0)!="#"&&(g='<a href="'+p.l.Target+'">'+g+"</a>")),y.id=(n.id||"sjs")+"-"+f,a.push(Gt("td",g,y))}}var v="<tr>";return v+a.join("")+"</tr>"}var rte='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',nte="</body></html>";function ste(e,t){var r=e.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!r||r.length==0)throw new Error("Invalid HTML: could not find <table>");if(r.length==1)return ad(x3(r[0],t),t);var n=GS();return r.forEach(function(s,a){VS(n,x3(s,t),"Sheet"+(a+1))}),n}function ate(e,t,r){var n=[];return n.join("")+"<table"+(r&&r.id?' id="'+r.id+'"':"")+">"}function eP(e,t){var r=t||{},n=r.header!=null?r.header:rte,s=r.footer!=null?r.footer:nte,a=[n],i=Di(e["!ref"]);r.dense=Array.isArray(e),a.push(ate(e,i,r));for(var l=i.s.r;l<=i.e.r;++l)a.push(tte(e,i,l,r));return a.push("</table>"+s),a.join("")}function tP(e,t,r){var n=r||{},s=0,a=0;if(n.origin!=null)if(typeof n.origin=="number")s=n.origin;else{var i=typeof n.origin=="string"?ts(n.origin):n.origin;s=i.r,a=i.c}var l=t.getElementsByTagName("tr"),c=Math.min(n.sheetRows||1e7,l.length),d={s:{r:0,c:0},e:{r:s,c:a}};if(e["!ref"]){var f=Di(e["!ref"]);d.s.r=Math.min(d.s.r,f.s.r),d.s.c=Math.min(d.s.c,f.s.c),d.e.r=Math.max(d.e.r,f.e.r),d.e.c=Math.max(d.e.c,f.e.c),s==-1&&(d.e.r=s=f.e.r+1)}var p=[],g=0,y=e["!rows"]||(e["!rows"]=[]),v=0,w=0,b=0,E=0,k=0,_=0;for(e["!cols"]||(e["!cols"]=[]);v<l.length&&w<c;++v){var T=l[v];if(y3(T)){if(n.display)continue;y[w]={hidden:!0}}var j=T.children;for(b=E=0;b<j.length;++b){var P=j[b];if(!(n.display&&y3(P))){var R=P.hasAttribute("data-v")?P.getAttribute("data-v"):P.hasAttribute("v")?P.getAttribute("v"):S8(P.innerHTML),N=P.getAttribute("data-z")||P.getAttribute("z");for(g=0;g<p.length;++g){var A=p[g];A.s.c==E+a&&A.s.r<w+s&&w+s<=A.e.r&&(E=A.e.c+1-a,g=-1)}_=+P.getAttribute("colspan")||1,((k=+P.getAttribute("rowspan")||1)>1||_>1)&&p.push({s:{r:w+s,c:E+a},e:{r:w+s+(k||1)-1,c:E+a+(_||1)-1}});var M={t:"s",v:R},H=P.getAttribute("data-t")||P.getAttribute("t")||"";R!=null&&(R.length==0?M.t=H||"z":n.raw||R.trim().length==0||H=="s"||(R==="TRUE"?M={t:"b",v:!0}:R==="FALSE"?M={t:"b",v:!1}:isNaN(Qo(R))?isNaN(p0(R).getDate())||(M={t:"d",v:Un(R)},n.cellDates||(M={t:"n",v:Ys(M.v)}),M.z=n.dateNF||Cr[14]):M={t:"n",v:Qo(R)})),M.z===void 0&&N!=null&&(M.z=N);var Q="",Z=P.getElementsByTagName("A");if(Z&&Z.length)for(var ae=0;ae<Z.length&&!(Z[ae].hasAttribute("href")&&(Q=Z[ae].getAttribute("href"),Q.charAt(0)!="#"));++ae);Q&&Q.charAt(0)!="#"&&(M.l={Target:Q}),n.dense?(e[w+s]||(e[w+s]=[]),e[w+s][E+a]=M):e[jr({c:E+a,r:w+s})]=M,d.e.c<E+a&&(d.e.c=E+a),E+=_}}++w}return p.length&&(e["!merges"]=(e["!merges"]||[]).concat(p)),d.e.r=Math.max(d.e.r,w-1+s),e["!ref"]=zr(d),w>=c&&(e["!fullref"]=zr((d.e.r=l.length-v+w-1+s,d))),e}function rP(e,t){var r=t||{},n=r.dense?[]:{};return tP(n,e,t)}function ite(e,t){return ad(rP(e,t),t)}function y3(e){var t="",r=ote(e);return r&&(t=r(e).getPropertyValue("display")),t||(t=e.style&&e.style.display),t==="none"}function ote(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function lte(e){var t=e.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(n,s){return Array(parseInt(s,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),r=nn(t.replace(/<[^>]*>/g,""));return[r]}var v3={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function nP(e,t){var r=t||{},n=xS(e),s=[],a,i,l={name:""},c="",d=0,f,p,g={},y=[],v=r.dense?[]:{},w,b,E={value:""},k="",_=0,T=[],j=-1,P=-1,R={s:{r:1e6,c:1e7},e:{r:0,c:0}},N=0,A={},M=[],H={},Q=0,Z=0,ae=[],te=1,se=1,L=[],G={Names:[]},I={},z=["",""],V=[],O={},W="",q=0,Y=!1,ee=!1,X=0;for(vp.lastIndex=0,n=n.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");w=vp.exec(n);)switch(w[3]=w[3].replace(/_.*$/,"")){case"table":case"工作表":w[1]==="/"?(R.e.c>=R.s.c&&R.e.r>=R.s.r?v["!ref"]=zr(R):v["!ref"]="A1:A1",r.sheetRows>0&&r.sheetRows<=R.e.r&&(v["!fullref"]=v["!ref"],R.e.r=r.sheetRows-1,v["!ref"]=zr(R)),M.length&&(v["!merges"]=M),ae.length&&(v["!rows"]=ae),f.name=f.名称||f.name,typeof JSON<"u"&&JSON.stringify(f),y.push(f.name),g[f.name]=v,ee=!1):w[0].charAt(w[0].length-2)!=="/"&&(f=Fr(w[0],!1),j=P=-1,R.s.r=R.s.c=1e7,R.e.r=R.e.c=0,v=r.dense?[]:{},M=[],ae=[],ee=!0);break;case"table-row-group":w[1]==="/"?--N:++N;break;case"table-row":case"行":if(w[1]==="/"){j+=te,te=1;break}if(p=Fr(w[0],!1),p.行号?j=p.行号-1:j==-1&&(j=0),te=+p["number-rows-repeated"]||1,te<10)for(X=0;X<te;++X)N>0&&(ae[j+X]={level:N});P=-1;break;case"covered-table-cell":w[1]!=="/"&&++P,r.sheetStubs&&(r.dense?(v[j]||(v[j]=[]),v[j][P]={t:"z"}):v[jr({r:j,c:P})]={t:"z"}),k="",T=[];break;case"table-cell":case"数据":if(w[0].charAt(w[0].length-2)==="/")++P,E=Fr(w[0],!1),se=parseInt(E["number-columns-repeated"]||"1",10),b={t:"z",v:null},E.formula&&r.cellFormula!=!1&&(b.f=g3(nn(E.formula))),(E.数据类型||E["value-type"])=="string"&&(b.t="s",b.v=nn(E["string-value"]||""),r.dense?(v[j]||(v[j]=[]),v[j][P]=b):v[jr({r:j,c:P})]=b),P+=se-1;else if(w[1]!=="/"){++P,k="",_=0,T=[],se=1;var ne=te?j+te-1:j;if(P>R.e.c&&(R.e.c=P),P<R.s.c&&(R.s.c=P),j<R.s.r&&(R.s.r=j),ne>R.e.r&&(R.e.r=ne),E=Fr(w[0],!1),V=[],O={},b={t:E.数据类型||E["value-type"],v:null},r.cellFormula)if(E.formula&&(E.formula=nn(E.formula)),E["number-matrix-columns-spanned"]&&E["number-matrix-rows-spanned"]&&(Q=parseInt(E["number-matrix-rows-spanned"],10)||0,Z=parseInt(E["number-matrix-columns-spanned"],10)||0,H={s:{r:j,c:P},e:{r:j+Q-1,c:P+Z-1}},b.F=zr(H),L.push([H,b.F])),E.formula)b.f=g3(E.formula);else for(X=0;X<L.length;++X)j>=L[X][0].s.r&&j<=L[X][0].e.r&&P>=L[X][0].s.c&&P<=L[X][0].e.c&&(b.F=L[X][1]);switch((E["number-columns-spanned"]||E["number-rows-spanned"])&&(Q=parseInt(E["number-rows-spanned"],10)||0,Z=parseInt(E["number-columns-spanned"],10)||0,H={s:{r:j,c:P},e:{r:j+Q-1,c:P+Z-1}},M.push(H)),E["number-columns-repeated"]&&(se=parseInt(E["number-columns-repeated"],10)),b.t){case"boolean":b.t="b",b.v=On(E["boolean-value"]);break;case"float":b.t="n",b.v=parseFloat(E.value);break;case"percentage":b.t="n",b.v=parseFloat(E.value);break;case"currency":b.t="n",b.v=parseFloat(E.value);break;case"date":b.t="d",b.v=Un(E["date-value"]),r.cellDates||(b.t="n",b.v=Ys(b.v)),b.z="m/d/yy";break;case"time":b.t="n",b.v=IH(E["time-value"])/86400,r.cellDates&&(b.t="d",b.v=ov(b.v)),b.z="HH:MM:SS";break;case"number":b.t="n",b.v=parseFloat(E.数据数值);break;default:if(b.t==="string"||b.t==="text"||!b.t)b.t="s",E["string-value"]!=null&&(k=nn(E["string-value"]),T=[]);else throw new Error("Unsupported value type "+b.t)}}else{if(Y=!1,b.t==="s"&&(b.v=k||"",T.length&&(b.R=T),Y=_==0),I.Target&&(b.l=I),V.length>0&&(b.c=V,V=[]),k&&r.cellText!==!1&&(b.w=k),Y&&(b.t="z",delete b.v),(!Y||r.sheetStubs)&&!(r.sheetRows&&r.sheetRows<=j))for(var ge=0;ge<te;++ge){if(se=parseInt(E["number-columns-repeated"]||"1",10),r.dense)for(v[j+ge]||(v[j+ge]=[]),v[j+ge][P]=ge==0?b:$n(b);--se>0;)v[j+ge][P+se]=$n(b);else for(v[jr({r:j+ge,c:P})]=b;--se>0;)v[jr({r:j+ge,c:P+se})]=$n(b);R.e.c<=P&&(R.e.c=P)}se=parseInt(E["number-columns-repeated"]||"1",10),P+=se-1,se=0,b={},k="",T=[]}I={};break;case"document":case"document-content":case"电子表格文档":case"spreadsheet":case"主体":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(w[1]==="/"){if((a=s.pop())[0]!==w[3])throw"Bad state: "+a}else w[0].charAt(w[0].length-2)!=="/"&&s.push([w[3],!0]);break;case"annotation":if(w[1]==="/"){if((a=s.pop())[0]!==w[3])throw"Bad state: "+a;O.t=k,T.length&&(O.R=T),O.a=W,V.push(O)}else w[0].charAt(w[0].length-2)!=="/"&&s.push([w[3],!1]);W="",q=0,k="",_=0,T=[];break;case"creator":w[1]==="/"?W=n.slice(q,w.index):q=w.index+w[0].length;break;case"meta":case"元数据":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(w[1]==="/"){if((a=s.pop())[0]!==w[3])throw"Bad state: "+a}else w[0].charAt(w[0].length-2)!=="/"&&s.push([w[3],!1]);k="",_=0,T=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(w[1]==="/"){if(A[l.name]=c,(a=s.pop())[0]!==w[3])throw"Bad state: "+a}else w[0].charAt(w[0].length-2)!=="/"&&(c="",l=Fr(w[0],!1),s.push([w[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(s[s.length-1][0]){case"time-style":case"date-style":i=Fr(w[0],!1),c+=v3[w[3]][i.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(s[s.length-1][0]){case"time-style":case"date-style":i=Fr(w[0],!1),c+=v3[w[3]][i.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(w[0].slice(-2)==="/>")break;if(w[1]==="/")switch(s[s.length-1][0]){case"number-style":case"date-style":case"time-style":c+=n.slice(d,w.index);break}else d=w.index+w[0].length;break;case"named-range":i=Fr(w[0],!1),z=Yw(i["cell-range-address"]);var _e={Name:i.name,Ref:z[0]+"!"+z[1]};ee&&(_e.Sheet=y.length),G.Names.push(_e);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"电子表格":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"文本串":if(["master-styles"].indexOf(s[s.length-1][0])>-1)break;if(w[1]==="/"&&(!E||!E["string-value"])){var Pe=lte(n.slice(_,w.index));k=(k.length>0?k+`
`:"")+Pe[0]}else Fr(w[0],!1),_=w.index+w[0].length;break;case"s":break;case"database-range":if(w[1]==="/")break;try{z=Yw(Fr(w[0])["target-range-address"]),g[z[0]]["!autofilter"]={ref:z[1]}}catch{}break;case"date":break;case"object":break;case"title":case"标题":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(w[1]!=="/"){if(I=Fr(w[0],!1),!I.href)break;I.Target=nn(I.href),delete I.href,I.Target.charAt(0)=="#"&&I.Target.indexOf(".")>-1?(z=Yw(I.Target.slice(1)),I.Target="#"+z[0]+"!"+z[1]):I.Target.match(/^\.\.[\\\/]/)&&(I.Target=I.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(w[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"表:":case"字:":break;default:if(r.WTF)throw new Error(w)}}var ce={Sheets:g,SheetNames:y,Workbook:G};return r.bookSheets&&delete ce.Sheets,ce}function w3(e,t){t=t||{},vo(e,"META-INF/manifest.xml")&&IG(Is(e,"META-INF/manifest.xml"),t);var r=qi(e,"content.xml");if(!r)throw new Error("Missing content.xml in ODS / UOF file");var n=nP(Nn(r),t);return vo(e,"meta.xml")&&(n.Props=K8(Is(e,"meta.xml"))),n}function _3(e,t){return nP(e,t)}var cte=(function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+yp({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return Es+t}})(),b3=(function(){var e=function(a){return bn(a).replace(/  +/g,function(i){return'<text:s text:c="'+i.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},t=`          <table:table-cell />
`,r=`          <table:covered-table-cell/>
`,n=function(a,i,l){var c=[];c.push('      <table:table table:name="'+bn(i.SheetNames[l])+`" table:style-name="ta1">
`);var d=0,f=0,p=Di(a["!ref"]||"A1"),g=a["!merges"]||[],y=0,v=Array.isArray(a);if(a["!cols"])for(f=0;f<=p.e.c;++f)c.push("        <table:table-column"+(a["!cols"][f]?' table:style-name="co'+a["!cols"][f].ods+'"':"")+`></table:table-column>
`);var w="",b=a["!rows"]||[];for(d=0;d<p.s.r;++d)w=b[d]?' table:style-name="ro'+b[d].ods+'"':"",c.push("        <table:table-row"+w+`></table:table-row>
`);for(;d<=p.e.r;++d){for(w=b[d]?' table:style-name="ro'+b[d].ods+'"':"",c.push("        <table:table-row"+w+`>
`),f=0;f<p.s.c;++f)c.push(t);for(;f<=p.e.c;++f){var E=!1,k={},_="";for(y=0;y!=g.length;++y)if(!(g[y].s.c>f)&&!(g[y].s.r>d)&&!(g[y].e.c<f)&&!(g[y].e.r<d)){(g[y].s.c!=f||g[y].s.r!=d)&&(E=!0),k["table:number-columns-spanned"]=g[y].e.c-g[y].s.c+1,k["table:number-rows-spanned"]=g[y].e.r-g[y].s.r+1;break}if(E){c.push(r);continue}var T=jr({r:d,c:f}),j=v?(a[d]||[])[f]:a[T];if(j&&j.f&&(k["table:formula"]=bn(jJ(j.f)),j.F&&j.F.slice(0,T.length)==T)){var P=Di(j.F);k["table:number-matrix-columns-spanned"]=P.e.c-P.s.c+1,k["table:number-matrix-rows-spanned"]=P.e.r-P.s.r+1}if(!j){c.push(t);continue}switch(j.t){case"b":_=j.v?"TRUE":"FALSE",k["office:value-type"]="boolean",k["office:boolean-value"]=j.v?"true":"false";break;case"n":_=j.w||String(j.v||0),k["office:value-type"]="float",k["office:value"]=j.v||0;break;case"s":case"str":_=j.v==null?"":j.v,k["office:value-type"]="string";break;case"d":_=j.w||Un(j.v).toISOString(),k["office:value-type"]="date",k["office:date-value"]=Un(j.v).toISOString(),k["table:style-name"]="ce1";break;default:c.push(t);continue}var R=e(_);if(j.l&&j.l.Target){var N=j.l.Target;N=N.charAt(0)=="#"?"#"+AJ(N.slice(1)):N,N.charAt(0)!="#"&&!N.match(/^\w+:/)&&(N="../"+N),R=Gt("text:a",R,{"xlink:href":N.replace(/&/g,"&amp;")})}c.push("          "+Gt("table:table-cell",Gt("text:p",R,{}),k)+`
`)}c.push(`        </table:table-row>
`)}return c.push(`      </table:table>
`),c.join("")},s=function(a,i){a.push(` <office:automatic-styles>
`),a.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),a.push(`   <number:month number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:day number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:year/>
`),a.push(`  </number:date-style>
`);var l=0;i.SheetNames.map(function(d){return i.Sheets[d]}).forEach(function(d){if(d&&d["!cols"]){for(var f=0;f<d["!cols"].length;++f)if(d["!cols"][f]){var p=d["!cols"][f];if(p.width==null&&p.wpx==null&&p.wch==null)continue;qu(p),p.ods=l;var g=d["!cols"][f].wpx+"px";a.push('  <style:style style:name="co'+l+`" style:family="table-column">
`),a.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+g+`"/>
`),a.push(`  </style:style>
`),++l}}});var c=0;i.SheetNames.map(function(d){return i.Sheets[d]}).forEach(function(d){if(d&&d["!rows"]){for(var f=0;f<d["!rows"].length;++f)if(d["!rows"][f]){d["!rows"][f].ods=c;var p=d["!rows"][f].hpx+"px";a.push('  <style:style style:name="ro'+c+`" style:family="table-row">
`),a.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+p+`"/>
`),a.push(`  </style:style>
`),++c}}}),a.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),a.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),a.push(`  </style:style>
`),a.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),a.push(` </office:automatic-styles>
`)};return function(i,l){var c=[Es],d=yp({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),f=yp({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});l.bookType=="fods"?(c.push("<office:document"+d+f+`>
`),c.push(V8().replace(/office:document-meta/g,"office:meta"))):c.push("<office:document-content"+d+`>
`),s(c,i),c.push(`  <office:body>
`),c.push(`    <office:spreadsheet>
`);for(var p=0;p!=i.SheetNames.length;++p)c.push(n(i.Sheets[i.SheetNames[p]],i,p));return c.push(`    </office:spreadsheet>
`),c.push(`  </office:body>
`),l.bookType=="fods"?c.push("</office:document>"):c.push("</office:document-content>"),c.join("")}})();function sP(e,t){if(t.bookType=="fods")return b3(e,t);var r=hS(),n="",s=[],a=[];return n="mimetype",Hr(r,n,"application/vnd.oasis.opendocument.spreadsheet"),n="content.xml",Hr(r,n,b3(e,t)),s.push([n,"text/xml"]),a.push([n,"ContentFile"]),n="styles.xml",Hr(r,n,cte(e,t)),s.push([n,"text/xml"]),a.push([n,"StylesFile"]),n="meta.xml",Hr(r,n,Es+V8()),s.push([n,"text/xml"]),a.push([n,"MetadataFile"]),n="manifest.rdf",Hr(r,n,LG(a)),s.push([n,"application/rdf+xml"]),n="META-INF/manifest.xml",Hr(r,n,MG(s)),r}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function Sf(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function v2(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Nn(sd(e))}function ute(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Ki(Il(e))}function dte(e,t){e:for(var r=0;r<=e.length-t.length;++r){for(var n=0;n<t.length;++n)if(e[r+n]!=t[n])continue e;return!0}return!1}function Yu(e){var t=e.reduce(function(s,a){return s+a.length},0),r=new Uint8Array(t),n=0;return e.forEach(function(s){r.set(s,n),n+=s.length}),r}function S3(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>>24}function fte(e,t){for(var r=(e[t+15]&127)<<7|e[t+14]>>1,n=e[t+14]&1,s=t+13;s>=t;--s)n=n*256+e[s];return(e[t+15]&128?-n:n)*Math.pow(10,r-6176)}function hte(e,t,r){var n=Math.floor(r==0?0:Math.LOG10E*Math.log(Math.abs(r)))+6176-20,s=r/Math.pow(10,n-6176);e[t+15]|=n>>7,e[t+14]|=(n&127)<<1;for(var a=0;s>=1;++a,s/=256)e[t+a]=s&255;e[t+15]|=r>=0?0:128}function Tp(e,t){var r=t?t[0]:0,n=e[r]&127;e:if(e[r++]>=128&&(n|=(e[r]&127)<<7,e[r++]<128||(n|=(e[r]&127)<<14,e[r++]<128)||(n|=(e[r]&127)<<21,e[r++]<128)||(n+=(e[r]&127)*Math.pow(2,28),++r,e[r++]<128)||(n+=(e[r]&127)*Math.pow(2,35),++r,e[r++]<128)||(n+=(e[r]&127)*Math.pow(2,42),++r,e[r++]<128)))break e;return t&&(t[0]=r),n}function vn(e){var t=new Uint8Array(7);t[0]=e&127;var r=1;e:if(e>127){if(t[r-1]|=128,t[r]=e>>7&127,++r,e<=16383||(t[r-1]|=128,t[r]=e>>14&127,++r,e<=2097151)||(t[r-1]|=128,t[r]=e>>21&127,++r,e<=268435455)||(t[r-1]|=128,t[r]=e/256>>>21&127,++r,e<=34359738367)||(t[r-1]|=128,t[r]=e/65536>>>21&127,++r,e<=4398046511103))break e;t[r-1]|=128,t[r]=e/16777216>>>21&127,++r}return t.slice(0,r)}function gs(e){var t=0,r=e[t]&127;e:if(e[t++]>=128){if(r|=(e[t]&127)<<7,e[t++]<128||(r|=(e[t]&127)<<14,e[t++]<128)||(r|=(e[t]&127)<<21,e[t++]<128))break e;r|=(e[t]&127)<<28}return r}function on(e){for(var t=[],r=[0];r[0]<e.length;){var n=r[0],s=Tp(e,r),a=s&7;s=Math.floor(s/8);var i=0,l;if(s==0)break;switch(a){case 0:{for(var c=r[0];e[r[0]++]>=128;);l=e.slice(c,r[0])}break;case 5:i=4,l=e.slice(r[0],r[0]+i),r[0]+=i;break;case 1:i=8,l=e.slice(r[0],r[0]+i),r[0]+=i;break;case 2:i=Tp(e,r),l=e.slice(r[0],r[0]+i),r[0]+=i;break;case 3:case 4:default:throw new Error("PB Type ".concat(a," for Field ").concat(s," at offset ").concat(n))}var d={data:l,type:a};t[s]==null?t[s]=[d]:t[s].push(d)}return t}function ka(e){var t=[];return e.forEach(function(r,n){r.forEach(function(s){s.data&&(t.push(vn(n*8+s.type)),s.type==2&&t.push(vn(s.data.length)),t.push(s.data))})}),Yu(t)}function US(e,t){return e?.map(function(r){return t(r.data)})||[]}function po(e){for(var t,r=[],n=[0];n[0]<e.length;){var s=Tp(e,n),a=on(e.slice(n[0],n[0]+s));n[0]+=s;var i={id:gs(a[1][0].data),messages:[]};a[2].forEach(function(l){var c=on(l.data),d=gs(c[3][0].data);i.messages.push({meta:c,data:e.slice(n[0],n[0]+d)}),n[0]+=d}),(t=a[3])!=null&&t[0]&&(i.merge=gs(a[3][0].data)>>>0>0),r.push(i)}return r}function Fh(e){var t=[];return e.forEach(function(r){var n=[];n[1]=[{data:vn(r.id),type:0}],n[2]=[],r.merge!=null&&(n[3]=[{data:vn(+!!r.merge),type:0}]);var s=[];r.messages.forEach(function(i){s.push(i.data),i.meta[3]=[{type:0,data:vn(i.data.length)}],n[2].push({data:ka(i.meta),type:2})});var a=ka(n);t.push(vn(a.length)),t.push(a),s.forEach(function(i){return t.push(i)})}),Yu(t)}function gte(e,t){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var r=[0],n=Tp(t,r),s=[];r[0]<t.length;){var a=t[r[0]]&3;if(a==0){var i=t[r[0]++]>>2;if(i<60)++i;else{var l=i-59;i=t[r[0]],l>1&&(i|=t[r[0]+1]<<8),l>2&&(i|=t[r[0]+2]<<16),l>3&&(i|=t[r[0]+3]<<24),i>>>=0,i++,r[0]+=l}s.push(t.slice(r[0],r[0]+i)),r[0]+=i;continue}else{var c=0,d=0;if(a==1?(d=(t[r[0]]>>2&7)+4,c=(t[r[0]++]&224)<<3,c|=t[r[0]++]):(d=(t[r[0]++]>>2)+1,a==2?(c=t[r[0]]|t[r[0]+1]<<8,r[0]+=2):(c=(t[r[0]]|t[r[0]+1]<<8|t[r[0]+2]<<16|t[r[0]+3]<<24)>>>0,r[0]+=4)),s=[Yu(s)],c==0)throw new Error("Invalid offset 0");if(c>s[0].length)throw new Error("Invalid offset beyond length");if(d>=c)for(s.push(s[0].slice(-c)),d-=c;d>=s[s.length-1].length;)s.push(s[s.length-1]),d-=s[s.length-1].length;s.push(s[0].slice(-c,-c+d))}}var f=Yu(s);if(f.length!=n)throw new Error("Unexpected length: ".concat(f.length," != ").concat(n));return f}function xo(e){for(var t=[],r=0;r<e.length;){var n=e[r++],s=e[r]|e[r+1]<<8|e[r+2]<<16;r+=3,t.push(gte(n,e.slice(r,r+s))),r+=s}if(r!==e.length)throw new Error("data is not a valid framed stream!");return Yu(t)}function Ph(e){for(var t=[],r=0;r<e.length;){var n=Math.min(e.length-r,268435455),s=new Uint8Array(4);t.push(s);var a=vn(n),i=a.length;t.push(a),n<=60?(i++,t.push(new Uint8Array([n-1<<2]))):n<=256?(i+=2,t.push(new Uint8Array([240,n-1&255]))):n<=65536?(i+=3,t.push(new Uint8Array([244,n-1&255,n-1>>8&255]))):n<=16777216?(i+=4,t.push(new Uint8Array([248,n-1&255,n-1>>8&255,n-1>>16&255]))):n<=4294967296&&(i+=5,t.push(new Uint8Array([252,n-1&255,n-1>>8&255,n-1>>16&255,n-1>>>24&255]))),t.push(e.slice(r,r+n)),i+=n,s[0]=0,s[1]=i&255,s[2]=i>>8&255,s[3]=i>>16&255,r+=n}return Yu(t)}function mte(e,t,r,n){var s=Sf(e),a=s.getUint32(4,!0),i=(n>1?12:8)+S3(a&(n>1?3470:398))*4,l=-1,c=-1,d=NaN,f=new Date(2001,0,1);a&512&&(l=s.getUint32(i,!0),i+=4),i+=S3(a&(n>1?12288:4096))*4,a&16&&(c=s.getUint32(i,!0),i+=4),a&32&&(d=s.getFloat64(i,!0),i+=8),a&64&&(f.setTime(f.getTime()+s.getFloat64(i,!0)*1e3),i+=8);var p;switch(e[2]){case 0:break;case 2:p={t:"n",v:d};break;case 3:p={t:"s",v:t[c]};break;case 5:p={t:"d",v:f};break;case 6:p={t:"b",v:d>0};break;case 7:p={t:"n",v:d/86400};break;case 8:p={t:"e",v:0};break;case 9:if(l>-1)p={t:"s",v:r[l]};else if(c>-1)p={t:"s",v:t[c]};else if(!isNaN(d))p={t:"n",v:d};else throw new Error("Unsupported cell type ".concat(e.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(e.slice(0,4)))}return p}function pte(e,t,r){var n=Sf(e),s=n.getUint32(8,!0),a=12,i=-1,l=-1,c=NaN,d=NaN,f=new Date(2001,0,1);s&1&&(c=fte(e,a),a+=16),s&2&&(d=n.getFloat64(a,!0),a+=8),s&4&&(f.setTime(f.getTime()+n.getFloat64(a,!0)*1e3),a+=8),s&8&&(l=n.getUint32(a,!0),a+=4),s&16&&(i=n.getUint32(a,!0),a+=4);var p;switch(e[1]){case 0:break;case 2:p={t:"n",v:c};break;case 3:p={t:"s",v:t[l]};break;case 5:p={t:"d",v:f};break;case 6:p={t:"b",v:d>0};break;case 7:p={t:"n",v:d/86400};break;case 8:p={t:"e",v:0};break;case 9:if(i>-1)p={t:"s",v:r[i]};else throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(s&31," : ").concat(e.slice(0,4)));break;case 10:p={t:"n",v:c};break;default:throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(s&31," : ").concat(e.slice(0,4)))}return p}function Qw(e,t){var r=new Uint8Array(32),n=Sf(r),s=12,a=0;switch(r[0]=5,e.t){case"n":r[1]=2,hte(r,s,e.v),a|=1,s+=16;break;case"b":r[1]=6,n.setFloat64(s,e.v?1:0,!0),a|=2,s+=8;break;case"s":if(t.indexOf(e.v)==-1)throw new Error("Value ".concat(e.v," missing from SST!"));r[1]=3,n.setUint32(s,t.indexOf(e.v),!0),a|=8,s+=4;break;default:throw"unsupported cell type "+e.t}return n.setUint32(8,a,!0),r.slice(0,s)}function Zw(e,t){var r=new Uint8Array(32),n=Sf(r),s=12,a=0;switch(r[0]=3,e.t){case"n":r[2]=2,n.setFloat64(s,e.v,!0),a|=32,s+=8;break;case"b":r[2]=6,n.setFloat64(s,e.v?1:0,!0),a|=32,s+=8;break;case"s":if(t.indexOf(e.v)==-1)throw new Error("Value ".concat(e.v," missing from SST!"));r[2]=3,n.setUint32(s,t.indexOf(e.v),!0),a|=16,s+=4;break;default:throw"unsupported cell type "+e.t}return n.setUint32(4,a,!0),r.slice(0,s)}function xte(e,t,r){switch(e[0]){case 0:case 1:case 2:case 3:return mte(e,t,r,e[0]);case 5:return pte(e,t,r);default:throw new Error("Unsupported payload version ".concat(e[0]))}}function $a(e){var t=on(e);return Tp(t[1][0].data)}function k3(e,t){var r=on(t.data),n=gs(r[1][0].data),s=r[3],a=[];return(s||[]).forEach(function(i){var l=on(i.data),c=gs(l[1][0].data)>>>0;switch(n){case 1:a[c]=v2(l[3][0].data);break;case 8:{var d=e[$a(l[9][0].data)][0],f=on(d.data),p=e[$a(f[1][0].data)][0],g=gs(p.meta[1][0].data);if(g!=2001)throw new Error("2000 unexpected reference to ".concat(g));var y=on(p.data);a[c]=y[3].map(function(v){return v2(v.data)}).join("")}break}}),a}function yte(e,t){var r,n,s,a,i,l,c,d,f,p,g,y,v,w,b=on(e),E=gs(b[1][0].data)>>>0,k=gs(b[2][0].data)>>>0,_=((n=(r=b[8])==null?void 0:r[0])==null?void 0:n.data)&&gs(b[8][0].data)>0||!1,T,j;if((a=(s=b[7])==null?void 0:s[0])!=null&&a.data&&t!=0)T=(l=(i=b[7])==null?void 0:i[0])==null?void 0:l.data,j=(d=(c=b[6])==null?void 0:c[0])==null?void 0:d.data;else if((p=(f=b[4])==null?void 0:f[0])!=null&&p.data&&t!=1)T=(y=(g=b[4])==null?void 0:g[0])==null?void 0:y.data,j=(w=(v=b[3])==null?void 0:v[0])==null?void 0:w.data;else throw"NUMBERS Tile missing ".concat(t," cell storage");for(var P=_?4:1,R=Sf(T),N=[],A=0;A<T.length/2;++A){var M=R.getUint16(A*2,!0);M<65535&&N.push([A,M])}if(N.length!=k)throw"Expected ".concat(k," cells, found ").concat(N.length);var H=[];for(A=0;A<N.length-1;++A)H[N[A][0]]=j.subarray(N[A][1]*P,N[A+1][1]*P);return N.length>=1&&(H[N[N.length-1][0]]=j.subarray(N[N.length-1][1]*P)),{R:E,cells:H}}function vte(e,t){var r,n=on(t.data),s=(r=n?.[7])!=null&&r[0]?gs(n[7][0].data)>>>0>0?1:0:-1,a=US(n[5],function(i){return yte(i,s)});return{nrows:gs(n[4][0].data)>>>0,data:a.reduce(function(i,l){return i[l.R]||(i[l.R]=[]),l.cells.forEach(function(c,d){if(i[l.R][d])throw new Error("Duplicate cell r=".concat(l.R," c=").concat(d));i[l.R][d]=c}),i},[])}}function wte(e,t,r){var n,s=on(t.data),a={s:{r:0,c:0},e:{r:0,c:0}};if(a.e.r=(gs(s[6][0].data)>>>0)-1,a.e.r<0)throw new Error("Invalid row varint ".concat(s[6][0].data));if(a.e.c=(gs(s[7][0].data)>>>0)-1,a.e.c<0)throw new Error("Invalid col varint ".concat(s[7][0].data));r["!ref"]=zr(a);var i=on(s[4][0].data),l=k3(e,e[$a(i[4][0].data)][0]),c=(n=i[17])!=null&&n[0]?k3(e,e[$a(i[17][0].data)][0]):[],d=on(i[3][0].data),f=0;d[1].forEach(function(p){var g=on(p.data),y=e[$a(g[2][0].data)][0],v=gs(y.meta[1][0].data);if(v!=6002)throw new Error("6001 unexpected reference to ".concat(v));var w=vte(e,y);w.data.forEach(function(b,E){b.forEach(function(k,_){var T=jr({r:f+E,c:_}),j=xte(k,l,c);j&&(r[T]=j)})}),f+=w.nrows})}function _te(e,t){var r=on(t.data),n={"!ref":"A1"},s=e[$a(r[2][0].data)],a=gs(s[0].meta[1][0].data);if(a!=6001)throw new Error("6000 unexpected reference to ".concat(a));return wte(e,s[0],n),n}function bte(e,t){var r,n=on(t.data),s={name:(r=n[1])!=null&&r[0]?v2(n[1][0].data):"",sheets:[]},a=US(n[2],$a);return a.forEach(function(i){e[i].forEach(function(l){var c=gs(l.meta[1][0].data);c==6e3&&s.sheets.push(_te(e,l))})}),s}function Ste(e,t){var r=GS(),n=on(t.data),s=US(n[1],$a);if(s.forEach(function(a){e[a].forEach(function(i){var l=gs(i.meta[1][0].data);if(l==2){var c=bte(e,i);c.sheets.forEach(function(d,f){VS(r,d,f==0?c.name:c.name+"_"+f,!0)})}})}),r.SheetNames.length==0)throw new Error("Empty NUMBERS file");return r}function e_(e){var t,r,n,s,a={},i=[];if(e.FullPaths.forEach(function(c){if(c.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),e.FileIndex.forEach(function(c){if(c.name.match(/\.iwa$/)){var d;try{d=xo(c.content)}catch(p){return console.log("?? "+c.content.length+" "+(p.message||p))}var f;try{f=po(d)}catch(p){return console.log("## "+(p.message||p))}f.forEach(function(p){a[p.id]=p.messages,i.push(p.id)})}}),!i.length)throw new Error("File has no messages");var l=((s=(n=(r=(t=a?.[1])==null?void 0:t[0])==null?void 0:r.meta)==null?void 0:n[1])==null?void 0:s[0].data)&&gs(a[1][0].meta[1][0].data)==1&&a[1][0];if(l||i.forEach(function(c){a[c].forEach(function(d){var f=gs(d.meta[1][0].data)>>>0;if(f==1)if(!l)l=d;else throw new Error("Document has multiple roots")})}),!l)throw new Error("Cannot find Document root");return Ste(a,l)}function kte(e,t,r){var n,s,a,i;if(!((n=e[6])!=null&&n[0])||!((s=e[7])!=null&&s[0]))throw"Mutation only works on post-BNC storages!";var l=((i=(a=e[8])==null?void 0:a[0])==null?void 0:i.data)&&gs(e[8][0].data)>0||!1;if(l)throw"Math only works with normal offsets";for(var c=0,d=Sf(e[7][0].data),f=0,p=[],g=Sf(e[4][0].data),y=0,v=[],w=0;w<t.length;++w){if(t[w]==null){d.setUint16(w*2,65535,!0),g.setUint16(w*2,65535);continue}d.setUint16(w*2,f,!0),g.setUint16(w*2,y,!0);var b,E;switch(typeof t[w]){case"string":b=Qw({t:"s",v:t[w]},r),E=Zw({t:"s",v:t[w]},r);break;case"number":b=Qw({t:"n",v:t[w]},r),E=Zw({t:"n",v:t[w]},r);break;case"boolean":b=Qw({t:"b",v:t[w]},r),E=Zw({t:"b",v:t[w]},r);break;default:throw new Error("Unsupported value "+t[w])}p.push(b),f+=b.length,v.push(E),y+=E.length,++c}for(e[2][0].data=vn(c);w<e[7][0].data.length/2;++w)d.setUint16(w*2,65535,!0),g.setUint16(w*2,65535,!0);return e[6][0].data=Yu(p),e[3][0].data=Yu(v),c}function Cte(e,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var r=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var n=Di(r["!ref"]);n.s.r=n.s.c=0;var s=!1;n.e.c>9&&(s=!0,n.e.c=9),n.e.r>49&&(s=!0,n.e.r=49),s&&console.error("The Numbers writer is currently limited to ".concat(zr(n)));var a=N1(r,{range:n,header:1}),i=["~Sh33tJ5~"];a.forEach(function(W){return W.forEach(function(q){typeof q=="string"&&i.push(q)})});var l={},c=[],d=xr.read(t.numbers,{type:"base64"});d.FileIndex.map(function(W,q){return[W,d.FullPaths[q]]}).forEach(function(W){var q=W[0],Y=W[1];if(q.type==2&&q.name.match(/\.iwa/)){var ee=q.content,X=xo(ee),ne=po(X);ne.forEach(function(ge){c.push(ge.id),l[ge.id]={deps:[],location:Y,type:gs(ge.messages[0].meta[1][0].data)}})}}),c.sort(function(W,q){return W-q});var f=c.filter(function(W){return W>1}).map(function(W){return[W,vn(W)]});d.FileIndex.map(function(W,q){return[W,d.FullPaths[q]]}).forEach(function(W){var q=W[0];if(W[1],!!q.name.match(/\.iwa/)){var Y=po(xo(q.content));Y.forEach(function(ee){ee.messages.forEach(function(X){f.forEach(function(ne){ee.messages.some(function(ge){return gs(ge.meta[1][0].data)!=11006&&dte(ge.data,ne[1])})&&l[ne[0]].deps.push(ee.id)})})})}});for(var p=xr.find(d,l[1].location),g=po(xo(p.content)),y,v=0;v<g.length;++v){var w=g[v];w.id==1&&(y=w)}var b=$a(on(y.messages[0].data)[1][0].data);for(p=xr.find(d,l[b].location),g=po(xo(p.content)),v=0;v<g.length;++v)w=g[v],w.id==b&&(y=w);for(b=$a(on(y.messages[0].data)[2][0].data),p=xr.find(d,l[b].location),g=po(xo(p.content)),v=0;v<g.length;++v)w=g[v],w.id==b&&(y=w);for(b=$a(on(y.messages[0].data)[2][0].data),p=xr.find(d,l[b].location),g=po(xo(p.content)),v=0;v<g.length;++v)w=g[v],w.id==b&&(y=w);var E=on(y.messages[0].data);{E[6][0].data=vn(n.e.r+1),E[7][0].data=vn(n.e.c+1);var k=$a(E[46][0].data),_=xr.find(d,l[k].location),T=po(xo(_.content));{for(var j=0;j<T.length&&T[j].id!=k;++j);if(T[j].id!=k)throw"Bad ColumnRowUIDMapArchive";var P=on(T[j].messages[0].data);P[1]=[],P[2]=[],P[3]=[];for(var R=0;R<=n.e.c;++R){var N=[];N[1]=N[2]=[{type:0,data:vn(R+420690)}],P[1].push({type:2,data:ka(N)}),P[2].push({type:0,data:vn(R)}),P[3].push({type:0,data:vn(R)})}P[4]=[],P[5]=[],P[6]=[];for(var A=0;A<=n.e.r;++A)N=[],N[1]=N[2]=[{type:0,data:vn(A+726270)}],P[4].push({type:2,data:ka(N)}),P[5].push({type:0,data:vn(A)}),P[6].push({type:0,data:vn(A)});T[j].messages[0].data=ka(P)}_.content=Ph(Fh(T)),_.size=_.content.length,delete E[46];var M=on(E[4][0].data);{M[7][0].data=vn(n.e.r+1);var H=on(M[1][0].data),Q=$a(H[2][0].data);_=xr.find(d,l[Q].location),T=po(xo(_.content));{if(T[0].id!=Q)throw"Bad HeaderStorageBucket";var Z=on(T[0].messages[0].data);for(A=0;A<a.length;++A){var ae=on(Z[2][0].data);ae[1][0].data=vn(A),ae[4][0].data=vn(a[A].length),Z[2][A]={type:Z[2][0].type,data:ka(ae)}}T[0].messages[0].data=ka(Z)}_.content=Ph(Fh(T)),_.size=_.content.length;var te=$a(M[2][0].data);_=xr.find(d,l[te].location),T=po(xo(_.content));{if(T[0].id!=te)throw"Bad HeaderStorageBucket";for(Z=on(T[0].messages[0].data),R=0;R<=n.e.c;++R)ae=on(Z[2][0].data),ae[1][0].data=vn(R),ae[4][0].data=vn(n.e.r+1),Z[2][R]={type:Z[2][0].type,data:ka(ae)};T[0].messages[0].data=ka(Z)}_.content=Ph(Fh(T)),_.size=_.content.length;var se=$a(M[4][0].data);(function(){for(var W=xr.find(d,l[se].location),q=po(xo(W.content)),Y,ee=0;ee<q.length;++ee){var X=q[ee];X.id==se&&(Y=X)}var ne=on(Y.messages[0].data);{ne[3]=[];var ge=[];i.forEach(function(ce,ye){ge[1]=[{type:0,data:vn(ye)}],ge[2]=[{type:0,data:vn(1)}],ge[3]=[{type:2,data:ute(ce)}],ne[3].push({type:2,data:ka(ge)})})}Y.messages[0].data=ka(ne);var _e=Fh(q),Pe=Ph(_e);W.content=Pe,W.size=W.content.length})();var L=on(M[3][0].data);{var G=L[1][0];delete L[2];var I=on(G.data);{var z=$a(I[2][0].data);(function(){for(var W=xr.find(d,l[z].location),q=po(xo(W.content)),Y,ee=0;ee<q.length;++ee){var X=q[ee];X.id==z&&(Y=X)}var ne=on(Y.messages[0].data);{delete ne[6],delete L[7];var ge=new Uint8Array(ne[5][0].data);ne[5]=[];for(var _e=0,Pe=0;Pe<=n.e.r;++Pe){var ce=on(ge);_e+=kte(ce,a[Pe],i),ce[1][0].data=vn(Pe),ne[5].push({data:ka(ce),type:2})}ne[1]=[{type:0,data:vn(n.e.c+1)}],ne[2]=[{type:0,data:vn(n.e.r+1)}],ne[3]=[{type:0,data:vn(_e)}],ne[4]=[{type:0,data:vn(n.e.r+1)}]}Y.messages[0].data=ka(ne);var ye=Fh(q),Fe=Ph(ye);W.content=Fe,W.size=W.content.length})()}G.data=ka(I)}M[3][0].data=ka(L)}E[4][0].data=ka(M)}y.messages[0].data=ka(E);var V=Fh(g),O=Ph(V);return p.content=O,p.size=p.content.length,d}function aP(e){return function(r){for(var n=0;n!=e.length;++n){var s=e[n];r[s[0]]===void 0&&(r[s[0]]=s[1]),s[2]==="n"&&(r[s[0]]=Number(r[s[0]]))}}}function $S(e){aP([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(e)}function WS(e){aP([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function Tte(e){return Yr.WS.indexOf(e)>-1?"sheet":e==Yr.CS?"chart":e==Yr.DS?"dialog":e==Yr.MS?"macro":e&&e.length?e:"sheet"}function Nte(e,t){if(!e)return 0;try{e=t.map(function(n){return n.id||(n.id=n.strRelID),[n.name,e["!id"][n.id].Target,Tte(e["!id"][n.id].Type)]})}catch{return null}return!e||e.length===0?null:e}function Ete(e,t,r,n,s,a,i,l,c,d,f,p){try{a[n]=Gm(qi(e,r,!0),t);var g=Is(e,t),y;switch(l){case"sheet":y=YZ(g,t,s,c,a[n],d,f,p);break;case"chart":if(y=JZ(g,t,s,c,a[n],d,f,p),!y||!y["!drawel"])break;var v=Fm(y["!drawel"].Target,t),w=wp(v),b=OX(qi(e,v,!0),Gm(qi(e,w,!0),v)),E=Fm(b,v),k=wp(E);y=kZ(qi(e,E,!0),E,c,Gm(qi(e,k,!0),E),d,y);break;case"macro":y=QZ(g,t,s,c,a[n],d,f,p);break;case"dialog":y=ZZ(g,t,s,c,a[n],d,f,p);break;default:throw new Error("Unrecognized sheet type "+l)}i[n]=y;var _=[];a&&a[n]&&ms(a[n]).forEach(function(T){var j="";if(a[n][T].Type==Yr.CMNT){j=Fm(a[n][T].Target,t);var P=nee(Is(e,j,!0),j,c);if(!P||!P.length)return;c3(y,P,!1)}a[n][T].Type==Yr.TCMNT&&(j=Fm(a[n][T].Target,t),_=_.concat(BX(Is(e,j,!0),c)))}),_&&_.length&&c3(y,_,!0,c.people||[])}catch(T){if(c.WTF)throw T}}function go(e){return e.charAt(0)=="/"?e.slice(1):e}function jte(e,t){if(O0(),t=t||{},$S(t),vo(e,"META-INF/manifest.xml")||vo(e,"objectdata.xml"))return w3(e,t);if(vo(e,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof e_<"u"){if(e.FileIndex)return e_(e);var r=xr.utils.cfb_new();return AE(e).forEach(function(ae){Hr(r,ae,UH(e,ae))}),e_(r)}throw new Error("Unsupported NUMBERS file")}if(!vo(e,"[Content_Types].xml"))throw vo(e,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):vo(e,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var n=AE(e),s=RG(qi(e,"[Content_Types].xml")),a=!1,i,l;if(s.workbooks.length===0&&(l="xl/workbook.xml",Is(e,l,!0)&&s.workbooks.push(l)),s.workbooks.length===0){if(l="xl/workbook.bin",!Is(e,l,!0))throw new Error("Could not find workbook");s.workbooks.push(l),a=!0}s.workbooks[0].slice(-3)=="bin"&&(a=!0);var c={},d={};if(!t.bookSheets&&!t.bookProps){if(Vm=[],s.sst)try{Vm=ree(Is(e,go(s.sst)),s.sst,t)}catch(ae){if(t.WTF)throw ae}t.cellStyles&&s.themes.length&&(c=tee(qi(e,s.themes[0].replace(/^\//,""),!0)||"",s.themes[0],t)),s.style&&(d=eee(Is(e,go(s.style)),s.style,c,t))}s.links.map(function(ae){try{var te=Gm(qi(e,wp(go(ae))),ae);return aee(Is(e,go(ae)),te,ae,t)}catch{}});var f=XZ(Is(e,go(s.workbooks[0])),s.workbooks[0],t),p={},g="";s.coreprops.length&&(g=Is(e,go(s.coreprops[0]),!0),g&&(p=K8(g)),s.extprops.length!==0&&(g=Is(e,go(s.extprops[0]),!0),g&&UG(g,p,t)));var y={};(!t.bookSheets||t.bookProps)&&s.custprops.length!==0&&(g=qi(e,go(s.custprops[0]),!0),g&&(y=WG(g,t)));var v={};if((t.bookSheets||t.bookProps)&&(f.Sheets?i=f.Sheets.map(function(te){return te.name}):p.Worksheets&&p.SheetNames.length>0&&(i=p.SheetNames),t.bookProps&&(v.Props=p,v.Custprops=y),t.bookSheets&&typeof i<"u"&&(v.SheetNames=i),t.bookSheets?v.SheetNames:t.bookProps))return v;i={};var w={};t.bookDeps&&s.calcchain&&(w=see(Is(e,go(s.calcchain)),s.calcchain));var b=0,E={},k,_;{var T=f.Sheets;p.Worksheets=T.length,p.SheetNames=[];for(var j=0;j!=T.length;++j)p.SheetNames[j]=T[j].name}var P=a?"bin":"xml",R=s.workbooks[0].lastIndexOf("/"),N=(s.workbooks[0].slice(0,R+1)+"_rels/"+s.workbooks[0].slice(R+1)+".rels").replace(/^\//,"");vo(e,N)||(N="xl/_rels/workbook."+P+".rels");var A=Gm(qi(e,N,!0),N.replace(/_rels.*/,"s5s"));(s.metadata||[]).length>=1&&(t.xlmeta=iee(Is(e,go(s.metadata[0])),s.metadata[0],t)),(s.people||[]).length>=1&&(t.people=$X(Is(e,go(s.people[0])),t)),A&&(A=Nte(A,f.Sheets));var M=Is(e,"xl/worksheets/sheet.xml",!0)?1:0;e:for(b=0;b!=p.Worksheets;++b){var H="sheet";if(A&&A[b]?(k="xl/"+A[b][1].replace(/[\/]?xl\//,""),vo(e,k)||(k=A[b][1]),vo(e,k)||(k=N.replace(/_rels\/.*$/,"")+A[b][1]),H=A[b][2]):(k="xl/worksheets/sheet"+(b+1-M)+"."+P,k=k.replace(/sheet0\./,"sheet.")),_=k.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),t&&t.sheets!=null)switch(typeof t.sheets){case"number":if(b!=t.sheets)continue e;break;case"string":if(p.SheetNames[b].toLowerCase()!=t.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(t.sheets)){for(var Q=!1,Z=0;Z!=t.sheets.length;++Z)typeof t.sheets[Z]=="number"&&t.sheets[Z]==b&&(Q=1),typeof t.sheets[Z]=="string"&&t.sheets[Z].toLowerCase()==p.SheetNames[b].toLowerCase()&&(Q=1);if(!Q)continue e}}Ete(e,k,_,p.SheetNames[b],b,E,i,H,t,f,c,d)}return v={Directory:s,Workbook:f,Props:p,Custprops:y,Deps:w,Sheets:i,SheetNames:p.SheetNames,Strings:Vm,Styles:d,Themes:c,SSF:$n(Cr)},t&&t.bookFiles&&(e.files?(v.keys=n,v.files=e.files):(v.keys=[],v.files={},e.FullPaths.forEach(function(ae,te){ae=ae.replace(/^Root Entry[\/]/,""),v.keys.push(ae),v.files[ae]=e.FileIndex[te]}))),t&&t.bookVBA&&(s.vba.length>0?v.vbaraw=Is(e,go(s.vba[0]),!0):s.defaults&&s.defaults.bin===XX&&(v.vbaraw=Is(e,"xl/vbaProject.bin",!0))),v}function Ate(e,t){var r=t||{},n="Workbook",s=xr.find(e,n);try{if(n="/!DataSpaces/Version",s=xr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);if(iq(s.content),n="/!DataSpaces/DataSpaceMap",s=xr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var a=lq(s.content);if(a.length!==1||a[0].comps.length!==1||a[0].comps[0].t!==0||a[0].name!=="StrongEncryptionDataSpace"||a[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+n);if(n="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",s=xr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var i=cq(s.content);if(i.length!=1||i[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+n);if(n="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",s=xr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);dq(s.content)}catch{}if(n="/EncryptionInfo",s=xr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var l=fq(s.content);if(n="/EncryptedPackage",s=xr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);if(l[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(l[1],s.content,r.password||"",r);if(l[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(l[1],s.content,r.password||"",r);throw new Error("File is password-protected")}function Fte(e,t){return t.bookType=="ods"?sP(e,t):t.bookType=="numbers"?Cte(e,t):t.bookType=="xlsb"?Pte(e,t):Rte(e,t)}function Pte(e,t){Xh=1024,e&&!e.SSF&&(e.SSF=$n(Cr)),e&&e.SSF&&(O0(),sv(e.SSF),t.revssf=iv(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Km?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var r=t.bookType=="xlsb"?"bin":"xml",n=PF.indexOf(t.bookType)>-1,s=NS();WS(t=t||{});var a=hS(),i="",l=0;if(t.cellXfs=[],id(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),i="docProps/core.xml",Hr(a,i,q8(e.Props,t)),s.coreprops.push(i),_n(t.rels,2,i,Yr.CORE_PROPS),i="docProps/app.xml",!(e.Props&&e.Props.SheetNames))if(!e.Workbook||!e.Workbook.Sheets)e.Props.SheetNames=e.SheetNames;else{for(var c=[],d=0;d<e.SheetNames.length;++d)(e.Workbook.Sheets[d]||{}).Hidden!=2&&c.push(e.SheetNames[d]);e.Props.SheetNames=c}for(e.Props.Worksheets=e.Props.SheetNames.length,Hr(a,i,J8(e.Props)),s.extprops.push(i),_n(t.rels,3,i,Yr.EXT_PROPS),e.Custprops!==e.Props&&ms(e.Custprops||{}).length>0&&(i="docProps/custom.xml",Hr(a,i,Q8(e.Custprops)),s.custprops.push(i),_n(t.rels,4,i,Yr.CUST_PROPS)),l=1;l<=e.SheetNames.length;++l){var f={"!id":{}},p=e.Sheets[e.SheetNames[l-1]],g=(p||{})["!type"]||"sheet";switch(g){case"chart":default:i="xl/worksheets/sheet"+l+"."+r,Hr(a,i,lee(l-1,i,t,e,f)),s.sheets.push(i),_n(t.wbrels,-1,"worksheets/sheet"+l+"."+r,Yr.WS[0])}if(p){var y=p["!comments"],v=!1,w="";y&&y.length>0&&(w="xl/comments"+l+"."+r,Hr(a,w,dee(y,w)),s.comments.push(w),_n(f,-1,"../comments"+l+"."+r,Yr.CMNT),v=!0),p["!legacy"]&&v&&Hr(a,"xl/drawings/vmlDrawing"+l+".vml",AF(l,p["!comments"])),delete p["!comments"],delete p["!legacy"]}f["!id"].rId1&&Hr(a,wp(i),s0(f))}return t.Strings!=null&&t.Strings.length>0&&(i="xl/sharedStrings."+r,Hr(a,i,uee(t.Strings,i,t)),s.strs.push(i),_n(t.wbrels,-1,"sharedStrings."+r,Yr.SST)),i="xl/workbook."+r,Hr(a,i,oee(e,i)),s.workbooks.push(i),_n(t.rels,1,i,Yr.WB),i="xl/theme/theme1.xml",Hr(a,i,RS(e.Themes,t)),s.themes.push(i),_n(t.wbrels,-1,"theme/theme1.xml",Yr.THEME),i="xl/styles."+r,Hr(a,i,cee(e,i,t)),s.styles.push(i),_n(t.wbrels,-1,"styles."+r,Yr.STY),e.vbaraw&&n&&(i="xl/vbaProject.bin",Hr(a,i,e.vbaraw),s.vba.push(i),_n(t.wbrels,-1,"vbaProject.bin",Yr.VBA)),i="xl/metadata."+r,Hr(a,i,fee(i)),s.metadata.push(i),_n(t.wbrels,-1,"metadata."+r,Yr.XLMETA),Hr(a,"[Content_Types].xml",G8(s,t)),Hr(a,"_rels/.rels",s0(t.rels)),Hr(a,"xl/_rels/workbook."+r+".rels",s0(t.wbrels)),delete t.revssf,delete t.ssf,a}function Rte(e,t){Xh=1024,e&&!e.SSF&&(e.SSF=$n(Cr)),e&&e.SSF&&(O0(),sv(e.SSF),t.revssf=iv(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Km?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var r="xml",n=PF.indexOf(t.bookType)>-1,s=NS();WS(t=t||{});var a=hS(),i="",l=0;if(t.cellXfs=[],id(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),i="docProps/core.xml",Hr(a,i,q8(e.Props,t)),s.coreprops.push(i),_n(t.rels,2,i,Yr.CORE_PROPS),i="docProps/app.xml",!(e.Props&&e.Props.SheetNames))if(!e.Workbook||!e.Workbook.Sheets)e.Props.SheetNames=e.SheetNames;else{for(var c=[],d=0;d<e.SheetNames.length;++d)(e.Workbook.Sheets[d]||{}).Hidden!=2&&c.push(e.SheetNames[d]);e.Props.SheetNames=c}e.Props.Worksheets=e.Props.SheetNames.length,Hr(a,i,J8(e.Props)),s.extprops.push(i),_n(t.rels,3,i,Yr.EXT_PROPS),e.Custprops!==e.Props&&ms(e.Custprops||{}).length>0&&(i="docProps/custom.xml",Hr(a,i,Q8(e.Custprops)),s.custprops.push(i),_n(t.rels,4,i,Yr.CUST_PROPS));var f=["SheetJ5"];for(t.tcid=0,l=1;l<=e.SheetNames.length;++l){var p={"!id":{}},g=e.Sheets[e.SheetNames[l-1]],y=(g||{})["!type"]||"sheet";switch(y){case"chart":default:i="xl/worksheets/sheet"+l+"."+r,Hr(a,i,zF(l-1,t,e,p)),s.sheets.push(i),_n(t.wbrels,-1,"worksheets/sheet"+l+"."+r,Yr.WS[0])}if(g){var v=g["!comments"],w=!1,b="";if(v&&v.length>0){var E=!1;v.forEach(function(k){k[1].forEach(function(_){_.T==!0&&(E=!0)})}),E&&(b="xl/threadedComments/threadedComment"+l+"."+r,Hr(a,b,UX(v,f,t)),s.threadedcomments.push(b),_n(p,-1,"../threadedComments/threadedComment"+l+"."+r,Yr.TCMNT)),b="xl/comments"+l+"."+r,Hr(a,b,FF(v)),s.comments.push(b),_n(p,-1,"../comments"+l+"."+r,Yr.CMNT),w=!0}g["!legacy"]&&w&&Hr(a,"xl/drawings/vmlDrawing"+l+".vml",AF(l,g["!comments"])),delete g["!comments"],delete g["!legacy"]}p["!id"].rId1&&Hr(a,wp(i),s0(p))}return t.Strings!=null&&t.Strings.length>0&&(i="xl/sharedStrings."+r,Hr(a,i,yF(t.Strings,t)),s.strs.push(i),_n(t.wbrels,-1,"sharedStrings."+r,Yr.SST)),i="xl/workbook."+r,Hr(a,i,qF(e)),s.workbooks.push(i),_n(t.rels,1,i,Yr.WB),i="xl/theme/theme1.xml",Hr(a,i,RS(e.Themes,t)),s.themes.push(i),_n(t.wbrels,-1,"theme/theme1.xml",Yr.THEME),i="xl/styles."+r,Hr(a,i,TF(e,t)),s.styles.push(i),_n(t.wbrels,-1,"styles."+r,Yr.STY),e.vbaraw&&n&&(i="xl/vbaProject.bin",Hr(a,i,e.vbaraw),s.vba.push(i),_n(t.wbrels,-1,"vbaProject.bin",Yr.VBA)),i="xl/metadata."+r,Hr(a,i,jF()),s.metadata.push(i),_n(t.wbrels,-1,"metadata."+r,Yr.XLMETA),f.length>1&&(i="xl/persons/person.xml",Hr(a,i,WX(f)),s.people.push(i),_n(t.wbrels,-1,"persons/person.xml",Yr.PEOPLE)),Hr(a,"[Content_Types].xml",G8(s,t)),Hr(a,"_rels/.rels",s0(t.rels)),Hr(a,"xl/_rels/workbook."+r+".rels",s0(t.wbrels)),delete t.revssf,delete t.ssf,a}function zS(e,t){var r="";switch((t||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":r=Yi(e.slice(0,12));break;case"binary":r=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3),r.charCodeAt(4),r.charCodeAt(5),r.charCodeAt(6),r.charCodeAt(7)]}function Dte(e,t){return xr.find(e,"EncryptedPackage")?Ate(e,t):QF(e,t)}function Ite(e,t){var r,n=e,s=t||{};return s.type||(s.type=Gr&&Buffer.isBuffer(e)?"buffer":"base64"),r=w8(n,s),jte(r,s)}function iP(e,t){var r=0;e:for(;r<e.length;)switch(e.charCodeAt(r)){case 10:case 13:case 32:++r;break;case 60:return x2(e.slice(r),t);default:break e}return x0.to_workbook(e,t)}function Mte(e,t){var r="",n=zS(e,t);switch(t.type){case"base64":r=Yi(e);break;case"binary":r=e;break;case"buffer":r=e.toString("binary");break;case"array":r=vf(e);break;default:throw new Error("Unrecognized type "+t.type)}return n[0]==239&&n[1]==187&&n[2]==191&&(r=Nn(r)),t.type="binary",iP(r,t)}function Ote(e,t){var r=e;return t.type=="base64"&&(r=Yi(r)),r=gp.utils.decode(1200,r.slice(2),"str"),t.type="binary",iP(r,t)}function Lte(e){return e.match(/[^\x00-\x7F]/)?Il(e):e}function t_(e,t,r,n){return n?(r.type="string",x0.to_workbook(e,r)):x0.to_workbook(t,r)}function w2(e,t){lS();var r=t||{};if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return w2(new Uint8Array(e),(r=$n(r),r.type="array",r));typeof Uint8Array<"u"&&e instanceof Uint8Array&&!r.type&&(r.type=typeof Deno<"u"?"buffer":"array");var n=e,s=[0,0,0,0],a=!1;if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),i0={},r.dateNF&&(i0.dateNF=r.dateNF),r.type||(r.type=Gr&&Buffer.isBuffer(e)?"buffer":"base64"),r.type=="file"&&(r.type=Gr?"buffer":"binary",n=PH(e),typeof Uint8Array<"u"&&!Gr&&(r.type="array")),r.type=="string"&&(a=!0,r.type="binary",r.codepage=65001,n=Lte(e)),r.type=="array"&&typeof Uint8Array<"u"&&e instanceof Uint8Array&&typeof ArrayBuffer<"u"){var i=new ArrayBuffer(3),l=new Uint8Array(i);if(l.foo="bar",!l.foo)return r=$n(r),r.type="array",w2(cS(n),r)}switch((s=zS(n,r))[0]){case 208:if(s[1]===207&&s[2]===17&&s[3]===224&&s[4]===161&&s[5]===177&&s[6]===26&&s[7]===225)return Dte(xr.read(n,r),r);break;case 9:if(s[1]<=8)return QF(n,r);break;case 60:return x2(n,r);case 73:if(s[1]===73&&s[2]===42&&s[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(s[1]===68)return zK(n,r);break;case 84:if(s[1]===65&&s[2]===66&&s[3]===76)return pF.to_workbook(n,r);break;case 80:return s[1]===75&&s[2]<9&&s[3]<9?Ite(n,r):t_(e,n,r,a);case 239:return s[3]===60?x2(n,r):t_(e,n,r,a);case 255:if(s[1]===254)return Ote(n,r);if(s[1]===0&&s[2]===2&&s[3]===0)return tf.to_workbook(n,r);break;case 0:if(s[1]===0&&(s[2]>=2&&s[3]===0||s[2]===0&&(s[3]===8||s[3]===9)))return tf.to_workbook(n,r);break;case 3:case 131:case 139:case 140:return p2.to_workbook(n,r);case 123:if(s[1]===92&&s[2]===114&&s[3]===116)return SF.to_workbook(n,r);break;case 10:case 13:case 32:return Mte(n,r);case 137:if(s[1]===80&&s[2]===78&&s[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return WK.indexOf(s[0])>-1&&s[2]<=12&&s[3]<=31?p2.to_workbook(n,r):t_(e,n,r,a)}function oP(e,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return Yp(t.file,xr.write(e,{type:Gr?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return xr.write(e,t)}function Bte(e,t){var r=$n(t||{}),n=Fte(e,r);return Ute(n,r)}function Ute(e,t){var r={},n=Gr?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(t.compression&&(r.compression="DEFLATE"),t.password)r.type=n;else switch(t.type){case"base64":r.type="base64";break;case"binary":r.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":r.type=n;break;default:throw new Error("Unrecognized type "+t.type)}var s=e.FullPaths?xr.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[r.type]||r.type,compression:!!t.compression}):e.generate(r);if(typeof Deno<"u"&&typeof s=="string"){if(t.type=="binary"||t.type=="base64")return s;s=new Uint8Array(nv(s))}return t.password&&typeof encrypt_agile<"u"?oP(encrypt_agile(s,t.password),t):t.type==="file"?Yp(t.file,s):t.type=="string"?Nn(s):s}function $te(e,t){var r=t||{},n=Lee(e,r);return oP(n,r)}function jl(e,t,r){r||(r="");var n=r+e;switch(t.type){case"base64":return mp(Il(n));case"binary":return Il(n);case"string":return e;case"file":return Yp(t.file,n,"utf8");case"buffer":return Gr?Bc(n,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(n):jl(n,{type:"binary"}).split("").map(function(s){return s.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function Wte(e,t){switch(t.type){case"base64":return mp(e);case"binary":return e;case"string":return e;case"file":return Yp(t.file,e,"binary");case"buffer":return Gr?Bc(e,"binary"):e.split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function jy(e,t){switch(t.type){case"string":case"base64":case"binary":for(var r="",n=0;n<e.length;++n)r+=String.fromCharCode(e[n]);return t.type=="base64"?mp(r):t.type=="string"?Nn(r):r;case"file":return Yp(t.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+t.type)}}function lP(e,t){lS(),DZ(e);var r=$n(t||{});if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),r.type=="array"){r.type="binary";var n=lP(e,r);return r.type="array",nv(n)}var s=0;if(r.sheet&&(typeof r.sheet=="number"?s=r.sheet:s=e.SheetNames.indexOf(r.sheet),!e.SheetNames[s]))throw new Error("Sheet not found: "+r.sheet+" : "+typeof r.sheet);switch(r.bookType||"xlsb"){case"xml":case"xlml":return jl(Fee(e,r),r);case"slk":case"sylk":return jl(mF.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"htm":case"html":return jl(eP(e.Sheets[e.SheetNames[s]],r),r);case"txt":return Wte(cP(e.Sheets[e.SheetNames[s]],r),r);case"csv":return jl(HS(e.Sheets[e.SheetNames[s]],r),r,"\uFEFF");case"dif":return jl(pF.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"dbf":return jy(p2.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"prn":return jl(x0.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"rtf":return jl(SF.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"eth":return jl(xF.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"fods":return jl(sP(e,r),r);case"wk1":return jy(tf.sheet_to_wk1(e.Sheets[e.SheetNames[s]],r),r);case"wk3":return jy(tf.book_to_wk3(e,r),r);case"biff2":r.biff||(r.biff=2);case"biff3":r.biff||(r.biff=3);case"biff4":return r.biff||(r.biff=4),jy(ZF(e,r),r);case"biff5":r.biff||(r.biff=5);case"biff8":case"xla":case"xls":return r.biff||(r.biff=8),$te(e,r);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return Bte(e,r);default:throw new Error("Unrecognized bookType |"+r.bookType+"|")}}function zte(e){if(!e.bookType){var t={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},r=e.file.slice(e.file.lastIndexOf(".")).toLowerCase();r.match(/^\.[a-z]+$/)&&(e.bookType=r.slice(1)),e.bookType=t[e.bookType]||e.bookType}}function Hte(e,t,r){var n={};return n.type="file",n.file=t,zte(n),lP(e,n)}function Gte(e,t,r,n,s,a,i,l){var c=Ts(r),d=l.defval,f=l.raw||!Object.prototype.hasOwnProperty.call(l,"raw"),p=!0,g=s===1?[]:{};if(s!==1)if(Object.defineProperty)try{Object.defineProperty(g,"__rowNum__",{value:r,enumerable:!1})}catch{g.__rowNum__=r}else g.__rowNum__=r;if(!i||e[r])for(var y=t.s.c;y<=t.e.c;++y){var v=i?e[r][y]:e[n[y]+c];if(v===void 0||v.t===void 0){if(d===void 0)continue;a[y]!=null&&(g[a[y]]=d);continue}var w=v.v;switch(v.t){case"z":if(w==null)break;continue;case"e":w=w==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+v.t)}if(a[y]!=null){if(w==null)if(v.t=="e"&&w===null)g[a[y]]=null;else if(d!==void 0)g[a[y]]=d;else if(f&&w===null)g[a[y]]=null;else continue;else g[a[y]]=f&&(v.t!=="n"||v.t==="n"&&l.rawNumbers!==!1)?w:Mc(v,w,l);w!=null&&(p=!1)}}return{row:g,isempty:p}}function N1(e,t){if(e==null||e["!ref"]==null)return[];var r={t:"n",v:0},n=0,s=1,a=[],i=0,l="",c={s:{r:0,c:0},e:{r:0,c:0}},d=t||{},f=d.range!=null?d.range:e["!ref"];switch(d.header===1?n=1:d.header==="A"?n=2:Array.isArray(d.header)?n=3:d.header==null&&(n=0),typeof f){case"string":c=sn(f);break;case"number":c=sn(e["!ref"]),c.s.r=f;break;default:c=f}n>0&&(s=0);var p=Ts(c.s.r),g=[],y=[],v=0,w=0,b=Array.isArray(e),E=c.s.r,k=0,_={};b&&!e[E]&&(e[E]=[]);var T=d.skipHidden&&e["!cols"]||[],j=d.skipHidden&&e["!rows"]||[];for(k=c.s.c;k<=c.e.c;++k)if(!(T[k]||{}).hidden)switch(g[k]=es(k),r=b?e[E][k]:e[g[k]+p],n){case 1:a[k]=k-c.s.c;break;case 2:a[k]=g[k];break;case 3:a[k]=d.header[k-c.s.c];break;default:if(r==null&&(r={w:"__EMPTY",t:"s"}),l=i=Mc(r,null,d),w=_[i]||0,!w)_[i]=1;else{do l=i+"_"+w++;while(_[l]);_[i]=w,_[l]=1}a[k]=l}for(E=c.s.r+s;E<=c.e.r;++E)if(!(j[E]||{}).hidden){var P=Gte(e,c,E,g,n,a,b,d);(P.isempty===!1||(n===1?d.blankrows!==!1:d.blankrows))&&(y[v++]=P.row)}return y.length=v,y}var C3=/"/g;function Vte(e,t,r,n,s,a,i,l){for(var c=!0,d=[],f="",p=Ts(r),g=t.s.c;g<=t.e.c;++g)if(n[g]){var y=l.dense?(e[r]||[])[g]:e[n[g]+p];if(y==null)f="";else if(y.v!=null){c=!1,f=""+(l.rawNumbers&&y.t=="n"?y.v:Mc(y,null,l));for(var v=0,w=0;v!==f.length;++v)if((w=f.charCodeAt(v))===s||w===a||w===34||l.forceQuotes){f='"'+f.replace(C3,'""')+'"';break}f=="ID"&&(f='"ID"')}else y.f!=null&&!y.F?(c=!1,f="="+y.f,f.indexOf(",")>=0&&(f='"'+f.replace(C3,'""')+'"')):f="";d.push(f)}return l.blankrows===!1&&c?null:d.join(i)}function HS(e,t){var r=[],n=t??{};if(e==null||e["!ref"]==null)return"";var s=sn(e["!ref"]),a=n.FS!==void 0?n.FS:",",i=a.charCodeAt(0),l=n.RS!==void 0?n.RS:`
`,c=l.charCodeAt(0),d=new RegExp((a=="|"?"\\|":a)+"+$"),f="",p=[];n.dense=Array.isArray(e);for(var g=n.skipHidden&&e["!cols"]||[],y=n.skipHidden&&e["!rows"]||[],v=s.s.c;v<=s.e.c;++v)(g[v]||{}).hidden||(p[v]=es(v));for(var w=0,b=s.s.r;b<=s.e.r;++b)(y[b]||{}).hidden||(f=Vte(e,s,b,p,i,c,a,n),f!=null&&(n.strip&&(f=f.replace(d,"")),(f||n.blankrows!==!1)&&r.push((w++?l:"")+f)));return delete n.dense,r.join("")}function cP(e,t){t||(t={}),t.FS="	",t.RS=`
`;var r=HS(e,t);return r}function Kte(e){var t="",r,n="";if(e==null||e["!ref"]==null)return[];var s=sn(e["!ref"]),a="",i=[],l,c=[],d=Array.isArray(e);for(l=s.s.c;l<=s.e.c;++l)i[l]=es(l);for(var f=s.s.r;f<=s.e.r;++f)for(a=Ts(f),l=s.s.c;l<=s.e.c;++l)if(t=i[l]+a,r=d?(e[f]||[])[l]:e[t],n="",r!==void 0){if(r.F!=null){if(t=r.F,!r.f)continue;n=r.f,t.indexOf(":")==-1&&(t=t+":"+t)}if(r.f!=null)n=r.f;else{if(r.t=="z")continue;if(r.t=="n"&&r.v!=null)n=""+r.v;else if(r.t=="b")n=r.v?"TRUE":"FALSE";else if(r.w!==void 0)n="'"+r.w;else{if(r.v===void 0)continue;r.t=="s"?n="'"+r.v:n=""+r.v}}c[c.length]=t+"="+n}return c}function uP(e,t,r){var n=r||{},s=+!n.skipHeader,a=e||{},i=0,l=0;if(a&&n.origin!=null)if(typeof n.origin=="number")i=n.origin;else{var c=typeof n.origin=="string"?ts(n.origin):n.origin;i=c.r,l=c.c}var d,f={s:{c:0,r:0},e:{c:l,r:i+t.length-1+s}};if(a["!ref"]){var p=sn(a["!ref"]);f.e.c=Math.max(f.e.c,p.e.c),f.e.r=Math.max(f.e.r,p.e.r),i==-1&&(i=p.e.r+1,f.e.r=i+t.length-1+s)}else i==-1&&(i=0,f.e.r=t.length-1+s);var g=n.header||[],y=0;t.forEach(function(w,b){ms(w).forEach(function(E){(y=g.indexOf(E))==-1&&(g[y=g.length]=E);var k=w[E],_="z",T="",j=jr({c:l+y,r:i+b+s});d=Np(a,j),k&&typeof k=="object"&&!(k instanceof Date)?a[j]=k:(typeof k=="number"?_="n":typeof k=="boolean"?_="b":typeof k=="string"?_="s":k instanceof Date?(_="d",n.cellDates||(_="n",k=Ys(k)),T=n.dateNF||Cr[14]):k===null&&n.nullError&&(_="e",k=0),d?(d.t=_,d.v=k,delete d.w,delete d.R,T&&(d.z=T)):a[j]=d={t:_,v:k},T&&(d.z=T))})}),f.e.c=Math.max(f.e.c,l+g.length-1);var v=Ts(i);if(s)for(y=0;y<g.length;++y)a[es(y+l)+v]={t:"s",v:g[y]};return a["!ref"]=zr(f),a}function qte(e,t){return uP(null,e,t)}function Np(e,t,r){if(typeof t=="string"){if(Array.isArray(e)){var n=ts(t);return e[n.r]||(e[n.r]=[]),e[n.r][n.c]||(e[n.r][n.c]={t:"z"})}return e[t]||(e[t]={t:"z"})}return typeof t!="number"?Np(e,jr(t)):Np(e,jr({r:t,c:r||0}))}function Xte(e,t){if(typeof t=="number"){if(t>=0&&e.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}else if(typeof t=="string"){var r=e.SheetNames.indexOf(t);if(r>-1)return r;throw new Error("Cannot find sheet name |"+t+"|")}else throw new Error("Cannot find sheet |"+t+"|")}function GS(){return{SheetNames:[],Sheets:{}}}function VS(e,t,r,n){var s=1;if(!r)for(;s<=65535&&e.SheetNames.indexOf(r="Sheet"+s)!=-1;++s,r=void 0);if(!r||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(n&&e.SheetNames.indexOf(r)>=0){var a=r.match(/(^.*?)(\d+)$/);s=a&&+a[2]||0;var i=a&&a[1]||r;for(++s;s<=65535&&e.SheetNames.indexOf(r=i+s)!=-1;++s);}if(KF(r),e.SheetNames.indexOf(r)>=0)throw new Error("Worksheet with name |"+r+"| already exists!");return e.SheetNames.push(r),e.Sheets[r]=t,r}function Yte(e,t,r){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var n=Xte(e,t);switch(e.Workbook.Sheets[n]||(e.Workbook.Sheets[n]={}),r){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+r)}e.Workbook.Sheets[n].Hidden=r}function Jte(e,t){return e.z=t,e}function dP(e,t,r){return t?(e.l={Target:t},r&&(e.l.Tooltip=r)):delete e.l,e}function Qte(e,t,r){return dP(e,"#"+t,r)}function Zte(e,t,r){e.c||(e.c=[]),e.c.push({t,a:r||"SheetJS"})}function ere(e,t,r,n){for(var s=typeof t!="string"?t:sn(t),a=typeof t=="string"?t:zr(t),i=s.s.r;i<=s.e.r;++i)for(var l=s.s.c;l<=s.e.c;++l){var c=Np(e,i,l);c.t="n",c.F=a,delete c.v,i==s.s.r&&l==s.s.c&&(c.f=r,n&&(c.D=!0))}return e}var By={encode_col:es,encode_row:Ts,encode_cell:jr,encode_range:zr,decode_col:_S,decode_row:wS,split_cell:uG,decode_cell:ts,decode_range:Di,format_cell:Mc,sheet_add_aoa:L8,sheet_add_json:uP,sheet_add_dom:tP,aoa_to_sheet:L0,json_to_sheet:qte,table_to_sheet:rP,table_to_book:ite,sheet_to_csv:HS,sheet_to_txt:cP,sheet_to_json:N1,sheet_to_html:eP,sheet_to_formulae:Kte,sheet_to_row_object_array:N1,sheet_get_cell:Np,book_new:GS,book_append_sheet:VS,book_set_sheet_visibility:Yte,cell_set_number_format:Jte,cell_set_hyperlink:dP,cell_set_internal_link:Qte,cell_add_comment:Zte,sheet_set_array_formula:ere,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};const fP=({onBackToCabinet:e,selectedGrade:t,selectedClass:r,openRetestModal:n})=>{Ii(),A1();const{user:s,isAuthenticated:a}=Wn(),{showNotification:i}=da(),l=C.useCallback(je=>{let Ke=null;if(typeof je?.percentage=="number"&&!Number.isNaN(je.percentage))return Ke=Math.round(je.percentage),console.debug("[TeacherResults] Using provided percentage",{percentage:je.percentage,rounded:Ke,result:je}),Ke;const Mt=je?.retest_best_score??je?.score,it=je?.retest_best_max_score??je?.max_score,_r=Number(Mt??0),Ut=Number(it??0);return Ut>0&&(Ke=Math.round(_r/Ut*100)),Ke},[]);C.useCallback(je=>{const Ke=l(je);return Ke===null?"text-gray-600":Ke<50?"text-red-600 font-semibold":Ke<70?"text-yellow-600":"text-green-600"},[l]),C.useCallback(je=>{const Ke=l(je);return Ke!==null&&Ke<50},[l]);const[c,d]=C.useState(null),[f,p]=C.useState(!0),[g,y]=C.useState(""),[v,w]=C.useState([]),[b,E]=C.useState(null),[k,_]=C.useState(!1),[T,j]=C.useState([]),[P,R]=C.useState([]),[N,A]=C.useState([1,2]),[M,H]=C.useState(null),[Q,Z]=C.useState(null),[ae,te]=C.useState(null),[se,L]=C.useState("main"),[G,I]=C.useState(null),[z,V]=C.useState(null),O=G||t,W=z||r,[q,Y]=C.useState(null),[ee,X]=C.useState({}),[ne,ge]=C.useState(!1),[_e,Pe]=C.useState(new Set),[ce,ye]=C.useState(!0),[Fe,Me]=C.useState(null),[Oe,He]=C.useState(null),[It,Ze]=C.useState(!1),[Le,De]=C.useState(!1),[et,bt]=C.useState(!1),ut=C.useRef(null),[jt,Rt]=C.useState(null),[Xe,Ye]=C.useState(!1),[pt,mt]=C.useState(null),[_t,Ht]=C.useState(!1),[Qt,nr]=C.useState(null),[Nr,fr]=C.useState(""),[hr,sr]=C.useState(""),[Er,he]=C.useState(!1),[le,pe]=C.useState(!1),[be,Ve]=C.useState(null),[Ct,Et]=C.useState(""),[Be,at]=C.useState(!1),[dt,zt]=C.useState(new Set),[Yt,wr]=C.useState({}),[Ur,yr]=C.useState(!1),[ur,oe]=C.useState(null),[we,fe]=C.useState(""),[me,Se]=C.useState(!1),ke=C.useRef(new Set),We=C.useRef({}),ft=C.useRef(null);C.useEffect(()=>{console.log("🎯 editingColumns state changed:",Array.from(dt)),ke.current=dt},[dt]),C.useEffect(()=>{console.log("🎯 columnScores state changed:",Yt),We.current=Yt},[Yt]);const Re=C.useCallback(je=>{console.log("🔄 Toggling test collapse for:",je),Pe(Ke=>{const Mt=new Set(Ke);return Mt.has(je)?(Mt.delete(je),console.log("📤 Expanding test:",je)):(Mt.add(je),console.log("📥 Collapsing test:",je)),console.log("📋 New collapsed tests:",Array.from(Mt)),Mt})},[]),ie=C.useCallback(()=>{if(ut.current){const{scrollLeft:je,scrollWidth:Ke,clientWidth:Mt}=ut.current;De(je>0),bt(je<Ke-Mt-1)}},[]);C.useEffect(()=>{Ce()},[]),C.useEffect(()=>{if(M&&ut.current){const je=setTimeout(ie,100);return()=>clearTimeout(je)}},[M,ie]),C.useEffect(()=>{console.log("📋 Current collapsed tests state:",Array.from(_e))},[_e]);const de=C.useCallback(async je=>{try{ge(!0);const Ke=s?.teacher_id,Mt=`${O}/${W}`,it=await tz.getTeacherStudentResults(Ke,O,Mt,je);if(it.success){console.log("📅 Results loaded for term:",je,it.results?.length||0,"results"),console.log("📅 Students loaded:",it.students?.length||0,"students");const _r=[],Ut=new Set,mr=new Set;it.results&&it.results.length>0&&it.results.forEach(Tt=>{Tt.test_name&&!Ut.has(Tt.test_name)&&(Ut.add(Tt.test_name),_r.push({test_name:Tt.test_name,test_type:Tt.test_type,subject:Tt.subject})),Tt.subject&&mr.add(Tt.subject)});const Mr=(it.students||[]).map(Tt=>{const Pt={};return(it.results||[]).filter(pr=>pr.student_id===Tt.student_id).forEach(pr=>{pr.test_name&&(Pt[pr.test_name]={id:pr.id,test_type:pr.test_type,test_id:pr.test_id,subject_id:pr.subject_id,score:pr.score,max_score:pr.max_score,retest_offered:pr.retest_offered,caught_cheating:pr.caught_cheating,visibility_change_times:pr.visibility_change_times,answers:pr.answers,ai_feedback:pr.ai_feedback,name:pr.name,surname:pr.surname,test_name:pr.test_name})}),{...Tt,...Pt}}),lt={results:it.results||[],students:Mr,class:Mr,unique_tests:_r,subjects:Array.from(mr),count:it.count||0,student_count:it.student_count||0};console.log("📅 Processed results data:",{uniqueTests:_r.length,subjects:Array.from(mr),resultsCount:it.results?.length||0,studentsWithScores:Mr.length,sampleStudent:Mr[0]}),H(lt),X(lt),te(new Date)}}catch(Ke){console.error("📅 Error loading results for term:",Ke),H(null),X(null)}finally{ge(!1)}},[s,O,W]);C.useEffect(()=>{(async()=>{try{Ze(!0),await Ic.loadAcademicCalendar();const Ke=Ic.getCurrentSemesterTerms();He(Ke),Ke?.currentTerm&&(Me(Ke.currentTerm.id),O&&W&&de(Ke.currentTerm.id))}catch(Ke){console.error("📅 Error initializing academic calendar:",Ke)}finally{Ze(!1)}})()},[O,W]),C.useEffect(()=>{t&&r&&(console.log("👨‍🏫 Props detected:",{grade:t,class:r}),Oe?.currentTerm&&(Me(Oe.currentTerm.id),de(Oe.currentTerm.id)))},[t,r,Oe]);const Ce=C.useCallback(async()=>{console.log("👨‍🏫 Initializing teacher results...");try{if(p(!0),y(""),!a||!s){console.log("👨‍🏫 User not authenticated"),y("User not authenticated");return}if(s.role!==fi.TEACHER){console.error("👨‍🏫 Invalid user role for teacher results:",s.role),y("Access denied. Teacher role required.");return}console.log("👨‍🏫 Loading teacher assignments..."),await Ne(),console.log("👨‍🏫 TODO: Load academic calendar service"),console.log("👨‍🏫 Teacher results initialization complete!")}catch(je){console.error("👨‍🏫 Error initializing teacher results:",je),y("Failed to initialize teacher results")}finally{p(!1)}},[a,s]),Ne=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher assignments...");try{const je=`teacher_data_${s?.teacher_id||s?.id||""}`;let Ke=Jn(je);Ke&&Ke.subjects&&Ke.subjects.length>0&&(Ke.subjects.some(lt=>lt.subject&&lt.classes&&lt.classes.length>0)||(console.log("👨‍🏫 Cached data has invalid subject structure, forcing refresh"),localStorage.removeItem(je),Ke=null)),Ke?console.log("👨‍🏫 Cache HIT! Using cached teacher data"):(console.log("👨‍🏫 Cache MISS! Fetching teacher data from API"),Ke=await Vn.getTeacherData(),console.log("👨‍🏫 Teacher data loaded:",Ke),Qn(je,Ke,hs.teacher_subjects)),d(Ke);const Mt=[];Ke&&Ke.subjects&&(console.log("👨‍🏫 Teacher subjects structure:",Ke.subjects),Ke.subjects.forEach(Mr=>{console.log("👨‍🏫 Processing subject:",Mr),Mr.classes&&Mr.classes.forEach(lt=>{lt.grade&&lt.class&&Mt.push({grade:lt.grade,class:lt.class,subject:Mr.subject||Mr.name||"Unknown Subject"})})})),R(Mt),console.log("👨‍🏫 Available classes from teacher data:",Mt);const it=`teacher_tests_${s?.teacher_id||s?.id||""}`,_r=Jn(it);_r&&_r.some(Mr=>Mr.test_type==="drawing")&&(console.log("🎨 Drawing test detected - forcing cache refresh"),localStorage.removeItem(it));let Ut=Jn(it);Ut?console.log("👨‍🏫 Cache HIT! Using cached teacher tests"):(console.log("👨‍🏫 Cache MISS! Fetching teacher tests from API"),Ut=await ln.getTeacherTests(),console.log("👨‍🏫 Teacher tests loaded:",Ut),Qn(it,Ut,hs.teacher_tests));const mr=Ut.flatMap(Mr=>Mr.assignments||[]);w(mr),console.log("👨‍🏫 Raw assignments data:",mr),console.log("👨‍🏫 Teacher assignments loaded:",mr.length)}catch(je){console.error("👨‍🏫 Error loading teacher assignments:",je),i("Failed to load teacher assignments","error")}},[i]),Ge=C.useCallback(async(je,Ke)=>{console.log("👨‍🏫 Showing classes for grade:",je,"class:",Ke),I(je),V(Ke),E(null),H(null),je&&Ke&&console.log("👨‍🏫 TODO: Implement academic calendar service for term selection")},[]);C.useCallback((je,Ke)=>{console.log("👨‍🏫 Showing semesters for class:",je,Ke),E(null),H(null),console.log("👨‍🏫 TODO: Implement academic calendar service for term selection")},[]),C.useCallback((je,Ke)=>{console.log("👨‍🏫 Class clicked:",je,Ke),_(!0),console.log("👨‍🏫 TODO: Implement academic calendar service for term selection")},[]);const Je=C.useCallback(async je=>{!O||!W||(console.log("👨‍🏫 Loading results for semester:",je),E(je),Oe?.currentTerm&&await de(Oe.currentTerm.id))},[O,W,Oe,de]),yt=C.useCallback(()=>Oe?o.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[o.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Current Semester: ",Oe?.semester===1?"Semester 1":"Semester 2"]}),o.jsx("div",{className:"flex space-x-4",children:Oe?.terms.map(je=>o.jsx(Qe.button,{className:`px-6 py-3 rounded-lg font-semibold transition-all duration-300 ${je.isCurrent?"bg-blue-600 text-white shadow-lg":Fe===je.id?"bg-green-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>{Me(je.id),de(je.id)},whileHover:{scale:1.05},whileTap:{scale:.95},children:je.label},je.id))})]}):o.jsx("div",{className:"flex space-x-4 mb-6",children:o.jsx("div",{className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-500",children:"Loading terms..."})}),[Oe,Fe,de]);C.useCallback(je=>je.reduce((Ke,Mt)=>(Ke[Mt.student_id]||(Ke[Mt.student_id]=[]),Ke[Mt.student_id].push(Mt),Ke),{}),[]),C.useCallback(je=>{if(je.length===0)return 0;const Ke=je.reduce((Mt,it)=>Mt+(it.percentage||0),0);return Math.round(Ke/je.length)},[]),C.useCallback(je=>{je.score<je.passing_score&&window.confirm("Give another try?")&&Vt(je.student_id,je.test_id)},[]);const Vt=C.useCallback(async(je,Ke)=>{try{(await fetch("/.netlify/functions/reset-test-attempt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:je,testId:Ke})})).ok&&(W&&Je(b),i("Test made accessible to student","success"))}catch(Mt){console.error("Error resetting test attempt:",Mt),i("Failed to reset test attempt","error")}},[W,b,Je,i]),gt=C.useCallback((je,Ke)=>{if(je===null||Ke===null)return"";const Mt=Math.round(je/Ke*100);return Mt>=80?"text-green-600 bg-green-50":Mt>=60?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50"},[]),Ot=C.useCallback(je=>{Rt(je),Ye(!0)},[]),vr=C.useCallback((je,Ke="overview",Mt)=>{try{const _r=!!je?.ai_feedback,Ut=typeof je?.ai_feedback;let mr=[];if(_r)if(Ut==="string")try{mr=Object.keys(JSON.parse(je.ai_feedback))}catch{mr=["<invalid json>"]}else Ut==="object"&&(mr=Object.keys(je.ai_feedback||{}));console.log("[AI DEBUG] Opening speaking result",{hasAi:_r,aiType:Ut,aiKeys:mr})}catch{}const it={...je,__initialTab:Ke};Mt&&(it.__audioUrl=Mt),mt(it),Ht(!0)},[]);C.useCallback((je,Ke,Mt)=>{nr({resultId:je,score:Ke,maxScore:Mt}),fr(Ke?.toString()||""),sr(Mt?.toString()||""),pe(!0)},[]),C.useCallback(je=>{fr(je)},[]),C.useCallback(je=>{sr(je)},[]),C.useCallback(async()=>{if(Qt){he(!0);try{const je={resultId:Qt.resultId,score:parseInt(Nr)||0,maxScore:parseInt(hr)||1};(await fetch(Sm.UPDATE_DRAWING_TEST_SCORE,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(je)})).ok?(i("Score updated successfully","success"),W&&Je(b),nr(null),fr(""),sr(""),pe(!1)):i("Failed to update score","error")}catch(je){console.error("Error updating score:",je),i("Failed to update score","error")}finally{he(!1)}}},[Qt,Nr,hr,W,b,Je,i]),C.useCallback(()=>{nr(null),fr(""),sr(""),pe(!1)},[]);const kr=C.useCallback((je,Ke)=>{Ve({resultId:je,score:Ke}),Et(Ke.toString())},[]),Pr=C.useCallback(async()=>{if(be){at(!0);try{const je={resultId:be.resultId,score:parseInt(Ct)||0},Ke=await fetch(Sm.UPDATE_SPEAKING_TEST_SCORE,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(je)});if(Ke.ok){const Mt=await Ke.json();i("Speaking test score updated successfully","success"),pt&&mt(it=>({...it,score:Mt.score,percentage:Mt.percentage})),W&&Je(b),Ve(null),Et("")}else{const Mt=await Ke.json();i(Mt.error||"Failed to update speaking test score","error")}}catch(je){console.error("Error updating speaking test score:",je),i("Failed to update speaking test score","error")}finally{at(!1)}}},[be,Ct,W,b,Je,i]),hn=C.useCallback(()=>{Ve(null),Et("")},[]),Kr=(je,Ke)=>{console.log("🎯 Starting column editing for drawing test:",je),console.log("🎯 Current editingColumns before update:",Array.from(dt)),console.log("🎯 Results data passed to function:",Ke),zt(Mt=>{const it=new Set(Mt).add(je);return console.log("🎯 Updated editingColumns:",Array.from(it)),it}),console.log("🎯 Initializing column scores for test:",je),console.log("🎯 Results data:",Ke),console.log("🎯 Results.class:","null"),console.log("🎯 No results or class data available")},$r=C.useCallback(je=>{zt(Ke=>{const Mt=new Set(Ke);return Mt.delete(je),Mt}),wr(Ke=>{const Mt={...Ke};return delete Mt[je],Mt})},[]),or=C.useCallback((je,Ke,Mt,it)=>{const _r=it.toString();We.current[je]||(We.current[je]={}),We.current[je][Ke]||(We.current[je][Ke]={}),We.current[je][Ke][Mt]=_r;const Ut=parseInt(it)||0;wr(mr=>({...mr,[je]:{...mr[je],[Ke]:{...mr[je]?.[Ke],[Mt]:Ut}}}))},[]),xe=C.useCallback(async je=>{if(We.current[je]){yr(!0);try{const Ke=Object.entries(We.current[je]).map(([Ut,mr])=>({resultId:mr.resultId,score:parseInt(mr.score)||0,maxScore:parseInt(mr.maxScore)||100}));console.log("🎯 Saving column scores for",je,":",Ke);const Mt=Ke.map(Ut=>(console.log("🎯 Sending update:",Ut),fetch(Sm.UPDATE_DRAWING_TEST_SCORE,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ut)})));(await Promise.all(Mt)).every(Ut=>Ut.ok)?(i(`Scores updated successfully for ${je}`,"success"),W&&Je(b),$r(je)):i("Failed to update some scores","error")}catch(Ke){console.error("Error updating column scores:",Ke),i("Failed to update scores","error")}finally{yr(!1)}}},[Yt,W,b,Je,i,$r]),ht=C.useCallback((je,Ke,Mt)=>!Ke||Ke.length===0?o.jsx(Qe.div,{className:"text-center py-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:o.jsx("p",{className:"text-gray-500",children:"No students found for this subject"})}):o.jsx(Qe.div,{className:"relative",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:o.jsxs(Qe.div,{className:"bg-white rounded-lg shadow-lg overflow-hidden",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1},children:[o.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",onScroll:it=>{ut.current&&(ut.current.scrollLeft=it.target.scrollLeft)},children:o.jsx("div",{className:"min-w-full h-1",children:o.jsx("div",{className:"h-1",style:{width:`${(Mt.length+5)*120}px`}})})}),o.jsx("div",{ref:ut,className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",onScroll:it=>{ie(it);const _r=it.target.previousElementSibling;_r&&(_r.scrollLeft=it.target.scrollLeft)},children:o.jsxs("table",{className:"min-w-full border-collapse text-sm min-w-max",children:[o.jsx("thead",{children:o.jsxs(Qe.tr,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:[o.jsx("th",{className:"border-b border-gray-200 px-4 py-4 text-left font-semibold text-gray-700 w-20 text-center",children:"Student ID"}),o.jsx("th",{className:`border-b border-gray-200 px-2 py-4 text-left font-semibold text-gray-700 ${ce?"w-8 min-w-[32px] max-w-[32px] bg-gray-100 cursor-pointer select-none":"min-w-[180px] bg-blue-50 cursor-pointer select-none"}`,onClick:it=>{it.preventDefault(),it.stopPropagation(),ye(!ce)},title:"Toggle student name columns",children:ce?o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"truncate",title:"Student Name",children:"Student Name"}),o.jsx("svg",{className:"w-4 h-4 ml-1 flex-shrink-0 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),o.jsx("th",{className:"border-b border-gray-200 px-4 py-4 text-left font-semibold text-gray-700 w-16 text-center",children:"No."}),o.jsx("th",{className:"border-b border-gray-200 px-4 py-4 text-left font-semibold text-gray-700 min-w-[100px]",children:"Nickname"}),Mt.map((it,_r)=>{const Ut=_e.has(it.test_name),mr=it.test_type==="drawing",Mr=ke.current.has(it.test_name);return console.log(`🎯 Rendering test ${it.test_name}:`,{isDrawingTest:mr,isEditingColumn:Mr,editingColumns:Array.from(ke.current),test_type:it.test_type}),o.jsx("th",{className:`border-b border-gray-200 px-2 py-4 text-left font-semibold text-gray-700 cursor-pointer hover:bg-blue-200 transition-colors select-none ${Ut?"w-8 min-w-[32px] max-w-[32px] bg-gray-100":"min-w-[100px] bg-blue-50"}`,onClick:lt=>{lt.preventDefault(),lt.stopPropagation(),Re(it.test_name)},children:Ut?o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"truncate",title:it.test_name,children:it.test_name.length>8?it.test_name.substring(0,8)+"...":it.test_name}),o.jsx("svg",{className:"w-4 h-4 ml-1 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})},_r)})]})}),o.jsx("tbody",{children:o.jsx(ji,{children:Ke.map((it,_r)=>o.jsxs(Qe.tr,{className:`border-b border-gray-100 hover:bg-blue-50 transition-colors duration-200 ${_r%2===0?"bg-white":"bg-gray-50"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1+_r*.05,ease:"easeOut"},whileHover:{scale:1.01,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.99},children:[o.jsx(Qe.td,{className:"border-b border-gray-100 px-4 py-4 text-center font-semibold text-gray-900",whileHover:{scale:1.05},transition:{duration:.2},children:it.student_id}),ce?o.jsx("td",{className:"border-b border-gray-100 px-1 py-4 text-sm w-8 min-w-[32px] max-w-[32px]",children:o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-4 h-4 text-gray-400 cursor-pointer hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:Ut=>{Ut.preventDefault(),Ut.stopPropagation(),ye(!1)},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})}):o.jsxs(o.Fragment,{children:[o.jsx(Qe.td,{className:"border-b border-gray-100 px-4 py-4 text-gray-900",whileHover:{scale:1.02},transition:{duration:.2},children:it.name}),o.jsx(Qe.td,{className:"border-b border-gray-100 px-4 py-4 text-gray-900",whileHover:{scale:1.02},transition:{duration:.2},children:it.surname})]}),o.jsx(Qe.td,{className:"border-b border-gray-100 px-4 py-4 text-center text-gray-900",whileHover:{scale:1.02},transition:{duration:.2},children:it.number??_r+1}),o.jsx(Qe.td,{className:"border-b border-gray-100 px-4 py-4 text-gray-600",whileHover:{scale:1.02},transition:{duration:.2},children:it.nickname||"-"}),Mt.map((Ut,mr)=>{const Mr=_e.has(Ut.test_name),lt=it[Ut.test_name];return Mr?(console.log("📥 Rendering collapsed column for test:",Ut.test_name),o.jsx("td",{className:"border-b border-gray-100 px-1 py-4 text-sm w-8 min-w-[32px] max-w-[32px]",children:o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-4 h-4 text-gray-400 cursor-pointer hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:Tt=>{Tt.preventDefault(),Tt.stopPropagation(),console.log("🖱️ Clicked on collapsed arrow for:",Ut.test_name),Re(Ut.test_name)},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})},mr)):o.jsx(Qe.td,{className:"border-b border-gray-100 px-2 py-4 text-sm min-w-[100px]",initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},transition:{duration:.3},whileHover:{scale:1.02},onClick:Tt=>{if(console.debug("[TeacherResults] Main table TD clicked",{testResult:lt,student:it.student_id}),lt?.retest_offered){i("Retest is already offered","info");return}const Pt=l(lt);Pt!==null&&Pt<50&&(console.debug("[TeacherResults] Main table TD -> opening retest modal",{studentId:it.student_id,test:Ut}),n({failedStudentIds:[it.student_id],test_type:Ut.test_type,original_test_id:lt?.test_id||Ut.test_id,subject_id:lt?.subject_id||Ut.subject_id,grade:t,class:r}))},children:lt&&lt.test_type==="drawing"?o.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[o.jsx("button",{onClick:()=>Ot(lt),className:"text-blue-600 hover:text-blue-800 underline text-sm font-medium px-2 py-1 rounded hover:bg-blue-50",children:"View Drawing"}),(()=>{const Tt=`${Ut.test_name}|${it.student_id}`,Pt=ur===Tt,zn=Number.isFinite(lt?.score)?lt.score:0;if(!Pt){const pr=l(lt),mn=pr!==null&&pr<50,In=pr!==null&&pr>=50&&pr<70,ha=lt?.retest_offered===!0,nl=pr===null?"text-gray-600":mn?"text-red-600 font-semibold":In?"text-yellow-600":"text-green-600";return o.jsxs(Qe.div,{className:`px-2 py-1 rounded-full text-xs font-medium ${nl} ${mn?"cursor-pointer hover:opacity-90":""} ${ha?"bg-blue-50 text-blue-700 border border-blue-200":""}`,style:mn?{color:"#b91c1c"}:void 0,whileHover:{scale:mn?1.1:1.05},transition:{duration:.2},onClick:()=>{mn&&!ha?n({failedStudentIds:[it.student_id],test_type:Ut.test_type,original_test_id:lt?.test_id||Ut.test_id,subject_id:lt?.subject_id||Ut.subject_id,grade:t,class:r}):(oe(Tt),fe(String(zn)))},title:ha?"Retest offered":mn?"Offer retest":"Click to edit score",children:[(()=>{const Wc=lt.retest_best_score??lt.score,sl=lt.retest_best_max_score??lt.max_score;return o.jsxs(o.Fragment,{children:[o.jsx("span",{className:mn?"text-red-700":"",children:Wc}),"/",o.jsx("span",{children:sl})]})})(),lt.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})}return o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"number",min:"0",max:10,value:we,onChange:pr=>fe(pr.target.value),onBlur:async()=>{const pr=Math.max(0,Math.min(10,parseFloat(we||"0")));Se(!0);try{const mn={resultId:lt?.id,score:pr,maxScore:10},In=localStorage.getItem("auth_token")||localStorage.getItem("accessToken")||localStorage.getItem("token");if(!(await fetch(Sm.UPDATE_DRAWING_TEST_SCORE,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:In?`Bearer ${In}`:""},body:JSON.stringify(mn)})).ok)throw new Error("Failed to save")}catch{}finally{Se(!1),oe(null),Je(b)}},onKeyDown:async pr=>{pr.key==="Enter"?pr.currentTarget.blur():pr.key==="Escape"&&oe(null)},className:"w-16 px-2 py-1 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0",disabled:me}),o.jsx("span",{className:"text-xs text-gray-500",children:"/"}),o.jsx("input",{type:"number",value:10,className:"w-12 px-2 py-1 text-xs border border-gray-300 bg-gray-100 rounded",disabled:!0})]})})(),lt.caught_cheating&&lt.visibility_change_times&&o.jsxs("span",{className:"text-xs text-red-600",children:["(",lt.visibility_change_times,")"]})]}):lt&&(lt.test_type==="speaking"||Ut.test_type==="speaking")?o.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[(()=>{const Tt=lt?.answers;let Pt;if(typeof Tt=="string")if(/^https?:\/\//i.test(Tt))Pt=Tt;else try{Pt=JSON.parse(Tt)?.audio_url}catch{}else Tt&&typeof Tt=="object"&&(Pt=Tt.audio_url);return!Pt&&lt?.audio_url&&(Pt=lt.audio_url),o.jsx(o.Fragment,{children:o.jsx("button",{onClick:()=>vr({...lt,__studentId:it.student_id},"audio",Pt),className:"text-blue-600 hover:text-blue-800 underline text-sm font-medium px-2 py-1 rounded hover:bg-blue-50",children:"Results"})})})(),(()=>{const Tt=ke.current.has(Ut.test_name);return console.log(`🎯 Score cell for ${Ut.test_name}:`,{isEditing:Tt,editingColumns:Array.from(ke.current),test_name:Ut.test_name}),Tt})()?o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"number",min:"0",max:lt.max_score||100,value:We.current[Ut.test_name]?.[it.student_id]?.score||lt.score||"",onChange:Tt=>or(Ut.test_name,it.student_id,"score",Tt.target.value),className:"w-16 px-2 py-1 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Score"}),o.jsx("span",{className:"text-xs text-gray-500",children:"/"}),o.jsx("input",{type:"number",min:"1",value:We.current[Ut.test_name]?.[it.student_id]?.maxScore||lt.max_score||100,onChange:Tt=>or(Ut.test_name,it.student_id,"maxScore",Tt.target.value),className:"w-16 px-2 py-1 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Max"})]}):o.jsxs("div",{className:"px-2 py-1 rounded-full text-xs font-medium",onDoubleClick:()=>{console.log("🎯 Double-clicked on speaking test score:",Ut.test_name),console.log("🎯 Results state at double-click:",M),console.log("🎯 Test result:",lt),console.log("🎯 Student:",it),console.log("🎯 Test:",Ut),lt&&lt.id?(console.log("🎯 Starting column editing for speaking test:",Ut.test_name),Kr(Ut.test_name)):console.log("🎯 No test result ID found, cannot edit")},title:"Double-click to edit scores",children:[(()=>{const Tt=l(lt),Pt=Tt!==null&&Tt<50,zn=Tt!==null&&Tt>=50&&Tt<70,pr=lt.retest_offered,mn=Tt===null?"text-gray-600":Pt?"text-red-600 font-semibold":zn?"text-yellow-600":"text-green-600";return o.jsxs(Qe.div,{className:`px-2 py-1 rounded-full text-xs font-medium ${mn} ${Pt?"cursor-pointer hover:opacity-90":""} ${pr?"bg-blue-50 text-blue-700 border border-blue-200":""}`,style:Pt?{color:"#b91c1c"}:void 0,whileHover:{scale:Pt?1.1:1.05},transition:{duration:.2},onClick:()=>{Pt&&!pr&&(console.log("🎯 Offering retest for speaking test:",Ut.test_name),n({failedStudentIds:[it.student_id],test_type:Ut.test_type,original_test_id:lt?.test_id||Ut.test_id,subject_id:lt?.subject_id||Ut.subject_id,grade:t,class:r}))},title:pr?"Retest offered":Pt?"Offer retest":"",children:[(()=>{const In=lt.retest_best_score??lt.score,ha=lt.retest_best_max_score??lt.max_score;return o.jsxs(o.Fragment,{children:[o.jsx("span",{className:Pt?"text-red-700":"",children:In}),"/",o.jsx("span",{children:ha})]})})(),lt.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})})(),lt.caught_cheating&&lt.visibility_change_times&&o.jsxs("span",{className:"text-xs text-red-600",children:["(",lt.visibility_change_times,")"]})]})]}):lt&&lt.score!==null&&lt.score!==void 0?o.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[(()=>{const Tt=l(lt),Pt=Tt!==null&&Tt<50,zn=Tt!==null&&Tt>=50&&Tt<70,pr=Tt===null?"text-gray-600":Pt?"text-red-600 font-semibold":zn?"text-yellow-600":"text-green-600",mn=lt?.retest_offered===!0;return o.jsxs(Qe.div,{className:`px-2 py-1 rounded-full text-xs font-medium ${pr} ${Pt?"cursor-pointer hover:opacity-90":""} ${mn?"bg-blue-50 text-blue-700 border border-blue-200":""}`,style:Pt?{color:"#b91c1c"}:void 0,whileHover:{scale:Pt?1.1:1.05},transition:{duration:.2},onClick:In=>{if(In.preventDefault(),In.stopPropagation(),lt?.retest_offered){i("Retest is already offered","info");return}Pt&&n({failedStudentIds:[it.student_id],test_type:Ut.test_type,original_test_id:lt?.test_id||Ut.test_id,subject_id:lt?.subject_id||Ut.subject_id,grade:t,class:r})},title:mn?"Retest offered":Pt?"Offer retest":"",children:[(()=>{const In=lt.retest_best_score??lt.score,ha=lt.retest_best_max_score??lt.max_score;return o.jsxs(o.Fragment,{children:[o.jsx("span",{className:Pt?"text-red-700":"",children:In}),"/",o.jsx("span",{children:ha})]})})(),lt.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})})(),lt.caught_cheating&&lt.visibility_change_times&&o.jsxs("span",{className:"text-xs text-red-600",children:["(",lt.visibility_change_times,")"]})]}):o.jsx("span",{className:"text-gray-400",children:"-"})},mr)})]},_r))})})]})})]})}),[gt,_e,Re,ce]),Ee=C.useCallback((je,Ke,Mt)=>!Ke||Ke.length===0?o.jsx(Qe.div,{className:"text-center py-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:o.jsx("p",{className:"text-gray-500",children:"No students found for this subject"})}):o.jsx(Qe.div,{className:"w-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},children:o.jsx(Qe.div,{className:"overflow-x-auto -mx-4 px-4",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.1},children:o.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden min-w-max",children:o.jsxs("table",{className:"w-full border-collapse text-xs min-w-max",children:[o.jsx("thead",{children:o.jsxs(Qe.tr,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.2,delay:.2},children:[o.jsx("th",{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 w-16 text-center",children:"ID"}),o.jsx("th",{className:`border-b border-gray-200 px-2 py-3 text-left font-semibold text-gray-700 ${ce?"w-8 min-w-[32px] max-w-[32px] bg-gray-100 cursor-pointer select-none":"min-w-[160px] bg-blue-50 cursor-pointer select-none"}`,onClick:it=>{it.preventDefault(),it.stopPropagation(),ye(!ce)},title:"Toggle student name columns",children:ce?o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-3 h-3 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"truncate",title:"Student Name",children:"Student Name"}),o.jsx("svg",{className:"w-3 h-3 ml-1 flex-shrink-0 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),o.jsx("th",{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 w-12 text-center",children:"No."}),o.jsx("th",{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 min-w-[80px]",children:"Nickname"}),Mt.map((it,_r)=>{const Ut=it.test_type==="drawing",mr=ke.current.has(it.test_name);return o.jsx(Qe.th,{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 min-w-[100px]",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.2,delay:.3+_r*.05},children:o.jsxs("div",{className:"flex flex-col space-y-1",children:[Ut&&o.jsx("div",{className:"flex justify-center",children:mr?o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:Mr=>{Mr.preventDefault(),Mr.stopPropagation(),xe(it.test_name)},disabled:Ur,className:"px-1 py-0.5 bg-green-600 text-white text-xs rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Ur?"Saving...":"Save"}),o.jsx("button",{onClick:Mr=>{Mr.preventDefault(),Mr.stopPropagation(),$r(it.test_name)},disabled:Ur,className:"px-1 py-0.5 bg-gray-500 text-white text-xs rounded hover:bg-gray-600 disabled:opacity-50",children:"Cancel"})]}):o.jsx("button",{onClick:Mr=>{Mr.preventDefault(),Mr.stopPropagation(),Kr(it.test_name)},className:"px-1 py-0.5 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Edit"})}),o.jsx("span",{className:"text-xs",children:it.test_name.length>10?it.test_name.substring(0,10)+"...":it.test_name})]})},_r)})]})}),o.jsx("tbody",{children:o.jsx(ji,{children:Ke.map((it,_r)=>o.jsxs(Qe.tr,{className:`border-b border-gray-100 hover:bg-blue-50 transition-colors duration-200 ${_r%2===0?"bg-white":"bg-gray-50"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.2,delay:.1+_r*.03,ease:"easeOut"},whileHover:{scale:1.005,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.995},children:[o.jsx(Qe.td,{className:"border-b border-gray-100 px-3 py-3 text-center font-semibold text-gray-900",whileHover:{scale:1.03},transition:{duration:.15},children:it.student_id}),ce?o.jsx("td",{className:"border-b border-gray-100 px-1 py-3 text-xs w-8 min-w-[32px] max-w-[32px]",children:o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-3 h-3 text-gray-400 cursor-pointer hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:Ut=>{Ut.preventDefault(),Ut.stopPropagation(),ye(!1)},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})}):o.jsxs(o.Fragment,{children:[o.jsx(Qe.td,{className:"border-b border-gray-100 px-3 py-3 text-gray-900 truncate",whileHover:{scale:1.01},transition:{duration:.15},children:it.name}),o.jsx(Qe.td,{className:"border-b border-gray-100 px-3 py-3 text-gray-900 truncate",whileHover:{scale:1.01},transition:{duration:.15},children:it.surname})]}),o.jsx(Qe.td,{className:"border-b border-gray-100 px-3 py-3 text-center text-gray-900 truncate",whileHover:{scale:1.01},transition:{duration:.15},children:it.number??_r+1}),o.jsx(Qe.td,{className:"border-b border-gray-100 px-3 py-3 text-gray-600 whitespace-normal break-words",whileHover:{scale:1.01},transition:{duration:.15},children:it.nickname||"-"}),Mt.map((Ut,mr)=>{const Mr=_e.has(Ut.test_name),lt=it[Ut.test_name];return Mr?o.jsx("td",{className:"border-b border-gray-100 px-1 py-3 text-sm w-8 min-w-[32px] max-w-[32px]",children:o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-4 h-4 text-gray-400 cursor-pointer hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:Tt=>{Tt.preventDefault(),Tt.stopPropagation(),Re(Ut.test_name)},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})},mr):o.jsx(Qe.td,{className:"border-b border-gray-100 px-3 py-3 text-sm",whileHover:{scale:1.01},transition:{duration:.15},onClick:Tt=>{console.debug("[TeacherResults] TD clicked",{testResult:lt,student:it.student_id});const Pt=l(lt);if(Pt!==null&&Pt<50){if(lt?.retest_offered){i("Retest is already offered","info");return}console.debug("[TeacherResults] TD -> opening retest modal",{studentId:it.student_id}),n({failedStudentIds:[it.student_id],grade:t,class:r})}},children:lt&&lt.score!==null&&lt.score!==void 0?o.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[lt.test_type==="drawing"?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>Ot(lt),className:"text-blue-600 hover:text-blue-800 underline text-xs font-medium px-1 py-0.5 rounded hover:bg-blue-50",children:"View"}),ke.current.has(Ut.test_name)?o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"number",min:"0",max:lt.max_score||100,value:We.current[Ut.test_name]?.[it.student_id]?.score||lt.score||"",onChange:Tt=>or(Ut.test_name,it.student_id,"score",Tt.target.value),className:"w-12 px-1 py-0.5 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Score"}),o.jsx("span",{className:"text-xs text-gray-500",children:"/"}),o.jsx("input",{type:"number",min:"1",value:We.current[Ut.test_name]?.[it.student_id]?.maxScore||lt.max_score||100,onChange:Tt=>or(Ut.test_name,it.student_id,"maxScore",Tt.target.value),className:"w-12 px-1 py-0.5 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Max"})]}):(()=>{const Tt=l(lt),Pt=Tt!==null&&Tt<50,zn=Tt!==null&&Tt>=50&&Tt<70,pr=lt.retest_offered,mn=Tt===null?"text-gray-600":Pt?"text-red-600 font-semibold":zn?"text-yellow-600":"text-green-600";return o.jsxs(Qe.div,{className:`px-1 py-0.5 rounded text-xs font-medium ${mn} ${Pt?"cursor-pointer hover:opacity-90":""} ${pr?"bg-blue-50 text-blue-700 border border-blue-200":""}`,style:Pt?{color:"#b91c1c"}:void 0,whileHover:{scale:Pt?1.05:1},transition:{duration:.15},onDoubleClick:()=>Kr(Ut.test_name),onClick:Pt?In=>{if(In.preventDefault(),In.stopPropagation(),lt?.retest_offered){i("Retest is already offered","info");return}n({failedStudentIds:[it.student_id],test_type:Ut.test_type,original_test_id:lt?.test_id||Ut.test_id,subject_id:lt?.subject_id||Ut.subject_id,grade:t,class:r})}:void 0,title:pr?"Retest offered":Pt?"Offer retest":"Double-click to edit column",children:[o.jsx("span",{className:Pt?"text-red-700":"",children:lt.score}),"/",o.jsx("span",{children:lt.max_score}),lt.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})})()]}):lt.test_type==="speaking"||Ut.test_type==="speaking"?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>vr({...lt,__studentId:it.student_id},"audio"),className:"text-blue-600 hover:text-blue-800 underline text-xs font-medium px-1 py-0.5 rounded hover:bg-blue-50",children:"View Audio"}),be&&be.resultId===lt.result_id?o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"number",min:"0",max:lt.max_score||100,value:Ct,onChange:Tt=>Et(Tt.target.value),className:"w-12 px-1 py-0.5 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Score"}),o.jsx("button",{onClick:()=>Pr(),disabled:Be,className:"px-1 py-0.5 bg-green-600 text-white text-xs rounded hover:bg-green-700 disabled:opacity-50",children:Be?"Saving...":"Save"}),o.jsx("button",{onClick:()=>hn(),disabled:Be,className:"px-1 py-0.5 bg-gray-500 text-white text-xs rounded hover:bg-gray-600 disabled:opacity-50",children:"Cancel"})]}):(()=>{const Tt=l(lt),Pt=Tt!==null&&Tt<50,zn=Tt!==null&&Tt>=50&&Tt<70,pr=lt.retest_offered,mn=Tt===null?"text-gray-600":Pt?"text-red-600 font-semibold":zn?"text-yellow-600":"text-green-600";return o.jsxs(Qe.div,{className:`px-1 py-0.5 rounded text-xs font-medium ${mn} ${Pt?"cursor-pointer hover:opacity-90":""} ${pr?"bg-blue-50 text-blue-700 border border-blue-200":""}`,style:Pt?{color:"#b91c1c"}:void 0,whileHover:{scale:Pt?1.05:1},transition:{duration:.15},onDoubleClick:()=>{Ve({resultId:lt.result_id,score:lt.score}),Et(lt.score?.toString()||"")},onClick:Pt?In=>{if(In.preventDefault(),In.stopPropagation(),lt?.retest_offered){i("Retest is already offered","info");return}n({failedStudentIds:[it.student_id],test_type:Ut.test_type,original_test_id:lt?.test_id||Ut.test_id,subject_id:lt?.subject_id||Ut.subject_id,grade:t,class:r})}:void 0,title:pr?"Retest offered":Pt?"Offer retest":"Double-click to edit score",children:[o.jsx("span",{className:Pt?"text-red-700":"",children:lt.score||0}),"/",o.jsx("span",{children:lt.max_score||100}),lt.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})})()]}):(()=>{const Tt=l(lt),Pt=Tt!==null&&Tt<50,zn=Tt!==null&&Tt>=50&&Tt<70,pr=Tt!==null&&Tt>=70;console.debug("[TeacherResults] Render pill",{studentId:it.student_id,pct:Tt,isRed:Pt,isYellow:zn,isGreen:pr,score:lt.score,max:lt.max_score,percentageField:lt.percentage});const In=`px-1 py-0.5 rounded text-xs font-medium ${Tt===null?"text-gray-600":Pt?"text-red-600 font-semibold":zn?"text-yellow-600":"text-green-600"} ${Pt?"cursor-pointer hover:opacity-90 pointer-events-auto":""}`;return o.jsxs(Qe.div,{className:In,style:Pt?{color:"#b91c1c"}:void 0,whileHover:{scale:Pt?1.05:1},transition:{duration:.15},onClick:Pt?ha=>{ha.preventDefault(),ha.stopPropagation();const nl=window.getComputedStyle(ha.currentTarget).color;console.debug("[TeacherResults] Red pill clicked -> opening retest modal",{studentId:it.student_id,className:In,computedColor:nl}),n({failedStudentIds:[it.student_id],grade:t,class:r})}:void 0,title:Pt?"Offer retest":"",children:[o.jsx("span",{className:Pt?"text-red-700":"",children:lt.score}),"/",o.jsx("span",{children:lt.max_score}),lt.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})})(),lt.caught_cheating&&lt.visibility_change_times&&o.jsxs("span",{className:"text-xs text-red-600",children:["(",lt.visibility_change_times,")"]})]}):o.jsx("span",{className:"text-gray-400",children:"-"})},mr)})]},_r))})})]})})})}),[gt,_e,Re,ce]),tt=C.useCallback(()=>{if(!M)return null;console.log("🔍 renderResults - results:",M),console.log("🔍 renderResults - results.class:",M.class),console.log("🔍 renderResults - results.unique_tests:",M.unique_tests);const je=M.class&&Array.isArray(M.class)&&M.class.length>0;if(console.log("🔍 renderResults - hasStudentData:",je),!je)return console.log("🔍 renderResults - No student data, showing no students message"),o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No students found for this class and semester."})});const Ke=M.unique_tests||[];return console.log("🔍 renderResults - uniqueTests:",Ke),ft.current=M,o.jsxs("div",{className:"space-y-6",children:[o.jsxs(Qe.div,{className:"bg-gradient-to-r from-red-500 to-pink-500 rounded-lg p-6 text-white",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:[o.jsxs(Qe.h2,{className:"text-2xl font-bold mb-2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.1},children:["Test Results - Grade M",O,", Class ",O,"/",W,", Semester ",b]}),o.jsxs(Qe.p,{className:"text-cyan-100",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2},children:["Viewing results for ",M.subjects?.length||0," subject(s)"]}),o.jsxs(Qe.div,{className:"mt-4 flex gap-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},children:[o.jsx("button",{onClick:()=>{const Mt=M.unique_tests?.map(it=>it.test_name)||[];Pe(new Set(Mt))},className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-colors",children:"Collapse All Tests"}),o.jsx("button",{onClick:()=>Pe(new Set),className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-colors",children:"Expand All Tests"})]})]}),o.jsxs(Qe.div,{className:"bg-white rounded-lg shadow p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},children:[o.jsx(Qe.h3,{className:"text-lg font-semibold text-gray-900 mb-4",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.2},children:"Class Results"}),o.jsx("div",{className:"hidden md:block",children:ht("All Subjects",M.class,Ke)}),o.jsx("div",{className:"md:hidden",children:Ee("All Subjects",M.class,Ke)})]})]})},[M,ht,O,W,b]),St=C.useCallback(()=>{if(!M||!M.class||!M.unique_tests)return;const je=["Student ID","Name","Surname","No.","Nickname",...M.unique_tests.map(mr=>mr.test_name)],Ke=M.class.map((mr,Mr)=>{const lt=[];return lt.push(mr.student_id),lt.push(mr.name),lt.push(mr.surname),lt.push(mr.number??Mr+1),lt.push(mr.nickname||"-"),M.unique_tests.forEach(Tt=>{const Pt=mr[Tt.test_name];Pt&&Pt.score!==null&&Pt.score!==void 0?lt.push(`${Pt.score}/${Pt.max_score}`):lt.push("-")}),lt}),Mt=By.aoa_to_sheet([je,...Ke]),it=By.book_new(),_r=[{wch:10},{wch:15},{wch:15},{wch:6},{wch:12},...M.unique_tests.map(()=>({wch:15}))];Mt["!cols"]=_r,By.book_append_sheet(it,Mt,"Class Results");const Ut=`class-results-${O}-${W}-semester-${b}.xlsx`;Hte(it,Ut),i("Excel file exported successfully!","success")},[M,O,W,b,i]);return f?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Teacher Results..."})]})}):g?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Results Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:g}),o.jsx(rt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsx("div",{className:"flex justify-between items-center py-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Results"}),o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",ae?ae.toLocaleString():"Never"]})]})})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Class"}),P.length>0?(()=>{const je=P.reduce((Ke,Mt)=>{const it=Mt.subject||"Unknown Subject";return Ke[it]||(Ke[it]=[]),Ke[it].push(Mt),Ke},{});return o.jsx("div",{className:"space-y-6",children:Object.entries(je).map(([Ke,Mt])=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-3 flex flex-col sm:flex-row sm:items-center items-center",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),Ke]}),o.jsxs("span",{className:"ml-0 sm:ml-2 text-sm text-gray-500 mt-1 sm:mt-0",children:["(",Mt.length," classes)"]})]}),o.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:Mt.map((it,_r)=>o.jsxs(rt,{variant:O===it.grade&&W===it.class?"primary":"outline",onClick:()=>Ge(it.grade,it.class),className:"px-3 py-1 text-xs font-medium min-w-[60px]",children:[it.grade,"/",it.class]},`${it.grade}-${it.class}-${_r}`))})]},Ke))})})():o.jsx("p",{className:"text-gray-500",children:"No classes available"})]}),W&&yt(),W&&M&&o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[O," ",W," - Test Results ",Fe?`(Term ${Oe?.terms.find(je=>je.id===Fe)?.term})`:""]}),o.jsx("div",{className:"flex space-x-3",children:o.jsxs("button",{type:"button",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md hover:shadow-lg transition-all duration-200 flex items-center space-x-2",onClick:St,children:[o.jsx("img",{src:"/pics/excel.png",alt:"Excel",className:"w-4 h-4 object-contain"}),o.jsx("span",{className:"font-medium text-sm",children:"Export Excel"})]})})]}),tt()]}),W&&!M&&o.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:o.jsx("div",{className:"flex items-center justify-center py-8",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-gray-200 border-t-blue-500"}),o.jsx("span",{className:"text-gray-600",children:"Loading results…"})]})})})]})}),jt&&Xe&&o.jsx(pE,{children:o.jsx(e8,{drawing:jt,isOpen:Xe,onClose:()=>Ye(!1),isTeacherView:!0,onSaveScore:async({resultId:je,score:Ke,maxScore:Mt})=>{try{const it=localStorage.getItem("auth_token")||localStorage.getItem("accessToken")||localStorage.getItem("token");if(!(await fetch(Sm.UPDATE_DRAWING_TEST_SCORE,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:it?`Bearer ${it}`:""},body:JSON.stringify({resultId:je,score:Ke,maxScore:Mt})})).ok)throw new Error("Failed to save");await Je(b)}catch{i("Failed to save drawing score","error")}}})}),pt&&_t&&o.jsx(pE,{children:o.jsx(Zz,{result:pt,isOpen:_t,onClose:()=>Ht(!1),initialTab:pt.__initialTab||"overview",editingSpeakingScore:be,tempSpeakingScore:Ct,isSavingSpeakingScore:Be,onStartSpeakingScoreEdit:kr,onSaveSpeakingScore:Pr,onCancelSpeakingScoreEdit:hn,onTempSpeakingScoreChange:Et})})]})},T3=({onBackToLogin:e})=>{const t=Ii(),{user:r,isAuthenticated:n,logout:s,getCurrentTeacherUsername:a}=Wn(),{teacherData:i,loadTeacherData:l}=tv(),{activeTests:c,loadActiveTests:d}=qp(),{showNotification:f,notifications:p}=da(),[g,y]=C.useState(!0),[v,w]=C.useState(""),[b,E]=C.useState("main"),[k,_]=C.useState([]),[T,j]=C.useState([]),[P,R]=C.useState(null),[N,A]=C.useState(null),[M,H]=C.useState(null),[Q,Z]=C.useState(!1),[ae,te]=C.useState(!1),[se,L]=C.useState(null),[G,I]=C.useState(!1),[z,V]=C.useState(null),[O,W]=C.useState(!1),[q,Y]=C.useState(null),[ee,X]=C.useState(null),[ne,ge]=C.useState([]),[_e,Pe]=C.useState(!1),[ce,ye]=C.useState(null),[Fe,Me]=C.useState({}),[Oe,He]=C.useState(!1),[It,Ze]=C.useState(!1),[Le,De]=C.useState(0),[et,bt]=C.useState(!1),[ut,jt]=C.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[Rt,Xe]=C.useState([]),[Ye,pt]=C.useState([]),[mt,_t]=C.useState(!1),[Ht,Qt]=C.useState(!1),[nr,Nr]=C.useState(null),[fr,hr]=C.useState([]),[sr,Er]=C.useState(!1),[he,le]=C.useState("subject");C.useEffect(()=>{dt()},[]),C.useEffect(()=>{const Ee=tt=>{Oe&&!tt.target.closest(".relative")&&He(!1),It&&!tt.target.closest(".relative")&&Ze(!1)};return document.addEventListener("mousedown",Ee),()=>{document.removeEventListener("mousedown",Ee)}},[Oe,It]);const pe=C.useCallback(()=>{console.log("🔧 showChangePasswordTab called"),bt(!0),He(!1),Ze(!1)},[]),be=C.useCallback(()=>{console.log("🔧 hideChangePasswordTab called"),bt(!1),jt({currentPassword:"",newPassword:"",confirmPassword:""})},[]),Ve=C.useCallback(async()=>{if(!r)return;const{currentPassword:Ee,newPassword:tt,confirmPassword:St}=ut;if(!Ee||!tt||!St){f("Please fill in all fields","error");return}if(tt!==St){f("New passwords do not match","error");return}if(tt.length<6){f("New password must be at least 6 characters long","error");return}const je=/[a-zA-Z]/.test(tt),Ke=/[0-9]/.test(tt);if(!je||!Ke){f("New password must contain both letters and numbers","error");return}try{const Mt=await Vn.changePassword({username:r.username,currentPassword:Ee,newPassword:tt});Mt.success?(f("Password changed successfully!","success"),be()):f(Mt.message||"Failed to change password","error")}catch(Mt){console.error("Password change error:",Mt),f("Failed to change password. Please try again.","error")}},[r,ut,f]),Ct=C.useCallback(Ee=>{const{name:tt,value:St}=Ee.target;jt(je=>({...je,[tt]:St}))},[]),Et=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher data...");try{const Ee=await Vn.getTeacherData();return console.log("👨‍🏫 Teacher data loaded:",Ee),X(new Date),Ee}catch(Ee){throw console.error("👨‍🏫 Error loading teacher data:",Ee),Ee}},[]),Be=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher subjects...");try{const Ee=`teacher_subjects_${r?.teacher_id||r?.id||""}`,tt=Jn(Ee);if(tt)return console.log("👨‍🏫 Using cached teacher subjects"),_(tt),tt;const St=await Vn.getTeacherData();console.log("👨‍🏫 Raw teacher data:",St);const je=Vn.getTeacherSubjects(St.subjects);return console.log("👨‍🏫 Teacher subjects loaded:",je),_(je),Qn(Ee,je,hs.teacher_subjects),console.log("📊 Available classes for performance chart:",je[0]?.classes||[]),console.log("📊 Performance chart will load when user clicks on a class"),je}catch(Ee){throw console.error("👨‍🏫 Error loading teacher subjects:",Ee),Ee}},[r?.teacher_id,r?.id]),at=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher active tests...");try{const Ee=`teacher_tests_${r?.teacher_id||r?.id||""}`,tt=Jn(Ee);tt&&tt.some(Ke=>Ke.test_type==="drawing")&&(console.log("🎨 Drawing test detected - forcing cache refresh"),localStorage.removeItem(Ee));const St=Jn(Ee);if(St)return console.log("👨‍🏫 Using cached teacher tests"),j(St),St;const je=await ln.getTeacherTests();return console.log("👨‍🏫 Teacher tests loaded:",je),j(je),Qn(Ee,je,hs.teacher_tests),je}catch(Ee){throw console.error("👨‍🏫 Error loading teacher tests:",Ee),Ee}},[r?.teacher_id,r?.id]),dt=C.useCallback(async()=>{console.log("👨‍🏫 Initializing Teacher Cabinet...");try{if(y(!0),w(""),!n||!r){console.log("👨‍🏫 User not authenticated"),w("User not authenticated");return}if(r.role!==fi.TEACHER){console.error("👨‍🏫 Invalid user role for teacher cabinet:",r.role),w("Access denied. Teacher role required.");return}console.log("👨‍🏫 Loading teacher data..."),await Et(),console.log("👨‍🏫 Loading teacher subjects..."),await Be(),console.log("👨‍🏫 Loading active tests..."),await at(),console.log("👨‍🏫 Teacher Cabinet initialization complete!")}catch(Ee){console.error("👨‍🏫 Error initializing teacher cabinet:",Ee),w("Failed to initialize teacher cabinet")}finally{y(!1)}},[n,r,Et,Be,at]),zt=C.useCallback(()=>{console.log("👨‍🏫 Showing subject selection prompt..."),Z(!0),Yt(),le("subject")},[]),Yt=C.useCallback(async()=>{console.log("👨‍🏫 Loading available subjects..."),_t(!0);try{const Ee=await Vn.getSubjectsForSelection();Xe(Ee),console.log("👨‍🏫 Available subjects loaded:",Ee)}catch(Ee){console.error("👨‍🏫 Error loading available subjects:",Ee),f("Failed to load subjects","error")}finally{_t(!1)}},[]),wr=C.useCallback(Ee=>{if(!Ee){Nr(null);return}const tt=Rt.find(St=>St.subject_id==Ee);tt&&(Nr(tt),hr([]),le("classes"))},[Rt]),Ur=C.useCallback((Ee,tt)=>{hr(St=>St.some(je=>je.grade===Ee&&je.class===tt)?St.filter(je=>!(je.grade===Ee&&je.class===tt)):[...St,{grade:Ee,class:tt}])},[]),yr=C.useCallback(()=>{if(!nr||fr.length===0){f("Please select at least one class","warning");return}const Ee={subject_id:parseInt(nr.subject_id),subject_name:nr.subject,classes:fr};pt(tt=>[...tt,Ee]),Nr(null),hr([]),le("subject"),f(`Added ${nr.subject} with ${fr.length} classes`,"success")},[nr,fr]),ur=C.useCallback(Ee=>{pt(tt=>tt.filter((St,je)=>je!==Ee))},[]),oe=C.useCallback(async(Ee,tt,St)=>{console.log("👨‍🏫 Deleting teacher subject:",{subjectId:Ee,grade:tt,classNumber:St});try{const je={subjectId:Ee,grade:tt,class:St};console.log("👨‍🏫 Sending delete request with data:",je);const Ke=await Vn.deleteTeacherSubject(je);if(Ke.success)f("Subject assignment deleted successfully!","success"),await Be();else throw new Error(Ke.error||"Failed to delete subject assignment")}catch(je){console.error("👨‍🏫 Error deleting subject assignment:",je),f("Error deleting subject assignment. Please try again.","error")}},[Be,f]),we=C.useCallback((Ee,tt,St,je)=>{Y({subjectId:Ee,subjectName:tt,grade:St,classNumber:je}),W(!0)},[]),fe=C.useCallback(async()=>{q&&(await oe(q.subjectId,q.grade,q.classNumber),W(!1),Y(null))},[q,oe]),me=C.useCallback(()=>{W(!1),Y(null)},[]),Se=C.useCallback(async()=>{if(Ye.length===0){f("Please select at least one subject","warning");return}Qt(!0);try{const Ee=await Vn.saveTeacherSubjects(Ye);if(Ee.success)f("Subjects saved successfully!","success"),Z(!1),pt([]),le("subject"),await Be();else throw new Error(Ee.error||"Failed to save subjects")}catch(Ee){console.error("👨‍🏫 Error saving teacher subjects:",Ee),f("Failed to save subjects","error")}finally{Qt(!1)}},[Ye,Be]);C.useCallback(async Ee=>{console.log("👨‍🏫 Saving teacher subjects:",Ee);try{const tt=await Vn.saveTeacherSubjects(Ee);if(tt.success)f("Subjects saved successfully!","success"),await Be(),Z(!1);else throw new Error(tt.error||"Failed to save subjects")}catch(tt){console.error("👨‍🏫 Error saving teacher subjects:",tt),f("Failed to save subjects","error")}},[Be]);const ke=C.useCallback(()=>{console.log("👨‍🏫 Showing active tests..."),E("tests")},[]),We=C.useCallback(Ee=>{console.log("👨‍🏫 Showing test details:",Ee),L(Ee),te(!0)},[]);C.useCallback(async(Ee,tt,St)=>{console.log("👨‍🏫 Removing class assignment:",Ee,tt,St);try{const je=await ln.removeClassAssignment(Ee,tt,St);if(je.success)f("Assignment removed successfully!","success"),await at();else throw new Error(je.error||"Failed to remove assignment")}catch(je){console.error("👨‍🏫 Error removing class assignment:",je),f("Failed to remove assignment","error")}},[at]);const ft=C.useCallback(async(Ee,tt)=>{console.log("👨‍🏫 Marking test as completed:",Ee,tt);try{const St=await ln.markTestCompleted(Ee,tt);if(St.success){f("Test marked as completed!","success");const je=`teacher_tests_${r?.teacher_id||r?.id||""}`;localStorage.removeItem(je),console.log("👨‍🏫 Cleared teacher tests cache"),await at()}else throw new Error(St.error||"Failed to mark test as completed")}catch(St){console.error("👨‍🏫 Error marking test as completed:",St),f("Failed to mark test as completed","error")}},[at,f,r?.teacher_id,r?.id]),Re=C.useCallback(async()=>{console.log("👨‍🏫 Refreshing active tests data...");try{await at(),f("Tests refreshed successfully!","success")}catch(Ee){console.error("👨‍🏫 Error refreshing tests:",Ee),f("Failed to refresh tests","error")}},[at]),[ie,de]=C.useState(!1),Ce=C.useCallback(async Ee=>{console.log("📊 Loading performance data for class:",Ee),console.log("📊 Current selectedClassForChart:",ce);try{de(!0);const[tt,St]=Ee.split("/"),je=tt.startsWith("M")?tt:`M${tt}`;await Ic.loadAcademicCalendar();const Ke=Ic.getCurrentTerm(),Mt=Ke?.id;if(!Mt)throw new Error("No current academic period found");const it=`class_summary_${r.teacher_id}_${je}_${St}_${Mt}`,_r=Jn(it);if((_r?Date.now()-_r.timestamp:1/0)>36e5)try{await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/refresh-class-summary-semester")}catch(Tt){console.warn("Materialized view refresh failed (continuing):",Tt.message)}const Mr=await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-class-summary-term?teacher_id=${r.teacher_id}&grade=${je}&class=${St}&term_id=${Mt}`);console.log("📊 API response status:",Mr.status);const lt=await Mr.json();if(console.log("📊 Performance API response:",lt),console.log("📊 API success:",lt.success),console.log("📊 API summary:",lt.summary),lt.success&&lt.summary){console.log("📊 Processing semester performance data:",lt.summary);const Tt=lt.summary;console.log("📊 Semester summary:",{total_students:Tt.total_students,total_tests:Tt.total_tests,completed_tests:Tt.completed_tests,average_class_score:Tt.average_class_score,pass_rate:Tt.pass_rate,cheating_incidents:Tt.cheating_incidents});const Pt={summary:Tt,term:Ke.term,semester:Ke.semester,academicYear:Ke.academic_year,termId:Mt,overallAverage:Tt.average_class_score||0,totalTests:Tt.total_tests||0,completedTests:Tt.completed_tests||0,passRate:Tt.pass_rate||0,cheatingIncidents:Tt.cheating_incidents||0,lastTestDate:Tt.last_test_date,termProgress:Ne(Tt,Ke)};console.log("📊 Term performance data:",Pt),Me(zn=>({...zn,[Ee]:Pt}))}else console.log("📊 No performance data available for class:",Ee),Me(Tt=>({...Tt,[Ee]:{tests:[],overallAverage:0}}))}catch(tt){console.error("📊 Error loading performance data:",tt),console.error("📊 Error details:",tt.message),Me(St=>({...St,[Ee]:{tests:[],overallAverage:0}}))}finally{de(!1)}},[r]),Ne=C.useCallback((Ee,tt)=>{if(!Ee.last_test_date||!tt)return 0;const St=new Date(tt.start_date),je=new Date(tt.end_date),Ke=new Date,Mt=je-St,it=Math.min(Ke-St,Mt);return Math.round(it/Mt*100)},[]);C.useCallback((Ee,tt)=>{console.log("👨‍🏫 Showing class results:",Ee,tt),console.log("👨‍🏫 Class click - grade:",Ee,"className:",tt),A(Ee),H(tt),E("results");const St=`${Ee}/${tt}`;console.log("📊 Loading performance data for clicked class:",St),ye(St),Ce(St)},[Ce]);const[Ge,Je]=C.useState([]),[yt,Vt]=C.useState([]),gt=C.useCallback(async()=>{try{const tt=await(await hi(()=>import("./retestService-C6b0YDiD.js"),[])).retestService.getRetestAssignments(r.teacher_id);Je(tt)}catch(Ee){console.warn("Failed to load retests",Ee)}},[r]);C.useCallback(async Ee=>{try{const St=await(await hi(()=>import("./retestService-C6b0YDiD.js"),[])).retestService.getRetestTargets(Ee);Vt(St)}catch(tt){console.warn("Failed to load retest targets",tt)}},[]);const[Ot,vr]=C.useState(!1);C.useEffect(()=>{console.debug("[TeacherCabinet] showRetestModal state changed:",Ot)},[Ot]);const[kr,Pr]=C.useState({test_type:"",original_test_id:"",subject_id:"",passing_threshold:50,scoring_policy:"BEST",max_attempts:1,window_days:2,student_ids:[]}),hn=C.useCallback(async Ee=>{console.debug("[TeacherCabinet] openRetestModal called with:",Ee);const{test_type:tt,original_test_id:St,subject_id:je,failedStudentIds:Ke=[],grade:Mt,class:it}=Ee||{};Pr({test_type:tt||"multiple_choice",original_test_id:St||"",subject_id:je||"",passing_threshold:50,scoring_policy:"BEST",max_attempts:1,window_days:2,student_ids:Ke}),Mt!==void 0&&A(Mt),it!==void 0&&H(it),console.debug("[TeacherCabinet] Setting showRetestModal to true"),vr(!0)},[]),Kr=C.useCallback(async()=>{try{const Ee=await hi(()=>import("./retestService-C6b0YDiD.js"),[]),tt=new Date,St=new Date(tt.getTime()+kr.window_days*24*60*60*1e3),je={...kr,grade:N,class:M,window_start:tt.toISOString(),window_end:St.toISOString()};console.debug("[Retest][TeacherCabinet] Prepared payload:",JSON.stringify(je)),console.debug("[Retest][TeacherCabinet] Selected students count:",(je.student_ids||[]).length,"IDs:",je.student_ids),await Ee.retestService.createRetestAssignment(je),f("Retest created","success"),vr(!1),gt(),De(Ke=>Ke+1)}catch(Ee){console.error("Create retest error",Ee),f(Ee.message||"Failed to create retest","error")}},[kr,N,M,gt]),$r=C.useCallback(Ee=>{if(!Ee)return o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"📊"}),o.jsx("p",{className:"text-gray-500",children:"Click on a class to view performance data"})]});const St=(Fe[Ee]||{}).summary;return St?o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[o.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[St.average_class_score?.toFixed(1)||0,"%"]}),o.jsx("div",{className:"text-sm text-blue-600",children:"Class Average"})]}),o.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-3xl font-bold text-green-600",children:St.total_tests||0}),o.jsx("div",{className:"text-sm text-green-600",children:"Total Tests"})]}),o.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[o.jsxs("div",{className:"text-3xl font-bold text-purple-600",children:[St.pass_rate?.toFixed(1)||0,"%"]}),o.jsx("div",{className:"text-sm text-purple-600",children:"Pass Rate"})]}),o.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-3xl font-bold text-red-600",children:St.cheating_incidents||0}),o.jsx("div",{className:"text-sm text-red-600",children:"Cheating Incidents"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[o.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:St.completed_tests||0}),o.jsx("div",{className:"text-sm text-yellow-600",children:"Completed Tests"})]}),o.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:St.highest_score||0}),o.jsx("div",{className:"text-sm text-indigo-600",children:"Highest Score"})]}),o.jsxs("div",{className:"bg-pink-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold text-pink-600",children:St.total_students||0}),o.jsx("div",{className:"text-sm text-pink-600",children:"Total Students"})]})]}),ie&&o.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-xs text-center",children:[o.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-gray-300 border-t-transparent rounded-full mx-auto mb-2"}),o.jsx("div",{className:"text-sm text-gray-700",children:"Loading latest class summary..."})]})})]}):o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"📊"}),o.jsx("p",{className:"text-gray-500",children:"No performance data available for this class"})]})},[Fe]);if(g)return o.jsxs("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:[o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Teacher Cabinet..."})]}),o.jsx("div",{className:"flex flex-wrap gap-2"})]});if(v)return o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Cabinet Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:v}),o.jsx(rt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})});return o.jsxs(Qe.div,{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[o.jsx(Qe.div,{className:"bg-gradient-to-r from-sky-400 to-sky-600 text-white shadow-lg",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-6",children:[o.jsxs(Qe.div,{className:"flex-1 text-center",initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-white mb-2",children:"Teacher Cabinet"}),o.jsxs("p",{className:"text-sky-100 text-sm sm:text-base md:text-lg",children:["Welcome, Teacher ",a()||""]})]}),o.jsxs(Qe.div,{className:"relative",initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3,duration:.5},children:[o.jsx("div",{className:"hidden md:block",children:o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>He(!Oe),className:"flex items-center space-x-1 sm:space-x-2 bg-white/10 border border-white/20 text-white hover:bg-white/20 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-white/50",children:[o.jsx("span",{className:"hidden sm:inline text-xs sm:text-sm font-medium",children:"Menu"}),o.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 transition-transform duration-200",style:{transform:Oe?"rotate(180deg)":"rotate(0deg)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]}),Oe&&o.jsxs(Qe.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[o.jsxs("button",{onClick:()=>{He(!1),pe()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})}),o.jsx("span",{children:"Change Password"})]}),o.jsxs("button",{onClick:()=>{He(!1),e?e():s()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),o.jsx("span",{children:"Logout"})]})]})]})}),o.jsxs("div",{className:"md:hidden",children:[o.jsx("button",{onClick:()=>Ze(!It),className:"flex items-center justify-center w-10 h-10 bg-white/10 border border-white/20 text-white hover:bg-white/20 rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-white/50",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),It&&o.jsxs(Qe.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[o.jsxs("div",{className:"px-4 py-2 border-b border-gray-200",children:[o.jsx("p",{className:"text-sm font-medium text-gray-900",children:a()||"Teacher"}),o.jsx("p",{className:"text-xs text-gray-500",children:"Teacher Account"})]}),o.jsxs("button",{onClick:()=>{Ze(!1),pe()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})}),o.jsx("span",{children:"Change Password"})]}),o.jsxs("button",{onClick:()=>{Ze(!1),e?e():s()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),o.jsx("span",{children:"Logout"})]})]})]})]})]})})}),o.jsx(Qe.div,{className:"bg-white border-b shadow-sm",initial:{y:-10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.5},children:o.jsx("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8",children:o.jsx("nav",{className:"flex space-x-1 sm:space-x-8 overflow-x-auto",children:[{key:"main",label:"Main Dashboard",shortLabel:"Dashboard"},{key:"tests",label:"Test Management",shortLabel:"Tests"},{key:"results",label:"Class Results",shortLabel:"Results"},{key:"subjects",label:"Subject Management",shortLabel:"Subjects"}].map((Ee,tt)=>o.jsxs(Qe.button,{onClick:()=>Ee.key==="tests"?ke():E(Ee.key),className:`py-2 sm:py-4 px-2 sm:px-1 border-b-2 font-medium text-xs sm:text-sm transition-colors duration-200 whitespace-nowrap flex-shrink-0 ${b===Ee.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,initial:{y:-10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5+tt*.1,duration:.3},whileHover:{scale:1.05},whileTap:{scale:.95},children:[o.jsx("span",{className:"sm:hidden",children:Ee.shortLabel}),o.jsx("span",{className:"hidden sm:inline",children:Ee.label})]},Ee.key))})})}),o.jsx(Qe.div,{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.5},children:o.jsxs(ji,{mode:"wait",children:[b==="main"&&o.jsx(Qe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:or()},"main"),b==="subjects"&&o.jsx(Qe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:xe()},"subjects"),b==="tests"&&o.jsx(Qe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:ht()},"tests"),b==="results"&&o.jsx(Qe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:o.jsx(fP,{selectedGrade:N,selectedClass:M,onBackToCabinet:()=>E("main"),openRetestModal:hn},Le)},"results")]})}),Q&&o.jsx(Ko,{isOpen:Q,onClose:()=>{Z(!1),le("subject"),pt([]),Nr(null),hr([])},title:"Select Subjects and Classes",size:"large",children:o.jsxs("div",{className:"space-y-6 px-4 max-h-[80vh] overflow-y-auto",children:[he==="subject"&&o.jsxs(Qe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Step 1: Select Subject"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Choose the subject you want to teach:"}),mt?o.jsxs("div",{className:"flex items-center justify-center py-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),o.jsx("span",{className:"ml-2 text-gray-600",children:"Loading subjects..."})]}):o.jsxs("select",{value:nr?.subject_id||"",onChange:Ee=>wr(Ee.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[o.jsx("option",{value:"",children:"Select a subject"}),Rt.map(Ee=>o.jsx("option",{value:Ee.subject_id,children:Ee.subject},Ee.subject_id))]})]}),o.jsxs("div",{className:"flex justify-end space-x-3",children:[o.jsx(rt,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),o.jsx(rt,{variant:"primary",onClick:()=>le("classes"),disabled:!nr,children:"Next: Select Classes"})]})]}),he==="classes"&&nr&&o.jsxs(Qe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["Step 2: Select Classes for ",nr.subject]}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Choose the classes you teach for this subject:"}),o.jsx("div",{className:"max-h-80 overflow-y-auto border border-gray-200 rounded-lg p-4",children:o.jsx("div",{className:"grid grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(Ee=>{let tt;return Ee===1||Ee===2||Ee===3?tt=[15,16]:Ee===4||Ee===5||Ee===6?tt=[13,14]:tt=[],o.jsxs("div",{className:"space-y-2",children:[o.jsxs("h4",{className:"font-medium text-gray-700 text-sm",children:["Grade ",Ee]}),o.jsx("div",{className:"space-y-1",children:tt.map(St=>o.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[o.jsx("input",{type:"checkbox",checked:fr.some(je=>je.grade===Ee.toString()&&je.class===St.toString()),onChange:()=>Ur(Ee.toString(),St.toString()),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),o.jsxs("span",{className:"text-xs text-gray-700",children:["Class ",St]})]},St))})]},Ee)})})})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx(rt,{variant:"outline",onClick:()=>le("subject"),children:"Back to Subjects"}),o.jsxs("div",{className:"space-x-3",children:[o.jsx(rt,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),o.jsx(rt,{variant:"primary",onClick:yr,disabled:fr.length===0,children:"Add Subject"})]})]})]}),Ye.length>0&&o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Selected Subjects"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Review your selected subjects and classes:"}),o.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:Ye.map((Ee,tt)=>o.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-gray-900",children:Ee.subject_name}),o.jsxs("p",{className:"text-sm text-gray-600",children:["Classes: ",Ee.classes.map(St=>`Grade ${St.grade} Class ${St.class}`).join(", ")]})]}),o.jsx("button",{onClick:()=>ur(tt),className:"text-red-600 hover:text-red-800 p-1",children:o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},tt))})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx(rt,{variant:"outline",onClick:()=>le("subject"),children:"Add More Subjects"}),o.jsxs("div",{className:"space-x-3",children:[o.jsx(rt,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),o.jsx(rt,{variant:"primary",onClick:Se,disabled:Ht,className:"relative",children:Ht?o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save All Subjects"})]})]})]})]})}),Ot&&o.jsxs(Ko,{isOpen:Ot,onClose:()=>vr(!1),title:"Create Retest",size:"medium",children:[o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Retest Window"}),o.jsxs("select",{className:"w-full border rounded px-3 py-2 text-sm",value:kr.window_days,onChange:Ee=>Pr(tt=>({...tt,window_days:Number(Ee.target.value)})),children:[o.jsx("option",{value:1,children:"1 day"}),o.jsx("option",{value:2,children:"2 days"}),o.jsx("option",{value:3,children:"3 days"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Attempts"}),o.jsxs("select",{className:"w-full border rounded px-3 py-2 text-sm",value:kr.max_attempts,onChange:Ee=>Pr(tt=>({...tt,max_attempts:Number(Ee.target.value)})),children:[o.jsx("option",{value:1,children:"1 attempt"}),o.jsx("option",{value:2,children:"2 attempts"}),o.jsx("option",{value:3,children:"3 attempts"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Students can retry immediately if they fail"})]})]})}),o.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[o.jsx("button",{onClick:()=>vr(!1),className:"px-4 py-2 text-sm rounded border border-gray-300 hover:bg-gray-50",children:"Cancel"}),o.jsx("button",{onClick:Kr,className:"px-4 py-2 text-sm rounded bg-indigo-600 text-white hover:bg-indigo-700",children:"Create Retest"})]})]}),ae&&se&&o.jsxs(Ko,{isOpen:ae,onClose:()=>te(!1),title:"Test Details",size:"large",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Test Name:"}),o.jsx("p",{className:"text-sm text-gray-900",children:se.test_name})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Subject:"}),o.jsx("p",{className:"text-sm text-gray-900",children:se.subject})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Test Type:"}),o.jsx("p",{className:"text-sm text-gray-900",children:se.test_type})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Created:"}),o.jsx("p",{className:"text-sm text-gray-900",children:new Date(se.created_at).toLocaleDateString()})]}),se.assignments&&se.assignments.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Classes:"}),o.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:se.assignments.map((Ee,tt)=>o.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs font-medium",children:[Ee.grade,"/",Ee.class]},tt))})]})]}),o.jsx("div",{className:"flex justify-end space-x-3 mt-6",children:o.jsx(rt,{variant:"outline",onClick:()=>te(!1),children:"Close"})})]}),O&&q&&o.jsx(Ko,{isOpen:O,onClose:me,title:"Delete Subject Assignment",size:"small",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:o.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Delete Subject Assignment"}),o.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Are you sure you want to delete the assignment for"," ",o.jsx("span",{className:"font-semibold text-gray-900",children:q.subjectName})," ","in Grade ",q.grade,", Class ",q.classNumber,"?"]}),o.jsx("p",{className:"text-xs text-red-600",children:"This action cannot be undone."})]}),o.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[o.jsx(rt,{variant:"outline",onClick:me,children:"Cancel"}),o.jsx(rt,{variant:"danger",onClick:fe,children:"Delete Assignment"})]})]})}),o.jsx(Qe.div,{className:"fixed top-4 right-4 space-y-2 z-50",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.8,duration:.5},children:p.map(Ee=>o.jsx(Qe.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},transition:{duration:.3},children:o.jsx("div",{className:`p-4 rounded-lg shadow-lg ${Ee.type==="success"?"bg-green-600 text-white":Ee.type==="error"?"bg-red-600 text-white":Ee.type==="warning"?"bg-yellow-600 text-white":"bg-blue-600 text-white"}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:Ee.message}),o.jsx("button",{onClick:()=>setNotifications(tt=>tt.filter(St=>St.id!==Ee.id)),className:"ml-4 text-white hover:text-gray-200",children:"×"})]})})},Ee.id))}),et&&o.jsx(Ko,{isOpen:et,onClose:be,title:"Change Password",size:"small",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),o.jsx("input",{type:"password",name:"currentPassword",value:ut.currentPassword,onChange:Ct,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Enter current password"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),o.jsx("input",{type:"password",name:"newPassword",value:ut.newPassword,onChange:Ct,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Enter new password"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),o.jsx("input",{type:"password",name:"confirmPassword",value:ut.confirmPassword,onChange:Ct,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Confirm new password"})]}),o.jsxs("div",{className:"flex space-x-3 pt-4",children:[o.jsx(rt,{type:"button",variant:"secondary",onClick:be,className:"flex-1",children:"Cancel"}),o.jsx(rt,{type:"button",onClick:Ve,className:"flex-1",children:"Change Password"})]})]})})]});function or(){return o.jsxs("div",{className:"space-y-8",children:[o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{children:"My Subjects & Classes"})}),o.jsx(kt.Body,{children:k.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📚"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No subjects assigned"}),o.jsx("p",{className:"text-gray-500 mb-4",children:"You don't have any subjects assigned yet."}),o.jsx(rt,{variant:"outline",onClick:()=>E("subjects"),children:"Manage Subjects"})]}):o.jsx("div",{className:"space-y-6",children:k.map((Ee,tt)=>o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2+tt*.1,duration:.3},className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:Ee.name}),o.jsxs("span",{className:"text-sm text-gray-500",children:[Ee.classes?.length||0," classes"]})]}),Ee.classes&&Ee.classes.length>0?o.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:Ee.classes.map((St,je)=>o.jsx(Qe.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3+tt*.1+je*.05,duration:.2},whileHover:{scale:1.05},whileTap:{scale:.95},children:o.jsxs(rt,{variant:"outline",size:"sm",onClick:()=>{A(St.grade),H(St.class),E("results")},className:"font-medium",children:[St.grade,"/",St.class]})},je))}):o.jsx("div",{className:"text-center py-4 text-gray-500",children:o.jsx("span",{className:"text-sm",children:"No classes assigned to this subject"})})]},Ee.id))})})]})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},children:o.jsxs(kt,{children:[o.jsxs(kt.Header,{children:[o.jsx(kt.Title,{children:"Test Performance Overview"}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Average scores across all tests by class"})]}),o.jsx(kt.Body,{children:k.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"📊"}),o.jsx("p",{className:"text-gray-500",children:"No subjects assigned - no performance data available"})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"flex flex-wrap gap-2 border-b border-gray-200",children:(()=>{const Ee=[];return k.forEach(tt=>{tt.classes&&tt.classes.forEach(St=>{const je=`${St.grade}/${St.class}`;Ee.find(Ke=>Ke.key===je)||Ee.push({key:je,grade:St.grade,class:St.class,subject:tt.name})})}),Ee})().map((Ee,tt)=>o.jsxs("button",{onClick:()=>{console.log("🎯 Class button clicked:",Ee.key),ye(Ee.key),Ce(Ee.key)},className:`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${ce===Ee.key?"bg-blue-100 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[Ee.grade,"/",Ee.class]},Ee.key))}),o.jsx("div",{className:"mt-4",children:$r(ce)})]})})]})})]})}function xe(){return o.jsxs("div",{className:"space-y-8",children:[o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.5},children:o.jsx(kt,{children:o.jsx(kt.Header,{children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(kt.Title,{children:"Subject Management"}),o.jsx(rt,{variant:"primary",onClick:zt,children:"Add Subject"})]})})})}),k.length===0?o.jsx(Qe.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2,duration:.5},children:o.jsx(kt,{children:o.jsx(kt.Body,{children:o.jsxs("div",{className:"text-center p-12",children:[o.jsx(Qe.div,{className:"text-6xl mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.5,type:"spring"},children:"📚"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"No subjects assigned yet"}),o.jsx("p",{className:"text-gray-600 mb-6",children:"Add your first subject to get started with creating tests and managing classes."}),o.jsx(rt,{variant:"primary",onClick:zt,size:"lg",children:"Add Your First Subject"})]})})})}):o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{children:"Your Subjects"})}),o.jsx(kt.Body,{children:o.jsx("div",{className:"space-y-4",children:k.map((Ee,tt)=>o.jsx(Qe.div,{className:"p-4 bg-gray-50 rounded-lg border-l-4 border-green-500",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+tt*.1,duration:.3},whileHover:{scale:1.02,backgroundColor:"#f9fafb"},children:o.jsx("div",{className:"flex justify-between items-start",children:o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:Ee.name}),o.jsx("div",{className:"flex flex-wrap gap-2",children:Ee.classes?.map((St,je)=>o.jsxs(Qe.div,{className:"inline-flex items-center gap-2 bg-blue-100 text-blue-800 text-xs rounded-full px-3 py-1",initial:{scale:0},animate:{scale:1},transition:{delay:.4+tt*.1+je*.05,duration:.2},whileHover:{scale:1.1},children:[o.jsxs("span",{children:[St.grade," - ",St.className]}),o.jsx("button",{onClick:()=>we(Ee.id,Ee.name,St.grade,St.class),className:"ml-1 text-red-600 hover:text-red-800 transition-colors",title:"Delete this subject assignment",children:o.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},je))||o.jsx("span",{className:"text-gray-500 text-sm",children:"No classes assigned"})})]})})},tt))})})]})})]})}function ht(){return o.jsxs("div",{className:"space-y-8",children:[o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.5},children:o.jsx(kt,{children:o.jsx(kt.Header,{children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(kt.Title,{children:"Active Tests"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(rt,{variant:"outline",onClick:Re,children:"Refresh"}),o.jsx(rt,{variant:"primary",onClick:()=>t("/teacher/tests/create"),children:"Create New Test"})]})]})})})}),T.length===0?o.jsx(Qe.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2,duration:.5},children:o.jsx(kt,{children:o.jsx(kt.Body,{children:o.jsxs("div",{className:"text-center p-12",children:[o.jsx(Qe.div,{className:"text-6xl mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.5,type:"spring"},children:"📝"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"No active tests found"}),o.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first test to get started with assessments."}),o.jsx(rt,{variant:"primary",onClick:()=>t("/teacher/tests/create"),size:"lg",children:"Create Your First Test"})]})})})}):o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},className:"space-y-4",children:T.map((Ee,tt)=>o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3+tt*.1,duration:.3},whileHover:{scale:1.01},children:o.jsx(kt,{children:o.jsx(kt.Body,{children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex-1 flex items-center space-x-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 min-w-0 flex-shrink-0",children:Ee.test_name}),o.jsx("span",{className:"hidden sm:inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium flex-shrink-0",children:Ee.test_type}),o.jsxs("div",{className:"hidden sm:flex items-center space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-600 flex-shrink-0",children:[o.jsx("span",{className:"font-medium",children:"Assignments:"}),o.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium",children:Ee.assignments?.length||0})]}),Ee.assignments&&Ee.assignments.length>0&&o.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-600 flex-shrink-0",children:[o.jsx("span",{className:"font-medium",children:"Classes:"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:Ee.assignments.map((St,je)=>o.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs font-medium",children:[St.grade,"/",St.class]},je))})]}),o.jsx("div",{className:"text-sm text-gray-500 flex-shrink-0",children:new Date(Ee.created_at).toLocaleDateString()})]})]}),o.jsxs("div",{className:"flex gap-2 ml-4 flex-shrink-0",children:[o.jsx("div",{className:"sm:hidden",children:o.jsx(rt,{variant:"outline",onClick:()=>We(Ee),size:"sm",className:"text-xs",title:`Type: ${Ee.test_type} | Assignments: ${Ee.assignments?.length||0} | Classes: ${Ee.assignments?.map(St=>`${St.grade}/${St.class}`).join(", ")||"None"} | ${new Date(Ee.created_at).toLocaleDateString("en-US",{year:"2-digit",month:"numeric",day:"numeric"})}`,children:"Details"})}),o.jsx("div",{className:"hidden sm:block",children:o.jsx(rt,{variant:"outline",onClick:()=>We(Ee),size:"sm",children:"Details"})}),o.jsx(rt,{variant:"success",onClick:()=>ft(Ee.test_type,Ee.test_id),size:"sm",children:"Complete"})]})]})})})},tt))})]})}},tre={multipleChoice:"multiple_choice",trueFalse:"true_false",input:"input",matching:"matching_type",wordMatching:"word_matching",drawing:"drawing",fillBlanks:"fill_blanks",speaking:"speaking"},N3=()=>{const{user:e}=Wn();UW();const{notifications:t,showNotification:r,removeNotification:n}=da(),[s,a]=C.useState(!1),[i,l]=C.useState(!1),[c,d]=C.useState("typeSelection"),[f,p]=C.useState(!1),[g,y]=C.useState(null),[v,w]=C.useState([]),[b,E]=C.useState(!1),[k,_]=C.useState(!1),[T,j]=C.useState(!1),[P,R]=C.useState(!1),[N,A]=C.useState({testName:"",numQuestions:0,numOptions:0,questions:{},enableTimer:!1,timerMinutes:"",isShuffled:!1}),[M,H]=C.useState([]),[Q,Z]=C.useState(null);C.useRef(null),C.useRef(null),C.useRef(null),C.useRef(null),C.useRef(null),C.useRef(null),C.useRef(null);const ae=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in initializeTestCreation, redirecting to login"),r("Missing teacher session. Please sign in again.","error");return}console.log("🔍 Setting up test creation event listeners..."),V(),console.log("🔍 Test creation initialization complete")},[e,r]),te=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in showTestTypeSelection, redirecting to login"),r("Missing teacher session. Please sign in again.","error");return}console.log("🔍 showTestTypeSelection called - starting new test creation"),l(!1),console.log("🔍 Reset testAssignmentCompleted flag to false"),a(!0),console.log("🔍 Set isInTestCreation flag to true"),se(),d("typeSelection"),G("testTypeSelection")},[e,r]),se=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in disableNavigationButtons, redirecting to login");return}console.log("🔍 Disabling navigation buttons..."),p(!0)},[e]),L=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in enableNavigationButtons, redirecting to login");return}console.log("🔍 Enabling navigation buttons..."),p(!1)},[e]),G=C.useCallback(async ie=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in saveTestCreationState, redirecting to login");return}console.log("🔍 🔴 saveTestCreationState called with step:",ie),console.log("🔍 🔴 Call stack:",new Error().stack);const de={multipleChoice:{buttonVisible:!0,hintVisible:!1},trueFalse:{buttonVisible:!0,hintVisible:!1},input:{buttonVisible:!0,hintVisible:!1}},Ce={isInTestCreation:!0,currentStep:ie,timestamp:Date.now(),excelState:de};localStorage.setItem("test_creation_state",JSON.stringify(Ce)),console.log("🔍 Saved test creation state:",Ce);const Ne={};switch(ie){case"testTypeSelection":break;case"multipleChoiceForm":Ne.testName=N.testName||"",Ne.numQuestions=N.numQuestions||"",Ne.numOptions=N.numOptions||"",Ne.questions=N.questions||{};break;case"trueFalseForm":Ne.testName=N.testName||"",Ne.numQuestions=N.numQuestions||"",Ne.questions=N.questions||{};break;case"inputForm":Ne.testName=N.testName||"",Ne.numQuestions=N.numQuestions||"",Ne.questions=N.questions||{};break;case"formCreation":Ne.testName=N.testName||"",Ne.numQuestions=N.numQuestions||"",Ne.numOptions=N.numOptions||"",Ne.questions=N.questions||{},Ne.enableTimer=!!N.enableTimer,Ne.timerMinutes=N.timerMinutes||"",Ne.isShuffled=!!N.isShuffled;break;case"assignment":case"testAssignment":Ne.testName=N.testName||"",Ne.numQuestions=N.numQuestions||"",Ne.numOptions=N.numOptions||"",Ne.questions=N.questions||{};break;default:console.log("🔍 Unknown step in saveTestCreationState:",ie);break}Object.keys(Ne).length>0&&(localStorage.setItem(`form_data_${ie}`,JSON.stringify(Ne)),console.log("🔍 Saved form data for step:",ie,Ne))},[e,N]),I=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in clearTestCreationState, redirecting to login");return}localStorage.removeItem("test_creation_state"),localStorage.removeItem("test_creation_form_data");const ie=[];for(let de=0;de<localStorage.length;de++){const Ce=localStorage.key(de);Ce&&(Ce.includes("test")||Ce.includes("form")||Ce.includes("question"))&&ie.push(Ce)}ie.forEach(de=>{localStorage.removeItem(de),console.log("🔍 Removed localStorage key:",de)}),console.log("🔍 Cleared test creation state from localStorage")},[e]);C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in clearAllTestFields, redirecting to login");return}console.log("🔍 Clearing all test form fields..."),A({testName:"",numQuestions:0,numOptions:0,questions:{}}),y(null),H([]),Z(null),console.log("🔍 Cleared all test form fields")},[e]);const z=C.useCallback(()=>{console.log("🔍 Resetting Excel upload state..."),_t({multipleChoice:{buttonVisible:!1,hintVisible:!1},trueFalse:{buttonVisible:!1,hintVisible:!1},input:{buttonVisible:!1,hintVisible:!1}}),["multiple-choice","true-false","input","word-matching"].forEach(de=>{const Ce=document.querySelector(`.excel-upload-btn[data-test-type="${de}"]`);Ce&&(Ce.style.display="none",console.log("🔍 Excel button hidden for:",de));const Ne=document.querySelector(`.excel-hint[data-test-type="${de}"]`);Ne&&(Ne.style.display="none",console.log("🔍 Excel hint hidden for:",de));const Ge=document.querySelector(`.excel-file-input[data-test-type="${de}"]`);Ge&&(Ge.value="",console.log("🔍 File input cleared for:",de))}),console.log("✅ Excel upload state reset complete")},[]),V=C.useCallback(()=>{console.log("🔍 Setting up auto-save listeners for initial form fields..."),["testName","numQuestions","numOptions","enableTimer","timerMinutes","isShuffled"].forEach(de=>{const Ce=document.getElementById(de);Ce&&Ce.addEventListener("input",()=>{console.log(`🔍 Auto-save triggered for field: ${de}`)})}),console.log("✅ Form auto-save setup complete")},[]);C.useCallback(async ie=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in saveFormDataForStep, redirecting to login");return}console.log("🔍 🔴 saveFormDataForStep called with step:",ie),console.log("🔍 🔴 Call stack:",new Error().stack);const de={};switch(ie){case"testTypeSelection":break;case"multipleChoiceForm":de.testName=N.testName||"",de.numQuestions=N.numQuestions||"",de.numOptions=N.numOptions||"",de.questions=N.questions||{};break;case"trueFalseForm":de.testName=N.testName||"",de.numQuestions=N.numQuestions||"",de.questions=N.questions||{};break;case"inputForm":de.testName=N.testName||"",de.numQuestions=N.numQuestions||"",de.questions=N.questions||{};break;case"formCreation":de.testName=N.testName||"",de.numQuestions=N.numQuestions||"",de.numOptions=N.numOptions||"",de.questions=N.questions||{};break;default:console.log("🔍 Unknown step for form data save:",ie);return}localStorage.setItem("test_creation_form_data",JSON.stringify({step:ie,data:de,timestamp:Date.now()})),console.log("🔍 Saved form data for step:",ie,de)},[e,N]);const O=C.useCallback(async ie=>{console.log("🔍 Restoring form data for step:",ie);try{const de=localStorage.getItem(`form_data_${ie}`);if(de){const Ce=JSON.parse(de);console.log("🔍 Restored form data:",Ce),A(Ne=>{const Ge={...Ne,...Ce};return console.log("🔍 Updated formData with restored data:",Ge),console.log("🔍 Matching test data in restored data:",Ge.matchingTestData),Ge}),Object.keys(Ce).forEach(Ne=>{const Ge=document.getElementById(Ne);Ge&&Ce[Ne]!==void 0&&(Ge.value=Ce[Ne])}),console.log("✅ Form data restored for step:",ie)}else console.log("ℹ️ No saved data found for step:",ie)}catch(de){console.error("❌ Error restoring form data:",de)}},[e]),W=C.useCallback(()=>{console.log("🔍 Setting up multiple choice form auto-save..."),["mcNumOptions"].forEach(Ce=>{const Ne=document.getElementById(Ce);Ne&&Ne.addEventListener("input",()=>{console.log(`🔍 Auto-save triggered for MC field: ${Ce}`)})}),document.querySelectorAll("#mcQuestionsContainer input, #mcQuestionsContainer textarea, #mcQuestionsContainer select").forEach(Ce=>{Ce.addEventListener("input",()=>{console.log("🔍 Auto-save triggered for MC question field")})}),console.log("✅ Multiple choice form auto-save setup complete")},[]),q=C.useCallback(()=>{console.log("🔍 Setting up true/false form auto-save..."),document.querySelectorAll("#tfQuestionsContainer input, #tfQuestionsContainer textarea, #tfQuestionsContainer select").forEach(de=>{de.addEventListener("input",()=>{console.log("🔍 Auto-save triggered for TF question field")})}),console.log("✅ True/false form auto-save setup complete")},[]),Y=C.useCallback(()=>{console.log("🔍 Setting up input form auto-save..."),document.querySelectorAll("#inputQuestionsContainer input, #inputQuestionsContainer textarea, #inputQuestionsContainer select").forEach(de=>{de.addEventListener("input",()=>{console.log("🔍 Auto-save triggered for Input question field")})}),console.log("✅ Input form auto-save setup complete")},[]),ee=C.useCallback(ie=>{console.log("🔍 showExcelUploadButton called with testType:",ie);const de=ie==="multiple-choice"?"multipleChoice":ie==="true-false"?"trueFalse":ie==="input"?"input":ie;_t(Ce=>({...Ce,[de]:{...Ce[de],buttonVisible:!0}}))},[]),X=C.useCallback(ie=>{console.log("🔍 showExcelHint called with testType:",ie);const de=ie==="multiple-choice"?"multipleChoice":ie==="true-false"?"trueFalse":ie==="input"?"input":ie;_t(Ce=>({...Ce,[de]:{...Ce[de],hintVisible:!0}}))},[]),ne=C.useCallback(async(ie,de,Ce)=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in displayTestAssignmentOptions, redirecting to login");return}console.log("displayTestAssignmentOptions called with:",{classes:ie,testType:de,testId:Ce}),w(ie),console.log("🔍 Test assignment options displayed for:",{testType:de,testId:Ce,classesCount:ie.length})},[e]),ge=C.useCallback(async(ie,de)=>{try{if(console.log("Loading teacher grades and classes for test assignment"),!e||!e.teacher_id){console.error("No valid teacher session found, redirecting to login");return}console.log("Teacher ID:",e.teacher_id);const Ne=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-teacher-subjects?teacher_id=${e.teacher_id}`)).json();console.log("Teacher subjects response:",Ne),Ne.success&&Ne.subjects&&Ne.subjects.length>0?(console.log("Teacher subjects loaded:",Ne.subjects),w(Ne.subjects),ne(Ne.subjects,ie,de)):(console.log("No teacher subjects found"),r("No subjects found. Please assign subjects to grades and classes first.","warning"))}catch(Ce){console.error("Error loading teacher grades and classes:",Ce),r("Error loading teacher grades and classes","error")}},[e,r,ne]),_e=C.useCallback(async()=>{console.log("👨‍🏫 Loading available classes...");try{const ie=await Vn.getGradesAndClasses();if(console.log("👨‍🏫 Raw grades/classes data:",ie),!ie||ie.length===0){w([]);return}const de=new Map;ie.forEach(Ne=>{const Ge=Ne.subject_id,Je=Ne.subject||`Subject ${Ge}`;de.has(Ge)||de.set(Ge,{subject_id:Ge,subject:Je,classes:[]}),de.get(Ge).classes.push({grade:Ne.grade,class:Ne.class})});const Ce=Array.from(de.values());w(Ce),console.log("👨‍🏫 Transformed available classes:",Ce)}catch(ie){console.error("👨‍🏫 Error loading available classes:",ie),r("Failed to load available classes","error")}},[r]);C.useCallback(async(ie,de)=>{if(i){l(!1);return}if(!e||!e.teacher_id){console.error("No valid teacher session found in showTestAssignment, redirecting to login");return}se(),G("testAssignment"),Z(de),y(ie),d("testAssignment"),ge(ie,de),_e(),console.log("🔍 Test assignment interface shown for:",{testType:ie,testId:de})},[i,e,se,G,ge,_e]);const Pe=C.useCallback(async ie=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in displayTeacherActiveTests, redirecting to login");return}if(console.log("🔍 Displaying teacher active tests:",ie),ie.length===0){He([]);return}He(ie),console.log("🔍 Active tests displayed:",ie.length,"tests")},[e]);C.useCallback(async(ie,de)=>{try{console.log("🔍 Loading test questions for:",{testType:ie,testId:de});const Ce=await ln.getTestQuestions(de,ie);return console.log("🔍 Test questions loaded:",Ce),Ce}catch(Ce){throw console.error("Error loading test questions:",Ce),Ce}},[]),C.useCallback((ie,de,Ce,Ne)=>{console.log("🔍 Showing teacher test details modal:",{testType:ie,testId:de,testName:Ce,questionsCount:Ne.length}),console.log("Test Details:",{testType:ie,testId:de,testName:Ce,questions:Ne.map(Ge=>({id:Ge.question_id,question:Ge.question,correctAnswer:Ge.correct_answer}))}),r(`Test details for "${Ce}" loaded successfully.`,"success")},[r]);const ce=C.useCallback(async()=>{console.log("🔧 DEBUG: loadTeacherActiveTests called");try{console.log("🔧 DEBUG: Fetching teacher active tests using JWT authentication...");const ie=await ln.getTeacherTests();console.log("🔧 DEBUG: Tests loaded:",ie),ie&&ie.length>0?(console.log("🔧 DEBUG: Success! Displaying",ie.length,"tests"),Pe(ie)):(console.log("🔧 DEBUG: No tests found"),He([]))}catch(ie){console.error("🔧 DEBUG: Error loading active tests:",ie),r("Error loading active tests.","error")}},[r,Pe]),ye=C.useCallback(()=>{console.log("showTestCreationSuccessMessage called"),r("Test created and assigned successfully!","success"),d("typeSelection"),A({testName:"",numQuestions:0,numOptions:0,questions:{}}),H([]),l(!1),a(!1),I()},[r,I]),Fe=C.useCallback(async(ie,de)=>{if(console.log("🔍 === ASSIGN TEST TO CLASSES DEBUG START ==="),console.log("🔍 Test Type:",ie),console.log("🔍 Test ID:",de),console.log("🔍 Current formData:",N),console.log("🔍 Selected Classes:",M),console.log("🔍 User:",e),!e||!e.teacher_id){console.error("❌ No valid teacher session found in assignTestToClasses, redirecting to login"),r("Missing teacher session. Please sign in again.","error");return}if(console.log("✅ Teacher ID:",e.teacher_id),M.length===0){console.warn("⚠️ No classes selected"),r("Please select at least one class.","warning");return}try{console.log("📤 Preparing test + assignment request..."),await Ic.loadAcademicCalendar();const Ne=Ic.getCurrentTerm()?.id;if(!Ne)throw new Error("No current academic period found");const Ge=M.map(gt=>{const Ot={grade:parseInt(gt.grade),class:parseInt(gt.class),subject_id:parseInt(gt.subject_id),academic_period_id:Ne,due_date:null};return console.log("🔍 Created assignment:",Ot),Ot});if(console.log("📋 Final assignments array:",Ge),ie==="matching"){console.log("🎯 Processing matching test..."),console.log("🔄 Setting isAssigningTest to true for matching test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Pr=>setTimeout(Pr,100));const gt=N.matchingTestData;if(console.log("🔍 Matching test data from formData:",gt),!gt){console.error("❌ Matching test data not found in formData"),r("Matching test data not found. Please recreate the test.","error");return}console.log("✅ Matching test data found, processing...");let Ot;gt.processedQuestions?(console.log("🔍 Using pre-processed questions from MatchingTestCreator"),Ot=gt.processedQuestions):(console.log("🔍 Converting blocks to questions (fallback)..."),console.log("🔍 Blocks:",gt.blocks),console.log("🔍 Words:",gt.words),console.log("🔍 Arrows:",gt.arrows),Ot=gt.blocks.map((Pr,hn)=>{const Kr=gt.words.find(ht=>ht.blockId===Pr.id)?.word||`Word ${hn+1}`,$r=gt.arrows.some(ht=>ht.startBlock===Pr.id),or=gt.arrows.find(ht=>ht.startBlock===Pr.id)||null,xe={question_id:hn+1,word:Kr,block_coordinates:{x:Pr.x,y:Pr.y,width:Pr.width,height:Pr.height},has_arrow:$r,arrow:or?{startX:or.startX,startY:or.startY,endX:or.endX,endY:or.endY,style:or.style||{}}:null};return console.log(`🔍 Question ${hn+1}:`,xe),xe})),console.log("📋 Final questions array:",Ot);const vr={teacher_id:e.teacher_id,test_name:N.testName,image_url:gt.imageUrl,num_blocks:gt.blocks.length,questions:Ot,allowed_time:N.enableTimer?Math.max(0,Math.floor(Number(N.timerMinutes||0)*60)):null,assignments:Ge};console.log("📤 Final matching test data payload:",vr),console.log("🚀 Calling testService.saveMatchingTest...");const kr=await ln.saveMatchingTest(vr);console.log("📥 API Response:",kr),kr.success?(console.log("✅ Matching test created and assigned successfully!"),r("Matching test created and assigned successfully!","success"),console.log("Matching test created and assigned successfully"),l(!0),Me()):(console.error("❌ Failed to create matching test:",kr.message),r("Error creating and assigning matching test: "+kr.message,"error")),R(!1);return}if(ie==="wordMatching"){console.log("🎯 Processing word matching test..."),console.log("🔄 Setting isAssigningTest to true for word matching test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Pr=>setTimeout(Pr,100));const gt=N.wordMatchingData;if(console.log("🔍 Word matching test data from formData:",gt),!gt){console.error("❌ Word matching test data not found in formData"),r("Word matching test data not found. Please recreate the test.","error");return}console.log("✅ Word matching test data found, processing...");const Ot=gt.wordPairs.map((Pr,hn)=>({question_id:hn+1,left_word:Pr.leftWord,right_word:Pr.rightWord}));console.log("📋 Final word matching questions array:",Ot);const vr={teacher_id:e.teacher_id,test_type:"word_matching",test_name:N.testName,num_questions:gt.wordPairs.length,interaction_type:gt.interactionType||"drag",questions:Ot,allowed_time:N.enableTimer?Math.max(0,Math.floor(Number(N.timerMinutes||0)*60)):null,assignments:Ge};console.log("📤 Final word matching test data payload:",vr),console.log("🚀 Calling testService.assignTestToClasses for word matching...");const kr=await ln.assignTestToClasses(vr);console.log("📥 API Response:",kr),kr.success?(console.log("✅ Word matching test created and assigned successfully!"),r("Word matching test created and assigned successfully!","success"),console.log("Word matching test created and assigned successfully"),l(!0),Me()):(console.error("❌ Failed to create word matching test:",kr.message),r("Error creating and assigning word matching test: "+kr.message,"error")),R(!1);return}if(ie==="drawing"){console.log("🎯 Processing drawing test..."),console.log("🔄 Setting isAssigningTest to true for drawing test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Pr=>setTimeout(Pr,100));const gt=N.drawingData;if(console.log("🔍 Drawing test data from formData:",gt),!gt){console.error("❌ Drawing test data not found in formData"),r("Drawing test data not found. Please recreate the test.","error");return}console.log("✅ Drawing test data found, processing...");const Ot=gt.questions||[];console.log("📋 Drawing questions array:",Ot);const vr={teacher_id:e.teacher_id,test_type:"drawing",test_name:N.testName,num_questions:gt.num_questions,passing_score:gt.passing_score,questions:Ot,allowed_time:N.enableTimer?Math.max(0,Math.floor(Number(N.timerMinutes||0)*60)):null,assignments:Ge};console.log("📤 Final drawing test data payload:",vr),console.log("🚀 Calling testService.assignTestToClasses...");const kr=await ln.assignTestToClasses(vr);console.log("📥 API Response:",kr),kr.success?(console.log("✅ Drawing test created and assigned successfully!"),r("Drawing test created and assigned successfully!","success"),l(!0),Me()):(console.error("❌ Failed to create drawing test:",kr.message),r("Error creating and assigning drawing test: "+kr.message,"error")),R(!1);return}if(ie==="fillBlanks"){console.log("🎯 Processing fill blanks test..."),console.log("🔄 Setting isAssigningTest to true for fill blanks test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Pr=>setTimeout(Pr,100));const gt=N.fillBlanksData;if(console.log("🔍 Fill blanks test data from formData:",gt),!gt){console.error("❌ Fill blanks test data not found in formData"),r("Fill blanks test data not found. Please recreate the test.","error");return}console.log("✅ Fill blanks test data found, processing...");const Ot=gt.blanks||[];console.log("📋 Fill blanks questions array:",Ot);const vr={teacher_id:e.teacher_id,test_type:"fill_blanks",test_name:N.testName,test_text:gt.test_text,num_questions:gt.num_questions,num_blanks:gt.num_blanks,separate_type:gt.separate_type,allowed_time:N.enableTimer?Math.max(0,Math.floor(Number(N.timerMinutes||0)*60)):null,questions:Ot,assignments:Ge};console.log("📤 Final fill blanks test data payload:",vr),console.log("🚀 Calling testService.assignTestToClasses...");const kr=await ln.assignTestToClasses(vr);console.log("📥 API Response:",kr),kr.success?(console.log("✅ Fill blanks test created and assigned successfully!"),r("Fill blanks test created and assigned successfully!","success"),l(!0),Me()):(console.error("❌ Failed to create fill blanks test:",kr.message),r("Error creating and assigning fill blanks test: "+kr.message,"error")),R(!1);return}if(ie==="speaking"){console.log("🎯 Processing speaking test..."),console.log("🔄 Setting isAssigningTest to true for speaking test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Pr=>setTimeout(Pr,100));const gt=N.speakingData;if(console.log("🔍 Speaking test data from formData:",gt),!gt){console.error("❌ Speaking test data not found in formData"),r("Speaking test data not found. Please recreate the test.","error");return}console.log("✅ Speaking test data found, processing...");const Ot={teacher_id:e.teacher_id,test_type:"speaking",test_name:N.testName,time_limit:gt.time_limit,min_duration:gt.min_duration,max_duration:gt.max_duration,max_attempts:gt.max_attempts,min_words:gt.min_words,passing_score:gt.passing_score,allowed_time:N.enableTimer?Math.max(0,Math.floor(Number(N.timerMinutes||0)*60)):null,questions:gt.questions,assignments:Ge};console.log("📤 Final speaking test data payload:",Ot),console.log("🚀 Calling save-speaking-test-with-assignments for speaking test...");const kr=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-speaking-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ot)})).json();console.log("📥 API Response:",kr),kr.success?(console.log("✅ Speaking test created and assigned successfully!"),r("Speaking test created and assigned successfully!","success"),l(!0),Me()):(console.error("❌ Failed to create speaking test:",kr.message),r("Error creating and assigning speaking test: "+kr.message,"error")),R(!1);return}console.log("🔍 Processing non-matching test..."),console.log("🔍 Form data questions:",N.questions);const Je=Object.keys(N.questions).map(gt=>{const Ot=N.questions[gt];console.log(`🔍 Processing question ${gt}:`,Ot);let vr;ie==="input"?vr={correct_answers:Ot.correct_answers||[Ot.correctAnswer||""]}:vr={correct_answer:Ot.correctAnswer||Ot.correct_answers?.[0]||""};const kr={question_id:parseInt(gt),question:Ot.question,...vr,options:Ot.options||[]};return console.log(`🔍 Question ${gt} correct_answers:`,Ot.correct_answers),console.log(`🔍 Question ${gt} correctAnswer:`,Ot.correctAnswer),console.log(`🔍 Converted question ${gt}:`,kr),kr});console.log("📋 Final questions array:",Je);const yt={teacher_id:e.teacher_id,test_type:tre[ie],test_name:N.testName,num_questions:N.numQuestions,num_options:N.numOptions,questions:Je,allowed_time:N.enableTimer?Math.max(0,Math.floor(Number(N.timerMinutes||0)*60)):null,is_shuffled:!!N.isShuffled,assignments:Ge};console.log("📤 Final test data payload:",yt),console.log("🔄 Setting isAssigningTest to true..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(gt=>setTimeout(gt,100)),console.log("🚀 Calling testService.assignTestToClasses...");const Vt=await ln.assignTestToClasses(yt);console.log("📥 API Response:",Vt),Vt.success?(console.log("✅ Test created and assigned successfully!"),r("Test created and assigned successfully!","success"),console.log("Test created and assigned successfully"),l(!0),Me()):(console.error("❌ Failed to create and assign test:",Vt.message),r("Error creating and assigning test: "+Vt.message,"error"))}catch(Ce){console.error("💥 Exception in assignTestToClasses:",Ce),console.error("Error creating and assigning test:",Ce),r("Error creating and assigning test. Please try again.","error")}finally{R(!1)}console.log("🔍 === ASSIGN TEST TO CLASSES DEBUG END ===")},[e,M,N,r,ye]),Me=C.useCallback(async()=>{console.log("returnToMainCabinet called - restoring main cabinet view");try{a(!1),l(!1),d("typeSelection"),y(null),Z(null),H([]),L(),I(),ye(),console.log("🔍 Returned to main cabinet")}catch(ie){console.error("Error returning to main cabinet:",ie)}},[L,I,ye]),[Oe,He]=C.useState([]),[It,Ze]=C.useState(!1);C.useCallback(async()=>{console.log("🔍 Refreshing active tests data...");try{await ce(),r("Active tests data refreshed.","success")}catch(ie){console.error("Error refreshing active tests data:",ie),r("Error refreshing data.","error")}},[ce,r]);const[Le,De]=C.useState([]),[et,bt]=C.useState([]),[ut,jt]=C.useState(!1),[Rt,Xe]=C.useState(!1),Ye=C.useCallback(async ie=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in displayExistingSubjectsInSelection, redirecting to login");return}console.log("Displaying existing subjects in selection interface:",ie),De(ie),console.log("🔍 Existing subjects displayed in selection:",ie.length,"subjects")},[e]);C.useCallback(async()=>{try{console.log("Loading existing subjects...");const ie=await Vn.getTeacherSubjects();console.log("Existing subjects loaded:",ie),ie&&ie.length>0?Ye(ie):(console.log("No existing subjects found"),De([]))}catch(ie){console.error("Error loading existing subjects:",ie),r("Error loading subjects.","error")}},[r,Ye]);const pt=C.useCallback(ie=>{console.log("Checking for outside click...");const de=document.getElementById("dropdownMenu"),Ce=document.querySelector("[data-menu-button]");de&&!de.contains(ie.target)&&!Ce?.contains(ie.target)&&(console.log("Outside click detected, closing menu"),de.classList.remove("show"),document.removeEventListener("click",pt))},[]),[mt,_t]=C.useState({multipleChoice:{buttonVisible:!1,hintVisible:!1},trueFalse:{buttonVisible:!1,hintVisible:!1},input:{buttonVisible:!1,hintVisible:!1}}),Ht=C.useCallback((ie,de)=>{const Ce=ie.target.files[0];if(!Ce)return;if(!Ce.name.match(/\.(xlsx|xls)$/i)){r("Please select a valid Excel file (.xlsx or .xls)","error"),ie.target.value="";return}if(Ce.size>5*1024*1024){r("File is too large. Please select a file smaller than 5MB.","error"),ie.target.value="";return}j(!0);const Ne=new FileReader;Ne.onload=function(Ge){try{console.log("🔍 File loaded, processing data...");const Je=new Uint8Array(Ge.target.result),yt=w2(Je,{type:"array"}),Vt=yt.SheetNames[0],gt=yt.Sheets[Vt],Ot=By.sheet_to_json(gt,{header:1});console.log("🔍 Parsed Excel data:",Ot),nr(Ot,de),j(!1)}catch(Je){console.error("Error processing Excel file:",Je),r("Error reading Excel file: "+Je.message,"error"),ie.target.value="",j(!1)}},Ne.onerror=function(){r("Failed to read file","error"),ie.target.value="",j(!1)},Ne.readAsArrayBuffer(Ce)},[r]),Qt=C.useCallback(()=>{console.log("🔍 Initializing Excel upload for all test types...");const ie=document.querySelectorAll(".excel-upload-btn");console.log(`🔍 Found ${ie.length} Excel upload buttons`),ie.forEach((de,Ce)=>{const Ne=de.dataset.testType,Ge=document.querySelector(`.excel-file-input[data-test-type="${Ne}"]`);console.log(`🔍 Processing button ${Ce+1}: testType=${Ne}, fileInput=${Ge?"found":"not found"}`),Ge?(de._excelClickHandler&&de.removeEventListener("click",de._excelClickHandler),Ge._excelChangeHandler&&Ge.removeEventListener("change",Ge._excelChangeHandler),de._excelClickHandler=()=>{console.log(`🔍 Excel upload button clicked for test type: ${Ne}`),Ge.click()},Ge._excelChangeHandler=Je=>{console.log(`🔍 File input changed for test type: ${Ne}`),Ht(Je,Ne)},de.addEventListener("click",de._excelClickHandler),Ge.addEventListener("change",Ge._excelChangeHandler),console.log(`✅ Excel upload initialized for test type: ${Ne}`)):console.warn(`⚠️ File input not found for test type: ${Ne}`)}),console.log("✅ Excel upload initialization complete")},[Ht]),nr=C.useCallback((ie,de)=>{const Ce=ie.filter(gt=>Array.isArray(gt)&&gt.length>0&&gt.some(Ot=>Ot&&Ot.toString().trim()!==""));console.log("🔍 Original Excel data rows:",ie.length),console.log("🔍 Filtered Excel data rows:",Ce.length);const Ge=Nr(Ce,de).dataRows;if(Ge.length===0){const gt="No data rows found after header processing. Please check your Excel file.";r(gt,"error"),alert(gt),pe(de);return}console.log(`🔍 Processing Excel data for test type: ${de}`),console.log("🔍 Data rows after header processing:",Ge);const Je=sr(Ge,de);if(console.log("🔍 Recognition result:",Je),!Je.recognized){console.log(`❌ Excel data recognition failed for test type: ${de}`);const gt="Excel data recognition failed. Please check your file format.";r(gt,"error"),alert(gt),pe(de);return}console.log(`✅ Excel data recognition successful for test type: ${de}`);const yt=Ge.length,Vt=le(de);if(Vt===0)console.log(`🔍 No question count specified, using CSV count: ${yt}`),A(gt=>({...gt,numQuestions:yt}));else if(yt!==Vt){const gt=`Your CSV file has ${yt} data rows, but you specified ${Vt} questions.

Please either:
1. Change your question count to ${yt}, or
2. Fix your CSV file to have exactly ${Vt} data rows

Then try uploading again.`;r(gt,"error"),pe(de);return}be(Ge,de)},[r]),Nr=C.useCallback((ie,de)=>{if(ie.length===0)return{hasHeaders:!1,headerRow:null,dataRows:ie};const Ce=ie[0],Ne=fr(de);if(hr(Ce,Ne).isLikelyHeader){const Je=`The first row of your Excel file looks like it contains headers:

"${Ce.join(" | ")}"

Does the first row contain column headers?

Click "OK" if YES (headers will be removed)
Click "Cancel" if NO (first row will be treated as data)`;if(window.confirm(Je))return{hasHeaders:!0,headerRow:Ce,dataRows:ie.slice(1)}}return{hasHeaders:!1,headerRow:null,dataRows:ie}},[]),fr=C.useCallback(ie=>{switch(ie){case"multipleChoice":return{keywords:["question","answer","correct","option","a","b","c","d","e","f"],expectedColumns:4};case"trueFalse":return{keywords:["question","answer","correct","true","false"],expectedColumns:2};case"input":return{keywords:["question","answer","correct"],expectedColumns:2};default:return{keywords:[],expectedColumns:0}}},[]),hr=C.useCallback((ie,de)=>{if(!ie||ie.length===0)return{isLikelyHeader:!1};if(ie.length<de.expectedColumns)return{isLikelyHeader:!1};const Ce=ie.join(" ").toLowerCase(),Ne=de.keywords.filter(Je=>Ce.includes(Je.toLowerCase()));return{isLikelyHeader:Ne.length>de.keywords.length/2,keywordMatches:Ne}},[]),sr=C.useCallback((ie,de)=>{if(ie.length===0)return r("No data rows found. Please check your Excel file.","error"),{recognized:!1,data:[]};console.log(`🔍 Checking data pattern for test type: ${de}`),console.log("🔍 Excel data to validate:",ie);const Ce=Er(ie,de);if(console.log("🔍 Recognition result:",Ce),!Ce.matches){const Ne=`Your Excel file doesn't match the expected format.

Required format:
${he(de)}

Please review your Excel file and make sure it follows this format exactly.

Then try uploading again.`;return console.log("❌ Data pattern validation failed:",Ne),console.log("🔍 Calling showNotification with message:",Ne),r(Ne,"error"),console.log("🔍 showNotification called"),alert(Ne),{recognized:!1,data:[]}}return console.log(`✅ Data pattern validation passed for test type: ${de}`),{recognized:!0,data:ie}},[r]),Er=C.useCallback((ie,de)=>{if(de==="multipleChoice")for(let Ce=0;Ce<ie.length;Ce++){const Ne=ie[Ce];if(Ne.length<4)return{matches:!1,issue:`Row ${Ce+1} has ${Ne.length} columns but needs at least 4`};if(!Ne[0]||Ne[0].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no question in column 1`};if(!Ne[1]||Ne[1].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no correct answer in column 2`}}else if(de==="trueFalse")for(let Ce=0;Ce<ie.length;Ce++){const Ne=ie[Ce];if(Ne.length<2)return{matches:!1,issue:`Row ${Ce+1} has ${Ne.length} columns but needs at least 2`};if(!Ne[0]||Ne[0].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no question in column 1`};const Ge=Ne[1]?.toString().trim().toLowerCase();if(!Ge||!["true","false","t","f"].includes(Ge))return{matches:!1,issue:`Row ${Ce+1} has invalid correct answer in column 2 (must be True/False)`}}else if(de==="input")for(let Ce=0;Ce<ie.length;Ce++){const Ne=ie[Ce];if(Ne.length<2)return{matches:!1,issue:`Row ${Ce+1} has ${Ne.length} columns but needs at least 2`};if(!Ne[0]||Ne[0].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no question in column 1`};if(!Ne[1]||Ne[1].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no correct answer in column 2`}}return{matches:!0}},[]),he=C.useCallback(ie=>{switch(ie){case"multipleChoice":return`Column 1: Question
Column 2: Correct Answer (A, B, C, D, E, or F)
Column 3: Option A
Column 4: Option B
Column 5: Option C (optional)
Column 6: Option D (optional)
Column 7: Option E (optional)
Column 8: Option F (optional)`;case"trueFalse":return`Column 1: Question
Column 2: Correct Answer (True or False)`;case"input":return`Column 1: Question
Column 2: Correct Answer`;default:return"Unknown test type"}},[]),le=C.useCallback(ie=>N.numQuestions||0,[N.numQuestions]),pe=C.useCallback(ie=>{console.log(`🔍 Clearing file input for test type: ${ie}`)},[]),be=C.useCallback((ie,de)=>{switch(console.log(`🔍 populateFromExcelForTestType called with testType: ${de}`),de){case"multipleChoice":case"multiple-choice":Ve(ie);break;case"trueFalse":case"true-false":Ct(ie);break;case"input":Et(ie);break;default:console.log(`❌ Unknown test type: ${de}`)}},[]),Ve=C.useCallback(ie=>{console.log("🔍 populateMultipleChoiceFromExcel called with:",ie);const de=Math.max(...ie.map(Ge=>Ge.length-2)),Ce=Math.min(de,6);console.log(`🔍 Excel data has ${de} option columns, using ${Ce} options`),A(Ge=>({...Ge,numOptions:Ce}));const Ne={};ie.forEach((Ge,Je)=>{const yt=Je+1;console.log(`🔍 Row ${Je+1} data:`,Ge);const Vt={question:(Ge[0]||"").toString().trim(),options:[],correctAnswer:(Ge[1]||"").toString().trim().toUpperCase()};console.log(`🔍 Question ${yt} correctAnswer:`,Vt.correctAnswer),["A","B","C","D","E","F"].slice(0,Ce).forEach((vr,kr)=>{const Pr=(Ge[kr+2]||"").toString().trim();console.log(`🔍 Option ${kr} (${vr}):`,Pr),Vt.options.push(Pr)}),Ne[yt]=Vt}),A(Ge=>{const Je={...Ge,questions:Ne};return console.log("🔍 Updating form data with:",Je),Je}),console.log("🔍 Populated multiple choice questions from Excel:",Ne),r(`Successfully loaded ${ie.length} questions from CSV file!`,"success"),W(),Be("multiple-choice")},[N.numOptions,W,r]),Ct=C.useCallback(ie=>{console.log("🔍 populateTrueFalseFromExcel called with:",ie);const de={};ie.forEach((Ce,Ne)=>{const Ge=Ne+1,Je={question:(Ce[0]||"").toString().trim(),correctAnswer:Ce[1]?.toString().trim().toLowerCase()==="true"?"true":"false"};de[Ge]=Je}),A(Ce=>({...Ce,questions:de})),console.log("🔍 Populated true/false questions from Excel:",de),r(`Successfully loaded ${ie.length} questions from CSV file!`,"success"),q(),Be("true-false")},[q,r]),Et=C.useCallback(ie=>{console.log("🔍 populateInputFromExcel called with:",ie);const de={};ie.forEach((Ce,Ne)=>{const Ge=Ne+1,Je=[];for(let Vt=1;Vt<Ce.length;Vt++){const gt=(Ce[Vt]||"").toString().trim();gt&&Je.push(gt)}const yt={question:(Ce[0]||"").toString().trim(),correctAnswer:Je[0]||"",correct_answers:Je};console.log(`🔍 Excel question ${Ge} data:`,yt),de[Ge]=yt}),A(Ce=>({...Ce,questions:de})),console.log("🔍 Populated input questions from Excel:",de),r(`Successfully loaded ${ie.length} questions from Excel file!`,"success"),Y(),Be("input")},[Y,r]),Be=C.useCallback(ie=>{switch(console.log(`🔍 Reattaching form event listeners for test type: ${ie}`),document.querySelectorAll('[data-listener-attached="true"]').forEach(Ce=>{Ce.removeEventListener("input",()=>{}),Ce.removeAttribute("data-listener-attached")}),ie){case"multiple-choice":W();break;case"true-false":q();break;case"input":Y();break;default:console.warn("Unknown test type for event listener reattachment:",ie)}console.log(`✅ Form event listeners reattached for test type: ${ie}`)},[W,q,Y]),at=C.useCallback(()=>{const ie=localStorage.getItem("test_creation_state");if(!ie)return console.log("🔍 No test creation state found in localStorage"),!1;try{const de=JSON.parse(ie);console.log("🔍 Found test creation state:",de);const Ce=Date.now()-de.timestamp,Ne=1800*1e3;if(Ce>Ne)return console.log("🔍 Test creation state is too old, clearing it"),I(),!1;switch(a(!0),console.log("🔍 Restored isInTestCreation flag to true"),se(),de.excelState&&z(),de.currentStep){case"testTypeSelection":console.log("🔍 Restoring test type selection step"),d("typeSelection");break;case"multipleChoiceForm":console.log("🔍 Restoring multiple choice form step"),y("multipleChoice"),d("formCreation");break;case"trueFalseForm":console.log("🔍 Restoring true/false form step"),y("trueFalse"),d("formCreation");break;case"inputForm":console.log("🔍 Restoring input form step"),y("input"),d("formCreation");break;case"testAssignment":case"assignment":console.log("🔍 Restoring test assignment step"),console.log("🔍 Cannot restore test assignment step without test data, going back to type selection"),d("typeSelection");break;default:console.log("🔍 Unknown step in state, defaulting to type selection"),d("typeSelection")}return O(de.currentStep),!0}catch(de){return console.error("🔍 Error restoring test creation state:",de),I(),!1}},[I,se,z,O]);C.useEffect(()=>{console.log("👨‍🏫 Initializing Teacher Tests..."),ae(),at(),_e(),Qt()},[ae,at,_e,Qt]),C.useEffect(()=>{N.numQuestions>0&&g&&g!=="matching"&&g!=="drawing"&&g!=="fillBlanks"&&(console.log("🔍 Excel upload buttons rendered, initializing event listeners..."),setTimeout(()=>{Qt()},100))},[N.numQuestions,g,Qt]);const dt=ie=>{console.log("👨‍🏫 Test type selected:",ie),console.log("👨‍🏫 Setting testType to:",ie),y(ie),d("formCreation"),A({testName:"",numQuestions:0,numOptions:0,questions:{},enableTimer:!1,timerMinutes:""}),G("formCreation"),setTimeout(()=>{Qt()},100)},zt=(ie,de)=>{A(Ce=>({...Ce,[ie]:de}))},Yt=(ie,de,Ce)=>{A(Ne=>({...Ne,questions:{...Ne.questions,[ie]:{...Ne.questions[ie],[de]:Ce}}}))},wr=(ie,de,Ce,Ne=0)=>{const Ge={};for(let Je=1;Je<=Ce;Je++)ie==="multipleChoice"?Ge[Je]={question:"",options:Array.from({length:Ne},()=>""),correctAnswer:""}:ie==="trueFalse"?Ge[Je]={question:"",correctAnswer:""}:ie==="input"&&(Ge[Je]={question:"",correct_answers:[""]});A(Je=>({...Je,questions:Ge})),ie==="multipleChoice"?(ee("multiple-choice"),X("multiple-choice")):ie==="trueFalse"?(ee("true-false"),X("true-false")):ie==="input"&&(ee("input"),X("input"))},Ur=async()=>{if(!g||!N.testName||!N.numQuestions){r("Please fill in all required fields","error");return}console.log("👨‍🏫 Test form completed, proceeding to assignment step"),G("testAssignment",N),d("testAssignment"),r("Test form completed! Now select classes and subjects.","success")},yr=(ie,de,Ce,Ne,Ge)=>{H(Ce?Je=>[...Je,{grade:ie,class:de,subject_id:Ne,subject:Ge}]:Je=>Je.filter(yt=>!(yt.grade===ie&&yt.class===de&&yt.subject_id===Ne)))},ur=C.useCallback(async ie=>{console.log("🎯 [DEBUG] handleMatchingTestSave called"),console.log("🎯 [DEBUG] Received testData:",ie),console.log("🎯 [DEBUG] Current formData:",N),console.log("🎯 [DEBUG] Current testType:",g),console.log("🎯 [DEBUG] Current user:",e),console.log("🎯 [DEBUG] Current currentStep:",c),_(!0);try{const de=ie.blocks.map((Ge,Je)=>{const yt=ie.words.find(Ot=>Ot.blockId===Ge.id)?.word||`Word ${Je+1}`,Vt=ie.arrows.some(Ot=>Ot.startBlock===Ge.id),gt=ie.arrows.find(Ot=>Ot.startBlock===Ge.id)||null;return{question_id:Je+1,word:yt,block_coordinates:{x:Ge.x,y:Ge.y,width:Ge.width,height:Ge.height},has_arrow:Vt,arrow:gt?{startX:gt.startX,startY:gt.startY,endX:gt.endX,endY:gt.endY,style:gt.style||{}}:null}}),Ce={teacher_id:e.teacher_id,test_name:N.testName||`Matching Test - ${new Date().toLocaleString()}`,image_url:ie.imageUrl,num_blocks:ie.blocks.length,questions:de,assignments:[]};console.log("📦 Sending matching test payload:",Ce);const Ne={...N,testName:Ce.test_name,numQuestions:Ce.num_blocks,numOptions:0,questions:de.reduce((Ge,Je,yt)=>(Ge[yt+1]={question:Je.word,correctAnswer:Je.word,options:[]},Ge),{}),matchingTestData:ie};console.log("📦 Assignment form data:",Ne),A(Ne),G("testAssignment",Ne),console.log("📦 Setting current step to testAssignment"),d("testAssignment"),r("Matching test data saved! Now select classes and subjects.","success")}catch(de){console.error("❌ Error saving matching test:",de),r("Failed to save matching test: "+de.message,"error")}finally{_(!1)}},[e,N,g,r,G]),oe=C.useCallback(()=>{console.log("❌ Cancelling matching test creation"),d("typeSelection"),A({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),we=C.useCallback(async ie=>{console.log("🎯 [DEBUG] handleWordMatchingTestSave called"),console.log("🎯 [DEBUG] Received testData:",ie),_(!0);try{A(de=>({...de,wordMatchingData:ie,numQuestions:ie.numQuestions||ie.wordPairs?.length||0})),d("testAssignment"),r("Word matching test created! Now assign it to classes.","success")}catch(de){console.error("Error saving word matching test:",de),r("Failed to save word matching test: "+de.message,"error")}finally{_(!1)}},[r]),fe=C.useCallback(()=>{console.log("❌ Cancelling word matching test creation"),d("typeSelection"),A({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),me=C.useCallback(async ie=>{console.log("🎯 [DEBUG] handleDrawingTestSave called"),console.log("🎯 [DEBUG] Received testData:",ie),_(!0);try{A(de=>({...de,drawingData:ie,numQuestions:ie.num_questions||ie.questions?.length||0})),d("testAssignment"),r("Drawing test created! Now assign it to classes.","success")}catch(de){console.error("❌ Error saving drawing test:",de),r("Error saving drawing test","error")}finally{_(!1)}},[r]),Se=C.useCallback(()=>{console.log("❌ Cancelling drawing test creation"),d("typeSelection"),A({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),ke=C.useCallback(()=>{console.log("❌ Cancelling fill blanks test creation"),d("typeSelection"),A({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),We=C.useCallback(async ie=>{console.log("🎯 [DEBUG] handleFillBlanksTestSave called"),console.log("🎯 [DEBUG] Received testData:",ie),_(!0);try{A(de=>({...de,fillBlanksData:ie,numQuestions:ie.num_questions||ie.blanks?.length||0})),d("testAssignment"),r("Fill blanks test created! Now assign it to classes.","success")}catch(de){console.error("❌ Error saving fill blanks test:",de),r("Error saving fill blanks test","error")}finally{_(!1)}},[r]),ft=C.useCallback(()=>{console.log("❌ Cancelling speaking test creation"),d("typeSelection"),A({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),Re=C.useCallback(async ie=>{console.log("🎯 [DEBUG] handleSpeakingTestSave called"),console.log("🎯 [DEBUG] Received testData:",ie),_(!0);try{A(de=>({...de,speakingData:ie,numQuestions:ie.questions?.length||0})),d("testAssignment"),r("Speaking test created! Now assign it to classes.","success")}catch(de){console.error("❌ Error saving speaking test:",de),r("Error saving speaking test","error")}finally{_(!1)}},[r]);return o.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[o.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs(ji,{mode:"wait",children:[c==="typeSelection"&&o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs(rt,{variant:"outline",onClick:()=>window.history.back(),className:"flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),o.jsx("span",{children:"Back to Main"})]}),o.jsx("div",{className:"flex-1"})]}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Create New Test"}),o.jsx("p",{className:"text-gray-600",children:"Choose the type of test you want to create"})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[{type:"multipleChoice",title:"Multiple Choice",description:"Questions with multiple answer options",icon:"/pics/multiple-choice.png"},{type:"trueFalse",title:"True/False",description:"Questions with true or false answers",icon:"/pics/true-false.png"},{type:"input",title:"Input",description:"Questions requiring text input",icon:"/pics/input.png"},{type:"matching",title:"Picture Matching",description:"Labeling pictures",icon:"/pics/matching.png"},{type:"wordMatching",title:"Word Matching",description:"Matching word pairs by dragging or drawing arrows",icon:"/pics/matching-words.png"},{type:"drawing",title:"Drawing Test",description:"Interactive drawing tests with canvas for students",icon:"/pics/drawing.png"},{type:"fillBlanks",title:"Fill Blanks",description:"Text with multiple choice blanks",icon:"/pics/fill-blanks.png"},{type:"speaking",title:"Speaking Test",description:"Audio recording with AI-powered feedback",icon:"/pics/speaking.png"}].map(({type:ie,title:de,description:Ce,icon:Ne})=>o.jsx(Qe.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"cursor-pointer",onClick:()=>dt(ie),children:o.jsxs(kt,{className:"h-full text-center hover:shadow-lg transition-shadow",children:[o.jsx("div",{className:"mb-3 flex justify-center",children:o.jsx("img",{src:Ne,alt:de,className:"w-12 h-12 object-contain"})}),o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:de}),o.jsx("p",{className:"text-sm text-gray-600",children:Ce})]})},ie))})]}),c==="formCreation"&&o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"flex space-x-2",children:o.jsx(rt,{variant:"outline",onClick:te,children:"← Back to Test Types"})}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Create ",g==="multipleChoice"?"Multiple Choice":g==="trueFalse"?"True/False":g==="input"?"Input":g==="drawing"?"Drawing":g==="fillBlanks"?"Fill Blanks":g==="wordMatching"?"Word Matching":g==="speaking"?"Speaking":"Picture Matching"," Test"]}),o.jsx("p",{className:"text-gray-600",children:"Fill in the test details and questions"})]})]})}),o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Test Information"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Test Name"}),o.jsx("input",{type:"text",value:N.testName,onChange:ie=>zt("testName",ie.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter test name"})]}),g!=="matching"&&g!=="wordMatching"&&g!=="drawing"&&g!=="fillBlanks"&&g!=="speaking"&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Questions"}),o.jsx("input",{type:"number",min:"1",max:"50",value:N.numQuestions,onChange:ie=>{const de=parseInt(ie.target.value)||0;zt("numQuestions",de),de>0&&wr(g,N.testName,de,N.numOptions)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter number of questions"})]}),g==="multipleChoice"&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Options per Question"}),o.jsx("input",{type:"number",min:"2",max:"6",value:N.numOptions,onChange:ie=>{const de=parseInt(ie.target.value)||0;zt("numOptions",de),de>0&&de<2&&r("Multiple choice tests require at least 2 options per question. Please enter 2 or more.","warning"),N.numQuestions>0&&wr(g,N.testName,N.numQuestions,de)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter number of options (2-6)"})]}),g!=="speaking"&&o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs("label",{className:"inline-flex items-center space-x-2",children:[o.jsx("input",{type:"checkbox",checked:!!N.enableTimer,onChange:ie=>zt("enableTimer",ie.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),o.jsx("span",{className:"text-sm text-gray-700",children:"Enable timer for this test"})]}),N.enableTimer&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("label",{className:"text-sm text-gray-700",children:"Time (minutes):"}),o.jsx("input",{type:"number",min:"1",max:"1440",value:N.timerMinutes,onChange:ie=>zt("timerMinutes",ie.target.value.replace(/[^0-9]/g,"")),className:"w-28 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g. 30"})]}),g!=="drawing"&&g!=="matching"&&g!=="wordMatching"&&g!=="fillBlanks"&&g!=="speaking"&&o.jsxs("label",{className:"inline-flex items-center space-x-2 ml-6",children:[o.jsx("input",{type:"checkbox",checked:!!N.isShuffled,onChange:ie=>zt("isShuffled",ie.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),o.jsx("span",{className:"text-sm text-gray-700",children:"Shuffle questions during test"})]})]})]})}),g==="matching"&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4 text-center",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Picture Matching Test"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Upload an image and create interactive matching blocks with words."}),o.jsx(OL,{testName:N.testName,onTestSaved:ur,onCancel:oe,onBackToCabinet:Me,isSaving:k,validationErrors:{}})]})}),g==="wordMatching"&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4 text-center",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Word Matching Test"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Create word pairs for students to match by dragging or drawing arrows."}),o.jsx(BW,{testName:N.testName,onTestSaved:we,onCancel:fe,onBackToCabinet:Me,isSaving:k,validationErrors:{}})]})}),g==="drawing"&&o.jsxs("div",{className:"drawing-test-section",children:[console.log("🎨 Rendering DrawingTestCreator, testType:",g),o.jsx(EW,{testName:N.testName,onTestSaved:me,onCancel:Se,onBackToCabinet:Me,isSaving:k,validationErrors:{}})]}),g==="fillBlanks"&&o.jsxs("div",{className:"fill-blanks-test-section",children:[console.log("📝 Rendering FillBlanksTestCreator, testType:",g),o.jsx(PW,{testName:N.testName,allowedTime:N.enableTimer&&parseInt(N.timerMinutes)||null,onTestSaved:We,onCancel:ke,onBackToCabinet:Me,isSaving:k,validationErrors:{}})]}),g==="speaking"&&o.jsxs(kt,{children:[console.log("🎤 Rendering SpeakingTestCreator, testType:",g),o.jsx(DW,{testName:N.testName,onTestSaved:Re,onCancel:ft,onBackToCabinet:Me,isSaving:k,validationErrors:{}})]}),g!=="matching"&&g!=="drawing"&&g!=="fillBlanks"&&g!=="speaking"&&N.numQuestions>0&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Excel Upload"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Upload an Excel file to automatically populate questions, or fill them in manually below."}),o.jsxs("div",{className:"space-y-6",children:[g==="multipleChoice"&&mt.multipleChoice?.buttonVisible&&o.jsxs("div",{className:"flex items-start space-x-4",children:[o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("button",{type:"button",className:"excel-upload-btn px-6 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md hover:shadow-lg transition-all duration-200 flex items-center space-x-3 min-h-[60px] disabled:opacity-50 disabled:cursor-not-allowed","data-test-type":"multiple-choice",disabled:T,children:T?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",color:"white"}),o.jsx("span",{className:"font-medium",children:"Processing..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("img",{src:"/pics/excel.png",alt:"Excel",className:"w-6 h-6 object-contain"}),o.jsx("span",{className:"font-medium",children:"Upload Excel"})]})}),o.jsx("input",{type:"file",accept:".xlsx,.xls",className:"excel-file-input hidden","data-test-type":"multiple-choice"})]}),o.jsx("div",{className:"w-fit",children:o.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md min-h-[60px] flex items-start",children:o.jsxs("div",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Multiple Choice Format:"}),o.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[o.jsx("div",{children:"Column 1: Question"}),o.jsx("div",{children:"Column 2: Correct Answer (A-F)"}),o.jsx("div",{children:"Column 3: Option A text"}),o.jsx("div",{children:"Column 4: Option B text"}),o.jsx("div",{children:"Column 5: Option C text"}),o.jsx("div",{children:"Column 6: Option D text"})]})]})})})]}),g==="trueFalse"&&mt.trueFalse?.buttonVisible&&o.jsxs("div",{className:"flex items-start space-x-4",children:[o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("button",{type:"button",className:"excel-upload-btn px-6 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md hover:shadow-lg transition-all duration-200 flex items-center space-x-3 min-h-[60px] disabled:opacity-50 disabled:cursor-not-allowed","data-test-type":"true-false",disabled:T,children:T?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",color:"white"}),o.jsx("span",{className:"font-medium",children:"Processing..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("img",{src:"/pics/excel.png",alt:"Excel",className:"w-6 h-6 object-contain"}),o.jsx("span",{className:"font-medium",children:"Upload Excel"})]})}),o.jsx("input",{type:"file",accept:".xlsx,.xls",className:"excel-file-input hidden","data-test-type":"true-false"})]}),o.jsx("div",{className:"w-fit",children:o.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md min-h-[60px] flex items-start",children:o.jsxs("div",{className:"text-xs text-blue-800",children:[o.jsxs("div",{children:[o.jsx("strong",{children:"Format:"})," Question | Answer (true/false)"]}),o.jsxs("div",{className:"mt-1",children:[o.jsx("strong",{children:"Example:"})," The Earth is round | true"]}),o.jsxs("div",{className:"mt-1",children:[o.jsx("strong",{children:"Note:"})," Headers are optional"]})]})})})]}),g==="input"&&mt.input?.buttonVisible&&o.jsxs("div",{className:"flex items-start space-x-4",children:[o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("button",{type:"button",className:"excel-upload-btn px-6 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md hover:shadow-lg transition-all duration-200 flex items-center space-x-3 min-h-[60px] disabled:opacity-50 disabled:cursor-not-allowed","data-test-type":"input",disabled:T,children:T?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",color:"white"}),o.jsx("span",{className:"font-medium",children:"Processing..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("img",{src:"/pics/excel.png",alt:"Excel",className:"w-6 h-6 object-contain"}),o.jsx("span",{className:"font-medium",children:"Upload Excel"})]})}),o.jsx("input",{type:"file",accept:".xlsx,.xls",className:"excel-file-input hidden","data-test-type":"input"})]}),o.jsx("div",{className:"w-fit",children:o.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md min-h-[60px] flex items-start",children:o.jsxs("div",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Input Test Format:"}),o.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[o.jsx("div",{children:"Column 1: Question"}),o.jsx("div",{children:"Column 2: Answer 1"}),o.jsx("div",{children:"Column 3: Answer 2 (optional)"})]})]})})})]})]})]})}),g!=="matching"&&g!=="drawing"&&g!=="fillBlanks"&&N.numQuestions>0&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Manual Question Entry"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Fill in the questions manually using the form below."})]})}),N.numQuestions>0&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Questions"}),o.jsx("div",{className:"space-y-6",children:Object.keys(N.questions).map(ie=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Question ",ie]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question Text"}),o.jsx("textarea",{value:N.questions[ie]?.question||"",onChange:de=>Yt(ie,"question",de.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Enter the question text"})]}),g==="multipleChoice"&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Answer Options"}),o.jsx("div",{className:"space-y-2",children:N.questions[ie]?.options?.map((de,Ce)=>o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("span",{className:"w-6 text-sm font-medium text-gray-700",children:[String.fromCharCode(65+Ce),":"]}),o.jsx("input",{type:"text",value:de,onChange:Ne=>{const Ge=[...N.questions[ie].options];Ge[Ce]=Ne.target.value,Yt(ie,"options",Ge)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Option ${String.fromCharCode(65+Ce)}`})]},Ce))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Correct Answer"}),g==="multipleChoice"?o.jsx("div",{children:o.jsxs("select",{value:N.questions[ie]?.correctAnswer||"",onChange:de=>Yt(ie,"correctAnswer",de.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"",children:"Select correct answer"}),N.questions[ie]?.options?.map((de,Ce)=>o.jsx("option",{value:String.fromCharCode(65+Ce),children:String.fromCharCode(65+Ce)},Ce))]})}):g==="trueFalse"?o.jsxs("select",{value:N.questions[ie]?.correctAnswer||"",onChange:de=>Yt(ie,"correctAnswer",de.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"true",children:"True"}),o.jsx("option",{value:"false",children:"False"})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Correct Answer(s)"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("input",{type:"text",value:N.questions[ie]?.correct_answers?.[0]||"",onChange:de=>{const Ne=[...N.questions[ie]?.correct_answers||[""]];Ne[0]=de.target.value,Yt(ie,"correct_answers",Ne)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter the primary correct answer"}),N.questions[ie]?.correct_answers?.slice(1).map((de,Ce)=>o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"text",value:de,onChange:Ne=>{const Ge=[...N.questions[ie]?.correct_answers||[]];Ge[Ce+1]=Ne.target.value,Yt(ie,"correct_answers",Ge)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Alternative answer ${Ce+2}`}),o.jsx("button",{type:"button",onClick:()=>{const Ne=[...N.questions[ie]?.correct_answers||[]];Ne.splice(Ce+1,1),Yt(ie,"correct_answers",Ne)},className:"px-2 py-1 text-red-600 hover:text-red-800 text-sm",children:"Remove"})]},Ce))||[],o.jsx("button",{type:"button",onClick:()=>{const Ce=[...N.questions[ie]?.correct_answers||[""],""];Yt(ie,"correct_answers",Ce)},className:"px-3 py-1 text-blue-600 hover:text-blue-800 text-sm border border-blue-300 rounded-md hover:bg-blue-50",children:"+ Add Alternative Answer"})]}),o.jsx("p",{className:"text-xs text-gray-500",children:"You can add multiple correct answers for the same question. Students will get credit for any of them."})]})]})]})]},ie))})]})}),N.testName&&N.numQuestions>0&&o.jsx("div",{className:"flex justify-end",children:o.jsx(rt,{onClick:Ur,disabled:k,className:"px-8",children:k?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",color:"white",className:"mr-2"}),"Saving Test..."]}):"Save Test & Continue to Assignment"})})]}),c==="testAssignment"&&o.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs(rt,{variant:"outline",onClick:()=>window.history.back(),className:"flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),o.jsx("span",{children:"Back to Main"})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Assign Test to Classes"}),o.jsx("p",{className:"text-gray-600",children:"Select which classes should take this test"})]})]}),o.jsx(rt,{variant:"outline",onClick:()=>d("formCreation"),children:"← Back to Test Form"})]}),o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Available Classes"}),v.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📚"}),o.jsx("p",{className:"text-gray-500 text-lg",children:"No subjects available for assignment."}),o.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"You need to assign subjects to grades and classes first."}),o.jsx("div",{className:"mt-4",children:o.jsx(rt,{onClick:()=>window.location.href="/teacher/subjects",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Go to Subjects Page"})})]}):o.jsx("div",{className:"space-y-6",children:v.map(ie=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:ie.subject}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2",children:ie.classes.map(de=>o.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:M.some(Ce=>Ce.grade===de.grade&&Ce.class===de.class&&Ce.subject_id===ie.subject_id),onChange:Ce=>yr(de.grade,de.class,Ce.target.checked,ie.subject_id,ie.subject),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),o.jsxs("span",{className:"text-sm text-gray-700",children:[de.grade,"/",de.class]})]},`${de.grade}-${de.class}-${ie.subject_id}`))})]},ie.subject_id))})]})}),M.length>0&&o.jsx("div",{className:"flex justify-end",children:o.jsx(rt,{onClick:()=>Fe(g,null),disabled:b,className:"px-8",children:b?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:"sm",color:"white",className:"mr-2"}),"Assigning Test..."]}):`Assign Test to ${M.length} Class${M.length>1?"es":""}`})})]})]})}),console.log("🔍 Checking isAssigningTest:",P),P&&o.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-blue-600 font-semibold text-lg",children:"Assigning test to classes..."}),o.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Please wait while we process your assignment"})]})}),k&&o.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-blue-600 font-semibold text-lg",children:"Saving test..."}),o.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Please wait while we save your test"})]})}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:t.map(ie=>o.jsx(el,{type:ie.type,message:ie.message,duration:ie.duration,onClose:()=>n(ie.id)},ie.id))})]})},rre=({onDataLoaded:e,onError:t})=>{const r=Ii(),{user:n,isAuthenticated:s}=Wn(),{teacherData:a,loadTeacherData:i}=tv(),[l,c]=C.useState(!0),[d,f]=C.useState(""),[p,g]=C.useState([]),[y,v]=C.useState(null),[w,b]=C.useState([]),[E,k]=C.useState([]),[_,T]=C.useState([]),[j,P]=C.useState(null),[R,N]=C.useState(0);C.useEffect(()=>{ae()},[]),C.useCallback(async se=>{console.log("👨‍🏫 Teacher login attempt...");try{const L=await Vn.teacherLogin(se);if(L.success)return Z("Login successful!","success"),await A(),L;throw new Error(L.error||"Login failed")}catch(L){throw console.error("👨‍🏫 Teacher login error:",L),Z("Login failed. Please check your credentials.","error"),L}},[]);const A=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher data...");try{if(c(!0),f(""),!s||!n){console.log("👨‍🏫 User not authenticated"),f("User not authenticated");return}if(n.role!==fi.TEACHER){console.error("👨‍🏫 Invalid user role for teacher data:",n.role),f("Access denied. Teacher role required.");return}console.log("👨‍🏫 Fetching teacher data from service...");const se=await Vn.getTeacherData();if(se&&se.success)console.log("👨‍🏫 Teacher data loaded successfully:",se),v(se.teacher||n),se.subjects&&(b(se.subjects),console.log("👨‍🏫 Teacher subjects loaded:",se.subjects.length)),se.grades&&k(se.grades),se.classes&&T(se.classes),P(new Date),N(L=>L+1),e&&e(se),Z("Teacher data loaded successfully!","success");else throw new Error(se?.error||"Failed to load teacher data")}catch(se){console.error("👨‍🏫 Error loading teacher data:",se);const L=se.message||"Failed to load teacher data";f(L),t&&t(se),Z(L,"error")}finally{c(!1)}},[s,n,e,t]),M=C.useCallback(()=>{console.log("👨‍🏫 Returning to main cabinet..."),r("/teacher/cabinet")},[r]);C.useCallback(se=>{console.log("👨‍🏫 Showing main cabinet with subjects:",se),se&&b(se),r("/teacher/cabinet")},[r]);const H=C.useCallback(()=>(console.log("👨‍🏫 Rendering grade buttons..."),["M1","M2","M3","M4","M5","M6"].map(L=>({id:L,name:`Grade ${L}`,classes:Q(L)}))),[]),Q=C.useCallback(se=>Array.from({length:10},(G,I)=>I+1).map(G=>({id:`${se}-${G}`,name:`Class ${G}`,grade:se,classNumber:G})),[]),Z=C.useCallback((se,L)=>{const G={id:Date.now(),message:se,type:L,timestamp:new Date};g(I=>[...I,G]),setTimeout(()=>{g(I=>I.filter(z=>z.id!==G.id))},Vu.NOTIFICATION_DURATION)},[]),ae=C.useCallback(async()=>{console.log("👨‍🏫 Initializing teacher data..."),await A()},[A]),te=C.useCallback(async()=>{console.log("👨‍🏫 Refreshing teacher data..."),await A()},[A]);return C.useCallback(async se=>{console.log("👨‍🏫 Updating teacher profile:",se);try{const L=await Vn.updateUserProfile(se);if(L.success)return v(G=>({...G,...se})),Z("Profile updated successfully!","success"),L;throw new Error(L.error||"Failed to update profile")}catch(L){throw console.error("👨‍🏫 Error updating teacher profile:",L),Z("Failed to update profile","error"),L}},[]),C.useCallback(async se=>{console.log("👨‍🏫 Changing teacher password...");try{const L=await Vn.changePassword(se);if(L.success)return Z("Password changed successfully!","success"),L;throw new Error(L.error||"Failed to change password")}catch(L){throw console.error("👨‍🏫 Error changing teacher password:",L),Z("Failed to change password","error"),L}},[]),l?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Teacher Data..."})]})}):d?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Data Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:d}),o.jsxs("div",{className:"flex space-x-3 justify-center",children:[o.jsx(rt,{variant:"primary",onClick:te,children:"Retry"}),o.jsx(rt,{variant:"outline",onClick:M,children:"Go Back"})]})]})})}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Teacher Data"}),o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",j?j.toLocaleString():"Never"," | Version: ",R]})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx(rt,{variant:"outline",onClick:te,children:"Refresh Data"}),o.jsx(rt,{variant:"outline",onClick:M,children:"Back to Cabinet"})]})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Teacher Information"}),y?o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Name:"}),o.jsx("p",{className:"text-sm text-gray-900",children:y.name||"N/A"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Username:"}),o.jsx("p",{className:"text-sm text-gray-900",children:y.username||"N/A"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Email:"}),o.jsx("p",{className:"text-sm text-gray-900",children:y.email||"N/A"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Role:"}),o.jsx("p",{className:"text-sm text-gray-900",children:y.role||"N/A"})]})]}):o.jsx("p",{className:"text-gray-500",children:"No teacher information available"})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Subjects (",w.length,")"]}),w.length>0?o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map((se,L)=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("h3",{className:"font-medium text-gray-900",children:se.name}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:se.description||"No description"}),se.classes&&se.classes.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Classes:"}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:se.classes.map((G,I)=>o.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:[G.grade," - ",G.className]},I))})]})]},L))}):o.jsx("p",{className:"text-gray-500",children:"No subjects assigned"})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Grade Levels"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:H().map(se=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:se.name}),o.jsx("div",{className:"grid grid-cols-5 gap-1",children:se.classes.map(L=>o.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded transition-colors",onClick:()=>console.log("Class clicked:",L),children:L.classNumber},L.id))})]},se.id))})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Data Statistics"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:w.length}),o.jsx("p",{className:"text-sm text-gray-500",children:"Subjects"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-semibold text-green-600",children:E.length}),o.jsx("p",{className:"text-sm text-gray-500",children:"Grades"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-semibold text-yellow-600",children:_.length}),o.jsx("p",{className:"text-sm text-gray-500",children:"Classes"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-semibold text-purple-600",children:R}),o.jsx("p",{className:"text-sm text-gray-500",children:"Data Version"})]})]})]})]})}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:p.map(se=>o.jsx(el,{type:se.type,message:se.message,onClose:()=>g(L=>L.filter(G=>G.id!==se.id))},se.id))})]})},nre=({onBackToCabinet:e})=>{const t=Ii(),{user:r,isAuthenticated:n}=Wn(),{teacherData:s}=tv(),[a,i]=C.useState(!0),[l,c]=C.useState(""),[d,f]=C.useState([]),[p,g]=C.useState([]),[y,v]=C.useState([]),[w,b]=C.useState([]),[E,k]=C.useState(null),[_,T]=C.useState([]),[j,P]=C.useState(!1),[R,N]=C.useState(!1),[A,M]=C.useState(!1),[H,Q]=C.useState(!1),[Z,ae]=C.useState(null),[te,se]=C.useState(!0),[L,G]=C.useState(null);C.useEffect(()=>{He()},[]),C.useCallback(Ze=>{console.log("👨‍🏫 Rendering existing subjects:",Ze),g(Ze)},[]);const I=C.useCallback(()=>{console.log("👨‍🏫 Showing subject selection prompt..."),P(!0),se(!1),z()},[]),z=C.useCallback(async()=>{console.log("👨‍🏫 Loading existing subjects...");try{const Ze=await Vn.getTeacherSubjects();Ze.success&&Ze.subjects&&Ze.subjects.length>0?(console.log("👨‍🏫 Existing subjects found:",Ze.subjects),V(Ze.subjects)):(console.log("👨‍🏫 No existing subjects found"),b([]))}catch(Ze){console.error("👨‍🏫 Error loading existing subjects:",Ze),Oe("Failed to load existing subjects","error")}},[]),V=C.useCallback(Ze=>{console.log("👨‍🏫 Rendering subject selection:",Ze);const Le=[];Ze.forEach(De=>{De.classes&&Array.isArray(De.classes)&&De.classes.forEach(et=>{Le.push({id:`${De.subject_id}-${et.grade}-${et.class}`,subjectId:De.subject_id,subjectName:De.subject,grade:et.grade,class:et.class,displayText:`${De.subject} - ${et.grade}/${et.class}`})})}),b(Le),console.log("👨‍🏫 Processed subjects for selection:",Le)},[]),O=C.useCallback(async Ze=>{if(console.log("👨‍🏫 Saving teacher subjects:",Ze),!Ze||Ze.length===0){Oe("Please select at least one subject and class combination.","warning");return}try{const Le=Ze.reduce((et,bt)=>{const ut=et.find(jt=>jt.subject_id===bt.subjectId);return ut?ut.classes.push({grade:bt.grade,class:bt.class}):et.push({subject_id:bt.subjectId,classes:[{grade:bt.grade,class:bt.class}]}),et},[]);console.log("👨‍🏫 Transformed data for backend:",Le);const De=await Vn.saveTeacherSubjects(Le);if(De.success)Oe("Subjects saved successfully!","success"),P(!1),se(!0),G(new Date),await z();else throw new Error(De.error||"Failed to save subjects")}catch(Le){console.error("👨‍🏫 Error saving subjects:",Le),Oe("Error saving subjects. Please try again.","error")}},[]),W=C.useCallback(()=>{console.log("👨‍🏫 Toggling subject dropdown..."),N(Ze=>!Ze),M(!1)},[]),q=C.useCallback(async()=>{console.log("👨‍🏫 Loading subjects for dropdown...");try{const Ze=await Vn.getAllSubjects();if(Ze.success)v(Ze.subjects||[]),console.log("👨‍🏫 Available subjects loaded:",Ze.subjects?.length||0);else throw new Error(Ze.error||"Failed to load subjects")}catch(Ze){console.error("👨‍🏫 Error loading subjects for dropdown:",Ze),Oe("Failed to load subjects","error")}},[]),Y=C.useCallback(Ze=>{console.log("👨‍🏫 Subject selected:",Ze);const Le=y.find(De=>De.subject_id===parseInt(Ze));Le&&(k(Le),M(!0),N(!1),ee())},[y]),ee=C.useCallback(()=>{console.log("👨‍🏫 Loading grades and classes...")},[]),X=C.useCallback((Ze,Le)=>{console.log("👨‍🏫 Saving classes for subject:",Ze,Le);const De={id:`${Ze.subject_id}-${Date.now()}`,subjectId:Ze.subject_id,subjectName:Ze.subject,grade:Le.grade,class:Le.class,displayText:`${Ze.subject} - ${Le.grade}/${Le.class}`};b(et=>[...et,De]),k(null),T([]),M(!1),ge(`Added ${Ze.subject} for ${Le.grade}/${Le.class}`)},[]),ne=C.useCallback(()=>{console.log("👨‍🏫 Resetting subject selection..."),k(null),T([]),N(!1),M(!1)},[]),ge=C.useCallback(Ze=>{console.log("👨‍🏫 Showing message:",Ze),Oe(Ze,"success")},[]),_e=C.useCallback(Ze=>{console.log("👨‍🏫 Showing confirmation modal:",Ze),ae(Ze),Q(!0)},[]),Pe=C.useCallback(()=>{console.log("👨‍🏫 Hiding confirmation modal..."),Q(!1),ae(null)},[]),ce=C.useCallback(()=>{console.log("👨‍🏫 Confirming save subjects..."),Pe(),O(w)},[w,O,Pe]),ye=C.useCallback(()=>{console.log("👨‍🏫 Cancelling save subjects..."),Pe()},[Pe]),Fe=C.useCallback(Ze=>{console.log("👨‍🏫 Removing subject:",Ze),b(Le=>Le.filter(De=>De.id!==Ze)),Oe("Subject removed","info")},[]);C.useCallback(()=>{console.log("👨‍🏫 Showing edit subjects button..."),se(!0)},[]),C.useCallback(()=>{console.log("👨‍🏫 Hiding edit subjects button..."),se(!1)},[]);const Me=C.useCallback(Ze=>{console.log("👨‍🏫 Generating class buttons for grade:",Ze);let Le;return Ze===1||Ze===2?Le=["15","16"]:Ze===3?Le=["15","16"]:Ze===4?Le=["13","14"]:Ze===5||Ze===6?Le=["13","14"]:Le=[],Le.map(De=>({id:`${Ze}-${De}`,grade:Ze,class:De,displayText:`${Ze}/${De}`}))},[]);C.useCallback((Ze,Le)=>{console.log("👨‍🏫 Showing class results:",Ze,Le),t("/teacher/results")},[t]);const Oe=C.useCallback((Ze,Le)=>{const De={id:Date.now(),message:Ze,type:Le,timestamp:new Date};f(et=>[...et,De]),setTimeout(()=>{f(et=>et.filter(bt=>bt.id!==De.id))},Vu.NOTIFICATION_DURATION)},[]),He=C.useCallback(async()=>{console.log("👨‍🏫 Initializing teacher subjects...");try{if(i(!0),c(""),!n||!r){console.log("👨‍🏫 User not authenticated"),c("User not authenticated");return}if(r.role!==fi.TEACHER){console.error("👨‍🏫 Invalid user role for teacher subjects:",r.role),c("Access denied. Teacher role required.");return}await z(),await q(),console.log("👨‍🏫 Teacher subjects initialization complete!")}catch(Ze){console.error("👨‍🏫 Error initializing teacher subjects:",Ze),c("Failed to initialize teacher subjects")}finally{i(!1)}},[n,r,z,q]),It=C.useCallback(()=>{e?e():t("/teacher/cabinet")},[e,t]);return a?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Teacher Subjects..."})]})}):l?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Subjects Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:l}),o.jsx(rt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Subject Management"}),o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",L?L.toLocaleString():"Never"]})]}),o.jsxs("div",{className:"flex space-x-3",children:[te&&o.jsx(rt,{variant:"primary",onClick:I,children:"Edit Subjects"}),o.jsx(rt,{variant:"outline",onClick:It,children:"Back to Cabinet"})]})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsxs("div",{className:"space-y-6",children:[!j&&o.jsxs("div",{className:`\r
              bg-white rounded-xl shadow-md border border-gray-200 p-6\r
              hover:shadow-lg hover:-translate-y-1 transition-all duration-200\r
            `,children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Assigned Subjects"}),o.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your teaching subjects and class assignments"})]}),o.jsx("div",{className:"flex space-x-3",children:o.jsxs(rt,{variant:"primary",onClick:I,className:"px-6 py-2",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Subjects"]})})]}),p.length>0?o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map((Ze,Le)=>o.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200",children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:Ze.subject}),Ze.classes&&Ze.classes.length>0&&o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-gray-600 mb-2",children:"Assigned Classes:"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:Ze.classes.map((De,et)=>o.jsxs("span",{className:"px-3 py-1 bg-blue-500 text-white text-sm font-medium rounded-full",children:["Grade ",De.grade," - Class ",De.class]},et))})]})]}),o.jsx("div",{className:"ml-4",children:o.jsx(rt,{variant:"outline",size:"sm",onClick:()=>Fe(Ze.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 border-red-300",children:o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]})},Le))}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:o.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No subjects assigned yet"}),o.jsx("p",{className:"text-gray-500 mb-6",children:"Get started by adding your teaching subjects and class assignments"}),o.jsxs(rt,{variant:"primary",onClick:I,className:"px-6 py-3",children:[o.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Your First Subject"]})]})]}),j&&o.jsxs("div",{className:`\r
              bg-white rounded-xl shadow-md border border-gray-200 p-6\r
              hover:shadow-lg hover:-translate-y-1 transition-all duration-200\r
            `,children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Select Subjects and Classes"}),o.jsx("p",{className:"text-gray-600",children:"Choose the subjects you want to teach and assign them to specific classes"})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"mb-8",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:o.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:"1"})}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"Select Subject"}),o.jsx("p",{className:"text-gray-600",children:"Choose the subject you want to teach"})]})]}),o.jsxs("div",{className:"relative",children:[o.jsxs(rt,{variant:"outline",onClick:W,className:"w-full justify-between p-4 h-auto text-left border-2 border-gray-200 hover:border-blue-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white rounded-xl shadow-sm",children:[o.jsx("span",{className:"text-gray-900 font-medium",children:E?E.subject:"Select a subject"}),o.jsx("svg",{className:"w-5 h-5 ml-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),R&&o.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-xl max-h-60 overflow-y-auto",children:y.map(Ze=>o.jsx("button",{onClick:()=>Y(Ze.subject_id),className:"w-full px-4 py-4 text-left hover:bg-blue-50 focus:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200 border-b border-gray-100 last:border-b-0",children:o.jsx("span",{className:"text-gray-900 font-medium",children:Ze.subject})},Ze.subject_id))})]})]}),A&&E&&o.jsxs("div",{className:"mb-8",children:[o.jsxs("div",{className:"flex items-center mb-6",children:[o.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3",children:o.jsx("span",{className:"text-green-600 font-semibold text-sm",children:"2"})}),o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Select Classes for ",E.subject]}),o.jsx("p",{className:"text-gray-600",children:"Choose which classes you want to teach this subject to"})]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(Ze=>o.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-2",children:o.jsx("span",{className:"text-white font-bold text-xs",children:Ze})}),o.jsxs("h4",{className:"font-semibold text-gray-900",children:["Grade ",Ze]})]}),o.jsx("div",{className:"space-y-3",children:Me(Ze).map(Le=>o.jsx(rt,{variant:"outline",size:"sm",onClick:()=>X(E,Le),className:"w-full text-sm py-2 px-4 border-green-300 hover:border-green-400 hover:bg-green-100 focus:ring-2 focus:ring-green-500 rounded-lg font-medium",children:Le.displayText},Le.id))})]},Ze))})]}),w.length>0&&o.jsxs("div",{className:"mb-8",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-3",children:o.jsx("span",{className:"text-purple-600 font-semibold text-sm",children:"3"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Selected Subjects"}),o.jsx("p",{className:"text-gray-600",children:"Review your subject and class selections"})]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.map(Ze=>o.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-xl p-4 hover:shadow-md transition-shadow duration-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("div",{className:"flex-1",children:o.jsx("span",{className:"text-sm font-semibold text-purple-900",children:Ze.displayText})}),o.jsx(rt,{variant:"outline",size:"sm",onClick:()=>Fe(Ze.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 border-red-300 focus:ring-2 focus:ring-red-500 rounded-lg",children:o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},Ze.id))})]}),o.jsxs("div",{className:"flex justify-between items-center pt-6 border-t-2 border-gray-100",children:[o.jsx("div",{className:"text-sm text-gray-500",children:w.length>0?`${w.length} subject${w.length>1?"s":""} selected`:"No subjects selected"}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsxs(rt,{variant:"outline",onClick:()=>{P(!1),se(!0),ne()},className:"px-6 py-3 text-sm font-medium text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 focus:ring-2 focus:ring-gray-500 rounded-xl",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Cancel"]}),o.jsxs(rt,{variant:"primary",onClick:()=>_e({type:"save",data:w}),disabled:w.length===0,className:"px-8 py-3 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-indigo-600 border border-transparent rounded-xl hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),A?"Next: Select Classes":"Save Subjects"]})]})]})]})]})]})}),H&&o.jsx(Ko,{isOpen:H,onClose:Pe,title:"Confirm Save",variant:"confirmation",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to save ",Z?.data?.length||0," subject assignments?"]}),o.jsxs("div",{className:"flex justify-end space-x-3",children:[o.jsx(rt,{variant:"outline",onClick:ye,children:"Cancel"}),o.jsx(rt,{variant:"primary",onClick:ce,children:"Save"})]})]})}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:d.map(Ze=>o.jsx(el,{type:Ze.type,message:Ze.message,onClose:()=>f(Le=>Le.filter(De=>De.id!==Ze.id))},Ze.id))})]})},sre=()=>{const{user:e,role:t,isAuthenticated:r,isLoading:n}=Wn(),[s,a]=C.useState("cabinet");return!r||t!=="teacher"?o.jsx(o0,{to:"/login",replace:!0}):n?o.jsxs("div",{className:"teacher-app-loading",children:[o.jsx(Br,{}),o.jsx("p",{children:"Loading teacher interface..."})]}):o.jsx("div",{className:"teacher-app",children:o.jsxs(k2,{children:[o.jsx(ds,{path:"/",element:o.jsx(T3,{})}),o.jsx(ds,{path:"/cabinet",element:o.jsx(T3,{})}),o.jsx(ds,{path:"/tests",element:o.jsx(N3,{})}),o.jsx(ds,{path:"/tests/create",element:o.jsx(N3,{})}),o.jsx(ds,{path:"/data",element:o.jsx(rre,{})}),o.jsx(ds,{path:"/subjects",element:o.jsx(nre,{})}),o.jsx(ds,{path:"/results",element:o.jsx(fP,{})}),o.jsx(ds,{path:"*",element:o.jsx(o0,{to:"/teacher",replace:!0})})]})})},Ae={container:"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100",mainContainer:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",header:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg",headerContent:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",headerFlex:"flex justify-between items-center",adminInfo:"flex items-center space-x-4",adminAvatar:"h-12 w-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",adminText:"text-lg sm:text-xl md:text-2xl font-bold text-white",adminSubtext:"text-purple-100 text-sm sm:text-base md:text-lg",menuContainer:"relative admin-menu",menuButton:"flex items-center space-x-1 sm:space-x-2 bg-white/10 border-white/20 text-white hover:bg-white/20 font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm border-2",menuDropdown:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg z-50 overflow-hidden",menuItem:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-purple-50 transition-colors",menuItemLogout:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-red-50 transition-colors",cardContainer:"bg-white rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300",cardHeader:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-indigo-50",cardTitle:"text-xl font-bold text-gray-800",cardBody:"p-6",buttonGroup:"flex flex-wrap gap-3 mb-6",buttonPrimary:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200",buttonSecondary:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium px-4 py-2 rounded-lg transition-colors duration-200",formContainer:"bg-gray-50 rounded-lg p-6 border border-gray-200",formGrid:"grid grid-cols-1 md:grid-cols-2 gap-4",formGroup:"space-y-2",formLabel:"block text-sm font-medium text-gray-700",formInput:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors duration-200",formCheckbox:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded",formActions:"flex space-x-3 pt-4",table:"min-w-full divide-y divide-gray-200",tableHeader:"bg-gray-50",tableHeaderCell:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",tableBody:"bg-white divide-y divide-gray-200",tableRow:"hover:bg-gray-50 transition-colors duration-150",tableCell:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",statusActive:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",statusInactive:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",modalOverlay:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",modalContent:"bg-white rounded-lg p-6 w-full max-w-md mx-4 shadow-xl",modalTitle:"text-xl font-semibold text-gray-900 mb-4",modalActions:"flex space-x-3 pt-4"},are=()=>{const{user:e,isAdmin:t,logout:r}=Wn(),{get:n,post:s,delete:a}=Ji(),i=C.useCallback(async()=>{try{y({type:"info",message:"Refreshing class summary view..."});const xe=await s("/.netlify/functions/refresh-class-summary-semester",{});xe&&(xe.success||xe.message)?y({type:"success",message:"Class summary view refreshed."}):y({type:"error",message:xe?.error||"Failed to refresh view"})}catch(xe){y({type:"error",message:"Failed to refresh view"}),console.error("Refresh class summary error:",xe)}},[s]),l=C.useCallback(async()=>{try{y({type:"info",message:"Checking for overdue assignments..."});const xe=await s("/.netlify/functions/check-overdue-assignments",{});if(xe&&xe.success){const ht=xe.overdue_count||0;ht>0?y({type:"success",message:`Found and marked ${ht} overdue assignments as inactive.`}):y({type:"info",message:"No overdue assignments found."})}else y({type:"error",message:xe?.error||"Failed to check assignments"})}catch(xe){y({type:"error",message:"Failed to check assignments"}),console.error("Check overdue assignments error:",xe)}},[s]),[c,d]=C.useState(!1),[f,p]=C.useState(null),[g,y]=C.useState(null),[v,w]=C.useState(!1),[b,E]=C.useState(!1),[k,_]=C.useState(!1),[T,j]=C.useState(!1),[P,R]=C.useState(""),[N,A]=C.useState(null),[M,H]=C.useState({}),[Q,Z]=C.useState(null),[ae,te]=C.useState({}),[se,L]=C.useState(null),[G,I]=C.useState({}),[z,V]=C.useState([]),[O,W]=C.useState(""),[q,Y]=C.useState(""),[ee,X]=C.useState(""),[ne,ge]=C.useState(!0),[_e,Pe]=C.useState(!1),[ce,ye]=C.useState([]),[Fe,Me]=C.useState(""),[Oe,He]=C.useState(""),[It,Ze]=C.useState(""),[Le,De]=C.useState(!1),[et,bt]=C.useState(!1),[ut,jt]=C.useState([]),[Rt,Xe]=C.useState([]),[Ye,pt]=C.useState([]),[mt,_t]=C.useState([]),[Ht,Qt]=C.useState(!1),[nr,Nr]=C.useState(!1),[fr,hr]=C.useState(!1),[sr,Er]=C.useState(!1),[he,le]=C.useState({grade:"",class:"",number:"",student_id:"",name:"",surname:"",nickname:"",password:"",is_active:!0}),[pe,be]=C.useState({teacher_id:"",username:"",password:"",first_name:"",last_name:"",is_active:!0}),[Ve,Ct]=C.useState({subject_id:"",subject:"",description:"",is_active:!0}),[Et,Be]=C.useState({startDate:"",endDate:"",teacherId:"",grades:[],classes:[],subjectId:""});C.useEffect(()=>{console.log("🔄 AdminCabinet component mounted - initializing..."),at()},[]),C.useEffect(()=>{const xe=ht=>{Le&&!ht.target.closest(".admin-menu")&&De(!1)};return document.addEventListener("mousedown",xe),()=>{document.removeEventListener("mousedown",xe)}},[Le]);const at=C.useCallback(async()=>{try{d(!0),await wr(),console.log("Admin app initialized")}catch(xe){p("Failed to initialize admin app"),console.error("Admin app initialization error:",xe)}finally{d(!1)}},[]),dt=C.useCallback(()=>{De(xe=>!xe)},[]),zt=C.useCallback(()=>{bt(!0),De(!1)},[]),Yt=C.useCallback(()=>{bt(!1)},[]),wr=C.useCallback(async()=>{try{await Promise.all([Ur(),yr(),ur(),oe()])}catch(xe){console.error("Error loading admin data:",xe),p("Failed to load admin data")}},[]),Ur=C.useCallback(async()=>{try{const xe="admin_users_",ht=Jn(xe);if(ht){console.log("📊 Using cached users data"),jt(ht);return}const Ee=await n("/.netlify/functions/get-all-users");console.log("📊 Users response:",Ee);const tt=Ee.users||[];jt(tt),Qn(xe,tt,hs.admin_users),console.log("👥 Users set to state:",tt)}catch(xe){console.error("Error loading users:",xe)}},[n]),yr=C.useCallback(async()=>{try{const xe="admin_teachers_",ht=Jn(xe);if(ht){console.log("📊 Using cached teachers data"),Xe(ht);return}const Ee=await n("/.netlify/functions/get-all-teachers");console.log("📊 Teachers response:",Ee);const tt=Ee.teachers||[];Xe(tt),Qn(xe,tt,hs.admin_teachers),console.log("👨‍🏫 Teachers set to state:",tt)}catch(xe){console.error("Error loading teachers:",xe)}},[n]),ur=C.useCallback(async()=>{try{const xe="admin_subjects_",ht=Jn(xe);if(ht){console.log("📊 Using cached subjects data"),pt(ht);return}const Ee=await n("/.netlify/functions/get-all-subjects");console.log("📊 Subjects response:",Ee);const tt=Ee.subjects||[];pt(tt),Qn(xe,tt,hs.admin_subjects),console.log("📚 Subjects set to state:",tt)}catch(xe){console.error("Error loading subjects:",xe)}},[n]),oe=C.useCallback(async()=>{try{const xe="admin_academic_years_",ht=Jn(xe);if(ht){console.log("📊 Using cached academic years data"),_t(ht);return}const tt=(await n("/.netlify/functions/get-academic-year")).academic_years||[];_t(tt),Qn(xe,tt,hs.admin_academic_years)}catch(xe){console.error("Error loading academic year:",xe)}},[n]),we=C.useCallback(async()=>{try{if(j(!T),!T){const[xe,ht]=await Promise.all([n("/.netlify/functions/get-all-tests"),n("/.netlify/functions/get-test-assignments")]);console.log("📊 Active tests response:",xe),console.log("📊 Assignments response:",ht);const Ee=xe.tests||[],St=(ht.assignments||[]).reduce((Ke,Mt)=>{const it=`${Mt.test_type}-${Mt.test_id}`;return Ke[it]||(Ke[it]=[]),Ke[it].push(Mt),Ke},{}),je=Ee.map(Ke=>{const Mt=`${Ke.test_type}-${Ke.test_id}`,it=St[Mt]||[],_r=it.some(Ut=>Ut.is_active);return{...Ke,is_active:_r,assignments:it}});V(je),console.log("🧪 All tests with status set to state:",je)}}catch(xe){console.error("Error loading tests:",xe),y({type:"error",message:"Failed to load tests"})}},[n,T]),fe=C.useCallback((xe,ht)=>{le(Ee=>({...Ee,[xe]:ht}))},[]),me=C.useCallback((xe,ht)=>{be(Ee=>({...Ee,[xe]:ht}))},[]),Se=C.useCallback((xe,ht)=>{Ct(Ee=>({...Ee,[xe]:ht}))},[]);C.useCallback(()=>{console.log("🧪 Testing local storage...");try{const xe={test:"data",timestamp:Date.now()};localStorage.setItem("test",JSON.stringify(xe));const ht=JSON.parse(localStorage.getItem("test"));console.log("✅ Local storage test successful:",ht),y({type:"success",message:"Local storage test successful"})}catch(xe){console.error("❌ Local storage test failed:",xe),y({type:"error",message:"Local storage test failed"})}},[]),C.useCallback(()=>{console.log("🧹 Clearing local storage...");try{localStorage.clear(),console.log("✅ Local storage cleared"),y({type:"success",message:"Local storage cleared"})}catch(xe){console.error("❌ Error clearing local storage:",xe),y({type:"error",message:"Error clearing local storage"})}},[]),C.useCallback(async()=>{console.log("👨‍🏫 Checking teacher subjects...");try{const ht=(await n("/.netlify/functions/get-all-teachers")).data||[];console.log("📊 Teachers data:",ht),y({type:"success",message:`Found ${ht.length} teachers`})}catch(xe){console.error("❌ Error checking teacher subjects:",xe),y({type:"error",message:"Error checking teacher subjects"})}},[n]);const ke=C.useCallback(async xe=>{xe.preventDefault();try{console.log("👤 Submitting user:",he);const ht=await s("/.netlify/functions/add-user",he);ht.success?(y({type:"success",message:"User added successfully"}),Qt(!1),le({grade:"",class:"",number:"",student_id:"",name:"",surname:"",nickname:"",password:"",is_active:!0}),Ur()):y({type:"error",message:ht.message||"Failed to add user"})}catch(ht){console.error("❌ Error adding user:",ht),y({type:"error",message:"Error adding user"})}},[he,s,Ur]),We=C.useCallback(async xe=>{xe.preventDefault();try{console.log("👨‍🏫 Submitting teacher:",pe);const ht=await s("/.netlify/functions/add-teacher",pe);ht.success?(y({type:"success",message:"Teacher added successfully"}),Nr(!1),be({teacher_id:"",username:"",password:"",first_name:"",last_name:"",is_active:!0}),yr()):y({type:"error",message:ht.message||"Failed to add teacher"})}catch(ht){console.error("❌ Error adding teacher:",ht),y({type:"error",message:"Error adding teacher"})}},[pe,s,yr]),ft=C.useCallback(async xe=>{xe.preventDefault();try{console.log("📚 Submitting subject:",Ve);const ht=await s("/.netlify/functions/add-subject",Ve);ht.success?(y({type:"success",message:"Subject added successfully"}),hr(!1),Ct({subject_id:"",subject:"",description:"",is_active:!0}),ur()):y({type:"error",message:ht.message||"Failed to add subject"})}catch(ht){console.error("❌ Error adding subject:",ht),y({type:"error",message:"Error adding subject"})}},[Ve,s,ur]),Re=C.useCallback(xe=>{A(xe),H({name:xe.name||"",surname:xe.surname||"",grade:xe.grade||"",class:xe.class||"",student_id:xe.student_id||"",nickname:xe.nickname||"",password:xe.password||"",is_active:xe.is_active!==void 0?xe.is_active:!0})},[]),ie=C.useCallback(async()=>{try{const xe=[];Object.keys(M).forEach(ht=>{ht!=="student_id"&&M[ht]!==N[ht]&&xe.push({fieldName:ht,newValue:M[ht]})});for(const ht of xe)await s("/.netlify/functions/update-user",{userId:N.student_id,fieldName:ht.fieldName,newValue:ht.newValue});y({type:"success",message:"User updated successfully!"}),A(null),H({}),Ur()}catch{y({type:"error",message:"Failed to update user"})}},[M,N,s,Ur]),de=C.useCallback(async xe=>{if(window.confirm("Are you sure you want to delete this user?"))try{(await s("/.netlify/functions/delete-user",{userId:xe})).success&&(y({type:"success",message:"User deleted successfully!"}),Ur())}catch{y({type:"error",message:"Failed to delete user"})}},[s,Ur]),Ce=C.useCallback(xe=>{Z(xe),te({teacher_id:xe.teacher_id||"",username:xe.username||"",password:xe.password||"",first_name:xe.first_name||"",last_name:xe.last_name||"",is_active:xe.is_active!==void 0?xe.is_active:!0})},[]),Ne=C.useCallback(async()=>{try{const xe=[];Object.keys(ae).forEach(ht=>{ht!=="teacher_id"&&ae[ht]!==Q[ht]&&xe.push({fieldName:ht,newValue:ae[ht]})});for(const ht of xe)await s("/.netlify/functions/update-teacher",{teacherId:Q.teacher_id,fieldName:ht.fieldName,newValue:ht.newValue});y({type:"success",message:"Teacher updated successfully!"}),Z(null),te({}),yr()}catch{y({type:"error",message:"Failed to update teacher"})}},[ae,Q,s,yr]),Ge=C.useCallback(async xe=>{if(window.confirm("Are you sure you want to delete this teacher?"))try{(await s("/.netlify/functions/delete-teacher",{teacherId:xe})).success&&(y({type:"success",message:"Teacher deleted successfully!"}),yr())}catch{y({type:"error",message:"Failed to delete teacher"})}},[s,yr]),Je=C.useCallback(xe=>{L(xe),I({subject_id:xe.subject_id||"",subject:xe.subject||""})},[]),yt=C.useCallback(async()=>{try{const xe=[];Object.keys(G).forEach(ht=>{ht!=="subject_id"&&G[ht]!==se[ht]&&xe.push({fieldName:ht,newValue:G[ht]})});for(const ht of xe)await s("/.netlify/functions/update-subject",{subjectId:se.subject_id,fieldName:ht.fieldName,newValue:ht.newValue});y({type:"success",message:"Subject updated successfully!"}),L(null),I({}),ur()}catch{y({type:"error",message:"Failed to update subject"})}},[G,se,s,ur]),Vt=C.useCallback(async xe=>{if(window.confirm("Are you sure you want to delete this subject?"))try{const ht=await s("/.netlify/functions/delete-subject",{subjectId:xe});ht.success?(y({type:"success",message:"Subject deleted successfully!"}),ur()):y({type:"error",message:ht.message||"Failed to delete subject"})}catch{y({type:"error",message:"Failed to delete subject"})}},[s,ur]),gt=C.useCallback((xe,ht)=>{Be(Ee=>({...Ee,[xe]:ht}))},[]),Ot=C.useCallback(async xe=>{if(xe.preventDefault(),!Et.startDate||!Et.endDate||!Et.teacherId){y({type:"error",message:"Please fill in all required fields (Start Date, End Date, Teacher ID)"});return}if(window.confirm("Are you sure you want to delete all test data for the selected criteria? This action cannot be undone."))try{const ht=await s("/.netlify/functions/delete-test-data",Et);ht.success?(y({type:"success",message:`Successfully deleted ${ht.deletedCount} test records!`}),Er(!1),Be({startDate:"",endDate:"",teacherId:"",grades:[],classes:[],subjectId:""})):y({type:"error",message:ht.message||"Failed to delete test data"})}catch{y({type:"error",message:"Failed to delete test data"})}},[Et,s]),vr=C.useCallback(async(xe,ht,Ee)=>{try{const tt=await n("/.netlify/functions/get-test-assignments");if(tt.success&&tt.assignments){const St=tt.assignments.filter(je=>je.test_id===parseInt(xe)&&je.test_type===ht);if(St.length===0){y({type:"error",message:"No assignments found for this test"});return}for(const je of St){const Ke=await s("/.netlify/functions/remove-assignment",{teacher_id:Ee,assignment_id:je.assignment_id,test_type:ht,test_id:xe});if(!Ke.success){y({type:"error",message:`Failed to complete test: ${Ke.message}`});return}}y({type:"success",message:"Test marked as complete successfully!"}),await we()}else y({type:"error",message:"Failed to get test assignments"})}catch(tt){console.error("Error completing test:",tt),y({type:"error",message:"Failed to complete test"})}},[s,n,we]),kr=C.useCallback(async(xe,ht,Ee)=>{try{const tt=await n("/.netlify/functions/get-test-assignments");if(tt.success&&tt.assignments){const St=tt.assignments.filter(je=>je.test_id===parseInt(xe)&&je.test_type===ht);if(St.length===0){y({type:"error",message:"No assignments found for this test"});return}for(const je of St){const Ke=await s("/.netlify/functions/remove-assignment",{teacher_id:Ee,assignment_id:je.assignment_id,test_type:ht,test_id:xe,mark_active:!0});if(!Ke.success){y({type:"error",message:`Failed to reactivate test: ${Ke.message}`});return}}y({type:"success",message:"Test marked as active successfully!"}),await we()}else y({type:"error",message:"Failed to get test assignments"})}catch(tt){console.error("Error reactivating test:",tt),y({type:"error",message:"Failed to reactivate test"})}},[s,n,we]),Pr=C.useCallback(async()=>{try{if(Pe(!_e),!_e){const xe=await n("/.netlify/functions/get-all-tests");console.log("📊 Actual tests response:",xe),ye(xe.tests||[]),console.log("🧪 Actual tests set to state:",xe.tests||[])}}catch(xe){console.error("Error loading actual tests:",xe),y({type:"error",message:"Failed to load tests"})}},[n,_e]),hn=C.useCallback(async(xe,ht,Ee)=>{try{const tt=await s("/.netlify/functions/delete-test",{test_id:xe,test_type:ht,teacher_id:Ee});tt.success?(y({type:"success",message:"Test deleted successfully!"}),await Pr()):y({type:"error",message:`Failed to delete test: ${tt.message}`})}catch(tt){console.error("Error deleting test:",tt),y({type:"error",message:"Failed to delete test"})}},[s,Pr]),Kr=P?ut.filter(xe=>xe.grade.toString()===P):ut,$r=z.filter(xe=>{const ht=!O||xe.teacher_id===O,Ee=!q||new Date(xe.created_at)>=new Date(q),tt=!ee||new Date(xe.created_at)<=new Date(ee+"T23:59:59"),St=ne?xe.is_active:!xe.is_active;return ht&&Ee&&tt&&St}),or=ce.filter(xe=>{const ht=!Fe||xe.teacher_id===Fe,Ee=!Oe||new Date(xe.created_at)>=new Date(Oe),tt=!It||new Date(xe.created_at)<=new Date(It+"T23:59:59");return ht&&Ee&&tt});return o.jsxs(Qe.div,{id:"admin-cabinet-main",className:Ae.container,initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[o.jsx(Qe.div,{className:Ae.header,initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},children:o.jsx("div",{className:Ae.headerContent,children:o.jsxs("div",{className:Ae.headerFlex,children:[o.jsxs(Qe.div,{className:Ae.adminInfo,initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(Qe.div,{className:Ae.adminAvatar,initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.3,type:"spring"},whileHover:{scale:1.1},children:o.jsx("span",{className:"text-white font-semibold text-xl",children:e?.username?.charAt(0)||"A"})})}),o.jsxs("div",{children:[o.jsx("h1",{className:Ae.adminText,children:e?.username||"Administrator"}),o.jsx("p",{className:Ae.adminSubtext,children:"Administrator Dashboard"})]})]}),o.jsxs(Qe.div,{className:Ae.menuContainer,initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3,duration:.5},children:[o.jsxs("button",{onClick:dt,className:Ae.menuButton,style:{zIndex:1e3},children:[o.jsx("span",{className:"hidden sm:inline",children:"Menu"}),o.jsx(Qe.svg,{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:{rotate:Le?180:0},transition:{duration:.2},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]}),o.jsx(ji,{children:Le&&o.jsx(Qe.div,{className:Ae.menuDropdown,initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},children:o.jsxs("div",{className:"py-2",children:[o.jsx(Qe.button,{onClick:zt,className:Ae.menuItem,whileHover:{x:4},transition:{duration:.2},children:"Change Password"}),o.jsx(Qe.button,{onClick:()=>{dt(),r()},className:Ae.menuItemLogout,whileHover:{x:4},transition:{duration:.2},children:"Logout"})]})})})]})]})})}),c&&o.jsx(Br,{text:"Loading..."}),f&&o.jsx(el,{type:"error",message:f,onClose:()=>p(null)}),g&&o.jsx(el,{type:g.type,message:g.message,onClose:()=>y(null)}),et&&o.jsx("div",{className:Ae.modalOverlay,children:o.jsxs("div",{className:Ae.modalContent,children:[o.jsx("h2",{className:Ae.modalTitle,children:"Change Password"}),o.jsxs("form",{className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{htmlFor:"currentPassword",className:Ae.formLabel,children:"Current Password"}),o.jsx("input",{type:"password",id:"currentPassword",className:Ae.formInput})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{htmlFor:"newPassword",className:Ae.formLabel,children:"New Password"}),o.jsx("input",{type:"password",id:"newPassword",className:Ae.formInput})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{htmlFor:"confirmPassword",className:Ae.formLabel,children:"Confirm New Password"}),o.jsx("input",{type:"password",id:"confirmPassword",className:Ae.formInput})]}),o.jsxs("div",{className:Ae.modalActions,children:[o.jsx(rt,{type:"button",variant:"secondary",onClick:Yt,className:"flex-1",children:"Cancel"}),o.jsx(rt,{type:"submit",variant:"primary",className:"flex-1 bg-purple-600 hover:bg-purple-700",children:"Change Password"})]})]})]})}),o.jsx(Qe.div,{className:Ae.mainContainer,initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.5},children:o.jsxs("div",{className:"space-y-6",children:[o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"User Management"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsxs("div",{className:Ae.buttonGroup,children:[o.jsx(rt,{variant:"primary",onClick:()=>Qt(!0),className:Ae.buttonPrimary,children:"Add User"}),o.jsx(rt,{variant:"secondary",onClick:()=>{Ur(),w(!v)},className:Ae.buttonSecondary,children:v?"Hide Users Table":"Get All Users ▶"})]}),o.jsx(ji,{children:Ht&&o.jsxs(Qe.div,{className:Ae.formContainer,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Add New User"}),o.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGrid,children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Grade"}),o.jsx("input",{type:"text",value:he.grade,onChange:xe=>fe("grade",xe.target.value),className:Ae.formInput,placeholder:"Enter grade"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Class"}),o.jsx("input",{type:"text",value:he.class,onChange:xe=>fe("class",xe.target.value),className:Ae.formInput,placeholder:"Enter class"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Number"}),o.jsx("input",{type:"text",value:he.number,onChange:xe=>fe("number",xe.target.value),className:Ae.formInput,placeholder:"Enter number"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Student ID"}),o.jsx("input",{type:"text",value:he.student_id,onChange:xe=>fe("student_id",xe.target.value),className:Ae.formInput,placeholder:"Enter student ID"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Name"}),o.jsx("input",{type:"text",value:he.name,onChange:xe=>fe("name",xe.target.value),className:Ae.formInput,placeholder:"Enter name"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Surname"}),o.jsx("input",{type:"text",value:he.surname,onChange:xe=>fe("surname",xe.target.value),className:Ae.formInput,placeholder:"Enter surname"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Nickname"}),o.jsx("input",{type:"text",value:he.nickname,onChange:xe=>fe("nickname",xe.target.value),className:Ae.formInput,placeholder:"Enter nickname"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Password"}),o.jsx("input",{type:"password",value:he.password,onChange:xe=>fe("password",xe.target.value),className:Ae.formInput,placeholder:"Enter password"})]})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"userActive",checked:he.is_active,onChange:xe=>fe("is_active",xe.target.checked),className:Ae.formCheckbox}),o.jsx("label",{htmlFor:"userActive",className:"ml-2 text-sm text-gray-700",children:"Active"})]}),o.jsxs("div",{className:Ae.formActions,children:[o.jsx(rt,{type:"button",variant:"secondary",onClick:()=>Qt(!1),className:Ae.buttonSecondary,children:"Cancel"}),o.jsx(rt,{type:"submit",variant:"primary",className:Ae.buttonPrimary,children:"Add User"})]})]})]})}),v&&o.jsxs("div",{className:"mt-6",children:[o.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:["All Users (",Kr.length," of ",ut.length,")"]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Filter by Grade:"}),o.jsxs("select",{value:P,onChange:xe=>R(xe.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[o.jsx("option",{value:"",children:"All Grades"}),[...new Set(ut.map(xe=>xe.grade))].sort().map(xe=>o.jsxs("option",{value:xe,children:["Grade ",xe]},xe))]})]})]}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Grade"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Class"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Student ID"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Number"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Nickname"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:Kr.map((xe,ht)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsxs("td",{className:Ae.tableCell,children:[xe.name," ",xe.surname]}),o.jsx("td",{className:Ae.tableCell,children:xe.grade}),o.jsx("td",{className:Ae.tableCell,children:xe.class}),o.jsx("td",{className:Ae.tableCell,children:xe.student_id}),o.jsx("td",{className:Ae.tableCell,children:xe.number}),o.jsx("td",{className:Ae.tableCell,children:xe.nickname}),o.jsx("td",{className:Ae.tableCell,children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>Re(xe),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),o.jsx("button",{onClick:()=>de(xe.student_id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Delete"})]})})]},xe.id||ht))})]})})})]})]})]})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsxs(kt.Header,{className:Ae.cardHeader,children:[o.jsx(kt.Title,{className:Ae.cardTitle,children:"Teacher Management"}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-xs whitespace-nowrap",title:"Refresh materialized class summary view",children:"Refresh Class Summary View"}),o.jsx("button",{onClick:l,className:"px-3 py-1.5 bg-orange-600 text-white rounded hover:bg-orange-700 transition-colors text-xs whitespace-nowrap",title:"Check and mark overdue assignments (7+ days old) as inactive",children:"Check Overdue Assignments"}),o.jsx(rt,{variant:"primary",onClick:()=>Nr(!0),className:"text-xs whitespace-nowrap",children:"Add Teacher"}),o.jsx(rt,{variant:"secondary",onClick:()=>{yr(),E(!b)},className:"text-xs whitespace-nowrap",children:b?"Hide Teachers Table":"Get All Teachers ▶"})]})]}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsx(ji,{children:nr&&o.jsxs(Qe.div,{className:Ae.formContainer,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Add New Teacher"}),o.jsxs("form",{onSubmit:We,className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGrid,children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Teacher ID"}),o.jsx("input",{type:"text",value:pe.teacher_id,onChange:xe=>me("teacher_id",xe.target.value),className:Ae.formInput,placeholder:"Enter teacher ID"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Username"}),o.jsx("input",{type:"text",value:pe.username,onChange:xe=>me("username",xe.target.value),className:Ae.formInput,placeholder:"Enter username"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Password"}),o.jsx("input",{type:"password",value:pe.password,onChange:xe=>me("password",xe.target.value),className:Ae.formInput,placeholder:"Enter password"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"First Name"}),o.jsx("input",{type:"text",value:pe.first_name,onChange:xe=>me("first_name",xe.target.value),className:Ae.formInput,placeholder:"Enter first name"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Last Name"}),o.jsx("input",{type:"text",value:pe.last_name,onChange:xe=>me("last_name",xe.target.value),className:Ae.formInput,placeholder:"Enter last name"})]})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"teacherActive",checked:pe.is_active,onChange:xe=>me("is_active",xe.target.checked),className:Ae.formCheckbox}),o.jsx("label",{htmlFor:"teacherActive",className:"ml-2 text-sm text-gray-700",children:"Active"})]}),o.jsxs("div",{className:Ae.formActions,children:[o.jsx(rt,{type:"button",variant:"secondary",onClick:()=>Nr(!1),className:Ae.buttonSecondary,children:"Cancel"}),o.jsx(rt,{type:"submit",variant:"primary",className:Ae.buttonPrimary,children:"Add Teacher"})]})]})]})}),N&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Edit User"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),o.jsx("input",{type:"text",value:M.name,onChange:xe=>H({...M,name:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Surname"}),o.jsx("input",{type:"text",value:M.surname,onChange:xe=>H({...M,surname:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Grade"}),o.jsx("input",{type:"number",value:M.grade,onChange:xe=>H({...M,grade:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class"}),o.jsx("input",{type:"number",value:M.class,onChange:xe=>H({...M,class:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student ID"}),o.jsx("input",{type:"text",value:M.student_id,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500 cursor-not-allowed"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Student ID cannot be changed"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nickname"}),o.jsx("input",{type:"text",value:M.nickname,onChange:xe=>H({...M,nickname:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),o.jsx("input",{type:"text",value:M.password,onChange:xe=>H({...M,password:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"is_active",checked:M.is_active,onChange:xe=>H({...M,is_active:xe.target.checked}),className:"h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),o.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm font-medium text-gray-700",children:"Active"})]})]}),o.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[o.jsx("button",{onClick:()=>{A(null),H({})},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),o.jsx("button",{onClick:ie,className:"px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-md hover:bg-purple-700",children:"Update User"})]})]})}),b&&o.jsxs("div",{className:"mt-6",children:[o.jsx("div",{className:"mb-4",children:o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:["All Teachers (",Rt.length,")"]})}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-96",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Teacher ID"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Username"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Password"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Status"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Created"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:Rt.map((xe,ht)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsx("td",{className:Ae.tableCell,children:xe.teacher_id}),o.jsxs("td",{className:Ae.tableCell,children:[xe.first_name," ",xe.last_name]}),o.jsx("td",{className:Ae.tableCell,children:xe.username}),o.jsx("td",{className:Ae.tableCell,children:xe.password}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("span",{className:xe.is_active?Ae.statusActive:Ae.statusInactive,children:xe.is_active?"Active":"Inactive"})}),o.jsx("td",{className:Ae.tableCell,children:new Date(xe.created_at).toLocaleDateString()}),o.jsx("td",{className:Ae.tableCell,children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>Ce(xe),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),o.jsx("button",{onClick:()=>Ge(xe.teacher_id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Delete"})]})})]},xe.teacher_id||ht))})]})})})]})]})]})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Subject Management"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsxs("div",{className:Ae.buttonGroup,children:[o.jsx(rt,{variant:"primary",onClick:()=>hr(!0),className:Ae.buttonPrimary,children:"Add Subject"}),o.jsx(rt,{variant:"secondary",onClick:()=>{ur(),_(!k)},className:Ae.buttonSecondary,children:k?"Hide Subjects Table":"Get All Subjects ▶"})]}),o.jsx(ji,{children:fr&&o.jsxs(Qe.div,{className:Ae.formContainer,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Add New Subject"}),o.jsxs("form",{onSubmit:ft,className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Subject Name"}),o.jsx("input",{type:"text",value:Ve.subject,onChange:xe=>Se("subject",xe.target.value),className:Ae.formInput,placeholder:"Enter subject name",required:!0}),o.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Subject ID will be automatically generated"})]}),o.jsxs("div",{className:Ae.formActions,children:[o.jsx(rt,{type:"button",variant:"secondary",onClick:()=>hr(!1),className:Ae.buttonSecondary,children:"Cancel"}),o.jsx(rt,{type:"submit",variant:"primary",className:Ae.buttonPrimary,children:"Add Subject"})]})]})]})}),Q&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Edit Teacher"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teacher ID"}),o.jsx("input",{type:"text",value:ae.teacher_id,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500 cursor-not-allowed"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Teacher ID cannot be changed"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),o.jsx("input",{type:"text",value:ae.username,onChange:xe=>te({...ae,username:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),o.jsx("input",{type:"text",value:ae.password,onChange:xe=>te({...ae,password:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),o.jsx("input",{type:"text",value:ae.first_name,onChange:xe=>te({...ae,first_name:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),o.jsx("input",{type:"text",value:ae.last_name,onChange:xe=>te({...ae,last_name:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"teacher_is_active",checked:ae.is_active,onChange:xe=>te({...ae,is_active:xe.target.checked}),className:"h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),o.jsx("label",{htmlFor:"teacher_is_active",className:"ml-2 text-sm font-medium text-gray-700",children:"Active"})]})]}),o.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[o.jsx("button",{onClick:()=>{Z(null),te({})},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),o.jsx("button",{onClick:Ne,className:"px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-md hover:bg-purple-700",children:"Update Teacher"})]})]})}),se&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Edit Subject"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject ID"}),o.jsx("input",{type:"text",value:G.subject_id,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500 cursor-not-allowed"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Subject ID cannot be changed"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject Name"}),o.jsx("input",{type:"text",value:G.subject,onChange:xe=>I({...G,subject:xe.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]})]}),o.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[o.jsx("button",{onClick:()=>L(null),className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),o.jsx("button",{onClick:yt,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:"Update Subject"})]})]})}),k&&o.jsxs("div",{className:"mt-6",children:[o.jsx("div",{className:"mb-4",children:o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:["All Subjects (",Ye.length,")"]})}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-96",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Subject ID"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Subject Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:Ye.map((xe,ht)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsx("td",{className:Ae.tableCell,children:xe.subject_id}),o.jsx("td",{className:Ae.tableCell,children:xe.subject}),o.jsx("td",{className:Ae.tableCell,children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>Je(xe),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),o.jsx("button",{onClick:()=>Vt(xe.subject_id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Delete"})]})})]},xe.subject_id||ht))})]})})})]})]})]})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Test Data Deletion"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsx("div",{className:Ae.buttonGroup,children:o.jsx(rt,{variant:"danger",onClick:()=>Er(!0),className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 shadow-md",children:"Delete Test Data"})}),o.jsx(ji,{children:sr&&o.jsxs(Qe.div,{className:Ae.formContainer,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Delete Test Data by Date Range"}),o.jsxs("form",{onSubmit:Ot,className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGrid,children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Start Date *"}),o.jsx("input",{type:"date",value:Et.startDate,onChange:xe=>gt("startDate",xe.target.value),className:Ae.formInput,required:!0})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"End Date *"}),o.jsx("input",{type:"date",value:Et.endDate,onChange:xe=>gt("endDate",xe.target.value),className:Ae.formInput,required:!0})]})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Teacher ID *"}),o.jsxs("select",{value:Et.teacherId,onChange:xe=>gt("teacherId",xe.target.value),className:Ae.formInput,required:!0,children:[o.jsx("option",{value:"",children:"Select a teacher"}),Rt.map(xe=>o.jsxs("option",{value:xe.teacher_id,children:[xe.teacher_id," - ",xe.first_name," ",xe.last_name]},xe.teacher_id))]})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Subject (Optional)"}),o.jsxs("select",{value:Et.subjectId,onChange:xe=>gt("subjectId",xe.target.value),className:Ae.formInput,children:[o.jsx("option",{value:"",children:"All subjects"}),Ye.map(xe=>o.jsx("option",{value:xe.subject_id,children:xe.subject},xe.subject_id))]})]}),o.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:o.jsxs("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),o.jsxs("div",{className:"ml-3",children:[o.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Warning: This action cannot be undone"}),o.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[o.jsx("p",{children:"This will permanently delete:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"All test records within the date range"}),o.jsx("li",{children:"All test questions and answers"}),o.jsx("li",{children:"All test results and submissions"}),o.jsx("li",{children:"All test assignments"}),o.jsx("li",{children:"Associated Cloudinary images (for matching tests)"})]})]})]})]})}),o.jsxs("div",{className:Ae.formActions,children:[o.jsx(rt,{type:"button",variant:"secondary",onClick:()=>Er(!1),className:Ae.buttonSecondary,children:"Cancel"}),o.jsx(rt,{type:"submit",variant:"danger",className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 shadow-md",children:"Delete Test Data"})]})]})]})})]})]})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.85,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Assignments Management"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsx("div",{className:"mb-4",children:o.jsx(rt,{variant:"primary",onClick:we,className:Ae.buttonPrimary,children:T?"Hide Assignments Table":"Get All Assignments ▶"})}),T&&o.jsx("div",{className:"mb-6",children:o.jsx("div",{className:"border-b border-gray-200",children:o.jsxs("nav",{className:"-mb-px flex space-x-8",children:[o.jsx("button",{onClick:()=>ge(!0),className:`py-2 px-1 border-b-2 font-medium text-sm ${ne?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Active Assignments"}),o.jsx("button",{onClick:()=>ge(!1),className:`py-2 px-1 border-b-2 font-medium text-sm ${ne?"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":"border-purple-500 text-purple-600"}`,children:"Inactive Assignments"})]})})}),T&&o.jsxs("div",{className:"mt-6",children:[o.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:[ne?"Active":"Inactive"," Assignments (",$r.length," of ",z.filter(xe=>ne?xe.is_active:!xe.is_active).length,")"]}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsxs("select",{value:O,onChange:xe=>W(xe.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[o.jsx("option",{value:"",children:"All Teachers"}),Rt.map(xe=>o.jsxs("option",{value:xe.teacher_id,children:[xe.first_name," ",xe.last_name]},xe.teacher_id))]}),o.jsx("input",{type:"date",value:q,onChange:xe=>Y(xe.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Start Date"}),o.jsx("input",{type:"date",value:ee,onChange:xe=>X(xe.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"End Date"})]})]}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-96",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Test Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Type"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Teacher"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Questions"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Created"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:$r.map((xe,ht)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsx("td",{className:Ae.tableCell,children:xe.test_name}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:xe.test_type.replace("_"," ").toUpperCase()})}),o.jsx("td",{className:Ae.tableCell,children:xe.teacher_name}),o.jsx("td",{className:Ae.tableCell,children:xe.num_questions}),o.jsx("td",{className:Ae.tableCell,children:new Date(xe.created_at).toLocaleDateString()}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("div",{className:"flex space-x-2",children:ne?o.jsx("button",{onClick:()=>vr(xe.test_id,xe.test_type,xe.teacher_id),className:"text-sm font-medium px-3 py-1 rounded bg-orange-100 text-orange-700 hover:bg-orange-200",children:"Mark Complete"}):o.jsx("button",{onClick:()=>kr(xe.test_id,xe.test_type,xe.teacher_id),className:"text-sm font-medium px-3 py-1 rounded bg-green-100 text-green-700 hover:bg-green-200",children:"Mark Active"})})})]},`${xe.test_type}-${xe.test_id}-${ht}`))})]})})})]})]})]})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Test Management"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsx("div",{className:"mb-4",children:o.jsx(rt,{variant:"primary",onClick:Pr,className:Ae.buttonPrimary,children:_e?"Hide Tests Table":"Get All Tests ▶"})}),_e&&o.jsxs("div",{className:"mt-6",children:[o.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:["All Tests (",or.length," of ",ce.length,")"]}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsxs("select",{value:Fe,onChange:xe=>Me(xe.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[o.jsx("option",{value:"",children:"All Teachers"}),Rt.map(xe=>o.jsxs("option",{value:xe.teacher_id,children:[xe.first_name," ",xe.last_name]},xe.teacher_id))]}),o.jsx("input",{type:"date",value:Oe,onChange:xe=>He(xe.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Start Date"}),o.jsx("input",{type:"date",value:It,onChange:xe=>Ze(xe.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"End Date"})]})]}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-96",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Test Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Type"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Teacher"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Questions"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Created"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:or.map((xe,ht)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsx("td",{className:Ae.tableCell,children:xe.test_name}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:xe.test_type.replace("_"," ").toUpperCase()})}),o.jsx("td",{className:Ae.tableCell,children:xe.teacher_name}),o.jsx("td",{className:Ae.tableCell,children:xe.num_questions}),o.jsx("td",{className:Ae.tableCell,children:new Date(xe.created_at).toLocaleDateString()}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{onClick:()=>hn(xe.test_id,xe.test_type,xe.teacher_id),className:"text-sm font-medium px-3 py-1 rounded bg-red-100 text-red-700 hover:bg-red-200",children:"Delete Test"})})})]},`${xe.test_type}-${xe.test_id}-${ht}`))})]})})})]})]})]})}),o.jsx(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Debug & Testing"})}),o.jsx(kt.Body,{className:Ae.cardBody})]})})]})})]})},ire=()=>{const{isAdmin:e,getCurrentAdminId:t,logout:r}=Wn(),{get:n}=Ji(),{showNotification:s}=da();C.useEffect(()=>{a()},[]);const a=C.useCallback(async()=>{if(console.log("👨‍💼 Initializing Admin Application..."),!e()){console.error("❌ User is not an admin, redirecting to login"),s("Access Denied: You are not an administrator.","error"),r();return}try{i(),await l(),c(),d(),console.log("✅ Admin Application initialized successfully"),s("Admin dashboard loaded successfully","success")}catch(f){console.error("❌ Error initializing admin app:",f),s("Failed to initialize admin dashboard","error")}},[e,t,r,s,n]),i=C.useCallback(()=>{console.log("🔧 Initializing global event listeners...");const f=p=>{p.ctrlKey&&p.key==="k"&&(p.preventDefault(),console.log("Admin search shortcut triggered"))};return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[]),l=C.useCallback(async()=>{try{console.log("📊 Loading admin data...");const[f,p,g,y]=await Promise.allSettled([n("/.netlify/functions/get-all-users"),n("/.netlify/functions/get-all-teachers"),n("/.netlify/functions/get-all-subjects"),n("/.netlify/functions/get-academic-year")]);f.status==="fulfilled"&&f.value?.success&&console.log("✅ Users loaded:",f.value.users?.length||0),p.status==="fulfilled"&&p.value?.success&&console.log("✅ Teachers loaded:",p.value.teachers?.length||0),g.status==="fulfilled"&&g.value?.success&&console.log("✅ Subjects loaded:",g.value.subjects?.length||0),y.status==="fulfilled"&&y.value?.success&&console.log("✅ Academic years loaded:",y.value.academic_years?.length||0),console.log("✅ Admin data loading completed")}catch(f){throw console.error("❌ Error loading admin data:",f),f}},[n]),c=C.useCallback(()=>{console.log("🗑️ Initializing test deletion functionality..."),console.log("✅ Test deletion functionality initialized")},[]),d=C.useCallback(()=>{console.log("🌐 Exposing admin functions globally..."),window.toggleSubjectsContent=()=>{const p=document.getElementById("allSubjectsContainer"),g=document.querySelector('button[onclick="toggleSubjectsContent()"]');if(!p){console.error("❌ allSubjectsContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Subjects":"Hide Subjects"},window.showAddSubjectForm=()=>{const p=document.getElementById("addSubjectForm");p&&(p.style.display="block")},window.hideAddSubjectForm=()=>{const p=document.getElementById("addSubjectForm"),g=document.getElementById("newSubjectForm");p&&(p.style.display="none"),g&&g.reset()},window.showAddAcademicYearForm=()=>{const p=document.getElementById("addAcademicYearForm");p&&(p.style.display="block")},window.hideAddAcademicYearForm=()=>{const p=document.getElementById("addAcademicYearForm"),g=document.getElementById("newAcademicYearForm");p&&(p.style.display="none"),g&&g.reset()},window.toggleUsersContent=()=>{const p=document.getElementById("allUsersContainer"),g=document.querySelector('button[onclick="toggleUsersContent()"]');if(!p){console.error("❌ allUsersContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Users":"Hide Users"},window.showAddUserForm=()=>{const p=document.getElementById("addUserForm");p&&(p.style.display="block")},window.hideAddUserForm=()=>{const p=document.getElementById("addUserForm"),g=document.getElementById("newUserForm");p&&(p.style.display="none"),g&&g.reset()},window.showAddTeacherForm=()=>{const p=document.getElementById("addTeacherForm");p&&(p.style.display="block")},window.hideAddTeacherForm=()=>{const p=document.getElementById("addTeacherForm"),g=document.getElementById("newTeacherForm");p&&(p.style.display="none"),g&&g.reset()},window.toggleTeachersContent=()=>{const p=document.getElementById("allTeachersContainer"),g=document.querySelector('button[onclick="toggleTeachersContent()"]');if(!p){console.error("❌ allTeachersContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Teachers":"Hide Teachers"},window.toggleTestsContent=()=>{const p=document.getElementById("allTestsContainer"),g=document.querySelector('button[onclick="toggleTestsContent()"]');if(!p){console.error("❌ allTestsContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Tests":"Hide Tests"},window.toggleAssignmentsContent=()=>{const p=document.getElementById("allAssignmentsContainer"),g=document.querySelector('button[onclick="toggleAssignmentsContent()"]');if(!p){console.error("❌ allAssignmentsContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Assignments":"Hide Assignments"},window.toggleResultsContent=()=>{const p=document.getElementById("allResultsContainer"),g=document.querySelector('button[onclick="toggleResultsContent()"]');if(!p){console.error("❌ allResultsContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Results":"Hide Results"};const f={};window.toggleSection=p=>{console.log(`🔧 toggleSection called with sectionId: ${p}`);const g=Date.now();if(f[p]&&g-f[p]<300){console.log(`🔧 Ignoring rapid successive call for ${p}`);return}f[p]=g;const y=document.getElementById(p);if(!y){console.error(`❌ Section with id '${p}' not found!`);return}const v=y.style.display!=="none";y.style.display=v?"none":"block";const w=document.querySelector(`button[onclick="toggleSection('${p}')"]`);w&&(w.textContent=v?"Show":"Hide")},window.addClickListeners=()=>{console.log("🔧 Adding click listeners to section headers...");const p=document.querySelectorAll(".section-header");console.log(`🔧 Found ${p.length} section headers`),p.forEach((g,y)=>{const v=g.textContent.trim();if(console.log(`🔧 Processing header ${y+1}:`,v),g.dataset.listenerAdded==="true"){console.log(`🔧 Skipping header ${v} - listener already added`);return}g.addEventListener("click",()=>{const w=g.dataset.sectionId;w&&window.toggleSection(w)}),g.dataset.listenerAdded="true",console.log(`🔧 Added click listener to header: ${v}`)})},window.makeFieldEditable=p=>{const g=p.textContent;p.dataset.field;const y=document.createElement("input");y.type="text",y.value=g,y.className="editable-input";const v=document.createElement("button");v.textContent="Save",v.className="btn-save",v.onclick=()=>window.saveField(p,y,v,w);const w=document.createElement("button");w.textContent="Cancel",w.className="btn-cancel",w.onclick=()=>{p.textContent=g,p.style.display="block",y.remove(),v.remove(),w.remove()},p.style.display="none",p.parentNode.insertBefore(y,p),p.parentNode.insertBefore(v,p),p.parentNode.insertBefore(w,p)},window.saveField=(p,g,y,v)=>{const w=g.value.trim(),b=p.dataset.field,E=p.dataset.recordId;if(!w){alert("Field cannot be empty");return}console.log(`Saving field ${b} for record ${E} with value: ${w}`),p.textContent=w,p.style.display="block",g.remove(),y.remove(),v.remove()},window.showTestDataDeletion=()=>console.log("showTestDataDeletion called"),window.hideTestDataDeletionForm=()=>console.log("hideTestDataDeletionForm called"),window.loadTeacherGradesClasses=()=>console.log("loadTeacherGradesClasses called"),window.checkTeacherSubjects=()=>console.log("checkTeacherSubjects called"),window.initializeTestDeletion=()=>console.log("initializeTestDeletion called"),window.handleAssignmentDeletion=()=>console.log("handleAssignmentDeletion called"),window.handleTestDataDeletion=()=>console.log("handleTestDataDeletion called"),window.getSelectedGradesClasses=()=>console.log("getSelectedGradesClasses called"),window.hideAssignmentDeletionForm=()=>console.log("hideAssignmentDeletionForm called"),window.addKeyboardAccessibility=()=>console.log("addKeyboardAccessibility called"),window.testToggleSection=()=>console.log("testToggleSection called"),window.testAllToggles=()=>console.log("testAllToggles called"),window.manualToggleTest=()=>console.log("manualToggleTest called"),window.addEditableFieldListeners=()=>console.log("addEditableFieldListeners called"),window.deleteTest=()=>console.log("deleteTest called"),window.testLocalStorage=()=>{console.log("Testing localStorage...");try{localStorage.setItem("test","value");const p=localStorage.getItem("test");return localStorage.removeItem("test"),console.log("✅ localStorage is working"),!0}catch(p){return console.error("❌ localStorage error:",p),!1}},window.clearAllLocalStorage=()=>{console.log("Clearing all localStorage..."),localStorage.clear(),console.log("✅ localStorage cleared")},window.exportLocalStorage=()=>{console.log("Exporting localStorage...");const p={};for(let w=0;w<localStorage.length;w++){const b=localStorage.key(w);p[b]=localStorage.getItem(b)}const g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),y=URL.createObjectURL(g),v=document.createElement("a");v.href=y,v.download="localStorage-backup.json",v.click(),URL.revokeObjectURL(y)},console.log("✅ Admin functions exposed globally")},[]);return e()?o.jsx(are,{}):o.jsxs("div",{className:"admin-error",children:[o.jsx("h2",{children:"Access Denied"}),o.jsx("p",{children:"You don't have permission to access the admin dashboard."}),o.jsx("button",{onClick:r,children:"Return to Login"})]})},r_=({children:e,allowedRoles:t})=>{const{isAuthenticated:r,role:n,isLoading:s}=Wn();return s?o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):r?t&&!t.includes(n)?o.jsx(o0,{to:"/unauthorized",replace:!0}):e:o.jsx(o0,{to:"/login",replace:!0})},ore=()=>o.jsxs("div",{className:"unauthorized-page",children:[o.jsx("h1",{children:"Access Denied"}),o.jsx("p",{children:"You don't have permission to access this page."})]}),lre=()=>o.jsx(G3,{children:o.jsx(zA,{children:o.jsx($A,{children:o.jsx(OR,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:o.jsx("div",{className:"app",children:o.jsxs(k2,{children:[o.jsx(ds,{path:"/login",element:o.jsx(KW,{})}),o.jsx(ds,{path:"/unauthorized",element:o.jsx(ore,{})}),o.jsx(ds,{path:"/student/*",element:o.jsx(r_,{allowedRoles:["student"],children:o.jsx(Qz,{})})}),o.jsx(ds,{path:"/teacher/*",element:o.jsx(r_,{allowedRoles:["teacher"],children:o.jsx(sre,{})})}),o.jsx(ds,{path:"/admin/*",element:o.jsx(r_,{allowedRoles:["admin"],children:o.jsx(ire,{})})}),o.jsx(ds,{path:"/",element:o.jsx(o0,{to:"/login",replace:!0})}),o.jsx(ds,{path:"*",element:o.jsx(o0,{to:"/login",replace:!0})})]})})})})})});class cre{constructor(){this.tokenKey="auth_token",this.refreshTokenKey="refresh_token",this.userKey="user_data"}getToken(){return localStorage.getItem(this.tokenKey)}getRefreshToken(){return localStorage.getItem(this.refreshTokenKey)}getUserData(){const t=localStorage.getItem(this.userKey);return t?JSON.parse(t):null}setToken(t){localStorage.setItem(this.tokenKey,t)}setRefreshToken(t){localStorage.setItem(this.refreshTokenKey,t)}setUserData(t){localStorage.setItem(this.userKey,JSON.stringify(t))}setTokens(t,r){this.setToken(t),this.setUserData({role:r}),localStorage.setItem("accessToken",t)}isAuthenticated(){const t=this.getToken();if(!t)return!1;try{const r=JSON.parse(atob(t.split(".")[1])),n=Date.now()/1e3;return r.exp>n}catch(r){return console.error("Error decoding token:",r),!1}}getUserRole(){const t=this.getUserData();return t?t.role:null}isAdmin(){return this.getUserRole()==="admin"}isTeacher(){return this.getUserRole()==="teacher"}isStudent(){return this.getUserRole()==="student"}clearAuth(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.refreshTokenKey),localStorage.removeItem(this.userKey)}logout(){this.clearAuth(),window.location.href="/login"}getAuthHeader(){const t=this.getToken();return t?`Bearer ${t}`:null}async makeAuthenticatedRequest(t,r={}){const n=this.getToken();if(!n)throw new Error("No authentication token found");const s={"Content-Type":"application/json",Authorization:`Bearer ${n}`,...r.headers},a=await fetch(t,{...r,headers:s});if(a.status===401){if(await this.refreshToken())return s.Authorization=`Bearer ${this.getToken()}`,fetch(t,{...r,headers:s});throw this.logout(),new Error("Authentication failed")}return a}async refreshToken(){const t=this.getRefreshToken();if(!t)return!1;try{const r=await fetch("/.netlify/functions/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(r.ok){const n=await r.json();return this.setToken(n.token),n.refreshToken&&this.setRefreshToken(n.refreshToken),!0}}catch(r){console.error("Error refreshing token:",r)}return!1}getAccessToken(){return this.getToken()}decodeToken(t){try{return JSON.parse(atob(t.split(".")[1]))}catch(r){return console.error("Error decoding token:",r),null}}init(){return this.isAuthenticated()?(this.setupTokenRefresh(),!0):(window.location.pathname!=="/login"&&(window.location.href="/login"),!1)}setupTokenRefresh(){setInterval(async()=>{this.isAuthenticated()&&await this.refreshToken()},3e3*1e3)}}const _2=new cre;window.tokenManager=_2;typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{_2.init()}):_2.init());class hP{constructor(){this.currentRole=null,this.loadedFunctions=new Set,this.blockedFunctions=new Set,this.initialized=!1,this.retryCount=0,this.maxRetries=20}initialize(){if(this.initialized){console.log("[DEBUG] Role-based loader already initialized, skipping...");return}if(this.retryCount>=this.maxRetries){console.warn("[DEBUG] Max retries reached, stopping role-based loader initialization");return}if(this.retryCount++,(this.retryCount%5===1||this.retryCount===this.maxRetries)&&console.log(`[DEBUG] Role-based loader initializing... (attempt ${this.retryCount}/${this.maxRetries})`),console.log("[DEBUG] Token manager available:",!!window.tokenManager),window.tokenManager&&window.tokenManager.isAuthenticated()){const t=window.tokenManager.getUserRole();console.log("[DEBUG] Role from token manager:",t),console.log("[DEBUG] Access token exists:",!!window.tokenManager.getAccessToken()),t?(this.currentRole=t,this.initialized=!0,this.retryCount=0,this.setupRoleBasedAccess()):(console.log("[DEBUG] No role found, waiting for role to be set..."),setTimeout(()=>this.initialize(),500))}else console.log("[DEBUG] Token manager not available or not authenticated, waiting..."),setTimeout(()=>this.initialize(),500)}setupRoleBasedAccess(){this.currentRole||(console.warn("No role detected, defaulting to student access"),this.currentRole="student");let t=!1;try{const r=window.tokenManager.getAccessToken();r&&(t=window.tokenManager.decodeToken(r).role==="admin")}catch(r){console.warn("Could not decode token for admin check:",r),t=!1}console.log(`Role-based loader initialized for: ${this.currentRole}${t?" (admin)":""}`),this.loadRoleSpecificFunctions(),this.setupRoleBasedUI(),this.replaceBlockedFunctions()}loadRoleSpecificFunctions(){this.currentRole==="teacher"?this.loadTeacherFunctions():this.currentRole==="student"&&this.loadStudentFunctions()}loadTeacherFunctions(){console.log("Teacher functions already available in main script")}loadStudentFunctions(){console.log("Student functions already available in main script")}loadFunction(t,r){console.log(`Function ${t} already available in main script for ${r}`),this.loadedFunctions.add(t)}setupRoleBasedUI(){let t=!1;try{const r=window.tokenManager.getAccessToken();r&&(t=window.tokenManager.decodeToken(r).role==="admin")}catch(r){console.warn("Could not decode token for admin check in UI:",r),t=!1}this.currentRole==="student"&&this.hideTeacherElements(),this.currentRole==="teacher"&&!t&&this.hideStudentElements()}hideTeacherElements(){[".teacher-cabinet",".test-creation-panel",".grade-management-panel",".class-management-panel",'[data-role="teacher"]'].forEach(r=>{document.querySelectorAll(r).forEach(s=>{s.style.display="none",s.classList.add("role-hidden")})})}hideStudentElements(){[".student-cabinet",".test-taking-panel",".results-viewing-panel",'[data-role="student"]'].forEach(r=>{document.querySelectorAll(r).forEach(s=>{s.style.display="none",s.classList.add("role-hidden")})})}replaceBlockedFunctions(){this.currentRole==="student"?this.blockTeacherFunctions():this.currentRole==="teacher"&&this.blockStudentFunctions()}blockTeacherFunctions(){Object.entries({createTest:()=>this.showAccessDenied("teacher"),assignTest:()=>this.showAccessDenied("teacher"),gradeTest:()=>this.showAccessDenied("teacher"),manageClasses:()=>this.showAccessDenied("teacher"),viewAllResults:()=>this.showAccessDenied("teacher")}).forEach(([r,n])=>{window[r]&&(this.blockedFunctions.add(r),window[r]=n)})}blockStudentFunctions(){Object.entries({takeTest:()=>this.showAccessDenied("student"),submitTest:()=>this.showAccessDenied("student"),viewMyResults:()=>this.showAccessDenied("student")}).forEach(([r,n])=>{window[r]&&(this.blockedFunctions.add(r),window[r]=n)})}showAccessDenied(t){const r=`Access denied. This function requires ${t} role.`;console.warn(r),typeof showNotification=="function"?showNotification(r,"warning"):alert(r)}isFunctionBlocked(t){return this.blockedFunctions.has(t)}isFunctionLoaded(t){return this.loadedFunctions.has(t)}getCurrentRole(){return this.currentRole}hasRole(t){return this.currentRole===t}reloadRoleAccess(){this.initialize()}setupAccessAfterLogin(){if(console.log("[DEBUG] Setting up role-based access after login..."),console.log("[DEBUG] Role-based loader will now initialize (no more retry loop before login)"),!window.tokenManager)return console.error("[ERROR] Token manager not available during setupAccessAfterLogin"),!1;if(!window.tokenManager.isAuthenticated())return console.error("[ERROR] User not authenticated during setupAccessAfterLogin"),!1;const t=window.tokenManager.getUserRole();return t?(console.log("[DEBUG] Setting role after login:",t),this.currentRole=t,this.initialized=!0,this.retryCount=0,this.setupRoleBasedAccess(),console.log("[DEBUG] Role-based access setup completed successfully for role:",t),!0):(console.error("[ERROR] No role found in token during setupAccessAfterLogin"),!1)}}window.roleBasedLoader=new hP;typeof Uy<"u"&&Uy.exports&&(Uy.exports=hP);const ure=()=>{console.log("[DEBUG] Initializing application with new structure");const e={schemaVersion:"2.0",enhancedFeatures:!0,newUserStructure:!0,newTestStructure:!0};localStorage.setItem("app_init_data",JSON.stringify(e)),console.log("[DEBUG] Application initialized with enhanced features")},dre=()=>{console.log("[DEBUG] Starting main application"),ure(),GP.createRoot(document.getElementById("root")).render(o.jsx(us.StrictMode,{children:o.jsx(lre,{})}))};dre()});export default fre();
