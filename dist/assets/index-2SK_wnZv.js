var RP=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ire=RP((mre,O1)=>{function C3(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const a=Object.getOwnPropertyDescriptor(n,s);a&&Object.defineProperty(e,s,a.get?a:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();var L1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Bv={exports:{}},kg={},Uv={exports:{}},$r={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wk;function DP(){if(wk)return $r;wk=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),i=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;function g(K){return K===null||typeof K!="object"?null:(K=p&&K[p]||K["@@iterator"],typeof K=="function"?K:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,_={};function b(K,B,z){this.props=K,this.context=B,this.refs=_,this.updater=z||y}b.prototype.isReactComponent={},b.prototype.setState=function(K,B){if(typeof K!="object"&&typeof K!="function"&&K!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,K,B,"setState")},b.prototype.forceUpdate=function(K){this.updater.enqueueForceUpdate(this,K,"forceUpdate")};function E(){}E.prototype=b.prototype;function k(K,B,z){this.props=K,this.context=B,this.refs=_,this.updater=z||y}var w=k.prototype=new E;w.constructor=k,v(w,b.prototype),w.isPureReactComponent=!0;var N=Array.isArray,A=Object.prototype.hasOwnProperty,P={current:null},R={key:!0,ref:!0,__self:!0,__source:!0};function T(K,B,z){var Q,Y={},te=null,ee=null;if(B!=null)for(Q in B.ref!==void 0&&(ee=B.ref),B.key!==void 0&&(te=""+B.key),B)A.call(B,Q)&&!R.hasOwnProperty(Q)&&(Y[Q]=B[Q]);var ae=arguments.length-2;if(ae===1)Y.children=z;else if(1<ae){for(var ge=Array(ae),_e=0;_e<ae;_e++)ge[_e]=arguments[_e+2];Y.children=ge}if(K&&K.defaultProps)for(Q in ae=K.defaultProps,ae)Y[Q]===void 0&&(Y[Q]=ae[Q]);return{$$typeof:e,type:K,key:te,ref:ee,props:Y,_owner:P.current}}function D(K,B){return{$$typeof:e,type:K.type,key:B,ref:K.ref,props:K.props,_owner:K._owner}}function I(K){return typeof K=="object"&&K!==null&&K.$$typeof===e}function V(K){var B={"=":"=0",":":"=2"};return"$"+K.replace(/[=:]/g,function(z){return B[z]})}var X=/\/+/g;function Z(K,B){return typeof K=="object"&&K!==null&&K.key!=null?V(""+K.key):B.toString(36)}function ie(K,B,z,Q,Y){var te=typeof K;(te==="undefined"||te==="boolean")&&(K=null);var ee=!1;if(K===null)ee=!0;else switch(te){case"string":case"number":ee=!0;break;case"object":switch(K.$$typeof){case e:case t:ee=!0}}if(ee)return ee=K,Y=Y(ee),K=Q===""?"."+Z(ee,0):Q,N(Y)?(z="",K!=null&&(z=K.replace(X,"$&/")+"/"),ie(Y,B,z,"",function(_e){return _e})):Y!=null&&(I(Y)&&(Y=D(Y,z+(!Y.key||ee&&ee.key===Y.key?"":(""+Y.key).replace(X,"$&/")+"/")+K)),B.push(Y)),1;if(ee=0,Q=Q===""?".":Q+":",N(K))for(var ae=0;ae<K.length;ae++){te=K[ae];var ge=Q+Z(te,ae);ee+=ie(te,B,z,ge,Y)}else if(ge=g(K),typeof ge=="function")for(K=ge.call(K),ae=0;!(te=K.next()).done;)te=te.value,ge=Q+Z(te,ae++),ee+=ie(te,B,z,ge,Y);else if(te==="object")throw B=String(K),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(K).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.");return ee}function q(K,B,z){if(K==null)return K;var Q=[],Y=0;return ie(K,Q,"","",function(te){return B.call(z,te,Y++)}),Q}function ne(K){if(K._status===-1){var B=K._result;B=B(),B.then(function(z){(K._status===0||K._status===-1)&&(K._status=1,K._result=z)},function(z){(K._status===0||K._status===-1)&&(K._status=2,K._result=z)}),K._status===-1&&(K._status=0,K._result=B)}if(K._status===1)return K._result.default;throw K._result}var M={current:null},W={transition:null},L={ReactCurrentDispatcher:M,ReactCurrentBatchConfig:W,ReactCurrentOwner:P};function H(){throw Error("act(...) is not supported in production builds of React.")}return $r.Children={map:q,forEach:function(K,B,z){q(K,function(){B.apply(this,arguments)},z)},count:function(K){var B=0;return q(K,function(){B++}),B},toArray:function(K){return q(K,function(B){return B})||[]},only:function(K){if(!I(K))throw Error("React.Children.only expected to receive a single React element child.");return K}},$r.Component=b,$r.Fragment=r,$r.Profiler=s,$r.PureComponent=k,$r.StrictMode=n,$r.Suspense=c,$r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,$r.act=H,$r.cloneElement=function(K,B,z){if(K==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+K+".");var Q=v({},K.props),Y=K.key,te=K.ref,ee=K._owner;if(B!=null){if(B.ref!==void 0&&(te=B.ref,ee=P.current),B.key!==void 0&&(Y=""+B.key),K.type&&K.type.defaultProps)var ae=K.type.defaultProps;for(ge in B)A.call(B,ge)&&!R.hasOwnProperty(ge)&&(Q[ge]=B[ge]===void 0&&ae!==void 0?ae[ge]:B[ge])}var ge=arguments.length-2;if(ge===1)Q.children=z;else if(1<ge){ae=Array(ge);for(var _e=0;_e<ge;_e++)ae[_e]=arguments[_e+2];Q.children=ae}return{$$typeof:e,type:K.type,key:Y,ref:te,props:Q,_owner:ee}},$r.createContext=function(K){return K={$$typeof:i,_currentValue:K,_currentValue2:K,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},K.Provider={$$typeof:a,_context:K},K.Consumer=K},$r.createElement=T,$r.createFactory=function(K){var B=T.bind(null,K);return B.type=K,B},$r.createRef=function(){return{current:null}},$r.forwardRef=function(K){return{$$typeof:l,render:K}},$r.isValidElement=I,$r.lazy=function(K){return{$$typeof:f,_payload:{_status:-1,_result:K},_init:ne}},$r.memo=function(K,B){return{$$typeof:d,type:K,compare:B===void 0?null:B}},$r.startTransition=function(K){var B=W.transition;W.transition={};try{K()}finally{W.transition=B}},$r.unstable_act=H,$r.useCallback=function(K,B){return M.current.useCallback(K,B)},$r.useContext=function(K){return M.current.useContext(K)},$r.useDebugValue=function(){},$r.useDeferredValue=function(K){return M.current.useDeferredValue(K)},$r.useEffect=function(K,B){return M.current.useEffect(K,B)},$r.useId=function(){return M.current.useId()},$r.useImperativeHandle=function(K,B,z){return M.current.useImperativeHandle(K,B,z)},$r.useInsertionEffect=function(K,B){return M.current.useInsertionEffect(K,B)},$r.useLayoutEffect=function(K,B){return M.current.useLayoutEffect(K,B)},$r.useMemo=function(K,B){return M.current.useMemo(K,B)},$r.useReducer=function(K,B,z){return M.current.useReducer(K,B,z)},$r.useRef=function(K){return M.current.useRef(K)},$r.useState=function(K){return M.current.useState(K)},$r.useSyncExternalStore=function(K,B,z){return M.current.useSyncExternalStore(K,B,z)},$r.useTransition=function(){return M.current.useTransition()},$r.version="18.3.1",$r}var _k;function Cy(){return _k||(_k=1,Uv.exports=DP()),Uv.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bk;function IP(){if(bk)return kg;bk=1;var e=Cy(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(l,c,d){var f,p={},g=null,y=null;d!==void 0&&(g=""+d),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(y=c.ref);for(f in c)n.call(c,f)&&!a.hasOwnProperty(f)&&(p[f]=c[f]);if(l&&l.defaultProps)for(f in c=l.defaultProps,c)p[f]===void 0&&(p[f]=c[f]);return{$$typeof:t,type:l,key:g,ref:y,props:p,_owner:s.current}}return kg.Fragment=r,kg.jsx=i,kg.jsxs=i,kg}var Sk;function MP(){return Sk||(Sk=1,Bv.exports=IP()),Bv.exports}var o=MP(),C=Cy();const ns=bp(C),OP=C3({__proto__:null,default:ns},[C]);var Zx={},$v={exports:{}},xi={},Wv={exports:{}},zv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kk;function LP(){return kk||(kk=1,(function(e){function t(W,L){var H=W.length;W.push(L);e:for(;0<H;){var K=H-1>>>1,B=W[K];if(0<s(B,L))W[K]=L,W[H]=B,H=K;else break e}}function r(W){return W.length===0?null:W[0]}function n(W){if(W.length===0)return null;var L=W[0],H=W.pop();if(H!==L){W[0]=H;e:for(var K=0,B=W.length,z=B>>>1;K<z;){var Q=2*(K+1)-1,Y=W[Q],te=Q+1,ee=W[te];if(0>s(Y,H))te<B&&0>s(ee,Y)?(W[K]=ee,W[te]=H,K=te):(W[K]=Y,W[Q]=H,K=Q);else if(te<B&&0>s(ee,H))W[K]=ee,W[te]=H,K=te;else break e}}return L}function s(W,L){var H=W.sortIndex-L.sortIndex;return H!==0?H:W.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var i=Date,l=i.now();e.unstable_now=function(){return i.now()-l}}var c=[],d=[],f=1,p=null,g=3,y=!1,v=!1,_=!1,b=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(W){for(var L=r(d);L!==null;){if(L.callback===null)n(d);else if(L.startTime<=W)n(d),L.sortIndex=L.expirationTime,t(c,L);else break;L=r(d)}}function N(W){if(_=!1,w(W),!v)if(r(c)!==null)v=!0,ne(A);else{var L=r(d);L!==null&&M(N,L.startTime-W)}}function A(W,L){v=!1,_&&(_=!1,E(T),T=-1),y=!0;var H=g;try{for(w(L),p=r(c);p!==null&&(!(p.expirationTime>L)||W&&!V());){var K=p.callback;if(typeof K=="function"){p.callback=null,g=p.priorityLevel;var B=K(p.expirationTime<=L);L=e.unstable_now(),typeof B=="function"?p.callback=B:p===r(c)&&n(c),w(L)}else n(c);p=r(c)}if(p!==null)var z=!0;else{var Q=r(d);Q!==null&&M(N,Q.startTime-L),z=!1}return z}finally{p=null,g=H,y=!1}}var P=!1,R=null,T=-1,D=5,I=-1;function V(){return!(e.unstable_now()-I<D)}function X(){if(R!==null){var W=e.unstable_now();I=W;var L=!0;try{L=R(!0,W)}finally{L?Z():(P=!1,R=null)}}else P=!1}var Z;if(typeof k=="function")Z=function(){k(X)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,q=ie.port2;ie.port1.onmessage=X,Z=function(){q.postMessage(null)}}else Z=function(){b(X,0)};function ne(W){R=W,P||(P=!0,Z())}function M(W,L){T=b(function(){W(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){v||y||(v=!0,ne(A))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return g},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(W){switch(g){case 1:case 2:case 3:var L=3;break;default:L=g}var H=g;g=L;try{return W()}finally{g=H}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,L){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var H=g;g=W;try{return L()}finally{g=H}},e.unstable_scheduleCallback=function(W,L,H){var K=e.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?K+H:K):H=K,W){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=H+B,W={id:f++,callback:L,priorityLevel:W,startTime:H,expirationTime:B,sortIndex:-1},H>K?(W.sortIndex=H,t(d,W),r(c)===null&&W===r(d)&&(_?(E(T),T=-1):_=!0,M(N,H-K))):(W.sortIndex=B,t(c,W),v||y||(v=!0,ne(A))),W},e.unstable_shouldYield=V,e.unstable_wrapCallback=function(W){var L=g;return function(){var H=g;g=L;try{return W.apply(this,arguments)}finally{g=H}}}})(zv)),zv}var Ck;function w2(){return Ck||(Ck=1,Wv.exports=LP()),Wv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tk;function BP(){if(Tk)return xi;Tk=1;var e=Cy(),t=w2();function r(u){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+u,S=1;S<arguments.length;S++)h+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,s={};function a(u,h){i(u,h),i(u+"Capture",h)}function i(u,h){for(s[u]=h,u=0;u<h.length;u++)n.add(h[u])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(u){return c.call(p,u)?!0:c.call(f,u)?!1:d.test(u)?p[u]=!0:(f[u]=!0,!1)}function y(u,h,S,F){if(S!==null&&S.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return F?!1:S!==null?!S.acceptsBooleans:(u=u.toLowerCase().slice(0,5),u!=="data-"&&u!=="aria-");default:return!1}}function v(u,h,S,F){if(h===null||typeof h>"u"||y(u,h,S,F))return!0;if(F)return!1;if(S!==null)switch(S.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function _(u,h,S,F,U,J,ce){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=F,this.attributeNamespace=U,this.mustUseProperty=S,this.propertyName=u,this.type=h,this.sanitizeURL=J,this.removeEmptyString=ce}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(u){b[u]=new _(u,0,!1,u,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(u){var h=u[0];b[h]=new _(h,1,!1,u[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(u){b[u]=new _(u,2,!1,u.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(u){b[u]=new _(u,2,!1,u,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(u){b[u]=new _(u,3,!1,u.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(u){b[u]=new _(u,3,!0,u,null,!1,!1)}),["capture","download"].forEach(function(u){b[u]=new _(u,4,!1,u,null,!1,!1)}),["cols","rows","size","span"].forEach(function(u){b[u]=new _(u,6,!1,u,null,!1,!1)}),["rowSpan","start"].forEach(function(u){b[u]=new _(u,5,!1,u.toLowerCase(),null,!1,!1)});var E=/[\-:]([a-z])/g;function k(u){return u[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(u){var h=u.replace(E,k);b[h]=new _(h,1,!1,u,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(u){var h=u.replace(E,k);b[h]=new _(h,1,!1,u,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(u){var h=u.replace(E,k);b[h]=new _(h,1,!1,u,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(u){b[u]=new _(u,1,!1,u.toLowerCase(),null,!1,!1)}),b.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(u){b[u]=new _(u,1,!1,u.toLowerCase(),null,!0,!0)});function w(u,h,S,F){var U=b.hasOwnProperty(h)?b[h]:null;(U!==null?U.type!==0:F||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(v(h,S,U,F)&&(S=null),F||U===null?g(h)&&(S===null?u.removeAttribute(h):u.setAttribute(h,""+S)):U.mustUseProperty?u[U.propertyName]=S===null?U.type===3?!1:"":S:(h=U.attributeName,F=U.attributeNamespace,S===null?u.removeAttribute(h):(U=U.type,S=U===3||U===4&&S===!0?"":""+S,F?u.setAttributeNS(F,h,S):u.setAttribute(h,S))))}var N=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),P=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),V=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),M=Symbol.for("react.offscreen"),W=Symbol.iterator;function L(u){return u===null||typeof u!="object"?null:(u=W&&u[W]||u["@@iterator"],typeof u=="function"?u:null)}var H=Object.assign,K;function B(u){if(K===void 0)try{throw Error()}catch(S){var h=S.stack.trim().match(/\n( *(at )?)/);K=h&&h[1]||""}return`
`+K+u}var z=!1;function Q(u,h){if(!u||z)return"";z=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(ct){var F=ct}Reflect.construct(u,[],h)}else{try{h.call()}catch(ct){F=ct}u.call(h.prototype)}else{try{throw Error()}catch(ct){F=ct}u()}}catch(ct){if(ct&&F&&typeof ct.stack=="string"){for(var U=ct.stack.split(`
`),J=F.stack.split(`
`),ce=U.length-1,Ee=J.length-1;1<=ce&&0<=Ee&&U[ce]!==J[Ee];)Ee--;for(;1<=ce&&0<=Ee;ce--,Ee--)if(U[ce]!==J[Ee]){if(ce!==1||Ee!==1)do if(ce--,Ee--,0>Ee||U[ce]!==J[Ee]){var Re=`
`+U[ce].replace(" at new "," at ");return u.displayName&&Re.includes("<anonymous>")&&(Re=Re.replace("<anonymous>",u.displayName)),Re}while(1<=ce&&0<=Ee);break}}}finally{z=!1,Error.prepareStackTrace=S}return(u=u?u.displayName||u.name:"")?B(u):""}function Y(u){switch(u.tag){case 5:return B(u.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return u=Q(u.type,!1),u;case 11:return u=Q(u.type.render,!1),u;case 1:return u=Q(u.type,!0),u;default:return""}}function te(u){if(u==null)return null;if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case R:return"Fragment";case P:return"Portal";case D:return"Profiler";case T:return"StrictMode";case Z:return"Suspense";case ie:return"SuspenseList"}if(typeof u=="object")switch(u.$$typeof){case V:return(u.displayName||"Context")+".Consumer";case I:return(u._context.displayName||"Context")+".Provider";case X:var h=u.render;return u=u.displayName,u||(u=h.displayName||h.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case q:return h=u.displayName||null,h!==null?h:te(u.type)||"Memo";case ne:h=u._payload,u=u._init;try{return te(u(h))}catch{}}return null}function ee(u){var h=u.type;switch(u.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return u=h.render,u=u.displayName||u.name||"",h.displayName||(u!==""?"ForwardRef("+u+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return te(h);case 8:return h===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function ae(u){switch(typeof u){case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function ge(u){var h=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function _e(u){var h=ge(u)?"checked":"value",S=Object.getOwnPropertyDescriptor(u.constructor.prototype,h),F=""+u[h];if(!u.hasOwnProperty(h)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var U=S.get,J=S.set;return Object.defineProperty(u,h,{configurable:!0,get:function(){return U.call(this)},set:function(ce){F=""+ce,J.call(this,ce)}}),Object.defineProperty(u,h,{enumerable:S.enumerable}),{getValue:function(){return F},setValue:function(ce){F=""+ce},stopTracking:function(){u._valueTracker=null,delete u[h]}}}}function Me(u){u._valueTracker||(u._valueTracker=_e(u))}function ue(u){if(!u)return!1;var h=u._valueTracker;if(!h)return!0;var S=h.getValue(),F="";return u&&(F=ge(u)?u.checked?"true":"false":u.value),u=F,u!==S?(h.setValue(u),!0):!1}function me(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}function He(u,h){var S=h.checked;return H({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??u._wrapperState.initialChecked})}function qe(u,h){var S=h.defaultValue==null?"":h.defaultValue,F=h.checked!=null?h.checked:h.defaultChecked;S=ae(h.value!=null?h.value:S),u._wrapperState={initialChecked:F,initialValue:S,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function Xe(u,h){h=h.checked,h!=null&&w(u,"checked",h,!1)}function Ve(u,h){Xe(u,h);var S=ae(h.value),F=h.type;if(S!=null)F==="number"?(S===0&&u.value===""||u.value!=S)&&(u.value=""+S):u.value!==""+S&&(u.value=""+S);else if(F==="submit"||F==="reset"){u.removeAttribute("value");return}h.hasOwnProperty("value")?st(u,h.type,S):h.hasOwnProperty("defaultValue")&&st(u,h.type,ae(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(u.defaultChecked=!!h.defaultChecked)}function It(u,h,S){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var F=h.type;if(!(F!=="submit"&&F!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+u._wrapperState.initialValue,S||h===u.value||(u.value=h),u.defaultValue=h}S=u.name,S!==""&&(u.name=""),u.defaultChecked=!!u._wrapperState.initialChecked,S!==""&&(u.name=S)}function st(u,h,S){(h!=="number"||me(u.ownerDocument)!==u)&&(S==null?u.defaultValue=""+u._wrapperState.initialValue:u.defaultValue!==""+S&&(u.defaultValue=""+S))}var Ie=Array.isArray;function je(u,h,S,F){if(u=u.options,h){h={};for(var U=0;U<S.length;U++)h["$"+S[U]]=!0;for(S=0;S<u.length;S++)U=h.hasOwnProperty("$"+u[S].value),u[S].selected!==U&&(u[S].selected=U),U&&F&&(u[S].defaultSelected=!0)}else{for(S=""+ae(S),h=null,U=0;U<u.length;U++){if(u[U].value===S){u[U].selected=!0,F&&(u[U].defaultSelected=!0);return}h!==null||u[U].disabled||(h=u[U])}h!==null&&(h.selected=!0)}}function Ze(u,h){if(h.dangerouslySetInnerHTML!=null)throw Error(r(91));return H({},h,{value:void 0,defaultValue:void 0,children:""+u._wrapperState.initialValue})}function bt(u,h){var S=h.value;if(S==null){if(S=h.children,h=h.defaultValue,S!=null){if(h!=null)throw Error(r(92));if(Ie(S)){if(1<S.length)throw Error(r(93));S=S[0]}h=S}h==null&&(h=""),S=h}u._wrapperState={initialValue:ae(S)}}function mt(u,h){var S=ae(h.value),F=ae(h.defaultValue);S!=null&&(S=""+S,S!==u.value&&(u.value=S),h.defaultValue==null&&u.defaultValue!==S&&(u.defaultValue=S)),F!=null&&(u.defaultValue=""+F)}function $t(u){var h=u.textContent;h===u._wrapperState.initialValue&&h!==""&&h!==null&&(u.value=h)}function Wt(u){switch(u){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(u,h){return u==null||u==="http://www.w3.org/1999/xhtml"?Wt(h):u==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":u}var Qe,yt=(function(u){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,S,F,U){MSApp.execUnsafeLocalFunction(function(){return u(h,S,F,U)})}:u})(function(u,h){if(u.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in u)u.innerHTML=h;else{for(Qe=Qe||document.createElement("div"),Qe.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=Qe.firstChild;u.firstChild;)u.removeChild(u.firstChild);for(;h.firstChild;)u.appendChild(h.firstChild)}});function ft(u,h){if(h){var S=u.firstChild;if(S&&S===u.lastChild&&S.nodeType===3){S.nodeValue=h;return}}u.textContent=h}var _t={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zt=["Webkit","ms","Moz","O"];Object.keys(_t).forEach(function(u){zt.forEach(function(h){h=h+u.charAt(0).toUpperCase()+u.substring(1),_t[h]=_t[u]})});function Jt(u,h,S){return h==null||typeof h=="boolean"||h===""?"":S||typeof h!="number"||h===0||_t.hasOwnProperty(u)&&_t[u]?(""+h).trim():h+"px"}function De(u,h){u=u.style;for(var S in h)if(h.hasOwnProperty(S)){var F=S.indexOf("--")===0,U=Jt(S,h[S],F);S==="float"&&(S="cssFloat"),F?u.setProperty(S,U):u[S]=U}}var ut=H({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pt(u,h){if(h){if(ut[u]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(r(137,u));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(r(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(r(61))}if(h.style!=null&&typeof h.style!="object")throw Error(r(62))}}function Pt(u,h){if(u.indexOf("-")===-1)return typeof h.is=="string";switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lt=null;function sr(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var Te=null,ve=null,fe=null;function we(u){if(u=gd(u)){if(typeof Te!="function")throw Error(r(280));var h=u.stateNode;h&&(h=ks(h),Te(u.stateNode,u.type,h))}}function Ue(u){ve?fe?fe.push(u):fe=[u]:ve=u}function St(){if(ve){var u=ve,h=fe;if(fe=ve=null,we(u),h)for(u=0;u<h.length;u++)we(h[u])}}function xt(u,h){return u(h)}function Ht(){}var Ot=!1;function Xt(u,h,S){if(Ot)return u(h,S);Ot=!0;try{return xt(u,h,S)}finally{Ot=!1,(ve!==null||fe!==null)&&(Ht(),St())}}function pr(u,h){var S=u.stateNode;if(S===null)return null;var F=ks(S);if(F===null)return null;S=F[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(F=!F.disabled)||(u=u.type,F=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!F;break e;default:u=!1}if(u)return null;if(S&&typeof S!="function")throw Error(r(231,h,typeof S));return S}var Fr=!1;if(l)try{var fr={};Object.defineProperty(fr,"passive",{get:function(){Fr=!0}}),window.addEventListener("test",fr,fr),window.removeEventListener("test",fr,fr)}catch{Fr=!1}function vr(u,h,S,F,U,J,ce,Ee,Re){var ct=Array.prototype.slice.call(arguments,3);try{h.apply(S,ct)}catch(Ft){this.onError(Ft)}}var Mr=!1,sn=null,le=!1,be=null,pe={onError:function(u){Mr=!0,sn=u}};function xe(u,h,S,F,U,J,ce,Ee,Re){Mr=!1,sn=null,vr.apply(pe,arguments)}function Se(u,h,S,F,U,J,ce,Ee,Re){if(xe.apply(this,arguments),Mr){if(Mr){var ct=sn;Mr=!1,sn=null}else throw Error(r(198));le||(le=!0,be=ct)}}function ke(u){var h=u,S=u;if(u.alternate)for(;h.return;)h=h.return;else{u=h;do h=u,(h.flags&4098)!==0&&(S=h.return),u=h.return;while(u)}return h.tag===3?S:null}function $e(u){if(u.tag===13){var h=u.memoizedState;if(h===null&&(u=u.alternate,u!==null&&(h=u.memoizedState)),h!==null)return h.dehydrated}return null}function ht(u){if(ke(u)!==u)throw Error(r(188))}function Ke(u){var h=u.alternate;if(!h){if(h=ke(u),h===null)throw Error(r(188));return h!==u?null:u}for(var S=u,F=h;;){var U=S.return;if(U===null)break;var J=U.alternate;if(J===null){if(F=U.return,F!==null){S=F;continue}break}if(U.child===J.child){for(J=U.child;J;){if(J===S)return ht(U),u;if(J===F)return ht(U),h;J=J.sibling}throw Error(r(188))}if(S.return!==F.return)S=U,F=J;else{for(var ce=!1,Ee=U.child;Ee;){if(Ee===S){ce=!0,S=U,F=J;break}if(Ee===F){ce=!0,F=U,S=J;break}Ee=Ee.sibling}if(!ce){for(Ee=J.child;Ee;){if(Ee===S){ce=!0,S=J,F=U;break}if(Ee===F){ce=!0,F=J,S=U;break}Ee=Ee.sibling}if(!ce)throw Error(r(189))}}if(S.alternate!==F)throw Error(r(190))}if(S.tag!==3)throw Error(r(188));return S.stateNode.current===S?u:h}function oe(u){return u=Ke(u),u!==null?he(u):null}function he(u){if(u.tag===5||u.tag===6)return u;for(u=u.child;u!==null;){var h=he(u);if(h!==null)return h;u=u.sibling}return null}var Ce=t.unstable_scheduleCallback,Ne=t.unstable_cancelCallback,Ge=t.unstable_shouldYield,ot=t.unstable_requestPaint,Le=t.unstable_now,Et=t.unstable_getCurrentPriorityLevel,Bt=t.unstable_ImmediatePriority,Yt=t.unstable_UserBlockingPriority,Fe=t.unstable_NormalPriority,We=t.unstable_LowPriority,Ct=t.unstable_IdlePriority,at=null,Qt=null;function tt(u){if(Qt&&typeof Qt.onCommitFiberRoot=="function")try{Qt.onCommitFiberRoot(at,u,void 0,(u.current.flags&128)===128)}catch{}}var jt=Math.clz32?Math.clz32:Pe,re=Math.log,de=Math.LN2;function Pe(u){return u>>>=0,u===0?32:31-(re(u)/de|0)|0}var Je=64,gr=4194304;function or(u){switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return u&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return u}}function Or(u,h){var S=u.pendingLanes;if(S===0)return 0;var F=0,U=u.suspendedLanes,J=u.pingedLanes,ce=S&268435455;if(ce!==0){var Ee=ce&~U;Ee!==0?F=or(Ee):(J&=ce,J!==0&&(F=or(J)))}else ce=S&~U,ce!==0?F=or(ce):J!==0&&(F=or(J));if(F===0)return 0;if(h!==0&&h!==F&&(h&U)===0&&(U=F&-F,J=h&-h,U>=J||U===16&&(J&4194240)!==0))return h;if((F&4)!==0&&(F|=S&16),h=u.entangledLanes,h!==0)for(u=u.entanglements,h&=F;0<h;)S=31-jt(h),U=1<<S,F|=u[S],h&=~U;return F}function Dr(u,h){switch(u){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xr(u,h){for(var S=u.suspendedLanes,F=u.pingedLanes,U=u.expirationTimes,J=u.pendingLanes;0<J;){var ce=31-jt(J),Ee=1<<ce,Re=U[ce];Re===-1?((Ee&S)===0||(Ee&F)!==0)&&(U[ce]=Dr(Ee,h)):Re<=h&&(u.expiredLanes|=Ee),J&=~Ee}}function Zr(u){return u=u.pendingLanes&-1073741825,u!==0?u:u&1073741824?1073741824:0}function dr(){var u=Je;return Je<<=1,(Je&4194240)===0&&(Je=64),u}function _s(u){for(var h=[],S=0;31>S;S++)h.push(u);return h}function Ml(u,h,S){u.pendingLanes|=h,h!==536870912&&(u.suspendedLanes=0,u.pingedLanes=0),u=u.eventTimes,h=31-jt(h),u[h]=S}function lv(u,h){var S=u.pendingLanes&~h;u.pendingLanes=h,u.suspendedLanes=0,u.pingedLanes=0,u.expiredLanes&=h,u.mutableReadLanes&=h,u.entangledLanes&=h,h=u.entanglements;var F=u.eventTimes;for(u=u.expirationTimes;0<S;){var U=31-jt(S),J=1<<U;h[U]=0,F[U]=-1,u[U]=-1,S&=~J}}function D0(u,h){var S=u.entangledLanes|=h;for(u=u.entanglements;S;){var F=31-jt(S),U=1<<F;U&h|u[F]&h&&(u[F]|=h),S&=~U}}var Kr=0;function Zu(u){return u&=-u,1<u?4<u?(u&268435455)!==0?16:536870912:4:1}var Rc,Dc,Zp,ex,Tf,Ef=!1,Ic=[],ci=null,Yo=null,Hi=null,Ur=new Map,Mc=new Map,Gi=[],tx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rx(u,h){switch(u){case"focusin":case"focusout":ci=null;break;case"dragenter":case"dragleave":Yo=null;break;case"mouseover":case"mouseout":Hi=null;break;case"pointerover":case"pointerout":Ur.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mc.delete(h.pointerId)}}function ed(u,h,S,F,U,J){return u===null||u.nativeEvent!==J?(u={blockedOn:h,domEventName:S,eventSystemFlags:F,nativeEvent:J,targetContainers:[U]},h!==null&&(h=gd(h),h!==null&&Dc(h)),u):(u.eventSystemFlags|=F,h=u.targetContainers,U!==null&&h.indexOf(U)===-1&&h.push(U),u)}function bs(u,h,S,F,U){switch(h){case"focusin":return ci=ed(ci,u,h,S,F,U),!0;case"dragenter":return Yo=ed(Yo,u,h,S,F,U),!0;case"mouseover":return Hi=ed(Hi,u,h,S,F,U),!0;case"pointerover":var J=U.pointerId;return Ur.set(J,ed(Ur.get(J)||null,u,h,S,F,U)),!0;case"gotpointercapture":return J=U.pointerId,Mc.set(J,ed(Mc.get(J)||null,u,h,S,F,U)),!0}return!1}function Nf(u){var h=il(u.target);if(h!==null){var S=ke(h);if(S!==null){if(h=S.tag,h===13){if(h=$e(S),h!==null){u.blockedOn=h,Tf(u.priority,function(){Zp(S)});return}}else if(h===3&&S.stateNode.current.memoizedState.isDehydrated){u.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}u.blockedOn=null}function Af(u){if(u.blockedOn!==null)return!1;for(var h=u.targetContainers;0<h.length;){var S=Pf(u.domEventName,u.eventSystemFlags,h[0],u.nativeEvent);if(S===null){S=u.nativeEvent;var F=new S.constructor(S.type,S);Lt=F,S.target.dispatchEvent(F),Lt=null}else return h=gd(S),h!==null&&Dc(h),u.blockedOn=S,!1;h.shift()}return!0}function jf(u,h,S){Af(u)&&S.delete(h)}function cv(){Ef=!1,ci!==null&&Af(ci)&&(ci=null),Yo!==null&&Af(Yo)&&(Yo=null),Hi!==null&&Af(Hi)&&(Hi=null),Ur.forEach(jf),Mc.forEach(jf)}function Qo(u,h){u.blockedOn===h&&(u.blockedOn=null,Ef||(Ef=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,cv)))}function Ca(u){function h(U){return Qo(U,u)}if(0<Ic.length){Qo(Ic[0],u);for(var S=1;S<Ic.length;S++){var F=Ic[S];F.blockedOn===u&&(F.blockedOn=null)}}for(ci!==null&&Qo(ci,u),Yo!==null&&Qo(Yo,u),Hi!==null&&Qo(Hi,u),Ur.forEach(h),Mc.forEach(h),S=0;S<Gi.length;S++)F=Gi[S],F.blockedOn===u&&(F.blockedOn=null);for(;0<Gi.length&&(S=Gi[0],S.blockedOn===null);)Nf(S),S.blockedOn===null&&Gi.shift()}var Oc=N.ReactCurrentBatchConfig,Ff=!0;function Ni(u,h,S,F){var U=Kr,J=Oc.transition;Oc.transition=null;try{Kr=1,Lc(u,h,S,F)}finally{Kr=U,Oc.transition=J}}function _o(u,h,S,F){var U=Kr,J=Oc.transition;Oc.transition=null;try{Kr=4,Lc(u,h,S,F)}finally{Kr=U,Oc.transition=J}}function Lc(u,h,S,F){if(Ff){var U=Pf(u,h,S,F);if(U===null)qf(u,h,F,Bc,S),rx(u,F);else if(bs(U,u,h,S,F))F.stopPropagation();else if(rx(u,F),h&4&&-1<tx.indexOf(u)){for(;U!==null;){var J=gd(U);if(J!==null&&Rc(J),J=Pf(u,h,S,F),J===null&&qf(u,h,F,Bc,S),J===U)break;U=J}U!==null&&F.stopPropagation()}else qf(u,h,F,null,S)}}var Bc=null;function Pf(u,h,S,F){if(Bc=null,u=sr(F),u=il(u),u!==null)if(h=ke(u),h===null)u=null;else if(S=h.tag,S===13){if(u=$e(h),u!==null)return u;u=null}else if(S===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;u=null}else h!==u&&(u=null);return Bc=u,null}function nx(u){switch(u){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Et()){case Bt:return 1;case Yt:return 4;case Fe:case We:return 16;case Ct:return 536870912;default:return 16}default:return 16}}var Rs=null,Jo=null,bo=null;function td(){if(bo)return bo;var u,h=Jo,S=h.length,F,U="value"in Rs?Rs.value:Rs.textContent,J=U.length;for(u=0;u<S&&h[u]===U[u];u++);var ce=S-u;for(F=1;F<=ce&&h[S-F]===U[J-F];F++);return bo=U.slice(u,1<F?1-F:void 0)}function Ol(u){var h=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&h===13&&(u=13)):u=h,u===10&&(u=13),32<=u||u===13?u:0}function aa(){return!0}function Ha(){return!1}function cs(u){function h(S,F,U,J,ce){this._reactName=S,this._targetInst=U,this.type=F,this.nativeEvent=J,this.target=ce,this.currentTarget=null;for(var Ee in u)u.hasOwnProperty(Ee)&&(S=u[Ee],this[Ee]=S?S(J):J[Ee]);return this.isDefaultPrevented=(J.defaultPrevented!=null?J.defaultPrevented:J.returnValue===!1)?aa:Ha,this.isPropagationStopped=Ha,this}return H(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=aa)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=aa)},persist:function(){},isPersistent:aa}),h}var Ta={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ai=cs(Ta),ji=H({},Ta,{view:0,detail:0}),sx=cs(ji),rd,nd,Ds,ia=H({},ji,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bl,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==Ds&&(Ds&&u.type==="mousemove"?(rd=u.screenX-Ds.screenX,nd=u.screenY-Ds.screenY):nd=rd=0,Ds=u),rd)},movementY:function(u){return"movementY"in u?u.movementY:nd}}),Sn=cs(ia),sd=H({},ia,{dataTransfer:0}),Fi=cs(sd),ax=H({},ji,{relatedTarget:0}),Rf=cs(ax),I0=H({},Ta,{animationName:0,elapsedTime:0,pseudoElement:0}),M0=cs(I0),ix=H({},Ta,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),Df=cs(ix),ox=H({},Ta,{data:0}),Ll=cs(ox),O0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},If={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dv(u){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(u):(u=If[u])?!!h[u]:!1}function Bl(){return dv}var Mf=H({},ji,{key:function(u){if(u.key){var h=O0[u.key]||u.key;if(h!=="Unidentified")return h}return u.type==="keypress"?(u=Ol(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?uv[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bl,charCode:function(u){return u.type==="keypress"?Ol(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?Ol(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),lx=cs(Mf),cx=H({},ia,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ul=cs(cx),ux=H({},ji,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bl}),Of=cs(ux),Lf=H({},Ta,{propertyName:0,elapsedTime:0,pseudoElement:0}),Uc=cs(Lf),L0=H({},ia,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),B0=cs(L0),dx=[9,13,27,32],ad=l&&"CompositionEvent"in window,$l=null;l&&"documentMode"in document&&($l=document.documentMode);var $c=l&&"TextEvent"in window&&!$l,Ga=l&&(!ad||$l&&8<$l&&11>=$l),Zo=" ",Bf=!1;function U0(u,h){switch(u){case"keyup":return dx.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pi(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var Va=!1;function $0(u,h){switch(u){case"compositionend":return Pi(h);case"keypress":return h.which!==32?null:(Bf=!0,Zo);case"textInput":return u=h.data,u===Zo&&Bf?null:u;default:return null}}function fx(u,h){if(Va)return u==="compositionend"||!ad&&U0(u,h)?(u=td(),bo=Jo=Rs=null,Va=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Ga&&h.locale!=="ko"?null:h.data;default:return null}}var So={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ko(u){var h=u&&u.nodeName&&u.nodeName.toLowerCase();return h==="input"?!!So[u.type]:h==="textarea"}function id(u,h,S,F){Ue(F),h=Xf(h,"onChange"),0<h.length&&(S=new Ai("onChange","change",null,S,F),u.push({event:S,listeners:h}))}var Wc=null,el=null;function hx(u){J0(u,0)}function tl(u){var h=ds(u);if(ue(h))return u}function ui(u,h){if(u==="change")return h}var zc=!1;if(l){var rl;if(l){var di="oninput"in document;if(!di){var Uf=document.createElement("div");Uf.setAttribute("oninput","return;"),di=typeof Uf.oninput=="function"}rl=di}else rl=!1;zc=rl&&(!document.documentMode||9<document.documentMode)}function Wl(){Wc&&(Wc.detachEvent("onpropertychange",W0),el=Wc=null)}function W0(u){if(u.propertyName==="value"&&tl(el)){var h=[];id(h,el,u,sr(u)),Xt(hx,h)}}function z0(u,h,S){u==="focusin"?(Wl(),Wc=h,el=S,Wc.attachEvent("onpropertychange",W0)):u==="focusout"&&Wl()}function Pn(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return tl(el)}function $f(u,h){if(u==="click")return tl(h)}function H0(u,h){if(u==="input"||u==="change")return tl(h)}function G0(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var Ea=typeof Object.is=="function"?Object.is:G0;function zl(u,h){if(Ea(u,h))return!0;if(typeof u!="object"||u===null||typeof h!="object"||h===null)return!1;var S=Object.keys(u),F=Object.keys(h);if(S.length!==F.length)return!1;for(F=0;F<S.length;F++){var U=S[F];if(!c.call(h,U)||!Ea(u[U],h[U]))return!1}return!0}function nl(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function Tn(u,h){var S=nl(u);u=0;for(var F;S;){if(S.nodeType===3){if(F=u+S.textContent.length,u<=h&&F>=h)return{node:S,offset:h-u};u=F}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=nl(S)}}function Yn(u,h){return u&&h?u===h?!0:u&&u.nodeType===3?!1:h&&h.nodeType===3?Yn(u,h.parentNode):"contains"in u?u.contains(h):u.compareDocumentPosition?!!(u.compareDocumentPosition(h)&16):!1:!1}function us(){for(var u=window,h=me();h instanceof u.HTMLIFrameElement;){try{var S=typeof h.contentWindow.location.href=="string"}catch{S=!1}if(S)u=h.contentWindow;else break;h=me(u.document)}return h}function Hc(u){var h=u&&u.nodeName&&u.nodeName.toLowerCase();return h&&(h==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||h==="textarea"||u.contentEditable==="true")}function od(u){var h=us(),S=u.focusedElem,F=u.selectionRange;if(h!==S&&S&&S.ownerDocument&&Yn(S.ownerDocument.documentElement,S)){if(F!==null&&Hc(S)){if(h=F.start,u=F.end,u===void 0&&(u=h),"selectionStart"in S)S.selectionStart=h,S.selectionEnd=Math.min(u,S.value.length);else if(u=(h=S.ownerDocument||document)&&h.defaultView||window,u.getSelection){u=u.getSelection();var U=S.textContent.length,J=Math.min(F.start,U);F=F.end===void 0?J:Math.min(F.end,U),!u.extend&&J>F&&(U=F,F=J,J=U),U=Tn(S,J);var ce=Tn(S,F);U&&ce&&(u.rangeCount!==1||u.anchorNode!==U.node||u.anchorOffset!==U.offset||u.focusNode!==ce.node||u.focusOffset!==ce.offset)&&(h=h.createRange(),h.setStart(U.node,U.offset),u.removeAllRanges(),J>F?(u.addRange(h),u.extend(ce.node,ce.offset)):(h.setEnd(ce.node,ce.offset),u.addRange(h)))}}for(h=[],u=S;u=u.parentNode;)u.nodeType===1&&h.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<h.length;S++)u=h[S],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var ld=l&&"documentMode"in document&&11>=document.documentMode,Gc=null,Ss=null,Hl=null,cd=!1;function Wf(u,h,S){var F=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;cd||Gc==null||Gc!==me(F)||(F=Gc,"selectionStart"in F&&Hc(F)?F={start:F.selectionStart,end:F.selectionEnd}:(F=(F.ownerDocument&&F.ownerDocument.defaultView||window).getSelection(),F={anchorNode:F.anchorNode,anchorOffset:F.anchorOffset,focusNode:F.focusNode,focusOffset:F.focusOffset}),Hl&&zl(Hl,F)||(Hl=F,F=Xf(Ss,"onSelect"),0<F.length&&(h=new Ai("onSelect","select",null,h,S),u.push({event:h,listeners:F}),h.target=Gc)))}function Ka(u,h){var S={};return S[u.toLowerCase()]=h.toLowerCase(),S["Webkit"+u]="webkit"+h,S["Moz"+u]="moz"+h,S}var Is={animationend:Ka("Animation","AnimationEnd"),animationiteration:Ka("Animation","AnimationIteration"),animationstart:Ka("Animation","AnimationStart"),transitionend:Ka("Transition","TransitionEnd")},Gl={},zf={};l&&(zf=document.createElement("div").style,"AnimationEvent"in window||(delete Is.animationend.animation,delete Is.animationiteration.animation,delete Is.animationstart.animation),"TransitionEvent"in window||delete Is.transitionend.transition);function Vc(u){if(Gl[u])return Gl[u];if(!Is[u])return u;var h=Is[u],S;for(S in h)if(h.hasOwnProperty(S)&&S in zf)return Gl[u]=h[S];return u}var V0=Vc("animationend"),K0=Vc("animationiteration"),q0=Vc("animationstart"),X0=Vc("transitionend"),Y0=new Map,Q0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Co(u,h){Y0.set(u,h),a(h,[u])}for(var Hf=0;Hf<Q0.length;Hf++){var Vl=Q0[Hf],gx=Vl.toLowerCase(),Gf=Vl[0].toUpperCase()+Vl.slice(1);Co(gx,"on"+Gf)}Co(V0,"onAnimationEnd"),Co(K0,"onAnimationIteration"),Co(q0,"onAnimationStart"),Co("dblclick","onDoubleClick"),Co("focusin","onFocus"),Co("focusout","onBlur"),Co(X0,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mx=new Set("cancel close invalid load scroll toggle".split(" ").concat(sl));function Vf(u,h,S){var F=u.type||"unknown-event";u.currentTarget=S,Se(F,h,void 0,u),u.currentTarget=null}function J0(u,h){h=(h&4)!==0;for(var S=0;S<u.length;S++){var F=u[S],U=F.event;F=F.listeners;e:{var J=void 0;if(h)for(var ce=F.length-1;0<=ce;ce--){var Ee=F[ce],Re=Ee.instance,ct=Ee.currentTarget;if(Ee=Ee.listener,Re!==J&&U.isPropagationStopped())break e;Vf(U,Ee,ct),J=Re}else for(ce=0;ce<F.length;ce++){if(Ee=F[ce],Re=Ee.instance,ct=Ee.currentTarget,Ee=Ee.listener,Re!==J&&U.isPropagationStopped())break e;Vf(U,Ee,ct),J=Re}}}if(le)throw u=be,le=!1,be=null,u}function xn(u,h){var S=h[Qf];S===void 0&&(S=h[Qf]=new Set);var F=u+"__bubble";S.has(F)||(Z0(h,u,2,!1),S.add(F))}function Kf(u,h,S){var F=0;h&&(F|=4),Z0(S,u,F,h)}var ud="_reactListening"+Math.random().toString(36).slice(2);function Kl(u){if(!u[ud]){u[ud]=!0,n.forEach(function(S){S!=="selectionchange"&&(mx.has(S)||Kf(S,!1,u),Kf(S,!0,u))});var h=u.nodeType===9?u:u.ownerDocument;h===null||h[ud]||(h[ud]=!0,Kf("selectionchange",!1,h))}}function Z0(u,h,S,F){switch(nx(h)){case 1:var U=Ni;break;case 4:U=_o;break;default:U=Lc}S=U.bind(null,h,S,u),U=void 0,!Fr||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(U=!0),F?U!==void 0?u.addEventListener(h,S,{capture:!0,passive:U}):u.addEventListener(h,S,!0):U!==void 0?u.addEventListener(h,S,{passive:U}):u.addEventListener(h,S,!1)}function qf(u,h,S,F,U){var J=F;if((h&1)===0&&(h&2)===0&&F!==null)e:for(;;){if(F===null)return;var ce=F.tag;if(ce===3||ce===4){var Ee=F.stateNode.containerInfo;if(Ee===U||Ee.nodeType===8&&Ee.parentNode===U)break;if(ce===4)for(ce=F.return;ce!==null;){var Re=ce.tag;if((Re===3||Re===4)&&(Re=ce.stateNode.containerInfo,Re===U||Re.nodeType===8&&Re.parentNode===U))return;ce=ce.return}for(;Ee!==null;){if(ce=il(Ee),ce===null)return;if(Re=ce.tag,Re===5||Re===6){F=J=ce;continue e}Ee=Ee.parentNode}}F=F.return}Xt(function(){var ct=J,Ft=sr(S),Dt=[];e:{var At=Y0.get(u);if(At!==void 0){var rr=Ai,lr=u;switch(u){case"keypress":if(Ol(S)===0)break e;case"keydown":case"keyup":rr=lx;break;case"focusin":lr="focus",rr=Rf;break;case"focusout":lr="blur",rr=Rf;break;case"beforeblur":case"afterblur":rr=Rf;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":rr=Sn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":rr=Fi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":rr=Of;break;case V0:case K0:case q0:rr=M0;break;case X0:rr=Uc;break;case"scroll":rr=sx;break;case"wheel":rr=B0;break;case"copy":case"cut":case"paste":rr=Df;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":rr=Ul}var cr=(h&4)!==0,ms=!cr&&u==="scroll",Ye=cr?At!==null?At+"Capture":null:At;cr=[];for(var Oe=ct,rt;Oe!==null;){rt=Oe;var Ut=rt.stateNode;if(rt.tag===5&&Ut!==null&&(rt=Ut,Ye!==null&&(Ut=pr(Oe,Ye),Ut!=null&&cr.push(Kc(Oe,Ut,rt)))),ms)break;Oe=Oe.return}0<cr.length&&(At=new rr(At,lr,null,S,Ft),Dt.push({event:At,listeners:cr}))}}if((h&7)===0){e:{if(At=u==="mouseover"||u==="pointerover",rr=u==="mouseout"||u==="pointerout",At&&S!==Lt&&(lr=S.relatedTarget||S.fromElement)&&(il(lr)||lr[Ki]))break e;if((rr||At)&&(At=Ft.window===Ft?Ft:(At=Ft.ownerDocument)?At.defaultView||At.parentWindow:window,rr?(lr=S.relatedTarget||S.toElement,rr=ct,lr=lr?il(lr):null,lr!==null&&(ms=ke(lr),lr!==ms||lr.tag!==5&&lr.tag!==6)&&(lr=null)):(rr=null,lr=ct),rr!==lr)){if(cr=Sn,Ut="onMouseLeave",Ye="onMouseEnter",Oe="mouse",(u==="pointerout"||u==="pointerover")&&(cr=Ul,Ut="onPointerLeave",Ye="onPointerEnter",Oe="pointer"),ms=rr==null?At:ds(rr),rt=lr==null?At:ds(lr),At=new cr(Ut,Oe+"leave",rr,S,Ft),At.target=ms,At.relatedTarget=rt,Ut=null,il(Ft)===ct&&(cr=new cr(Ye,Oe+"enter",lr,S,Ft),cr.target=rt,cr.relatedTarget=ms,Ut=cr),ms=Ut,rr&&lr)t:{for(cr=rr,Ye=lr,Oe=0,rt=cr;rt;rt=ql(rt))Oe++;for(rt=0,Ut=Ye;Ut;Ut=ql(Ut))rt++;for(;0<Oe-rt;)cr=ql(cr),Oe--;for(;0<rt-Oe;)Ye=ql(Ye),rt--;for(;Oe--;){if(cr===Ye||Ye!==null&&cr===Ye.alternate)break t;cr=ql(cr),Ye=ql(Ye)}cr=null}else cr=null;rr!==null&&px(Dt,At,rr,cr,!1),lr!==null&&ms!==null&&px(Dt,ms,lr,cr,!0)}}e:{if(At=ct?ds(ct):window,rr=At.nodeName&&At.nodeName.toLowerCase(),rr==="select"||rr==="input"&&At.type==="file")var ur=ui;else if(ko(At))if(zc)ur=H0;else{ur=Pn;var xr=z0}else(rr=At.nodeName)&&rr.toLowerCase()==="input"&&(At.type==="checkbox"||At.type==="radio")&&(ur=$f);if(ur&&(ur=ur(u,ct))){id(Dt,ur,S,Ft);break e}xr&&xr(u,At,ct),u==="focusout"&&(xr=At._wrapperState)&&xr.controlled&&At.type==="number"&&st(At,"number",At.value)}switch(xr=ct?ds(ct):window,u){case"focusin":(ko(xr)||xr.contentEditable==="true")&&(Gc=xr,Ss=ct,Hl=null);break;case"focusout":Hl=Ss=Gc=null;break;case"mousedown":cd=!0;break;case"contextmenu":case"mouseup":case"dragend":cd=!1,Wf(Dt,S,Ft);break;case"selectionchange":if(ld)break;case"keydown":case"keyup":Wf(Dt,S,Ft)}var yr;if(ad)e:{switch(u){case"compositionstart":var Cr="onCompositionStart";break e;case"compositionend":Cr="onCompositionEnd";break e;case"compositionupdate":Cr="onCompositionUpdate";break e}Cr=void 0}else Va?U0(u,S)&&(Cr="onCompositionEnd"):u==="keydown"&&S.keyCode===229&&(Cr="onCompositionStart");Cr&&(Ga&&S.locale!=="ko"&&(Va||Cr!=="onCompositionStart"?Cr==="onCompositionEnd"&&Va&&(yr=td()):(Rs=Ft,Jo="value"in Rs?Rs.value:Rs.textContent,Va=!0)),xr=Xf(ct,Cr),0<xr.length&&(Cr=new Ll(Cr,u,null,S,Ft),Dt.push({event:Cr,listeners:xr}),yr?Cr.data=yr:(yr=Pi(S),yr!==null&&(Cr.data=yr)))),(yr=$c?$0(u,S):fx(u,S))&&(ct=Xf(ct,"onBeforeInput"),0<ct.length&&(Ft=new Ll("onBeforeInput","beforeinput",null,S,Ft),Dt.push({event:Ft,listeners:ct}),Ft.data=yr))}J0(Dt,h)})}function Kc(u,h,S){return{instance:u,listener:h,currentTarget:S}}function Xf(u,h){for(var S=h+"Capture",F=[];u!==null;){var U=u,J=U.stateNode;U.tag===5&&J!==null&&(U=J,J=pr(u,S),J!=null&&F.unshift(Kc(u,J,U)),J=pr(u,h),J!=null&&F.push(Kc(u,J,U))),u=u.return}return F}function ql(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5);return u||null}function px(u,h,S,F,U){for(var J=h._reactName,ce=[];S!==null&&S!==F;){var Ee=S,Re=Ee.alternate,ct=Ee.stateNode;if(Re!==null&&Re===F)break;Ee.tag===5&&ct!==null&&(Ee=ct,U?(Re=pr(S,J),Re!=null&&ce.unshift(Kc(S,Re,Ee))):U||(Re=pr(S,J),Re!=null&&ce.push(Kc(S,Re,Ee)))),S=S.return}ce.length!==0&&u.push({event:h,listeners:ce})}var fv=/\r\n?/g,xx=/\u0000|\uFFFD/g;function eg(u){return(typeof u=="string"?u:""+u).replace(fv,`
`).replace(xx,"")}function dd(u,h,S){if(h=eg(h),eg(u)!==h&&S)throw Error(r(425))}function Xl(){}var tg=null,rg=null;function ng(u,h){return u==="textarea"||u==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var qa=typeof setTimeout=="function"?setTimeout:void 0,sg=typeof clearTimeout=="function"?clearTimeout:void 0,fd=typeof Promise=="function"?Promise:void 0,yx=typeof queueMicrotask=="function"?queueMicrotask:typeof fd<"u"?function(u){return fd.resolve(null).then(u).catch(vx)}:qa;function vx(u){setTimeout(function(){throw u})}function Yf(u,h){var S=h,F=0;do{var U=S.nextSibling;if(u.removeChild(S),U&&U.nodeType===8)if(S=U.data,S==="/$"){if(F===0){u.removeChild(U),Ca(h);return}F--}else S!=="$"&&S!=="$?"&&S!=="$!"||F++;S=U}while(S);Ca(h)}function Vi(u){for(;u!=null;u=u.nextSibling){var h=u.nodeType;if(h===1||h===3)break;if(h===8){if(h=u.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return u}function Yl(u){u=u.previousSibling;for(var h=0;u;){if(u.nodeType===8){var S=u.data;if(S==="$"||S==="$!"||S==="$?"){if(h===0)return u;h--}else S==="/$"&&h++}u=u.previousSibling}return null}var al=Math.random().toString(36).slice(2),fi="__reactFiber$"+al,hd="__reactProps$"+al,Ki="__reactContainer$"+al,Qf="__reactEvents$"+al,wx="__reactListeners$"+al,_x="__reactHandles$"+al;function il(u){var h=u[fi];if(h)return h;for(var S=u.parentNode;S;){if(h=S[Ki]||S[fi]){if(S=h.alternate,h.child!==null||S!==null&&S.child!==null)for(u=Yl(u);u!==null;){if(S=u[fi])return S;u=Yl(u)}return h}u=S,S=u.parentNode}return null}function gd(u){return u=u[fi]||u[Ki],!u||u.tag!==5&&u.tag!==6&&u.tag!==13&&u.tag!==3?null:u}function ds(u){if(u.tag===5||u.tag===6)return u.stateNode;throw Error(r(33))}function ks(u){return u[hd]||null}var Jf=[],Ql=-1;function To(u){return{current:u}}function yn(u){0>Ql||(u.current=Jf[Ql],Jf[Ql]=null,Ql--)}function un(u,h){Ql++,Jf[Ql]=u.current,u.current=h}var qi={},Ms=To(qi),Hs=To(!1),ol=qi;function Jl(u,h){var S=u.type.contextTypes;if(!S)return qi;var F=u.stateNode;if(F&&F.__reactInternalMemoizedUnmaskedChildContext===h)return F.__reactInternalMemoizedMaskedChildContext;var U={},J;for(J in S)U[J]=h[J];return F&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=h,u.__reactInternalMemoizedMaskedChildContext=U),U}function Gs(u){return u=u.childContextTypes,u!=null}function qc(){yn(Hs),yn(Ms)}function ag(u,h,S){if(Ms.current!==qi)throw Error(r(168));un(Ms,h),un(Hs,S)}function Zf(u,h,S){var F=u.stateNode;if(h=h.childContextTypes,typeof F.getChildContext!="function")return S;F=F.getChildContext();for(var U in F)if(!(U in h))throw Error(r(108,ee(u)||"Unknown",U));return H({},S,F)}function Zl(u){return u=(u=u.stateNode)&&u.__reactInternalMemoizedMergedChildContext||qi,ol=Ms.current,un(Ms,u),un(Hs,Hs.current),!0}function bx(u,h,S){var F=u.stateNode;if(!F)throw Error(r(169));S?(u=Zf(u,h,ol),F.__reactInternalMemoizedMergedChildContext=u,yn(Hs),yn(Ms),un(Ms,u)):yn(Hs),un(Hs,S)}var Xi=null,Xc=!1,eh=!1;function md(u){Xi===null?Xi=[u]:Xi.push(u)}function Eo(u){Xc=!0,md(u)}function ll(){if(!eh&&Xi!==null){eh=!0;var u=0,h=Kr;try{var S=Xi;for(Kr=1;u<S.length;u++){var F=S[u];do F=F(!0);while(F!==null)}Xi=null,Xc=!1}catch(U){throw Xi!==null&&(Xi=Xi.slice(u+1)),Ce(Bt,ll),U}finally{Kr=h,eh=!1}}return null}var oa=[],ec=0,cl=null,ul=0,la=[],ca=0,dl=null,Xa=1,En="";function tc(u,h){oa[ec++]=ul,oa[ec++]=cl,cl=u,ul=h}function Sx(u,h,S){la[ca++]=Xa,la[ca++]=En,la[ca++]=dl,dl=u;var F=Xa;u=En;var U=32-jt(F)-1;F&=~(1<<U),S+=1;var J=32-jt(h)+U;if(30<J){var ce=U-U%5;J=(F&(1<<ce)-1).toString(32),F>>=ce,U-=ce,Xa=1<<32-jt(h)+U|S<<U|F,En=J+u}else Xa=1<<J|S<<U|F,En=u}function Yc(u){u.return!==null&&(tc(u,1),Sx(u,1,0))}function Cs(u){for(;u===cl;)cl=oa[--ec],oa[ec]=null,ul=oa[--ec],oa[ec]=null;for(;u===dl;)dl=la[--ca],la[ca]=null,En=la[--ca],la[ca]=null,Xa=la[--ca],la[ca]=null}var Ya=null,Zt=null,an=!1,Qa=null;function ig(u,h){var S=ro(5,null,null,0);S.elementType="DELETED",S.stateNode=h,S.return=u,h=u.deletions,h===null?(u.deletions=[S],u.flags|=16):h.push(S)}function kx(u,h){switch(u.tag){case 5:var S=u.type;return h=h.nodeType!==1||S.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(u.stateNode=h,Ya=u,Zt=Vi(h.firstChild),!0):!1;case 6:return h=u.pendingProps===""||h.nodeType!==3?null:h,h!==null?(u.stateNode=h,Ya=u,Zt=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(S=dl!==null?{id:Xa,overflow:En}:null,u.memoizedState={dehydrated:h,treeContext:S,retryLane:1073741824},S=ro(18,null,null,0),S.stateNode=h,S.return=u,u.child=S,Ya=u,Zt=null,!0):!1;default:return!1}}function rc(u){return(u.mode&1)!==0&&(u.flags&128)===0}function Qc(u){if(an){var h=Zt;if(h){var S=h;if(!kx(u,h)){if(rc(u))throw Error(r(418));h=Vi(S.nextSibling);var F=Ya;h&&kx(u,h)?ig(F,S):(u.flags=u.flags&-4097|2,an=!1,Ya=u)}}else{if(rc(u))throw Error(r(418));u.flags=u.flags&-4097|2,an=!1,Ya=u}}}function th(u){for(u=u.return;u!==null&&u.tag!==5&&u.tag!==3&&u.tag!==13;)u=u.return;Ya=u}function pd(u){if(u!==Ya)return!1;if(!an)return th(u),an=!0,!1;var h;if((h=u.tag!==3)&&!(h=u.tag!==5)&&(h=u.type,h=h!=="head"&&h!=="body"&&!ng(u.type,u.memoizedProps)),h&&(h=Zt)){if(rc(u))throw og(),Error(r(418));for(;h;)ig(u,h),h=Vi(h.nextSibling)}if(th(u),u.tag===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));e:{for(u=u.nextSibling,h=0;u;){if(u.nodeType===8){var S=u.data;if(S==="/$"){if(h===0){Zt=Vi(u.nextSibling);break e}h--}else S!=="$"&&S!=="$!"&&S!=="$?"||h++}u=u.nextSibling}Zt=null}}else Zt=Ya?Vi(u.stateNode.nextSibling):null;return!0}function og(){for(var u=Zt;u;)u=Vi(u.nextSibling)}function nc(){Zt=Ya=null,an=!1}function xd(u){Qa===null?Qa=[u]:Qa.push(u)}var lg=N.ReactCurrentBatchConfig;function Hn(u,h,S){if(u=S.ref,u!==null&&typeof u!="function"&&typeof u!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(r(309));var F=S.stateNode}if(!F)throw Error(r(147,u));var U=F,J=""+u;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===J?h.ref:(h=function(ce){var Ee=U.refs;ce===null?delete Ee[J]:Ee[J]=ce},h._stringRef=J,h)}if(typeof u!="string")throw Error(r(284));if(!S._owner)throw Error(r(290,u))}return u}function Na(u,h){throw u=Object.prototype.toString.call(h),Error(r(31,u==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":u))}function Ri(u){var h=u._init;return h(u._payload)}function rh(u){function h(Ye,Oe){if(u){var rt=Ye.deletions;rt===null?(Ye.deletions=[Oe],Ye.flags|=16):rt.push(Oe)}}function S(Ye,Oe){if(!u)return null;for(;Oe!==null;)h(Ye,Oe),Oe=Oe.sibling;return null}function F(Ye,Oe){for(Ye=new Map;Oe!==null;)Oe.key!==null?Ye.set(Oe.key,Oe):Ye.set(Oe.index,Oe),Oe=Oe.sibling;return Ye}function U(Ye,Oe){return Ye=xu(Ye,Oe),Ye.index=0,Ye.sibling=null,Ye}function J(Ye,Oe,rt){return Ye.index=rt,u?(rt=Ye.alternate,rt!==null?(rt=rt.index,rt<Oe?(Ye.flags|=2,Oe):rt):(Ye.flags|=2,Oe)):(Ye.flags|=1048576,Oe)}function ce(Ye){return u&&Ye.alternate===null&&(Ye.flags|=2),Ye}function Ee(Ye,Oe,rt,Ut){return Oe===null||Oe.tag!==6?(Oe=Rv(rt,Ye.mode,Ut),Oe.return=Ye,Oe):(Oe=U(Oe,rt),Oe.return=Ye,Oe)}function Re(Ye,Oe,rt,Ut){var ur=rt.type;return ur===R?Ft(Ye,Oe,rt.props.children,Ut,rt.key):Oe!==null&&(Oe.elementType===ur||typeof ur=="object"&&ur!==null&&ur.$$typeof===ne&&Ri(ur)===Oe.type)?(Ut=U(Oe,rt.props),Ut.ref=Hn(Ye,Oe,rt),Ut.return=Ye,Ut):(Ut=Gx(rt.type,rt.key,rt.props,null,Ye.mode,Ut),Ut.ref=Hn(Ye,Oe,rt),Ut.return=Ye,Ut)}function ct(Ye,Oe,rt,Ut){return Oe===null||Oe.tag!==4||Oe.stateNode.containerInfo!==rt.containerInfo||Oe.stateNode.implementation!==rt.implementation?(Oe=Dv(rt,Ye.mode,Ut),Oe.return=Ye,Oe):(Oe=U(Oe,rt.children||[]),Oe.return=Ye,Oe)}function Ft(Ye,Oe,rt,Ut,ur){return Oe===null||Oe.tag!==7?(Oe=Nd(rt,Ye.mode,Ut,ur),Oe.return=Ye,Oe):(Oe=U(Oe,rt),Oe.return=Ye,Oe)}function Dt(Ye,Oe,rt){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return Oe=Rv(""+Oe,Ye.mode,rt),Oe.return=Ye,Oe;if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case A:return rt=Gx(Oe.type,Oe.key,Oe.props,null,Ye.mode,rt),rt.ref=Hn(Ye,null,Oe),rt.return=Ye,rt;case P:return Oe=Dv(Oe,Ye.mode,rt),Oe.return=Ye,Oe;case ne:var Ut=Oe._init;return Dt(Ye,Ut(Oe._payload),rt)}if(Ie(Oe)||L(Oe))return Oe=Nd(Oe,Ye.mode,rt,null),Oe.return=Ye,Oe;Na(Ye,Oe)}return null}function At(Ye,Oe,rt,Ut){var ur=Oe!==null?Oe.key:null;if(typeof rt=="string"&&rt!==""||typeof rt=="number")return ur!==null?null:Ee(Ye,Oe,""+rt,Ut);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case A:return rt.key===ur?Re(Ye,Oe,rt,Ut):null;case P:return rt.key===ur?ct(Ye,Oe,rt,Ut):null;case ne:return ur=rt._init,At(Ye,Oe,ur(rt._payload),Ut)}if(Ie(rt)||L(rt))return ur!==null?null:Ft(Ye,Oe,rt,Ut,null);Na(Ye,rt)}return null}function rr(Ye,Oe,rt,Ut,ur){if(typeof Ut=="string"&&Ut!==""||typeof Ut=="number")return Ye=Ye.get(rt)||null,Ee(Oe,Ye,""+Ut,ur);if(typeof Ut=="object"&&Ut!==null){switch(Ut.$$typeof){case A:return Ye=Ye.get(Ut.key===null?rt:Ut.key)||null,Re(Oe,Ye,Ut,ur);case P:return Ye=Ye.get(Ut.key===null?rt:Ut.key)||null,ct(Oe,Ye,Ut,ur);case ne:var xr=Ut._init;return rr(Ye,Oe,rt,xr(Ut._payload),ur)}if(Ie(Ut)||L(Ut))return Ye=Ye.get(rt)||null,Ft(Oe,Ye,Ut,ur,null);Na(Oe,Ut)}return null}function lr(Ye,Oe,rt,Ut){for(var ur=null,xr=null,yr=Oe,Cr=Oe=0,Qs=null;yr!==null&&Cr<rt.length;Cr++){yr.index>Cr?(Qs=yr,yr=null):Qs=yr.sibling;var en=At(Ye,yr,rt[Cr],Ut);if(en===null){yr===null&&(yr=Qs);break}u&&yr&&en.alternate===null&&h(Ye,yr),Oe=J(en,Oe,Cr),xr===null?ur=en:xr.sibling=en,xr=en,yr=Qs}if(Cr===rt.length)return S(Ye,yr),an&&tc(Ye,Cr),ur;if(yr===null){for(;Cr<rt.length;Cr++)yr=Dt(Ye,rt[Cr],Ut),yr!==null&&(Oe=J(yr,Oe,Cr),xr===null?ur=yr:xr.sibling=yr,xr=yr);return an&&tc(Ye,Cr),ur}for(yr=F(Ye,yr);Cr<rt.length;Cr++)Qs=rr(yr,Ye,Cr,rt[Cr],Ut),Qs!==null&&(u&&Qs.alternate!==null&&yr.delete(Qs.key===null?Cr:Qs.key),Oe=J(Qs,Oe,Cr),xr===null?ur=Qs:xr.sibling=Qs,xr=Qs);return u&&yr.forEach(function(yu){return h(Ye,yu)}),an&&tc(Ye,Cr),ur}function cr(Ye,Oe,rt,Ut){var ur=L(rt);if(typeof ur!="function")throw Error(r(150));if(rt=ur.call(rt),rt==null)throw Error(r(151));for(var xr=ur=null,yr=Oe,Cr=Oe=0,Qs=null,en=rt.next();yr!==null&&!en.done;Cr++,en=rt.next()){yr.index>Cr?(Qs=yr,yr=null):Qs=yr.sibling;var yu=At(Ye,yr,en.value,Ut);if(yu===null){yr===null&&(yr=Qs);break}u&&yr&&yu.alternate===null&&h(Ye,yr),Oe=J(yu,Oe,Cr),xr===null?ur=yu:xr.sibling=yu,xr=yu,yr=Qs}if(en.done)return S(Ye,yr),an&&tc(Ye,Cr),ur;if(yr===null){for(;!en.done;Cr++,en=rt.next())en=Dt(Ye,en.value,Ut),en!==null&&(Oe=J(en,Oe,Cr),xr===null?ur=en:xr.sibling=en,xr=en);return an&&tc(Ye,Cr),ur}for(yr=F(Ye,yr);!en.done;Cr++,en=rt.next())en=rr(yr,Ye,Cr,en.value,Ut),en!==null&&(u&&en.alternate!==null&&yr.delete(en.key===null?Cr:en.key),Oe=J(en,Oe,Cr),xr===null?ur=en:xr.sibling=en,xr=en);return u&&yr.forEach(function(PP){return h(Ye,PP)}),an&&tc(Ye,Cr),ur}function ms(Ye,Oe,rt,Ut){if(typeof rt=="object"&&rt!==null&&rt.type===R&&rt.key===null&&(rt=rt.props.children),typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case A:e:{for(var ur=rt.key,xr=Oe;xr!==null;){if(xr.key===ur){if(ur=rt.type,ur===R){if(xr.tag===7){S(Ye,xr.sibling),Oe=U(xr,rt.props.children),Oe.return=Ye,Ye=Oe;break e}}else if(xr.elementType===ur||typeof ur=="object"&&ur!==null&&ur.$$typeof===ne&&Ri(ur)===xr.type){S(Ye,xr.sibling),Oe=U(xr,rt.props),Oe.ref=Hn(Ye,xr,rt),Oe.return=Ye,Ye=Oe;break e}S(Ye,xr);break}else h(Ye,xr);xr=xr.sibling}rt.type===R?(Oe=Nd(rt.props.children,Ye.mode,Ut,rt.key),Oe.return=Ye,Ye=Oe):(Ut=Gx(rt.type,rt.key,rt.props,null,Ye.mode,Ut),Ut.ref=Hn(Ye,Oe,rt),Ut.return=Ye,Ye=Ut)}return ce(Ye);case P:e:{for(xr=rt.key;Oe!==null;){if(Oe.key===xr)if(Oe.tag===4&&Oe.stateNode.containerInfo===rt.containerInfo&&Oe.stateNode.implementation===rt.implementation){S(Ye,Oe.sibling),Oe=U(Oe,rt.children||[]),Oe.return=Ye,Ye=Oe;break e}else{S(Ye,Oe);break}else h(Ye,Oe);Oe=Oe.sibling}Oe=Dv(rt,Ye.mode,Ut),Oe.return=Ye,Ye=Oe}return ce(Ye);case ne:return xr=rt._init,ms(Ye,Oe,xr(rt._payload),Ut)}if(Ie(rt))return lr(Ye,Oe,rt,Ut);if(L(rt))return cr(Ye,Oe,rt,Ut);Na(Ye,rt)}return typeof rt=="string"&&rt!==""||typeof rt=="number"?(rt=""+rt,Oe!==null&&Oe.tag===6?(S(Ye,Oe.sibling),Oe=U(Oe,rt),Oe.return=Ye,Ye=Oe):(S(Ye,Oe),Oe=Rv(rt,Ye.mode,Ut),Oe.return=Ye,Ye=Oe),ce(Ye)):S(Ye,Oe)}return ms}var sc=rh(!0),hi=rh(!1),yd=To(null),Ja=null,Jc=null,nh=null;function sh(){nh=Jc=Ja=null}function ah(u){var h=yd.current;yn(yd),u._currentValue=h}function ih(u,h,S){for(;u!==null;){var F=u.alternate;if((u.childLanes&h)!==h?(u.childLanes|=h,F!==null&&(F.childLanes|=h)):F!==null&&(F.childLanes&h)!==h&&(F.childLanes|=h),u===S)break;u=u.return}}function No(u,h){Ja=u,nh=Jc=null,u=u.dependencies,u!==null&&u.firstContext!==null&&((u.lanes&h)!==0&&(se=!0),u.firstContext=null)}function ua(u){var h=u._currentValue;if(nh!==u)if(u={context:u,memoizedValue:h,next:null},Jc===null){if(Ja===null)throw Error(r(308));Jc=u,Ja.dependencies={lanes:0,firstContext:u}}else Jc=Jc.next=u;return h}var Yi=null;function Zc(u){Yi===null?Yi=[u]:Yi.push(u)}function vd(u,h,S,F){var U=h.interleaved;return U===null?(S.next=S,Zc(h)):(S.next=U.next,U.next=S),h.interleaved=S,Za(u,F)}function Za(u,h){u.lanes|=h;var S=u.alternate;for(S!==null&&(S.lanes|=h),S=u,u=u.return;u!==null;)u.childLanes|=h,S=u.alternate,S!==null&&(S.childLanes|=h),S=u,u=u.return;return S.tag===3?S.stateNode:null}var Qi=!1;function wd(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function oh(u,h){u=u.updateQueue,h.updateQueue===u&&(h.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,effects:u.effects})}function Ji(u,h){return{eventTime:u,lane:h,tag:0,payload:null,callback:null,next:null}}function Zi(u,h,S){var F=u.updateQueue;if(F===null)return null;if(F=F.shared,(Yr&2)!==0){var U=F.pending;return U===null?h.next=h:(h.next=U.next,U.next=h),F.pending=h,Za(u,S)}return U=F.interleaved,U===null?(h.next=h,Zc(F)):(h.next=U.next,U.next=h),F.interleaved=h,Za(u,S)}function lh(u,h,S){if(h=h.updateQueue,h!==null&&(h=h.shared,(S&4194240)!==0)){var F=h.lanes;F&=u.pendingLanes,S|=F,h.lanes=S,D0(u,S)}}function _d(u,h){var S=u.updateQueue,F=u.alternate;if(F!==null&&(F=F.updateQueue,S===F)){var U=null,J=null;if(S=S.firstBaseUpdate,S!==null){do{var ce={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};J===null?U=J=ce:J=J.next=ce,S=S.next}while(S!==null);J===null?U=J=h:J=J.next=h}else U=J=h;S={baseState:F.baseState,firstBaseUpdate:U,lastBaseUpdate:J,shared:F.shared,effects:F.effects},u.updateQueue=S;return}u=S.lastBaseUpdate,u===null?S.firstBaseUpdate=h:u.next=h,S.lastBaseUpdate=h}function eu(u,h,S,F){var U=u.updateQueue;Qi=!1;var J=U.firstBaseUpdate,ce=U.lastBaseUpdate,Ee=U.shared.pending;if(Ee!==null){U.shared.pending=null;var Re=Ee,ct=Re.next;Re.next=null,ce===null?J=ct:ce.next=ct,ce=Re;var Ft=u.alternate;Ft!==null&&(Ft=Ft.updateQueue,Ee=Ft.lastBaseUpdate,Ee!==ce&&(Ee===null?Ft.firstBaseUpdate=ct:Ee.next=ct,Ft.lastBaseUpdate=Re))}if(J!==null){var Dt=U.baseState;ce=0,Ft=ct=Re=null,Ee=J;do{var At=Ee.lane,rr=Ee.eventTime;if((F&At)===At){Ft!==null&&(Ft=Ft.next={eventTime:rr,lane:0,tag:Ee.tag,payload:Ee.payload,callback:Ee.callback,next:null});e:{var lr=u,cr=Ee;switch(At=h,rr=S,cr.tag){case 1:if(lr=cr.payload,typeof lr=="function"){Dt=lr.call(rr,Dt,At);break e}Dt=lr;break e;case 3:lr.flags=lr.flags&-65537|128;case 0:if(lr=cr.payload,At=typeof lr=="function"?lr.call(rr,Dt,At):lr,At==null)break e;Dt=H({},Dt,At);break e;case 2:Qi=!0}}Ee.callback!==null&&Ee.lane!==0&&(u.flags|=64,At=U.effects,At===null?U.effects=[Ee]:At.push(Ee))}else rr={eventTime:rr,lane:At,tag:Ee.tag,payload:Ee.payload,callback:Ee.callback,next:null},Ft===null?(ct=Ft=rr,Re=Dt):Ft=Ft.next=rr,ce|=At;if(Ee=Ee.next,Ee===null){if(Ee=U.shared.pending,Ee===null)break;At=Ee,Ee=At.next,At.next=null,U.lastBaseUpdate=At,U.shared.pending=null}}while(!0);if(Ft===null&&(Re=Dt),U.baseState=Re,U.firstBaseUpdate=ct,U.lastBaseUpdate=Ft,h=U.shared.interleaved,h!==null){U=h;do ce|=U.lane,U=U.next;while(U!==h)}else J===null&&(U.shared.lanes=0);kd|=ce,u.lanes=ce,u.memoizedState=Dt}}function Un(u,h,S){if(u=h.effects,h.effects=null,u!==null)for(h=0;h<u.length;h++){var F=u[h],U=F.callback;if(U!==null){if(F.callback=null,F=S,typeof U!="function")throw Error(r(191,U));U.call(F)}}}var Nr={},dn=To(Nr),Nn=To(Nr),Gn=To(Nr);function fs(u){if(u===Nr)throw Error(r(174));return u}function fl(u,h){switch(un(Gn,h),un(Nn,u),un(dn,Nr),u=h.nodeType,u){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:lt(null,"");break;default:u=u===8?h.parentNode:h,h=u.namespaceURI||null,u=u.tagName,h=lt(h,u)}yn(dn),un(dn,h)}function An(){yn(dn),yn(Nn),yn(Gn)}function tu(u){fs(Gn.current);var h=fs(dn.current),S=lt(h,u.type);h!==S&&(un(Nn,u),un(dn,S))}function Ao(u){Nn.current===u&&(yn(dn),yn(Nn))}var vn=To(0);function ru(u){for(var h=u;h!==null;){if(h.tag===13){var S=h.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===u)break;for(;h.sibling===null;){if(h.return===null||h.return===u)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var ac=[];function Vs(){for(var u=0;u<ac.length;u++)ac[u]._workInProgressVersionPrimary=null;ac.length=0}var nu=N.ReactCurrentDispatcher,bd=N.ReactCurrentBatchConfig,da=0,cn=null,$n=null,Qn=null,Di=!1,hl=!1,gi=0,ch=0;function Jn(){throw Error(r(321))}function Sd(u,h){if(h===null)return!1;for(var S=0;S<h.length&&S<u.length;S++)if(!Ea(u[S],h[S]))return!1;return!0}function su(u,h,S,F,U,J){if(da=J,cn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,nu.current=u===null||u.memoizedState===null?gv:pl,u=S(F,U),hl){J=0;do{if(hl=!1,gi=0,25<=J)throw Error(r(301));J+=1,Qn=$n=null,h.updateQueue=null,nu.current=gh,u=S(F,U)}while(hl)}if(nu.current=lu,h=$n!==null&&$n.next!==null,da=0,Qn=$n=cn=null,Di=!1,h)throw Error(r(300));return u}function au(){var u=gi!==0;return gi=0,u}function kn(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qn===null?cn.memoizedState=Qn=u:Qn=Qn.next=u,Qn}function hs(){if($n===null){var u=cn.alternate;u=u!==null?u.memoizedState:null}else u=$n.next;var h=Qn===null?cn.memoizedState:Qn.next;if(h!==null)Qn=h,$n=u;else{if(u===null)throw Error(r(310));$n=u,u={memoizedState:$n.memoizedState,baseState:$n.baseState,baseQueue:$n.baseQueue,queue:$n.queue,next:null},Qn===null?cn.memoizedState=Qn=u:Qn=Qn.next=u}return Qn}function Ks(u,h){return typeof h=="function"?h(u):h}function qs(u){var h=hs(),S=h.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=u;var F=$n,U=F.baseQueue,J=S.pending;if(J!==null){if(U!==null){var ce=U.next;U.next=J.next,J.next=ce}F.baseQueue=U=J,S.pending=null}if(U!==null){J=U.next,F=F.baseState;var Ee=ce=null,Re=null,ct=J;do{var Ft=ct.lane;if((da&Ft)===Ft)Re!==null&&(Re=Re.next={lane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),F=ct.hasEagerState?ct.eagerState:u(F,ct.action);else{var Dt={lane:Ft,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null};Re===null?(Ee=Re=Dt,ce=F):Re=Re.next=Dt,cn.lanes|=Ft,kd|=Ft}ct=ct.next}while(ct!==null&&ct!==J);Re===null?ce=F:Re.next=Ee,Ea(F,h.memoizedState)||(se=!0),h.memoizedState=F,h.baseState=ce,h.baseQueue=Re,S.lastRenderedState=F}if(u=S.interleaved,u!==null){U=u;do J=U.lane,cn.lanes|=J,kd|=J,U=U.next;while(U!==u)}else U===null&&(S.lanes=0);return[h.memoizedState,S.dispatch]}function uh(u){var h=hs(),S=h.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=u;var F=S.dispatch,U=S.pending,J=h.memoizedState;if(U!==null){S.pending=null;var ce=U=U.next;do J=u(J,ce.action),ce=ce.next;while(ce!==U);Ea(J,h.memoizedState)||(se=!0),h.memoizedState=J,h.baseQueue===null&&(h.baseState=J),S.lastRenderedState=J}return[J,F]}function dh(){}function fh(u,h){var S=cn,F=hs(),U=h(),J=!Ea(F.memoizedState,U);if(J&&(F.memoizedState=U,se=!0),F=F.queue,fg(cg.bind(null,S,F,u),[u]),F.getSnapshot!==h||J||Qn!==null&&Qn.memoizedState.tag&1){if(S.flags|=2048,iu(9,jo.bind(null,S,F,U,h),void 0,null),Ys===null)throw Error(r(349));(da&30)!==0||Cx(S,h,U)}return U}function Cx(u,h,S){u.flags|=16384,u={getSnapshot:h,value:S},h=cn.updateQueue,h===null?(h={lastEffect:null,stores:null},cn.updateQueue=h,h.stores=[u]):(S=h.stores,S===null?h.stores=[u]:S.push(u))}function jo(u,h,S,F){h.value=S,h.getSnapshot=F,ug(h)&&hh(u)}function cg(u,h,S){return S(function(){ug(h)&&hh(u)})}function ug(u){var h=u.getSnapshot;u=u.value;try{var S=h();return!Ea(u,S)}catch{return!0}}function hh(u){var h=Za(u,1);h!==null&&Do(h,u,1,-1)}function gl(u){var h=kn();return typeof u=="function"&&(u=u()),h.memoizedState=h.baseState=u,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:u},h.queue=u,u=u.dispatch=Fx.bind(null,cn,u),[h.memoizedState,u]}function iu(u,h,S,F){return u={tag:u,create:h,destroy:S,deps:F,next:null},h=cn.updateQueue,h===null?(h={lastEffect:null,stores:null},cn.updateQueue=h,h.lastEffect=u.next=u):(S=h.lastEffect,S===null?h.lastEffect=u.next=u:(F=S.next,S.next=u,u.next=F,h.lastEffect=u)),u}function dg(){return hs().memoizedState}function ou(u,h,S,F){var U=kn();cn.flags|=u,U.memoizedState=iu(1|h,S,void 0,F===void 0?null:F)}function ic(u,h,S,F){var U=hs();F=F===void 0?null:F;var J=void 0;if($n!==null){var ce=$n.memoizedState;if(J=ce.destroy,F!==null&&Sd(F,ce.deps)){U.memoizedState=iu(h,S,J,F);return}}cn.flags|=u,U.memoizedState=iu(1|h,S,J,F)}function Tx(u,h){return ou(8390656,8,u,h)}function fg(u,h){return ic(2048,8,u,h)}function hg(u,h){return ic(4,2,u,h)}function gg(u,h){return ic(4,4,u,h)}function ml(u,h){if(typeof h=="function")return u=u(),h(u),function(){h(null)};if(h!=null)return u=u(),h.current=u,function(){h.current=null}}function Ex(u,h,S){return S=S!=null?S.concat([u]):null,ic(4,4,ml.bind(null,h,u),S)}function Fo(){}function mg(u,h){var S=hs();h=h===void 0?null:h;var F=S.memoizedState;return F!==null&&h!==null&&Sd(h,F[1])?F[0]:(S.memoizedState=[u,h],u)}function Cn(u,h){var S=hs();h=h===void 0?null:h;var F=S.memoizedState;return F!==null&&h!==null&&Sd(h,F[1])?F[0]:(u=u(),S.memoizedState=[u,h],u)}function Nx(u,h,S){return(da&21)===0?(u.baseState&&(u.baseState=!1,se=!0),u.memoizedState=S):(Ea(S,h)||(S=dr(),cn.lanes|=S,kd|=S,u.baseState=!0),h)}function Ax(u,h){var S=Kr;Kr=S!==0&&4>S?S:4,u(!0);var F=bd.transition;bd.transition={};try{u(!1),h()}finally{Kr=S,bd.transition=F}}function jx(){return hs().memoizedState}function hv(u,h,S){var F=mu(u);if(S={lane:F,action:S,hasEagerState:!1,eagerState:null,next:null},pg(u))Px(h,S);else if(S=vd(u,h,S,F),S!==null){var U=ti();Do(S,u,F,U),ei(S,h,F)}}function Fx(u,h,S){var F=mu(u),U={lane:F,action:S,hasEagerState:!1,eagerState:null,next:null};if(pg(u))Px(h,U);else{var J=u.alternate;if(u.lanes===0&&(J===null||J.lanes===0)&&(J=h.lastRenderedReducer,J!==null))try{var ce=h.lastRenderedState,Ee=J(ce,S);if(U.hasEagerState=!0,U.eagerState=Ee,Ea(Ee,ce)){var Re=h.interleaved;Re===null?(U.next=U,Zc(h)):(U.next=Re.next,Re.next=U),h.interleaved=U;return}}catch{}finally{}S=vd(u,h,U,F),S!==null&&(U=ti(),Do(S,u,F,U),ei(S,h,F))}}function pg(u){var h=u.alternate;return u===cn||h!==null&&h===cn}function Px(u,h){hl=Di=!0;var S=u.pending;S===null?h.next=h:(h.next=S.next,S.next=h),u.pending=h}function ei(u,h,S){if((S&4194240)!==0){var F=h.lanes;F&=u.pendingLanes,S|=F,h.lanes=S,D0(u,S)}}var lu={readContext:ua,useCallback:Jn,useContext:Jn,useEffect:Jn,useImperativeHandle:Jn,useInsertionEffect:Jn,useLayoutEffect:Jn,useMemo:Jn,useReducer:Jn,useRef:Jn,useState:Jn,useDebugValue:Jn,useDeferredValue:Jn,useTransition:Jn,useMutableSource:Jn,useSyncExternalStore:Jn,useId:Jn,unstable_isNewReconciler:!1},gv={readContext:ua,useCallback:function(u,h){return kn().memoizedState=[u,h===void 0?null:h],u},useContext:ua,useEffect:Tx,useImperativeHandle:function(u,h,S){return S=S!=null?S.concat([u]):null,ou(4194308,4,ml.bind(null,h,u),S)},useLayoutEffect:function(u,h){return ou(4194308,4,u,h)},useInsertionEffect:function(u,h){return ou(4,2,u,h)},useMemo:function(u,h){var S=kn();return h=h===void 0?null:h,u=u(),S.memoizedState=[u,h],u},useReducer:function(u,h,S){var F=kn();return h=S!==void 0?S(h):h,F.memoizedState=F.baseState=h,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:h},F.queue=u,u=u.dispatch=hv.bind(null,cn,u),[F.memoizedState,u]},useRef:function(u){var h=kn();return u={current:u},h.memoizedState=u},useState:gl,useDebugValue:Fo,useDeferredValue:function(u){return kn().memoizedState=u},useTransition:function(){var u=gl(!1),h=u[0];return u=Ax.bind(null,u[1]),kn().memoizedState=u,[h,u]},useMutableSource:function(){},useSyncExternalStore:function(u,h,S){var F=cn,U=kn();if(an){if(S===void 0)throw Error(r(407));S=S()}else{if(S=h(),Ys===null)throw Error(r(349));(da&30)!==0||Cx(F,h,S)}U.memoizedState=S;var J={value:S,getSnapshot:h};return U.queue=J,Tx(cg.bind(null,F,J,u),[u]),F.flags|=2048,iu(9,jo.bind(null,F,J,S,h),void 0,null),S},useId:function(){var u=kn(),h=Ys.identifierPrefix;if(an){var S=En,F=Xa;S=(F&~(1<<32-jt(F)-1)).toString(32)+S,h=":"+h+"R"+S,S=gi++,0<S&&(h+="H"+S.toString(32)),h+=":"}else S=ch++,h=":"+h+"r"+S.toString(32)+":";return u.memoizedState=h},unstable_isNewReconciler:!1},pl={readContext:ua,useCallback:mg,useContext:ua,useEffect:fg,useImperativeHandle:Ex,useInsertionEffect:hg,useLayoutEffect:gg,useMemo:Cn,useReducer:qs,useRef:dg,useState:function(){return qs(Ks)},useDebugValue:Fo,useDeferredValue:function(u){var h=hs();return Nx(h,$n.memoizedState,u)},useTransition:function(){var u=qs(Ks)[0],h=hs().memoizedState;return[u,h]},useMutableSource:dh,useSyncExternalStore:fh,useId:jx,unstable_isNewReconciler:!1},gh={readContext:ua,useCallback:mg,useContext:ua,useEffect:fg,useImperativeHandle:Ex,useInsertionEffect:hg,useLayoutEffect:gg,useMemo:Cn,useReducer:uh,useRef:dg,useState:function(){return uh(Ks)},useDebugValue:Fo,useDeferredValue:function(u){var h=hs();return $n===null?h.memoizedState=u:Nx(h,$n.memoizedState,u)},useTransition:function(){var u=uh(Ks)[0],h=hs().memoizedState;return[u,h]},useMutableSource:dh,useSyncExternalStore:fh,useId:jx,unstable_isNewReconciler:!1};function Os(u,h){if(u&&u.defaultProps){h=H({},h),u=u.defaultProps;for(var S in u)h[S]===void 0&&(h[S]=u[S]);return h}return h}function cu(u,h,S,F){h=u.memoizedState,S=S(F,h),S=S==null?h:H({},h,S),u.memoizedState=S,u.lanes===0&&(u.updateQueue.baseState=S)}var uu={isMounted:function(u){return(u=u._reactInternals)?ke(u)===u:!1},enqueueSetState:function(u,h,S){u=u._reactInternals;var F=ti(),U=mu(u),J=Ji(F,U);J.payload=h,S!=null&&(J.callback=S),h=Zi(u,J,U),h!==null&&(Do(h,u,U,F),lh(h,u,U))},enqueueReplaceState:function(u,h,S){u=u._reactInternals;var F=ti(),U=mu(u),J=Ji(F,U);J.tag=1,J.payload=h,S!=null&&(J.callback=S),h=Zi(u,J,U),h!==null&&(Do(h,u,U,F),lh(h,u,U))},enqueueForceUpdate:function(u,h){u=u._reactInternals;var S=ti(),F=mu(u),U=Ji(S,F);U.tag=2,h!=null&&(U.callback=h),h=Zi(u,U,F),h!==null&&(Do(h,u,F,S),lh(h,u,F))}};function mh(u,h,S,F,U,J,ce){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(F,J,ce):h.prototype&&h.prototype.isPureReactComponent?!zl(S,F)||!zl(U,J):!0}function Rx(u,h,S){var F=!1,U=qi,J=h.contextType;return typeof J=="object"&&J!==null?J=ua(J):(U=Gs(h)?ol:Ms.current,F=h.contextTypes,J=(F=F!=null)?Jl(u,U):qi),h=new h(S,J),u.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=uu,u.stateNode=h,h._reactInternals=u,F&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=U,u.__reactInternalMemoizedMaskedChildContext=J),h}function xg(u,h,S,F){u=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(S,F),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(S,F),h.state!==u&&uu.enqueueReplaceState(h,h.state,null)}function ph(u,h,S,F){var U=u.stateNode;U.props=S,U.state=u.memoizedState,U.refs={},wd(u);var J=h.contextType;typeof J=="object"&&J!==null?U.context=ua(J):(J=Gs(h)?ol:Ms.current,U.context=Jl(u,J)),U.state=u.memoizedState,J=h.getDerivedStateFromProps,typeof J=="function"&&(cu(u,h,J,S),U.state=u.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(h=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),h!==U.state&&uu.enqueueReplaceState(U,U.state,null),eu(u,S,U,F),U.state=u.memoizedState),typeof U.componentDidMount=="function"&&(u.flags|=4194308)}function oc(u,h){try{var S="",F=h;do S+=Y(F),F=F.return;while(F);var U=S}catch(J){U=`
Error generating stack: `+J.message+`
`+J.stack}return{value:u,source:h,stack:U,digest:null}}function xh(u,h,S){return{value:u,source:null,stack:S??null,digest:h??null}}function du(u,h){try{console.error(h.value)}catch(S){setTimeout(function(){throw S})}}var mv=typeof WeakMap=="function"?WeakMap:Map;function Dx(u,h,S){S=Ji(-1,S),S.tag=3,S.payload={element:null};var F=h.value;return S.callback=function(){Bx||(Bx=!0,Cv=F),du(u,h)},S}function m(u,h,S){S=Ji(-1,S),S.tag=3;var F=u.type.getDerivedStateFromError;if(typeof F=="function"){var U=h.value;S.payload=function(){return F(U)},S.callback=function(){du(u,h)}}var J=u.stateNode;return J!==null&&typeof J.componentDidCatch=="function"&&(S.callback=function(){du(u,h),typeof F!="function"&&(hu===null?hu=new Set([this]):hu.add(this));var ce=h.stack;this.componentDidCatch(h.value,{componentStack:ce!==null?ce:""})}),S}function x(u,h,S){var F=u.pingCache;if(F===null){F=u.pingCache=new mv;var U=new Set;F.set(h,U)}else U=F.get(h),U===void 0&&(U=new Set,F.set(h,U));U.has(S)||(U.add(S),u=_P.bind(null,u,h,S),h.then(u,u))}function j(u){do{var h;if((h=u.tag===13)&&(h=u.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return u;u=u.return}while(u!==null);return null}function O(u,h,S,F,U){return(u.mode&1)===0?(u===h?u.flags|=65536:(u.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(h=Ji(-1,1),h.tag=2,Zi(S,h,1))),S.lanes|=1),u):(u.flags|=65536,u.lanes=U,u)}var G=N.ReactCurrentOwner,se=!1;function ye(u,h,S,F){h.child=u===null?hi(h,null,S,F):sc(h,u.child,S,F)}function Be(u,h,S,F,U){S=S.render;var J=h.ref;return No(h,U),F=su(u,h,S,F,J,U),S=au(),u!==null&&!se?(h.updateQueue=u.updateQueue,h.flags&=-2053,u.lanes&=~U,Xs(u,h,U)):(an&&S&&Yc(h),h.flags|=1,ye(u,h,F,U),h.child)}function dt(u,h,S,F,U){if(u===null){var J=S.type;return typeof J=="function"&&!Pv(J)&&J.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(h.tag=15,h.type=J,Mt(u,h,J,F,U)):(u=Gx(S.type,null,F,h,h.mode,U),u.ref=h.ref,u.return=h,h.child=u)}if(J=u.child,(u.lanes&U)===0){var ce=J.memoizedProps;if(S=S.compare,S=S!==null?S:zl,S(ce,F)&&u.ref===h.ref)return Xs(u,h,U)}return h.flags|=1,u=xu(J,F),u.ref=h.ref,u.return=h,h.child=u}function Mt(u,h,S,F,U){if(u!==null){var J=u.memoizedProps;if(zl(J,F)&&u.ref===h.ref)if(se=!1,h.pendingProps=F=J,(u.lanes&U)!==0)(u.flags&131072)!==0&&(se=!0);else return h.lanes=u.lanes,Xs(u,h,U)}return er(u,h,S,F,U)}function ar(u,h,S){var F=h.pendingProps,U=F.children,J=u!==null?u.memoizedState:null;if(F.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null,transitions:null},un(vh,Ii),Ii|=S;else{if((S&1073741824)===0)return u=J!==null?J.baseLanes|S:S,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:u,cachePool:null,transitions:null},h.updateQueue=null,un(vh,Ii),Ii|=u,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},F=J!==null?J.baseLanes:S,un(vh,Ii),Ii|=F}else J!==null?(F=J.baseLanes|S,h.memoizedState=null):F=S,un(vh,Ii),Ii|=F;return ye(u,h,U,S),h.child}function Tr(u,h){var S=h.ref;(u===null&&S!==null||u!==null&&u.ref!==S)&&(h.flags|=512,h.flags|=2097152)}function er(u,h,S,F,U){var J=Gs(S)?ol:Ms.current;return J=Jl(h,J),No(h,U),S=su(u,h,S,F,J,U),F=au(),u!==null&&!se?(h.updateQueue=u.updateQueue,h.flags&=-2053,u.lanes&=~U,Xs(u,h,U)):(an&&F&&Yc(h),h.flags|=1,ye(u,h,S,U),h.child)}function wn(u,h,S,F,U){if(Gs(S)){var J=!0;Zl(h)}else J=!1;if(No(h,U),h.stateNode===null)zr(u,h),Rx(h,S,F),ph(h,S,F,U),F=!0;else if(u===null){var ce=h.stateNode,Ee=h.memoizedProps;ce.props=Ee;var Re=ce.context,ct=S.contextType;typeof ct=="object"&&ct!==null?ct=ua(ct):(ct=Gs(S)?ol:Ms.current,ct=Jl(h,ct));var Ft=S.getDerivedStateFromProps,Dt=typeof Ft=="function"||typeof ce.getSnapshotBeforeUpdate=="function";Dt||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ee!==F||Re!==ct)&&xg(h,ce,F,ct),Qi=!1;var At=h.memoizedState;ce.state=At,eu(h,F,ce,U),Re=h.memoizedState,Ee!==F||At!==Re||Hs.current||Qi?(typeof Ft=="function"&&(cu(h,S,Ft,F),Re=h.memoizedState),(Ee=Qi||mh(h,S,Ee,F,At,Re,ct))?(Dt||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(h.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=F,h.memoizedState=Re),ce.props=F,ce.state=Re,ce.context=ct,F=Ee):(typeof ce.componentDidMount=="function"&&(h.flags|=4194308),F=!1)}else{ce=h.stateNode,oh(u,h),Ee=h.memoizedProps,ct=h.type===h.elementType?Ee:Os(h.type,Ee),ce.props=ct,Dt=h.pendingProps,At=ce.context,Re=S.contextType,typeof Re=="object"&&Re!==null?Re=ua(Re):(Re=Gs(S)?ol:Ms.current,Re=Jl(h,Re));var rr=S.getDerivedStateFromProps;(Ft=typeof rr=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ee!==Dt||At!==Re)&&xg(h,ce,F,Re),Qi=!1,At=h.memoizedState,ce.state=At,eu(h,F,ce,U);var lr=h.memoizedState;Ee!==Dt||At!==lr||Hs.current||Qi?(typeof rr=="function"&&(cu(h,S,rr,F),lr=h.memoizedState),(ct=Qi||mh(h,S,ct,F,At,lr,Re)||!1)?(Ft||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(F,lr,Re),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(F,lr,Re)),typeof ce.componentDidUpdate=="function"&&(h.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof ce.componentDidUpdate!="function"||Ee===u.memoizedProps&&At===u.memoizedState||(h.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ee===u.memoizedProps&&At===u.memoizedState||(h.flags|=1024),h.memoizedProps=F,h.memoizedState=lr),ce.props=F,ce.state=lr,ce.context=Re,F=ct):(typeof ce.componentDidUpdate!="function"||Ee===u.memoizedProps&&At===u.memoizedState||(h.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ee===u.memoizedProps&&At===u.memoizedState||(h.flags|=1024),F=!1)}return on(u,h,S,F,J,U)}function on(u,h,S,F,U,J){Tr(u,h);var ce=(h.flags&128)!==0;if(!F&&!ce)return U&&bx(h,S,!1),Xs(u,h,J);F=h.stateNode,G.current=h;var Ee=ce&&typeof S.getDerivedStateFromError!="function"?null:F.render();return h.flags|=1,u!==null&&ce?(h.child=sc(h,u.child,null,J),h.child=sc(h,null,Ee,J)):ye(u,h,Ee,J),h.memoizedState=F.state,U&&bx(h,S,!0),h.child}function fa(u){var h=u.stateNode;h.pendingContext?ag(u,h.pendingContext,h.pendingContext!==h.context):h.context&&ag(u,h.context,!1),fl(u,h.containerInfo)}function eo(u,h,S,F,U){return nc(),xd(U),h.flags|=256,ye(u,h,S,F),h.child}var it={dehydrated:null,treeContext:null,retryLane:0};function ze(u){return{baseLanes:u,cachePool:null,transitions:null}}function gt(u,h,S){var F=h.pendingProps,U=vn.current,J=!1,ce=(h.flags&128)!==0,Ee;if((Ee=ce)||(Ee=u!==null&&u.memoizedState===null?!1:(U&2)!==0),Ee?(J=!0,h.flags&=-129):(u===null||u.memoizedState!==null)&&(U|=1),un(vn,U&1),u===null)return Qc(h),u=h.memoizedState,u!==null&&(u=u.dehydrated,u!==null)?((h.mode&1)===0?h.lanes=1:u.data==="$!"?h.lanes=8:h.lanes=1073741824,null):(ce=F.children,u=F.fallback,J?(F=h.mode,J=h.child,ce={mode:"hidden",children:ce},(F&1)===0&&J!==null?(J.childLanes=0,J.pendingProps=ce):J=Vx(ce,F,0,null),u=Nd(u,F,S,null),J.return=h,u.return=h,J.sibling=u,h.child=J,h.child.memoizedState=ze(S),h.memoizedState=it,u):tr(h,ce));if(U=u.memoizedState,U!==null&&(Ee=U.dehydrated,Ee!==null))return Pr(u,h,ce,F,Ee,U,S);if(J){J=F.fallback,ce=h.mode,U=u.child,Ee=U.sibling;var Re={mode:"hidden",children:F.children};return(ce&1)===0&&h.child!==U?(F=h.child,F.childLanes=0,F.pendingProps=Re,h.deletions=null):(F=xu(U,Re),F.subtreeFlags=U.subtreeFlags&14680064),Ee!==null?J=xu(Ee,J):(J=Nd(J,ce,S,null),J.flags|=2),J.return=h,F.return=h,F.sibling=J,h.child=F,F=J,J=h.child,ce=u.child.memoizedState,ce=ce===null?ze(S):{baseLanes:ce.baseLanes|S,cachePool:null,transitions:ce.transitions},J.memoizedState=ce,J.childLanes=u.childLanes&~S,h.memoizedState=it,F}return J=u.child,u=J.sibling,F=xu(J,{mode:"visible",children:F.children}),(h.mode&1)===0&&(F.lanes=S),F.return=h,F.sibling=null,u!==null&&(S=h.deletions,S===null?(h.deletions=[u],h.flags|=16):S.push(u)),h.child=F,h.memoizedState=null,F}function tr(u,h){return h=Vx({mode:"visible",children:h},u.mode,0,null),h.return=u,u.child=h}function hr(u,h,S,F){return F!==null&&xd(F),sc(h,u.child,null,S),u=tr(h,h.pendingProps.children),u.flags|=2,h.memoizedState=null,u}function Pr(u,h,S,F,U,J,ce){if(S)return h.flags&256?(h.flags&=-257,F=xh(Error(r(422))),hr(u,h,ce,F)):h.memoizedState!==null?(h.child=u.child,h.flags|=128,null):(J=F.fallback,U=h.mode,F=Vx({mode:"visible",children:F.children},U,0,null),J=Nd(J,U,ce,null),J.flags|=2,F.return=h,J.return=h,F.sibling=J,h.child=F,(h.mode&1)!==0&&sc(h,u.child,null,ce),h.child.memoizedState=ze(ce),h.memoizedState=it,J);if((h.mode&1)===0)return hr(u,h,ce,null);if(U.data==="$!"){if(F=U.nextSibling&&U.nextSibling.dataset,F)var Ee=F.dgst;return F=Ee,J=Error(r(419)),F=xh(J,F,void 0),hr(u,h,ce,F)}if(Ee=(ce&u.childLanes)!==0,se||Ee){if(F=Ys,F!==null){switch(ce&-ce){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}U=(U&(F.suspendedLanes|ce))!==0?0:U,U!==0&&U!==J.retryLane&&(J.retryLane=U,Za(u,U),Do(F,u,U,-1))}return Fv(),F=xh(Error(r(421))),hr(u,h,ce,F)}return U.data==="$?"?(h.flags|=128,h.child=u.child,h=bP.bind(null,u),U._reactRetry=h,null):(u=J.treeContext,Zt=Vi(U.nextSibling),Ya=h,an=!0,Qa=null,u!==null&&(la[ca++]=Xa,la[ca++]=En,la[ca++]=dl,Xa=u.id,En=u.overflow,dl=h),h=tr(h,F.children),h.flags|=4096,h)}function Er(u,h,S){u.lanes|=h;var F=u.alternate;F!==null&&(F.lanes|=h),ih(u.return,h,S)}function Gr(u,h,S,F,U){var J=u.memoizedState;J===null?u.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:F,tail:S,tailMode:U}:(J.isBackwards=h,J.rendering=null,J.renderingStartTime=0,J.last=F,J.tail=S,J.tailMode=U)}function gs(u,h,S){var F=h.pendingProps,U=F.revealOrder,J=F.tail;if(ye(u,h,F.children,S),F=vn.current,(F&2)!==0)F=F&1|2,h.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=h.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&Er(u,S,h);else if(u.tag===19)Er(u,S,h);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===h)break e;for(;u.sibling===null;){if(u.return===null||u.return===h)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}F&=1}if(un(vn,F),(h.mode&1)===0)h.memoizedState=null;else switch(U){case"forwards":for(S=h.child,U=null;S!==null;)u=S.alternate,u!==null&&ru(u)===null&&(U=S),S=S.sibling;S=U,S===null?(U=h.child,h.child=null):(U=S.sibling,S.sibling=null),Gr(h,!1,U,S,J);break;case"backwards":for(S=null,U=h.child,h.child=null;U!==null;){if(u=U.alternate,u!==null&&ru(u)===null){h.child=U;break}u=U.sibling,U.sibling=S,S=U,U=u}Gr(h,!0,S,null,J);break;case"together":Gr(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function zr(u,h){(h.mode&1)===0&&u!==null&&(u.alternate=null,h.alternate=null,h.flags|=2)}function Xs(u,h,S){if(u!==null&&(h.dependencies=u.dependencies),kd|=h.lanes,(S&h.childLanes)===0)return null;if(u!==null&&h.child!==u.child)throw Error(r(153));if(h.child!==null){for(u=h.child,S=xu(u,u.pendingProps),h.child=S,S.return=h;u.sibling!==null;)u=u.sibling,S=S.sibling=xu(u,u.pendingProps),S.return=h;S.sibling=null}return h.child}function pv(u,h,S){switch(h.tag){case 3:fa(h),nc();break;case 5:tu(h);break;case 1:Gs(h.type)&&Zl(h);break;case 4:fl(h,h.stateNode.containerInfo);break;case 10:var F=h.type._context,U=h.memoizedProps.value;un(yd,F._currentValue),F._currentValue=U;break;case 13:if(F=h.memoizedState,F!==null)return F.dehydrated!==null?(un(vn,vn.current&1),h.flags|=128,null):(S&h.child.childLanes)!==0?gt(u,h,S):(un(vn,vn.current&1),u=Xs(u,h,S),u!==null?u.sibling:null);un(vn,vn.current&1);break;case 19:if(F=(S&h.childLanes)!==0,(u.flags&128)!==0){if(F)return gs(u,h,S);h.flags|=128}if(U=h.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),un(vn,vn.current),F)break;return null;case 22:case 23:return h.lanes=0,ar(u,h,S)}return Xs(u,h,S)}var GS,xv,VS,KS;GS=function(u,h){for(var S=h.child;S!==null;){if(S.tag===5||S.tag===6)u.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===h)break;for(;S.sibling===null;){if(S.return===null||S.return===h)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},xv=function(){},VS=function(u,h,S,F){var U=u.memoizedProps;if(U!==F){u=h.stateNode,fs(dn.current);var J=null;switch(S){case"input":U=He(u,U),F=He(u,F),J=[];break;case"select":U=H({},U,{value:void 0}),F=H({},F,{value:void 0}),J=[];break;case"textarea":U=Ze(u,U),F=Ze(u,F),J=[];break;default:typeof U.onClick!="function"&&typeof F.onClick=="function"&&(u.onclick=Xl)}pt(S,F);var ce;S=null;for(ct in U)if(!F.hasOwnProperty(ct)&&U.hasOwnProperty(ct)&&U[ct]!=null)if(ct==="style"){var Ee=U[ct];for(ce in Ee)Ee.hasOwnProperty(ce)&&(S||(S={}),S[ce]="")}else ct!=="dangerouslySetInnerHTML"&&ct!=="children"&&ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&ct!=="autoFocus"&&(s.hasOwnProperty(ct)?J||(J=[]):(J=J||[]).push(ct,null));for(ct in F){var Re=F[ct];if(Ee=U?.[ct],F.hasOwnProperty(ct)&&Re!==Ee&&(Re!=null||Ee!=null))if(ct==="style")if(Ee){for(ce in Ee)!Ee.hasOwnProperty(ce)||Re&&Re.hasOwnProperty(ce)||(S||(S={}),S[ce]="");for(ce in Re)Re.hasOwnProperty(ce)&&Ee[ce]!==Re[ce]&&(S||(S={}),S[ce]=Re[ce])}else S||(J||(J=[]),J.push(ct,S)),S=Re;else ct==="dangerouslySetInnerHTML"?(Re=Re?Re.__html:void 0,Ee=Ee?Ee.__html:void 0,Re!=null&&Ee!==Re&&(J=J||[]).push(ct,Re)):ct==="children"?typeof Re!="string"&&typeof Re!="number"||(J=J||[]).push(ct,""+Re):ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&(s.hasOwnProperty(ct)?(Re!=null&&ct==="onScroll"&&xn("scroll",u),J||Ee===Re||(J=[])):(J=J||[]).push(ct,Re))}S&&(J=J||[]).push("style",S);var ct=J;(h.updateQueue=ct)&&(h.flags|=4)}},KS=function(u,h,S,F){S!==F&&(h.flags|=4)};function yg(u,h){if(!an)switch(u.tailMode){case"hidden":h=u.tail;for(var S=null;h!==null;)h.alternate!==null&&(S=h),h=h.sibling;S===null?u.tail=null:S.sibling=null;break;case"collapsed":S=u.tail;for(var F=null;S!==null;)S.alternate!==null&&(F=S),S=S.sibling;F===null?h||u.tail===null?u.tail=null:u.tail.sibling=null:F.sibling=null}}function Aa(u){var h=u.alternate!==null&&u.alternate.child===u.child,S=0,F=0;if(h)for(var U=u.child;U!==null;)S|=U.lanes|U.childLanes,F|=U.subtreeFlags&14680064,F|=U.flags&14680064,U.return=u,U=U.sibling;else for(U=u.child;U!==null;)S|=U.lanes|U.childLanes,F|=U.subtreeFlags,F|=U.flags,U.return=u,U=U.sibling;return u.subtreeFlags|=F,u.childLanes=S,h}function dP(u,h,S){var F=h.pendingProps;switch(Cs(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Aa(h),null;case 1:return Gs(h.type)&&qc(),Aa(h),null;case 3:return F=h.stateNode,An(),yn(Hs),yn(Ms),Vs(),F.pendingContext&&(F.context=F.pendingContext,F.pendingContext=null),(u===null||u.child===null)&&(pd(h)?h.flags|=4:u===null||u.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,Qa!==null&&(Nv(Qa),Qa=null))),xv(u,h),Aa(h),null;case 5:Ao(h);var U=fs(Gn.current);if(S=h.type,u!==null&&h.stateNode!=null)VS(u,h,S,F,U),u.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!F){if(h.stateNode===null)throw Error(r(166));return Aa(h),null}if(u=fs(dn.current),pd(h)){F=h.stateNode,S=h.type;var J=h.memoizedProps;switch(F[fi]=h,F[hd]=J,u=(h.mode&1)!==0,S){case"dialog":xn("cancel",F),xn("close",F);break;case"iframe":case"object":case"embed":xn("load",F);break;case"video":case"audio":for(U=0;U<sl.length;U++)xn(sl[U],F);break;case"source":xn("error",F);break;case"img":case"image":case"link":xn("error",F),xn("load",F);break;case"details":xn("toggle",F);break;case"input":qe(F,J),xn("invalid",F);break;case"select":F._wrapperState={wasMultiple:!!J.multiple},xn("invalid",F);break;case"textarea":bt(F,J),xn("invalid",F)}pt(S,J),U=null;for(var ce in J)if(J.hasOwnProperty(ce)){var Ee=J[ce];ce==="children"?typeof Ee=="string"?F.textContent!==Ee&&(J.suppressHydrationWarning!==!0&&dd(F.textContent,Ee,u),U=["children",Ee]):typeof Ee=="number"&&F.textContent!==""+Ee&&(J.suppressHydrationWarning!==!0&&dd(F.textContent,Ee,u),U=["children",""+Ee]):s.hasOwnProperty(ce)&&Ee!=null&&ce==="onScroll"&&xn("scroll",F)}switch(S){case"input":Me(F),It(F,J,!0);break;case"textarea":Me(F),$t(F);break;case"select":case"option":break;default:typeof J.onClick=="function"&&(F.onclick=Xl)}F=U,h.updateQueue=F,F!==null&&(h.flags|=4)}else{ce=U.nodeType===9?U:U.ownerDocument,u==="http://www.w3.org/1999/xhtml"&&(u=Wt(S)),u==="http://www.w3.org/1999/xhtml"?S==="script"?(u=ce.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild)):typeof F.is=="string"?u=ce.createElement(S,{is:F.is}):(u=ce.createElement(S),S==="select"&&(ce=u,F.multiple?ce.multiple=!0:F.size&&(ce.size=F.size))):u=ce.createElementNS(u,S),u[fi]=h,u[hd]=F,GS(u,h,!1,!1),h.stateNode=u;e:{switch(ce=Pt(S,F),S){case"dialog":xn("cancel",u),xn("close",u),U=F;break;case"iframe":case"object":case"embed":xn("load",u),U=F;break;case"video":case"audio":for(U=0;U<sl.length;U++)xn(sl[U],u);U=F;break;case"source":xn("error",u),U=F;break;case"img":case"image":case"link":xn("error",u),xn("load",u),U=F;break;case"details":xn("toggle",u),U=F;break;case"input":qe(u,F),U=He(u,F),xn("invalid",u);break;case"option":U=F;break;case"select":u._wrapperState={wasMultiple:!!F.multiple},U=H({},F,{value:void 0}),xn("invalid",u);break;case"textarea":bt(u,F),U=Ze(u,F),xn("invalid",u);break;default:U=F}pt(S,U),Ee=U;for(J in Ee)if(Ee.hasOwnProperty(J)){var Re=Ee[J];J==="style"?De(u,Re):J==="dangerouslySetInnerHTML"?(Re=Re?Re.__html:void 0,Re!=null&&yt(u,Re)):J==="children"?typeof Re=="string"?(S!=="textarea"||Re!=="")&&ft(u,Re):typeof Re=="number"&&ft(u,""+Re):J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&J!=="autoFocus"&&(s.hasOwnProperty(J)?Re!=null&&J==="onScroll"&&xn("scroll",u):Re!=null&&w(u,J,Re,ce))}switch(S){case"input":Me(u),It(u,F,!1);break;case"textarea":Me(u),$t(u);break;case"option":F.value!=null&&u.setAttribute("value",""+ae(F.value));break;case"select":u.multiple=!!F.multiple,J=F.value,J!=null?je(u,!!F.multiple,J,!1):F.defaultValue!=null&&je(u,!!F.multiple,F.defaultValue,!0);break;default:typeof U.onClick=="function"&&(u.onclick=Xl)}switch(S){case"button":case"input":case"select":case"textarea":F=!!F.autoFocus;break e;case"img":F=!0;break e;default:F=!1}}F&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return Aa(h),null;case 6:if(u&&h.stateNode!=null)KS(u,h,u.memoizedProps,F);else{if(typeof F!="string"&&h.stateNode===null)throw Error(r(166));if(S=fs(Gn.current),fs(dn.current),pd(h)){if(F=h.stateNode,S=h.memoizedProps,F[fi]=h,(J=F.nodeValue!==S)&&(u=Ya,u!==null))switch(u.tag){case 3:dd(F.nodeValue,S,(u.mode&1)!==0);break;case 5:u.memoizedProps.suppressHydrationWarning!==!0&&dd(F.nodeValue,S,(u.mode&1)!==0)}J&&(h.flags|=4)}else F=(S.nodeType===9?S:S.ownerDocument).createTextNode(F),F[fi]=h,h.stateNode=F}return Aa(h),null;case 13:if(yn(vn),F=h.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(an&&Zt!==null&&(h.mode&1)!==0&&(h.flags&128)===0)og(),nc(),h.flags|=98560,J=!1;else if(J=pd(h),F!==null&&F.dehydrated!==null){if(u===null){if(!J)throw Error(r(318));if(J=h.memoizedState,J=J!==null?J.dehydrated:null,!J)throw Error(r(317));J[fi]=h}else nc(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Aa(h),J=!1}else Qa!==null&&(Nv(Qa),Qa=null),J=!0;if(!J)return h.flags&65536?h:null}return(h.flags&128)!==0?(h.lanes=S,h):(F=F!==null,F!==(u!==null&&u.memoizedState!==null)&&F&&(h.child.flags|=8192,(h.mode&1)!==0&&(u===null||(vn.current&1)!==0?Ls===0&&(Ls=3):Fv())),h.updateQueue!==null&&(h.flags|=4),Aa(h),null);case 4:return An(),xv(u,h),u===null&&Kl(h.stateNode.containerInfo),Aa(h),null;case 10:return ah(h.type._context),Aa(h),null;case 17:return Gs(h.type)&&qc(),Aa(h),null;case 19:if(yn(vn),J=h.memoizedState,J===null)return Aa(h),null;if(F=(h.flags&128)!==0,ce=J.rendering,ce===null)if(F)yg(J,!1);else{if(Ls!==0||u!==null&&(u.flags&128)!==0)for(u=h.child;u!==null;){if(ce=ru(u),ce!==null){for(h.flags|=128,yg(J,!1),F=ce.updateQueue,F!==null&&(h.updateQueue=F,h.flags|=4),h.subtreeFlags=0,F=S,S=h.child;S!==null;)J=S,u=F,J.flags&=14680066,ce=J.alternate,ce===null?(J.childLanes=0,J.lanes=u,J.child=null,J.subtreeFlags=0,J.memoizedProps=null,J.memoizedState=null,J.updateQueue=null,J.dependencies=null,J.stateNode=null):(J.childLanes=ce.childLanes,J.lanes=ce.lanes,J.child=ce.child,J.subtreeFlags=0,J.deletions=null,J.memoizedProps=ce.memoizedProps,J.memoizedState=ce.memoizedState,J.updateQueue=ce.updateQueue,J.type=ce.type,u=ce.dependencies,J.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),S=S.sibling;return un(vn,vn.current&1|2),h.child}u=u.sibling}J.tail!==null&&Le()>wh&&(h.flags|=128,F=!0,yg(J,!1),h.lanes=4194304)}else{if(!F)if(u=ru(ce),u!==null){if(h.flags|=128,F=!0,S=u.updateQueue,S!==null&&(h.updateQueue=S,h.flags|=4),yg(J,!0),J.tail===null&&J.tailMode==="hidden"&&!ce.alternate&&!an)return Aa(h),null}else 2*Le()-J.renderingStartTime>wh&&S!==1073741824&&(h.flags|=128,F=!0,yg(J,!1),h.lanes=4194304);J.isBackwards?(ce.sibling=h.child,h.child=ce):(S=J.last,S!==null?S.sibling=ce:h.child=ce,J.last=ce)}return J.tail!==null?(h=J.tail,J.rendering=h,J.tail=h.sibling,J.renderingStartTime=Le(),h.sibling=null,S=vn.current,un(vn,F?S&1|2:S&1),h):(Aa(h),null);case 22:case 23:return jv(),F=h.memoizedState!==null,u!==null&&u.memoizedState!==null!==F&&(h.flags|=8192),F&&(h.mode&1)!==0?(Ii&1073741824)!==0&&(Aa(h),h.subtreeFlags&6&&(h.flags|=8192)):Aa(h),null;case 24:return null;case 25:return null}throw Error(r(156,h.tag))}function fP(u,h){switch(Cs(h),h.tag){case 1:return Gs(h.type)&&qc(),u=h.flags,u&65536?(h.flags=u&-65537|128,h):null;case 3:return An(),yn(Hs),yn(Ms),Vs(),u=h.flags,(u&65536)!==0&&(u&128)===0?(h.flags=u&-65537|128,h):null;case 5:return Ao(h),null;case 13:if(yn(vn),u=h.memoizedState,u!==null&&u.dehydrated!==null){if(h.alternate===null)throw Error(r(340));nc()}return u=h.flags,u&65536?(h.flags=u&-65537|128,h):null;case 19:return yn(vn),null;case 4:return An(),null;case 10:return ah(h.type._context),null;case 22:case 23:return jv(),null;case 24:return null;default:return null}}var Ix=!1,ja=!1,hP=typeof WeakSet=="function"?WeakSet:Set,ir=null;function yh(u,h){var S=u.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(F){Zn(u,h,F)}else S.current=null}function yv(u,h,S){try{S()}catch(F){Zn(u,h,F)}}var qS=!1;function gP(u,h){if(tg=Ff,u=us(),Hc(u)){if("selectionStart"in u)var S={start:u.selectionStart,end:u.selectionEnd};else e:{S=(S=u.ownerDocument)&&S.defaultView||window;var F=S.getSelection&&S.getSelection();if(F&&F.rangeCount!==0){S=F.anchorNode;var U=F.anchorOffset,J=F.focusNode;F=F.focusOffset;try{S.nodeType,J.nodeType}catch{S=null;break e}var ce=0,Ee=-1,Re=-1,ct=0,Ft=0,Dt=u,At=null;t:for(;;){for(var rr;Dt!==S||U!==0&&Dt.nodeType!==3||(Ee=ce+U),Dt!==J||F!==0&&Dt.nodeType!==3||(Re=ce+F),Dt.nodeType===3&&(ce+=Dt.nodeValue.length),(rr=Dt.firstChild)!==null;)At=Dt,Dt=rr;for(;;){if(Dt===u)break t;if(At===S&&++ct===U&&(Ee=ce),At===J&&++Ft===F&&(Re=ce),(rr=Dt.nextSibling)!==null)break;Dt=At,At=Dt.parentNode}Dt=rr}S=Ee===-1||Re===-1?null:{start:Ee,end:Re}}else S=null}S=S||{start:0,end:0}}else S=null;for(rg={focusedElem:u,selectionRange:S},Ff=!1,ir=h;ir!==null;)if(h=ir,u=h.child,(h.subtreeFlags&1028)!==0&&u!==null)u.return=h,ir=u;else for(;ir!==null;){h=ir;try{var lr=h.alternate;if((h.flags&1024)!==0)switch(h.tag){case 0:case 11:case 15:break;case 1:if(lr!==null){var cr=lr.memoizedProps,ms=lr.memoizedState,Ye=h.stateNode,Oe=Ye.getSnapshotBeforeUpdate(h.elementType===h.type?cr:Os(h.type,cr),ms);Ye.__reactInternalSnapshotBeforeUpdate=Oe}break;case 3:var rt=h.stateNode.containerInfo;rt.nodeType===1?rt.textContent="":rt.nodeType===9&&rt.documentElement&&rt.removeChild(rt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Ut){Zn(h,h.return,Ut)}if(u=h.sibling,u!==null){u.return=h.return,ir=u;break}ir=h.return}return lr=qS,qS=!1,lr}function vg(u,h,S){var F=h.updateQueue;if(F=F!==null?F.lastEffect:null,F!==null){var U=F=F.next;do{if((U.tag&u)===u){var J=U.destroy;U.destroy=void 0,J!==void 0&&yv(h,S,J)}U=U.next}while(U!==F)}}function Mx(u,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var S=h=h.next;do{if((S.tag&u)===u){var F=S.create;S.destroy=F()}S=S.next}while(S!==h)}}function vv(u){var h=u.ref;if(h!==null){var S=u.stateNode;switch(u.tag){case 5:u=S;break;default:u=S}typeof h=="function"?h(u):h.current=u}}function XS(u){var h=u.alternate;h!==null&&(u.alternate=null,XS(h)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(h=u.stateNode,h!==null&&(delete h[fi],delete h[hd],delete h[Qf],delete h[wx],delete h[_x])),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}function YS(u){return u.tag===5||u.tag===3||u.tag===4}function QS(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||YS(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function wv(u,h,S){var F=u.tag;if(F===5||F===6)u=u.stateNode,h?S.nodeType===8?S.parentNode.insertBefore(u,h):S.insertBefore(u,h):(S.nodeType===8?(h=S.parentNode,h.insertBefore(u,S)):(h=S,h.appendChild(u)),S=S._reactRootContainer,S!=null||h.onclick!==null||(h.onclick=Xl));else if(F!==4&&(u=u.child,u!==null))for(wv(u,h,S),u=u.sibling;u!==null;)wv(u,h,S),u=u.sibling}function _v(u,h,S){var F=u.tag;if(F===5||F===6)u=u.stateNode,h?S.insertBefore(u,h):S.appendChild(u);else if(F!==4&&(u=u.child,u!==null))for(_v(u,h,S),u=u.sibling;u!==null;)_v(u,h,S),u=u.sibling}var ha=null,Po=!1;function fu(u,h,S){for(S=S.child;S!==null;)JS(u,h,S),S=S.sibling}function JS(u,h,S){if(Qt&&typeof Qt.onCommitFiberUnmount=="function")try{Qt.onCommitFiberUnmount(at,S)}catch{}switch(S.tag){case 5:ja||yh(S,h);case 6:var F=ha,U=Po;ha=null,fu(u,h,S),ha=F,Po=U,ha!==null&&(Po?(u=ha,S=S.stateNode,u.nodeType===8?u.parentNode.removeChild(S):u.removeChild(S)):ha.removeChild(S.stateNode));break;case 18:ha!==null&&(Po?(u=ha,S=S.stateNode,u.nodeType===8?Yf(u.parentNode,S):u.nodeType===1&&Yf(u,S),Ca(u)):Yf(ha,S.stateNode));break;case 4:F=ha,U=Po,ha=S.stateNode.containerInfo,Po=!0,fu(u,h,S),ha=F,Po=U;break;case 0:case 11:case 14:case 15:if(!ja&&(F=S.updateQueue,F!==null&&(F=F.lastEffect,F!==null))){U=F=F.next;do{var J=U,ce=J.destroy;J=J.tag,ce!==void 0&&((J&2)!==0||(J&4)!==0)&&yv(S,h,ce),U=U.next}while(U!==F)}fu(u,h,S);break;case 1:if(!ja&&(yh(S,h),F=S.stateNode,typeof F.componentWillUnmount=="function"))try{F.props=S.memoizedProps,F.state=S.memoizedState,F.componentWillUnmount()}catch(Ee){Zn(S,h,Ee)}fu(u,h,S);break;case 21:fu(u,h,S);break;case 22:S.mode&1?(ja=(F=ja)||S.memoizedState!==null,fu(u,h,S),ja=F):fu(u,h,S);break;default:fu(u,h,S)}}function ZS(u){var h=u.updateQueue;if(h!==null){u.updateQueue=null;var S=u.stateNode;S===null&&(S=u.stateNode=new hP),h.forEach(function(F){var U=SP.bind(null,u,F);S.has(F)||(S.add(F),F.then(U,U))})}}function Ro(u,h){var S=h.deletions;if(S!==null)for(var F=0;F<S.length;F++){var U=S[F];try{var J=u,ce=h,Ee=ce;e:for(;Ee!==null;){switch(Ee.tag){case 5:ha=Ee.stateNode,Po=!1;break e;case 3:ha=Ee.stateNode.containerInfo,Po=!0;break e;case 4:ha=Ee.stateNode.containerInfo,Po=!0;break e}Ee=Ee.return}if(ha===null)throw Error(r(160));JS(J,ce,U),ha=null,Po=!1;var Re=U.alternate;Re!==null&&(Re.return=null),U.return=null}catch(ct){Zn(U,h,ct)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)ek(h,u),h=h.sibling}function ek(u,h){var S=u.alternate,F=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:if(Ro(h,u),xl(u),F&4){try{vg(3,u,u.return),Mx(3,u)}catch(cr){Zn(u,u.return,cr)}try{vg(5,u,u.return)}catch(cr){Zn(u,u.return,cr)}}break;case 1:Ro(h,u),xl(u),F&512&&S!==null&&yh(S,S.return);break;case 5:if(Ro(h,u),xl(u),F&512&&S!==null&&yh(S,S.return),u.flags&32){var U=u.stateNode;try{ft(U,"")}catch(cr){Zn(u,u.return,cr)}}if(F&4&&(U=u.stateNode,U!=null)){var J=u.memoizedProps,ce=S!==null?S.memoizedProps:J,Ee=u.type,Re=u.updateQueue;if(u.updateQueue=null,Re!==null)try{Ee==="input"&&J.type==="radio"&&J.name!=null&&Xe(U,J),Pt(Ee,ce);var ct=Pt(Ee,J);for(ce=0;ce<Re.length;ce+=2){var Ft=Re[ce],Dt=Re[ce+1];Ft==="style"?De(U,Dt):Ft==="dangerouslySetInnerHTML"?yt(U,Dt):Ft==="children"?ft(U,Dt):w(U,Ft,Dt,ct)}switch(Ee){case"input":Ve(U,J);break;case"textarea":mt(U,J);break;case"select":var At=U._wrapperState.wasMultiple;U._wrapperState.wasMultiple=!!J.multiple;var rr=J.value;rr!=null?je(U,!!J.multiple,rr,!1):At!==!!J.multiple&&(J.defaultValue!=null?je(U,!!J.multiple,J.defaultValue,!0):je(U,!!J.multiple,J.multiple?[]:"",!1))}U[hd]=J}catch(cr){Zn(u,u.return,cr)}}break;case 6:if(Ro(h,u),xl(u),F&4){if(u.stateNode===null)throw Error(r(162));U=u.stateNode,J=u.memoizedProps;try{U.nodeValue=J}catch(cr){Zn(u,u.return,cr)}}break;case 3:if(Ro(h,u),xl(u),F&4&&S!==null&&S.memoizedState.isDehydrated)try{Ca(h.containerInfo)}catch(cr){Zn(u,u.return,cr)}break;case 4:Ro(h,u),xl(u);break;case 13:Ro(h,u),xl(u),U=u.child,U.flags&8192&&(J=U.memoizedState!==null,U.stateNode.isHidden=J,!J||U.alternate!==null&&U.alternate.memoizedState!==null||(kv=Le())),F&4&&ZS(u);break;case 22:if(Ft=S!==null&&S.memoizedState!==null,u.mode&1?(ja=(ct=ja)||Ft,Ro(h,u),ja=ct):Ro(h,u),xl(u),F&8192){if(ct=u.memoizedState!==null,(u.stateNode.isHidden=ct)&&!Ft&&(u.mode&1)!==0)for(ir=u,Ft=u.child;Ft!==null;){for(Dt=ir=Ft;ir!==null;){switch(At=ir,rr=At.child,At.tag){case 0:case 11:case 14:case 15:vg(4,At,At.return);break;case 1:yh(At,At.return);var lr=At.stateNode;if(typeof lr.componentWillUnmount=="function"){F=At,S=At.return;try{h=F,lr.props=h.memoizedProps,lr.state=h.memoizedState,lr.componentWillUnmount()}catch(cr){Zn(F,S,cr)}}break;case 5:yh(At,At.return);break;case 22:if(At.memoizedState!==null){nk(Dt);continue}}rr!==null?(rr.return=At,ir=rr):nk(Dt)}Ft=Ft.sibling}e:for(Ft=null,Dt=u;;){if(Dt.tag===5){if(Ft===null){Ft=Dt;try{U=Dt.stateNode,ct?(J=U.style,typeof J.setProperty=="function"?J.setProperty("display","none","important"):J.display="none"):(Ee=Dt.stateNode,Re=Dt.memoizedProps.style,ce=Re!=null&&Re.hasOwnProperty("display")?Re.display:null,Ee.style.display=Jt("display",ce))}catch(cr){Zn(u,u.return,cr)}}}else if(Dt.tag===6){if(Ft===null)try{Dt.stateNode.nodeValue=ct?"":Dt.memoizedProps}catch(cr){Zn(u,u.return,cr)}}else if((Dt.tag!==22&&Dt.tag!==23||Dt.memoizedState===null||Dt===u)&&Dt.child!==null){Dt.child.return=Dt,Dt=Dt.child;continue}if(Dt===u)break e;for(;Dt.sibling===null;){if(Dt.return===null||Dt.return===u)break e;Ft===Dt&&(Ft=null),Dt=Dt.return}Ft===Dt&&(Ft=null),Dt.sibling.return=Dt.return,Dt=Dt.sibling}}break;case 19:Ro(h,u),xl(u),F&4&&ZS(u);break;case 21:break;default:Ro(h,u),xl(u)}}function xl(u){var h=u.flags;if(h&2){try{e:{for(var S=u.return;S!==null;){if(YS(S)){var F=S;break e}S=S.return}throw Error(r(160))}switch(F.tag){case 5:var U=F.stateNode;F.flags&32&&(ft(U,""),F.flags&=-33);var J=QS(u);_v(u,J,U);break;case 3:case 4:var ce=F.stateNode.containerInfo,Ee=QS(u);wv(u,Ee,ce);break;default:throw Error(r(161))}}catch(Re){Zn(u,u.return,Re)}u.flags&=-3}h&4096&&(u.flags&=-4097)}function mP(u,h,S){ir=u,tk(u)}function tk(u,h,S){for(var F=(u.mode&1)!==0;ir!==null;){var U=ir,J=U.child;if(U.tag===22&&F){var ce=U.memoizedState!==null||Ix;if(!ce){var Ee=U.alternate,Re=Ee!==null&&Ee.memoizedState!==null||ja;Ee=Ix;var ct=ja;if(Ix=ce,(ja=Re)&&!ct)for(ir=U;ir!==null;)ce=ir,Re=ce.child,ce.tag===22&&ce.memoizedState!==null?sk(U):Re!==null?(Re.return=ce,ir=Re):sk(U);for(;J!==null;)ir=J,tk(J),J=J.sibling;ir=U,Ix=Ee,ja=ct}rk(u)}else(U.subtreeFlags&8772)!==0&&J!==null?(J.return=U,ir=J):rk(u)}}function rk(u){for(;ir!==null;){var h=ir;if((h.flags&8772)!==0){var S=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:ja||Mx(5,h);break;case 1:var F=h.stateNode;if(h.flags&4&&!ja)if(S===null)F.componentDidMount();else{var U=h.elementType===h.type?S.memoizedProps:Os(h.type,S.memoizedProps);F.componentDidUpdate(U,S.memoizedState,F.__reactInternalSnapshotBeforeUpdate)}var J=h.updateQueue;J!==null&&Un(h,J,F);break;case 3:var ce=h.updateQueue;if(ce!==null){if(S=null,h.child!==null)switch(h.child.tag){case 5:S=h.child.stateNode;break;case 1:S=h.child.stateNode}Un(h,ce,S)}break;case 5:var Ee=h.stateNode;if(S===null&&h.flags&4){S=Ee;var Re=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":Re.autoFocus&&S.focus();break;case"img":Re.src&&(S.src=Re.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var ct=h.alternate;if(ct!==null){var Ft=ct.memoizedState;if(Ft!==null){var Dt=Ft.dehydrated;Dt!==null&&Ca(Dt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}ja||h.flags&512&&vv(h)}catch(At){Zn(h,h.return,At)}}if(h===u){ir=null;break}if(S=h.sibling,S!==null){S.return=h.return,ir=S;break}ir=h.return}}function nk(u){for(;ir!==null;){var h=ir;if(h===u){ir=null;break}var S=h.sibling;if(S!==null){S.return=h.return,ir=S;break}ir=h.return}}function sk(u){for(;ir!==null;){var h=ir;try{switch(h.tag){case 0:case 11:case 15:var S=h.return;try{Mx(4,h)}catch(Re){Zn(h,S,Re)}break;case 1:var F=h.stateNode;if(typeof F.componentDidMount=="function"){var U=h.return;try{F.componentDidMount()}catch(Re){Zn(h,U,Re)}}var J=h.return;try{vv(h)}catch(Re){Zn(h,J,Re)}break;case 5:var ce=h.return;try{vv(h)}catch(Re){Zn(h,ce,Re)}}}catch(Re){Zn(h,h.return,Re)}if(h===u){ir=null;break}var Ee=h.sibling;if(Ee!==null){Ee.return=h.return,ir=Ee;break}ir=h.return}}var pP=Math.ceil,Ox=N.ReactCurrentDispatcher,bv=N.ReactCurrentOwner,to=N.ReactCurrentBatchConfig,Yr=0,Ys=null,Ts=null,ga=0,Ii=0,vh=To(0),Ls=0,wg=null,kd=0,Lx=0,Sv=0,_g=null,mi=null,kv=0,wh=1/0,lc=null,Bx=!1,Cv=null,hu=null,Ux=!1,gu=null,$x=0,bg=0,Tv=null,Wx=-1,zx=0;function ti(){return(Yr&6)!==0?Le():Wx!==-1?Wx:Wx=Le()}function mu(u){return(u.mode&1)===0?1:(Yr&2)!==0&&ga!==0?ga&-ga:lg.transition!==null?(zx===0&&(zx=dr()),zx):(u=Kr,u!==0||(u=window.event,u=u===void 0?16:nx(u.type)),u)}function Do(u,h,S,F){if(50<bg)throw bg=0,Tv=null,Error(r(185));Ml(u,S,F),((Yr&2)===0||u!==Ys)&&(u===Ys&&((Yr&2)===0&&(Lx|=S),Ls===4&&pu(u,ga)),pi(u,F),S===1&&Yr===0&&(h.mode&1)===0&&(wh=Le()+500,Xc&&ll()))}function pi(u,h){var S=u.callbackNode;Xr(u,h);var F=Or(u,u===Ys?ga:0);if(F===0)S!==null&&Ne(S),u.callbackNode=null,u.callbackPriority=0;else if(h=F&-F,u.callbackPriority!==h){if(S!=null&&Ne(S),h===1)u.tag===0?Eo(ik.bind(null,u)):md(ik.bind(null,u)),yx(function(){(Yr&6)===0&&ll()}),S=null;else{switch(Zu(F)){case 1:S=Bt;break;case 4:S=Yt;break;case 16:S=Fe;break;case 536870912:S=Ct;break;default:S=Fe}S=gk(S,ak.bind(null,u))}u.callbackPriority=h,u.callbackNode=S}}function ak(u,h){if(Wx=-1,zx=0,(Yr&6)!==0)throw Error(r(327));var S=u.callbackNode;if(_h()&&u.callbackNode!==S)return null;var F=Or(u,u===Ys?ga:0);if(F===0)return null;if((F&30)!==0||(F&u.expiredLanes)!==0||h)h=Hx(u,F);else{h=F;var U=Yr;Yr|=2;var J=lk();(Ys!==u||ga!==h)&&(lc=null,wh=Le()+500,Td(u,h));do try{vP();break}catch(Ee){ok(u,Ee)}while(!0);sh(),Ox.current=J,Yr=U,Ts!==null?h=0:(Ys=null,ga=0,h=Ls)}if(h!==0){if(h===2&&(U=Zr(u),U!==0&&(F=U,h=Ev(u,U))),h===1)throw S=wg,Td(u,0),pu(u,F),pi(u,Le()),S;if(h===6)pu(u,F);else{if(U=u.current.alternate,(F&30)===0&&!xP(U)&&(h=Hx(u,F),h===2&&(J=Zr(u),J!==0&&(F=J,h=Ev(u,J))),h===1))throw S=wg,Td(u,0),pu(u,F),pi(u,Le()),S;switch(u.finishedWork=U,u.finishedLanes=F,h){case 0:case 1:throw Error(r(345));case 2:Ed(u,mi,lc);break;case 3:if(pu(u,F),(F&130023424)===F&&(h=kv+500-Le(),10<h)){if(Or(u,0)!==0)break;if(U=u.suspendedLanes,(U&F)!==F){ti(),u.pingedLanes|=u.suspendedLanes&U;break}u.timeoutHandle=qa(Ed.bind(null,u,mi,lc),h);break}Ed(u,mi,lc);break;case 4:if(pu(u,F),(F&4194240)===F)break;for(h=u.eventTimes,U=-1;0<F;){var ce=31-jt(F);J=1<<ce,ce=h[ce],ce>U&&(U=ce),F&=~J}if(F=U,F=Le()-F,F=(120>F?120:480>F?480:1080>F?1080:1920>F?1920:3e3>F?3e3:4320>F?4320:1960*pP(F/1960))-F,10<F){u.timeoutHandle=qa(Ed.bind(null,u,mi,lc),F);break}Ed(u,mi,lc);break;case 5:Ed(u,mi,lc);break;default:throw Error(r(329))}}}return pi(u,Le()),u.callbackNode===S?ak.bind(null,u):null}function Ev(u,h){var S=_g;return u.current.memoizedState.isDehydrated&&(Td(u,h).flags|=256),u=Hx(u,h),u!==2&&(h=mi,mi=S,h!==null&&Nv(h)),u}function Nv(u){mi===null?mi=u:mi.push.apply(mi,u)}function xP(u){for(var h=u;;){if(h.flags&16384){var S=h.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var F=0;F<S.length;F++){var U=S[F],J=U.getSnapshot;U=U.value;try{if(!Ea(J(),U))return!1}catch{return!1}}}if(S=h.child,h.subtreeFlags&16384&&S!==null)S.return=h,h=S;else{if(h===u)break;for(;h.sibling===null;){if(h.return===null||h.return===u)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function pu(u,h){for(h&=~Sv,h&=~Lx,u.suspendedLanes|=h,u.pingedLanes&=~h,u=u.expirationTimes;0<h;){var S=31-jt(h),F=1<<S;u[S]=-1,h&=~F}}function ik(u){if((Yr&6)!==0)throw Error(r(327));_h();var h=Or(u,0);if((h&1)===0)return pi(u,Le()),null;var S=Hx(u,h);if(u.tag!==0&&S===2){var F=Zr(u);F!==0&&(h=F,S=Ev(u,F))}if(S===1)throw S=wg,Td(u,0),pu(u,h),pi(u,Le()),S;if(S===6)throw Error(r(345));return u.finishedWork=u.current.alternate,u.finishedLanes=h,Ed(u,mi,lc),pi(u,Le()),null}function Av(u,h){var S=Yr;Yr|=1;try{return u(h)}finally{Yr=S,Yr===0&&(wh=Le()+500,Xc&&ll())}}function Cd(u){gu!==null&&gu.tag===0&&(Yr&6)===0&&_h();var h=Yr;Yr|=1;var S=to.transition,F=Kr;try{if(to.transition=null,Kr=1,u)return u()}finally{Kr=F,to.transition=S,Yr=h,(Yr&6)===0&&ll()}}function jv(){Ii=vh.current,yn(vh)}function Td(u,h){u.finishedWork=null,u.finishedLanes=0;var S=u.timeoutHandle;if(S!==-1&&(u.timeoutHandle=-1,sg(S)),Ts!==null)for(S=Ts.return;S!==null;){var F=S;switch(Cs(F),F.tag){case 1:F=F.type.childContextTypes,F!=null&&qc();break;case 3:An(),yn(Hs),yn(Ms),Vs();break;case 5:Ao(F);break;case 4:An();break;case 13:yn(vn);break;case 19:yn(vn);break;case 10:ah(F.type._context);break;case 22:case 23:jv()}S=S.return}if(Ys=u,Ts=u=xu(u.current,null),ga=Ii=h,Ls=0,wg=null,Sv=Lx=kd=0,mi=_g=null,Yi!==null){for(h=0;h<Yi.length;h++)if(S=Yi[h],F=S.interleaved,F!==null){S.interleaved=null;var U=F.next,J=S.pending;if(J!==null){var ce=J.next;J.next=U,F.next=ce}S.pending=F}Yi=null}return u}function ok(u,h){do{var S=Ts;try{if(sh(),nu.current=lu,Di){for(var F=cn.memoizedState;F!==null;){var U=F.queue;U!==null&&(U.pending=null),F=F.next}Di=!1}if(da=0,Qn=$n=cn=null,hl=!1,gi=0,bv.current=null,S===null||S.return===null){Ls=1,wg=h,Ts=null;break}e:{var J=u,ce=S.return,Ee=S,Re=h;if(h=ga,Ee.flags|=32768,Re!==null&&typeof Re=="object"&&typeof Re.then=="function"){var ct=Re,Ft=Ee,Dt=Ft.tag;if((Ft.mode&1)===0&&(Dt===0||Dt===11||Dt===15)){var At=Ft.alternate;At?(Ft.updateQueue=At.updateQueue,Ft.memoizedState=At.memoizedState,Ft.lanes=At.lanes):(Ft.updateQueue=null,Ft.memoizedState=null)}var rr=j(ce);if(rr!==null){rr.flags&=-257,O(rr,ce,Ee,J,h),rr.mode&1&&x(J,ct,h),h=rr,Re=ct;var lr=h.updateQueue;if(lr===null){var cr=new Set;cr.add(Re),h.updateQueue=cr}else lr.add(Re);break e}else{if((h&1)===0){x(J,ct,h),Fv();break e}Re=Error(r(426))}}else if(an&&Ee.mode&1){var ms=j(ce);if(ms!==null){(ms.flags&65536)===0&&(ms.flags|=256),O(ms,ce,Ee,J,h),xd(oc(Re,Ee));break e}}J=Re=oc(Re,Ee),Ls!==4&&(Ls=2),_g===null?_g=[J]:_g.push(J),J=ce;do{switch(J.tag){case 3:J.flags|=65536,h&=-h,J.lanes|=h;var Ye=Dx(J,Re,h);_d(J,Ye);break e;case 1:Ee=Re;var Oe=J.type,rt=J.stateNode;if((J.flags&128)===0&&(typeof Oe.getDerivedStateFromError=="function"||rt!==null&&typeof rt.componentDidCatch=="function"&&(hu===null||!hu.has(rt)))){J.flags|=65536,h&=-h,J.lanes|=h;var Ut=m(J,Ee,h);_d(J,Ut);break e}}J=J.return}while(J!==null)}uk(S)}catch(ur){h=ur,Ts===S&&S!==null&&(Ts=S=S.return);continue}break}while(!0)}function lk(){var u=Ox.current;return Ox.current=lu,u===null?lu:u}function Fv(){(Ls===0||Ls===3||Ls===2)&&(Ls=4),Ys===null||(kd&268435455)===0&&(Lx&268435455)===0||pu(Ys,ga)}function Hx(u,h){var S=Yr;Yr|=2;var F=lk();(Ys!==u||ga!==h)&&(lc=null,Td(u,h));do try{yP();break}catch(U){ok(u,U)}while(!0);if(sh(),Yr=S,Ox.current=F,Ts!==null)throw Error(r(261));return Ys=null,ga=0,Ls}function yP(){for(;Ts!==null;)ck(Ts)}function vP(){for(;Ts!==null&&!Ge();)ck(Ts)}function ck(u){var h=hk(u.alternate,u,Ii);u.memoizedProps=u.pendingProps,h===null?uk(u):Ts=h,bv.current=null}function uk(u){var h=u;do{var S=h.alternate;if(u=h.return,(h.flags&32768)===0){if(S=dP(S,h,Ii),S!==null){Ts=S;return}}else{if(S=fP(S,h),S!==null){S.flags&=32767,Ts=S;return}if(u!==null)u.flags|=32768,u.subtreeFlags=0,u.deletions=null;else{Ls=6,Ts=null;return}}if(h=h.sibling,h!==null){Ts=h;return}Ts=h=u}while(h!==null);Ls===0&&(Ls=5)}function Ed(u,h,S){var F=Kr,U=to.transition;try{to.transition=null,Kr=1,wP(u,h,S,F)}finally{to.transition=U,Kr=F}return null}function wP(u,h,S,F){do _h();while(gu!==null);if((Yr&6)!==0)throw Error(r(327));S=u.finishedWork;var U=u.finishedLanes;if(S===null)return null;if(u.finishedWork=null,u.finishedLanes=0,S===u.current)throw Error(r(177));u.callbackNode=null,u.callbackPriority=0;var J=S.lanes|S.childLanes;if(lv(u,J),u===Ys&&(Ts=Ys=null,ga=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||Ux||(Ux=!0,gk(Fe,function(){return _h(),null})),J=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||J){J=to.transition,to.transition=null;var ce=Kr;Kr=1;var Ee=Yr;Yr|=4,bv.current=null,gP(u,S),ek(S,u),od(rg),Ff=!!tg,rg=tg=null,u.current=S,mP(S),ot(),Yr=Ee,Kr=ce,to.transition=J}else u.current=S;if(Ux&&(Ux=!1,gu=u,$x=U),J=u.pendingLanes,J===0&&(hu=null),tt(S.stateNode),pi(u,Le()),h!==null)for(F=u.onRecoverableError,S=0;S<h.length;S++)U=h[S],F(U.value,{componentStack:U.stack,digest:U.digest});if(Bx)throw Bx=!1,u=Cv,Cv=null,u;return($x&1)!==0&&u.tag!==0&&_h(),J=u.pendingLanes,(J&1)!==0?u===Tv?bg++:(bg=0,Tv=u):bg=0,ll(),null}function _h(){if(gu!==null){var u=Zu($x),h=to.transition,S=Kr;try{if(to.transition=null,Kr=16>u?16:u,gu===null)var F=!1;else{if(u=gu,gu=null,$x=0,(Yr&6)!==0)throw Error(r(331));var U=Yr;for(Yr|=4,ir=u.current;ir!==null;){var J=ir,ce=J.child;if((ir.flags&16)!==0){var Ee=J.deletions;if(Ee!==null){for(var Re=0;Re<Ee.length;Re++){var ct=Ee[Re];for(ir=ct;ir!==null;){var Ft=ir;switch(Ft.tag){case 0:case 11:case 15:vg(8,Ft,J)}var Dt=Ft.child;if(Dt!==null)Dt.return=Ft,ir=Dt;else for(;ir!==null;){Ft=ir;var At=Ft.sibling,rr=Ft.return;if(XS(Ft),Ft===ct){ir=null;break}if(At!==null){At.return=rr,ir=At;break}ir=rr}}}var lr=J.alternate;if(lr!==null){var cr=lr.child;if(cr!==null){lr.child=null;do{var ms=cr.sibling;cr.sibling=null,cr=ms}while(cr!==null)}}ir=J}}if((J.subtreeFlags&2064)!==0&&ce!==null)ce.return=J,ir=ce;else e:for(;ir!==null;){if(J=ir,(J.flags&2048)!==0)switch(J.tag){case 0:case 11:case 15:vg(9,J,J.return)}var Ye=J.sibling;if(Ye!==null){Ye.return=J.return,ir=Ye;break e}ir=J.return}}var Oe=u.current;for(ir=Oe;ir!==null;){ce=ir;var rt=ce.child;if((ce.subtreeFlags&2064)!==0&&rt!==null)rt.return=ce,ir=rt;else e:for(ce=Oe;ir!==null;){if(Ee=ir,(Ee.flags&2048)!==0)try{switch(Ee.tag){case 0:case 11:case 15:Mx(9,Ee)}}catch(ur){Zn(Ee,Ee.return,ur)}if(Ee===ce){ir=null;break e}var Ut=Ee.sibling;if(Ut!==null){Ut.return=Ee.return,ir=Ut;break e}ir=Ee.return}}if(Yr=U,ll(),Qt&&typeof Qt.onPostCommitFiberRoot=="function")try{Qt.onPostCommitFiberRoot(at,u)}catch{}F=!0}return F}finally{Kr=S,to.transition=h}}return!1}function dk(u,h,S){h=oc(S,h),h=Dx(u,h,1),u=Zi(u,h,1),h=ti(),u!==null&&(Ml(u,1,h),pi(u,h))}function Zn(u,h,S){if(u.tag===3)dk(u,u,S);else for(;h!==null;){if(h.tag===3){dk(h,u,S);break}else if(h.tag===1){var F=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof F.componentDidCatch=="function"&&(hu===null||!hu.has(F))){u=oc(S,u),u=m(h,u,1),h=Zi(h,u,1),u=ti(),h!==null&&(Ml(h,1,u),pi(h,u));break}}h=h.return}}function _P(u,h,S){var F=u.pingCache;F!==null&&F.delete(h),h=ti(),u.pingedLanes|=u.suspendedLanes&S,Ys===u&&(ga&S)===S&&(Ls===4||Ls===3&&(ga&130023424)===ga&&500>Le()-kv?Td(u,0):Sv|=S),pi(u,h)}function fk(u,h){h===0&&((u.mode&1)===0?h=1:(h=gr,gr<<=1,(gr&130023424)===0&&(gr=4194304)));var S=ti();u=Za(u,h),u!==null&&(Ml(u,h,S),pi(u,S))}function bP(u){var h=u.memoizedState,S=0;h!==null&&(S=h.retryLane),fk(u,S)}function SP(u,h){var S=0;switch(u.tag){case 13:var F=u.stateNode,U=u.memoizedState;U!==null&&(S=U.retryLane);break;case 19:F=u.stateNode;break;default:throw Error(r(314))}F!==null&&F.delete(h),fk(u,S)}var hk;hk=function(u,h,S){if(u!==null)if(u.memoizedProps!==h.pendingProps||Hs.current)se=!0;else{if((u.lanes&S)===0&&(h.flags&128)===0)return se=!1,pv(u,h,S);se=(u.flags&131072)!==0}else se=!1,an&&(h.flags&1048576)!==0&&Sx(h,ul,h.index);switch(h.lanes=0,h.tag){case 2:var F=h.type;zr(u,h),u=h.pendingProps;var U=Jl(h,Ms.current);No(h,S),U=su(null,h,F,u,U,S);var J=au();return h.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,Gs(F)?(J=!0,Zl(h)):J=!1,h.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,wd(h),U.updater=uu,h.stateNode=U,U._reactInternals=h,ph(h,F,u,S),h=on(null,h,F,!0,J,S)):(h.tag=0,an&&J&&Yc(h),ye(null,h,U,S),h=h.child),h;case 16:F=h.elementType;e:{switch(zr(u,h),u=h.pendingProps,U=F._init,F=U(F._payload),h.type=F,U=h.tag=CP(F),u=Os(F,u),U){case 0:h=er(null,h,F,u,S);break e;case 1:h=wn(null,h,F,u,S);break e;case 11:h=Be(null,h,F,u,S);break e;case 14:h=dt(null,h,F,Os(F.type,u),S);break e}throw Error(r(306,F,""))}return h;case 0:return F=h.type,U=h.pendingProps,U=h.elementType===F?U:Os(F,U),er(u,h,F,U,S);case 1:return F=h.type,U=h.pendingProps,U=h.elementType===F?U:Os(F,U),wn(u,h,F,U,S);case 3:e:{if(fa(h),u===null)throw Error(r(387));F=h.pendingProps,J=h.memoizedState,U=J.element,oh(u,h),eu(h,F,null,S);var ce=h.memoizedState;if(F=ce.element,J.isDehydrated)if(J={element:F,isDehydrated:!1,cache:ce.cache,pendingSuspenseBoundaries:ce.pendingSuspenseBoundaries,transitions:ce.transitions},h.updateQueue.baseState=J,h.memoizedState=J,h.flags&256){U=oc(Error(r(423)),h),h=eo(u,h,F,S,U);break e}else if(F!==U){U=oc(Error(r(424)),h),h=eo(u,h,F,S,U);break e}else for(Zt=Vi(h.stateNode.containerInfo.firstChild),Ya=h,an=!0,Qa=null,S=hi(h,null,F,S),h.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(nc(),F===U){h=Xs(u,h,S);break e}ye(u,h,F,S)}h=h.child}return h;case 5:return tu(h),u===null&&Qc(h),F=h.type,U=h.pendingProps,J=u!==null?u.memoizedProps:null,ce=U.children,ng(F,U)?ce=null:J!==null&&ng(F,J)&&(h.flags|=32),Tr(u,h),ye(u,h,ce,S),h.child;case 6:return u===null&&Qc(h),null;case 13:return gt(u,h,S);case 4:return fl(h,h.stateNode.containerInfo),F=h.pendingProps,u===null?h.child=sc(h,null,F,S):ye(u,h,F,S),h.child;case 11:return F=h.type,U=h.pendingProps,U=h.elementType===F?U:Os(F,U),Be(u,h,F,U,S);case 7:return ye(u,h,h.pendingProps,S),h.child;case 8:return ye(u,h,h.pendingProps.children,S),h.child;case 12:return ye(u,h,h.pendingProps.children,S),h.child;case 10:e:{if(F=h.type._context,U=h.pendingProps,J=h.memoizedProps,ce=U.value,un(yd,F._currentValue),F._currentValue=ce,J!==null)if(Ea(J.value,ce)){if(J.children===U.children&&!Hs.current){h=Xs(u,h,S);break e}}else for(J=h.child,J!==null&&(J.return=h);J!==null;){var Ee=J.dependencies;if(Ee!==null){ce=J.child;for(var Re=Ee.firstContext;Re!==null;){if(Re.context===F){if(J.tag===1){Re=Ji(-1,S&-S),Re.tag=2;var ct=J.updateQueue;if(ct!==null){ct=ct.shared;var Ft=ct.pending;Ft===null?Re.next=Re:(Re.next=Ft.next,Ft.next=Re),ct.pending=Re}}J.lanes|=S,Re=J.alternate,Re!==null&&(Re.lanes|=S),ih(J.return,S,h),Ee.lanes|=S;break}Re=Re.next}}else if(J.tag===10)ce=J.type===h.type?null:J.child;else if(J.tag===18){if(ce=J.return,ce===null)throw Error(r(341));ce.lanes|=S,Ee=ce.alternate,Ee!==null&&(Ee.lanes|=S),ih(ce,S,h),ce=J.sibling}else ce=J.child;if(ce!==null)ce.return=J;else for(ce=J;ce!==null;){if(ce===h){ce=null;break}if(J=ce.sibling,J!==null){J.return=ce.return,ce=J;break}ce=ce.return}J=ce}ye(u,h,U.children,S),h=h.child}return h;case 9:return U=h.type,F=h.pendingProps.children,No(h,S),U=ua(U),F=F(U),h.flags|=1,ye(u,h,F,S),h.child;case 14:return F=h.type,U=Os(F,h.pendingProps),U=Os(F.type,U),dt(u,h,F,U,S);case 15:return Mt(u,h,h.type,h.pendingProps,S);case 17:return F=h.type,U=h.pendingProps,U=h.elementType===F?U:Os(F,U),zr(u,h),h.tag=1,Gs(F)?(u=!0,Zl(h)):u=!1,No(h,S),Rx(h,F,U),ph(h,F,U,S),on(null,h,F,!0,u,S);case 19:return gs(u,h,S);case 22:return ar(u,h,S)}throw Error(r(156,h.tag))};function gk(u,h){return Ce(u,h)}function kP(u,h,S,F){this.tag=u,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=F,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ro(u,h,S,F){return new kP(u,h,S,F)}function Pv(u){return u=u.prototype,!(!u||!u.isReactComponent)}function CP(u){if(typeof u=="function")return Pv(u)?1:0;if(u!=null){if(u=u.$$typeof,u===X)return 11;if(u===q)return 14}return 2}function xu(u,h){var S=u.alternate;return S===null?(S=ro(u.tag,h,u.key,u.mode),S.elementType=u.elementType,S.type=u.type,S.stateNode=u.stateNode,S.alternate=u,u.alternate=S):(S.pendingProps=h,S.type=u.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=u.flags&14680064,S.childLanes=u.childLanes,S.lanes=u.lanes,S.child=u.child,S.memoizedProps=u.memoizedProps,S.memoizedState=u.memoizedState,S.updateQueue=u.updateQueue,h=u.dependencies,S.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},S.sibling=u.sibling,S.index=u.index,S.ref=u.ref,S}function Gx(u,h,S,F,U,J){var ce=2;if(F=u,typeof u=="function")Pv(u)&&(ce=1);else if(typeof u=="string")ce=5;else e:switch(u){case R:return Nd(S.children,U,J,h);case T:ce=8,U|=8;break;case D:return u=ro(12,S,h,U|2),u.elementType=D,u.lanes=J,u;case Z:return u=ro(13,S,h,U),u.elementType=Z,u.lanes=J,u;case ie:return u=ro(19,S,h,U),u.elementType=ie,u.lanes=J,u;case M:return Vx(S,U,J,h);default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case I:ce=10;break e;case V:ce=9;break e;case X:ce=11;break e;case q:ce=14;break e;case ne:ce=16,F=null;break e}throw Error(r(130,u==null?u:typeof u,""))}return h=ro(ce,S,h,U),h.elementType=u,h.type=F,h.lanes=J,h}function Nd(u,h,S,F){return u=ro(7,u,F,h),u.lanes=S,u}function Vx(u,h,S,F){return u=ro(22,u,F,h),u.elementType=M,u.lanes=S,u.stateNode={isHidden:!1},u}function Rv(u,h,S){return u=ro(6,u,null,h),u.lanes=S,u}function Dv(u,h,S){return h=ro(4,u.children!==null?u.children:[],u.key,h),h.lanes=S,h.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},h}function TP(u,h,S,F,U){this.tag=h,this.containerInfo=u,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_s(0),this.expirationTimes=_s(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_s(0),this.identifierPrefix=F,this.onRecoverableError=U,this.mutableSourceEagerHydrationData=null}function Iv(u,h,S,F,U,J,ce,Ee,Re){return u=new TP(u,h,S,Ee,Re),h===1?(h=1,J===!0&&(h|=8)):h=0,J=ro(3,null,null,h),u.current=J,J.stateNode=u,J.memoizedState={element:F,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},wd(J),u}function EP(u,h,S){var F=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:F==null?null:""+F,children:u,containerInfo:h,implementation:S}}function mk(u){if(!u)return qi;u=u._reactInternals;e:{if(ke(u)!==u||u.tag!==1)throw Error(r(170));var h=u;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(Gs(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(r(171))}if(u.tag===1){var S=u.type;if(Gs(S))return Zf(u,S,h)}return h}function pk(u,h,S,F,U,J,ce,Ee,Re){return u=Iv(S,F,!0,u,U,J,ce,Ee,Re),u.context=mk(null),S=u.current,F=ti(),U=mu(S),J=Ji(F,U),J.callback=h??null,Zi(S,J,U),u.current.lanes=U,Ml(u,U,F),pi(u,F),u}function Kx(u,h,S,F){var U=h.current,J=ti(),ce=mu(U);return S=mk(S),h.context===null?h.context=S:h.pendingContext=S,h=Ji(J,ce),h.payload={element:u},F=F===void 0?null:F,F!==null&&(h.callback=F),u=Zi(U,h,ce),u!==null&&(Do(u,U,ce,J),lh(u,U,ce)),ce}function qx(u){if(u=u.current,!u.child)return null;switch(u.child.tag){case 5:return u.child.stateNode;default:return u.child.stateNode}}function xk(u,h){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var S=u.retryLane;u.retryLane=S!==0&&S<h?S:h}}function Mv(u,h){xk(u,h),(u=u.alternate)&&xk(u,h)}function NP(){return null}var yk=typeof reportError=="function"?reportError:function(u){console.error(u)};function Ov(u){this._internalRoot=u}Xx.prototype.render=Ov.prototype.render=function(u){var h=this._internalRoot;if(h===null)throw Error(r(409));Kx(u,h,null,null)},Xx.prototype.unmount=Ov.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var h=u.containerInfo;Cd(function(){Kx(null,u,null,null)}),h[Ki]=null}};function Xx(u){this._internalRoot=u}Xx.prototype.unstable_scheduleHydration=function(u){if(u){var h=ex();u={blockedOn:null,target:u,priority:h};for(var S=0;S<Gi.length&&h!==0&&h<Gi[S].priority;S++);Gi.splice(S,0,u),S===0&&Nf(u)}};function Lv(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function Yx(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11&&(u.nodeType!==8||u.nodeValue!==" react-mount-point-unstable "))}function vk(){}function AP(u,h,S,F,U){if(U){if(typeof F=="function"){var J=F;F=function(){var ct=qx(ce);J.call(ct)}}var ce=pk(h,F,u,0,null,!1,!1,"",vk);return u._reactRootContainer=ce,u[Ki]=ce.current,Kl(u.nodeType===8?u.parentNode:u),Cd(),ce}for(;U=u.lastChild;)u.removeChild(U);if(typeof F=="function"){var Ee=F;F=function(){var ct=qx(Re);Ee.call(ct)}}var Re=Iv(u,0,!1,null,null,!1,!1,"",vk);return u._reactRootContainer=Re,u[Ki]=Re.current,Kl(u.nodeType===8?u.parentNode:u),Cd(function(){Kx(h,Re,S,F)}),Re}function Qx(u,h,S,F,U){var J=S._reactRootContainer;if(J){var ce=J;if(typeof U=="function"){var Ee=U;U=function(){var Re=qx(ce);Ee.call(Re)}}Kx(h,ce,u,U)}else ce=AP(S,h,u,U,F);return qx(ce)}Rc=function(u){switch(u.tag){case 3:var h=u.stateNode;if(h.current.memoizedState.isDehydrated){var S=or(h.pendingLanes);S!==0&&(D0(h,S|1),pi(h,Le()),(Yr&6)===0&&(wh=Le()+500,ll()))}break;case 13:Cd(function(){var F=Za(u,1);if(F!==null){var U=ti();Do(F,u,1,U)}}),Mv(u,1)}},Dc=function(u){if(u.tag===13){var h=Za(u,134217728);if(h!==null){var S=ti();Do(h,u,134217728,S)}Mv(u,134217728)}},Zp=function(u){if(u.tag===13){var h=mu(u),S=Za(u,h);if(S!==null){var F=ti();Do(S,u,h,F)}Mv(u,h)}},ex=function(){return Kr},Tf=function(u,h){var S=Kr;try{return Kr=u,h()}finally{Kr=S}},Te=function(u,h,S){switch(h){case"input":if(Ve(u,S),h=S.name,S.type==="radio"&&h!=null){for(S=u;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<S.length;h++){var F=S[h];if(F!==u&&F.form===u.form){var U=ks(F);if(!U)throw Error(r(90));ue(F),Ve(F,U)}}}break;case"textarea":mt(u,S);break;case"select":h=S.value,h!=null&&je(u,!!S.multiple,h,!1)}},xt=Av,Ht=Cd;var jP={usingClientEntryPoint:!1,Events:[gd,ds,ks,Ue,St,Av]},Sg={findFiberByHostInstance:il,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},FP={bundleType:Sg.bundleType,version:Sg.version,rendererPackageName:Sg.rendererPackageName,rendererConfig:Sg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(u){return u=oe(u),u===null?null:u.stateNode},findFiberByHostInstance:Sg.findFiberByHostInstance||NP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Jx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jx.isDisabled&&Jx.supportsFiber)try{at=Jx.inject(FP),Qt=Jx}catch{}}return xi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jP,xi.createPortal=function(u,h){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lv(h))throw Error(r(200));return EP(u,h,null,S)},xi.createRoot=function(u,h){if(!Lv(u))throw Error(r(299));var S=!1,F="",U=yk;return h!=null&&(h.unstable_strictMode===!0&&(S=!0),h.identifierPrefix!==void 0&&(F=h.identifierPrefix),h.onRecoverableError!==void 0&&(U=h.onRecoverableError)),h=Iv(u,1,!1,null,null,S,!1,F,U),u[Ki]=h.current,Kl(u.nodeType===8?u.parentNode:u),new Ov(h)},xi.findDOMNode=function(u){if(u==null)return null;if(u.nodeType===1)return u;var h=u._reactInternals;if(h===void 0)throw typeof u.render=="function"?Error(r(188)):(u=Object.keys(u).join(","),Error(r(268,u)));return u=oe(h),u=u===null?null:u.stateNode,u},xi.flushSync=function(u){return Cd(u)},xi.hydrate=function(u,h,S){if(!Yx(h))throw Error(r(200));return Qx(null,u,h,!0,S)},xi.hydrateRoot=function(u,h,S){if(!Lv(u))throw Error(r(405));var F=S!=null&&S.hydratedSources||null,U=!1,J="",ce=yk;if(S!=null&&(S.unstable_strictMode===!0&&(U=!0),S.identifierPrefix!==void 0&&(J=S.identifierPrefix),S.onRecoverableError!==void 0&&(ce=S.onRecoverableError)),h=pk(h,null,u,1,S??null,U,!1,J,ce),u[Ki]=h.current,Kl(u),F)for(u=0;u<F.length;u++)S=F[u],U=S._getVersion,U=U(S._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[S,U]:h.mutableSourceEagerHydrationData.push(S,U);return new Xx(h)},xi.render=function(u,h,S){if(!Yx(h))throw Error(r(200));return Qx(null,u,h,!1,S)},xi.unmountComponentAtNode=function(u){if(!Yx(u))throw Error(r(40));return u._reactRootContainer?(Cd(function(){Qx(null,null,u,!1,function(){u._reactRootContainer=null,u[Ki]=null})}),!0):!1},xi.unstable_batchedUpdates=Av,xi.unstable_renderSubtreeIntoContainer=function(u,h,S,F){if(!Yx(S))throw Error(r(200));if(u==null||u._reactInternals===void 0)throw Error(r(38));return Qx(u,h,S,!1,F)},xi.version="18.3.1-next-f1338f8080-20240426",xi}var Ek;function T3(){if(Ek)return $v.exports;Ek=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),$v.exports=BP(),$v.exports}var Nk;function UP(){if(Nk)return Zx;Nk=1;var e=T3();return Zx.createRoot=e.createRoot,Zx.hydrateRoot=e.hydrateRoot,Zx}var $P=UP();const WP=bp($P);var Ak=T3();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Hm(){return Hm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Hm.apply(this,arguments)}var ku;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ku||(ku={}));const jk="popstate";function zP(e){e===void 0&&(e={});function t(n,s){let{pathname:a,search:i,hash:l}=n.location;return t_("",{pathname:a,search:i,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:N3(s)}return GP(t,r,null,e)}function Ps(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function E3(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function HP(){return Math.random().toString(36).substr(2,8)}function Fk(e,t){return{usr:e.state,key:e.key,idx:t}}function t_(e,t,r,n){return r===void 0&&(r=null),Hm({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?g0(t):t,{state:r,key:t&&t.key||n||HP()})}function N3(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function g0(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function GP(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:a=!1}=n,i=s.history,l=ku.Pop,c=null,d=f();d==null&&(d=0,i.replaceState(Hm({},i.state,{idx:d}),""));function f(){return(i.state||{idx:null}).idx}function p(){l=ku.Pop;let b=f(),E=b==null?null:b-d;d=b,c&&c({action:l,location:_.location,delta:E})}function g(b,E){l=ku.Push;let k=t_(_.location,b,E);d=f()+1;let w=Fk(k,d),N=_.createHref(k);try{i.pushState(w,"",N)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;s.location.assign(N)}a&&c&&c({action:l,location:_.location,delta:1})}function y(b,E){l=ku.Replace;let k=t_(_.location,b,E);d=f();let w=Fk(k,d),N=_.createHref(k);i.replaceState(w,"",N),a&&c&&c({action:l,location:_.location,delta:0})}function v(b){let E=s.location.origin!=="null"?s.location.origin:s.location.href,k=typeof b=="string"?b:N3(b);return k=k.replace(/ $/,"%20"),Ps(E,"No window.location.(origin|href) available to create URL for href: "+k),new URL(k,E)}let _={get action(){return l},get location(){return e(s,i)},listen(b){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(jk,p),c=b,()=>{s.removeEventListener(jk,p),c=null}},createHref(b){return t(s,b)},createURL:v,encodeLocation(b){let E=v(b);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:g,replace:y,go(b){return i.go(b)}};return _}var Pk;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Pk||(Pk={}));function VP(e,t,r){return r===void 0&&(r="/"),KP(e,t,r)}function KP(e,t,r,n){let s=typeof t=="string"?g0(t):t,a=F3(s.pathname||"/",r);if(a==null)return null;let i=A3(e);qP(i);let l=null;for(let c=0;l==null&&c<i.length;++c){let d=iR(a);l=nR(i[c],d)}return l}function A3(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(a,i,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:i,route:a};c.relativePath.startsWith("/")&&(Ps(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let d=Ud([n,c.relativePath]),f=r.concat(c);a.children&&a.children.length>0&&(Ps(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),A3(a.children,t,f,d)),!(a.path==null&&!a.index)&&t.push({path:d,score:tR(d,a.index),routesMeta:f})};return e.forEach((a,i)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))s(a,i);else for(let c of j3(a.path))s(a,i,c)}),t}function j3(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return s?[a,""]:[a];let i=j3(n.join("/")),l=[];return l.push(...i.map(c=>c===""?a:[a,c].join("/"))),s&&l.push(...i),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function qP(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:rR(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const XP=/^:[\w-]+$/,YP=3,QP=2,JP=1,ZP=10,eR=-2,Rk=e=>e==="*";function tR(e,t){let r=e.split("/"),n=r.length;return r.some(Rk)&&(n+=eR),t&&(n+=QP),r.filter(s=>!Rk(s)).reduce((s,a)=>s+(XP.test(a)?YP:a===""?JP:ZP),n)}function rR(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function nR(e,t,r){let{routesMeta:n}=e,s={},a="/",i=[];for(let l=0;l<n.length;++l){let c=n[l],d=l===n.length-1,f=a==="/"?t:t.slice(a.length)||"/",p=sR({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},f),g=c.route;if(!p)return null;Object.assign(s,p.params),i.push({params:s,pathname:Ud([a,p.pathname]),pathnameBase:uR(Ud([a,p.pathnameBase])),route:g}),p.pathnameBase!=="/"&&(a=Ud([a,p.pathnameBase]))}return i}function sR(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=aR(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let a=s[0],i=a.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:n.reduce((d,f,p)=>{let{paramName:g,isOptional:y}=f;if(g==="*"){let _=l[p]||"";i=a.slice(0,a.length-_.length).replace(/(.)\/+$/,"$1")}const v=l[p];return y&&!v?d[g]=void 0:d[g]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:i,pattern:e}}function aR(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),E3(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function iR(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return E3(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function F3(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function oR(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:s=""}=typeof e=="string"?g0(e):e;return{pathname:r?r.startsWith("/")?r:lR(r,t):t,search:dR(n),hash:fR(s)}}function lR(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function Hv(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function cR(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function P3(e,t){let r=cR(e);return t?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function R3(e,t,r,n){n===void 0&&(n=!1);let s;typeof e=="string"?s=g0(e):(s=Hm({},e),Ps(!s.pathname||!s.pathname.includes("?"),Hv("?","pathname","search",s)),Ps(!s.pathname||!s.pathname.includes("#"),Hv("#","pathname","hash",s)),Ps(!s.search||!s.search.includes("#"),Hv("#","search","hash",s)));let a=e===""||s.pathname==="",i=a?"/":s.pathname,l;if(i==null)l=r;else{let p=t.length-1;if(!n&&i.startsWith("..")){let g=i.split("/");for(;g[0]==="..";)g.shift(),p-=1;s.pathname=g.join("/")}l=p>=0?t[p]:"/"}let c=oR(s,l),d=i&&i!=="/"&&i.endsWith("/"),f=(a||i===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||f)&&(c.pathname+="/"),c}const Ud=e=>e.join("/").replace(/\/\/+/g,"/"),uR=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),dR=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,fR=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function hR(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const D3=["post","put","patch","delete"];new Set(D3);const gR=["get",...D3];new Set(gR);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gm(){return Gm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gm.apply(this,arguments)}const _2=C.createContext(null),mR=C.createContext(null),Sp=C.createContext(null),Ty=C.createContext(null),zu=C.createContext({outlet:null,matches:[],isDataRoute:!1}),I3=C.createContext(null);function kp(){return C.useContext(Ty)!=null}function Ey(){return kp()||Ps(!1),C.useContext(Ty).location}function M3(e){C.useContext(Sp).static||C.useLayoutEffect(e)}function Ei(){let{isDataRoute:e}=C.useContext(zu);return e?NR():pR()}function pR(){kp()||Ps(!1);let e=C.useContext(_2),{basename:t,future:r,navigator:n}=C.useContext(Sp),{matches:s}=C.useContext(zu),{pathname:a}=Ey(),i=JSON.stringify(P3(s,r.v7_relativeSplatPath)),l=C.useRef(!1);return M3(()=>{l.current=!0}),C.useCallback(function(d,f){if(f===void 0&&(f={}),!l.current)return;if(typeof d=="number"){n.go(d);return}let p=R3(d,JSON.parse(i),a,f.relative==="path");e==null&&t!=="/"&&(p.pathname=p.pathname==="/"?t:Ud([t,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[t,n,i,a,e])}function Ny(){let{matches:e}=C.useContext(zu),t=e[e.length-1];return t?t.params:{}}function xR(e,t){return yR(e,t)}function yR(e,t,r,n){kp()||Ps(!1);let{navigator:s}=C.useContext(Sp),{matches:a}=C.useContext(zu),i=a[a.length-1],l=i?i.params:{};i&&i.pathname;let c=i?i.pathnameBase:"/";i&&i.route;let d=Ey(),f;if(t){var p;let b=typeof t=="string"?g0(t):t;c==="/"||(p=b.pathname)!=null&&p.startsWith(c)||Ps(!1),f=b}else f=d;let g=f.pathname||"/",y=g;if(c!=="/"){let b=c.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(b.length).join("/")}let v=VP(e,{pathname:y}),_=SR(v&&v.map(b=>Object.assign({},b,{params:Object.assign({},l,b.params),pathname:Ud([c,s.encodeLocation?s.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?c:Ud([c,s.encodeLocation?s.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),a,r,n);return t&&_?C.createElement(Ty.Provider,{value:{location:Gm({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:ku.Pop}},_):_}function vR(){let e=ER(),t=hR(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},t),r?C.createElement("pre",{style:s},r):null,null)}const wR=C.createElement(vR,null);class _R extends C.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?C.createElement(zu.Provider,{value:this.props.routeContext},C.createElement(I3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function bR(e){let{routeContext:t,match:r,children:n}=e,s=C.useContext(_2);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),C.createElement(zu.Provider,{value:t},n)}function SR(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var a;if(!r)return null;if(r.errors)e=r.matches;else if((a=n)!=null&&a.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let i=e,l=(s=r)==null?void 0:s.errors;if(l!=null){let f=i.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);f>=0||Ps(!1),i=i.slice(0,Math.min(i.length,f+1))}let c=!1,d=-1;if(r&&n&&n.v7_partialHydration)for(let f=0;f<i.length;f++){let p=i[f];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(d=f),p.route.id){let{loaderData:g,errors:y}=r,v=p.route.loader&&g[p.route.id]===void 0&&(!y||y[p.route.id]===void 0);if(p.route.lazy||v){c=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}return i.reduceRight((f,p,g)=>{let y,v=!1,_=null,b=null;r&&(y=l&&p.route.id?l[p.route.id]:void 0,_=p.route.errorElement||wR,c&&(d<0&&g===0?(AR("route-fallback"),v=!0,b=null):d===g&&(v=!0,b=p.route.hydrateFallbackElement||null)));let E=t.concat(i.slice(0,g+1)),k=()=>{let w;return y?w=_:v?w=b:p.route.Component?w=C.createElement(p.route.Component,null):p.route.element?w=p.route.element:w=f,C.createElement(bR,{match:p,routeContext:{outlet:f,matches:E,isDataRoute:r!=null},children:w})};return r&&(p.route.ErrorBoundary||p.route.errorElement||g===0)?C.createElement(_R,{location:r.location,revalidation:r.revalidation,component:_,error:y,children:k(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):k()},null)}var O3=(function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e})(O3||{}),L3=(function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e})(L3||{});function kR(e){let t=C.useContext(_2);return t||Ps(!1),t}function CR(e){let t=C.useContext(mR);return t||Ps(!1),t}function TR(e){let t=C.useContext(zu);return t||Ps(!1),t}function B3(e){let t=TR(),r=t.matches[t.matches.length-1];return r.route.id||Ps(!1),r.route.id}function ER(){var e;let t=C.useContext(I3),r=CR(),n=B3();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function NR(){let{router:e}=kR(O3.UseNavigateStable),t=B3(L3.UseNavigateStable),r=C.useRef(!1);return M3(()=>{r.current=!0}),C.useCallback(function(s,a){a===void 0&&(a={}),r.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,Gm({fromRouteId:t},a)))},[e,t])}const Dk={};function AR(e,t,r){Dk[e]||(Dk[e]=!0)}function jR(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function r0(e){let{to:t,replace:r,state:n,relative:s}=e;kp()||Ps(!1);let{future:a,static:i}=C.useContext(Sp),{matches:l}=C.useContext(zu),{pathname:c}=Ey(),d=Ei(),f=R3(t,P3(l,a.v7_relativeSplatPath),c,s==="path"),p=JSON.stringify(f);return C.useEffect(()=>d(JSON.parse(p),{replace:r,state:n,relative:s}),[d,p,s,r,n]),null}function ss(e){Ps(!1)}function FR(e){let{basename:t="/",children:r=null,location:n,navigationType:s=ku.Pop,navigator:a,static:i=!1,future:l}=e;kp()&&Ps(!1);let c=t.replace(/^\/*/,"/"),d=C.useMemo(()=>({basename:c,navigator:a,static:i,future:Gm({v7_relativeSplatPath:!1},l)}),[c,l,a,i]);typeof n=="string"&&(n=g0(n));let{pathname:f="/",search:p="",hash:g="",state:y=null,key:v="default"}=n,_=C.useMemo(()=>{let b=F3(f,c);return b==null?null:{location:{pathname:b,search:p,hash:g,state:y,key:v},navigationType:s}},[c,f,p,g,y,v,s]);return _==null?null:C.createElement(Sp.Provider,{value:d},C.createElement(Ty.Provider,{children:r,value:_}))}function b2(e){let{children:t,location:r}=e;return xR(r_(t),r)}new Promise(()=>{});function r_(e,t){t===void 0&&(t=[]);let r=[];return C.Children.forEach(e,(n,s)=>{if(!C.isValidElement(n))return;let a=[...t,s];if(n.type===C.Fragment){r.push.apply(r,r_(n.props.children,a));return}n.type!==ss&&Ps(!1),!n.props.index||!n.props.children||Ps(!1);let i={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=r_(n.props.children,a)),r.push(i)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const PR="6";try{window.__reactRouterVersion=PR}catch{}const RR="startTransition",Ik=OP[RR];function DR(e){let{basename:t,children:r,future:n,window:s}=e,a=C.useRef();a.current==null&&(a.current=zP({window:s,v5Compat:!0}));let i=a.current,[l,c]=C.useState({action:i.action,location:i.location}),{v7_startTransition:d}=n||{},f=C.useCallback(p=>{d&&Ik?Ik(()=>c(p)):c(p)},[c,d]);return C.useLayoutEffect(()=>i.listen(f),[i,f]),C.useEffect(()=>jR(n),[n]),C.createElement(FR,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:i,future:n})}var Mk;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Mk||(Mk={}));var Ok;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Ok||(Ok={}));const Dn={student_subjects:1800*1e3,student_active_tests:600*1e3,student_results_table:600*1e3,teacher_subjects:900*1e3,teacher_classes:900*1e3,teacher_tests:600*1e3,teacher_results_table:600*1e3,admin_users:1200*1e3,admin_teachers:1200*1e3,admin_subjects:1800*1e3,admin_academic_years:3600*1e3,admin_tests:900*1e3,admin_results_table:null,admin_teacher_id:3600*1e3,all_tests:1200*1e3,subjects_dropdown:1800*1e3,grades_classes:3600*1e3,test_progress:120*1e3,anti_cheating:120*1e3,word_matching_test:600*1e3,speaking_test_data:3600*1e3},jn=e=>{try{const t=localStorage.getItem(e);if(!t)return console.log("💾 Cache: No data found for key:",e),null;const{data:r,timestamp:n,ttl:s}=JSON.parse(t),a=Date.now()-n;return a>s?(console.log("💾 Cache: Data expired for key:",e,"age:",a,"ttl:",s),localStorage.removeItem(e),null):(console.log("💾 Cache: Data found for key:",e,"age:",a,"ttl:",s),r)}catch(t){return console.log("💾 Cache: Corrupted data for key:",e,t),localStorage.removeItem(e),null}},Fn=(e,t,r)=>{try{console.log("💾 Cache: Setting data for key:",e,"ttl:",r),localStorage.setItem(e,JSON.stringify({data:t,timestamp:Date.now(),ttl:r})),console.log("💾 Cache: Data cached successfully for key:",e)}catch{console.log("💾 Cache: Storage full, cleaning old data for key:",e),U3();try{localStorage.setItem(e,JSON.stringify({data:t,timestamp:Date.now(),ttl:r})),console.log("💾 Cache: Data cached after cleanup for key:",e)}catch{console.warn("Storage full, cannot cache data")}}},U3=()=>{const e=Date.now(),t=Object.keys(localStorage);t.forEach(s=>{try{const a=localStorage.getItem(s);if(a){const{timestamp:i,ttl:l}=JSON.parse(a);e-i>l&&localStorage.removeItem(s)}}catch{localStorage.removeItem(s)}});const r=e-10080*60*1e3;t.forEach(s=>{try{const a=localStorage.getItem(s);if(a){const{timestamp:i}=JSON.parse(a);i<r&&localStorage.removeItem(s)}}catch{localStorage.removeItem(s)}});const n=Object.keys(localStorage);if(n.length>0){const s=n.map(i=>{try{const l=localStorage.getItem(i);if(l){const{timestamp:c}=JSON.parse(l);return{key:i,timestamp:c}}}catch{return{key:i,timestamp:0}}return{key:i,timestamp:0}}),a=Math.ceil(s.length*.25);s.sort((i,l)=>i.timestamp-l.timestamp).slice(0,a).forEach(({key:i})=>localStorage.removeItem(i))}},S2=e=>{Object.keys(localStorage).forEach(r=>{r.includes(e)&&localStorage.removeItem(r)})},m0=(e,t,r)=>{const n=`test_progress_${e}_${t}_${r}`,s=`anti_cheating_${e}_${t}_${r}`;if(localStorage.removeItem(n),localStorage.removeItem(s),t==="speaking_test_data"){const a=`speaking_test_data_${e}_${r}`;localStorage.removeItem(a),console.log(`Cleared speaking test data cache for ${r}`)}console.log(`Cleared test data for ${t}_${r}`)},Ih=Object.freeze(Object.defineProperty({__proto__:null,CACHE_TTL:Dn,cleanupOldData:U3,clearTestData:m0,clearUserData:S2,getCachedData:jn,setCachedData:Fn},Symbol.toStringTag,{value:"Module"})),$3=C.createContext(),W3=({children:e})=>{const[t,r]=C.useState(null),[n,s]=C.useState(null),[a,i]=C.useState(localStorage.getItem("token")),[l,c]=C.useState(!1),[d,f]=C.useState(!0),[p,g]=C.useState(null);C.useEffect(()=>{console.log("[AUTH] Initializing application session..."),b()},[]),C.useEffect(()=>{if(l&&a){console.log("[AUTH] Setting up proactive token refresh...");let K=!1;const B=setInterval(async()=>{if(l&&a&&!K){K=!0;try{const z=a||localStorage.getItem("auth_token");if(z&&y(z))console.log("[AUTH] Token expired, attempting refresh..."),await v()||console.log("[AUTH] Proactive refresh failed, but user remains logged in");else if(z)try{const Y=JSON.parse(atob(z.split(".")[1])).exp*1e3,te=Date.now(),ee=Y-te;ee<300*1e3&&ee>0&&(console.log(`[AUTH] Token expires in ${Math.round(ee/1e3)} seconds, refreshing...`),await v()||console.log("[AUTH] Proactive refresh failed, but user remains logged in"))}catch(Q){console.error("[AUTH] Error parsing token for expiration check:",Q)}}catch(z){console.error("[AUTH] Error in proactive refresh:",z)}finally{K=!1}}},300*1e3);return()=>{console.log("[AUTH] Clearing proactive token refresh interval"),clearInterval(B)}}},[l,a]);const y=K=>{if(!K)return!0;try{const B=JSON.parse(atob(K.split(".")[1])),z=Date.now()/1e3;return B.exp<=z}catch(B){return console.error("[AUTH] Error decoding token:",B),!0}},v=async()=>{const K=localStorage.getItem("refresh_token");if(!K)return console.log("[AUTH] No refresh token found"),!1;try{const B=await fetch("/.netlify/functions/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:K})});if(B.ok){const z=await B.json();console.log("[AUTH] Token refresh successful"),localStorage.setItem("auth_token",z.accessToken),localStorage.setItem("refresh_token",z.refreshToken),localStorage.setItem("accessToken",z.accessToken);try{window.tokenManager&&(window.tokenManager.setToken(z.accessToken),z.refreshToken&&window.tokenManager.setRefreshToken(z.refreshToken))}catch{}return i(z.accessToken),!0}else return console.error("[AUTH] Token refresh failed:",B.status),!1}catch(B){return console.error("[AUTH] Token refresh error:",B),!1}},_=async(K,B={})=>{const z=a||localStorage.getItem("auth_token");if(!z)throw new Error("No authentication token found");const Q={"Content-Type":"application/json",Authorization:`Bearer ${z}`,...B.headers},Y=await fetch(K,{...B,headers:Q});if(Y.status===401)if(console.log("[AUTH] 401 error, attempting token refresh..."),await v()){const ee=localStorage.getItem("auth_token");return Q.Authorization=`Bearer ${ee}`,fetch(K,{...B,headers:Q})}else throw console.log("[AUTH] Token refresh failed, returning 401 response"),new Error("Authentication failed - please login again");return Y},b=async()=>{try{console.log("[AUTH] Starting session initialization..."),f(!0);const K=localStorage.getItem("auth_token")||localStorage.getItem("accessToken")||localStorage.getItem("token"),B=localStorage.getItem("user_data")||localStorage.getItem("userData"),z=B?JSON.parse(B).role:null;if(console.log("[AUTH] Found stored data:",{hasToken:!!K,hasUser:!!B,role:z}),K&&z&&B)try{const Q=JSON.parse(B);if(y(K))if(console.log("[AUTH] Token expired, attempting refresh..."),await v()){console.log("[AUTH] Token refreshed successfully");const te=localStorage.getItem("auth_token");i(te)}else console.log("[AUTH] Token refresh failed, but continuing with existing token..."),i(K);else i(K);s(z),r(Q);try{if(window.tokenManager){window.tokenManager.setToken(localStorage.getItem("auth_token"));const Y=localStorage.getItem("refresh_token");Y&&window.tokenManager.setRefreshToken(Y)}}catch{}c(!0),await w(Q,z)}catch(Q){console.error("[AUTH] Error parsing stored user data:",Q),console.log("[AUTH] Invalid user data, but not forcing logout - continuing with empty state"),c(!1)}}catch(K){console.error("[AUTH] Session initialization error:",K),console.log("[AUTH] Initialization error, but not forcing logout - continuing with empty state"),c(!1)}finally{console.log("[AUTH] Session initialization complete"),f(!1)}},E=async K=>{try{if(f(!0),g(null),window.forceLogout||window.preventAutoLogin){console.log("⚠️ Login blocked - force logout in progress"),g("Please wait for the logout process to complete.");return}console.log("Attempting login with:",K.username);let B,z;K.username==="admin"?(B={ok:!0,json:()=>({success:!0,token:"test-token"})},z="admin"):(B=await authService.teacherLogin(K),z="teacher");const Q=await B.json();await k(B,z,Q)}catch(B){T(B)}finally{f(!1)}},k=async(K,B,z)=>{try{if(K.ok&&z.success&&z.token){i(z.token),s(B),r(z),c(!0),localStorage.setItem("auth_token",z.accessToken||z.token),localStorage.setItem("refresh_token",z.refreshToken),localStorage.setItem("user_data",JSON.stringify(z)),localStorage.setItem("accessToken",z.accessToken||z.token);try{const Q=Date.now(),Y=10080*60*1e3,te=[];for(let ee=0;ee<localStorage.length;ee++){const ae=localStorage.key(ee);if(!(!ae||!(ae.startsWith("test_progress_")||ae.startsWith("test_timer_")||ae.startsWith("test_shuffle_order_")||ae.startsWith("student_results_table_")||ae.startsWith("anti_cheating_"))))try{const _e=localStorage.getItem(ae);if(!_e){te.push(ae);continue}let Me=null;if(_e.startsWith("{")||_e.startsWith("[")){const ue=JSON.parse(_e),me=ue.timestamp||ue.lastSaved||ue.lastTickAt||ue.createdAt||ue.updatedAt||ue.startedAt||ue.started_at;me&&(Me=new Date(me).getTime())}if(!Me){const ue=`${ae}__ts`,me=localStorage.getItem(ue);me&&(Me=parseInt(me)||null)}if(!Me)continue;Q-Me>Y&&te.push(ae)}catch{}}te.forEach(ee=>{try{localStorage.removeItem(ee)}catch{}})}catch(Q){console.warn("LocalStorage cleanup skipped:",Q)}return await w(z,B),!0}else{const Q=z.message||K.statusText||"Login failed";return T(new Error(Q)),!1}}catch(Q){return T(Q),!1}},w=async(K,B)=>{try{switch(B){case"admin":console.log("Admin login successful, role:",K.role),console.log("Admin logged in:",K);break;case"teacher":console.log("Teacher login successful, role:",K.role),console.log("Teacher data:",K.teacher),await A(K),await R();break;case"student":console.log("Student login successful"),N(K);break;default:console.warn("Unknown user role:",B)}}catch(z){console.error("Post-login actions error:",z)}},N=K=>{r(K),console.log("Student info populated:",K)},A=async K=>{r(K),console.log("Teacher info populated:",K)},P=async()=>{try{console.log("Initializing teacher cabinet...")}catch(K){console.error("Error initializing teacher cabinet:",K)}},R=async()=>{try{console.log("Checking teacher subjects...")}catch(K){console.error("Error checking teacher subjects:",K)}},T=K=>{g(K.message||"Login failed"),D()},D=()=>{g(null),f(!1)},I=C.useCallback(()=>{V()},[]),V=()=>{r(null),s(null),i(null),c(!1),g(null);const K=t?.student_id||t?.teacher_id||t?.admin_id||t?.id;K&&S2(K),localStorage.removeItem("token"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("user_role"),localStorage.removeItem("accessToken"),localStorage.removeItem("testProgress"),localStorage.removeItem("formData"),window.tokenManager&&window.tokenManager.clearAuth(),setTimeout(()=>{X()},100)},X=()=>{console.log("Interface reset after session clear - redirecting to login"),window.location.replace("/login")},Z=()=>t?.id||null,ie=()=>n==="admin"?t:null,q=()=>n==="admin",ne=()=>q()?t?.admin_id:null,M=()=>n==="teacher"?t?.username:null,W=()=>{console.log("Auth functions available:",{handleUnifiedLogin:typeof E,logout:typeof I,getCurrentTeacherId:typeof Z,isAdmin:typeof q,getCurrentAdmin:typeof ie,getCurrentAdminId:typeof ne,getCurrentTeacherUsername:typeof M})};C.useEffect(()=>(window.logout=I,window.getCurrentTeacherId=Z,window.getCurrentAdmin=ie,window.isAdmin=q,window.getCurrentAdminId=ne,window.getCurrentTeacherUsername=M,window.checkFunctionAvailability=W,()=>{delete window.logout,delete window.getCurrentTeacherId,delete window.getCurrentAdmin,delete window.isAdmin,delete window.getCurrentAdminId,delete window.getCurrentTeacherUsername,delete window.checkFunctionAvailability}),[I]);const L=C.useCallback(K=>{console.log("Setting user data from external auth:",K),r(K),s(K.role),i(K.token),c(!0),f(!1),g(null),localStorage.setItem("auth_token",K.token),localStorage.setItem("user_data",JSON.stringify(K)),localStorage.setItem("accessToken",K.token)},[]),H={user:t,role:n,token:a,isAuthenticated:l,isLoading:d,error:p,login:E,setUserData:L,logout:I,resetLoginForm:D,forceCompleteLogout:V,initializeApplicationSession:b,makeAuthenticatedRequest:_,populateStudentInfo:N,populateTeacherInfo:A,initializeTeacherCabinet:P,checkTeacherSubjects:R,getCurrentTeacherId:Z,getCurrentAdmin:ie,isAdmin:q,getCurrentAdminId:ne,getCurrentTeacherUsername:M,handleLoginResponse:k,handlePostLoginActions:w,handleLoginFailure:T,resetInterfaceAfterSessionClear:X,checkFunctionAvailability:W};return o.jsx($3.Provider,{value:H,children:e})},Bn=()=>{const e=C.useContext($3);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e};class IR{constructor(){this.baseURL="http://localhost:8888/.netlify/functions",this.timeout=1e4,this.retryCount=3,this.retryDelay=1e3}getHeaders(){const t=localStorage.getItem("token");return{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}}}async sendRequest(t,r){try{return await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(n){throw console.error("❌ Network error:",n),n}}async request(t,r={}){const n=`${this.baseURL}${t}`,s={method:"GET",headers:this.getHeaders(),timeout:this.timeout,...r};let a;for(let i=0;i<this.retryCount;i++)try{const l=new AbortController,c=setTimeout(()=>l.abort(),this.timeout),d=await fetch(n,{...s,signal:l.signal});if(clearTimeout(c),!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(l){if(a=l,l.name==="AbortError")throw new Error("Request timeout");i<this.retryCount-1&&(console.warn(`Request failed, retrying in ${this.retryDelay}ms... (attempt ${i+1}/${this.retryCount})`),await new Promise(c=>setTimeout(c,this.retryDelay*Math.pow(2,i))))}throw a}async get(t,r={}){return this.request(t,{...r,method:"GET"})}async post(t,r,n={}){return this.request(t,{...n,method:"POST",body:JSON.stringify(r)})}async put(t,r,n={}){return this.request(t,{...n,method:"PUT",body:JSON.stringify(r)})}async delete(t,r={}){return this.request(t,{...r,method:"DELETE"})}async patch(t,r,n={}){return this.request(t,{...n,method:"PATCH",body:JSON.stringify(r)})}async uploadFile(t,r,n={}){const s=new FormData;s.append("file",r);const a=`${this.baseURL}${t}`,i={method:"POST",headers:{...localStorage.getItem("token")&&{Authorization:`Bearer ${localStorage.getItem("token")}`}},body:s,...n};try{const l=await fetch(a,i);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){throw l}}async downloadFile(t,r,n={}){const s=`${this.baseURL}${t}`,a={method:"GET",headers:this.getHeaders(),...n};try{const i=await fetch(s,a);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const l=await i.blob(),c=window.URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=r,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(c)}catch(i){throw i}}ensureDebugOutput(){let t=document.getElementById("debug-output");return t||(t=document.createElement("div"),t.id="debug-output",t.className="fixed top-4 right-4 w-96 max-h-96 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-50 overflow-auto",t.innerHTML='<div class="text-sm font-mono text-gray-800">Debug Output</div>',document.body.appendChild(t)),t}async testDbConnection(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/test-db-connection")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Database Connection Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,message:"Database connection successful",data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Database Connection Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,message:"Database connection failed",error:t.message}}}async testStudentLogin(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/student-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:"51706",password:"1"})})).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Student Login Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Student Login Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testTeacherLogin(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/teacher-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:"Aleksandr_Petrov",password:"465"})})).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Teacher Login Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Teacher Login Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testAdminLogin(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/admin-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:"admin",password:"admin123"})})).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Admin Login Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Admin Login Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetSubjects(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-subjects")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Subjects Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Subjects Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetTeacherSubjects(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-teacher-subjects")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Teacher Subjects Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Teacher Subjects Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetClassResults(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-class-results")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Class Results Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Class Results Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetStudentSubjects(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-student-subjects")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Student Subjects Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Student Subjects Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testGetStudentTestResults(){try{const t=this.ensureDebugOutput(),n=await(await fetch("/.netlify/functions/get-student-test-results")).json();return t&&(t.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Get Student Test Results Test</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),{success:!0,data:n}}catch(t){const r=this.ensureDebugOutput();return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Get Student Test Results Error</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${t.message}</pre>
        `),{success:!1,error:t.message}}}async testEndpoints(){const t=["/debug/test-student-login","/debug/test-teacher-login","/debug/test-admin-login","/debug/test-get-subjects","/debug/test-get-teacher-subjects","/debug/test-get-class-results","/debug/test-get-student-subjects","/debug/test-get-student-test-results"],r={};for(const n of t)try{const s=await this.get(n);r[n]={success:!0,data:s}}catch(s){r[n]={success:!1,error:s.message}}return r}async debugFunction(t){const r=this.ensureDebugOutput();try{let n;switch(t){case"testDbConnection":n=await this.testDbConnection();break;case"testStudentLogin":n=await this.testStudentLogin();break;case"testTeacherLogin":n=await this.testTeacherLogin();break;case"testAdminLogin":n=await this.testAdminLogin();break;case"testGetSubjects":n=await this.testGetSubjects();break;case"testGetTeacherSubjects":n=await this.testGetTeacherSubjects();break;case"testGetClassResults":n=await this.testGetClassResults();break;case"testGetStudentSubjects":n=await this.testGetStudentSubjects();break;case"testGetStudentTestResults":n=await this.testGetStudentTestResults();break;default:throw new Error(`Unknown debug function: ${t}`)}return r&&(r.innerHTML=`
          <div class="text-sm font-mono text-gray-800 mb-2">Debug Function: ${t}</div>
          <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(n,null,2)}</pre>
        `),n}catch(n){throw r&&(r.innerHTML=`
          <div class="text-sm font-mono text-red-600 mb-2">Debug Function Error: ${t}</div>
          <pre class="text-xs bg-red-100 p-2 rounded overflow-auto">Error: ${n.message}</pre>
        `),n}}showDebugFunctions(){const t=this.ensureDebugOutput(),r=`
      <div class="text-sm font-mono text-gray-800 mb-4">Debug Functions</div>
      <div class="grid grid-cols-2 gap-2 mb-4">
        <button onclick="apiClient.testDbConnection()" class="px-3 py-2 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">
          Test DB Connection
        </button>
        <button onclick="apiClient.testStudentLogin()" class="px-3 py-2 bg-green-500 text-white text-xs rounded hover:bg-green-600 transition-colors">
          Test Student Login
        </button>
        <button onclick="apiClient.testTeacherLogin()" class="px-3 py-2 bg-yellow-500 text-white text-xs rounded hover:bg-yellow-600 transition-colors">
          Test Teacher Login
        </button>
        <button onclick="apiClient.testAdminLogin()" class="px-3 py-2 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors">
          Test Admin Login
        </button>
        <button onclick="apiClient.testGetSubjects()" class="px-3 py-2 bg-purple-500 text-white text-xs rounded hover:bg-purple-600 transition-colors">
          Test Get Subjects
        </button>
        <button onclick="apiClient.testGetTeacherSubjects()" class="px-3 py-2 bg-indigo-500 text-white text-xs rounded hover:bg-indigo-600 transition-colors">
          Test Get Teacher Subjects
        </button>
        <button onclick="apiClient.testGetClassResults()" class="px-3 py-2 bg-pink-500 text-white text-xs rounded hover:bg-pink-600 transition-colors">
          Test Get Class Results
        </button>
        <button onclick="apiClient.testGetStudentSubjects()" class="px-3 py-2 bg-teal-500 text-white text-xs rounded hover:bg-teal-600 transition-colors">
          Test Get Student Subjects
        </button>
        <button onclick="apiClient.testGetStudentTestResults()" class="px-3 py-2 bg-orange-500 text-white text-xs rounded hover:bg-orange-600 transition-colors">
          Test Get Student Test Results
        </button>
        <button onclick="apiClient.testEndpoints()" class="px-3 py-2 bg-gray-500 text-white text-xs rounded hover:bg-gray-600 transition-colors">
          Test All Endpoints
        </button>
      </div>
    `;t.innerHTML=r}}const es=new IR,k2=C.createContext({});function C2(e){const t=C.useRef(null);return t.current===null&&(t.current=e()),t.current}const T2=typeof window<"u",z3=T2?C.useLayoutEffect:C.useEffect,Ay=C.createContext(null);function E2(e,t){e.indexOf(t)===-1&&e.push(t)}function N2(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Sc=(e,t,r)=>r>t?t:r<e?e:r;let A2=()=>{};const kc={},H3=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function G3(e){return typeof e=="object"&&e!==null}const V3=e=>/^0[^.\s]+$/u.test(e);function j2(e){let t;return()=>(t===void 0&&(t=e()),t)}const mo=e=>e,MR=(e,t)=>r=>t(e(r)),Cp=(...e)=>e.reduce(MR),Vm=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n};class F2{constructor(){this.subscriptions=[]}add(t){return E2(this.subscriptions,t),()=>N2(this.subscriptions,t)}notify(t,r,n){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](t,r,n);else for(let a=0;a<s;a++){const i=this.subscriptions[a];i&&i(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const El=e=>e*1e3,Nl=e=>e/1e3;function K3(e,t){return t?e*(1e3/t):0}const q3=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,OR=1e-7,LR=12;function BR(e,t,r,n,s){let a,i,l=0;do i=t+(r-t)/2,a=q3(i,n,s)-e,a>0?r=i:t=i;while(Math.abs(a)>OR&&++l<LR);return i}function Tp(e,t,r,n){if(e===t&&r===n)return mo;const s=a=>BR(a,0,1,e,r);return a=>a===0||a===1?a:q3(s(a),t,n)}const X3=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Y3=e=>t=>1-e(1-t),Q3=Tp(.33,1.53,.69,.99),P2=Y3(Q3),J3=X3(P2),Z3=e=>(e*=2)<1?.5*P2(e):.5*(2-Math.pow(2,-10*(e-1))),R2=e=>1-Math.sin(Math.acos(e)),e5=Y3(R2),t5=X3(R2),UR=Tp(.42,0,1,1),$R=Tp(0,0,.58,1),r5=Tp(.42,0,.58,1),WR=e=>Array.isArray(e)&&typeof e[0]!="number",n5=e=>Array.isArray(e)&&typeof e[0]=="number",zR={linear:mo,easeIn:UR,easeInOut:r5,easeOut:$R,circIn:R2,circInOut:t5,circOut:e5,backIn:P2,backInOut:J3,backOut:Q3,anticipate:Z3},HR=e=>typeof e=="string",Lk=e=>{if(n5(e)){A2(e.length===4);const[t,r,n,s]=e;return Tp(t,r,n,s)}else if(HR(e))return zR[e];return e},e1=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function GR(e,t){let r=new Set,n=new Set,s=!1,a=!1;const i=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(f){i.has(f)&&(d.schedule(f),e()),f(l)}const d={schedule:(f,p=!1,g=!1)=>{const v=g&&s?r:n;return p&&i.add(f),v.has(f)||v.add(f),f},cancel:f=>{n.delete(f),i.delete(f)},process:f=>{if(l=f,s){a=!0;return}s=!0,[r,n]=[n,r],r.forEach(c),r.clear(),s=!1,a&&(a=!1,d.process(f))}};return d}const VR=40;function s5(e,t){let r=!1,n=!0;const s={delta:0,timestamp:0,isProcessing:!1},a=()=>r=!0,i=e1.reduce((w,N)=>(w[N]=GR(a),w),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:f,update:p,preRender:g,render:y,postRender:v}=i,_=()=>{const w=kc.useManualTiming?s.timestamp:performance.now();r=!1,kc.useManualTiming||(s.delta=n?1e3/60:Math.max(Math.min(w-s.timestamp,VR),1)),s.timestamp=w,s.isProcessing=!0,l.process(s),c.process(s),d.process(s),f.process(s),p.process(s),g.process(s),y.process(s),v.process(s),s.isProcessing=!1,r&&t&&(n=!1,e(_))},b=()=>{r=!0,n=!0,s.isProcessing||e(_)};return{schedule:e1.reduce((w,N)=>{const A=i[N];return w[N]=(P,R=!1,T=!1)=>(r||b(),A.schedule(P,R,T)),w},{}),cancel:w=>{for(let N=0;N<e1.length;N++)i[e1[N]].cancel(w)},state:s,steps:i}}const{schedule:Wn,cancel:Iu,state:pa,steps:Gv}=s5(typeof requestAnimationFrame<"u"?requestAnimationFrame:mo,!0);let E1;function KR(){E1=void 0}const bi={now:()=>(E1===void 0&&bi.set(pa.isProcessing||kc.useManualTiming?pa.timestamp:performance.now()),E1),set:e=>{E1=e,queueMicrotask(KR)}},a5=e=>t=>typeof t=="string"&&t.startsWith(e),D2=a5("--"),qR=a5("var(--"),I2=e=>qR(e)?XR.test(e.split("/*")[0].trim()):!1,XR=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,p0={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Km={...p0,transform:e=>Sc(0,1,e)},t1={...p0,default:1},Tm=e=>Math.round(e*1e5)/1e5,M2=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function YR(e){return e==null}const QR=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,O2=(e,t)=>r=>!!(typeof r=="string"&&QR.test(r)&&r.startsWith(e)||t&&!YR(r)&&Object.prototype.hasOwnProperty.call(r,t)),i5=(e,t,r)=>n=>{if(typeof n!="string")return n;const[s,a,i,l]=n.match(M2);return{[e]:parseFloat(s),[t]:parseFloat(a),[r]:parseFloat(i),alpha:l!==void 0?parseFloat(l):1}},JR=e=>Sc(0,255,e),Vv={...p0,transform:e=>Math.round(JR(e))},Md={test:O2("rgb","red"),parse:i5("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+Vv.transform(e)+", "+Vv.transform(t)+", "+Vv.transform(r)+", "+Tm(Km.transform(n))+")"};function ZR(e){let t="",r="",n="",s="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),s=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),s=e.substring(4,5),t+=t,r+=r,n+=n,s+=s),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:s?parseInt(s,16)/255:1}}const n_={test:O2("#"),parse:ZR,transform:Md.transform},Ep=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),bu=Ep("deg"),Al=Ep("%"),Sr=Ep("px"),eD=Ep("vh"),tD=Ep("vw"),Bk={...Al,parse:e=>Al.parse(e)/100,transform:e=>Al.transform(e*100)},Mh={test:O2("hsl","hue"),parse:i5("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+Al.transform(Tm(t))+", "+Al.transform(Tm(r))+", "+Tm(Km.transform(n))+")"},js={test:e=>Md.test(e)||n_.test(e)||Mh.test(e),parse:e=>Md.test(e)?Md.parse(e):Mh.test(e)?Mh.parse(e):n_.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Md.transform(e):Mh.transform(e),getAnimatableNone:e=>{const t=js.parse(e);return t.alpha=0,js.transform(t)}},rD=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function nD(e){return isNaN(e)&&typeof e=="string"&&(e.match(M2)?.length||0)+(e.match(rD)?.length||0)>0}const o5="number",l5="color",sD="var",aD="var(",Uk="${}",iD=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function qm(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},s=[];let a=0;const l=t.replace(iD,c=>(js.test(c)?(n.color.push(a),s.push(l5),r.push(js.parse(c))):c.startsWith(aD)?(n.var.push(a),s.push(sD),r.push(c)):(n.number.push(a),s.push(o5),r.push(parseFloat(c))),++a,Uk)).split(Uk);return{values:r,split:l,indexes:n,types:s}}function c5(e){return qm(e).values}function u5(e){const{split:t,types:r}=qm(e),n=t.length;return s=>{let a="";for(let i=0;i<n;i++)if(a+=t[i],s[i]!==void 0){const l=r[i];l===o5?a+=Tm(s[i]):l===l5?a+=js.transform(s[i]):a+=s[i]}return a}}const oD=e=>typeof e=="number"?0:js.test(e)?js.getAnimatableNone(e):e;function lD(e){const t=c5(e);return u5(e)(t.map(oD))}const Mu={test:nD,parse:c5,createTransformer:u5,getAnimatableNone:lD};function Kv(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function cD({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let s=0,a=0,i=0;if(!t)s=a=i=r;else{const l=r<.5?r*(1+t):r+t-r*t,c=2*r-l;s=Kv(c,l,e+1/3),a=Kv(c,l,e),i=Kv(c,l,e-1/3)}return{red:Math.round(s*255),green:Math.round(a*255),blue:Math.round(i*255),alpha:n}}function B1(e,t){return r=>r>0?t:e}const Vn=(e,t,r)=>e+(t-e)*r,qv=(e,t,r)=>{const n=e*e,s=r*(t*t-n)+n;return s<0?0:Math.sqrt(s)},uD=[n_,Md,Mh],dD=e=>uD.find(t=>t.test(e));function $k(e){const t=dD(e);if(!t)return!1;let r=t.parse(e);return t===Mh&&(r=cD(r)),r}const Wk=(e,t)=>{const r=$k(e),n=$k(t);if(!r||!n)return B1(e,t);const s={...r};return a=>(s.red=qv(r.red,n.red,a),s.green=qv(r.green,n.green,a),s.blue=qv(r.blue,n.blue,a),s.alpha=Vn(r.alpha,n.alpha,a),Md.transform(s))},s_=new Set(["none","hidden"]);function fD(e,t){return s_.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function hD(e,t){return r=>Vn(e,t,r)}function L2(e){return typeof e=="number"?hD:typeof e=="string"?I2(e)?B1:js.test(e)?Wk:pD:Array.isArray(e)?d5:typeof e=="object"?js.test(e)?Wk:gD:B1}function d5(e,t){const r=[...e],n=r.length,s=e.map((a,i)=>L2(a)(a,t[i]));return a=>{for(let i=0;i<n;i++)r[i]=s[i](a);return r}}function gD(e,t){const r={...e,...t},n={};for(const s in r)e[s]!==void 0&&t[s]!==void 0&&(n[s]=L2(e[s])(e[s],t[s]));return s=>{for(const a in n)r[a]=n[a](s);return r}}function mD(e,t){const r=[],n={color:0,var:0,number:0};for(let s=0;s<t.values.length;s++){const a=t.types[s],i=e.indexes[a][n[a]],l=e.values[i]??0;r[s]=l,n[a]++}return r}const pD=(e,t)=>{const r=Mu.createTransformer(t),n=qm(e),s=qm(t);return n.indexes.var.length===s.indexes.var.length&&n.indexes.color.length===s.indexes.color.length&&n.indexes.number.length>=s.indexes.number.length?s_.has(e)&&!s.values.length||s_.has(t)&&!n.values.length?fD(e,t):Cp(d5(mD(n,s),s.values),r):B1(e,t)};function f5(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?Vn(e,t,r):L2(e)(e,t)}const xD=e=>{const t=({timestamp:r})=>e(r);return{start:(r=!0)=>Wn.update(t,r),stop:()=>Iu(t),now:()=>pa.isProcessing?pa.timestamp:bi.now()}},h5=(e,t,r=10)=>{let n="";const s=Math.max(Math.round(t/r),2);for(let a=0;a<s;a++)n+=Math.round(e(a/(s-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},U1=2e4;function B2(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<U1;)t+=r,n=e.next(t);return t>=U1?1/0:t}function yD(e,t=100,r){const n=r({...e,keyframes:[0,t]}),s=Math.min(B2(n),U1);return{type:"keyframes",ease:a=>n.next(s*a).value/t,duration:Nl(s)}}const vD=5;function g5(e,t,r){const n=Math.max(t-vD,0);return K3(r-e(n),t-n)}const ts={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Xv=.001;function wD({duration:e=ts.duration,bounce:t=ts.bounce,velocity:r=ts.velocity,mass:n=ts.mass}){let s,a,i=1-t;i=Sc(ts.minDamping,ts.maxDamping,i),e=Sc(ts.minDuration,ts.maxDuration,Nl(e)),i<1?(s=d=>{const f=d*i,p=f*e,g=f-r,y=a_(d,i),v=Math.exp(-p);return Xv-g/y*v},a=d=>{const p=d*i*e,g=p*r+r,y=Math.pow(i,2)*Math.pow(d,2)*e,v=Math.exp(-p),_=a_(Math.pow(d,2),i);return(-s(d)+Xv>0?-1:1)*((g-y)*v)/_}):(s=d=>{const f=Math.exp(-d*e),p=(d-r)*e+1;return-Xv+f*p},a=d=>{const f=Math.exp(-d*e),p=(r-d)*(e*e);return f*p});const l=5/e,c=bD(s,a,l);if(e=El(e),isNaN(c))return{stiffness:ts.stiffness,damping:ts.damping,duration:e};{const d=Math.pow(c,2)*n;return{stiffness:d,damping:i*2*Math.sqrt(n*d),duration:e}}}const _D=12;function bD(e,t,r){let n=r;for(let s=1;s<_D;s++)n=n-e(n)/t(n);return n}function a_(e,t){return e*Math.sqrt(1-t*t)}const SD=["duration","bounce"],kD=["stiffness","damping","mass"];function zk(e,t){return t.some(r=>e[r]!==void 0)}function CD(e){let t={velocity:ts.velocity,stiffness:ts.stiffness,damping:ts.damping,mass:ts.mass,isResolvedFromDuration:!1,...e};if(!zk(e,kD)&&zk(e,SD))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),s=n*n,a=2*Sc(.05,1,1-(e.bounce||0))*Math.sqrt(s);t={...t,mass:ts.mass,stiffness:s,damping:a}}else{const r=wD(e);t={...t,...r,mass:ts.mass},t.isResolvedFromDuration=!0}return t}function $1(e=ts.visualDuration,t=ts.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:s}=r;const a=r.keyframes[0],i=r.keyframes[r.keyframes.length-1],l={done:!1,value:a},{stiffness:c,damping:d,mass:f,duration:p,velocity:g,isResolvedFromDuration:y}=CD({...r,velocity:-Nl(r.velocity||0)}),v=g||0,_=d/(2*Math.sqrt(c*f)),b=i-a,E=Nl(Math.sqrt(c/f)),k=Math.abs(b)<5;n||(n=k?ts.restSpeed.granular:ts.restSpeed.default),s||(s=k?ts.restDelta.granular:ts.restDelta.default);let w;if(_<1){const A=a_(E,_);w=P=>{const R=Math.exp(-_*E*P);return i-R*((v+_*E*b)/A*Math.sin(A*P)+b*Math.cos(A*P))}}else if(_===1)w=A=>i-Math.exp(-E*A)*(b+(v+E*b)*A);else{const A=E*Math.sqrt(_*_-1);w=P=>{const R=Math.exp(-_*E*P),T=Math.min(A*P,300);return i-R*((v+_*E*b)*Math.sinh(T)+A*b*Math.cosh(T))/A}}const N={calculatedDuration:y&&p||null,next:A=>{const P=w(A);if(y)l.done=A>=p;else{let R=A===0?v:0;_<1&&(R=A===0?El(v):g5(w,A,P));const T=Math.abs(R)<=n,D=Math.abs(i-P)<=s;l.done=T&&D}return l.value=l.done?i:P,l},toString:()=>{const A=Math.min(B2(N),U1),P=h5(R=>N.next(A*R).value,A,30);return A+"ms "+P},toTransition:()=>{}};return N}$1.applyToOptions=e=>{const t=yD(e,100,$1);return e.ease=t.ease,e.duration=El(t.duration),e.type="keyframes",e};function i_({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:s=10,bounceStiffness:a=500,modifyTarget:i,min:l,max:c,restDelta:d=.5,restSpeed:f}){const p=e[0],g={done:!1,value:p},y=T=>l!==void 0&&T<l||c!==void 0&&T>c,v=T=>l===void 0?c:c===void 0||Math.abs(l-T)<Math.abs(c-T)?l:c;let _=r*t;const b=p+_,E=i===void 0?b:i(b);E!==b&&(_=E-p);const k=T=>-_*Math.exp(-T/n),w=T=>E+k(T),N=T=>{const D=k(T),I=w(T);g.done=Math.abs(D)<=d,g.value=g.done?E:I};let A,P;const R=T=>{y(g.value)&&(A=T,P=$1({keyframes:[g.value,v(g.value)],velocity:g5(w,T,g.value),damping:s,stiffness:a,restDelta:d,restSpeed:f}))};return R(0),{calculatedDuration:null,next:T=>{let D=!1;return!P&&A===void 0&&(D=!0,N(T),R(T)),A!==void 0&&T>=A?P.next(T-A):(!D&&N(T),g)}}}function TD(e,t,r){const n=[],s=r||kc.mix||f5,a=e.length-1;for(let i=0;i<a;i++){let l=s(e[i],e[i+1]);if(t){const c=Array.isArray(t)?t[i]||mo:t;l=Cp(c,l)}n.push(l)}return n}function ED(e,t,{clamp:r=!0,ease:n,mixer:s}={}){const a=e.length;if(A2(a===t.length),a===1)return()=>t[0];if(a===2&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const l=TD(t,n,s),c=l.length,d=f=>{if(i&&f<e[0])return t[0];let p=0;if(c>1)for(;p<e.length-2&&!(f<e[p+1]);p++);const g=Vm(e[p],e[p+1],f);return l[p](g)};return r?f=>d(Sc(e[0],e[a-1],f)):d}function ND(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const s=Vm(0,t,n);e.push(Vn(r,1,s))}}function AD(e){const t=[0];return ND(t,e.length-1),t}function jD(e,t){return e.map(r=>r*t)}function FD(e,t){return e.map(()=>t||r5).splice(0,e.length-1)}function Em({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const s=WR(n)?n.map(Lk):Lk(n),a={done:!1,value:t[0]},i=jD(r&&r.length===t.length?r:AD(t),e),l=ED(i,t,{ease:Array.isArray(s)?s:FD(t,s)});return{calculatedDuration:e,next:c=>(a.value=l(c),a.done=c>=e,a)}}const PD=e=>e!==null;function U2(e,{repeat:t,repeatType:r="loop"},n,s=1){const a=e.filter(PD),l=s<0||t&&r!=="loop"&&t%2===1?0:a.length-1;return!l||n===void 0?a[l]:n}const RD={decay:i_,inertia:i_,tween:Em,keyframes:Em,spring:$1};function m5(e){typeof e.type=="string"&&(e.type=RD[e.type])}class $2{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,r){return this.finished.then(t,r)}}const DD=e=>e/100;class W2 extends $2{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==bi.now()&&this.tick(bi.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;m5(t);const{type:r=Em,repeat:n=0,repeatDelay:s=0,repeatType:a,velocity:i=0}=t;let{keyframes:l}=t;const c=r||Em;c!==Em&&typeof l[0]!="number"&&(this.mixKeyframes=Cp(DD,f5(l[0],l[1])),l=[0,100]);const d=c({...t,keyframes:l});a==="mirror"&&(this.mirroredGenerator=c({...t,keyframes:[...l].reverse(),velocity:-i})),d.calculatedDuration===null&&(d.calculatedDuration=B2(d));const{calculatedDuration:f}=d;this.calculatedDuration=f,this.resolvedDuration=f+s,this.totalDuration=this.resolvedDuration*(n+1)-s,this.generator=d}updateTime(t){const r=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(t,r=!1){const{generator:n,totalDuration:s,mixKeyframes:a,mirroredGenerator:i,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return n.next(0);const{delay:d=0,keyframes:f,repeat:p,repeatType:g,repeatDelay:y,type:v,onUpdate:_,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-s/this.speed,this.startTime)),r?this.currentTime=t:this.updateTime(t);const E=this.currentTime-d*(this.playbackSpeed>=0?1:-1),k=this.playbackSpeed>=0?E<0:E>s;this.currentTime=Math.max(E,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let w=this.currentTime,N=n;if(p){const T=Math.min(this.currentTime,s)/l;let D=Math.floor(T),I=T%1;!I&&T>=1&&(I=1),I===1&&D--,D=Math.min(D,p+1),!!(D%2)&&(g==="reverse"?(I=1-I,y&&(I-=y/l)):g==="mirror"&&(N=i)),w=Sc(0,1,I)*l}const A=k?{done:!1,value:f[0]}:N.next(w);a&&(A.value=a(A.value));let{done:P}=A;!k&&c!==null&&(P=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const R=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&P);return R&&v!==i_&&(A.value=U2(f,this.options,b,this.speed)),_&&_(A.value),R&&this.finish(),A}then(t,r){return this.finished.then(t,r)}get duration(){return Nl(this.calculatedDuration)}get time(){return Nl(this.currentTime)}set time(t){t=El(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(bi.now());const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=Nl(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=xD,startTime:r}=this.options;this.driver||(this.driver=t(s=>this.tick(s))),this.options.onPlay?.();const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=r??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(bi.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function ID(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Od=e=>e*180/Math.PI,o_=e=>{const t=Od(Math.atan2(e[1],e[0]));return l_(t)},MD={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:o_,rotateZ:o_,skewX:e=>Od(Math.atan(e[1])),skewY:e=>Od(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},l_=e=>(e=e%360,e<0&&(e+=360),e),Hk=o_,Gk=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Vk=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),OD={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Gk,scaleY:Vk,scale:e=>(Gk(e)+Vk(e))/2,rotateX:e=>l_(Od(Math.atan2(e[6],e[5]))),rotateY:e=>l_(Od(Math.atan2(-e[2],e[0]))),rotateZ:Hk,rotate:Hk,skewX:e=>Od(Math.atan(e[4])),skewY:e=>Od(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function c_(e){return e.includes("scale")?1:0}function u_(e,t){if(!e||e==="none")return c_(t);const r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,s;if(r)n=OD,s=r;else{const l=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=MD,s=l}if(!s)return c_(t);const a=n[t],i=s[1].split(",").map(BD);return typeof a=="function"?a(i):i[a]}const LD=(e,t)=>{const{transform:r="none"}=getComputedStyle(e);return u_(r,t)};function BD(e){return parseFloat(e.trim())}const x0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],y0=new Set(x0),Kk=e=>e===p0||e===Sr,UD=new Set(["x","y","z"]),$D=x0.filter(e=>!UD.has(e));function WD(e){const t=[];return $D.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const $d={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>u_(t,"x"),y:(e,{transform:t})=>u_(t,"y")};$d.translateX=$d.x;$d.translateY=$d.y;const Wd=new Set;let d_=!1,f_=!1,h_=!1;function p5(){if(f_){const e=Array.from(Wd).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const s=WD(n);s.length&&(r.set(n,s),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const s=r.get(n);s&&s.forEach(([a,i])=>{n.getValue(a)?.set(i)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}f_=!1,d_=!1,Wd.forEach(e=>e.complete(h_)),Wd.clear()}function x5(){Wd.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(f_=!0)})}function zD(){h_=!0,x5(),p5(),h_=!1}class z2{constructor(t,r,n,s,a,i=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=s,this.element=a,this.isAsync=i}scheduleResolve(){this.state="scheduled",this.isAsync?(Wd.add(this),d_||(d_=!0,Wn.read(x5),Wn.resolveKeyframes(p5))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:s}=this;if(t[0]===null){const a=s?.get(),i=t[t.length-1];if(a!==void 0)t[0]=a;else if(n&&r){const l=n.readValue(r,i);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=i),s&&a===void 0&&s.set(t[0])}ID(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Wd.delete(this)}cancel(){this.state==="scheduled"&&(Wd.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const HD=e=>e.startsWith("--");function GD(e,t,r){HD(t)?e.style.setProperty(t,r):e.style[t]=r}const VD=j2(()=>window.ScrollTimeline!==void 0),KD={};function qD(e,t){const r=j2(e);return()=>KD[t]??r()}const y5=qD(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),wm=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,qk={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:wm([0,.65,.55,1]),circOut:wm([.55,0,1,.45]),backIn:wm([.31,.01,.66,-.59]),backOut:wm([.33,1.53,.69,.99])};function v5(e,t){if(e)return typeof e=="function"?y5()?h5(e,t):"ease-out":n5(e)?wm(e):Array.isArray(e)?e.map(r=>v5(r,t)||qk.easeOut):qk[e]}function XD(e,t,r,{delay:n=0,duration:s=300,repeat:a=0,repeatType:i="loop",ease:l="easeOut",times:c}={},d=void 0){const f={[t]:r};c&&(f.offset=c);const p=v5(l,s);Array.isArray(p)&&(f.easing=p);const g={delay:n,duration:s,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:a+1,direction:i==="reverse"?"alternate":"normal"};return d&&(g.pseudoElement=d),e.animate(f,g)}function w5(e){return typeof e=="function"&&"applyToOptions"in e}function YD({type:e,...t}){return w5(e)&&y5()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class QD extends $2{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:r,name:n,keyframes:s,pseudoElement:a,allowFlatten:i=!1,finalKeyframe:l,onComplete:c}=t;this.isPseudoElement=!!a,this.allowFlatten=i,this.options=t,A2(typeof t.type!="string");const d=YD(t);this.animation=XD(r,n,s,d,a),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const f=U2(s,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(f):GD(r,n,f),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return Nl(Number(t))}get time(){return Nl(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=El(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&VD()?(this.animation.timeline=t,mo):r(this)}}const _5={anticipate:Z3,backInOut:J3,circInOut:t5};function JD(e){return e in _5}function ZD(e){typeof e.ease=="string"&&JD(e.ease)&&(e.ease=_5[e.ease])}const Xk=10;class e7 extends QD{constructor(t){ZD(t),m5(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:r,onUpdate:n,onComplete:s,element:a,...i}=this.options;if(!r)return;if(t!==void 0){r.set(t);return}const l=new W2({...i,autoplay:!1}),c=El(this.finishedTime??this.time);r.setWithVelocity(l.sample(c-Xk).value,l.sample(c).value,Xk),l.stop()}}const Yk=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Mu.test(e)||e==="0")&&!e.startsWith("url("));function t7(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function r7(e,t,r,n){const s=e[0];if(s===null)return!1;if(t==="display"||t==="visibility")return!0;const a=e[e.length-1],i=Yk(s,t),l=Yk(a,t);return!i||!l?!1:t7(e)||(r==="spring"||w5(r))&&n}function g_(e){e.duration=0,e.type}const n7=new Set(["opacity","clipPath","filter","transform"]),s7=j2(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function a7(e){const{motionValue:t,name:r,repeatDelay:n,repeatType:s,damping:a,type:i}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=t.owner.getProps();return s7()&&r&&n7.has(r)&&(r!=="transform"||!d)&&!c&&!n&&s!=="mirror"&&a!==0&&i!=="inertia"}const i7=40;class o7 extends $2{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:s=0,repeatDelay:a=0,repeatType:i="loop",keyframes:l,name:c,motionValue:d,element:f,...p}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=bi.now();const g={autoplay:t,delay:r,type:n,repeat:s,repeatDelay:a,repeatType:i,name:c,motionValue:d,element:f,...p},y=f?.KeyframeResolver||z2;this.keyframeResolver=new y(l,(v,_,b)=>this.onKeyframesResolved(v,_,g,!b),c,d,f),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,r,n,s){this.keyframeResolver=void 0;const{name:a,type:i,velocity:l,delay:c,isHandoff:d,onUpdate:f}=n;this.resolvedAt=bi.now(),r7(t,a,i,l)||((kc.instantAnimations||!c)&&f?.(U2(t,n,r)),t[0]=t[t.length-1],g_(n),n.repeat=0);const g={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>i7?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...n,keyframes:t},y=!d&&a7(g)?new e7({...g,element:g.motionValue.owner.current}):new W2(g);y.finished.then(()=>this.notifyFinished()).catch(mo),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(t,r){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),zD()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const l7=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function c7(e){const t=l7.exec(e);if(!t)return[,];const[,r,n,s]=t;return[`--${r??n}`,s]}function b5(e,t,r=1){const[n,s]=c7(e);if(!n)return;const a=window.getComputedStyle(t).getPropertyValue(n);if(a){const i=a.trim();return H3(i)?parseFloat(i):i}return I2(s)?b5(s,t,r+1):s}function H2(e,t){return e?.[t]??e?.default??e}const S5=new Set(["width","height","top","left","right","bottom",...x0]),u7={test:e=>e==="auto",parse:e=>e},k5=e=>t=>t.test(e),C5=[p0,Sr,Al,bu,tD,eD,u7],Qk=e=>C5.find(k5(e));function d7(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||V3(e):!0}const f7=new Set(["brightness","contrast","saturate","opacity"]);function h7(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(M2)||[];if(!n)return e;const s=r.replace(n,"");let a=f7.has(t)?1:0;return n!==r&&(a*=100),t+"("+a+s+")"}const g7=/\b([a-z-]*)\(.*?\)/gu,m_={...Mu,getAnimatableNone:e=>{const t=e.match(g7);return t?t.map(h7).join(" "):e}},Jk={...p0,transform:Math.round},m7={rotate:bu,rotateX:bu,rotateY:bu,rotateZ:bu,scale:t1,scaleX:t1,scaleY:t1,scaleZ:t1,skew:bu,skewX:bu,skewY:bu,distance:Sr,translateX:Sr,translateY:Sr,translateZ:Sr,x:Sr,y:Sr,z:Sr,perspective:Sr,transformPerspective:Sr,opacity:Km,originX:Bk,originY:Bk,originZ:Sr},G2={borderWidth:Sr,borderTopWidth:Sr,borderRightWidth:Sr,borderBottomWidth:Sr,borderLeftWidth:Sr,borderRadius:Sr,radius:Sr,borderTopLeftRadius:Sr,borderTopRightRadius:Sr,borderBottomRightRadius:Sr,borderBottomLeftRadius:Sr,width:Sr,maxWidth:Sr,height:Sr,maxHeight:Sr,top:Sr,right:Sr,bottom:Sr,left:Sr,padding:Sr,paddingTop:Sr,paddingRight:Sr,paddingBottom:Sr,paddingLeft:Sr,margin:Sr,marginTop:Sr,marginRight:Sr,marginBottom:Sr,marginLeft:Sr,backgroundPositionX:Sr,backgroundPositionY:Sr,...m7,zIndex:Jk,fillOpacity:Km,strokeOpacity:Km,numOctaves:Jk},p7={...G2,color:js,backgroundColor:js,outlineColor:js,fill:js,stroke:js,borderColor:js,borderTopColor:js,borderRightColor:js,borderBottomColor:js,borderLeftColor:js,filter:m_,WebkitFilter:m_},T5=e=>p7[e];function E5(e,t){let r=T5(e);return r!==m_&&(r=Mu),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const x7=new Set(["auto","none","0"]);function y7(e,t,r){let n=0,s;for(;n<e.length&&!s;){const a=e[n];typeof a=="string"&&!x7.has(a)&&qm(a).values.length&&(s=e[n]),n++}if(s&&r)for(const a of t)e[a]=E5(r,s)}class v7 extends z2{constructor(t,r,n,s,a){super(t,r,n,s,a,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),I2(d))){const f=b5(d,r.current);f!==void 0&&(t[c]=f),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!S5.has(n)||t.length!==2)return;const[s,a]=t,i=Qk(s),l=Qk(a);if(i!==l)if(Kk(i)&&Kk(l))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else $d[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let s=0;s<t.length;s++)(t[s]===null||d7(t[s]))&&n.push(s);n.length&&y7(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=$d[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const s=r[r.length-1];s!==void 0&&t.getValue(n,s).jump(s,!1)}measureEndState(){const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const s=t.getValue(r);s&&s.jump(this.measuredOrigin,!1);const a=n.length-1,i=n[a];n[a]=$d[r](t.measureViewportBox(),window.getComputedStyle(t.current)),i!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=i),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{t.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function w7(e,t,r){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let n=document;const s=r?.[e]??n.querySelectorAll(e);return s?Array.from(s):[]}return Array.from(e)}const N5=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function A5(e){return G3(e)&&"offsetHeight"in e}const Zk=30,_7=e=>!isNaN(parseFloat(e));class b7{constructor(t,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const s=bi.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=bi.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=_7(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new F2);const n=this.events[t].add(r);return t==="change"?()=>{n(),Wn.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=bi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>Zk)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,Zk);return K3(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function n0(e,t){return new b7(e,t)}const{schedule:V2}=s5(queueMicrotask,!1),Oo={x:!1,y:!1};function j5(){return Oo.x||Oo.y}function S7(e){return e==="x"||e==="y"?Oo[e]?null:(Oo[e]=!0,()=>{Oo[e]=!1}):Oo.x||Oo.y?null:(Oo.x=Oo.y=!0,()=>{Oo.x=Oo.y=!1})}function F5(e,t){const r=w7(e),n=new AbortController,s={passive:!0,...t,signal:n.signal};return[r,s,()=>n.abort()]}function eC(e){return!(e.pointerType==="touch"||j5())}function k7(e,t,r={}){const[n,s,a]=F5(e,r),i=l=>{if(!eC(l))return;const{target:c}=l,d=t(c,l);if(typeof d!="function"||!c)return;const f=p=>{eC(p)&&(d(p),c.removeEventListener("pointerleave",f))};c.addEventListener("pointerleave",f,s)};return n.forEach(l=>{l.addEventListener("pointerenter",i,s)}),a}const P5=(e,t)=>t?e===t?!0:P5(e,t.parentElement):!1,K2=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,C7=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function T7(e){return C7.has(e.tagName)||e.tabIndex!==-1}const N1=new WeakSet;function tC(e){return t=>{t.key==="Enter"&&e(t)}}function Yv(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const E7=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=tC(()=>{if(N1.has(r))return;Yv(r,"down");const s=tC(()=>{Yv(r,"up")}),a=()=>Yv(r,"cancel");r.addEventListener("keyup",s,t),r.addEventListener("blur",a,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function rC(e){return K2(e)&&!j5()}function N7(e,t,r={}){const[n,s,a]=F5(e,r),i=l=>{const c=l.currentTarget;if(!rC(l))return;N1.add(c);const d=t(c,l),f=(y,v)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",g),N1.has(c)&&N1.delete(c),rC(y)&&typeof d=="function"&&d(y,{success:v})},p=y=>{f(y,c===window||c===document||r.useGlobalTarget||P5(c,y.target))},g=y=>{f(y,!1)};window.addEventListener("pointerup",p,s),window.addEventListener("pointercancel",g,s)};return n.forEach(l=>{(r.useGlobalTarget?window:l).addEventListener("pointerdown",i,s),A5(l)&&(l.addEventListener("focus",d=>E7(d,s)),!T7(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),a}function R5(e){return G3(e)&&"ownerSVGElement"in e}function A7(e){return R5(e)&&e.tagName==="svg"}const Oa=e=>!!(e&&e.getVelocity),j7=[...C5,js,Mu],F7=e=>j7.find(k5(e)),q2=C.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class P7 extends C.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=r.offsetParent,s=A5(n)&&n.offsetWidth||0,a=this.props.sizeRef.current;a.height=r.offsetHeight||0,a.width=r.offsetWidth||0,a.top=r.offsetTop,a.left=r.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function R7({children:e,isPresent:t,anchorX:r,root:n}){const s=C.useId(),a=C.useRef(null),i=C.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=C.useContext(q2);return C.useInsertionEffect(()=>{const{width:c,height:d,top:f,left:p,right:g}=i.current;if(t||!a.current||!c||!d)return;const y=r==="left"?`left: ${p}`:`right: ${g}`;a.current.dataset.motionPopId=s;const v=document.createElement("style");l&&(v.nonce=l);const _=n??document.head;return _.appendChild(v),v.sheet&&v.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${d}px !important;
            ${y}px !important;
            top: ${f}px !important;
          }
        `),()=>{_.contains(v)&&_.removeChild(v)}},[t]),o.jsx(P7,{isPresent:t,childRef:a,sizeRef:i,children:C.cloneElement(e,{ref:a})})}const D7=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:s,presenceAffectsLayout:a,mode:i,anchorX:l,root:c})=>{const d=C2(I7),f=C.useId();let p=!0,g=C.useMemo(()=>(p=!1,{id:f,initial:t,isPresent:r,custom:s,onExitComplete:y=>{d.set(y,!0);for(const v of d.values())if(!v)return;n&&n()},register:y=>(d.set(y,!1),()=>d.delete(y))}),[r,d,n]);return a&&p&&(g={...g}),C.useMemo(()=>{d.forEach((y,v)=>d.set(v,!1))},[r]),C.useEffect(()=>{!r&&!d.size&&n&&n()},[r]),i==="popLayout"&&(e=o.jsx(R7,{isPresent:r,anchorX:l,root:c,children:e})),o.jsx(Ay.Provider,{value:g,children:e})};function I7(){return new Map}function D5(e=!0){const t=C.useContext(Ay);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:s}=t,a=C.useId();C.useEffect(()=>{if(e)return s(a)},[e]);const i=C.useCallback(()=>e&&n&&n(a),[a,n,e]);return!r&&n?[!1,i]:[!0]}const r1=e=>e.key||"";function nC(e){const t=[];return C.Children.forEach(e,r=>{C.isValidElement(r)&&t.push(r)}),t}const _i=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:s=!0,mode:a="sync",propagate:i=!1,anchorX:l="left",root:c})=>{const[d,f]=D5(i),p=C.useMemo(()=>nC(e),[e]),g=i&&!d?[]:p.map(r1),y=C.useRef(!0),v=C.useRef(p),_=C2(()=>new Map),[b,E]=C.useState(p),[k,w]=C.useState(p);z3(()=>{y.current=!1,v.current=p;for(let P=0;P<k.length;P++){const R=r1(k[P]);g.includes(R)?_.delete(R):_.get(R)!==!0&&_.set(R,!1)}},[k,g.length,g.join("-")]);const N=[];if(p!==b){let P=[...p];for(let R=0;R<k.length;R++){const T=k[R],D=r1(T);g.includes(D)||(P.splice(R,0,T),N.push(T))}return a==="wait"&&N.length&&(P=N),w(nC(P)),E(p),null}const{forceRender:A}=C.useContext(k2);return o.jsx(o.Fragment,{children:k.map(P=>{const R=r1(P),T=i&&!d?!1:p===k||g.includes(R),D=()=>{if(_.has(R))_.set(R,!0);else return;let I=!0;_.forEach(V=>{V||(I=!1)}),I&&(A?.(),w(v.current),i&&f?.(),n&&n())};return o.jsx(D7,{isPresent:T,initial:!y.current||r?void 0:!1,custom:t,presenceAffectsLayout:s,mode:a,root:c,onExitComplete:T?void 0:D,anchorX:l,children:P},R)})})},I5=C.createContext({strict:!1}),sC={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},s0={};for(const e in sC)s0[e]={isEnabled:t=>sC[e].some(r=>!!t[r])};function M7(e){for(const t in e)s0[t]={...s0[t],...e[t]}}const O7=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function W1(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||O7.has(e)}let M5=e=>!W1(e);function L7(e){typeof e=="function"&&(M5=t=>t.startsWith("on")?!W1(t):e(t))}try{L7(require("@emotion/is-prop-valid").default)}catch{}function B7(e,t,r){const n={};for(const s in e)s==="values"&&typeof e.values=="object"||(M5(s)||r===!0&&W1(s)||!t&&!W1(s)||e.draggable&&s.startsWith("onDrag"))&&(n[s]=e[s]);return n}const jy=C.createContext({});function Fy(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function Xm(e){return typeof e=="string"||Array.isArray(e)}const X2=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Y2=["initial",...X2];function Py(e){return Fy(e.animate)||Y2.some(t=>Xm(e[t]))}function O5(e){return!!(Py(e)||e.variants)}function U7(e,t){if(Py(e)){const{initial:r,animate:n}=e;return{initial:r===!1||Xm(r)?r:void 0,animate:Xm(n)?n:void 0}}return e.inherit!==!1?t:{}}function $7(e){const{initial:t,animate:r}=U7(e,C.useContext(jy));return C.useMemo(()=>({initial:t,animate:r}),[aC(t),aC(r)])}function aC(e){return Array.isArray(e)?e.join(" "):e}const Ym={};function W7(e){for(const t in e)Ym[t]=e[t],D2(t)&&(Ym[t].isCSSVariable=!0)}function L5(e,{layout:t,layoutId:r}){return y0.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!Ym[e]||e==="opacity")}const z7={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},H7=x0.length;function G7(e,t,r){let n="",s=!0;for(let a=0;a<H7;a++){const i=x0[a],l=e[i];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(i.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||r){const d=N5(l,G2[i]);if(!c){s=!1;const f=z7[i]||i;n+=`${f}(${d}) `}r&&(t[i]=d)}}return n=n.trim(),r?n=r(t,s?"":n):s&&(n="none"),n}function Q2(e,t,r){const{style:n,vars:s,transformOrigin:a}=e;let i=!1,l=!1;for(const c in t){const d=t[c];if(y0.has(c)){i=!0;continue}else if(D2(c)){s[c]=d;continue}else{const f=N5(d,G2[c]);c.startsWith("origin")?(l=!0,a[c]=f):n[c]=f}}if(t.transform||(i||r?n.transform=G7(t,e.transform,r):n.transform&&(n.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:f=0}=a;n.transformOrigin=`${c} ${d} ${f}`}}const J2=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function B5(e,t,r){for(const n in t)!Oa(t[n])&&!L5(n,r)&&(e[n]=t[n])}function V7({transformTemplate:e},t){return C.useMemo(()=>{const r=J2();return Q2(r,t,e),Object.assign({},r.vars,r.style)},[t])}function K7(e,t){const r=e.style||{},n={};return B5(n,r,e),Object.assign(n,V7(e,t)),n}function q7(e,t){const r={},n=K7(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const X7={offset:"stroke-dashoffset",array:"stroke-dasharray"},Y7={offset:"strokeDashoffset",array:"strokeDasharray"};function Q7(e,t,r=1,n=0,s=!0){e.pathLength=1;const a=s?X7:Y7;e[a.offset]=Sr.transform(-n);const i=Sr.transform(t),l=Sr.transform(r);e[a.array]=`${i} ${l}`}function U5(e,{attrX:t,attrY:r,attrScale:n,pathLength:s,pathSpacing:a=1,pathOffset:i=0,...l},c,d,f){if(Q2(e,l,d),c){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:g}=e;p.transform&&(g.transform=p.transform,delete p.transform),(g.transform||p.transformOrigin)&&(g.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),g.transform&&(g.transformBox=f?.transformBox??"fill-box",delete p.transformBox),t!==void 0&&(p.x=t),r!==void 0&&(p.y=r),n!==void 0&&(p.scale=n),s!==void 0&&Q7(p,s,a,i,!1)}const $5=()=>({...J2(),attrs:{}}),W5=e=>typeof e=="string"&&e.toLowerCase()==="svg";function J7(e,t,r,n){const s=C.useMemo(()=>{const a=$5();return U5(a,t,W5(n),e.transformTemplate,e.style),{...a.attrs,style:{...a.style}}},[t]);if(e.style){const a={};B5(a,e.style,e),s.style={...a,...s.style}}return s}const Z7=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Z2(e){return typeof e!="string"||e.includes("-")?!1:!!(Z7.indexOf(e)>-1||/[A-Z]/u.test(e))}function e9(e,t,r,{latestValues:n},s,a=!1){const l=(Z2(e)?J7:q7)(t,n,s,e),c=B7(t,typeof e=="string",a),d=e!==C.Fragment?{...c,...l,ref:r}:{},{children:f}=t,p=C.useMemo(()=>Oa(f)?f.get():f,[f]);return C.createElement(e,{...d,children:p})}function iC(e){const t=[{},{}];return e?.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function eb(e,t,r,n){if(typeof t=="function"){const[s,a]=iC(n);t=t(r!==void 0?r:e.custom,s,a)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[s,a]=iC(n);t=t(r!==void 0?r:e.custom,s,a)}return t}function A1(e){return Oa(e)?e.get():e}function t9({scrapeMotionValuesFromProps:e,createRenderState:t},r,n,s){return{latestValues:r9(r,n,s,e),renderState:t()}}function r9(e,t,r,n){const s={},a=n(e,{});for(const g in a)s[g]=A1(a[g]);let{initial:i,animate:l}=e;const c=Py(e),d=O5(e);t&&d&&!c&&e.inherit!==!1&&(i===void 0&&(i=t.initial),l===void 0&&(l=t.animate));let f=r?r.initial===!1:!1;f=f||i===!1;const p=f?l:i;if(p&&typeof p!="boolean"&&!Fy(p)){const g=Array.isArray(p)?p:[p];for(let y=0;y<g.length;y++){const v=eb(e,g[y]);if(v){const{transitionEnd:_,transition:b,...E}=v;for(const k in E){let w=E[k];if(Array.isArray(w)){const N=f?w.length-1:0;w=w[N]}w!==null&&(s[k]=w)}for(const k in _)s[k]=_[k]}}}return s}const z5=e=>(t,r)=>{const n=C.useContext(jy),s=C.useContext(Ay),a=()=>t9(e,t,n,s);return r?a():C2(a)};function tb(e,t,r){const{style:n}=e,s={};for(const a in n)(Oa(n[a])||t.style&&Oa(t.style[a])||L5(a,e)||r?.getValue(a)?.liveStyle!==void 0)&&(s[a]=n[a]);return s}const n9=z5({scrapeMotionValuesFromProps:tb,createRenderState:J2});function H5(e,t,r){const n=tb(e,t,r);for(const s in e)if(Oa(e[s])||Oa(t[s])){const a=x0.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;n[a]=e[s]}return n}const s9=z5({scrapeMotionValuesFromProps:H5,createRenderState:$5}),a9=Symbol.for("motionComponentSymbol");function Oh(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function i9(e,t,r){return C.useCallback(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):Oh(r)&&(r.current=n))},[t])}const rb=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),o9="framerAppearId",G5="data-"+rb(o9),V5=C.createContext({});function l9(e,t,r,n,s){const{visualElement:a}=C.useContext(jy),i=C.useContext(I5),l=C.useContext(Ay),c=C.useContext(q2).reducedMotion,d=C.useRef(null);n=n||i.renderer,!d.current&&n&&(d.current=n(e,{visualState:t,parent:a,props:r,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const f=d.current,p=C.useContext(V5);f&&!f.projection&&s&&(f.type==="html"||f.type==="svg")&&c9(d.current,r,s,p);const g=C.useRef(!1);C.useInsertionEffect(()=>{f&&g.current&&f.update(r,l)});const y=r[G5],v=C.useRef(!!y&&!window.MotionHandoffIsComplete?.(y)&&window.MotionHasOptimisedAnimation?.(y));return z3(()=>{f&&(g.current=!0,window.MotionIsMounted=!0,f.updateFeatures(),f.scheduleRenderMicrotask(),v.current&&f.animationState&&f.animationState.animateChanges())}),C.useEffect(()=>{f&&(!v.current&&f.animationState&&f.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(y)}),v.current=!1),f.enteringChildren=void 0)}),f}function c9(e,t,r,n){const{layoutId:s,layout:a,drag:i,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:f}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:K5(e.parent)),e.projection.setOptions({layoutId:s,layout:a,alwaysMeasureLayout:!!i||l&&Oh(l),visualElement:e,animationType:typeof a=="string"?a:"both",initialPromotionConfig:n,crossfade:f,layoutScroll:c,layoutRoot:d})}function K5(e){if(e)return e.options.allowProjection!==!1?e.projection:K5(e.parent)}function Qv(e,{forwardMotionProps:t=!1}={},r,n){r&&M7(r);const s=Z2(e)?s9:n9;function a(l,c){let d;const f={...C.useContext(q2),...l,layoutId:u9(l)},{isStatic:p}=f,g=$7(l),y=s(l,p);if(!p&&T2){d9();const v=f9(f);d=v.MeasureLayout,g.visualElement=l9(e,y,f,n,v.ProjectionNode)}return o.jsxs(jy.Provider,{value:g,children:[d&&g.visualElement?o.jsx(d,{visualElement:g.visualElement,...f}):null,e9(e,l,i9(y,g.visualElement,c),y,p,t)]})}a.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const i=C.forwardRef(a);return i[a9]=e,i}function u9({layoutId:e}){const t=C.useContext(k2).id;return t&&e!==void 0?t+"-"+e:e}function d9(e,t){C.useContext(I5).strict}function f9(e){const{drag:t,layout:r}=s0;if(!t&&!r)return{};const n={...t,...r};return{MeasureLayout:t?.isEnabled(e)||r?.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function h9(e,t){if(typeof Proxy>"u")return Qv;const r=new Map,n=(a,i)=>Qv(a,i,e,t),s=(a,i)=>n(a,i);return new Proxy(s,{get:(a,i)=>i==="create"?n:(r.has(i)||r.set(i,Qv(i,void 0,e,t)),r.get(i))})}function q5({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function g9({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function m9(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function Jv(e){return e===void 0||e===1}function p_({scale:e,scaleX:t,scaleY:r}){return!Jv(e)||!Jv(t)||!Jv(r)}function Rd(e){return p_(e)||X5(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function X5(e){return oC(e.x)||oC(e.y)}function oC(e){return e&&e!=="0%"}function z1(e,t,r){const n=e-r,s=t*n;return r+s}function lC(e,t,r,n,s){return s!==void 0&&(e=z1(e,s,n)),z1(e,r,n)+t}function x_(e,t=0,r=1,n,s){e.min=lC(e.min,t,r,n,s),e.max=lC(e.max,t,r,n,s)}function Y5(e,{x:t,y:r}){x_(e.x,t.translate,t.scale,t.originPoint),x_(e.y,r.translate,r.scale,r.originPoint)}const cC=.999999999999,uC=1.0000000000001;function p9(e,t,r,n=!1){const s=r.length;if(!s)return;t.x=t.y=1;let a,i;for(let l=0;l<s;l++){a=r[l],i=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(n&&a.options.layoutScroll&&a.scroll&&a!==a.root&&Bh(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,Y5(e,i)),n&&Rd(a.latestValues)&&Bh(e,a.latestValues))}t.x<uC&&t.x>cC&&(t.x=1),t.y<uC&&t.y>cC&&(t.y=1)}function Lh(e,t){e.min=e.min+t,e.max=e.max+t}function dC(e,t,r,n,s=.5){const a=Vn(e.min,e.max,s);x_(e,t,r,a,n)}function Bh(e,t){dC(e.x,t.x,t.scaleX,t.scale,t.originX),dC(e.y,t.y,t.scaleY,t.scale,t.originY)}function Q5(e,t){return q5(m9(e.getBoundingClientRect(),t))}function x9(e,t,r){const n=Q5(e,r),{scroll:s}=t;return s&&(Lh(n.x,s.offset.x),Lh(n.y,s.offset.y)),n}const fC=()=>({translate:0,scale:1,origin:0,originPoint:0}),Uh=()=>({x:fC(),y:fC()}),hC=()=>({min:0,max:0}),xs=()=>({x:hC(),y:hC()}),y_={current:null},J5={current:!1};function y9(){if(J5.current=!0,!!T2)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>y_.current=e.matches;e.addEventListener("change",t),t()}else y_.current=!1}const v9=new WeakMap;function w9(e,t,r){for(const n in t){const s=t[n],a=r[n];if(Oa(s))e.addValue(n,s);else if(Oa(a))e.addValue(n,n0(s,{owner:e}));else if(a!==s)if(e.hasValue(n)){const i=e.getValue(n);i.liveStyle===!0?i.jump(s):i.hasAnimated||i.set(s)}else{const i=e.getStaticValue(n);e.addValue(n,n0(i!==void 0?i:s,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const gC=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class _9{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:s,blockInitialAnimation:a,visualState:i},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=z2,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=bi.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,Wn.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=i;this.latestValues=c,this.baseTarget={...c},this.initialValues=r.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=s,this.options=l,this.blockInitialAnimation=!!a,this.isControllingVariants=Py(r),this.isVariantNode=O5(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:f,...p}=this.scrapeMotionValuesFromProps(r,{},this);for(const g in p){const y=p[g];c[g]!==void 0&&Oa(y)&&y.set(c[g])}}mount(t){this.current=t,v9.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),J5.current||y9(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:y_.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Iu(this.notifyUpdate),Iu(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=y0.has(t);n&&this.onBindTransform&&this.onBindTransform();const s=r.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&Wn.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{s(),a&&a(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in s0){const r=s0[t];if(!r)continue;const{isEnabled:n,Feature:s}=r;if(!this.features[t]&&s&&n(this.props)&&(this.features[t]=new s(this)),this.features[t]){const a=this.features[t];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):xs()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<gC.length;n++){const s=gC[n];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const a="on"+s,i=t[a];i&&(this.propEventSubscriptions[s]=this.on(s,i))}this.prevMotionValues=w9(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=n0(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(H3(n)||V3(n))?n=parseFloat(n):!F7(n)&&Mu.test(r)&&(n=E5(t,r)),this.setBaseTarget(t,Oa(n)?n.get():n)),Oa(n)?n.get():n}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const a=eb(this.props,r,this.presenceContext?.custom);a&&(n=a[t])}if(r&&n!==void 0)return n;const s=this.getBaseTargetFromProps(this.props,t);return s!==void 0&&!Oa(s)?s:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new F2),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}scheduleRenderMicrotask(){V2.render(this.render)}}class Z5 extends _9{constructor(){super(...arguments),this.KeyframeResolver=v7}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Oa(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function e6(e,{style:t,vars:r},n,s){const a=e.style;let i;for(i in t)a[i]=t[i];s?.applyProjectionStyles(a,n);for(i in r)a.setProperty(i,r[i])}function b9(e){return window.getComputedStyle(e)}class S9 extends Z5{constructor(){super(...arguments),this.type="html",this.renderInstance=e6}readValueFromInstance(t,r){if(y0.has(r))return this.projection?.isProjecting?c_(r):LD(t,r);{const n=b9(t),s=(D2(r)?n.getPropertyValue(r):n[r])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(t,{transformPagePoint:r}){return Q5(t,r)}build(t,r,n){Q2(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return tb(t,r,n)}}const t6=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function k9(e,t,r,n){e6(e,t,void 0,n);for(const s in t.attrs)e.setAttribute(t6.has(s)?s:rb(s),t.attrs[s])}class C9 extends Z5{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=xs}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(y0.has(r)){const n=T5(r);return n&&n.default||0}return r=t6.has(r)?r:rb(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return H5(t,r,n)}build(t,r,n){U5(t,r,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,r,n,s){k9(t,r,n,s)}mount(t){this.isSVGTag=W5(t.tagName),super.mount(t)}}const T9=(e,t)=>Z2(e)?new C9(t):new S9(t,{allowProjection:e!==C.Fragment});function Gh(e,t,r){const n=e.getProps();return eb(n,t,r!==void 0?r:n.custom,e)}const v_=e=>Array.isArray(e);function E9(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,n0(r))}function N9(e){return v_(e)?e[e.length-1]||0:e}function A9(e,t){const r=Gh(e,t);let{transitionEnd:n={},transition:s={},...a}=r||{};a={...a,...n};for(const i in a){const l=N9(a[i]);E9(e,i,l)}}function j9(e){return!!(Oa(e)&&e.add)}function w_(e,t){const r=e.getValue("willChange");if(j9(r))return r.add(t);if(!r&&kc.WillChange){const n=new kc.WillChange("auto");e.addValue("willChange",n),n.add(t)}}function r6(e){return e.props[G5]}const F9=e=>e!==null;function P9(e,{repeat:t,repeatType:r="loop"},n){const s=e.filter(F9),a=t&&r!=="loop"&&t%2===1?0:s.length-1;return s[a]}const R9={type:"spring",stiffness:500,damping:25,restSpeed:10},D9=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),I9={type:"keyframes",duration:.8},M9={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},O9=(e,{keyframes:t})=>t.length>2?I9:y0.has(e)?e.startsWith("scale")?D9(t[1]):R9:M9;function L9({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:s,repeat:a,repeatType:i,repeatDelay:l,from:c,elapsed:d,...f}){return!!Object.keys(f).length}const nb=(e,t,r,n={},s,a)=>i=>{const l=H2(n,e)||{},c=l.delay||n.delay||0;let{elapsed:d=0}=n;d=d-El(c);const f={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:g=>{t.set(g),l.onUpdate&&l.onUpdate(g)},onComplete:()=>{i(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:a?void 0:s};L9(l)||Object.assign(f,O9(e,f)),f.duration&&(f.duration=El(f.duration)),f.repeatDelay&&(f.repeatDelay=El(f.repeatDelay)),f.from!==void 0&&(f.keyframes[0]=f.from);let p=!1;if((f.type===!1||f.duration===0&&!f.repeatDelay)&&(g_(f),f.delay===0&&(p=!0)),(kc.instantAnimations||kc.skipAnimations)&&(p=!0,g_(f),f.delay=0),f.allowFlatten=!l.type&&!l.ease,p&&!a&&t.get()!==void 0){const g=P9(f.keyframes,l);if(g!==void 0){Wn.update(()=>{f.onUpdate(g),f.onComplete()});return}}return l.isSync?new W2(f):new o7(f)};function B9({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function n6(e,t,{delay:r=0,transitionOverride:n,type:s}={}){let{transition:a=e.getDefaultTransition(),transitionEnd:i,...l}=t;n&&(a=n);const c=[],d=s&&e.animationState&&e.animationState.getState()[s];for(const f in l){const p=e.getValue(f,e.latestValues[f]??null),g=l[f];if(g===void 0||d&&B9(d,f))continue;const y={delay:r,...H2(a||{},f)},v=p.get();if(v!==void 0&&!p.isAnimating&&!Array.isArray(g)&&g===v&&!y.velocity)continue;let _=!1;if(window.MotionHandoffAnimation){const E=r6(e);if(E){const k=window.MotionHandoffAnimation(E,f,Wn);k!==null&&(y.startTime=k,_=!0)}}w_(e,f),p.start(nb(f,p,g,e.shouldReduceMotion&&S5.has(f)?{type:!1}:y,e,_));const b=p.animation;b&&c.push(b)}return i&&Promise.all(c).then(()=>{Wn.update(()=>{i&&A9(e,i)})}),c}function s6(e,t,r,n=0,s=1){const a=Array.from(e).sort((d,f)=>d.sortNodePosition(f)).indexOf(t),i=e.size,l=(i-1)*n;return typeof r=="function"?r(a,i):s===1?a*n:l-a*n}function __(e,t,r={}){const n=Gh(e,t,r.type==="exit"?e.presenceContext?.custom:void 0);let{transition:s=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(s=r.transitionOverride);const a=n?()=>Promise.all(n6(e,n,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:p}=s;return U9(e,t,c,d,f,p,r)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,d]=l==="beforeChildren"?[a,i]:[i,a];return c().then(()=>d())}else return Promise.all([a(),i(r.delay)])}function U9(e,t,r=0,n=0,s=0,a=1,i){const l=[];for(const c of e.variantChildren)c.notify("AnimationStart",t),l.push(__(c,t,{...i,delay:r+(typeof n=="function"?0:n)+s6(e.variantChildren,c,n,s,a)}).then(()=>c.notify("AnimationComplete",t)));return Promise.all(l)}function $9(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const s=t.map(a=>__(e,a,r));n=Promise.all(s)}else if(typeof t=="string")n=__(e,t,r);else{const s=typeof t=="function"?Gh(e,t,r.custom):t;n=Promise.all(n6(e,s,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}function a6(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}const W9=Y2.length;function i6(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?i6(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<W9;r++){const n=Y2[r],s=e.props[n];(Xm(s)||s===!1)&&(t[n]=s)}return t}const z9=[...X2].reverse(),H9=X2.length;function G9(e){return t=>Promise.all(t.map(({animation:r,options:n})=>$9(e,r,n)))}function V9(e){let t=G9(e),r=mC(),n=!0;const s=c=>(d,f)=>{const p=Gh(e,f,c==="exit"?e.presenceContext?.custom:void 0);if(p){const{transition:g,transitionEnd:y,...v}=p;d={...d,...v,...y}}return d};function a(c){t=c(e)}function i(c){const{props:d}=e,f=i6(e.parent)||{},p=[],g=new Set;let y={},v=1/0;for(let b=0;b<H9;b++){const E=z9[b],k=r[E],w=d[E]!==void 0?d[E]:f[E],N=Xm(w),A=E===c?k.isActive:null;A===!1&&(v=b);let P=w===f[E]&&w!==d[E]&&N;if(P&&n&&e.manuallyAnimateOnMount&&(P=!1),k.protectedKeys={...y},!k.isActive&&A===null||!w&&!k.prevProp||Fy(w)||typeof w=="boolean")continue;const R=K9(k.prevProp,w);let T=R||E===c&&k.isActive&&!P&&N||b>v&&N,D=!1;const I=Array.isArray(w)?w:[w];let V=I.reduce(s(E),{});A===!1&&(V={});const{prevResolvedValues:X={}}=k,Z={...X,...V},ie=M=>{T=!0,g.has(M)&&(D=!0,g.delete(M)),k.needsAnimating[M]=!0;const W=e.getValue(M);W&&(W.liveStyle=!1)};for(const M in Z){const W=V[M],L=X[M];if(y.hasOwnProperty(M))continue;let H=!1;v_(W)&&v_(L)?H=!a6(W,L):H=W!==L,H?W!=null?ie(M):g.add(M):W!==void 0&&g.has(M)?ie(M):k.protectedKeys[M]=!0}k.prevProp=w,k.prevResolvedValues=V,k.isActive&&(y={...y,...V}),n&&e.blockInitialAnimation&&(T=!1);const q=P&&R;T&&(!q||D)&&p.push(...I.map(M=>{const W={type:E};if(typeof M=="string"&&n&&!q&&e.manuallyAnimateOnMount&&e.parent){const{parent:L}=e,H=Gh(L,M);if(L.enteringChildren&&H){const{delayChildren:K}=H.transition||{};W.delay=s6(L.enteringChildren,e,K)}}return{animation:M,options:W}}))}if(g.size){const b={};if(typeof d.initial!="boolean"){const E=Gh(e,Array.isArray(d.initial)?d.initial[0]:d.initial);E&&E.transition&&(b.transition=E.transition)}g.forEach(E=>{const k=e.getBaseTarget(E),w=e.getValue(E);w&&(w.liveStyle=!0),b[E]=k??null}),p.push({animation:b})}let _=!!p.length;return n&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(_=!1),n=!1,_?t(p):Promise.resolve()}function l(c,d){if(r[c].isActive===d)return Promise.resolve();e.variantChildren?.forEach(p=>p.animationState?.setActive(c,d)),r[c].isActive=d;const f=i(c);for(const p in r)r[p].protectedKeys={};return f}return{animateChanges:i,setActive:l,setAnimateFunction:a,getState:()=>r,reset:()=>{r=mC(),n=!0}}}function K9(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!a6(t,e):!1}function Ad(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function mC(){return{animate:Ad(!0),whileInView:Ad(),whileHover:Ad(),whileTap:Ad(),whileDrag:Ad(),whileFocus:Ad(),exit:Ad()}}class Hu{constructor(t){this.isMounted=!1,this.node=t}update(){}}class q9 extends Hu{constructor(t){super(t),t.animationState||(t.animationState=V9(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Fy(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let X9=0;class Y9 extends Hu{constructor(){super(...arguments),this.id=X9++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const s=this.node.animationState.setActive("exit",!t);r&&!t&&s.then(()=>{r(this.id)})}mount(){const{register:t,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Q9={animation:{Feature:q9},exit:{Feature:Y9}};function Qm(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function Np(e){return{point:{x:e.pageX,y:e.pageY}}}const J9=e=>t=>K2(t)&&e(t,Np(t));function Nm(e,t,r,n){return Qm(e,t,J9(r),n)}const o6=1e-4,Z9=1-o6,eI=1+o6,l6=.01,tI=0-l6,rI=0+l6;function ai(e){return e.max-e.min}function nI(e,t,r){return Math.abs(e-t)<=r}function pC(e,t,r,n=.5){e.origin=n,e.originPoint=Vn(t.min,t.max,e.origin),e.scale=ai(r)/ai(t),e.translate=Vn(r.min,r.max,e.origin)-e.originPoint,(e.scale>=Z9&&e.scale<=eI||isNaN(e.scale))&&(e.scale=1),(e.translate>=tI&&e.translate<=rI||isNaN(e.translate))&&(e.translate=0)}function Am(e,t,r,n){pC(e.x,t.x,r.x,n?n.originX:void 0),pC(e.y,t.y,r.y,n?n.originY:void 0)}function xC(e,t,r){e.min=r.min+t.min,e.max=e.min+ai(t)}function sI(e,t,r){xC(e.x,t.x,r.x),xC(e.y,t.y,r.y)}function yC(e,t,r){e.min=t.min-r.min,e.max=e.min+ai(t)}function jm(e,t,r){yC(e.x,t.x,r.x),yC(e.y,t.y,r.y)}function co(e){return[e("x"),e("y")]}const c6=({current:e})=>e?e.ownerDocument.defaultView:null,vC=(e,t)=>Math.abs(e-t);function aI(e,t){const r=vC(e.x,t.x),n=vC(e.y,t.y);return Math.sqrt(r**2+n**2)}class u6{constructor(t,r,{transformPagePoint:n,contextWindow:s=window,dragSnapToOrigin:a=!1,distanceThreshold:i=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=ew(this.lastMoveEventInfo,this.history),y=this.startEvent!==null,v=aI(g.offset,{x:0,y:0})>=this.distanceThreshold;if(!y&&!v)return;const{point:_}=g,{timestamp:b}=pa;this.history.push({..._,timestamp:b});const{onStart:E,onMove:k}=this.handlers;y||(E&&E(this.lastMoveEvent,g),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,g)},this.handlePointerMove=(g,y)=>{this.lastMoveEvent=g,this.lastMoveEventInfo=Zv(y,this.transformPagePoint),Wn.update(this.updatePoint,!0)},this.handlePointerUp=(g,y)=>{this.end();const{onEnd:v,onSessionEnd:_,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const E=ew(g.type==="pointercancel"?this.lastMoveEventInfo:Zv(y,this.transformPagePoint),this.history);this.startEvent&&v&&v(g,E),_&&_(g,E)},!K2(t))return;this.dragSnapToOrigin=a,this.handlers=r,this.transformPagePoint=n,this.distanceThreshold=i,this.contextWindow=s||window;const l=Np(t),c=Zv(l,this.transformPagePoint),{point:d}=c,{timestamp:f}=pa;this.history=[{...d,timestamp:f}];const{onSessionStart:p}=r;p&&p(t,ew(c,this.history)),this.removeListeners=Cp(Nm(this.contextWindow,"pointermove",this.handlePointerMove),Nm(this.contextWindow,"pointerup",this.handlePointerUp),Nm(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Iu(this.updatePoint)}}function Zv(e,t){return t?{point:t(e.point)}:e}function wC(e,t){return{x:e.x-t.x,y:e.y-t.y}}function ew({point:e},t){return{point:e,delta:wC(e,d6(t)),offset:wC(e,iI(t)),velocity:oI(t,.1)}}function iI(e){return e[0]}function d6(e){return e[e.length-1]}function oI(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const s=d6(e);for(;r>=0&&(n=e[r],!(s.timestamp-n.timestamp>El(t)));)r--;if(!n)return{x:0,y:0};const a=Nl(s.timestamp-n.timestamp);if(a===0)return{x:0,y:0};const i={x:(s.x-n.x)/a,y:(s.y-n.y)/a};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function lI(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?Vn(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?Vn(r,e,n.max):Math.min(e,r)),e}function _C(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function cI(e,{top:t,left:r,bottom:n,right:s}){return{x:_C(e.x,r,s),y:_C(e.y,t,n)}}function bC(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function uI(e,t){return{x:bC(e.x,t.x),y:bC(e.y,t.y)}}function dI(e,t){let r=.5;const n=ai(e),s=ai(t);return s>n?r=Vm(t.min,t.max-n,e.min):n>s&&(r=Vm(e.min,e.max-s,t.min)),Sc(0,1,r)}function fI(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const b_=.35;function hI(e=b_){return e===!1?e=0:e===!0&&(e=b_),{x:SC(e,"left","right"),y:SC(e,"top","bottom")}}function SC(e,t,r){return{min:kC(e,t),max:kC(e,r)}}function kC(e,t){return typeof e=="number"?e:e[t]||0}const gI=new WeakMap;class mI{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=xs(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:r=!1,distanceThreshold:n}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const a=p=>{const{dragSnapToOrigin:g}=this.getProps();g?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Np(p).point)},i=(p,g)=>{const{drag:y,dragPropagation:v,onDragStart:_}=this.getProps();if(y&&!v&&(this.openDragLock&&this.openDragLock(),this.openDragLock=S7(y),!this.openDragLock))return;this.latestPointerEvent=p,this.latestPanInfo=g,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),co(E=>{let k=this.getAxisMotionValue(E).get()||0;if(Al.test(k)){const{projection:w}=this.visualElement;if(w&&w.layout){const N=w.layout.layoutBox[E];N&&(k=ai(N)*(parseFloat(k)/100))}}this.originPoint[E]=k}),_&&Wn.postRender(()=>_(p,g)),w_(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},l=(p,g)=>{this.latestPointerEvent=p,this.latestPanInfo=g;const{dragPropagation:y,dragDirectionLock:v,onDirectionLock:_,onDrag:b}=this.getProps();if(!y&&!this.openDragLock)return;const{offset:E}=g;if(v&&this.currentDirection===null){this.currentDirection=pI(E),this.currentDirection!==null&&_&&_(this.currentDirection);return}this.updateAxis("x",g.point,E),this.updateAxis("y",g.point,E),this.visualElement.render(),b&&b(p,g)},c=(p,g)=>{this.latestPointerEvent=p,this.latestPanInfo=g,this.stop(p,g),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>co(p=>this.getAnimationState(p)==="paused"&&this.getAxisMotionValue(p).animation?.play()),{dragSnapToOrigin:f}=this.getProps();this.panSession=new u6(t,{onSessionStart:a,onStart:i,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:f,distanceThreshold:n,contextWindow:c6(this.visualElement)})}stop(t,r){const n=t||this.latestPointerEvent,s=r||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!s||!n)return;const{velocity:i}=s;this.startAnimation(i);const{onDragEnd:l}=this.getProps();l&&Wn.postRender(()=>l(n,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:s}=this.getProps();if(!n||!n1(t,s,this.currentDirection))return;const a=this.getAxisMotionValue(t);let i=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(i=lI(i,this.constraints[t],this.elastic[t])),a.set(i)}resolveConstraints(){const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,s=this.constraints;t&&Oh(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=cI(n.layoutBox,t):this.constraints=!1,this.elastic=hI(r),s!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&co(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=fI(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Oh(t))return!1;const n=t.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const a=x9(n,s.root,this.visualElement.getTransformPagePoint());let i=uI(s.layout.layoutBox,a);if(r){const l=r(g9(i));this.hasMutatedConstraints=!!l,l&&(i=q5(l))}return i}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:s,dragTransition:a,dragSnapToOrigin:i,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=co(f=>{if(!n1(f,r,this.currentDirection))return;let p=c&&c[f]||{};i&&(p={min:0,max:0});const g=s?200:1e6,y=s?40:1e7,v={type:"inertia",velocity:n?t[f]:0,bounceStiffness:g,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...a,...p};return this.startAxisValueAnimation(f,v)});return Promise.all(d).then(l)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return w_(this.visualElement,t),n.start(nb(t,n,0,r,this.visualElement,!1))}stopAnimation(){co(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){co(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),s=n[r];return s||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){co(r=>{const{drag:n}=this.getProps();if(!n1(r,n,this.currentDirection))return;const{projection:s}=this.visualElement,a=this.getAxisMotionValue(r);if(s&&s.layout){const{min:i,max:l}=s.layout.layoutBox[r];a.set(t[r]-Vn(i,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!Oh(r)||!n||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};co(i=>{const l=this.getAxisMotionValue(i);if(l&&this.constraints!==!1){const c=l.get();s[i]=dI({min:c,max:c},this.constraints[i])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),co(i=>{if(!n1(i,t,null))return;const l=this.getAxisMotionValue(i),{min:c,max:d}=this.constraints[i];l.set(Vn(c,d,s[i]))})}addListeners(){if(!this.visualElement.current)return;gI.set(this.visualElement,this);const t=this.visualElement.current,r=Nm(t,"pointerdown",c=>{const{drag:d,dragListener:f=!0}=this.getProps();d&&f&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();Oh(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,a=s.addEventListener("measure",n);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Wn.read(n);const i=Qm(window,"resize",()=>this.scalePositionWithinConstraints()),l=s.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(co(f=>{const p=this.getAxisMotionValue(f);p&&(this.originPoint[f]+=c[f].translate,p.set(p.get()+c[f].translate))}),this.visualElement.render())}));return()=>{i(),r(),a(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:s=!1,dragConstraints:a=!1,dragElastic:i=b_,dragMomentum:l=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:s,dragConstraints:a,dragElastic:i,dragMomentum:l}}}function n1(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function pI(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class xI extends Hu{constructor(t){super(t),this.removeGroupControls=mo,this.removeListeners=mo,this.controls=new mI(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||mo}unmount(){this.removeGroupControls(),this.removeListeners()}}const CC=e=>(t,r)=>{e&&Wn.postRender(()=>e(t,r))};class yI extends Hu{constructor(){super(...arguments),this.removePointerDownListener=mo}onPointerDown(t){this.session=new u6(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:c6(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:s}=this.node.getProps();return{onSessionStart:CC(t),onStart:CC(r),onMove:n,onEnd:(a,i)=>{delete this.session,s&&Wn.postRender(()=>s(a,i))}}}mount(){this.removePointerDownListener=Nm(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const j1={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function TC(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Cg={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Sr.test(e))e=parseFloat(e);else return e;const r=TC(e,t.target.x),n=TC(e,t.target.y);return`${r}% ${n}%`}},vI={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,s=Mu.parse(e);if(s.length>5)return n;const a=Mu.createTransformer(e),i=typeof s[0]!="number"?1:0,l=r.x.scale*t.x,c=r.y.scale*t.y;s[0+i]/=l,s[1+i]/=c;const d=Vn(l,c,.5);return typeof s[2+i]=="number"&&(s[2+i]/=d),typeof s[3+i]=="number"&&(s[3+i]/=d),a(s)}};let tw=!1;class wI extends C.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:s}=this.props,{projection:a}=t;W7(_I),a&&(r.group&&r.group.add(a),n&&n.register&&s&&n.register(a),tw&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),j1.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:s,isPresent:a}=this.props,{projection:i}=n;return i&&(i.isPresent=a,tw=!0,s||t.layoutDependency!==r||r===void 0||t.isPresent!==a?i.willUpdate():this.safeToRemove(),t.isPresent!==a&&(a?i.promote():i.relegate()||Wn.postRender(()=>{const l=i.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),V2.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:s}=t;tw=!0,s&&(s.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(s),n&&n.deregister&&n.deregister(s))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function f6(e){const[t,r]=D5(),n=C.useContext(k2);return o.jsx(wI,{...e,layoutGroup:n,switchLayoutGroup:C.useContext(V5),isPresent:t,safeToRemove:r})}const _I={borderRadius:{...Cg,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Cg,borderTopRightRadius:Cg,borderBottomLeftRadius:Cg,borderBottomRightRadius:Cg,boxShadow:vI};function bI(e,t,r){const n=Oa(e)?e:n0(e);return n.start(nb("",n,t,r)),n.animation}const SI=(e,t)=>e.depth-t.depth;class kI{constructor(){this.children=[],this.isDirty=!1}add(t){E2(this.children,t),this.isDirty=!0}remove(t){N2(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(SI),this.isDirty=!1,this.children.forEach(t)}}function CI(e,t){const r=bi.now(),n=({timestamp:s})=>{const a=s-r;a>=t&&(Iu(n),e(a-t))};return Wn.setup(n,!0),()=>Iu(n)}const h6=["TopLeft","TopRight","BottomLeft","BottomRight"],TI=h6.length,EC=e=>typeof e=="string"?parseFloat(e):e,NC=e=>typeof e=="number"||Sr.test(e);function EI(e,t,r,n,s,a){s?(e.opacity=Vn(0,r.opacity??1,NI(n)),e.opacityExit=Vn(t.opacity??1,0,AI(n))):a&&(e.opacity=Vn(t.opacity??1,r.opacity??1,n));for(let i=0;i<TI;i++){const l=`border${h6[i]}Radius`;let c=AC(t,l),d=AC(r,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||NC(c)===NC(d)?(e[l]=Math.max(Vn(EC(c),EC(d),n),0),(Al.test(d)||Al.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||r.rotate)&&(e.rotate=Vn(t.rotate||0,r.rotate||0,n))}function AC(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const NI=g6(0,.5,e5),AI=g6(.5,.95,mo);function g6(e,t,r){return n=>n<e?0:n>t?1:r(Vm(e,t,n))}function jC(e,t){e.min=t.min,e.max=t.max}function no(e,t){jC(e.x,t.x),jC(e.y,t.y)}function FC(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function PC(e,t,r,n,s){return e-=t,e=z1(e,1/r,n),s!==void 0&&(e=z1(e,1/s,n)),e}function jI(e,t=0,r=1,n=.5,s,a=e,i=e){if(Al.test(t)&&(t=parseFloat(t),t=Vn(i.min,i.max,t/100)-i.min),typeof t!="number")return;let l=Vn(a.min,a.max,n);e===a&&(l-=t),e.min=PC(e.min,t,r,l,s),e.max=PC(e.max,t,r,l,s)}function RC(e,t,[r,n,s],a,i){jI(e,t[r],t[n],t[s],t.scale,a,i)}const FI=["x","scaleX","originX"],PI=["y","scaleY","originY"];function DC(e,t,r,n){RC(e.x,t,FI,r?r.x:void 0,n?n.x:void 0),RC(e.y,t,PI,r?r.y:void 0,n?n.y:void 0)}function IC(e){return e.translate===0&&e.scale===1}function m6(e){return IC(e.x)&&IC(e.y)}function MC(e,t){return e.min===t.min&&e.max===t.max}function RI(e,t){return MC(e.x,t.x)&&MC(e.y,t.y)}function OC(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function p6(e,t){return OC(e.x,t.x)&&OC(e.y,t.y)}function LC(e){return ai(e.x)/ai(e.y)}function BC(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class DI{constructor(){this.members=[]}add(t){E2(this.members,t),t.scheduleRender()}remove(t){if(N2(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(s=>t===s);if(r===0)return!1;let n;for(let s=r;s>=0;s--){const a=this.members[s];if(a.isPresent!==!1){n=a;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:s}=t.options;s===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function II(e,t,r){let n="";const s=e.x.translate/t.x,a=e.y.translate/t.y,i=r?.z||0;if((s||a||i)&&(n=`translate3d(${s}px, ${a}px, ${i}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:d,rotate:f,rotateX:p,rotateY:g,skewX:y,skewY:v}=r;d&&(n=`perspective(${d}px) ${n}`),f&&(n+=`rotate(${f}deg) `),p&&(n+=`rotateX(${p}deg) `),g&&(n+=`rotateY(${g}deg) `),y&&(n+=`skewX(${y}deg) `),v&&(n+=`skewY(${v}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(n+=`scale(${l}, ${c})`),n||"none"}const rw=["","X","Y","Z"],MI=1e3;let OI=0;function nw(e,t,r,n){const{latestValues:s}=t;s[e]&&(r[e]=s[e],t.setStaticValue(e,0),n&&(n[e]=0))}function x6(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=r6(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:s,layoutId:a}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Wn,!(s||a))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&x6(n)}function y6({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:s}){return class{constructor(i={},l=t?.()){this.id=OI++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(UI),this.nodes.forEach(HI),this.nodes.forEach(GI),this.nodes.forEach($I)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new kI)}addEventListener(i,l){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new F2),this.eventHandlers.get(i).add(l)}notifyListeners(i,...l){const c=this.eventHandlers.get(i);c&&c.notify(...l)}hasListeners(i){return this.eventHandlers.has(i)}mount(i){if(this.instance)return;this.isSVG=R5(i)&&!A7(i),this.instance=i;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),e){let f,p=0;const g=()=>this.root.updateBlockedByResize=!1;Wn.read(()=>{p=window.innerWidth}),e(i,()=>{const y=window.innerWidth;y!==p&&(p=y,this.root.updateBlockedByResize=!0,f&&f(),f=CI(g,250),j1.hasAnimatedSinceResize&&(j1.hasAnimatedSinceResize=!1,this.nodes.forEach(WC)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:p,hasRelativeLayoutChanged:g,layout:y})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||d.getDefaultTransition()||YI,{onLayoutAnimationStart:_,onLayoutAnimationComplete:b}=d.getProps(),E=!this.targetLayout||!p6(this.targetLayout,y),k=!p&&g;if(this.options.layoutRoot||this.resumeFrom||k||p&&(E||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...H2(v,"layout"),onPlay:_,onComplete:b};(d.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(f,k)}else p||WC(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=y})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Iu(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(VI),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&x6(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let f=0;f<this.path.length;f++){const p=this.path[f];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(UC);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach($C);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(zI),this.nodes.forEach(LI),this.nodes.forEach(BI)):this.nodes.forEach($C),this.clearAllSnapshots();const l=bi.now();pa.delta=Sc(0,1e3/60,l-pa.timestamp),pa.timestamp=l,pa.isProcessing=!0,Gv.update.process(pa),Gv.preRender.process(pa),Gv.render.process(pa),pa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,V2.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(WI),this.sharedNodes.forEach(KI)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Wn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Wn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ai(this.snapshot.measuredBox.x)&&!ai(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutCorrected=xs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(l=!1),l&&this.instance){const c=n(this.instance);this.scroll={animationId:this.root.animationId,phase:i,isRoot:c,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!s)return;const i=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!m6(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,f=d!==this.prevTransformTemplateValue;i&&this.instance&&(l||Rd(this.latestValues)||f)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return i&&(c=this.removeTransform(c)),QI(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:i}=this.options;if(!i)return xs();const l=i.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(JI))){const{scroll:d}=this.root;d&&(Lh(l.x,d.offset.x),Lh(l.y,d.offset.y))}return l}removeElementScroll(i){const l=xs();if(no(l,i),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:f,options:p}=d;d!==this.root&&f&&p.layoutScroll&&(f.wasRoot&&no(l,i),Lh(l.x,f.offset.x),Lh(l.y,f.offset.y))}return l}applyTransform(i,l=!1){const c=xs();no(c,i);for(let d=0;d<this.path.length;d++){const f=this.path[d];!l&&f.options.layoutScroll&&f.scroll&&f!==f.root&&Bh(c,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),Rd(f.latestValues)&&Bh(c,f.latestValues)}return Rd(this.latestValues)&&Bh(c,this.latestValues),c}removeTransform(i){const l=xs();no(l,i);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!Rd(d.latestValues))continue;p_(d.latestValues)&&d.updateSnapshot();const f=xs(),p=d.measurePageBox();no(f,p),DC(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,f)}return Rd(this.latestValues)&&DC(l,this.latestValues),l}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==pa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(i||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:p}=this.options;if(!(!this.layout||!(f||p))){if(this.resolvedRelativeTargetAt=pa.timestamp,!this.targetDelta&&!this.relativeTarget){const g=this.getClosestProjectingParent();g&&g.layout&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xs(),this.relativeTargetOrigin=xs(),jm(this.relativeTargetOrigin,this.layout.layoutBox,g.layout.layoutBox),no(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=xs(),this.targetWithTransforms=xs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),sI(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):no(this.target,this.layout.layoutBox),Y5(this.target,this.targetDelta)):no(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const g=this.getClosestProjectingParent();g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xs(),this.relativeTargetOrigin=xs(),jm(this.relativeTargetOrigin,this.target,g.target),no(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||p_(this.parent.latestValues)||X5(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const i=this.getLead(),l=!!this.resumingFrom||this!==i;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===pa.timestamp&&(c=!1),c)return;const{layout:d,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||f))return;no(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,g=this.treeScale.y;p9(this.layoutCorrected,this.treeScale,this.path,l),i.layout&&!i.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(i.target=i.layout.layoutBox,i.targetWithTransforms=xs());const{target:y}=i;if(!y){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(FC(this.prevProjectionDelta.x,this.projectionDelta.x),FC(this.prevProjectionDelta.y,this.projectionDelta.y)),Am(this.projectionDelta,this.layoutCorrected,y,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==g||!BC(this.projectionDelta.x,this.prevProjectionDelta.x)||!BC(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",y))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){if(this.options.visualElement?.scheduleRender(),i){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Uh(),this.projectionDelta=Uh(),this.projectionDeltaWithTransform=Uh()}setAnimationOrigin(i,l=!1){const c=this.snapshot,d=c?c.latestValues:{},f={...this.latestValues},p=Uh();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const g=xs(),y=c?c.source:void 0,v=this.layout?this.layout.source:void 0,_=y!==v,b=this.getStack(),E=!b||b.members.length<=1,k=!!(_&&!E&&this.options.crossfade===!0&&!this.path.some(XI));this.animationProgress=0;let w;this.mixTargetDelta=N=>{const A=N/1e3;zC(p.x,i.x,A),zC(p.y,i.y,A),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(jm(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),qI(this.relativeTarget,this.relativeTargetOrigin,g,A),w&&RI(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=xs()),no(w,this.relativeTarget)),_&&(this.animationValues=f,EI(f,d,this.latestValues,A,k,E)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=A},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Iu(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Wn.update(()=>{j1.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=n0(0)),this.currentAnimation=bI(this.motionValue,[0,1e3],{...i,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),i.onUpdate&&i.onUpdate(l)},onStop:()=>{},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(MI),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:f}=i;if(!(!l||!c||!d)){if(this!==i&&this.layout&&d&&v6(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||xs();const p=ai(this.layout.layoutBox.x);c.x.min=i.target.x.min,c.x.max=c.x.min+p;const g=ai(this.layout.layoutBox.y);c.y.min=i.target.y.min,c.y.max=c.y.min+g}no(l,c),Bh(l,f),Am(this.projectionDeltaWithTransform,this.layoutCorrected,l,f)}}registerSharedNode(i,l){this.sharedNodes.has(i)||this.sharedNodes.set(i,new DI),this.sharedNodes.get(i).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){const{layoutId:i}=this.options;return i?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:i}=this.options;return i?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),i&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetSkewAndRotation(){const{visualElement:i}=this.options;if(!i)return;let l=!1;const{latestValues:c}=i;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&nw("z",i,d,this.animationValues);for(let f=0;f<rw.length;f++)nw(`rotate${rw[f]}`,i,d,this.animationValues),nw(`skew${rw[f]}`,i,d,this.animationValues);i.render();for(const f in d)i.setStaticValue(f,d[f]),this.animationValues&&(this.animationValues[f]=d[f]);i.scheduleRender()}applyProjectionStyles(i,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){i.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,i.visibility="",i.opacity="",i.pointerEvents=A1(l?.pointerEvents)||"",i.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(i.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,i.pointerEvents=A1(l?.pointerEvents)||""),this.hasProjected&&!Rd(this.latestValues)&&(i.transform=c?c({},""):"none",this.hasProjected=!1);return}i.visibility="";const f=d.animationValues||d.latestValues;this.applyTransformsToTarget();let p=II(this.projectionDeltaWithTransform,this.treeScale,f);c&&(p=c(f,p)),i.transform=p;const{x:g,y}=this.projectionDelta;i.transformOrigin=`${g.origin*100}% ${y.origin*100}% 0`,d.animationValues?i.opacity=d===this?f.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:i.opacity=d===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const v in Ym){if(f[v]===void 0)continue;const{correct:_,applyTo:b,isCSSVariable:E}=Ym[v],k=p==="none"?f[v]:_(f[v],d);if(b){const w=b.length;for(let N=0;N<w;N++)i[b[N]]=k}else E?this.options.visualElement.renderState.vars[v]=k:i[v]=k}this.options.layoutId&&(i.pointerEvents=d===this?A1(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>i.currentAnimation?.stop()),this.root.nodes.forEach(UC),this.root.sharedNodes.clear()}}}function LI(e){e.updateLayout()}function BI(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:s}=e.options,a=t.source!==e.layout.source;s==="size"?co(f=>{const p=a?t.measuredBox[f]:t.layoutBox[f],g=ai(p);p.min=r[f].min,p.max=p.min+g}):v6(s,t.layoutBox,r)&&co(f=>{const p=a?t.measuredBox[f]:t.layoutBox[f],g=ai(r[f]);p.max=p.min+g,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+g)});const i=Uh();Am(i,r,t.layoutBox);const l=Uh();a?Am(l,e.applyTransform(n,!0),t.measuredBox):Am(l,r,t.layoutBox);const c=!m6(i);let d=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:p,layout:g}=f;if(p&&g){const y=xs();jm(y,t.layoutBox,p.layoutBox);const v=xs();jm(v,r,g.layoutBox),p6(y,v)||(d=!0),f.options.layoutRoot&&(e.relativeTarget=v,e.relativeTargetOrigin=y,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:l,layoutDelta:i,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function UI(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function $I(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function WI(e){e.clearSnapshot()}function UC(e){e.clearMeasurements()}function $C(e){e.isLayoutDirty=!1}function zI(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function WC(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function HI(e){e.resolveTargetDelta()}function GI(e){e.calcProjection()}function VI(e){e.resetSkewAndRotation()}function KI(e){e.removeLeadSnapshot()}function zC(e,t,r){e.translate=Vn(t.translate,0,r),e.scale=Vn(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function HC(e,t,r,n){e.min=Vn(t.min,r.min,n),e.max=Vn(t.max,r.max,n)}function qI(e,t,r,n){HC(e.x,t.x,r.x,n),HC(e.y,t.y,r.y,n)}function XI(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const YI={duration:.45,ease:[.4,0,.1,1]},GC=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),VC=GC("applewebkit/")&&!GC("chrome/")?Math.round:mo;function KC(e){e.min=VC(e.min),e.max=VC(e.max)}function QI(e){KC(e.x),KC(e.y)}function v6(e,t,r){return e==="position"||e==="preserve-aspect"&&!nI(LC(t),LC(r),.2)}function JI(e){return e!==e.root&&e.scroll?.wasRoot}const ZI=y6({attachResizeListener:(e,t)=>Qm(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),sw={current:void 0},w6=y6({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!sw.current){const e=new ZI({});e.mount(window),e.setOptions({layoutScroll:!0}),sw.current=e}return sw.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),eM={pan:{Feature:yI},drag:{Feature:xI,ProjectionNode:w6,MeasureLayout:f6}};function qC(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const s="onHover"+r,a=n[s];a&&Wn.postRender(()=>a(t,Np(t)))}class tM extends Hu{mount(){const{current:t}=this.node;t&&(this.unmount=k7(t,(r,n)=>(qC(this.node,n,"Start"),s=>qC(this.node,s,"End"))))}unmount(){}}class rM extends Hu{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Cp(Qm(this.node.current,"focus",()=>this.onFocus()),Qm(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function XC(e,t,r){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const s="onTap"+(r==="End"?"":r),a=n[s];a&&Wn.postRender(()=>a(t,Np(t)))}class nM extends Hu{mount(){const{current:t}=this.node;t&&(this.unmount=N7(t,(r,n)=>(XC(this.node,n,"Start"),(s,{success:a})=>XC(this.node,s,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const S_=new WeakMap,aw=new WeakMap,sM=e=>{const t=S_.get(e.target);t&&t(e)},aM=e=>{e.forEach(sM)};function iM({root:e,...t}){const r=e||document;aw.has(r)||aw.set(r,{});const n=aw.get(r),s=JSON.stringify(t);return n[s]||(n[s]=new IntersectionObserver(aM,{root:e,...t})),n[s]}function oM(e,t,r){const n=iM(t);return S_.set(e,r),n.observe(e),()=>{S_.delete(e),n.unobserve(e)}}const lM={some:0,all:1};class cM extends Hu{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:s="some",once:a}=t,i={root:r?r.current:void 0,rootMargin:n,threshold:typeof s=="number"?s:lM[s]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,a&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:f,onViewportLeave:p}=this.node.getProps(),g=d?f:p;g&&g(c)};return oM(this.node.current,i,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(uM(t,r))&&this.startObserver()}unmount(){}}function uM({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const dM={inView:{Feature:cM},tap:{Feature:nM},focus:{Feature:rM},hover:{Feature:tM}},fM={layout:{ProjectionNode:w6,MeasureLayout:f6}},hM={...Q9,...dM,...eM,...fM},et=h9(hM,T9),nt=({children:e,variant:t="primary",size:r="md",onClick:n,disabled:s=!1,className:a="",...i})=>{const l="font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer",c={primary:"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500",success:"bg-green-600 hover:bg-green-700 text-white focus:ring-green-500",danger:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500",warning:"bg-yellow-600 hover:bg-yellow-700 text-white focus:ring-yellow-500",outline:"bg-transparent text-blue-600 border-2 border-blue-600 hover:bg-blue-600 hover:text-white focus:ring-blue-500",secondary:"bg-gray-200 hover:bg-gray-300 text-gray-700 focus:ring-gray-500"},d={xs:"px-2 py-1 text-xs",sm:"px-2 py-1 text-xs sm:px-3 sm:py-1.5 sm:text-sm",md:"px-3 py-1.5 text-sm sm:px-4 sm:py-2 sm:text-base",lg:"px-4 py-2 text-base sm:px-6 sm:py-3 sm:text-lg",icon:"p-0 flex items-center justify-center"},f=s?"opacity-50 cursor-not-allowed":"";return o.jsx(et.button,{className:`${l} ${c[t]} ${d[r]} ${f} ${a}`,onClick:n,disabled:s,whileHover:s?{}:{scale:1.05},whileTap:s?{}:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},...i,children:e})},jr=({size:e="md",color:t="blue",className:r=""})=>{const n={sm:"w-4 h-4",small:"w-4 h-4",md:"w-6 h-6",medium:"w-6 h-6",lg:"w-8 h-8",large:"w-8 h-8",xl:"w-12 h-12"},s={blue:"border-blue-600",green:"border-green-600",red:"border-red-600",yellow:"border-yellow-600",gray:"border-gray-600"};return o.jsx(et.div,{className:`
        inline-block border-2 border-gray-300 border-t-current rounded-full animate-spin
        ${n[e]} ${s[t]} ${r}
      `,animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})},Ko=({type:e="info",message:t="",duration:r=3e3,closable:n=!0,onClose:s,className:a="",...i})=>{const[l,c]=C.useState(!0),[d,f]=C.useState(!1),p=C.useRef(null),g=C.useRef(null);C.useEffect(()=>{if(r>0)return g.current=setTimeout(()=>{y()},r),()=>{g.current&&clearTimeout(g.current)}},[r]);const y=C.useCallback(()=>{d||(f(!0),g.current&&clearTimeout(g.current),setTimeout(()=>{c(!1),s&&s()},300))},[d,s]),v=C.useCallback(E=>{E.key==="Escape"&&y()},[y]);if(!l)return null;const _=["notification",`notification-${e}`,l?"notification-visible":"",d?"notification-exiting":"",a].filter(Boolean).join(" "),b=()=>{switch(e){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";case"info":default:return"ℹ"}};return o.jsx("div",{ref:p,className:_,role:"alert","aria-live":"polite",onKeyDown:v,tabIndex:-1,...i,children:o.jsxs("div",{className:"notification-content",children:[o.jsx("div",{className:"notification-icon","aria-hidden":"true",children:b()}),o.jsx("div",{className:"notification-body",children:o.jsx("div",{className:"notification-message",children:t})}),n&&o.jsx("button",{className:"notification-close",onClick:y,type:"button","aria-label":"Close notification",children:"×"})]})})},ka=()=>{const[e,t]=C.useState([]),r=C.useCallback((a,i="info",l={})=>{const c=Date.now()+Math.random(),d={id:c,message:a,type:i,...l};return t(f=>[...f,d]),l.duration!==0&&setTimeout(()=>{n(c)},l.duration||3e3),c},[]),n=C.useCallback(a=>{t(i=>i.filter(l=>l.id!==a))},[]),s=C.useCallback(()=>{t([])},[]);return{notifications:e,showNotification:r,removeNotification:n,clearAllNotifications:s}},zi=()=>{const[e,t]=C.useState(!1),[r,n]=C.useState(null),[s,a]=C.useState(null),i=C.useRef(null);C.useRef(new Map);const l=C.useRef(0),c=3,d=1e3,f=C.useCallback(()=>{i.current&&(i.current.abort(),i.current=null)},[]);C.useEffect(()=>f,[f]);const p=C.useCallback(async(B,z={})=>{try{t(!0),n(null),i.current=new AbortController;const Q=z.method||"POST",Y={method:Q,headers:{"Content-Type":"application/json",...z.headers},signal:i.current.signal,...z};Q!=="GET"&&Q!=="HEAD"&&(Y.body=JSON.stringify(z.data||{})),console.log(`[API] Making request to: ${B}`,Y);const te=await fetch(B,Y);if(!te.ok)throw new Error(`HTTP error! status: ${te.status}`);const ee=await te.json();if(console.log("[API] Response received:",ee),ee.success)return a(ee),l.current=0,ee;throw new Error(ee.error||ee.message||"Request failed")}catch(Q){if(Q.name==="AbortError")return console.log("[API] Request was aborted"),null;if(console.error("[API] Request failed:",Q),n(Q.message||"Request failed"),l.current<c){l.current++;const Y=d*Math.pow(2,l.current-1);return console.log(`[API] Retrying in ${Y}ms (attempt ${l.current}/${c})`),await new Promise(te=>setTimeout(te,Y)),p(B,z)}throw Q}finally{t(!1),i.current=null}},[]),g=C.useCallback(async(B,z={})=>{try{if(!window.tokenManager||!window.tokenManager.isAuthenticated())throw new Error("No valid authentication token found");return await window.tokenManager.makeAuthenticatedRequest(B,z)}catch(Q){throw console.error("[API] Authenticated request failed:",Q),Q}},[]),y=C.useCallback(async(B,z)=>{try{const Q=`/.netlify/functions/get-test-questions?test_type=${B}&test_id=${z}`;console.log(`[API] Getting test info for ${B}_${z}`);const te=await(await g(Q)).json();if(te.success)return console.log("[API] Test info retrieved successfully:",te.test_info),te.test_info;throw new Error(te.error||"Failed to get test info")}catch(Q){throw console.error("[API] Failed to get test info:",Q),Q}},[g]),v=C.useCallback(async(B,z)=>{try{const Q=`/.netlify/functions/get-test-questions?test_type=${B}&test_id=${z}`;console.log(`[API] Getting test questions for ${B}_${z}`);const te=await(await g(Q)).json();if(te.success)return console.log("[API] Test questions retrieved successfully:",te.questions),te.questions;throw new Error(te.error||"Failed to get test questions")}catch(Q){throw console.error("[API] Failed to get test questions:",Q),Q}},[g]),_=C.useCallback(async()=>{try{const B="/.netlify/functions/get-student-active-tests";console.log("[API] Loading student active tests");const Q=await(await g(B)).json();if(Q.success)return console.log("[API] Student active tests loaded successfully:",Q.tests),Q.tests;throw new Error(Q.error||"Failed to load student active tests")}catch(B){throw console.error("[API] Failed to load student active tests:",B),B}},[g]),b=C.useCallback(async(B,z,Q)=>{try{let Y;switch(B){case"true_false":Y="/.netlify/functions/submit-true-false-test";break;case"multiple_choice":Y="/.netlify/functions/submit-multiple-choice-test";break;case"input":Y="/.netlify/functions/submit-input-test";break;case"matching_type":Y="/.netlify/functions/submit-matching-type-test";break;case"speaking":Y="/.netlify/functions/submit-speaking-test";break;default:throw new Error(`Unknown test type: ${B}`)}console.log(`[API] Submitting ${B} test:`,Q);const ee=await(await g(Y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)})).json();if(ee.success)return console.log("[API] Test submitted successfully:",ee),ee;throw new Error(ee.error||"Failed to submit test")}catch(Y){throw console.error("[API] Failed to submit test:",Y),Y}},[g]),E=C.useCallback(async B=>{try{const z="/.netlify/functions/save-multiple-choice-test";console.log("[API] Saving multiple choice test:",B);const Y=await(await g(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})).json();if(Y.success)return console.log("[API] Multiple choice test saved successfully:",Y),Y;throw new Error(Y.error||"Failed to save multiple choice test")}catch(z){throw console.error("[API] Failed to save multiple choice test:",z),z}},[g]),k=C.useCallback(async B=>{try{const z="/.netlify/functions/save-true-false-test";console.log("[API] Saving true/false test:",B);const Y=await(await g(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})).json();if(Y.success)return console.log("[API] True/false test saved successfully:",Y),Y;throw new Error(Y.error||"Failed to save true/false test")}catch(z){throw console.error("[API] Failed to save true/false test:",z),z}},[g]),w=C.useCallback(async B=>{try{const z="/.netlify/functions/save-input-test";console.log("[API] Saving input test:",B);const Y=await(await g(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})).json();if(Y.success)return console.log("[API] Input test saved successfully:",Y),Y;throw new Error(Y.error||"Failed to save input test")}catch(z){throw console.error("[API] Failed to save input test:",z),z}},[g]),N=C.useCallback(async B=>{try{const z="/.netlify/functions/assign-test";console.log("[API] Assigning test to classes:",B);const Y=await(await g(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})).json();if(Y.success)return console.log("[API] Test assigned successfully:",Y),Y;throw new Error(Y.error||"Failed to assign test")}catch(z){throw console.error("[API] Failed to assign test:",z),z}},[g]),A=C.useCallback(async()=>{try{const B="/.netlify/functions/get-teacher-active-tests";console.log("[API] Loading teacher active tests");const Q=await(await g(B)).json();if(Q.success)return console.log("[API] Teacher active tests loaded successfully:",Q.tests),Q.tests;throw new Error(Q.error||"Failed to load teacher active tests")}catch(B){throw console.error("[API] Failed to load teacher active tests:",B),B}},[g]),P=C.useCallback(async()=>{try{const B="/.netlify/functions/get-all-users";console.log("[API] Getting all users");const Q=await(await g(B)).json();if(Q.success)return console.log("[API] All users loaded successfully:",Q.users),Q.users;throw new Error(Q.error||"Failed to get all users")}catch(B){throw console.error("[API] Failed to get all users:",B),B}},[g]),R=C.useCallback(async()=>{try{const B="/.netlify/functions/get-all-teachers";console.log("[API] Getting all teachers");const Q=await(await g(B)).json();if(Q.success)return console.log("[API] All teachers loaded successfully:",Q.teachers),Q.teachers;throw new Error(Q.error||"Failed to get all teachers")}catch(B){throw console.error("[API] Failed to get all teachers:",B),B}},[g]),T=C.useCallback(async()=>{try{const B="/.netlify/functions/get-all-subjects";console.log("[API] Getting all subjects");const Q=await(await g(B)).json();if(Q.success)return console.log("[API] All subjects loaded successfully:",Q.subjects),Q.subjects;throw new Error(Q.error||"Failed to get all subjects")}catch(B){throw console.error("[API] Failed to get all subjects:",B),B}},[g]),D=C.useCallback(()=>{n(null)},[]),I=C.useCallback(()=>{a(null)},[]),V=C.useCallback(()=>{t(!1),n(null),a(null),l.current=0,f()},[f]),X=C.useCallback(async(B,z={})=>{const Y=await(await g(B,{...z,method:"GET"})).json();if(Y.success)return Y;throw new Error(Y.error||"Request failed")},[g]),Z=C.useCallback(async(B,z,Q={})=>{const te=await(await g(B,{...Q,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)})).json();if(te.success)return te;throw new Error(te.error||"Request failed")},[g]),ie=C.useCallback(async(B,z,Q={})=>{const te=await(await g(B,{...Q,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)})).json();if(te.success)return te;throw new Error(te.error||"Request failed")},[g]),q=C.useCallback(async(B,z={})=>{const Y=await(await g(B,{...z,method:"DELETE"})).json();if(Y.success)return Y;throw new Error(Y.error||"Request failed")},[g]),ne=C.useCallback(async B=>{try{const z="/.netlify/functions/submit-speaking-test";console.log("[API] Submitting speaking test:",B);const Y=await(await g(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})).json();if(Y.success)return console.log("[API] Speaking test submitted successfully:",Y),Y;throw new Error(Y.error||"Failed to submit speaking test")}catch(z){throw console.error("[API] Failed to submit speaking test:",z),z}},[g]),M=C.useCallback(async B=>{try{const z=`/.netlify/functions/get-speaking-test-new?action=test&test_id=${B}`;console.log("[API] Getting speaking test:",B);const Y=await(await g(z,{method:"GET"})).json();if(Y.success)return console.log("[API] Speaking test loaded successfully:",Y),Y;throw new Error(Y.error||"Failed to load speaking test")}catch(z){throw console.error("[API] Failed to load speaking test:",z),z}},[g]),W=C.useCallback(async B=>{try{const z=`/.netlify/functions/get-speaking-test-new?action=questions&test_id=${B}`;console.log("[API] Getting speaking test questions:",B);const Y=await(await g(z,{method:"GET"})).json();if(Y.success)return console.log("[API] Speaking test questions loaded successfully:",Y),Y;throw new Error(Y.error||"Failed to load speaking test questions")}catch(z){throw console.error("[API] Failed to load speaking test questions:",z),z}},[g]),L=C.useCallback(async B=>{try{const z="/.netlify/functions/upload-speaking-audio";console.log("[API] Uploading speaking audio");const Y=await(await g(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})).json();if(Y.success)return console.log("[API] Audio uploaded successfully:",Y),Y;throw new Error(Y.error||"Failed to upload audio")}catch(z){throw console.error("[API] Failed to upload audio:",z),z}},[g]),H=C.useCallback(async B=>{try{const z=`/.netlify/functions/get-speaking-test-new?action=audio&file_path=${encodeURIComponent(B)}`;console.log("[API] Getting speaking audio:",B);const Y=await(await g(z,{method:"GET"})).json();if(Y.success)return console.log("[API] Audio URL retrieved successfully:",Y),Y;throw new Error(Y.error||"Failed to get audio")}catch(z){throw console.error("[API] Failed to get audio:",z),z}},[g]),K=C.useCallback(async(B,z)=>{try{const Q=`/.netlify/functions/check-test-completion?test_id=${B}&test_type=${z}`;console.log("[API] Checking test completion:",B,z);const te=await(await g(Q,{method:"GET"})).json();if(te.success)return console.log("[API] Test completion status:",te),te;throw new Error(te.error||"Failed to check test completion")}catch(Q){throw console.error("[API] Failed to check test completion:",Q),Q}},[g]);return{loading:e,error:r,data:s,sendRequest:p,makeAuthenticatedRequest:g,get:X,post:Z,put:ie,delete:q,getTestInfo:y,getTestQuestions:v,loadStudentActiveTests:_,submitTest:b,submitSpeakingTest:ne,getSpeakingTest:M,getSpeakingTestQuestions:W,uploadSpeakingAudio:L,getSpeakingAudio:H,checkTestCompletion:K,saveMultipleChoiceTest:E,saveTrueFalseTest:k,saveInputTest:w,assignTestToClasses:N,loadTeacherActiveTests:A,getAllUsers:P,getAllTeachers:R,getAllSubjects:T,clearError:D,clearData:I,reset:V,cleanup:f}},gM="modulepreload",mM=function(e){return"/"+e},YC={},Uo=function(t,r,n){let s=Promise.resolve();if(r&&r.length>0){let d=function(f){return Promise.all(f.map(p=>Promise.resolve(p).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};var i=d;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");s=d(r.map(f=>{if(f=mM(f),f in YC)return;YC[f]=!0;const p=f.endsWith(".css"),g=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${g}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":gM,p||(y.as="script"),y.crossOrigin="",y.href=f,c&&y.setAttribute("nonce",c),document.head.appendChild(y),p)return new Promise((v,_)=>{y.addEventListener("load",v),y.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&a(c.reason);return t().catch(a)})};var F1={exports:{}},Tg={},iw={},ow={},QC;function Br(){return QC||(QC=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const t=Math.PI/180;function r(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}e.glob=typeof L1<"u"?L1:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},e.Konva={_global:e.glob,version:"9.3.22",isBrowser:r(),isUnminified:/param/.test((function(s){}).toString()),dblClickWindow:400,getAngle(s){return e.Konva.angleDeg?s*t:s},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return e.Konva.DD.isDragging},isTransforming(){var s;return(s=e.Konva.Transformer)===null||s===void 0?void 0:s.isTransforming()},isDragReady(){return!!e.Konva.DD.node},releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(s){e.glob.Konva=s}};const n=s=>{e.Konva[s.prototype.getClassName()]=s};e._registerNode=n,e.Konva._injectGlobal(e.Konva)})(ow)),ow}var lw={},JC;function ls(){return JC||(JC=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Util=e.Transform=void 0;const t=Br();class r{constructor(N=[1,0,0,1,0,0]){this.dirty=!1,this.m=N&&N.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new r(this.m)}copyInto(N){N.m[0]=this.m[0],N.m[1]=this.m[1],N.m[2]=this.m[2],N.m[3]=this.m[3],N.m[4]=this.m[4],N.m[5]=this.m[5]}point(N){const A=this.m;return{x:A[0]*N.x+A[2]*N.y+A[4],y:A[1]*N.x+A[3]*N.y+A[5]}}translate(N,A){return this.m[4]+=this.m[0]*N+this.m[2]*A,this.m[5]+=this.m[1]*N+this.m[3]*A,this}scale(N,A){return this.m[0]*=N,this.m[1]*=N,this.m[2]*=A,this.m[3]*=A,this}rotate(N){const A=Math.cos(N),P=Math.sin(N),R=this.m[0]*A+this.m[2]*P,T=this.m[1]*A+this.m[3]*P,D=this.m[0]*-P+this.m[2]*A,I=this.m[1]*-P+this.m[3]*A;return this.m[0]=R,this.m[1]=T,this.m[2]=D,this.m[3]=I,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(N,A){const P=this.m[0]+this.m[2]*A,R=this.m[1]+this.m[3]*A,T=this.m[2]+this.m[0]*N,D=this.m[3]+this.m[1]*N;return this.m[0]=P,this.m[1]=R,this.m[2]=T,this.m[3]=D,this}multiply(N){const A=this.m[0]*N.m[0]+this.m[2]*N.m[1],P=this.m[1]*N.m[0]+this.m[3]*N.m[1],R=this.m[0]*N.m[2]+this.m[2]*N.m[3],T=this.m[1]*N.m[2]+this.m[3]*N.m[3],D=this.m[0]*N.m[4]+this.m[2]*N.m[5]+this.m[4],I=this.m[1]*N.m[4]+this.m[3]*N.m[5]+this.m[5];return this.m[0]=A,this.m[1]=P,this.m[2]=R,this.m[3]=T,this.m[4]=D,this.m[5]=I,this}invert(){const N=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),A=this.m[3]*N,P=-this.m[1]*N,R=-this.m[2]*N,T=this.m[0]*N,D=N*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),I=N*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=A,this.m[1]=P,this.m[2]=R,this.m[3]=T,this.m[4]=D,this.m[5]=I,this}getMatrix(){return this.m}decompose(){const N=this.m[0],A=this.m[1],P=this.m[2],R=this.m[3],T=this.m[4],D=this.m[5],I=N*R-A*P,V={x:T,y:D,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(N!=0||A!=0){const X=Math.sqrt(N*N+A*A);V.rotation=A>0?Math.acos(N/X):-Math.acos(N/X),V.scaleX=X,V.scaleY=I/X,V.skewX=(N*P+A*R)/I,V.skewY=0}else if(P!=0||R!=0){const X=Math.sqrt(P*P+R*R);V.rotation=Math.PI/2-(R>0?Math.acos(-P/X):-Math.acos(P/X)),V.scaleX=I/X,V.scaleY=X,V.skewX=0,V.skewY=(N*P+A*R)/I}return V.rotation=e.Util._getRotation(V.rotation),V}}e.Transform=r;const n="[object Array]",s="[object Number]",a="[object String]",i="[object Boolean]",l=Math.PI/180,c=180/Math.PI,d="#",f="",p="0",g="Konva warning: ",y="Konva error: ",v="rgb(",_={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let E=[];const k=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(w){setTimeout(w,60)};e.Util={_isElement(w){return!!(w&&w.nodeType==1)},_isFunction(w){return!!(w&&w.constructor&&w.call&&w.apply)},_isPlainObject(w){return!!w&&w.constructor===Object},_isArray(w){return Object.prototype.toString.call(w)===n},_isNumber(w){return Object.prototype.toString.call(w)===s&&!isNaN(w)&&isFinite(w)},_isString(w){return Object.prototype.toString.call(w)===a},_isBoolean(w){return Object.prototype.toString.call(w)===i},isObject(w){return w instanceof Object},isValidSelector(w){if(typeof w!="string")return!1;const N=w[0];return N==="#"||N==="."||N===N.toUpperCase()},_sign(w){return w===0||w>0?1:-1},requestAnimFrame(w){E.push(w),E.length===1&&k(function(){const N=E;E=[],N.forEach(function(A){A()})})},createCanvasElement(){const w=document.createElement("canvas");try{w.style=w.style||{}}catch{}return w},createImageElement(){return document.createElement("img")},_isInDocument(w){for(;w=w.parentNode;)if(w==document)return!0;return!1},_urlToImage(w,N){const A=e.Util.createImageElement();A.onload=function(){N(A)},A.src=w},_rgbToHex(w,N,A){return((1<<24)+(w<<16)+(N<<8)+A).toString(16).slice(1)},_hexToRgb(w){w=w.replace(d,f);const N=parseInt(w,16);return{r:N>>16&255,g:N>>8&255,b:N&255}},getRandomColor(){let w=(Math.random()*16777215<<0).toString(16);for(;w.length<6;)w=p+w;return d+w},getRGB(w){let N;return w in _?(N=_[w],{r:N[0],g:N[1],b:N[2]}):w[0]===d?this._hexToRgb(w.substring(1)):w.substr(0,4)===v?(N=b.exec(w.replace(/ /g,"")),{r:parseInt(N[1],10),g:parseInt(N[2],10),b:parseInt(N[3],10)}):{r:0,g:0,b:0}},colorToRGBA(w){return w=w||"black",e.Util._namedColorToRBA(w)||e.Util._hex3ColorToRGBA(w)||e.Util._hex4ColorToRGBA(w)||e.Util._hex6ColorToRGBA(w)||e.Util._hex8ColorToRGBA(w)||e.Util._rgbColorToRGBA(w)||e.Util._rgbaColorToRGBA(w)||e.Util._hslColorToRGBA(w)},_namedColorToRBA(w){const N=_[w.toLowerCase()];return N?{r:N[0],g:N[1],b:N[2],a:1}:null},_rgbColorToRGBA(w){if(w.indexOf("rgb(")===0){w=w.match(/rgb\(([^)]+)\)/)[1];const N=w.split(/ *, */).map(Number);return{r:N[0],g:N[1],b:N[2],a:1}}},_rgbaColorToRGBA(w){if(w.indexOf("rgba(")===0){w=w.match(/rgba\(([^)]+)\)/)[1];const N=w.split(/ *, */).map((A,P)=>A.slice(-1)==="%"?P===3?parseInt(A)/100:parseInt(A)/100*255:Number(A));return{r:N[0],g:N[1],b:N[2],a:N[3]}}},_hex8ColorToRGBA(w){if(w[0]==="#"&&w.length===9)return{r:parseInt(w.slice(1,3),16),g:parseInt(w.slice(3,5),16),b:parseInt(w.slice(5,7),16),a:parseInt(w.slice(7,9),16)/255}},_hex6ColorToRGBA(w){if(w[0]==="#"&&w.length===7)return{r:parseInt(w.slice(1,3),16),g:parseInt(w.slice(3,5),16),b:parseInt(w.slice(5,7),16),a:1}},_hex4ColorToRGBA(w){if(w[0]==="#"&&w.length===5)return{r:parseInt(w[1]+w[1],16),g:parseInt(w[2]+w[2],16),b:parseInt(w[3]+w[3],16),a:parseInt(w[4]+w[4],16)/255}},_hex3ColorToRGBA(w){if(w[0]==="#"&&w.length===4)return{r:parseInt(w[1]+w[1],16),g:parseInt(w[2]+w[2],16),b:parseInt(w[3]+w[3],16),a:1}},_hslColorToRGBA(w){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(w)){const[N,...A]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(w),P=Number(A[0])/360,R=Number(A[1])/100,T=Number(A[2])/100;let D,I,V;if(R===0)return V=T*255,{r:Math.round(V),g:Math.round(V),b:Math.round(V),a:1};T<.5?D=T*(1+R):D=T+R-T*R;const X=2*T-D,Z=[0,0,0];for(let ie=0;ie<3;ie++)I=P+1/3*-(ie-1),I<0&&I++,I>1&&I--,6*I<1?V=X+(D-X)*6*I:2*I<1?V=D:3*I<2?V=X+(D-X)*(2/3-I)*6:V=X,Z[ie]=V*255;return{r:Math.round(Z[0]),g:Math.round(Z[1]),b:Math.round(Z[2]),a:1}}},haveIntersection(w,N){return!(N.x>w.x+w.width||N.x+N.width<w.x||N.y>w.y+w.height||N.y+N.height<w.y)},cloneObject(w){const N={};for(const A in w)this._isPlainObject(w[A])?N[A]=this.cloneObject(w[A]):this._isArray(w[A])?N[A]=this.cloneArray(w[A]):N[A]=w[A];return N},cloneArray(w){return w.slice(0)},degToRad(w){return w*l},radToDeg(w){return w*c},_degToRad(w){return e.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),e.Util.degToRad(w)},_radToDeg(w){return e.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),e.Util.radToDeg(w)},_getRotation(w){return t.Konva.angleDeg?e.Util.radToDeg(w):w},_capitalize(w){return w.charAt(0).toUpperCase()+w.slice(1)},throw(w){throw new Error(y+w)},error(w){console.error(y+w)},warn(w){t.Konva.showWarnings&&console.warn(g+w)},each(w,N){for(const A in w)N(A,w[A])},_inRange(w,N,A){return N<=w&&w<A},_getProjectionToSegment(w,N,A,P,R,T){let D,I,V;const X=(w-A)*(w-A)+(N-P)*(N-P);if(X==0)D=w,I=N,V=(R-A)*(R-A)+(T-P)*(T-P);else{const Z=((R-w)*(A-w)+(T-N)*(P-N))/X;Z<0?(D=w,I=N,V=(w-R)*(w-R)+(N-T)*(N-T)):Z>1?(D=A,I=P,V=(A-R)*(A-R)+(P-T)*(P-T)):(D=w+Z*(A-w),I=N+Z*(P-N),V=(D-R)*(D-R)+(I-T)*(I-T))}return[D,I,V]},_getProjectionToLine(w,N,A){const P=e.Util.cloneObject(w);let R=Number.MAX_VALUE;return N.forEach(function(T,D){if(!A&&D===N.length-1)return;const I=N[(D+1)%N.length],V=e.Util._getProjectionToSegment(T.x,T.y,I.x,I.y,w.x,w.y),X=V[0],Z=V[1],ie=V[2];ie<R&&(P.x=X,P.y=Z,R=ie)}),P},_prepareArrayForTween(w,N,A){const P=[],R=[];if(w.length>N.length){const D=N;N=w,w=D}for(let D=0;D<w.length;D+=2)P.push({x:w[D],y:w[D+1]});for(let D=0;D<N.length;D+=2)R.push({x:N[D],y:N[D+1]});const T=[];return R.forEach(function(D){const I=e.Util._getProjectionToLine(D,P,A);T.push(I.x),T.push(I.y)}),T},_prepareToStringify(w){let N;w.visitedByCircularReferenceRemoval=!0;for(const A in w)if(w.hasOwnProperty(A)&&w[A]&&typeof w[A]=="object"){if(N=Object.getOwnPropertyDescriptor(w,A),w[A].visitedByCircularReferenceRemoval||e.Util._isElement(w[A]))if(N.configurable)delete w[A];else return null;else if(e.Util._prepareToStringify(w[A])===null)if(N.configurable)delete w[A];else return null}return delete w.visitedByCircularReferenceRemoval,w},_assign(w,N){for(const A in N)w[A]=N[A];return w},_getFirstPointerId(w){return w.touches?w.changedTouches[0].identifier:w.pointerId||999},releaseCanvas(...w){t.Konva.releaseCanvasOnDestroy&&w.forEach(N=>{N.width=0,N.height=0})},drawRoundedRectPath(w,N,A,P){let R=0,T=0,D=0,I=0;typeof P=="number"?R=T=D=I=Math.min(P,N/2,A/2):(R=Math.min(P[0]||0,N/2,A/2),T=Math.min(P[1]||0,N/2,A/2),I=Math.min(P[2]||0,N/2,A/2),D=Math.min(P[3]||0,N/2,A/2)),w.moveTo(R,0),w.lineTo(N-T,0),w.arc(N-T,T,T,Math.PI*3/2,0,!1),w.lineTo(N,A-I),w.arc(N-I,A-I,I,0,Math.PI/2,!1),w.lineTo(D,A),w.arc(D,A-D,D,Math.PI/2,Math.PI,!1),w.lineTo(0,R),w.arc(R,R,R,Math.PI,Math.PI*3/2,!1)}}})(lw)),lw}var Eg={},cc={},uc={},ZC;function _6(){if(ZC)return uc;ZC=1,Object.defineProperty(uc,"__esModule",{value:!0}),uc.HitContext=uc.SceneContext=uc.Context=void 0;const e=ls(),t=Br();function r(E){const k=[],w=E.length,N=e.Util;for(let A=0;A<w;A++){let P=E[A];N._isNumber(P)?P=Math.round(P*1e3)/1e3:N._isString(P)||(P=P+""),k.push(P)}return k}const n=",",s="(",a=")",i="([",l="])",c=";",d="()",f="=",p=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],g=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],y=100;let v=class{constructor(k){this.canvas=k,t.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(k){k.fillEnabled()&&this._fill(k)}_fill(k){}strokeShape(k){k.hasStroke()&&this._stroke(k)}_stroke(k){}fillStrokeShape(k){k.attrs.fillAfterStrokeEnabled?(this.strokeShape(k),this.fillShape(k)):(this.fillShape(k),this.strokeShape(k))}getTrace(k,w){let N=this.traceArr,A=N.length,P="",R,T,D,I;for(R=0;R<A;R++)T=N[R],D=T.method,D?(I=T.args,P+=D,k?P+=d:e.Util._isArray(I[0])?P+=i+I.join(n)+l:(w&&(I=I.map(V=>typeof V=="number"?Math.floor(V):V)),P+=s+I.join(n)+a)):(P+=T.property,k||(P+=f+T.val)),P+=c;return P}clearTrace(){this.traceArr=[]}_trace(k){let w=this.traceArr,N;w.push(k),N=w.length,N>=y&&w.shift()}reset(){const k=this.getCanvas().getPixelRatio();this.setTransform(1*k,0,0,1*k,0,0)}getCanvas(){return this.canvas}clear(k){const w=this.getCanvas();k?this.clearRect(k.x||0,k.y||0,k.width||0,k.height||0):this.clearRect(0,0,w.getWidth()/w.pixelRatio,w.getHeight()/w.pixelRatio)}_applyLineCap(k){const w=k.attrs.lineCap;w&&this.setAttr("lineCap",w)}_applyOpacity(k){const w=k.getAbsoluteOpacity();w!==1&&this.setAttr("globalAlpha",w)}_applyLineJoin(k){const w=k.attrs.lineJoin;w&&this.setAttr("lineJoin",w)}setAttr(k,w){this._context[k]=w}arc(k,w,N,A,P,R){this._context.arc(k,w,N,A,P,R)}arcTo(k,w,N,A,P){this._context.arcTo(k,w,N,A,P)}beginPath(){this._context.beginPath()}bezierCurveTo(k,w,N,A,P,R){this._context.bezierCurveTo(k,w,N,A,P,R)}clearRect(k,w,N,A){this._context.clearRect(k,w,N,A)}clip(...k){this._context.clip.apply(this._context,k)}closePath(){this._context.closePath()}createImageData(k,w){const N=arguments;if(N.length===2)return this._context.createImageData(k,w);if(N.length===1)return this._context.createImageData(k)}createLinearGradient(k,w,N,A){return this._context.createLinearGradient(k,w,N,A)}createPattern(k,w){return this._context.createPattern(k,w)}createRadialGradient(k,w,N,A,P,R){return this._context.createRadialGradient(k,w,N,A,P,R)}drawImage(k,w,N,A,P,R,T,D,I){const V=arguments,X=this._context;V.length===3?X.drawImage(k,w,N):V.length===5?X.drawImage(k,w,N,A,P):V.length===9&&X.drawImage(k,w,N,A,P,R,T,D,I)}ellipse(k,w,N,A,P,R,T,D){this._context.ellipse(k,w,N,A,P,R,T,D)}isPointInPath(k,w,N,A){return N?this._context.isPointInPath(N,k,w,A):this._context.isPointInPath(k,w,A)}fill(...k){this._context.fill.apply(this._context,k)}fillRect(k,w,N,A){this._context.fillRect(k,w,N,A)}strokeRect(k,w,N,A){this._context.strokeRect(k,w,N,A)}fillText(k,w,N,A){A?this._context.fillText(k,w,N,A):this._context.fillText(k,w,N)}measureText(k){return this._context.measureText(k)}getImageData(k,w,N,A){return this._context.getImageData(k,w,N,A)}lineTo(k,w){this._context.lineTo(k,w)}moveTo(k,w){this._context.moveTo(k,w)}rect(k,w,N,A){this._context.rect(k,w,N,A)}roundRect(k,w,N,A,P){this._context.roundRect(k,w,N,A,P)}putImageData(k,w,N){this._context.putImageData(k,w,N)}quadraticCurveTo(k,w,N,A){this._context.quadraticCurveTo(k,w,N,A)}restore(){this._context.restore()}rotate(k){this._context.rotate(k)}save(){this._context.save()}scale(k,w){this._context.scale(k,w)}setLineDash(k){this._context.setLineDash?this._context.setLineDash(k):"mozDash"in this._context?this._context.mozDash=k:"webkitLineDash"in this._context&&(this._context.webkitLineDash=k)}getLineDash(){return this._context.getLineDash()}setTransform(k,w,N,A,P,R){this._context.setTransform(k,w,N,A,P,R)}stroke(k){k?this._context.stroke(k):this._context.stroke()}strokeText(k,w,N,A){this._context.strokeText(k,w,N,A)}transform(k,w,N,A,P,R){this._context.transform(k,w,N,A,P,R)}translate(k,w){this._context.translate(k,w)}_enableTrace(){let k=this,w=p.length,N=this.setAttr,A,P;const R=function(T){let D=k[T],I;k[T]=function(){return P=r(Array.prototype.slice.call(arguments,0)),I=D.apply(k,arguments),k._trace({method:T,args:P}),I}};for(A=0;A<w;A++)R(p[A]);k.setAttr=function(){N.apply(k,arguments);const T=arguments[0];let D=arguments[1];(T==="shadowOffsetX"||T==="shadowOffsetY"||T==="shadowBlur")&&(D=D/this.canvas.getPixelRatio()),k._trace({property:T,val:D})}}_applyGlobalCompositeOperation(k){const w=k.attrs.globalCompositeOperation;!w||w==="source-over"||this.setAttr("globalCompositeOperation",w)}};uc.Context=v,g.forEach(function(E){Object.defineProperty(v.prototype,E,{get(){return this._context[E]},set(k){this._context[E]=k}})});class _ extends v{constructor(k,{willReadFrequently:w=!1}={}){super(k),this._context=k._canvas.getContext("2d",{willReadFrequently:w})}_fillColor(k){const w=k.fill();this.setAttr("fillStyle",w),k._fillFunc(this)}_fillPattern(k){this.setAttr("fillStyle",k._getFillPattern()),k._fillFunc(this)}_fillLinearGradient(k){const w=k._getLinearGradient();w&&(this.setAttr("fillStyle",w),k._fillFunc(this))}_fillRadialGradient(k){const w=k._getRadialGradient();w&&(this.setAttr("fillStyle",w),k._fillFunc(this))}_fill(k){const w=k.fill(),N=k.getFillPriority();if(w&&N==="color"){this._fillColor(k);return}const A=k.getFillPatternImage();if(A&&N==="pattern"){this._fillPattern(k);return}const P=k.getFillLinearGradientColorStops();if(P&&N==="linear-gradient"){this._fillLinearGradient(k);return}const R=k.getFillRadialGradientColorStops();if(R&&N==="radial-gradient"){this._fillRadialGradient(k);return}w?this._fillColor(k):A?this._fillPattern(k):P?this._fillLinearGradient(k):R&&this._fillRadialGradient(k)}_strokeLinearGradient(k){const w=k.getStrokeLinearGradientStartPoint(),N=k.getStrokeLinearGradientEndPoint(),A=k.getStrokeLinearGradientColorStops(),P=this.createLinearGradient(w.x,w.y,N.x,N.y);if(A){for(let R=0;R<A.length;R+=2)P.addColorStop(A[R],A[R+1]);this.setAttr("strokeStyle",P)}}_stroke(k){const w=k.dash(),N=k.getStrokeScaleEnabled();if(k.hasStroke()){if(!N){this.save();const P=this.getCanvas().getPixelRatio();this.setTransform(P,0,0,P,0,0)}this._applyLineCap(k),w&&k.dashEnabled()&&(this.setLineDash(w),this.setAttr("lineDashOffset",k.dashOffset())),this.setAttr("lineWidth",k.strokeWidth()),k.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),k.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(k):this.setAttr("strokeStyle",k.stroke()),k._strokeFunc(this),N||this.restore()}}_applyShadow(k){var w,N,A;const P=(w=k.getShadowRGBA())!==null&&w!==void 0?w:"black",R=(N=k.getShadowBlur())!==null&&N!==void 0?N:5,T=(A=k.getShadowOffset())!==null&&A!==void 0?A:{x:0,y:0},D=k.getAbsoluteScale(),I=this.canvas.getPixelRatio(),V=D.x*I,X=D.y*I;this.setAttr("shadowColor",P),this.setAttr("shadowBlur",R*Math.min(Math.abs(V),Math.abs(X))),this.setAttr("shadowOffsetX",T.x*V),this.setAttr("shadowOffsetY",T.y*X)}}uc.SceneContext=_;class b extends v{constructor(k){super(k),this._context=k._canvas.getContext("2d",{willReadFrequently:!0})}_fill(k){this.save(),this.setAttr("fillStyle",k.colorKey),k._fillFuncHit(this),this.restore()}strokeShape(k){k.hasHitStroke()&&this._stroke(k)}_stroke(k){if(k.hasHitStroke()){const w=k.getStrokeScaleEnabled();if(!w){this.save();const P=this.getCanvas().getPixelRatio();this.setTransform(P,0,0,P,0,0)}this._applyLineCap(k);const N=k.hitStrokeWidth(),A=N==="auto"?k.strokeWidth():N;this.setAttr("lineWidth",A),this.setAttr("strokeStyle",k.colorKey),k._strokeFuncHit(this),w||this.restore()}}}return uc.HitContext=b,uc}var eT;function Ry(){if(eT)return cc;eT=1,Object.defineProperty(cc,"__esModule",{value:!0}),cc.HitCanvas=cc.SceneCanvas=cc.Canvas=void 0;const e=ls(),t=_6(),r=Br();let n;function s(){if(n)return n;const c=e.Util.createCanvasElement(),d=c.getContext("2d");return n=(function(){const f=r.Konva._global.devicePixelRatio||1,p=d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1;return f/p})(),e.Util.releaseCanvas(c),n}let a=class{constructor(d){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const p=(d||{}).pixelRatio||r.Konva.pixelRatio||s();this.pixelRatio=p,this._canvas=e.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(d){const f=this.pixelRatio;this.pixelRatio=d,this.setSize(this.getWidth()/f,this.getHeight()/f)}setWidth(d){this.width=this._canvas.width=d*this.pixelRatio,this._canvas.style.width=d+"px";const f=this.pixelRatio;this.getContext()._context.scale(f,f)}setHeight(d){this.height=this._canvas.height=d*this.pixelRatio,this._canvas.style.height=d+"px";const f=this.pixelRatio;this.getContext()._context.scale(f,f)}getWidth(){return this.width}getHeight(){return this.height}setSize(d,f){this.setWidth(d||0),this.setHeight(f||0)}toDataURL(d,f){try{return this._canvas.toDataURL(d,f)}catch{try{return this._canvas.toDataURL()}catch(g){return e.Util.error("Unable to get data URL. "+g.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};cc.Canvas=a;class i extends a{constructor(d={width:0,height:0,willReadFrequently:!1}){super(d),this.context=new t.SceneContext(this,{willReadFrequently:d.willReadFrequently}),this.setSize(d.width,d.height)}}cc.SceneCanvas=i;class l extends a{constructor(d={width:0,height:0}){super(d),this.hitCanvas=!0,this.context=new t.HitContext(this),this.setSize(d.width,d.height)}}return cc.HitCanvas=l,cc}var cw={},tT;function sb(){return tT||(tT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;const t=Br(),r=ls();e.DD={get isDragging(){let n=!1;return e.DD._dragElements.forEach(s=>{s.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return e.DD._dragElements.forEach(s=>{n=s.node}),n},_dragElements:new Map,_drag(n){const s=[];e.DD._dragElements.forEach((a,i)=>{const{node:l}=a,c=l.getStage();c.setPointersPositions(n),a.pointerId===void 0&&(a.pointerId=r.Util._getFirstPointerId(n));const d=c._changedPointerPositions.find(f=>f.id===a.pointerId);if(d){if(a.dragStatus!=="dragging"){const f=l.dragDistance();if(Math.max(Math.abs(d.x-a.startPointerPos.x),Math.abs(d.y-a.startPointerPos.y))<f||(l.startDrag({evt:n}),!l.isDragging()))return}l._setDragPosition(n,a),s.push(l)}}),s.forEach(a=>{a.fire("dragmove",{type:"dragmove",target:a,evt:n},!0)})},_endDragBefore(n){const s=[];e.DD._dragElements.forEach(a=>{const{node:i}=a,l=i.getStage();if(n&&l.setPointersPositions(n),!l._changedPointerPositions.find(f=>f.id===a.pointerId))return;(a.dragStatus==="dragging"||a.dragStatus==="stopped")&&(e.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,a.dragStatus="stopped");const d=a.node.getLayer()||a.node instanceof t.Konva.Stage&&a.node;d&&s.indexOf(d)===-1&&s.push(d)}),s.forEach(a=>{a.draw()})},_endDragAfter(n){e.DD._dragElements.forEach((s,a)=>{s.dragStatus==="stopped"&&s.node.fire("dragend",{type:"dragend",target:s.node,evt:n},!0),s.dragStatus!=="dragging"&&e.DD._dragElements.delete(a)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("touchcancel",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1),window.addEventListener("touchcancel",e.DD._endDragAfter,!1))})(cw)),cw}var uw={},yi={},rT;function Vr(){if(rT)return yi;rT=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.RGBComponent=n,yi.alphaComponent=s,yi.getNumberValidator=a,yi.getNumberOrArrayOfNumbersValidator=i,yi.getNumberOrAutoValidator=l,yi.getStringValidator=c,yi.getStringOrGradientValidator=d,yi.getFunctionValidator=f,yi.getNumberArrayValidator=p,yi.getBooleanValidator=g,yi.getComponentValidator=y;const e=Br(),t=ls();function r(v){return t.Util._isString(v)?'"'+v+'"':Object.prototype.toString.call(v)==="[object Number]"||t.Util._isBoolean(v)?v:Object.prototype.toString.call(v)}function n(v){return v>255?255:v<0?0:Math.round(v)}function s(v){return v>1?1:v<1e-4?1e-4:v}function a(){if(e.Konva.isUnminified)return function(v,_){return t.Util._isNumber(v)||t.Util.warn(r(v)+' is a not valid value for "'+_+'" attribute. The value should be a number.'),v}}function i(v){if(e.Konva.isUnminified)return function(_,b){let E=t.Util._isNumber(_),k=t.Util._isArray(_)&&_.length==v;return!E&&!k&&t.Util.warn(r(_)+' is a not valid value for "'+b+'" attribute. The value should be a number or Array<number>('+v+")"),_}}function l(){if(e.Konva.isUnminified)return function(v,_){return t.Util._isNumber(v)||v==="auto"||t.Util.warn(r(v)+' is a not valid value for "'+_+'" attribute. The value should be a number or "auto".'),v}}function c(){if(e.Konva.isUnminified)return function(v,_){return t.Util._isString(v)||t.Util.warn(r(v)+' is a not valid value for "'+_+'" attribute. The value should be a string.'),v}}function d(){if(e.Konva.isUnminified)return function(v,_){const b=t.Util._isString(v),E=Object.prototype.toString.call(v)==="[object CanvasGradient]"||v&&v.addColorStop;return b||E||t.Util.warn(r(v)+' is a not valid value for "'+_+'" attribute. The value should be a string or a native gradient.'),v}}function f(){if(e.Konva.isUnminified)return function(v,_){return t.Util._isFunction(v)||t.Util.warn(r(v)+' is a not valid value for "'+_+'" attribute. The value should be a function.'),v}}function p(){if(e.Konva.isUnminified)return function(v,_){const b=Int8Array?Object.getPrototypeOf(Int8Array):null;return b&&v instanceof b||(t.Util._isArray(v)?v.forEach(function(E){t.Util._isNumber(E)||t.Util.warn('"'+_+'" attribute has non numeric element '+E+". Make sure that all elements are numbers.")}):t.Util.warn(r(v)+' is a not valid value for "'+_+'" attribute. The value should be a array of numbers.')),v}}function g(){if(e.Konva.isUnminified)return function(v,_){return v===!0||v===!1||t.Util.warn(r(v)+' is a not valid value for "'+_+'" attribute. The value should be a boolean.'),v}}function y(v){if(e.Konva.isUnminified)return function(_,b){return _==null||t.Util.isObject(_)||t.Util.warn(r(_)+' is a not valid value for "'+b+'" attribute. The value should be an object with properties '+v),_}}return yi}var nT;function Hr(){return nT||(nT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const t=ls(),r=Vr(),n="get",s="set";e.Factory={addGetterSetter(a,i,l,c,d){e.Factory.addGetter(a,i,l),e.Factory.addSetter(a,i,c,d),e.Factory.addOverloadedGetterSetter(a,i)},addGetter(a,i,l){const c=n+t.Util._capitalize(i);a.prototype[c]=a.prototype[c]||function(){const d=this.attrs[i];return d===void 0?l:d}},addSetter(a,i,l,c){const d=s+t.Util._capitalize(i);a.prototype[d]||e.Factory.overWriteSetter(a,i,l,c)},overWriteSetter(a,i,l,c){const d=s+t.Util._capitalize(i);a.prototype[d]=function(f){return l&&f!==void 0&&f!==null&&(f=l.call(this,f,i)),this._setAttr(i,f),c&&c.call(this),this}},addComponentsGetterSetter(a,i,l,c,d){const f=l.length,p=t.Util._capitalize,g=n+p(i),y=s+p(i);a.prototype[g]=function(){const _={};for(let b=0;b<f;b++){const E=l[b];_[E]=this.getAttr(i+p(E))}return _};const v=(0,r.getComponentValidator)(l);a.prototype[y]=function(_){const b=this.attrs[i];c&&(_=c.call(this,_,i)),v&&v.call(this,_,i);for(const E in _)_.hasOwnProperty(E)&&this._setAttr(i+p(E),_[E]);return _||l.forEach(E=>{this._setAttr(i+p(E),void 0)}),this._fireChangeEvent(i,b,_),d&&d.call(this),this},e.Factory.addOverloadedGetterSetter(a,i)},addOverloadedGetterSetter(a,i){const l=t.Util._capitalize(i),c=s+l,d=n+l;a.prototype[i]=function(){return arguments.length?(this[c](arguments[0]),this):this[d]()}},addDeprecatedGetterSetter(a,i,l,c){t.Util.error("Adding deprecated "+i);const d=n+t.Util._capitalize(i),f=i+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[d]=function(){t.Util.error(f);const p=this.attrs[i];return p===void 0?l:p},e.Factory.addSetter(a,i,c,function(){t.Util.error(f)}),e.Factory.addOverloadedGetterSetter(a,i)},backCompat(a,i){t.Util.each(i,function(l,c){const d=a.prototype[c],f=n+t.Util._capitalize(l),p=s+t.Util._capitalize(l);function g(){d.apply(this,arguments),t.Util.error('"'+l+'" method is deprecated and will be removed soon. Use ""'+c+'" instead.')}a.prototype[l]=g,a.prototype[f]=g,a.prototype[p]=g})},afterSetFilter(){this._filterUpToDate=!1}}})(uw)),uw}var sT;function vs(){if(sT)return Eg;sT=1,Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.Node=void 0;const e=Ry(),t=sb(),r=Hr(),n=Br(),s=ls(),a=Vr(),i="absoluteOpacity",l="allEventListeners",c="absoluteTransform",d="absoluteScale",f="canvas",p="Change",g="children",y="konva",v="listening",_="mouseenter",b="mouseleave",E="pointerenter",k="pointerleave",w="touchenter",N="touchleave",A="set",P="Shape",R=" ",T="stage",D="transform",I="Stage",V="visible",X=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(R);let Z=1,ie=class k_{constructor(M){this._id=Z++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(M),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(M){(M===D||M===c)&&this._cache.get(M)?this._cache.get(M).dirty=!0:M?this._cache.delete(M):this._cache.clear()}_getCache(M,W){let L=this._cache.get(M);return(L===void 0||(M===D||M===c)&&L.dirty===!0)&&(L=W.call(this),this._cache.set(M,L)),L}_calculate(M,W,L){if(!this._attachedDepsListeners.get(M)){const H=W.map(K=>K+"Change.konva").join(R);this.on(H,()=>{this._clearCache(M)}),this._attachedDepsListeners.set(M,!0)}return this._getCache(M,L)}_getCanvasCache(){return this._cache.get(f)}_clearSelfAndDescendantCache(M){this._clearCache(M),M===c&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(f)){const{scene:M,filter:W,hit:L,buffer:H}=this._cache.get(f);s.Util.releaseCanvas(M,W,L,H),this._cache.delete(f)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(M){const W=M||{};let L={};(W.x===void 0||W.y===void 0||W.width===void 0||W.height===void 0)&&(L=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let H=Math.ceil(W.width||L.width),K=Math.ceil(W.height||L.height),B=W.pixelRatio,z=W.x===void 0?Math.floor(L.x):W.x,Q=W.y===void 0?Math.floor(L.y):W.y,Y=W.offset||0,te=W.drawBorder||!1,ee=W.hitCanvasPixelRatio||1;if(!H||!K){s.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const ae=Math.abs(Math.round(L.x)-z)>.5?1:0,ge=Math.abs(Math.round(L.y)-Q)>.5?1:0;H+=Y*2+ae,K+=Y*2+ge,z-=Y,Q-=Y;const _e=new e.SceneCanvas({pixelRatio:B,width:H,height:K}),Me=new e.SceneCanvas({pixelRatio:B,width:0,height:0,willReadFrequently:!0}),ue=new e.HitCanvas({pixelRatio:ee,width:H,height:K}),me=_e.getContext(),He=ue.getContext(),qe=new e.SceneCanvas({width:_e.width/_e.pixelRatio+Math.abs(z),height:_e.height/_e.pixelRatio+Math.abs(Q),pixelRatio:_e.pixelRatio}),Xe=qe.getContext();return ue.isCache=!0,_e.isCache=!0,this._cache.delete(f),this._filterUpToDate=!1,W.imageSmoothingEnabled===!1&&(_e.getContext()._context.imageSmoothingEnabled=!1,Me.getContext()._context.imageSmoothingEnabled=!1),me.save(),He.save(),Xe.save(),me.translate(-z,-Q),He.translate(-z,-Q),Xe.translate(-z,-Q),qe.x=z,qe.y=Q,this._isUnderCache=!0,this._clearSelfAndDescendantCache(i),this._clearSelfAndDescendantCache(d),this.drawScene(_e,this,qe),this.drawHit(ue,this),this._isUnderCache=!1,me.restore(),He.restore(),te&&(me.save(),me.beginPath(),me.rect(0,0,H,K),me.closePath(),me.setAttr("strokeStyle","red"),me.setAttr("lineWidth",5),me.stroke(),me.restore()),this._cache.set(f,{scene:_e,filter:Me,hit:ue,buffer:qe,x:z,y:Q}),this._requestDraw(),this}isCached(){return this._cache.has(f)}getClientRect(M){throw new Error('abstract "getClientRect" method call')}_transformedRect(M,W){const L=[{x:M.x,y:M.y},{x:M.x+M.width,y:M.y},{x:M.x+M.width,y:M.y+M.height},{x:M.x,y:M.y+M.height}];let H=1/0,K=1/0,B=-1/0,z=-1/0;const Q=this.getAbsoluteTransform(W);return L.forEach(function(Y){const te=Q.point(Y);H===void 0&&(H=B=te.x,K=z=te.y),H=Math.min(H,te.x),K=Math.min(K,te.y),B=Math.max(B,te.x),z=Math.max(z,te.y)}),{x:H,y:K,width:B-H,height:z-K}}_drawCachedSceneCanvas(M){M.save(),M._applyOpacity(this),M._applyGlobalCompositeOperation(this);const W=this._getCanvasCache();M.translate(W.x,W.y);const L=this._getCachedSceneCanvas(),H=L.pixelRatio;M.drawImage(L._canvas,0,0,L.width/H,L.height/H),M.restore()}_drawCachedHitCanvas(M){const W=this._getCanvasCache(),L=W.hit;M.save(),M.translate(W.x,W.y),M.drawImage(L._canvas,0,0,L.width/L.pixelRatio,L.height/L.pixelRatio),M.restore()}_getCachedSceneCanvas(){let M=this.filters(),W=this._getCanvasCache(),L=W.scene,H=W.filter,K=H.getContext(),B,z,Q,Y;if(M){if(!this._filterUpToDate){const te=L.pixelRatio;H.setSize(L.width/L.pixelRatio,L.height/L.pixelRatio);try{for(B=M.length,K.clear(),K.drawImage(L._canvas,0,0,L.getWidth()/te,L.getHeight()/te),z=K.getImageData(0,0,H.getWidth(),H.getHeight()),Q=0;Q<B;Q++){if(Y=M[Q],typeof Y!="function"){s.Util.error("Filter should be type of function, but got "+typeof Y+" instead. Please check correct filters");continue}Y.call(this,z),K.putImageData(z,0,0)}}catch(ee){s.Util.error("Unable to apply filter. "+ee.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return H}return L}on(M,W){if(this._cache&&this._cache.delete(l),arguments.length===3)return this._delegate.apply(this,arguments);const L=M.split(R);for(let H=0;H<L.length;H++){const B=L[H].split("."),z=B[0],Q=B[1]||"";this.eventListeners[z]||(this.eventListeners[z]=[]),this.eventListeners[z].push({name:Q,handler:W})}return this}off(M,W){let L=(M||"").split(R),H=L.length,K,B,z,Q,Y,te;if(this._cache&&this._cache.delete(l),!M)for(B in this.eventListeners)this._off(B);for(K=0;K<H;K++)if(z=L[K],Q=z.split("."),Y=Q[0],te=Q[1],Y)this.eventListeners[Y]&&this._off(Y,te,W);else for(B in this.eventListeners)this._off(B,te,W);return this}dispatchEvent(M){const W={target:this,type:M.type,evt:M};return this.fire(M.type,W),this}addEventListener(M,W){return this.on(M,function(L){W.call(this,L.evt)}),this}removeEventListener(M){return this.off(M),this}_delegate(M,W,L){const H=this;this.on(M,function(K){const B=K.target.findAncestors(W,!0,H);for(let z=0;z<B.length;z++)K=s.Util.cloneObject(K),K.currentTarget=B[z],L.call(B[z],K)})}remove(){return this.isDragging()&&this.stopDrag(),t.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(i),this._clearSelfAndDescendantCache(d),this._clearSelfAndDescendantCache(T),this._clearSelfAndDescendantCache(V),this._clearSelfAndDescendantCache(v)}_remove(){this._clearCaches();const M=this.getParent();M&&M.children&&(M.children.splice(this.index,1),M._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(M){const W="get"+s.Util._capitalize(M);return s.Util._isFunction(this[W])?this[W]():this.attrs[M]}getAncestors(){let M=this.getParent(),W=[];for(;M;)W.push(M),M=M.getParent();return W}getAttrs(){return this.attrs||{}}setAttrs(M){return this._batchTransformChanges(()=>{let W,L;if(!M)return this;for(W in M)W!==g&&(L=A+s.Util._capitalize(W),s.Util._isFunction(this[L])?this[L](M[W]):this._setAttr(W,M[W]))}),this}isListening(){return this._getCache(v,this._isListening)}_isListening(M){if(!this.listening())return!1;const L=this.getParent();return L&&L!==M&&this!==M?L._isListening(M):!0}isVisible(){return this._getCache(V,this._isVisible)}_isVisible(M){if(!this.visible())return!1;const L=this.getParent();return L&&L!==M&&this!==M?L._isVisible(M):!0}shouldDrawHit(M,W=!1){if(M)return this._isVisible(M)&&this._isListening(M);const L=this.getLayer();let H=!1;t.DD._dragElements.forEach(B=>{B.dragStatus==="dragging"&&(B.node.nodeType==="Stage"||B.node.getLayer()===L)&&(H=!0)});const K=!W&&!n.Konva.hitOnDragEnabled&&(H||n.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!K}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let M=this.getDepth(),W=this,L=0,H,K,B,z;function Q(te){for(H=[],K=te.length,B=0;B<K;B++)z=te[B],L++,z.nodeType!==P&&(H=H.concat(z.getChildren().slice())),z._id===W._id&&(B=K);H.length>0&&H[0].getDepth()<=M&&Q(H)}const Y=this.getStage();return W.nodeType!==I&&Y&&Q(Y.getChildren()),L}getDepth(){let M=0,W=this.parent;for(;W;)M++,W=W.parent;return M}_batchTransformChanges(M){this._batchingTransformChange=!0,M(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(D),this._clearSelfAndDescendantCache(c)),this._needClearTransformCache=!1}setPosition(M){return this._batchTransformChanges(()=>{this.x(M.x),this.y(M.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const M=this.getStage();if(!M)return null;const W=M.getPointerPosition();if(!W)return null;const L=this.getAbsoluteTransform().copy();return L.invert(),L.point(W)}getAbsolutePosition(M){let W=!1,L=this.parent;for(;L;){if(L.isCached()){W=!0;break}L=L.parent}W&&!M&&(M=!0);const H=this.getAbsoluteTransform(M).getMatrix(),K=new s.Transform,B=this.offset();return K.m=H.slice(),K.translate(B.x,B.y),K.getTranslation()}setAbsolutePosition(M){const{x:W,y:L,...H}=this._clearTransform();this.attrs.x=W,this.attrs.y=L,this._clearCache(D);const K=this._getAbsoluteTransform().copy();return K.invert(),K.translate(M.x,M.y),M={x:this.attrs.x+K.getTranslation().x,y:this.attrs.y+K.getTranslation().y},this._setTransform(H),this.setPosition({x:M.x,y:M.y}),this._clearCache(D),this._clearSelfAndDescendantCache(c),this}_setTransform(M){let W;for(W in M)this.attrs[W]=M[W]}_clearTransform(){const M={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,M}move(M){let W=M.x,L=M.y,H=this.x(),K=this.y();return W!==void 0&&(H+=W),L!==void 0&&(K+=L),this.setPosition({x:H,y:K}),this}_eachAncestorReverse(M,W){let L=[],H=this.getParent(),K,B;if(!(W&&W._id===this._id)){for(L.unshift(this);H&&(!W||H._id!==W._id);)L.unshift(H),H=H.parent;for(K=L.length,B=0;B<K;B++)M(L[B])}}rotate(M){return this.rotation(this.rotation()+M),this}moveToTop(){if(!this.parent)return s.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const M=this.index,W=this.parent.getChildren().length;return M<W-1?(this.parent.children.splice(M,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return s.Util.warn("Node has no parent. moveUp function is ignored."),!1;const M=this.index,W=this.parent.getChildren().length;return M<W-1?(this.parent.children.splice(M,1),this.parent.children.splice(M+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return s.Util.warn("Node has no parent. moveDown function is ignored."),!1;const M=this.index;return M>0?(this.parent.children.splice(M,1),this.parent.children.splice(M-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return s.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const M=this.index;return M>0?(this.parent.children.splice(M,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(M){if(!this.parent)return s.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(M<0||M>=this.parent.children.length)&&s.Util.warn("Unexpected value "+M+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const W=this.index;return this.parent.children.splice(W,1),this.parent.children.splice(M,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(i,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let M=this.opacity();const W=this.getParent();return W&&!W._isUnderCache&&(M*=W.getAbsoluteOpacity()),M}moveTo(M){return this.getParent()!==M&&(this._remove(),M.add(this)),this}toObject(){let M=this.getAttrs(),W,L,H,K,B;const z={attrs:{},className:this.getClassName()};for(W in M)L=M[W],B=s.Util.isObject(L)&&!s.Util._isPlainObject(L)&&!s.Util._isArray(L),!B&&(H=typeof this[W]=="function"&&this[W],delete M[W],K=H?H.call(this):null,M[W]=L,K!==L&&(z.attrs[W]=L));return s.Util._prepareToStringify(z)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(M,W,L){const H=[];W&&this._isMatch(M)&&H.push(this);let K=this.parent;for(;K;){if(K===L)return H;K._isMatch(M)&&H.push(K),K=K.parent}return H}isAncestorOf(M){return!1}findAncestor(M,W,L){return this.findAncestors(M,W,L)[0]}_isMatch(M){if(!M)return!1;if(typeof M=="function")return M(this);let W=M.replace(/ /g,"").split(","),L=W.length,H,K;for(H=0;H<L;H++)if(K=W[H],s.Util.isValidSelector(K)||(s.Util.warn('Selector "'+K+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),s.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),s.Util.warn("Konva is awesome, right?")),K.charAt(0)==="#"){if(this.id()===K.slice(1))return!0}else if(K.charAt(0)==="."){if(this.hasName(K.slice(1)))return!0}else if(this.className===K||this.nodeType===K)return!0;return!1}getLayer(){const M=this.getParent();return M?M.getLayer():null}getStage(){return this._getCache(T,this._getStage)}_getStage(){const M=this.getParent();return M?M.getStage():null}fire(M,W={},L){return W.target=W.target||this,L?this._fireAndBubble(M,W):this._fire(M,W),this}getAbsoluteTransform(M){return M?this._getAbsoluteTransform(M):this._getCache(c,this._getAbsoluteTransform)}_getAbsoluteTransform(M){let W;if(M)return W=new s.Transform,this._eachAncestorReverse(function(L){const H=L.transformsEnabled();H==="all"?W.multiply(L.getTransform()):H==="position"&&W.translate(L.x()-L.offsetX(),L.y()-L.offsetY())},M),W;{W=this._cache.get(c)||new s.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(W):W.reset();const L=this.transformsEnabled();if(L==="all")W.multiply(this.getTransform());else if(L==="position"){const H=this.attrs.x||0,K=this.attrs.y||0,B=this.attrs.offsetX||0,z=this.attrs.offsetY||0;W.translate(H-B,K-z)}return W.dirty=!1,W}}getAbsoluteScale(M){let W=this;for(;W;)W._isUnderCache&&(M=W),W=W.getParent();const H=this.getAbsoluteTransform(M).decompose();return{x:H.scaleX,y:H.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(D,this._getTransform)}_getTransform(){var M,W;const L=this._cache.get(D)||new s.Transform;L.reset();const H=this.x(),K=this.y(),B=n.Konva.getAngle(this.rotation()),z=(M=this.attrs.scaleX)!==null&&M!==void 0?M:1,Q=(W=this.attrs.scaleY)!==null&&W!==void 0?W:1,Y=this.attrs.skewX||0,te=this.attrs.skewY||0,ee=this.attrs.offsetX||0,ae=this.attrs.offsetY||0;return(H!==0||K!==0)&&L.translate(H,K),B!==0&&L.rotate(B),(Y!==0||te!==0)&&L.skew(Y,te),(z!==1||Q!==1)&&L.scale(z,Q),(ee!==0||ae!==0)&&L.translate(-1*ee,-1*ae),L.dirty=!1,L}clone(M){let W=s.Util.cloneObject(this.attrs),L,H,K,B,z;for(L in M)W[L]=M[L];const Q=new this.constructor(W);for(L in this.eventListeners)for(H=this.eventListeners[L],K=H.length,B=0;B<K;B++)z=H[B],z.name.indexOf(y)<0&&(Q.eventListeners[L]||(Q.eventListeners[L]=[]),Q.eventListeners[L].push(z));return Q}_toKonvaCanvas(M){M=M||{};const W=this.getClientRect(),L=this.getStage(),H=M.x!==void 0?M.x:Math.floor(W.x),K=M.y!==void 0?M.y:Math.floor(W.y),B=M.pixelRatio||1,z=new e.SceneCanvas({width:M.width||Math.ceil(W.width)||(L?L.width():0),height:M.height||Math.ceil(W.height)||(L?L.height():0),pixelRatio:B}),Q=z.getContext(),Y=new e.SceneCanvas({width:z.width/z.pixelRatio+Math.abs(H),height:z.height/z.pixelRatio+Math.abs(K),pixelRatio:z.pixelRatio});return M.imageSmoothingEnabled===!1&&(Q._context.imageSmoothingEnabled=!1),Q.save(),(H||K)&&Q.translate(-1*H,-1*K),this.drawScene(z,void 0,Y),Q.restore(),z}toCanvas(M){return this._toKonvaCanvas(M)._canvas}toDataURL(M){M=M||{};const W=M.mimeType||null,L=M.quality||null,H=this._toKonvaCanvas(M).toDataURL(W,L);return M.callback&&M.callback(H),H}toImage(M){return new Promise((W,L)=>{try{const H=M?.callback;H&&delete M.callback,s.Util._urlToImage(this.toDataURL(M),function(K){W(K),H?.(K)})}catch(H){L(H)}})}toBlob(M){return new Promise((W,L)=>{try{const H=M?.callback;H&&delete M.callback,this.toCanvas(M).toBlob(K=>{W(K),H?.(K)},M?.mimeType,M?.quality)}catch(H){L(H)}})}setSize(M){return this.width(M.width),this.height(M.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.Konva.dragDistance}_off(M,W,L){let H=this.eventListeners[M],K,B,z;for(K=0;K<H.length;K++)if(B=H[K].name,z=H[K].handler,(B!=="konva"||W==="konva")&&(!W||B===W)&&(!L||L===z)){if(H.splice(K,1),H.length===0){delete this.eventListeners[M];break}K--}}_fireChangeEvent(M,W,L){this._fire(M+p,{oldVal:W,newVal:L})}addName(M){if(!this.hasName(M)){const W=this.name(),L=W?W+" "+M:M;this.name(L)}return this}hasName(M){if(!M)return!1;const W=this.name();return W?(W||"").split(/\s/g).indexOf(M)!==-1:!1}removeName(M){const W=(this.name()||"").split(/\s/g),L=W.indexOf(M);return L!==-1&&(W.splice(L,1),this.name(W.join(" "))),this}setAttr(M,W){const L=this[A+s.Util._capitalize(M)];return s.Util._isFunction(L)?L.call(this,W):this._setAttr(M,W),this}_requestDraw(){if(n.Konva.autoDrawEnabled){const M=this.getLayer()||this.getStage();M?.batchDraw()}}_setAttr(M,W){const L=this.attrs[M];L===W&&!s.Util.isObject(W)||(W==null?delete this.attrs[M]:this.attrs[M]=W,this._shouldFireChangeEvents&&this._fireChangeEvent(M,L,W),this._requestDraw())}_setComponentAttr(M,W,L){let H;L!==void 0&&(H=this.attrs[M],H||(this.attrs[M]=this.getAttr(M)),this.attrs[M][W]=L,this._fireChangeEvent(M,H,L))}_fireAndBubble(M,W,L){W&&this.nodeType===P&&(W.target=this);const H=[_,b,E,k,w,N];if(!(H.indexOf(M)!==-1&&(L&&(this===L||this.isAncestorOf&&this.isAncestorOf(L))||this.nodeType==="Stage"&&!L))){this._fire(M,W);const B=H.indexOf(M)!==-1&&L&&L.isAncestorOf&&L.isAncestorOf(this)&&!L.isAncestorOf(this.parent);(W&&!W.cancelBubble||!W)&&this.parent&&this.parent.isListening()&&!B&&(L&&L.parent?this._fireAndBubble.call(this.parent,M,W,L):this._fireAndBubble.call(this.parent,M,W))}}_getProtoListeners(M){var W,L,H;const K=(W=this._cache.get(l))!==null&&W!==void 0?W:{};let B=K?.[M];if(B===void 0){B=[];let z=Object.getPrototypeOf(this);for(;z;){const Q=(H=(L=z.eventListeners)===null||L===void 0?void 0:L[M])!==null&&H!==void 0?H:[];B.push(...Q),z=Object.getPrototypeOf(z)}K[M]=B,this._cache.set(l,K)}return B}_fire(M,W){W=W||{},W.currentTarget=this,W.type=M;const L=this._getProtoListeners(M);if(L)for(let K=0;K<L.length;K++)L[K].handler.call(this,W);const H=this.eventListeners[M];if(H)for(let K=0;K<H.length;K++)H[K].handler.call(this,W)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(M){const W=M?M.pointerId:void 0,L=this.getStage(),H=this.getAbsolutePosition();if(!L)return;const K=L._getPointerById(W)||L._changedPointerPositions[0]||H;t.DD._dragElements.set(this._id,{node:this,startPointerPos:K,offset:{x:K.x-H.x,y:K.y-H.y},dragStatus:"ready",pointerId:W})}startDrag(M,W=!0){t.DD._dragElements.has(this._id)||this._createDragElement(M);const L=t.DD._dragElements.get(this._id);L.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:M&&M.evt},W)}_setDragPosition(M,W){const L=this.getStage()._getPointerById(W.pointerId);if(!L)return;let H={x:L.x-W.offset.x,y:L.y-W.offset.y};const K=this.dragBoundFunc();if(K!==void 0){const B=K.call(this,H,M);B?H=B:s.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==H.x||this._lastPos.y!==H.y)&&(this.setAbsolutePosition(H),this._requestDraw()),this._lastPos=H}stopDrag(M){const W=t.DD._dragElements.get(this._id);W&&(W.dragStatus="stopped"),t.DD._endDragBefore(M),t.DD._endDragAfter(M)}setDraggable(M){this._setAttr("draggable",M),this._dragChange()}isDragging(){const M=t.DD._dragElements.get(this._id);return M?M.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(M){if(!(!(M.evt.button!==void 0)||n.Konva.dragButtons.indexOf(M.evt.button)>=0)||this.isDragging())return;let H=!1;t.DD._dragElements.forEach(K=>{this.isAncestorOf(K.node)&&(H=!0)}),H||this._createDragElement(M)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const W=t.DD._dragElements.get(this._id),L=W&&W.dragStatus==="dragging",H=W&&W.dragStatus==="ready";L?this.stopDrag():H&&t.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(M={x:0,y:0}){const W=this.getStage();if(!W)return!1;const L={x:-M.x,y:-M.y,width:W.width()+2*M.x,height:W.height()+2*M.y};return s.Util.haveIntersection(L,this.getClientRect())}static create(M,W){return s.Util._isString(M)&&(M=JSON.parse(M)),this._createNode(M,W)}static _createNode(M,W){let L=k_.prototype.getClassName.call(M),H=M.children,K,B,z;W&&(M.attrs.container=W),n.Konva[L]||(s.Util.warn('Can not find a node with class name "'+L+'". Fallback to "Shape".'),L="Shape");const Q=n.Konva[L];if(K=new Q(M.attrs),H)for(B=H.length,z=0;z<B;z++)K.add(k_._createNode(H[z]));return K}};Eg.Node=ie,ie.prototype.nodeType="Node",ie.prototype._attrsAffectingSize=[],ie.prototype.eventListeners={},ie.prototype.on.call(ie.prototype,X,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(D),this._clearSelfAndDescendantCache(c)}),ie.prototype.on.call(ie.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(V)}),ie.prototype.on.call(ie.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(v)}),ie.prototype.on.call(ie.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(i)});const q=r.Factory.addGetterSetter;return q(ie,"zIndex"),q(ie,"absolutePosition"),q(ie,"position"),q(ie,"x",0,(0,a.getNumberValidator)()),q(ie,"y",0,(0,a.getNumberValidator)()),q(ie,"globalCompositeOperation","source-over",(0,a.getStringValidator)()),q(ie,"opacity",1,(0,a.getNumberValidator)()),q(ie,"name","",(0,a.getStringValidator)()),q(ie,"id","",(0,a.getStringValidator)()),q(ie,"rotation",0,(0,a.getNumberValidator)()),r.Factory.addComponentsGetterSetter(ie,"scale",["x","y"]),q(ie,"scaleX",1,(0,a.getNumberValidator)()),q(ie,"scaleY",1,(0,a.getNumberValidator)()),r.Factory.addComponentsGetterSetter(ie,"skew",["x","y"]),q(ie,"skewX",0,(0,a.getNumberValidator)()),q(ie,"skewY",0,(0,a.getNumberValidator)()),r.Factory.addComponentsGetterSetter(ie,"offset",["x","y"]),q(ie,"offsetX",0,(0,a.getNumberValidator)()),q(ie,"offsetY",0,(0,a.getNumberValidator)()),q(ie,"dragDistance",void 0,(0,a.getNumberValidator)()),q(ie,"width",0,(0,a.getNumberValidator)()),q(ie,"height",0,(0,a.getNumberValidator)()),q(ie,"listening",!0,(0,a.getBooleanValidator)()),q(ie,"preventDefault",!0,(0,a.getBooleanValidator)()),q(ie,"filters",void 0,function(ne){return this._filterUpToDate=!1,ne}),q(ie,"visible",!0,(0,a.getBooleanValidator)()),q(ie,"transformsEnabled","all",(0,a.getStringValidator)()),q(ie,"size"),q(ie,"dragBoundFunc"),q(ie,"draggable",!1,(0,a.getBooleanValidator)()),r.Factory.backCompat(ie,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Eg}var Ng={},aT;function Dy(){if(aT)return Ng;aT=1,Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.Container=void 0;const e=Hr(),t=vs(),r=Vr();let n=class extends t.Node{constructor(){super(...arguments),this.children=[]}getChildren(a){const i=this.children||[];return a?i.filter(a):i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.destroy()}),this.children=[],this._requestDraw(),this}add(...a){if(a.length===0)return this;if(a.length>1){for(let l=0;l<a.length;l++)this.add(a[l]);return this}const i=a[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(a){return this._generalFind(a,!1)}findOne(a){const i=this._generalFind(a,!0);return i.length>0?i[0]:void 0}_generalFind(a,i){const l=[];return this._descendants(c=>{const d=c._isMatch(a);return d&&l.push(c),!!(d&&i)}),l}_descendants(a){let i=!1;const l=this.getChildren();for(const c of l){if(i=a(c),i)return!0;if(c.hasChildren()&&(i=c._descendants(a),i))return!0}return!1}toObject(){const a=t.Node.prototype.toObject.call(this);return a.children=[],this.getChildren().forEach(i=>{a.children.push(i.toObject())}),a}isAncestorOf(a){let i=a.getParent();for(;i;){if(i._id===this._id)return!0;i=i.getParent()}return!1}clone(a){const i=t.Node.prototype.clone.call(this,a);return this.getChildren().forEach(function(l){i.add(l.clone())}),i}getAllIntersections(a){const i=[];return this.find("Shape").forEach(l=>{l.isVisible()&&l.intersects(a)&&i.push(l)}),i}_clearSelfAndDescendantCache(a){var i;super._clearSelfAndDescendantCache(a),!this.isCached()&&((i=this.children)===null||i===void 0||i.forEach(function(l){l._clearSelfAndDescendantCache(a)}))}_setChildrenIndices(){var a;(a=this.children)===null||a===void 0||a.forEach(function(i,l){i.index=l}),this._requestDraw()}drawScene(a,i,l){const c=this.getLayer(),d=a||c&&c.getCanvas(),f=d&&d.getContext(),p=this._getCanvasCache(),g=p&&p.scene,y=d&&d.isCache;if(!this.isVisible()&&!y)return this;if(g){f.save();const v=this.getAbsoluteTransform(i).getMatrix();f.transform(v[0],v[1],v[2],v[3],v[4],v[5]),this._drawCachedSceneCanvas(f),f.restore()}else this._drawChildren("drawScene",d,i,l);return this}drawHit(a,i){if(!this.shouldDrawHit(i))return this;const l=this.getLayer(),c=a||l&&l.hitCanvas,d=c&&c.getContext(),f=this._getCanvasCache();if(f&&f.hit){d.save();const g=this.getAbsoluteTransform(i).getMatrix();d.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._drawCachedHitCanvas(d),d.restore()}else this._drawChildren("drawHit",c,i);return this}_drawChildren(a,i,l,c){var d;const f=i&&i.getContext(),p=this.clipWidth(),g=this.clipHeight(),y=this.clipFunc(),v=typeof p=="number"&&typeof g=="number"||y,_=l===this;if(v){f.save();const E=this.getAbsoluteTransform(l);let k=E.getMatrix();f.transform(k[0],k[1],k[2],k[3],k[4],k[5]),f.beginPath();let w;if(y)w=y.call(this,f,this);else{const N=this.clipX(),A=this.clipY();f.rect(N||0,A||0,p,g)}f.clip.apply(f,w),k=E.copy().invert().getMatrix(),f.transform(k[0],k[1],k[2],k[3],k[4],k[5])}const b=!_&&this.globalCompositeOperation()!=="source-over"&&a==="drawScene";b&&(f.save(),f._applyGlobalCompositeOperation(this)),(d=this.children)===null||d===void 0||d.forEach(function(E){E[a](i,l,c)}),b&&f.restore(),v&&f.restore()}getClientRect(a={}){var i;const l=a.skipTransform,c=a.relativeTo;let d,f,p,g,y={x:1/0,y:1/0,width:0,height:0};const v=this;(i=this.children)===null||i===void 0||i.forEach(function(E){if(!E.visible())return;const k=E.getClientRect({relativeTo:v,skipShadow:a.skipShadow,skipStroke:a.skipStroke});k.width===0&&k.height===0||(d===void 0?(d=k.x,f=k.y,p=k.x+k.width,g=k.y+k.height):(d=Math.min(d,k.x),f=Math.min(f,k.y),p=Math.max(p,k.x+k.width),g=Math.max(g,k.y+k.height)))});const _=this.find("Shape");let b=!1;for(let E=0;E<_.length;E++)if(_[E]._isVisible(this)){b=!0;break}return b&&d!==void 0?y={x:d,y:f,width:p-d,height:g-f}:y={x:0,y:0,width:0,height:0},l?y:this._transformedRect(y,c)}};return Ng.Container=n,e.Factory.addComponentsGetterSetter(n,"clip",["x","y","width","height"]),e.Factory.addGetterSetter(n,"clipX",void 0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(n,"clipY",void 0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(n,"clipWidth",void 0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(n,"clipHeight",void 0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(n,"clipFunc"),Ng}var dw={},vu={},iT;function b6(){if(iT)return vu;iT=1,Object.defineProperty(vu,"__esModule",{value:!0}),vu.getCapturedShape=n,vu.createEvent=s,vu.hasPointerCapture=a,vu.setPointerCapture=i,vu.releaseCapture=l;const e=Br(),t=new Map,r=e.Konva._global.PointerEvent!==void 0;function n(c){return t.get(c)}function s(c){return{evt:c,pointerId:c.pointerId}}function a(c,d){return t.get(c)===d}function i(c,d){l(c),d.getStage()&&(t.set(c,d),r&&d._fire("gotpointercapture",s(new PointerEvent("gotpointercapture"))))}function l(c,d){const f=t.get(c);if(!f)return;const p=f.getStage();p&&p.content,t.delete(c),r&&f._fire("lostpointercapture",s(new PointerEvent("lostpointercapture")))}return vu}var oT;function pM(){return oT||(oT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stage=e.stages=void 0;const t=ls(),r=Hr(),n=Dy(),s=Br(),a=Ry(),i=sb(),l=Br(),c=b6(),d="Stage",f="string",p="px",g="mouseout",y="mouseleave",v="mouseover",_="mouseenter",b="mousemove",E="mousedown",k="mouseup",w="pointermove",N="pointerdown",A="pointerup",P="pointercancel",R="lostpointercapture",T="pointerout",D="pointerleave",I="pointerover",V="pointerenter",X="contextmenu",Z="touchstart",ie="touchend",q="touchmove",ne="touchcancel",M="wheel",W=5,L=[[_,"_pointerenter"],[E,"_pointerdown"],[b,"_pointermove"],[k,"_pointerup"],[y,"_pointerleave"],[Z,"_pointerdown"],[q,"_pointermove"],[ie,"_pointerup"],[ne,"_pointercancel"],[v,"_pointerover"],[M,"_wheel"],[X,"_contextmenu"],[N,"_pointerdown"],[w,"_pointermove"],[A,"_pointerup"],[P,"_pointercancel"],[D,"_pointerleave"],[R,"_lostpointercapture"]],H={mouse:{[T]:g,[D]:y,[I]:v,[V]:_,[w]:b,[N]:E,[A]:k,[P]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[T]:"touchout",[D]:"touchleave",[I]:"touchover",[V]:"touchenter",[w]:q,[N]:Z,[A]:ie,[P]:ne,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[T]:T,[D]:D,[I]:I,[V]:V,[w]:w,[N]:N,[A]:A,[P]:P,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},K=te=>te.indexOf("pointer")>=0?"pointer":te.indexOf("touch")>=0?"touch":"mouse",B=te=>{const ee=K(te);if(ee==="pointer")return s.Konva.pointerEventsEnabled&&H.pointer;if(ee==="touch")return H.touch;if(ee==="mouse")return H.mouse};function z(te={}){return(te.clipFunc||te.clipWidth||te.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),te}const Q="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";e.stages=[];class Y extends n.Container{constructor(ee){super(z(ee)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),e.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{z(this.attrs)}),this._checkVisibility()}_validateAdd(ee){const ae=ee.getType()==="Layer",ge=ee.getType()==="FastLayer";ae||ge||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const ee=this.visible()?"":"none";this.content.style.display=ee}setContainer(ee){if(typeof ee===f){let ae;if(ee.charAt(0)==="."){const ge=ee.slice(1);ee=document.getElementsByClassName(ge)[0]}else ee.charAt(0)!=="#"?ae=ee:ae=ee.slice(1),ee=document.getElementById(ae);if(!ee)throw"Can not find container in document with id "+ae}return this._setAttr("container",ee),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),ee.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const ee=this.children,ae=ee.length;for(let ge=0;ge<ae;ge++)ee[ge].clear();return this}clone(ee){return ee||(ee={}),ee.container=typeof document<"u"&&document.createElement("div"),n.Container.prototype.clone.call(this,ee)}destroy(){super.destroy();const ee=this.content;ee&&t.Util._isInDocument(ee)&&this.container().removeChild(ee);const ae=e.stages.indexOf(this);return ae>-1&&e.stages.splice(ae,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const ee=this._pointerPositions[0]||this._changedPointerPositions[0];return ee?{x:ee.x,y:ee.y}:(t.Util.warn(Q),null)}_getPointerById(ee){return this._pointerPositions.find(ae=>ae.id===ee)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(ee){ee=ee||{},ee.x=ee.x||0,ee.y=ee.y||0,ee.width=ee.width||this.width(),ee.height=ee.height||this.height();const ae=new a.SceneCanvas({width:ee.width,height:ee.height,pixelRatio:ee.pixelRatio||1}),ge=ae.getContext()._context,_e=this.children;return(ee.x||ee.y)&&ge.translate(-1*ee.x,-1*ee.y),_e.forEach(function(Me){if(!Me.isVisible())return;const ue=Me._toKonvaCanvas(ee);ge.drawImage(ue._canvas,ee.x,ee.y,ue.getWidth()/ue.getPixelRatio(),ue.getHeight()/ue.getPixelRatio())}),ae}getIntersection(ee){if(!ee)return null;const ae=this.children,ge=ae.length,_e=ge-1;for(let Me=_e;Me>=0;Me--){const ue=ae[Me].getIntersection(ee);if(ue)return ue}return null}_resizeDOM(){const ee=this.width(),ae=this.height();this.content&&(this.content.style.width=ee+p,this.content.style.height=ae+p),this.bufferCanvas.setSize(ee,ae),this.bufferHitCanvas.setSize(ee,ae),this.children.forEach(ge=>{ge.setSize({width:ee,height:ae}),ge.draw()})}add(ee,...ae){if(arguments.length>1){for(let _e=0;_e<arguments.length;_e++)this.add(arguments[_e]);return this}super.add(ee);const ge=this.children.length;return ge>W&&t.Util.warn("The stage has "+ge+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),ee.setSize({width:this.width(),height:this.height()}),ee.draw(),s.Konva.isBrowser&&this.content.appendChild(ee.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(ee){return c.hasPointerCapture(ee,this)}setPointerCapture(ee){c.setPointerCapture(ee,this)}releaseCapture(ee){c.releaseCapture(ee,this)}getLayers(){return this.children}_bindContentEvents(){s.Konva.isBrowser&&L.forEach(([ee,ae])=>{this.content.addEventListener(ee,ge=>{this[ae](ge)},{passive:!1})})}_pointerenter(ee){this.setPointersPositions(ee);const ae=B(ee.type);ae&&this._fire(ae.pointerenter,{evt:ee,target:this,currentTarget:this})}_pointerover(ee){this.setPointersPositions(ee);const ae=B(ee.type);ae&&this._fire(ae.pointerover,{evt:ee,target:this,currentTarget:this})}_getTargetShape(ee){let ae=this[ee+"targetShape"];return ae&&!ae.getStage()&&(ae=null),ae}_pointerleave(ee){const ae=B(ee.type),ge=K(ee.type);if(!ae)return;this.setPointersPositions(ee);const _e=this._getTargetShape(ge),Me=!(s.Konva.isDragging()||s.Konva.isTransforming())||s.Konva.hitOnDragEnabled;_e&&Me?(_e._fireAndBubble(ae.pointerout,{evt:ee}),_e._fireAndBubble(ae.pointerleave,{evt:ee}),this._fire(ae.pointerleave,{evt:ee,target:this,currentTarget:this}),this[ge+"targetShape"]=null):Me&&(this._fire(ae.pointerleave,{evt:ee,target:this,currentTarget:this}),this._fire(ae.pointerout,{evt:ee,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(ee){const ae=B(ee.type),ge=K(ee.type);if(!ae)return;this.setPointersPositions(ee);let _e=!1;this._changedPointerPositions.forEach(Me=>{const ue=this.getIntersection(Me);if(i.DD.justDragged=!1,s.Konva["_"+ge+"ListenClick"]=!0,!ue||!ue.isListening()){this[ge+"ClickStartShape"]=void 0;return}s.Konva.capturePointerEventsEnabled&&ue.setPointerCapture(Me.id),this[ge+"ClickStartShape"]=ue,ue._fireAndBubble(ae.pointerdown,{evt:ee,pointerId:Me.id}),_e=!0;const me=ee.type.indexOf("touch")>=0;ue.preventDefault()&&ee.cancelable&&me&&ee.preventDefault()}),_e||this._fire(ae.pointerdown,{evt:ee,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(ee){const ae=B(ee.type),ge=K(ee.type);if(!ae||(s.Konva.isDragging()&&i.DD.node.preventDefault()&&ee.cancelable&&ee.preventDefault(),this.setPointersPositions(ee),!(!(s.Konva.isDragging()||s.Konva.isTransforming())||s.Konva.hitOnDragEnabled)))return;const Me={};let ue=!1;const me=this._getTargetShape(ge);this._changedPointerPositions.forEach(He=>{const qe=c.getCapturedShape(He.id)||this.getIntersection(He),Xe=He.id,Ve={evt:ee,pointerId:Xe},It=me!==qe;if(It&&me&&(me._fireAndBubble(ae.pointerout,{...Ve},qe),me._fireAndBubble(ae.pointerleave,{...Ve},qe)),qe){if(Me[qe._id])return;Me[qe._id]=!0}qe&&qe.isListening()?(ue=!0,It&&(qe._fireAndBubble(ae.pointerover,{...Ve},me),qe._fireAndBubble(ae.pointerenter,{...Ve},me),this[ge+"targetShape"]=qe),qe._fireAndBubble(ae.pointermove,{...Ve})):me&&(this._fire(ae.pointerover,{evt:ee,target:this,currentTarget:this,pointerId:Xe}),this[ge+"targetShape"]=null)}),ue||this._fire(ae.pointermove,{evt:ee,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(ee){const ae=B(ee.type),ge=K(ee.type);if(!ae)return;this.setPointersPositions(ee);const _e=this[ge+"ClickStartShape"],Me=this[ge+"ClickEndShape"],ue={};let me=!1;this._changedPointerPositions.forEach(He=>{const qe=c.getCapturedShape(He.id)||this.getIntersection(He);if(qe){if(qe.releaseCapture(He.id),ue[qe._id])return;ue[qe._id]=!0}const Xe=He.id,Ve={evt:ee,pointerId:Xe};let It=!1;s.Konva["_"+ge+"InDblClickWindow"]?(It=!0,clearTimeout(this[ge+"DblTimeout"])):i.DD.justDragged||(s.Konva["_"+ge+"InDblClickWindow"]=!0,clearTimeout(this[ge+"DblTimeout"])),this[ge+"DblTimeout"]=setTimeout(function(){s.Konva["_"+ge+"InDblClickWindow"]=!1},s.Konva.dblClickWindow),qe&&qe.isListening()?(me=!0,this[ge+"ClickEndShape"]=qe,qe._fireAndBubble(ae.pointerup,{...Ve}),s.Konva["_"+ge+"ListenClick"]&&_e&&_e===qe&&(qe._fireAndBubble(ae.pointerclick,{...Ve}),It&&Me&&Me===qe&&qe._fireAndBubble(ae.pointerdblclick,{...Ve}))):(this[ge+"ClickEndShape"]=null,s.Konva["_"+ge+"ListenClick"]&&this._fire(ae.pointerclick,{evt:ee,target:this,currentTarget:this,pointerId:Xe}),It&&this._fire(ae.pointerdblclick,{evt:ee,target:this,currentTarget:this,pointerId:Xe}))}),me||this._fire(ae.pointerup,{evt:ee,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),s.Konva["_"+ge+"ListenClick"]=!1,ee.cancelable&&ge!=="touch"&&ge!=="pointer"&&ee.preventDefault()}_contextmenu(ee){this.setPointersPositions(ee);const ae=this.getIntersection(this.getPointerPosition());ae&&ae.isListening()?ae._fireAndBubble(X,{evt:ee}):this._fire(X,{evt:ee,target:this,currentTarget:this})}_wheel(ee){this.setPointersPositions(ee);const ae=this.getIntersection(this.getPointerPosition());ae&&ae.isListening()?ae._fireAndBubble(M,{evt:ee}):this._fire(M,{evt:ee,target:this,currentTarget:this})}_pointercancel(ee){this.setPointersPositions(ee);const ae=c.getCapturedShape(ee.pointerId)||this.getIntersection(this.getPointerPosition());ae&&ae._fireAndBubble(A,c.createEvent(ee)),c.releaseCapture(ee.pointerId)}_lostpointercapture(ee){c.releaseCapture(ee.pointerId)}setPointersPositions(ee){const ae=this._getContentPosition();let ge=null,_e=null;ee=ee||window.event,ee.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(ee.touches,Me=>{this._pointerPositions.push({id:Me.identifier,x:(Me.clientX-ae.left)/ae.scaleX,y:(Me.clientY-ae.top)/ae.scaleY})}),Array.prototype.forEach.call(ee.changedTouches||ee.touches,Me=>{this._changedPointerPositions.push({id:Me.identifier,x:(Me.clientX-ae.left)/ae.scaleX,y:(Me.clientY-ae.top)/ae.scaleY})})):(ge=(ee.clientX-ae.left)/ae.scaleX,_e=(ee.clientY-ae.top)/ae.scaleY,this.pointerPos={x:ge,y:_e},this._pointerPositions=[{x:ge,y:_e,id:t.Util._getFirstPointerId(ee)}],this._changedPointerPositions=[{x:ge,y:_e,id:t.Util._getFirstPointerId(ee)}])}_setPointerPosition(ee){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(ee)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const ee=this.content.getBoundingClientRect();return{top:ee.top,left:ee.left,scaleX:ee.width/this.content.clientWidth||1,scaleY:ee.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new a.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new a.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!s.Konva.isBrowser)return;const ee=this.container();if(!ee)throw"Stage has no container. A container is required.";ee.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),ee.appendChild(this.content),this._resizeDOM()}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(ee){ee.batchDraw()}),this}}e.Stage=Y,Y.prototype.nodeType=d,(0,l._registerNode)(Y),r.Factory.addGetterSetter(Y,"container"),s.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{e.stages.forEach(te=>{te.batchDraw()})})})(dw)),dw}var Ag={},fw={},lT;function sa(){return lT||(lT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Shape=e.shapes=void 0;const t=Br(),r=ls(),n=Hr(),s=vs(),a=Vr(),i=Br(),l=b6(),c="hasShadow",d="shadowRGBA",f="patternImage",p="linearGradient",g="radialGradient";let y;function v(){return y||(y=r.Util.createCanvasElement().getContext("2d"),y)}e.shapes={};function _(D){const I=this.attrs.fillRule;I?D.fill(I):D.fill()}function b(D){D.stroke()}function E(D){const I=this.attrs.fillRule;I?D.fill(I):D.fill()}function k(D){D.stroke()}function w(){this._clearCache(c)}function N(){this._clearCache(d)}function A(){this._clearCache(f)}function P(){this._clearCache(p)}function R(){this._clearCache(g)}class T extends s.Node{constructor(I){super(I);let V;for(;V=r.Util.getRandomColor(),!(V&&!(V in e.shapes)););this.colorKey=V,e.shapes[V]=this}getContext(){return r.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return r.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(c,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(f,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const V=v().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(V&&V.setTransform){const X=new r.Transform;X.translate(this.fillPatternX(),this.fillPatternY()),X.rotate(t.Konva.getAngle(this.fillPatternRotation())),X.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),X.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const Z=X.getMatrix(),ie=typeof DOMMatrix>"u"?{a:Z[0],b:Z[1],c:Z[2],d:Z[3],e:Z[4],f:Z[5]}:new DOMMatrix(Z);V.setTransform(ie)}return V}}_getLinearGradient(){return this._getCache(p,this.__getLinearGradient)}__getLinearGradient(){const I=this.fillLinearGradientColorStops();if(I){const V=v(),X=this.fillLinearGradientStartPoint(),Z=this.fillLinearGradientEndPoint(),ie=V.createLinearGradient(X.x,X.y,Z.x,Z.y);for(let q=0;q<I.length;q+=2)ie.addColorStop(I[q],I[q+1]);return ie}}_getRadialGradient(){return this._getCache(g,this.__getRadialGradient)}__getRadialGradient(){const I=this.fillRadialGradientColorStops();if(I){const V=v(),X=this.fillRadialGradientStartPoint(),Z=this.fillRadialGradientEndPoint(),ie=V.createRadialGradient(X.x,X.y,this.fillRadialGradientStartRadius(),Z.x,Z.y,this.fillRadialGradientEndRadius());for(let q=0;q<I.length;q+=2)ie.addColorStop(I[q],I[q+1]);return ie}}getShadowRGBA(){return this._getCache(d,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const I=r.Util.colorToRGBA(this.shadowColor());if(I)return"rgba("+I.r+","+I.g+","+I.b+","+I.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const I=this.hitStrokeWidth();return I==="auto"?this.hasStroke():this.strokeEnabled()&&!!I}intersects(I){const V=this.getStage();if(!V)return!1;const X=V.bufferHitCanvas;return X.getContext().clear(),this.drawHit(X,void 0,!0),X.context.getImageData(Math.round(I.x),Math.round(I.y),1,1).data[3]>0}destroy(){return s.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(I){var V;if(!((V=this.attrs.perfectDrawEnabled)!==null&&V!==void 0?V:!0))return!1;const Z=I||this.hasFill(),ie=this.hasStroke(),q=this.getAbsoluteOpacity()!==1;if(Z&&ie&&q)return!0;const ne=this.hasShadow(),M=this.shadowForStrokeEnabled();return!!(Z&&ie&&ne&&M)}setStrokeHitEnabled(I){r.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),I?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const I=this.size();return{x:this._centroid?-I.width/2:0,y:this._centroid?-I.height/2:0,width:I.width,height:I.height}}getClientRect(I={}){let V=!1,X=this.getParent();for(;X;){if(X.isCached()){V=!0;break}X=X.getParent()}const Z=I.skipTransform,ie=I.relativeTo||V&&this.getStage()||void 0,q=this.getSelfRect(),M=!I.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,W=q.width+M,L=q.height+M,H=!I.skipShadow&&this.hasShadow(),K=H?this.shadowOffsetX():0,B=H?this.shadowOffsetY():0,z=W+Math.abs(K),Q=L+Math.abs(B),Y=H&&this.shadowBlur()||0,te=z+Y*2,ee=Q+Y*2,ae={width:te,height:ee,x:-(M/2+Y)+Math.min(K,0)+q.x,y:-(M/2+Y)+Math.min(B,0)+q.y};return Z?ae:this._transformedRect(ae,ie)}drawScene(I,V,X){const Z=this.getLayer(),ie=I||Z.getCanvas(),q=ie.getContext(),ne=this._getCanvasCache(),M=this.getSceneFunc(),W=this.hasShadow();let L;const H=V===this;if(!this.isVisible()&&!H)return this;if(ne){q.save();const K=this.getAbsoluteTransform(V).getMatrix();return q.transform(K[0],K[1],K[2],K[3],K[4],K[5]),this._drawCachedSceneCanvas(q),q.restore(),this}if(!M)return this;if(q.save(),this._useBufferCanvas()){L=this.getStage();const K=X||L.bufferCanvas,B=K.getContext();B.clear(),B.save(),B._applyLineJoin(this);const z=this.getAbsoluteTransform(V).getMatrix();B.transform(z[0],z[1],z[2],z[3],z[4],z[5]),M.call(this,B,this),B.restore();const Q=K.pixelRatio;W&&q._applyShadow(this),q._applyOpacity(this),q._applyGlobalCompositeOperation(this),q.drawImage(K._canvas,K.x||0,K.y||0,K.width/Q,K.height/Q)}else{if(q._applyLineJoin(this),!H){const K=this.getAbsoluteTransform(V).getMatrix();q.transform(K[0],K[1],K[2],K[3],K[4],K[5]),q._applyOpacity(this),q._applyGlobalCompositeOperation(this)}W&&q._applyShadow(this),M.call(this,q,this)}return q.restore(),this}drawHit(I,V,X=!1){if(!this.shouldDrawHit(V,X))return this;const Z=this.getLayer(),ie=I||Z.hitCanvas,q=ie&&ie.getContext(),ne=this.hitFunc()||this.sceneFunc(),M=this._getCanvasCache(),W=M&&M.hit;if(this.colorKey||r.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),W){q.save();const H=this.getAbsoluteTransform(V).getMatrix();return q.transform(H[0],H[1],H[2],H[3],H[4],H[5]),this._drawCachedHitCanvas(q),q.restore(),this}if(!ne)return this;if(q.save(),q._applyLineJoin(this),!(this===V)){const H=this.getAbsoluteTransform(V).getMatrix();q.transform(H[0],H[1],H[2],H[3],H[4],H[5])}return ne.call(this,q,this),q.restore(),this}drawHitFromCache(I=0){const V=this._getCanvasCache(),X=this._getCachedSceneCanvas(),Z=V.hit,ie=Z.getContext(),q=Z.getWidth(),ne=Z.getHeight();ie.clear(),ie.drawImage(X._canvas,0,0,q,ne);try{const M=ie.getImageData(0,0,q,ne),W=M.data,L=W.length,H=r.Util._hexToRgb(this.colorKey);for(let K=0;K<L;K+=4)W[K+3]>I?(W[K]=H.r,W[K+1]=H.g,W[K+2]=H.b,W[K+3]=255):W[K+3]=0;ie.putImageData(M,0,0)}catch(M){r.Util.error("Unable to draw hit graph from cached scene canvas. "+M.message)}return this}hasPointerCapture(I){return l.hasPointerCapture(I,this)}setPointerCapture(I){l.setPointerCapture(I,this)}releaseCapture(I){l.releaseCapture(I,this)}}e.Shape=T,T.prototype._fillFunc=_,T.prototype._strokeFunc=b,T.prototype._fillFuncHit=E,T.prototype._strokeFuncHit=k,T.prototype._centroid=!1,T.prototype.nodeType="Shape",(0,i._registerNode)(T),T.prototype.eventListeners={},T.prototype.on.call(T.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",w),T.prototype.on.call(T.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",N),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",A),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",P),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",R),n.Factory.addGetterSetter(T,"stroke",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(T,"strokeWidth",2,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"fillAfterStrokeEnabled",!1),n.Factory.addGetterSetter(T,"hitStrokeWidth","auto",(0,a.getNumberOrAutoValidator)()),n.Factory.addGetterSetter(T,"strokeHitEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(T,"perfectDrawEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(T,"shadowForStrokeEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(T,"lineJoin"),n.Factory.addGetterSetter(T,"lineCap"),n.Factory.addGetterSetter(T,"sceneFunc"),n.Factory.addGetterSetter(T,"hitFunc"),n.Factory.addGetterSetter(T,"dash"),n.Factory.addGetterSetter(T,"dashOffset",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"shadowColor",void 0,(0,a.getStringValidator)()),n.Factory.addGetterSetter(T,"shadowBlur",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"shadowOpacity",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(T,"shadowOffset",["x","y"]),n.Factory.addGetterSetter(T,"shadowOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"shadowOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"fillPatternImage"),n.Factory.addGetterSetter(T,"fill",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(T,"fillPatternX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"fillPatternY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(T,"strokeLinearGradientColorStops"),n.Factory.addGetterSetter(T,"fillRadialGradientStartRadius",0),n.Factory.addGetterSetter(T,"fillRadialGradientEndRadius",0),n.Factory.addGetterSetter(T,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(T,"fillPatternRepeat","repeat"),n.Factory.addGetterSetter(T,"fillEnabled",!0),n.Factory.addGetterSetter(T,"strokeEnabled",!0),n.Factory.addGetterSetter(T,"shadowEnabled",!0),n.Factory.addGetterSetter(T,"dashEnabled",!0),n.Factory.addGetterSetter(T,"strokeScaleEnabled",!0),n.Factory.addGetterSetter(T,"fillPriority","color"),n.Factory.addComponentsGetterSetter(T,"fillPatternOffset",["x","y"]),n.Factory.addGetterSetter(T,"fillPatternOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"fillPatternOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(T,"fillPatternScale",["x","y"]),n.Factory.addGetterSetter(T,"fillPatternScaleX",1,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(T,"fillPatternScaleY",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(T,"fillLinearGradientStartPoint",["x","y"]),n.Factory.addComponentsGetterSetter(T,"strokeLinearGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(T,"fillLinearGradientStartPointX",0),n.Factory.addGetterSetter(T,"strokeLinearGradientStartPointX",0),n.Factory.addGetterSetter(T,"fillLinearGradientStartPointY",0),n.Factory.addGetterSetter(T,"strokeLinearGradientStartPointY",0),n.Factory.addComponentsGetterSetter(T,"fillLinearGradientEndPoint",["x","y"]),n.Factory.addComponentsGetterSetter(T,"strokeLinearGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(T,"fillLinearGradientEndPointX",0),n.Factory.addGetterSetter(T,"strokeLinearGradientEndPointX",0),n.Factory.addGetterSetter(T,"fillLinearGradientEndPointY",0),n.Factory.addGetterSetter(T,"strokeLinearGradientEndPointY",0),n.Factory.addComponentsGetterSetter(T,"fillRadialGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(T,"fillRadialGradientStartPointX",0),n.Factory.addGetterSetter(T,"fillRadialGradientStartPointY",0),n.Factory.addComponentsGetterSetter(T,"fillRadialGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(T,"fillRadialGradientEndPointX",0),n.Factory.addGetterSetter(T,"fillRadialGradientEndPointY",0),n.Factory.addGetterSetter(T,"fillPatternRotation",0),n.Factory.addGetterSetter(T,"fillRule",void 0,(0,a.getStringValidator)()),n.Factory.backCompat(T,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(fw)),fw}var cT;function S6(){if(cT)return Ag;cT=1,Object.defineProperty(Ag,"__esModule",{value:!0}),Ag.Layer=void 0;const e=ls(),t=Dy(),r=vs(),n=Hr(),s=Ry(),a=Vr(),i=sa(),l=Br(),c="#",d="beforeDraw",f="draw",p=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],g=p.length;class y extends t.Container{constructor(_){super(_),this.canvas=new s.SceneCanvas,this.hitCanvas=new s.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(_){return this.getContext().clear(_),this.getHitCanvas().getContext().clear(_),this}setZIndex(_){super.setZIndex(_);const b=this.getStage();return b&&b.content&&(b.content.removeChild(this.getNativeCanvasElement()),_<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[_+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){r.Node.prototype.moveToTop.call(this);const _=this.getStage();return _&&_.content&&(_.content.removeChild(this.getNativeCanvasElement()),_.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!r.Node.prototype.moveUp.call(this))return!1;const b=this.getStage();return!b||!b.content?!1:(b.content.removeChild(this.getNativeCanvasElement()),this.index<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[this.index+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(r.Node.prototype.moveDown.call(this)){const _=this.getStage();if(_){const b=_.children;_.content&&(_.content.removeChild(this.getNativeCanvasElement()),_.content.insertBefore(this.getNativeCanvasElement(),b[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(r.Node.prototype.moveToBottom.call(this)){const _=this.getStage();if(_){const b=_.children;_.content&&(_.content.removeChild(this.getNativeCanvasElement()),_.content.insertBefore(this.getNativeCanvasElement(),b[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const _=this.getNativeCanvasElement();return r.Node.prototype.remove.call(this),_&&_.parentNode&&e.Util._isInDocument(_)&&_.parentNode.removeChild(_),this}getStage(){return this.parent}setSize({width:_,height:b}){return this.canvas.setSize(_,b),this.hitCanvas.setSize(_,b),this._setSmoothEnabled(),this}_validateAdd(_){const b=_.getType();b!=="Group"&&b!=="Shape"&&e.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(_){return _=_||{},_.width=_.width||this.getWidth(),_.height=_.height||this.getHeight(),_.x=_.x!==void 0?_.x:this.x(),_.y=_.y!==void 0?_.y:this.y(),r.Node.prototype._toKonvaCanvas.call(this,_)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){e.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){e.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,e.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(_){if(!this.isListening()||!this.isVisible())return null;let b=1,E=!1;for(;;){for(let k=0;k<g;k++){const w=p[k],N=this._getIntersection({x:_.x+w.x*b,y:_.y+w.y*b}),A=N.shape;if(A)return A;if(E=!!N.antialiased,!N.antialiased)break}if(E)b+=1;else return null}}_getIntersection(_){const b=this.hitCanvas.pixelRatio,E=this.hitCanvas.context.getImageData(Math.round(_.x*b),Math.round(_.y*b),1,1).data,k=E[3];if(k===255){const w=e.Util._rgbToHex(E[0],E[1],E[2]),N=i.shapes[c+w];return N?{shape:N}:{antialiased:!0}}else if(k>0)return{antialiased:!0};return{}}drawScene(_,b,E){const k=this.getLayer(),w=_||k&&k.getCanvas();return this._fire(d,{node:this}),this.clearBeforeDraw()&&w.getContext().clear(),t.Container.prototype.drawScene.call(this,w,b,E),this._fire(f,{node:this}),this}drawHit(_,b){const E=this.getLayer(),k=_||E&&E.hitCanvas;return E&&E.clearBeforeDraw()&&E.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,k,b),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(_){e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(_)}getHitGraphEnabled(_){return e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const _=this.parent;!!this.hitCanvas._canvas.parentNode?_.content.removeChild(this.hitCanvas._canvas):_.content.appendChild(this.hitCanvas._canvas)}destroy(){return e.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}return Ag.Layer=y,y.prototype.nodeType="Layer",(0,l._registerNode)(y),n.Factory.addGetterSetter(y,"imageSmoothingEnabled",!0),n.Factory.addGetterSetter(y,"clearBeforeDraw",!0),n.Factory.addGetterSetter(y,"hitGraphEnabled",!0,(0,a.getBooleanValidator)()),Ag}var jg={},uT;function xM(){if(uT)return jg;uT=1,Object.defineProperty(jg,"__esModule",{value:!0}),jg.FastLayer=void 0;const e=ls(),t=S6(),r=Br();class n extends t.Layer{constructor(a){super(a),this.listening(!1),e.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}return jg.FastLayer=n,n.prototype.nodeType="FastLayer",(0,r._registerNode)(n),jg}var Fg={},dT;function ab(){if(dT)return Fg;dT=1,Object.defineProperty(Fg,"__esModule",{value:!0}),Fg.Group=void 0;const e=ls(),t=Dy(),r=Br();class n extends t.Container{_validateAdd(a){const i=a.getType();i!=="Group"&&i!=="Shape"&&e.Util.throw("You may only add groups and shapes to groups.")}}return Fg.Group=n,n.prototype.nodeType="Group",(0,r._registerNode)(n),Fg}var Pg={},fT;function ib(){if(fT)return Pg;fT=1,Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.Animation=void 0;const e=Br(),t=ls(),r=(function(){return e.glob.performance&&e.glob.performance.now?function(){return e.glob.performance.now()}:function(){return new Date().getTime()}})();let n=class Nh{constructor(a,i){this.id=Nh.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:r(),frameRate:0},this.func=a,this.setLayers(i)}setLayers(a){let i=[];return a&&(i=Array.isArray(a)?a:[a]),this.layers=i,this}getLayers(){return this.layers}addLayer(a){const i=this.layers,l=i.length;for(let c=0;c<l;c++)if(i[c]._id===a._id)return!1;return this.layers.push(a),!0}isRunning(){const i=Nh.animations,l=i.length;for(let c=0;c<l;c++)if(i[c].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=r(),Nh._addAnimation(this),this}stop(){return Nh._removeAnimation(this),this}_updateFrameObject(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(a){this.animations.push(a),this._handleAnimation()}static _removeAnimation(a){const i=a.id,l=this.animations,c=l.length;for(let d=0;d<c;d++)if(l[d].id===i){this.animations.splice(d,1);break}}static _runFrames(){const a={},i=this.animations;for(let l=0;l<i.length;l++){const c=i[l],d=c.layers,f=c.func;c._updateFrameObject(r());const p=d.length;let g;if(f?g=f.call(c,c.frame)!==!1:g=!0,!!g)for(let y=0;y<p;y++){const v=d[y];v._id!==void 0&&(a[v._id]=v)}}for(const l in a)a.hasOwnProperty(l)&&a[l].batchDraw()}static _animationLoop(){const a=Nh;a.animations.length?(a._runFrames(),t.Util.requestAnimFrame(a._animationLoop)):a.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,t.Util.requestAnimFrame(this._animationLoop))}};return Pg.Animation=n,n.animations=[],n.animIdCounter=0,n.animRunning=!1,Pg}var hw={},hT;function yM(){return hT||(hT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Easings=e.Tween=void 0;const t=ls(),r=ib(),n=vs(),s=Br(),a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},i=1,l=2,c=3,d=["fill","stroke","shadowColor"];let f=0;class p{constructor(v,_,b,E,k,w,N){this.prop=v,this.propFunc=_,this.begin=E,this._pos=E,this.duration=w,this._change=0,this.prevPos=0,this.yoyo=N,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=b,this._change=k-this.begin,this.pause()}fire(v){const _=this[v];_&&_()}setTime(v){v>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():v<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=v,this.update())}getTime(){return this._time}setPosition(v){this.prevPos=this._pos,this.propFunc(v),this._pos=v}getPosition(v){return v===void 0&&(v=this._time),this.func(v,this.begin,this._change,this.duration)}play(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(v){this.pause(),this._time=v,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const v=this.getTimer()-this._startTime;this.state===l?this.setTime(v):this.state===c&&this.setTime(this.duration-v)}pause(){this.state=i,this.fire("onPause")}getTimer(){return new Date().getTime()}}class g{constructor(v){const _=this,b=v.node,E=b._id,k=v.easing||e.Easings.Linear,w=!!v.yoyo;let N,A;typeof v.duration>"u"?N=.3:v.duration===0?N=.001:N=v.duration,this.node=b,this._id=f++;const P=b.getLayer()||(b instanceof s.Konva.Stage?b.getLayers():null);P||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new r.Animation(function(){_.tween.onEnterFrame()},P),this.tween=new p(A,function(R){_._tweenFunc(R)},k,0,1,N*1e3,w),this._addListeners(),g.attrs[E]||(g.attrs[E]={}),g.attrs[E][this._id]||(g.attrs[E][this._id]={}),g.tweens[E]||(g.tweens[E]={});for(A in v)a[A]===void 0&&this._addAttr(A,v[A]);this.reset(),this.onFinish=v.onFinish,this.onReset=v.onReset,this.onUpdate=v.onUpdate}_addAttr(v,_){const b=this.node,E=b._id;let k,w,N,A,P;const R=g.tweens[E][v];R&&delete g.attrs[E][R][v];let T=b.getAttr(v);if(t.Util._isArray(_))if(k=[],w=Math.max(_.length,T.length),v==="points"&&_.length!==T.length&&(_.length>T.length?(A=T,T=t.Util._prepareArrayForTween(T,_,b.closed())):(N=_,_=t.Util._prepareArrayForTween(_,T,b.closed()))),v.indexOf("fill")===0)for(let D=0;D<w;D++)if(D%2===0)k.push(_[D]-T[D]);else{const I=t.Util.colorToRGBA(T[D]);P=t.Util.colorToRGBA(_[D]),T[D]=I,k.push({r:P.r-I.r,g:P.g-I.g,b:P.b-I.b,a:P.a-I.a})}else for(let D=0;D<w;D++)k.push(_[D]-T[D]);else d.indexOf(v)!==-1?(T=t.Util.colorToRGBA(T),P=t.Util.colorToRGBA(_),k={r:P.r-T.r,g:P.g-T.g,b:P.b-T.b,a:P.a-T.a}):k=_-T;g.attrs[E][this._id][v]={start:T,diff:k,end:_,trueEnd:N,trueStart:A},g.tweens[E][v]=this._id}_tweenFunc(v){const _=this.node,b=g.attrs[_._id][this._id];let E,k,w,N,A,P,R,T;for(E in b){if(k=b[E],w=k.start,N=k.diff,T=k.end,t.Util._isArray(w))if(A=[],R=Math.max(w.length,T.length),E.indexOf("fill")===0)for(P=0;P<R;P++)P%2===0?A.push((w[P]||0)+N[P]*v):A.push("rgba("+Math.round(w[P].r+N[P].r*v)+","+Math.round(w[P].g+N[P].g*v)+","+Math.round(w[P].b+N[P].b*v)+","+(w[P].a+N[P].a*v)+")");else for(P=0;P<R;P++)A.push((w[P]||0)+N[P]*v);else d.indexOf(E)!==-1?A="rgba("+Math.round(w.r+N.r*v)+","+Math.round(w.g+N.g*v)+","+Math.round(w.b+N.b*v)+","+(w.a+N.a*v)+")":A=w+N*v;_.setAttr(E,A)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const v=this.node,_=g.attrs[v._id][this._id];_.points&&_.points.trueEnd&&v.setAttr("points",_.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const v=this.node,_=g.attrs[v._id][this._id];_.points&&_.points.trueStart&&v.points(_.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(v){return this.tween.seek(v*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const v=this.node._id,_=this._id,b=g.tweens[v];this.pause(),this.anim&&this.anim.stop();for(const E in b)delete g.tweens[v][E];delete g.attrs[v][_],g.tweens[v]&&(Object.keys(g.tweens[v]).length===0&&delete g.tweens[v],Object.keys(g.attrs[v]).length===0&&delete g.attrs[v])}}e.Tween=g,g.attrs={},g.tweens={},n.Node.prototype.to=function(y){const v=y.onFinish;y.node=this,y.onFinish=function(){this.destroy(),v&&v()},new g(y).play()},e.Easings={BackEaseIn(y,v,_,b){return _*(y/=b)*y*((1.70158+1)*y-1.70158)+v},BackEaseOut(y,v,_,b){return _*((y=y/b-1)*y*((1.70158+1)*y+1.70158)+1)+v},BackEaseInOut(y,v,_,b){let E=1.70158;return(y/=b/2)<1?_/2*(y*y*(((E*=1.525)+1)*y-E))+v:_/2*((y-=2)*y*(((E*=1.525)+1)*y+E)+2)+v},ElasticEaseIn(y,v,_,b,E,k){let w=0;return y===0?v:(y/=b)===1?v+_:(k||(k=b*.3),!E||E<Math.abs(_)?(E=_,w=k/4):w=k/(2*Math.PI)*Math.asin(_/E),-(E*Math.pow(2,10*(y-=1))*Math.sin((y*b-w)*(2*Math.PI)/k))+v)},ElasticEaseOut(y,v,_,b,E,k){let w=0;return y===0?v:(y/=b)===1?v+_:(k||(k=b*.3),!E||E<Math.abs(_)?(E=_,w=k/4):w=k/(2*Math.PI)*Math.asin(_/E),E*Math.pow(2,-10*y)*Math.sin((y*b-w)*(2*Math.PI)/k)+_+v)},ElasticEaseInOut(y,v,_,b,E,k){let w=0;return y===0?v:(y/=b/2)===2?v+_:(k||(k=b*(.3*1.5)),!E||E<Math.abs(_)?(E=_,w=k/4):w=k/(2*Math.PI)*Math.asin(_/E),y<1?-.5*(E*Math.pow(2,10*(y-=1))*Math.sin((y*b-w)*(2*Math.PI)/k))+v:E*Math.pow(2,-10*(y-=1))*Math.sin((y*b-w)*(2*Math.PI)/k)*.5+_+v)},BounceEaseOut(y,v,_,b){return(y/=b)<1/2.75?_*(7.5625*y*y)+v:y<2/2.75?_*(7.5625*(y-=1.5/2.75)*y+.75)+v:y<2.5/2.75?_*(7.5625*(y-=2.25/2.75)*y+.9375)+v:_*(7.5625*(y-=2.625/2.75)*y+.984375)+v},BounceEaseIn(y,v,_,b){return _-e.Easings.BounceEaseOut(b-y,0,_,b)+v},BounceEaseInOut(y,v,_,b){return y<b/2?e.Easings.BounceEaseIn(y*2,0,_,b)*.5+v:e.Easings.BounceEaseOut(y*2-b,0,_,b)*.5+_*.5+v},EaseIn(y,v,_,b){return _*(y/=b)*y+v},EaseOut(y,v,_,b){return-_*(y/=b)*(y-2)+v},EaseInOut(y,v,_,b){return(y/=b/2)<1?_/2*y*y+v:-_/2*(--y*(y-2)-1)+v},StrongEaseIn(y,v,_,b){return _*(y/=b)*y*y*y*y+v},StrongEaseOut(y,v,_,b){return _*((y=y/b-1)*y*y*y*y+1)+v},StrongEaseInOut(y,v,_,b){return(y/=b/2)<1?_/2*y*y*y*y*y+v:_/2*((y-=2)*y*y*y*y+2)+v},Linear(y,v,_,b){return _*y/b+v}}})(hw)),hw}var gT;function C_(){return gT||(gT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;const t=Br(),r=ls(),n=vs(),s=Dy(),a=pM(),i=S6(),l=xM(),c=ab(),d=sb(),f=sa(),p=ib(),g=yM(),y=_6(),v=Ry();e.Konva=r.Util._assign(t.Konva,{Util:r.Util,Transform:r.Transform,Node:n.Node,Container:s.Container,Stage:a.Stage,stages:a.stages,Layer:i.Layer,FastLayer:l.FastLayer,Group:c.Group,DD:d.DD,Shape:f.Shape,shapes:f.shapes,Animation:p.Animation,Tween:g.Tween,Easings:g.Easings,Context:y.Context,Canvas:v.Canvas}),e.default=e.Konva})(iw)),iw}var Rg={},mT;function vM(){if(mT)return Rg;mT=1,Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.Arc=void 0;const e=Hr(),t=sa(),r=Br(),n=Vr(),s=Br();class a extends t.Shape{_sceneFunc(l){const c=r.Konva.getAngle(this.angle()),d=this.clockwise();l.beginPath(),l.arc(0,0,this.outerRadius(),0,c,d),l.arc(0,0,this.innerRadius(),c,0,!d),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}getSelfRect(){const l=this.innerRadius(),c=this.outerRadius(),d=this.clockwise(),f=r.Konva.getAngle(d?360-this.angle():this.angle()),p=Math.cos(Math.min(f,Math.PI)),g=1,y=Math.sin(Math.min(Math.max(Math.PI,f),3*Math.PI/2)),v=Math.sin(Math.min(f,Math.PI/2)),_=p*(p>0?l:c),b=g*c,E=y*(y>0?l:c),k=v*(v>0?c:l);return{x:_,y:d?-1*k:E,width:b-_,height:k-E}}}return Rg.Arc=a,a.prototype._centroid=!0,a.prototype.className="Arc",a.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"outerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"clockwise",!1,(0,n.getBooleanValidator)()),Rg}var Dg={},Ig={},pT;function k6(){if(pT)return Ig;pT=1,Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.Line=void 0;const e=Hr(),t=Br(),r=sa(),n=Vr();function s(l,c,d,f,p,g,y){const v=Math.sqrt(Math.pow(d-l,2)+Math.pow(f-c,2)),_=Math.sqrt(Math.pow(p-d,2)+Math.pow(g-f,2)),b=y*v/(v+_),E=y*_/(v+_),k=d-b*(p-l),w=f-b*(g-c),N=d+E*(p-l),A=f+E*(g-c);return[k,w,N,A]}function a(l,c){const d=l.length,f=[];for(let p=2;p<d-2;p+=2){const g=s(l[p-2],l[p-1],l[p],l[p+1],l[p+2],l[p+3],c);isNaN(g[0])||(f.push(g[0]),f.push(g[1]),f.push(l[p]),f.push(l[p+1]),f.push(g[2]),f.push(g[3]))}return f}class i extends r.Shape{constructor(c){super(c),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(c){const d=this.points(),f=d.length,p=this.tension(),g=this.closed(),y=this.bezier();if(!f)return;let v=0;if(c.beginPath(),c.moveTo(d[0],d[1]),p!==0&&f>4){const _=this.getTensionPoints(),b=_.length;for(v=g?0:4,g||c.quadraticCurveTo(_[0],_[1],_[2],_[3]);v<b-2;)c.bezierCurveTo(_[v++],_[v++],_[v++],_[v++],_[v++],_[v++]);g||c.quadraticCurveTo(_[b-2],_[b-1],d[f-2],d[f-1])}else if(y)for(v=2;v<f;)c.bezierCurveTo(d[v++],d[v++],d[v++],d[v++],d[v++],d[v++]);else for(v=2;v<f;v+=2)c.lineTo(d[v],d[v+1]);g?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():a(this.points(),this.tension())}_getTensionPointsClosed(){const c=this.points(),d=c.length,f=this.tension(),p=s(c[d-2],c[d-1],c[0],c[1],c[2],c[3],f),g=s(c[d-4],c[d-3],c[d-2],c[d-1],c[0],c[1],f),y=a(c,f);return[p[2],p[3]].concat(y).concat([g[0],g[1],c[d-2],c[d-1],g[2],g[3],p[0],p[1],c[0],c[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let c=this.points();if(c.length<4)return{x:c[0]||0,y:c[1]||0,width:0,height:0};this.tension()!==0?c=[c[0],c[1],...this._getTensionPoints(),c[c.length-2],c[c.length-1]]:c=this.points();let d=c[0],f=c[0],p=c[1],g=c[1],y,v;for(let _=0;_<c.length/2;_++)y=c[_*2],v=c[_*2+1],d=Math.min(d,y),f=Math.max(f,y),p=Math.min(p,v),g=Math.max(g,v);return{x:d,y:p,width:f-d,height:g-p}}}return Ig.Line=i,i.prototype.className="Line",i.prototype._attrsAffectingSize=["points","bezier","tension"],(0,t._registerNode)(i),e.Factory.addGetterSetter(i,"closed",!1),e.Factory.addGetterSetter(i,"bezier",!1),e.Factory.addGetterSetter(i,"tension",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"points",[],(0,n.getNumberArrayValidator)()),Ig}var Mg={},gw={},xT;function wM(){return xT||(xT=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.t2length=e.getQuadraticArcLength=e.getCubicArcLength=e.binomialCoefficients=e.cValues=e.tValues=void 0,e.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],e.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],e.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(i,l,c)=>{let d,f;const g=c/2;d=0;for(let y=0;y<20;y++)f=g*e.tValues[20][y]+g,d+=e.cValues[20][y]*n(i,l,f);return g*d};e.getCubicArcLength=t;const r=(i,l,c)=>{c===void 0&&(c=1);const d=i[0]-2*i[1]+i[2],f=l[0]-2*l[1]+l[2],p=2*i[1]-2*i[0],g=2*l[1]-2*l[0],y=4*(d*d+f*f),v=4*(d*p+f*g),_=p*p+g*g;if(y===0)return c*Math.sqrt(Math.pow(i[2]-i[0],2)+Math.pow(l[2]-l[0],2));const b=v/(2*y),E=_/y,k=c+b,w=E-b*b,N=k*k+w>0?Math.sqrt(k*k+w):0,A=b*b+w>0?Math.sqrt(b*b+w):0,P=b+Math.sqrt(b*b+w)!==0?w*Math.log(Math.abs((k+N)/(b+A))):0;return Math.sqrt(y)/2*(k*N-b*A+P)};e.getQuadraticArcLength=r;function n(i,l,c){const d=s(1,c,i),f=s(1,c,l),p=d*d+f*f;return Math.sqrt(p)}const s=(i,l,c)=>{const d=c.length-1;let f,p;if(d===0)return 0;if(i===0){p=0;for(let g=0;g<=d;g++)p+=e.binomialCoefficients[d][g]*Math.pow(1-l,d-g)*Math.pow(l,g)*c[g];return p}else{f=new Array(d);for(let g=0;g<d;g++)f[g]=d*(c[g+1]-c[g]);return s(i-1,l,f)}},a=(i,l,c)=>{let d=1,f=i/l,p=(i-c(f))/l,g=0;for(;d>.001;){const y=c(f+p),v=Math.abs(i-y)/l;if(v<d)d=v,f+=p;else{const _=c(f-p),b=Math.abs(i-_)/l;b<d?(d=b,f-=p):p/=2}if(g++,g>500)break}return f};e.t2length=a})(gw)),gw}var yT;function ob(){if(yT)return Mg;yT=1,Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.Path=void 0;const e=Hr(),t=Br(),r=sa(),n=wM();class s extends r.Shape{constructor(i){super(i),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=s.parsePathData(this.data()),this.pathLength=s.getPathLength(this.dataArray)}_sceneFunc(i){const l=this.dataArray;i.beginPath();let c=!1;for(let d=0;d<l.length;d++){const f=l[d].command,p=l[d].points;switch(f){case"L":i.lineTo(p[0],p[1]);break;case"M":i.moveTo(p[0],p[1]);break;case"C":i.bezierCurveTo(p[0],p[1],p[2],p[3],p[4],p[5]);break;case"Q":i.quadraticCurveTo(p[0],p[1],p[2],p[3]);break;case"A":const g=p[0],y=p[1],v=p[2],_=p[3],b=p[4],E=p[5],k=p[6],w=p[7],N=v>_?v:_,A=v>_?1:v/_,P=v>_?_/v:1;i.translate(g,y),i.rotate(k),i.scale(A,P),i.arc(0,0,N,b,b+E,1-w),i.scale(1/A,1/P),i.rotate(-k),i.translate(-g,-y);break;case"z":c=!0,i.closePath();break}}!c&&!this.hasFill()?i.strokeShape(this):i.fillStrokeShape(this)}getSelfRect(){let i=[];this.dataArray.forEach(function(y){if(y.command==="A"){const v=y.points[4],_=y.points[5],b=y.points[4]+_;let E=Math.PI/180;if(Math.abs(v-b)<E&&(E=Math.abs(v-b)),_<0)for(let k=v-E;k>b;k-=E){const w=s.getPointOnEllipticalArc(y.points[0],y.points[1],y.points[2],y.points[3],k,0);i.push(w.x,w.y)}else for(let k=v+E;k<b;k+=E){const w=s.getPointOnEllipticalArc(y.points[0],y.points[1],y.points[2],y.points[3],k,0);i.push(w.x,w.y)}}else if(y.command==="C")for(let v=0;v<=1;v+=.01){const _=s.getPointOnCubicBezier(v,y.start.x,y.start.y,y.points[0],y.points[1],y.points[2],y.points[3],y.points[4],y.points[5]);i.push(_.x,_.y)}else i=i.concat(y.points)});let l=i[0],c=i[0],d=i[1],f=i[1],p,g;for(let y=0;y<i.length/2;y++)p=i[y*2],g=i[y*2+1],isNaN(p)||(l=Math.min(l,p),c=Math.max(c,p)),isNaN(g)||(d=Math.min(d,g),f=Math.max(f,g));return{x:l,y:d,width:c-l,height:f-d}}getLength(){return this.pathLength}getPointAtLength(i){return s.getPointAtLengthOfDataArray(i,this.dataArray)}static getLineLength(i,l,c,d){return Math.sqrt((c-i)*(c-i)+(d-l)*(d-l))}static getPathLength(i){let l=0;for(let c=0;c<i.length;++c)l+=i[c].pathLength;return l}static getPointAtLengthOfDataArray(i,l){let c,d=0,f=l.length;if(!f)return null;for(;d<f&&i>l[d].pathLength;)i-=l[d].pathLength,++d;if(d===f)return c=l[d-1].points.slice(-2),{x:c[0],y:c[1]};if(i<.01)return l[d].command==="M"?(c=l[d].points.slice(0,2),{x:c[0],y:c[1]}):{x:l[d].start.x,y:l[d].start.y};const p=l[d],g=p.points;switch(p.command){case"L":return s.getPointOnLine(i,p.start.x,p.start.y,g[0],g[1]);case"C":return s.getPointOnCubicBezier((0,n.t2length)(i,s.getPathLength(l),N=>(0,n.getCubicArcLength)([p.start.x,g[0],g[2],g[4]],[p.start.y,g[1],g[3],g[5]],N)),p.start.x,p.start.y,g[0],g[1],g[2],g[3],g[4],g[5]);case"Q":return s.getPointOnQuadraticBezier((0,n.t2length)(i,s.getPathLength(l),N=>(0,n.getQuadraticArcLength)([p.start.x,g[0],g[2]],[p.start.y,g[1],g[3]],N)),p.start.x,p.start.y,g[0],g[1],g[2],g[3]);case"A":const y=g[0],v=g[1],_=g[2],b=g[3],E=g[5],k=g[6];let w=g[4];return w+=E*i/p.pathLength,s.getPointOnEllipticalArc(y,v,_,b,w,k)}return null}static getPointOnLine(i,l,c,d,f,p,g){p=p??l,g=g??c;const y=this.getLineLength(l,c,d,f);if(y<1e-10)return{x:l,y:c};if(d===l)return{x:p,y:g+(f>c?i:-i)};const v=(f-c)/(d-l),_=Math.sqrt(i*i/(1+v*v))*(d<l?-1:1),b=v*_;if(Math.abs(g-c-v*(p-l))<1e-10)return{x:p+_,y:g+b};const E=((p-l)*(d-l)+(g-c)*(f-c))/(y*y),k=l+E*(d-l),w=c+E*(f-c),N=this.getLineLength(p,g,k,w),A=Math.sqrt(i*i-N*N),P=Math.sqrt(A*A/(1+v*v))*(d<l?-1:1),R=v*P;return{x:k+P,y:w+R}}static getPointOnCubicBezier(i,l,c,d,f,p,g,y,v){function _(A){return A*A*A}function b(A){return 3*A*A*(1-A)}function E(A){return 3*A*(1-A)*(1-A)}function k(A){return(1-A)*(1-A)*(1-A)}const w=y*_(i)+p*b(i)+d*E(i)+l*k(i),N=v*_(i)+g*b(i)+f*E(i)+c*k(i);return{x:w,y:N}}static getPointOnQuadraticBezier(i,l,c,d,f,p,g){function y(k){return k*k}function v(k){return 2*k*(1-k)}function _(k){return(1-k)*(1-k)}const b=p*y(i)+d*v(i)+l*_(i),E=g*y(i)+f*v(i)+c*_(i);return{x:b,y:E}}static getPointOnEllipticalArc(i,l,c,d,f,p){const g=Math.cos(p),y=Math.sin(p),v={x:c*Math.cos(f),y:d*Math.sin(f)};return{x:i+(v.x*g-v.y*y),y:l+(v.x*y+v.y*g)}}static parsePathData(i){if(!i)return[];let l=i;const c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];l=l.replace(new RegExp(" ","g"),",");for(let b=0;b<c.length;b++)l=l.replace(new RegExp(c[b],"g"),"|"+c[b]);const d=l.split("|"),f=[],p=[];let g=0,y=0;const v=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let _;for(let b=1;b<d.length;b++){let E=d[b],k=E.charAt(0);for(E=E.slice(1),p.length=0;_=v.exec(E);)p.push(_[0]);const w=[];for(let N=0,A=p.length;N<A;N++){if(p[N]==="00"){w.push(0,0);continue}const P=parseFloat(p[N]);isNaN(P)?w.push(0):w.push(P)}for(;w.length>0&&!isNaN(w[0]);){let N="",A=[];const P=g,R=y;let T,D,I,V,X,Z,ie,q,ne,M;switch(k){case"l":g+=w.shift(),y+=w.shift(),N="L",A.push(g,y);break;case"L":g=w.shift(),y=w.shift(),A.push(g,y);break;case"m":const W=w.shift(),L=w.shift();if(g+=W,y+=L,N="M",f.length>2&&f[f.length-1].command==="z"){for(let H=f.length-2;H>=0;H--)if(f[H].command==="M"){g=f[H].points[0]+W,y=f[H].points[1]+L;break}}A.push(g,y),k="l";break;case"M":g=w.shift(),y=w.shift(),N="M",A.push(g,y),k="L";break;case"h":g+=w.shift(),N="L",A.push(g,y);break;case"H":g=w.shift(),N="L",A.push(g,y);break;case"v":y+=w.shift(),N="L",A.push(g,y);break;case"V":y=w.shift(),N="L",A.push(g,y);break;case"C":A.push(w.shift(),w.shift(),w.shift(),w.shift()),g=w.shift(),y=w.shift(),A.push(g,y);break;case"c":A.push(g+w.shift(),y+w.shift(),g+w.shift(),y+w.shift()),g+=w.shift(),y+=w.shift(),N="C",A.push(g,y);break;case"S":D=g,I=y,T=f[f.length-1],T.command==="C"&&(D=g+(g-T.points[2]),I=y+(y-T.points[3])),A.push(D,I,w.shift(),w.shift()),g=w.shift(),y=w.shift(),N="C",A.push(g,y);break;case"s":D=g,I=y,T=f[f.length-1],T.command==="C"&&(D=g+(g-T.points[2]),I=y+(y-T.points[3])),A.push(D,I,g+w.shift(),y+w.shift()),g+=w.shift(),y+=w.shift(),N="C",A.push(g,y);break;case"Q":A.push(w.shift(),w.shift()),g=w.shift(),y=w.shift(),A.push(g,y);break;case"q":A.push(g+w.shift(),y+w.shift()),g+=w.shift(),y+=w.shift(),N="Q",A.push(g,y);break;case"T":D=g,I=y,T=f[f.length-1],T.command==="Q"&&(D=g+(g-T.points[0]),I=y+(y-T.points[1])),g=w.shift(),y=w.shift(),N="Q",A.push(D,I,g,y);break;case"t":D=g,I=y,T=f[f.length-1],T.command==="Q"&&(D=g+(g-T.points[0]),I=y+(y-T.points[1])),g+=w.shift(),y+=w.shift(),N="Q",A.push(D,I,g,y);break;case"A":V=w.shift(),X=w.shift(),Z=w.shift(),ie=w.shift(),q=w.shift(),ne=g,M=y,g=w.shift(),y=w.shift(),N="A",A=this.convertEndpointToCenterParameterization(ne,M,g,y,ie,q,V,X,Z);break;case"a":V=w.shift(),X=w.shift(),Z=w.shift(),ie=w.shift(),q=w.shift(),ne=g,M=y,g+=w.shift(),y+=w.shift(),N="A",A=this.convertEndpointToCenterParameterization(ne,M,g,y,ie,q,V,X,Z);break}f.push({command:N||k,points:A,start:{x:P,y:R},pathLength:this.calcLength(P,R,N||k,A)})}(k==="z"||k==="Z")&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f}static calcLength(i,l,c,d){let f,p,g,y;const v=s;switch(c){case"L":return v.getLineLength(i,l,d[0],d[1]);case"C":return(0,n.getCubicArcLength)([i,d[0],d[2],d[4]],[l,d[1],d[3],d[5]],1);case"Q":return(0,n.getQuadraticArcLength)([i,d[0],d[2]],[l,d[1],d[3]],1);case"A":f=0;const _=d[4],b=d[5],E=d[4]+b;let k=Math.PI/180;if(Math.abs(_-E)<k&&(k=Math.abs(_-E)),p=v.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],_,0),b<0)for(y=_-k;y>E;y-=k)g=v.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],y,0),f+=v.getLineLength(p.x,p.y,g.x,g.y),p=g;else for(y=_+k;y<E;y+=k)g=v.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],y,0),f+=v.getLineLength(p.x,p.y,g.x,g.y),p=g;return g=v.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],E,0),f+=v.getLineLength(p.x,p.y,g.x,g.y),f}return 0}static convertEndpointToCenterParameterization(i,l,c,d,f,p,g,y,v){const _=v*(Math.PI/180),b=Math.cos(_)*(i-c)/2+Math.sin(_)*(l-d)/2,E=-1*Math.sin(_)*(i-c)/2+Math.cos(_)*(l-d)/2,k=b*b/(g*g)+E*E/(y*y);k>1&&(g*=Math.sqrt(k),y*=Math.sqrt(k));let w=Math.sqrt((g*g*(y*y)-g*g*(E*E)-y*y*(b*b))/(g*g*(E*E)+y*y*(b*b)));f===p&&(w*=-1),isNaN(w)&&(w=0);const N=w*g*E/y,A=w*-y*b/g,P=(i+c)/2+Math.cos(_)*N-Math.sin(_)*A,R=(l+d)/2+Math.sin(_)*N+Math.cos(_)*A,T=function(q){return Math.sqrt(q[0]*q[0]+q[1]*q[1])},D=function(q,ne){return(q[0]*ne[0]+q[1]*ne[1])/(T(q)*T(ne))},I=function(q,ne){return(q[0]*ne[1]<q[1]*ne[0]?-1:1)*Math.acos(D(q,ne))},V=I([1,0],[(b-N)/g,(E-A)/y]),X=[(b-N)/g,(E-A)/y],Z=[(-1*b-N)/g,(-1*E-A)/y];let ie=I(X,Z);return D(X,Z)<=-1&&(ie=Math.PI),D(X,Z)>=1&&(ie=0),p===0&&ie>0&&(ie=ie-2*Math.PI),p===1&&ie<0&&(ie=ie+2*Math.PI),[P,R,g,y,V,ie,_,p]}}return Mg.Path=s,s.prototype.className="Path",s.prototype._attrsAffectingSize=["data"],(0,t._registerNode)(s),e.Factory.addGetterSetter(s,"data"),Mg}var vT;function _M(){if(vT)return Dg;vT=1,Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.Arrow=void 0;const e=Hr(),t=k6(),r=Vr(),n=Br(),s=ob();class a extends t.Line{_sceneFunc(l){super._sceneFunc(l);const c=Math.PI*2,d=this.points();let f=d;const p=this.tension()!==0&&d.length>4;p&&(f=this.getTensionPoints());const g=this.pointerLength(),y=d.length;let v,_;if(p){const k=[f[f.length-4],f[f.length-3],f[f.length-2],f[f.length-1],d[y-2],d[y-1]],w=s.Path.calcLength(f[f.length-4],f[f.length-3],"C",k),N=s.Path.getPointOnQuadraticBezier(Math.min(1,1-g/w),k[0],k[1],k[2],k[3],k[4],k[5]);v=d[y-2]-N.x,_=d[y-1]-N.y}else v=d[y-2]-d[y-4],_=d[y-1]-d[y-3];const b=(Math.atan2(_,v)+c)%c,E=this.pointerWidth();this.pointerAtEnding()&&(l.save(),l.beginPath(),l.translate(d[y-2],d[y-1]),l.rotate(b),l.moveTo(0,0),l.lineTo(-g,E/2),l.lineTo(-g,-E/2),l.closePath(),l.restore(),this.__fillStroke(l)),this.pointerAtBeginning()&&(l.save(),l.beginPath(),l.translate(d[0],d[1]),p?(v=(f[0]+f[2])/2-d[0],_=(f[1]+f[3])/2-d[1]):(v=d[2]-d[0],_=d[3]-d[1]),l.rotate((Math.atan2(-_,-v)+c)%c),l.moveTo(0,0),l.lineTo(-g,E/2),l.lineTo(-g,-E/2),l.closePath(),l.restore(),this.__fillStroke(l))}__fillStroke(l){const c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,l.setLineDash([])),l.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)}getSelfRect(){const l=super.getSelfRect(),c=this.pointerWidth()/2;return{x:l.x,y:l.y-c,width:l.width,height:l.height+c*2}}}return Dg.Arrow=a,a.prototype.className="Arrow",(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"pointerLength",10,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(a,"pointerWidth",10,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(a,"pointerAtBeginning",!1),e.Factory.addGetterSetter(a,"pointerAtEnding",!0),Dg}var Og={},wT;function bM(){if(wT)return Og;wT=1,Object.defineProperty(Og,"__esModule",{value:!0}),Og.Circle=void 0;const e=Hr(),t=sa(),r=Vr(),n=Br();class s extends t.Shape{_sceneFunc(i){i.beginPath(),i.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(i){this.radius()!==i/2&&this.radius(i/2)}setHeight(i){this.radius()!==i/2&&this.radius(i/2)}}return Og.Circle=s,s.prototype._centroid=!0,s.prototype.className="Circle",s.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(s),e.Factory.addGetterSetter(s,"radius",0,(0,r.getNumberValidator)()),Og}var Lg={},_T;function SM(){if(_T)return Lg;_T=1,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.Ellipse=void 0;const e=Hr(),t=sa(),r=Vr(),n=Br();class s extends t.Shape{_sceneFunc(i){const l=this.radiusX(),c=this.radiusY();i.beginPath(),i.save(),l!==c&&i.scale(1,c/l),i.arc(0,0,l,0,Math.PI*2,!1),i.restore(),i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(i){this.radiusX(i/2)}setHeight(i){this.radiusY(i/2)}}return Lg.Ellipse=s,s.prototype.className="Ellipse",s.prototype._centroid=!0,s.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,n._registerNode)(s),e.Factory.addComponentsGetterSetter(s,"radius",["x","y"]),e.Factory.addGetterSetter(s,"radiusX",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(s,"radiusY",0,(0,r.getNumberValidator)()),Lg}var Bg={},bT;function kM(){if(bT)return Bg;bT=1,Object.defineProperty(Bg,"__esModule",{value:!0}),Bg.Image=void 0;const e=ls(),t=Hr(),r=sa(),n=Br(),s=Vr();class a extends r.Shape{constructor(l){super(l),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",c=>{this._removeImageLoad(c.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const l=this.image();l&&l.complete||l&&l.readyState===4||l&&l.addEventListener&&l.addEventListener("load",this._loadListener)}_removeImageLoad(l){l&&l.removeEventListener&&l.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const l=!!this.cornerRadius(),c=this.hasShadow();return l&&c?!0:super._useBufferCanvas(!0)}_sceneFunc(l){const c=this.getWidth(),d=this.getHeight(),f=this.cornerRadius(),p=this.attrs.image;let g;if(p){const y=this.attrs.cropWidth,v=this.attrs.cropHeight;y&&v?g=[p,this.cropX(),this.cropY(),y,v,0,0,c,d]:g=[p,0,0,c,d]}(this.hasFill()||this.hasStroke()||f)&&(l.beginPath(),f?e.Util.drawRoundedRectPath(l,c,d,f):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)),p&&(f&&l.clip(),l.drawImage.apply(l,g))}_hitFunc(l){const c=this.width(),d=this.height(),f=this.cornerRadius();l.beginPath(),f?e.Util.drawRoundedRectPath(l,c,d,f):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)}getWidth(){var l,c;return(l=this.attrs.width)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.width}getHeight(){var l,c;return(l=this.attrs.height)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.height}static fromURL(l,c,d=null){const f=e.Util.createImageElement();f.onload=function(){const p=new a({image:f});c(p)},f.onerror=d,f.crossOrigin="Anonymous",f.src=l}}return Bg.Image=a,a.prototype.className="Image",(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),t.Factory.addGetterSetter(a,"image"),t.Factory.addComponentsGetterSetter(a,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(a,"cropX",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(a,"cropY",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(a,"cropWidth",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(a,"cropHeight",0,(0,s.getNumberValidator)()),Bg}var jd={},ST;function CM(){if(ST)return jd;ST=1,Object.defineProperty(jd,"__esModule",{value:!0}),jd.Tag=jd.Label=void 0;const e=Hr(),t=sa(),r=ab(),n=Vr(),s=Br(),a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],i="Change.konva",l="none",c="up",d="right",f="down",p="left",g=a.length;class y extends r.Group{constructor(b){super(b),this.on("add.konva",function(E){this._addListeners(E.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(b){let E=this,k;const w=function(){E._sync()};for(k=0;k<g;k++)b.on(a[k]+i,w)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let b=this.getText(),E=this.getTag(),k,w,N,A,P,R,T;if(b&&E){switch(k=b.width(),w=b.height(),N=E.pointerDirection(),A=E.pointerWidth(),T=E.pointerHeight(),P=0,R=0,N){case c:P=k/2,R=-1*T;break;case d:P=k+A,R=w/2;break;case f:P=k/2,R=w+T;break;case p:P=-1*A,R=w/2;break}E.setAttrs({x:-1*P,y:-1*R,width:k,height:w}),b.setAttrs({x:-1*P,y:-1*R})}}}jd.Label=y,y.prototype.className="Label",(0,s._registerNode)(y);class v extends t.Shape{_sceneFunc(b){const E=this.width(),k=this.height(),w=this.pointerDirection(),N=this.pointerWidth(),A=this.pointerHeight(),P=this.cornerRadius();let R=0,T=0,D=0,I=0;typeof P=="number"?R=T=D=I=Math.min(P,E/2,k/2):(R=Math.min(P[0]||0,E/2,k/2),T=Math.min(P[1]||0,E/2,k/2),I=Math.min(P[2]||0,E/2,k/2),D=Math.min(P[3]||0,E/2,k/2)),b.beginPath(),b.moveTo(R,0),w===c&&(b.lineTo((E-N)/2,0),b.lineTo(E/2,-1*A),b.lineTo((E+N)/2,0)),b.lineTo(E-T,0),b.arc(E-T,T,T,Math.PI*3/2,0,!1),w===d&&(b.lineTo(E,(k-A)/2),b.lineTo(E+N,k/2),b.lineTo(E,(k+A)/2)),b.lineTo(E,k-I),b.arc(E-I,k-I,I,0,Math.PI/2,!1),w===f&&(b.lineTo((E+N)/2,k),b.lineTo(E/2,k+A),b.lineTo((E-N)/2,k)),b.lineTo(D,k),b.arc(D,k-D,D,Math.PI/2,Math.PI,!1),w===p&&(b.lineTo(0,(k+A)/2),b.lineTo(-1*N,k/2),b.lineTo(0,(k-A)/2)),b.lineTo(0,R),b.arc(R,R,R,Math.PI,Math.PI*3/2,!1),b.closePath(),b.fillStrokeShape(this)}getSelfRect(){let b=0,E=0,k=this.pointerWidth(),w=this.pointerHeight(),N=this.pointerDirection(),A=this.width(),P=this.height();return N===c?(E-=w,P+=w):N===f?P+=w:N===p?(b-=k*1.5,A+=k):N===d&&(A+=k*1.5),{x:b,y:E,width:A,height:P}}}return jd.Tag=v,v.prototype.className="Tag",(0,s._registerNode)(v),e.Factory.addGetterSetter(v,"pointerDirection",l),e.Factory.addGetterSetter(v,"pointerWidth",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(v,"pointerHeight",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(v,"cornerRadius",0,(0,n.getNumberOrArrayOfNumbersValidator)(4)),jd}var Ug={},kT;function C6(){if(kT)return Ug;kT=1,Object.defineProperty(Ug,"__esModule",{value:!0}),Ug.Rect=void 0;const e=Hr(),t=sa(),r=Br(),n=ls(),s=Vr();class a extends t.Shape{_sceneFunc(l){const c=this.cornerRadius(),d=this.width(),f=this.height();l.beginPath(),c?n.Util.drawRoundedRectPath(l,d,f,c):l.rect(0,0,d,f),l.closePath(),l.fillStrokeShape(this)}}return Ug.Rect=a,a.prototype.className="Rect",(0,r._registerNode)(a),e.Factory.addGetterSetter(a,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),Ug}var $g={},CT;function TM(){if(CT)return $g;CT=1,Object.defineProperty($g,"__esModule",{value:!0}),$g.RegularPolygon=void 0;const e=Hr(),t=sa(),r=Vr(),n=Br();class s extends t.Shape{_sceneFunc(i){const l=this._getPoints();i.beginPath(),i.moveTo(l[0].x,l[0].y);for(let c=1;c<l.length;c++)i.lineTo(l[c].x,l[c].y);i.closePath(),i.fillStrokeShape(this)}_getPoints(){const i=this.attrs.sides,l=this.attrs.radius||0,c=[];for(let d=0;d<i;d++)c.push({x:l*Math.sin(d*2*Math.PI/i),y:-1*l*Math.cos(d*2*Math.PI/i)});return c}getSelfRect(){const i=this._getPoints();let l=i[0].x,c=i[0].y,d=i[0].x,f=i[0].y;return i.forEach(p=>{l=Math.min(l,p.x),c=Math.max(c,p.x),d=Math.min(d,p.y),f=Math.max(f,p.y)}),{x:l,y:d,width:c-l,height:f-d}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(i){this.radius(i/2)}setHeight(i){this.radius(i/2)}}return $g.RegularPolygon=s,s.prototype.className="RegularPolygon",s.prototype._centroid=!0,s.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(s),e.Factory.addGetterSetter(s,"radius",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(s,"sides",0,(0,r.getNumberValidator)()),$g}var Wg={},TT;function EM(){if(TT)return Wg;TT=1,Object.defineProperty(Wg,"__esModule",{value:!0}),Wg.Ring=void 0;const e=Hr(),t=sa(),r=Vr(),n=Br(),s=Math.PI*2;class a extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.innerRadius(),0,s,!1),l.moveTo(this.outerRadius(),0),l.arc(0,0,this.outerRadius(),s,0,!0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}}return Wg.Ring=a,a.prototype.className="Ring",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"innerRadius",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(a,"outerRadius",0,(0,r.getNumberValidator)()),Wg}var zg={},ET;function NM(){if(ET)return zg;ET=1,Object.defineProperty(zg,"__esModule",{value:!0}),zg.Sprite=void 0;const e=Hr(),t=sa(),r=ib(),n=Vr(),s=Br();class a extends t.Shape{constructor(l){super(l),this._updated=!0,this.anim=new r.Animation(()=>{const c=this._updated;return this._updated=!1,c}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(l){const c=this.animation(),d=this.frameIndex(),f=d*4,p=this.animations()[c],g=this.frameOffsets(),y=p[f+0],v=p[f+1],_=p[f+2],b=p[f+3],E=this.image();if((this.hasFill()||this.hasStroke())&&(l.beginPath(),l.rect(0,0,_,b),l.closePath(),l.fillStrokeShape(this)),E)if(g){const k=g[c],w=d*2;l.drawImage(E,y,v,_,b,k[w+0],k[w+1],_,b)}else l.drawImage(E,y,v,_,b,0,0,_,b)}_hitFunc(l){const c=this.animation(),d=this.frameIndex(),f=d*4,p=this.animations()[c],g=this.frameOffsets(),y=p[f+2],v=p[f+3];if(l.beginPath(),g){const _=g[c],b=d*2;l.rect(_[b+0],_[b+1],y,v)}else l.rect(0,0,y,v);l.closePath(),l.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const l=this;this.interval=setInterval(function(){l._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const l=this.getLayer();this.anim.setLayers(l),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const l=this.frameIndex(),c=this.animation(),d=this.animations(),f=d[c],p=f.length/4;l<p-1?this.frameIndex(l+1):this.frameIndex(0)}}return zg.Sprite=a,a.prototype.className="Sprite",(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"animation"),e.Factory.addGetterSetter(a,"animations"),e.Factory.addGetterSetter(a,"frameOffsets"),e.Factory.addGetterSetter(a,"image"),e.Factory.addGetterSetter(a,"frameIndex",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"frameRate",17,(0,n.getNumberValidator)()),e.Factory.backCompat(a,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),zg}var Hg={},NT;function AM(){if(NT)return Hg;NT=1,Object.defineProperty(Hg,"__esModule",{value:!0}),Hg.Star=void 0;const e=Hr(),t=sa(),r=Vr(),n=Br();class s extends t.Shape{_sceneFunc(i){const l=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();i.beginPath(),i.moveTo(0,0-c);for(let f=1;f<d*2;f++){const p=f%2===0?c:l,g=p*Math.sin(f*Math.PI/d),y=-1*p*Math.cos(f*Math.PI/d);i.lineTo(g,y)}i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(i){this.outerRadius(i/2)}setHeight(i){this.outerRadius(i/2)}}return Hg.Star=s,s.prototype.className="Star",s.prototype._centroid=!0,s.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(s),e.Factory.addGetterSetter(s,"numPoints",5,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(s,"innerRadius",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(s,"outerRadius",0,(0,r.getNumberValidator)()),Hg}var bh={},AT;function T6(){if(AT)return bh;AT=1,Object.defineProperty(bh,"__esModule",{value:!0}),bh.Text=void 0,bh.stringToArray=i;const e=ls(),t=Hr(),r=sa(),n=Br(),s=Vr(),a=Br();function i(B){return[...B].reduce((z,Q,Y,te)=>{if(new RegExp("\\p{Emoji}","u").test(Q)){const ee=te[Y+1];ee&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(ee)?(z.push(Q+ee),te[Y+1]=""):z.push(Q)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(Q+(te[Y+1]||""))?z.push(Q+te[Y+1]):Y>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(Q)?z[z.length-1]+=Q:Q&&z.push(Q);return z},[])}const l="auto",c="center",d="inherit",f="justify",p="Change.konva",g="2d",y="-",v="left",_="text",b="Text",E="top",k="bottom",w="middle",N="normal",A="px ",P=" ",R="right",T="rtl",D="word",I="char",V="none",X="…",Z=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],ie=Z.length;function q(B){return B.split(",").map(z=>{z=z.trim();const Q=z.indexOf(" ")>=0,Y=z.indexOf('"')>=0||z.indexOf("'")>=0;return Q&&!Y&&(z=`"${z}"`),z}).join(", ")}let ne;function M(){return ne||(ne=e.Util.createCanvasElement().getContext(g),ne)}function W(B){B.fillText(this._partialText,this._partialTextX,this._partialTextY)}function L(B){B.setAttr("miterLimit",2),B.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function H(B){return B=B||{},!B.fillLinearGradientColorStops&&!B.fillRadialGradientColorStops&&!B.fillPatternImage&&(B.fill=B.fill||"black"),B}class K extends r.Shape{constructor(z){super(H(z)),this._partialTextX=0,this._partialTextY=0;for(let Q=0;Q<ie;Q++)this.on(Z[Q]+p,this._setTextData);this._setTextData()}_sceneFunc(z){const Q=this.textArr,Y=Q.length;if(!this.text())return;let te=this.padding(),ee=this.fontSize(),ae=this.lineHeight()*ee,ge=this.verticalAlign(),_e=this.direction(),Me=0,ue=this.align(),me=this.getWidth(),He=this.letterSpacing(),qe=this.fill(),Xe=this.textDecoration(),Ve=Xe.indexOf("underline")!==-1,It=Xe.indexOf("line-through")!==-1,st;_e=_e===d?z.direction:_e;let Ie=ae/2,je=w;if(n.Konva._fixTextRendering){const Ze=this.measureSize("M");je="alphabetic",Ie=(Ze.fontBoundingBoxAscent-Ze.fontBoundingBoxDescent)/2+ae/2}for(_e===T&&z.setAttr("direction",_e),z.setAttr("font",this._getContextFont()),z.setAttr("textBaseline",je),z.setAttr("textAlign",v),ge===w?Me=(this.getHeight()-Y*ae-te*2)/2:ge===k&&(Me=this.getHeight()-Y*ae-te*2),z.translate(te,Me+te),st=0;st<Y;st++){let Ze=0,bt=0;const mt=Q[st],$t=mt.text,Wt=mt.width,lt=mt.lastInParagraph;if(z.save(),ue===R?Ze+=me-Wt-te*2:ue===c&&(Ze+=(me-Wt-te*2)/2),Ve){z.save(),z.beginPath();const Qe=n.Konva._fixTextRendering?Math.round(ee/4):Math.round(ee/2),yt=Ze,ft=Ie+bt+Qe;z.moveTo(yt,ft);const _t=ue===f&&!lt?me-te*2:Wt;z.lineTo(yt+Math.round(_t),ft),z.lineWidth=ee/15;const zt=this._getLinearGradient();z.strokeStyle=zt||qe,z.stroke(),z.restore()}if(It){z.save(),z.beginPath();const Qe=n.Konva._fixTextRendering?-Math.round(ee/4):0;z.moveTo(Ze,Ie+bt+Qe);const yt=ue===f&&!lt?me-te*2:Wt;z.lineTo(Ze+Math.round(yt),Ie+bt+Qe),z.lineWidth=ee/15;const ft=this._getLinearGradient();z.strokeStyle=ft||qe,z.stroke(),z.restore()}if(_e!==T&&(He!==0||ue===f)){const Qe=$t.split(" ").length-1,yt=i($t);for(let ft=0;ft<yt.length;ft++){const _t=yt[ft];_t===" "&&!lt&&ue===f&&(Ze+=(me-te*2-Wt)/Qe),this._partialTextX=Ze,this._partialTextY=Ie+bt,this._partialText=_t,z.fillStrokeShape(this),Ze+=this.measureSize(_t).width+He}}else He!==0&&z.setAttr("letterSpacing",`${He}px`),this._partialTextX=Ze,this._partialTextY=Ie+bt,this._partialText=$t,z.fillStrokeShape(this);z.restore(),Y>1&&(Ie+=ae)}}_hitFunc(z){const Q=this.getWidth(),Y=this.getHeight();z.beginPath(),z.rect(0,0,Q,Y),z.closePath(),z.fillStrokeShape(this)}setText(z){const Q=e.Util._isString(z)?z:z==null?"":z+"";return this._setAttr(_,Q),this}getWidth(){return this.attrs.width===l||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===l||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(z){var Q,Y,te,ee,ae,ge,_e,Me,ue,me,He;let qe=M(),Xe=this.fontSize(),Ve;qe.save(),qe.font=this._getContextFont(),Ve=qe.measureText(z),qe.restore();const It=Xe/100;return{actualBoundingBoxAscent:(Q=Ve.actualBoundingBoxAscent)!==null&&Q!==void 0?Q:71.58203125*It,actualBoundingBoxDescent:(Y=Ve.actualBoundingBoxDescent)!==null&&Y!==void 0?Y:0,actualBoundingBoxLeft:(te=Ve.actualBoundingBoxLeft)!==null&&te!==void 0?te:-7.421875*It,actualBoundingBoxRight:(ee=Ve.actualBoundingBoxRight)!==null&&ee!==void 0?ee:75.732421875*It,alphabeticBaseline:(ae=Ve.alphabeticBaseline)!==null&&ae!==void 0?ae:0,emHeightAscent:(ge=Ve.emHeightAscent)!==null&&ge!==void 0?ge:100*It,emHeightDescent:(_e=Ve.emHeightDescent)!==null&&_e!==void 0?_e:-20*It,fontBoundingBoxAscent:(Me=Ve.fontBoundingBoxAscent)!==null&&Me!==void 0?Me:91*It,fontBoundingBoxDescent:(ue=Ve.fontBoundingBoxDescent)!==null&&ue!==void 0?ue:21*It,hangingBaseline:(me=Ve.hangingBaseline)!==null&&me!==void 0?me:72.80000305175781*It,ideographicBaseline:(He=Ve.ideographicBaseline)!==null&&He!==void 0?He:-21*It,width:Ve.width,height:Xe}}_getContextFont(){return this.fontStyle()+P+this.fontVariant()+P+(this.fontSize()+A)+q(this.fontFamily())}_addTextLine(z){this.align()===f&&(z=z.trim());const Y=this._getTextWidth(z);return this.textArr.push({text:z,width:Y,lastInParagraph:!1})}_getTextWidth(z){const Q=this.letterSpacing(),Y=z.length;return M().measureText(z).width+Q*Y}_setTextData(){let z=this.text().split(`
`),Q=+this.fontSize(),Y=0,te=this.lineHeight()*Q,ee=this.attrs.width,ae=this.attrs.height,ge=ee!==l&&ee!==void 0,_e=ae!==l&&ae!==void 0,Me=this.padding(),ue=ee-Me*2,me=ae-Me*2,He=0,qe=this.wrap(),Xe=qe!==V,Ve=qe!==I&&Xe,It=this.ellipsis();this.textArr=[],M().font=this._getContextFont();const st=It?this._getTextWidth(X):0;for(let Ie=0,je=z.length;Ie<je;++Ie){let Ze=z[Ie],bt=this._getTextWidth(Ze);if(ge&&bt>ue)for(;Ze.length>0;){let mt=0,$t=i(Ze).length,Wt="",lt=0;for(;mt<$t;){const Qe=mt+$t>>>1,yt=i(Ze),ft=yt.slice(0,Qe+1).join(""),_t=this._getTextWidth(ft);(It&&_e&&He+te>me?_t+st:_t)<=ue?(mt=Qe+1,Wt=ft,lt=_t):$t=Qe}if(Wt){if(Ve){const ft=i(Ze),_t=i(Wt),zt=ft[_t.length],Jt=zt===P||zt===y;let De;if(Jt&&lt<=ue)De=_t.length;else{const ut=_t.lastIndexOf(P),pt=_t.lastIndexOf(y);De=Math.max(ut,pt)+1}De>0&&(mt=De,Wt=ft.slice(0,mt).join(""),lt=this._getTextWidth(Wt))}if(Wt=Wt.trimRight(),this._addTextLine(Wt),Y=Math.max(Y,lt),He+=te,this._shouldHandleEllipsis(He)){this._tryToAddEllipsisToLastLine();break}if(Ze=i(Ze).slice(mt).join("").trimLeft(),Ze.length>0&&(bt=this._getTextWidth(Ze),bt<=ue)){this._addTextLine(Ze),He+=te,Y=Math.max(Y,bt);break}}else break}else this._addTextLine(Ze),He+=te,Y=Math.max(Y,bt),this._shouldHandleEllipsis(He)&&Ie<je-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),_e&&He+te>me)break}this.textHeight=Q,this.textWidth=Y}_shouldHandleEllipsis(z){const Q=+this.fontSize(),Y=this.lineHeight()*Q,te=this.attrs.height,ee=te!==l&&te!==void 0,ae=this.padding(),ge=te-ae*2;return!(this.wrap()!==V)||ee&&z+Y>ge}_tryToAddEllipsisToLastLine(){const z=this.attrs.width,Q=z!==l&&z!==void 0,Y=this.padding(),te=z-Y*2,ee=this.ellipsis(),ae=this.textArr[this.textArr.length-1];!ae||!ee||(Q&&(this._getTextWidth(ae.text+X)<te||(ae.text=ae.text.slice(0,ae.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(ae.text+X))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const z=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,Q=this.hasShadow();return z&&Q?!0:super._useBufferCanvas()}}return bh.Text=K,K.prototype._fillFunc=W,K.prototype._strokeFunc=L,K.prototype.className=b,K.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,a._registerNode)(K),t.Factory.overWriteSetter(K,"width",(0,s.getNumberOrAutoValidator)()),t.Factory.overWriteSetter(K,"height",(0,s.getNumberOrAutoValidator)()),t.Factory.addGetterSetter(K,"direction",d),t.Factory.addGetterSetter(K,"fontFamily","Arial"),t.Factory.addGetterSetter(K,"fontSize",12,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(K,"fontStyle",N),t.Factory.addGetterSetter(K,"fontVariant",N),t.Factory.addGetterSetter(K,"padding",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(K,"align",v),t.Factory.addGetterSetter(K,"verticalAlign",E),t.Factory.addGetterSetter(K,"lineHeight",1,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(K,"wrap",D),t.Factory.addGetterSetter(K,"ellipsis",!1,(0,s.getBooleanValidator)()),t.Factory.addGetterSetter(K,"letterSpacing",0,(0,s.getNumberValidator)()),t.Factory.addGetterSetter(K,"text","",(0,s.getStringValidator)()),t.Factory.addGetterSetter(K,"textDecoration",""),bh}var Gg={},jT;function jM(){if(jT)return Gg;jT=1,Object.defineProperty(Gg,"__esModule",{value:!0}),Gg.TextPath=void 0;const e=ls(),t=Hr(),r=sa(),n=ob(),s=T6(),a=Vr(),i=Br(),l="",c="normal";function d(g){g.fillText(this.partialText,0,0)}function f(g){g.strokeText(this.partialText,0,0)}class p extends r.Shape{constructor(y){super(y),this.dummyCanvas=e.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return n.Path.getPathLength(this.dataArray)}_getPointAtLength(y){if(!this.attrs.data)return null;const v=this.pathLength;return y-1>v?null:n.Path.getPointAtLengthOfDataArray(y,this.dataArray)}_readDataAttribute(){this.dataArray=n.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(y){y.setAttr("font",this._getContextFont()),y.setAttr("textBaseline",this.textBaseline()),y.setAttr("textAlign","left"),y.save();const v=this.textDecoration(),_=this.fill(),b=this.fontSize(),E=this.glyphInfo;v==="underline"&&y.beginPath();for(let k=0;k<E.length;k++){y.save();const w=E[k].p0;y.translate(w.x,w.y),y.rotate(E[k].rotation),this.partialText=E[k].text,y.fillStrokeShape(this),v==="underline"&&(k===0&&y.moveTo(0,b/2+1),y.lineTo(b,b/2+1)),y.restore()}v==="underline"&&(y.strokeStyle=_,y.lineWidth=b/20,y.stroke()),y.restore()}_hitFunc(y){y.beginPath();const v=this.glyphInfo;if(v.length>=1){const _=v[0].p0;y.moveTo(_.x,_.y)}for(let _=0;_<v.length;_++){const b=v[_].p1;y.lineTo(b.x,b.y)}y.setAttr("lineWidth",this.fontSize()),y.setAttr("strokeStyle",this.colorKey),y.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(y){return s.Text.prototype.setText.call(this,y)}_getContextFont(){return s.Text.prototype._getContextFont.call(this)}_getTextSize(y){const _=this.dummyCanvas.getContext("2d");_.save(),_.font=this._getContextFont();const b=_.measureText(y);return _.restore(),{width:b.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:y,height:v}=this._getTextSize(this.attrs.text);if(this.textWidth=y,this.textHeight=v,this.glyphInfo=[],!this.attrs.data)return null;const _=this.letterSpacing(),b=this.align(),E=this.kerningFunc(),k=Math.max(this.textWidth+((this.attrs.text||"").length-1)*_,0);let w=0;b==="center"&&(w=Math.max(0,this.pathLength/2-k/2)),b==="right"&&(w=Math.max(0,this.pathLength-k));const N=(0,s.stringToArray)(this.text());let A=w;for(let P=0;P<N.length;P++){const R=this._getPointAtLength(A);if(!R)return;let T=this._getTextSize(N[P]).width+_;if(N[P]===" "&&b==="justify"){const ie=this.text().split(" ").length-1;T+=(this.pathLength-k)/ie}const D=this._getPointAtLength(A+T);if(!D)return;const I=n.Path.getLineLength(R.x,R.y,D.x,D.y);let V=0;if(E)try{V=E(N[P-1],N[P])*this.fontSize()}catch{V=0}R.x+=V,D.x+=V,this.textWidth+=V;const X=n.Path.getPointOnLine(V+I/2,R.x,R.y,D.x,D.y),Z=Math.atan2(D.y-R.y,D.x-R.x);this.glyphInfo.push({transposeX:X.x,transposeY:X.y,text:N[P],rotation:Z,p0:R,p1:D}),A+=T}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const y=[];this.glyphInfo.forEach(function(A){y.push(A.p0.x),y.push(A.p0.y),y.push(A.p1.x),y.push(A.p1.y)});let v=y[0]||0,_=y[0]||0,b=y[1]||0,E=y[1]||0,k,w;for(let A=0;A<y.length/2;A++)k=y[A*2],w=y[A*2+1],v=Math.min(v,k),_=Math.max(_,k),b=Math.min(b,w),E=Math.max(E,w);const N=this.fontSize();return{x:v-N/2,y:b-N/2,width:_-v+N,height:E-b+N}}destroy(){return e.Util.releaseCanvas(this.dummyCanvas),super.destroy()}}return Gg.TextPath=p,p.prototype._fillFunc=d,p.prototype._strokeFunc=f,p.prototype._fillFuncHit=d,p.prototype._strokeFuncHit=f,p.prototype.className="TextPath",p.prototype._attrsAffectingSize=["text","fontSize","data"],(0,i._registerNode)(p),t.Factory.addGetterSetter(p,"data"),t.Factory.addGetterSetter(p,"fontFamily","Arial"),t.Factory.addGetterSetter(p,"fontSize",12,(0,a.getNumberValidator)()),t.Factory.addGetterSetter(p,"fontStyle",c),t.Factory.addGetterSetter(p,"align","left"),t.Factory.addGetterSetter(p,"letterSpacing",0,(0,a.getNumberValidator)()),t.Factory.addGetterSetter(p,"textBaseline","middle"),t.Factory.addGetterSetter(p,"fontVariant",c),t.Factory.addGetterSetter(p,"text",l),t.Factory.addGetterSetter(p,"textDecoration",""),t.Factory.addGetterSetter(p,"kerningFunc",void 0),Gg}var Vg={},FT;function FM(){if(FT)return Vg;FT=1,Object.defineProperty(Vg,"__esModule",{value:!0}),Vg.Transformer=void 0;const e=ls(),t=Hr(),r=vs(),n=sa(),s=C6(),a=ab(),i=Br(),l=Vr(),c=Br(),d="tr-konva",f=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(T=>T+`.${d}`).join(" "),p="nodesRect",g=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],y={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},v="ontouchstart"in i.Konva._global;function _(T,D,I){if(T==="rotater")return I;D+=e.Util.degToRad(y[T]||0);const V=(e.Util.radToDeg(D)%360+360)%360;return e.Util._inRange(V,315+22.5,360)||e.Util._inRange(V,0,22.5)?"ns-resize":e.Util._inRange(V,45-22.5,45+22.5)?"nesw-resize":e.Util._inRange(V,90-22.5,90+22.5)?"ew-resize":e.Util._inRange(V,135-22.5,135+22.5)?"nwse-resize":e.Util._inRange(V,180-22.5,180+22.5)?"ns-resize":e.Util._inRange(V,225-22.5,225+22.5)?"nesw-resize":e.Util._inRange(V,270-22.5,270+22.5)?"ew-resize":e.Util._inRange(V,315-22.5,315+22.5)?"nwse-resize":(e.Util.error("Transformer has unknown angle for cursor detection: "+V),"pointer")}const b=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function E(T){return{x:T.x+T.width/2*Math.cos(T.rotation)+T.height/2*Math.sin(-T.rotation),y:T.y+T.height/2*Math.cos(T.rotation)+T.width/2*Math.sin(T.rotation)}}function k(T,D,I){const V=I.x+(T.x-I.x)*Math.cos(D)-(T.y-I.y)*Math.sin(D),X=I.y+(T.x-I.x)*Math.sin(D)+(T.y-I.y)*Math.cos(D);return{...T,rotation:T.rotation+D,x:V,y:X}}function w(T,D){const I=E(T);return k(T,D,I)}function N(T,D,I){let V=D;for(let X=0;X<T.length;X++){const Z=i.Konva.getAngle(T[X]),ie=Math.abs(Z-D)%(Math.PI*2);Math.min(ie,Math.PI*2-ie)<I&&(V=Z)}return V}let A=0;class P extends a.Group{constructor(D){super(D),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(f,this.update),this.getNode()&&this.update()}attachTo(D){return this.setNode(D),this}setNode(D){return e.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([D])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return d+this._id}setNodes(D=[]){this._nodes&&this._nodes.length&&this.detach();const I=D.filter(X=>X.isAncestorOf(this)?(e.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=D=I,D.length===1&&this.useSingleNodeRotation()?this.rotation(D[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(X=>{const Z=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(X._attrsAffectingSize.length){const ie=X._attrsAffectingSize.map(q=>q+"Change."+this._getEventNamespace()).join(" ");X.on(ie,Z)}X.on(g.map(ie=>ie+`.${this._getEventNamespace()}`).join(" "),Z),X.on(`absoluteTransformChange.${this._getEventNamespace()}`,Z),this._proxyDrag(X)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(D){let I;D.on(`dragstart.${this._getEventNamespace()}`,V=>{I=D.getAbsolutePosition(),!this.isDragging()&&D!==this.findOne(".back")&&this.startDrag(V,!1)}),D.on(`dragmove.${this._getEventNamespace()}`,V=>{if(!I)return;const X=D.getAbsolutePosition(),Z=X.x-I.x,ie=X.y-I.y;this.nodes().forEach(q=>{if(q===D||q.isDragging())return;const ne=q.getAbsolutePosition();q.setAbsolutePosition({x:ne.x+Z,y:ne.y+ie}),q.startDrag(V)}),I=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(D=>{D.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(p),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(p,this.__getNodeRect)}__getNodeShape(D,I=this.rotation(),V){const X=D.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),Z=D.getAbsoluteScale(V),ie=D.getAbsolutePosition(V),q=X.x*Z.x-D.offsetX()*Z.x,ne=X.y*Z.y-D.offsetY()*Z.y,M=(i.Konva.getAngle(D.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),W={x:ie.x+q*Math.cos(M)+ne*Math.sin(-M),y:ie.y+ne*Math.cos(M)+q*Math.sin(M),width:X.width*Z.x,height:X.height*Z.y,rotation:M};return k(W,-i.Konva.getAngle(I),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const I=[];this.nodes().map(M=>{const W=M.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),L=[{x:W.x,y:W.y},{x:W.x+W.width,y:W.y},{x:W.x+W.width,y:W.y+W.height},{x:W.x,y:W.y+W.height}],H=M.getAbsoluteTransform();L.forEach(function(K){const B=H.point(K);I.push(B)})});const V=new e.Transform;V.rotate(-i.Konva.getAngle(this.rotation()));let X=1/0,Z=1/0,ie=-1/0,q=-1/0;I.forEach(function(M){const W=V.point(M);X===void 0&&(X=ie=W.x,Z=q=W.y),X=Math.min(X,W.x),Z=Math.min(Z,W.y),ie=Math.max(ie,W.x),q=Math.max(q,W.y)}),V.invert();const ne=V.point({x:X,y:Z});return{x:ne.x,y:ne.y,width:ie-X,height:q-Z,rotation:i.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),b.forEach(D=>{this._createAnchor(D)}),this._createAnchor("rotater")}_createAnchor(D){const I=new s.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:D+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:v?10:"auto"}),V=this;I.on("mousedown touchstart",function(X){V._handleMouseDown(X)}),I.on("dragstart",X=>{I.stopDrag(),X.cancelBubble=!0}),I.on("dragend",X=>{X.cancelBubble=!0}),I.on("mouseenter",()=>{const X=i.Konva.getAngle(this.rotation()),Z=this.rotateAnchorCursor(),ie=_(D,X,Z);I.getStage().content&&(I.getStage().content.style.cursor=ie),this._cursorChange=!0}),I.on("mouseout",()=>{I.getStage().content&&(I.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(I)}_createBack(){const D=new n.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(I,V){const X=V.getParent(),Z=X.padding();I.beginPath(),I.rect(-Z,-Z,V.width()+Z*2,V.height()+Z*2),I.moveTo(V.width()/2,-Z),X.rotateEnabled()&&X.rotateLineVisible()&&I.lineTo(V.width()/2,-X.rotateAnchorOffset()*e.Util._sign(V.height())-Z),I.fillStrokeShape(V)},hitFunc:(I,V)=>{if(!this.shouldOverdrawWholeArea())return;const X=this.padding();I.beginPath(),I.rect(-X,-X,V.width()+X*2,V.height()+X*2),I.fillStrokeShape(V)}});this.add(D),this._proxyDrag(D),D.on("dragstart",I=>{I.cancelBubble=!0}),D.on("dragmove",I=>{I.cancelBubble=!0}),D.on("dragend",I=>{I.cancelBubble=!0}),this.on("dragmove",I=>{this.update()})}_handleMouseDown(D){if(this._transforming)return;this._movingAnchorName=D.target.name().split(" ")[0];const I=this._getNodeRect(),V=I.width,X=I.height,Z=Math.sqrt(Math.pow(V,2)+Math.pow(X,2));this.sin=Math.abs(X/Z),this.cos=Math.abs(V/Z),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const ie=D.target.getAbsolutePosition(),q=D.target.getStage().getPointerPosition();this._anchorDragOffset={x:q.x-ie.x,y:q.y-ie.y},A++,this._fire("transformstart",{evt:D.evt,target:this.getNode()}),this._nodes.forEach(ne=>{ne._fire("transformstart",{evt:D.evt,target:ne})})}_handleMouseMove(D){let I,V,X;const Z=this.findOne("."+this._movingAnchorName),ie=Z.getStage();ie.setPointersPositions(D);const q=ie.getPointerPosition();let ne={x:q.x-this._anchorDragOffset.x,y:q.y-this._anchorDragOffset.y};const M=Z.getAbsolutePosition();this.anchorDragBoundFunc()&&(ne=this.anchorDragBoundFunc()(M,ne,D)),Z.setAbsolutePosition(ne);const W=Z.getAbsolutePosition();if(M.x===W.x&&M.y===W.y)return;if(this._movingAnchorName==="rotater"){const te=this._getNodeRect();I=Z.x()-te.width/2,V=-Z.y()+te.height/2;let ee=Math.atan2(-V,I)+Math.PI/2;te.height<0&&(ee-=Math.PI);const ge=i.Konva.getAngle(this.rotation())+ee,_e=i.Konva.getAngle(this.rotationSnapTolerance()),ue=N(this.rotationSnaps(),ge,_e)-te.rotation,me=w(te,ue);this._fitNodesInto(me,D);return}const L=this.shiftBehavior();let H;L==="inverted"?H=this.keepRatio()&&!D.shiftKey:L==="none"?H=this.keepRatio():H=this.keepRatio()||D.shiftKey;let K=this.centeredScaling()||D.altKey;if(this._movingAnchorName==="top-left"){if(H){const te=K?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};X=Math.sqrt(Math.pow(te.x-Z.x(),2)+Math.pow(te.y-Z.y(),2));const ee=this.findOne(".top-left").x()>te.x?-1:1,ae=this.findOne(".top-left").y()>te.y?-1:1;I=X*this.cos*ee,V=X*this.sin*ae,this.findOne(".top-left").x(te.x-I),this.findOne(".top-left").y(te.y-V)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(Z.y());else if(this._movingAnchorName==="top-right"){if(H){const te=K?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};X=Math.sqrt(Math.pow(Z.x()-te.x,2)+Math.pow(te.y-Z.y(),2));const ee=this.findOne(".top-right").x()<te.x?-1:1,ae=this.findOne(".top-right").y()>te.y?-1:1;I=X*this.cos*ee,V=X*this.sin*ae,this.findOne(".top-right").x(te.x+I),this.findOne(".top-right").y(te.y-V)}var B=Z.position();this.findOne(".top-left").y(B.y),this.findOne(".bottom-right").x(B.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(Z.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(Z.x());else if(this._movingAnchorName==="bottom-left"){if(H){const te=K?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};X=Math.sqrt(Math.pow(te.x-Z.x(),2)+Math.pow(Z.y()-te.y,2));const ee=te.x<Z.x()?-1:1,ae=Z.y()<te.y?-1:1;I=X*this.cos*ee,V=X*this.sin*ae,Z.x(te.x-I),Z.y(te.y+V)}B=Z.position(),this.findOne(".top-left").x(B.x),this.findOne(".bottom-right").y(B.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(Z.y());else if(this._movingAnchorName==="bottom-right"){if(H){const te=K?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};X=Math.sqrt(Math.pow(Z.x()-te.x,2)+Math.pow(Z.y()-te.y,2));const ee=this.findOne(".bottom-right").x()<te.x?-1:1,ae=this.findOne(".bottom-right").y()<te.y?-1:1;I=X*this.cos*ee,V=X*this.sin*ae,this.findOne(".bottom-right").x(te.x+I),this.findOne(".bottom-right").y(te.y+V)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(K=this.centeredScaling()||D.altKey,K){const te=this.findOne(".top-left"),ee=this.findOne(".bottom-right"),ae=te.x(),ge=te.y(),_e=this.getWidth()-ee.x(),Me=this.getHeight()-ee.y();ee.move({x:-ae,y:-ge}),te.move({x:_e,y:Me})}const z=this.findOne(".top-left").getAbsolutePosition();I=z.x,V=z.y;const Q=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),Y=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:I,y:V,width:Q,height:Y,rotation:i.Konva.getAngle(this.rotation())},D)}_handleMouseUp(D){this._removeEvents(D)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(D){var I;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const V=this.getNode();A--,this._fire("transformend",{evt:D,target:V}),(I=this.getLayer())===null||I===void 0||I.batchDraw(),V&&this._nodes.forEach(X=>{var Z;X._fire("transformend",{evt:D,target:X}),(Z=X.getLayer())===null||Z===void 0||Z.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(D,I){const V=this._getNodeRect(),X=1;if(e.Util._inRange(D.width,-this.padding()*2-X,X)){this.update();return}if(e.Util._inRange(D.height,-this.padding()*2-X,X)){this.update();return}const Z=new e.Transform;if(Z.rotate(i.Konva.getAngle(this.rotation())),this._movingAnchorName&&D.width<0&&this._movingAnchorName.indexOf("left")>=0){const H=Z.point({x:-this.padding()*2,y:0});D.x+=H.x,D.y+=H.y,D.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=H.x,this._anchorDragOffset.y-=H.y}else if(this._movingAnchorName&&D.width<0&&this._movingAnchorName.indexOf("right")>=0){const H=Z.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=H.x,this._anchorDragOffset.y-=H.y,D.width+=this.padding()*2}if(this._movingAnchorName&&D.height<0&&this._movingAnchorName.indexOf("top")>=0){const H=Z.point({x:0,y:-this.padding()*2});D.x+=H.x,D.y+=H.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=H.x,this._anchorDragOffset.y-=H.y,D.height+=this.padding()*2}else if(this._movingAnchorName&&D.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const H=Z.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=H.x,this._anchorDragOffset.y-=H.y,D.height+=this.padding()*2}if(this.boundBoxFunc()){const H=this.boundBoxFunc()(V,D);H?D=H:e.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const ie=1e7,q=new e.Transform;q.translate(V.x,V.y),q.rotate(V.rotation),q.scale(V.width/ie,V.height/ie);const ne=new e.Transform,M=D.width/ie,W=D.height/ie;this.flipEnabled()===!1?(ne.translate(D.x,D.y),ne.rotate(D.rotation),ne.translate(D.width<0?D.width:0,D.height<0?D.height:0),ne.scale(Math.abs(M),Math.abs(W))):(ne.translate(D.x,D.y),ne.rotate(D.rotation),ne.scale(M,W));const L=ne.multiply(q.invert());this._nodes.forEach(H=>{var K;const B=H.getParent().getAbsoluteTransform(),z=H.getTransform().copy();z.translate(H.offsetX(),H.offsetY());const Q=new e.Transform;Q.multiply(B.copy().invert()).multiply(L).multiply(B).multiply(z);const Y=Q.decompose();H.setAttrs(Y),(K=H.getLayer())===null||K===void 0||K.batchDraw()}),this.rotation(e.Util._getRotation(D.rotation)),this._nodes.forEach(H=>{this._fire("transform",{evt:I,target:H}),H._fire("transform",{evt:I,target:H})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(D,I){this.findOne(D).setAttrs(I)}update(){var D;const I=this._getNodeRect();this.rotation(e.Util._getRotation(I.rotation));const V=I.width,X=I.height,Z=this.enabledAnchors(),ie=this.resizeEnabled(),q=this.padding(),ne=this.anchorSize(),M=this.find("._anchor");M.forEach(L=>{L.setAttrs({width:ne,height:ne,offsetX:ne/2,offsetY:ne/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:ne/2+q,offsetY:ne/2+q,visible:ie&&Z.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:V/2,y:0,offsetY:ne/2+q,visible:ie&&Z.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:V,y:0,offsetX:ne/2-q,offsetY:ne/2+q,visible:ie&&Z.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:X/2,offsetX:ne/2+q,visible:ie&&Z.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:V,y:X/2,offsetX:ne/2-q,visible:ie&&Z.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:X,offsetX:ne/2+q,offsetY:ne/2-q,visible:ie&&Z.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:V/2,y:X,offsetY:ne/2-q,visible:ie&&Z.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:V,y:X,offsetX:ne/2-q,offsetY:ne/2-q,visible:ie&&Z.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:V/2,y:-this.rotateAnchorOffset()*e.Util._sign(X)-q,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:V,height:X,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const W=this.anchorStyleFunc();W&&M.forEach(L=>{W(L)}),(D=this.getLayer())===null||D===void 0||D.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const D=this.findOne("."+this._movingAnchorName);D&&D.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),a.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return r.Node.prototype.toObject.call(this)}clone(D){return r.Node.prototype.clone.call(this,D)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}Vg.Transformer=P,P.isTransforming=()=>A>0;function R(T){return T instanceof Array||e.Util.warn("enabledAnchors value should be an array"),T instanceof Array&&T.forEach(function(D){b.indexOf(D)===-1&&e.Util.warn("Unknown anchor name: "+D+". Available names are: "+b.join(", "))}),T||[]}return P.prototype.className="Transformer",(0,c._registerNode)(P),t.Factory.addGetterSetter(P,"enabledAnchors",b,R),t.Factory.addGetterSetter(P,"flipEnabled",!0,(0,l.getBooleanValidator)()),t.Factory.addGetterSetter(P,"resizeEnabled",!0),t.Factory.addGetterSetter(P,"anchorSize",10,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"rotateEnabled",!0),t.Factory.addGetterSetter(P,"rotateLineVisible",!0),t.Factory.addGetterSetter(P,"rotationSnaps",[]),t.Factory.addGetterSetter(P,"rotateAnchorOffset",50,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"rotateAnchorCursor","crosshair"),t.Factory.addGetterSetter(P,"rotationSnapTolerance",5,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderEnabled",!0),t.Factory.addGetterSetter(P,"anchorStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(P,"anchorStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"anchorFill","white"),t.Factory.addGetterSetter(P,"anchorCornerRadius",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(P,"borderStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderDash"),t.Factory.addGetterSetter(P,"keepRatio",!0),t.Factory.addGetterSetter(P,"shiftBehavior","default"),t.Factory.addGetterSetter(P,"centeredScaling",!1),t.Factory.addGetterSetter(P,"ignoreStroke",!1),t.Factory.addGetterSetter(P,"padding",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(P,"nodes"),t.Factory.addGetterSetter(P,"node"),t.Factory.addGetterSetter(P,"boundBoxFunc"),t.Factory.addGetterSetter(P,"anchorDragBoundFunc"),t.Factory.addGetterSetter(P,"anchorStyleFunc"),t.Factory.addGetterSetter(P,"shouldOverdrawWholeArea",!1),t.Factory.addGetterSetter(P,"useSingleNodeRotation",!0),t.Factory.backCompat(P,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),Vg}var Kg={},PT;function PM(){if(PT)return Kg;PT=1,Object.defineProperty(Kg,"__esModule",{value:!0}),Kg.Wedge=void 0;const e=Hr(),t=sa(),r=Br(),n=Vr(),s=Br();class a extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.radius(),0,r.Konva.getAngle(this.angle()),this.clockwise()),l.lineTo(0,0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius(l/2)}setHeight(l){this.radius(l/2)}}return Kg.Wedge=a,a.prototype.className="Wedge",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"radius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"clockwise",!1),e.Factory.backCompat(a,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Kg}var qg={},RT;function RM(){if(RT)return qg;RT=1,Object.defineProperty(qg,"__esModule",{value:!0}),qg.Blur=void 0;const e=Hr(),t=vs(),r=Vr();function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const s=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],a=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function i(c,d){const f=c.data,p=c.width,g=c.height;let y,v,_,b,E,k,w,N,A,P,R,T,D,I,V,X,Z,ie,q,ne;const M=d+d+1,W=p-1,L=g-1,H=d+1,K=H*(H+1)/2,B=new n,z=s[d],Q=a[d];let Y=null,te=B,ee=null,ae=null;for(let ge=1;ge<M;ge++)te=te.next=new n,ge===H&&(Y=te);te.next=B,_=v=0;for(let ge=0;ge<g;ge++){T=D=I=V=b=E=k=w=0,N=H*(X=f[v]),A=H*(Z=f[v+1]),P=H*(ie=f[v+2]),R=H*(q=f[v+3]),b+=K*X,E+=K*Z,k+=K*ie,w+=K*q,te=B;for(let _e=0;_e<H;_e++)te.r=X,te.g=Z,te.b=ie,te.a=q,te=te.next;for(let _e=1;_e<H;_e++)y=v+((W<_e?W:_e)<<2),b+=(te.r=X=f[y])*(ne=H-_e),E+=(te.g=Z=f[y+1])*ne,k+=(te.b=ie=f[y+2])*ne,w+=(te.a=q=f[y+3])*ne,T+=X,D+=Z,I+=ie,V+=q,te=te.next;ee=B,ae=Y;for(let _e=0;_e<p;_e++)f[v+3]=q=w*z>>Q,q!==0?(q=255/q,f[v]=(b*z>>Q)*q,f[v+1]=(E*z>>Q)*q,f[v+2]=(k*z>>Q)*q):f[v]=f[v+1]=f[v+2]=0,b-=N,E-=A,k-=P,w-=R,N-=ee.r,A-=ee.g,P-=ee.b,R-=ee.a,y=_+((y=_e+d+1)<W?y:W)<<2,T+=ee.r=f[y],D+=ee.g=f[y+1],I+=ee.b=f[y+2],V+=ee.a=f[y+3],b+=T,E+=D,k+=I,w+=V,ee=ee.next,N+=X=ae.r,A+=Z=ae.g,P+=ie=ae.b,R+=q=ae.a,T-=X,D-=Z,I-=ie,V-=q,ae=ae.next,v+=4;_+=p}for(let ge=0;ge<p;ge++){D=I=V=T=E=k=w=b=0,v=ge<<2,N=H*(X=f[v]),A=H*(Z=f[v+1]),P=H*(ie=f[v+2]),R=H*(q=f[v+3]),b+=K*X,E+=K*Z,k+=K*ie,w+=K*q,te=B;for(let Me=0;Me<H;Me++)te.r=X,te.g=Z,te.b=ie,te.a=q,te=te.next;let _e=p;for(let Me=1;Me<=d;Me++)v=_e+ge<<2,b+=(te.r=X=f[v])*(ne=H-Me),E+=(te.g=Z=f[v+1])*ne,k+=(te.b=ie=f[v+2])*ne,w+=(te.a=q=f[v+3])*ne,T+=X,D+=Z,I+=ie,V+=q,te=te.next,Me<L&&(_e+=p);v=ge,ee=B,ae=Y;for(let Me=0;Me<g;Me++)y=v<<2,f[y+3]=q=w*z>>Q,q>0?(q=255/q,f[y]=(b*z>>Q)*q,f[y+1]=(E*z>>Q)*q,f[y+2]=(k*z>>Q)*q):f[y]=f[y+1]=f[y+2]=0,b-=N,E-=A,k-=P,w-=R,N-=ee.r,A-=ee.g,P-=ee.b,R-=ee.a,y=ge+((y=Me+H)<L?y:L)*p<<2,b+=T+=ee.r=f[y],E+=D+=ee.g=f[y+1],k+=I+=ee.b=f[y+2],w+=V+=ee.a=f[y+3],ee=ee.next,N+=X=ae.r,A+=Z=ae.g,P+=ie=ae.b,R+=q=ae.a,T-=X,D-=Z,I-=ie,V-=q,ae=ae.next,v+=p}}const l=function(d){const f=Math.round(this.blurRadius());f>0&&i(d,f)};return qg.Blur=l,e.Factory.addGetterSetter(t.Node,"blurRadius",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),qg}var Xg={},DT;function DM(){if(DT)return Xg;DT=1,Object.defineProperty(Xg,"__esModule",{value:!0}),Xg.Brighten=void 0;const e=Hr(),t=vs(),r=Vr(),n=function(s){const a=this.brightness()*255,i=s.data,l=i.length;for(let c=0;c<l;c+=4)i[c]+=a,i[c+1]+=a,i[c+2]+=a};return Xg.Brighten=n,e.Factory.addGetterSetter(t.Node,"brightness",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),Xg}var Yg={},IT;function IM(){if(IT)return Yg;IT=1,Object.defineProperty(Yg,"__esModule",{value:!0}),Yg.Contrast=void 0;const e=Hr(),t=vs(),r=Vr(),n=function(s){const a=Math.pow((this.contrast()+100)/100,2),i=s.data,l=i.length;let c=150,d=150,f=150;for(let p=0;p<l;p+=4)c=i[p],d=i[p+1],f=i[p+2],c/=255,c-=.5,c*=a,c+=.5,c*=255,d/=255,d-=.5,d*=a,d+=.5,d*=255,f/=255,f-=.5,f*=a,f+=.5,f*=255,c=c<0?0:c>255?255:c,d=d<0?0:d>255?255:d,f=f<0?0:f>255?255:f,i[p]=c,i[p+1]=d,i[p+2]=f};return Yg.Contrast=n,e.Factory.addGetterSetter(t.Node,"contrast",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),Yg}var Qg={},MT;function MM(){if(MT)return Qg;MT=1,Object.defineProperty(Qg,"__esModule",{value:!0}),Qg.Emboss=void 0;const e=Hr(),t=vs(),r=ls(),n=Vr(),s=function(a){const i=this.embossStrength()*10,l=this.embossWhiteLevel()*255,c=this.embossDirection(),d=this.embossBlend(),f=a.data,p=a.width,g=a.height,y=p*4;let v=0,_=0,b=g;switch(c){case"top-left":v=-1,_=-1;break;case"top":v=-1,_=0;break;case"top-right":v=-1,_=1;break;case"right":v=0,_=1;break;case"bottom-right":v=1,_=1;break;case"bottom":v=1,_=0;break;case"bottom-left":v=1,_=-1;break;case"left":v=0,_=-1;break;default:r.Util.error("Unknown emboss direction: "+c)}do{const E=(b-1)*y;let k=v;b+k<1&&(k=0),b+k>g&&(k=0);const w=(b-1+k)*p*4;let N=p;do{const A=E+(N-1)*4;let P=_;N+P<1&&(P=0),N+P>p&&(P=0);const R=w+(N-1+P)*4,T=f[A]-f[R],D=f[A+1]-f[R+1],I=f[A+2]-f[R+2];let V=T;const X=V>0?V:-V,Z=D>0?D:-D,ie=I>0?I:-I;if(Z>X&&(V=D),ie>X&&(V=I),V*=i,d){const q=f[A]+V,ne=f[A+1]+V,M=f[A+2]+V;f[A]=q>255?255:q<0?0:q,f[A+1]=ne>255?255:ne<0?0:ne,f[A+2]=M>255?255:M<0?0:M}else{let q=l-V;q<0?q=0:q>255&&(q=255),f[A]=f[A+1]=f[A+2]=q}}while(--N)}while(--b)};return Qg.Emboss=s,e.Factory.addGetterSetter(t.Node,"embossStrength",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossDirection","top-left",void 0,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossBlend",!1,void 0,e.Factory.afterSetFilter),Qg}var Jg={},OT;function OM(){if(OT)return Jg;OT=1,Object.defineProperty(Jg,"__esModule",{value:!0}),Jg.Enhance=void 0;const e=Hr(),t=vs(),r=Vr();function n(a,i,l,c,d){const f=l-i,p=d-c;if(f===0)return c+p/2;if(p===0)return c;let g=(a-i)/f;return g=p*g+c,g}const s=function(a){const i=a.data,l=i.length;let c=i[0],d=c,f,p=i[1],g=p,y,v=i[2],_=v,b;const E=this.enhance();if(E===0)return;for(let T=0;T<l;T+=4)f=i[T+0],f<c?c=f:f>d&&(d=f),y=i[T+1],y<p?p=y:y>g&&(g=y),b=i[T+2],b<v?v=b:b>_&&(_=b);d===c&&(d=255,c=0),g===p&&(g=255,p=0),_===v&&(_=255,v=0);let k,w,N,A,P,R;if(E>0)k=d+E*(255-d),w=c-E*(c-0),N=g+E*(255-g),A=p-E*(p-0),P=_+E*(255-_),R=v-E*(v-0);else{const T=(d+c)*.5;k=d+E*(d-T),w=c+E*(c-T);const D=(g+p)*.5;N=g+E*(g-D),A=p+E*(p-D);const I=(_+v)*.5;P=_+E*(_-I),R=v+E*(v-I)}for(let T=0;T<l;T+=4)i[T+0]=n(i[T+0],c,d,w,k),i[T+1]=n(i[T+1],p,g,A,N),i[T+2]=n(i[T+2],v,_,R,P)};return Jg.Enhance=s,e.Factory.addGetterSetter(t.Node,"enhance",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),Jg}var Zg={},LT;function LM(){if(LT)return Zg;LT=1,Object.defineProperty(Zg,"__esModule",{value:!0}),Zg.Grayscale=void 0;const e=function(t){const r=t.data,n=r.length;for(let s=0;s<n;s+=4){const a=.34*r[s]+.5*r[s+1]+.16*r[s+2];r[s]=a,r[s+1]=a,r[s+2]=a}};return Zg.Grayscale=e,Zg}var em={},BT;function BM(){if(BT)return em;BT=1,Object.defineProperty(em,"__esModule",{value:!0}),em.HSL=void 0;const e=Hr(),t=vs(),r=Vr();e.Factory.addGetterSetter(t.Node,"hue",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"luminance",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter);const n=function(s){const a=s.data,i=a.length,l=1,c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,f=this.luminance()*127,p=l*c*Math.cos(d*Math.PI/180),g=l*c*Math.sin(d*Math.PI/180),y=.299*l+.701*p+.167*g,v=.587*l-.587*p+.33*g,_=.114*l-.114*p-.497*g,b=.299*l-.299*p-.328*g,E=.587*l+.413*p+.035*g,k=.114*l-.114*p+.293*g,w=.299*l-.3*p+1.25*g,N=.587*l-.586*p-1.05*g,A=.114*l+.886*p-.2*g;let P,R,T,D;for(let I=0;I<i;I+=4)P=a[I+0],R=a[I+1],T=a[I+2],D=a[I+3],a[I+0]=y*P+v*R+_*T+f,a[I+1]=b*P+E*R+k*T+f,a[I+2]=w*P+N*R+A*T+f,a[I+3]=D};return em.HSL=n,em}var tm={},UT;function UM(){if(UT)return tm;UT=1,Object.defineProperty(tm,"__esModule",{value:!0}),tm.HSV=void 0;const e=Hr(),t=vs(),r=Vr(),n=function(s){const a=s.data,i=a.length,l=Math.pow(2,this.value()),c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,f=l*c*Math.cos(d*Math.PI/180),p=l*c*Math.sin(d*Math.PI/180),g=.299*l+.701*f+.167*p,y=.587*l-.587*f+.33*p,v=.114*l-.114*f-.497*p,_=.299*l-.299*f-.328*p,b=.587*l+.413*f+.035*p,E=.114*l-.114*f+.293*p,k=.299*l-.3*f+1.25*p,w=.587*l-.586*f-1.05*p,N=.114*l+.886*f-.2*p;for(let A=0;A<i;A+=4){const P=a[A+0],R=a[A+1],T=a[A+2],D=a[A+3];a[A+0]=g*P+y*R+v*T,a[A+1]=_*P+b*R+E*T,a[A+2]=k*P+w*R+N*T,a[A+3]=D}};return tm.HSV=n,e.Factory.addGetterSetter(t.Node,"hue",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"value",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),tm}var rm={},$T;function $M(){if($T)return rm;$T=1,Object.defineProperty(rm,"__esModule",{value:!0}),rm.Invert=void 0;const e=function(t){const r=t.data,n=r.length;for(let s=0;s<n;s+=4)r[s]=255-r[s],r[s+1]=255-r[s+1],r[s+2]=255-r[s+2]};return rm.Invert=e,rm}var nm={},WT;function WM(){if(WT)return nm;WT=1,Object.defineProperty(nm,"__esModule",{value:!0}),nm.Kaleidoscope=void 0;const e=Hr(),t=vs(),r=ls(),n=Vr(),s=function(l,c,d){const f=l.data,p=c.data,g=l.width,y=l.height,v=d.polarCenterX||g/2,_=d.polarCenterY||y/2;let b=Math.sqrt(v*v+_*_),E=g-v,k=y-_;const w=Math.sqrt(E*E+k*k);b=w>b?w:b;const N=y,A=g,P=360/A*Math.PI/180;for(let R=0;R<A;R+=1){const T=Math.sin(R*P),D=Math.cos(R*P);for(let I=0;I<N;I+=1){E=Math.floor(v+b*I/N*D),k=Math.floor(_+b*I/N*T);let V=(k*g+E)*4;const X=f[V+0],Z=f[V+1],ie=f[V+2],q=f[V+3];V=(R+I*g)*4,p[V+0]=X,p[V+1]=Z,p[V+2]=ie,p[V+3]=q}}},a=function(l,c,d){const f=l.data,p=c.data,g=l.width,y=l.height,v=d.polarCenterX||g/2,_=d.polarCenterY||y/2;let b=Math.sqrt(v*v+_*_),E=g-v,k=y-_;const w=Math.sqrt(E*E+k*k);b=w>b?w:b;const N=y,A=g,P=0;let R,T;for(E=0;E<g;E+=1)for(k=0;k<y;k+=1){const D=E-v,I=k-_,V=Math.sqrt(D*D+I*I)*N/b;let X=(Math.atan2(I,D)*180/Math.PI+360+P)%360;X=X*A/360,R=Math.floor(X),T=Math.floor(V);let Z=(T*g+R)*4;const ie=f[Z+0],q=f[Z+1],ne=f[Z+2],M=f[Z+3];Z=(k*g+E)*4,p[Z+0]=ie,p[Z+1]=q,p[Z+2]=ne,p[Z+3]=M}},i=function(l){const c=l.width,d=l.height;let f,p,g,y,v,_,b,E,k,w,N=Math.round(this.kaleidoscopePower());const A=Math.round(this.kaleidoscopeAngle()),P=Math.floor(c*(A%360)/360);if(N<1)return;const R=r.Util.createCanvasElement();R.width=c,R.height=d;const T=R.getContext("2d").getImageData(0,0,c,d);r.Util.releaseCanvas(R),s(l,T,{polarCenterX:c/2,polarCenterY:d/2});let D=c/Math.pow(2,N);for(;D<=8;)D=D*2,N-=1;D=Math.ceil(D);let I=D,V=0,X=I,Z=1;for(P+D>c&&(V=I,X=0,Z=-1),p=0;p<d;p+=1)for(f=V;f!==X;f+=Z)g=Math.round(f+P)%c,k=(c*p+g)*4,v=T.data[k+0],_=T.data[k+1],b=T.data[k+2],E=T.data[k+3],w=(c*p+f)*4,T.data[w+0]=v,T.data[w+1]=_,T.data[w+2]=b,T.data[w+3]=E;for(p=0;p<d;p+=1)for(I=Math.floor(D),y=0;y<N;y+=1){for(f=0;f<I+1;f+=1)k=(c*p+f)*4,v=T.data[k+0],_=T.data[k+1],b=T.data[k+2],E=T.data[k+3],w=(c*p+I*2-f-1)*4,T.data[w+0]=v,T.data[w+1]=_,T.data[w+2]=b,T.data[w+3]=E;I*=2}a(T,l,{})};return nm.Kaleidoscope=i,e.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),nm}var sm={},zT;function zM(){if(zT)return sm;zT=1,Object.defineProperty(sm,"__esModule",{value:!0}),sm.Mask=void 0;const e=Hr(),t=vs(),r=Vr();function n(g,y,v){let _=(v*g.width+y)*4;const b=[];return b.push(g.data[_++],g.data[_++],g.data[_++],g.data[_++]),b}function s(g,y){return Math.sqrt(Math.pow(g[0]-y[0],2)+Math.pow(g[1]-y[1],2)+Math.pow(g[2]-y[2],2))}function a(g){const y=[0,0,0];for(let v=0;v<g.length;v++)y[0]+=g[v][0],y[1]+=g[v][1],y[2]+=g[v][2];return y[0]/=g.length,y[1]/=g.length,y[2]/=g.length,y}function i(g,y){const v=n(g,0,0),_=n(g,g.width-1,0),b=n(g,0,g.height-1),E=n(g,g.width-1,g.height-1),k=y||10;if(s(v,_)<k&&s(_,E)<k&&s(E,b)<k&&s(b,v)<k){const w=a([_,v,E,b]),N=[];for(let A=0;A<g.width*g.height;A++){const P=s(w,[g.data[A*4],g.data[A*4+1],g.data[A*4+2]]);N[A]=P<k?0:255}return N}}function l(g,y){for(let v=0;v<g.width*g.height;v++)g.data[4*v+3]=y[v]}function c(g,y,v){const _=[1,1,1,1,0,1,1,1,1],b=Math.round(Math.sqrt(_.length)),E=Math.floor(b/2),k=[];for(let w=0;w<v;w++)for(let N=0;N<y;N++){const A=w*y+N;let P=0;for(let R=0;R<b;R++)for(let T=0;T<b;T++){const D=w+R-E,I=N+T-E;if(D>=0&&D<v&&I>=0&&I<y){const V=D*y+I,X=_[R*b+T];P+=g[V]*X}}k[A]=P===2040?255:0}return k}function d(g,y,v){const _=[1,1,1,1,1,1,1,1,1],b=Math.round(Math.sqrt(_.length)),E=Math.floor(b/2),k=[];for(let w=0;w<v;w++)for(let N=0;N<y;N++){const A=w*y+N;let P=0;for(let R=0;R<b;R++)for(let T=0;T<b;T++){const D=w+R-E,I=N+T-E;if(D>=0&&D<v&&I>=0&&I<y){const V=D*y+I,X=_[R*b+T];P+=g[V]*X}}k[A]=P>=1020?255:0}return k}function f(g,y,v){const _=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],b=Math.round(Math.sqrt(_.length)),E=Math.floor(b/2),k=[];for(let w=0;w<v;w++)for(let N=0;N<y;N++){const A=w*y+N;let P=0;for(let R=0;R<b;R++)for(let T=0;T<b;T++){const D=w+R-E,I=N+T-E;if(D>=0&&D<v&&I>=0&&I<y){const V=D*y+I,X=_[R*b+T];P+=g[V]*X}}k[A]=P}return k}const p=function(g){const y=this.threshold();let v=i(g,y);return v&&(v=c(v,g.width,g.height),v=d(v,g.width,g.height),v=f(v,g.width,g.height),l(g,v)),g};return sm.Mask=p,e.Factory.addGetterSetter(t.Node,"threshold",0,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),sm}var am={},HT;function HM(){if(HT)return am;HT=1,Object.defineProperty(am,"__esModule",{value:!0}),am.Noise=void 0;const e=Hr(),t=vs(),r=Vr(),n=function(s){const a=this.noise()*255,i=s.data,l=i.length,c=a/2;for(let d=0;d<l;d+=4)i[d+0]+=c-2*c*Math.random(),i[d+1]+=c-2*c*Math.random(),i[d+2]+=c-2*c*Math.random()};return am.Noise=n,e.Factory.addGetterSetter(t.Node,"noise",.2,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),am}var im={},GT;function GM(){if(GT)return im;GT=1,Object.defineProperty(im,"__esModule",{value:!0}),im.Pixelate=void 0;const e=Hr(),t=ls(),r=vs(),n=Vr(),s=function(a){let i=Math.ceil(this.pixelSize()),l=a.width,c=a.height,d=Math.ceil(l/i),f=Math.ceil(c/i),p=a.data;if(i<=0){t.Util.error("pixelSize value can not be <= 0");return}for(let g=0;g<d;g+=1)for(let y=0;y<f;y+=1){let v=0,_=0,b=0,E=0;const k=g*i,w=k+i,N=y*i,A=N+i;let P=0;for(let R=k;R<w;R+=1)if(!(R>=l))for(let T=N;T<A;T+=1){if(T>=c)continue;const D=(l*T+R)*4;v+=p[D+0],_+=p[D+1],b+=p[D+2],E+=p[D+3],P+=1}v=v/P,_=_/P,b=b/P,E=E/P;for(let R=k;R<w;R+=1)if(!(R>=l))for(let T=N;T<A;T+=1){if(T>=c)continue;const D=(l*T+R)*4;p[D+0]=v,p[D+1]=_,p[D+2]=b,p[D+3]=E}}};return im.Pixelate=s,e.Factory.addGetterSetter(r.Node,"pixelSize",8,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),im}var om={},VT;function VM(){if(VT)return om;VT=1,Object.defineProperty(om,"__esModule",{value:!0}),om.Posterize=void 0;const e=Hr(),t=vs(),r=Vr(),n=function(s){const a=Math.round(this.levels()*254)+1,i=s.data,l=i.length,c=255/a;for(let d=0;d<l;d+=1)i[d]=Math.floor(i[d]/c)*c};return om.Posterize=n,e.Factory.addGetterSetter(t.Node,"levels",.5,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),om}var lm={},KT;function KM(){if(KT)return lm;KT=1,Object.defineProperty(lm,"__esModule",{value:!0}),lm.RGB=void 0;const e=Hr(),t=vs(),r=Vr(),n=function(s){const a=s.data,i=a.length,l=this.red(),c=this.green(),d=this.blue();for(let f=0;f<i;f+=4){const p=(.34*a[f]+.5*a[f+1]+.16*a[f+2])/255;a[f]=p*l,a[f+1]=p*c,a[f+2]=p*d,a[f+3]=a[f+3]}};return lm.RGB=n,e.Factory.addGetterSetter(t.Node,"red",0,function(s){return this._filterUpToDate=!1,s>255?255:s<0?0:Math.round(s)}),e.Factory.addGetterSetter(t.Node,"green",0,function(s){return this._filterUpToDate=!1,s>255?255:s<0?0:Math.round(s)}),e.Factory.addGetterSetter(t.Node,"blue",0,r.RGBComponent,e.Factory.afterSetFilter),lm}var cm={},qT;function qM(){if(qT)return cm;qT=1,Object.defineProperty(cm,"__esModule",{value:!0}),cm.RGBA=void 0;const e=Hr(),t=vs(),r=Vr(),n=function(s){const a=s.data,i=a.length,l=this.red(),c=this.green(),d=this.blue(),f=this.alpha();for(let p=0;p<i;p+=4){const g=1-f;a[p]=l*f+a[p]*g,a[p+1]=c*f+a[p+1]*g,a[p+2]=d*f+a[p+2]*g}};return cm.RGBA=n,e.Factory.addGetterSetter(t.Node,"red",0,function(s){return this._filterUpToDate=!1,s>255?255:s<0?0:Math.round(s)}),e.Factory.addGetterSetter(t.Node,"green",0,function(s){return this._filterUpToDate=!1,s>255?255:s<0?0:Math.round(s)}),e.Factory.addGetterSetter(t.Node,"blue",0,r.RGBComponent,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"alpha",1,function(s){return this._filterUpToDate=!1,s>1?1:s<0?0:s}),cm}var um={},XT;function XM(){if(XT)return um;XT=1,Object.defineProperty(um,"__esModule",{value:!0}),um.Sepia=void 0;const e=function(t){const r=t.data,n=r.length;for(let s=0;s<n;s+=4){const a=r[s+0],i=r[s+1],l=r[s+2];r[s+0]=Math.min(255,a*.393+i*.769+l*.189),r[s+1]=Math.min(255,a*.349+i*.686+l*.168),r[s+2]=Math.min(255,a*.272+i*.534+l*.131)}};return um.Sepia=e,um}var dm={},YT;function YM(){if(YT)return dm;YT=1,Object.defineProperty(dm,"__esModule",{value:!0}),dm.Solarize=void 0;const e=function(t){const r=t.data,n=t.width,s=t.height,a=n*4;let i=s;do{const l=(i-1)*a;let c=n;do{const d=l+(c-1)*4;let f=r[d],p=r[d+1],g=r[d+2];f>127&&(f=255-f),p>127&&(p=255-p),g>127&&(g=255-g),r[d]=f,r[d+1]=p,r[d+2]=g}while(--c)}while(--i)};return dm.Solarize=e,dm}var fm={},QT;function QM(){if(QT)return fm;QT=1,Object.defineProperty(fm,"__esModule",{value:!0}),fm.Threshold=void 0;const e=Hr(),t=vs(),r=Vr(),n=function(s){const a=this.threshold()*255,i=s.data,l=i.length;for(let c=0;c<l;c+=1)i[c]=i[c]<a?0:255};return fm.Threshold=n,e.Factory.addGetterSetter(t.Node,"threshold",.5,(0,r.getNumberValidator)(),e.Factory.afterSetFilter),fm}var JT;function JM(){if(JT)return Tg;JT=1,Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.Konva=void 0;const e=C_(),t=vM(),r=_M(),n=bM(),s=SM(),a=kM(),i=CM(),l=k6(),c=ob(),d=C6(),f=TM(),p=EM(),g=NM(),y=AM(),v=T6(),_=jM(),b=FM(),E=PM(),k=RM(),w=DM(),N=IM(),A=MM(),P=OM(),R=LM(),T=BM(),D=UM(),I=$M(),V=WM(),X=zM(),Z=HM(),ie=GM(),q=VM(),ne=KM(),M=qM(),W=XM(),L=YM(),H=QM();return Tg.Konva=e.Konva.Util._assign(e.Konva,{Arc:t.Arc,Arrow:r.Arrow,Circle:n.Circle,Ellipse:s.Ellipse,Image:a.Image,Label:i.Label,Tag:i.Tag,Line:l.Line,Path:c.Path,Rect:d.Rect,RegularPolygon:f.RegularPolygon,Ring:p.Ring,Sprite:g.Sprite,Star:y.Star,Text:v.Text,TextPath:_.TextPath,Transformer:b.Transformer,Wedge:E.Wedge,Filters:{Blur:k.Blur,Brighten:w.Brighten,Contrast:N.Contrast,Emboss:A.Emboss,Enhance:P.Enhance,Grayscale:R.Grayscale,HSL:T.HSL,HSV:D.HSV,Invert:I.Invert,Kaleidoscope:V.Kaleidoscope,Mask:X.Mask,Noise:Z.Noise,Pixelate:ie.Pixelate,Posterize:q.Posterize,RGB:ne.RGB,RGBA:M.RGBA,Sepia:W.Sepia,Solarize:L.Solarize,Threshold:H.Threshold}}),Tg}var ZM=F1.exports,ZT;function eO(){if(ZT)return F1.exports;ZT=1,Object.defineProperty(ZM,"__esModule",{value:!0});const e=JM();return F1.exports=e.Konva,F1.exports}var E6=eO();const tO=bp(E6),rO=C3({__proto__:null,default:tO},[E6]);var s1={exports:{}},e4;function nO(){return e4||(e4=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;var r=C_();Object.defineProperty(t,"Konva",{enumerable:!0,get:function(){return r.Konva}});const n=C_();e.exports=n.Konva})(s1,s1.exports)),s1.exports}var sO=nO();const Jm=bp(sO);var mw={exports:{}};/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pw,t4;function aO(){return t4||(t4=1,pw=function(t){var r={},n=Cy(),s=w2(),a=Object.assign;function i(m){for(var x="https://reactjs.org/docs/error-decoder.html?invariant="+m,j=1;j<arguments.length;j++)x+="&args[]="+encodeURIComponent(arguments[j]);return"Minified React error #"+m+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=Symbol.for("react.element"),d=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),v=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),N=Symbol.for("react.offscreen"),A=Symbol.iterator;function P(m){return m===null||typeof m!="object"?null:(m=A&&m[A]||m["@@iterator"],typeof m=="function"?m:null)}function R(m){if(m==null)return null;if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case f:return"Fragment";case d:return"Portal";case g:return"Profiler";case p:return"StrictMode";case b:return"Suspense";case E:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case v:return(m.displayName||"Context")+".Consumer";case y:return(m._context.displayName||"Context")+".Provider";case _:var x=m.render;return m=m.displayName,m||(m=x.displayName||x.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case k:return x=m.displayName||null,x!==null?x:R(m.type)||"Memo";case w:x=m._payload,m=m._init;try{return R(m(x))}catch{}}return null}function T(m){var x=m.type;switch(m.tag){case 24:return"Cache";case 9:return(x.displayName||"Context")+".Consumer";case 10:return(x._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return m=x.render,m=m.displayName||m.name||"",x.displayName||(m!==""?"ForwardRef("+m+")":"ForwardRef");case 7:return"Fragment";case 5:return x;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return R(x);case 8:return x===p?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x}return null}function D(m){var x=m,j=m;if(m.alternate)for(;x.return;)x=x.return;else{m=x;do x=m,(x.flags&4098)!==0&&(j=x.return),m=x.return;while(m)}return x.tag===3?j:null}function I(m){if(D(m)!==m)throw Error(i(188))}function V(m){var x=m.alternate;if(!x){if(x=D(m),x===null)throw Error(i(188));return x!==m?null:m}for(var j=m,O=x;;){var G=j.return;if(G===null)break;var se=G.alternate;if(se===null){if(O=G.return,O!==null){j=O;continue}break}if(G.child===se.child){for(se=G.child;se;){if(se===j)return I(G),m;if(se===O)return I(G),x;se=se.sibling}throw Error(i(188))}if(j.return!==O.return)j=G,O=se;else{for(var ye=!1,Be=G.child;Be;){if(Be===j){ye=!0,j=G,O=se;break}if(Be===O){ye=!0,O=G,j=se;break}Be=Be.sibling}if(!ye){for(Be=se.child;Be;){if(Be===j){ye=!0,j=se,O=G;break}if(Be===O){ye=!0,O=se,j=G;break}Be=Be.sibling}if(!ye)throw Error(i(189))}}if(j.alternate!==O)throw Error(i(190))}if(j.tag!==3)throw Error(i(188));return j.stateNode.current===j?m:x}function X(m){return m=V(m),m!==null?Z(m):null}function Z(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){var x=Z(m);if(x!==null)return x;m=m.sibling}return null}function ie(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){if(m.tag!==4){var x=ie(m);if(x!==null)return x}m=m.sibling}return null}var q=Array.isArray,ne=t.getPublicInstance,M=t.getRootHostContext,W=t.getChildHostContext,L=t.prepareForCommit,H=t.resetAfterCommit,K=t.createInstance,B=t.appendInitialChild,z=t.finalizeInitialChildren,Q=t.prepareUpdate,Y=t.shouldSetTextContent,te=t.createTextInstance,ee=t.scheduleTimeout,ae=t.cancelTimeout,ge=t.noTimeout,_e=t.isPrimaryRenderer,Me=t.supportsMutation,ue=t.supportsPersistence,me=t.supportsHydration,He=t.getInstanceFromNode,qe=t.preparePortalMount,Xe=t.getCurrentEventPriority,Ve=t.detachDeletedInstance,It=t.supportsMicrotasks,st=t.scheduleMicrotask,Ie=t.supportsTestSelectors,je=t.findFiberRoot,Ze=t.getBoundingRect,bt=t.getTextContent,mt=t.isHiddenSubtree,$t=t.matchAccessibilityRole,Wt=t.setFocusIfFocusable,lt=t.setupIntersectionObserver,Qe=t.appendChild,yt=t.appendChildToContainer,ft=t.commitTextUpdate,_t=t.commitMount,zt=t.commitUpdate,Jt=t.insertBefore,De=t.insertInContainerBefore,ut=t.removeChild,pt=t.removeChildFromContainer,Pt=t.resetTextContent,Lt=t.hideInstance,sr=t.hideTextInstance,Te=t.unhideInstance,ve=t.unhideTextInstance,fe=t.clearContainer,we=t.cloneInstance,Ue=t.createContainerChildSet,St=t.appendChildToContainerChildSet,xt=t.finalizeContainerChildren,Ht=t.replaceContainerChildren,Ot=t.cloneHiddenInstance,Xt=t.cloneHiddenTextInstance,pr=t.canHydrateInstance,Fr=t.canHydrateTextInstance,fr=t.canHydrateSuspenseInstance,vr=t.isSuspenseInstancePending,Mr=t.isSuspenseInstanceFallback,sn=t.getSuspenseInstanceFallbackErrorDetails,le=t.registerSuspenseInstanceRetry,be=t.getNextHydratableSibling,pe=t.getFirstHydratableChild,xe=t.getFirstHydratableChildWithinContainer,Se=t.getFirstHydratableChildWithinSuspenseInstance,ke=t.hydrateInstance,$e=t.hydrateTextInstance,ht=t.hydrateSuspenseInstance,Ke=t.getNextHydratableInstanceAfterSuspenseInstance,oe=t.commitHydratedContainer,he=t.commitHydratedSuspenseInstance,Ce=t.clearSuspenseBoundary,Ne=t.clearSuspenseBoundaryFromContainer,Ge=t.shouldDeleteUnhydratedTailInstances,ot=t.didNotMatchHydratedContainerTextInstance,Le=t.didNotMatchHydratedTextInstance,Et;function Bt(m){if(Et===void 0)try{throw Error()}catch(j){var x=j.stack.trim().match(/\n( *(at )?)/);Et=x&&x[1]||""}return`
`+Et+m}var Yt=!1;function Fe(m,x){if(!m||Yt)return"";Yt=!0;var j=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(x)if(x=function(){throw Error()},Object.defineProperty(x.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x,[])}catch(Mt){var O=Mt}Reflect.construct(m,[],x)}else{try{x.call()}catch(Mt){O=Mt}m.call(x.prototype)}else{try{throw Error()}catch(Mt){O=Mt}m()}}catch(Mt){if(Mt&&O&&typeof Mt.stack=="string"){for(var G=Mt.stack.split(`
`),se=O.stack.split(`
`),ye=G.length-1,Be=se.length-1;1<=ye&&0<=Be&&G[ye]!==se[Be];)Be--;for(;1<=ye&&0<=Be;ye--,Be--)if(G[ye]!==se[Be]){if(ye!==1||Be!==1)do if(ye--,Be--,0>Be||G[ye]!==se[Be]){var dt=`
`+G[ye].replace(" at new "," at ");return m.displayName&&dt.includes("<anonymous>")&&(dt=dt.replace("<anonymous>",m.displayName)),dt}while(1<=ye&&0<=Be);break}}}finally{Yt=!1,Error.prepareStackTrace=j}return(m=m?m.displayName||m.name:"")?Bt(m):""}var We=Object.prototype.hasOwnProperty,Ct=[],at=-1;function Qt(m){return{current:m}}function tt(m){0>at||(m.current=Ct[at],Ct[at]=null,at--)}function jt(m,x){at++,Ct[at]=m.current,m.current=x}var re={},de=Qt(re),Pe=Qt(!1),Je=re;function gr(m,x){var j=m.type.contextTypes;if(!j)return re;var O=m.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===x)return O.__reactInternalMemoizedMaskedChildContext;var G={},se;for(se in j)G[se]=x[se];return O&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=x,m.__reactInternalMemoizedMaskedChildContext=G),G}function or(m){return m=m.childContextTypes,m!=null}function Or(){tt(Pe),tt(de)}function Dr(m,x,j){if(de.current!==re)throw Error(i(168));jt(de,x),jt(Pe,j)}function Xr(m,x,j){var O=m.stateNode;if(x=x.childContextTypes,typeof O.getChildContext!="function")return j;O=O.getChildContext();for(var G in O)if(!(G in x))throw Error(i(108,T(m)||"Unknown",G));return a({},j,O)}function Zr(m){return m=(m=m.stateNode)&&m.__reactInternalMemoizedMergedChildContext||re,Je=de.current,jt(de,m),jt(Pe,Pe.current),!0}function dr(m,x,j){var O=m.stateNode;if(!O)throw Error(i(169));j?(m=Xr(m,x,Je),O.__reactInternalMemoizedMergedChildContext=m,tt(Pe),tt(de),jt(de,m)):tt(Pe),jt(Pe,j)}var _s=Math.clz32?Math.clz32:D0,Ml=Math.log,lv=Math.LN2;function D0(m){return m>>>=0,m===0?32:31-(Ml(m)/lv|0)|0}var Kr=64,Zu=4194304;function Rc(m){switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return m&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return m}}function Dc(m,x){var j=m.pendingLanes;if(j===0)return 0;var O=0,G=m.suspendedLanes,se=m.pingedLanes,ye=j&268435455;if(ye!==0){var Be=ye&~G;Be!==0?O=Rc(Be):(se&=ye,se!==0&&(O=Rc(se)))}else ye=j&~G,ye!==0?O=Rc(ye):se!==0&&(O=Rc(se));if(O===0)return 0;if(x!==0&&x!==O&&(x&G)===0&&(G=O&-O,se=x&-x,G>=se||G===16&&(se&4194240)!==0))return x;if((O&4)!==0&&(O|=j&16),x=m.entangledLanes,x!==0)for(m=m.entanglements,x&=O;0<x;)j=31-_s(x),G=1<<j,O|=m[j],x&=~G;return O}function Zp(m,x){switch(m){case 1:case 2:case 4:return x+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ex(m,x){for(var j=m.suspendedLanes,O=m.pingedLanes,G=m.expirationTimes,se=m.pendingLanes;0<se;){var ye=31-_s(se),Be=1<<ye,dt=G[ye];dt===-1?((Be&j)===0||(Be&O)!==0)&&(G[ye]=Zp(Be,x)):dt<=x&&(m.expiredLanes|=Be),se&=~Be}}function Tf(m){return m=m.pendingLanes&-1073741825,m!==0?m:m&1073741824?1073741824:0}function Ef(){var m=Kr;return Kr<<=1,(Kr&4194240)===0&&(Kr=64),m}function Ic(m){for(var x=[],j=0;31>j;j++)x.push(m);return x}function ci(m,x,j){m.pendingLanes|=x,x!==536870912&&(m.suspendedLanes=0,m.pingedLanes=0),m=m.eventTimes,x=31-_s(x),m[x]=j}function Yo(m,x){var j=m.pendingLanes&~x;m.pendingLanes=x,m.suspendedLanes=0,m.pingedLanes=0,m.expiredLanes&=x,m.mutableReadLanes&=x,m.entangledLanes&=x,x=m.entanglements;var O=m.eventTimes;for(m=m.expirationTimes;0<j;){var G=31-_s(j),se=1<<G;x[G]=0,O[G]=-1,m[G]=-1,j&=~se}}function Hi(m,x){var j=m.entangledLanes|=x;for(m=m.entanglements;j;){var O=31-_s(j),G=1<<O;G&x|m[O]&x&&(m[O]|=x),j&=~G}}var Ur=0;function Mc(m){return m&=-m,1<m?4<m?(m&268435455)!==0?16:536870912:4:1}var Gi=s.unstable_scheduleCallback,tx=s.unstable_cancelCallback,rx=s.unstable_shouldYield,ed=s.unstable_requestPaint,bs=s.unstable_now,Nf=s.unstable_ImmediatePriority,Af=s.unstable_UserBlockingPriority,jf=s.unstable_NormalPriority,cv=s.unstable_IdlePriority,Qo=null,Ca=null;function Oc(m){if(Ca&&typeof Ca.onCommitFiberRoot=="function")try{Ca.onCommitFiberRoot(Qo,m,void 0,(m.current.flags&128)===128)}catch{}}function Ff(m,x){return m===x&&(m!==0||1/m===1/x)||m!==m&&x!==x}var Ni=typeof Object.is=="function"?Object.is:Ff,_o=null,Lc=!1,Bc=!1;function Pf(m){_o===null?_o=[m]:_o.push(m)}function nx(m){Lc=!0,Pf(m)}function Rs(){if(!Bc&&_o!==null){Bc=!0;var m=0,x=Ur;try{var j=_o;for(Ur=1;m<j.length;m++){var O=j[m];do O=O(!0);while(O!==null)}_o=null,Lc=!1}catch(G){throw _o!==null&&(_o=_o.slice(m+1)),Gi(Nf,Rs),G}finally{Ur=x,Bc=!1}}return null}var Jo=[],bo=0,td=null,Ol=0,aa=[],Ha=0,cs=null,Ta=1,Ai="";function ji(m,x){Jo[bo++]=Ol,Jo[bo++]=td,td=m,Ol=x}function sx(m,x,j){aa[Ha++]=Ta,aa[Ha++]=Ai,aa[Ha++]=cs,cs=m;var O=Ta;m=Ai;var G=32-_s(O)-1;O&=~(1<<G),j+=1;var se=32-_s(x)+G;if(30<se){var ye=G-G%5;se=(O&(1<<ye)-1).toString(32),O>>=ye,G-=ye,Ta=1<<32-_s(x)+G|j<<G|O,Ai=se+m}else Ta=1<<se|j<<G|O,Ai=m}function rd(m){m.return!==null&&(ji(m,1),sx(m,1,0))}function nd(m){for(;m===td;)td=Jo[--bo],Jo[bo]=null,Ol=Jo[--bo],Jo[bo]=null;for(;m===cs;)cs=aa[--Ha],aa[Ha]=null,Ai=aa[--Ha],aa[Ha]=null,Ta=aa[--Ha],aa[Ha]=null}var Ds=null,ia=null,Sn=!1,sd=!1,Fi=null;function ax(m,x){var j=ei(5,null,null,0);j.elementType="DELETED",j.stateNode=x,j.return=m,x=m.deletions,x===null?(m.deletions=[j],m.flags|=16):x.push(j)}function Rf(m,x){switch(m.tag){case 5:return x=pr(x,m.type,m.pendingProps),x!==null?(m.stateNode=x,Ds=m,ia=pe(x),!0):!1;case 6:return x=Fr(x,m.pendingProps),x!==null?(m.stateNode=x,Ds=m,ia=null,!0):!1;case 13:if(x=fr(x),x!==null){var j=cs!==null?{id:Ta,overflow:Ai}:null;return m.memoizedState={dehydrated:x,treeContext:j,retryLane:1073741824},j=ei(18,null,null,0),j.stateNode=x,j.return=m,m.child=j,Ds=m,ia=null,!0}return!1;default:return!1}}function I0(m){return(m.mode&1)!==0&&(m.flags&128)===0}function M0(m){if(Sn){var x=ia;if(x){var j=x;if(!Rf(m,x)){if(I0(m))throw Error(i(418));x=be(j);var O=Ds;x&&Rf(m,x)?ax(O,j):(m.flags=m.flags&-4097|2,Sn=!1,Ds=m)}}else{if(I0(m))throw Error(i(418));m.flags=m.flags&-4097|2,Sn=!1,Ds=m}}}function ix(m){for(m=m.return;m!==null&&m.tag!==5&&m.tag!==3&&m.tag!==13;)m=m.return;Ds=m}function Df(m){if(!me||m!==Ds)return!1;if(!Sn)return ix(m),Sn=!0,!1;if(m.tag!==3&&(m.tag!==5||Ge(m.type)&&!Y(m.type,m.memoizedProps))){var x=ia;if(x){if(I0(m))throw ox(),Error(i(418));for(;x;)ax(m,x),x=be(x)}}if(ix(m),m.tag===13){if(!me)throw Error(i(316));if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));ia=Ke(m)}else ia=Ds?be(m.stateNode):null;return!0}function ox(){for(var m=ia;m;)m=be(m)}function Ll(){me&&(ia=Ds=null,sd=Sn=!1)}function O0(m){Fi===null?Fi=[m]:Fi.push(m)}var uv=l.ReactCurrentBatchConfig;function If(m,x){if(Ni(m,x))return!0;if(typeof m!="object"||m===null||typeof x!="object"||x===null)return!1;var j=Object.keys(m),O=Object.keys(x);if(j.length!==O.length)return!1;for(O=0;O<j.length;O++){var G=j[O];if(!We.call(x,G)||!Ni(m[G],x[G]))return!1}return!0}function dv(m){switch(m.tag){case 5:return Bt(m.type);case 16:return Bt("Lazy");case 13:return Bt("Suspense");case 19:return Bt("SuspenseList");case 0:case 2:case 15:return m=Fe(m.type,!1),m;case 11:return m=Fe(m.type.render,!1),m;case 1:return m=Fe(m.type,!0),m;default:return""}}function Bl(m,x,j){if(m=j.ref,m!==null&&typeof m!="function"&&typeof m!="object"){if(j._owner){if(j=j._owner,j){if(j.tag!==1)throw Error(i(309));var O=j.stateNode}if(!O)throw Error(i(147,m));var G=O,se=""+m;return x!==null&&x.ref!==null&&typeof x.ref=="function"&&x.ref._stringRef===se?x.ref:(x=function(ye){var Be=G.refs;ye===null?delete Be[se]:Be[se]=ye},x._stringRef=se,x)}if(typeof m!="string")throw Error(i(284));if(!j._owner)throw Error(i(290,m))}return m}function Mf(m,x){throw m=Object.prototype.toString.call(x),Error(i(31,m==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":m))}function lx(m){var x=m._init;return x(m._payload)}function cx(m){function x(it,ze){if(m){var gt=it.deletions;gt===null?(it.deletions=[ze],it.flags|=16):gt.push(ze)}}function j(it,ze){if(!m)return null;for(;ze!==null;)x(it,ze),ze=ze.sibling;return null}function O(it,ze){for(it=new Map;ze!==null;)ze.key!==null?it.set(ze.key,ze):it.set(ze.index,ze),ze=ze.sibling;return it}function G(it,ze){return it=pl(it,ze),it.index=0,it.sibling=null,it}function se(it,ze,gt){return it.index=gt,m?(gt=it.alternate,gt!==null?(gt=gt.index,gt<ze?(it.flags|=2,ze):gt):(it.flags|=2,ze)):(it.flags|=1048576,ze)}function ye(it){return m&&it.alternate===null&&(it.flags|=2),it}function Be(it,ze,gt,tr){return ze===null||ze.tag!==6?(ze=uu(gt,it.mode,tr),ze.return=it,ze):(ze=G(ze,gt),ze.return=it,ze)}function dt(it,ze,gt,tr){var hr=gt.type;return hr===f?ar(it,ze,gt.props.children,tr,gt.key):ze!==null&&(ze.elementType===hr||typeof hr=="object"&&hr!==null&&hr.$$typeof===w&&lx(hr)===ze.type)?(tr=G(ze,gt.props),tr.ref=Bl(it,ze,gt),tr.return=it,tr):(tr=gh(gt.type,gt.key,gt.props,null,it.mode,tr),tr.ref=Bl(it,ze,gt),tr.return=it,tr)}function Mt(it,ze,gt,tr){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==gt.containerInfo||ze.stateNode.implementation!==gt.implementation?(ze=mh(gt,it.mode,tr),ze.return=it,ze):(ze=G(ze,gt.children||[]),ze.return=it,ze)}function ar(it,ze,gt,tr,hr){return ze===null||ze.tag!==7?(ze=Os(gt,it.mode,tr,hr),ze.return=it,ze):(ze=G(ze,gt),ze.return=it,ze)}function Tr(it,ze,gt){if(typeof ze=="string"&&ze!==""||typeof ze=="number")return ze=uu(""+ze,it.mode,gt),ze.return=it,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case c:return gt=gh(ze.type,ze.key,ze.props,null,it.mode,gt),gt.ref=Bl(it,null,ze),gt.return=it,gt;case d:return ze=mh(ze,it.mode,gt),ze.return=it,ze;case w:var tr=ze._init;return Tr(it,tr(ze._payload),gt)}if(q(ze)||P(ze))return ze=Os(ze,it.mode,gt,null),ze.return=it,ze;Mf(it,ze)}return null}function er(it,ze,gt,tr){var hr=ze!==null?ze.key:null;if(typeof gt=="string"&&gt!==""||typeof gt=="number")return hr!==null?null:Be(it,ze,""+gt,tr);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case c:return gt.key===hr?dt(it,ze,gt,tr):null;case d:return gt.key===hr?Mt(it,ze,gt,tr):null;case w:return hr=gt._init,er(it,ze,hr(gt._payload),tr)}if(q(gt)||P(gt))return hr!==null?null:ar(it,ze,gt,tr,null);Mf(it,gt)}return null}function wn(it,ze,gt,tr,hr){if(typeof tr=="string"&&tr!==""||typeof tr=="number")return it=it.get(gt)||null,Be(ze,it,""+tr,hr);if(typeof tr=="object"&&tr!==null){switch(tr.$$typeof){case c:return it=it.get(tr.key===null?gt:tr.key)||null,dt(ze,it,tr,hr);case d:return it=it.get(tr.key===null?gt:tr.key)||null,Mt(ze,it,tr,hr);case w:var Pr=tr._init;return wn(it,ze,gt,Pr(tr._payload),hr)}if(q(tr)||P(tr))return it=it.get(gt)||null,ar(ze,it,tr,hr,null);Mf(ze,tr)}return null}function on(it,ze,gt,tr){for(var hr=null,Pr=null,Er=ze,Gr=ze=0,gs=null;Er!==null&&Gr<gt.length;Gr++){Er.index>Gr?(gs=Er,Er=null):gs=Er.sibling;var zr=er(it,Er,gt[Gr],tr);if(zr===null){Er===null&&(Er=gs);break}m&&Er&&zr.alternate===null&&x(it,Er),ze=se(zr,ze,Gr),Pr===null?hr=zr:Pr.sibling=zr,Pr=zr,Er=gs}if(Gr===gt.length)return j(it,Er),Sn&&ji(it,Gr),hr;if(Er===null){for(;Gr<gt.length;Gr++)Er=Tr(it,gt[Gr],tr),Er!==null&&(ze=se(Er,ze,Gr),Pr===null?hr=Er:Pr.sibling=Er,Pr=Er);return Sn&&ji(it,Gr),hr}for(Er=O(it,Er);Gr<gt.length;Gr++)gs=wn(Er,it,Gr,gt[Gr],tr),gs!==null&&(m&&gs.alternate!==null&&Er.delete(gs.key===null?Gr:gs.key),ze=se(gs,ze,Gr),Pr===null?hr=gs:Pr.sibling=gs,Pr=gs);return m&&Er.forEach(function(Xs){return x(it,Xs)}),Sn&&ji(it,Gr),hr}function fa(it,ze,gt,tr){var hr=P(gt);if(typeof hr!="function")throw Error(i(150));if(gt=hr.call(gt),gt==null)throw Error(i(151));for(var Pr=hr=null,Er=ze,Gr=ze=0,gs=null,zr=gt.next();Er!==null&&!zr.done;Gr++,zr=gt.next()){Er.index>Gr?(gs=Er,Er=null):gs=Er.sibling;var Xs=er(it,Er,zr.value,tr);if(Xs===null){Er===null&&(Er=gs);break}m&&Er&&Xs.alternate===null&&x(it,Er),ze=se(Xs,ze,Gr),Pr===null?hr=Xs:Pr.sibling=Xs,Pr=Xs,Er=gs}if(zr.done)return j(it,Er),Sn&&ji(it,Gr),hr;if(Er===null){for(;!zr.done;Gr++,zr=gt.next())zr=Tr(it,zr.value,tr),zr!==null&&(ze=se(zr,ze,Gr),Pr===null?hr=zr:Pr.sibling=zr,Pr=zr);return Sn&&ji(it,Gr),hr}for(Er=O(it,Er);!zr.done;Gr++,zr=gt.next())zr=wn(Er,it,Gr,zr.value,tr),zr!==null&&(m&&zr.alternate!==null&&Er.delete(zr.key===null?Gr:zr.key),ze=se(zr,ze,Gr),Pr===null?hr=zr:Pr.sibling=zr,Pr=zr);return m&&Er.forEach(function(pv){return x(it,pv)}),Sn&&ji(it,Gr),hr}function eo(it,ze,gt,tr){if(typeof gt=="object"&&gt!==null&&gt.type===f&&gt.key===null&&(gt=gt.props.children),typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case c:e:{for(var hr=gt.key,Pr=ze;Pr!==null;){if(Pr.key===hr){if(hr=gt.type,hr===f){if(Pr.tag===7){j(it,Pr.sibling),ze=G(Pr,gt.props.children),ze.return=it,it=ze;break e}}else if(Pr.elementType===hr||typeof hr=="object"&&hr!==null&&hr.$$typeof===w&&lx(hr)===Pr.type){j(it,Pr.sibling),ze=G(Pr,gt.props),ze.ref=Bl(it,Pr,gt),ze.return=it,it=ze;break e}j(it,Pr);break}else x(it,Pr);Pr=Pr.sibling}gt.type===f?(ze=Os(gt.props.children,it.mode,tr,gt.key),ze.return=it,it=ze):(tr=gh(gt.type,gt.key,gt.props,null,it.mode,tr),tr.ref=Bl(it,ze,gt),tr.return=it,it=tr)}return ye(it);case d:e:{for(Pr=gt.key;ze!==null;){if(ze.key===Pr)if(ze.tag===4&&ze.stateNode.containerInfo===gt.containerInfo&&ze.stateNode.implementation===gt.implementation){j(it,ze.sibling),ze=G(ze,gt.children||[]),ze.return=it,it=ze;break e}else{j(it,ze);break}else x(it,ze);ze=ze.sibling}ze=mh(gt,it.mode,tr),ze.return=it,it=ze}return ye(it);case w:return Pr=gt._init,eo(it,ze,Pr(gt._payload),tr)}if(q(gt))return on(it,ze,gt,tr);if(P(gt))return fa(it,ze,gt,tr);Mf(it,gt)}return typeof gt=="string"&&gt!==""||typeof gt=="number"?(gt=""+gt,ze!==null&&ze.tag===6?(j(it,ze.sibling),ze=G(ze,gt),ze.return=it,it=ze):(j(it,ze),ze=uu(gt,it.mode,tr),ze.return=it,it=ze),ye(it)):j(it,ze)}return eo}var Ul=cx(!0),ux=cx(!1),Of=Qt(null),Lf=null,Uc=null,L0=null;function B0(){L0=Uc=Lf=null}function dx(m,x,j){_e?(jt(Of,x._currentValue),x._currentValue=j):(jt(Of,x._currentValue2),x._currentValue2=j)}function ad(m){var x=Of.current;tt(Of),_e?m._currentValue=x:m._currentValue2=x}function $l(m,x,j){for(;m!==null;){var O=m.alternate;if((m.childLanes&x)!==x?(m.childLanes|=x,O!==null&&(O.childLanes|=x)):O!==null&&(O.childLanes&x)!==x&&(O.childLanes|=x),m===j)break;m=m.return}}function $c(m,x){Lf=m,L0=Uc=null,m=m.dependencies,m!==null&&m.firstContext!==null&&((m.lanes&x)!==0&&(ds=!0),m.firstContext=null)}function Ga(m){var x=_e?m._currentValue:m._currentValue2;if(L0!==m)if(m={context:m,memoizedValue:x,next:null},Uc===null){if(Lf===null)throw Error(i(308));Uc=m,Lf.dependencies={lanes:0,firstContext:m}}else Uc=Uc.next=m;return x}var Zo=null;function Bf(m){Zo===null?Zo=[m]:Zo.push(m)}function U0(m,x,j,O){var G=x.interleaved;return G===null?(j.next=j,Bf(x)):(j.next=G.next,G.next=j),x.interleaved=j,Pi(m,O)}function Pi(m,x){m.lanes|=x;var j=m.alternate;for(j!==null&&(j.lanes|=x),j=m,m=m.return;m!==null;)m.childLanes|=x,j=m.alternate,j!==null&&(j.childLanes|=x),j=m,m=m.return;return j.tag===3?j.stateNode:null}var Va=!1;function $0(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fx(m,x){m=m.updateQueue,x.updateQueue===m&&(x.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,effects:m.effects})}function So(m,x){return{eventTime:m,lane:x,tag:0,payload:null,callback:null,next:null}}function ko(m,x,j){var O=m.updateQueue;if(O===null)return null;if(O=O.shared,(Nr&2)!==0){var G=O.pending;return G===null?x.next=x:(x.next=G.next,G.next=x),O.pending=x,Pi(m,j)}return G=O.interleaved,G===null?(x.next=x,Bf(O)):(x.next=G.next,G.next=x),O.interleaved=x,Pi(m,j)}function id(m,x,j){if(x=x.updateQueue,x!==null&&(x=x.shared,(j&4194240)!==0)){var O=x.lanes;O&=m.pendingLanes,j|=O,x.lanes=j,Hi(m,j)}}function Wc(m,x){var j=m.updateQueue,O=m.alternate;if(O!==null&&(O=O.updateQueue,j===O)){var G=null,se=null;if(j=j.firstBaseUpdate,j!==null){do{var ye={eventTime:j.eventTime,lane:j.lane,tag:j.tag,payload:j.payload,callback:j.callback,next:null};se===null?G=se=ye:se=se.next=ye,j=j.next}while(j!==null);se===null?G=se=x:se=se.next=x}else G=se=x;j={baseState:O.baseState,firstBaseUpdate:G,lastBaseUpdate:se,shared:O.shared,effects:O.effects},m.updateQueue=j;return}m=j.lastBaseUpdate,m===null?j.firstBaseUpdate=x:m.next=x,j.lastBaseUpdate=x}function el(m,x,j,O){var G=m.updateQueue;Va=!1;var se=G.firstBaseUpdate,ye=G.lastBaseUpdate,Be=G.shared.pending;if(Be!==null){G.shared.pending=null;var dt=Be,Mt=dt.next;dt.next=null,ye===null?se=Mt:ye.next=Mt,ye=dt;var ar=m.alternate;ar!==null&&(ar=ar.updateQueue,Be=ar.lastBaseUpdate,Be!==ye&&(Be===null?ar.firstBaseUpdate=Mt:Be.next=Mt,ar.lastBaseUpdate=dt))}if(se!==null){var Tr=G.baseState;ye=0,ar=Mt=dt=null,Be=se;do{var er=Be.lane,wn=Be.eventTime;if((O&er)===er){ar!==null&&(ar=ar.next={eventTime:wn,lane:0,tag:Be.tag,payload:Be.payload,callback:Be.callback,next:null});e:{var on=m,fa=Be;switch(er=x,wn=j,fa.tag){case 1:if(on=fa.payload,typeof on=="function"){Tr=on.call(wn,Tr,er);break e}Tr=on;break e;case 3:on.flags=on.flags&-65537|128;case 0:if(on=fa.payload,er=typeof on=="function"?on.call(wn,Tr,er):on,er==null)break e;Tr=a({},Tr,er);break e;case 2:Va=!0}}Be.callback!==null&&Be.lane!==0&&(m.flags|=64,er=G.effects,er===null?G.effects=[Be]:er.push(Be))}else wn={eventTime:wn,lane:er,tag:Be.tag,payload:Be.payload,callback:Be.callback,next:null},ar===null?(Mt=ar=wn,dt=Tr):ar=ar.next=wn,ye|=er;if(Be=Be.next,Be===null){if(Be=G.shared.pending,Be===null)break;er=Be,Be=er.next,er.next=null,G.lastBaseUpdate=er,G.shared.pending=null}}while(!0);if(ar===null&&(dt=Tr),G.baseState=dt,G.firstBaseUpdate=Mt,G.lastBaseUpdate=ar,x=G.shared.interleaved,x!==null){G=x;do ye|=G.lane,G=G.next;while(G!==x)}else se===null&&(G.shared.lanes=0);Ao|=ye,m.lanes=ye,m.memoizedState=Tr}}function hx(m,x,j){if(m=x.effects,x.effects=null,m!==null)for(x=0;x<m.length;x++){var O=m[x],G=O.callback;if(G!==null){if(O.callback=null,O=j,typeof G!="function")throw Error(i(191,G));G.call(O)}}}var tl={},ui=Qt(tl),zc=Qt(tl),rl=Qt(tl);function di(m){if(m===tl)throw Error(i(174));return m}function Uf(m,x){jt(rl,x),jt(zc,m),jt(ui,tl),m=M(x),tt(ui),jt(ui,m)}function Wl(){tt(ui),tt(zc),tt(rl)}function W0(m){var x=di(rl.current),j=di(ui.current);x=W(j,m.type,x),j!==x&&(jt(zc,m),jt(ui,x))}function z0(m){zc.current===m&&(tt(ui),tt(zc))}var Pn=Qt(0);function $f(m){for(var x=m;x!==null;){if(x.tag===13){var j=x.memoizedState;if(j!==null&&(j=j.dehydrated,j===null||vr(j)||Mr(j)))return x}else if(x.tag===19&&x.memoizedProps.revealOrder!==void 0){if((x.flags&128)!==0)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===m)break;for(;x.sibling===null;){if(x.return===null||x.return===m)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}var H0=[];function G0(){for(var m=0;m<H0.length;m++){var x=H0[m];_e?x._workInProgressVersionPrimary=null:x._workInProgressVersionSecondary=null}H0.length=0}var Ea=l.ReactCurrentDispatcher,zl=l.ReactCurrentBatchConfig,nl=0,Tn=null,Yn=null,us=null,Hc=!1,od=!1,ld=0,Gc=0;function Ss(){throw Error(i(321))}function Hl(m,x){if(x===null)return!1;for(var j=0;j<x.length&&j<m.length;j++)if(!Ni(m[j],x[j]))return!1;return!0}function cd(m,x,j,O,G,se){if(nl=se,Tn=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,Ea.current=m===null||m.memoizedState===null?tg:rg,m=j(O,G),od){se=0;do{if(od=!1,ld=0,25<=se)throw Error(i(301));se+=1,us=Yn=null,x.updateQueue=null,Ea.current=ng,m=j(O,G)}while(od)}if(Ea.current=Xl,x=Yn!==null&&Yn.next!==null,nl=0,us=Yn=Tn=null,Hc=!1,x)throw Error(i(300));return m}function Wf(){var m=ld!==0;return ld=0,m}function Ka(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return us===null?Tn.memoizedState=us=m:us=us.next=m,us}function Is(){if(Yn===null){var m=Tn.alternate;m=m!==null?m.memoizedState:null}else m=Yn.next;var x=us===null?Tn.memoizedState:us.next;if(x!==null)us=x,Yn=m;else{if(m===null)throw Error(i(310));Yn=m,m={memoizedState:Yn.memoizedState,baseState:Yn.baseState,baseQueue:Yn.baseQueue,queue:Yn.queue,next:null},us===null?Tn.memoizedState=us=m:us=us.next=m}return us}function Gl(m,x){return typeof x=="function"?x(m):x}function zf(m){var x=Is(),j=x.queue;if(j===null)throw Error(i(311));j.lastRenderedReducer=m;var O=Yn,G=O.baseQueue,se=j.pending;if(se!==null){if(G!==null){var ye=G.next;G.next=se.next,se.next=ye}O.baseQueue=G=se,j.pending=null}if(G!==null){se=G.next,O=O.baseState;var Be=ye=null,dt=null,Mt=se;do{var ar=Mt.lane;if((nl&ar)===ar)dt!==null&&(dt=dt.next={lane:0,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null}),O=Mt.hasEagerState?Mt.eagerState:m(O,Mt.action);else{var Tr={lane:ar,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null};dt===null?(Be=dt=Tr,ye=O):dt=dt.next=Tr,Tn.lanes|=ar,Ao|=ar}Mt=Mt.next}while(Mt!==null&&Mt!==se);dt===null?ye=O:dt.next=Be,Ni(O,x.memoizedState)||(ds=!0),x.memoizedState=O,x.baseState=ye,x.baseQueue=dt,j.lastRenderedState=O}if(m=j.interleaved,m!==null){G=m;do se=G.lane,Tn.lanes|=se,Ao|=se,G=G.next;while(G!==m)}else G===null&&(j.lanes=0);return[x.memoizedState,j.dispatch]}function Vc(m){var x=Is(),j=x.queue;if(j===null)throw Error(i(311));j.lastRenderedReducer=m;var O=j.dispatch,G=j.pending,se=x.memoizedState;if(G!==null){j.pending=null;var ye=G=G.next;do se=m(se,ye.action),ye=ye.next;while(ye!==G);Ni(se,x.memoizedState)||(ds=!0),x.memoizedState=se,x.baseQueue===null&&(x.baseState=se),j.lastRenderedState=se}return[se,O]}function V0(){}function K0(m,x){var j=Tn,O=Is(),G=x(),se=!Ni(O.memoizedState,G);if(se&&(O.memoizedState=G,ds=!0),O=O.queue,Vf(Y0.bind(null,j,O,m),[m]),O.getSnapshot!==x||se||us!==null&&us.memoizedState.tag&1){if(j.flags|=2048,Vl(9,X0.bind(null,j,O,G,x),void 0,null),dn===null)throw Error(i(349));(nl&30)!==0||q0(j,x,G)}return G}function q0(m,x,j){m.flags|=16384,m={getSnapshot:x,value:j},x=Tn.updateQueue,x===null?(x={lastEffect:null,stores:null},Tn.updateQueue=x,x.stores=[m]):(j=x.stores,j===null?x.stores=[m]:j.push(m))}function X0(m,x,j,O){x.value=j,x.getSnapshot=O,Q0(x)&&Co(m)}function Y0(m,x,j){return j(function(){Q0(x)&&Co(m)})}function Q0(m){var x=m.getSnapshot;m=m.value;try{var j=x();return!Ni(m,j)}catch{return!0}}function Co(m){var x=Pi(m,1);x!==null&&Ks(x,m,1,-1)}function Hf(m){var x=Ka();return typeof m=="function"&&(m=m()),x.memoizedState=x.baseState=m,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:m},x.queue=m,m=m.dispatch=fv.bind(null,Tn,m),[x.memoizedState,m]}function Vl(m,x,j,O){return m={tag:m,create:x,destroy:j,deps:O,next:null},x=Tn.updateQueue,x===null?(x={lastEffect:null,stores:null},Tn.updateQueue=x,x.lastEffect=m.next=m):(j=x.lastEffect,j===null?x.lastEffect=m.next=m:(O=j.next,j.next=m,m.next=O,x.lastEffect=m)),m}function gx(){return Is().memoizedState}function Gf(m,x,j,O){var G=Ka();Tn.flags|=m,G.memoizedState=Vl(1|x,j,void 0,O===void 0?null:O)}function sl(m,x,j,O){var G=Is();O=O===void 0?null:O;var se=void 0;if(Yn!==null){var ye=Yn.memoizedState;if(se=ye.destroy,O!==null&&Hl(O,ye.deps)){G.memoizedState=Vl(x,j,se,O);return}}Tn.flags|=m,G.memoizedState=Vl(1|x,j,se,O)}function mx(m,x){return Gf(8390656,8,m,x)}function Vf(m,x){return sl(2048,8,m,x)}function J0(m,x){return sl(4,2,m,x)}function xn(m,x){return sl(4,4,m,x)}function Kf(m,x){if(typeof x=="function")return m=m(),x(m),function(){x(null)};if(x!=null)return m=m(),x.current=m,function(){x.current=null}}function ud(m,x,j){return j=j!=null?j.concat([m]):null,sl(4,4,Kf.bind(null,x,m),j)}function Kl(){}function Z0(m,x){var j=Is();x=x===void 0?null:x;var O=j.memoizedState;return O!==null&&x!==null&&Hl(x,O[1])?O[0]:(j.memoizedState=[m,x],m)}function qf(m,x){var j=Is();x=x===void 0?null:x;var O=j.memoizedState;return O!==null&&x!==null&&Hl(x,O[1])?O[0]:(m=m(),j.memoizedState=[m,x],m)}function Kc(m,x,j){return(nl&21)===0?(m.baseState&&(m.baseState=!1,ds=!0),m.memoizedState=j):(Ni(j,x)||(j=Ef(),Tn.lanes|=j,Ao|=j,m.baseState=!0),x)}function Xf(m,x){var j=Ur;Ur=j!==0&&4>j?j:4,m(!0);var O=zl.transition;zl.transition={};try{m(!1),x()}finally{Ur=j,zl.transition=O}}function ql(){return Is().memoizedState}function px(m,x,j){var O=hs(m);if(j={lane:O,action:j,hasEagerState:!1,eagerState:null,next:null},xx(m))eg(x,j);else if(j=U0(m,x,j,O),j!==null){var G=kn();Ks(j,m,O,G),dd(j,x,O)}}function fv(m,x,j){var O=hs(m),G={lane:O,action:j,hasEagerState:!1,eagerState:null,next:null};if(xx(m))eg(x,G);else{var se=m.alternate;if(m.lanes===0&&(se===null||se.lanes===0)&&(se=x.lastRenderedReducer,se!==null))try{var ye=x.lastRenderedState,Be=se(ye,j);if(G.hasEagerState=!0,G.eagerState=Be,Ni(Be,ye)){var dt=x.interleaved;dt===null?(G.next=G,Bf(x)):(G.next=dt.next,dt.next=G),x.interleaved=G;return}}catch{}finally{}j=U0(m,x,G,O),j!==null&&(G=kn(),Ks(j,m,O,G),dd(j,x,O))}}function xx(m){var x=m.alternate;return m===Tn||x!==null&&x===Tn}function eg(m,x){od=Hc=!0;var j=m.pending;j===null?x.next=x:(x.next=j.next,j.next=x),m.pending=x}function dd(m,x,j){if((j&4194240)!==0){var O=x.lanes;O&=m.pendingLanes,j|=O,x.lanes=j,Hi(m,j)}}var Xl={readContext:Ga,useCallback:Ss,useContext:Ss,useEffect:Ss,useImperativeHandle:Ss,useInsertionEffect:Ss,useLayoutEffect:Ss,useMemo:Ss,useReducer:Ss,useRef:Ss,useState:Ss,useDebugValue:Ss,useDeferredValue:Ss,useTransition:Ss,useMutableSource:Ss,useSyncExternalStore:Ss,useId:Ss,unstable_isNewReconciler:!1},tg={readContext:Ga,useCallback:function(m,x){return Ka().memoizedState=[m,x===void 0?null:x],m},useContext:Ga,useEffect:mx,useImperativeHandle:function(m,x,j){return j=j!=null?j.concat([m]):null,Gf(4194308,4,Kf.bind(null,x,m),j)},useLayoutEffect:function(m,x){return Gf(4194308,4,m,x)},useInsertionEffect:function(m,x){return Gf(4,2,m,x)},useMemo:function(m,x){var j=Ka();return x=x===void 0?null:x,m=m(),j.memoizedState=[m,x],m},useReducer:function(m,x,j){var O=Ka();return x=j!==void 0?j(x):x,O.memoizedState=O.baseState=x,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:x},O.queue=m,m=m.dispatch=px.bind(null,Tn,m),[O.memoizedState,m]},useRef:function(m){var x=Ka();return m={current:m},x.memoizedState=m},useState:Hf,useDebugValue:Kl,useDeferredValue:function(m){return Ka().memoizedState=m},useTransition:function(){var m=Hf(!1),x=m[0];return m=Xf.bind(null,m[1]),Ka().memoizedState=m,[x,m]},useMutableSource:function(){},useSyncExternalStore:function(m,x,j){var O=Tn,G=Ka();if(Sn){if(j===void 0)throw Error(i(407));j=j()}else{if(j=x(),dn===null)throw Error(i(349));(nl&30)!==0||q0(O,x,j)}G.memoizedState=j;var se={value:j,getSnapshot:x};return G.queue=se,mx(Y0.bind(null,O,se,m),[m]),O.flags|=2048,Vl(9,X0.bind(null,O,se,j,x),void 0,null),j},useId:function(){var m=Ka(),x=dn.identifierPrefix;if(Sn){var j=Ai,O=Ta;j=(O&~(1<<32-_s(O)-1)).toString(32)+j,x=":"+x+"R"+j,j=ld++,0<j&&(x+="H"+j.toString(32)),x+=":"}else j=Gc++,x=":"+x+"r"+j.toString(32)+":";return m.memoizedState=x},unstable_isNewReconciler:!1},rg={readContext:Ga,useCallback:Z0,useContext:Ga,useEffect:Vf,useImperativeHandle:ud,useInsertionEffect:J0,useLayoutEffect:xn,useMemo:qf,useReducer:zf,useRef:gx,useState:function(){return zf(Gl)},useDebugValue:Kl,useDeferredValue:function(m){var x=Is();return Kc(x,Yn.memoizedState,m)},useTransition:function(){var m=zf(Gl)[0],x=Is().memoizedState;return[m,x]},useMutableSource:V0,useSyncExternalStore:K0,useId:ql,unstable_isNewReconciler:!1},ng={readContext:Ga,useCallback:Z0,useContext:Ga,useEffect:Vf,useImperativeHandle:ud,useInsertionEffect:J0,useLayoutEffect:xn,useMemo:qf,useReducer:Vc,useRef:gx,useState:function(){return Vc(Gl)},useDebugValue:Kl,useDeferredValue:function(m){var x=Is();return Yn===null?x.memoizedState=m:Kc(x,Yn.memoizedState,m)},useTransition:function(){var m=Vc(Gl)[0],x=Is().memoizedState;return[m,x]},useMutableSource:V0,useSyncExternalStore:K0,useId:ql,unstable_isNewReconciler:!1};function qa(m,x){if(m&&m.defaultProps){x=a({},x),m=m.defaultProps;for(var j in m)x[j]===void 0&&(x[j]=m[j]);return x}return x}function sg(m,x,j,O){x=m.memoizedState,j=j(O,x),j=j==null?x:a({},x,j),m.memoizedState=j,m.lanes===0&&(m.updateQueue.baseState=j)}var fd={isMounted:function(m){return(m=m._reactInternals)?D(m)===m:!1},enqueueSetState:function(m,x,j){m=m._reactInternals;var O=kn(),G=hs(m),se=So(O,G);se.payload=x,j!=null&&(se.callback=j),x=ko(m,se,G),x!==null&&(Ks(x,m,G,O),id(x,m,G))},enqueueReplaceState:function(m,x,j){m=m._reactInternals;var O=kn(),G=hs(m),se=So(O,G);se.tag=1,se.payload=x,j!=null&&(se.callback=j),x=ko(m,se,G),x!==null&&(Ks(x,m,G,O),id(x,m,G))},enqueueForceUpdate:function(m,x){m=m._reactInternals;var j=kn(),O=hs(m),G=So(j,O);G.tag=2,x!=null&&(G.callback=x),x=ko(m,G,O),x!==null&&(Ks(x,m,O,j),id(x,m,O))}};function yx(m,x,j,O,G,se,ye){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(O,se,ye):x.prototype&&x.prototype.isPureReactComponent?!If(j,O)||!If(G,se):!0}function vx(m,x,j){var O=!1,G=re,se=x.contextType;return typeof se=="object"&&se!==null?se=Ga(se):(G=or(x)?Je:de.current,O=x.contextTypes,se=(O=O!=null)?gr(m,G):re),x=new x(j,se),m.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=fd,m.stateNode=x,x._reactInternals=m,O&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=G,m.__reactInternalMemoizedMaskedChildContext=se),x}function Yf(m,x,j,O){m=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(j,O),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(j,O),x.state!==m&&fd.enqueueReplaceState(x,x.state,null)}function Vi(m,x,j,O){var G=m.stateNode;G.props=j,G.state=m.memoizedState,G.refs={},$0(m);var se=x.contextType;typeof se=="object"&&se!==null?G.context=Ga(se):(se=or(x)?Je:de.current,G.context=gr(m,se)),G.state=m.memoizedState,se=x.getDerivedStateFromProps,typeof se=="function"&&(sg(m,x,se,j),G.state=m.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof G.getSnapshotBeforeUpdate=="function"||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(x=G.state,typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount(),x!==G.state&&fd.enqueueReplaceState(G,G.state,null),el(m,j,G,O),G.state=m.memoizedState),typeof G.componentDidMount=="function"&&(m.flags|=4194308)}function Yl(m,x){try{var j="",O=x;do j+=dv(O),O=O.return;while(O);var G=j}catch(se){G=`
Error generating stack: `+se.message+`
`+se.stack}return{value:m,source:x,stack:G,digest:null}}function al(m,x,j){return{value:m,source:null,stack:j??null,digest:x??null}}function fi(m,x){try{console.error(x.value)}catch(j){setTimeout(function(){throw j})}}var hd=typeof WeakMap=="function"?WeakMap:Map;function Ki(m,x,j){j=So(-1,j),j.tag=3,j.payload={element:null};var O=x.value;return j.callback=function(){$n||($n=!0,Qn=O),fi(m,x)},j}function Qf(m,x,j){j=So(-1,j),j.tag=3;var O=m.type.getDerivedStateFromError;if(typeof O=="function"){var G=x.value;j.payload=function(){return O(G)},j.callback=function(){fi(m,x)}}var se=m.stateNode;return se!==null&&typeof se.componentDidCatch=="function"&&(j.callback=function(){fi(m,x),typeof O!="function"&&(Di===null?Di=new Set([this]):Di.add(this));var ye=x.stack;this.componentDidCatch(x.value,{componentStack:ye!==null?ye:""})}),j}function wx(m,x,j){var O=m.pingCache;if(O===null){O=m.pingCache=new hd;var G=new Set;O.set(x,G)}else G=O.get(x),G===void 0&&(G=new Set,O.set(x,G));G.has(j)||(G.add(j),m=Nx.bind(null,m,x,j),x.then(m,m))}function _x(m){do{var x;if((x=m.tag===13)&&(x=m.memoizedState,x=x!==null?x.dehydrated!==null:!0),x)return m;m=m.return}while(m!==null);return null}function il(m,x,j,O,G){return(m.mode&1)===0?(m===x?m.flags|=65536:(m.flags|=128,j.flags|=131072,j.flags&=-52805,j.tag===1&&(j.alternate===null?j.tag=17:(x=So(-1,1),x.tag=2,ko(j,x,1))),j.lanes|=1),m):(m.flags|=65536,m.lanes=G,m)}var gd=l.ReactCurrentOwner,ds=!1;function ks(m,x,j,O){x.child=m===null?ux(x,null,j,O):Ul(x,m.child,j,O)}function Jf(m,x,j,O,G){j=j.render;var se=x.ref;return $c(x,G),O=cd(m,x,j,O,se,G),j=Wf(),m!==null&&!ds?(x.updateQueue=m.updateQueue,x.flags&=-2053,m.lanes&=~G,Eo(m,x,G)):(Sn&&j&&rd(x),x.flags|=1,ks(m,x,O,G),x.child)}function Ql(m,x,j,O,G){if(m===null){var se=j.type;return typeof se=="function"&&!lu(se)&&se.defaultProps===void 0&&j.compare===null&&j.defaultProps===void 0?(x.tag=15,x.type=se,To(m,x,se,O,G)):(m=gh(j.type,null,O,x,x.mode,G),m.ref=x.ref,m.return=x,x.child=m)}if(se=m.child,(m.lanes&G)===0){var ye=se.memoizedProps;if(j=j.compare,j=j!==null?j:If,j(ye,O)&&m.ref===x.ref)return Eo(m,x,G)}return x.flags|=1,m=pl(se,O),m.ref=x.ref,m.return=x,x.child=m}function To(m,x,j,O,G){if(m!==null){var se=m.memoizedProps;if(If(se,O)&&m.ref===x.ref)if(ds=!1,x.pendingProps=O=se,(m.lanes&G)!==0)(m.flags&131072)!==0&&(ds=!0);else return x.lanes=m.lanes,Eo(m,x,G)}return qi(m,x,j,O,G)}function yn(m,x,j){var O=x.pendingProps,G=O.children,se=m!==null?m.memoizedState:null;if(O.mode==="hidden")if((x.mode&1)===0)x.memoizedState={baseLanes:0,cachePool:null,transitions:null},jt(fl,fs),fs|=j;else{if((j&1073741824)===0)return m=se!==null?se.baseLanes|j:j,x.lanes=x.childLanes=1073741824,x.memoizedState={baseLanes:m,cachePool:null,transitions:null},x.updateQueue=null,jt(fl,fs),fs|=m,null;x.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=se!==null?se.baseLanes:j,jt(fl,fs),fs|=O}else se!==null?(O=se.baseLanes|j,x.memoizedState=null):O=j,jt(fl,fs),fs|=O;return ks(m,x,G,j),x.child}function un(m,x){var j=x.ref;(m===null&&j!==null||m!==null&&m.ref!==j)&&(x.flags|=512,x.flags|=2097152)}function qi(m,x,j,O,G){var se=or(j)?Je:de.current;return se=gr(x,se),$c(x,G),j=cd(m,x,j,O,se,G),O=Wf(),m!==null&&!ds?(x.updateQueue=m.updateQueue,x.flags&=-2053,m.lanes&=~G,Eo(m,x,G)):(Sn&&O&&rd(x),x.flags|=1,ks(m,x,j,G),x.child)}function Ms(m,x,j,O,G){if(or(j)){var se=!0;Zr(x)}else se=!1;if($c(x,G),x.stateNode===null)md(m,x),vx(x,j,O),Vi(x,j,O,G),O=!0;else if(m===null){var ye=x.stateNode,Be=x.memoizedProps;ye.props=Be;var dt=ye.context,Mt=j.contextType;typeof Mt=="object"&&Mt!==null?Mt=Ga(Mt):(Mt=or(j)?Je:de.current,Mt=gr(x,Mt));var ar=j.getDerivedStateFromProps,Tr=typeof ar=="function"||typeof ye.getSnapshotBeforeUpdate=="function";Tr||typeof ye.UNSAFE_componentWillReceiveProps!="function"&&typeof ye.componentWillReceiveProps!="function"||(Be!==O||dt!==Mt)&&Yf(x,ye,O,Mt),Va=!1;var er=x.memoizedState;ye.state=er,el(x,O,ye,G),dt=x.memoizedState,Be!==O||er!==dt||Pe.current||Va?(typeof ar=="function"&&(sg(x,j,ar,O),dt=x.memoizedState),(Be=Va||yx(x,j,Be,O,er,dt,Mt))?(Tr||typeof ye.UNSAFE_componentWillMount!="function"&&typeof ye.componentWillMount!="function"||(typeof ye.componentWillMount=="function"&&ye.componentWillMount(),typeof ye.UNSAFE_componentWillMount=="function"&&ye.UNSAFE_componentWillMount()),typeof ye.componentDidMount=="function"&&(x.flags|=4194308)):(typeof ye.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=O,x.memoizedState=dt),ye.props=O,ye.state=dt,ye.context=Mt,O=Be):(typeof ye.componentDidMount=="function"&&(x.flags|=4194308),O=!1)}else{ye=x.stateNode,fx(m,x),Be=x.memoizedProps,Mt=x.type===x.elementType?Be:qa(x.type,Be),ye.props=Mt,Tr=x.pendingProps,er=ye.context,dt=j.contextType,typeof dt=="object"&&dt!==null?dt=Ga(dt):(dt=or(j)?Je:de.current,dt=gr(x,dt));var wn=j.getDerivedStateFromProps;(ar=typeof wn=="function"||typeof ye.getSnapshotBeforeUpdate=="function")||typeof ye.UNSAFE_componentWillReceiveProps!="function"&&typeof ye.componentWillReceiveProps!="function"||(Be!==Tr||er!==dt)&&Yf(x,ye,O,dt),Va=!1,er=x.memoizedState,ye.state=er,el(x,O,ye,G);var on=x.memoizedState;Be!==Tr||er!==on||Pe.current||Va?(typeof wn=="function"&&(sg(x,j,wn,O),on=x.memoizedState),(Mt=Va||yx(x,j,Mt,O,er,on,dt)||!1)?(ar||typeof ye.UNSAFE_componentWillUpdate!="function"&&typeof ye.componentWillUpdate!="function"||(typeof ye.componentWillUpdate=="function"&&ye.componentWillUpdate(O,on,dt),typeof ye.UNSAFE_componentWillUpdate=="function"&&ye.UNSAFE_componentWillUpdate(O,on,dt)),typeof ye.componentDidUpdate=="function"&&(x.flags|=4),typeof ye.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof ye.componentDidUpdate!="function"||Be===m.memoizedProps&&er===m.memoizedState||(x.flags|=4),typeof ye.getSnapshotBeforeUpdate!="function"||Be===m.memoizedProps&&er===m.memoizedState||(x.flags|=1024),x.memoizedProps=O,x.memoizedState=on),ye.props=O,ye.state=on,ye.context=dt,O=Mt):(typeof ye.componentDidUpdate!="function"||Be===m.memoizedProps&&er===m.memoizedState||(x.flags|=4),typeof ye.getSnapshotBeforeUpdate!="function"||Be===m.memoizedProps&&er===m.memoizedState||(x.flags|=1024),O=!1)}return Hs(m,x,j,O,se,G)}function Hs(m,x,j,O,G,se){un(m,x);var ye=(x.flags&128)!==0;if(!O&&!ye)return G&&dr(x,j,!1),Eo(m,x,se);O=x.stateNode,gd.current=x;var Be=ye&&typeof j.getDerivedStateFromError!="function"?null:O.render();return x.flags|=1,m!==null&&ye?(x.child=Ul(x,m.child,null,se),x.child=Ul(x,null,Be,se)):ks(m,x,Be,se),x.memoizedState=O.state,G&&dr(x,j,!0),x.child}function ol(m){var x=m.stateNode;x.pendingContext?Dr(m,x.pendingContext,x.pendingContext!==x.context):x.context&&Dr(m,x.context,!1),Uf(m,x.containerInfo)}function Jl(m,x,j,O,G){return Ll(),O0(G),x.flags|=256,ks(m,x,j,O),x.child}var Gs={dehydrated:null,treeContext:null,retryLane:0};function qc(m){return{baseLanes:m,cachePool:null,transitions:null}}function ag(m,x,j){var O=x.pendingProps,G=Pn.current,se=!1,ye=(x.flags&128)!==0,Be;if((Be=ye)||(Be=m!==null&&m.memoizedState===null?!1:(G&2)!==0),Be?(se=!0,x.flags&=-129):(m===null||m.memoizedState!==null)&&(G|=1),jt(Pn,G&1),m===null)return M0(x),m=x.memoizedState,m!==null&&(m=m.dehydrated,m!==null)?((x.mode&1)===0?x.lanes=1:Mr(m)?x.lanes=8:x.lanes=1073741824,null):(ye=O.children,m=O.fallback,se?(O=x.mode,se=x.child,ye={mode:"hidden",children:ye},(O&1)===0&&se!==null?(se.childLanes=0,se.pendingProps=ye):se=cu(ye,O,0,null),m=Os(m,O,j,null),se.return=x,m.return=x,se.sibling=m,x.child=se,x.child.memoizedState=qc(j),x.memoizedState=Gs,m):Zf(x,ye));if(G=m.memoizedState,G!==null&&(Be=G.dehydrated,Be!==null))return bx(m,x,ye,O,Be,G,j);if(se){se=O.fallback,ye=x.mode,G=m.child,Be=G.sibling;var dt={mode:"hidden",children:O.children};return(ye&1)===0&&x.child!==G?(O=x.child,O.childLanes=0,O.pendingProps=dt,x.deletions=null):(O=pl(G,dt),O.subtreeFlags=G.subtreeFlags&14680064),Be!==null?se=pl(Be,se):(se=Os(se,ye,j,null),se.flags|=2),se.return=x,O.return=x,O.sibling=se,x.child=O,O=se,se=x.child,ye=m.child.memoizedState,ye=ye===null?qc(j):{baseLanes:ye.baseLanes|j,cachePool:null,transitions:ye.transitions},se.memoizedState=ye,se.childLanes=m.childLanes&~j,x.memoizedState=Gs,O}return se=m.child,m=se.sibling,O=pl(se,{mode:"visible",children:O.children}),(x.mode&1)===0&&(O.lanes=j),O.return=x,O.sibling=null,m!==null&&(j=x.deletions,j===null?(x.deletions=[m],x.flags|=16):j.push(m)),x.child=O,x.memoizedState=null,O}function Zf(m,x){return x=cu({mode:"visible",children:x},m.mode,0,null),x.return=m,m.child=x}function Zl(m,x,j,O){return O!==null&&O0(O),Ul(x,m.child,null,j),m=Zf(x,x.pendingProps.children),m.flags|=2,x.memoizedState=null,m}function bx(m,x,j,O,G,se,ye){if(j)return x.flags&256?(x.flags&=-257,O=al(Error(i(422))),Zl(m,x,ye,O)):x.memoizedState!==null?(x.child=m.child,x.flags|=128,null):(se=O.fallback,G=x.mode,O=cu({mode:"visible",children:O.children},G,0,null),se=Os(se,G,ye,null),se.flags|=2,O.return=x,se.return=x,O.sibling=se,x.child=O,(x.mode&1)!==0&&Ul(x,m.child,null,ye),x.child.memoizedState=qc(ye),x.memoizedState=Gs,se);if((x.mode&1)===0)return Zl(m,x,ye,null);if(Mr(G))return O=sn(G).digest,se=Error(i(419)),O=al(se,O,void 0),Zl(m,x,ye,O);if(j=(ye&m.childLanes)!==0,ds||j){if(O=dn,O!==null){switch(ye&-ye){case 4:G=2;break;case 16:G=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:G=32;break;case 536870912:G=268435456;break;default:G=0}G=(G&(O.suspendedLanes|ye))!==0?0:G,G!==0&&G!==se.retryLane&&(se.retryLane=G,Pi(m,G),Ks(O,m,G,-1))}return ou(),O=al(Error(i(421))),Zl(m,x,ye,O)}return vr(G)?(x.flags|=128,x.child=m.child,x=jx.bind(null,m),le(G,x),null):(m=se.treeContext,me&&(ia=Se(G),Ds=x,Sn=!0,Fi=null,sd=!1,m!==null&&(aa[Ha++]=Ta,aa[Ha++]=Ai,aa[Ha++]=cs,Ta=m.id,Ai=m.overflow,cs=x)),x=Zf(x,O.children),x.flags|=4096,x)}function Xi(m,x,j){m.lanes|=x;var O=m.alternate;O!==null&&(O.lanes|=x),$l(m.return,x,j)}function Xc(m,x,j,O,G){var se=m.memoizedState;se===null?m.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:O,tail:j,tailMode:G}:(se.isBackwards=x,se.rendering=null,se.renderingStartTime=0,se.last=O,se.tail=j,se.tailMode=G)}function eh(m,x,j){var O=x.pendingProps,G=O.revealOrder,se=O.tail;if(ks(m,x,O.children,j),O=Pn.current,(O&2)!==0)O=O&1|2,x.flags|=128;else{if(m!==null&&(m.flags&128)!==0)e:for(m=x.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&Xi(m,j,x);else if(m.tag===19)Xi(m,j,x);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===x)break e;for(;m.sibling===null;){if(m.return===null||m.return===x)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}O&=1}if(jt(Pn,O),(x.mode&1)===0)x.memoizedState=null;else switch(G){case"forwards":for(j=x.child,G=null;j!==null;)m=j.alternate,m!==null&&$f(m)===null&&(G=j),j=j.sibling;j=G,j===null?(G=x.child,x.child=null):(G=j.sibling,j.sibling=null),Xc(x,!1,G,j,se);break;case"backwards":for(j=null,G=x.child,x.child=null;G!==null;){if(m=G.alternate,m!==null&&$f(m)===null){x.child=G;break}m=G.sibling,G.sibling=j,j=G,G=m}Xc(x,!0,j,null,se);break;case"together":Xc(x,!1,null,null,void 0);break;default:x.memoizedState=null}return x.child}function md(m,x){(x.mode&1)===0&&m!==null&&(m.alternate=null,x.alternate=null,x.flags|=2)}function Eo(m,x,j){if(m!==null&&(x.dependencies=m.dependencies),Ao|=x.lanes,(j&x.childLanes)===0)return null;if(m!==null&&x.child!==m.child)throw Error(i(153));if(x.child!==null){for(m=x.child,j=pl(m,m.pendingProps),x.child=j,j.return=x;m.sibling!==null;)m=m.sibling,j=j.sibling=pl(m,m.pendingProps),j.return=x;j.sibling=null}return x.child}function ll(m,x,j){switch(x.tag){case 3:ol(x),Ll();break;case 5:W0(x);break;case 1:or(x.type)&&Zr(x);break;case 4:Uf(x,x.stateNode.containerInfo);break;case 10:dx(x,x.type._context,x.memoizedProps.value);break;case 13:var O=x.memoizedState;if(O!==null)return O.dehydrated!==null?(jt(Pn,Pn.current&1),x.flags|=128,null):(j&x.child.childLanes)!==0?ag(m,x,j):(jt(Pn,Pn.current&1),m=Eo(m,x,j),m!==null?m.sibling:null);jt(Pn,Pn.current&1);break;case 19:if(O=(j&x.childLanes)!==0,(m.flags&128)!==0){if(O)return eh(m,x,j);x.flags|=128}var G=x.memoizedState;if(G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),jt(Pn,Pn.current),O)break;return null;case 22:case 23:return x.lanes=0,yn(m,x,j)}return Eo(m,x,j)}function oa(m){m.flags|=4}function ec(m,x){if(m!==null&&m.child===x.child)return!0;if((x.flags&16)!==0)return!1;for(m=x.child;m!==null;){if((m.flags&12854)!==0||(m.subtreeFlags&12854)!==0)return!1;m=m.sibling}return!0}var cl,ul,la,ca;if(Me)cl=function(m,x){for(var j=x.child;j!==null;){if(j.tag===5||j.tag===6)B(m,j.stateNode);else if(j.tag!==4&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===x)break;for(;j.sibling===null;){if(j.return===null||j.return===x)return;j=j.return}j.sibling.return=j.return,j=j.sibling}},ul=function(){},la=function(m,x,j,O,G){if(m=m.memoizedProps,m!==O){var se=x.stateNode,ye=di(ui.current);j=Q(se,j,m,O,G,ye),(x.updateQueue=j)&&oa(x)}},ca=function(m,x,j,O){j!==O&&oa(x)};else if(ue){cl=function(m,x,j,O){for(var G=x.child;G!==null;){if(G.tag===5){var se=G.stateNode;j&&O&&(se=Ot(se,G.type,G.memoizedProps,G)),B(m,se)}else if(G.tag===6)se=G.stateNode,j&&O&&(se=Xt(se,G.memoizedProps,G)),B(m,se);else if(G.tag!==4){if(G.tag===22&&G.memoizedState!==null)se=G.child,se!==null&&(se.return=G),cl(m,G,!0,!0);else if(G.child!==null){G.child.return=G,G=G.child;continue}}if(G===x)break;for(;G.sibling===null;){if(G.return===null||G.return===x)return;G=G.return}G.sibling.return=G.return,G=G.sibling}};var dl=function(m,x,j,O){for(var G=x.child;G!==null;){if(G.tag===5){var se=G.stateNode;j&&O&&(se=Ot(se,G.type,G.memoizedProps,G)),St(m,se)}else if(G.tag===6)se=G.stateNode,j&&O&&(se=Xt(se,G.memoizedProps,G)),St(m,se);else if(G.tag!==4){if(G.tag===22&&G.memoizedState!==null)se=G.child,se!==null&&(se.return=G),dl(m,G,!0,!0);else if(G.child!==null){G.child.return=G,G=G.child;continue}}if(G===x)break;for(;G.sibling===null;){if(G.return===null||G.return===x)return;G=G.return}G.sibling.return=G.return,G=G.sibling}};ul=function(m,x){var j=x.stateNode;if(!ec(m,x)){m=j.containerInfo;var O=Ue(m);dl(O,x,!1,!1),j.pendingChildren=O,oa(x),xt(m,O)}},la=function(m,x,j,O,G){var se=m.stateNode,ye=m.memoizedProps;if((m=ec(m,x))&&ye===O)x.stateNode=se;else{var Be=x.stateNode,dt=di(ui.current),Mt=null;ye!==O&&(Mt=Q(Be,j,ye,O,G,dt)),m&&Mt===null?x.stateNode=se:(se=we(se,Mt,j,ye,O,x,m,Be),z(se,j,O,G,dt)&&oa(x),x.stateNode=se,m?oa(x):cl(se,x,!1,!1))}},ca=function(m,x,j,O){j!==O?(m=di(rl.current),j=di(ui.current),x.stateNode=te(O,m,j,x),oa(x)):x.stateNode=m.stateNode}}else ul=function(){},la=function(){},ca=function(){};function Xa(m,x){if(!Sn)switch(m.tailMode){case"hidden":x=m.tail;for(var j=null;x!==null;)x.alternate!==null&&(j=x),x=x.sibling;j===null?m.tail=null:j.sibling=null;break;case"collapsed":j=m.tail;for(var O=null;j!==null;)j.alternate!==null&&(O=j),j=j.sibling;O===null?x||m.tail===null?m.tail=null:m.tail.sibling=null:O.sibling=null}}function En(m){var x=m.alternate!==null&&m.alternate.child===m.child,j=0,O=0;if(x)for(var G=m.child;G!==null;)j|=G.lanes|G.childLanes,O|=G.subtreeFlags&14680064,O|=G.flags&14680064,G.return=m,G=G.sibling;else for(G=m.child;G!==null;)j|=G.lanes|G.childLanes,O|=G.subtreeFlags,O|=G.flags,G.return=m,G=G.sibling;return m.subtreeFlags|=O,m.childLanes=j,x}function tc(m,x,j){var O=x.pendingProps;switch(nd(x),x.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return En(x),null;case 1:return or(x.type)&&Or(),En(x),null;case 3:return j=x.stateNode,Wl(),tt(Pe),tt(de),G0(),j.pendingContext&&(j.context=j.pendingContext,j.pendingContext=null),(m===null||m.child===null)&&(Df(x)?oa(x):m===null||m.memoizedState.isDehydrated&&(x.flags&256)===0||(x.flags|=1024,Fi!==null&&(fh(Fi),Fi=null))),ul(m,x),En(x),null;case 5:z0(x),j=di(rl.current);var G=x.type;if(m!==null&&x.stateNode!=null)la(m,x,G,O,j),m.ref!==x.ref&&(x.flags|=512,x.flags|=2097152);else{if(!O){if(x.stateNode===null)throw Error(i(166));return En(x),null}if(m=di(ui.current),Df(x)){if(!me)throw Error(i(175));m=ke(x.stateNode,x.type,x.memoizedProps,j,m,x,!sd),x.updateQueue=m,m!==null&&oa(x)}else{var se=K(G,O,j,m,x);cl(se,x,!1,!1),x.stateNode=se,z(se,G,O,j,m)&&oa(x)}x.ref!==null&&(x.flags|=512,x.flags|=2097152)}return En(x),null;case 6:if(m&&x.stateNode!=null)ca(m,x,m.memoizedProps,O);else{if(typeof O!="string"&&x.stateNode===null)throw Error(i(166));if(m=di(rl.current),j=di(ui.current),Df(x)){if(!me)throw Error(i(176));if(m=x.stateNode,j=x.memoizedProps,(O=$e(m,j,x,!sd))&&(G=Ds,G!==null))switch(G.tag){case 3:ot(G.stateNode.containerInfo,m,j,(G.mode&1)!==0);break;case 5:Le(G.type,G.memoizedProps,G.stateNode,m,j,(G.mode&1)!==0)}O&&oa(x)}else x.stateNode=te(O,m,j,x)}return En(x),null;case 13:if(tt(Pn),O=x.memoizedState,m===null||m.memoizedState!==null&&m.memoizedState.dehydrated!==null){if(Sn&&ia!==null&&(x.mode&1)!==0&&(x.flags&128)===0)ox(),Ll(),x.flags|=98560,G=!1;else if(G=Df(x),O!==null&&O.dehydrated!==null){if(m===null){if(!G)throw Error(i(318));if(!me)throw Error(i(344));if(G=x.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(i(317));ht(G,x)}else Ll(),(x.flags&128)===0&&(x.memoizedState=null),x.flags|=4;En(x),G=!1}else Fi!==null&&(fh(Fi),Fi=null),G=!0;if(!G)return x.flags&65536?x:null}return(x.flags&128)!==0?(x.lanes=j,x):(j=O!==null,j!==(m!==null&&m.memoizedState!==null)&&j&&(x.child.flags|=8192,(x.mode&1)!==0&&(m===null||(Pn.current&1)!==0?An===0&&(An=3):ou())),x.updateQueue!==null&&(x.flags|=4),En(x),null);case 4:return Wl(),ul(m,x),m===null&&qe(x.stateNode.containerInfo),En(x),null;case 10:return ad(x.type._context),En(x),null;case 17:return or(x.type)&&Or(),En(x),null;case 19:if(tt(Pn),G=x.memoizedState,G===null)return En(x),null;if(O=(x.flags&128)!==0,se=G.rendering,se===null)if(O)Xa(G,!1);else{if(An!==0||m!==null&&(m.flags&128)!==0)for(m=x.child;m!==null;){if(se=$f(m),se!==null){for(x.flags|=128,Xa(G,!1),m=se.updateQueue,m!==null&&(x.updateQueue=m,x.flags|=4),x.subtreeFlags=0,m=j,j=x.child;j!==null;)O=j,G=m,O.flags&=14680066,se=O.alternate,se===null?(O.childLanes=0,O.lanes=G,O.child=null,O.subtreeFlags=0,O.memoizedProps=null,O.memoizedState=null,O.updateQueue=null,O.dependencies=null,O.stateNode=null):(O.childLanes=se.childLanes,O.lanes=se.lanes,O.child=se.child,O.subtreeFlags=0,O.deletions=null,O.memoizedProps=se.memoizedProps,O.memoizedState=se.memoizedState,O.updateQueue=se.updateQueue,O.type=se.type,G=se.dependencies,O.dependencies=G===null?null:{lanes:G.lanes,firstContext:G.firstContext}),j=j.sibling;return jt(Pn,Pn.current&1|2),x.child}m=m.sibling}G.tail!==null&&bs()>bd&&(x.flags|=128,O=!0,Xa(G,!1),x.lanes=4194304)}else{if(!O)if(m=$f(se),m!==null){if(x.flags|=128,O=!0,m=m.updateQueue,m!==null&&(x.updateQueue=m,x.flags|=4),Xa(G,!0),G.tail===null&&G.tailMode==="hidden"&&!se.alternate&&!Sn)return En(x),null}else 2*bs()-G.renderingStartTime>bd&&j!==1073741824&&(x.flags|=128,O=!0,Xa(G,!1),x.lanes=4194304);G.isBackwards?(se.sibling=x.child,x.child=se):(m=G.last,m!==null?m.sibling=se:x.child=se,G.last=se)}return G.tail!==null?(x=G.tail,G.rendering=x,G.tail=x.sibling,G.renderingStartTime=bs(),x.sibling=null,m=Pn.current,jt(Pn,O?m&1|2:m&1),x):(En(x),null);case 22:case 23:return hh(),j=x.memoizedState!==null,m!==null&&m.memoizedState!==null!==j&&(x.flags|=8192),j&&(x.mode&1)!==0?(fs&1073741824)!==0&&(En(x),Me&&x.subtreeFlags&6&&(x.flags|=8192)):En(x),null;case 24:return null;case 25:return null}throw Error(i(156,x.tag))}function Sx(m,x){switch(nd(x),x.tag){case 1:return or(x.type)&&Or(),m=x.flags,m&65536?(x.flags=m&-65537|128,x):null;case 3:return Wl(),tt(Pe),tt(de),G0(),m=x.flags,(m&65536)!==0&&(m&128)===0?(x.flags=m&-65537|128,x):null;case 5:return z0(x),null;case 13:if(tt(Pn),m=x.memoizedState,m!==null&&m.dehydrated!==null){if(x.alternate===null)throw Error(i(340));Ll()}return m=x.flags,m&65536?(x.flags=m&-65537|128,x):null;case 19:return tt(Pn),null;case 4:return Wl(),null;case 10:return ad(x.type._context),null;case 22:case 23:return hh(),null;case 24:return null;default:return null}}var Yc=!1,Cs=!1,Ya=typeof WeakSet=="function"?WeakSet:Set,Zt=null;function an(m,x){var j=m.ref;if(j!==null)if(typeof j=="function")try{j(null)}catch(O){Cn(m,x,O)}else j.current=null}function Qa(m,x,j){try{j()}catch(O){Cn(m,x,O)}}var ig=!1;function kx(m,x){for(L(m.containerInfo),Zt=x;Zt!==null;)if(m=Zt,x=m.child,(m.subtreeFlags&1028)!==0&&x!==null)x.return=m,Zt=x;else for(;Zt!==null;){m=Zt;try{var j=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(j!==null){var O=j.memoizedProps,G=j.memoizedState,se=m.stateNode,ye=se.getSnapshotBeforeUpdate(m.elementType===m.type?O:qa(m.type,O),G);se.__reactInternalSnapshotBeforeUpdate=ye}break;case 3:Me&&fe(m.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Be){Cn(m,m.return,Be)}if(x=m.sibling,x!==null){x.return=m.return,Zt=x;break}Zt=m.return}return j=ig,ig=!1,j}function rc(m,x,j){var O=x.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var G=O=O.next;do{if((G.tag&m)===m){var se=G.destroy;G.destroy=void 0,se!==void 0&&Qa(x,j,se)}G=G.next}while(G!==O)}}function Qc(m,x){if(x=x.updateQueue,x=x!==null?x.lastEffect:null,x!==null){var j=x=x.next;do{if((j.tag&m)===m){var O=j.create;j.destroy=O()}j=j.next}while(j!==x)}}function th(m){var x=m.ref;if(x!==null){var j=m.stateNode;switch(m.tag){case 5:m=ne(j);break;default:m=j}typeof x=="function"?x(m):x.current=m}}function pd(m){var x=m.alternate;x!==null&&(m.alternate=null,pd(x)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(x=m.stateNode,x!==null&&Ve(x)),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function og(m){return m.tag===5||m.tag===3||m.tag===4}function nc(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||og(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function xd(m,x,j){var O=m.tag;if(O===5||O===6)m=m.stateNode,x?De(j,m,x):yt(j,m);else if(O!==4&&(m=m.child,m!==null))for(xd(m,x,j),m=m.sibling;m!==null;)xd(m,x,j),m=m.sibling}function lg(m,x,j){var O=m.tag;if(O===5||O===6)m=m.stateNode,x?Jt(j,m,x):Qe(j,m);else if(O!==4&&(m=m.child,m!==null))for(lg(m,x,j),m=m.sibling;m!==null;)lg(m,x,j),m=m.sibling}var Hn=null,Na=!1;function Ri(m,x,j){for(j=j.child;j!==null;)rh(m,x,j),j=j.sibling}function rh(m,x,j){if(Ca&&typeof Ca.onCommitFiberUnmount=="function")try{Ca.onCommitFiberUnmount(Qo,j)}catch{}switch(j.tag){case 5:Cs||an(j,x);case 6:if(Me){var O=Hn,G=Na;Hn=null,Ri(m,x,j),Hn=O,Na=G,Hn!==null&&(Na?pt(Hn,j.stateNode):ut(Hn,j.stateNode))}else Ri(m,x,j);break;case 18:Me&&Hn!==null&&(Na?Ne(Hn,j.stateNode):Ce(Hn,j.stateNode));break;case 4:Me?(O=Hn,G=Na,Hn=j.stateNode.containerInfo,Na=!0,Ri(m,x,j),Hn=O,Na=G):(ue&&(O=j.stateNode.containerInfo,G=Ue(O),Ht(O,G)),Ri(m,x,j));break;case 0:case 11:case 14:case 15:if(!Cs&&(O=j.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){G=O=O.next;do{var se=G,ye=se.destroy;se=se.tag,ye!==void 0&&((se&2)!==0||(se&4)!==0)&&Qa(j,x,ye),G=G.next}while(G!==O)}Ri(m,x,j);break;case 1:if(!Cs&&(an(j,x),O=j.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=j.memoizedProps,O.state=j.memoizedState,O.componentWillUnmount()}catch(Be){Cn(j,x,Be)}Ri(m,x,j);break;case 21:Ri(m,x,j);break;case 22:j.mode&1?(Cs=(O=Cs)||j.memoizedState!==null,Ri(m,x,j),Cs=O):Ri(m,x,j);break;default:Ri(m,x,j)}}function sc(m){var x=m.updateQueue;if(x!==null){m.updateQueue=null;var j=m.stateNode;j===null&&(j=m.stateNode=new Ya),x.forEach(function(O){var G=hv.bind(null,m,O);j.has(O)||(j.add(O),O.then(G,G))})}}function hi(m,x){var j=x.deletions;if(j!==null)for(var O=0;O<j.length;O++){var G=j[O];try{var se=m,ye=x;if(Me){var Be=ye;e:for(;Be!==null;){switch(Be.tag){case 5:Hn=Be.stateNode,Na=!1;break e;case 3:Hn=Be.stateNode.containerInfo,Na=!0;break e;case 4:Hn=Be.stateNode.containerInfo,Na=!0;break e}Be=Be.return}if(Hn===null)throw Error(i(160));rh(se,ye,G),Hn=null,Na=!1}else rh(se,ye,G);var dt=G.alternate;dt!==null&&(dt.return=null),G.return=null}catch(Mt){Cn(G,x,Mt)}}if(x.subtreeFlags&12854)for(x=x.child;x!==null;)yd(x,m),x=x.sibling}function yd(m,x){var j=m.alternate,O=m.flags;switch(m.tag){case 0:case 11:case 14:case 15:if(hi(x,m),Ja(m),O&4){try{rc(3,m,m.return),Qc(3,m)}catch(er){Cn(m,m.return,er)}try{rc(5,m,m.return)}catch(er){Cn(m,m.return,er)}}break;case 1:hi(x,m),Ja(m),O&512&&j!==null&&an(j,j.return);break;case 5:if(hi(x,m),Ja(m),O&512&&j!==null&&an(j,j.return),Me){if(m.flags&32){var G=m.stateNode;try{Pt(G)}catch(er){Cn(m,m.return,er)}}if(O&4&&(G=m.stateNode,G!=null)){var se=m.memoizedProps;if(j=j!==null?j.memoizedProps:se,O=m.type,x=m.updateQueue,m.updateQueue=null,x!==null)try{zt(G,x,O,j,se,m)}catch(er){Cn(m,m.return,er)}}}break;case 6:if(hi(x,m),Ja(m),O&4&&Me){if(m.stateNode===null)throw Error(i(162));G=m.stateNode,se=m.memoizedProps,j=j!==null?j.memoizedProps:se;try{ft(G,j,se)}catch(er){Cn(m,m.return,er)}}break;case 3:if(hi(x,m),Ja(m),O&4){if(Me&&me&&j!==null&&j.memoizedState.isDehydrated)try{oe(x.containerInfo)}catch(er){Cn(m,m.return,er)}if(ue){G=x.containerInfo,se=x.pendingChildren;try{Ht(G,se)}catch(er){Cn(m,m.return,er)}}}break;case 4:if(hi(x,m),Ja(m),O&4&&ue){se=m.stateNode,G=se.containerInfo,se=se.pendingChildren;try{Ht(G,se)}catch(er){Cn(m,m.return,er)}}break;case 13:hi(x,m),Ja(m),G=m.child,G.flags&8192&&(se=G.memoizedState!==null,G.stateNode.isHidden=se,!se||G.alternate!==null&&G.alternate.memoizedState!==null||(nu=bs())),O&4&&sc(m);break;case 22:var ye=j!==null&&j.memoizedState!==null;if(m.mode&1?(Cs=(j=Cs)||ye,hi(x,m),Cs=j):hi(x,m),Ja(m),O&8192){if(j=m.memoizedState!==null,(m.stateNode.isHidden=j)&&!ye&&(m.mode&1)!==0)for(Zt=m,O=m.child;O!==null;){for(x=Zt=O;Zt!==null;){ye=Zt;var Be=ye.child;switch(ye.tag){case 0:case 11:case 14:case 15:rc(4,ye,ye.return);break;case 1:an(ye,ye.return);var dt=ye.stateNode;if(typeof dt.componentWillUnmount=="function"){var Mt=ye,ar=ye.return;try{var Tr=Mt;dt.props=Tr.memoizedProps,dt.state=Tr.memoizedState,dt.componentWillUnmount()}catch(er){Cn(Mt,ar,er)}}break;case 5:an(ye,ye.return);break;case 22:if(ye.memoizedState!==null){ah(x);continue}}Be!==null?(Be.return=ye,Zt=Be):ah(x)}O=O.sibling}if(Me){e:if(O=null,Me)for(x=m;;){if(x.tag===5){if(O===null){O=x;try{G=x.stateNode,j?Lt(G):Te(x.stateNode,x.memoizedProps)}catch(er){Cn(m,m.return,er)}}}else if(x.tag===6){if(O===null)try{se=x.stateNode,j?sr(se):ve(se,x.memoizedProps)}catch(er){Cn(m,m.return,er)}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===m)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===m)break e;for(;x.sibling===null;){if(x.return===null||x.return===m)break e;O===x&&(O=null),x=x.return}O===x&&(O=null),x.sibling.return=x.return,x=x.sibling}}}break;case 19:hi(x,m),Ja(m),O&4&&sc(m);break;case 21:break;default:hi(x,m),Ja(m)}}function Ja(m){var x=m.flags;if(x&2){try{if(Me){e:{for(var j=m.return;j!==null;){if(og(j)){var O=j;break e}j=j.return}throw Error(i(160))}switch(O.tag){case 5:var G=O.stateNode;O.flags&32&&(Pt(G),O.flags&=-33);var se=nc(m);lg(m,se,G);break;case 3:case 4:var ye=O.stateNode.containerInfo,Be=nc(m);xd(m,Be,ye);break;default:throw Error(i(161))}}}catch(dt){Cn(m,m.return,dt)}m.flags&=-3}x&4096&&(m.flags&=-4097)}function Jc(m,x,j){Zt=m,nh(m)}function nh(m,x,j){for(var O=(m.mode&1)!==0;Zt!==null;){var G=Zt,se=G.child;if(G.tag===22&&O){var ye=G.memoizedState!==null||Yc;if(!ye){var Be=G.alternate,dt=Be!==null&&Be.memoizedState!==null||Cs;Be=Yc;var Mt=Cs;if(Yc=ye,(Cs=dt)&&!Mt)for(Zt=G;Zt!==null;)ye=Zt,dt=ye.child,ye.tag===22&&ye.memoizedState!==null?ih(G):dt!==null?(dt.return=ye,Zt=dt):ih(G);for(;se!==null;)Zt=se,nh(se),se=se.sibling;Zt=G,Yc=Be,Cs=Mt}sh(m)}else(G.subtreeFlags&8772)!==0&&se!==null?(se.return=G,Zt=se):sh(m)}}function sh(m){for(;Zt!==null;){var x=Zt;if((x.flags&8772)!==0){var j=x.alternate;try{if((x.flags&8772)!==0)switch(x.tag){case 0:case 11:case 15:Cs||Qc(5,x);break;case 1:var O=x.stateNode;if(x.flags&4&&!Cs)if(j===null)O.componentDidMount();else{var G=x.elementType===x.type?j.memoizedProps:qa(x.type,j.memoizedProps);O.componentDidUpdate(G,j.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var se=x.updateQueue;se!==null&&hx(x,se,O);break;case 3:var ye=x.updateQueue;if(ye!==null){if(j=null,x.child!==null)switch(x.child.tag){case 5:j=ne(x.child.stateNode);break;case 1:j=x.child.stateNode}hx(x,ye,j)}break;case 5:var Be=x.stateNode;j===null&&x.flags&4&&_t(Be,x.type,x.memoizedProps,x);break;case 6:break;case 4:break;case 12:break;case 13:if(me&&x.memoizedState===null){var dt=x.alternate;if(dt!==null){var Mt=dt.memoizedState;if(Mt!==null){var ar=Mt.dehydrated;ar!==null&&he(ar)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Cs||x.flags&512&&th(x)}catch(Tr){Cn(x,x.return,Tr)}}if(x===m){Zt=null;break}if(j=x.sibling,j!==null){j.return=x.return,Zt=j;break}Zt=x.return}}function ah(m){for(;Zt!==null;){var x=Zt;if(x===m){Zt=null;break}var j=x.sibling;if(j!==null){j.return=x.return,Zt=j;break}Zt=x.return}}function ih(m){for(;Zt!==null;){var x=Zt;try{switch(x.tag){case 0:case 11:case 15:var j=x.return;try{Qc(4,x)}catch(dt){Cn(x,j,dt)}break;case 1:var O=x.stateNode;if(typeof O.componentDidMount=="function"){var G=x.return;try{O.componentDidMount()}catch(dt){Cn(x,G,dt)}}var se=x.return;try{th(x)}catch(dt){Cn(x,se,dt)}break;case 5:var ye=x.return;try{th(x)}catch(dt){Cn(x,ye,dt)}}}catch(dt){Cn(x,x.return,dt)}if(x===m){Zt=null;break}var Be=x.sibling;if(Be!==null){Be.return=x.return,Zt=Be;break}Zt=x.return}}var No=0,ua=1,Yi=2,Zc=3,vd=4;if(typeof Symbol=="function"&&Symbol.for){var Za=Symbol.for;No=Za("selector.component"),ua=Za("selector.has_pseudo_class"),Yi=Za("selector.role"),Zc=Za("selector.test_id"),vd=Za("selector.text")}function Qi(m){var x=He(m);if(x!=null){if(typeof x.memoizedProps["data-testname"]!="string")throw Error(i(364));return x}if(m=je(m),m===null)throw Error(i(362));return m.stateNode.current}function wd(m,x){switch(x.$$typeof){case No:if(m.type===x.value)return!0;break;case ua:e:{x=x.value,m=[m,0];for(var j=0;j<m.length;){var O=m[j++],G=m[j++],se=x[G];if(O.tag!==5||!mt(O)){for(;se!=null&&wd(O,se);)G++,se=x[G];if(G===x.length){x=!0;break e}else for(O=O.child;O!==null;)m.push(O,G),O=O.sibling}}x=!1}return x;case Yi:if(m.tag===5&&$t(m.stateNode,x.value))return!0;break;case vd:if((m.tag===5||m.tag===6)&&(m=bt(m),m!==null&&0<=m.indexOf(x.value)))return!0;break;case Zc:if(m.tag===5&&(m=m.memoizedProps["data-testname"],typeof m=="string"&&m.toLowerCase()===x.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function oh(m){switch(m.$$typeof){case No:return"<"+(R(m.value)||"Unknown")+">";case ua:return":has("+(oh(m)||"")+")";case Yi:return'[role="'+m.value+'"]';case vd:return'"'+m.value+'"';case Zc:return'[data-testname="'+m.value+'"]';default:throw Error(i(365))}}function Ji(m,x){var j=[];m=[m,0];for(var O=0;O<m.length;){var G=m[O++],se=m[O++],ye=x[se];if(G.tag!==5||!mt(G)){for(;ye!=null&&wd(G,ye);)se++,ye=x[se];if(se===x.length)j.push(G);else for(G=G.child;G!==null;)m.push(G,se),G=G.sibling}}return j}function Zi(m,x){if(!Ie)throw Error(i(363));m=Qi(m),m=Ji(m,x),x=[],m=Array.from(m);for(var j=0;j<m.length;){var O=m[j++];if(O.tag===5)mt(O)||x.push(O.stateNode);else for(O=O.child;O!==null;)m.push(O),O=O.sibling}return x}var lh=Math.ceil,_d=l.ReactCurrentDispatcher,eu=l.ReactCurrentOwner,Un=l.ReactCurrentBatchConfig,Nr=0,dn=null,Nn=null,Gn=0,fs=0,fl=Qt(0),An=0,tu=null,Ao=0,vn=0,ru=0,ac=null,Vs=null,nu=0,bd=1/0,da=null;function cn(){bd=bs()+500}var $n=!1,Qn=null,Di=null,hl=!1,gi=null,ch=0,Jn=0,Sd=null,su=-1,au=0;function kn(){return(Nr&6)!==0?bs():su!==-1?su:su=bs()}function hs(m){return(m.mode&1)===0?1:(Nr&2)!==0&&Gn!==0?Gn&-Gn:uv.transition!==null?(au===0&&(au=Ef()),au):(m=Ur,m!==0?m:Xe())}function Ks(m,x,j,O){if(50<Jn)throw Jn=0,Sd=null,Error(i(185));ci(m,j,O),((Nr&2)===0||m!==dn)&&(m===dn&&((Nr&2)===0&&(vn|=j),An===4&&jo(m,Gn)),qs(m,O),j===1&&Nr===0&&(x.mode&1)===0&&(cn(),Lc&&Rs()))}function qs(m,x){var j=m.callbackNode;ex(m,x);var O=Dc(m,m===dn?Gn:0);if(O===0)j!==null&&tx(j),m.callbackNode=null,m.callbackPriority=0;else if(x=O&-O,m.callbackPriority!==x){if(j!=null&&tx(j),x===1)m.tag===0?nx(cg.bind(null,m)):Pf(cg.bind(null,m)),It?st(function(){(Nr&6)===0&&Rs()}):Gi(Nf,Rs),j=null;else{switch(Mc(O)){case 1:j=Nf;break;case 4:j=Af;break;case 16:j=jf;break;case 536870912:j=cv;break;default:j=jf}j=pg(j,uh.bind(null,m))}m.callbackPriority=x,m.callbackNode=j}}function uh(m,x){if(su=-1,au=0,(Nr&6)!==0)throw Error(i(327));var j=m.callbackNode;if(Fo()&&m.callbackNode!==j)return null;var O=Dc(m,m===dn?Gn:0);if(O===0)return null;if((O&30)!==0||(O&m.expiredLanes)!==0||x)x=ic(m,O);else{x=O;var G=Nr;Nr|=2;var se=dg();(dn!==m||Gn!==x)&&(da=null,cn(),gl(m,x));do try{fg();break}catch(Be){iu(m,Be)}while(!0);B0(),_d.current=se,Nr=G,Nn!==null?x=0:(dn=null,Gn=0,x=An)}if(x!==0){if(x===2&&(G=Tf(m),G!==0&&(O=G,x=dh(m,G))),x===1)throw j=tu,gl(m,0),jo(m,O),qs(m,bs()),j;if(x===6)jo(m,O);else{if(G=m.current.alternate,(O&30)===0&&!Cx(G)&&(x=ic(m,O),x===2&&(se=Tf(m),se!==0&&(O=se,x=dh(m,se))),x===1))throw j=tu,gl(m,0),jo(m,O),qs(m,bs()),j;switch(m.finishedWork=G,m.finishedLanes=O,x){case 0:case 1:throw Error(i(345));case 2:ml(m,Vs,da);break;case 3:if(jo(m,O),(O&130023424)===O&&(x=nu+500-bs(),10<x)){if(Dc(m,0)!==0)break;if(G=m.suspendedLanes,(G&O)!==O){kn(),m.pingedLanes|=m.suspendedLanes&G;break}m.timeoutHandle=ee(ml.bind(null,m,Vs,da),x);break}ml(m,Vs,da);break;case 4:if(jo(m,O),(O&4194240)===O)break;for(x=m.eventTimes,G=-1;0<O;){var ye=31-_s(O);se=1<<ye,ye=x[ye],ye>G&&(G=ye),O&=~se}if(O=G,O=bs()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*lh(O/1960))-O,10<O){m.timeoutHandle=ee(ml.bind(null,m,Vs,da),O);break}ml(m,Vs,da);break;case 5:ml(m,Vs,da);break;default:throw Error(i(329))}}}return qs(m,bs()),m.callbackNode===j?uh.bind(null,m):null}function dh(m,x){var j=ac;return m.current.memoizedState.isDehydrated&&(gl(m,x).flags|=256),m=ic(m,x),m!==2&&(x=Vs,Vs=j,x!==null&&fh(x)),m}function fh(m){Vs===null?Vs=m:Vs.push.apply(Vs,m)}function Cx(m){for(var x=m;;){if(x.flags&16384){var j=x.updateQueue;if(j!==null&&(j=j.stores,j!==null))for(var O=0;O<j.length;O++){var G=j[O],se=G.getSnapshot;G=G.value;try{if(!Ni(se(),G))return!1}catch{return!1}}}if(j=x.child,x.subtreeFlags&16384&&j!==null)j.return=x,x=j;else{if(x===m)break;for(;x.sibling===null;){if(x.return===null||x.return===m)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function jo(m,x){for(x&=~ru,x&=~vn,m.suspendedLanes|=x,m.pingedLanes&=~x,m=m.expirationTimes;0<x;){var j=31-_s(x),O=1<<j;m[j]=-1,x&=~O}}function cg(m){if((Nr&6)!==0)throw Error(i(327));Fo();var x=Dc(m,0);if((x&1)===0)return qs(m,bs()),null;var j=ic(m,x);if(m.tag!==0&&j===2){var O=Tf(m);O!==0&&(x=O,j=dh(m,O))}if(j===1)throw j=tu,gl(m,0),jo(m,x),qs(m,bs()),j;if(j===6)throw Error(i(345));return m.finishedWork=m.current.alternate,m.finishedLanes=x,ml(m,Vs,da),qs(m,bs()),null}function ug(m){gi!==null&&gi.tag===0&&(Nr&6)===0&&Fo();var x=Nr;Nr|=1;var j=Un.transition,O=Ur;try{if(Un.transition=null,Ur=1,m)return m()}finally{Ur=O,Un.transition=j,Nr=x,(Nr&6)===0&&Rs()}}function hh(){fs=fl.current,tt(fl)}function gl(m,x){m.finishedWork=null,m.finishedLanes=0;var j=m.timeoutHandle;if(j!==ge&&(m.timeoutHandle=ge,ae(j)),Nn!==null)for(j=Nn.return;j!==null;){var O=j;switch(nd(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&Or();break;case 3:Wl(),tt(Pe),tt(de),G0();break;case 5:z0(O);break;case 4:Wl();break;case 13:tt(Pn);break;case 19:tt(Pn);break;case 10:ad(O.type._context);break;case 22:case 23:hh()}j=j.return}if(dn=m,Nn=m=pl(m.current,null),Gn=fs=x,An=0,tu=null,ru=vn=Ao=0,Vs=ac=null,Zo!==null){for(x=0;x<Zo.length;x++)if(j=Zo[x],O=j.interleaved,O!==null){j.interleaved=null;var G=O.next,se=j.pending;if(se!==null){var ye=se.next;se.next=G,O.next=ye}j.pending=O}Zo=null}return m}function iu(m,x){do{var j=Nn;try{if(B0(),Ea.current=Xl,Hc){for(var O=Tn.memoizedState;O!==null;){var G=O.queue;G!==null&&(G.pending=null),O=O.next}Hc=!1}if(nl=0,us=Yn=Tn=null,od=!1,ld=0,eu.current=null,j===null||j.return===null){An=1,tu=x,Nn=null;break}e:{var se=m,ye=j.return,Be=j,dt=x;if(x=Gn,Be.flags|=32768,dt!==null&&typeof dt=="object"&&typeof dt.then=="function"){var Mt=dt,ar=Be,Tr=ar.tag;if((ar.mode&1)===0&&(Tr===0||Tr===11||Tr===15)){var er=ar.alternate;er?(ar.updateQueue=er.updateQueue,ar.memoizedState=er.memoizedState,ar.lanes=er.lanes):(ar.updateQueue=null,ar.memoizedState=null)}var wn=_x(ye);if(wn!==null){wn.flags&=-257,il(wn,ye,Be,se,x),wn.mode&1&&wx(se,Mt,x),x=wn,dt=Mt;var on=x.updateQueue;if(on===null){var fa=new Set;fa.add(dt),x.updateQueue=fa}else on.add(dt);break e}else{if((x&1)===0){wx(se,Mt,x),ou();break e}dt=Error(i(426))}}else if(Sn&&Be.mode&1){var eo=_x(ye);if(eo!==null){(eo.flags&65536)===0&&(eo.flags|=256),il(eo,ye,Be,se,x),O0(Yl(dt,Be));break e}}se=dt=Yl(dt,Be),An!==4&&(An=2),ac===null?ac=[se]:ac.push(se),se=ye;do{switch(se.tag){case 3:se.flags|=65536,x&=-x,se.lanes|=x;var it=Ki(se,dt,x);Wc(se,it);break e;case 1:Be=dt;var ze=se.type,gt=se.stateNode;if((se.flags&128)===0&&(typeof ze.getDerivedStateFromError=="function"||gt!==null&&typeof gt.componentDidCatch=="function"&&(Di===null||!Di.has(gt)))){se.flags|=65536,x&=-x,se.lanes|=x;var tr=Qf(se,Be,x);Wc(se,tr);break e}}se=se.return}while(se!==null)}gg(j)}catch(hr){x=hr,Nn===j&&j!==null&&(Nn=j=j.return);continue}break}while(!0)}function dg(){var m=_d.current;return _d.current=Xl,m===null?Xl:m}function ou(){(An===0||An===3||An===2)&&(An=4),dn===null||(Ao&268435455)===0&&(vn&268435455)===0||jo(dn,Gn)}function ic(m,x){var j=Nr;Nr|=2;var O=dg();(dn!==m||Gn!==x)&&(da=null,gl(m,x));do try{Tx();break}catch(G){iu(m,G)}while(!0);if(B0(),Nr=j,_d.current=O,Nn!==null)throw Error(i(261));return dn=null,Gn=0,An}function Tx(){for(;Nn!==null;)hg(Nn)}function fg(){for(;Nn!==null&&!rx();)hg(Nn)}function hg(m){var x=Fx(m.alternate,m,fs);m.memoizedProps=m.pendingProps,x===null?gg(m):Nn=x,eu.current=null}function gg(m){var x=m;do{var j=x.alternate;if(m=x.return,(x.flags&32768)===0){if(j=tc(j,x,fs),j!==null){Nn=j;return}}else{if(j=Sx(j,x),j!==null){j.flags&=32767,Nn=j;return}if(m!==null)m.flags|=32768,m.subtreeFlags=0,m.deletions=null;else{An=6,Nn=null;return}}if(x=x.sibling,x!==null){Nn=x;return}Nn=x=m}while(x!==null);An===0&&(An=5)}function ml(m,x,j){var O=Ur,G=Un.transition;try{Un.transition=null,Ur=1,Ex(m,x,j,O)}finally{Un.transition=G,Ur=O}return null}function Ex(m,x,j,O){do Fo();while(gi!==null);if((Nr&6)!==0)throw Error(i(327));j=m.finishedWork;var G=m.finishedLanes;if(j===null)return null;if(m.finishedWork=null,m.finishedLanes=0,j===m.current)throw Error(i(177));m.callbackNode=null,m.callbackPriority=0;var se=j.lanes|j.childLanes;if(Yo(m,se),m===dn&&(Nn=dn=null,Gn=0),(j.subtreeFlags&2064)===0&&(j.flags&2064)===0||hl||(hl=!0,pg(jf,function(){return Fo(),null})),se=(j.flags&15990)!==0,(j.subtreeFlags&15990)!==0||se){se=Un.transition,Un.transition=null;var ye=Ur;Ur=1;var Be=Nr;Nr|=4,eu.current=null,kx(m,j),yd(j,m),H(m.containerInfo),m.current=j,Jc(j),ed(),Nr=Be,Ur=ye,Un.transition=se}else m.current=j;if(hl&&(hl=!1,gi=m,ch=G),se=m.pendingLanes,se===0&&(Di=null),Oc(j.stateNode),qs(m,bs()),x!==null)for(O=m.onRecoverableError,j=0;j<x.length;j++)G=x[j],O(G.value,{componentStack:G.stack,digest:G.digest});if($n)throw $n=!1,m=Qn,Qn=null,m;return(ch&1)!==0&&m.tag!==0&&Fo(),se=m.pendingLanes,(se&1)!==0?m===Sd?Jn++:(Jn=0,Sd=m):Jn=0,Rs(),null}function Fo(){if(gi!==null){var m=Mc(ch),x=Un.transition,j=Ur;try{if(Un.transition=null,Ur=16>m?16:m,gi===null)var O=!1;else{if(m=gi,gi=null,ch=0,(Nr&6)!==0)throw Error(i(331));var G=Nr;for(Nr|=4,Zt=m.current;Zt!==null;){var se=Zt,ye=se.child;if((Zt.flags&16)!==0){var Be=se.deletions;if(Be!==null){for(var dt=0;dt<Be.length;dt++){var Mt=Be[dt];for(Zt=Mt;Zt!==null;){var ar=Zt;switch(ar.tag){case 0:case 11:case 15:rc(8,ar,se)}var Tr=ar.child;if(Tr!==null)Tr.return=ar,Zt=Tr;else for(;Zt!==null;){ar=Zt;var er=ar.sibling,wn=ar.return;if(pd(ar),ar===Mt){Zt=null;break}if(er!==null){er.return=wn,Zt=er;break}Zt=wn}}}var on=se.alternate;if(on!==null){var fa=on.child;if(fa!==null){on.child=null;do{var eo=fa.sibling;fa.sibling=null,fa=eo}while(fa!==null)}}Zt=se}}if((se.subtreeFlags&2064)!==0&&ye!==null)ye.return=se,Zt=ye;else e:for(;Zt!==null;){if(se=Zt,(se.flags&2048)!==0)switch(se.tag){case 0:case 11:case 15:rc(9,se,se.return)}var it=se.sibling;if(it!==null){it.return=se.return,Zt=it;break e}Zt=se.return}}var ze=m.current;for(Zt=ze;Zt!==null;){ye=Zt;var gt=ye.child;if((ye.subtreeFlags&2064)!==0&&gt!==null)gt.return=ye,Zt=gt;else e:for(ye=ze;Zt!==null;){if(Be=Zt,(Be.flags&2048)!==0)try{switch(Be.tag){case 0:case 11:case 15:Qc(9,Be)}}catch(hr){Cn(Be,Be.return,hr)}if(Be===ye){Zt=null;break e}var tr=Be.sibling;if(tr!==null){tr.return=Be.return,Zt=tr;break e}Zt=Be.return}}if(Nr=G,Rs(),Ca&&typeof Ca.onPostCommitFiberRoot=="function")try{Ca.onPostCommitFiberRoot(Qo,m)}catch{}O=!0}return O}finally{Ur=j,Un.transition=x}}return!1}function mg(m,x,j){x=Yl(j,x),x=Ki(m,x,1),m=ko(m,x,1),x=kn(),m!==null&&(ci(m,1,x),qs(m,x))}function Cn(m,x,j){if(m.tag===3)mg(m,m,j);else for(;x!==null;){if(x.tag===3){mg(x,m,j);break}else if(x.tag===1){var O=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(Di===null||!Di.has(O))){m=Yl(j,m),m=Qf(x,m,1),x=ko(x,m,1),m=kn(),x!==null&&(ci(x,1,m),qs(x,m));break}}x=x.return}}function Nx(m,x,j){var O=m.pingCache;O!==null&&O.delete(x),x=kn(),m.pingedLanes|=m.suspendedLanes&j,dn===m&&(Gn&j)===j&&(An===4||An===3&&(Gn&130023424)===Gn&&500>bs()-nu?gl(m,0):ru|=j),qs(m,x)}function Ax(m,x){x===0&&((m.mode&1)===0?x=1:(x=Zu,Zu<<=1,(Zu&130023424)===0&&(Zu=4194304)));var j=kn();m=Pi(m,x),m!==null&&(ci(m,x,j),qs(m,j))}function jx(m){var x=m.memoizedState,j=0;x!==null&&(j=x.retryLane),Ax(m,j)}function hv(m,x){var j=0;switch(m.tag){case 13:var O=m.stateNode,G=m.memoizedState;G!==null&&(j=G.retryLane);break;case 19:O=m.stateNode;break;default:throw Error(i(314))}O!==null&&O.delete(x),Ax(m,j)}var Fx;Fx=function(m,x,j){if(m!==null)if(m.memoizedProps!==x.pendingProps||Pe.current)ds=!0;else{if((m.lanes&j)===0&&(x.flags&128)===0)return ds=!1,ll(m,x,j);ds=(m.flags&131072)!==0}else ds=!1,Sn&&(x.flags&1048576)!==0&&sx(x,Ol,x.index);switch(x.lanes=0,x.tag){case 2:var O=x.type;md(m,x),m=x.pendingProps;var G=gr(x,de.current);$c(x,j),G=cd(null,x,O,m,G,j);var se=Wf();return x.flags|=1,typeof G=="object"&&G!==null&&typeof G.render=="function"&&G.$$typeof===void 0?(x.tag=1,x.memoizedState=null,x.updateQueue=null,or(O)?(se=!0,Zr(x)):se=!1,x.memoizedState=G.state!==null&&G.state!==void 0?G.state:null,$0(x),G.updater=fd,x.stateNode=G,G._reactInternals=x,Vi(x,O,m,j),x=Hs(null,x,O,!0,se,j)):(x.tag=0,Sn&&se&&rd(x),ks(null,x,G,j),x=x.child),x;case 16:O=x.elementType;e:{switch(md(m,x),m=x.pendingProps,G=O._init,O=G(O._payload),x.type=O,G=x.tag=gv(O),m=qa(O,m),G){case 0:x=qi(null,x,O,m,j);break e;case 1:x=Ms(null,x,O,m,j);break e;case 11:x=Jf(null,x,O,m,j);break e;case 14:x=Ql(null,x,O,qa(O.type,m),j);break e}throw Error(i(306,O,""))}return x;case 0:return O=x.type,G=x.pendingProps,G=x.elementType===O?G:qa(O,G),qi(m,x,O,G,j);case 1:return O=x.type,G=x.pendingProps,G=x.elementType===O?G:qa(O,G),Ms(m,x,O,G,j);case 3:e:{if(ol(x),m===null)throw Error(i(387));O=x.pendingProps,se=x.memoizedState,G=se.element,fx(m,x),el(x,O,null,j);var ye=x.memoizedState;if(O=ye.element,me&&se.isDehydrated)if(se={element:O,isDehydrated:!1,cache:ye.cache,pendingSuspenseBoundaries:ye.pendingSuspenseBoundaries,transitions:ye.transitions},x.updateQueue.baseState=se,x.memoizedState=se,x.flags&256){G=Yl(Error(i(423)),x),x=Jl(m,x,O,j,G);break e}else if(O!==G){G=Yl(Error(i(424)),x),x=Jl(m,x,O,j,G);break e}else for(me&&(ia=xe(x.stateNode.containerInfo),Ds=x,Sn=!0,Fi=null,sd=!1),j=ux(x,null,O,j),x.child=j;j;)j.flags=j.flags&-3|4096,j=j.sibling;else{if(Ll(),O===G){x=Eo(m,x,j);break e}ks(m,x,O,j)}x=x.child}return x;case 5:return W0(x),m===null&&M0(x),O=x.type,G=x.pendingProps,se=m!==null?m.memoizedProps:null,ye=G.children,Y(O,G)?ye=null:se!==null&&Y(O,se)&&(x.flags|=32),un(m,x),ks(m,x,ye,j),x.child;case 6:return m===null&&M0(x),null;case 13:return ag(m,x,j);case 4:return Uf(x,x.stateNode.containerInfo),O=x.pendingProps,m===null?x.child=Ul(x,null,O,j):ks(m,x,O,j),x.child;case 11:return O=x.type,G=x.pendingProps,G=x.elementType===O?G:qa(O,G),Jf(m,x,O,G,j);case 7:return ks(m,x,x.pendingProps,j),x.child;case 8:return ks(m,x,x.pendingProps.children,j),x.child;case 12:return ks(m,x,x.pendingProps.children,j),x.child;case 10:e:{if(O=x.type._context,G=x.pendingProps,se=x.memoizedProps,ye=G.value,dx(x,O,ye),se!==null)if(Ni(se.value,ye)){if(se.children===G.children&&!Pe.current){x=Eo(m,x,j);break e}}else for(se=x.child,se!==null&&(se.return=x);se!==null;){var Be=se.dependencies;if(Be!==null){ye=se.child;for(var dt=Be.firstContext;dt!==null;){if(dt.context===O){if(se.tag===1){dt=So(-1,j&-j),dt.tag=2;var Mt=se.updateQueue;if(Mt!==null){Mt=Mt.shared;var ar=Mt.pending;ar===null?dt.next=dt:(dt.next=ar.next,ar.next=dt),Mt.pending=dt}}se.lanes|=j,dt=se.alternate,dt!==null&&(dt.lanes|=j),$l(se.return,j,x),Be.lanes|=j;break}dt=dt.next}}else if(se.tag===10)ye=se.type===x.type?null:se.child;else if(se.tag===18){if(ye=se.return,ye===null)throw Error(i(341));ye.lanes|=j,Be=ye.alternate,Be!==null&&(Be.lanes|=j),$l(ye,j,x),ye=se.sibling}else ye=se.child;if(ye!==null)ye.return=se;else for(ye=se;ye!==null;){if(ye===x){ye=null;break}if(se=ye.sibling,se!==null){se.return=ye.return,ye=se;break}ye=ye.return}se=ye}ks(m,x,G.children,j),x=x.child}return x;case 9:return G=x.type,O=x.pendingProps.children,$c(x,j),G=Ga(G),O=O(G),x.flags|=1,ks(m,x,O,j),x.child;case 14:return O=x.type,G=qa(O,x.pendingProps),G=qa(O.type,G),Ql(m,x,O,G,j);case 15:return To(m,x,x.type,x.pendingProps,j);case 17:return O=x.type,G=x.pendingProps,G=x.elementType===O?G:qa(O,G),md(m,x),x.tag=1,or(O)?(m=!0,Zr(x)):m=!1,$c(x,j),vx(x,O,G),Vi(x,O,G,j),Hs(null,x,O,!0,m,j);case 19:return eh(m,x,j);case 22:return yn(m,x,j)}throw Error(i(156,x.tag))};function pg(m,x){return Gi(m,x)}function Px(m,x,j,O){this.tag=m,this.key=j,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ei(m,x,j,O){return new Px(m,x,j,O)}function lu(m){return m=m.prototype,!(!m||!m.isReactComponent)}function gv(m){if(typeof m=="function")return lu(m)?1:0;if(m!=null){if(m=m.$$typeof,m===_)return 11;if(m===k)return 14}return 2}function pl(m,x){var j=m.alternate;return j===null?(j=ei(m.tag,x,m.key,m.mode),j.elementType=m.elementType,j.type=m.type,j.stateNode=m.stateNode,j.alternate=m,m.alternate=j):(j.pendingProps=x,j.type=m.type,j.flags=0,j.subtreeFlags=0,j.deletions=null),j.flags=m.flags&14680064,j.childLanes=m.childLanes,j.lanes=m.lanes,j.child=m.child,j.memoizedProps=m.memoizedProps,j.memoizedState=m.memoizedState,j.updateQueue=m.updateQueue,x=m.dependencies,j.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},j.sibling=m.sibling,j.index=m.index,j.ref=m.ref,j}function gh(m,x,j,O,G,se){var ye=2;if(O=m,typeof m=="function")lu(m)&&(ye=1);else if(typeof m=="string")ye=5;else e:switch(m){case f:return Os(j.children,G,se,x);case p:ye=8,G|=8;break;case g:return m=ei(12,j,x,G|2),m.elementType=g,m.lanes=se,m;case b:return m=ei(13,j,x,G),m.elementType=b,m.lanes=se,m;case E:return m=ei(19,j,x,G),m.elementType=E,m.lanes=se,m;case N:return cu(j,G,se,x);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case y:ye=10;break e;case v:ye=9;break e;case _:ye=11;break e;case k:ye=14;break e;case w:ye=16,O=null;break e}throw Error(i(130,m==null?m:typeof m,""))}return x=ei(ye,j,x,G),x.elementType=m,x.type=O,x.lanes=se,x}function Os(m,x,j,O){return m=ei(7,m,O,x),m.lanes=j,m}function cu(m,x,j,O){return m=ei(22,m,O,x),m.elementType=N,m.lanes=j,m.stateNode={isHidden:!1},m}function uu(m,x,j){return m=ei(6,m,null,x),m.lanes=j,m}function mh(m,x,j){return x=ei(4,m.children!==null?m.children:[],m.key,x),x.lanes=j,x.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},x}function Rx(m,x,j,O,G){this.tag=x,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ge,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ic(0),this.expirationTimes=Ic(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ic(0),this.identifierPrefix=O,this.onRecoverableError=G,me&&(this.mutableSourceEagerHydrationData=null)}function xg(m,x,j,O,G,se,ye,Be,dt){return m=new Rx(m,x,j,Be,dt),x===1?(x=1,se===!0&&(x|=8)):x=0,se=ei(3,null,null,x),m.current=se,se.stateNode=m,se.memoizedState={element:O,isDehydrated:j,cache:null,transitions:null,pendingSuspenseBoundaries:null},$0(se),m}function ph(m){if(!m)return re;m=m._reactInternals;e:{if(D(m)!==m||m.tag!==1)throw Error(i(170));var x=m;do{switch(x.tag){case 3:x=x.stateNode.context;break e;case 1:if(or(x.type)){x=x.stateNode.__reactInternalMemoizedMergedChildContext;break e}}x=x.return}while(x!==null);throw Error(i(171))}if(m.tag===1){var j=m.type;if(or(j))return Xr(m,j,x)}return x}function oc(m){var x=m._reactInternals;if(x===void 0)throw typeof m.render=="function"?Error(i(188)):(m=Object.keys(m).join(","),Error(i(268,m)));return m=X(x),m===null?null:m.stateNode}function xh(m,x){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var j=m.retryLane;m.retryLane=j!==0&&j<x?j:x}}function du(m,x){xh(m,x),(m=m.alternate)&&xh(m,x)}function mv(m){return m=X(m),m===null?null:m.stateNode}function Dx(){return null}return r.attemptContinuousHydration=function(m){if(m.tag===13){var x=Pi(m,134217728);if(x!==null){var j=kn();Ks(x,m,134217728,j)}du(m,134217728)}},r.attemptDiscreteHydration=function(m){if(m.tag===13){var x=Pi(m,1);if(x!==null){var j=kn();Ks(x,m,1,j)}du(m,1)}},r.attemptHydrationAtCurrentPriority=function(m){if(m.tag===13){var x=hs(m),j=Pi(m,x);if(j!==null){var O=kn();Ks(j,m,x,O)}du(m,x)}},r.attemptSynchronousHydration=function(m){switch(m.tag){case 3:var x=m.stateNode;if(x.current.memoizedState.isDehydrated){var j=Rc(x.pendingLanes);j!==0&&(Hi(x,j|1),qs(x,bs()),(Nr&6)===0&&(cn(),Rs()))}break;case 13:ug(function(){var O=Pi(m,1);if(O!==null){var G=kn();Ks(O,m,1,G)}}),du(m,1)}},r.batchedUpdates=function(m,x){var j=Nr;Nr|=1;try{return m(x)}finally{Nr=j,Nr===0&&(cn(),Lc&&Rs())}},r.createComponentSelector=function(m){return{$$typeof:No,value:m}},r.createContainer=function(m,x,j,O,G,se,ye){return xg(m,x,!1,null,j,O,G,se,ye)},r.createHasPseudoClassSelector=function(m){return{$$typeof:ua,value:m}},r.createHydrationContainer=function(m,x,j,O,G,se,ye,Be,dt){return m=xg(j,O,!0,m,G,se,ye,Be,dt),m.context=ph(null),j=m.current,O=kn(),G=hs(j),se=So(O,G),se.callback=x??null,ko(j,se,G),m.current.lanes=G,ci(m,G,O),qs(m,O),m},r.createPortal=function(m,x,j){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:O==null?null:""+O,children:m,containerInfo:x,implementation:j}},r.createRoleSelector=function(m){return{$$typeof:Yi,value:m}},r.createTestNameSelector=function(m){return{$$typeof:Zc,value:m}},r.createTextSelector=function(m){return{$$typeof:vd,value:m}},r.deferredUpdates=function(m){var x=Ur,j=Un.transition;try{return Un.transition=null,Ur=16,m()}finally{Ur=x,Un.transition=j}},r.discreteUpdates=function(m,x,j,O,G){var se=Ur,ye=Un.transition;try{return Un.transition=null,Ur=1,m(x,j,O,G)}finally{Ur=se,Un.transition=ye,Nr===0&&cn()}},r.findAllNodes=Zi,r.findBoundingRects=function(m,x){if(!Ie)throw Error(i(363));x=Zi(m,x),m=[];for(var j=0;j<x.length;j++)m.push(Ze(x[j]));for(x=m.length-1;0<x;x--){j=m[x];for(var O=j.x,G=O+j.width,se=j.y,ye=se+j.height,Be=x-1;0<=Be;Be--)if(x!==Be){var dt=m[Be],Mt=dt.x,ar=Mt+dt.width,Tr=dt.y,er=Tr+dt.height;if(O>=Mt&&se>=Tr&&G<=ar&&ye<=er){m.splice(x,1);break}else if(O!==Mt||j.width!==dt.width||er<se||Tr>ye){if(!(se!==Tr||j.height!==dt.height||ar<O||Mt>G)){Mt>O&&(dt.width+=Mt-O,dt.x=O),ar<G&&(dt.width=G-Mt),m.splice(x,1);break}}else{Tr>se&&(dt.height+=Tr-se,dt.y=se),er<ye&&(dt.height=ye-Tr),m.splice(x,1);break}}}return m},r.findHostInstance=oc,r.findHostInstanceWithNoPortals=function(m){return m=V(m),m=m!==null?ie(m):null,m===null?null:m.stateNode},r.findHostInstanceWithWarning=function(m){return oc(m)},r.flushControlled=function(m){var x=Nr;Nr|=1;var j=Un.transition,O=Ur;try{Un.transition=null,Ur=1,m()}finally{Ur=O,Un.transition=j,Nr=x,Nr===0&&(cn(),Rs())}},r.flushPassiveEffects=Fo,r.flushSync=ug,r.focusWithin=function(m,x){if(!Ie)throw Error(i(363));for(m=Qi(m),x=Ji(m,x),x=Array.from(x),m=0;m<x.length;){var j=x[m++];if(!mt(j)){if(j.tag===5&&Wt(j.stateNode))return!0;for(j=j.child;j!==null;)x.push(j),j=j.sibling}}return!1},r.getCurrentUpdatePriority=function(){return Ur},r.getFindAllNodesFailureDescription=function(m,x){if(!Ie)throw Error(i(363));var j=0,O=[];m=[Qi(m),0];for(var G=0;G<m.length;){var se=m[G++],ye=m[G++],Be=x[ye];if((se.tag!==5||!mt(se))&&(wd(se,Be)&&(O.push(oh(Be)),ye++,ye>j&&(j=ye)),ye<x.length))for(se=se.child;se!==null;)m.push(se,ye),se=se.sibling}if(j<x.length){for(m=[];j<x.length;j++)m.push(oh(x[j]));return`findAllNodes was able to match part of the selector:
  `+(O.join(" > ")+`

No matching component was found for:
  `)+m.join(" > ")}return null},r.getPublicRootInstance=function(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 5:return ne(m.child.stateNode);default:return m.child.stateNode}},r.injectIntoDevTools=function(m){if(m={bundleType:m.bundleType,version:m.version,rendererPackageName:m.rendererPackageName,rendererConfig:m.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:l.ReactCurrentDispatcher,findHostInstanceByFiber:mv,findFiberByHostInstance:m.findFiberByHostInstance||Dx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")m=!1;else{var x=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(x.isDisabled||!x.supportsFiber)m=!0;else{try{Qo=x.inject(m),Ca=x}catch{}m=!!x.checkDCE}}return m},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(m,x,j,O){if(!Ie)throw Error(i(363));m=Zi(m,x);var G=lt(m,j,O).disconnect;return{disconnect:function(){G()}}},r.registerMutableSourceForHydration=function(m,x){var j=x._getVersion;j=j(x._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[x,j]:m.mutableSourceEagerHydrationData.push(x,j)},r.runWithPriority=function(m,x){var j=Ur;try{return Ur=m,x()}finally{Ur=j}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(m,x,j,O){var G=x.current,se=kn(),ye=hs(G);return j=ph(j),x.context===null?x.context=j:x.pendingContext=j,x=So(se,ye),x.payload={element:m},O=O===void 0?null:O,O!==null&&(x.callback=O),m=ko(G,x,ye),m!==null&&(Ks(m,G,ye,se),id(m,G,ye)),ye},r}),pw}var r4;function iO(){return r4||(r4=1,mw.exports=aO()),mw.exports}var oO=iO();const lO=bp(oO);var xw={exports:{}},wu={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n4;function cO(){return n4||(n4=1,wu.ConcurrentRoot=1,wu.ContinuousEventPriority=4,wu.DefaultEventPriority=16,wu.DiscreteEventPriority=1,wu.IdleEventPriority=536870912,wu.LegacyRoot=0),wu}var s4;function uO(){return s4||(s4=1,xw.exports=cO()),xw.exports}var N6=uO(),dO=Br();const a4={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let i4=!1,o4=!1;const lb=".react-konva-event";let A6=!1;function fO(e){A6=e}const hO=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,gO=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,mO={};function Iy(e,t,r=mO){if(!i4&&"zIndex"in t&&(console.warn(gO),i4=!0),!o4&&t.draggable){var n=t.x!==void 0||t.y!==void 0,s=t.onDragEnd||t.onDragMove;n&&!s&&(console.warn(hO),o4=!0)}for(var a in r)if(!a4[a]){var i=a.slice(0,2)==="on",l=r[a]!==t[a];if(i&&l){var c=a.substr(2).toLowerCase();c.substr(0,7)==="content"&&(c="content"+c.substr(7,1).toUpperCase()+c.substr(8)),e.off(c,r[a])}var d=!t.hasOwnProperty(a);d&&e.setAttr(a,void 0)}var f=A6||t._useStrictMode,p={},g=!1;const y={};for(var a in t)if(!a4[a]){var i=a.slice(0,2)==="on",v=r[a]!==t[a];if(i&&v){var c=a.substr(2).toLowerCase();c.substr(0,7)==="content"&&(c="content"+c.substr(7,1).toUpperCase()+c.substr(8)),t[a]&&(y[c]=t[a])}!i&&(t[a]!==r[a]||f&&t[a]!==e.getAttr(a))&&(g=!0,p[a]=t[a])}g&&(e.setAttrs(p),Gu(e));for(var c in y)e.on(c+lb,y[c])}function Gu(e){if(!dO.Konva.autoDrawEnabled){var t=e.getLayer()||e.getStage();t&&t.batchDraw()}}var yw=w2();const j6={},pO={};Jm.Node.prototype._applyProps=Iy;function xO(e,t){if(typeof t=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${t}`);return}e.add(t),Gu(e)}function yO(e,t,r){let n=Jm[e];n||(console.error(`Konva has no node with the type ${e}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${e}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),n=Jm.Group);const s={},a={};for(var i in t){var l=i.slice(0,2)==="on";l?a[i]=t[i]:s[i]=t[i]}const c=new n(s);return Iy(c,a),c}function vO(e,t,r){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${e}"`)}function wO(e,t,r){return!1}function _O(e){return e}function bO(){return null}function SO(){return null}function kO(e,t,r,n){return pO}function CO(){}function TO(e){}function EO(e,t){return!1}function NO(){return j6}function AO(){return j6}const jO=setTimeout,FO=clearTimeout,PO=-1;function RO(e,t){return!1}const DO=!1,IO=!0,MO=!0;function OO(e,t){t.parent===e?t.moveToTop():e.add(t),Gu(e)}function LO(e,t){t.parent===e?t.moveToTop():e.add(t),Gu(e)}function F6(e,t,r){t._remove(),e.add(t),t.setZIndex(r.getZIndex()),Gu(e)}function BO(e,t,r){F6(e,t,r)}function UO(e,t){t.destroy(),t.off(lb),Gu(e)}function $O(e,t){t.destroy(),t.off(lb),Gu(e)}function WO(e,t,r){console.error(`Text components are not yet supported in ReactKonva. You text is: "${r}"`)}function zO(e,t,r){}function HO(e,t,r,n,s){Iy(e,s,n)}function GO(e){e.hide(),Gu(e)}function VO(e){}function KO(e,t){(t.visible==null||t.visible)&&e.show()}function qO(e,t){}function XO(e){}function YO(){}const QO=()=>N6.DefaultEventPriority,JO=Object.freeze(Object.defineProperty({__proto__:null,appendChild:OO,appendChildToContainer:LO,appendInitialChild:xO,cancelTimeout:FO,clearContainer:XO,commitMount:zO,commitTextUpdate:WO,commitUpdate:HO,createInstance:yO,createTextInstance:vO,detachDeletedInstance:YO,finalizeInitialChildren:wO,getChildHostContext:AO,getCurrentEventPriority:QO,getPublicInstance:_O,getRootHostContext:NO,hideInstance:GO,hideTextInstance:VO,idlePriority:yw.unstable_IdlePriority,insertBefore:F6,insertInContainerBefore:BO,isPrimaryRenderer:DO,noTimeout:PO,now:yw.unstable_now,prepareForCommit:bO,preparePortalMount:SO,prepareUpdate:kO,removeChild:UO,removeChildFromContainer:$O,resetAfterCommit:CO,resetTextContent:TO,run:yw.unstable_runWithPriority,scheduleTimeout:jO,shouldDeprioritizeSubtree:EO,shouldSetTextContent:RO,supportsMutation:MO,unhideInstance:KO,unhideTextInstance:qO,warnsIfNotActing:IO},Symbol.toStringTag,{value:"Module"}));var ZO=Object.defineProperty,eL=Object.defineProperties,tL=Object.getOwnPropertyDescriptors,l4=Object.getOwnPropertySymbols,rL=Object.prototype.hasOwnProperty,nL=Object.prototype.propertyIsEnumerable,c4=(e,t,r)=>t in e?ZO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u4=(e,t)=>{for(var r in t||(t={}))rL.call(t,r)&&c4(e,r,t[r]);if(l4)for(var r of l4(t))nL.call(t,r)&&c4(e,r,t[r]);return e},sL=(e,t)=>eL(e,tL(t)),d4,f4;typeof window<"u"&&((d4=window.document)!=null&&d4.createElement||((f4=window.navigator)==null?void 0:f4.product)==="ReactNative")?C.useLayoutEffect:C.useEffect;function P6(e,t,r){if(!e)return;if(r(e)===!0)return e;let n=e.child;for(;n;){const s=P6(n,t,r);if(s)return s;n=n.sibling}}function R6(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const h4=console.error;console.error=function(){const e=[...arguments].join("");if(e?.startsWith("Warning:")&&e.includes("useContext")){console.error=h4;return}return h4.apply(this,arguments)};const cb=R6(C.createContext(null));class D6 extends C.Component{render(){return C.createElement(cb.Provider,{value:this._reactInternals},this.props.children)}}function aL(){const e=C.useContext(cb);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=C.useId();return C.useMemo(()=>{for(const n of[e,e?.alternate]){if(!n)continue;const s=P6(n,!1,a=>{let i=a.memoizedState;for(;i;){if(i.memoizedState===t)return!0;i=i.next}});if(s)return s}},[e,t])}function iL(){const e=aL(),[t]=C.useState(()=>new Map);t.clear();let r=e;for(;r;){if(r.type&&typeof r.type=="object"){const s=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;s&&s!==cb&&!t.has(s)&&t.set(s,C.useContext(R6(s)))}r=r.return}return t}function I6(){const e=iL();return C.useMemo(()=>Array.from(e.keys()).reduce((t,r)=>n=>C.createElement(t,null,C.createElement(r.Provider,sL(u4({},n),{value:e.get(r)}))),t=>C.createElement(D6,u4({},t))),[e])}function oL(e){const t=ns.useRef({});return ns.useLayoutEffect(()=>{t.current=e}),ns.useLayoutEffect(()=>()=>{t.current={}},[]),t.current}const lL=e=>{const t=ns.useRef(null),r=ns.useRef(null),n=ns.useRef(null),s=oL(e),a=I6(),i=l=>{const{forwardedRef:c}=e;c&&(typeof c=="function"?c(l):c.current=l)};return ns.useLayoutEffect(()=>(r.current=new Jm.Stage({width:e.width,height:e.height,container:t.current}),i(r.current),n.current=$h.createContainer(r.current,N6.LegacyRoot,!1,null),$h.updateContainer(ns.createElement(a,{},e.children),n.current),()=>{Jm.isBrowser&&(i(null),$h.updateContainer(null,n.current,null),r.current.destroy())}),[]),ns.useLayoutEffect(()=>{i(r.current),Iy(r.current,e,s),$h.updateContainer(ns.createElement(a,{},e.children),n.current,null)}),ns.createElement("div",{ref:t,id:e.id,accessKey:e.accessKey,className:e.className,role:e.role,style:e.style,tabIndex:e.tabIndex,title:e.title})},Yd="Layer",cL="FastLayer",$o="Group",uL="Label",ra="Rect",ju="Circle",dL="Ellipse",fL="Wedge",xa="Line",hL="Sprite",M6="Image",kl="Text",gL="TextPath",mL="Star",pL="Ring",xL="Arc",yL="Tag",vL="Path",wL="RegularPolygon",T_="Arrow",_L="Shape",O6="Transformer",bL="18.2.13",$h=lO(JO);$h.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:ns.version,rendererPackageName:"react-konva"});const Qd=ns.forwardRef((e,t)=>ns.createElement(D6,{},ns.createElement(lL,{...e,forwardedRef:t}))),SL=fO,kL=Object.freeze(Object.defineProperty({__proto__:null,Arc:xL,Arrow:T_,Circle:ju,Ellipse:dL,FastLayer:cL,Group:$o,Image:M6,KonvaRenderer:$h,Label:uL,Layer:Yd,Line:xa,Path:vL,Rect:ra,RegularPolygon:wL,Ring:pL,Shape:_L,Sprite:hL,Stage:Qd,Star:mL,Tag:yL,Text:kl,TextPath:gL,Transformer:O6,Wedge:fL,useContextBridge:I6,useStrictMode:SL,version:bL},Symbol.toStringTag,{value:"Module"})),kt=({children:e,hover:t=!0,className:r="",paddingClass:n="p-6",...s})=>{const a=`
    bg-white rounded-xl shadow-md border border-gray-200 ${n}
    ${t?"hover:shadow-lg hover:-translate-y-1 transition-all duration-200":""}
    ${r}
  `;return o.jsx(et.div,{className:a,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},...s,children:e})},CL=({children:e,className:t=""})=>o.jsx("div",{className:`border-b border-gray-200 pb-4 mb-4 ${t}`,children:e}),TL=({children:e,className:t=""})=>o.jsx("h3",{className:`text-xl font-semibold text-gray-800 ${t}`,children:e}),EL=({children:e,className:t=""})=>o.jsx("div",{className:`py-4 ${t}`,children:e}),NL=({children:e,className:t=""})=>o.jsx("div",{className:`border-t border-gray-200 pt-4 mt-4 ${t}`,children:e});kt.Header=CL;kt.Title=TL;kt.Body=EL;kt.Footer=NL;const AL=e=>{const[t,r]=C.useState({width:800,height:600}),n=C.useRef(null),s=C.useCallback(()=>{if(e.current){e.current.getBoundingClientRect();const a=Math.min(1200,window.innerWidth*.8),i=Math.min(800,window.innerHeight*.6),l=4/3;let c=a,d=c/l;d>i&&(d=i,c=d*l),r({width:c,height:d})}},[e]);return C.useEffect(()=>(s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)),[s]),{canvasSize:t,stageRef:n,updateCanvasSize:s}},E_={convertToOriginal:(e,t,r)=>r?{x:Number(((e-r.x)/r.scale).toFixed(4)),y:Number(((t-r.y)/r.scale).toFixed(4))}:{x:e,y:t},convertToCanvas:(e,t,r)=>r?{x:Number((r.x+e*r.scale).toFixed(4)),y:Number((r.y+t*r.scale).toFixed(4))}:{x:e,y:t},isPointInImage:(e,t)=>t?e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height:!1,calculateImageScale:(e,t)=>{if(!e||!t)return 1;const r=40,n=t.width-r,s=t.height-r;return Math.min(n/e.width,s/e.height)},calculateImageInfo:(e,t)=>{if(!e||!t)return null;const r=40,n=t.width-r,s=t.height-r,a=Math.min(n/e.width,s/e.height),i=e.width*a,l=e.height*a,c=(t.width-i)/2,d=(t.height-l)/2;return{x:c,y:d,width:i,height:l,scale:a,originalWidth:e.width,originalHeight:e.height}}},jL=(e,t)=>{const[r,n]=C.useState(null),s=C.useCallback((a,i)=>E_.calculateImageInfo(a,i),[]);return C.useEffect(()=>{if(e&&t){const a=s(e,t);n(a)}},[e,t,s]),r},FL=e=>{const t=C.useCallback((n,s)=>E_.convertToOriginal(n,s,e),[e]),r=C.useCallback((n,s)=>E_.convertToCanvas(n,s,e),[e]);return{convertToOriginal:t,convertToCanvas:r}},hm={create:(e,t,r,n,s)=>({id:s,x:e-r/2,y:t-n/2,width:Math.max(r,30),height:Math.max(n,10),fill:"rgba(0, 123, 255, 0.15)",stroke:"#007bff",strokeWidth:2,cornerRadius:6,shadowColor:"rgba(0, 123, 255, 0.3)",shadowBlur:10,shadowOffset:{x:0,y:2},shadowOpacity:.5}),validate:e=>e.width>0&&e.height>0,findAtPosition:(e,t,r)=>e.find(n=>t>=n.x&&t<=n.x+n.width&&r>=n.y&&r<=n.y+n.height),generateId:()=>`block_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},Ah={create:(e,t,r,n,s,a,i)=>({id:i,startX:e,startY:t,endX:r,endY:n,startBlock:s,endBlock:a,stroke:"#dc3545",fill:"#dc3545",strokeWidth:3,pointerLength:10,pointerWidth:10}),snapToNearestBlock:(e,t,r,n=60)=>{let s=null,a=1/0;for(const i of r){const l=i.x+i.width/2,c=i.y+i.height/2,d=Math.sqrt(Math.pow(e-l,2)+Math.pow(t-c,2));d<=n&&d<a&&(a=d,s=i)}return s?{x:s.x+s.width/2,y:s.y+s.height/2,blockId:s.id,block:s,distance:a}:null},validate:(e,t,r,n,s)=>Ah.snapToNearestBlock(e,t,s)!==null,generateId:()=>`arrow_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},vw={create:(e,t,r)=>({id:r,blockId:e,word:t}),update:(e,t,r)=>e.map(n=>n.blockId===t?{...n,word:r}:n),delete:(e,t)=>e.filter(r=>r.blockId!==t),generateId:e=>`word_${e}`,validate:e=>e&&e.trim().length>0},PL={testData:{blocks:[],words:[],arrows:[],imageUrl:null},canvas:{size:{width:800,height:600},image:null,imageInfo:null,selectedTool:"edit"},creation:{isCreatingBlock:!1,isDrawingArrow:!1,blockCreationStart:null,arrowStart:null,previewBlock:null,previewArrow:null},ui:{selectedBlock:null,showWordPanel:!1,isLoading:!1,error:null}},RL=(e,t)=>{switch(t.type){case"SET_CANVAS_SIZE":return{...e,canvas:{...e.canvas,size:t.payload}};case"SET_IMAGE":return{...e,canvas:{...e.canvas,image:t.payload}};case"SET_IMAGE_INFO":return{...e,canvas:{...e.canvas,imageInfo:t.payload}};case"SET_SELECTED_TOOL":return{...e,canvas:{...e.canvas,selectedTool:t.payload}};case"ADD_BLOCK":return{...e,testData:{...e.testData,blocks:[...e.testData.blocks,t.payload]}};case"ADD_WORD":return{...e,testData:{...e.testData,words:[...e.testData.words,t.payload]}};case"ADD_ARROW":return{...e,testData:{...e.testData,arrows:[...e.testData.arrows,t.payload]}};case"UPDATE_BLOCK":return{...e,testData:{...e.testData,blocks:e.testData.blocks.map(r=>r.id===t.payload.id?{...r,...t.payload.updates}:r)}};case"DELETE_BLOCK":return{...e,testData:{...e.testData,blocks:e.testData.blocks.filter(r=>r.id!==t.payload),words:e.testData.words.filter(r=>r.blockId!==t.payload),arrows:e.testData.arrows.filter(r=>r.startBlock!==t.payload&&r.endBlock!==t.payload)}};case"UPDATE_WORDS":return{...e,testData:{...e.testData,words:t.payload}};case"SET_CREATION_STATE":return{...e,creation:{...e.creation,...t.payload}};case"SET_UI_STATE":return{...e,ui:{...e.ui,...t.payload}};case"SET_LOADING":return{...e,ui:{...e.ui,isLoading:t.payload}};case"SET_ERROR":return{...e,ui:{...e.ui,error:t.payload}};case"RESET_TESTDATA":return{...e,testData:{blocks:[],words:[],arrows:[],imageUrl:e.testData.imageUrl}};default:return e}},DL=({testName:e="",showQuestionCount:t=!0,onTestSaved:r,onCancel:n,onBackToCabinet:s,isSaving:a=!1,validationErrors:i={}})=>{const[l,c]=C.useReducer(RL,PL),{showNotification:d}=ka(),{makeAuthenticatedRequest:f}=zi(),{user:p}=Bn(),g=C.useRef(null),y=C.useRef(null),v=C.useRef(null),_=C.useRef({}),b=C.useRef({}),{canvasSize:E,stageRef:k}=AL(g),w=jL(l.canvas.image,E),{convertToOriginal:N}=FL(w);C.useEffect(()=>{c({type:"SET_CANVAS_SIZE",payload:E})},[E]),C.useEffect(()=>{w&&c({type:"SET_IMAGE_INFO",payload:w})},[w]),C.useEffect(()=>{const q=v.current;if(!q)return;const ne=l.ui.selectedBlock?.id?_.current[l.ui.selectedBlock.id]:null;ne?(q.nodes([ne]),q.getLayer()?.batchDraw()):(q.nodes([]),q.getLayer()?.batchDraw())},[l.ui.selectedBlock]);const A=C.useCallback(()=>{c({type:"SET_UI_STATE",payload:{selectedBlock:null}}),c({type:"SET_CREATION_STATE",payload:{isCreatingBlock:!1,isDrawingArrow:!1,blockCreationStart:null,arrowStart:null,previewBlock:null,previewArrow:null}}),c({type:"RESET_TESTDATA"}),c({type:"SET_ERROR",payload:null})},[]),P=C.useCallback(q=>{const ne=q.target.files[0];if(!ne||!ne.type.startsWith("image/")){d("Please select a valid image file","error");return}const M=new FileReader;M.onload=W=>{const L=W.target.result,H=new Image;H.crossOrigin="anonymous",H.onload=()=>{c({type:"SET_IMAGE",payload:H}),c({type:"SET_UI_STATE",payload:{imageUrl:L}})},H.src=L},M.readAsDataURL(ne)},[d]),R=C.useCallback(q=>{const ne=k.current;if(!ne)return;const M=ne.getPointerPosition();if(M){if(l.canvas.selectedTool==="create"){const W=hm.findAtPosition(l.testData.blocks,M.x,M.y);if(W){c({type:"SET_UI_STATE",payload:{selectedBlock:W}});return}c({type:"SET_CREATION_STATE",payload:{isCreatingBlock:!0,blockCreationStart:{x:M.x,y:M.y}}})}else if(l.canvas.selectedTool==="edit"){const W=hm.findAtPosition(l.testData.blocks,M.x,M.y);c(W?{type:"SET_UI_STATE",payload:{selectedBlock:W}}:{type:"SET_UI_STATE",payload:{selectedBlock:null}})}else if(l.canvas.selectedTool==="arrow"){const W=q.target===ne,L=hm.findAtPosition(l.testData.blocks,M.x,M.y);(W||!L)&&c({type:"SET_CREATION_STATE",payload:{isDrawingArrow:!0,arrowStart:{x:M.x,y:M.y}}})}}},[l.canvas.selectedTool,w,l.testData.blocks]),T=C.useCallback(q=>{if(l.creation.isCreatingBlock&&l.creation.blockCreationStart){const ne=k.current;if(!ne)return;const M=ne.getPointerPosition();if(!M)return;const W=Math.abs(M.x-l.creation.blockCreationStart.x),L=Math.abs(M.y-l.creation.blockCreationStart.y),H=10,K=Math.max(W,H),B=Math.max(L,H);c({type:"SET_CREATION_STATE",payload:{previewBlock:{x:Math.min(M.x,l.creation.blockCreationStart.x),y:Math.min(M.y,l.creation.blockCreationStart.y),width:K,height:B,fill:"rgba(0, 123, 255, 0.3)",stroke:"#007bff",strokeWidth:2,dash:[5,5],opacity:.7}}})}else if(l.creation.isDrawingArrow&&l.creation.arrowStart){const ne=k.current;if(!ne)return;const M=ne.getPointerPosition();if(!M)return;c({type:"SET_CREATION_STATE",payload:{previewArrow:{startX:l.creation.arrowStart.x,startY:l.creation.arrowStart.y,endX:M.x,endY:M.y,stroke:"#dc3545",fill:"#dc3545",strokeWidth:3,dash:[5,5],opacity:.7}}})}},[l.creation]),D=C.useCallback(q=>{if(l.creation.isCreatingBlock&&l.creation.blockCreationStart){const ne=k.current;if(!ne)return;const M=ne.getPointerPosition();if(!M)return;const W=Math.abs(M.x-l.creation.blockCreationStart.x),L=Math.abs(M.y-l.creation.blockCreationStart.y),H=10,K=Math.max(W,H),B=Math.max(L,H),z=Math.min(M.x,l.creation.blockCreationStart.x)+K/2,Q=Math.min(M.y,l.creation.blockCreationStart.y)+B/2,Y=hm.generateId(),te=hm.create(z,Q,K,B,Y),ee=vw.create(Y,`Word ${l.testData.blocks.length+1}`,vw.generateId(Y));c({type:"ADD_BLOCK",payload:te}),c({type:"ADD_WORD",payload:ee}),c({type:"SET_CREATION_STATE",payload:{isCreatingBlock:!1,blockCreationStart:null,previewBlock:null}}),l.testData.blocks.length===0&&c({type:"SET_UI_STATE",payload:{showWordPanel:!0}})}else if(l.creation.isDrawingArrow&&l.creation.arrowStart){const ne=k.current;if(!ne)return;const M=ne.getPointerPosition();if(!M)return;if(Ah.validate(l.creation.arrowStart.x,l.creation.arrowStart.y,M.x,M.y,l.testData.blocks)){const W=Ah.snapToNearestBlock(l.creation.arrowStart.x,l.creation.arrowStart.y,l.testData.blocks),L=Ah.snapToNearestBlock(M.x,M.y,l.testData.blocks),H=W?W.x:l.creation.arrowStart.x,K=W?W.y:l.creation.arrowStart.y,B=L?L.x:M.x,z=L?L.y:M.y,Q=Ah.generateId(),Y=Ah.create(H,K,B,z,W?W.blockId:null,L?L.blockId:null,Q);c({type:"ADD_ARROW",payload:Y}),d("Arrow created successfully!","success")}else d("Arrow must start near a block!","error");c({type:"SET_CREATION_STATE",payload:{isDrawingArrow:!1,arrowStart:null,previewArrow:null}})}},[l.creation,l.testData.blocks,d]),I=C.useCallback(async()=>{console.log("🟢 [MatchingTestCreator] handleSaveTest clicked");const q=V();if(Object.keys(q).length>0){console.warn("⚠️ [MatchingTestCreator] Validation errors:",q),d("Please fix validation errors before saving","error");return}try{console.log("🟢 [MatchingTestCreator] Preparing data to save...",{blocks:l.testData.blocks.length,words:l.testData.words.length,arrows:l.testData.arrows.length,imageUrl:l.ui.imageUrl?"present":"missing"}),c({type:"SET_LOADING",payload:!0});let ne=l.ui.imageUrl;if(l.ui.imageUrl&&l.ui.imageUrl.startsWith("data:")){const W=await f("/.netlify/functions/upload-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataUrl:l.ui.imageUrl,folder:"matching_tests"})}),L=await W.json();if(W.ok&&L.success&&L.url)ne=L.url;else throw new Error(L.message||"Upload failed")}const M=l.testData.blocks.map((W,L)=>{let H;if(w){const z=N(W.x,W.y),Q=N(W.x+W.width,W.y+W.height);H={x:z.x,y:z.y,width:Number((Q.x-z.x).toFixed(4)),height:Number((Q.y-z.y).toFixed(4))}}else H={x:Number(W.x.toFixed(4)),y:Number(W.y.toFixed(4)),width:Number(W.width.toFixed(4)),height:Number(W.height.toFixed(4))};const K=l.testData.words.find(z=>z.blockId===W.id),B=l.testData.arrows.find(z=>z.startBlock===W.id);return{question_id:L+1,word:K?.word||`Word ${L+1}`,block_coordinates:H,has_arrow:!!B,arrow:B&&w?(()=>{const z=N(B.startX,B.startY),Q=N(B.endX,B.endY),Y=z.x/w.originalWidth*100,te=z.y/w.originalHeight*100,ee=Q.x/w.originalWidth*100,ae=Q.y/w.originalHeight*100;return{start_x:Number(z.x.toFixed(4)),start_y:Number(z.y.toFixed(4)),end_x:Number(Q.x.toFixed(4)),end_y:Number(Q.y.toFixed(4)),rel_start_x:Number(Y.toFixed(4)),rel_start_y:Number(te.toFixed(4)),rel_end_x:Number(ee.toFixed(4)),rel_end_y:Number(ae.toFixed(4)),image_width:w.originalWidth,image_height:w.originalHeight,style:B.style||{color:"#dc3545",thickness:3}}})():null}});r&&(console.log("🟢 [MatchingTestCreator] Calling onTestSaved with processed data"),r({success:!0,message:"Test data prepared for assignment",blocks:l.testData.blocks,words:l.testData.words,arrows:l.testData.arrows,imageUrl:ne,processedQuestions:M}))}catch(ne){console.error("Save error:",ne),d(`Error saving test: ${ne.message}`,"error")}finally{c({type:"SET_LOADING",payload:!1})}},[l.testData,l.ui.imageUrl,w,N,f,r,d,e,p]),V=C.useCallback(()=>{const q={};return e.trim()||(q.testName="Test name is required"),l.testData.blocks.length===0&&(q.blocks="At least one block is required"),q},[e,l.testData.blocks.length]),X=()=>o.jsxs("div",{className:"flex flex-wrap gap-2 p-4 bg-gray-50 border-b",children:[o.jsx(nt,{onClick:()=>c({type:"SET_SELECTED_TOOL",payload:"create"}),variant:l.canvas.selectedTool==="create"?"primary":"secondary",size:"sm",children:"📦 Create Blocks"}),o.jsx(nt,{onClick:()=>c({type:"SET_SELECTED_TOOL",payload:"edit"}),variant:l.canvas.selectedTool==="edit"?"primary":"secondary",size:"sm",children:"🛠️ Edit Blocks"}),o.jsx(nt,{onClick:()=>c({type:"SET_SELECTED_TOOL",payload:"arrow"}),variant:l.canvas.selectedTool==="arrow"?"primary":"secondary",size:"sm",children:"🏹 Draw Arrows"}),o.jsx(nt,{onClick:A,variant:"secondary",size:"sm",children:"♻️ Reset"}),o.jsx(nt,{onClick:()=>y.current?.click(),variant:"secondary",size:"sm",children:"🖼️ Upload Image"})]}),Z=()=>o.jsx(Qd,{width:E.width,height:E.height,ref:k,onMouseDown:R,onMouseMove:T,onMouseUp:D,className:l.canvas.selectedTool==="arrow"||l.canvas.selectedTool==="create"?"cursor-crosshair":"cursor-default",children:o.jsxs(Yd,{children:[l.canvas.image&&w&&o.jsx(M6,{image:l.canvas.image,x:w.x,y:w.y,width:w.width,height:w.height}),l.testData.blocks.map(q=>o.jsxs($o,{ref:ne=>{ne&&(b.current[q.id]=ne)},draggable:l.canvas.selectedTool==="edit",x:q.x,y:q.y,onMouseEnter:ne=>{const M=ne.target.getStage()?.container();M&&(M.style.cursor=l.ui.selectedBlock?.id===q.id?"nwse-resize":"move")},onMouseLeave:ne=>{const M=ne.target.getStage()?.container();M&&(M.style.cursor=l.canvas.selectedTool==="arrow"?"crosshair":"default")},onDragStart:()=>{c({type:"SET_UI_STATE",payload:{selectedBlock:q}})},onDragEnd:ne=>{const{x:M,y:W}=ne.target.position();c({type:"UPDATE_BLOCK",payload:{id:q.id,updates:{x:M,y:W}}})},onClick:()=>{c({type:"SET_UI_STATE",payload:{selectedBlock:q}})},onTap:()=>{c({type:"SET_UI_STATE",payload:{selectedBlock:q}})},children:[o.jsx(ra,{ref:ne=>{ne&&(_.current[q.id]=ne)},width:q.width,height:q.height,fill:q.fill,stroke:q.stroke,strokeWidth:q.strokeWidth,cornerRadius:q.cornerRadius,shadowColor:q.shadowColor,shadowBlur:q.shadowBlur,shadowOffset:q.shadowOffset,shadowOpacity:q.shadowOpacity,draggable:l.canvas.selectedTool==="edit",onDragEnd:ne=>{const{x:M,y:W}=ne.target.getParent().position();c({type:"UPDATE_BLOCK",payload:{id:q.id,updates:{x:M,y:W}}})},onMouseEnter:ne=>{const M=ne.target.getStage()?.container();M&&(M.style.cursor=l.ui.selectedBlock?.id===q.id?"nwse-resize":"move")},onMouseLeave:ne=>{const M=ne.target.getStage()?.container();M&&(M.style.cursor=l.canvas.selectedTool==="arrow"?"crosshair":"default")},onTransformEnd:ne=>{const M=_.current[q.id];if(!M)return;const W=Math.max(10,M.width()*M.scaleX()),L=Math.max(10,M.height()*M.scaleY());M.scaleX(1),M.scaleY(1),c({type:"UPDATE_BLOCK",payload:{id:q.id,updates:{width:W,height:L}}})}}),o.jsx(kl,{x:2,y:2,text:`${l.testData.blocks.indexOf(q)+1}`,fontSize:Math.min(12,Math.max(8,q.width/4)),fontFamily:"Arial",fill:"#333",fontStyle:"bold",listening:!1})]},q.id)),o.jsx(O6,{ref:v,rotateEnabled:!1,flipEnabled:!1,boundBoxFunc:(q,ne)=>({...ne,width:Math.max(ne.width,10),height:Math.max(ne.height,10)})}),l.testData.arrows.map(q=>o.jsx(T_,{points:[q.startX,q.startY,q.endX,q.endY],stroke:q.stroke,fill:q.fill,strokeWidth:q.strokeWidth,pointerLength:q.pointerLength,pointerWidth:q.pointerWidth},q.id)),l.creation.previewBlock&&o.jsx(ra,{x:l.creation.previewBlock.x,y:l.creation.previewBlock.y,width:l.creation.previewBlock.width,height:l.creation.previewBlock.height,fill:l.creation.previewBlock.fill,stroke:l.creation.previewBlock.stroke,strokeWidth:l.creation.previewBlock.strokeWidth,dash:l.creation.previewBlock.dash,opacity:l.creation.previewBlock.opacity}),l.creation.previewArrow&&o.jsx(T_,{points:[l.creation.previewArrow.startX,l.creation.previewArrow.startY,l.creation.previewArrow.endX,l.creation.previewArrow.endY],stroke:l.creation.previewArrow.stroke,fill:l.creation.previewArrow.fill,strokeWidth:l.creation.previewArrow.strokeWidth,dash:l.creation.previewArrow.dash,opacity:l.creation.previewArrow.opacity})]})}),ie=C.useMemo(()=>l.testData.blocks.length===0?null:o.jsxs("div",{className:"word-panel bg-gray-50 border-t border-gray-200 p-4 w-full",style:{height:"min(400px, 40vh)",overflowY:"auto"},children:[o.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Words (Auto-created with blocks)"}),o.jsx("div",{className:"space-y-2",children:l.testData.words.map(q=>{const ne=l.testData.blocks.find(M=>M.id===q.blockId);return o.jsxs("div",{className:"p-2 bg-white rounded border",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsxs("span",{className:"text-xs text-gray-500",children:["Block ",l.testData.blocks.indexOf(ne)+1]}),o.jsx("button",{onClick:()=>c({type:"DELETE_BLOCK",payload:ne.id}),className:"text-red-500 hover:text-red-700 text-xs",children:"×"})]}),o.jsx("input",{type:"text",value:q.word,onChange:M=>{const W=vw.update(l.testData.words,q.blockId,M.target.value);c({type:"UPDATE_WORDS",payload:W})},className:"w-full text-sm px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter word text"})]},q.blockId)})})]}),[l.testData.words,l.testData.blocks]);return o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex flex-col h-screen bg-gray-100",children:[o.jsx("div",{className:"bg-white shadow-sm border-b p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("div",{children:o.jsx("div",{className:"mt-2 text-sm text-gray-600",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("span",{children:[o.jsx("strong",{children:"Test Name:"})," ",e||"Untitled Test"]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Questions:"})," ",l.testData.blocks.length," (auto-generated from blocks)"]})]})})}),o.jsx("div",{className:"flex gap-2",children:o.jsx(nt,{onClick:I,disabled:a||l.ui.isLoading,variant:"primary",children:a||l.ui.isLoading?o.jsx(jr,{size:"sm"}):"Save Test"})})]})}),X(),o.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[o.jsx("div",{ref:g,className:"bg-white border overflow-auto",style:{minHeight:"400px",maxHeight:"calc(100vh - 200px)",height:"auto"},children:Z()}),ie]}),o.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:P,className:"hidden"})]})},v0=C.createContext(null);function IL(e,t){return{getTheme:function(){return t??null}}}function Rl(){const e=C.useContext(v0);return e==null&&(function(t,...r){const n=new URL("https://lexical.dev/docs/error"),s=new URLSearchParams;s.append("code",t);for(const a of r)s.append("v",a);throw n.search=s.toString(),Error(`Minified Lexical error #${t}; visit ${n.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(8),e}function Rt(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const Xo=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,ML=Xo&&"documentMode"in document?document.documentMode:null,Sl=Xo&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),Jd=Xo&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),H1=!(!Xo||!("InputEvent"in window)||ML)&&"getTargetRanges"in new window.InputEvent("input"),Zm=Xo&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),a0=Xo&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,OL=Xo&&/Android/.test(navigator.userAgent),L6=Xo&&/^(?=.*Chrome).*/i.test(navigator.userAgent),g4=Xo&&OL&&L6,G1=Xo&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!L6;function B6(...e){const t=[];for(const r of e)if(r&&typeof r=="string")for(const[n]of r.matchAll(/\S+/g))t.push(n);return t}const LL=1,BL=3,UL=9,$L=11,Zd=0,U6=1,i0=2,WL=0,zL=1,HL=2,V1=4,K1=8,ub=128,GL=1792|(112|(3|V1|K1)|ub),db=1,fb=2,hb=3,gb=4,mb=5,pb=6,My=Zm||a0||G1?" ":"​",Cc=`

`,VL=Jd?" ":My,ef={bold:1,capitalize:1024,code:16,highlight:ub,italic:2,lowercase:256,strikethrough:V1,subscript:32,superscript:64,underline:K1,uppercase:512},KL={directionless:1,unmergeable:2},m4={center:fb,end:pb,justify:gb,left:db,right:hb,start:mb},qL={[fb]:"center",[pb]:"end",[gb]:"justify",[db]:"left",[hb]:"right",[mb]:"start"},XL={normal:0,segmented:2,token:1},YL={[WL]:"normal",[HL]:"segmented",[zL]:"token"},p4="$config";function $6(e,t,r,n,s,a){let i=e.getFirstChild();for(;i!==null;){const l=i.__key;i.__parent===t&&(vt(i)&&$6(i,l,r,n,s,a),r.has(l)||a.delete(l),s.push(l)),i=i.getNextSibling()}}const QL=100;let N_=!1,xb=0;function JL(e){xb=e.timeStamp}function ww(e,t,r){const n=e.nodeName==="BR",s=t.__lexicalLineBreak;return s&&(e===s||n&&e.previousSibling===s)||n&&Vy(e,r)!==void 0}function ZL(e,t,r){const n=qo(xo(r));let s=null,a=null;n!==null&&n.anchorNode===e&&(s=n.anchorOffset,a=n.focusOffset);const i=e.nodeValue;i!==null&&Ob(t,i,s,a,!1)}function eB(e,t,r){if(Nt(e)){const n=e.anchor.getNode();if(n.is(r)&&e.format!==n.getFormat())return!1}return Nc(t)&&r.isAttached()}function tB(e,t,r,n){for(let s=e;s&&!tU(s);s=Ip(s)){const a=Vy(s,t);if(a!==void 0){const i=Fs(a,r);if(i)return nn(i)||!Mn(s)?void 0:[s,i]}else if(s===n)return[n,OA(r)]}}function W6(e,t,r){N_=!0;const n=performance.now()-xb>QL;try{Mi(e,(()=>{const s=Kt()||(function(g){return g.getEditorState().read((()=>{const y=Kt();return y!==null?y.clone():null}))})(e),a=new Map,i=e.getRootElement(),l=e._editorState,c=e._blockCursorElement;let d=!1,f="";for(let g=0;g<t.length;g++){const y=t[g],v=y.type,_=y.target,b=tB(_,e,l,i);if(!b)continue;const[E,k]=b;if(v==="characterData")n&&qt(k)&&Nc(_)&&eB(s,_,k)&&ZL(_,k,e);else if(v==="childList"){d=!0;const w=y.addedNodes;for(let P=0;P<w.length;P++){const R=w[P],T=IA(R),D=R.parentNode;if(D!=null&&R!==c&&T===null&&!ww(R,D,e)){if(Jd){const I=(Mn(R)?R.innerText:null)||R.nodeValue;I&&(f+=I)}D.removeChild(R)}}const N=y.removedNodes,A=N.length;if(A>0){let P=0;for(let R=0;R<A;R++){const T=N[R];(ww(T,_,e)||c===T)&&(_.appendChild(T),P++)}A!==P&&a.set(E,k)}}}if(a.size>0)for(const[g,y]of a)y.reconcileObservedMutation(g,e);const p=r.takeRecords();if(p.length>0){for(let g=0;g<p.length;g++){const y=p[g],v=y.addedNodes,_=y.target;for(let b=0;b<v.length;b++){const E=v[b],k=E.parentNode;k==null||E.nodeName!=="BR"||ww(E,_,e)||k.removeChild(E)}}r.takeRecords()}s!==null&&(d&&Sa(s),Jd&&$A(e)&&s.insertRawText(f))}))}finally{N_=!1}}function z6(e){const t=e._observer;t!==null&&W6(e,t.takeRecords(),t)}function H6(e){(function(t){xb===0&&xo(t).addEventListener("textInput",JL,!0)})(e),e._observer=new MutationObserver(((t,r)=>{W6(e,t,r)}))}function rB(e){const t=new Map,r=new Set;for(let n=typeof e=="function"?e:e.replace;n.prototype&&n.prototype.getType!==void 0;n=Object.getPrototypeOf(n)){const{ownNodeConfig:s}=Wb(n);if(s&&s.stateConfigs)for(const a of s.stateConfigs){let i;"stateConfig"in a?(i=a.stateConfig,a.flat&&r.add(i.key)):i=a,t.set(i.key,i)}}return{flatKeys:r,sharedConfigMap:t}}let nB=class G6{constructor(t,r,n=void 0,s=new Map,a=void 0){this.node=t,this.sharedNodeState=r,this.unknownState=n,this.knownState=s;const{sharedConfigMap:i}=this.sharedNodeState,l=a!==void 0?a:(function(c,d,f){let p=f.size;if(d)for(const g in d){const y=c.get(g);y&&f.has(y)||p++}return p})(i,n,s);this.size=l}getValue(t){const r=this.knownState.get(t);if(r!==void 0)return r;this.sharedNodeState.sharedConfigMap.set(t.key,t);let n=t.defaultValue;if(this.unknownState&&t.key in this.unknownState){const s=this.unknownState[t.key];s!==void 0&&(n=t.parse(s)),this.updateFromKnown(t,n)}return n}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const t={...this.unknownState},r={};for(const[n,s]of this.knownState)n.isEqual(s,n.defaultValue)?delete t[n.key]:t[n.key]=n.unparse(s);for(const n of this.sharedNodeState.flatKeys)n in t&&(r[n]=t[n],delete t[n]);return x4(t)&&(r.$=t),r}getWritable(t){if(this.node===t)return this;const{sharedNodeState:r,unknownState:n}=this,s=new Map(this.knownState);return new G6(t,r,(function(a,i,l){let c;if(l)for(const[d,f]of Object.entries(l)){const p=a.get(d);p?i.has(p)||i.set(p,p.parse(f)):(c=c||{},c[d]=f)}return c})(r.sharedConfigMap,s,n),s,this.size)}updateFromKnown(t,r){const n=t.key;this.sharedNodeState.sharedConfigMap.set(n,t);const{knownState:s,unknownState:a}=this;s.has(t)||a&&n in a||(a&&(delete a[n],this.unknownState=x4(a)),this.size++),s.set(t,r)}updateFromUnknown(t,r){const n=this.sharedNodeState.sharedConfigMap.get(t);n?this.updateFromKnown(n,n.parse(r)):(this.unknownState=this.unknownState||{},t in this.unknownState||this.size++,this.unknownState[t]=r)}updateFromJSON(t){const{knownState:r}=this;for(const n of r.keys())r.set(n,n.defaultValue);if(this.size=r.size,this.unknownState=void 0,t)for(const[n,s]of Object.entries(t))this.updateFromUnknown(n,s)}};function sB(e){const t=e.getWritable(),r=t.__state?t.__state.getWritable(t):new nB(t,V6(t));return t.__state=r,r}function V6(e){return e.__state?e.__state.sharedNodeState:PA(Mp(),e.getType()).sharedNodeState}function x4(e){if(e)for(const t in e)return e}function y4(e,t,r){for(const[n,s]of t.knownState){if(e.has(n.key))continue;e.add(n.key);const a=r?r.getValue(n):n.defaultValue;if(a!==s&&!n.isEqual(a,s))return!0}return!1}function v4(e,t,r){const{unknownState:n}=t,s=r?r.unknownState:void 0;if(n){for(const[a,i]of Object.entries(n))if(!e.has(a)&&(e.add(a),i!==(s?s[a]:void 0)))return!0}return!1}function w4(e,t){const r=e.__state;return r&&r.node===e?r.getWritable(t):r}function _4(e,t){const r=e.__mode,n=e.__format,s=e.__style,a=t.__mode,i=t.__format,l=t.__style,c=e.__state,d=t.__state;return(r===null||r===a)&&(n===null||n===i)&&(s===null||s===l)&&(e.__state===null||c===d||(function(f,p){if(f===p)return!0;if(f&&p&&f.size!==p.size)return!1;const g=new Set;return!(f&&y4(g,f,p)||p&&y4(g,p,f)||f&&v4(g,f,p)||p&&v4(g,p,f))})(c,d))}function b4(e,t){const r=e.mergeWithSibling(t),n=Xn()._normalizedNodes;return n.add(e.__key),n.add(t.__key),r}function S4(e){let t,r,n=e;if(n.__text!==""||!n.isSimpleText()||n.isUnmergeable()){for(;(t=n.getPreviousSibling())!==null&&qt(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(_4(t,n)){n=b4(t,n);break}break}t.remove()}for(;(r=n.getNextSibling())!==null&&qt(r)&&r.isSimpleText()&&!r.isUnmergeable();){if(r.__text!==""){if(_4(n,r)){n=b4(n,r);break}break}r.remove()}}else n.remove()}function q1(e){return k4(e.anchor),k4(e.focus),e}function k4(e){for(;e.type==="element";){const t=e.getNode(),r=e.offset;let n,s;if(r===t.getChildrenSize()?(n=t.getChildAtIndex(r-1),s=!0):(n=t.getChildAtIndex(r),s=!1),qt(n)){e.set(n.__key,s?n.getTextContentSize():0,"text",!0);break}if(!vt(n))break;e.set(n.__key,s?n.getChildrenSize():0,"element",!0)}}let tf,Ba,ep,Oy,A_,j_,rf,Ho,F_,tp,Bs="",_l=null,bl="",mc="",jh=!1,X1=!1;function Y1(e,t){const r=rf.get(e);if(t!==null){const n=I_(e);n.parentNode===t&&t.removeChild(n)}if(Ho.has(e)||Ba._keyToDOMMap.delete(e),vt(r)){const n=J1(r,rf);P_(n,0,n.length-1,null)}r!==void 0&&Lb(tp,ep,Oy,r,"destroyed")}function P_(e,t,r,n){let s=t;for(;s<=r;++s){const a=e[s];a!==void 0&&Y1(a,n)}}function Fd(e,t){e.setProperty("text-align",t)}const aB="40px";function K6(e,t){const r=tf.theme.indent;if(typeof r=="string"){const s=e.classList.contains(r);t>0&&!s?e.classList.add(r):t<1&&s&&e.classList.remove(r)}const n=getComputedStyle(e).getPropertyValue("--lexical-indent-base-value")||aB;e.style.setProperty("padding-inline-start",t===0?"":`calc(${t} * ${n})`)}function q6(e,t){const r=e.style;t===0?Fd(r,""):t===db?Fd(r,"left"):t===fb?Fd(r,"center"):t===hb?Fd(r,"right"):t===gb?Fd(r,"justify"):t===mb?Fd(r,"start"):t===pb&&Fd(r,"end")}function R_(e,t){const r=(function(n){const s=n.__dir;if(s!==null)return s;if(Ws(n))return null;const a=n.getParentOrThrow();return Ws(a)&&a.__dir===null?"auto":null})(t);r!==null?e.dir=r:e.removeAttribute("dir")}function Q1(e,t){const r=Ho.get(e);r===void 0&&Rt(60);const n=r.createDOM(tf,Ba);if((function(s,a,i){const l=i._keyToDOMMap;(function(c,d,f){const p=`__lexicalKey_${d._key}`;c[p]=f})(a,i,s),l.set(s,a)})(e,n,Ba),qt(r)?n.setAttribute("data-lexical-text","true"):nn(r)&&n.setAttribute("data-lexical-decorator","true"),vt(r)){const s=r.__indent,a=r.__size;if(R_(n,r),s!==0&&K6(n,s),a!==0){const l=a-1;D_(J1(r,Ho),r,0,l,r.getDOMSlot(n))}const i=r.__format;i!==0&&q6(n,i),r.isInline()||X6(null,r,n),Ky(r)&&(Bs+=Cc,mc+=Cc)}else{const s=r.getTextContent();if(nn(r)){const a=r.decorate(Ba,tf);a!==null&&Y6(e,a),n.contentEditable="false"}Bs+=s,mc+=s}return t!==null&&t.insertChild(n),Lb(tp,ep,Oy,r,"created"),n}function D_(e,t,r,n,s){const a=Bs;Bs="";let i=r;for(;i<=n;++i){Q1(e[i],s);const l=Ho.get(e[i]);l!==null&&qt(l)&&(_l===null&&(_l=l.getFormat()),bl===""&&(bl=l.getStyle()))}Ky(t)&&(Bs+=Cc),s.element.__lexicalTextContent=Bs,Bs=a+Bs}function C4(e,t){if(e){const r=e.__last;if(r){const n=t.get(r);if(n)return vc(n)?"line-break":nn(n)&&n.isInline()?"decorator":null}return"empty"}return null}function X6(e,t,r){const n=C4(e,rf),s=C4(t,Ho);n!==s&&t.getDOMSlot(r).setManagedLineBreak(s)}function iB(e,t,r){var n;_l=null,bl="",(function(s,a,i){const l=Bs,c=s.__size,d=a.__size;Bs="";const f=i.element;if(c===1&&d===1){const p=s.__first,g=a.__first;if(p===g)_m(p,f);else{const v=I_(p),_=Q1(g,null);try{f.replaceChild(_,v)}catch(b){if(typeof b=="object"&&b!=null){const E=`${b.toString()} Parent: ${f.tagName}, new child: {tag: ${_.tagName} key: ${g}}, old child: {tag: ${v.tagName}, key: ${p}}.`;throw new Error(E)}throw b}Y1(p,null)}const y=Ho.get(g);qt(y)&&(_l===null&&(_l=y.getFormat()),bl===""&&(bl=y.getStyle()))}else{const p=J1(s,rf),g=J1(a,Ho);if(p.length!==c&&Rt(227),g.length!==d&&Rt(228),c===0)d!==0&&D_(g,a,0,d-1,i);else if(d===0){if(c!==0){const y=i.after==null&&i.before==null&&i.element.__lexicalLineBreak==null;P_(p,0,c-1,y?null:f),y&&(f.textContent="")}}else(function(y,v,_,b,E,k){const w=b-1,N=E-1;let A,P,R=k.getFirstChild(),T=0,D=0;for(;T<=w&&D<=N;){const X=v[T],Z=_[D];if(X===Z)R=_w(_m(Z,k.element)),T++,D++;else{A===void 0&&(A=new Set(v)),P===void 0&&(P=new Set(_));const q=P.has(X),ne=A.has(Z);if(q)if(ne){const M=nf(Ba,Z);M===R?R=_w(_m(Z,k.element)):(k.withBefore(R).insertChild(M),_m(Z,k.element)),T++,D++}else Q1(Z,k.withBefore(R)),D++;else R=_w(I_(X)),Y1(X,k.element),T++}const ie=Ho.get(Z);ie!==null&&qt(ie)&&(_l===null&&(_l=ie.getFormat()),bl===""&&(bl=ie.getStyle()))}const I=T>w,V=D>N;if(I&&!V){const X=_[N+1],Z=X===void 0?null:Ba.getElementByKey(X);D_(_,y,D,N,k.withBefore(Z))}else V&&!I&&P_(v,T,w,k.element)})(a,p,g,c,d,i)}Ky(a)&&(Bs+=Cc),f.__lexicalTextContent=Bs,Bs=l+Bs})(e,t,t.getDOMSlot(r)),n=t,_l==null||_l===n.__textFormat||X1||n.setTextFormat(_l),(function(s){bl===""||bl===s.__textStyle||X1||s.setTextStyle(bl)})(t)}function J1(e,t){const r=[];let n=e.__first;for(;n!==null;){const s=t.get(n);s===void 0&&Rt(101),r.push(n),n=s.__next}return r}function _m(e,t){const r=rf.get(e);let n=Ho.get(e);r!==void 0&&n!==void 0||Rt(61);const s=jh||j_.has(e)||A_.has(e),a=nf(Ba,e);if(r===n&&!s){if(vt(r)){const i=a.__lexicalTextContent;i!==void 0&&(Bs+=i,mc+=i)}else{const i=r.getTextContent();mc+=i,Bs+=i}return a}if(r!==n&&s&&Lb(tp,ep,Oy,n,"updated"),n.updateDOM(r,a,tf)){const i=Q1(e,null);return t===null&&Rt(62),t.replaceChild(i,a),Y1(e,null),i}if(vt(r)&&vt(n)){const i=n.__indent;(jh||i!==r.__indent)&&K6(a,i);const l=n.__format;if((jh||l!==r.__format)&&q6(a,l),s&&(iB(r,n,a),Ws(n)||n.isInline()||X6(r,n,a)),Ky(n)&&(Bs+=Cc,mc+=Cc),(jh||n.__dir!==r.__dir)&&(R_(a,n),Ws(n)&&!jh))for(const c of n.getChildren())vt(c)&&R_(nf(Ba,c.getKey()),c)}else{const i=n.getTextContent();if(nn(n)){const l=n.decorate(Ba,tf);l!==null&&Y6(e,l)}Bs+=i,mc+=i}if(!X1&&Ws(n)&&n.__cachedText!==mc){const i=n.getWritable();i.__cachedText=mc,n=i}return a}function Y6(e,t){let r=Ba._pendingDecorators;const n=Ba._decorators;if(r===null){if(n[e]===t)return;r=MA(Ba)}r[e]=t}function _w(e){let t=e.nextSibling;return t!==null&&t===Ba._blockCursorElement&&(t=t.nextSibling),t}function oB(e,t,r,n,s,a){Bs="",mc="",jh=n===i0,Ba=r,tf=r._config,ep=r._nodes,Oy=Ba._listeners.mutation,A_=s,j_=a,rf=e._nodeMap,Ho=t._nodeMap,X1=t._readOnly,F_=new Map(r._keyToDOMMap);const i=new Map;return tp=i,_m("root",null),Ba=void 0,ep=void 0,A_=void 0,j_=void 0,rf=void 0,Ho=void 0,tf=void 0,F_=void 0,tp=void 0,i}function I_(e){const t=F_.get(e);return t===void 0&&Rt(75,e),t}function _r(e){return{type:e}}const Q6=_r("SELECTION_CHANGE_COMMAND"),lB=_r("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),yb=_r("CLICK_COMMAND"),zd=_r("DELETE_CHARACTER_COMMAND"),Vh=_r("INSERT_LINE_BREAK_COMMAND"),rp=_r("INSERT_PARAGRAPH_COMMAND"),Kh=_r("CONTROLLED_TEXT_INSERTION_COMMAND"),vb=_r("PASTE_COMMAND"),M_=_r("REMOVE_TEXT_COMMAND"),np=_r("DELETE_WORD_COMMAND"),sp=_r("DELETE_LINE_COMMAND"),La=_r("FORMAT_TEXT_COMMAND"),wb=_r("UNDO_COMMAND"),_b=_r("REDO_COMMAND"),cB=_r("KEYDOWN_COMMAND"),J6=_r("KEY_ARROW_RIGHT_COMMAND"),uB=_r("MOVE_TO_END"),Z6=_r("KEY_ARROW_LEFT_COMMAND"),dB=_r("MOVE_TO_START"),eA=_r("KEY_ARROW_UP_COMMAND"),tA=_r("KEY_ARROW_DOWN_COMMAND"),Z1=_r("KEY_ENTER_COMMAND"),rA=_r("KEY_SPACE_COMMAND"),nA=_r("KEY_BACKSPACE_COMMAND"),sA=_r("KEY_ESCAPE_COMMAND"),aA=_r("KEY_DELETE_COMMAND"),iA=_r("KEY_TAB_COMMAND"),fB=_r("INSERT_TAB_COMMAND"),hB=_r("INDENT_CONTENT_COMMAND"),T4=_r("OUTDENT_CONTENT_COMMAND"),oA=_r("DROP_COMMAND"),lA=_r("FORMAT_ELEMENT_COMMAND"),cA=_r("DRAGSTART_COMMAND"),uA=_r("DRAGOVER_COMMAND"),gB=_r("DRAGEND_COMMAND"),Ly=_r("COPY_COMMAND"),bb=_r("CUT_COMMAND"),O_=_r("SELECT_ALL_COMMAND"),mB=_r("CLEAR_EDITOR_COMMAND"),pB=_r("CLEAR_HISTORY_COMMAND"),a1=_r("CAN_REDO_COMMAND"),i1=_r("CAN_UNDO_COMMAND"),xB=_r("FOCUS_COMMAND"),yB=_r("BLUR_COMMAND"),vB=_r("KEY_MODIFIER_COMMAND"),dc=Object.freeze({}),L_=30,B_=[["keydown",function(e,t){if(Fm=e.timeStamp,dA=e.key,!t.isComposing()&&!nr(t,cB,e)&&e.key!=null){if(bw&&eE(e))return Mi(t,(()=>{o1(t,Sw)})),bw=!1,void(Sw="");if((function(r){return fn(r,"ArrowRight",{shiftKey:"any"})})(e))nr(t,J6,e);else if((function(r){return fn(r,"ArrowRight",hc)})(e))nr(t,uB,e);else if((function(r){return fn(r,"ArrowLeft",{shiftKey:"any"})})(e))nr(t,Z6,e);else if((function(r){return fn(r,"ArrowLeft",hc)})(e))nr(t,dB,e);else if((function(r){return fn(r,"ArrowUp",{altKey:"any",shiftKey:"any"})})(e))nr(t,eA,e);else if((function(r){return fn(r,"ArrowDown",{altKey:"any",shiftKey:"any"})})(e))nr(t,tA,e);else if((function(r){return fn(r,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})})(e))Pm=!0,nr(t,Z1,e);else if((function(r){return r.key===" "})(e))nr(t,rA,e);else if((function(r){return Sl&&fn(r,"o",{ctrlKey:!0})})(e))e.preventDefault(),Pm=!0,nr(t,Vh,!0);else if((function(r){return fn(r,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})})(e))Pm=!1,nr(t,Z1,e);else if((function(r){return fn(r,"Backspace",{shiftKey:"any"})||Sl&&fn(r,"h",{ctrlKey:!0})})(e))eE(e)?nr(t,nA,e):(e.preventDefault(),nr(t,zd,!0));else if((function(r){return r.key==="Escape"})(e))nr(t,sA,e);else if((function(r){return fn(r,"Delete",{})||Sl&&fn(r,"d",{ctrlKey:!0})})(e))(function(r){return r.key==="Delete"})(e)?nr(t,aA,e):(e.preventDefault(),nr(t,zd,!1));else if((function(r){return fn(r,"Backspace",Z4)})(e))e.preventDefault(),nr(t,np,!0);else if((function(r){return fn(r,"Delete",Z4)})(e))e.preventDefault(),nr(t,np,!1);else if((function(r){return Sl&&fn(r,"Backspace",{metaKey:!0})})(e))e.preventDefault(),nr(t,sp,!0);else if((function(r){return Sl&&(fn(r,"Delete",{metaKey:!0})||fn(r,"k",{ctrlKey:!0}))})(e))e.preventDefault(),nr(t,sp,!1);else if((function(r){return fn(r,"b",hc)})(e))e.preventDefault(),nr(t,La,"bold");else if((function(r){return fn(r,"u",hc)})(e))e.preventDefault(),nr(t,La,"underline");else if((function(r){return fn(r,"i",hc)})(e))e.preventDefault(),nr(t,La,"italic");else if((function(r){return fn(r,"Tab",{shiftKey:"any"})})(e))nr(t,iA,e);else if((function(r){return fn(r,"z",hc)})(e))e.preventDefault(),nr(t,wb,void 0);else if((function(r){return Sl?fn(r,"z",{metaKey:!0,shiftKey:!0}):fn(r,"y",{ctrlKey:!0})||fn(r,"z",{ctrlKey:!0,shiftKey:!0})})(e))e.preventDefault(),nr(t,_b,void 0);else{const r=t._editorState._selection;r===null||Nt(r)?tE(e)&&(e.preventDefault(),nr(t,O_,e)):(function(n){return fn(n,"c",hc)})(e)?(e.preventDefault(),nr(t,Ly,e)):(function(n){return fn(n,"x",hc)})(e)?(e.preventDefault(),nr(t,bb,e)):tE(e)&&(e.preventDefault(),nr(t,O_,e))}(function(r){return r.ctrlKey||r.shiftKey||r.altKey||r.metaKey})(e)&&nr(t,vB,e)}}],["pointerdown",function(e,t){const r=e.target,n=e.pointerType;S0(r)&&n!=="touch"&&n!=="pen"&&e.button===0&&Mi(t,(()=>{Y4(r)||($_=!0)}))}],["compositionstart",function(e,t){Mi(t,(()=>{const r=Kt();if(Nt(r)&&!t.isComposing()){const n=r.anchor,s=r.anchor.getNode();wa(n.key),(e.timeStamp<Fm+L_||n.type==="element"||!r.isCollapsed()||s.getFormat()!==r.format||qt(s)&&s.getStyle()!==r.style)&&nr(t,Kh,VL)}}))}],["compositionend",function(e,t){Jd?gm=!0:a0||!Zm&&!G1?Mi(t,(()=>{o1(t,e.data)})):(bw=!0,Sw=e.data)}],["input",function(e,t){e.stopPropagation(),Mi(t,(()=>{if(Mn(e.target)&&Y4(e.target))return;const r=Kt(),n=e.data,s=pA(e);if(n!=null&&Nt(r)&&gA(r,s,n,e.timeStamp,!1)){gm&&(o1(t,n),gm=!1);const a=r.anchor.getNode(),i=qo(xo(t));if(i===null)return;const l=r.isBackward(),c=l?r.anchor.offset:r.focus.offset,d=l?r.focus.offset:r.anchor.offset;H1&&!r.isCollapsed()&&qt(a)&&i.anchorNode!==null&&a.getTextContent().slice(0,c)+n+a.getTextContent().slice(c+d)===UA(i.anchorNode)||nr(t,Kh,n);const f=n.length;Jd&&f>1&&e.inputType==="insertCompositionText"&&!t.isComposing()&&(r.anchor.offset-=f),Zm||a0||G1||!t.isComposing()||(Fm=0,wa(null))}else Mb(!1,t,n!==null?n:void 0),gm&&(o1(t,n||void 0),gm=!1);(function(){va();const a=Xn();z6(a)})()}),{event:e}),Fh=null}],["click",function(e,t){Mi(t,(()=>{const r=Kt(),n=qo(xo(t)),s=b0();if(n){if(Nt(r)){const a=r.anchor,i=a.getNode();if(a.type==="element"&&a.offset===0&&r.isCollapsed()&&!Ws(i)&&zn().getChildrenSize()===1&&i.getTopLevelElementOrThrow().isEmpty()&&s!==null&&r.is(s))n.removeAllRanges(),r.dirty=!0;else if(e.detail===3&&!r.isCollapsed()&&i!==r.focus.getNode()){const l=(function(c,d){let f=c;for(;f!==zn()&&f!=null;){if(d(f))return f;f=f.getParent()}return null})(i,(c=>vt(c)&&!c.isInline()));vt(l)&&l.select(0)}}else if(e.pointerType==="touch"||e.pointerType==="pen"){const a=n.anchorNode;(Mn(a)||Nc(a))&&Sa(Cb(s,n,t,e))}}nr(t,yb,e)}))}],["cut",dc],["copy",dc],["dragstart",dc],["dragover",dc],["dragend",dc],["paste",dc],["focus",dc],["blur",dc],["drop",dc]];H1&&B_.push(["beforeinput",(e,t)=>(function(r,n){const s=r.inputType,a=pA(r);s==="deleteCompositionText"||Jd&&$A(n)||s!=="insertCompositionText"&&Mi(n,(()=>{const i=Kt();if(s==="deleteContentBackward"){if(i===null){const y=b0();if(!Nt(y))return;Sa(y.clone())}if(Nt(i)){const y=i.anchor.key===i.focus.key;if(l=r.timeStamp,dA==="MediaLast"&&l<Fm+L_&&n.isComposing()&&y){if(wa(null),Fm=0,setTimeout((()=>{Mi(n,(()=>{wa(null)}))}),L_),Nt(i)){const v=i.anchor.getNode();v.markDirty(),qt(v)||Rt(142),mA(i,v)}}else{wa(null),r.preventDefault();const v=i.anchor.getNode(),_=v.getTextContent(),b=v.canInsertTextAfter(),E=i.anchor.offset===0&&i.focus.offset===_.length;let k=g4&&y&&!E&&b;if(k&&i.isCollapsed()&&(k=!nn(V_(i.anchor,!0))),!k){nr(n,zd,!0);const w=Kt();g4&&Nt(w)&&w.isCollapsed()&&(Dd=w,setTimeout((()=>Dd=null)))}}return}}var l;if(!Nt(i))return;const c=r.data;Fh!==null&&Mb(!1,n,Fh),i.dirty&&Fh===null||!i.isCollapsed()||Ws(i.anchor.getNode())||a===null||i.applyDOMRange(a),Fh=null;const d=i.anchor,f=i.focus,p=d.getNode(),g=f.getNode();if(s!=="insertText"&&s!=="insertTranspose")switch(r.preventDefault(),s){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":nr(n,Kh,r);break;case"insertFromComposition":wa(null),nr(n,Kh,r);break;case"insertLineBreak":wa(null),nr(n,Vh,!1);break;case"insertParagraph":wa(null),Pm&&!a0?(Pm=!1,nr(n,Vh,!1)):nr(n,rp,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":nr(n,vb,r);break;case"deleteByComposition":(function(y,v){return y!==v||vt(y)||vt(v)||!Hd(y)||!Hd(v)})(p,g)&&nr(n,M_,r);break;case"deleteByDrag":case"deleteByCut":nr(n,M_,r);break;case"deleteContent":nr(n,zd,!1);break;case"deleteWordBackward":nr(n,np,!0);break;case"deleteWordForward":nr(n,np,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":nr(n,sp,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":nr(n,sp,!1);break;case"formatStrikeThrough":nr(n,La,"strikethrough");break;case"formatBold":nr(n,La,"bold");break;case"formatItalic":nr(n,La,"italic");break;case"formatUnderline":nr(n,La,"underline");break;case"historyUndo":nr(n,wb,void 0);break;case"historyRedo":nr(n,_b,void 0)}else{if(c===`
`)r.preventDefault(),nr(n,Vh,!1);else if(c===Cc)r.preventDefault(),nr(n,rp,void 0);else if(c==null&&r.dataTransfer){const y=r.dataTransfer.getData("text/plain");r.preventDefault(),i.insertRawText(y)}else c!=null&&gA(i,a,c,r.timeStamp,!0)?(r.preventDefault(),nr(n,Kh,c)):Fh=c;fA=r.timeStamp}}))})(e,t)]);let Fm=0,dA=null,fA=0,Fh=null;const ey=new WeakMap;let U_=!1,$_=!1,Pm=!1,gm=!1,bw=!1,Sw="",Dd=null,hA=[0,"",0,"root",0];function gA(e,t,r,n,s){const a=e.anchor,i=e.focus,l=a.getNode(),c=Xn(),d=qo(xo(c)),f=d!==null?d.anchorNode:null,p=a.key,g=c.getElementByKey(p),y=r.length;return p!==i.key||!qt(l)||(!s&&(!H1||fA<n+50)||l.isDirty()&&y<2||LA(r))&&a.offset!==i.offset&&!l.isComposing()||gc(l)||l.isDirty()&&y>1||(s||!H1)&&g!==null&&!l.isComposing()&&f!==o0(g)||d!==null&&t!==null&&(!t.collapsed||t.startContainer!==d.anchorNode||t.startOffset!==d.anchorOffset)||l.getFormat()!==e.format||l.getStyle()!==e.style||(function(v,_){if(_.isSegmented())return!0;if(!v.isCollapsed())return!1;const b=v.anchor.offset,E=_.getParentOrThrow(),k=Hd(_);return b===0?!_.canInsertTextBefore()||!E.canInsertTextBefore()&&!_.isComposing()||k||(function(w){const N=w.getPreviousSibling();return(qt(N)||vt(N)&&N.isInline())&&!N.canInsertTextAfter()})(_):b===_.getTextContentSize()&&(!_.canInsertTextAfter()||!E.canInsertTextAfter()&&!_.isComposing()||k)})(e,l)}function E4(e,t){return Nc(e)&&e.nodeValue!==null&&t!==0&&t!==e.nodeValue.length}function N4(e,t,r){const{anchorNode:n,anchorOffset:s,focusNode:a,focusOffset:i}=e;U_&&(U_=!1,E4(n,s)&&E4(a,i)&&!Dd)||Mi(t,(()=>{if(!r)return void Sa(null);if(!Dp(t,n,a))return;let l=Kt();if(Dd&&Nt(l)&&l.isCollapsed()){const c=l.anchor,d=Dd.anchor;(c.key===d.key&&c.offset===d.offset+1||c.offset===1&&d.getNode().is(c.getNode().getPreviousSibling()))&&(l=Dd.clone(),Sa(l))}if(Dd=null,Nt(l)){const c=l.anchor,d=c.getNode();if(l.isCollapsed()){e.type==="Range"&&e.anchorNode===e.focusNode&&(l.dirty=!0);const f=xo(t).event,p=f?f.timeStamp:performance.now(),[g,y,v,_,b]=hA,E=zn(),k=t.isComposing()===!1&&E.getTextContent()==="";if(p<b+200&&c.offset===v&&c.key===_)P1(l,g,y);else if(c.type==="text")qt(d)||Rt(141),mA(l,d);else if(c.type==="element"&&!k){vt(d)||Rt(259);const w=c.getNode();w.isEmpty()?(function(N,A){const P=A.getTextFormat(),R=A.getTextStyle();P1(N,P,R)})(l,w):P1(l,0,"")}}else{const f=c.key,p=l.focus.key,g=l.getNodes(),y=g.length,v=l.isBackward(),_=v?i:s,b=v?s:i,E=v?p:f,k=v?f:p;let w=GL,N=!1;for(let A=0;A<y;A++){const P=g[A],R=P.getTextContentSize();if(qt(P)&&R!==0&&!(A===0&&P.__key===E&&_===R||A===y-1&&P.__key===k&&b===0)&&(N=!0,w&=P.getFormat(),w===0))break}l.format=N?w:0}}nr(t,Q6,void 0)}))}function P1(e,t,r){e.format===t&&e.style===r||(e.format=t,e.style=r,e.dirty=!0)}function mA(e,t){P1(e,t.getFormat(),t.getStyle())}function pA(e){if(!e.getTargetRanges)return null;const t=e.getTargetRanges();return t.length===0?null:t[0]}function o1(e,t){const r=e._compositionKey;if(wa(null),r!==null&&t!=null){if(t===""){const n=Fs(r),s=o0(e.getElementByKey(r));return void(s!==null&&s.nodeValue!==null&&qt(n)&&Ob(n,s.nodeValue,null,null,!0))}if(t[t.length-1]===`
`){const n=Kt();if(Nt(n)){const s=n.focus;return n.anchor.set(s.key,s.offset,s.type),void nr(e,Z1,null)}}}Mb(!0,e,t)}function xA(e){let t=e.__lexicalEventHandles;return t===void 0&&(t=[],e.__lexicalEventHandles=t),t}const qh=new Map;function yA(e){const t=JB(e.target);if(t===null)return;const r=RA(t.anchorNode);if(r===null)return;$_&&($_=!1,Mi(r,(()=>{const c=b0(),d=t.anchorNode;(Mn(d)||Nc(d))&&Sa(Cb(c,t,r,e))})));const n=Ib(r),s=n[n.length-1],a=s._key,i=qh.get(a),l=i||s;l!==r&&N4(t,l,!1),N4(t,r,!0),r!==s?qh.set(a,r):i&&qh.delete(a)}function A4(e){e._lexicalHandled=!0}function j4(e){return e._lexicalHandled===!0}function wB(e){const t=e.ownerDocument,r=ey.get(t);if(r===void 0)return;const n=r-1;n>=0||Rt(164),ey.set(t,n),n===0&&t.removeEventListener("selectionchange",yA);const s=Gy(e);Db(s)?((function(i){if(i._parentEditor!==null){const l=Ib(i),c=l[l.length-1]._key;qh.get(c)===i&&qh.delete(c)}else qh.delete(i._key)})(s),e.__lexicalEditor=null):s&&Rt(198);const a=xA(e);for(let i=0;i<a.length;i++)a[i]();e.__lexicalEventHandles=[]}function W_(e,t,r){va();const n=e.__key,s=e.getParent();if(s===null)return;const a=(function(l){const c=Kt();if(!Nt(c)||!vt(l))return c;const{anchor:d,focus:f}=c,p=d.getNode(),g=f.getNode();return K_(p,l)&&d.set(l.__key,0,"element"),K_(g,l)&&f.set(l.__key,0,"element"),c})(e);let i=!1;if(Nt(a)&&t){const l=a.anchor,c=a.focus;l.key===n&&(ry(l,e,s,e.getPreviousSibling(),e.getNextSibling()),i=!0),c.key===n&&(ry(c,e,s,e.getPreviousSibling(),e.getNextSibling()),i=!0)}else Pa(a)&&t&&e.isSelected()&&e.selectPrevious();if(Nt(a)&&t&&!i){const l=e.getIndexWithinParent();Gd(e),ty(a,s,l,-1)}else Gd(e);r||ii(s)||s.canBeEmpty()||!s.isEmpty()||W_(s,t),t&&a&&Ws(s)&&s.isEmpty()&&s.selectEnd()}class w0{static getType(){const{ownNodeType:t}=Wb(this);return t===void 0&&Rt(64,this.name),t}static clone(t){Rt(65,this.name)}$config(){return{}}config(t,r){const n=r.extends||Object.getPrototypeOf(this.constructor);return Object.assign(r,{extends:n,type:t}),{[t]:r}}afterCloneFrom(t){this.__key===t.__key?(this.__parent=t.__parent,this.__next=t.__next,this.__prev=t.__prev,this.__state=t.__state):t.__state&&(this.__state=t.__state.getWritable(this))}constructor(t){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),HB(this,t)}getType(){return this.__type}isInline(){Rt(137,this.constructor.name)}isAttached(){let t=this.__key;for(;t!==null;){if(t==="root")return!0;const r=Fs(t);if(r===null)break;t=r.__parent}return!1}isSelected(t){const r=t||Kt();if(r==null)return!1;const n=r.getNodes().some((s=>s.__key===this.__key));if(qt(this))return n;if(Nt(r)&&r.anchor.type==="element"&&r.focus.type==="element"){if(r.isCollapsed())return!1;const s=this.getParent();if(nn(this)&&this.isInline()&&s){const a=r.isBackward()?r.focus:r.anchor;if(s.is(a.getNode())&&a.offset===s.getChildrenSize()&&this.is(s.getLastChild()))return!1}}return n}getKey(){return this.__key}getIndexWithinParent(){const t=this.getParent();if(t===null)return-1;let r=t.getFirstChild(),n=0;for(;r!==null;){if(this.is(r))return n;n++,r=r.getNextSibling()}return-1}getParent(){const t=this.getLatest().__parent;return t===null?null:Fs(t)}getParentOrThrow(){const t=this.getParent();return t===null&&Rt(66,this.__key),t}getTopLevelElement(){let t=this;for(;t!==null;){const r=t.getParent();if(ii(r))return vt(t)||t===this&&nn(t)||Rt(194),t;t=r}return null}getTopLevelElementOrThrow(){const t=this.getTopLevelElement();return t===null&&Rt(67,this.__key),t}getParents(){const t=[];let r=this.getParent();for(;r!==null;)t.push(r),r=r.getParent();return t}getParentKeys(){const t=[];let r=this.getParent();for(;r!==null;)t.push(r.__key),r=r.getParent();return t}getPreviousSibling(){const t=this.getLatest().__prev;return t===null?null:Fs(t)}getPreviousSiblings(){const t=[],r=this.getParent();if(r===null)return t;let n=r.getFirstChild();for(;n!==null&&!n.is(this);)t.push(n),n=n.getNextSibling();return t}getNextSibling(){const t=this.getLatest().__next;return t===null?null:Fs(t)}getNextSiblings(){const t=[];let r=this.getNextSibling();for(;r!==null;)t.push(r),r=r.getNextSibling();return t}getCommonAncestor(t){const r=vt(this)?this:this.getParent(),n=vt(t)?t:t.getParent(),s=r&&n?D1(r,n):null;return s?s.commonAncestor:null}is(t){return t!=null&&this.__key===t.__key}isBefore(t){const r=D1(this,t);return r!==null&&(r.type==="descendant"||(r.type==="branch"?GA(r)===-1:(r.type!=="same"&&r.type!=="ancestor"&&Rt(279),!1)))}isParentOf(t){const r=D1(this,t);return r!==null&&r.type==="ancestor"}getNodesBetween(t){const r=this.isBefore(t),n=[],s=new Set;let a=this;for(;a!==null;){const i=a.__key;if(s.has(i)||(s.add(i),n.push(a)),a===t)break;const l=vt(a)?r?a.getFirstChild():a.getLastChild():null;if(l!==null){a=l;continue}const c=r?a.getNextSibling():a.getPreviousSibling();if(c!==null){a=c;continue}const d=a.getParentOrThrow();if(s.has(d.__key)||n.push(d),d===t)break;let f=null,p=d;do{if(p===null&&Rt(68),f=r?p.getNextSibling():p.getPreviousSibling(),p=p.getParent(),p===null)break;f!==null||s.has(p.__key)||n.push(p)}while(f===null);a=f}return r||n.reverse(),n}isDirty(){const t=Xn()._dirtyLeaves;return t!==null&&t.has(this.__key)}getLatest(){const t=Fs(this.__key);return t===null&&Rt(113),t}getWritable(){va();const t=Ku(),r=Xn(),n=t._nodeMap,s=this.__key,a=this.getLatest(),i=r._cloneNotNeeded,l=Kt();if(l!==null&&l.setCachedNodes(null),i.has(s))return ay(a),a;const c=Ub(a);return i.add(s),ay(c),n.set(s,c),c}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(t,r){Rt(70)}updateDOM(t,r,n){Rt(71)}exportDOM(t){return{element:this.createDOM(t._config,t)}}exportJSON(){const t=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...t}}static importJSON(t){Rt(18,this.name)}updateFromJSON(t){return(function(r,n){const s=r.getWritable(),a=n.$;let i=a;for(const l of V6(s).flatKeys)l in n&&(i!==void 0&&i!==a||(i={...a}),i[l]=n[l]);return(s.__state||i)&&sB(r).updateFromJSON(i),s})(this,t)}static transform(){return null}remove(t){W_(this,!0,t)}replace(t,r){va();let n=Kt();n!==null&&(n=n.clone()),Aw(this,t);const s=this.getLatest(),a=this.__key,i=t.__key,l=t.getWritable(),c=this.getParentOrThrow().getWritable(),d=c.__size;Gd(l);const f=s.getPreviousSibling(),p=s.getNextSibling(),g=s.__prev,y=s.__next,v=s.__parent;if(W_(s,!1,!0),f===null?c.__first=i:f.getWritable().__next=i,l.__prev=g,p===null?c.__last=i:p.getWritable().__prev=i,l.__next=y,l.__parent=v,c.__size=d,r&&(vt(this)&&vt(l)||Rt(139),this.getChildren().forEach((_=>{l.append(_)}))),Nt(n)){Sa(n);const _=n.anchor,b=n.focus;_.key===a&&D4(_,l),b.key===a&&D4(b,l)}return Cu()===a&&wa(i),l}insertAfter(t,r=!0){va(),Aw(this,t);const n=this.getWritable(),s=t.getWritable(),a=s.getParent(),i=Kt();let l=!1,c=!1;if(a!==null){const y=t.getIndexWithinParent();if(Gd(s),Nt(i)){const v=a.__key,_=i.anchor,b=i.focus;l=_.type==="element"&&_.key===v&&_.offset===y+1,c=b.type==="element"&&b.key===v&&b.offset===y+1}}const d=this.getNextSibling(),f=this.getParentOrThrow().getWritable(),p=s.__key,g=n.__next;if(d===null?f.__last=p:d.getWritable().__prev=p,f.__size++,n.__next=p,s.__next=g,s.__prev=n.__key,s.__parent=n.__parent,r&&Nt(i)){const y=this.getIndexWithinParent();ty(i,f,y+1);const v=f.__key;l&&i.anchor.set(v,y+2,"element"),c&&i.focus.set(v,y+2,"element")}return t}insertBefore(t,r=!0){va(),Aw(this,t);const n=this.getWritable(),s=t.getWritable(),a=s.__key;Gd(s);const i=this.getPreviousSibling(),l=this.getParentOrThrow().getWritable(),c=n.__prev,d=this.getIndexWithinParent();i===null?l.__first=a:i.getWritable().__next=a,l.__size++,n.__prev=a,s.__prev=c,s.__next=n.__key,s.__parent=n.__parent;const f=Kt();return r&&Nt(f)&&ty(f,this.getParentOrThrow(),d),t}isParentRequired(){return!1}createParentElementNode(){return In()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(t,r){va();const n=this.getPreviousSibling(),s=this.getParentOrThrow();if(n===null)return s.select(0,0);if(vt(n))return n.select();if(!qt(n)){const a=n.getIndexWithinParent()+1;return s.select(a,a)}return n.select(t,r)}selectNext(t,r){va();const n=this.getNextSibling(),s=this.getParentOrThrow();if(n===null)return s.select();if(vt(n))return n.select(0,0);if(!qt(n)){const a=n.getIndexWithinParent();return s.select(a,a)}return n.select(t,r)}markDirty(){this.getWritable()}reconcileObservedMutation(t,r){this.markDirty()}}class Ap extends w0{static getType(){return"linebreak"}static clone(t){return new Ap(t.__key)}constructor(t){super(t)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:t=>(function(r){const n=r.parentElement;if(n!==null&&iy(n)){const s=n.firstChild;if(s===r||s.nextSibling===r&&l1(s)){const a=n.lastChild;if(a===r||a.previousSibling===r&&l1(a))return!0}}return!1})(t)||(function(r){const n=r.parentElement;if(n!==null&&iy(n)){const s=n.firstChild;if(s===r||s.nextSibling===r&&l1(s))return!1;const a=n.lastChild;if(a===r||a.previousSibling===r&&l1(a))return!0}return!1})(t)?null:{conversion:_B,priority:0}}}static importJSON(t){return Fl().updateFromJSON(t)}}function _B(e){return{node:Fl()}}function Fl(){return li(new Ap)}function vc(e){return e instanceof Ap}function l1(e){return Nc(e)&&/^( |\t|\r?\n)+$/.test(e.textContent||"")}function kw(e,t){return 16&t?"code":t&ub?"mark":32&t?"sub":64&t?"sup":null}function Cw(e,t){return 1&t?"strong":2&t?"em":"span"}function vA(e,t,r,n,s){const a=n.classList;let i=Xh(s,"base");i!==void 0&&a.add(...i),i=Xh(s,"underlineStrikethrough");let l=!1;const c=t&K1&&t&V1;i!==void 0&&(r&K1&&r&V1?(l=!0,c||a.add(...i)):c&&a.remove(...i));for(const d in ef){const f=ef[d];if(i=Xh(s,d),i!==void 0)if(r&f){if(l&&(d==="underline"||d==="strikethrough")){t&f&&a.remove(...i);continue}t&f&&(!c||d!=="underline")&&d!=="strikethrough"||a.add(...i)}else t&f&&a.remove(...i)}}function wA(e,t,r){const n=t.firstChild,s=r.isComposing(),a=e+(s?My:"");if(n==null)t.textContent=a;else{const i=n.nodeValue;if(i!==a)if(s||Jd){const[l,c,d]=(function(f,p){const g=f.length,y=p.length;let v=0,_=0;for(;v<g&&v<y&&f[v]===p[v];)v++;for(;_+v<g&&_+v<y&&f[g-_-1]===p[y-_-1];)_++;return[v,g-v-_,p.slice(v,y-_)]})(i,a);c!==0&&n.deleteData(l,c),n.insertData(l,d)}else n.nodeValue=a}}function F4(e,t,r,n,s,a){wA(s,e,t);const i=a.theme.text;i!==void 0&&vA(0,0,n,e,i)}function c1(e,t){const r=document.createElement(t);return r.appendChild(e),r}class Vu extends w0{static getType(){return"text"}static clone(t){return new Vu(t.__text,t.__key)}afterCloneFrom(t){super.afterCloneFrom(t),this.__text=t.__text,this.__format=t.__format,this.__style=t.__style,this.__mode=t.__mode,this.__detail=t.__detail}constructor(t="",r){super(r),this.__text=t,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const t=this.getLatest();return YL[t.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===Cu()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(t){const r=ef[t];return!!(this.getFormat()&r)}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(t,r){return sy(this.getLatest().__format,t,r)}canHaveFormat(){return!0}isInline(){return!0}createDOM(t,r){const n=this.__format,s=kw(0,n),a=Cw(0,n),i=s===null?a:s,l=document.createElement(i);let c=l;this.hasFormat("code")&&l.setAttribute("spellcheck","false"),s!==null&&(c=document.createElement(a),l.appendChild(c)),F4(c,this,0,n,this.__text,t);const d=this.__style;return d!==""&&(l.style.cssText=d),l}updateDOM(t,r,n){const s=this.__text,a=t.__format,i=this.__format,l=kw(0,a),c=kw(0,i),d=Cw(0,a),f=Cw(0,i);if((l===null?d:l)!==(c===null?f:c))return!0;if(l===c&&d!==f){const _=r.firstChild;_==null&&Rt(48);const b=document.createElement(f);return F4(b,this,0,i,s,n),r.replaceChild(b,_),!1}let p=r;c!==null&&l!==null&&(p=r.firstChild,p==null&&Rt(49)),wA(s,p,this);const g=n.theme.text;g!==void 0&&a!==i&&vA(0,a,i,p,g);const y=t.__style,v=this.__style;return y!==v&&(r.style.cssText=v),!1}static importDOM(){return{"#text":()=>({conversion:CB,priority:0}),b:()=>({conversion:SB,priority:0}),code:()=>({conversion:fc,priority:0}),em:()=>({conversion:fc,priority:0}),i:()=>({conversion:fc,priority:0}),mark:()=>({conversion:fc,priority:0}),s:()=>({conversion:fc,priority:0}),span:()=>({conversion:bB,priority:0}),strong:()=>({conversion:fc,priority:0}),sub:()=>({conversion:fc,priority:0}),sup:()=>({conversion:fc,priority:0}),u:()=>({conversion:fc,priority:0})}}static importJSON(t){return rs().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setTextContent(t.text).setFormat(t.format).setDetail(t.detail).setMode(t.mode).setStyle(t.style)}exportDOM(t){let{element:r}=super.exportDOM(t);return Mn(r)||Rt(132),r.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?r.style.textTransform="lowercase":this.hasFormat("uppercase")?r.style.textTransform="uppercase":this.hasFormat("capitalize")&&(r.style.textTransform="capitalize"),this.hasFormat("bold")&&(r=c1(r,"b")),this.hasFormat("italic")&&(r=c1(r,"i")),this.hasFormat("strikethrough")&&(r=c1(r,"s")),this.hasFormat("underline")&&(r=c1(r,"u")),{element:r}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(t,r){}setFormat(t){const r=this.getWritable();return r.__format=typeof t=="string"?ef[t]:t,r}setDetail(t){const r=this.getWritable();return r.__detail=typeof t=="string"?KL[t]:t,r}setStyle(t){const r=this.getWritable();return r.__style=t,r}toggleFormat(t){const r=sy(this.getFormat(),t,null);return this.setFormat(r)}toggleDirectionless(){const t=this.getWritable();return t.__detail^=1,t}toggleUnmergeable(){const t=this.getWritable();return t.__detail^=2,t}setMode(t){const r=XL[t];if(this.__mode===r)return this;const n=this.getWritable();return n.__mode=r,n}setTextContent(t){if(this.__text===t)return this;const r=this.getWritable();return r.__text=t,r}select(t,r){va();let n=t,s=r;const a=Kt(),i=this.getTextContent(),l=this.__key;if(typeof i=="string"){const c=i.length;n===void 0&&(n=c),s===void 0&&(s=c)}else n=0,s=0;if(!Nt(a))return SA(l,n,l,s,"text","text");{const c=Cu();c!==a.anchor.key&&c!==a.focus.key||wa(l),a.setTextNodeRange(this,n,this,s)}return a}selectStart(){return this.select(0,0)}selectEnd(){const t=this.getTextContentSize();return this.select(t,t)}spliceText(t,r,n,s){const a=this.getWritable(),i=a.__text,l=n.length;let c=t;c<0&&(c=l+c,c<0&&(c=0));const d=Kt();if(s&&Nt(d)){const p=t+l;d.setTextNodeRange(a,p,a,p)}const f=i.slice(0,c)+n+i.slice(c+r);return a.__text=f,a}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...t){va();const r=this.getLatest(),n=r.getTextContent();if(n==="")return[];const s=r.__key,a=Cu(),i=n.length;t.sort(((T,D)=>T-D)),t.push(i);const l=[],c=t.length;for(let T=0,D=0;T<i&&D<=c;D++){const I=t[D];I>T&&(l.push(n.slice(T,I)),T=I)}const d=l.length;if(d===1)return[r];const f=l[0],p=r.getParent();let g;const y=r.getFormat(),v=r.getStyle(),_=r.__detail;let b=!1,E=null,k=null;const w=Kt();if(Nt(w)){const[T,D]=w.isBackward()?[w.focus,w.anchor]:[w.anchor,w.focus];T.type==="text"&&T.key===s&&(E=T),D.type==="text"&&D.key===s&&(k=D)}r.isSegmented()?(g=rs(f),g.__format=y,g.__style=v,g.__detail=_,g.__state=w4(r,g),b=!0):g=r.setTextContent(f);const N=[g];for(let T=1;T<d;T++){const D=rs(l[T]);D.__format=y,D.__style=v,D.__detail=_,D.__state=w4(r,D);const I=D.__key;a===s&&wa(I),N.push(D)}const A=E?E.offset:null,P=k?k.offset:null;let R=0;for(const T of N){if(!E&&!k)break;const D=R+T.getTextContentSize();if(E!==null&&A!==null&&A<=D&&A>=R&&(E.set(T.getKey(),A-R,"text"),A<D&&(E=null)),k!==null&&P!==null&&P<=D&&P>=R){k.set(T.getKey(),P-R,"text");break}R=D}if(p!==null){(function(I){const V=I.getPreviousSibling(),X=I.getNextSibling();V!==null&&ay(V),X!==null&&ay(X)})(this);const T=p.getWritable(),D=this.getIndexWithinParent();b?(T.splice(D,0,N),this.remove()):T.splice(D,1,N),Nt(w)&&ty(w,p,D,d-1)}return N}mergeWithSibling(t){const r=t===this.getPreviousSibling();r||t===this.getNextSibling()||Rt(50);const n=this.__key,s=t.__key,a=this.__text,i=a.length;Cu()===s&&wa(n);const l=Kt();if(Nt(l)){const p=l.anchor,g=l.focus;p!==null&&p.key===s&&$4(p,r,n,t,i),g!==null&&g.key===s&&$4(g,r,n,t,i)}const c=t.__text,d=r?c+a:a+c;this.setTextContent(d);const f=this.getWritable();return t.remove(),f}isTextEntity(){return!1}}function bB(e){return{forChild:Sb(e.style),node:null}}function SB(e){const t=e,r=t.style.fontWeight==="normal";return{forChild:Sb(t.style,r?void 0:"bold"),node:null}}const P4=new WeakMap;function kB(e){if(!Mn(e))return!1;if(e.nodeName==="PRE")return!0;const t=e.style.whiteSpace;return typeof t=="string"&&t.startsWith("pre")}function CB(e){const t=e;e.parentElement===null&&Rt(129);let r=t.textContent||"";if((function(n){let s,a=n.parentNode;const i=[n];for(;a!==null&&(s=P4.get(a))===void 0&&!kB(a);)i.push(a),a=a.parentNode;const l=s===void 0?a:s;for(let c=0;c<i.length;c++)P4.set(i[c],l);return l})(t)!==null){const n=r.split(/(\r?\n|\t)/),s=[],a=n.length;for(let i=0;i<a;i++){const l=n[i];l===`
`||l===`\r
`?s.push(Fl()):l==="	"?s.push(_0()):l!==""&&s.push(rs(l))}return{node:s}}if(r=r.replace(/\r/g,"").replace(/[ \t\n]+/g," "),r==="")return{node:null};if(r[0]===" "){let n=t,s=!0;for(;n!==null&&(n=R4(n,!1))!==null;){const a=n.textContent||"";if(a.length>0){/[ \t\n]$/.test(a)&&(r=r.slice(1)),s=!1;break}}s&&(r=r.slice(1))}if(r[r.length-1]===" "){let n=t,s=!0;for(;n!==null&&(n=R4(n,!0))!==null;)if((n.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){s=!1;break}s&&(r=r.slice(0,r.length-1))}return r===""?{node:null}:{node:rs(r)}}function R4(e,t){let r=e;for(;;){let n;for(;(n=t?r.nextSibling:r.previousSibling)===null;){const a=r.parentElement;if(a===null)return null;r=a}if(r=n,Mn(r)){const a=r.style.display;if(a===""&&!Y_(r)||a!==""&&!a.startsWith("inline"))return null}let s=r;for(;(s=t?r.firstChild:r.lastChild)!==null;)r=s;if(Nc(r))return r;if(r.nodeName==="BR")return null}}const TB={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function fc(e){const t=TB[e.nodeName.toLowerCase()];return t===void 0?{node:null}:{forChild:Sb(e.style,t),node:null}}function rs(e=""){return li(new Vu(e))}function qt(e){return e instanceof Vu}function Sb(e,t){const r=e.fontWeight,n=e.textDecoration.split(" "),s=r==="700"||r==="bold",a=n.includes("line-through"),i=e.fontStyle==="italic",l=n.includes("underline"),c=e.verticalAlign;return d=>(qt(d)&&(s&&!d.hasFormat("bold")&&d.toggleFormat("bold"),a&&!d.hasFormat("strikethrough")&&d.toggleFormat("strikethrough"),i&&!d.hasFormat("italic")&&d.toggleFormat("italic"),l&&!d.hasFormat("underline")&&d.toggleFormat("underline"),c!=="sub"||d.hasFormat("subscript")||d.toggleFormat("subscript"),c!=="super"||d.hasFormat("superscript")||d.toggleFormat("superscript"),t&&!d.hasFormat(t)&&d.toggleFormat(t)),d)}class jp extends Vu{static getType(){return"tab"}static clone(t){return new jp(t.__key)}constructor(t){super("	",t),this.__detail=2}static importDOM(){return null}createDOM(t){const r=super.createDOM(t),n=Xh(t.theme,"tab");return n!==void 0&&r.classList.add(...n),r}static importJSON(t){return _0().updateFromJSON(t)}setTextContent(t){return t!=="	"&&t!==""&&Rt(126),super.setTextContent("	")}spliceText(t,r,n,s){return n===""&&r===0||n==="	"&&r===1||Rt(286),this}setDetail(t){return t!==2&&Rt(127),this}setMode(t){return t!=="normal"&&Rt(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}}function _0(){return li(new jp)}function By(e){return e instanceof jp}class EB{constructor(t,r,n){this._selection=null,this.key=t,this.offset=r,this.type=n}is(t){return this.key===t.key&&this.offset===t.offset&&this.type===t.type}isBefore(t){return this.key===t.key?this.offset<t.offset:HA(go(Tc(this,"next")),go(Tc(t,"next")))<0}getNode(){const t=Fs(this.key);return t===null&&Rt(20),t}set(t,r,n,s){const a=this._selection,i=this.key;s&&this.key===t&&this.offset===r&&this.type===n||(this.key=t,this.offset=r,this.type=n,Fp()||(Cu()===i&&wa(t),a!==null&&(a.setCachedNodes(null),a.dirty=!0)))}}function Pl(e,t,r){return new EB(e,t,r)}function Tw(e,t){let r=t.__key,n=e.offset,s="element";if(qt(t)){s="text";const a=t.getTextContentSize();n>a&&(n=a)}else if(!vt(t)){const a=t.getNextSibling();if(qt(a))r=a.__key,n=0,s="text";else{const i=t.getParent();i&&(r=i.__key,n=t.getIndexWithinParent()+1)}}e.set(r,n,s)}function D4(e,t){if(vt(t)){const r=t.getLastDescendant();vt(r)||qt(r)?Tw(e,r):Tw(e,t)}else Tw(e,t)}class Uy{constructor(t){this._cachedNodes=null,this._nodes=t,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(t){this._cachedNodes=t}is(t){if(!Pa(t))return!1;const r=this._nodes,n=t._nodes;return r.size===n.size&&Array.from(r).every((s=>n.has(s)))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(t){this.dirty=!0,this._nodes.add(t),this._cachedNodes=null}delete(t){this.dirty=!0,this._nodes.delete(t),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(t){return this._nodes.has(t)}clone(){return new Uy(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(t){}insertText(){}insertNodes(t){const r=this.getNodes(),n=r.length,s=r[n-1];let a;if(qt(s))a=s.select();else{const i=s.getIndexWithinParent()+1;a=s.getParentOrThrow().select(i,i)}a.insertNodes(t);for(let i=0;i<n;i++)r[i].remove()}getNodes(){const t=this._cachedNodes;if(t!==null)return t;const r=this._nodes,n=[];for(const s of r){const a=Fs(s);a!==null&&n.push(a)}return Fp()||(this._cachedNodes=n),n}getTextContent(){const t=this.getNodes();let r="";for(let n=0;n<t.length;n++)r+=t[n].getTextContent();return r}deleteNodes(){const t=this.getNodes();if((Kt()||b0())===this&&t[0]){const r=ba(t[0],"next");dU(Lu(r,r))}for(const r of t)r.remove()}}function Nt(e){return e instanceof xf}class xf{constructor(t,r,n,s){this.anchor=t,this.focus=r,t._selection=this,r._selection=this,this._cachedNodes=null,this.format=n,this.style=s,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(t){this._cachedNodes=t}is(t){return!!Nt(t)&&this.anchor.is(t.anchor)&&this.focus.is(t.focus)&&this.format===t.format&&this.style===t.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const t=this._cachedNodes;if(t!==null)return t;const r=(function(n){const s=[],[a,i]=n.getTextSlices();a&&s.push(a.caret.origin);const l=new Set,c=new Set;for(const d of n)if(jl(d)){const{origin:f}=d;s.length===0?l.add(f):(c.add(f),s.push(f))}else{const{origin:f}=d;vt(f)&&c.has(f)||s.push(f)}if(i&&s.push(i.caret.origin),of(n.focus)&&vt(n.focus.origin)&&n.focus.getNodeAtCaret()===null)for(let d=yo(n.focus.origin,"previous");jl(d)&&l.has(d.origin)&&!d.origin.isEmpty()&&d.origin.is(s[s.length-1]);d=Gb(d))l.delete(d.origin),s.pop();for(;s.length>1;){const d=s[s.length-1];if(!vt(d)||c.has(d)||d.isEmpty()||l.has(d))break;s.pop()}if(s.length===0&&n.isCollapsed()){const d=go(n.anchor),f=go(n.anchor.getFlipped()),p=y=>Fu(y)?y.origin:y.getNodeAtCaret(),g=p(d)||p(f)||(n.anchor.getNodeAtCaret()?d.origin:f.origin);s.push(g)}return s})(KA(oE(this),"next"));return Fp()||(this._cachedNodes=r),r}setTextNodeRange(t,r,n,s){this.anchor.set(t.__key,r,"text"),this.focus.set(n.__key,s,"text")}getTextContent(){const t=this.getNodes();if(t.length===0)return"";const r=t[0],n=t[t.length-1],s=this.anchor,a=this.focus,i=s.isBefore(a),[l,c]=z_(this);let d="",f=!0;for(let p=0;p<t.length;p++){const g=t[p];if(vt(g)&&!g.isInline())f||(d+=`
`),f=!g.isEmpty();else if(f=!1,qt(g)){let y=g.getTextContent();g===r?g===n?s.type==="element"&&a.type==="element"&&a.offset!==s.offset||(y=l<c?y.slice(l,c):y.slice(c,l)):y=i?y.slice(l):y.slice(c):g===n&&(y=i?y.slice(0,c):y.slice(0,l)),d+=y}else!nn(g)&&!vc(g)||g===n&&this.isCollapsed()||(d+=g.getTextContent())}return d}applyDOMRange(t){const r=Xn(),n=r.getEditorState()._selection,s=bA(t.startContainer,t.startOffset,t.endContainer,t.endOffset,r,n);if(s===null)return;const[a,i]=s;this.anchor.set(a.key,a.offset,a.type,!0),this.focus.set(i.key,i.offset,i.type,!0),q1(this)}clone(){const t=this.anchor,r=this.focus;return new xf(Pl(t.key,t.offset,t.type),Pl(r.key,r.offset,r.type),this.format,this.style)}toggleFormat(t){this.format=sy(this.format,t,null),this.dirty=!0}setFormat(t){this.format=t,this.dirty=!0}setStyle(t){this.style=t,this.dirty=!0}hasFormat(t){const r=ef[t];return!!(this.format&r)}insertRawText(t){const r=t.split(/(\r?\n|\t)/),n=[],s=r.length;for(let a=0;a<s;a++){const i=r[a];i===`
`||i===`\r
`?n.push(Fl()):i==="	"?n.push(_0()):n.push(rs(i))}this.insertNodes(n)}insertText(t){const r=this.anchor,n=this.focus,s=this.format,a=this.style;let i=r,l=n;!this.isCollapsed()&&n.isBefore(r)&&(i=n,l=r),i.type==="element"&&(function(b,E,k,w){const N=b.getNode(),A=N.getChildAtIndex(b.offset),P=rs();if(P.setFormat(k),P.setStyle(w),jb(A))A.splice(0,0,[P]);else{const R=Ws(N)?In().append(P):P;A===null?N.append(R):A.insertBefore(R)}b.is(E)&&E.set(P.__key,0,"text"),b.set(P.__key,0,"text")})(i,l,s,a),l.type==="element"&&cf(l,go(Tc(l,"next")));const c=i.offset;let d=l.offset;const f=this.getNodes(),p=f.length;let g=f[0];qt(g)||Rt(26);const y=g.getTextContent().length,v=g.getParentOrThrow();let _=f[p-1];if(p===1&&l.type==="element"&&(d=y,l.set(i.key,d,"text")),this.isCollapsed()&&c===y&&(gc(g)||!g.canInsertTextAfter()||!v.canInsertTextAfter()&&g.getNextSibling()===null)){let b=g.getNextSibling();if(qt(b)&&b.canInsertTextBefore()&&!gc(b)||(b=rs(),b.setFormat(s),b.setStyle(a),v.canInsertTextAfter()?g.insertAfter(b):v.insertAfter(b)),b.select(0,0),g=b,t!=="")return void this.insertText(t)}else if(this.isCollapsed()&&c===0&&(gc(g)||!g.canInsertTextBefore()||!v.canInsertTextBefore()&&g.getPreviousSibling()===null)){let b=g.getPreviousSibling();if(qt(b)&&!gc(b)||(b=rs(),b.setFormat(s),v.canInsertTextBefore()?g.insertBefore(b):v.insertBefore(b)),b.select(),g=b,t!=="")return void this.insertText(t)}else if(g.isSegmented()&&c!==y){const b=rs(g.getTextContent());b.setFormat(s),g.replace(b),g=b}else if(!this.isCollapsed()&&t!==""){const b=_.getParent();if(!v.canInsertTextBefore()||!v.canInsertTextAfter()||vt(b)&&(!b.canInsertTextBefore()||!b.canInsertTextAfter()))return this.insertText(""),_A(this.anchor,this.focus,null),void this.insertText(t)}if(p===1){if(Hd(g)){const w=rs(t);return w.select(),void g.replace(w)}const b=g.getFormat(),E=g.getStyle();if(c!==d||b===s&&E===a){if(By(g)){const w=rs(t);return w.setFormat(s),w.setStyle(a),w.select(),void g.replace(w)}}else{if(g.getTextContent()!==""){const w=rs(t);if(w.setFormat(s),w.setStyle(a),w.select(),c===0)g.insertBefore(w,!1);else{const[N]=g.splitText(c);N.insertAfter(w,!1)}return void(w.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=t.length))}g.setFormat(s),g.setStyle(a)}const k=d-c;g=g.spliceText(c,k,t,!0),g.getTextContent()===""?g.remove():this.anchor.type==="text"&&(g.isComposing()?this.anchor.offset-=t.length:(this.format=b,this.style=E))}else{const b=new Set([...g.getParentKeys(),..._.getParentKeys()]),E=vt(g)?g:g.getParentOrThrow();let k=vt(_)?_:_.getParentOrThrow(),w=_;if(!E.is(k)&&k.isInline())do w=k,k=k.getParentOrThrow();while(k.isInline());if(l.type==="text"&&(d!==0||_.getTextContent()==="")||l.type==="element"&&_.getIndexWithinParent()<d)if(qt(_)&&!Hd(_)&&d!==_.getTextContentSize()){if(_.isSegmented()){const T=rs(_.getTextContent());_.replace(T),_=T}Ws(l.getNode())||l.type!=="text"||(_=_.spliceText(0,d,"")),b.add(_.__key)}else{const T=_.getParentOrThrow();T.canBeEmpty()||T.getChildrenSize()!==1?_.remove():T.remove()}else b.add(_.__key);const N=k.getChildren(),A=new Set(f),P=E.is(k),R=E.isInline()&&g.getNextSibling()===null?E:g;for(let T=N.length-1;T>=0;T--){const D=N[T];if(D.is(g)||vt(D)&&D.isParentOf(g))break;D.isAttached()&&(!A.has(D)||D.is(w)?P||R.insertAfter(D,!1):D.remove())}if(!P){let T=k,D=null;for(;T!==null;){const I=T.getChildren(),V=I.length;(V===0||I[V-1].is(D))&&(b.delete(T.__key),D=T),T=T.getParent()}}if(Hd(g))if(c===y)g.select();else{const T=rs(t);T.select(),g.replace(T)}else g=g.spliceText(c,y-c,t,!0),g.getTextContent()===""?g.remove():g.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=t.length);for(let T=1;T<p;T++){const D=f[T],I=D.__key;b.has(I)||D.remove()}}}removeText(){const t=Kt()===this;I1(this,fU(oE(this))),t&&Kt()!==this&&Sa(this)}formatText(t,r=null){if(this.isCollapsed())return this.toggleFormat(t),void wa(null);const n=this.getNodes(),s=[];for(const N of n)qt(N)&&s.push(N);const a=N=>{n.forEach((A=>{if(vt(A)){const P=A.getFormatFlags(t,N);A.setTextFormat(P)}}))},i=s.length;if(i===0)return this.toggleFormat(t),wa(null),void a(r);const l=this.anchor,c=this.focus,d=this.isBackward(),f=d?c:l,p=d?l:c;let g=0,y=s[0],v=f.type==="element"?0:f.offset;if(f.type==="text"&&v===y.getTextContentSize()&&(g=1,y=s[1],v=0),y==null)return;const _=y.getFormatFlags(t,r);a(_);const b=i-1;let E=s[b];const k=p.type==="text"?p.offset:E.getTextContentSize();if(y.is(E)){if(v===k)return;if(gc(y)||v===0&&k===y.getTextContentSize())y.setFormat(_);else{const N=y.splitText(v,k),A=v===0?N[0]:N[1];A.setFormat(_),f.type==="text"&&f.set(A.__key,0,"text"),p.type==="text"&&p.set(A.__key,k-v,"text")}return void(this.format=_)}v===0||gc(y)||([,y]=y.splitText(v),v=0),y.setFormat(_);const w=E.getFormatFlags(t,_);k>0&&(k===E.getTextContentSize()||gc(E)||([E]=E.splitText(k)),E.setFormat(w));for(let N=g+1;N<b;N++){const A=s[N],P=A.getFormatFlags(t,w);A.setFormat(P)}f.type==="text"&&f.set(y.__key,v,"text"),p.type==="text"&&p.set(E.__key,k,"text"),this.format=_|w}insertNodes(t){if(t.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const v=Kt();return Nt(v)||Rt(134),v.insertNodes(t)}const r=(this.isBackward()?this.focus:this.anchor).getNode(),n=Fw(r,ho),s=t[t.length-1];if(vt(n)&&"__language"in n){if("__language"in t[0])this.insertText(t[0].getTextContent());else{const v=Ew(this);n.splice(v,0,t),s.selectEnd()}return}if(!t.some((v=>(vt(v)||nn(v))&&!v.isInline()))){vt(n)||Rt(211,r.constructor.name,r.getType());const v=Ew(this);return n.splice(v,0,t),void s.selectEnd()}const a=(function(v){const _=In();let b=null;for(let E=0;E<v.length;E++){const k=v[E],w=vc(k);if(w||nn(k)&&k.isInline()||vt(k)&&k.isInline()||qt(k)||k.isParentRequired()){if(b===null&&(b=k.createParentElementNode(),_.append(b),w))continue;b!==null&&b.append(k)}else _.append(k),b=null}return _})(t),i=a.getLastDescendant(),l=a.getChildren(),c=!vt(n)||!n.isEmpty()?this.insertParagraph():null,d=l[l.length-1];let f=l[0];var p;vt(p=f)&&ho(p)&&!p.isEmpty()&&vt(n)&&(!n.isEmpty()||n.canMergeWhenEmpty())&&(vt(n)||Rt(211,r.constructor.name,r.getType()),n.append(...f.getChildren()),f=l[1]),f&&(n===null&&Rt(212,r.constructor.name,r.getType()),(function(v,_,b){const E=_.getParentOrThrow().getLastChild();let k=_;const w=[_];for(;k!==E;)k.getNextSibling()||Rt(140),k=k.getNextSibling(),w.push(k);let N=v;for(const A of w)N=N.insertAfter(A)})(n,f));const g=Fw(i,ho);c&&vt(g)&&(c.canMergeWhenEmpty()||ho(d))&&(g.append(...c.getChildren()),c.remove()),vt(n)&&n.isEmpty()&&n.remove(),i.selectEnd();const y=vt(n)?n.getLastChild():null;vc(y)&&g!==n&&y.remove()}insertParagraph(){if(this.anchor.key==="root"){const i=In();return zn().splice(this.anchor.offset,0,[i]),i.select(),i}const t=Ew(this),r=Fw(this.anchor.getNode(),ho);vt(r)||Rt(213);const n=r.getChildAtIndex(t),s=n?[n,...n.getNextSiblings()]:[],a=r.insertNewAfter(this,!1);return a?(a.append(...s),a.selectStart(),a):null}insertLineBreak(t){const r=Fl();if(this.insertNodes([r]),t){const n=r.getParentOrThrow(),s=r.getIndexWithinParent();n.select(s,s)}}extract(){const t=this.getNodes(),r=t.length,n=r-1,s=this.anchor,a=this.focus;let i=t[0],l=t[n];const[c,d]=z_(this);if(r===0)return[];if(r===1){if(qt(i)&&!this.isCollapsed()){const p=c>d?d:c,g=c>d?c:d,y=i.splitText(p,g),v=p===0?y[0]:y[1];return v!=null?[v]:[]}return[i]}const f=s.isBefore(a);if(qt(i)){const p=f?c:d;p===i.getTextContentSize()?t.shift():p!==0&&([,i]=i.splitText(p),t[0]=i)}if(qt(l)){const p=l.getTextContent().length,g=f?d:c;g===0?t.pop():g!==p&&([l]=l.splitText(g),t[n]=l)}return t}modify(t,r,n){if(W4(this,t,r,n))return;const s=t==="move",a=Xn(),i=qo(xo(a));if(!i)return;const l=a._blockCursorElement,c=a._rootElement,d=this.focus.getNode();if(c===null||l===null||!vt(d)||d.isInline()||d.canBeEmpty()||q_(l,a,c),this.dirty){let f=nf(a,this.anchor.key),p=nf(a,this.focus.key);this.anchor.type==="text"&&(f=o0(f)),this.focus.type==="text"&&(p=o0(p)),f&&p&&kA(i,f,this.anchor.offset,p,this.focus.offset)}if((function(f,p,g,y){f.modify(p,g,y)})(i,t,r?"backward":"forward",n),i.rangeCount>0){const f=i.getRangeAt(0),p=this.anchor.getNode(),g=Ws(p)?p:YB(p);if(this.applyDOMRange(f),this.dirty=!0,!s){const y=this.getNodes(),v=[];let _=!1;for(let b=0;b<y.length;b++){const E=y[b];K_(E,g)?v.push(E):_=!0}if(_&&v.length>0)if(r){const b=v[0];vt(b)?b.selectStart():b.getParentOrThrow().selectStart()}else{const b=v[v.length-1];vt(b)?b.selectEnd():b.getParentOrThrow().selectEnd()}i.anchorNode===f.startContainer&&i.anchorOffset===f.startOffset||(function(b){const E=b.focus,k=b.anchor,w=k.key,N=k.offset,A=k.type;k.set(E.key,E.offset,E.type,!0),E.set(w,N,A,!0)})(this)}}n==="lineboundary"&&W4(this,t,r,n,"decorators")}forwardDeletion(t,r,n){if(!n&&(t.type==="element"&&vt(r)&&t.offset===r.getChildrenSize()||t.type==="text"&&t.offset===r.getTextContentSize())){const s=r.getParent(),a=r.getNextSibling()||(s===null?null:s.getNextSibling());if(vt(a)&&a.isShadowRoot())return!0}return!1}deleteCharacter(t){const r=this.isCollapsed();if(this.isCollapsed()){const n=this.anchor;let s=n.getNode();if(this.forwardDeletion(n,s,t))return;const a=Kb(Tc(n,t?"previous":"next"));if(a.getTextSlices().every((l=>l===null||l.distance===0))){let l={type:"initial"};for(const c of a.iterNodeCarets("shadowRoot"))if(jl(c)){if(!c.origin.isInline()){if(c.origin.isShadowRoot()){if(l.type==="merge-block")break;if(vt(a.anchor.origin)&&a.anchor.origin.isEmpty()){const d=go(c);I1(this,Lu(d,d)),a.anchor.origin.remove()}return}l.type!=="merge-next-block"&&l.type!=="merge-block"||(l={block:l.block,caret:c,type:"merge-block"})}}else{if(l.type==="merge-block")break;if(of(c)){if(vt(c.origin)){if(c.origin.isInline()){if(!c.origin.isParentOf(a.anchor.origin))break}else l={block:c.origin,type:"merge-next-block"};continue}if(nn(c.origin)){if(!c.origin.isIsolated())if(l.type==="merge-next-block"&&(c.origin.isKeyboardSelectable()||!c.origin.isInline())&&vt(a.anchor.origin)&&a.anchor.origin.isEmpty()){a.anchor.origin.remove();const d=kb();d.add(c.origin.getKey()),Sa(d)}else c.origin.remove();return}break}}if(l.type==="merge-block"){const{caret:c,block:d}=l;return I1(this,Lu(!c.origin.isEmpty()&&d.isEmpty()?Xb(ba(d,c.direction)):a.anchor,c)),this.removeText()}}const i=this.focus;if(this.modify("extend",t,"character"),this.isCollapsed()){if(t&&n.offset===0&&M4(this,n.getNode()))return}else{const l=i.type==="text"?i.getNode():null;if(s=n.type==="text"?n.getNode():null,l!==null&&l.isSegmented()){const c=i.offset,d=l.getTextContentSize();if(l.is(s)||t&&c!==d||!t&&c!==0)return void O4(l,t,c)}else if(s!==null&&s.isSegmented()){const c=n.offset,d=s.getTextContentSize();if(s.is(l)||t&&c!==0||!t&&c!==d)return void O4(s,t,c)}(function(c,d){const f=c.anchor,p=c.focus,g=f.getNode(),y=p.getNode();if(g===y&&f.type==="text"&&p.type==="text"){const v=f.offset,_=p.offset,b=v<_,E=b?v:_,k=b?_:v,w=k-1;E!==w&&(function(N){return!(LA(N)||NB(N))})(g.getTextContent().slice(E,k))&&(d?p.set(p.key,w,p.type):f.set(f.key,w,f.type))}})(this,t)}}if(this.removeText(),t&&!r&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const n=this.anchor.getNode();n.isEmpty()&&Ws(n.getParent())&&n.getPreviousSibling()===null&&M4(this,n)}}deleteLine(t){this.isCollapsed()&&this.modify("extend",t,"lineboundary"),this.isCollapsed()?this.deleteCharacter(t):this.removeText()}deleteWord(t){if(this.isCollapsed()){const r=this.anchor,n=r.getNode();if(this.forwardDeletion(r,n,t))return;this.modify("extend",t,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}}function Pa(e){return e instanceof Uy}function I4(e){const t=e.offset;if(e.type==="text")return t;const r=e.getNode();return t===r.getChildrenSize()?r.getTextContent().length:0}function z_(e){const t=e.getStartEndPoints();if(t===null)return[0,0];const[r,n]=t;return r.type==="element"&&n.type==="element"&&r.key===n.key&&r.offset===n.offset?[0,0]:[I4(r),I4(n)]}function M4(e,t){for(let r=t;r;r=r.getParent()){if(vt(r)){if(r.collapseAtStart(e))return!0;if(ii(r))break}if(r.getPreviousSibling())break}return!1}const NB=(()=>{try{const e=new RegExp("\\p{Emoji}","u"),t=e.test.bind(e);if(t("❤️")&&t("#️⃣")&&t("👍"))return t}catch{}return()=>!1})();function O4(e,t,r){const n=e,s=n.getTextContent().split(/(?=\s)/g),a=s.length;let i=0,l=0;for(let d=0;d<a;d++){const f=d===a-1;if(l=i,i+=s[d].length,t&&i===r||i>r||f){s.splice(d,1),f&&(l=void 0);break}}const c=s.join("").trim();c===""?n.remove():(n.setTextContent(c),n.select(l,l))}function L4(e,t,r,n){let s,a=t;if(Mn(e)){let i=!1;const l=e.childNodes,c=l.length,d=n._blockCursorElement;a===c&&(i=!0,a=c-1);let f=l[a],p=!1;if(f===d)f=l[a+1],p=!0;else if(d!==null){const g=d.parentNode;e===g&&t>Array.prototype.indexOf.call(g.children,d)&&a--}if(s=Wh(f),qt(s))a=Pu(s,i?"next":"previous");else{let g=Wh(e);if(g===null)return null;if(vt(g)){const y=n.getElementByKey(g.getKey());y===null&&Rt(214),[g,a]=g.getDOMSlot(y).resolveChildIndex(g,y,e,t),vt(g)||Rt(215),i&&a>=g.getChildrenSize()&&(a=Math.max(0,g.getChildrenSize()-1));let _=g.getChildAtIndex(a);if(vt(_)&&(function(b,E,k){const w=b.getParent();return k===null||w===null||!w.canBeEmpty()||w!==k.getNode()})(_,0,r)){const b=i?_.getLastDescendant():_.getFirstDescendant();b===null?g=_:(_=b,g=vt(_)?_:_.getParentOrThrow()),a=0}qt(_)?(s=_,g=null,a=Pu(_,i?"next":"previous")):_!==g&&i&&!p&&(vt(g)||Rt(216),a=Math.min(g.getChildrenSize(),a+1))}else{const y=g.getIndexWithinParent();a=t===0&&nn(g)&&Wh(e)===g?y:y+1,g=g.getParentOrThrow()}if(vt(g))return Pl(g.__key,a,"element")}}else s=Wh(e);return qt(s)?Pl(s.__key,Pu(s,a,"clamp"),"text"):null}function B4(e,t,r){const n=e.offset,s=e.getNode();if(n===0){const a=s.getPreviousSibling(),i=s.getParent();if(t){if((r||!t)&&a===null&&vt(i)&&i.isInline()){const l=i.getPreviousSibling();qt(l)&&e.set(l.__key,l.getTextContent().length,"text")}}else vt(a)&&!r&&a.isInline()?e.set(a.__key,a.getChildrenSize(),"element"):qt(a)&&e.set(a.__key,a.getTextContent().length,"text")}else if(n===s.getTextContent().length){const a=s.getNextSibling(),i=s.getParent();if(t&&vt(a)&&a.isInline())e.set(a.__key,0,"element");else if((r||t)&&a===null&&vt(i)&&i.isInline()&&!i.canInsertTextAfter()){const l=i.getNextSibling();qt(l)&&e.set(l.__key,0,"text")}}}function _A(e,t,r){if(e.type==="text"&&t.type==="text"){const n=e.isBefore(t),s=e.is(t);B4(e,n,s),B4(t,!n,s),s&&t.set(e.key,e.offset,e.type);const a=Xn();if(a.isComposing()&&a._compositionKey!==e.key&&Nt(r)){const i=r.anchor,l=r.focus;e.set(i.key,i.offset,i.type,!0),t.set(l.key,l.offset,l.type,!0)}}}function bA(e,t,r,n,s,a){if(e===null||r===null||!Dp(s,e,r))return null;const i=L4(e,t,Nt(a)?a.anchor:null,s);if(i===null)return null;const l=L4(r,n,Nt(a)?a.focus:null,s);if(l===null)return null;if(i.type==="element"&&l.type==="element"){const c=Wh(e),d=Wh(r);if(nn(c)&&nn(d))return null}return _A(i,l,a),[i,l]}function H_(e){return vt(e)&&!e.isInline()}function SA(e,t,r,n,s,a){const i=Ku(),l=new xf(Pl(e,t,s),Pl(r,n,a),0,"");return l.dirty=!0,i._selection=l,l}function $y(){const e=Pl("root",0,"element"),t=Pl("root",0,"element");return new xf(e,t,0,"")}function kb(){return new Uy(new Set)}function Cb(e,t,r,n){const s=r._window;if(s===null)return null;const a=n||s.event,i=a?a.type:void 0,l=i==="selectionchange",c=!N_&&(l||i==="beforeinput"||i==="compositionstart"||i==="compositionend"||i==="click"&&a&&a.detail===3||i==="drop"||i===void 0);let d,f,p,g;if(Nt(e)&&!c)return e.clone();if(t===null)return null;if(d=t.anchorNode,f=t.focusNode,p=t.anchorOffset,g=t.focusOffset,l&&Nt(e)&&!Dp(r,d,f))return e.clone();const y=bA(d,p,f,g,r,e);if(y===null)return null;const[v,_]=y;return new xf(v,_,Nt(e)?e.format:0,Nt(e)?e.style:"")}function Kt(){return Ku()._selection}function b0(){return Xn()._editorState._selection}function ty(e,t,r,n=1){const s=e.anchor,a=e.focus,i=s.getNode(),l=a.getNode();if(!t.is(i)&&!t.is(l))return;const c=t.__key;if(e.isCollapsed()){const d=s.offset;if(r<=d&&n>0||r<d&&n<0){const f=Math.max(0,d+n);s.set(c,f,"element"),a.set(c,f,"element"),U4(e)}}else{const d=e.isBackward(),f=d?a:s,p=f.getNode(),g=d?s:a,y=g.getNode();if(t.is(p)){const v=f.offset;(r<=v&&n>0||r<v&&n<0)&&f.set(c,Math.max(0,v+n),"element")}if(t.is(y)){const v=g.offset;(r<=v&&n>0||r<v&&n<0)&&g.set(c,Math.max(0,v+n),"element")}}U4(e)}function U4(e){const t=e.anchor,r=t.offset,n=e.focus,s=n.offset,a=t.getNode(),i=n.getNode();if(e.isCollapsed()){if(!vt(a))return;const l=a.getChildrenSize(),c=r>=l,d=c?a.getChildAtIndex(l-1):a.getChildAtIndex(r);if(qt(d)){let f=0;c&&(f=d.getTextContentSize()),t.set(d.__key,f,"text"),n.set(d.__key,f,"text")}}else{if(vt(a)){const l=a.getChildrenSize(),c=r>=l,d=c?a.getChildAtIndex(l-1):a.getChildAtIndex(r);if(qt(d)){let f=0;c&&(f=d.getTextContentSize()),t.set(d.__key,f,"text")}}if(vt(i)){const l=i.getChildrenSize(),c=s>=l,d=c?i.getChildAtIndex(l-1):i.getChildAtIndex(s);if(qt(d)){let f=0;c&&(f=d.getTextContentSize()),n.set(d.__key,f,"text")}}}}function ry(e,t,r,n,s){let a=null,i=0,l=null;n!==null?(a=n.__key,qt(n)?(i=n.getTextContentSize(),l="text"):vt(n)&&(i=n.getChildrenSize(),l="element")):s!==null&&(a=s.__key,qt(s)?l="text":vt(s)&&(l="element")),a!==null&&l!==null?e.set(a,i,l):(i=t.getIndexWithinParent(),i===-1&&(i=r.getChildrenSize()),e.set(r.__key,i,"element"))}function $4(e,t,r,n,s){e.type==="text"?e.set(r,e.offset+(t?0:s),"text"):e.offset>n.getIndexWithinParent()&&e.set(e.key,e.offset-1,"element")}function kA(e,t,r,n,s){try{e.setBaseAndExtent(t,r,n,s)}catch{}}function AB(e,t,r,n,s,a,i){const l=n.anchorNode,c=n.focusNode,d=n.anchorOffset,f=n.focusOffset,p=document.activeElement;if(s.has(jA)&&p!==a||p!==null&&Rb(p))return;if(!Nt(t))return void(e!==null&&Dp(r,l,c)&&n.removeAllRanges());const g=t.anchor,y=t.focus,v=g.key,_=y.key,b=nf(r,v),E=nf(r,_),k=g.offset,w=y.offset,N=t.format,A=t.style,P=t.isCollapsed();let R=b,T=E,D=!1;if(g.type==="text"){R=o0(b);const q=g.getNode();D=q.getFormat()!==N||q.getStyle()!==A}else Nt(e)&&e.anchor.type==="text"&&(D=!0);var I,V,X,Z,ie;if(y.type==="text"&&(T=o0(E)),R!==null&&T!==null&&(P&&(e===null||D||Nt(e)&&(e.format!==N||e.style!==A))&&(I=N,V=A,X=k,Z=v,ie=performance.now(),hA=[I,V,X,Z,ie]),d!==k||f!==w||l!==R||c!==T||n.type==="Range"&&P||(p!==null&&a.contains(p)||a.focus({preventScroll:!0}),g.type==="element"))){if(kA(n,R,k,T,w),!s.has(MB)&&t.isCollapsed()&&a!==null&&a===document.activeElement){const q=Nt(t)&&t.anchor.type==="element"?R.childNodes[k]||null:n.rangeCount>0?n.getRangeAt(0):null;if(q!==null){let ne;if(q instanceof Text){const M=document.createRange();M.selectNode(q),ne=M.getBoundingClientRect()}else ne=q.getBoundingClientRect();(function(M,W,L){const H=WA(L),K=Bb(H);if(H===null||K===null)return;let{top:B,bottom:z}=W,Q=0,Y=0,te=L;for(;te!==null;){const ee=te===H.body;if(ee)Q=0,Y=xo(M).innerHeight;else{const ge=te.getBoundingClientRect();Q=ge.top,Y=ge.bottom}let ae=0;if(B<Q?ae=-(Q-B):z>Y&&(ae=z-Y),ae!==0)if(ee)K.scrollBy(0,ae);else{const ge=te.scrollTop;te.scrollTop+=ae;const _e=te.scrollTop-ge;B-=_e,z-=_e}if(ee)break;te=Ip(te)}})(r,ne,a)}}U_=!0}}function jB(e){let t=Kt()||b0();t===null&&(t=zn().selectEnd()),t.insertNodes(e)}function Ew(e){let t=e;e.isCollapsed()||t.removeText();const r=Kt();Nt(r)&&(t=r),Nt(t)||Rt(161);const n=t.anchor;let s=n.getNode(),a=n.offset;for(;!ho(s);){const i=s;if([s,a]=FB(s,a),i.is(s))break}return a}function FB(e,t){const r=e.getParent();if(!r){const s=In();return zn().append(s),s.select(),[zn(),0]}if(qt(e)){const s=e.splitText(t);if(s.length===0)return[r,e.getIndexWithinParent()];const a=t===0?0:1;return[r,s[0].getIndexWithinParent()+a]}if(!vt(e)||t===0)return[r,e.getIndexWithinParent()];const n=e.getChildAtIndex(t);if(n){const s=new xf(Pl(e.__key,t,"element"),Pl(e.__key,t,"element"),0,""),a=e.insertNewAfter(s);a&&a.append(n,...n.getNextSiblings())}return[r,e.getIndexWithinParent()+1]}function W4(e,t,r,n,s="decorators-and-blocks"){if(t==="move"&&n==="character"&&!e.isCollapsed()){const[f,p]=r===e.isBackward()?[e.focus,e.anchor]:[e.anchor,e.focus];return p.set(f.key,f.offset,f.type),!0}const a=Tc(e.focus,r?"previous":"next"),i=n==="lineboundary",l=t==="move";let c=a,d=s==="decorators-and-blocks";if(!VA(c)){for(const f of c){d=!1;const{origin:p}=f;if(!nn(p)||p.isIsolated()||(c=f,!i||!p.isInline()))break}if(d)for(const f of Kb(a).iterNodeCarets(t==="extend"?"shadowRoot":"root")){if(jl(f))f.origin.isInline()||(c=f);else{if(vt(f.origin))continue;nn(f.origin)&&!f.origin.isInline()&&(c=f)}break}}if(c===a)return!1;if(l&&!i&&nn(c.origin)&&c.origin.isKeyboardSelectable()){const f=kb();return f.add(c.origin.getKey()),Sa(f),!0}return c=go(c),l&&cf(e.anchor,c),cf(e.focus,c),d||!i}let Zs=null,ea=null,Si=!1,Nw=!1,R1=0;const z4={characterData:!0,childList:!0,subtree:!0};function Fp(){return Si||Zs!==null&&Zs._readOnly}function va(){Si&&Rt(13)}function CA(){R1>99&&Rt(14)}function Ku(){return Zs===null&&Rt(195,TA()),Zs}function Xn(){return ea===null&&Rt(196,TA()),ea}function TA(){let e=0;const t=new Set,r=Hy.version;if(typeof window<"u")for(const s of document.querySelectorAll("[contenteditable]")){const a=Gy(s);if(Db(a))e++;else if(a){let i=String(a.constructor.version||"<0.17.1");i===r&&(i+=" (separately built, likely a bundler configuration issue)"),t.add(i)}}let n=` Detected on the page: ${e} compatible editor(s) with version ${r}`;return t.size&&(n+=` and incompatible editors with versions ${Array.from(t).join(", ")}`),n}function PB(){return ea}function H4(e,t,r){const n=t.__type,s=PA(e,n);let a=r.get(n);a===void 0&&(a=Array.from(s.transforms),r.set(n,a));const i=a.length;for(let l=0;l<i&&(a[l](t),t.isAttached());l++);}function G4(e,t){return e!==void 0&&e.__key!==t&&e.isAttached()}function EA(e,t){if(!t)return;const r=e._updateTags;let n=t;Array.isArray(t)||(n=[t]);for(const s of n)r.add(s)}function RB(e){return Tb(e,Xn()._nodes)}function Tb(e,t){const r=e.type,n=t.get(r);n===void 0&&Rt(17,r);const s=n.klass;e.type!==s.getType()&&Rt(18,s.name);const a=s.importJSON(e),i=e.children;if(vt(a)&&Array.isArray(i))for(let l=0;l<i.length;l++){const c=Tb(i[l],t);a.append(c)}return a}function V4(e,t,r){const n=Zs,s=Si,a=ea;Zs=t,Si=!0,ea=e;try{return r()}finally{Zs=n,Si=s,ea=a}}function pc(e,t){const r=e._pendingEditorState,n=e._rootElement,s=e._headless||n===null;if(r===null)return;const a=e._editorState,i=a._selection,l=r._selection,c=e._dirtyType!==Zd,d=Zs,f=Si,p=ea,g=e._updating,y=e._observer;let v=null;if(e._pendingEditorState=null,e._editorState=r,!s&&c&&y!==null){ea=e,Zs=r,Si=!1,e._updating=!0;try{const P=e._dirtyType,R=e._dirtyElements,T=e._dirtyLeaves;y.disconnect(),v=oB(a,r,e,P,R,T)}catch(P){if(P instanceof Error&&e._onError(P),Nw)throw P;return FA(e,null,n,r),H6(e),e._dirtyType=i0,Nw=!0,pc(e,a),void(Nw=!1)}finally{y.observe(n,z4),e._updating=g,Zs=d,Si=f,ea=p}}r._readOnly||(r._readOnly=!0);const _=e._dirtyLeaves,b=e._dirtyElements,E=e._normalizedNodes,k=e._updateTags,w=e._deferred;c&&(e._dirtyType=Zd,e._cloneNotNeeded.clear(),e._dirtyLeaves=new Set,e._dirtyElements=new Map,e._normalizedNodes=new Set,e._updateTags=new Set),(function(P,R){const T=P._decorators;let D=P._pendingDecorators||T;const I=R._nodeMap;let V;for(V in D)I.has(V)||(D===T&&(D=MA(P)),delete D[V])})(e,r);const N=s?null:qo(xo(e));if(e._editable&&N!==null&&(c||l===null||l.dirty)&&n!==null&&!k.has(OB)){ea=e,Zs=r;try{if(y!==null&&y.disconnect(),c||l===null||l.dirty){const P=e._blockCursorElement;P!==null&&q_(P,e,n),AB(i,l,e,N,k,n)}(function(P,R,T){let D=P._blockCursorElement;if(Nt(T)&&T.isCollapsed()&&T.anchor.type==="element"&&R.contains(document.activeElement)){const I=T.anchor,V=I.getNode(),X=I.offset;let Z=!1,ie=null;if(X===V.getChildrenSize())jw(V.getChildAtIndex(X-1))&&(Z=!0);else{const q=V.getChildAtIndex(X);if(q!==null&&jw(q)){const ne=q.getPreviousSibling();(ne===null||jw(ne))&&(Z=!0,ie=P.getElementByKey(q.__key))}}if(Z){const q=P.getElementByKey(V.__key);return D===null&&(P._blockCursorElement=D=(function(ne){const M=ne.theme,W=document.createElement("div");W.contentEditable="false",W.setAttribute("data-lexical-cursor","true");let L=M.blockCursor;if(L!==void 0){if(typeof L=="string"){const H=B6(L);L=M.blockCursor=H}L!==void 0&&W.classList.add(...L)}return W})(P._config)),R.style.caretColor="transparent",void(ie===null?q.appendChild(D):q.insertBefore(D,ie))}}D!==null&&q_(D,P,R)})(e,n,l)}finally{y!==null&&y.observe(n,z4),ea=p,Zs=d}}v!==null&&(function(P,R,T,D,I){const V=Array.from(P._listeners.mutation),X=V.length;for(let Z=0;Z<X;Z++){const[ie,q]=V[Z];for(const ne of q){const M=R.get(ne);M!==void 0&&ie(M,{dirtyLeaves:D,prevEditorState:I,updateTags:T})}}})(e,v,k,_,a),Nt(l)||l===null||i!==null&&i.is(l)||e.dispatchCommand(Q6,void 0);const A=e._pendingDecorators;A!==null&&(e._decorators=A,e._pendingDecorators=null,Rm("decorator",e,!0,A)),(function(P,R,T){const D=Q4(R),I=Q4(T);D!==I&&Rm("textcontent",P,!0,I)})(e,t||a,r),Rm("update",e,!0,{dirtyElements:b,dirtyLeaves:_,editorState:r,mutatedNodes:v,normalizedNodes:E,prevEditorState:t||a,tags:k}),(function(P,R){if(P._deferred=[],R.length!==0){const T=P._updating;P._updating=!0;try{for(let D=0;D<R.length;D++)R[D]()}finally{P._updating=T}}})(e,w),(function(P){const R=P._updates;if(R.length!==0){const T=R.shift();if(T){const[D,I]=T;Wy(P,D,I)}}})(e)}function Rm(e,t,r,...n){const s=t._updating;t._updating=r;try{const a=Array.from(t._listeners[e]);for(let i=0;i<a.length;i++)a[i].apply(null,n)}finally{t._updating=s}}function K4(e,t){const r=e._updates;let n=t||!1;for(;r.length!==0;){const s=r.shift();if(s){const[a,i]=s,l=e._pendingEditorState;let c;i!==void 0&&(c=i.onUpdate,i.skipTransforms&&(n=!0),i.discrete&&(l===null&&Rt(191),l._flushSync=!0),c&&e._deferred.push(c),EA(e,i.tag)),l==null?Wy(e,a,i):a()}}return n}function Wy(e,t,r){const n=e._updateTags;let s,a=!1,i=!1;r!==void 0&&(s=r.onUpdate,EA(e,r.tag),a=r.skipTransforms||!1,i=r.discrete||!1),s&&e._deferred.push(s);const l=e._editorState;let c=e._pendingEditorState,d=!1;(c===null||c._readOnly)&&(c=e._pendingEditorState=NA(c||l),d=!0),c._flushSync=i;const f=Zs,p=Si,g=ea,y=e._updating;Zs=c,Si=!1,e._updating=!0,ea=e;const v=e._headless||e.getRootElement()===null;Fb(null);try{d&&(v?l._selection!==null&&(c._selection=l._selection.clone()):c._selection=(function(k,w){const N=k.getEditorState()._selection,A=qo(xo(k));return Nt(N)||N==null?Cb(N,A,k,w):N.clone()})(e,r&&r.event||null));const b=e._compositionKey;t(),a=K4(e,a),(function(k,w){const N=w.getEditorState()._selection,A=k._selection;if(Nt(A)){const P=A.anchor,R=A.focus;let T;if(P.type==="text"&&(T=P.getNode(),T.selectionTransform(N,A)),R.type==="text"){const D=R.getNode();T!==D&&D.selectionTransform(N,A)}}})(c,e),e._dirtyType!==Zd&&(a?(function(k,w){const N=w._dirtyLeaves,A=k._nodeMap;for(const P of N){const R=A.get(P);qt(R)&&R.isAttached()&&R.isSimpleText()&&!R.isUnmergeable()&&S4(R)}})(c,e):(function(k,w){const N=w._dirtyLeaves,A=w._dirtyElements,P=k._nodeMap,R=Cu(),T=new Map;let D=N,I=D.size,V=A,X=V.size;for(;I>0||X>0;){if(I>0){w._dirtyLeaves=new Set;for(const Z of D){const ie=P.get(Z);qt(ie)&&ie.isAttached()&&ie.isSimpleText()&&!ie.isUnmergeable()&&S4(ie),ie!==void 0&&G4(ie,R)&&H4(w,ie,T),N.add(Z)}if(D=w._dirtyLeaves,I=D.size,I>0){R1++;continue}}w._dirtyLeaves=new Set,w._dirtyElements=new Map,V.delete("root")&&V.set("root",!0);for(const Z of V){const ie=Z[0],q=Z[1];if(A.set(ie,q),!q)continue;const ne=P.get(ie);ne!==void 0&&G4(ne,R)&&H4(w,ne,T)}D=w._dirtyLeaves,I=D.size,V=w._dirtyElements,X=V.size,R1++}w._dirtyLeaves=N,w._dirtyElements=A})(c,e),K4(e),(function(k,w,N,A){const P=k._nodeMap,R=w._nodeMap,T=[];for(const[D]of A){const I=R.get(D);I!==void 0&&(I.isAttached()||(vt(I)&&$6(I,D,P,R,T,A),P.has(D)||A.delete(D),T.push(D)))}for(const D of T)R.delete(D);for(const D of N){const I=R.get(D);I===void 0||I.isAttached()||(P.has(D)||N.delete(D),R.delete(D))}})(l,c,e._dirtyLeaves,e._dirtyElements)),b!==e._compositionKey&&(c._flushSync=!0);const E=c._selection;if(Nt(E)){const k=c._nodeMap,w=E.anchor.key,N=E.focus.key;k.get(w)!==void 0&&k.get(N)!==void 0||Rt(19)}else Pa(E)&&E._nodes.size===0&&(c._selection=null)}catch(b){return b instanceof Error&&e._onError(b),e._pendingEditorState=l,e._dirtyType=i0,e._cloneNotNeeded.clear(),e._dirtyLeaves=new Set,e._dirtyElements.clear(),void pc(e)}finally{Zs=f,Si=p,ea=g,e._updating=y,R1=0}e._dirtyType!==Zd||e._deferred.length>0||(function(b,E){const k=E.getEditorState()._selection,w=b._selection;if(w!==null){if(w.dirty||!w.is(k))return!0}else if(k!==null)return!0;return!1})(c,e)?c._flushSync?(c._flushSync=!1,pc(e)):d&&WB((()=>{pc(e)})):(c._flushSync=!1,d&&(n.clear(),e._deferred=[],e._pendingEditorState=null))}function Mi(e,t,r){ea===e&&r===void 0?t():Wy(e,t,r)}class Dm{constructor(t,r,n){this.element=t,this.before=r||null,this.after=n||null}withBefore(t){return new Dm(this.element,t,this.after)}withAfter(t){return new Dm(this.element,this.before,t)}withElement(t){return this.element===t?this:new Dm(t,this.before,this.after)}insertChild(t){const r=this.before||this.getManagedLineBreak();return r!==null&&r.parentElement!==this.element&&Rt(222),this.element.insertBefore(t,r),this}removeChild(t){return t.parentElement!==this.element&&Rt(223),this.element.removeChild(t),this}replaceChild(t,r){return r.parentElement!==this.element&&Rt(224),this.element.replaceChild(t,r),this}getFirstChild(){const t=this.after?this.after.nextSibling:this.element.firstChild;return t===this.before||t===this.getManagedLineBreak()?null:t}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(t){if(t===null)this.removeManagedLineBreak();else{const r=t==="decorator"&&(a0||Zm);this.insertManagedLineBreak(r)}}removeManagedLineBreak(){const t=this.getManagedLineBreak();if(t){const r=this.element,n=t.nodeName==="IMG"?t.nextSibling:null;n&&r.removeChild(n),r.removeChild(t),r.__lexicalLineBreak=void 0}}insertManagedLineBreak(t){const r=this.getManagedLineBreak();if(r){if(t===(r.nodeName==="IMG"))return;this.removeManagedLineBreak()}const n=this.element,s=this.before,a=document.createElement("br");if(n.insertBefore(a,s),t){const i=document.createElement("img");i.setAttribute("data-lexical-linebreak","true"),i.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",i.alt="",n.insertBefore(i,a),n.__lexicalLineBreak=i}else n.__lexicalLineBreak=a}getFirstChildOffset(){let t=0;for(let r=this.after;r!==null;r=r.previousSibling)t++;return t}resolveChildIndex(t,r,n,s){if(n===this.element){const c=this.getFirstChildOffset();return[t,Math.min(c+t.getChildrenSize(),Math.max(c,s))]}const a=q4(r,n);a.push(s);const i=q4(r,this.element);let l=t.getIndexWithinParent();for(let c=0;c<i.length;c++){const d=a[c],f=i[c];if(d===void 0||d<f)break;if(d>f){l+=1;break}}return[t.getParentOrThrow(),l]}}function q4(e,t){const r=[];let n=t;for(;n!==e&&n!==null;n=n.parentNode){let s=0;for(let a=n.previousSibling;a!==null;a=a.previousSibling)s++;r.push(s)}return n!==e&&Rt(225),r.reverse()}class $a extends w0{constructor(t){super(t),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(t){super.afterCloneFrom(t),this.__key===t.__key&&(this.__first=t.__first,this.__last=t.__last,this.__size=t.__size),this.__indent=t.__indent,this.__format=t.__format,this.__style=t.__style,this.__dir=t.__dir,this.__textFormat=t.__textFormat,this.__textStyle=t.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const t=this.getFormat();return qL[t]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const t=[];let r=this.getFirstChild();for(;r!==null;)t.push(r),r=r.getNextSibling();return t}getChildrenKeys(){const t=[];let r=this.getFirstChild();for(;r!==null;)t.push(r.__key),r=r.getNextSibling();return t}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const t=Xn()._dirtyElements;return t!==null&&t.has(this.__key)}isLastChild(){const t=this.getLatest(),r=this.getParentOrThrow().getLastChild();return r!==null&&r.is(t)}getAllTextNodes(){const t=[];let r=this.getFirstChild();for(;r!==null;){if(qt(r)&&t.push(r),vt(r)){const n=r.getAllTextNodes();t.push(...n)}r=r.getNextSibling()}return t}getFirstDescendant(){let t=this.getFirstChild();for(;vt(t);){const r=t.getFirstChild();if(r===null)break;t=r}return t}getLastDescendant(){let t=this.getLastChild();for(;vt(t);){const r=t.getLastChild();if(r===null)break;t=r}return t}getDescendantByIndex(t){const r=this.getChildren(),n=r.length;if(t>=n){const a=r[n-1];return vt(a)&&a.getLastDescendant()||a||null}const s=r[t];return vt(s)&&s.getFirstDescendant()||s||null}getFirstChild(){const t=this.getLatest().__first;return t===null?null:Fs(t)}getFirstChildOrThrow(){const t=this.getFirstChild();return t===null&&Rt(45,this.__key),t}getLastChild(){const t=this.getLatest().__last;return t===null?null:Fs(t)}getLastChildOrThrow(){const t=this.getLastChild();return t===null&&Rt(96,this.__key),t}getChildAtIndex(t){const r=this.getChildrenSize();let n,s;if(t<r/2){for(n=this.getFirstChild(),s=0;n!==null&&s<=t;){if(s===t)return n;n=n.getNextSibling(),s++}return null}for(n=this.getLastChild(),s=r-1;n!==null&&s>=t;){if(s===t)return n;n=n.getPreviousSibling(),s--}return null}getTextContent(){let t="";const r=this.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];t+=a.getTextContent(),vt(a)&&s!==n-1&&!a.isInline()&&(t+=Cc)}return t}getTextContentSize(){let t=0;const r=this.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];t+=a.getTextContentSize(),vt(a)&&s!==n-1&&!a.isInline()&&(t+=Cc.length)}return t}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(t){if(t!==""){const r=m4[t];return!!(this.getFormat()&r)}return!1}hasTextFormat(t){const r=ef[t];return!!(this.getTextFormat()&r)}getFormatFlags(t,r){return sy(this.getLatest().__textFormat,t,r)}getTextStyle(){return this.getLatest().__textStyle}select(t,r){va();const n=Kt();let s=t,a=r;const i=this.getChildrenSize();if(!this.canBeEmpty()){if(t===0&&r===0){const c=this.getFirstChild();if(qt(c)||vt(c))return c.select(0,0)}else if(!(t!==void 0&&t!==i||r!==void 0&&r!==i)){const c=this.getLastChild();if(qt(c)||vt(c))return c.select()}}s===void 0&&(s=i),a===void 0&&(a=i);const l=this.__key;return Nt(n)?(n.anchor.set(l,s,"element"),n.focus.set(l,a,"element"),n.dirty=!0,n):SA(l,s,l,a,"element","element")}selectStart(){const t=this.getFirstDescendant();return t?t.selectStart():this.select()}selectEnd(){const t=this.getLastDescendant();return t?t.selectEnd():this.select()}clear(){const t=this.getWritable();return this.getChildren().forEach((r=>r.remove())),t}append(...t){return this.splice(this.getChildrenSize(),0,t)}setDirection(t){const r=this.getWritable();return r.__dir=t,r}setFormat(t){return this.getWritable().__format=t!==""?m4[t]:0,this}setStyle(t){return this.getWritable().__style=t||"",this}setTextFormat(t){const r=this.getWritable();return r.__textFormat=t,r}setTextStyle(t){const r=this.getWritable();return r.__textStyle=t,r}setIndent(t){return this.getWritable().__indent=t,this}splice(t,r,n){const s=n.length,a=this.getChildrenSize(),i=this.getWritable();t+r<=a||Rt(226,String(t),String(r),String(a));const l=i.__key,c=[],d=[],f=this.getChildAtIndex(t+r);let p=null,g=a-r+s;if(t!==0)if(t===a)p=this.getLastChild();else{const v=this.getChildAtIndex(t);v!==null&&(p=v.getPreviousSibling())}if(r>0){let v=p===null?this.getFirstChild():p.getNextSibling();for(let _=0;_<r;_++){v===null&&Rt(100);const b=v.getNextSibling(),E=v.__key;Gd(v.getWritable()),d.push(E),v=b}}let y=p;for(let v=0;v<s;v++){const _=n[v];y!==null&&_.is(y)&&(p=y=y.getPreviousSibling());const b=_.getWritable();b.__parent===l&&g--,Gd(b);const E=_.__key;if(y===null)i.__first=E,b.__prev=null;else{const k=y.getWritable();k.__next=E,b.__prev=k.__key}_.__key===l&&Rt(76),b.__parent=l,c.push(E),y=_}if(t+r===a)y!==null&&(y.getWritable().__next=null,i.__last=y.__key);else if(f!==null){const v=f.getWritable();if(y!==null){const _=y.getWritable();v.__prev=y.__key,_.__next=f.__key}else v.__prev=null}if(i.__size=g,d.length){const v=Kt();if(Nt(v)){const _=new Set(d),b=new Set(c),{anchor:E,focus:k}=v;X4(E,_,b)&&ry(E,E.getNode(),this,p,f),X4(k,_,b)&&ry(k,k.getNode(),this,p,f),g!==0||this.canBeEmpty()||ii(this)||this.remove()}}return i}getDOMSlot(t){return new Dm(t)}exportDOM(t){const{element:r}=super.exportDOM(t);if(Mn(r)){const n=this.getIndent();n>0&&(r.style.paddingInlineStart=40*n+"px");const s=this.getDirection();s&&(r.dir=s)}return{element:r}}exportJSON(){const t={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},r=this.getTextFormat(),n=this.getTextStyle();return r!==0&&(t.textFormat=r),n!==""&&(t.textStyle=n),t}updateFromJSON(t){return super.updateFromJSON(t).setFormat(t.format).setIndent(t.indent).setDirection(t.direction).setTextFormat(t.textFormat||0).setTextStyle(t.textStyle||"")}insertNewAfter(t,r){return null}canIndent(){return!0}collapseAtStart(t){return!1}excludeFromCopy(t){return!1}canReplaceWith(t){return!0}canInsertAfter(t){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(t){return!1}extractWithChild(t,r,n){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(t,r){const n=this.getDOMSlot(t);let s=n.getFirstChild();for(let a=this.getFirstChild();a;a=a.getNextSibling()){const i=r.getElementByKey(a.getKey());i!==null&&(s==null?(n.insertChild(i),s=i):s!==i&&n.replaceChild(i,s),s=s.nextSibling)}}}function vt(e){return e instanceof $a}function X4(e,t,r){let n=e.getNode();for(;n;){const s=n.__key;if(t.has(s)&&!r.has(s))return!0;n=n.getParent()}return!1}class Eb extends w0{decorate(t,r){Rt(47)}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}}function nn(e){return e instanceof Eb}class Pp extends $a{static getType(){return"root"}static clone(){return new Pp}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){Rt(51)}getTextContent(){const t=this.__cachedText;return!Fp()&&Xn()._dirtyType!==Zd||t===null?super.getTextContent():t}remove(){Rt(52)}replace(t){Rt(53)}insertBefore(t){Rt(54)}insertAfter(t){Rt(55)}updateDOM(t,r){return!1}splice(t,r,n){for(const s of n)vt(s)||nn(s)||Rt(282);return super.splice(t,r,n)}static importJSON(t){return zn().updateFromJSON(t)}collapseAtStart(){return!0}}function Ws(e){return e instanceof Pp}function NA(e){return new zy(new Map(e._nodeMap))}function Nb(){return new zy(new Map([["root",new Pp]]))}function AA(e){const t=e.exportJSON(),r=e.constructor;if(t.type!==r.getType()&&Rt(130,r.name),vt(e)){const n=t.children;Array.isArray(n)||Rt(59,r.name);const s=e.getChildren();for(let a=0;a<s.length;a++){const i=AA(s[a]);n.push(i)}}return t}class zy{constructor(t,r){this._nodeMap=t,this._selection=r||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(t,r){return V4(r&&r.editor||null,this,t)}clone(t){const r=new zy(this._nodeMap,t===void 0?this._selection:t);return r._readOnly=!0,r}toJSON(){return V4(null,this,(()=>({root:AA(zn())})))}}const ny="historic",DB="history-push",Im="history-merge",IB="paste",jA="collaboration",MB="skip-scroll-into-view",OB="skip-dom-selection";class Ab extends $a{static getType(){return"artificial"}createDOM(t){return document.createElement("div")}}class Rp extends $a{static getType(){return"paragraph"}static clone(t){return new Rp(t.__key)}createDOM(t){const r=document.createElement("p"),n=Xh(t.theme,"paragraph");return n!==void 0&&r.classList.add(...n),r}updateDOM(t,r,n){return!1}static importDOM(){return{p:t=>({conversion:LB,priority:0})}}exportDOM(t){const{element:r}=super.exportDOM(t);if(Mn(r)){this.isEmpty()&&r.append(document.createElement("br"));const n=this.getFormatType();n&&(r.style.textAlign=n)}return{element:r}}static importJSON(t){return In().updateFromJSON(t)}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),textStyle:this.getTextStyle()}}insertNewAfter(t,r){const n=In();n.setTextFormat(t.format),n.setTextStyle(t.style);const s=this.getDirection();return n.setDirection(s),n.setFormat(this.getFormatType()),n.setStyle(this.getStyle()),this.insertAfter(n,r),n}collapseAtStart(){const t=this.getChildren();if(t.length===0||qt(t[0])&&t[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}}function LB(e){const t=In();return e.style&&(t.setFormat(e.style.textAlign),$b(e,t)),{node:t}}function In(){return li(new Rp)}function jb(e){return e instanceof Rp}const qr=0,Ph=1,BB=4;function FA(e,t,r,n){const s=e._keyToDOMMap;s.clear(),e._editorState=Nb(),e._pendingEditorState=n,e._compositionKey=null,e._dirtyType=Zd,e._cloneNotNeeded.clear(),e._dirtyLeaves=new Set,e._dirtyElements.clear(),e._normalizedNodes=new Set,e._updateTags=new Set,e._updates=[],e._blockCursorElement=null;const a=e._observer;a!==null&&(a.disconnect(),e._observer=null),t!==null&&(t.textContent=""),r!==null&&(r.textContent="",s.set("root",r))}function UB(e){const t=e||{},r=PB(),n=t.theme||{},s=e===void 0?r:t.parentEditor||null,a=t.disableEvents||!1,i=Nb(),l=t.namespace||(s!==null?s._config.namespace:BA()),c=t.editorState,d=[Pp,Vu,Ap,jp,Rp,Ab,...t.nodes||[]],{onError:f,html:p}=t,g=t.editable===void 0||t.editable;let y;if(e===void 0&&r!==null)y=r._nodes;else{y=new Map;for(let _=0;_<d.length;_++){let b=d[_],E=null,k=null;if(typeof b!="function"){const R=b;b=R.replace,E=R.with,k=R.withKlass||null}const{ownNodeConfig:w}=Wb(b),N=b.getType(),A=b.transform(),P=new Set;w&&w.$transform&&P.add(w.$transform),A!==null&&P.add(A),y.set(N,{exportDOM:p&&p.export?p.export.get(b):void 0,klass:b,replace:E,replaceWithKlass:k,sharedNodeState:rB(d[_]),transforms:P})}}const v=new Hy(i,s,y,{disableEvents:a,namespace:l,theme:n},f||console.error,(function(_,b){const E=new Map,k=new Set,w=N=>{Object.keys(N).forEach((A=>{let P=E.get(A);P===void 0&&(P=[],E.set(A,P)),P.push(N[A])}))};return _.forEach((N=>{const A=N.klass.importDOM;if(A==null||k.has(A))return;k.add(A);const P=A.call(N.klass);P!==null&&w(P)})),b&&w(b),E})(y,p?p.import:void 0),g,e);return c!==void 0&&(v._pendingEditorState=c,v._dirtyType=i0),v}class Hy{constructor(t,r,n,s,a,i,l,c){this._createEditorArgs=c,this._parentEditor=r,this._rootElement=null,this._editorState=t,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=s,this._nodes=n,this._decorators={},this._pendingDecorators=null,this._dirtyType=Zd,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=BA(),this._onError=a,this._htmlConversions=i,this._editable=l,this._headless=r!==null&&r._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(t){const r=this._listeners.update;return r.add(t),()=>{r.delete(t)}}registerEditableListener(t){const r=this._listeners.editable;return r.add(t),()=>{r.delete(t)}}registerDecoratorListener(t){const r=this._listeners.decorator;return r.add(t),()=>{r.delete(t)}}registerTextContentListener(t){const r=this._listeners.textcontent;return r.add(t),()=>{r.delete(t)}}registerRootListener(t){const r=this._listeners.root;return t(this._rootElement,null),r.add(t),()=>{t(null,this._rootElement),r.delete(t)}}registerCommand(t,r,n){n===void 0&&Rt(35);const s=this._commands;s.has(t)||s.set(t,[new Set,new Set,new Set,new Set,new Set]);const a=s.get(t);a===void 0&&Rt(36,String(t));const i=a[n];return i.add(r),()=>{i.delete(r),a.every((l=>l.size===0))&&s.delete(t)}}registerMutationListener(t,r,n){const s=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(t)).klass,a=this._listeners.mutation;let i=a.get(r);i===void 0&&(i=new Set,a.set(r,i)),i.add(s);const l=n&&n.skipInitialization;return l!==void 0&&l||this.initializeMutationListener(r,s),()=>{i.delete(s),i.size===0&&a.delete(r)}}getRegisteredNode(t){const r=this._nodes.get(t.getType());return r===void 0&&Rt(37,t.name),r}resolveRegisteredNodeAfterReplacements(t){for(;t.replaceWithKlass;)t=this.getRegisteredNode(t.replaceWithKlass);return t}initializeMutationListener(t,r){const n=this._editorState,s=sE(n).get(r.getType());if(!s)return;const a=new Map;for(const i of s.keys())a.set(i,"created");a.size>0&&t(a,{dirtyLeaves:new Set,prevEditorState:n,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(t,r){const n=this.getRegisteredNode(t);return n.transforms.add(r),n}registerNodeTransform(t,r){const n=this.registerNodeTransformToKlass(t,r),s=[n],a=n.replaceWithKlass;if(a!=null){const i=this.registerNodeTransformToKlass(a,r);s.push(i)}return(function(i,l){const c=sE(i.getEditorState()),d=[];for(const f of l){const p=c.get(f);p&&d.push(p)}d.length!==0&&i.update((()=>{for(const f of d)for(const p of f.keys()){const g=Fs(p);g&&g.markDirty()}}),i._pendingEditorState===null?{tag:Im}:void 0)})(this,s.map((i=>i.klass.getType()))),()=>{s.forEach((i=>i.transforms.delete(r)))}}hasNode(t){return this._nodes.has(t.getType())}hasNodes(t){return t.every(this.hasNode.bind(this))}dispatchCommand(t,r){return nr(this,t,r)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(t){const r=this._rootElement;if(t!==r){const n=Xh(this._config.theme,"root"),s=this._pendingEditorState||this._editorState;if(this._rootElement=t,FA(this,r,t,s),r!==null&&(this._config.disableEvents||wB(r),n!=null&&r.classList.remove(...n)),t!==null){const a=Bb(t),i=t.style;i.userSelect="text",i.whiteSpace="pre-wrap",i.wordBreak="break-word",t.setAttribute("data-lexical-editor","true"),this._window=a,this._dirtyType=i0,H6(this),this._updateTags.add(Im),pc(this),this._config.disableEvents||(function(l,c){const d=l.ownerDocument,f=ey.get(d);(f===void 0||f<1)&&d.addEventListener("selectionchange",yA),ey.set(d,(f||0)+1),l.__lexicalEditor=c;const p=xA(l);for(let g=0;g<B_.length;g++){const[y,v]=B_[g],_=typeof v=="function"?b=>{j4(b)||(A4(b),(c.isEditable()||y==="click")&&v(b,c))}:b=>{if(j4(b))return;A4(b);const E=c.isEditable();switch(y){case"cut":return E&&nr(c,bb,b);case"copy":return nr(c,Ly,b);case"paste":return E&&nr(c,vb,b);case"dragstart":return E&&nr(c,cA,b);case"dragover":return E&&nr(c,uA,b);case"dragend":return E&&nr(c,gB,b);case"focus":return E&&nr(c,xB,b);case"blur":return E&&nr(c,yB,b);case"drop":return E&&nr(c,oA,b)}};l.addEventListener(y,_),p.push((()=>{l.removeEventListener(y,_)}))}})(t,this),n!=null&&t.classList.add(...n)}else this._window=null,this._updateTags.add(Im),pc(this);Rm("root",this,!1,t,r)}}getElementByKey(t){return this._keyToDOMMap.get(t)||null}getEditorState(){return this._editorState}setEditorState(t,r){t.isEmpty()&&Rt(38);let n=t;n._readOnly&&(n=NA(t),n._selection=t._selection?t._selection.clone():null),z6(this);const s=this._pendingEditorState,a=this._updateTags,i=r!==void 0?r.tag:null;s===null||s.isEmpty()||(i!=null&&a.add(i),pc(this)),this._pendingEditorState=n,this._dirtyType=i0,this._dirtyElements.set("root",!1),this._compositionKey=null,i!=null&&a.add(i),this._updating||pc(this)}parseEditorState(t,r){return(function(n,s,a){const i=Nb(),l=Zs,c=Si,d=ea,f=s._dirtyElements,p=s._dirtyLeaves,g=s._cloneNotNeeded,y=s._dirtyType;s._dirtyElements=new Map,s._dirtyLeaves=new Set,s._cloneNotNeeded=new Set,s._dirtyType=0,Zs=i,Si=!1,ea=s,Fb(null);try{const v=s._nodes;Tb(n.root,v),a&&a(),i._readOnly=!0}catch(v){v instanceof Error&&s._onError(v)}finally{s._dirtyElements=f,s._dirtyLeaves=p,s._cloneNotNeeded=g,s._dirtyType=y,Zs=l,Si=c,ea=d}return i})(typeof t=="string"?JSON.parse(t):t,this,r)}read(t){return pc(this),this.getEditorState().read(t,{editor:this})}update(t,r){(function(n,s,a){n._updating?n._updates.push([s,a]):Wy(n,s,a)})(this,t,r)}focus(t,r={}){const n=this._rootElement;n!==null&&(n.setAttribute("autocapitalize","off"),Mi(this,(()=>{const s=Kt(),a=zn();s!==null?s.dirty||Sa(s.clone()):a.getChildrenSize()!==0&&(r.defaultSelection==="rootStart"?a.selectStart():a.selectEnd()),KB("focus"),qB((()=>{n.removeAttribute("autocapitalize"),t&&t()}))})),this._pendingEditorState===null&&n.removeAttribute("autocapitalize"))}blur(){const t=this._rootElement;t!==null&&t.blur();const r=qo(this._window);r!==null&&r.removeAllRanges()}isEditable(){return this._editable}setEditable(t){this._editable!==t&&(this._editable=t,Rm("editable",this,!0,t))}toJSON(){return{editorState:this._editorState.toJSON()}}}Hy.version="0.35.0+prod.esm";let G_=null;function Fb(e){G_=e}let $B=1;function PA(e,t){const r=Pb(e,t);return r===void 0&&Rt(30,t),r}function Pb(e,t){return e._nodes.get(t)}const WB=typeof queueMicrotask=="function"?queueMicrotask:e=>{Promise.resolve().then(e)};function Y4(e){return nn(Ou(e))}function Rb(e){const t=document.activeElement;if(!Mn(t))return!1;const r=t.nodeName;return nn(Ou(e))&&(r==="INPUT"||r==="TEXTAREA"||t.contentEditable==="true"&&Gy(t)==null)}function Dp(e,t,r){const n=e.getRootElement();try{return n!==null&&n.contains(t)&&n.contains(r)&&t!==null&&!Rb(t)&&RA(t)===e}catch{return!1}}function Db(e){return e instanceof Hy}function RA(e){let t=e;for(;t!=null;){const r=Gy(t);if(Db(r))return r;t=Ip(t)}return null}function Gy(e){return e?e.__lexicalEditor:null}function Hd(e){return By(e)||e.isToken()}function gc(e){return Hd(e)||e.isSegmented()}function Nc(e){return S0(e)&&e.nodeType===BL}function zB(e){return S0(e)&&e.nodeType===UL}function o0(e){let t=e;for(;t!=null;){if(Nc(t))return t;t=t.firstChild}return null}function sy(e,t,r){const n=ef[t];if(r!==null&&(e&n)==(r&n))return e;let s=e^n;return t==="subscript"?s&=-65:t==="superscript"?s&=-33:t==="lowercase"?(s&=-513,s&=-1025):t==="uppercase"?(s&=-257,s&=-1025):t==="capitalize"&&(s&=-257,s&=-513),s}function DA(e){return qt(e)||vc(e)||nn(e)}function HB(e,t){const r=(function(){const i=G_;return G_=null,i})();if((t=t||r&&r.__key)!=null)return void(e.__key=t);va(),CA();const n=Xn(),s=Ku(),a=""+$B++;s._nodeMap.set(a,e),vt(e)?n._dirtyElements.set(a,!0):n._dirtyLeaves.add(a),n._cloneNotNeeded.add(a),n._dirtyType=U6,e.__key=a}function Gd(e){const t=e.getParent();if(t!==null){const r=e.getWritable(),n=t.getWritable(),s=e.getPreviousSibling(),a=e.getNextSibling(),i=a!==null?a.__key:null,l=s!==null?s.__key:null,c=s!==null?s.getWritable():null,d=a!==null?a.getWritable():null;s===null&&(n.__first=i),a===null&&(n.__last=l),c!==null&&(c.__next=i),d!==null&&(d.__prev=l),r.__prev=null,r.__next=null,r.__parent=null,n.__size--}}function ay(e){CA();const t=e.getLatest(),r=t.__parent,n=Ku(),s=Xn(),a=n._nodeMap,i=s._dirtyElements;r!==null&&(function(c,d,f){let p=c;for(;p!==null;){if(f.has(p))return;const g=d.get(p);if(g===void 0)break;f.set(p,!1),p=g.__parent}})(r,a,i);const l=t.__key;s._dirtyType=U6,vt(e)?i.set(l,!0):s._dirtyLeaves.add(l)}function wa(e){va();const t=Xn(),r=t._compositionKey;if(e!==r){if(t._compositionKey=e,r!==null){const n=Fs(r);n!==null&&n.getWritable()}if(e!==null){const n=Fs(e);n!==null&&n.getWritable()}}}function Cu(){return Fp()?null:Xn()._compositionKey}function Fs(e,t){const r=(t||Ku())._nodeMap.get(e);return r===void 0?null:r}function IA(e,t){const r=Vy(e,Xn());return r!==void 0?Fs(r,t):null}function Vy(e,t){return e[`__lexicalKey_${t._key}`]}function Ou(e,t){let r=e;for(;r!=null;){const n=IA(r,t);if(n!==null)return n;r=Ip(r)}return null}function MA(e){const t=e._decorators,r=Object.assign({},t);return e._pendingDecorators=r,r}function Q4(e){return e.read((()=>zn().getTextContent()))}function zn(){return OA(Ku())}function OA(e){return e._nodeMap.get("root")}function Sa(e){va();const t=Ku();e!==null&&(e.dirty=!0,e.setCachedNodes(null)),t._selection=e}function Wh(e){const t=Xn(),r=(function(n,s){let a=n;for(;a!=null;){const i=Vy(a,s);if(i!==void 0)return i;a=Ip(a)}return null})(e,t);return r===null?e===t.getRootElement()?Fs("root"):null:Fs(r)}function LA(e){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(e)}function Ib(e){const t=[];let r=e;for(;r!==null;)t.push(r),r=r._parentEditor;return t}function BA(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function UA(e){return Nc(e)?e.nodeValue:null}function Mb(e,t,r){const n=qo(xo(t));if(n===null)return;const s=n.anchorNode;let{anchorOffset:a,focusOffset:i}=n;if(s!==null){let l=UA(s);const c=Ou(s);if(l!==null&&qt(c)){if(l===My&&r){const d=r.length;l=r,a=d,i=d}l!==null&&Ob(c,l,a,i,e)}}}function Ob(e,t,r,n,s){let a=e;if(a.isAttached()&&(s||!a.isDirty())){const i=a.isComposing();let l=t;(i||s)&&t[t.length-1]===My&&(l=t.slice(0,-1));const c=a.getTextContent();if(s||l!==c){if(l===""){if(wa(null),Zm||a0||G1)a.remove();else{const _=Xn();setTimeout((()=>{_.update((()=>{a.isAttached()&&a.remove()}))}),20)}return}const d=a.getParent(),f=b0(),p=a.getTextContentSize(),g=Cu(),y=a.getKey();if(a.isToken()||g!==null&&y===g&&!i||Nt(f)&&(d!==null&&!d.canInsertTextBefore()&&f.anchor.offset===0||f.anchor.key===e.__key&&f.anchor.offset===0&&!a.canInsertTextBefore()&&!i||f.focus.key===e.__key&&f.focus.offset===p&&!a.canInsertTextAfter()&&!i))return void a.markDirty();const v=Kt();if(!Nt(v)||r===null||n===null)return void J4(a,l,v);if(v.setTextNodeRange(a,r,a,n),a.isSegmented()){const _=rs(a.getTextContent());a.replace(_),a=_}J4(a,l,v)}}}function J4(e,t,r){if(e.setTextContent(t),Nt(r)){const n=e.getKey();for(const s of["anchor","focus"]){const a=r[s];a.type==="text"&&a.key===n&&(a.offset=Pu(e,a.offset,"clamp"))}}}function u1(e,t,r){const n=t[r]||!1;return n==="any"||n===e[r]}function GB(e,t){return u1(e,t,"altKey")&&u1(e,t,"ctrlKey")&&u1(e,t,"shiftKey")&&u1(e,t,"metaKey")}function fn(e,t,r){return GB(e,r)&&e.key.toLowerCase()===t.toLowerCase()}const hc={ctrlKey:!Sl,metaKey:Sl},Z4={altKey:Sl,ctrlKey:!Sl};function eE(e){return e.key==="Backspace"}function tE(e){return fn(e,"a",hc)}function VB(e){const t=zn();if(Nt(e)){const r=e.anchor,n=e.focus,s=r.getNode().getTopLevelElementOrThrow().getParentOrThrow();return r.set(s.getKey(),0,"element"),n.set(s.getKey(),s.getChildrenSize(),"element"),q1(e),e}{const r=t.select(0,t.getChildrenSize());return Sa(q1(r)),r}}function Xh(e,t){e.__lexicalClassNameCache===void 0&&(e.__lexicalClassNameCache={});const r=e.__lexicalClassNameCache,n=r[t];if(n!==void 0)return n;const s=e[t];if(typeof s=="string"){const a=B6(s);return r[t]=a,a}return s}function Lb(e,t,r,n,s){if(r.size===0)return;const a=n.__type,i=n.__key,l=t.get(a);l===void 0&&Rt(33,a);const c=l.klass;let d=e.get(c);d===void 0&&(d=new Map,e.set(c,d));const f=d.get(i),p=f==="destroyed"&&s==="created";(f===void 0||p)&&d.set(i,p?"updated":s)}function rE(e,t,r){const n=e.getParent();let s=r,a=e;return n!==null&&(t&&r===0?(s=a.getIndexWithinParent(),a=n):t||r!==a.getChildrenSize()||(s=a.getIndexWithinParent()+1,a=n)),a.getChildAtIndex(t?s-1:s)}function V_(e,t){const r=e.offset;if(e.type==="element")return rE(e.getNode(),t,r);{const n=e.getNode();if(t&&r===0||!t&&r===n.getTextContentSize()){const s=t?n.getPreviousSibling():n.getNextSibling();return s===null?rE(n.getParentOrThrow(),t,n.getIndexWithinParent()+(t?0:1)):s}}return null}function $A(e){const t=xo(e).event,r=t&&t.inputType;return r==="insertFromPaste"||r==="insertFromPasteAsQuotation"}function nr(e,t,r){return(function(n,s,a){const i=Ib(n);for(let l=4;l>=0;l--)for(let c=0;c<i.length;c++){const d=i[c],f=d._commands.get(s);if(f!==void 0){const p=f[l];if(p!==void 0){const g=Array.from(p),y=g.length;let v=!1;if(Mi(d,(()=>{for(let _=0;_<y;_++)if(g[_](a,n))return void(v=!0)})),v)return v}}}return!1})(e,t,r)}function Ky(e){return!Ws(e)&&!e.isLastChild()&&!e.isInline()}function nf(e,t){const r=e._keyToDOMMap.get(t);return r===void 0&&Rt(75,t),r}function Ip(e){const t=e.assignedSlot||e.parentElement;return X_(t)?t.host:t}function WA(e){return zB(e)?e:Mn(e)?e.ownerDocument:null}function KB(e){va(),Xn()._updateTags.add(e)}function qB(e){va(),Xn()._deferred.push(e)}function K_(e,t){let r=e.getParent();for(;r!==null;){if(r.is(t))return!0;r=r.getParent()}return!1}function Bb(e){const t=WA(e);return t?t.defaultView:null}function xo(e){const t=e._window;return t===null&&Rt(78),t}function XB(e){return vt(e)&&e.isInline()||nn(e)&&e.isInline()}function YB(e){let t=e.getParentOrThrow();for(;t!==null;){if(ii(t))return t;t=t.getParentOrThrow()}return t}function ii(e){return Ws(e)||vt(e)&&e.isShadowRoot()}function li(e){const t=Xn(),r=e.getType(),n=Pb(t,r);n===void 0&&Rt(200,e.constructor.name,r);const{replace:s,replaceWithKlass:a}=n;if(s!==null){const i=s(e),l=i.constructor;return a!==null?i instanceof a||Rt(201,a.name,a.getType(),l.name,l.getType(),e.constructor.name,r):i instanceof e.constructor&&l!==e.constructor||Rt(202,l.name,l.getType(),e.constructor.name,r),i.__key===e.__key&&Rt(203,e.constructor.name,r,l.name,l.getType()),i}return e}function Aw(e,t){!Ws(e.getParent())||vt(t)||nn(t)||Rt(99)}function QB(e){const t=Fs(e);return t===null&&Rt(63,e),t}function jw(e){return(nn(e)||vt(e)&&!e.canBeEmpty())&&!e.isInline()}function q_(e,t,r){r.style.removeProperty("caret-color"),t._blockCursorElement=null;const n=e.parentElement;n!==null&&n.removeChild(e)}function qo(e){return Xo?(e||window).getSelection():null}function JB(e){const t=Bb(e);return t?t.getSelection():null}function zA(e){return Mn(e)&&e.tagName==="A"}function Mn(e){return S0(e)&&e.nodeType===LL}function S0(e){return typeof e=="object"&&e!==null&&"nodeType"in e&&typeof e.nodeType=="number"}function X_(e){return S0(e)&&e.nodeType===$L}function Y_(e){const t=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return e.nodeName.match(t)!==null}function iy(e){const t=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return e.nodeName.match(t)!==null}function ho(e){if(nn(e)&&!e.isInline())return!0;if(!vt(e)||ii(e))return!1;const t=e.getFirstChild(),r=t===null||vc(t)||qt(t)||t.isInline();return!e.isInline()&&e.canBeEmpty()!==!1&&r}function Fw(e,t){let r=e;for(;r!==null&&r.getParent()!==null&&!t(r);)r=r.getParentOrThrow();return t(r)?r:null}function Mp(){return Xn()}const nE=new WeakMap,ZB=new Map;function sE(e){if(!e._readOnly&&e.isEmpty())return ZB;e._readOnly||Rt(192);let t=nE.get(e);return t||(t=(function(r){const n=new Map;for(const[s,a]of r._nodeMap){const i=a.__type;let l=n.get(i);l||(l=new Map,n.set(i,l)),l.set(s,a)}return n})(e),nE.set(e,t)),t}function Ub(e){const t=e.constructor.clone(e);return t.afterCloneFrom(e),t}function $b(e,t){const r=parseInt(e.style.paddingInlineStart,10)||0,n=Math.round(r/40);t.setIndent(n)}function eU(e){e.__lexicalUnmanaged=!0}function tU(e){return e.__lexicalUnmanaged===!0}function mm(e,t){return(function(r,n){return Object.prototype.hasOwnProperty.call(r,n)})(e,t)&&e[t]!==w0[t]}function Wb(e){const t=p4 in e.prototype?e.prototype[p4]():void 0,r=(function(i){return i===Eb||i===$a||i===w0})(e),n=!r&&mm(e,"getType")?e.getType():void 0;let s,a=n;if(t)if(n)s=t[n];else for(const[i,l]of Object.entries(t))a=i,s=l;if(!r&&a&&(mm(e,"getType")||(e.getType=()=>a),mm(e,"clone")||(e.clone=i=>(Fb(i),new e)),mm(e,"importJSON")||(e.importJSON=s&&s.$importJSON||(i=>new e().updateFromJSON(i))),!mm(e,"importDOM")&&s)){const{importDOM:i}=s;i&&(e.importDOM=()=>i)}return{ownNodeConfig:s,ownNodeType:a}}function rU(e){const t=Mp();return va(),new(t.resolveRegisteredNodeAfterReplacements(t.getRegisteredNode(e))).klass}const nU={next:"previous",previous:"next"};class zb{constructor(t){this.origin=t}[Symbol.iterator](){return qb({hasNext:of,initial:this.getAdjacentCaret(),map:t=>t,step:t=>t.getAdjacentCaret()})}getAdjacentCaret(){return ba(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return ba(this.origin,this.direction)}remove(){const t=this.getNodeAtCaret();return t&&t.remove(),this}replaceOrInsert(t,r){const n=this.getNodeAtCaret();return t.is(this.origin)||t.is(n)||(n===null?this.insert(t):n.replace(t,r)),this}splice(t,r,n="next"){const s=n===this.direction?r:Array.from(r).reverse();let a=this;const i=this.getParentAtCaret(),l=new Map;for(let c=a.getAdjacentCaret();c!==null&&l.size<t;c=c.getAdjacentCaret()){const d=c.origin.getWritable();l.set(d.getKey(),d)}for(const c of s){if(l.size>0){const d=a.getNodeAtCaret();if(d){if(l.delete(d.getKey()),l.delete(c.getKey()),!(d.is(c)||a.origin.is(c))){const f=c.getParent();f&&f.is(i)&&c.remove(),d.replace(c)}}else d===null&&Rt(263,Array.from(l).join(" "))}else a.insert(c);a=ba(c,this.direction)}for(const c of l.values())c.remove();return this}}class ap extends zb{type="child";getLatest(){const t=this.origin.getLatest();return t===this.origin?this:yo(t,this.direction)}getParentCaret(t="root"){return ba(Hb(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=k0(this.direction);return ba(this.getNodeAtCaret(),t)||yo(this.origin,t)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(t){return t instanceof ap&&this.direction===t.direction&&this.origin.is(t.origin)}isSamePointCaret(t){return this.isSameNodeCaret(t)}}const sU={root:Ws,shadowRoot:ii};function k0(e){return nU[e]}function Hb(e,t="root"){return sU[t](e)?null:e}class sf extends zb{type="sibling";getLatest(){const t=this.origin.getLatest();return t===this.origin?this:ba(t,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return vt(this.origin)?yo(this.origin,this.direction):null}getParentCaret(t="root"){return ba(Hb(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=k0(this.direction);return ba(this.getNodeAtCaret(),t)||yo(this.origin.getParentOrThrow(),t)}isSamePointCaret(t){return t instanceof sf&&this.direction===t.direction&&this.origin.is(t.origin)}isSameNodeCaret(t){return(t instanceof sf||t instanceof af)&&this.direction===t.direction&&this.origin.is(t.origin)}}class af extends zb{type="text";constructor(t,r){super(t),this.offset=r}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:lf(t,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(t="root"){return ba(Hb(this.getParentAtCaret(),t),this.direction)}getFlipped(){return lf(this.origin,k0(this.direction),this.offset)}isSamePointCaret(t){return t instanceof af&&this.direction===t.direction&&this.origin.is(t.origin)&&this.offset===t.offset}isSameNodeCaret(t){return(t instanceof sf||t instanceof af)&&this.direction===t.direction&&this.origin.is(t.origin)}getSiblingCaret(){return ba(this.origin,this.direction)}}function Fu(e){return e instanceof af}function of(e){return e instanceof sf}function jl(e){return e instanceof ap}const aU={next:class extends af{direction="next";getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends af{direction="previous";getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},iU={next:class extends sf{direction="next";getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends sf{direction="previous";getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},oU={next:class extends ap{direction="next";getNodeAtCaret(){return this.origin.getFirstChild()}insert(e){return this.origin.splice(0,0,[e]),this}},previous:class extends ap{direction="previous";getNodeAtCaret(){return this.origin.getLastChild()}insert(e){return this.origin.splice(this.origin.getChildrenSize(),0,[e]),this}}};function ba(e,t){return e?new iU[t](e):null}function lf(e,t,r){return e?new aU[t](e,Pu(e,r)):null}function Pu(e,t,r="error"){const n=e.getTextContentSize();let s=t==="next"?n:t==="previous"?0:t;return(s<0||s>n)&&(r!=="clamp"&&(function(a,...i){const l=new URL("https://lexical.dev/docs/error"),c=new URLSearchParams;c.append("code",a);for(const d of i)c.append("v",d);l.search=c.toString(),console.warn(`Minified Lexical warning #${a}; visit ${l.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(284,String(t),String(n),e.getKey()),s=s<0?0:n),s}function aE(e,t){return new cU(e,t)}function yo(e,t){return vt(e)?new oU[t](e):null}function lU(e){return e&&e.getChildCaret()||e}function Gb(e){return e&&lU(e.getAdjacentCaret())}class Vb{type="node-caret-range";constructor(t,r,n){this.anchor=t,this.focus=r,this.direction=n}getLatest(){const t=this.anchor.getLatest(),r=this.focus.getLatest();return t===this.anchor&&r===this.focus?this:new Vb(t,r,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const t=s=>{const a=this[s].getLatest();return Fu(a)?(function(i,l){const{direction:c,origin:d}=i,f=Pu(d,l==="focus"?k0(c):c);return aE(i,f-i.offset)})(a,s):null},r=t("anchor"),n=t("focus");if(r&&n){const{caret:s}=r,{caret:a}=n;if(s.isSameNodeCaret(a))return[aE(s,a.offset-s.offset),null]}return[r,n]}iterNodeCarets(t="root"){const r=Fu(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),n=this.focus.getLatest(),s=Fu(n),a=i=>i.isSameNodeCaret(n)?null:Gb(i)||i.getParentCaret(t);return qb({hasNext:i=>i!==null&&!(s&&n.isSameNodeCaret(i)),initial:r.isSameNodeCaret(n)?null:a(r),map:i=>i,step:a})}[Symbol.iterator](){return this.iterNodeCarets("root")}}class cU{type="slice";constructor(t,r){this.caret=t,this.distance=r}getSliceIndices(){const{distance:t,caret:{offset:r}}=this,n=r+t;return n<r?[n,r]:[r,n]}getTextContent(){const[t,r]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(t,r)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:t,direction:r}}=this,[n,s]=this.getSliceIndices(),a=t.getTextContent();return lf(t.setTextContent(a.slice(0,n)+a.slice(s)),r,n)}}function Kb(e){return Lu(e,ba(zn(),e.direction))}function uU(e){return Lu(e,e)}function Lu(e,t){return e.direction!==t.direction&&Rt(265),new Vb(e,t,e.direction)}function qb(e){const{initial:t,hasNext:r,step:n,map:s}=e;let a=t;return{[Symbol.iterator](){return this},next(){if(!r(a))return{done:!0,value:void 0};const i={done:!1,value:s(a)};return a=n(a),i}}}function HA(e,t){const r=D1(e.origin,t.origin);switch(r===null&&Rt(275,e.origin.getKey(),t.origin.getKey()),r.type){case"same":{const n=e.type==="text",s=t.type==="text";return n&&s?(function(a,i){return Math.sign(a-i)})(e.offset,t.offset):e.type===t.type?0:n?-1:s?1:e.type==="child"?-1:1}case"ancestor":return e.type==="child"?-1:1;case"descendant":return t.type==="child"?1:-1;case"branch":return GA(r)}}function GA(e){const{a:t,b:r}=e,n=t.__key,s=r.__key;let a=t,i=r;for(;a&&i;a=a.getNextSibling(),i=i.getNextSibling()){if(a.__key===s)return-1;if(i.__key===n)return 1}return a===null?1:-1}function d1(e,t){return t.is(e)}function iE(e){return vt(e)?[e.getLatest(),null]:[e.getParent(),e.getLatest()]}function D1(e,t){if(e.is(t))return{commonAncestor:e,type:"same"};const r=new Map;for(let[n,s]=iE(e);n;s=n,n=n.getParent())r.set(n,s);for(let[n,s]=iE(t);n;s=n,n=n.getParent()){const a=r.get(n);if(a!==void 0)return a===null?(d1(e,n)||Rt(276),{commonAncestor:n,type:"ancestor"}):s===null?(d1(t,n)||Rt(277),{commonAncestor:n,type:"descendant"}):((vt(a)||d1(e,a))&&(vt(s)||d1(t,s))&&n.is(a.getParent())&&n.is(s.getParent())||Rt(278),{a,b:s,commonAncestor:n,type:"branch"})}return null}function Tc(e,t){const{type:r,key:n,offset:s}=e,a=QB(e.key);return r==="text"?(qt(a)||Rt(266,a.getType(),n),lf(a,t,s)):(vt(a)||Rt(267,a.getType(),n),hU(a,e.offset,t))}function cf(e,t){const{origin:r,direction:n}=t,s=n==="next";Fu(t)?e.set(r.getKey(),t.offset,"text"):of(t)?qt(r)?e.set(r.getKey(),Pu(r,n),"text"):e.set(r.getParentOrThrow().getKey(),r.getIndexWithinParent()+(s?1:0),"element"):(jl(t)&&vt(r)||Rt(268),e.set(r.getKey(),s?0:r.getChildrenSize(),"element"))}function dU(e){const t=Kt(),r=Nt(t)?t:$y();return I1(r,e),Sa(r),r}function I1(e,t){cf(e.anchor,t.anchor),cf(e.focus,t.focus)}function oE(e){const{anchor:t,focus:r}=e,n=Tc(t,"next"),s=Tc(r,"next"),a=HA(n,s)<=0?"next":"previous";return Lu(l0(n,a),l0(s,a))}function Xb(e){const{direction:t,origin:r}=e,n=ba(r,k0(t)).getNodeAtCaret();return n?ba(n,t):yo(r.getParentOrThrow(),t)}function lE(e,t="root"){const r=[e];for(let n=jl(e)?e.getParentCaret(t):e.getSiblingCaret();n!==null;n=n.getParentCaret(t))r.push(Xb(n));return r}function Pw(e){return!!e&&e.origin.isAttached()}function fU(e,t="removeEmptySlices"){if(e.isCollapsed())return e;const r="root",n="next";let s=t;const a=KA(e,n),i=lE(a.anchor,r),l=lE(a.focus.getFlipped(),r),c=new Set,d=[];for(const v of a.iterNodeCarets(r))if(jl(v))c.add(v.origin.getKey());else if(of(v)){const{origin:_}=v;vt(_)&&!c.has(_.getKey())||d.push(_)}for(const v of d)v.remove();for(const v of a.getTextSlices()){if(!v)continue;const{origin:_}=v.caret,b=_.getTextContentSize(),E=Xb(ba(_,n)),k=_.getMode();if(Math.abs(v.distance)===b&&s==="removeEmptySlices"||k==="token"&&v.distance!==0)E.remove();else if(v.distance!==0){s="removeEmptySlices";let w=v.removeTextSlice();const N=v.caret.origin;if(k==="segmented"){const A=w.origin,P=rs(A.getTextContent()).setStyle(A.getStyle()).setFormat(A.getFormat());E.replaceOrInsert(P),w=lf(P,n,w.offset)}N.is(i[0].origin)&&(i[0]=w),N.is(l[0].origin)&&(l[0]=w.getFlipped())}}let f,p;for(const v of i)if(Pw(v)){f=go(v);break}for(const v of l)if(Pw(v)){p=go(v);break}const g=(function(v,_,b){if(!v||!_)return null;const E=v.getParentAtCaret(),k=_.getParentAtCaret();if(!E||!k)return null;const w=E.getParents().reverse();w.push(E);const N=k.getParents().reverse();N.push(k);const A=Math.min(w.length,N.length);let P;for(P=0;P<A&&w[P]===N[P];P++);const R=(I,V)=>{let X;for(let Z=P;Z<I.length;Z++){const ie=I[Z];if(ii(ie))return;!X&&V(ie)&&(X=ie)}return X},T=R(w,ho),D=T&&R(N,(I=>b.has(I.getKey())&&ho(I)));return T&&D?[T,D]:null})(f,p,c);if(g){const[v,_]=g;yo(v,"previous").splice(0,_.getChildren()),_.remove()}const y=[f,p,...i,...l].find(Pw);if(y)return uU(l0(go(y),e.direction));Rt(269,JSON.stringify(i.map((v=>v.origin.__key))))}function go(e){const t=(function(s){let a=s;for(;jl(a);){const i=Gb(a);if(!jl(i))break;a=i}return a})(e.getLatest()),{direction:r}=t;if(qt(t.origin))return Fu(t)?t:lf(t.origin,r,r);const n=t.getAdjacentCaret();return of(n)&&qt(n.origin)?lf(n.origin,r,k0(r)):t}function VA(e){return Fu(e)&&e.offset!==Pu(e.origin,e.direction)}function l0(e,t){return e.direction===t?e:e.getFlipped()}function KA(e,t){return e.direction===t?e:Lu(l0(e.focus,t),l0(e.anchor,t))}function hU(e,t,r){let n=yo(e,"next");for(let s=0;s<t;s++){const a=n.getAdjacentCaret();if(a===null)break;n=a}return l0(n,r)}const qA=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,gU=qA?C.useLayoutEffect:C.useEffect,f1={tag:Im};function XA({initialConfig:e,children:t}){const r=C.useMemo((()=>{const{theme:n,namespace:s,nodes:a,onError:i,editorState:l,html:c}=e,d=IL(null,n),f=UB({editable:e.editable,html:c,namespace:s,nodes:a,onError:p=>i(p,f),theme:n});return(function(p,g){if(g!==null){if(g===void 0)p.update((()=>{const y=zn();if(y.isEmpty()){const v=In();y.append(v);const _=qA?document.activeElement:null;(Kt()!==null||_!==null&&_===p.getRootElement())&&v.select()}}),f1);else if(g!==null)switch(typeof g){case"string":{const y=p.parseEditorState(g);p.setEditorState(y,f1);break}case"object":p.setEditorState(g,f1);break;case"function":p.update((()=>{zn().isEmpty()&&g(p)}),f1)}}})(f,l),[f,d]}),[]);return gU((()=>{const n=e.editable,[s]=r;s.setEditable(n===void 0||n)}),[]),o.jsx(v0.Provider,{value:r,children:t})}const mU=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function pU(e){return{initialValueFn:()=>e.isEditable(),subscribe:t=>e.registerEditableListener(t)}}function xU(){return(function(e){const[t]=Rl(),r=C.useMemo((()=>e(t)),[t,e]),[n,s]=C.useState((()=>r.initialValueFn())),a=C.useRef(n);return mU((()=>{const{initialValueFn:i,subscribe:l}=r,c=i();return a.current!==c&&(a.current=c,s(c)),l((d=>{a.current=d,s(d)}))}),[r,e]),n})(pU)}function yU(){return zn().getTextContent()}function vU(e,t=!0){if(e)return!1;let r=yU();return t&&(r=r.trim()),r===""}function wU(e){if(!vU(e,!1))return!1;const t=zn().getChildren(),r=t.length;if(r>1)return!1;for(let n=0;n<r;n++){const s=t[n];if(nn(s))return!1;if(vt(s)){if(!jb(s)||s.__indent!==0)return!1;const a=s.getChildren(),i=a.length;for(let l=0;l<i;l++){const c=a[n];if(!qt(c))return!1}}}return!0}function YA(e){return()=>wU(e)}const Q_=new Map;function QA(e){const t={};if(!e)return t;const r=e.split(";");for(const n of r)if(n!==""){const[s,a]=n.split(/:([^]+)/);s&&a&&(t[s.trim()]=a.trim())}return t}function cE(e){let t=Q_.get(e);return t===void 0&&(t=QA(e),Q_.set(e,t)),t}function JA(e){const t=Mp().getElementByKey(e.getKey());if(t===null)return null;const r=t.ownerDocument.defaultView;return r===null?null:r.getComputedStyle(t)}function ZA(e){return JA(Ws(e)?e:e.getParentOrThrow())}function uE(e){const t=ZA(e);return t!==null&&t.direction==="rtl"}function ej(e,t){const r=e.getStartEndPoints();if(t.isSelected(e)&&!gc(t)&&r!==null){const[n,s]=r,a=e.isBackward(),i=n.getNode(),l=s.getNode(),c=t.is(i),d=t.is(l);if(c||d){const[f,p]=z_(e),g=i.is(l),y=t.is(a?l:i),v=t.is(a?i:l);let _,b=0;g?(b=f>p?p:f,_=f>p?f:p):y?(b=a?p:f,_=void 0):v&&(b=0,_=a?f:p),t.__text=t.__text.slice(b,_)}}return t}function _U(e){const t=e.getStyle(),r=QA(t);Q_.set(t,r)}function bU(e,t){const r=e.getFormatType(),n=e.getIndent();r!==t.getFormatType()&&t.setFormat(r),n!==t.getIndent()&&t.setIndent(n)}function Yh(e,t,r=bU){if(e===null)return;const n=e.getStartEndPoints(),s=new Map;let a=null;if(n){const[i,l]=n;a=$y(),a.anchor.set(i.key,i.offset,i.type),a.focus.set(l.key,l.offset,l.type);const c=Rw(i.getNode(),ho),d=Rw(l.getNode(),ho);vt(c)&&s.set(c.getKey(),c),vt(d)&&s.set(d.getKey(),d)}for(const i of e.getNodes())if(vt(i)&&ho(i))s.set(i.getKey(),i);else if(n===null){const l=Rw(i,ho);vt(l)&&s.set(l.getKey(),l)}for(const[i,l]of s){const c=t();r(l,c),l.replace(c,!0),a&&(i===a.anchor.key&&a.anchor.set(c.getKey(),a.anchor.offset,a.anchor.type),i===a.focus.key&&a.focus.set(c.getKey(),a.focus.offset,a.focus.type))}a&&e.is(Kt())&&Sa(a)}function tj(e){const t=rj(e);return t!==null&&t.writingMode==="vertical-rl"}function rj(e){const t=e.anchor.getNode();return vt(t)?JA(t):ZA(t)}function dE(e,t){let r=tj(e)?!t:t;nj(e)&&(r=!r);const n=Tc(e.focus,r?"previous":"next");if(VA(n))return!1;for(const s of Kb(n)){if(jl(s))return!s.origin.isInline();if(!vt(s.origin)){if(nn(s.origin))return!0;break}}return!1}function SU(e,t,r,n){e.modify(t?"extend":"move",r,n)}function nj(e){const t=rj(e);return t!==null&&t.direction==="rtl"}function fE(e,t,r){const n=nj(e);let s;s=tj(e)||n?!r:r,SU(e,t,s,"character")}function Rw(e,t){let r=e;for(;r!==null&&r.getParent()!==null&&!t(r);)r=r.getParentOrThrow();return t(r)?r:null}function kU(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const sj=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,CU=sj&&"documentMode"in document?document.documentMode:null;!(!sj||!("InputEvent"in window)||CU)&&"getTargetRanges"in new window.InputEvent("input");function aj(...e){const t=[];for(const r of e)if(r&&typeof r=="string")for(const[n]of r.matchAll(/\S+/g))t.push(n);return t}function yf(...e){return()=>{for(let t=e.length-1;t>=0;t--)e[t]();e.length=0}}function Us(e,...t){const r=aj(...t);r.length>0&&e.classList.add(...r)}function Ru(e,...t){const r=aj(...t);r.length>0&&e.classList.remove(...r)}function TU(e){return e?e.getAdjacentCaret():null}function EU(e,t){let r=e;for(;r!=null;){if(r instanceof t)return r;r=r.getParent()}return null}function NU(e){const t=qy(e,(r=>vt(r)&&!r.isInline()));return vt(t)||kU(4,e.__key),t}const qy=(e,t)=>{let r=e;for(;r!==zn()&&r!=null;){if(t(r))return r;r=r.getParent()}return null};function Ld(e,t){return e!==null&&Object.getPrototypeOf(e).constructor.name===t.name}function ij(e,t){const r=[],n=Array.from(e).reverse();for(let s=n.pop();s!==void 0;s=n.pop())if(t(s))r.push(s);else if(vt(s))for(const a of AU(s))n.push(a);return r}function AU(e){return jU(yo(e,"previous"))}function jU(e){return qb({hasNext:of,initial:e.getAdjacentCaret(),map:t=>t.origin.getLatest(),step:t=>t.getAdjacentCaret()})}function FU(e){const t=window.location.origin,r=n=>{if(n.origin!==t)return;const s=e.getRootElement();if(document.activeElement!==s)return;const a=n.data;if(typeof a=="string"){let i;try{i=JSON.parse(a)}catch{return}if(i&&i.protocol==="nuanria_messaging"&&i.type==="request"){const l=i.payload;if(l&&l.functionId==="makeChanges"){const c=l.args;if(c){const[d,f,p,g,y,v]=c;e.update((()=>{const _=Kt();if(Nt(_)){const b=_.anchor;let E=b.getNode(),k=0,w=0;if(qt(E)&&d>=0&&f>=0&&(k=d,w=d+f,_.setTextNodeRange(E,k,E,w)),k===w&&p===""||(_.insertRawText(p),E=b.getNode()),qt(E)){k=g,w=g+y;const N=E.getTextContentSize();k=k>N?N:k,w=w>N?N:w,_.setTextNodeRange(E,k,E,w)}n.stopImmediatePropagation()}}))}}}}};return window.addEventListener("message",r,!0),()=>{window.removeEventListener("message",r,!0)}}function PU(e,t){const r=t.body?t.body.childNodes:[];let n=[];const s=[];for(let a=0;a<r.length;a++){const i=r[a];if(!lj.has(i.nodeName)){const l=cj(i,e,s,!1);l!==null&&(n=n.concat(l))}}return(function(a){for(const i of a)i.getNextSibling()instanceof Ab&&i.insertAfter(Fl());for(const i of a){const l=i.getChildren();for(const c of l)i.insertBefore(c);i.remove()}})(s),n}function RU(e,t){if(typeof document>"u"||typeof window>"u"&&global.window===void 0)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const r=document.createElement("div"),n=zn().getChildren();for(let s=0;s<n.length;s++)oj(e,n[s],r,t);return r.innerHTML}function oj(e,t,r,n=null){let s=n===null||t.isSelected(n);const a=vt(t)&&t.excludeFromCopy("html");let i=t;if(n!==null){let y=Ub(t);y=qt(y)&&n!==null?ej(n,y):y,i=y}const l=vt(i)?i.getChildren():[],c=Pb(e,i.getType());let d;d=c&&c.exportDOM!==void 0?c.exportDOM(e,i):i.exportDOM(e);const{element:f,after:p}=d;if(!f)return!1;const g=document.createDocumentFragment();for(let y=0;y<l.length;y++){const v=l[y],_=oj(e,v,g,n);!s&&vt(t)&&_&&t.extractWithChild(v,n,"html")&&(s=!0)}if(s&&!a){if((Mn(f)||X_(f))&&f.append(g),r.append(f),p){const y=p.call(i,f);y&&(X_(f)?f.replaceChildren(y):f.replaceWith(y))}}else r.append(g);return s}const lj=new Set(["STYLE","SCRIPT"]);function cj(e,t,r,n,s=new Map,a){let i=[];if(lj.has(e.nodeName))return i;let l=null;const c=(function(v,_){const{nodeName:b}=v,E=_._htmlConversions.get(b.toLowerCase());let k=null;if(E!==void 0)for(const w of E){const N=w(v);N!==null&&(k===null||(k.priority||0)<=(N.priority||0))&&(k=N)}return k!==null?k.conversion:null})(e,t),d=c?c(e):null;let f=null;if(d!==null){f=d.after;const v=d.node;if(l=Array.isArray(v)?v[v.length-1]:v,l!==null){for(const[,_]of s)if(l=_(l,a),!l)break;l&&i.push(...Array.isArray(v)?v:[l])}d.forChild!=null&&s.set(e.nodeName,d.forChild)}const p=e.childNodes;let g=[];const y=(l==null||!ii(l))&&(l!=null&&H_(l)||n);for(let v=0;v<p.length;v++)g.push(...cj(p[v],t,r,y,new Map(s),l));return f!=null&&(g=f(g)),iy(e)&&(g=DU(e,g,y?()=>{const v=new Ab;return r.push(v),v}:In)),l==null?g.length>0?i=i.concat(g):iy(e)&&(function(v){return v.nextSibling==null||v.previousSibling==null?!1:Y_(v.nextSibling)&&Y_(v.previousSibling)})(e)&&(i=i.concat(Fl())):vt(l)&&l.append(...g),i}function DU(e,t,r){const n=e.style.textAlign,s=[];let a=[];for(let i=0;i<t.length;i++){const l=t[i];if(H_(l))n&&!l.getFormat()&&l.setFormat(n),s.push(l);else if(a.push(l),i===t.length-1||i<t.length-1&&H_(t[i+1])){const c=r();c.setFormat(n),c.append(...a),s.push(c),a=[]}}return s}function oy(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function IU(e,t=Kt()){return t==null&&oy(166),Nt(t)&&t.isCollapsed()||t.getNodes().length===0?"":RU(e,t)}function MU(e,t=Kt()){return t==null&&oy(166),Nt(t)&&t.isCollapsed()||t.getNodes().length===0?null:JSON.stringify(OU(e,t))}function hE(e,t,r){const n=e.getData("application/x-lexical-editor");if(n)try{const l=JSON.parse(n);if(l.namespace===r._config.namespace&&Array.isArray(l.nodes))return gE(r,LU(l.nodes),t)}catch{}const s=e.getData("text/html"),a=e.getData("text/plain");if(s&&a!==s)try{const l=new DOMParser().parseFromString((function(c){return window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("lexical",{createHTML:d=>d}).createHTML(c):c})(s),"text/html");return gE(r,PU(r,l),t)}catch{}const i=a||e.getData("text/uri-list");if(i!=null)if(Nt(t)){const l=i.split(/(\r?\n|\t)/);l[l.length-1]===""&&l.pop();for(let c=0;c<l.length;c++){const d=Kt();if(Nt(d)){const f=l[c];f===`
`||f===`\r
`?d.insertParagraph():f==="	"?d.insertNodes([_0()]):d.insertText(f)}}}else t.insertRawText(i)}function gE(e,t,r){e.dispatchCommand(lB,{nodes:t,selection:r})||(r.insertNodes(t),(function(n){if(Nt(n)&&n.isCollapsed()){const s=n.anchor;let a=null;const i=Tc(s,"previous");if(i)if(Fu(i))a=i.origin;else{const l=Lu(i,yo(zn(),"next").getFlipped());for(const c of l){if(qt(c.origin)){a=c.origin;break}if(vt(c.origin)&&!c.origin.isInline())break}}if(a&&qt(a)){const l=a.getFormat(),c=a.getStyle();n.format===l&&n.style===c||(n.format=l,n.style=c,n.dirty=!0)}}})(r))}function uj(e,t,r,n=[]){let s=t===null||r.isSelected(t);const a=vt(r)&&r.excludeFromCopy("html");let i=r;if(t!==null){let d=Ub(r);d=qt(d)&&t!==null?ej(t,d):d,i=d}const l=vt(i)?i.getChildren():[],c=(function(d){const f=d.exportJSON(),p=d.constructor;if(f.type!==p.getType()&&oy(58,p.name),vt(d)){const g=f.children;Array.isArray(g)||oy(59,p.name)}return f})(i);if(qt(i)){const d=i.__text;d.length>0?c.text=d:s=!1}for(let d=0;d<l.length;d++){const f=l[d],p=uj(e,t,f,c.children);!s&&vt(r)&&p&&r.extractWithChild(f,t,"clone")&&(s=!0)}if(s&&!a)n.push(c);else if(Array.isArray(c.children))for(let d=0;d<c.children.length;d++){const f=c.children[d];n.push(f)}return s}function OU(e,t){const r=[],n=zn().getChildren();for(let s=0;s<n.length;s++)uj(e,t,n[s],r);return{namespace:e._config.namespace,nodes:r}}function LU(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r],s=RB(n);qt(s)&&_U(s),t.push(s)}return t}let Sh=null;async function mE(e,t,r){if(Sh!==null)return!1;if(t!==null)return new Promise(((d,f)=>{e.update((()=>{d(pE(e,t,r))}))}));const n=e.getRootElement(),s=e._window||window,a=window.document,i=qo(s);if(n===null||i===null)return!1;const l=a.createElement("span");l.style.cssText="position: fixed; top: -1000px;",l.append(a.createTextNode("#")),n.append(l);const c=new Range;return c.setStart(l,0),c.setEnd(l,1),i.removeAllRanges(),i.addRange(c),new Promise(((d,f)=>{const p=e.registerCommand(Ly,(g=>(Ld(g,ClipboardEvent)&&(p(),Sh!==null&&(window.clearTimeout(Sh),Sh=null),d(pE(e,g,r))),!0)),BB);Sh=window.setTimeout((()=>{p(),Sh=null,d(!1)}),50),a.execCommand("copy"),l.remove()}))}function pE(e,t,r){if(r===void 0){const s=qo(e._window);if(!s)return!1;const a=s.anchorNode,i=s.focusNode;if(a!==null&&i!==null&&!Dp(e,a,i))return!1;const l=Kt();if(l===null)return!1;r=UU(l)}t.preventDefault();const n=t.clipboardData;return n!==null&&($U(n,r),!0)}const BU=[["text/html",IU],["application/x-lexical-editor",MU]];function UU(e=Kt()){const t={"text/plain":e?e.getTextContent():""};if(e){const r=Mp();for(const[n,s]of BU){const a=s(r,e);a!==null&&(t[n]=a)}}return t}function $U(e,t){for(const r in t){const n=t[r];n!==void 0&&e.setData(r,n)}}function xE(e,t){if(document.caretRangeFromPoint!==void 0){const r=document.caretRangeFromPoint(e,t);return r===null?null:{node:r.startContainer,offset:r.startOffset}}if(document.caretPositionFromPoint!=="undefined"){const r=document.caretPositionFromPoint(e,t);return r===null?null:{node:r.offsetNode,offset:r.offset}}return null}const C0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,WU=C0&&"documentMode"in document?document.documentMode:null,zU=!(!C0||!("InputEvent"in window)||WU)&&"getTargetRanges"in new window.InputEvent("input"),HU=C0&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),yE=C0&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,GU=C0&&/^(?=.*Chrome).*/i.test(navigator.userAgent),VU=C0&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!GU,vE=_r("DRAG_DROP_PASTE_FILE");let Op=class dj extends $a{static getType(){return"quote"}static clone(t){return new dj(t.__key)}createDOM(t){const r=document.createElement("blockquote");return Us(r,t.theme.quote),r}updateDOM(t,r){return!1}static importDOM(){return{blockquote:t=>({conversion:KU,priority:0})}}exportDOM(t){const{element:r}=super.exportDOM(t);if(Mn(r)){this.isEmpty()&&r.append(document.createElement("br"));const n=this.getFormatType();n&&(r.style.textAlign=n);const s=this.getDirection();s&&(r.dir=s)}return{element:r}}static importJSON(t){return Lp().updateFromJSON(t)}insertNewAfter(t,r){const n=In(),s=this.getDirection();return n.setDirection(s),this.insertAfter(n,r),n}collapseAtStart(){const t=In();return this.getChildren().forEach((r=>t.append(r))),this.replace(t),!0}canMergeWhenEmpty(){return!0}};function Lp(){return li(new Op)}function wE(e){return e instanceof Op}let Bp=class fj extends $a{static getType(){return"heading"}static clone(t){return new fj(t.__tag,t.__key)}constructor(t,r){super(r),this.__tag=t}getTag(){return this.__tag}setTag(t){const r=this.getWritable();return this.__tag=t,r}createDOM(t){const r=this.__tag,n=document.createElement(r),s=t.theme.heading;if(s!==void 0){const a=s[r];Us(n,a)}return n}updateDOM(t,r,n){return t.__tag!==this.__tag}static importDOM(){return{h1:t=>({conversion:kh,priority:0}),h2:t=>({conversion:kh,priority:0}),h3:t=>({conversion:kh,priority:0}),h4:t=>({conversion:kh,priority:0}),h5:t=>({conversion:kh,priority:0}),h6:t=>({conversion:kh,priority:0}),p:t=>{const r=t.firstChild;return r!==null&&_E(r)?{conversion:()=>({node:null}),priority:3}:null},span:t=>_E(t)?{conversion:r=>({node:Tu("h1")}),priority:3}:null}}exportDOM(t){const{element:r}=super.exportDOM(t);if(Mn(r)){this.isEmpty()&&r.append(document.createElement("br"));const n=this.getFormatType();n&&(r.style.textAlign=n);const s=this.getDirection();s&&(r.dir=s)}return{element:r}}static importJSON(t){return Tu(t.tag).updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setTag(t.tag)}exportJSON(){return{...super.exportJSON(),tag:this.getTag()}}insertNewAfter(t,r=!0){const n=t?t.anchor.offset:0,s=this.getLastDescendant(),a=!s||t&&t.anchor.key===s.getKey()&&n===s.getTextContentSize()||!t?In():Tu(this.getTag()),i=this.getDirection();if(a.setDirection(i),this.insertAfter(a,r),n===0&&!this.isEmpty()&&t){const l=In();l.select(),this.replace(l,!0)}return a}collapseAtStart(){const t=this.isEmpty()?In():Tu(this.getTag());return this.getChildren().forEach((r=>t.append(r))),this.replace(t),!0}extractWithChild(){return!0}};function _E(e){return e.nodeName.toLowerCase()==="span"&&e.style.fontSize==="26pt"}function kh(e){const t=e.nodeName.toLowerCase();let r=null;return t!=="h1"&&t!=="h2"&&t!=="h3"&&t!=="h4"&&t!=="h5"&&t!=="h6"||(r=Tu(t),e.style!==null&&($b(e,r),r.setFormat(e.style.textAlign))),{node:r}}function KU(e){const t=Lp();return e.style!==null&&(t.setFormat(e.style.textAlign),$b(e,t)),{node:t}}function Tu(e="h1"){return li(new Bp(e))}function qU(e){return e instanceof Bp}function h1(e){let t=null;if(Ld(e,DragEvent)?t=e.dataTransfer:Ld(e,ClipboardEvent)&&(t=e.clipboardData),t===null)return[!1,[],!1];const r=t.types,n=r.includes("Files"),s=r.includes("text/html")||r.includes("text/plain");return[n,Array.from(t.files),s]}function bE(e){const t=Kt();if(!Nt(t))return!1;const r=new Set,n=t.getNodes();for(let s=0;s<n.length;s++){const a=n[s],i=a.getKey();if(r.has(i))continue;const l=qy(a,(d=>vt(d)&&!d.isInline()));if(l===null)continue;const c=l.getKey();l.canIndent()&&!r.has(c)&&(r.add(c),e(l))}return r.size>0}function SE(e){const t=Ou(e);return nn(t)}function Dw(e){for(const t of["lowercase","uppercase","capitalize"])e.hasFormat(t)&&e.toggleFormat(t)}function XU(e){return yf(e.registerCommand(yb,(t=>{const r=Kt();return!!Pa(r)&&(r.clear(),!0)}),qr),e.registerCommand(zd,(t=>{const r=Kt();return Nt(r)?(r.deleteCharacter(t),!0):!!Pa(r)&&(r.deleteNodes(),!0)}),qr),e.registerCommand(np,(t=>{const r=Kt();return!!Nt(r)&&(r.deleteWord(t),!0)}),qr),e.registerCommand(sp,(t=>{const r=Kt();return!!Nt(r)&&(r.deleteLine(t),!0)}),qr),e.registerCommand(Kh,(t=>{const r=Kt();if(typeof t=="string")r!==null&&r.insertText(t);else{if(r===null)return!1;const n=t.dataTransfer;if(n!=null)hE(n,r,e);else if(Nt(r)){const s=t.data;return s&&r.insertText(s),!0}}return!0}),qr),e.registerCommand(M_,(()=>{const t=Kt();return!!Nt(t)&&(t.removeText(),!0)}),qr),e.registerCommand(La,(t=>{const r=Kt();return!!Nt(r)&&(r.formatText(t),!0)}),qr),e.registerCommand(lA,(t=>{const r=Kt();if(!Nt(r)&&!Pa(r))return!1;const n=r.getNodes();for(const s of n){const a=qy(s,(i=>vt(i)&&!i.isInline()));a!==null&&a.setFormat(t)}return!0}),qr),e.registerCommand(Vh,(t=>{const r=Kt();return!!Nt(r)&&(r.insertLineBreak(t),!0)}),qr),e.registerCommand(rp,(()=>{const t=Kt();return!!Nt(t)&&(t.insertParagraph(),!0)}),qr),e.registerCommand(fB,(()=>(jB([_0()]),!0)),qr),e.registerCommand(hB,(()=>bE((t=>{const r=t.getIndent();t.setIndent(r+1)}))),qr),e.registerCommand(T4,(()=>bE((t=>{const r=t.getIndent();r>0&&t.setIndent(Math.max(0,r-1))}))),qr),e.registerCommand(eA,(t=>{const r=Kt();if(Pa(r)){const n=r.getNodes();if(n.length>0)return n[0].selectPrevious(),!0}else if(Nt(r)){const n=V_(r.focus,!0);if(!t.shiftKey&&nn(n)&&!n.isIsolated()&&!n.isInline())return n.selectPrevious(),t.preventDefault(),!0}return!1}),qr),e.registerCommand(tA,(t=>{const r=Kt();if(Pa(r)){const n=r.getNodes();if(n.length>0)return n[0].selectNext(0,0),!0}else if(Nt(r)){if((function(s){const a=s.focus;return a.key==="root"&&a.offset===zn().getChildrenSize()})(r))return t.preventDefault(),!0;const n=V_(r.focus,!1);if(!t.shiftKey&&nn(n)&&!n.isIsolated()&&!n.isInline())return n.selectNext(),t.preventDefault(),!0}return!1}),qr),e.registerCommand(Z6,(t=>{const r=Kt();if(Pa(r)){const n=r.getNodes();if(n.length>0)return t.preventDefault(),uE(n[0])?n[0].selectNext(0,0):n[0].selectPrevious(),!0}if(!Nt(r))return!1;if(dE(r,!0)){const n=t.shiftKey;return t.preventDefault(),fE(r,n,!0),!0}return!1}),qr),e.registerCommand(J6,(t=>{const r=Kt();if(Pa(r)){const s=r.getNodes();if(s.length>0)return t.preventDefault(),uE(s[0])?s[0].selectPrevious():s[0].selectNext(0,0),!0}if(!Nt(r))return!1;const n=t.shiftKey;return!!dE(r,!1)&&(t.preventDefault(),fE(r,n,!1),!0)}),qr),e.registerCommand(nA,(t=>{if(SE(t.target))return!1;const r=Kt();if(Nt(r)){if((function(n){if(!n.isCollapsed())return!1;const{anchor:s}=n;if(s.offset!==0)return!1;const a=s.getNode();if(Ws(a))return!1;const i=NU(a);return i.getIndent()>0&&(i.is(a)||a.is(i.getFirstDescendant()))})(r))return t.preventDefault(),e.dispatchCommand(T4,void 0);if(yE&&navigator.language==="ko-KR")return!1}else if(!Pa(r))return!1;return t.preventDefault(),e.dispatchCommand(zd,!0)}),qr),e.registerCommand(aA,(t=>{if(SE(t.target))return!1;const r=Kt();return!(!Nt(r)&&!Pa(r))&&(t.preventDefault(),e.dispatchCommand(zd,!1))}),qr),e.registerCommand(Z1,(t=>{const r=Kt();if(!Nt(r))return!1;if(Dw(r),t!==null){if((yE||HU||VU)&&zU)return!1;if(t.preventDefault(),t.shiftKey)return e.dispatchCommand(Vh,!1)}return e.dispatchCommand(rp,void 0)}),qr),e.registerCommand(sA,(()=>{const t=Kt();return!!Nt(t)&&(e.blur(),!0)}),qr),e.registerCommand(oA,(t=>{const[,r]=h1(t);if(r.length>0){const s=xE(t.clientX,t.clientY);if(s!==null){const{offset:a,node:i}=s,l=Ou(i);if(l!==null){const c=$y();if(qt(l))c.anchor.set(l.getKey(),a,"text"),c.focus.set(l.getKey(),a,"text");else{const f=l.getParentOrThrow().getKey(),p=l.getIndexWithinParent()+1;c.anchor.set(f,p,"element"),c.focus.set(f,p,"element")}const d=q1(c);Sa(d)}e.dispatchCommand(vE,r)}return t.preventDefault(),!0}const n=Kt();return!!Nt(n)}),qr),e.registerCommand(cA,(t=>{const[r]=h1(t),n=Kt();return!(r&&!Nt(n))}),qr),e.registerCommand(uA,(t=>{const[r]=h1(t),n=Kt();if(r&&!Nt(n))return!1;const s=xE(t.clientX,t.clientY);if(s!==null){const a=Ou(s.node);nn(a)&&t.preventDefault()}return!0}),qr),e.registerCommand(O_,(()=>(VB(),!0)),qr),e.registerCommand(Ly,(t=>(mE(e,Ld(t,ClipboardEvent)?t:null),!0)),qr),e.registerCommand(bb,(t=>((async function(r,n){await mE(n,Ld(r,ClipboardEvent)?r:null),n.update((()=>{const s=Kt();Nt(s)?s.removeText():Pa(s)&&s.getNodes().forEach((a=>a.remove()))}))})(t,e),!0)),qr),e.registerCommand(vb,(t=>{const[,r,n]=h1(t);return r.length>0&&!n?(e.dispatchCommand(vE,r),!0):S0(t.target)&&Rb(t.target)?!1:Kt()!==null&&((function(s,a){s.preventDefault(),a.update((()=>{const i=Kt(),l=Ld(s,InputEvent)||Ld(s,KeyboardEvent)?null:s.clipboardData;l!=null&&i!==null&&hE(l,i,a)}),{tag:IB})})(t,e),!0)}),qr),e.registerCommand(rA,(t=>{const r=Kt();return Nt(r)&&Dw(r),!1}),qr),e.registerCommand(iA,(t=>{const r=Kt();return Nt(r)&&Dw(r),!1}),qr))}const J_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function kE(e){return e.getEditorState().read(YA(e.isComposing()))}function hj({contentEditable:e,placeholder:t=null,ErrorBoundary:r}){const[n]=Rl(),s=(function(a,i){const[l,c]=C.useState((()=>a.getDecorators()));return J_((()=>a.registerDecoratorListener((d=>{Ak.flushSync((()=>{c(d)}))}))),[a]),C.useEffect((()=>{c(a.getDecorators())}),[a]),C.useMemo((()=>{const d=[],f=Object.keys(l);for(let p=0;p<f.length;p++){const g=f[p],y=o.jsx(i,{onError:_=>a._onError(_),children:o.jsx(C.Suspense,{fallback:null,children:l[g]})}),v=a.getElementByKey(g);v!==null&&d.push(Ak.createPortal(y,v,g))}return d}),[i,l,a])})(n,r);return(function(a){J_((()=>yf(XU(a),FU(a))),[a])})(n),o.jsxs(o.Fragment,{children:[e,o.jsx(YU,{content:t}),s]})}function YU({content:e}){const[t]=Rl(),r=(function(s){const[a,i]=C.useState((()=>kE(s)));return J_((()=>{function l(){const c=kE(s);i(c)}return l(),yf(s.registerUpdateListener((()=>{l()})),s.registerEditableListener((()=>{l()})))}),[s]),a})(t),n=xU();return r?typeof e=="function"?e(n):e:null}const gj=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function QU({editor:e,ariaActiveDescendant:t,ariaAutoComplete:r,ariaControls:n,ariaDescribedBy:s,ariaErrorMessage:a,ariaExpanded:i,ariaInvalid:l,ariaLabel:c,ariaLabelledBy:d,ariaMultiline:f,ariaOwns:p,ariaRequired:g,autoCapitalize:y,className:v,id:_,role:b="textbox",spellCheck:E=!0,style:k,tabIndex:w,"data-testid":N,...A},P){const[R,T]=C.useState(e.isEditable()),D=C.useCallback((V=>{V&&V.ownerDocument&&V.ownerDocument.defaultView?e.setRootElement(V):e.setRootElement(null)}),[e]),I=C.useMemo((()=>(function(...V){return X=>{V.forEach((Z=>{typeof Z=="function"?Z(X):Z!=null&&(Z.current=X)}))}})(P,D)),[D,P]);return gj((()=>(T(e.isEditable()),e.registerEditableListener((V=>{T(V)})))),[e]),o.jsx("div",{"aria-activedescendant":R?t:void 0,"aria-autocomplete":R?r:"none","aria-controls":R?n:void 0,"aria-describedby":s,...a!=null?{"aria-errormessage":a}:{},"aria-expanded":R&&b==="combobox"?!!i:void 0,...l!=null?{"aria-invalid":l}:{},"aria-label":c,"aria-labelledby":d,"aria-multiline":f,"aria-owns":R?p:void 0,"aria-readonly":!R||void 0,"aria-required":g,autoCapitalize:y,className:v,contentEditable:R,"data-testid":N,id:_,ref:I,role:b,spellCheck:E,style:k,tabIndex:w,...A})}const JU=C.forwardRef(QU);function CE(e){return e.getEditorState().read(YA(e.isComposing()))}const mj=C.forwardRef(ZU);function ZU(e,t){const{placeholder:r,...n}=e,[s]=Rl();return o.jsxs(o.Fragment,{children:[o.jsx(JU,{editor:s,...n,ref:t}),r!=null&&o.jsx(e$,{editor:s,content:r})]})}function e$({content:e,editor:t}){const r=(function(i){const[l,c]=C.useState((()=>CE(i)));return gj((()=>{function d(){const f=CE(i);c(f)}return d(),yf(i.registerUpdateListener((()=>{d()})),i.registerEditableListener((()=>{d()})))}),[i]),l})(t),[n,s]=C.useState(t.isEditable());if(C.useLayoutEffect((()=>(s(t.isEditable()),t.registerEditableListener((i=>{s(i)})))),[t]),!r)return null;let a=null;return typeof e=="function"?a=e(n):e!==null&&(a=e),a===null?null:o.jsx("div",{"aria-hidden":!0,children:a})}const g1=0,Z_=1,e2=2,Lo=0,t$=1,TE=2,r$=3,n$=4;function s$(e,t,r,n,s){if(e===null||r.size===0&&n.size===0&&!s)return Lo;const a=t._selection,i=e._selection;if(s)return t$;if(!(Nt(a)&&Nt(i)&&i.isCollapsed()&&a.isCollapsed()))return Lo;const l=(function(E,k,w){const N=E._nodeMap,A=[];for(const P of k){const R=N.get(P);R!==void 0&&A.push(R)}for(const[P,R]of w){if(!R)continue;const T=N.get(P);T===void 0||Ws(T)||A.push(T)}return A})(t,r,n);if(l.length===0)return Lo;if(l.length>1){const E=t._nodeMap,k=E.get(a.anchor.key),w=E.get(i.anchor.key);return k&&w&&!e._nodeMap.has(k.__key)&&qt(k)&&k.__text.length===1&&a.anchor.offset===1?TE:Lo}const c=l[0],d=e._nodeMap.get(c.__key);if(!qt(d)||!qt(c)||d.__mode!==c.__mode)return Lo;const f=d.__text,p=c.__text;if(f===p)return Lo;const g=a.anchor,y=i.anchor;if(g.key!==y.key||g.type!=="text")return Lo;const v=g.offset,_=y.offset,b=p.length-f.length;return b===1&&_===v-1?TE:b===-1&&_===v+1?r$:b===-1&&_===v?n$:Lo}function a$(e,t){let r=Date.now(),n=Lo;return(s,a,i,l,c,d)=>{const f=Date.now();if(d.has(ny))return n=Lo,r=f,e2;const p=s$(s,a,l,c,e.isComposing()),g=(()=>{const y=i===null||i.editor===e,v=d.has(DB);if(!v&&y&&d.has(Im))return g1;if(s===null)return Z_;const _=a._selection;return l.size>0||c.size>0?v===!1&&p!==Lo&&p===n&&f<r+t&&y||l.size===1&&(function(b,E,k){const w=E._nodeMap.get(b),N=k._nodeMap.get(b),A=E._selection,P=k._selection;return!(Nt(A)&&Nt(P)&&A.anchor.type==="element"&&A.focus.type==="element"&&P.anchor.type==="text"&&P.focus.type==="text"||!qt(w)||!qt(N)||w.__parent!==N.__parent)&&JSON.stringify(E.read((()=>w.exportJSON())))===JSON.stringify(k.read((()=>N.exportJSON())))})(Array.from(l)[0],s,a)?g1:Z_:_!==null?g1:e2})();return r=f,n=p,g}}function EE(e){e.undoStack=[],e.redoStack=[],e.current=null}function i$(e,t,r){const n=a$(e,r);return yf(e.registerCommand(wb,(()=>((function(a,i){const l=i.redoStack,c=i.undoStack;if(c.length!==0){const d=i.current,f=c.pop();d!==null&&(l.push(d),a.dispatchCommand(a1,!0)),c.length===0&&a.dispatchCommand(i1,!1),i.current=f||null,f&&f.editor.setEditorState(f.editorState,{tag:ny})}})(e,t),!0)),qr),e.registerCommand(_b,(()=>((function(a,i){const l=i.redoStack,c=i.undoStack;if(l.length!==0){const d=i.current;d!==null&&(c.push(d),a.dispatchCommand(i1,!0));const f=l.pop();l.length===0&&a.dispatchCommand(a1,!1),i.current=f||null,f&&f.editor.setEditorState(f.editorState,{tag:ny})}})(e,t),!0)),qr),e.registerCommand(mB,(()=>(EE(t),!1)),qr),e.registerCommand(pB,(()=>(EE(t),e.dispatchCommand(a1,!1),e.dispatchCommand(i1,!1),!0)),qr),e.registerUpdateListener((({editorState:a,prevEditorState:i,dirtyLeaves:l,dirtyElements:c,tags:d})=>{const f=t.current,p=t.redoStack,g=t.undoStack,y=f===null?null:f.editorState;if(f!==null&&a===y)return;const v=n(i,a,f,l,c,d);if(v===Z_)p.length!==0&&(t.redoStack=[],e.dispatchCommand(a1,!1)),f!==null&&(g.push({...f}),e.dispatchCommand(i1,!0));else if(v===e2)return;t.current={editor:e,editorState:a}})))}function o$(){return{current:null,redoStack:[],undoStack:[]}}function pj({delay:e,externalHistoryState:t}){const[r]=Rl();return(function(n,s,a=1e3){const i=C.useMemo((()=>s||o$()),[s]);C.useEffect((()=>i$(n,i,a)),[a,n,i])})(r,t,e),null}function xj({defaultSelection:e}){const[t]=Rl();return C.useEffect((()=>{t.focus((()=>{const r=document.activeElement,n=t.getRootElement();n===null||r!==null&&n.contains(r)||n.focus({preventScroll:!0})}),{defaultSelection:e})}),[e,t]),null}function t2(e,t){return t2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},t2(e,t)}var NE={error:null},l$=(function(e){var t,r;function n(){for(var a,i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return(a=e.call.apply(e,[this].concat(l))||this).state=NE,a.resetErrorBoundary=function(){for(var d,f=arguments.length,p=new Array(f),g=0;g<f;g++)p[g]=arguments[g];a.props.onReset==null||(d=a.props).onReset.apply(d,p),a.reset()},a}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t2(t,r),n.getDerivedStateFromError=function(a){return{error:a}};var s=n.prototype;return s.reset=function(){this.setState(NE)},s.componentDidCatch=function(a,i){var l,c;(l=(c=this.props).onError)==null||l.call(c,a,i)},s.componentDidUpdate=function(a,i){var l,c,d,f,p=this.state.error,g=this.props.resetKeys;p!==null&&i.error!==null&&((d=a.resetKeys)===void 0&&(d=[]),(f=g)===void 0&&(f=[]),d.length!==f.length||d.some((function(y,v){return!Object.is(y,f[v])})))&&((l=(c=this.props).onResetKeysChange)==null||l.call(c,a.resetKeys,g),this.reset())},s.render=function(){var a=this.state.error,i=this.props,l=i.fallbackRender,c=i.FallbackComponent,d=i.fallback;if(a!==null){var f={error:a,resetErrorBoundary:this.resetErrorBoundary};if(C.isValidElement(d))return d;if(typeof l=="function")return l(f);if(c)return C.createElement(c,f);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},n})(C.Component);function yj({children:e,onError:t}){return o.jsx(l$,{fallback:o.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:t,children:e})}const Yb=/^(\d+(?:\.\d+)?)px$/,Qh={BOTH:3,NO_STATUS:0,ROW:1};class T0 extends $a{static getType(){return"tablecell"}static clone(t){return new T0(t.__headerState,t.__colSpan,t.__width,t.__key)}afterCloneFrom(t){super.afterCloneFrom(t),this.__rowSpan=t.__rowSpan,this.__backgroundColor=t.__backgroundColor,this.__verticalAlign=t.__verticalAlign}static importDOM(){return{td:t=>({conversion:AE,priority:0}),th:t=>({conversion:AE,priority:0})}}static importJSON(t){return vj().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setHeaderStyles(t.headerState).setColSpan(t.colSpan||1).setRowSpan(t.rowSpan||1).setWidth(t.width||void 0).setBackgroundColor(t.backgroundColor||null).setVerticalAlign(t.verticalAlign||void 0)}constructor(t=Qh.NO_STATUS,r=1,n,s){super(s),this.__colSpan=r,this.__rowSpan=1,this.__headerState=t,this.__width=n,this.__backgroundColor=null,this.__verticalAlign=void 0}createDOM(t){const r=document.createElement(this.getTag());return this.__width&&(r.style.width=`${this.__width}px`),this.__colSpan>1&&(r.colSpan=this.__colSpan),this.__rowSpan>1&&(r.rowSpan=this.__rowSpan),this.__backgroundColor!==null&&(r.style.backgroundColor=this.__backgroundColor),r2(this.__verticalAlign)&&(r.style.verticalAlign=this.__verticalAlign),Us(r,t.theme.tableCell,this.hasHeader()&&t.theme.tableCellHeader),r}exportDOM(t){const r=super.exportDOM(t);if(Mn(r.element)){const n=r.element;n.setAttribute("data-temporary-table-cell-lexical-key",this.getKey()),n.style.border="1px solid black",this.__colSpan>1&&(n.colSpan=this.__colSpan),this.__rowSpan>1&&(n.rowSpan=this.__rowSpan),n.style.width=`${this.getWidth()||75}px`,n.style.verticalAlign=this.getVerticalAlign()||"top",n.style.textAlign="start",this.__backgroundColor===null&&this.hasHeader()&&(n.style.backgroundColor="#f2f3f5")}return r}exportJSON(){return{...super.exportJSON(),...r2(this.__verticalAlign)&&{verticalAlign:this.__verticalAlign},backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(t){const r=this.getWritable();return r.__colSpan=t,r}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(t){const r=this.getWritable();return r.__rowSpan=t,r}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(t,r=Qh.BOTH){const n=this.getWritable();return n.__headerState=t&r|n.__headerState&~r,n}getHeaderStyles(){return this.getLatest().__headerState}setWidth(t){const r=this.getWritable();return r.__width=t,r}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(t){const r=this.getWritable();return r.__backgroundColor=t,r}getVerticalAlign(){return this.getLatest().__verticalAlign}setVerticalAlign(t){const r=this.getWritable();return r.__verticalAlign=t||void 0,r}toggleHeaderStyle(t){const r=this.getWritable();return(r.__headerState&t)===t?r.__headerState-=t:r.__headerState+=t,r}hasHeaderState(t){return(this.getHeaderStyles()&t)===t}hasHeader(){return this.getLatest().__headerState!==Qh.NO_STATUS}updateDOM(t){return t.__headerState!==this.__headerState||t.__width!==this.__width||t.__colSpan!==this.__colSpan||t.__rowSpan!==this.__rowSpan||t.__backgroundColor!==this.__backgroundColor||t.__verticalAlign!==this.__verticalAlign}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}}function r2(e){return e==="middle"||e==="bottom"}function AE(e){const t=e,r=e.nodeName.toLowerCase();let n;Yb.test(t.style.width)&&(n=parseFloat(t.style.width));const s=vj(r==="th"?Qh.ROW:Qh.NO_STATUS,t.colSpan,n);s.__rowSpan=t.rowSpan;const a=t.style.backgroundColor;a!==""&&(s.__backgroundColor=a);const i=t.style.verticalAlign;r2(i)&&(s.__verticalAlign=i);const l=t.style,c=(l&&l.textDecoration||"").split(" "),d=l.fontWeight==="700"||l.fontWeight==="bold",f=c.includes("line-through"),p=l.fontStyle==="italic",g=c.includes("underline");return{after:y=>{const v=[];let _=null;const b=()=>{if(_){const E=_.getFirstChild();vc(E)&&_.getChildrenSize()===1&&E.remove()}};for(const E of y)XB(E)||qt(E)||vc(E)?(qt(E)&&(d&&E.toggleFormat("bold"),f&&E.toggleFormat("strikethrough"),p&&E.toggleFormat("italic"),g&&E.toggleFormat("underline")),_?_.append(E):(_=In().append(E),v.push(_))):(v.push(E),b(),_=null);return b(),v.length===0&&v.push(In()),v},node:s}}function vj(e=Qh.NO_STATUS,t=1,r){return li(new T0(e,t,r))}function ip(e){return e instanceof T0}function n2(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}class E0 extends $a{static getType(){return"tablerow"}static clone(t){return new E0(t.__height,t.__key)}static importDOM(){return{tr:t=>({conversion:c$,priority:0})}}static importJSON(t){return wj().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setHeight(t.height)}constructor(t,r){super(r),this.__height=t}exportJSON(){const t=this.getHeight();return{...super.exportJSON(),...t===void 0?void 0:{height:t}}}createDOM(t){const r=document.createElement("tr");return this.__height&&(r.style.height=`${this.__height}px`),Us(r,t.theme.tableRow),r}extractWithChild(t,r,n){return n==="html"}isShadowRoot(){return!0}setHeight(t){const r=this.getWritable();return r.__height=t,r}getHeight(){return this.getLatest().__height}updateDOM(t){return t.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function c$(e){const t=e;let r;return Yb.test(t.style.height)&&(r=parseFloat(t.style.height)),{after:n=>ij(n,ip),node:wj(r)}}function wj(e){return li(new E0(e))}function _j(e){return e instanceof E0}const bj=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,u$=bj&&"documentMode"in document?document.documentMode:null;bj&&"InputEvent"in window&&!u$&&new window.InputEvent("input");function d$(e,t,r){const n=[];let s=null,a=null;function i(c){let d=n[c];return d===void 0&&(n[c]=d=[]),d}const l=e.getChildren();for(let c=0;c<l.length;c++){const d=l[c];_j(d)||n2(209);const f=i(c);for(let p=d.getFirstChild(),g=0;p!=null;p=p.getNextSibling()){for(ip(p)||n2(147);f[g]!==void 0;)g++;const y={cell:p,startColumn:g,startRow:c},{__rowSpan:v,__colSpan:_}=p;for(let b=0;b<v&&!(c+b>=l.length);b++){const E=i(c+b);for(let k=0;k<_;k++)E[g+k]=y}}}return[n,s,a]}function pm(e){return Mn(e)&&e.nodeName==="TABLE"}function f$(e,t){for(let r=t,n=null;r!==null;r=r.getParent()){if(e.is(r))return n;ip(r)&&(n=r)}return null}function h$(e,t,r){return f$(e,Ou(t,r))}function jE(e,t,r){if(!t.theme.tableAlignment)return;const n=[],s=[];for(const a of["center","right"]){const i=t.theme.tableAlignment[a];i&&(a===r?s:n).push(i)}Ru(e,...n),Us(e,...s)}const g$=new WeakSet;function FE(e=Mp()){return g$.has(e)}class Up extends $a{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(t){const r=this.getWritable();return r.__colWidths=t,r}static clone(t){return new Up(t.__key)}afterCloneFrom(t){super.afterCloneFrom(t),this.__colWidths=t.__colWidths,this.__rowStriping=t.__rowStriping,this.__frozenColumnCount=t.__frozenColumnCount,this.__frozenRowCount=t.__frozenRowCount}static importDOM(){return{table:t=>({conversion:m$,priority:1})}}static importJSON(t){return Sj().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setRowStriping(t.rowStriping||!1).setFrozenColumns(t.frozenColumnCount||0).setFrozenRows(t.frozenRowCount||0).setColWidths(t.colWidths)}constructor(t){super(t),this.__rowStriping=!1,this.__frozenColumnCount=0,this.__frozenRowCount=0}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),frozenColumnCount:this.__frozenColumnCount?this.__frozenColumnCount:void 0,frozenRowCount:this.__frozenRowCount?this.__frozenRowCount:void 0,rowStriping:this.__rowStriping?this.__rowStriping:void 0}}extractWithChild(t,r,n){return n==="html"}getDOMSlot(t){const r=pm(t)?t:t.querySelector("table");return pm(r)||n2(229),super.getDOMSlot(t).withElement(r).withAfter(r.querySelector("colgroup"))}createDOM(t,r){const n=document.createElement("table");this.__style&&(n.style.cssText=this.__style);const s=document.createElement("colgroup");if(n.appendChild(s),eU(s),Us(n,t.theme.table),this.updateTableElement(null,n,t),FE(r)){const a=document.createElement("div"),i=t.theme.tableScrollableWrapper;return i?Us(a,i):a.style.cssText="overflow-x: auto;",a.appendChild(n),this.updateTableWrapper(null,a,n,t),a}return n}updateTableWrapper(t,r,n,s){this.__frozenColumnCount!==(t?t.__frozenColumnCount:0)&&(function(a,i,l,c){c>0?(Us(a,l.theme.tableFrozenColumn),i.setAttribute("data-lexical-frozen-column","true")):(Ru(a,l.theme.tableFrozenColumn),i.removeAttribute("data-lexical-frozen-column"))})(r,n,s,this.__frozenColumnCount),this.__frozenRowCount!==(t?t.__frozenRowCount:0)&&(function(a,i,l,c){c>0?(Us(a,l.theme.tableFrozenRow),i.setAttribute("data-lexical-frozen-row","true")):(Ru(a,l.theme.tableFrozenRow),i.removeAttribute("data-lexical-frozen-row"))})(r,n,s,this.__frozenRowCount)}updateTableElement(t,r,n){this.__style!==(t?t.__style:"")&&(r.style.cssText=this.__style),this.__rowStriping!==(!!t&&t.__rowStriping)&&(function(s,a,i){i?(Us(s,a.theme.tableRowStriping),s.setAttribute("data-lexical-row-striping","true")):(Ru(s,a.theme.tableRowStriping),s.removeAttribute("data-lexical-row-striping"))})(r,n,this.__rowStriping),(function(s,a,i,l){const c=s.querySelector("colgroup");if(!c)return;const d=[];for(let f=0;f<i;f++){const p=document.createElement("col"),g=l&&l[f];g&&(p.style.width=`${g}px`),d.push(p)}c.replaceChildren(...d)})(r,0,this.getColumnCount(),this.getColWidths()),jE(r,n,this.getFormatType())}updateDOM(t,r,n){const s=this.getDOMSlot(r).element;return r===s===FE()||(Mn(a=r)&&a.nodeName==="DIV"&&this.updateTableWrapper(t,r,s,n),this.updateTableElement(t,s,n),!1);var a}exportDOM(t){const r=super.exportDOM(t),{element:n}=r;return{after:s=>{if(r.after&&(s=r.after(s)),!pm(s)&&Mn(s)&&(s=s.querySelector("table")),!pm(s))return null;jE(s,t._config,this.getFormatType());const[a]=d$(this),i=new Map;for(const f of a)for(const p of f){const g=p.cell.getKey();i.has(g)||i.set(g,{colSpan:p.cell.getColSpan(),startColumn:p.startColumn})}const l=new Set;for(const f of s.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]")){const p=f.getAttribute("data-temporary-table-cell-lexical-key");if(p){const g=i.get(p);if(f.removeAttribute("data-temporary-table-cell-lexical-key"),g){i.delete(p);for(let y=0;y<g.colSpan;y++)l.add(y+g.startColumn)}}}const c=s.querySelector(":scope > colgroup");if(c){const f=Array.from(s.querySelectorAll(":scope > colgroup > col")).filter(((p,g)=>l.has(g)));c.replaceChildren(...f)}const d=s.querySelectorAll(":scope > tr");if(d.length>0){const f=document.createElement("tbody");for(const p of d)f.appendChild(p);s.append(f)}return s},element:!pm(n)&&Mn(n)?n.querySelector("table"):n}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(t,r){const{rows:n,domRows:s}=r;for(let a=0;a<n;a++){const i=s[a];if(i!=null)for(let l=0;l<i.length;l++){const c=i[l];if(c==null)continue;const{elem:d}=c,f=h$(this,d);if(f!==null&&t.is(f))return{x:l,y:a}}}throw new Error("Cell not found in table.")}getDOMCellFromCords(t,r,n){const{domRows:s}=n,a=s[r];if(a==null)return null;const i=a[t<a.length?t:a.length-1];return i??null}getDOMCellFromCordsOrThrow(t,r,n){const s=this.getDOMCellFromCords(t,r,n);if(!s)throw new Error("Cell not found at cords.");return s}getCellNodeFromCords(t,r,n){const s=this.getDOMCellFromCords(t,r,n);if(s==null)return null;const a=Ou(s.elem);return ip(a)?a:null}getCellNodeFromCordsOrThrow(t,r,n){const s=this.getCellNodeFromCords(t,r,n);if(!s)throw new Error("Node at cords not TableCellNode.");return s}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(t){const r=this.getWritable();return r.__rowStriping=t,r}setFrozenColumns(t){const r=this.getWritable();return r.__frozenColumnCount=t,r}getFrozenColumns(){return this.getLatest().__frozenColumnCount}setFrozenRows(t){const r=this.getWritable();return r.__frozenRowCount=t,r}getFrozenRows(){return this.getLatest().__frozenRowCount}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){const t=this.getFirstChild();if(!t)return 0;let r=0;return t.getChildren().forEach((n=>{ip(n)&&(r+=n.getColSpan())})),r}}function m$(e){const t=Sj();e.hasAttribute("data-lexical-row-striping")&&t.setRowStriping(!0),e.hasAttribute("data-lexical-frozen-column")&&t.setFrozenColumns(1),e.hasAttribute("data-lexical-frozen-row")&&t.setFrozenRows(1);const r=e.querySelector(":scope > colgroup");if(r){let n=[];for(const s of r.querySelectorAll(":scope > col")){let a=s.style.width||"";if(!Yb.test(a)&&(a=s.getAttribute("width")||"",!/^\d+$/.test(a))){n=void 0;break}n.push(parseFloat(a))}n&&t.setColWidths(n)}return{after:n=>ij(n,_j),node:t}}function Sj(){return li(new Up)}function Eu(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function s2(e){let t=1,r=e.getParent();for(;r!=null;){if(ln(r)){const n=r.getParent();if(Ar(n)){t++,r=n.getParent();continue}Eu(40)}return t}return t}function a2(e){let t=e.getParent();Ar(t)||Eu(40);let r=t;for(;r!==null;)r=r.getParent(),Ar(r)&&(t=r);return t}function kj(e){let t=[];const r=e.getChildren().filter(ln);for(let n=0;n<r.length;n++){const s=r[n],a=s.getFirstChild();Ar(a)?t=t.concat(kj(a)):t.push(s)}return t}function Cl(e){return ln(e)&&Ar(e.getFirstChild())}function PE(e){return $i().append(e)}function Cj(e,t){return ln(e)&&(t.length===0||t.length===1&&e.is(t[0])&&e.getChildrenSize()===0)}function RE(e){const t=Kt();if(t!==null){let r=t.getNodes();if(Nt(t)){const s=t.getStartEndPoints();s===null&&Eu(143);const[a]=s,i=a.getNode(),l=i.getParent();if(ii(i)){const c=i.getFirstChild();if(c)r=c.selectStart().getNodes();else{const d=In();i.append(d),r=d.select().getNodes()}}else if(Cj(i,r)){const c=ki(e);if(ii(l)){i.replace(c);const d=$i();vt(i)&&(d.setFormat(i.getFormatType()),d.setIndent(i.getIndent())),c.append(d)}else if(ln(i)){const d=i.getParentOrThrow();uf(c,d.getChildren()),d.replace(c)}return}}const n=new Set;for(let s=0;s<r.length;s++){const a=r[s];if(vt(a)&&a.isEmpty()&&!ln(a)&&!n.has(a.getKey())){DE(a,e);continue}let i=DA(a)?a.getParent():ln(a)&&a.isEmpty()?a:null;for(;i!=null;){const l=i.getKey();if(Ar(i)){if(!n.has(l)){const c=ki(e);uf(c,i.getChildren()),i.replace(c),n.add(l)}break}{const c=i.getParent();if(ii(c)&&!n.has(l)){n.add(l),DE(i,e);break}i=c}}}}}function uf(e,t){e.splice(e.getChildrenSize(),0,t)}function DE(e,t){if(Ar(e))return e;const r=e.getPreviousSibling(),n=e.getNextSibling(),s=$i();let a;if(uf(s,e.getChildren()),Ar(r)&&t===r.getListType())r.append(s),Ar(n)&&t===n.getListType()&&(uf(r,n.getChildren()),n.remove()),a=r;else if(Ar(n)&&t===n.getListType())n.getFirstChildOrThrow().insertBefore(s),a=n;else{const i=ki(t);i.append(s),e.replace(i),a=i}return s.setFormat(e.getFormatType()),s.setIndent(e.getIndent()),e.remove(),a}function Qb(e,t){const r=e.getLastChild(),n=t.getFirstChild();r&&n&&Cl(r)&&Cl(n)&&(Qb(r.getFirstChild(),n.getFirstChild()),n.remove());const s=t.getChildren();s.length>0&&e.append(...s),t.remove()}function p$(){const e=Kt();if(Nt(e)){const t=new Set,r=e.getNodes(),n=e.anchor.getNode();if(Cj(n,r))t.add(a2(n));else for(let s=0;s<r.length;s++){const a=r[s];if(DA(a)){const i=EU(a,Ac);i!=null&&t.add(a2(i))}}for(const s of t){let a=s;const i=kj(s);for(const l of i){const c=In().setTextStyle(e.style).setTextFormat(e.format);uf(c,l.getChildren()),a.insertAfter(c),a=c,l.__key===e.anchor.key&&cf(e.anchor,go(yo(c,"next"))),l.__key===e.focus.key&&cf(e.focus,go(yo(c,"next"))),l.remove()}s.remove()}}}function Tj(e){const t=e.getListType()!=="check";let r=e.getStart();for(const n of e.getChildren())ln(n)&&(n.getValue()!==r&&n.setValue(r),t&&n.getLatest().__checked!=null&&n.setChecked(void 0),Ar(n.getFirstChild())||r++)}function x$(e){const t=new Set;if(Cl(e)||t.has(e.getKey()))return;const r=e.getParent(),n=e.getNextSibling(),s=e.getPreviousSibling();if(Cl(n)&&Cl(s)){const a=s.getFirstChild();if(Ar(a)){a.append(e);const i=n.getFirstChild();Ar(i)&&(uf(a,i.getChildren()),n.remove(),t.add(n.getKey()))}}else if(Cl(n)){const a=n.getFirstChild();if(Ar(a)){const i=a.getFirstChild();i!==null&&i.insertBefore(e)}}else if(Cl(s)){const a=s.getFirstChild();Ar(a)&&a.append(e)}else if(Ar(r)){const a=$i().setTextFormat(e.getTextFormat()).setTextStyle(e.getTextStyle()),i=ki(r.getListType()).setTextFormat(r.getTextFormat()).setTextStyle(r.getTextStyle());a.append(i),i.append(e),s?s.insertAfter(a):n?n.insertBefore(a):r.append(a)}}function y$(e){if(Cl(e))return;const t=e.getParent(),r=t?t.getParent():void 0;if(Ar(r?r.getParent():void 0)&&ln(r)&&Ar(t)){const n=t?t.getFirstChild():void 0,s=t?t.getLastChild():void 0;if(e.is(n))r.insertBefore(e),t.isEmpty()&&r.remove();else if(e.is(s))r.insertAfter(e),t.isEmpty()&&r.remove();else{const a=t.getListType(),i=$i(),l=ki(a);i.append(l),e.getPreviousSiblings().forEach((f=>l.append(f)));const c=$i(),d=ki(a);c.append(d),uf(d,e.getNextSiblings()),r.insertBefore(i),r.insertAfter(c),r.replace(e)}}}function v$(){const e=Kt();if(!Nt(e)||!e.isCollapsed())return!1;const t=e.anchor.getNode();if(!ln(t)||t.getChildrenSize()!==0)return!1;const r=a2(t),n=t.getParent();Ar(n)||Eu(40);const s=n.getParent();let a;if(ii(s))a=In(),r.insertAfter(a);else{if(!ln(s))return!1;a=$i(),s.insertAfter(a)}a.setTextStyle(e.style).setTextFormat(e.format).select();const i=t.getNextSiblings();if(i.length>0){const l=ki(n.getListType());if(ln(a)){const c=$i();c.append(l),a.insertAfter(c)}else a.insertAfter(l);l.append(...i)}return(function(l){let c=l;for(;c.getNextSibling()==null&&c.getPreviousSibling()==null;){const d=c.getParent();if(d==null||!ln(d)&&!Ar(d))break;c=d}c.remove()})(t),!0}function ly(...e){const t=[];for(const r of e)if(r&&typeof r=="string")for(const[n]of r.matchAll(/\S+/g))t.push(n);return t}let Ac=class extends $a{$config(){return this.config("listitem",{$transform:t=>{if(t.__checked==null)return;const r=t.getParent();Ar(r)&&r.getListType()!=="check"&&t.getChecked()!=null&&t.setChecked(void 0)},extends:$a,importDOM:{li:()=>({conversion:w$,priority:0})}})}constructor(t=1,r=void 0,n){super(n),this.__value=t===void 0?1:t,this.__checked=r}afterCloneFrom(t){super.afterCloneFrom(t),this.__value=t.__value,this.__checked=t.__checked}createDOM(t){const r=document.createElement("li");return this.updateListItemDOM(null,r,t),r}updateListItemDOM(t,r,n){const s=this.getParent();Ar(s)&&s.getListType()==="check"&&(function(l,c,d,f){Ar(c.getFirstChild())?(l.removeAttribute("role"),l.removeAttribute("tabIndex"),l.removeAttribute("aria-checked")):(l.setAttribute("role","checkbox"),l.setAttribute("tabIndex","-1"),d&&c.__checked===d.__checked||l.setAttribute("aria-checked",c.getChecked()?"true":"false"))})(r,this,t),r.value=this.__value,(function(l,c,d){const f=[],p=[],g=c.list,y=g?g.listitem:void 0;let v;if(g&&g.nested&&(v=g.nested.listitem),y!==void 0&&f.push(...ly(y)),g){const _=d.getParent(),b=Ar(_)&&_.getListType()==="check",E=d.getChecked();b&&!E||p.push(g.listitemUnchecked),b&&E||p.push(g.listitemChecked),b&&f.push(E?g.listitemChecked:g.listitemUnchecked)}if(v!==void 0){const _=ly(v);d.getChildren().some((b=>Ar(b)))?f.push(..._):p.push(..._)}p.length>0&&Ru(l,...p),f.length>0&&Us(l,...f)})(r,n.theme,this);const a=t?t.__style:"",i=this.__style;a!==i&&(i===""?r.removeAttribute("style"):r.style.cssText=i),(function(l,c,d){const f=cE(c.__textStyle);for(const p in f)l.style.setProperty(`--listitem-marker-${p}`,f[p]);if(d)for(const p in cE(d.__textStyle))p in f||l.style.removeProperty(`--listitem-marker-${p}`)})(r,this,t)}updateDOM(t,r,n){const s=r;return this.updateListItemDOM(t,s,n),!1}updateFromJSON(t){return super.updateFromJSON(t).setValue(t.value).setChecked(t.checked)}exportDOM(t){const r=this.createDOM(t._config),n=this.getFormatType();n&&(r.style.textAlign=n);const s=this.getDirection();return s&&(r.dir=s),{element:r}}exportJSON(){return{...super.exportJSON(),checked:this.getChecked(),value:this.getValue()}}append(...t){for(let r=0;r<t.length;r++){const n=t[r];if(vt(n)&&this.canMergeWith(n)){const s=n.getChildren();this.append(...s),n.remove()}else super.append(n)}return this}replace(t,r){if(ln(t))return super.replace(t);this.setIndent(0);const n=this.getParentOrThrow();if(!Ar(n))return t;if(n.__first===this.getKey())n.insertBefore(t);else if(n.__last===this.getKey())n.insertAfter(t);else{const s=ki(n.getListType());let a=this.getNextSibling();for(;a;){const i=a;a=a.getNextSibling(),s.append(i)}n.insertAfter(t),t.insertAfter(s)}return r&&(vt(t)||Eu(139),this.getChildren().forEach((s=>{t.append(s)}))),this.remove(),n.getChildrenSize()===0&&n.remove(),t}insertAfter(t,r=!0){const n=this.getParentOrThrow();if(Ar(n)||Eu(39),ln(t))return super.insertAfter(t,r);const s=this.getNextSiblings();if(n.insertAfter(t,r),s.length!==0){const a=ki(n.getListType());s.forEach((i=>a.append(i))),t.insertAfter(a,r)}return t}remove(t){const r=this.getPreviousSibling(),n=this.getNextSibling();super.remove(t),r&&n&&Cl(r)&&Cl(n)&&(Qb(r.getFirstChild(),n.getFirstChild()),n.remove())}insertNewAfter(t,r=!0){const n=$i().updateFromJSON(this.exportJSON()).setChecked(!this.getChecked()&&void 0);return this.insertAfter(n,r),n}collapseAtStart(t){const r=In();this.getChildren().forEach((i=>r.append(i)));const n=this.getParentOrThrow(),s=n.getParentOrThrow(),a=ln(s);if(n.getChildrenSize()===1)if(a)n.remove(),s.select();else{n.insertBefore(r),n.remove();const i=t.anchor,l=t.focus,c=r.getKey();i.type==="element"&&i.getNode().is(this)&&i.set(c,i.offset,"element"),l.type==="element"&&l.getNode().is(this)&&l.set(c,l.offset,"element")}else n.insertBefore(r),this.remove();return!0}getValue(){return this.getLatest().__value}setValue(t){const r=this.getWritable();return r.__value=t,r}getChecked(){const t=this.getLatest();let r;const n=this.getParent();return Ar(n)&&(r=n.getListType()),r==="check"?!!t.__checked:void 0}setChecked(t){const r=this.getWritable();return r.__checked=t,r}toggleChecked(){const t=this.getWritable();return t.setChecked(!t.__checked)}getIndent(){const t=this.getParent();if(t===null||!this.isAttached())return this.getLatest().__indent;let r=t.getParentOrThrow(),n=0;for(;ln(r);)r=r.getParentOrThrow().getParentOrThrow(),n++;return n}setIndent(t){typeof t!="number"&&Eu(117),(t=Math.floor(t))>=0||Eu(199);let r=this.getIndent();for(;r!==t;)r<t?(x$(this),r++):(y$(this),r--);return this}canInsertAfter(t){return ln(t)}canReplaceWith(t){return ln(t)}canMergeWith(t){return ln(t)||jb(t)}extractWithChild(t,r){if(!Nt(r))return!1;const n=r.anchor.getNode(),s=r.focus.getNode();return this.isParentOf(n)&&this.isParentOf(s)&&this.getTextContent().length===r.getTextContent().length}isParentRequired(){return!0}createParentElementNode(){return ki("bullet")}canMergeWhenEmpty(){return!0}};function w$(e){if(e.classList.contains("task-list-item")){for(const r of e.children)if(r.tagName==="INPUT")return _$(r)}const t=e.getAttribute("aria-checked");return{node:$i(t==="true"||t!=="false"&&void 0)}}function _$(e){return e.getAttribute("type")!=="checkbox"?{node:null}:{node:$i(e.hasAttribute("checked"))}}function $i(e){return li(new Ac(void 0,e))}function ln(e){return e instanceof Ac}let qu=class extends $a{$config(){return this.config("list",{$transform:t=>{(function(r){const n=r.getNextSibling();Ar(n)&&r.getListType()===n.getListType()&&Qb(r,n)})(t),Tj(t)},extends:$a,importDOM:{ol:()=>({conversion:ME,priority:0}),ul:()=>({conversion:ME,priority:0})}})}constructor(t="number",r=1,n){super(n);const s=S$[t]||t;this.__listType=s,this.__tag=s==="number"?"ol":"ul",this.__start=r}afterCloneFrom(t){super.afterCloneFrom(t),this.__listType=t.__listType,this.__tag=t.__tag,this.__start=t.__start}getTag(){return this.getLatest().__tag}setListType(t){const r=this.getWritable();return r.__listType=t,r.__tag=t==="number"?"ol":"ul",r}getListType(){return this.getLatest().__listType}getStart(){return this.getLatest().__start}setStart(t){const r=this.getWritable();return r.__start=t,r}createDOM(t,r){const n=this.__tag,s=document.createElement(n);return this.__start!==1&&s.setAttribute("start",String(this.__start)),s.__lexicalListType=this.__listType,IE(s,t.theme,this),s}updateDOM(t,r,n){return t.__tag!==this.__tag||(IE(r,n.theme,this),!1)}updateFromJSON(t){return super.updateFromJSON(t).setListType(t.listType).setStart(t.start)}exportDOM(t){const r=this.createDOM(t._config,t);return Mn(r)&&(this.__start!==1&&r.setAttribute("start",String(this.__start)),this.__listType==="check"&&r.setAttribute("__lexicalListType","check")),{element:r}}exportJSON(){return{...super.exportJSON(),listType:this.getListType(),start:this.getStart(),tag:this.getTag()}}canBeEmpty(){return!1}canIndent(){return!1}splice(t,r,n){let s=n;for(let a=0;a<n.length;a++){const i=n[a];ln(i)||(s===n&&(s=[...n]),s[a]=$i().append(!vt(i)||Ar(i)||i.isInline()?i:rs(i.getTextContent())))}return super.splice(t,r,s)}extractWithChild(t){return ln(t)}};function IE(e,t,r){const n=[],s=[],a=t.list;if(a!==void 0){const i=a[`${r.__tag}Depth`]||[],l=s2(r)-1,c=l%i.length,d=i[c],f=a[r.__tag];let p;const g=a.nested,y=a.checklist;if(g!==void 0&&g.list&&(p=g.list),f!==void 0&&n.push(f),y!==void 0&&r.__listType==="check"&&n.push(y),d!==void 0){n.push(...ly(d));for(let v=0;v<i.length;v++)v!==c&&s.push(r.__tag+v)}if(p!==void 0){const v=ly(p);l>1?n.push(...v):s.push(...v)}}s.length>0&&Ru(e,...s),n.length>0&&Us(e,...n)}function b$(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(ln(n)){t.push(n);const s=n.getChildren();s.length>1&&s.forEach((a=>{Ar(a)&&t.push(PE(a))}))}else t.push(PE(n))}return t}function ME(e){const t=e.nodeName.toLowerCase();let r=null;return t==="ol"?r=ki("number",e.start):t==="ul"&&(r=(function(n){if(n.getAttribute("__lexicallisttype")==="check"||n.classList.contains("contains-task-list"))return!0;for(const s of n.childNodes)if(Mn(s)&&s.hasAttribute("aria-checked"))return!0;return!1})(e)?ki("check"):ki("bullet")),{after:b$,node:r}}const S$={ol:"number",ul:"bullet"};function ki(e="number",t=1){return li(new qu(e,t))}function Ar(e){return e instanceof qu}const k$=_r("UPDATE_LIST_START_COMMAND"),Jb=_r("INSERT_UNORDERED_LIST_COMMAND"),Zb=_r("INSERT_ORDERED_LIST_COMMAND"),eS=_r("REMOVE_LIST_COMMAND");function C$(e){return yf(e.registerCommand(Zb,(()=>(RE("number"),!0)),Ph),e.registerCommand(k$,(t=>{const{listNodeKey:r,newStart:n}=t,s=Fs(r);return!!Ar(s)&&(s.getListType()==="number"&&(s.setStart(n),Tj(s)),!0)}),Ph),e.registerCommand(Jb,(()=>(RE("bullet"),!0)),Ph),e.registerCommand(eS,(()=>(p$(),!0)),Ph),e.registerCommand(rp,(()=>v$()),Ph),e.registerNodeTransform(Ac,(t=>{const r=t.getFirstChild();if(r){if(qt(r)){const n=r.getStyle(),s=r.getFormat();t.getTextStyle()!==n&&t.setTextStyle(n),t.getTextFormat()!==s&&t.setTextFormat(s)}}else{const n=Kt();Nt(n)&&(n.style!==t.getTextStyle()||n.format!==t.getTextFormat())&&n.isCollapsed()&&t.is(n.anchor.getNode())&&t.setTextStyle(n.style).setTextFormat(n.format)}})),e.registerNodeTransform(Vu,(t=>{const r=t.getParent();if(ln(r)&&t.is(r.getFirstChild())){const n=t.getStyle(),s=t.getFormat();n===r.getTextStyle()&&s===r.getTextFormat()||r.setTextStyle(n).setTextFormat(s)}})))}function T$(e){const t=r=>{const n=r.getParent();if(Ar(r.getFirstChild())||!Ar(n))return;const s=qy(r,(a=>ln(a)&&Ar(a.getParent())&&ln(a.getPreviousSibling())));if(s===null&&r.getIndent()>0)r.setIndent(0);else if(ln(s)){const a=s.getPreviousSibling();if(ln(a)){const i=(function(c){let d=c,f=d.getFirstChild();for(;Ar(f);){const p=f.getLastChild();if(!ln(p))break;d=p,f=d.getFirstChild()}return d})(a),l=i.getParent();if(Ar(l)){const c=s2(l);c+1<s2(n)&&r.setIndent(c)}}}};return e.registerNodeTransform(qu,(r=>{const n=[r];for(;n.length>0;){const s=n.shift();if(Ar(s)){for(const a of s.getChildren())if(ln(a)){t(a);const i=a.getFirstChild();Ar(i)&&n.push(i)}}}}))}var Iw={exports:{}},OE;function E$(){return OE||(OE=1,(function(e){var t=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var r=(function(n){var s=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,a=0,i={},l={manual:n.Prism&&n.Prism.manual,disableWorkerMessageHandler:n.Prism&&n.Prism.disableWorkerMessageHandler,util:{encode:function k(w){return w instanceof c?new c(w.type,k(w.content),w.alias):Array.isArray(w)?w.map(k):w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(k){return Object.prototype.toString.call(k).slice(8,-1)},objId:function(k){return k.__id||Object.defineProperty(k,"__id",{value:++a}),k.__id},clone:function k(w,N){N=N||{};var A,P;switch(l.util.type(w)){case"Object":if(P=l.util.objId(w),N[P])return N[P];A={},N[P]=A;for(var R in w)w.hasOwnProperty(R)&&(A[R]=k(w[R],N));return A;case"Array":return P=l.util.objId(w),N[P]?N[P]:(A=[],N[P]=A,w.forEach(function(T,D){A[D]=k(T,N)}),A);default:return w}},getLanguage:function(k){for(;k;){var w=s.exec(k.className);if(w)return w[1].toLowerCase();k=k.parentElement}return"none"},setLanguage:function(k,w){k.className=k.className.replace(RegExp(s,"gi"),""),k.classList.add("language-"+w)},currentScript:function(){if(typeof document>"u")return null;if(document.currentScript&&document.currentScript.tagName==="SCRIPT")return document.currentScript;try{throw new Error}catch(A){var k=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(A.stack)||[])[1];if(k){var w=document.getElementsByTagName("script");for(var N in w)if(w[N].src==k)return w[N]}return null}},isActive:function(k,w,N){for(var A="no-"+w;k;){var P=k.classList;if(P.contains(w))return!0;if(P.contains(A))return!1;k=k.parentElement}return!!N}},languages:{plain:i,plaintext:i,text:i,txt:i,extend:function(k,w){var N=l.util.clone(l.languages[k]);for(var A in w)N[A]=w[A];return N},insertBefore:function(k,w,N,A){A=A||l.languages;var P=A[k],R={};for(var T in P)if(P.hasOwnProperty(T)){if(T==w)for(var D in N)N.hasOwnProperty(D)&&(R[D]=N[D]);N.hasOwnProperty(T)||(R[T]=P[T])}var I=A[k];return A[k]=R,l.languages.DFS(l.languages,function(V,X){X===I&&V!=k&&(this[V]=R)}),R},DFS:function k(w,N,A,P){P=P||{};var R=l.util.objId;for(var T in w)if(w.hasOwnProperty(T)){N.call(w,T,w[T],A||T);var D=w[T],I=l.util.type(D);I==="Object"&&!P[R(D)]?(P[R(D)]=!0,k(D,N,null,P)):I==="Array"&&!P[R(D)]&&(P[R(D)]=!0,k(D,N,T,P))}}},plugins:{},highlightAll:function(k,w){l.highlightAllUnder(document,k,w)},highlightAllUnder:function(k,w,N){var A={callback:N,container:k,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};l.hooks.run("before-highlightall",A),A.elements=Array.prototype.slice.apply(A.container.querySelectorAll(A.selector)),l.hooks.run("before-all-elements-highlight",A);for(var P=0,R;R=A.elements[P++];)l.highlightElement(R,w===!0,A.callback)},highlightElement:function(k,w,N){var A=l.util.getLanguage(k),P=l.languages[A];l.util.setLanguage(k,A);var R=k.parentElement;R&&R.nodeName.toLowerCase()==="pre"&&l.util.setLanguage(R,A);var T=k.textContent,D={element:k,language:A,grammar:P,code:T};function I(X){D.highlightedCode=X,l.hooks.run("before-insert",D),D.element.innerHTML=D.highlightedCode,l.hooks.run("after-highlight",D),l.hooks.run("complete",D),N&&N.call(D.element)}if(l.hooks.run("before-sanity-check",D),R=D.element.parentElement,R&&R.nodeName.toLowerCase()==="pre"&&!R.hasAttribute("tabindex")&&R.setAttribute("tabindex","0"),!D.code){l.hooks.run("complete",D),N&&N.call(D.element);return}if(l.hooks.run("before-highlight",D),!D.grammar){I(l.util.encode(D.code));return}if(w&&n.Worker){var V=new Worker(l.filename);V.onmessage=function(X){I(X.data)},V.postMessage(JSON.stringify({language:D.language,code:D.code,immediateClose:!0}))}else I(l.highlight(D.code,D.grammar,D.language))},highlight:function(k,w,N){var A={code:k,grammar:w,language:N};if(l.hooks.run("before-tokenize",A),!A.grammar)throw new Error('The language "'+A.language+'" has no grammar.');return A.tokens=l.tokenize(A.code,A.grammar),l.hooks.run("after-tokenize",A),c.stringify(l.util.encode(A.tokens),A.language)},tokenize:function(k,w){var N=w.rest;if(N){for(var A in N)w[A]=N[A];delete w.rest}var P=new p;return g(P,P.head,k),f(k,P,w,P.head,0),v(P)},hooks:{all:{},add:function(k,w){var N=l.hooks.all;N[k]=N[k]||[],N[k].push(w)},run:function(k,w){var N=l.hooks.all[k];if(!(!N||!N.length))for(var A=0,P;P=N[A++];)P(w)}},Token:c};n.Prism=l;function c(k,w,N,A){this.type=k,this.content=w,this.alias=N,this.length=(A||"").length|0}c.stringify=function k(w,N){if(typeof w=="string")return w;if(Array.isArray(w)){var A="";return w.forEach(function(I){A+=k(I,N)}),A}var P={type:w.type,content:k(w.content,N),tag:"span",classes:["token",w.type],attributes:{},language:N},R=w.alias;R&&(Array.isArray(R)?Array.prototype.push.apply(P.classes,R):P.classes.push(R)),l.hooks.run("wrap",P);var T="";for(var D in P.attributes)T+=" "+D+'="'+(P.attributes[D]||"").replace(/"/g,"&quot;")+'"';return"<"+P.tag+' class="'+P.classes.join(" ")+'"'+T+">"+P.content+"</"+P.tag+">"};function d(k,w,N,A){k.lastIndex=w;var P=k.exec(N);if(P&&A&&P[1]){var R=P[1].length;P.index+=R,P[0]=P[0].slice(R)}return P}function f(k,w,N,A,P,R){for(var T in N)if(!(!N.hasOwnProperty(T)||!N[T])){var D=N[T];D=Array.isArray(D)?D:[D];for(var I=0;I<D.length;++I){if(R&&R.cause==T+","+I)return;var V=D[I],X=V.inside,Z=!!V.lookbehind,ie=!!V.greedy,q=V.alias;if(ie&&!V.pattern.global){var ne=V.pattern.toString().match(/[imsuy]*$/)[0];V.pattern=RegExp(V.pattern.source,ne+"g")}for(var M=V.pattern||V,W=A.next,L=P;W!==w.tail&&!(R&&L>=R.reach);L+=W.value.length,W=W.next){var H=W.value;if(w.length>k.length)return;if(!(H instanceof c)){var K=1,B;if(ie){if(B=d(M,L,k,Z),!B||B.index>=k.length)break;var te=B.index,z=B.index+B[0].length,Q=L;for(Q+=W.value.length;te>=Q;)W=W.next,Q+=W.value.length;if(Q-=W.value.length,L=Q,W.value instanceof c)continue;for(var Y=W;Y!==w.tail&&(Q<z||typeof Y.value=="string");Y=Y.next)K++,Q+=Y.value.length;K--,H=k.slice(L,Q),B.index-=L}else if(B=d(M,0,H,Z),!B)continue;var te=B.index,ee=B[0],ae=H.slice(0,te),ge=H.slice(te+ee.length),_e=L+H.length;R&&_e>R.reach&&(R.reach=_e);var Me=W.prev;ae&&(Me=g(w,Me,ae),L+=ae.length),y(w,Me,K);var ue=new c(T,X?l.tokenize(ee,X):ee,q,ee);if(W=g(w,Me,ue),ge&&g(w,W,ge),K>1){var me={cause:T+","+I,reach:_e};f(k,w,N,W.prev,L,me),R&&me.reach>R.reach&&(R.reach=me.reach)}}}}}}function p(){var k={value:null,prev:null,next:null},w={value:null,prev:k,next:null};k.next=w,this.head=k,this.tail=w,this.length=0}function g(k,w,N){var A=w.next,P={value:N,prev:w,next:A};return w.next=P,A.prev=P,k.length++,P}function y(k,w,N){for(var A=w.next,P=0;P<N&&A!==k.tail;P++)A=A.next;w.next=A,A.prev=w,k.length-=P}function v(k){for(var w=[],N=k.head.next;N!==k.tail;)w.push(N.value),N=N.next;return w}if(!n.document)return n.addEventListener&&(l.disableWorkerMessageHandler||n.addEventListener("message",function(k){var w=JSON.parse(k.data),N=w.language,A=w.code,P=w.immediateClose;n.postMessage(l.highlight(A,l.languages[N],N)),P&&n.close()},!1)),l;var _=l.util.currentScript();_&&(l.filename=_.src,_.hasAttribute("data-manual")&&(l.manual=!0));function b(){l.manual||l.highlightAll()}if(!l.manual){var E=document.readyState;E==="loading"||E==="interactive"&&_&&_.defer?document.addEventListener("DOMContentLoaded",b):window.requestAnimationFrame?window.requestAnimationFrame(b):window.setTimeout(b,16)}return l})(t);e.exports&&(e.exports=r),typeof L1<"u"&&(L1.Prism=r),r.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},r.languages.markup.tag.inside["attr-value"].inside.entity=r.languages.markup.entity,r.languages.markup.doctype.inside["internal-subset"].inside=r.languages.markup,r.hooks.add("wrap",function(n){n.type==="entity"&&(n.attributes.title=n.content.replace(/&amp;/,"&"))}),Object.defineProperty(r.languages.markup.tag,"addInlined",{value:function(s,a){var i={};i["language-"+a]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:r.languages[a]},i.cdata=/^<!\[CDATA\[|\]\]>$/i;var l={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:i}};l["language-"+a]={pattern:/[\s\S]+/,inside:r.languages[a]};var c={};c[s]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return s}),"i"),lookbehind:!0,greedy:!0,inside:l},r.languages.insertBefore("markup","cdata",c)}}),Object.defineProperty(r.languages.markup.tag,"addAttribute",{value:function(n,s){r.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+n+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[s,"language-"+s],inside:r.languages[s]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),r.languages.html=r.languages.markup,r.languages.mathml=r.languages.markup,r.languages.svg=r.languages.markup,r.languages.xml=r.languages.extend("markup",{}),r.languages.ssml=r.languages.xml,r.languages.atom=r.languages.xml,r.languages.rss=r.languages.xml,(function(n){var s=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;n.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+s.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+s.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+s.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+s.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:s,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},n.languages.css.atrule.inside.rest=n.languages.css;var a=n.languages.markup;a&&(a.tag.addInlined("style","css"),a.tag.addAttribute("style","css"))})(r),r.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},r.languages.javascript=r.languages.extend("clike",{"class-name":[r.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),r.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,r.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:r.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:r.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:r.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:r.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:r.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),r.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:r.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),r.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),r.languages.markup&&(r.languages.markup.tag.addInlined("script","javascript"),r.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),r.languages.js=r.languages.javascript,(function(){if(typeof r>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var n="Loading…",s=function(_,b){return"✖ Error "+_+" while fetching file: "+b},a="✖ Error: File does not exist or is empty",i={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},l="data-src-status",c="loading",d="loaded",f="failed",p="pre[data-src]:not(["+l+'="'+d+'"]):not(['+l+'="'+c+'"])';function g(_,b,E){var k=new XMLHttpRequest;k.open("GET",_,!0),k.onreadystatechange=function(){k.readyState==4&&(k.status<400&&k.responseText?b(k.responseText):k.status>=400?E(s(k.status,k.statusText)):E(a))},k.send(null)}function y(_){var b=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(_||"");if(b){var E=Number(b[1]),k=b[2],w=b[3];return k?w?[E,Number(w)]:[E,void 0]:[E,E]}}r.hooks.add("before-highlightall",function(_){_.selector+=", "+p}),r.hooks.add("before-sanity-check",function(_){var b=_.element;if(b.matches(p)){_.code="",b.setAttribute(l,c);var E=b.appendChild(document.createElement("CODE"));E.textContent=n;var k=b.getAttribute("data-src"),w=_.language;if(w==="none"){var N=(/\.(\w+)$/.exec(k)||[,"none"])[1];w=i[N]||N}r.util.setLanguage(E,w),r.util.setLanguage(b,w);var A=r.plugins.autoloader;A&&A.loadLanguages(w),g(k,function(P){b.setAttribute(l,d);var R=y(b.getAttribute("data-range"));if(R){var T=P.split(/\r\n?|\n/g),D=R[0],I=R[1]==null?T.length:R[1];D<0&&(D+=T.length),D=Math.max(0,Math.min(D-1,T.length)),I<0&&(I+=T.length),I=Math.max(0,Math.min(I,T.length)),P=T.slice(D,I).join(`
`),b.hasAttribute("data-start")||b.setAttribute("data-start",String(D+1))}E.textContent=P,r.highlightElement(E)},function(P){b.setAttribute(l,f),E.textContent=P})}}),r.plugins.fileHighlight={highlight:function(b){for(var E=(b||document).querySelectorAll(p),k=0,w;w=E[k++];)r.highlightElement(w)}};var v=!1;r.fileHighlight=function(){v||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),v=!0),r.plugins.fileHighlight.highlight.apply(this,arguments)}})()})(Iw)),Iw.exports}E$();Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/};Prism.languages.javascript=Prism.languages.extend("clike",{"class-name":[Prism.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/});Prism.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/;Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:Prism.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:Prism.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/});Prism.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}});Prism.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}});Prism.languages.markup&&(Prism.languages.markup.tag.addInlined("script","javascript"),Prism.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript"));Prism.languages.js=Prism.languages.javascript;Prism.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]};Prism.languages.markup.tag.inside["attr-value"].inside.entity=Prism.languages.markup.entity;Prism.languages.markup.doctype.inside["internal-subset"].inside=Prism.languages.markup;Prism.hooks.add("wrap",function(e){e.type==="entity"&&(e.attributes.title=e.content.replace(/&amp;/,"&"))});Object.defineProperty(Prism.languages.markup.tag,"addInlined",{value:function(t,r){var n={};n["language-"+r]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:Prism.languages[r]},n.cdata=/^<!\[CDATA\[|\]\]>$/i;var s={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:n}};s["language-"+r]={pattern:/[\s\S]+/,inside:Prism.languages[r]};var a={};a[t]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return t}),"i"),lookbehind:!0,greedy:!0,inside:s},Prism.languages.insertBefore("markup","cdata",a)}});Object.defineProperty(Prism.languages.markup.tag,"addAttribute",{value:function(e,t){Prism.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+e+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[t,"language-"+t],inside:Prism.languages[t]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}});Prism.languages.html=Prism.languages.markup;Prism.languages.mathml=Prism.languages.markup;Prism.languages.svg=Prism.languages.markup;Prism.languages.xml=Prism.languages.extend("markup",{});Prism.languages.ssml=Prism.languages.xml;Prism.languages.atom=Prism.languages.xml;Prism.languages.rss=Prism.languages.xml;(function(e){var t=/(?:\\.|[^\\\n\r]|(?:\n|\r\n?)(?![\r\n]))/.source;function r(f){return f=f.replace(/<inner>/g,function(){return t}),RegExp(/((?:^|[^\\])(?:\\{2})*)/.source+"(?:"+f+")")}var n=/(?:\\.|``(?:[^`\r\n]|`(?!`))+``|`[^`\r\n]+`|[^\\|\r\n`])+/.source,s=/\|?__(?:\|__)+\|?(?:(?:\n|\r\n?)|(?![\s\S]))/.source.replace(/__/g,function(){return n}),a=/\|?[ \t]*:?-{3,}:?[ \t]*(?:\|[ \t]*:?-{3,}:?[ \t]*)+\|?(?:\n|\r\n?)/.source;e.languages.markdown=e.languages.extend("markup",{}),e.languages.insertBefore("markdown","prolog",{"front-matter-block":{pattern:/(^(?:\s*[\r\n])?)---(?!.)[\s\S]*?[\r\n]---(?!.)/,lookbehind:!0,greedy:!0,inside:{punctuation:/^---|---$/,"front-matter":{pattern:/\S+(?:\s+\S+)*/,alias:["yaml","language-yaml"],inside:e.languages.yaml}}},blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},table:{pattern:RegExp("^"+s+a+"(?:"+s+")*","m"),inside:{"table-data-rows":{pattern:RegExp("^("+s+a+")(?:"+s+")*$"),lookbehind:!0,inside:{"table-data":{pattern:RegExp(n),inside:e.languages.markdown},punctuation:/\|/}},"table-line":{pattern:RegExp("^("+s+")"+a+"$"),lookbehind:!0,inside:{punctuation:/\||:?-{3,}:?/}},"table-header-row":{pattern:RegExp("^"+s+"$"),inside:{"table-header":{pattern:RegExp(n),alias:"important",inside:e.languages.markdown},punctuation:/\|/}}}},code:[{pattern:/((?:^|\n)[ \t]*\n|(?:^|\r\n?)[ \t]*\r\n?)(?: {4}|\t).+(?:(?:\n|\r\n?)(?: {4}|\t).+)*/,lookbehind:!0,alias:"keyword"},{pattern:/^```[\s\S]*?^```$/m,greedy:!0,inside:{"code-block":{pattern:/^(```.*(?:\n|\r\n?))[\s\S]+?(?=(?:\n|\r\n?)^```$)/m,lookbehind:!0},"code-language":{pattern:/^(```).+/,lookbehind:!0},punctuation:/```/}}],title:[{pattern:/\S.*(?:\n|\r\n?)(?:==+|--+)(?=[ \t]*$)/m,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])(?:[\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:r(/\b__(?:(?!_)<inner>|_(?:(?!_)<inner>)+_)+__\b|\*\*(?:(?!\*)<inner>|\*(?:(?!\*)<inner>)+\*)+\*\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^..)[\s\S]+(?=..$)/,lookbehind:!0,inside:{}},punctuation:/\*\*|__/}},italic:{pattern:r(/\b_(?:(?!_)<inner>|__(?:(?!_)<inner>)+__)+_\b|\*(?:(?!\*)<inner>|\*\*(?:(?!\*)<inner>)+\*\*)+\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^.)[\s\S]+(?=.$)/,lookbehind:!0,inside:{}},punctuation:/[*_]/}},strike:{pattern:r(/(~~?)(?:(?!~)<inner>)+\2/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^~~?)[\s\S]+(?=\1$)/,lookbehind:!0,inside:{}},punctuation:/~~?/}},"code-snippet":{pattern:/(^|[^\\`])(?:``[^`\r\n]+(?:`[^`\r\n]+)*``(?!`)|`[^`\r\n]+`(?!`))/,lookbehind:!0,greedy:!0,alias:["code","keyword"]},url:{pattern:r(/!?\[(?:(?!\])<inner>)+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)|[ \t]?\[(?:(?!\])<inner>)+\])/.source),lookbehind:!0,greedy:!0,inside:{operator:/^!/,content:{pattern:/(^\[)[^\]]+(?=\])/,lookbehind:!0,inside:{}},variable:{pattern:/(^\][ \t]?\[)[^\]]+(?=\]$)/,lookbehind:!0},url:{pattern:/(^\]\()[^\s)]+/,lookbehind:!0},string:{pattern:/(^[ \t]+)"(?:\\.|[^"\\])*"(?=\)$)/,lookbehind:!0}}}}),["url","bold","italic","strike"].forEach(function(f){["url","bold","italic","strike","code-snippet"].forEach(function(p){f!==p&&(e.languages.markdown[f].inside.content.inside[p]=e.languages.markdown[p])})}),e.hooks.add("after-tokenize",function(f){if(f.language!=="markdown"&&f.language!=="md")return;function p(g){if(!(!g||typeof g=="string"))for(var y=0,v=g.length;y<v;y++){var _=g[y];if(_.type!=="code"){p(_.content);continue}var b=_.content[1],E=_.content[3];if(b&&E&&b.type==="code-language"&&E.type==="code-block"&&typeof b.content=="string"){var k=b.content.replace(/\b#/g,"sharp").replace(/\b\+\+/g,"pp");k=(/[a-z][\w-]*/i.exec(k)||[""])[0].toLowerCase();var w="language-"+k;E.alias?typeof E.alias=="string"?E.alias=[E.alias,w]:E.alias.push(w):E.alias=[w]}}}p(f.tokens)}),e.hooks.add("wrap",function(f){if(f.type==="code-block"){for(var p="",g=0,y=f.classes.length;g<y;g++){var v=f.classes[g],_=/language-(.+)/.exec(v);if(_){p=_[1];break}}var b=e.languages[p];if(b)f.content=e.highlight(d(f.content),b,p);else if(p&&p!=="none"&&e.plugins.autoloader){var E="md-"+new Date().valueOf()+"-"+Math.floor(Math.random()*1e16);f.attributes.id=E,e.plugins.autoloader.loadLanguages(p,function(){var k=document.getElementById(E);k&&(k.innerHTML=e.highlight(k.textContent,e.languages[p],p))})}}});var i=RegExp(e.languages.markup.tag.pattern.source,"gi"),l={amp:"&",lt:"<",gt:">",quot:'"'},c=String.fromCodePoint||String.fromCharCode;function d(f){var p=f.replace(i,"");return p=p.replace(/&(\w{1,8}|#x?[\da-f]{1,8});/gi,function(g,y){if(y=y.toLowerCase(),y[0]==="#"){var v;return y[1]==="x"?v=parseInt(y.slice(2),16):v=Number(y.slice(1)),c(v)}else{var _=l[y];return _||g}}),p}e.languages.md=e.languages.markdown})(Prism);Prism.languages.c=Prism.languages.extend("clike",{comment:{pattern:/\/\/(?:[^\r\n\\]|\\(?:\r\n?|\n|(?![\r\n])))*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},"class-name":{pattern:/(\b(?:enum|struct)\s+(?:__attribute__\s*\(\([\s\S]*?\)\)\s*)?)\w+|\b[a-z]\w*_t\b/,lookbehind:!0},keyword:/\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|__attribute__|asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|inline|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|typeof|union|unsigned|void|volatile|while)\b/,function:/\b[a-z_]\w*(?=\s*\()/i,number:/(?:\b0x(?:[\da-f]+(?:\.[\da-f]*)?|\.[\da-f]+)(?:p[+-]?\d+)?|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?)[ful]{0,4}/i,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*/%&|^!=<>]=?/});Prism.languages.insertBefore("c","string",{char:{pattern:/'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n]){0,32}'/,greedy:!0}});Prism.languages.insertBefore("c","string",{macro:{pattern:/(^[\t ]*)#\s*[a-z](?:[^\r\n\\/]|\/(?!\*)|\/\*(?:[^*]|\*(?!\/))*\*\/|\\(?:\r\n|[\s\S]))*/im,lookbehind:!0,greedy:!0,alias:"property",inside:{string:[{pattern:/^(#\s*include\s*)<[^>]+>/,lookbehind:!0},Prism.languages.c.string],char:Prism.languages.c.char,comment:Prism.languages.c.comment,"macro-name":[{pattern:/(^#\s*define\s+)\w+\b(?!\()/i,lookbehind:!0},{pattern:/(^#\s*define\s+)\w+\b(?=\()/i,lookbehind:!0,alias:"function"}],directive:{pattern:/^(#\s*)[a-z]+/,lookbehind:!0,alias:"keyword"},"directive-hash":/^#/,punctuation:/##|\\(?=[\r\n])/,expression:{pattern:/\S[\s\S]*/,inside:Prism.languages.c}}}});Prism.languages.insertBefore("c","function",{constant:/\b(?:EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|__DATE__|__FILE__|__LINE__|__TIMESTAMP__|__TIME__|__func__|stderr|stdin|stdout)\b/});delete Prism.languages.c.boolean;(function(e){var t=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;e.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+t.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+t.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+t.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+t.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:t,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},e.languages.css.atrule.inside.rest=e.languages.css;var r=e.languages.markup;r&&(r.tag.addInlined("style","css"),r.tag.addAttribute("style","css"))})(Prism);Prism.languages.objectivec=Prism.languages.extend("c",{string:{pattern:/@?"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},keyword:/\b(?:asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|in|inline|int|long|register|return|self|short|signed|sizeof|static|struct|super|switch|typedef|typeof|union|unsigned|void|volatile|while)\b|(?:@interface|@end|@implementation|@protocol|@class|@public|@protected|@private|@property|@try|@catch|@finally|@throw|@synthesize|@dynamic|@selector)\b/,operator:/-[->]?|\+\+?|!=?|<<?=?|>>?=?|==?|&&?|\|\|?|[~^%?*\/@]/});delete Prism.languages.objectivec["class-name"];Prism.languages.objc=Prism.languages.objectivec;Prism.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},identifier:{pattern:/(^|[^@\\])`(?:\\[\s\S]|[^`\\]|``)*`/,greedy:!0,lookbehind:!0,inside:{punctuation:/^`|`$/}},function:/\b(?:AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:COL|_INSERT)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:ING|S)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/i,boolean:/\b(?:FALSE|NULL|TRUE)\b/i,number:/\b0x[\da-f]+\b|\b\d+(?:\.\d*)?|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|ILIKE|IN|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/};(function(e){var t=e.languages.powershell={comment:[{pattern:/(^|[^`])<#[\s\S]*?#>/,lookbehind:!0},{pattern:/(^|[^`])#.*/,lookbehind:!0}],string:[{pattern:/"(?:`[\s\S]|[^`"])*"/,greedy:!0,inside:null},{pattern:/'(?:[^']|'')*'/,greedy:!0}],namespace:/\[[a-z](?:\[(?:\[[^\]]*\]|[^\[\]])*\]|[^\[\]])*\]/i,boolean:/\$(?:false|true)\b/i,variable:/\$\w+\b/,function:[/\b(?:Add|Approve|Assert|Backup|Block|Checkpoint|Clear|Close|Compare|Complete|Compress|Confirm|Connect|Convert|ConvertFrom|ConvertTo|Copy|Debug|Deny|Disable|Disconnect|Dismount|Edit|Enable|Enter|Exit|Expand|Export|Find|ForEach|Format|Get|Grant|Group|Hide|Import|Initialize|Install|Invoke|Join|Limit|Lock|Measure|Merge|Move|New|Open|Optimize|Out|Ping|Pop|Protect|Publish|Push|Read|Receive|Redo|Register|Remove|Rename|Repair|Request|Reset|Resize|Resolve|Restart|Restore|Resume|Revoke|Save|Search|Select|Send|Set|Show|Skip|Sort|Split|Start|Step|Stop|Submit|Suspend|Switch|Sync|Tee|Test|Trace|Unblock|Undo|Uninstall|Unlock|Unprotect|Unpublish|Unregister|Update|Use|Wait|Watch|Where|Write)-[a-z]+\b/i,/\b(?:ac|cat|chdir|clc|cli|clp|clv|compare|copy|cp|cpi|cpp|cvpa|dbp|del|diff|dir|ebp|echo|epal|epcsv|epsn|erase|fc|fl|ft|fw|gal|gbp|gc|gci|gcs|gdr|gi|gl|gm|gp|gps|group|gsv|gu|gv|gwmi|iex|ii|ipal|ipcsv|ipsn|irm|iwmi|iwr|kill|lp|ls|measure|mi|mount|move|mp|mv|nal|ndr|ni|nv|ogv|popd|ps|pushd|pwd|rbp|rd|rdr|ren|ri|rm|rmdir|rni|rnp|rp|rv|rvpa|rwmi|sal|saps|sasv|sbp|sc|select|set|shcm|si|sl|sleep|sls|sort|sp|spps|spsv|start|sv|swmi|tee|trcm|type|write)\b/i],keyword:/\b(?:Begin|Break|Catch|Class|Continue|Data|Define|Do|DynamicParam|Else|ElseIf|End|Exit|Filter|Finally|For|ForEach|From|Function|If|InlineScript|Parallel|Param|Process|Return|Sequence|Switch|Throw|Trap|Try|Until|Using|Var|While|Workflow)\b/i,operator:{pattern:/(^|\W)(?:!|-(?:b?(?:and|x?or)|as|(?:Not)?(?:Contains|In|Like|Match)|eq|ge|gt|is(?:Not)?|Join|le|lt|ne|not|Replace|sh[lr])\b|-[-=]?|\+[+=]?|[*\/%]=?)/i,lookbehind:!0},punctuation:/[|{}[\];(),.]/};t.string[0].inside={function:{pattern:/(^|[^`])\$\((?:\$\([^\r\n()]*\)|(?!\$\()[^\r\n)])*\)/,lookbehind:!0,inside:t},boolean:t.boolean,variable:t.variable}})(Prism);var LE={},BE;function N$(){return BE||(BE=1,Prism.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/},Prism.languages.python["string-interpolation"].inside.interpolation.inside.rest=Prism.languages.python,Prism.languages.py=Prism.languages.python),LE}N$();var UE={},$E;function A$(){return $E||($E=1,(function(e){for(var t=/\/\*(?:[^*/]|\*(?!\/)|\/(?!\*)|<self>)*\*\//.source,r=0;r<2;r++)t=t.replace(/<self>/g,function(){return t});t=t.replace(/<self>/g,function(){return/[^\s\S]/.source}),e.languages.rust={comment:[{pattern:RegExp(/(^|[^\\])/.source+t),lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/b?"(?:\\[\s\S]|[^\\"])*"|b?r(#*)"(?:[^"]|"(?!\1))*"\1/,greedy:!0},char:{pattern:/b?'(?:\\(?:x[0-7][\da-fA-F]|u\{(?:[\da-fA-F]_*){1,6}\}|.)|[^\\\r\n\t'])'/,greedy:!0},attribute:{pattern:/#!?\[(?:[^\[\]"]|"(?:\\[\s\S]|[^\\"])*")*\]/,greedy:!0,alias:"attr-name",inside:{string:null}},"closure-params":{pattern:/([=(,:]\s*|\bmove\s*)\|[^|]*\||\|[^|]*\|(?=\s*(?:\{|->))/,lookbehind:!0,greedy:!0,inside:{"closure-punctuation":{pattern:/^\||\|$/,alias:"punctuation"},rest:null}},"lifetime-annotation":{pattern:/'\w+/,alias:"symbol"},"fragment-specifier":{pattern:/(\$\w+:)[a-z]+/,lookbehind:!0,alias:"punctuation"},variable:/\$\w+/,"function-definition":{pattern:/(\bfn\s+)\w+/,lookbehind:!0,alias:"function"},"type-definition":{pattern:/(\b(?:enum|struct|trait|type|union)\s+)\w+/,lookbehind:!0,alias:"class-name"},"module-declaration":[{pattern:/(\b(?:crate|mod)\s+)[a-z][a-z_\d]*/,lookbehind:!0,alias:"namespace"},{pattern:/(\b(?:crate|self|super)\s*)::\s*[a-z][a-z_\d]*\b(?:\s*::(?:\s*[a-z][a-z_\d]*\s*::)*)?/,lookbehind:!0,alias:"namespace",inside:{punctuation:/::/}}],keyword:[/\b(?:Self|abstract|as|async|await|become|box|break|const|continue|crate|do|dyn|else|enum|extern|final|fn|for|if|impl|in|let|loop|macro|match|mod|move|mut|override|priv|pub|ref|return|self|static|struct|super|trait|try|type|typeof|union|unsafe|unsized|use|virtual|where|while|yield)\b/,/\b(?:bool|char|f(?:32|64)|[ui](?:8|16|32|64|128|size)|str)\b/],function:/\b[a-z_]\w*(?=\s*(?:::\s*<|\())/,macro:{pattern:/\b\w+!/,alias:"property"},constant:/\b[A-Z_][A-Z_\d]+\b/,"class-name":/\b[A-Z]\w*\b/,namespace:{pattern:/(?:\b[a-z][a-z_\d]*\s*::\s*)*\b[a-z][a-z_\d]*\s*::(?!\s*<)/,inside:{punctuation:/::/}},number:/\b(?:0x[\dA-Fa-f](?:_?[\dA-Fa-f])*|0o[0-7](?:_?[0-7])*|0b[01](?:_?[01])*|(?:(?:\d(?:_?\d)*)?\.)?\d(?:_?\d)*(?:[Ee][+-]?\d+)?)(?:_?(?:f32|f64|[iu](?:8|16|32|64|size)?))?\b/,boolean:/\b(?:false|true)\b/,punctuation:/->|\.\.=|\.{1,3}|::|[{}[\];(),:]/,operator:/[-+*\/%!^]=?|=[=>]?|&[&=]?|\|[|=]?|<<?=?|>>?=?|[@?]/},e.languages.rust["closure-params"].inside.rest=e.languages.rust,e.languages.rust.attribute.inside.string=e.languages.rust.string})(Prism)),UE}A$();Prism.languages.swift={comment:{pattern:/(^|[^\\:])(?:\/\/.*|\/\*(?:[^/*]|\/(?!\*)|\*(?!\/)|\/\*(?:[^*]|\*(?!\/))*\*\/)*\*\/)/,lookbehind:!0,greedy:!0},"string-literal":[{pattern:RegExp(/(^|[^"#])/.source+"(?:"+/"(?:\\(?:\((?:[^()]|\([^()]*\))*\)|\r\n|[^(])|[^\\\r\n"])*"/.source+"|"+/"""(?:\\(?:\((?:[^()]|\([^()]*\))*\)|[^(])|[^\\"]|"(?!""))*"""/.source+")"+/(?!["#])/.source),lookbehind:!0,greedy:!0,inside:{interpolation:{pattern:/(\\\()(?:[^()]|\([^()]*\))*(?=\))/,lookbehind:!0,inside:null},"interpolation-punctuation":{pattern:/^\)|\\\($/,alias:"punctuation"},punctuation:/\\(?=[\r\n])/,string:/[\s\S]+/}},{pattern:RegExp(/(^|[^"#])(#+)/.source+"(?:"+/"(?:\\(?:#+\((?:[^()]|\([^()]*\))*\)|\r\n|[^#])|[^\\\r\n])*?"/.source+"|"+/"""(?:\\(?:#+\((?:[^()]|\([^()]*\))*\)|[^#])|[^\\])*?"""/.source+")\\2"),lookbehind:!0,greedy:!0,inside:{interpolation:{pattern:/(\\#+\()(?:[^()]|\([^()]*\))*(?=\))/,lookbehind:!0,inside:null},"interpolation-punctuation":{pattern:/^\)|\\#+\($/,alias:"punctuation"},string:/[\s\S]+/}}],directive:{pattern:RegExp(/#/.source+"(?:"+(/(?:elseif|if)\b/.source+"(?:[ 	]*"+/(?:![ \t]*)?(?:\b\w+\b(?:[ \t]*\((?:[^()]|\([^()]*\))*\))?|\((?:[^()]|\([^()]*\))*\))(?:[ \t]*(?:&&|\|\|))?/.source+")+")+"|"+/(?:else|endif)\b/.source+")"),alias:"property",inside:{"directive-name":/^#\w+/,boolean:/\b(?:false|true)\b/,number:/\b\d+(?:\.\d+)*\b/,operator:/!|&&|\|\||[<>]=?/,punctuation:/[(),]/}},literal:{pattern:/#(?:colorLiteral|column|dsohandle|file(?:ID|Literal|Path)?|function|imageLiteral|line)\b/,alias:"constant"},"other-directive":{pattern:/#\w+\b/,alias:"property"},attribute:{pattern:/@\w+/,alias:"atrule"},"function-definition":{pattern:/(\bfunc\s+)\w+/,lookbehind:!0,alias:"function"},label:{pattern:/\b(break|continue)\s+\w+|\b[a-zA-Z_]\w*(?=\s*:\s*(?:for|repeat|while)\b)/,lookbehind:!0,alias:"important"},keyword:/\b(?:Any|Protocol|Self|Type|actor|as|assignment|associatedtype|associativity|async|await|break|case|catch|class|continue|convenience|default|defer|deinit|didSet|do|dynamic|else|enum|extension|fallthrough|fileprivate|final|for|func|get|guard|higherThan|if|import|in|indirect|infix|init|inout|internal|is|isolated|lazy|left|let|lowerThan|mutating|none|nonisolated|nonmutating|open|operator|optional|override|postfix|precedencegroup|prefix|private|protocol|public|repeat|required|rethrows|return|right|safe|self|set|some|static|struct|subscript|super|switch|throw|throws|try|typealias|unowned|unsafe|var|weak|where|while|willSet)\b/,boolean:/\b(?:false|true)\b/,nil:{pattern:/\bnil\b/,alias:"constant"},"short-argument":/\$\d+\b/,omit:{pattern:/\b_\b/,alias:"keyword"},number:/\b(?:[\d_]+(?:\.[\de_]+)?|0x[a-f0-9_]+(?:\.[a-f0-9p_]+)?|0b[01_]+|0o[0-7_]+)\b/i,"class-name":/\b[A-Z](?:[A-Z_\d]*[a-z]\w*)?\b/,function:/\b[a-z_]\w*(?=\s*\()/i,constant:/\b(?:[A-Z_]{2,}|k[A-Z][A-Za-z_]+)\b/,operator:/[-+*/%=!<>&|^~?]+|\.[.\-+*/%=!<>&|^~?]+/,punctuation:/[{}[\]();,.:\\]/};Prism.languages.swift["string-literal"].forEach(function(e){e.inside.interpolation.inside=Prism.languages.swift});var WE={},zE;function j$(){return zE||(zE=1,(function(e){e.languages.typescript=e.languages.extend("javascript",{"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|type)\s+)(?!keyof\b)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?:\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>)?/,lookbehind:!0,greedy:!0,inside:null},builtin:/\b(?:Array|Function|Promise|any|boolean|console|never|number|string|symbol|unknown)\b/}),e.languages.typescript.keyword.push(/\b(?:abstract|declare|is|keyof|readonly|require)\b/,/\b(?:asserts|infer|interface|module|namespace|type)\b(?=\s*(?:[{_$a-zA-Z\xA0-\uFFFF]|$))/,/\btype\b(?=\s*(?:[\{*]|$))/),delete e.languages.typescript.parameter,delete e.languages.typescript["literal-property"];var t=e.languages.extend("typescript",{});delete t["class-name"],e.languages.typescript["class-name"].inside=t,e.languages.insertBefore("typescript","function",{decorator:{pattern:/@[$\w\xA0-\uFFFF]+/,inside:{at:{pattern:/^@/,alias:"operator"},function:/^[\s\S]+/}},"generic-function":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>(?=\s*\()/,greedy:!0,inside:{function:/^#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:t}}}}),e.languages.ts=e.languages.typescript})(Prism)),WE}j$();var HE={},GE;function F$(){return GE||(GE=1,(function(e){var t=/\b(?:abstract|assert|boolean|break|byte|case|catch|char|class|const|continue|default|do|double|else|enum|exports|extends|final|finally|float|for|goto|if|implements|import|instanceof|int|interface|long|module|native|new|non-sealed|null|open|opens|package|permits|private|protected|provides|public|record(?!\s*[(){}[\]<>=%~.:,;?+\-*/&|^])|requires|return|sealed|short|static|strictfp|super|switch|synchronized|this|throw|throws|to|transient|transitive|try|uses|var|void|volatile|while|with|yield)\b/,r=/(?:[a-z]\w*\s*\.\s*)*(?:[A-Z]\w*\s*\.\s*)*/.source,n={pattern:RegExp(/(^|[^\w.])/.source+r+/[A-Z](?:[\d_A-Z]*[a-z]\w*)?\b/.source),lookbehind:!0,inside:{namespace:{pattern:/^[a-z]\w*(?:\s*\.\s*[a-z]\w*)*(?:\s*\.)?/,inside:{punctuation:/\./}},punctuation:/\./}};e.languages.java=e.languages.extend("clike",{string:{pattern:/(^|[^\\])"(?:\\.|[^"\\\r\n])*"/,lookbehind:!0,greedy:!0},"class-name":[n,{pattern:RegExp(/(^|[^\w.])/.source+r+/[A-Z]\w*(?=\s+\w+\s*[;,=()]|\s*(?:\[[\s,]*\]\s*)?::\s*new\b)/.source),lookbehind:!0,inside:n.inside},{pattern:RegExp(/(\b(?:class|enum|extends|implements|instanceof|interface|new|record|throws)\s+)/.source+r+/[A-Z]\w*\b/.source),lookbehind:!0,inside:n.inside}],keyword:t,function:[e.languages.clike.function,{pattern:/(::\s*)[a-z_]\w*/,lookbehind:!0}],number:/\b0b[01][01_]*L?\b|\b0x(?:\.[\da-f_p+-]+|[\da-f_]+(?:\.[\da-f_p+-]+)?)\b|(?:\b\d[\d_]*(?:\.[\d_]*)?|\B\.\d[\d_]*)(?:e[+-]?\d[\d_]*)?[dfl]?/i,operator:{pattern:/(^|[^.])(?:<<=?|>>>?=?|->|--|\+\+|&&|\|\||::|[?:~]|[-+*/%&|^!=<>]=?)/m,lookbehind:!0},constant:/\b[A-Z][A-Z_\d]+\b/}),e.languages.insertBefore("java","string",{"triple-quoted-string":{pattern:/"""[ \t]*[\r\n](?:(?:"|"")?(?:\\.|[^"\\]))*"""/,greedy:!0,alias:"string"},char:{pattern:/'(?:\\.|[^'\\\r\n]){1,6}'/,greedy:!0}}),e.languages.insertBefore("java","class-name",{annotation:{pattern:/(^|[^.])@\w+(?:\s*\.\s*\w+)*/,lookbehind:!0,alias:"punctuation"},generics:{pattern:/<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&))*>)*>)*>)*>/,inside:{"class-name":n,keyword:t,punctuation:/[<>(),.:]/,operator:/[?&|]/}},import:[{pattern:RegExp(/(\bimport\s+)/.source+r+/(?:[A-Z]\w*|\*)(?=\s*;)/.source),lookbehind:!0,inside:{namespace:n.inside.namespace,punctuation:/\./,operator:/\*/,"class-name":/\w+/}},{pattern:RegExp(/(\bimport\s+static\s+)/.source+r+/(?:\w+|\*)(?=\s*;)/.source),lookbehind:!0,alias:"static",inside:{namespace:n.inside.namespace,static:/\b\w+$/,punctuation:/\./,operator:/\*/,"class-name":/\w+/}}],namespace:{pattern:RegExp(/(\b(?:exports|import(?:\s+static)?|module|open|opens|package|provides|requires|to|transitive|uses|with)\s+)(?!<keyword>)[a-z]\w*(?:\.[a-z]\w*)*\.?/.source.replace(/<keyword>/g,function(){return t.source})),lookbehind:!0,inside:{punctuation:/\./}}})})(Prism)),HE}F$();var VE={},KE;function P$(){return KE||(KE=1,(function(e){var t=/\b(?:alignas|alignof|asm|auto|bool|break|case|catch|char|char16_t|char32_t|char8_t|class|co_await|co_return|co_yield|compl|concept|const|const_cast|consteval|constexpr|constinit|continue|decltype|default|delete|do|double|dynamic_cast|else|enum|explicit|export|extern|final|float|for|friend|goto|if|import|inline|int|int16_t|int32_t|int64_t|int8_t|long|module|mutable|namespace|new|noexcept|nullptr|operator|override|private|protected|public|register|reinterpret_cast|requires|return|short|signed|sizeof|static|static_assert|static_cast|struct|switch|template|this|thread_local|throw|try|typedef|typeid|typename|uint16_t|uint32_t|uint64_t|uint8_t|union|unsigned|using|virtual|void|volatile|wchar_t|while)\b/,r=/\b(?!<keyword>)\w+(?:\s*\.\s*\w+)*\b/.source.replace(/<keyword>/g,function(){return t.source});e.languages.cpp=e.languages.extend("c",{"class-name":[{pattern:RegExp(/(\b(?:class|concept|enum|struct|typename)\s+)(?!<keyword>)\w+/.source.replace(/<keyword>/g,function(){return t.source})),lookbehind:!0},/\b[A-Z]\w*(?=\s*::\s*\w+\s*\()/,/\b[A-Z_]\w*(?=\s*::\s*~\w+\s*\()/i,/\b\w+(?=\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>\s*::\s*\w+\s*\()/],keyword:t,number:{pattern:/(?:\b0b[01']+|\b0x(?:[\da-f']+(?:\.[\da-f']*)?|\.[\da-f']+)(?:p[+-]?[\d']+)?|(?:\b[\d']+(?:\.[\d']*)?|\B\.[\d']+)(?:e[+-]?[\d']+)?)[ful]{0,4}/i,greedy:!0},operator:/>>=?|<<=?|->|--|\+\+|&&|\|\||[?:~]|<=>|[-+*/%&|^!=<>]=?|\b(?:and|and_eq|bitand|bitor|not|not_eq|or|or_eq|xor|xor_eq)\b/,boolean:/\b(?:false|true)\b/}),e.languages.insertBefore("cpp","string",{module:{pattern:RegExp(/(\b(?:import|module)\s+)/.source+"(?:"+/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|<[^<>\r\n]*>/.source+"|"+/<mod-name>(?:\s*:\s*<mod-name>)?|:\s*<mod-name>/.source.replace(/<mod-name>/g,function(){return r})+")"),lookbehind:!0,greedy:!0,inside:{string:/^[<"][\s\S]+/,operator:/:/,punctuation:/\./}},"raw-string":{pattern:/R"([^()\\ ]{0,16})\([\s\S]*?\)\1"/,alias:"string",greedy:!0}}),e.languages.insertBefore("cpp","keyword",{"generic-function":{pattern:/\b(?!operator\b)[a-z_]\w*\s*<(?:[^<>]|<[^<>]*>)*>(?=\s*\()/i,inside:{function:/^\w+/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:e.languages.cpp}}}}),e.languages.insertBefore("cpp","operator",{"double-colon":{pattern:/::/,alias:"punctuation"}}),e.languages.insertBefore("cpp","class-name",{"base-clause":{pattern:/(\b(?:class|struct)\s+\w+\s*:\s*)[^;{}"'\s]+(?:\s+[^;{}"'\s]+)*(?=\s*[;{])/,lookbehind:!0,greedy:!0,inside:e.languages.extend("cpp",{})}}),e.languages.insertBefore("inside","double-colon",{"class-name":/\b[a-z_]\w*\b(?!\s*::)/i},e.languages.cpp["base-clause"])})(Prism)),VE}P$();function Ej(e,t){for(const r of e.childNodes){if(Mn(r)&&r.tagName===t)return!0;Ej(r,t)}return!1}const bm="data-language",xm="data-highlight-language",m1="data-theme";class vf extends $a{static getType(){return"code"}static clone(t){return new vf(t.__language,t.__key)}constructor(t,r){super(r),this.__language=t||void 0,this.__isSyntaxHighlightSupported=!1,this.__theme=void 0}afterCloneFrom(t){super.afterCloneFrom(t),this.__language=t.__language,this.__theme=t.__theme,this.__isSyntaxHighlightSupported=t.__isSyntaxHighlightSupported}createDOM(t){const r=document.createElement("code");Us(r,t.theme.code),r.setAttribute("spellcheck","false");const n=this.getLanguage();n&&(r.setAttribute(bm,n),this.getIsSyntaxHighlightSupported()&&r.setAttribute(xm,n));const s=this.getTheme();s&&r.setAttribute(m1,s);const a=this.getStyle();return a&&r.setAttribute("style",a),r}updateDOM(t,r,n){const s=this.__language,a=t.__language;s?s!==a&&r.setAttribute(bm,s):a&&r.removeAttribute(bm);const i=this.__isSyntaxHighlightSupported;t.__isSyntaxHighlightSupported&&a?i&&s?s!==a&&r.setAttribute(xm,s):r.removeAttribute(xm):i&&s&&r.setAttribute(xm,s);const l=this.__theme,c=t.__theme;l?l!==c&&r.setAttribute(m1,l):c&&r.removeAttribute(m1);const d=this.__style,f=t.__style;return d?d!==f&&r.setAttribute("style",d):f&&r.removeAttribute("style"),!1}exportDOM(t){const r=document.createElement("pre");Us(r,t._config.theme.code),r.setAttribute("spellcheck","false");const n=this.getLanguage();n&&(r.setAttribute(bm,n),this.getIsSyntaxHighlightSupported()&&r.setAttribute(xm,n));const s=this.getTheme();s&&r.setAttribute(m1,s);const a=this.getStyle();return a&&r.setAttribute("style",a),{element:r}}static importDOM(){return{code:t=>t.textContent!=null&&(/\r?\n/.test(t.textContent)||Ej(t,"BR"))?{conversion:qE,priority:1}:null,div:()=>({conversion:R$,priority:1}),pre:()=>({conversion:qE,priority:0}),table:t=>Mw(t)?{conversion:D$,priority:3}:null,td:t=>{const r=t,n=r.closest("table");return r.classList.contains("js-file-line")||n&&Mw(n)?{conversion:XE,priority:3}:null},tr:t=>{const r=t.closest("table");return r&&Mw(r)?{conversion:XE,priority:3}:null}}}static importJSON(t){return xc().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setLanguage(t.language).setTheme(t.theme)}exportJSON(){return{...super.exportJSON(),language:this.getLanguage(),theme:this.getTheme()}}insertNewAfter(t,r=!0){const n=this.getChildren(),s=n.length;if(s>=2&&n[s-1].getTextContent()===`
`&&n[s-2].getTextContent()===`
`&&t.isCollapsed()&&t.anchor.key===this.__key&&t.anchor.offset===s){n[s-1].remove(),n[s-2].remove();const c=In();return this.insertAfter(c,r),c}const{anchor:a,focus:i}=t,l=(a.isBefore(i)?a:i).getNode();if(qt(l)){let c=M$(l);const d=[];for(;;)if(By(c))d.push(_0()),c=c.getNextSibling();else{if(!jj(c))break;{let b=0;const E=c.getTextContent(),k=c.getTextContentSize();for(;b<k&&E[b]===" ";)b++;if(b!==0&&d.push(Aj(" ".repeat(b))),b!==k)break;c=c.getNextSibling()}}const f=l.splitText(a.offset)[0],p=a.offset===0?0:1,g=f.getIndexWithinParent()+p,y=l.getParentOrThrow(),v=[Fl(),...d];y.splice(g,0,v);const _=d[d.length-1];_?_.select():a.offset===0?f.selectPrevious():f.getNextSibling().selectNext(0,0)}if(tS(l)){const{offset:c}=t.anchor;l.splice(c,0,[Fl()]),l.select(c+1,c+1)}return null}canIndent(){return!1}collapseAtStart(){const t=In();return this.getChildren().forEach((r=>t.append(r))),this.replace(t),!0}setLanguage(t){const r=this.getWritable();return r.__language=t||void 0,r}getLanguage(){return this.getLatest().__language}setIsSyntaxHighlightSupported(t){const r=this.getWritable();return r.__isSyntaxHighlightSupported=t,r}getIsSyntaxHighlightSupported(){return this.getLatest().__isSyntaxHighlightSupported}setTheme(t){const r=this.getWritable();return r.__theme=t||void 0,r}getTheme(){return this.getLatest().__theme}}function xc(e,t){return rU(vf).setLanguage(e).setTheme(t)}function tS(e){return e instanceof vf}function qE(e){return{node:xc(e.getAttribute(bm))}}function R$(e){const t=e,r=YE(t);return r||(function(n){let s=n.parentElement;for(;s!==null;){if(YE(s))return!0;s=s.parentElement}return!1})(t)?{node:r?xc():null}:{node:null}}function D$(){return{node:xc()}}function XE(){return{node:null}}function YE(e){return e.style.fontFamily.match("monospace")!==null}function Mw(e){return e.classList.contains("js-file-line-container")}let Xy=class Nj extends Vu{constructor(t="",r,n){super(t,n),this.__highlightType=r}static getType(){return"code-highlight"}static clone(t){return new Nj(t.__text,t.__highlightType||void 0,t.__key)}getHighlightType(){return this.getLatest().__highlightType}setHighlightType(t){const r=this.getWritable();return r.__highlightType=t||void 0,r}canHaveFormat(){return!1}createDOM(t){const r=super.createDOM(t),n=Ow(t.theme,this.__highlightType);return Us(r,n),r}updateDOM(t,r,n){const s=super.updateDOM(t,r,n),a=Ow(n.theme,t.__highlightType),i=Ow(n.theme,this.__highlightType);return a!==i&&(a&&Ru(r,a),i&&Us(r,i)),s}static importJSON(t){return Aj().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setHighlightType(t.highlightType)}exportJSON(){return{...super.exportJSON(),highlightType:this.getHighlightType()}}setFormat(t){return this}isParentRequired(){return!0}createParentElementNode(){return xc()}};function Ow(e,t){return t&&e&&e.codeHighlight&&e.codeHighlight[t]}function Aj(e="",t){return li(new Xy(e,t))}function jj(e){return e instanceof Xy}function I$(e,t){let r=e;for(let n=ba(e,t);n&&(jj(n.origin)||By(n.origin));n=TU(n))r=n.origin;return r}function M$(e){return I$(e,"previous")}(function(e){e.languages.diff={coord:[/^(?:\*{3}|-{3}|\+{3}).*$/m,/^@@.*@@$/m,/^\d.*$/m]};var t={"deleted-sign":"-","deleted-arrow":"<","inserted-sign":"+","inserted-arrow":">",unchanged:" ",diff:"!"};Object.keys(t).forEach((function(r){var n=t[r],s=[];/^\w+$/.test(r)||s.push(/\w+/.exec(r)[0]),r==="diff"&&s.push("bold"),e.languages.diff[r]={pattern:RegExp("^(?:["+n+`].*(?:\r
?|
|(?![\\s\\S])))+`,"m"),alias:s,inside:{line:{pattern:/(.)(?=[\s\S]).*(?:\r\n?|\n)?/,lookbehind:!0},prefix:{pattern:/[\s\S]/,alias:/\w+/.exec(r)[0]}}}})),Object.defineProperty(e.languages.diff,"PREFIXES",{value:t})})(Prism);const O$=new Set(["http:","https:","mailto:","sms:","tel:"]);class Xu extends $a{static getType(){return"link"}static clone(t){return new Xu(t.__url,{rel:t.__rel,target:t.__target,title:t.__title},t.__key)}constructor(t="",r={},n){super(n);const{target:s=null,rel:a=null,title:i=null}=r;this.__url=t,this.__target=s,this.__rel=a,this.__title=i}createDOM(t){const r=document.createElement("a");return this.updateLinkDOM(null,r,t),Us(r,t.theme.link),r}updateLinkDOM(t,r,n){if(zA(r)){t&&t.__url===this.__url||(r.href=this.sanitizeUrl(this.__url));for(const s of["target","rel","title"]){const a=`__${s}`,i=this[a];t&&t[a]===i||(i?r[s]=i:r.removeAttribute(s))}}}updateDOM(t,r,n){return this.updateLinkDOM(t,r,n),!1}static importDOM(){return{a:t=>({conversion:L$,priority:1})}}static importJSON(t){return cy().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setURL(t.url).setRel(t.rel||null).setTarget(t.target||null).setTitle(t.title||null)}sanitizeUrl(t){t=JE(t);try{const r=new URL(JE(t));if(!O$.has(r.protocol))return"about:blank"}catch{return t}return t}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(t){const r=this.getWritable();return r.__url=t,r}getTarget(){return this.getLatest().__target}setTarget(t){const r=this.getWritable();return r.__target=t,r}getRel(){return this.getLatest().__rel}setRel(t){const r=this.getWritable();return r.__rel=t,r}getTitle(){return this.getLatest().__title}setTitle(t){const r=this.getWritable();return r.__title=t,r}insertNewAfter(t,r=!0){const n=cy(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(n,r),n}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(t,r,n){if(!Nt(r))return!1;const s=r.anchor.getNode(),a=r.focus.getNode();return this.isParentOf(s)&&this.isParentOf(a)&&r.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}}function L$(e){let t=null;if(zA(e)){const r=e.textContent;(r!==null&&r!==""||e.children.length>0)&&(t=cy(e.getAttribute("href")||"",{rel:e.getAttribute("rel"),target:e.getAttribute("target"),title:e.getAttribute("title")}))}return{node:t}}function cy(e="",t){return li(new Xu(e,t))}function B$(e){return e instanceof Xu}class N0 extends Xu{constructor(t="",r={},n){super(t,r,n),this.__isUnlinked=r.isUnlinked!==void 0&&r.isUnlinked!==null&&r.isUnlinked}static getType(){return"autolink"}static clone(t){return new N0(t.__url,{isUnlinked:t.__isUnlinked,rel:t.__rel,target:t.__target,title:t.__title},t.__key)}getIsUnlinked(){return this.__isUnlinked}setIsUnlinked(t){const r=this.getWritable();return r.__isUnlinked=t,r}createDOM(t){return this.__isUnlinked?document.createElement("span"):super.createDOM(t)}updateDOM(t,r,n){return super.updateDOM(t,r,n)||t.__isUnlinked!==this.__isUnlinked}static importJSON(t){return QE().updateFromJSON(t)}updateFromJSON(t){return super.updateFromJSON(t).setIsUnlinked(t.isUnlinked||!1)}static importDOM(){return null}exportJSON(){return{...super.exportJSON(),isUnlinked:this.__isUnlinked}}insertNewAfter(t,r=!0){const n=this.getParentOrThrow().insertNewAfter(t,r);if(vt(n)){const s=QE(this.__url,{isUnlinked:this.__isUnlinked,rel:this.__rel,target:this.__target,title:this.__title});return n.append(s),s}return null}}function QE(e="",t){return li(new N0(e,t))}function U$(e){return e instanceof N0}const $$=/^\+?[0-9\s()-]{5,}$/;function JE(e){return e.match(/^[a-z][a-z0-9+.-]*:/i)||e.match(/^[/#.]/)?e:e.includes("@")?`mailto:${e}`:$$.test(e)?`tel:${e}`:`https://${e}`}function i2(e,t){const r={};for(const n of e){const s=t(n);s&&(r[s]?r[s].push(n):r[s]=[n])}return r}function W$(e){const t=i2(e,(r=>r.type));return{element:t.element||[],multilineElement:t["multiline-element"]||[],textFormat:t["text-format"]||[],textMatch:t["text-match"]||[]}}const ZE=/[!-/:-@[-`{-~\s]/;function z$(e){return qt(e)&&!e.hasFormat("code")}function H$(e,...t){const r=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(const s of t)n.append("v",s);throw r.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function eN(e,t,r){const n=r.length;for(let s=t;s>=n;s--){const a=s-n;if(Fj(e,a,r,0,n)&&e[a+n]!==" ")return a}return-1}function Fj(e,t,r,n,s){for(let a=0;a<s;a++)if(e[t+a]!==r[n+a])return!1;return!0}function G$(e,t=Yy){const r=W$(t),n=i2(r.textFormat,(({tag:i})=>i[i.length-1])),s=i2(r.textMatch,(({trigger:i})=>i));for(const i of t){const l=i.type;if(l==="element"||l==="text-match"||l==="multiline-element"){const c=i.dependencies;for(const d of c)e.hasNode(d)||H$(173,d.getType())}}const a=(i,l,c)=>{(function(d,f,p,g){const y=d.getParent();if(!ii(y)||d.getFirstChild()!==f)return!1;const v=f.getTextContent();if(v[p-1]!==" ")return!1;for(const{regExp:_,replace:b}of g){const E=v.match(_);if(E&&E[0].length===(E[0].endsWith(" ")?p:p-1)){const k=f.getNextSiblings(),[w,N]=f.splitText(p);if(b(d,N?[N,...k]:k,E,!1)!==!1)return w.remove(),!0}}return!1})(i,l,c,r.element)||(function(d,f,p,g){const y=d.getParent();if(!ii(y)||d.getFirstChild()!==f)return!1;const v=f.getTextContent();if(v[p-1]!==" ")return!1;for(const{regExpStart:_,replace:b,regExpEnd:E}of g){if(E&&!("optional"in E)||E&&"optional"in E&&!E.optional)continue;const k=v.match(_);if(k&&k[0].length===(k[0].endsWith(" ")?p:p-1)){const w=f.getNextSiblings(),[N,A]=f.splitText(p);if(b(d,A?[A,...w]:w,k,null,null,!1)!==!1)return N.remove(),!0}}return!1})(i,l,c,r.multilineElement)||(function(d,f,p){let g=d.getTextContent();const y=p[g[f-1]];if(y==null)return!1;f<g.length&&(g=g.slice(0,f));for(const v of y){if(!v.replace||!v.regExp)continue;const _=g.match(v.regExp);if(_===null)continue;const b=_.index||0,E=b+_[0].length;let k;return b===0?[k]=d.splitText(E):[,k]=d.splitText(b,E),k.selectNext(0,0),v.replace(k,_),!0}return!1})(l,c,s)||(function(d,f,p){const g=d.getTextContent(),y=f-1,v=g[y],_=p[v];if(!_)return!1;for(const b of _){const{tag:E}=b,k=E.length,w=y-k+1;if(k>1&&!Fj(g,w,E,0,k)||g[w-1]===" ")continue;const N=g[y+1];if(b.intraword===!1&&N&&!ZE.test(N))continue;const A=d;let P=A,R=eN(g,w,E),T=P;for(;R<0&&(T=T.getPreviousSibling())&&!vc(T);)if(qt(T)){if(T.hasFormat("code"))continue;const M=T.getTextContent();P=T,R=eN(M,M.length,E)}if(R<0||P===A&&R+k===w)continue;const D=P.getTextContent();if(R>0&&D[R-1]===v)continue;const I=D[R-1];if(b.intraword===!1&&I&&!ZE.test(I))continue;const V=A.getTextContent(),X=V.slice(0,w)+V.slice(y+1);A.setTextContent(X);const Z=P===A?X:D;P.setTextContent(Z.slice(0,R)+Z.slice(R+k));const ie=Kt(),q=$y();Sa(q);const ne=y-k*(P===A?2:1)+1;q.anchor.set(P.__key,R,"text"),q.focus.set(A.__key,ne,"text");for(const M of b.format)q.hasFormat(M)||q.formatText(M);q.anchor.set(q.focus.key,q.focus.offset,q.focus.type);for(const M of b.format)q.hasFormat(M)&&q.toggleFormat(M);return Nt(ie)&&(q.format=ie.format),!0}})(l,c,n)};return e.registerUpdateListener((({tags:i,dirtyLeaves:l,editorState:c,prevEditorState:d})=>{if(i.has(jA)||i.has(ny)||e.isComposing())return;const f=c.read(Kt),p=d.read(Kt);if(!Nt(p)||!Nt(f)||!f.isCollapsed()||f.is(p))return;const g=f.anchor.key,y=f.anchor.offset,v=c._nodeMap.get(g);!qt(v)||!l.has(g)||y!==1&&y>p.anchor.offset+1||e.update((()=>{if(!z$(v))return;const _=v.getParent();_===null||tS(_)||a(_,v,f.anchor.offset)}))}))}const V$=/^(\s*)(\d{1,})\.\s/,K$=/^(\s*)[-*+]\s/,q$=/^(#{1,6})\s/,X$=/^>\s/,Y$=/^[ \t]*```([\w-]+)?/,Q$=/[ \t]*```$/,Pj=e=>(t,r,n,s)=>{const a=e(n);a.append(...r),t.replace(a),s||a.select(0,0)},Rj=e=>(t,r,n,s)=>{const a=t.getPreviousSibling(),i=t.getNextSibling(),l=$i(e==="check"?n[3]==="x":void 0);if(Ar(i)&&i.getListType()===e){const d=i.getFirstChild();d!==null?d.insertBefore(l):i.append(l),t.remove()}else if(Ar(a)&&a.getListType()===e)a.append(l),t.remove();else{const d=ki(e,e==="number"?Number(n[2]):void 0);d.append(l),t.replace(d)}l.append(...r),s||l.select(0,0);const c=(function(d){const f=d.match(/\t/g),p=d.match(/ /g);let g=0;return f&&(g+=f.length),p&&(g+=Math.floor(p.length/4)),g})(n[1]);c&&l.setIndent(c)},rS=(e,t,r)=>{const n=[],s=e.getChildren();let a=0;for(const i of s)if(ln(i)){if(i.getChildrenSize()===1){const f=i.getFirstChild();if(Ar(f)){n.push(rS(f,t,r+1));continue}}const l=" ".repeat(4*r),c=e.getListType(),d=c==="number"?`${e.getStart()+a}. `:c==="check"?`- [${i.getChecked()?"x":" "}] `:"- ";n.push(l+d+t(i)),a++}return n.join(`
`)},J$={dependencies:[Bp],export:(e,t)=>{if(!qU(e))return null;const r=Number(e.getTag().slice(1));return"#".repeat(r)+" "+t(e)},regExp:q$,replace:Pj((e=>{const t="h"+e[1].length;return Tu(t)})),type:"element"},Z$={dependencies:[Op],export:(e,t)=>{if(!wE(e))return null;const r=t(e).split(`
`),n=[];for(const s of r)n.push("> "+s);return n.join(`
`)},regExp:X$,replace:(e,t,r,n)=>{if(n){const a=e.getPreviousSibling();if(wE(a))return a.splice(a.getChildrenSize(),0,[Fl(),...t]),void e.remove()}const s=Lp();s.append(...t),e.replace(s),n||s.select(0,0)},type:"element"},eW={dependencies:[vf],export:e=>{if(!tS(e))return null;const t=e.getTextContent();return"```"+(e.getLanguage()||"")+(t?`
`+t:"")+"\n```"},regExpEnd:{optional:!0,regExp:Q$},regExpStart:Y$,replace:(e,t,r,n,s,a)=>{let i,l;if(!t&&s){if(s.length===1)n?(i=xc(),l=r[1]+s[0]):(i=xc(r[1]),l=s[0].startsWith(" ")?s[0].slice(1):s[0]);else{if(i=xc(r[1]),s[0].trim().length===0)for(;s.length>0&&!s[0].length;)s.shift();else s[0]=s[0].startsWith(" ")?s[0].slice(1):s[0];for(;s.length>0&&!s[s.length-1].length;)s.pop();l=s.join(`
`)}const c=rs(l);i.append(c),e.append(i)}else t&&Pj((c=>xc(c?c[1]:void 0)))(e,t,r,a)},type:"multiline-element"},tW={dependencies:[qu,Ac],export:(e,t)=>Ar(e)?rS(e,t,0):null,regExp:K$,replace:Rj("bullet"),type:"element"},rW={dependencies:[qu,Ac],export:(e,t)=>Ar(e)?rS(e,t,0):null,regExp:V$,replace:Rj("number"),type:"element"},nW={format:["code"],tag:"`",type:"text-format"},sW={format:["highlight"],tag:"==",type:"text-format"},aW={format:["bold","italic"],tag:"***",type:"text-format"},iW={format:["bold","italic"],intraword:!1,tag:"___",type:"text-format"},oW={format:["bold"],tag:"**",type:"text-format"},lW={format:["bold"],intraword:!1,tag:"__",type:"text-format"},cW={format:["strikethrough"],tag:"~~",type:"text-format"},uW={format:["italic"],tag:"*",type:"text-format"},dW={format:["italic"],intraword:!1,tag:"_",type:"text-format"},fW={dependencies:[Xu],export:(e,t,r)=>{if(!B$(e)||U$(e))return null;const n=e.getTitle(),s=t(e);return n?`[${s}](${e.getURL()} "${n}")`:`[${s}](${e.getURL()})`},importRegExp:/(?:\[(.*?)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))/,regExp:/(?:\[(.*?)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))$/,replace:(e,t)=>{const[,r,n,s]=t,a=cy(n,{title:s}),i=r.split("[").length-1,l=r.split("]").length-1;let c=r,d="";if(i<l)return;if(i>l){const p=r.split("[");d="["+p[0],c=p.slice(1).join("[")}const f=rs(c);return f.setFormat(e.getFormat()),a.append(f),e.replace(a),d&&a.insertBefore(rs(d)),f},trigger:")",type:"text-match"},hW=[J$,Z$,tW,rW],gW=[eW],mW=[nW,aW,iW,oW,lW,sW,uW,dW,cW],pW=[fW],Yy=[...hW,...gW,...mW,...pW];function tN(e,t){return e.getEditorState().read((()=>{const r=Fs(t);return r!==null&&r.isSelected()}))}function xW(e){const[t]=Rl(),[r,n]=C.useState((()=>tN(t,e)));return C.useEffect((()=>{let s=!0;const a=t.registerUpdateListener((()=>{s&&n(tN(t,e))}));return()=>{s=!1,a()}}),[t,e]),[r,C.useCallback((s=>{t.update((()=>{let a=Kt();Pa(a)||(a=kb(),Sa(a)),Pa(a)&&(s?a.add(e):a.delete(e))}))}),[t,e]),C.useCallback((()=>{t.update((()=>{const s=Kt();Pa(s)&&s.clear()}))}),[t])]}function yW({nodeKey:e}){const[t]=Rl(),[r,n,s]=xW(e);return C.useEffect((()=>yf(t.registerCommand(yb,(a=>{const i=t.getElementByKey(e);return a.target===i&&(a.shiftKey||s(),n(!r),!0)}),Ph))),[s,t,r,e,n]),C.useEffect((()=>{const a=t.getElementByKey(e),i=t._config.theme.hrSelected??"selected";a!==null&&(r?Us(a,i):Ru(a,i))}),[t,r,e]),null}class $p extends Eb{static getType(){return"horizontalrule"}static clone(t){return new $p(t.__key)}static importJSON(t){return nS().updateFromJSON(t)}static importDOM(){return{hr:()=>({conversion:vW,priority:0})}}exportDOM(){return{element:document.createElement("hr")}}createDOM(t){const r=document.createElement("hr");return Us(r,t.theme.hr),r}getTextContent(){return`
`}isInline(){return!1}updateDOM(){return!1}decorate(){return o.jsx(yW,{nodeKey:this.__key})}}function vW(){return{node:nS()}}function nS(){return li(new $p)}function wW(e){return e instanceof $p}const _W=[{dependencies:[$p],export:e=>wW(e)?"***":null,regExp:/^(---|\*\*\*|___)\s?$/,replace:(e,t,r,n)=>{const s=nS();n||e.getNextSibling()!=null?e.replace(s):e.insertBefore(s),s.selectNext()},type:"element"},...Yy];function Dj({transformers:e=_W}){const[t]=Rl();return C.useEffect((()=>G$(t,e)),[t,e]),null}function Ij({hasStrictIndent:e=!1}){const[t]=Rl();return C.useEffect((()=>{if(!t.hasNodes([qu,Ac]))throw new Error("ListPlugin: ListNode and/or ListItemNode not registered on editor")}),[t]),C.useEffect((()=>{if(e)return T$(t)}),[t,e]),(function(r){C.useEffect((()=>C$(r)),[r])})(t),null}const bW=({onChange:e})=>{const[t]=C.useContext(v0)||[];return C.useEffect(()=>{if(e&&t)return t.registerUpdateListener(({editorState:r})=>{r.read(()=>{zn().getTextContent();const s=r.toJSON();e(JSON.stringify(s))})})},[t,e]),null},SW=()=>{const[e]=C.useContext(v0)||[],t=C.useCallback(()=>{e&&e.dispatchCommand(La,"bold")},[e]),r=C.useCallback(()=>{e&&e.dispatchCommand(La,"italic")},[e]),n=C.useCallback(()=>{e&&e.dispatchCommand(La,"underline")},[e]),s=C.useCallback(()=>{e&&e.dispatchCommand(La,"strikethrough")},[e]),a=C.useCallback(y=>{e&&e.update(()=>{const v=Kt();Nt(v)&&Yh(v,()=>Tu(y))})},[e]),i=C.useCallback(()=>{e&&e.update(()=>{const y=Kt();Nt(y)&&Yh(y,()=>In())})},[e]);C.useCallback(()=>{e&&e.update(()=>{const y=Kt();Nt(y)&&Yh(y,()=>Lp())})},[e]);const l=C.useCallback(()=>{e&&e.dispatchCommand(Jb)},[e]),c=C.useCallback(()=>{e&&e.dispatchCommand(Zb)},[e]),d=C.useCallback(()=>{e&&e.dispatchCommand(eS)},[e]),f=C.useCallback(y=>{e&&e.update(()=>{const v=Kt();Nt(v)&&v.getNodes().forEach(_=>{qt(_)&&_.setStyle(`color: ${y}`)})})},[e]),p=C.useCallback(y=>{e&&e.update(()=>{const v=Kt();Nt(v)&&v.getNodes().forEach(b=>{if(qt(b)){const E=b.getStyle(),k=E?E.replace(/font-size:\s*\d+px;?\s*/g,"").trim():"",w=k?`${k}; font-size: ${y}px;`:`font-size: ${y}px;`;b.setStyle(w)}})})},[e]),g=C.useCallback(y=>{e&&e.dispatchCommand(lA,y)},[e]);return o.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 border-b border-gray-300 bg-gray-50",children:[o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:t,className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Bold",children:"B"}),o.jsx("button",{type:"button",onClick:r,className:"px-2 py-1 text-sm italic border border-gray-300 rounded hover:bg-gray-200",title:"Italic",children:"I"}),o.jsx("button",{type:"button",onClick:n,className:"px-2 py-1 text-sm underline border border-gray-300 rounded hover:bg-gray-200",title:"Underline",children:"U"}),o.jsx("button",{type:"button",onClick:s,className:"px-2 py-1 text-sm line-through border border-gray-300 rounded hover:bg-gray-200",title:"Strikethrough",children:"S"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:()=>a("h1"),className:"px-2 py-1 text-xs font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 1",children:"H1"}),o.jsx("button",{type:"button",onClick:()=>a("h2"),className:"px-2 py-1 text-xs font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 2",children:"H2"}),o.jsx("button",{type:"button",onClick:()=>a("h3"),className:"px-2 py-1 text-xs font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 3",children:"H3"}),o.jsx("button",{type:"button",onClick:i,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Paragraph",children:"P"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:l,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Bullet List",children:"• List"}),o.jsx("button",{type:"button",onClick:c,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Numbered List",children:"1. List"}),o.jsx("button",{type:"button",onClick:d,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Remove List",children:"No List"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Color:"}),o.jsx("button",{type:"button",onClick:()=>f("#000000"),className:"w-6 h-6 bg-black border border-gray-300 rounded hover:bg-gray-800",title:"Black"}),o.jsx("button",{type:"button",onClick:()=>f("#ff0000"),className:"w-6 h-6 bg-red-500 border border-gray-300 rounded hover:bg-red-600",title:"Red"}),o.jsx("button",{type:"button",onClick:()=>f("#0000ff"),className:"w-6 h-6 bg-blue-500 border border-gray-300 rounded hover:bg-blue-600",title:"Blue"}),o.jsx("button",{type:"button",onClick:()=>f("#008000"),className:"w-6 h-6 bg-green-500 border border-gray-300 rounded hover:bg-green-600",title:"Green"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Size:"}),o.jsx("button",{type:"button",onClick:()=>p(12),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Small",children:"12px"}),o.jsx("button",{type:"button",onClick:()=>p(16),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Normal",children:"16px"}),o.jsx("button",{type:"button",onClick:()=>p(20),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Large",children:"20px"}),o.jsx("button",{type:"button",onClick:()=>p(24),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Extra Large",children:"24px"})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Align:"}),o.jsx("button",{type:"button",onClick:()=>g("left"),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Align Left",children:"←"}),o.jsx("button",{type:"button",onClick:()=>g("center"),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Align Center",children:"↔"}),o.jsx("button",{type:"button",onClick:()=>g("right"),className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-200",title:"Align Right",children:"→"})]})]})},kW=({value:e,onChange:t,placeholder:r})=>{const n={namespace:"LexicalEditor",theme:{root:"p-4 min-h-32 focus:outline-none",paragraph:"mb-2",heading:{h1:"text-3xl font-bold mb-4",h2:"text-2xl font-bold mb-3",h3:"text-xl font-bold mb-2"},quote:"border-l-4 border-gray-300 pl-4 italic text-gray-600 mb-2",list:{nested:{listitem:"list-none"},ol:"list-decimal list-inside mb-2",ul:"list-disc list-inside mb-2",listitem:"mb-1"},text:{bold:"font-bold",italic:"italic",underline:"underline",strikethrough:"line-through"}},nodes:[Bp,qu,Ac,Op,vf,Xy,Up,T0,E0,N0,Xu],onError:s=>{console.error("Lexical error:",s)},editorState:e?(()=>{try{const s=JSON.parse(e);return JSON.stringify(s)}catch{return JSON.stringify({root:{children:[{children:[{detail:0,format:0,mode:"normal",style:"",text:e,type:"text",version:1}],direction:"ltr",format:"",indent:0,type:"paragraph",version:1}],direction:"ltr",format:"",indent:0,type:"root",version:1}})}})():void 0};return o.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:o.jsxs(XA,{initialConfig:n,children:[o.jsx(SW,{}),o.jsx(bW,{onChange:t}),o.jsxs("div",{className:"relative",children:[o.jsx(hj,{contentEditable:o.jsx(mj,{className:"p-4 min-h-32 focus:outline-none",placeholder:r}),placeholder:o.jsx("div",{className:"absolute top-4 left-4 text-gray-400 pointer-events-none",children:r}),ErrorBoundary:yj}),o.jsx(pj,{}),o.jsx(xj,{}),o.jsx(Ij,{}),o.jsx(Dj,{transformers:Yy})]})]})})},CW=({testName:e="",onTestSaved:t,onCancel:r,onBackToCabinet:n,isSaving:s=!1,validationErrors:a={}})=>{const{user:i}=Bn(),{post:l}=zi(),{showNotification:c}=ka(),[d,f]=C.useState({test_name:e,num_questions:1,passing_score:100,questions:[{id:1,question_json:"",canvas_width:600,canvas_height:800,max_canvas_width:1536,max_canvas_height:2048}]}),[p,g]=C.useState({isLoading:!1,error:null,showPreview:!0});C.useEffect(()=>{f(w=>({...w,test_name:e||""}))},[e]);const y=()=>{if(d.num_questions>=3){g(A=>({...A,error:"Maximum 3 questions allowed for performance reasons"}));return}const N={id:Math.max(...d.questions.map(A=>A.id))+1,question_json:"",canvas_width:600,canvas_height:800,max_canvas_width:1536,max_canvas_height:2048};f(A=>({...A,num_questions:A.num_questions+1,questions:[...A.questions,N]}))},v=w=>{d.questions.length<=1||f(N=>({...N,num_questions:N.num_questions-1,questions:N.questions.filter(A=>A.id!==w)}))},_=(w,N)=>{f(A=>({...A,questions:A.questions.map(P=>P.id===w?{...P,question_json:N}:P)}))},b=(w,N,A)=>{f(P=>({...P,questions:P.questions.map(R=>R.id===w?{...R,canvas_width:N,canvas_height:A}:R)}))},E=(w,N,A)=>{f(P=>({...P,questions:P.questions.map(R=>R.id===w?{...R,max_canvas_width:N,max_canvas_height:A}:R)}))},k=async()=>{if(!d.test_name.trim()){g(w=>({...w,error:"Test name is required"}));return}if(d.questions.some(w=>!w.question_json.trim())){g(w=>({...w,error:"All questions must have content"}));return}g(w=>({...w,isLoading:!0,error:null}));try{const w={test_name:d.test_name,num_questions:d.num_questions,passing_score:d.passing_score,questions:d.questions.map((N,A)=>({question_id:A+1,question_json:N.question_json,canvas_width:N.canvas_width,canvas_height:N.canvas_height,max_canvas_width:N.max_canvas_width,max_canvas_height:N.max_canvas_height}))};t&&t(w)}catch(w){console.error("Error preparing drawing test:",w),g(N=>({...N,error:"Failed to prepare drawing test. Please try again."})),c("Failed to prepare drawing test","error")}finally{g(w=>({...w,isLoading:!1}))}};return o.jsx("div",{className:"drawing-test-creator max-w-4xl mx-auto p-6",children:o.jsxs(kt,{className:"p-6",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Create Drawing Test"}),o.jsx("p",{className:"text-gray-600",children:"Create a test where students draw based on your instructions"})]}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Drawing Questions (",d.num_questions,"/3)"]}),o.jsx("p",{className:"text-sm text-gray-500",children:"Maximum 3 questions for optimal performance"})]}),o.jsxs(nt,{onClick:y,disabled:d.num_questions>=3,variant:"primary",size:"sm",className:"flex items-center gap-2",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),"Add Question"]})]}),o.jsx("div",{className:"space-y-4",children:d.questions.map((w,N)=>o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("h4",{className:"text-md font-medium text-gray-800",children:["Text ",N+1]}),d.questions.length>1&&o.jsx(nt,{onClick:()=>v(w.id),variant:"secondary",size:"sm",className:"text-red-600 hover:text-red-700",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Text Content *"}),o.jsx(kW,{value:w.question_json,onChange:A=>_(w.id,A),placeholder:""})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Canvas Dimensions"}),o.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Canvas is the actual drawing area, viewport is the initial display size"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Viewport Width"}),o.jsx("input",{type:"number",value:w.canvas_width,onChange:A=>b(w.id,parseInt(A.target.value),w.canvas_height),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"200",max:"2048"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Viewport Height"}),o.jsx("input",{type:"number",value:w.canvas_height,onChange:A=>b(w.id,w.canvas_width,parseInt(A.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"200",max:"2048"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Canvas Width"}),o.jsx("input",{type:"number",value:w.max_canvas_width,onChange:A=>E(w.id,parseInt(A.target.value),w.max_canvas_height),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"200",max:"4096"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Canvas Height"}),o.jsx("input",{type:"number",value:w.max_canvas_height,onChange:A=>E(w.id,w.max_canvas_width,parseInt(A.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"200",max:"4096"})]})]})]})]},w.id))})]}),p.error&&o.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg text-red-700",children:p.error}),o.jsxs("div",{className:"flex justify-end gap-3",children:[o.jsx(nt,{onClick:r,variant:"secondary",disabled:p.isLoading,children:"Cancel"}),o.jsx(nt,{onClick:k,variant:"primary",disabled:p.isLoading||!d.test_name.trim(),className:"flex items-center gap-2",children:p.isLoading?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",color:"white"}),"Saving..."]}):"Save Test"})]})]})})},TW=({onChange:e})=>{const[t]=C.useContext(v0)||[];return C.useEffect(()=>{if(e&&t)return t.registerUpdateListener(({editorState:r})=>{r.read(()=>{zn().getTextContent();const s=r.toJSON();e(JSON.stringify(s))})})},[t,e]),null},EW=({onAddBlank:e,blankCount:t})=>{const[r]=C.useContext(v0)||[],n=C.useCallback(()=>{r&&r.dispatchCommand(La,"bold")},[r]),s=C.useCallback(()=>{r&&r.dispatchCommand(La,"italic")},[r]),a=C.useCallback(()=>{r&&r.dispatchCommand(La,"underline")},[r]),i=C.useCallback(()=>{r&&r.dispatchCommand(La,"strikethrough")},[r]),l=C.useCallback(v=>{r&&r.update(()=>{const _=Kt();Nt(_)&&Yh(_,()=>Tu(v))})},[r]),c=C.useCallback(()=>{r&&r.update(()=>{const v=Kt();Nt(v)&&Yh(v,()=>In())})},[r]),d=C.useCallback(()=>{r&&r.update(()=>{const v=Kt();Nt(v)&&Yh(v,()=>Lp())})},[r]),f=C.useCallback(()=>{r&&r.dispatchCommand(Jb)},[r]),p=C.useCallback(()=>{r&&r.dispatchCommand(Zb)},[r]),g=C.useCallback(()=>{r&&r.dispatchCommand(eS)},[r]),y=C.useCallback(()=>{!r||!e||(r.update(()=>{const v=Kt();if(Nt(v)){const b=`${t+1}_________`,E=rs(b);E.setStyle("background-color: #f0f9ff; border: 1px dashed #3b82f6; padding: 2px 4px; border-radius: 4px; font-family: monospace;"),v.insertNodes([E])}}),e())},[r,e,t]);return o.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 border-b border-gray-300 bg-gray-50",children:[o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:n,className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Bold",children:"B"}),o.jsx("button",{type:"button",onClick:s,className:"px-2 py-1 text-sm italic border border-gray-300 rounded hover:bg-gray-200",title:"Italic",children:"I"}),o.jsx("button",{type:"button",onClick:a,className:"px-2 py-1 text-sm underline border border-gray-300 rounded hover:bg-gray-200",title:"Underline",children:"U"}),o.jsx("button",{type:"button",onClick:i,className:"px-2 py-1 text-sm line-through border border-gray-300 rounded hover:bg-gray-200",title:"Strikethrough",children:"S"})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:()=>l("h1"),className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 1",children:"H1"}),o.jsx("button",{type:"button",onClick:()=>l("h2"),className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 2",children:"H2"}),o.jsx("button",{type:"button",onClick:()=>l("h3"),className:"px-2 py-1 text-sm font-bold border border-gray-300 rounded hover:bg-gray-200",title:"Heading 3",children:"H3"}),o.jsx("button",{type:"button",onClick:c,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Paragraph",children:"P"}),o.jsx("button",{type:"button",onClick:d,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Quote",children:'"'})]}),o.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2",children:[o.jsx("button",{type:"button",onClick:f,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Bullet List",children:"•"}),o.jsx("button",{type:"button",onClick:p,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Numbered List",children:"1."}),o.jsx("button",{type:"button",onClick:g,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200",title:"Remove List",children:"↶"})]}),e&&o.jsx("div",{className:"flex items-center gap-1 border-l border-gray-300 pl-2",children:o.jsxs("button",{type:"button",onClick:y,className:"px-3 py-1 text-sm font-medium bg-blue-500 text-white border border-blue-600 rounded hover:bg-blue-600 transition-colors",title:"Add Blank",children:[o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",className:"inline mr-1",children:o.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),"Add Blank"]})})]})},NW=({value:e,onChange:t,placeholder:r,onAddBlank:n,blankCount:s=0})=>{const a={namespace:"FillBlanksLexicalEditor",theme:{root:"p-4 min-h-32 focus:outline-none",paragraph:"mb-2",heading:{h1:"text-3xl font-bold mb-4",h2:"text-2xl font-bold mb-3",h3:"text-xl font-bold mb-2"},quote:"border-l-4 border-gray-300 pl-4 italic text-gray-600 mb-2",list:{nested:{listitem:"list-none"},ol:"list-decimal list-inside mb-2",ul:"list-disc list-inside mb-2",listitem:"mb-1"},text:{bold:"font-bold",italic:"italic",underline:"underline",strikethrough:"line-through"}},nodes:[Bp,qu,Ac,Op,vf,Xy,Up,T0,E0,N0,Xu],onError:i=>{console.error("Lexical error:",i)},editorState:e?(()=>{try{const i=JSON.parse(e);return JSON.stringify(i)}catch{return JSON.stringify({root:{children:[{children:[{detail:0,format:0,mode:"normal",style:"",text:e,type:"text",version:1}],direction:"ltr",format:"",indent:0,type:"paragraph",version:1}],direction:"ltr",format:"",indent:0,type:"root",version:1}})}})():void 0};return o.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:o.jsxs(XA,{initialConfig:a,children:[o.jsx(EW,{onAddBlank:n,blankCount:s}),o.jsx(TW,{onChange:t}),o.jsxs("div",{className:"relative",children:[o.jsx(hj,{contentEditable:o.jsx(mj,{className:"p-4 min-h-32 focus:outline-none"}),placeholder:o.jsx("div",{className:"absolute top-4 left-4 text-gray-400 pointer-events-none",children:r}),ErrorBoundary:yj}),o.jsx(pj,{}),o.jsx(xj,{}),o.jsx(Ij,{}),o.jsx(Dj,{transformers:Yy})]})]})})},AW=({testName:e="",allowedTime:t=null,onTestSaved:r,onCancel:n,onBackToCabinet:s,isSaving:a=!1,validationErrors:i={}})=>{const{user:l}=Bn(),{post:c}=zi(),{showNotification:d}=ka(),[f,p]=C.useState({test_name:e,test_text:"",num_questions:1,num_blanks:0,passing_score:100,separate_type:!0,allowed_time:t,blanks:[]}),[g,y]=C.useState({isLoading:!1,error:null,showPreview:!0});C.useEffect(()=>{p(R=>({...R,test_name:e||"",allowed_time:t}))},[e,t]);const v=R=>{p(T=>({...T,test_text:R}))},_=()=>{const T={id:f.blanks.length+1,position:0,question:"",options:["","","",""],correct_answer:""};p(D=>({...D,blanks:[...D.blanks,T],num_blanks:D.num_blanks+1}))},b=R=>{p(T=>({...T,blanks:T.blanks.filter(D=>D.id!==R),num_blanks:T.num_blanks-1}))},E=R=>{p(T=>({...T,blanks:T.blanks.map(D=>D.id===R?{...D,options:[...D.options,""]}:D)}))},k=(R,T)=>{p(D=>({...D,blanks:D.blanks.map(I=>I.id===R?{...I,options:I.options.filter((V,X)=>X!==T),correct_answer:I.correct_answer===String.fromCharCode(65+T)?"":I.correct_answer}:I)}))},w=(R,T,D)=>{p(I=>({...I,blanks:I.blanks.map(V=>V.id===R?{...V,options:V.options.map((X,Z)=>Z===T?D:X)}:V)}))},N=(R,T)=>{console.log("🔍 [DEBUG] updateBlankQuestion called:",{blankId:R,question:T}),p(D=>({...D,blanks:D.blanks.map(I=>I.id===R?{...I,question:T}:I)})),console.log("🔍 [DEBUG] updateBlankQuestion completed")},A=(R,T)=>{p(D=>({...D,blanks:D.blanks.map(I=>I.id===R?{...I,correct_answer:T}:I)}))},P=async()=>{if(!f.test_name.trim()){y(R=>({...R,error:"Test name is required"}));return}if(!f.test_text.trim()){y(R=>({...R,error:"Test text is required"}));return}if(f.blanks.length===0){y(R=>({...R,error:"At least one blank is required"}));return}if(console.log("🔍 [DEBUG] Validating blanks:",f.blanks),f.blanks.forEach((R,T)=>{console.log(`🔍 [DEBUG] Blank ${T+1}:`,{question:R.question,questionTrimmed:R.question?.trim(),correct_answer:R.correct_answer,options:R.options})}),f.separate_type===!1){if(f.blanks.some(R=>!R.correct_answer)){console.log("❌ [DEBUG] Validation failed - some blanks missing correct answer"),y(R=>({...R,error:"All blanks must have correct answers"}));return}}else if(f.blanks.some(R=>!R.question.trim()||!R.correct_answer)){console.log("❌ [DEBUG] Validation failed - some blanks missing question or correct answer"),y(R=>({...R,error:"All blanks must have question text and correct answer"}));return}console.log("✅ [DEBUG] Validation passed - all blanks have question and correct answer"),y(R=>({...R,isLoading:!0,error:null}));try{const R={test_name:f.test_name,test_text:f.test_text,num_questions:f.blanks.length,num_blanks:f.blanks.length,separate_type:f.separate_type,passing_score:f.passing_score,allowed_time:f.allowed_time,blanks:f.blanks.map((T,D)=>({question_id:D+1,question_json:T.question,question:T.question,options:T.options,correct_answer:T.correct_answer,blank_positions:{},blank_options:T.options||[],correct_answers:[T.correct_answer]}))};console.log("🎯 [DEBUG] Calling onTestSaved with data:",R),r?(console.log("🎯 [DEBUG] onTestSaved function exists, calling it..."),r(R),console.log("🎯 [DEBUG] onTestSaved called successfully")):console.log("❌ [DEBUG] onTestSaved function is null/undefined")}catch(R){console.error("Error preparing fill blanks test:",R),y(T=>({...T,error:"Failed to prepare fill blanks test. Please try again."})),d("Failed to prepare fill blanks test","error")}finally{y(R=>({...R,isLoading:!1}))}};return o.jsx("div",{className:"fill-blanks-test-creator max-w-4xl mx-auto p-6",children:o.jsxs(kt,{className:"p-6",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Create Fill Blanks Test"}),o.jsx("p",{className:"text-gray-600",children:"Create a test with rich text content and multiple choice blanks"}),o.jsx("div",{className:"mt-2 text-sm text-gray-600",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("span",{children:[o.jsx("strong",{children:"Test Name:"})," ",e||"Untitled Test"]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Blanks:"})," ",f.num_blanks," (auto-calculated)"]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Timer:"})," ",f.allowed_time?`${f.allowed_time} minutes`:"No timer"]})]})}),g.error&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-600 text-sm",children:g.error})})]}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Text Content with Blanks"}),o.jsx("p",{className:"text-sm text-gray-500",children:"Type your text and add blanks where needed"})]}),o.jsx("div",{className:"flex items-center space-x-4",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Mode:"}),o.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[o.jsx("button",{onClick:()=>p(R=>({...R,separate_type:!0})),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors ${f.separate_type===!0?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Separate"}),o.jsx("button",{onClick:()=>p(R=>({...R,separate_type:!1})),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors ${f.separate_type===!1?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Inline"})]})]})})]}),o.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:f.separate_type===!0?"Separate Mode:":"Inline Mode:"})," ",f.separate_type===!0?"Students see numbered blanks in text and answer questions below":"Students see clickable blanks in text with dropdown options"]})}),o.jsx(NW,{value:f.test_text,onChange:v,placeholder:"Type your text here. Use the 'Add Blank' button in the toolbar to insert blanks.",onAddBlank:_,blankCount:f.blanks.length})]}),f.separate_type===!0&&o.jsx("div",{className:"space-y-4",children:f.blanks.map((R,T)=>o.jsxs(kt,{className:"p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-md font-medium",children:["Blank ",R.id," Configuration"]}),o.jsx(nt,{variant:"danger",size:"small",onClick:()=>b(R.id),className:"px-2 py-1 text-sm",children:"Remove Blank"})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Question Text for Blank ",R.id," *"]}),o.jsx("input",{type:"text",placeholder:"Enter question text for this blank",value:R.question,onChange:D=>N(R.id,D.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Answer Options:"}),R.options.map((D,I)=>o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:String.fromCharCode(65+I)}),o.jsx("input",{type:"text",placeholder:`Option ${String.fromCharCode(65+I)}`,value:D||"",onChange:V=>w(R.id,I,V.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"}),R.options.length>2&&o.jsx(nt,{variant:"danger",size:"small",onClick:()=>k(R.id,I),className:"px-2 py-1 text-sm",children:"×"})]},I)),R.options.length<6&&o.jsx(nt,{variant:"secondary",size:"small",onClick:()=>E(R.id),className:"w-full",children:"+ Add Option"})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correct Answer *"}),o.jsxs("select",{value:R.correct_answer||"",onChange:D=>A(R.id,D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[o.jsx("option",{value:"",children:"Select correct answer"}),R.options.filter(D=>D.trim().length>0).map((D,I)=>o.jsxs("option",{value:String.fromCharCode(65+I),children:[String.fromCharCode(65+I),") ",D]},I))]})]})]},R.id))}),f.separate_type===!1&&o.jsx("div",{className:"space-y-4",children:f.blanks.map((R,T)=>o.jsxs(kt,{className:"p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-md font-medium",children:["Blank ",R.id," Options"]}),o.jsx(nt,{variant:"danger",size:"small",onClick:()=>b(R.id),className:"px-2 py-1 text-sm",children:"Remove Blank"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Answer Options:"}),R.options.map((D,I)=>o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:String.fromCharCode(65+I)}),o.jsx("input",{type:"text",placeholder:`Option ${String.fromCharCode(65+I)}`,value:D||"",onChange:V=>w(R.id,I,V.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"}),R.options.length>2&&o.jsx(nt,{variant:"danger",size:"small",onClick:()=>k(R.id,I),className:"px-2 py-1 text-sm",children:"×"})]},I)),R.options.length<6&&o.jsx(nt,{variant:"secondary",size:"small",onClick:()=>E(R.id),className:"w-full",children:"+ Add Option"})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correct Answer *"}),o.jsxs("select",{value:R.correct_answer||"",onChange:D=>A(R.id,D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[o.jsx("option",{value:"",children:"Select correct answer"}),R.options.filter(D=>D.trim().length>0).map((D,I)=>o.jsxs("option",{value:String.fromCharCode(65+I),children:[String.fromCharCode(65+I),") ",D]},I))]})]})]},R.id))}),o.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[o.jsx(nt,{onClick:n,variant:"secondary",disabled:a,children:"Cancel"}),o.jsx(nt,{onClick:P,variant:"primary",disabled:a||f.blanks.length===0,children:a?o.jsx(jr,{size:"sm"}):"Save Test"})]})]})})},jW=[{value:"A1",label:"A1 (Beginner)",description:"Basic vocabulary, simple sentences"},{value:"A2",label:"A2 (Elementary)",description:"Everyday vocabulary, present/past tenses"},{value:"B1",label:"B1 (Intermediate)",description:"Varied vocabulary, complex sentences"},{value:"B2",label:"B2 (Upper-Intermediate)",description:"Advanced vocabulary, sophisticated structures"},{value:"C1",label:"C1 (Advanced)",description:"Nuanced vocabulary, complex discourse"},{value:"C2",label:"C2 (Proficiency)",description:"Native-like fluency and accuracy"}],FW=({testName:e="",onTestSaved:t,onCancel:r,onBackToCabinet:n,isSaving:s=!1,validationErrors:a={}})=>{const{showNotification:i}=ka(),[l,c]=C.useState({min_words:50,questions:[{question_id:1,prompt:"",expected_duration:null,difficulty_level:"B1"}]}),[d,f]=C.useState(!1),p=C.useCallback((E,k)=>{c(w=>({...w,[E]:k}))},[]),g=C.useCallback((E,k,w)=>{c(N=>({...N,questions:N.questions.map((A,P)=>P===E?{...A,[k]:w}:A)}))},[]),y=C.useCallback(()=>{c(E=>({...E,questions:[...E.questions,{question_id:E.questions.length+1,prompt:"",expected_duration:null,difficulty_level:"B1"}]}))},[]),v=C.useCallback(E=>{l.questions.length>1&&c(k=>({...k,questions:k.questions.filter((w,N)=>N!==E)}))},[l.questions.length]),_=C.useCallback(()=>{const E={};return l.min_words<10&&(E.min_words="Minimum word count must be at least 10 words"),l.questions.forEach((k,w)=>{k.prompt.trim()||(E[`question_${w}_prompt`]="Question prompt is required")}),E},[l]),b=C.useCallback(async E=>{E.preventDefault();const k=_();if(Object.keys(k).length>0){i("Please fix the validation errors","error");return}f(!0);try{const w={test_name:e,time_limit:300,min_duration:30,max_duration:600,max_attempts:3,min_words:l.min_words,passing_score:50,allowed_time:null,questions:l.questions.map((N,A)=>({question_id:A+1,prompt:N.prompt,expected_duration:N.expected_duration,difficulty_level:N.difficulty_level}))};console.log("🎯 [DEBUG] Calling onTestSaved with data:",w),t?(console.log("🎯 [DEBUG] onTestSaved function exists, calling it..."),t(w),console.log("🎯 [DEBUG] onTestSaved called successfully")):console.log("❌ [DEBUG] onTestSaved function is null/undefined")}catch(w){console.error("Error preparing speaking test:",w),i("Failed to prepare speaking test","error")}finally{f(!1)}},[l,_,i,t,e]);return d||s?o.jsxs("div",{className:"flex items-center justify-center p-8",children:[o.jsx(jr,{}),o.jsx("span",{className:"ml-2",children:"Creating speaking test..."})]}):o.jsxs("div",{className:"speaking-test-creator max-w-4xl mx-auto",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Create Speaking Test"}),o.jsx("p",{className:"text-gray-600",children:"Create a speaking test where students record audio responses with AI-powered feedback"})]}),o.jsxs("form",{onSubmit:b,className:"space-y-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Scoring Settings"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Word Count *"}),o.jsx("input",{type:"number",min:"10",max:"1000",value:l.min_words,onChange:E=>p("min_words",parseInt(E.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),a.min_words&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.min_words})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Questions"}),o.jsx(nt,{type:"button",variant:"outline",onClick:y,children:"Add Question"})]}),l.questions.length>1&&o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:o.jsxs("div",{className:"flex items-start",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),o.jsxs("div",{className:"ml-3",children:[o.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Multiple Questions Detected"}),o.jsx("div",{className:"mt-1 text-sm text-blue-700",children:o.jsxs("p",{children:["You have ",l.questions.length," questions in this test.",o.jsx("strong",{children:" Only one question will be randomly selected"})," and shown to each student. This ensures fair distribution across your question pool."]})})]})]})}),l.questions.map((E,k)=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("h4",{className:"font-medium",children:["Question ",k+1]}),l.questions.length>1&&o.jsx(nt,{type:"button",variant:"outline",size:"sm",onClick:()=>v(k),className:"text-red-600 hover:text-red-700",children:"Remove"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question Prompt *"}),o.jsx("textarea",{value:E.prompt,onChange:w=>g(k,"prompt",w.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Enter the question prompt for students"}),a[`question_${k}_prompt`]&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:a[`question_${k}_prompt`]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Duration (seconds)"}),o.jsx("input",{type:"number",min:"10",max:"600",value:E.expected_duration||"",onChange:w=>g(k,"expected_duration",w.target.value?parseInt(w.target.value):null),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEFR Level"}),o.jsx("select",{value:E.difficulty_level,onChange:w=>g(k,"difficulty_level",w.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:jW.map(w=>o.jsxs("option",{value:w.value,children:[w.label," - ",w.description]},w.value))}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select the appropriate CEFR level for this question. This will be used by AI to evaluate students appropriately."})]})]})]})]},k))]}),o.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[o.jsx(nt,{type:"button",variant:"secondary",onClick:r,children:"Cancel"}),o.jsx(nt,{type:"submit",variant:"primary",disabled:d||s,children:d||s?"Creating...":"Create Speaking Test"})]})]})]})},Mj=(e,t)=>{const[r,n]=C.useState(()=>{try{const i=window.localStorage.getItem(e);return i?JSON.parse(i):t}catch(i){return console.error(`Error reading localStorage key "${e}":`,i),t}}),s=C.useCallback(i=>{try{const l=i instanceof Function?i(r):i;n(l),window.localStorage.setItem(e,JSON.stringify(l))}catch(l){console.error(`Error setting localStorage key "${e}":`,l)}},[e,r]),a=C.useCallback(()=>{try{window.localStorage.removeItem(e),n(t)}catch(i){console.error(`Error removing localStorage key "${e}":`,i)}},[e,t]);return[r,s,a]},Qy=()=>{const e=C.useCallback((c,d=null)=>{try{const f=window.localStorage.getItem(c);return f?JSON.parse(f):d}catch(f){return console.error(`Error reading localStorage key "${c}":`,f),d}},[]),t=C.useCallback((c,d)=>{try{window.localStorage.setItem(c,JSON.stringify(d))}catch(f){console.error(`Error setting localStorage key "${c}":`,f)}},[]),r=C.useCallback(c=>{try{window.localStorage.removeItem(c)}catch(d){console.error(`Error removing localStorage key "${c}":`,d)}},[]),n=C.useCallback(()=>{if(confirm("Are you sure you want to clear all local storage? This cannot be undone."))try{window.localStorage.clear(),window.showNotification?window.showNotification("All local storage cleared!","success"):console.log("All local storage cleared!")}catch(c){console.error("Error clearing localStorage:",c)}},[]),s=C.useCallback(()=>{try{const c={};for(let g=0;g<window.localStorage.length;g++){const y=window.localStorage.key(g);y&&(c[y]=window.localStorage.getItem(y))}const d=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),f=URL.createObjectURL(d),p=document.createElement("a");p.href=f,p.download="localStorage_backup.json",p.click(),URL.revokeObjectURL(f),window.showNotification?window.showNotification("Local storage exported!","success"):console.log("Local storage exported!")}catch(c){console.error("Error exporting localStorage data:",c)}},[]),a=C.useCallback(()=>{try{window.localStorage.clear()}catch(c){console.error("Error clearing localStorage:",c)}},[]),i=C.useCallback(()=>{try{const c={};for(let d=0;d<window.localStorage.length;d++){const f=window.localStorage.key(d);f&&(c[f]=window.localStorage.getItem(f))}return c}catch(c){return console.error("Error exporting localStorage data:",c),{}}},[]),l=C.useCallback(c=>{try{Object.entries(c).forEach(([d,f])=>{window.localStorage.setItem(d,f)})}catch(d){console.error("Error importing localStorage data:",d)}},[]);return{getItem:e,setItem:t,removeItem:r,clearAll:a,clearAllLocalStorage:n,exportLocalStorage:s,exportData:i,importData:l}},PW=({question:e,testId:t,testType:r="true_false",mode:n="student",displayNumber:s,onAnswerChange:a,onQuestionChange:i,onSave:l,isEditing:c=!1,isSaving:d=!1,validationErrors:f={},showCorrectAnswers:p=!1,studentId:g=null})=>{const{getItem:y,setItem:v}=Qy();ka(),C.useRef(null);const[_,b]=C.useState(""),[E,k]=C.useState(""),[w,N]=C.useState(""),[A,P]=C.useState(!1),[R,T]=C.useState(!0),[D,I]=C.useState(""),[V,X]=C.useState(!1),[Z,ie]=C.useState(null);C.useEffect(()=>{if(e&&(N(e.question||""),k(e.correct_answer||""),n==="student"&&g)){const Y=y(`test_progress_${g}_${r}_${t}_${e.question_id}`);Y&&b(Y)}},[e,t,r,n,y]),C.useEffect(()=>{if(n==="student"&&_&&t&&e?.question_id&&g){const Y=setTimeout(()=>{X(!0),v(`test_progress_${g}_${r}_${t}_${e.question_id}`,_),ie(new Date().toLocaleTimeString()),setTimeout(()=>X(!1),1e3)},1e3);return()=>clearTimeout(Y)}},[_,t,r,e?.question_id,n,g,v]),C.useEffect(()=>{if(n==="teacher"&&(w||E)){const Y=setTimeout(()=>{X(!0);const te={question:w,correct_answer:E,timestamp:Date.now()};v(`teacher_form_${r}_${t}`,te),ie(new Date().toLocaleTimeString()),setTimeout(()=>X(!1),1e3)},2e3);return()=>clearTimeout(Y)}},[w,E,t,r,n,v]);const q=C.useCallback(Y=>{n==="student"&&(b(Y),a&&a(e.question_id,Y),W(Y))},[n,e?.question_id,a]),ne=C.useCallback(Y=>{N(Y),i&&i(e.question_id,Y),L(Y)},[e?.question_id,i]),M=C.useCallback(Y=>{k(Y),i&&i(e.question_id,{...e,correct_answer:Y}),H(Y)},[e,i]),W=C.useCallback(Y=>{if(n==="student"){if(!Y){T(!1),I("Please select an answer");return}T(!0),I("")}},[n]),L=C.useCallback(Y=>{if(n==="teacher"){if(!Y||Y.trim().length<10){T(!1),I("Question must be at least 10 characters long");return}T(!0),I("")}},[n]),H=C.useCallback(Y=>{if(n==="teacher"){if(!Y){T(!1),I("Please select a correct answer");return}T(!0),I("")}},[n]),K=C.useCallback(()=>{if(n!=="teacher"||!l)return;const Y={question_id:e.question_id,question:w,correct_answer:E,type:"true_false"};l(Y)},[n,l,e?.question_id,w,E]),B=C.useCallback(Y=>Y?Y.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"):"",[]),z=()=>o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",typeof s=="number"?s:e?.question_id]}),o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[V&&o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(jr,{size:"small"}),o.jsx("span",{children:"Saving..."})]}),Z&&!V&&o.jsxs("div",{className:"text-green-600",children:["✓ Saved at ",Z]})]})]}),o.jsx("div",{className:"question-text mb-6 text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:B(w)}}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${_==="true"?"border-blue-500 bg-blue-50":"border-gray-200"} ${p&&E==="true"?"ring-2 ring-green-400":""}`,children:[o.jsx("input",{type:"radio",name:`question_${e?.question_id}`,value:"true",checked:_==="true",onChange:()=>q("true"),className:"sr-only","aria-label":"True"}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${_==="true"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:_==="true"&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),o.jsx("span",{className:"text-gray-800 font-medium",children:"True"})]}),o.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${_==="false"?"border-blue-500 bg-blue-50":"border-gray-200"} ${p&&E==="false"?"ring-2 ring-green-400":""}`,children:[o.jsx("input",{type:"radio",name:`question_${e?.question_id}`,value:"false",checked:_==="false",onChange:()=>q("false"),className:"sr-only","aria-label":"False"}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${_==="false"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:_==="false"&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),o.jsx("span",{className:"text-gray-800 font-medium",children:"False"})]})]}),!R&&D&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:D})]}),Q=()=>o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",e?.question_id||"New Question"]}),o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[V&&o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(jr,{size:"small"}),o.jsx("span",{children:"Saving..."})]}),Z&&!V&&o.jsxs("div",{className:"text-green-600",children:["✓ Saved at ",Z]})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:`question_${e?.question_id}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text *"}),o.jsx("textarea",{id:`question_${e?.question_id}`,value:w,onChange:Y=>ne(Y.target.value),placeholder:"Enter your question here...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 resize-none",rows:3,required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Correct Answer *"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${E==="true"?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[o.jsx("input",{type:"radio",name:`correct_${e?.question_id}`,value:"true",checked:E==="true",onChange:()=>M("true"),className:"sr-only","aria-label":"True"}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${E==="true"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:E==="true"&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),o.jsx("span",{className:"text-gray-800 font-medium",children:"True"})]}),o.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${E==="false"?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[o.jsx("input",{type:"radio",name:`correct_${e?.question_id}`,value:"false",checked:E==="false",onChange:()=>M("false"),className:"sr-only","aria-label":"False"}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${E==="false"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:E==="false"&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),o.jsx("span",{className:"text-gray-800 font-medium",children:"False"})]})]})]})]}),!R&&D&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:D}),o.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:o.jsx(nt,{variant:"success",onClick:K,disabled:!R||d,className:"w-full sm:w-auto",children:d?o.jsx(jr,{size:"small"}):"Save Question"})})]});return o.jsx("div",{className:"true-false-question-container",children:n==="student"?z():Q()})},RW=({question:e,testId:t,testType:r="multiple_choice",mode:n="student",onAnswerChange:s,onQuestionChange:a,onOptionAdd:i,onOptionRemove:l,onSave:c,isEditing:d=!1,isSaving:f=!1,validationErrors:p={},showCorrectAnswers:g=!1,studentId:y=null,displayNumber:v})=>{const{getItem:_,setItem:b}=Qy(),{showNotification:E}=ka();C.useRef(null);const[k,w]=C.useState(""),[N,A]=C.useState(["","","",""]),[P,R]=C.useState(""),[T,D]=C.useState(""),[I,V]=C.useState(!1),[X,Z]=C.useState(!0),[ie,q]=C.useState(""),[ne,M]=C.useState(!1),[W,L]=C.useState(null);C.useEffect(()=>{if(e&&(D(e.question||""),A(e.options||["","","",""]),R(e.correct_answer||""),n==="student"&&y)){const me=_(`test_progress_${y}_${r}_${t}_${e.question_id}`);me&&w(me)}},[e,t,r,n,_]),C.useEffect(()=>{if(n==="student"&&k&&t&&e?.question_id&&y){const me=setTimeout(()=>{M(!0),b(`test_progress_${y}_${r}_${t}_${e.question_id}`,k),L(new Date().toLocaleTimeString()),setTimeout(()=>M(!1),1e3)},1e3);return()=>clearTimeout(me)}},[k,t,r,e?.question_id,n,y,b]),C.useEffect(()=>{if(n==="teacher"&&(T||N.some(me=>me.trim()))){const me=setTimeout(()=>{M(!0);const He={question:T,options:N,correct_answer:P,timestamp:Date.now()};b(`teacher_form_${r}_${t}`,He),L(new Date().toLocaleTimeString()),setTimeout(()=>M(!1),1e3)},2e3);return()=>clearTimeout(me)}},[T,N,P,t,r,n,b]),C.useCallback(me=>{if(n!=="student")return;const He=String(me);w(He),s&&s(e.question_id,He),Y(He)},[n,e?.question_id,s]);const H=C.useCallback(me=>{D(me),a&&a(e.question_id,me),te(me)},[e?.question_id,a]),K=C.useCallback((me,He)=>{const qe=[...N];qe[me]=He,A(qe),a&&a(e.question_id,{...e,options:qe}),ee(qe)},[N,e,a]),B=C.useCallback(me=>{R(me),a&&a(e.question_id,{...e,correct_answer:me}),ae(me)},[e,a]),z=C.useCallback(()=>{if(N.length<6){const me=[...N,""];A(me),i&&i(e.question_id,me)}else E("Maximum 6 options allowed","warning")},[N,e?.question_id,i,E]),Q=C.useCallback(me=>{if(N.length>2){const He=N.filter((qe,Xe)=>Xe!==me);if(A(He),P===String.fromCharCode(65+me))R("");else if(P&&String.fromCharCode(65+me)<P){const qe=String.fromCharCode(65+me-1);R(qe)}l&&l(e.question_id,He)}else E("Minimum 2 options required","warning")},[N,P,e?.question_id,l,E]),Y=C.useCallback(me=>{if(n==="student"){if(!me){Z(!1),q("Please select an answer");return}Z(!0),e?.correct_answer&&me===e.correct_answer?q("✅ Correct answer!"):e?.correct_answer?q("❌ Incorrect answer"):q("Answer selected")}},[n,e?.correct_answer]),te=C.useCallback(me=>!me||me.trim().length<10?(Z(!1),q("Question must be at least 10 characters long"),!1):(Z(!0),q(""),!0),[]),ee=C.useCallback(me=>{if(n!=="teacher")return;if(me.filter(qe=>qe.trim().length>0).length<2){Z(!1),q("At least 2 options must be filled");return}if(me.some(qe=>qe.trim().length>0&&qe.trim().length<3)){Z(!1),q("Each option must be at least 3 characters long");return}Z(!0),q("")},[n]),ae=C.useCallback(me=>{if(n==="teacher"){if(!me){Z(!1),q("Please select a correct answer");return}Z(!0),q("")}},[n]),ge=C.useCallback(()=>{if(n!=="teacher"||!c)return;const me={question_id:e.question_id,question:T,options:N.filter(He=>He.trim().length>0),correct_answer:P,type:"multiple_choice"};c(me)},[n,c,e?.question_id,T,N,P]),_e=C.useCallback(me=>me?me.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"):"",[]);return n==="teacher"?o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",e?.question_id||"New Question"]}),o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[ne&&o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(jr,{size:"small"}),o.jsx("span",{children:"Saving..."})]}),W&&!ne&&o.jsxs("div",{className:"text-green-600",children:["✓ Saved at ",W]})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:`question_${e?.question_id}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text *"}),o.jsx("textarea",{id:`question_${e?.question_id}`,value:T,onChange:me=>H(me.target.value),placeholder:"Enter your question here...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 resize-none",rows:3,required:!0})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Answer Options *"}),o.jsx(nt,{variant:"secondary",size:"small",onClick:z,disabled:N.length>=6,className:"px-3 py-1 text-sm",children:"+ Add Option"})]}),o.jsx("div",{className:"space-y-3",children:N.map((me,He)=>o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:String.fromCharCode(65+He)}),o.jsx("input",{type:"text",value:me,onChange:qe=>K(He,qe.target.value),placeholder:`Option ${String.fromCharCode(65+He)}`,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200",required:!0}),N.length>2&&o.jsx(nt,{variant:"danger",size:"small",onClick:()=>Q(He),className:"px-2 py-1 text-sm",children:"×"})]},He))})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:`correct_${e?.question_id}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Correct Answer *"}),o.jsxs("select",{id:`correct_${e?.question_id}`,value:P,onChange:me=>B(me.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200",required:!0,children:[o.jsx("option",{value:"",children:"Select correct answer"}),N.map((me,He)=>{if(!me.trim())return null;const qe=String.fromCharCode(65+He);return o.jsxs("option",{value:qe,children:[qe,") ",me]},He)})]})]})]}),!X&&ie&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:ie}),o.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:o.jsx(nt,{variant:"success",onClick:ge,disabled:!X||f,className:"w-full sm:w-auto",children:f?o.jsx(jr,{size:"small"}):"Save Question"})})]}):o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",typeof v=="number"?v:e?.question_id]}),o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[ne&&o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(jr,{size:"small"}),o.jsx("span",{children:"Saving..."})]}),W&&!ne&&o.jsxs("div",{className:"text-green-600",children:["✓ Saved at ",W]})]})]}),o.jsx("div",{className:"question-text mb-6 text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:_e(T)}}),o.jsx("div",{className:"space-y-3",children:N.map((me,He)=>o.jsxs("label",{className:`flex items-center p-3 rounded-lg border-2 cursor-pointer transition-all duration-200 ${k===String.fromCharCode(65+He)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[o.jsx("input",{type:"radio",name:`mcq_${t}_${e?.question_id}`,value:String.fromCharCode(65+He),checked:k===String.fromCharCode(65+He),onChange:qe=>{w(qe.target.value),s&&s(e?.question_id,qe.target.value)},className:"mr-3"}),o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600 mr-3",children:String.fromCharCode(65+He)}),o.jsx("span",{className:"flex-1",children:me||`Option ${String.fromCharCode(65+He)}`})]},He))}),!X&&ie&&o.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:ie})]})},DW=({question:e,testId:t,testType:r="input",mode:n="student",displayNumber:s,onAnswerChange:a,onQuestionChange:i,onAnswerAdd:l,onAnswerRemove:c,onSave:d,isEditing:f=!1,isSaving:p=!1,validationErrors:g={},showCorrectAnswers:y=!1,studentId:v=null})=>{const{getItem:_,setItem:b}=Qy(),{showNotification:E}=ka(),k=C.useRef(null),[w,N]=C.useState(""),[A,P]=C.useState([""]),[R,T]=C.useState(!1),[D,I]=C.useState(!0),[V,X]=C.useState(""),[Z,ie]=C.useState(!1);C.useEffect(()=>{if(n==="student"&&e?.question_id&&t&&r&&v){const te=`test_progress_${v}_${r}_${t}_${e.question_id}`,ee=_(te);ee&&N(ee)}},[e?.question_id,r,t,n,v,_]),C.useEffect(()=>{n==="teacher"&&e?.answers&&P(e.answers.length>0?e.answers:[""])},[e?.answers,n]),C.useEffect(()=>{if(n==="student"&&w&&e?.question_id&&t&&r&&v){const te=setTimeout(()=>{ie(!0),b(`test_progress_${v}_${r}_${t}_${e.question_id}`,w),setTimeout(()=>ie(!1),1e3)},1e3);return()=>clearTimeout(te)}},[w,e?.question_id,r,t,n,v,b]),C.useEffect(()=>{if(n==="teacher"&&A&&i){const te=setTimeout(()=>{i({...e,answers:A.filter(ee=>ee.trim())})},500);return()=>clearTimeout(te)}},[A,e,n,i]);const q=C.useCallback(te=>{N(te);const ee=te.trim().length>0;I(ee),X(ee?"":"Please enter an answer"),a&&a(e.question_id,te)},[e?.question_id,a]),ne=C.useCallback((te,ee)=>{const ae=[...A];ae[te]=ee,P(ae),a&&a(e.question_id,ae)},[A,e?.question_id,a]),M=C.useCallback(()=>{if(n==="teacher"){const te=[...A,""];P(te),l&&l(e.question_id,te)}},[A,e?.question_id,n,l]),W=C.useCallback(te=>{if(n==="teacher"&&A.length>1){const ee=A.filter((ae,ge)=>ge!==te);P(ee),c&&c(e.question_id,ee)}},[A,e?.question_id,n,c]),L=C.useCallback(()=>{if(n==="student"){const te=w.trim().length>0;return I(te),X(te?"":"Please enter an answer"),te}else if(n==="teacher"){const te=A.some(ee=>ee.trim().length>0);return I(te),X(te?"":"Please enter at least one correct answer"),te}return!0},[w,A,n]),H=C.useCallback(te=>te?te.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>"):"",[]),K=C.useCallback(()=>{T(!0)},[]),B=C.useCallback(()=>{T(!1),L()},[L]),z=C.useCallback(te=>{te.key==="Enter"&&n==="student"&&w.trim()&&(b(`test_progress_${r}_${t}_${e.question_id}`,w),E("Answer saved","success"))},[w,r,t,e?.question_id,n,b,E]),Q=()=>o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",typeof s=="number"?s:e.question_id]}),Z&&o.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[o.jsx(jr,{size:"small"}),o.jsx("span",{children:"Saving..."})]})]}),o.jsx("div",{className:"question-text mb-6 text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:H(e.question)}}),o.jsx("div",{className:"space-y-3",children:o.jsx("input",{ref:k,type:"text",id:`input_${e.question_id}`,placeholder:"Enter your answer here...",value:w,onChange:te=>q(te.target.value),onFocus:K,onBlur:B,onKeyPress:z,className:`w-full px-4 py-3 border-2 rounded-lg text-gray-800 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${D?R?"border-blue-500":"border-gray-300 hover:border-gray-400":"border-red-300 focus:border-red-500 focus:ring-red-500"}`,"data-question-id":e.question_id,"aria-label":`Answer for question ${e.question_id}`,"aria-invalid":!D,"aria-describedby":D?void 0:`error-${e.question_id}`})}),y&&e.correct_answers&&o.jsxs("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[o.jsx("h5",{className:"text-sm font-semibold text-green-800 mb-2",children:"Correct Answers:"}),o.jsx("ul",{className:"space-y-1",children:e.correct_answers.map((te,ee)=>o.jsxs("li",{className:"text-green-700 text-sm",children:["• ",te]},ee))})]})]}),Y=()=>o.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Question ",e.question_id||"New"]}),p&&o.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[o.jsx(jr,{size:"small"}),o.jsx("span",{children:"Saving..."})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:`question_${e.question_id||"new"}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text *"}),o.jsx("input",{type:"text",id:`question_${e.question_id||"new"}`,value:e.question||"",onChange:te=>i&&i({...e,question:te.target.value}),placeholder:"Enter question text",className:`w-full px-4 py-3 border-2 rounded-lg text-gray-800 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${g.question?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 hover:border-gray-400 focus:border-blue-500"}`}),g.question&&o.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:g.question})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Correct Answers *"}),o.jsx(nt,{type:"button",variant:"secondary",size:"small",onClick:M,className:"px-3 py-1 text-sm",children:"+ Add Answer"})]}),o.jsx("div",{className:"space-y-3",children:A.map((te,ee)=>o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:ee+1}),o.jsx("input",{type:"text",value:te,onChange:ae=>ne(ee,ae.target.value),placeholder:`Correct answer ${ee+1}`,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200","data-question-id":e.question_id,"data-answer-index":ee}),A.length>1&&o.jsx(nt,{type:"button",variant:"danger",size:"small",onClick:()=>W(ee),className:"px-2 py-1 text-sm",children:"× Remove"})]},ee))}),g.answers&&o.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:g.answers})]})]}),d&&o.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:o.jsx(nt,{type:"button",variant:"success",onClick:d,disabled:p,className:"w-full sm:w-auto",children:p?o.jsx(jr,{size:"small"}):"Save Question"})})]});return o.jsx("div",{className:`input-question-container ${n} ${R?"focused":""}`,children:n==="student"?Q():Y()})},Bo=({isOpen:e=!1,onClose:t,title:r="",children:n,size:s="medium",showCloseButton:a=!0,closeOnBackdropClick:i=!0,className:l="",...c})=>{if(!e)return null;const d=p=>{i&&p.target===p.currentTarget&&t()};ns.useEffect(()=>{const p=g=>{g.key==="Escape"&&t()};return e&&(document.addEventListener("keydown",p),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",p),document.body.style.overflow="unset"}},[e,t]);const f={small:"max-w-sm",medium:"max-w-md",large:"max-w-2xl"};return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:d,role:"dialog","aria-modal":"true","aria-label":r,...c,children:o.jsxs("div",{className:`
          bg-white rounded-xl shadow-md border border-gray-200 p-6
          hover:shadow-lg hover:-translate-y-1 transition-all duration-200
          w-full ${f[s]} mx-auto
          ${l}
        `,onClick:p=>p.stopPropagation(),children:[(r||a)&&o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r&&o.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:r}),a&&o.jsx(nt,{variant:"secondary",size:"small",onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200","aria-label":"Close modal",children:"×"})]}),o.jsx("div",{className:"space-y-6",children:n})]})})},Wp=(e,t,r)=>{const[n,s]=C.useState(!1),[a,i]=C.useState(0),[l,c]=C.useState(!1),d=C.useRef(!1);C.useEffect(()=>{if(!e||!t||!r)return;const b=`anti_cheating_${r}_${e}_${t}`,E=jn(b);E&&(i(E.tabSwitches||0),c(E.isCheating||!1))},[e,t,r]);const f=C.useCallback(()=>{if(console.log("🛡️ handleTabSwitch called - isTracking:",d.current),!d.current){console.log("🛡️ Not tracking, returning early");return}console.log("🛡️ Tab switch detected - starting 7 second timer...");const b=Date.now();setTimeout(()=>{const E=Date.now()-b;console.log("🛡️ Timer completed - time hidden:",E,"ms"),E>=6500?(console.log("🛡️ Tab was hidden for sufficient time - counting as tab switch"),i(k=>{const w=k+1,N=w>=2;console.log("🛡️ Tab switch count updated:",{newCount:w,cheating:N}),c(N);const A=`anti_cheating_${r}_${e}_${t}`;return Fn(A,{tabSwitches:w,isCheating:N},120*1e3),w})):console.log("🛡️ Tab was not hidden long enough - not counting as switch")},7e3)},[e,t,r]),p=C.useCallback(()=>{d.current&&(console.log("🛡️ Visibility change detected:",{hidden:document.hidden,isTracking:d.current}),document.hidden?f():console.log("🛡️ Tab became visible"))},[f]),g=C.useCallback(()=>{console.log("🛡️ startTracking called - setting up anti-cheating detection"),console.log("🛡️ Current document.hidden state:",document.hidden),console.log("🛡️ Current document.visibilityState:",document.visibilityState),s(!0),d.current=!0,document.addEventListener("visibilitychange",p),console.log("🛡️ Anti-cheating event listeners added (visibilitychange only)")},[p]),y=C.useCallback(()=>{console.log("🛡️ stopTracking called - removing anti-cheating detection"),s(!1),d.current=!1,document.removeEventListener("visibilitychange",p),console.log("🛡️ Anti-cheating event listeners removed")},[p]),v=C.useCallback(()=>{const b={caught_cheating:l,visibility_change_times:a};return console.log("🛡️ getCheatingData called:",b),b},[l,a]),_=C.useCallback(()=>{r&&e&&t&&m0(r,e,t),i(0),c(!1),console.log("🗑️ Anti-cheating data deleted from localStorage")},[r,e,t]);return{startTracking:g,stopTracking:y,clearData:_,getCheatingData:v,tabSwitches:a,isCheating:l,isTracking:n}},IW=({testData:e,onTestComplete:t,onBackToCabinet:r,isTestComplete:n=!1,testScore:s=null})=>{const[a,i]=C.useState(null),[l,c]=C.useState(null);C.useEffect(()=>{(async()=>{try{const[je,Ze]=await Promise.all([Uo(()=>Promise.resolve().then(()=>kL),void 0),Uo(()=>Promise.resolve().then(()=>rO),void 0)]);i(je),c(Ze.default)}catch(je){console.error("Failed to load Konva:",je)}})()},[]);const d=()=>a?{Stage:a.Stage,Layer:a.Layer,Rect:a.Rect,Arrow:a.Arrow,KonvaImage:a.Image,KonvaText:a.Text,Group:a.Group}:null,[f,p]=C.useState({}),[g,y]=C.useState({}),[v,_]=C.useState(0),[b,E]=C.useState(!1),[k,w]=C.useState(null),[N,A]=C.useState(0),[P,R]=C.useState(0),[T,D]=C.useState(null),[I,V]=C.useState(null),[X,Z]=C.useState(!1),[ie,q]=C.useState(!1),{showNotification:ne}=ka(),{makeAuthenticatedRequest:M}=zi(),{user:W}=Bn(),{startTracking:L,stopTracking:H,getCheatingData:K,clearData:B}=Wp("matching_type",e?.id,W?.student_id||W?.id),z=C.useRef(null),Q=C.useRef(null),Y=C.useRef(null),te=C.useRef(0),[ee,ae]=C.useState(400);C.useRef({});const ge=C.useCallback(()=>{Z(!0)},[]),_e=C.useCallback(()=>{y({}),p({}),Z(!1)},[]),Me=C.useCallback(()=>{q(!0)},[]),ue=C.useCallback(()=>{q(!1),r()},[r]),me=C.useMemo(()=>{if(!e)return null;const Ie=e.blocks.map(bt=>{let mt=bt.coordinates;if(typeof mt=="string")try{mt=JSON.parse(mt)}catch($t){console.error("❌ Failed to parse coordinates:",$t),mt={x:0,y:0,width:100,height:100}}return mt={x:(typeof mt.x=="number"?mt.x:Number(mt.x))||0,y:(typeof mt.y=="number"?mt.y:Number(mt.y))||0,width:(typeof mt.width=="number"?mt.width:Number(mt.width))||30,height:(typeof mt.height=="number"?mt.height:Number(mt.height))||10},{id:bt.id,word:bt.word,coordinates:mt,hasArrow:bt.hasArrow,arrow:bt.arrow}}),je=Array.isArray(e.arrows)?e.arrows:[],Ze=e.words.map(bt=>({id:bt.id,word:bt.word,blockId:null,isPlaced:!1,isCorrect:!1}));return{blocks:Ie,arrows:je,words:Ze}},[e]);C.useEffect(()=>{if(!e?.image_url)return;const Ie=new Image;Ie.crossOrigin="anonymous",Ie.onload=()=>{console.log("🖼️ Image loaded successfully"),A(Ie.width),R(Ie.height);const je=z.current?.clientWidth||800,Ze=z.current?.clientHeight||600,bt=je/Ie.width,mt=Ze/Ie.height,$t=Math.min(bt,mt,1),Wt=Ie.width*$t,lt=Ie.height*$t,Qe=(je-Wt)/2,yt=(Ze-lt)/2;w({x:Qe,y:yt,width:Wt,height:lt,scaleX:$t,scaleY:$t,scale:$t,image:Ie}),te.current=z.current?.clientWidth||800,console.log("🔍 Image info calculated:",{x:Qe,y:yt,width:Wt,height:lt,scaleX:$t,scaleY:$t})},Ie.onerror=()=>{console.error("❌ Failed to load image"),ne("Failed to load test image","error")},Ie.src=e.image_url},[e?.image_url,ne]),C.useEffect(()=>{if(!me||!k)return;const Ie=te.current||z.current?.clientWidth||800,je=12,Ze=38;let bt=k.x,mt=k.y+k.height+je;const $t=k.x+k.width,Wt={};me.words.forEach(yt=>{if(!Object.prototype.hasOwnProperty.call(g,yt.id)){const ft=typeof yt.word=="string"?yt.word:"",_t=Math.max(60,ft.length*8+20);bt+_t>Math.min(Ie-je,$t)&&(bt=k.x,mt+=Ze),f[yt.id]||(Wt[yt.id]={x:bt,y:mt}),bt+=_t+je}}),Object.keys(Wt).length&&p(yt=>({...yt,...Wt}));const lt=Object.values(Wt).reduce((yt,ft)=>Math.max(yt,ft.y),mt),Qe=Math.max(k.y+k.height+je,lt+Ze+je);ae(Math.max(400,Math.ceil(Qe)))},[me,k,g,f]);const He=C.useCallback(()=>{if(!k||!me)return[];const Ie=d();return Ie?me.blocks.map(je=>{const Ze=je.coordinates;let bt,mt,$t,Wt;bt=k.x+Ze.x*(k.scale??k.scaleX),mt=k.y+Ze.y*(k.scale??k.scaleY),$t=Ze.width*(k.scale??k.scaleX),Wt=Ze.height*(k.scale??k.scaleY);const lt=g[je.id];return o.jsxs(Ie.Group,{children:[o.jsx(Ie.Rect,{x:bt,y:mt,width:$t,height:Wt,fill:lt?"rgba(40, 167, 69, 0.4)":T===je.id?"rgba(0, 123, 255, 0.25)":"rgba(0, 123, 255, 0.15)",stroke:lt?"#28a745":T===je.id?"#0056b3":"#007bff",strokeWidth:2,cornerRadius:6,shadowColor:lt?"rgba(40, 167, 69, 0.3)":"rgba(0, 123, 255, 0.3)",shadowBlur:10,shadowOffset:{x:0,y:2},shadowOpacity:.5}),lt&&o.jsx(Ie.KonvaText,{x:bt+5,y:mt+Wt/2-10,width:$t-10,height:20,text:me.words.find(Qe=>Qe.id===lt)?.word||"",fontSize:Math.min(12,$t/8),fontFamily:"Arial",fill:"#2c3e50",align:"center",verticalAlign:"middle",listening:!1})]},je.id)}):[]},[k,me,g,a]),qe=C.useCallback(()=>{if(!k||!me)return[];const Ie=d();return Ie?(console.log("🔍 Processing arrows:",me.arrows),me.arrows.map(je=>{if(console.log("🔍 Arrow data:",je),!je.start||!je.end)return console.warn("⚠️ Arrow missing start/end coordinates:",je),null;let Ze,bt,mt,$t;if(je.rel_start_x!==null&&je.rel_start_y!==null&&je.rel_end_x!==null&&je.rel_end_y!==null&&je.image_width&&je.image_height&&je.image_width>0&&je.image_height>0){const Wt=je.image_width,lt=je.image_height,Qe=k.width/Wt,yt=k.height/lt;Ze=k.x+Number(je.rel_start_x)/100*Wt*Qe,bt=k.y+Number(je.rel_start_y)/100*lt*yt,mt=k.x+Number(je.rel_end_x)/100*Wt*Qe,$t=k.y+Number(je.rel_end_y)/100*lt*yt}else{const Wt=k.scale??k.scaleX??1,lt=Number(je.start.x),Qe=Number(je.start.y),yt=Number(je.end.x),ft=Number(je.end.y);lt<=k.width+1&&yt<=k.width+1&&Qe<=k.height+1&&ft<=k.height+1?(Ze=k.x+(isNaN(lt)?0:lt),bt=k.y+(isNaN(Qe)?0:Qe),mt=k.x+(isNaN(yt)?0:yt),$t=k.y+(isNaN(ft)?0:ft)):(Ze=k.x+(isNaN(lt)?0:lt)*Wt,bt=k.y+(isNaN(Qe)?0:Qe)*Wt,mt=k.x+(isNaN(yt)?0:yt)*Wt,$t=k.y+(isNaN(ft)?0:ft)*Wt)}return o.jsx(Ie.Arrow,{points:[Ze,bt,mt,$t],stroke:je.style?.color||"#dc3545",fill:je.style?.color||"#dc3545",strokeWidth:je.style?.thickness||3,pointerLength:10,pointerWidth:10},je.id)}).filter(Boolean)):[]},[k,me,a]),Xe=C.useCallback(()=>{if(!me)return[];const Ie=d();return Ie?me.words.map(je=>{const Ze=f[je.id]||{x:0,y:0},bt=typeof je.word=="string"?je.word:"",mt=Math.max(60,bt.length*8+20);return Object.values(g).includes(je.id)?null:o.jsxs(Ie.Group,{x:Ze.x,y:Ze.y,draggable:!0,onDragEnd:Wt=>Ve(Wt,je.id),children:[o.jsx(Ie.Rect,{width:mt,height:34,fill:"#ffffff",stroke:"#ced4da",strokeWidth:1,cornerRadius:4,shadowColor:"rgba(0,0,0,0.1)",shadowBlur:5,shadowOffset:{x:0,y:2},shadowOpacity:.3,listening:!0}),o.jsx(Ie.KonvaText,{text:bt,fontSize:14,fontFamily:"Arial",fill:"#343a40",padding:8,align:"center",verticalAlign:"middle",width:mt,height:34,listening:!1})]},je.id)}):[]},[me,f,g,k,a]),Ve=C.useCallback((Ie,je)=>{const Ze=Ie.target.x(),bt=Ie.target.y();if(p(_t=>({..._t,[je]:{x:Ze,y:bt}})),!k||!me)return;const mt=me.words.find(_t=>_t.id===je);if(!mt)return;const $t=typeof mt.word=="string"?mt.word:"",Wt=Math.max(60,$t.length*8+20),lt={x:Ze,y:bt,width:Wt,height:34},Qe=k.scale??k.scaleX??1,yt=(_t,zt)=>!(zt.x>_t.x+_t.width||zt.x+zt.width<_t.x||zt.y>_t.y+_t.height||zt.y+zt.height<_t.y),ft=me.blocks.find(_t=>{const zt=_t.coordinates,Jt={x:k.x+zt.x*Qe,y:k.y+zt.y*Qe,width:zt.width*Qe,height:zt.height*Qe};return yt(lt,Jt)});if(ft){y(pt=>({...pt,[ft.id]:je}));const _t=ft.coordinates,zt=k.x+_t.x*Qe,Jt=k.y+_t.y*Qe,De=_t.width*Qe,ut=_t.height*Qe;p(pt=>({...pt,[je]:{x:zt+(De-Wt)/2,y:Jt+(ut-34)/2}})),ne(`Word "${mt.word}" placed in block`,"success")}},[k,me,ne]),It=C.useCallback(()=>{if(!me)return 0;const Ie=me.words.length,je=Object.keys(g).length;return Ie>0?je/Ie*100:0},[me,g]);C.useEffect(()=>{const Ie=It();_(Ie)},[It]),C.useEffect(()=>{if(e&&!I){const Ie=new Date;V(Ie),console.log("⏱️ Test timer started at:",Ie.toISOString()),L(),console.log("🛡️ Anti-cheating tracking started")}},[e,I,L]);const st=C.useCallback(async()=>{if(me){E(!0);try{const Ie=me.words.length;let je=0;console.log("🔍 Scoring check - placedWords:",g),console.log("🔍 Scoring check - blocks:",me.blocks.map(De=>({id:De.id,word:De.word}))),console.log("🔍 Scoring check - words:",me.words.map(De=>({id:De.id,word:De.word}))),me.blocks.forEach(De=>{const ut=g[De.id];if(console.log(`🔍 Block ${De.id} (expects "${De.word}") has placed word ID: ${ut}`),ut){const pt=me.words.find(Pt=>Pt.id===ut);console.log("🔍 Placed word:",pt),pt&&pt.word===De.word?(je++,console.log(`✅ Correct! Block ${De.id} has correct word "${pt.word}"`)):console.log(`❌ Incorrect! Block ${De.id} expected "${De.word}" but got "${pt?.word||"nothing"}"`)}else console.log(`❌ Block ${De.id} has no word placed`)});const Ze=je,bt=Ie;console.log(`🎯 Final Score: ${Ze}/${bt} (${Math.round(Ze/bt*100)}%)`);const mt=new Date,$t=I?Math.round((mt-I)/1e3):0,Wt=I?I.toISOString():mt.toISOString();console.log("⏱️ Test timing:",{startedAt:Wt,endTime:mt.toISOString(),timeTaken:`${$t} seconds`});const lt=K();console.log("🛡️ Anti-cheating data for submission:",lt);const Qe=W.student_id,yt=`retest_assignment_id_${Qe}_matching_type_${e.id}`,ft=localStorage.getItem(yt),_t={test_id:e.id,test_name:e.test_name,teacher_id:e.teacher_id||null,subject_id:e.subject_id||null,student_id:Qe,answers:g,score:Ze,maxScore:bt,time_taken:$t,started_at:Wt,submitted_at:mt.toISOString(),caught_cheating:lt.caught_cheating,visibility_change_times:lt.visibility_change_times,retest_assignment_id:ft?Number(ft):null,parent_test_id:e.id};console.log("🔍 Submitting test data:",_t);const Jt=await(await M("/.netlify/functions/submit-matching-type-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_t)})).json();if(console.log("🔍 Submission response:",Jt),Jt.success){if(ne("Test submitted successfully!","success"),H(),B(),W?.student_id&&m0(W.student_id,"matching_type",e.id),W?.student_id){const ut=`test_completed_${W.student_id}_matching_type_${e.id}`;localStorage.setItem(ut,"true"),console.log("✅ Test marked as completed in localStorage:",ut)}if(W?.student_id){const{setCachedData:ut,CACHE_TTL:pt}=await Uo(async()=>{const{setCachedData:Lt,CACHE_TTL:sr}=await Promise.resolve().then(()=>Ih);return{setCachedData:Lt,CACHE_TTL:sr}},void 0),Pt=`student_results_table_${W.student_id}`;ut(Pt,Jt,pt.student_results_table),console.log("🎓 Test results cached with key:",Pt)}const De=`retest1_${Qe}_matching_type_${e.id}`;localStorage.removeItem(De),localStorage.removeItem(yt),t&&t(Ze)}else throw new Error(Jt.message||"Failed to submit test")}catch(Ie){console.error("❌ Error submitting test:",Ie),ne(`Error submitting test: ${Ie.message}`,"error")}finally{E(!1)}}},[me,g,e,W,I,M,ne,t]);return!e||!me?o.jsx(jr,{}):o.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:o.jsxs("div",{className:"max-w-6xl mx-auto",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:e.test_name})}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-sm text-gray-500",children:"Progress"}),o.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(v),"%"]})]})]}),o.jsx("div",{className:"mt-4 w-full bg-gray-200 rounded-full h-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${v}%`}})})]}),o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:o.jsx("div",{className:"lg:col-span-3",children:o.jsxs(kt,{className:"p-4",children:[o.jsxs("div",{className:"mb-4 text-center space-x-4",children:[o.jsx(nt,{onClick:ge,variant:"secondary",children:"Reset"}),o.jsx(nt,{onClick:Me,variant:"secondary",children:"Back to Cabinet"})]}),o.jsx("div",{ref:z,className:"w-full bg-gray-100 rounded-lg overflow-hidden",style:{height:`${ee}px`},children:k&&a?(()=>{const{Stage:Ie,Layer:je,KonvaImage:Ze}=d();return o.jsxs(Ie,{ref:Q,width:z.current?.clientWidth||800,height:ee,children:[o.jsxs(je,{children:[o.jsx(Ze,{ref:Y,image:k.image,x:k.x,y:k.y,width:k.width,height:k.height,listening:!1}),He(),qe()]}),o.jsx(je,{listening:!0,children:Xe()})]})})():k?o.jsxs("div",{className:"flex items-center justify-center h-full",children:[o.jsx(jr,{size:"lg"}),o.jsx("span",{className:"ml-2 text-gray-600",children:"Loading Konva canvas..."})]}):null}),o.jsx("div",{className:"mt-4 text-center",children:o.jsx(nt,{onClick:st,disabled:b||v<100,children:b?"Submitting...":"Submit Test"})})]})})}),o.jsx(Bo,{isOpen:X,onClose:()=>Z(!1),title:"Reset Test",size:"small",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to reset? This will clear all your progress and placed words."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(nt,{onClick:()=>Z(!1),variant:"secondary",children:"Cancel"}),o.jsx(nt,{onClick:_e,variant:"primary",children:"Reset"})]})]})}),o.jsx(Bo,{isOpen:ie,onClose:()=>q(!1),title:"Exit Test",size:"small",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to go back to cabinet? Your progress will be saved but you will exit the test."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(nt,{onClick:()=>q(!1),variant:"secondary",children:"Cancel"}),o.jsx(nt,{onClick:ue,variant:"primary",children:"Go Back"})]})]})})]})})},MW=({testName:e="",onTestSaved:t,onCancel:r,onBackToCabinet:n,isSaving:s=!1,validationErrors:a={}})=>{const{user:i}=Bn(),{makeAuthenticatedRequest:l}=zi(),{showNotification:c}=ka(),[d,f]=C.useState([{leftWord:"",rightWord:""},{leftWord:"",rightWord:""},{leftWord:"",rightWord:""}]),[p,g]=C.useState("drag"),[y,v]=C.useState(!1),[_,b]=C.useState(null),E=C.useCallback(()=>{f(R=>[...R,{leftWord:"",rightWord:""}])},[]),k=C.useCallback(R=>{d.length>1&&f(T=>T.filter((D,I)=>I!==R))},[d.length]),w=C.useCallback((R,T)=>{f(D=>D.map((I,V)=>V===R?{...I,leftWord:T}:I))},[]),N=C.useCallback((R,T)=>{f(D=>D.map((I,V)=>V===R?{...I,rightWord:T}:I))},[]),A=C.useCallback(()=>d.every(R=>R.leftWord.trim()&&R.rightWord.trim()),[d]),P=C.useCallback(async()=>{if(!A()){c("Please fill in all word pairs","error");return}v(!0),b(null);try{const R=d.map((D,I)=>({question_id:I+1,left_word:D.leftWord.trim(),right_word:D.rightWord.trim()})),T={test_name:e,num_questions:R.length,interaction_type:p,questions:R};console.log("🎯 Saving word matching test:",T),t({testName:e,numQuestions:R.length,interactionType:p,wordPairs:d,questions:R})}catch(R){console.error("Error saving word matching test:",R),b(R.message),c("Failed to save test: "+R.message,"error")}finally{v(!1)}},[e,d,p,A,l,c,t]);return o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"max-w-6xl mx-auto p-6",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Create Word Matching Test"}),o.jsx("p",{className:"text-gray-600",children:"Enter word pairs - position 1 left matches position 1 right"})]}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Choose Interaction Type"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:` p-4 border-2 rounded-lg cursor-pointer transition-all ${p==="drag"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>g("drag"),children:[o.jsxs("div",{className:"flex items-center mb-2",children:[o.jsx("input",{type:"radio",checked:p==="drag",onChange:()=>g("drag"),className:"mr-3"}),o.jsx("h4",{className:"font-medium",children:"Drag & Drop"})]}),o.jsx("p",{className:"text-sm text-gray-600",children:"Students drag words from left list to right list"}),o.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["• Easier for younger students",o.jsx("br",{}),"• Visual feedback on placement",o.jsx("br",{}),"• Mobile-friendly"]})]}),o.jsxs("div",{className:` p-4 border-2 rounded-lg cursor-pointer transition-all ${p==="arrow"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>g("arrow"),children:[o.jsxs("div",{className:"flex items-center mb-2",children:[o.jsx("input",{type:"radio",checked:p==="arrow",onChange:()=>g("arrow"),className:"mr-3"}),o.jsx("h4",{className:"font-medium",children:"Draw Arrows"})]}),o.jsx("p",{className:"text-sm text-gray-600",children:"Students draw arrows connecting matching words"}),o.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["• More challenging",o.jsx("br",{}),"• Better for visual learners",o.jsx("br",{}),"• Requires precision"]})]})]})]})}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"word-pairs-section",children:[o.jsxs("div",{className:"pairs-header flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Word Pairs"}),o.jsx(nt,{onClick:E,size:"sm",children:"+ Add Pair"})]}),o.jsx("div",{className:"pairs-list space-y-3",children:d.map((R,T)=>o.jsxs("div",{className:"word-pair-row flex items-center space-x-4 p-4 bg-gray-50 rounded-lg border",children:[o.jsx("div",{className:"pair-number flex-shrink-0",children:o.jsx("span",{className:"number-badge w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-semibold",children:T+1})}),o.jsx("div",{className:"left-word flex-1",children:o.jsx("input",{type:"text",value:R.leftWord,onChange:D=>w(T,D.target.value),placeholder:"Left word...",className:"word-input w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),o.jsx("div",{className:"pair-arrow flex-shrink-0 text-gray-500 text-xl",children:"→"}),o.jsx("div",{className:"right-word flex-1",children:o.jsx("input",{type:"text",value:R.rightWord,onChange:D=>N(T,D.target.value),placeholder:"Right word...",className:"word-input w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),o.jsx("div",{className:"pair-actions flex-shrink-0",children:o.jsx(nt,{onClick:()=>k(T),variant:"outline",size:"sm",className:"remove-btn w-8 h-8 p-0 text-red-500 hover:bg-red-50",disabled:d.length<=1,children:"×"})})]},T))})]})}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"preview-section",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Preview"}),o.jsx("div",{className:"preview-pairs space-y-2",children:d.map((R,T)=>o.jsxs("div",{className:"preview-pair flex items-center space-x-2 text-sm",children:[o.jsxs("span",{className:"preview-number font-semibold text-blue-600",children:[T+1,"."]}),o.jsx("span",{className:"preview-left px-2 py-1 bg-white rounded border",children:R.leftWord||"Left word"}),o.jsx("span",{className:"preview-arrow text-gray-500",children:"→"}),o.jsx("span",{className:"preview-right px-2 py-1 bg-white rounded border",children:R.rightWord||"Right word"})]},T))})]})}),o.jsxs("div",{className:"flex justify-center space-x-4",children:[o.jsx(nt,{onClick:P,disabled:!A()||y,className:"px-8",children:y?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",color:"white",className:"mr-2"}),"Saving Test..."]}):"Save Test"}),o.jsx(nt,{onClick:r,variant:"secondary",children:"Cancel"})]}),_&&o.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-600",children:_})})]})},OW=(e,t)=>{const[r,n,s]=Mj(`test_progress_${e}_${t}`,{}),[a,i]=C.useState(!1),[l,c]=C.useState(0),[d,f]=C.useState(0),[p,g]=C.useState(!1),[y,v]=C.useState(null),_=C.useRef(null),b=C.useRef(null),E=C.useCallback((L,H)=>{if(!window.tokenManager||!window.tokenManager.isAuthenticated()){console.warn("[WARN] Cannot save progress: No valid JWT token");return}n(K=>({...K,[L]:H})),console.log(`Saved progress for question ${L}:`,H)},[n]),k=C.useCallback(L=>!window.tokenManager||!window.tokenManager.isAuthenticated()?(console.warn("[WARN] Cannot get progress: No valid JWT token"),null):r[L]||null,[r]),w=C.useCallback(()=>{if(console.log(`[DEBUG] clearTestProgress called with testType: ${e}, testId: ${t}`),!window.tokenManager||!window.tokenManager.isAuthenticated()){console.warn("[WARN] Cannot clear progress: No valid JWT token");return}const L=`test_progress_${e}_${t}`;console.log(`[DEBUG] Removing localStorage key: ${L}`);const H=Object.keys(r).length>0;s(),console.log(H?`[DEBUG] Progress cleared for test ${e}_${t}`:`[DEBUG] No progress found to clear for test ${e}_${t}`)},[s,e,t,r]),N=C.useCallback(()=>{_.current&&(N(_.current),_.current=null),b.current&&(N(b.current),b.current=null)},[]),A=C.useCallback(()=>{console.log(`[DEBUG] setupProgressTrackingForPage called with testType: ${e}, testId: ${t}`),b.current=setInterval(()=>{console.log("[DEBUG] Auto-saving progress..."),I()},3e4),console.log("[DEBUG] Progress tracking interval set up (30 seconds)")},[e,t]),P=C.useCallback(()=>{console.log(`[DEBUG] updateProgressDisplayForPage called with testType: ${e}, testId: ${t}`);const L=D(),H=d>0?Math.round(L/d*100):0;return console.log(`[DEBUG] Progress: ${L}/${d} questions answered`),console.log(`[DEBUG] Progress bar updated: ${H}%`),{answeredQuestions:L,totalQuestions:d,percentage:H}},[e,t,d]),R=C.useCallback(()=>{console.log("[DEBUG] updateSubmitButtonStateForPage called");const L=D();console.log(`[DEBUG] Submit button state check: ${L}/${d} questions answered`);const H=L===d&&d>0;return console.log(H?"[DEBUG] Submit button enabled - all questions answered":"[DEBUG] Submit button disabled - not all questions answered"),H},[d]),T=C.useCallback(()=>{console.log(`[DEBUG] loadSavedProgressForPage called with testType: ${e}, testId: ${t}`);try{if(console.log("[DEBUG] Loaded progress from localStorage:",r),Object.keys(r).length===0){console.log("[DEBUG] No saved progress found");return}const L=Object.keys(r).length;c(L),console.log(`[DEBUG] Restored ${L} answered questions`)}catch(L){console.error("[ERROR] Failed to load saved progress:",L),v(L.message)}},[e,t,r]),D=C.useCallback(()=>{console.log(`[DEBUG] getAnsweredQuestionsCountForPage called with testType: ${e}`);const L=Object.keys(r).length;return c(L),console.log(`[DEBUG] Found ${L} answered questions`),L},[e,r]),I=C.useCallback(()=>{console.log(`[DEBUG] saveProgressForPage called with testType: ${e}, testId: ${t}`);try{console.log("[DEBUG] Progress saved:",r)}catch(L){console.error("[ERROR] Failed to save progress:",L),v(L.message)}},[e,t,r]),V=C.useCallback(()=>{try{const L=`test_completed_${e}_${t}`,H=localStorage.getItem(L)==="true";return i(H),H}catch(L){return console.error("Error checking test completion:",L),!1}},[e,t]),X=C.useCallback(()=>{try{const L=`test_completed_${e}_${t}`;localStorage.setItem(L,"true"),i(!0),console.log(`Test ${e}_${t} marked as completed`)}catch(L){console.error("Error marking test completed:",L)}},[e,t]),Z=C.useCallback(()=>{console.log("Marking test completed in UI:",{testType:e,testId:t}),X()},[e,t,X]),ie=C.useCallback(L=>{try{const H=`test_creation_state_${e}_${t}`;localStorage.setItem(H,JSON.stringify(L)),console.log("Test creation state saved:",L)}catch(H){console.error("Error saving test creation state:",H)}},[e,t]),q=C.useCallback(()=>{try{const L=`test_creation_state_${e}_${t}`;localStorage.removeItem(L),console.log("Test creation state cleared")}catch(L){console.error("Error clearing test creation state:",L)}},[e,t]),ne=C.useCallback((L,H)=>{try{const K=`test_step_${e}_${t}_${L}`;localStorage.setItem(K,JSON.stringify(H)),console.log(`Step ${L} data saved:`,H)}catch(K){console.error(`Error saving step ${L} data:`,K)}},[e,t]),M=C.useCallback(L=>{try{const H=`test_step_${e}_${t}_${L}`,K=localStorage.getItem(H);return K?JSON.parse(K):null}catch(H){return console.error(`Error restoring step ${L} data:`,H),null}},[e,t]),W=C.useCallback(()=>{try{const L=`test_creation_state_${e}_${t}`,H=localStorage.getItem(L);return H?JSON.parse(H):null}catch(L){return console.error("Error restoring test creation state:",L),null}},[e,t]);return C.useEffect(()=>()=>{N()},[e,t,A,T,N]),C.useEffect(()=>{D()},[r,D]),{progress:r,isCompleted:a,answeredCount:l,totalQuestions:d,isLoading:p,error:y,saveProgress:E,getProgress:k,clearProgress:w,clearInterval:N,setupProgressTracking:A,updateProgress:P,updateSubmitButton:R,loadProgress:T,getAnsweredCount:D,saveProgressForPage:I,checkCompleted:V,markCompleted:X,markCompletedUI:Z,saveState:ie,clearState:q,saveStepData:ne,restoreStepData:M,restoreState:W,setTotalQuestions:f,setError:v}},LW=({testData:e,onTestComplete:t,onBackToCabinet:r})=>{const{user:n}=Bn(),{makeAuthenticatedRequest:s}=zi(),[a,i]=C.useState({width:window.innerWidth,height:window.innerHeight});C.useEffect(()=>{const Ie=()=>{i({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",Ie),()=>window.removeEventListener("resize",Ie)},[]);const{getCheatingData:l,stopTracking:c,clearData:d}=Wp(),[f,p]=C.useState(null),[g,y]=C.useState({}),[v,_]=C.useState(null),b=C.useRef(null),[E,k]=C.useState(800),w={VERY_SMALL:400,MOBILE:600,TABLET:900},N={VERY_SMALL:.6,MOBILE:.8,TABLET:.9,DESKTOP:1},A={CANVAS_HEIGHT:400,BLOCK_WIDTH:140,BLOCK_HEIGHT:50,BLOCK_SPACING:100,MARGIN:50,PADDING:20},P=a.width<w.VERY_SMALL,R=a.width>=w.VERY_SMALL&&a.width<w.MOBILE,T=a.width>=w.MOBILE&&a.width<w.TABLET;a.width>=w.TABLET;const D=P?N.VERY_SMALL:R?N.MOBILE:T?N.TABLET:N.DESKTOP;C.useEffect(()=>{const Ie=()=>{if(b.current){const Ze=b.current.clientWidth;console.log("🎯 Container width detected:",Ze),Ze>0&&k(Ze)}};Ie();const je=[setTimeout(Ie,50),setTimeout(Ie,100),setTimeout(Ie,200),setTimeout(Ie,500)];return window.addEventListener("resize",Ie),()=>{je.forEach(Ze=>clearTimeout(Ze)),window.removeEventListener("resize",Ie)}},[f]);const I=Math.max(A.CANVAS_HEIGHT*D,(f?.leftWords?.length||3)*A.BLOCK_SPACING*D+A.PADDING*2),V=A.BLOCK_WIDTH*D,X=A.BLOCK_HEIGHT*D,Z=A.BLOCK_SPACING*D,ie=A.MARGIN*D,q=ie;console.log("🎯 Mobile Debug:",{screenWidth:a.width,containerWidth:b.current?.clientWidth,canvasWidth:E,scale:D,blockWidth:V,margin:ie,leftBlockX:q,displayDataLoaded:!!f});const ne=q+V+20+V+ie,M=ne<=E;let W,L=V,H=X;if(M)W=Math.min(Math.max(q+V+20,E-V-ie),E-V-ie);else{const Ie=E-ie*2,je=Math.floor((Ie-20)/2);L=Math.max(60,je),H=Math.max(30,H*(L/V)),W=q+L+20,console.log("🎯 Very small screen - adjusted block size:",{availableWidth:Ie,maxBlockWidth:je,actualBlockWidth:L,actualBlockHeight:H})}console.log("🎯 Right Block Position:",{rightBlockX:W,rightBlockRightEdge:W+L,canvasWidth:E,fits:W+L<=E,canFitSideBySide:M,minRequiredWidth:ne});const K=ie,B={DRAGGED_WORD:Math.max(8,14*D),ORIGINAL_WORD:Math.max(10,16*D),LEFT_WORD:Math.max(10,14*D)},z=Math.max(1,3*D),[Q,Y]=C.useState([]),[te,ee]=C.useState(!1),[ae,ge]=C.useState(null),[_e,Me]=C.useState(!1),[ue,me]=C.useState(!1);C.useEffect(()=>{if(e&&(p(e),ge(new Date),n?.student_id)){const Ie=`test_progress_${n.student_id}_word_matching_${e.id}`,je=jn(Ie);je&&(y(je.answers||{}),Y(je.arrows||[]),ge(new Date(je.startTime)),console.log("🎯 Test progress restored:",je))}},[e,n?.student_id]),C.useEffect(()=>{if(f&&ae&&n?.student_id){const Ie=setInterval(()=>{const je={answers:g,arrows:Q,startTime:ae.toISOString()},Ze=`test_progress_${n.student_id}_word_matching_${e.id}`;Fn(Ze,je,Dn.test_progress),console.log("🎯 Progress auto-saved")},3e4);return()=>clearInterval(Ie)}},[f,g,Q,ae,n?.student_id,e?.id]);const He=C.useCallback((Ie,je)=>{if(e.interaction_type==="arrow")if(v){if(v.side===Ie&&v.index===je)_(null);else if(v.side!==Ie){const Ze={id:Date.now().toString(),startWord:v,endWord:{side:Ie,index:je},color:"#3B82F6"};Y(bt=>[...bt,Ze]),y(bt=>({...bt,[v.index]:je})),_(null)}}else _({side:Ie,index:je})},[v,e?.interaction_type]);C.useCallback((Ie,je)=>{e.interaction_type==="drag"&&y(Ze=>({...Ze,[Ie]:je}))},[e?.interaction_type]);const qe=C.useCallback(()=>{Me(!0)},[]),Xe=C.useCallback(()=>{y({}),Y([]),_(null),Me(!1)},[]),Ve=C.useCallback(()=>{me(!0)},[]),It=C.useCallback(()=>{me(!1),r&&r()},[r]),st=C.useCallback(async()=>{if(f){ee(!0);try{const Ie=f.leftWords.length;let je=0,Ze={};e.interaction_type==="drag"?Object.entries(g).forEach(([ut,pt])=>{const Pt=f.correctPairs[ut];pt===Pt&&je++,Ze[ut]=pt}):Q.forEach(ut=>{const pt=ut.startWord.side==="left"?ut.startWord.index:ut.endWord.index,Pt=ut.startWord.side==="right"?ut.startWord.index:ut.endWord.index;f.correctPairs[pt]===Pt&&je++,Ze[pt]=Pt});const bt=je,mt=Ie;console.log(`🎯 Final Score: ${bt}/${mt} (${Math.round(bt/mt*100)}%)`);const $t=new Date,Wt=ae?Math.round(($t-ae)/1e3):0,lt=ae?ae.toISOString():$t.toISOString(),Qe=l(),yt=n.student_id,ft=`retest_assignment_id_${yt}_word_matching_${e.id}`,_t=localStorage.getItem(ft),zt={test_id:e.id,test_name:e.test_name,teacher_id:e.teacher_id||null,subject_id:e.subject_id||null,student_id:yt,parent_test_id:e.id,retest_assignment_id:_t?Number(_t):null,interaction_type:e.interaction_type,answers:Ze,score:bt,maxScore:mt,time_taken:Wt,started_at:lt,submitted_at:$t.toISOString(),caught_cheating:Qe.caught_cheating,visibility_change_times:Qe.visibility_change_times};console.log("🎯 Submission data being sent:",zt),console.log("🎯 TestData structure:",e),console.log("🎯 Submitting test results...");const Jt=await s("/.netlify/functions/submit-word-matching-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(zt)});console.log("🎯 Submission response received:",Jt.status);const De=await Jt.json();if(De.success){if(c(),d(),n?.student_id){const ut=`test_completed_${n.student_id}_word_matching_${e.id}`;localStorage.setItem(ut,"true"),console.log("✅ Test marked as completed in localStorage:",ut);const pt=`retest1_${yt}_word_matching_${e.id}`;localStorage.removeItem(pt),localStorage.removeItem(ft),m0(n.student_id,"word_matching",e.id),console.log("🎓 Test data cleared from cache");const Pt=`student_results_table_${n.student_id}`;Fn(Pt,De,Dn.student_results_table),console.log("🎓 Test results cached with key:",Pt)}setTimeout(()=>{t&&t(bt)},2e3)}else throw new Error(De.message||"Failed to submit test")}catch(Ie){console.error("Error submitting test:",Ie)}finally{ee(!1)}}},[f,g,Q,e,n,ae,l,c,d,s,t]);return f?o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"max-w-4xl mx-auto p-6",children:[o.jsx(Bo,{isOpen:te,onClose:()=>{},title:"Submitting",size:"small",children:o.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[o.jsx(jr,{size:"lg",className:"mb-3"}),o.jsx("p",{className:"text-blue-600 font-semibold text-lg",children:"Submitting test..."}),o.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Please wait while we process your results"})]})}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.test_name}),o.jsx("p",{className:"text-gray-600",children:e.interaction_type==="drag"?"Drag words from left to right to match them":"Click on the word or phrase on the left, then click on the matching word or phrase on the right to connect them"})]})}),e.interaction_type==="drag"?o.jsx(kt,{className:"mb-6",children:o.jsx("div",{ref:b,className:"relative w-full",children:o.jsx(Qd,{width:E,height:I,className:`border-2 border-gray-200 rounded-lg ${te?"pointer-events-none opacity-50":""}`,children:o.jsxs(Yd,{children:[f.leftWords.map((Ie,je)=>{const Ze=g[je]!==void 0,bt=K+je*Z;return o.jsxs($o,{x:q,y:bt,draggable:!Ze,onDragStart:mt=>{mt.target.moveToTop()},onDragEnd:mt=>{mt.target.getStage();const $t=f.rightWords,Wt=L+60,lt=H+30,Qe=W-30,yt=K-15;console.log("🎯 Drop detection - Word dropped at:",mt.target.x(),mt.target.y());for(let ft=0;ft<$t.length;ft++){const _t=yt+ft*Z,zt=Qe,Jt=Qe+Wt,De=_t,ut=_t+lt;if(console.log(`🎯 Checking drop zone ${ft}:`,{left:zt,right:Jt,top:De,bottom:ut,word:$t[ft]}),mt.target.x()>=zt&&mt.target.x()<=Jt&&mt.target.y()>=De&&mt.target.y()<=ut){console.log(`✅ Match found! Word "${f.leftWords[je]}" matched with "${$t[ft]}"`),y(pt=>({...pt,[je]:ft}));break}}console.log("❌ No match found, resetting position"),mt.target.position({x:q,y:bt})},children:[o.jsx(ra,{width:L,height:H,fill:Ze?"#e5e7eb":"#3b82f6",stroke:Ze?"#9ca3af":"#1d4ed8",strokeWidth:2,cornerRadius:8,opacity:Ze?.5:1}),o.jsx(kl,{text:Ie,x:L/2,y:H/2,fontSize:B.LEFT_WORD,fontFamily:"Arial",fill:Ze?"#dc2626":"white",align:"center",verticalAlign:"middle",width:L,offsetX:L/2,offsetY:H/2,wrap:"word",ellipsis:!0,listening:!1})]},`left-${je}`)}),f.rightWords.map((Ie,je)=>{const Ze=K+je*Z,bt=Object.keys(g).find(mt=>g[mt]===je);return o.jsxs($o,{x:W,y:Ze,children:[o.jsx(ra,{width:L,height:H,fill:bt?"#10b981":"#f3f4f6",stroke:bt?"#059669":"#d1d5db",strokeWidth:2,cornerRadius:8}),o.jsx(kl,{text:Ie,x:L/2,y:H/2,fontSize:B.ORIGINAL_WORD,fontFamily:"Arial",fill:"#000000",align:"center",verticalAlign:"middle",width:L,offsetX:L/2,offsetY:H/2,wrap:"word",ellipsis:!0,listening:!1}),bt&&o.jsx(kl,{text:f.leftWords[bt],x:V/2,y:X/4,fontSize:B.DRAGGED_WORD,fontFamily:"Arial",fill:"#dc2626",align:"center",verticalAlign:"middle",width:L,offsetX:L/2,offsetY:H/8,wrap:"word",ellipsis:!0})]},`right-${je}`)})]})})})}):o.jsx(kt,{className:"mb-6",children:o.jsx("div",{ref:b,className:"relative w-full",children:o.jsx(Qd,{width:E,height:I,className:`border-2 border-gray-200 rounded-lg ${te?"pointer-events-none opacity-50":""}`,children:o.jsxs(Yd,{children:[f.leftWords.map((Ie,je)=>{const Ze=K+je*Z,bt=v?.side==="left"&&v?.index===je;return o.jsxs($o,{x:q,y:Ze,onClick:()=>He("left",je),children:[o.jsx(ra,{width:L,height:H,fill:bt?"#3b82f6":"#f3f4f6",stroke:bt?"#1d4ed8":"#d1d5db",strokeWidth:bt?3:2,cornerRadius:8}),o.jsx(kl,{text:Ie,x:V/2,y:X/2,fontSize:B.LEFT_WORD,fontFamily:"Arial",fill:bt?"white":"#374151",align:"center",verticalAlign:"middle",width:L,offsetX:L/2,offsetY:H/2,wrap:"word",ellipsis:!0,listening:!1})]},`left-${je}`)}),f.rightWords.map((Ie,je)=>{const Ze=K+je*Z,bt=v?.side==="right"&&v?.index===je;return o.jsxs($o,{x:W,y:Ze,onClick:()=>He("right",je),children:[o.jsx(ra,{width:L,height:H,fill:bt?"#3b82f6":"#f3f4f6",stroke:bt?"#1d4ed8":"#d1d5db",strokeWidth:bt?3:2,cornerRadius:8}),o.jsx(kl,{text:Ie,x:V/2,y:X/2,fontSize:B.ORIGINAL_WORD,fontFamily:"Arial",fill:"#000000",align:"center",verticalAlign:"middle",width:L,offsetX:L/2,offsetY:H/2,wrap:"word",ellipsis:!0,listening:!1})]},`right-${je}`)}),Q.map((Ie,je)=>{const Ze=K+Ie.startWord.index*Z+X/2,bt=K+Ie.endWord.index*Z+X/2;return o.jsx(xa,{points:[q+V+20,Ze,W-20,bt],stroke:Ie.color||"#3b82f6",strokeWidth:z,lineCap:"round",lineJoin:"round"},je)})]})})})}),o.jsx(kt,{children:o.jsxs("div",{className:`submit-section flex justify-center space-x-4 ${te?"pointer-events-none opacity-50":""}`,children:[o.jsx(nt,{onClick:qe,variant:"outline",disabled:te,children:"Reset"}),o.jsx(nt,{onClick:Ve,variant:"outline",disabled:te,children:"Back to Cabinet"}),o.jsx(nt,{onClick:st,disabled:te,className:"px-8",children:te?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",color:"white",className:"mr-2"}),"Submitting..."]}):"Submit Test"})]})}),o.jsx(Bo,{isOpen:_e&&!te,onClose:()=>Me(!1),title:"Reset Test",size:"small",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to reset? This will clear all your progress and answers."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(nt,{onClick:()=>Me(!1),variant:"secondary",children:"Cancel"}),o.jsx(nt,{onClick:Xe,variant:"primary",children:"Reset"})]})]})}),o.jsx(Bo,{isOpen:ue&&!te,onClose:()=>me(!1),title:"Exit Test",size:"small",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to leave the test? Your progress will be saved."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(nt,{onClick:()=>me(!1),variant:"secondary",children:"Cancel"}),o.jsx(nt,{onClick:It,variant:"primary",children:"Leave"})]})]})})]}):o.jsx("div",{className:"flex justify-center items-center min-h-screen",children:o.jsx(jr,{size:"lg"})})},BW=({id:e,x:t,y:r,width:n,height:s,text:a,fontSize:i,color:l,isSelected:c,onSelect:d,onUpdate:f,onDelete:p})=>{const g=v=>{v.cancelBubble=!0,f(e,{isEditing:!0})},y=v=>{f(e,{x:v.target.x(),y:v.target.y()})};return o.jsxs($o,{x:t,y:r,draggable:!0,onClick:v=>{v.cancelBubble=!0,d(e)},onDblClick:g,onDragEnd:y,children:[o.jsx(ra,{width:n,height:s,fill:c?"#fef3c7":"#ffffff",stroke:c?"#f59e0b":"#d1d5db",strokeWidth:c?2:1,cornerRadius:6,shadowColor:"black",shadowBlur:2,shadowOffset:{x:1,y:1}}),o.jsx(kl,{text:a,width:n,height:s,padding:8,align:"left",verticalAlign:"top",fontSize:i,fill:l,wrap:"word"})]})},UW=({x:e,y:t,width:r,height:n,initialText:s,onSave:a,onCancel:i})=>{const l=C.useRef(null);C.useEffect(()=>{l.current&&(l.current.focus(),l.current.select())},[]);const c=d=>{d.key==="Enter"&&!d.shiftKey?(d.preventDefault(),a(l.current.value)):d.key==="Escape"&&i()};return o.jsx("textarea",{ref:l,defaultValue:s,style:{position:"absolute",top:t,left:e,width:r,height:n,fontSize:"14px",border:"2px solid #f59e0b",borderRadius:"6px",padding:"8px",background:"white",resize:"none",outline:"none",fontFamily:"inherit",lineHeight:"1.4",zIndex:1e3},onKeyDown:c,onBlur:()=>a(l.current.value)})},$W=({width:e,height:t,lines:r,onDrawingChange:n,currentTool:s,currentColor:a,currentThickness:i,zoom:l,onZoomChange:c,isPanning:d,isFullscreen:f,constrainPanPosition:p,handleWheel:g,stageRef:y,setIsPanning:v,responsiveDimensions:_,canvasSize:b,question:E,textBoxes:k,setTextBoxes:w,selectedTextBox:N,setSelectedTextBox:A,handleTextBoxSelect:P,handleTextBoxUpdate:R,handleTextBoxDelete:T,isEditingText:D,editingTextBox:I,setIsEditingText:V,setEditingTextBox:X,setCurrentTool:Z})=>{const[ie,q]=C.useState(!1),[ne,M]=C.useState([]),[W,L]=C.useState(null),[H,K]=C.useState(null),B=C.useRef(null),[z,Q]=C.useState(.25),[Y,te]=C.useState({x:0,y:0});C.useEffect(()=>{const fe=()=>{const we=B.current;if(!we)return;const Ue=we.clientWidth||1,St=we.clientHeight||1,xt=Math.min(Ue/(b.width||1),St/(b.height||1));Q(Math.min(xt,1))};return fe(),window.addEventListener("resize",fe),()=>window.removeEventListener("resize",fe)},[b.width,b.height,f]);const ee=fe=>{const we=y.current,Ue=we.getPointerPosition();if(s==="pan")return;if(s==="text"){const xt={x:(Ue.x-we.x())/we.scaleX(),y:(Ue.y-we.y())/we.scaleY()},Ht={id:Date.now(),x:xt.x,y:xt.y,width:150,height:60,text:"Double-click to edit",fontSize:14,color:"#000000"};w(Ot=>[...Ot,Ht]),A(Ht.id),Z("pan");return}q(!0);const St={x:(Ue.x-we.x())/we.scaleX(),y:(Ue.y-we.y())/we.scaleY()};K(St),s==="pencil"?M([{x:St.x,y:St.y,color:a,thickness:i}]):s==="eraser"?M([{x:St.x,y:St.y,color:a,thickness:i,tool:"eraser"}]):["line","rectangle","circle"].includes(s)&&L({type:s,startX:St.x,startY:St.y,endX:St.x,endY:St.y,color:a,thickness:i})},ae=fe=>{const we=y.current,Ue=we.getPointerPosition(),St={x:(Ue.x-we.x())/we.scaleX(),y:(Ue.y-we.y())/we.scaleY()};if(te(St),s!=="pan"&&ie)if(s==="pencil"){const xt=[...ne,{x:St.x,y:St.y,color:a,thickness:i}];M(xt)}else if(s==="eraser"){const xt=[...ne,{x:St.x,y:St.y,color:a,thickness:i,tool:"eraser"}];M(xt)}else["line","rectangle","circle"].includes(s)&&W&&L({...W,endX:St.x,endY:St.y})},ge=()=>{if(s!=="pan"&&ie){if(s==="pencil"){const fe=[...r,ne];n(fe),M([])}else if(s==="eraser"){const fe=[...r,ne];n(fe),M([])}else if(["line","rectangle","circle"].includes(s)&&W){const fe=[...r,W];n(fe),L(null)}q(!1),K(null)}},[_e,Me]=C.useState(null),[ue,me]=C.useState(null),[He,qe]=C.useState(!1),[Xe,Ve]=C.useState(null),[It,st]=C.useState(!1),[Ie,je]=C.useState(!1),[Ze,bt]=C.useState([]),[mt,$t]=C.useState(null),[Wt,lt]=C.useState({totalGestures:0,zoomGestures:0,panGestures:0,combinedGestures:0,averageResponseTime:0});let Qe=null;const ft=(window.devicePixelRatio||1)>1.5,_t={scaleDelta:ft?.03:.04,centerDelta:ft?4:6,minTouchDistance:8,gestureHysteresis:.02},zt=()=>{st(!1),Ve(null),Me(null),me(null),q(!1),K(null),je(!1),$t(null),Qe&&(cancelAnimationFrame(Qe),Qe=null),y.current&&y.current.stop()},Jt=fe=>{if(fe.length<2)return 0;const we=fe[0],Ue=fe[1];return Math.sqrt(Math.pow(Ue.clientX-we.clientX,2)+Math.pow(Ue.clientY-we.clientY,2))},De=fe=>{if(fe.length<2)return null;const we=fe[0],Ue=fe[1];return{x:(we.clientX+Ue.clientX)/2,y:(we.clientY+Ue.clientY)/2}},ut=fe=>{bt(we=>[...we,{type:fe,timestamp:Date.now()}].slice(-5))},pt=()=>{const fe=Date.now(),we=Ze.filter(xt=>fe-xt.timestamp<500);if(we.length<2)return 0;const Ue=we[we.length-1],St=we[we.length-2];return Ue.type===St.type?_t.gestureHysteresis:0},Pt=(fe,we)=>{lt(Ue=>({totalGestures:Ue.totalGestures+1,zoomGestures:fe.includes("zoom")?Ue.zoomGestures+1:Ue.zoomGestures,panGestures:fe.includes("pan")?Ue.panGestures+1:Ue.panGestures,combinedGestures:fe==="zoom+pan"?Ue.combinedGestures+1:Ue.combinedGestures,averageResponseTime:(Ue.averageResponseTime+we)/2}))},Lt=(fe,we,Ue,St)=>{const xt=y.current,Ht=xt.scaleX(),Ot=xt.position();let Xt=Ht,pr=Ot;if(fe){const vr=Ue/_e,Mr=Ht*vr,sn=E?.max_canvas_width||1536,le=E?.max_canvas_height||2048,be=sn/b.width,pe=le/b.height,xe=Math.min(be,pe,1);Xt=Math.max(.25,Math.min(xe,Mr));const Se=St,ke={x:(Se.x-xt.x())/Ht,y:(Se.y-xt.y())/Ht};pr={x:Se.x-ke.x*Xt,y:Se.y-ke.y*Xt}}if(we){const vr=St.x-ue.x,Mr=St.y-ue.y;fe?pr={x:pr.x+vr,y:pr.y+Mr}:pr={x:Ot.x+vr,y:Ot.y+Mr}}Qe||(Qe=requestAnimationFrame(()=>{xt.scale({x:Xt,y:Xt}),xt.position(pr),xt.batchDraw(),Qe=null})),fe&&we?(Ve("zoom+pan"),je(!0)):fe?(Ve("zoom"),je(!0)):we&&Ve("pan");const fr=Date.now()-(mt||Date.now());Pt(fe&&we?"zoom+pan":fe?"zoom":"pan",fr),console.log("🎨 Combined gesture",{doZoom:fe,doPan:we,scale:Xt.toFixed(2),pos:pr})},sr=fe=>{const we=fe.evt.touches;we.length===2?(fe.evt.preventDefault(),st(!0),Ve(null),Me(Jt(we)),me(De(we)),q(!1),$t(Date.now())):we.length===1&&(st(!1),Ve(null),ee())},Te=fe=>{const we=fe.evt.touches;if(we.length===2&&It){fe.evt.preventDefault();const Ue=y.current,St=Jt(we),xt=De(we);if(_e&&ue&&Ue&&St>_t.minTouchDistance){const Ht=Math.abs(St/_e-1),Ot=Math.sqrt(Math.pow(xt.x-ue.x,2)+Math.pow(xt.y-ue.y,2)),Xt=pt(),pr=_t.scaleDelta-Xt,Fr=_t.centerDelta-Xt*10,fr=Ht>pr,vr=Ot>Fr;(fr||vr)&&(Lt(fr,vr,St,xt),fr&&vr?ut("zoom+pan"):fr?ut("zoom"):vr&&ut("pan")),console.log("🎨 Gesture Debug",{scaleDelta:Ht.toFixed(3),centerDelta:Ot.toFixed(1),doZoom:fr,doPan:vr,hysteresis:Xt.toFixed(3),adjustedScaleDelta:pr.toFixed(3),adjustedCenterDelta:Fr.toFixed(1),gestureHistory:Ze.slice(-3)})}Me(St),me(xt)}else we.length===1&&!It&&(fe.evt.preventDefault(),ae())},ve=fe=>{const we=fe.evt.touches;we.length===0?(ge(),zt(),je(!1)):we.length===1&&(st(!1),Ve(null),Me(null),me(null),je(!1))};return o.jsx("div",{className:"relative w-full block sm:flex sm:justify-center",children:o.jsx("div",{className:"w-full max-w-full block sm:flex sm:justify-center",children:o.jsxs("div",{className:"relative",style:{border:f&&(_.width<window.innerWidth-40||_.height<window.innerHeight-40)?"2px solid #000000":"none",borderRadius:"8px",overflow:"hidden"},children:[o.jsx("div",{ref:B,className:"w-full h-full",children:o.jsx(Qd,{ref:y,width:_.width,height:_.height,scaleX:f?_.zoom:l,scaleY:f?_.zoom:l,onMouseDown:ee,onMousemove:ae,onMouseup:ge,onTouchStart:sr,onTouchMove:Te,onTouchEnd:ve,onWheel:g||(()=>{}),onDragStart:()=>{console.log("🎯 Drag started"),s==="pan"&&v(!0)},onDragEnd:()=>{if(console.log("🎯 Drag ended"),s==="pan"&&(v(!1),p)){const fe=y.current,we=B.current,Ue=we?.clientWidth||_.width,St=we?.clientHeight||_.height,xt=b.width*fe.scaleX(),Ht=b.height*fe.scaleY(),Ot=fe.x(),Xt=fe.y();(Ot>Ue||Ot<-xt||Xt>St||Xt<-Ht)&&p(fe)}},draggable:s==="pan"&&l>.25,className:`border-0 rounded-none shadow-none sm:border sm:rounded-lg sm:shadow-sm ${s==="pan"?"cursor-grab":d?"cursor-grabbing":"cursor-crosshair"}`,style:{width:"100%",height:"auto"},onLoad:()=>{console.log("�� DrawingTestStudent - Stage loaded with dimensions:",_.width,"x",_.height),console.log("�� DrawingTestStudent - Canvas size:",b.width,"x",b.height),console.log("�� DrawingTestStudent - Current zoom level:",l),console.log("�� DrawingTestStudent - Effective display size:",Math.round(b.width*l),"x",Math.round(b.height*l)),console.log("�� DrawingTestStudent - Total pixels displayed:",Math.round(b.width*l*b.height*l))},children:o.jsxs(Yd,{children:[o.jsx(ra,{x:0,y:0,width:b.width,height:b.height,fill:"white"}),r.map((fe,we)=>{if(Array.isArray(fe)){const Ue=fe[0]?.tool==="eraser";return o.jsx(xa,{points:fe.flatMap(St=>[St.x,St.y]),stroke:Ue?"black":fe[0]?.color||"#000000",strokeWidth:Ue?(fe[0]?.thickness||2)*7:fe[0]?.thickness||2,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:Ue?"destination-out":"source-over"},we)}else{if(fe.type==="line")return o.jsx(xa,{points:[fe.startX,fe.startY,fe.endX,fe.endY],stroke:fe.color,strokeWidth:fe.thickness,lineCap:"round"},we);if(fe.type==="rectangle"){const Ue=Math.abs(fe.endX-fe.startX),St=Math.abs(fe.endY-fe.startY),xt=Math.min(fe.startX,fe.endX),Ht=Math.min(fe.startY,fe.endY);return o.jsx(ra,{x:xt,y:Ht,width:Ue,height:St,stroke:fe.color,strokeWidth:fe.thickness,fill:"transparent"},we)}else if(fe.type==="circle"){const Ue=Math.sqrt(Math.pow(fe.endX-fe.startX,2)+Math.pow(fe.endY-fe.startY,2))/2,St=(fe.startX+fe.endX)/2,xt=(fe.startY+fe.endY)/2;return o.jsx(ju,{x:St,y:xt,radius:Ue,stroke:fe.color,strokeWidth:fe.thickness,fill:"transparent"},we)}}return null}),k.map(fe=>o.jsx(BW,{...fe,isSelected:N===fe.id,onSelect:P,onUpdate:R,onDelete:T},fe.id)),s==="pencil"&&o.jsx(xa,{points:ne.flatMap(fe=>[fe.x,fe.y]),stroke:a,strokeWidth:i,tension:.5,lineCap:"round",lineJoin:"round"}),s==="eraser"&&o.jsx(xa,{points:ne.flatMap(fe=>[fe.x,fe.y]),stroke:"black",strokeWidth:i*7,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:"destination-out"}),W&&W.type==="line"&&o.jsx(xa,{points:[W.startX,W.startY,W.endX,W.endY],stroke:W.color,strokeWidth:W.thickness,lineCap:"round"}),W&&W.type==="rectangle"&&o.jsx(ra,{x:Math.min(W.startX,W.endX),y:Math.min(W.startY,W.endY),width:Math.abs(W.endX-W.startX),height:Math.abs(W.endY-W.startY),stroke:W.color,strokeWidth:W.thickness,fill:"transparent"}),W&&W.type==="circle"&&o.jsx(ju,{x:(W.startX+W.endX)/2,y:(W.startY+W.endY)/2,radius:Math.sqrt(Math.pow(W.endX-W.startX,2)+Math.pow(W.endY-W.startY,2))/2,stroke:W.color,strokeWidth:W.thickness,fill:"transparent"}),s==="eraser"&&o.jsx(ju,{x:Y.x,y:Y.y,radius:i*7/2,stroke:"#666666",strokeWidth:2,fill:"rgba(102, 102, 102, 0.2)",dash:[5,5],listening:!1}),s==="pencil"&&o.jsx(xa,{points:[Y.x-10,Y.y,Y.x+10,Y.y,Y.x,Y.y-10,Y.x,Y.y+10],stroke:"#666666",strokeWidth:1,listening:!1}),s==="line"&&o.jsx(xa,{points:[Y.x-10,Y.y,Y.x+10,Y.y,Y.x,Y.y-10,Y.x,Y.y+10],stroke:"#666666",strokeWidth:1,listening:!1}),s==="rectangle"&&o.jsx(xa,{points:[Y.x-10,Y.y,Y.x+10,Y.y,Y.x,Y.y-10,Y.x,Y.y+10],stroke:"#666666",strokeWidth:1,listening:!1}),s==="circle"&&o.jsx(xa,{points:[Y.x-10,Y.y,Y.x+10,Y.y,Y.x,Y.y-10,Y.x,Y.y+10],stroke:"#666666",strokeWidth:1,listening:!1})]})})}),D&&I&&o.jsx(UW,{x:I.x,y:I.y,width:I.width,height:I.height,initialText:I.text,onSave:fe=>{R(I.id,{text:fe}),V(!1),X(null)},onCancel:()=>{V(!1),X(null)}}),o.jsxs("div",{className:"absolute top-2 right-2 flex flex-col gap-1",children:[o.jsx("button",{onClick:()=>{const fe=y.current,we=fe.scaleX(),Ue=E?.max_canvas_width||1536,St=E?.max_canvas_height||2048,xt=Ue/b.width,Ht=St/b.height,Ot=Math.min(xt,Ht,5),Xt=Math.min(Ot,fe.scaleX()*1.2);fe.scale({x:Xt,y:Xt}),fe.batchDraw(),console.log("�� DrawingTestStudent - Zoom In button:",we.toFixed(2),"->",Xt.toFixed(2)),console.log("�� DrawingTestStudent - New effective size:",Math.round(b.width*Xt),"x",Math.round(b.height*Xt)),console.log("�� DrawingTestStudent - New resolution:",Math.round(b.width*Xt*b.height*Xt),"pixels"),c(Xt)},className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center text-gray-600 font-bold",title:"Zoom In",children:"+"}),o.jsx("button",{onClick:()=>{const fe=y.current,we=fe.scaleX(),Ue=Math.max(.25,fe.scaleX()*.8);fe.scale({x:Ue,y:Ue}),fe.batchDraw(),console.log("�� DrawingTestStudent - Zoom Out button:",we.toFixed(2),"->",Ue.toFixed(2)),console.log("�� DrawingTestStudent - New effective size:",Math.round(b.width*Ue),"x",Math.round(b.height*Ue)),console.log("�� DrawingTestStudent - New resolution:",Math.round(b.width*Ue*b.height*Ue),"pixels"),c(Ue)},className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center text-gray-600 font-bold",title:"Zoom Out",children:"−"}),o.jsx("button",{onClick:()=>{const fe=y.current,we=fe.scaleX();fe.scale({x:1,y:1}),fe.position({x:0,y:0}),fe.batchDraw(),console.log("�� DrawingTestStudent - Reset zoom:",we.toFixed(2),"-> 1.00"),console.log("�� DrawingTestStudent - Reset effective size:",b.width,"x",b.height),console.log("�� DrawingTestStudent - Reset resolution:",b.width*b.height,"pixels"),c(1)},className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center text-gray-600 text-xs",title:"Reset Zoom",children:"1:1"})]}),o.jsxs("div",{className:"absolute bottom-2 left-2 bg-white border border-gray-300 rounded px-2 py-1 text-xs text-gray-600 shadow-sm",children:[Math.round(l*100),"%"]})]})})})},WW=({content:e})=>{if(!e)return o.jsx("div",{className:"text-gray-500 italic",children:"No instructions provided"});const t=n=>{if(!n)return"";if(n.type==="text"){let s=n.text||"";if(n.format&&(n.format&1&&(s=`<strong>${s}</strong>`),n.format&2&&(s=`<em>${s}</em>`),n.format&8&&(s=`<u>${s}</u>`),n.format&16&&(s=`<s>${s}</s>`)),n.style){const a=n.style.match(/color:\s*([^;]+)/);a&&(s=`<span style="color: ${a[1].trim()}">${s}</span>`)}if(n.textStyle){const a=n.textStyle.match(/color:\s*([^;]+)/);a&&(s=`<span style="color: ${a[1].trim()}">${s}</span>`)}return s}if(n.type==="paragraph"){const s=n.children?n.children.map(t).join(""):"";let a="text-left";return n.format&&(n.format==="center"?a="text-center":n.format==="right"?a="text-right":n.format==="left"&&(a="text-left")),`<p class="${a}">${s}</p>`}if(n.type==="heading"){const s=n.tag||"h1",a=n.children?n.children.map(t).join(""):"";return`<${s}>${a}</${s}>`}if(n.type==="list"){const s=n.listType==="bullet"?"ul":"ol",a=n.children?n.children.map(i=>{if(i.type==="listitem"){const l=i.children?i.children.map(t).join(""):"";let c="margin: 4px 0; display: list-item;";return i.format&&(i.format==="center"?c+=" text-align: center;":i.format==="right"?c+=" text-align: right;":i.format==="left"&&(c+=" text-align: left;")),`<li style="${c}">${l}</li>`}return""}).join(""):"";return`<${s} style="margin: 8px 0; padding-left: 20px; list-style-type: ${n.listType==="bullet"?"disc":"decimal"}; display: block;">${a}</${s}>`}return n.children?n.children.map(t).join(""):""};let r=e;if(typeof e=="string"&&e.startsWith("{"))try{const n=JSON.parse(e);n.text?r=n.text:n.content?r=n.content:n.root&&n.root.children&&(r=n.root.children.map(t).join(""))}catch(n){console.log("Failed to parse Lexical content:",n)}return o.jsx("div",{className:"max-w-none rich-text-content",style:{lineHeight:"1.6",fontSize:"14px"},dangerouslySetInnerHTML:{__html:r}})},zW=({question:e,questionIndex:t,studentAnswer:r,onAnswerChange:n,mode:s,testId:a,testType:i})=>{ka();const[l,c]=C.useState([]),[d,f]=C.useState(!0),[p,g]=C.useState("pencil"),[y,v]=C.useState("#000000"),[_,b]=C.useState(2),[E,k]=C.useState([]),[w,N]=C.useState(-1),[A,P]=C.useState({width:600,height:800}),[R,T]=C.useState(1),[D,I]=C.useState(!1),[V,X]=C.useState(!1),[Z,ie]=C.useState(!1),[q,ne]=C.useState([]),[M,W]=C.useState(null),[L,H]=C.useState(!1),[K,B]=C.useState(null),z=w>0,Q=w<E.length-1,[Y,te]=C.useState(!1),ee=C.useRef(null),ae=C.useRef(null),[ge,_e]=C.useState({width:600,height:800}),Me=C.useRef(!1),[ue,me]=C.useState(.25),He=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#008000","#808080","#FFC0CB","#A52A2A","#000080"];C.useEffect(()=>{const lt=()=>{ie(window.innerWidth>=1024)};return lt(),window.addEventListener("resize",lt),()=>window.removeEventListener("resize",lt)},[]),C.useEffect(()=>{if(e){const lt=e.max_canvas_width||1536,Qe=e.max_canvas_height||2048,yt=e.canvas_width||600,ft=e.canvas_height||800;if(P({width:lt,height:Qe}),Me.current)console.log("🎨 DrawingTestStudent - Preserving user zoom:",R.toFixed(2));else{T(1),Me.current=!0;const zt=(yt-lt*1)/2,Jt=(ft-Qe*1)/2;if(!isNaN(zt)&&!isNaN(Jt)&&ee.current){const De={x:zt,y:Jt};ee.current.position(De),ee.current.batchDraw()}console.log("🎨 DrawingTestStudent - Canvas size set:",lt,"x",Qe),console.log("🎨 DrawingTestStudent - Viewport size:",yt,"x",ft),console.log("🎨 DrawingTestStudent - Initial zoom:",1 .toFixed(2)),console.log("🎨 DrawingTestStudent - Image resolution:",lt*Qe,"pixels"),console.log("🎨 DrawingTestStudent - Aspect ratio:",(lt/Qe).toFixed(2))}if(r&&typeof r=="string")try{const _t=JSON.parse(r);_t.lines?c(_t.lines):c(_t),_t.textBoxes&&ne(_t.textBoxes)}catch{console.log("No valid drawing data found")}f(!1)}},[e,r]),C.useEffect(()=>{const lt=()=>{const Qe=ae.current;if(!Qe)return;const yt=Qe.clientWidth||1,ft=Qe.clientHeight||1,_t=Math.min(yt/(A.width||1),ft/(A.height||1));me(Math.min(_t,1))};return lt(),window.addEventListener("resize",lt),()=>window.removeEventListener("resize",lt)},[A.width,A.height,Y]);const qe=lt=>{c(lt);const Qe={lines:lt,textBoxes:q};n(e.question_id,JSON.stringify(Qe)),Xe(lt,q)},Xe=(lt,Qe=q)=>{const yt=E.slice(0,w+1);yt.push({lines:[...lt],textBoxes:[...Qe]}),k(yt),N(yt.length-1)},Ve=()=>{if(z){const lt=w-1,Qe=E[lt];if(Qe&&typeof Qe=="object"&&Qe.lines){c([...Qe.lines]),ne([...Qe.textBoxes]);const yt={lines:Qe.lines,textBoxes:Qe.textBoxes};n(e.question_id,JSON.stringify(yt))}else{const yt=Qe||[];c([...yt]),n(e.question_id,JSON.stringify(yt))}N(lt)}},It=()=>{if(Q){const lt=w+1,Qe=E[lt];if(Qe&&typeof Qe=="object"&&Qe.lines){c([...Qe.lines]),ne([...Qe.textBoxes]);const yt={lines:Qe.lines,textBoxes:Qe.textBoxes};n(e.question_id,JSON.stringify(yt))}else{const yt=Qe||[];c([...yt]),n(e.question_id,JSON.stringify(yt))}N(lt)}},st=()=>{c([]),ne([]),W(null),n(e.question_id,"")},Ie=lt=>{W(lt)},je=(lt,Qe)=>{const yt=q.map(_t=>_t.id===lt?{..._t,...Qe}:_t);ne(yt),Xe(l,yt);const ft={lines:l,textBoxes:yt};if(n(e.question_id,JSON.stringify(ft)),Qe.isEditing){const _t=q.find(zt=>zt.id===lt);B(_t),H(!0)}},Ze=lt=>{const Qe=q.filter(ft=>ft.id!==lt);ne(Qe),M===lt&&W(null),Xe(l,Qe);const yt={lines:l,textBoxes:Qe};n(e.question_id,JSON.stringify(yt))},bt=()=>{if(Y){const yt=e?.canvas_width||600,ft=e?.canvas_height||800,_t=window.innerWidth-40,zt=window.innerHeight-40,Jt=_t/yt,De=zt/ft,ut=Math.min(Jt,De,1);return{width:yt,height:ft,zoom:ut}}const lt=e?.canvas_width||600,Qe=e?.canvas_height||800;return{width:lt,height:Qe,zoom:1}};C.useEffect(()=>{const lt=()=>{_e(bt())};return lt(),window.addEventListener("resize",lt),()=>window.removeEventListener("resize",lt)},[Y,A]);const mt=lt=>{lt.evt.preventDefault();const Qe=ee.current,yt=Qe.scaleX(),ft=Qe.getPointerPosition(),_t={x:(ft.x-Qe.x())/yt,y:(ft.y-Qe.y())/yt},zt=lt.evt.deltaY>0?yt*.9:yt*1.1,Jt=e?.max_canvas_width||1536,De=e?.max_canvas_height||2048,ut=Jt/A.width,pt=De/A.height,Pt=Math.min(ut,pt,1),Lt=Math.max(ue,Math.min(Pt,zt)),sr={x:ft.x-_t.x*Lt,y:ft.y-_t.y*Lt};if(Lt<=ue&&ae.current){const Te=ae.current.clientWidth||1,ve=ae.current.clientHeight||1;sr.x=(Te-A.width*Lt)/2,sr.y=(ve-A.height*Lt)/2}Qe.scale({x:Lt,y:Lt}),Qe.position(sr),Qe.batchDraw(),console.log("🎨 DrawingTestStudent - Wheel zoom:",yt.toFixed(2),"->",Lt.toFixed(2)),console.log("🎨 DrawingTestStudent - New effective size:",Math.round(A.width*Lt),"x",Math.round(A.height*Lt)),console.log("🎨 DrawingTestStudent - New resolution:",Math.round(A.width*Lt*A.height*Lt),"pixels"),T(Lt),Me.current=!0},$t=lt=>{const Qe=lt.scaleX(),yt=ae.current,ft=yt?.clientWidth||ge.width,_t=yt?.clientHeight||ge.height,zt=A.width*Qe,Jt=A.height*Qe;if(Qe<=ue){const fe=(ft-zt)/2,we=(_t-Jt)/2;lt.position({x:fe,y:we}),lt.batchDraw();return}if(zt<=ft&&Jt<=_t){const fe=(ft-zt)/2,we=(_t-Jt)/2;lt.position({x:fe,y:we}),lt.batchDraw();return}const De=Math.max(0,zt-ft),ut=Math.max(0,Jt-_t),pt=-De,Pt=-ut,Lt=lt.x(),sr=lt.y(),Te=Math.max(pt,Math.min(De,Lt)),ve=Math.max(Pt,Math.min(ut,sr));(Te!==Lt||ve!==sr)&&(lt.position({x:Te,y:ve}),lt.batchDraw())},Wt=()=>{if(Y)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();else{const lt=document.querySelector(".drawing-canvas-container");lt&&(lt.requestFullscreen?lt.requestFullscreen():lt.webkitRequestFullscreen?lt.webkitRequestFullscreen():lt.msRequestFullscreen&&lt.msRequestFullscreen())}};return C.useEffect(()=>{const lt=()=>{te(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",lt),document.addEventListener("webkitfullscreenchange",lt),document.addEventListener("msfullscreenchange",lt),()=>{document.removeEventListener("fullscreenchange",lt),document.removeEventListener("webkitfullscreenchange",lt),document.removeEventListener("msfullscreenchange",lt)}},[]),C.useEffect(()=>()=>{ee.current&&ee.current.stop()},[]),d?o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsx(jr,{})}):e?o.jsxs("div",{className:`drawing-question w-full max-w-full mx-0 p-0 sm:p-2 ${Y?"fixed inset-0 z-50 bg-white overflow-y-auto":""}`,children:[!Y&&o.jsx("div",{className:"mb-4",children:o.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Question ",t+1]})}),!Y&&e.question_json&&e.question_json.trim()&&o.jsxs("div",{className:"mb-2 p-2 bg-gray-50 border border-gray-200 rounded-lg",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Task:"}),o.jsx("div",{className:"text-gray-700",children:o.jsx(WW,{content:e.question_json})})]}),!Y&&o.jsx(kt,{className:"p-1 sm:p-2 mb-2",children:o.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"hidden sm:block text-sm text-gray-700",children:"Tool:"}),o.jsxs("div",{className:"flex flex-nowrap sm:flex-wrap gap-1 overflow-x-auto",children:[o.jsx("button",{onClick:()=>g("pencil"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="pencil"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Pencil (Freehand drawing)",children:"✏️"}),o.jsx("button",{onClick:()=>g("line"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="line"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Line",children:"📏"}),o.jsx("button",{onClick:()=>g("rectangle"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="rectangle"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Rectangle",children:"⬜"}),o.jsx("button",{onClick:()=>g("circle"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="circle"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Circle",children:"⭕"}),o.jsx("button",{onClick:()=>g("eraser"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="eraser"?"bg-red-500 text-white border-red-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Eraser",children:"🧽"}),o.jsx("button",{onClick:()=>g("text"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="text"?"bg-green-500 text-white border-green-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Text Box",children:"📝"}),o.jsx("button",{onClick:()=>g("pan"),className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${p==="pan"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,title:"Pan (Move canvas)",children:"✋"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"text-sm text-gray-700",children:"History:"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:Ve,disabled:!z,className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${z?"bg-white text-gray-700 border-gray-300 hover:bg-gray-50":"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed"}`,title:"Undo (Ctrl+Z)",children:"↶"}),o.jsx("button",{onClick:It,disabled:!Q,className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm border rounded-lg transition-colors ${Q?"bg-white text-gray-700 border-gray-300 hover:bg-gray-50":"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed"}`,title:"Redo (Ctrl+Y)",children:"↷"})]})]}),o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>I(!D),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[o.jsx("div",{className:"w-6 h-6 rounded border border-gray-300",style:{backgroundColor:y}}),o.jsx("span",{className:"text-xs sm:text-sm text-gray-700",children:"Color"})]}),D&&o.jsx("div",{className:"absolute top-full left-0 mt-2 p-4 bg-white border border-gray-300 rounded-lg shadow-lg z-30 min-w-max",children:o.jsx("div",{className:"flex flex-wrap gap-2 max-w-xs",children:He.map(lt=>o.jsx("button",{onClick:()=>{v(lt),I(!1)},className:`w-10 h-10 rounded border-2 hover:scale-110 transition-transform flex-shrink-0 ${y===lt?"border-gray-800":"border-gray-300"}`,style:{backgroundColor:lt},title:lt},lt))})})]}),o.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[o.jsx("label",{className:"text-xs sm:text-sm text-gray-700",children:"Thickness:"}),o.jsx("input",{type:"range",min:"1",max:"10",value:_,onChange:lt=>b(parseInt(lt.target.value)),className:"w-16 sm:w-20"}),o.jsxs("span",{className:"text-xs text-gray-500 w-6 sm:w-8",children:[_,"px"]})]}),o.jsx(nt,{onClick:st,variant:"secondary",size:"sm",children:"Clear"})]})}),o.jsx(kt,{paddingClass:"p-0 sm:p-2",children:o.jsxs("div",{className:"w-full drawing-canvas-container relative p-0 m-0",children:[o.jsx($W,{width:A.width,height:A.height,lines:l,onDrawingChange:qe,currentTool:p,currentColor:y,currentThickness:_,zoom:R,onZoomChange:T,isPanning:V,isFullscreen:Y,constrainPanPosition:$t,handleWheel:mt,stageRef:ee,setIsPanning:X,responsiveDimensions:ge,canvasSize:A,question:e,textBoxes:q,setTextBoxes:ne,selectedTextBox:M,setSelectedTextBox:W,handleTextBoxSelect:Ie,handleTextBoxUpdate:je,handleTextBoxDelete:Ze,isEditingText:L,editingTextBox:K,setIsEditingText:H,setEditingTextBox:B,setCurrentTool:g}),o.jsx("button",{onClick:Wt,className:"absolute top-2 left-2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-lg transition-all duration-200 z-10",title:Y?"Exit Fullscreen":"Enter Fullscreen",children:Y?o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"})}):o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})})})]})})]}):o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsx("div",{className:"text-center",children:o.jsx("p",{className:"text-gray-500",children:"No drawing question data available"})})})},Lw={enhanceUserData(e,t){const r={id:e.id||e.student_id||e.teacher_id,username:e.username||e.student_id,name:e.name||e.first_name,surname:e.surname||e.last_name,nickname:e.nickname,role:t,is_active:e.is_active!==void 0?e.is_active:!0,created_at:e.created_at,updated_at:e.updated_at};switch(t){case"student":return{...r,student_id:e.student_id,grade:e.grade,class:e.class,number:e.number,subjects:e.subjects||[]};case"teacher":return{...r,teacher_id:e.teacher_id,first_name:e.first_name,last_name:e.last_name,email:e.email,phone:e.phone,subjects:e.subjects||[]};case"admin":return{...r,admin_id:e.admin_id,permissions:e.permissions||["all"]};default:return r}},async studentLogin(e){console.log("Trying student login...");try{const t=await fetch("/.netlify/functions/student-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:e.username,password:e.password})}),r=await t.json();if(t.ok&&r.success)return{success:!0,token:r.accessToken,refreshToken:r.refreshToken,data:r.student,role:"student",response:t};throw new Error(r.message||"Student login failed")}catch(t){throw console.error("Student login error:",t),new Error(t.message||"Student login failed")}},async teacherLogin(e){console.log("Trying teacher login...");try{const t=await fetch("/.netlify/functions/teacher-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(t.ok&&r.success)return{success:!0,token:r.accessToken,refreshToken:r.refreshToken,data:r.teacher,role:"teacher",response:t};throw new Error(r.message||"Teacher login failed")}catch(t){throw console.error("Teacher login error:",t),new Error(t.message||"Teacher login failed")}},async adminLogin(e){console.log("Trying admin login...");try{const t=await fetch("/.netlify/functions/admin-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(t.ok&&r.success)return{success:!0,token:r.accessToken,refreshToken:r.refreshToken,data:r.admin,role:"admin",response:t};throw new Error(r.message||"Admin login failed")}catch(t){throw console.error("Admin login error:",t),new Error(t.message||"Admin login failed")}},async login(e){const{username:t,password:r}=e;console.log("Attempting login with:",t,r);try{if(t==="admin"){const l=await this.adminLogin(e),c=await l.json();return await this.handleLoginResponse(l,"admin",c)}const n=await this.teacherLogin(e),s=await n.json();if(n.ok&&s.success)return await this.handleLoginResponse(n,"teacher",s);const a=await this.studentLogin(e),i=await a.json();return a.ok&&i.success?await this.handleLoginResponse(a,"student",i):(this.handleLoginFailure(),{success:!1,message:"Login failed. Please check your credentials and try again."})}catch(n){return console.error("Login error:",n),this.handleLoginFailure(),{success:!1,message:n.message||"Login failed"}}},async handleLoginResponse(e,t,r){if(e.ok&&r.success){if(!window.tokenManager||!window.roleBasedLoader)return console.error("[ERROR] JWT system not available during login response handling"),this.handleLoginFailure(),{success:!1,message:"JWT system not available"};if(r.accessToken&&r.role)try{window.tokenManager.setTokens(r.accessToken,r.role),window.roleBasedLoader.setupAccessAfterLogin()}catch(n){return console.error("[ERROR] Failed to initialize JWT system:",n),this.handleLoginFailure(),{success:!1,message:"Failed to initialize JWT system"}}return this.resetLoginForm(),await this.handlePostLoginActions(r,t),{success:!0,data:r,role:t}}return{success:!1,message:"Login failed"}},async handlePostLoginActions(e,t){console.log(`Handling post-login actions for role: ${t}`);try{switch(t){case"student":e.student&&(this.populateStudentInfo(e.student),window.loadStudentData&&await window.loadStudentData());break;case"teacher":e.teacher&&(this.populateTeacherInfo(e.teacher),window.loadTeacherData&&await window.loadTeacherData());break;case"admin":e.admin&&window.loadAdminData&&await window.loadAdminData();break;default:console.warn(`Unknown role for post-login actions: ${t}`)}}catch(r){console.error("Error in post-login actions:",r)}},handleLoginFailure(){console.log("All login attempts failed"),this.resetLoginForm(),window.showNotification&&window.showNotification("Login failed. Please check your credentials and try again.","error")},resetLoginForm(){const e=document.getElementById("unifiedLoginForm");if(e){e.querySelectorAll("input").forEach(n=>{n.disabled=!1,n.style.opacity="1",n.style.cursor="text",n.removeAttribute("readonly"),n.style.pointerEvents="auto"});const r=e.querySelector('button[type="submit"]');r&&(r.disabled=!1,r.style.opacity="1",r.style.cursor="pointer",r.style.pointerEvents="auto",r.innerHTML="Login"),e.classList.remove("test-submitting","disabled"),e.style.pointerEvents="auto",console.log("Login form reset successfully - all inputs re-enabled")}},async logout(){console.log("🚪 Logout initiated...");try{return window.tokenManager&&window.tokenManager.logout(),window.roleBasedLoader&&window.roleBasedLoader.reloadRoleAccess(),window.clearTestLocalStorage&&window.clearTestLocalStorage(),this.resetInterfaceAfterSessionClear(),console.log("✅ Logout completed - user session cleared, test data cleared, and interface reset"),{success:!0}}catch(e){return console.error("Logout error:",e),this.resetInterfaceAfterSessionClear(),{success:!0}}},resetInterfaceAfterSessionClear(){try{window.forceLogout=!0,window.preventAutoLogin=!0,window.isClearingSession=!0,window.forceLogoutComplete=!0,document.querySelectorAll(".section").forEach(s=>{s.classList.remove("active"),s.style.display="none",s.style.visibility="hidden",s.style.opacity="0"}),document.querySelectorAll('[id$="-cabinet"], [id$="-container"], [id*="cabinet"], [id*="container"]').forEach(s=>{s.id&&s.id!=="login-section"&&(s.classList.remove("active"),s.style.display="none",s.style.visibility="hidden",s.style.opacity="0")}),document.body.classList.remove("student-logged-in","teacher-logged-in","admin-logged-in"),document.body.classList.add("force-logout");const r=document.getElementById("login-section");r&&(r.classList.add("active"),r.style.display="block",r.style.visibility="visible",r.style.opacity="1"),document.querySelectorAll("input, select, textarea").forEach(s=>{s.type!=="hidden"&&(s.value="",s.checked=!1)}),console.log("✅ Interface reset to login state")}catch(e){console.error("Error resetting interface:",e),localStorage.clear(),sessionStorage.clear(),window.location.reload()}},async changePassword(e){try{return{success:!0,message:(await es.post("/auth/change-password",{currentPassword:e.currentPassword,newPassword:e.newPassword,confirmPassword:e.confirmPassword})).data.message}}catch(t){throw new Error(t.response?.data?.message||"Password change failed")}},async verifyToken(e){try{const t=await es.get("/auth/verify",{headers:{Authorization:`Bearer ${e}`}});return{success:!0,valid:t.data.valid,user:t.data.user}}catch(t){return{success:!1,valid:!1,error:t.message}}},async refreshToken(e){try{const t=await es.post("/auth/refresh",{refreshToken:e});return{success:!0,token:t.data.token,refreshToken:t.data.refreshToken}}catch(t){throw new Error(t.response?.data?.message||"Token refresh failed")}},async getUserProfile(){try{return{success:!0,user:(await es.get("/auth/profile")).data.user}}catch(e){throw new Error(e.response?.data?.message||"Failed to get user profile")}},async updateUserProfile(e){try{return{success:!0,user:(await es.put("/auth/profile",e)).data.user}}catch(t){throw new Error(t.response?.data?.message||"Failed to update user profile")}},populateStudentInfo(e){console.log("=== populateStudentInfo called ==="),console.log("Student object:",e);const t=document.getElementById("studentName");if(t){const s=`${e?.name||""} ${e?.surname||""}`.trim();t.textContent=s,console.log("Set student name to:",s)}const r=document.getElementById("studentGrade");r&&(r.textContent=e?.grade||"",console.log("Set student grade to:",e?.grade));const n=document.getElementById("studentClass");n&&(n.textContent=e?.class||"",console.log("Set student class to:",e?.class)),console.log("Student info populated successfully")},populateTeacherInfo(e){console.log("=== populateTeacherInfo called ==="),console.log("Teacher object:",e);const t=document.getElementById("teacherName");if(t){const n=`${e?.name||""} ${e?.surname||""}`.trim();t.textContent=n,console.log("Set teacher name to:",n)}const r=document.getElementById("teacherUsername");r&&(r.textContent=e?.username||"",console.log("Set teacher username to:",e?.username)),console.log("Teacher info populated successfully")},getCurrentTeacherId(){try{if(!window.tokenManager||!window.tokenManager.isAuthenticated())return console.warn("[WARN] No valid JWT token found for teacher"),null;const e=window.tokenManager.decodeToken(window.tokenManager.getAccessToken());return e&&e.sub?e.role==="teacher"?(console.log(`[DEBUG] Found teacher ID from JWT: ${e.sub}`),e.sub):(console.warn(`[WARN] Unsupported role for teacher function: ${e.role}`),null):(console.warn("[WARN] No teacher ID found in JWT token"),null)}catch(e){return console.error("[ERROR] Error getting current teacher ID from JWT:",e),null}},getCurrentAdmin(){const e=window.tokenManager?.getToken();if(!e)return null;const t=window.tokenManager.decodeToken(e);if(!t||t.role!=="admin")throw new Error("getCurrentAdmin() called by non-admin user");return{id:t.sub,username:t.username,role:t.role}},getCurrentTeacherUsername(){try{if(!window.tokenManager||!window.tokenManager.isAuthenticated())return console.warn("[WARN] No valid JWT token found for teacher"),null;const e=window.tokenManager.decodeToken(window.tokenManager.getAccessToken());return e&&e.username?(console.log(`[DEBUG] Found teacher username from JWT: ${e.username}`),e.username):(console.warn("[WARN] No teacher username found in JWT token"),null)}catch(e){return console.error("[ERROR] Error getting current teacher username from JWT:",e),null}},isAdmin(){try{const e=window.tokenManager?.getToken();if(!e)return!1;const t=window.tokenManager.decodeToken(e);return t&&t.role==="admin"}catch(e){return console.error("[ERROR] Error checking admin status:",e),!1}},getCurrentAdminId(){try{const e=this.getCurrentAdmin();return e?e.id:null}catch(e){return console.error("[ERROR] Error getting admin ID:",e),null}}},HW=()=>{const e=Ei(),{login:t,setUserData:r,isAuthenticated:n,user:s}=Bn(),[a,i]=C.useState({username:"",password:""}),[l,c]=C.useState(!1),[d,f]=C.useState(""),[p,g]=C.useState([]),[y,v]=C.useState(!1);C.useEffect(()=>{_()},[]);const _=C.useCallback(()=>{console.log("Checking for existing JWT session...");try{(window.forceLogout||window.preventAutoLogin)&&(window.forceLogout=!1,window.preventAutoLogin=!1)}catch{}if(window.tokenManager&&window.tokenManager.isAuthenticated()){console.log("JWT session valid, checking user role...");try{const V=window.tokenManager.decodeToken(window.tokenManager.getAccessToken());V&&V.role?console.log("User role from JWT:",V.role):console.log("No valid role found in JWT, showing login")}catch(V){console.error("Error decoding JWT token:",V)}}else console.log("No valid JWT session found, showing login")},[]),b=C.useCallback(async V=>{if(V.preventDefault(),window.forceLogout||window.preventAutoLogin){console.log("⚠️ Login blocked - force logout in progress"),T("Please wait for the logout process to complete.","warning");return}const{username:X,password:Z}=a;if(!X||!Z){f("Please enter both username and password");return}c(!0),f("");try{let ie,q;X==="admin"?(ie=await Lw.adminLogin({username:X,password:Z}),q=si.ADMIN):/^\d+$/.test(X)?(ie=await Lw.studentLogin({username:X,password:Z}),q=si.STUDENT):(ie=await Lw.teacherLogin({username:X,password:Z}),q=si.TEACHER);let ne,M;if(ie.response?(ne=ie,M=ie.response):(ne=await ie.json(),M=ie),await E(M,q,ne)){T("Login successful!","success");try{window.forceLogout=!1,window.preventAutoLogin=!1}catch{}}}catch(ie){console.error("Login error:",ie),f("Invalid username or password")}finally{c(!1)}},[a]),E=C.useCallback(async(V,X,Z)=>{if(V.ok&&Z.success){if(!window.tokenManager||!window.roleBasedLoader)return console.error("[ERROR] JWT system not available during login response handling"),P(),!1;try{Z.token&&(window.tokenManager.setTokens(Z.token,X),Z.refreshToken&&window.tokenManager.setRefreshToken(Z.refreshToken),console.log("JWT token stored successfully"));const ie={...Z.data,...Z,role:X};return r(ie),await k(ie),!0}catch(ie){return console.error("Error handling login response:",ie),P(ie),!1}}else return console.error("Login failed:",Z.error||"Unknown error"),f(Z.error||"Login failed. Please check your credentials."),!1},[t]),k=C.useCallback(async V=>{if(console.log("Handling post-login actions for role:",V.role),y){console.log("⚠️ Post-login already handled, skipping");return}v(!0);try{switch(V.role){case si.STUDENT:await w(V),e("/student");break;case si.TEACHER:await N(V),e("/teacher");break;case si.ADMIN:await A(V),e("/admin");break;default:console.error("Unknown user role:",V.role),P()}}catch(X){console.error("Error in post-login actions:",X),P(X)}},[e,y]);C.useEffect(()=>{n||v(!1)},[n]);const w=C.useCallback(async V=>{console.log("Populating student info:",V)},[]),N=C.useCallback(async V=>{console.log("Populating teacher info:",V)},[]),A=C.useCallback(async V=>{console.log("Populating admin info:",V)},[]),P=C.useCallback((V=null)=>{console.error("Login failure:",V),f("Login failed. Please check your credentials and try again."),R()},[]),R=C.useCallback(()=>{i({username:"",password:""}),f(""),c(!1)},[]),T=C.useCallback((V,X)=>{const Z={id:Date.now(),message:V,type:X,timestamp:new Date};g(ie=>[...ie,Z]),setTimeout(()=>{g(ie=>ie.filter(q=>q.id!==Z.id))},wi.NOTIFICATION_DURATION)},[]),D=C.useCallback(V=>{const{name:X,value:Z}=V.target;i(ie=>({...ie,[X]:Z})),d&&f("")},[d]),I=C.useCallback(V=>{V.key==="Enter"&&!l&&b(V)},[b,l]);return o.jsxs(et.div,{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[o.jsxs(et.div,{className:"w-full max-w-md",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsxs(et.div,{className:"text-center mb-8",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.5},children:[o.jsx(et.div,{className:"flex justify-center mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.4,duration:.5,type:"spring"},children:o.jsx("img",{src:"/pics/logo_mws.png",alt:"MWS Logo",className:"h-16 w-16 object-contain"})}),o.jsx(et.h1,{className:"text-3xl font-bold text-gray-900 mb-2",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5,duration:.3},children:"Mathayom Watsing School"}),o.jsx(et.p,{className:"text-lg text-gray-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.3},children:"Test Management System"})]}),o.jsxs(et.div,{className:"bg-white rounded-xl shadow-2xl p-8",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.7,duration:.5,type:"spring"},children:[o.jsx(et.h2,{className:"text-2xl font-semibold text-gray-900 text-center mb-6",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.8,duration:.3},children:"Login"}),o.jsxs("form",{onSubmit:b,className:"space-y-6",children:[o.jsxs(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.9,duration:.3},children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Student ID"}),o.jsx(et.input,{type:"text",id:"username",name:"username",value:a.username,onChange:D,onKeyDown:I,placeholder:"Enter student ID",required:!0,autoComplete:"username",disabled:l,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed","aria-describedby":d?"error-message":void 0,whileFocus:{scale:1.02},transition:{duration:.2}})]}),o.jsxs(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:1,duration:.3},children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),o.jsx(et.input,{type:"password",id:"password",name:"password",value:a.password,onChange:D,onKeyDown:I,placeholder:"Enter your password",required:!0,autoComplete:"current-password",disabled:l,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed","aria-describedby":d?"error-message":void 0,whileFocus:{scale:1.02},transition:{duration:.2}})]}),o.jsx(_i,{children:d&&o.jsx(et.div,{id:"error-message",className:"bg-red-50 border border-red-200 rounded-lg p-3",role:"alert","aria-live":"polite",initial:{opacity:0,height:0,y:-10},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-10},transition:{duration:.3},children:o.jsx("p",{className:"text-sm text-red-600",children:d})})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.1,duration:.3},children:o.jsx(nt,{type:"submit",variant:"primary",size:"lg",disabled:l,className:"w-full",children:l?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",className:"mr-2"}),"Logging in..."]}):"Login"})})]})]}),wi.DEBUG_MODE]}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:o.jsx(_i,{children:p.map(V=>o.jsx(et.div,{initial:{opacity:0,x:300,scale:.8},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:300,scale:.8},transition:{duration:.3,type:"spring"},children:o.jsx(Ko,{type:V.type,message:V.message,onClose:()=>g(X=>X.filter(Z=>Z.id!==V.id))})},V.id))})})]})},_n={async getStudentData(){console.log("getStudentData called - loading student subjects");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-student-subjects")).json();if(t.success)return console.log("Student data loaded successfully:",t.subjects),t.subjects;throw new Error(t.error||"Failed to load student data")}catch(e){throw console.error("Error loading student data:",e),e}},getStudentSubjects(e){return console.log("getStudentSubjects called with subjects:",e),e.map(t=>({id:t.id||t.subject_id,name:t.subject,grade:t.grade,class:t.class,testResults:t.test_results||[]}))},async getTeacherData(){console.log("getTeacherData called - loading teacher subjects");try{const e=await this.getCurrentTeacherId();if(!e)throw new Error("No valid teacher session found");const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-teacher-subjects")).json();if(r.success)return console.log("Teacher data loaded successfully:",r.subjects),{teacher_id:e,subjects:r.subjects,hasSubjects:r.subjects.length>0};throw new Error(r.error||"Failed to load teacher data")}catch(e){throw console.error("Error loading teacher data:",e),e}},getTeacherSubjects(e){return console.log("getTeacherSubjects called with subjects:",e),e.map(t=>{let r=[];return t.classes&&Array.isArray(t.classes)&&(r=t.classes.map(n=>({grade:n.grade,class:n.class,className:n.class}))),{id:t.subject_id,name:t.subject,classes:r,assignments:t.assignments||[],description:t.description||""}})},getGradeButtons(){return console.log("getGradeButtons called"),["M1","M2","M3","M4","M5","M6"].map(t=>({id:t,name:t,classes:this.generateClassButtons(t)}))},generateClassButtons(e){const t=[];for(let r=1;r<=10;r++)t.push({id:`${e}_${r}`,name:`${e}/${r}`,grade:e,class:r});return t},async getAdminData(){console.log("getAdminData called - loading admin data");try{if(!await this.getCurrentAdminId())throw new Error("No valid admin session found");const[t,r,n,s]=await Promise.allSettled([this.getAllTeachers(),this.getAllSubjects(),this.getAcademicYear(),this.getAllUsers()]);return{teachers:t.status==="fulfilled"?t.value:[],subjects:r.status==="fulfilled"?r.value:[],academicYear:n.status==="fulfilled"?n.value:[],users:s.status==="fulfilled"?s.value:[],loadedAt:new Date().toISOString()}}catch(e){throw console.error("Error loading admin data:",e),e}},async saveTeacherSubjects(e){console.log("saveTeacherSubjects called with subjects:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-teacher-subjects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subjects:e})})).json();if(r.success)return console.log("Teacher subjects saved successfully"),r;throw new Error(r.error||"Failed to save teacher subjects")}catch(t){throw console.error("Error saving teacher subjects:",t),t}},async deleteTeacherSubject(e){console.log("deleteTeacherSubject called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/delete-teacher-subject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("Teacher subject assignment deleted successfully"),r;throw new Error(r.error||"Failed to delete teacher subject assignment")}catch(t){throw console.error("Error deleting teacher subject assignment:",t),t}},async getSubjectsDropdown(){console.log("getSubjectsDropdown called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-all-subjects")).json();if(t.success)return console.log("Subjects dropdown data loaded successfully"),t.subjects.map(r=>({id:r.id,name:r.subject_name,value:r.subject_name}));throw new Error(t.error||"Failed to load subjects dropdown")}catch(e){throw console.error("Error loading subjects dropdown:",e),e}},async getGradesAndClasses(){console.log("getGradesAndClasses called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-teacher-grades-classes")).json();if(t.success)return console.log("Grades and classes loaded successfully"),t.data;throw new Error(t.message||"Failed to load grades and classes")}catch(e){throw console.error("Error loading grades and classes:",e),e}},async saveSubjectClasses(e,t){console.log("saveSubjectClasses called with subjectId:",e,"classes:",t);try{const r=await this.getCurrentTeacherId();if(!r)throw new Error("No valid teacher session found");const s=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-subject-classes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teacher_id:r,subject_id:e,classes:t})})).json();if(s.success)return console.log("Subject classes saved successfully"),s;throw new Error(s.error||"Failed to save subject classes")}catch(r){throw console.error("Error saving subject classes:",r),r}},async getAllSubjects(){console.log("getAllSubjects called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-all-subjects")).json();if(t.success)return console.log("All subjects loaded successfully"),t.subjects.map(r=>({id:r.id,name:r.subject_name,description:r.description||"",created_at:r.created_at,updated_at:r.updated_at}));throw new Error(t.error||"Failed to load all subjects")}catch(e){throw console.error("Error loading all subjects:",e),e}},async getSubjectsForSelection(){console.log("getSubjectsForSelection called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-subjects")).json();if(t.success)return console.log("Subjects for selection loaded successfully"),t.subjects;throw new Error(t.message||"Failed to load subjects for selection")}catch(e){throw console.error("Error loading subjects for selection:",e),e}},async getAcademicYear(){console.log("getAcademicYear called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-academic-year")).json();if(t.success)return console.log("Academic year loaded successfully"),t.academic_years.map(r=>({id:r.id,year:r.academic_year,semester:r.semester,term:r.term,start_date:r.start_date,end_date:r.end_date,is_current:r.is_current}));throw new Error(t.error||"Failed to load academic year")}catch(e){throw console.error("Error loading academic year:",e),e}},async addAcademicYear(e){console.log("addAcademicYear called with data:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/add-academic-year",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("Academic year added successfully"),r;throw new Error(r.error||"Failed to add academic year")}catch(t){throw console.error("Error adding academic year:",t),t}},async getAllUsers(){console.log("getAllUsers called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-all-users")).json();if(t.success)return console.log("All users loaded successfully"),t.users.map(r=>({id:r.id,student_id:r.student_id,grade:r.grade,class:r.class,number:r.number,name:r.name,surname:r.surname,nickname:r.nickname,created_at:r.created_at,updated_at:r.updated_at}));throw new Error(t.error||"Failed to load all users")}catch(e){throw console.error("Error loading all users:",e),e}},async getAllTeachers(){console.log("getAllTeachers called");try{const t=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-all-teachers")).json();if(t.success)return console.log("All teachers loaded successfully"),t.teachers.map(r=>({id:r.id,teacher_id:r.teacher_id,username:r.username,name:r.name,surname:r.surname,email:r.email,created_at:r.created_at,updated_at:r.updated_at}));throw new Error(t.error||"Failed to load all teachers")}catch(e){throw console.error("Error loading all teachers:",e),e}},async createUser(e){console.log("createUser called with data:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/create-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("User created successfully"),r;throw new Error(r.error||"Failed to create user")}catch(t){throw console.error("Error creating user:",t),t}},async updateUser(e,t){console.log("updateUser called with userId:",e,"data:",t);try{const n=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/update-user/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();if(n.success)return console.log("User updated successfully"),n;throw new Error(n.error||"Failed to update user")}catch(r){throw console.error("Error updating user:",r),r}},async createTeacher(e){console.log("createTeacher called with data:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/create-teacher",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("Teacher created successfully"),r;throw new Error(r.error||"Failed to create teacher")}catch(t){throw console.error("Error creating teacher:",t),t}},async updateTeacher(e,t){console.log("updateTeacher called with teacherId:",e,"data:",t);try{const n=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/update-teacher/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();if(n.success)return console.log("Teacher updated successfully"),n;throw new Error(n.error||"Failed to update teacher")}catch(r){throw console.error("Error updating teacher:",r),r}},async updateStudentInfo(e){console.log("updateStudentInfo called with data:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/update-student-info",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.success)return console.log("Student info updated successfully"),r;throw new Error(r.error||"Failed to update student info")}catch(t){throw console.error("Error updating student info:",t),t}},async changePassword(e){console.log("changePassword called");let t;if(e.studentId)t="/.netlify/functions/change-student-password";else if(e.username)t="/.netlify/functions/change-teacher-password";else throw new Error("Invalid password data: missing studentId or username");try{const n=await(await window.tokenManager.makeAuthenticatedRequest(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(n.success)return console.log("Password changed successfully"),n;throw new Error(n.error||"Failed to change password")}catch(r){throw console.error("Error changing password:",r),r}},async getCurrentTeacherId(){try{const e=localStorage.getItem("accessToken");if(!e)return null;const t=JSON.parse(atob(e.split(".")[1]));return t.teacher_id||t.sub||null}catch(e){return console.error("Error getting current teacher ID:",e),null}},async getCurrentAdminId(){try{const e=localStorage.getItem("accessToken");if(!e)return null;const t=JSON.parse(atob(e.split(".")[1]));return t.admin_id||t.sub||null}catch(e){return console.error("Error getting current admin ID:",e),null}}},Oj=C.createContext(),Lj=({children:e})=>{const[t,r]=C.useState(null),[n,s]=C.useState([]),[a,i]=C.useState([]),[l,c]=C.useState([]),[d,f]=C.useState([]),[p,g]=C.useState([]),[y,v]=C.useState([]),[_,b]=C.useState([]),[E,k]=C.useState(!1),[w,N]=C.useState(null),[A,P]=C.useState(!1),[R,T]=C.useState(!1),[D,I]=C.useState(!1),[V,X]=C.useState(null),[Z,ie]=C.useState(null),[q,ne]=C.useState(null),M=C.useCallback(async()=>{try{k(!0),N(null);const fe=`student_subjects_${t?.student_id||t?.id||""}`;console.log("🎓 UserContext: Checking cache for key:",fe);const we=jn(fe);if(we){console.log("🎓 UserContext: Cache HIT! Using cached student data"),s(we),W(we);return}console.log("🎓 UserContext: Cache MISS! Fetching from API");const Ue=await _n.getStudentData();if(Ue)s(Ue),W(Ue),console.log("🎓 UserContext: Caching student data with key:",fe),Fn(fe,Ue,Dn.student_subjects);else throw new Error("No subjects data received")}catch(ve){N(ve.message||"Failed to load student data"),console.error("Error loading student data:",ve)}finally{k(!1)}},[t?.student_id,t?.id]),W=ve=>{console.log("Displaying student subjects:",ve),s(ve)},L=C.useCallback(async()=>{try{if(k(!0),N(null),window.tokenManager&&!window.tokenManager.isAuthenticated()){console.error("No valid teacher session found in loadTeacherData, redirecting to login"),N("No valid teacher session found");return}const fe=`teacher_subjects_${t?.teacher_id||t?.id||""}`,we=jn(fe);if(we){s(we),we.length===0?ut():H(we);return}const Ue=await _n.getTeacherSubjects();if(Ue.success)s(Ue.subjects),Fn(fe,Ue.subjects,Dn.teacher_subjects),Ue.subjects.length===0?ut():H(Ue.subjects);else throw new Error(Ue.message||"Failed to load teacher data")}catch(ve){N(ve.message||"Failed to load teacher data"),console.error("Error loading teacher data:",ve)}finally{k(!1)}},[t?.teacher_id,t?.id]),H=ve=>{console.log("Showing main cabinet with subjects:",ve),s(ve)},K=ve=>{console.log("Displaying grade buttons:",ve),c(ve)},B=async()=>{try{if(k(!0),N(null),window.tokenManager&&!window.tokenManager.isAuthenticated()){console.error("No valid admin session found in loadAdminData, redirecting to login"),N("No valid admin session found");return}await Promise.all([me(),je(),Qe(),te()])}catch(ve){N(ve.message||"Failed to load admin data"),console.error("Error loading admin data:",ve)}finally{k(!1)}},z=ve=>{console.log("🎓 populateStudentInfoDirectly called with:",ve);try{r(ve),console.log("🎓 Set student profile:",ve)}catch(fe){console.error("Error populating student info:",fe)}},Q=ve=>{console.log("=== populateStudentInfo called ==="),r(ve)},Y=ve=>{console.log("=== populateTeacherInfo called ==="),r(ve)},te=C.useCallback(async()=>{try{k(!0);const ve="admin_users_",fe=jn(ve);if(fe){f(fe),ee(fe);return}const we=await _n.getAllUsers();if(we.success)f(we.users),ee(we.users),Fn(ve,we.users,Dn.admin_users);else throw new Error(we.message||"Failed to load users")}catch(ve){N(ve.message||"Failed to load users"),console.error("Error loading users:",ve)}finally{k(!1)}},[]),ee=ve=>{console.log("Displaying all users:",ve),f(ve)},ae=(ve,fe)=>{console.log("Displaying users table:",ve,fe),f(ve)},ge=()=>{console.log("Toggling users content")},_e=()=>{console.log("Showing add user form"),P(!0)},Me=()=>{console.log("Hiding add user form"),P(!1)},ue=ve=>{console.log("Editing user row:",ve);const fe=d.find(we=>we.id===ve);X(fe)},me=C.useCallback(async()=>{try{const ve="admin_teachers_",fe=jn(ve);if(fe){g(fe),He(fe);return}const we=await _n.getAllTeachers();if(we.success)g(we.teachers),He(we.teachers),Fn(ve,we.teachers,Dn.admin_teachers);else throw new Error(we.message||"Failed to load teachers")}catch(ve){N(ve.message||"Failed to load teachers"),console.error("Error loading teachers:",ve)}},[]),He=ve=>{console.log("Displaying all teachers:",ve),g(ve)},qe=(ve,fe)=>{console.log("Displaying teachers table:",ve,fe),g(ve)},Xe=()=>{console.log("Toggling teachers content")},Ve=()=>{console.log("Showing add teacher form"),T(!0)},It=()=>{console.log("Hiding add teacher form"),T(!1)},st=ve=>{console.log("Editing teacher:",ve);const fe=p.find(we=>we.id===ve);ie(fe)},Ie=ve=>{console.log("Editing teacher row:",ve);const fe=p.find(we=>we.id===ve);ie(fe)},je=C.useCallback(async()=>{try{const ve="admin_subjects_",fe=jn(ve);if(fe){v(fe),Ze(fe);return}const we=await _n.getAllSubjects();if(we.success)v(we.subjects),Ze(we.subjects),Fn(ve,we.subjects,Dn.admin_subjects);else throw new Error(we.message||"Failed to load subjects")}catch(ve){N(ve.message||"Failed to load subjects"),console.error("Error loading subjects:",ve)}},[]),Ze=ve=>{console.log("Displaying all subjects:",ve),v(ve)},bt=(ve,fe)=>{console.log("Displaying subjects table:",ve,fe),v(ve)},mt=()=>{console.log("Toggling subjects content")},$t=()=>{console.log("Showing add subject form"),I(!0)},Wt=()=>{console.log("Hiding add subject form"),I(!1)},lt=ve=>{console.log("Editing subject row:",ve);const fe=y.find(we=>we.id===ve);ne(fe)},Qe=C.useCallback(async()=>{try{const ve="admin_academic_years_",fe=jn(ve);if(fe){b(fe),yt(fe);return}const we=await _n.getAcademicYear();if(we.success)b(we.academicYears),yt(we.academicYears),Fn(ve,we.academicYears,Dn.admin_academic_years);else throw new Error(we.message||"Failed to load academic year")}catch(ve){N(ve.message||"Failed to load academic year"),console.error("Error loading academic year:",ve)}},[]),yt=ve=>{console.log("Displaying academic year:",ve),b(ve)},ft=()=>{console.log("Showing add academic year form")},_t=()=>{console.log("Hiding add academic year form")},zt=ve=>{console.log("Handling add academic year:",ve)},Jt=()=>{console.log("Toggling academic year content")},De=()=>{console.log("Showing academic year editor")},ut=()=>{console.log("Showing subject selection")},pt=()=>{console.log("Showing main cabinet")},Pt=ve=>{r(fe=>({...fe,...ve}))},Lt=()=>{r(null),s([]),i([]),c([]),f([]),g([]),v([]),b([]),N(null)},sr=C.useCallback(ve=>{Lt(),ve&&S2(ve)},[]),Te={userProfile:t,userSubjects:n,userClasses:a,userGrades:l,allUsers:d,allTeachers:p,allSubjects:y,academicYears:_,isLoading:E,error:w,showUserForm:A,showTeacherForm:R,showSubjectForm:D,editingUser:V,editingTeacher:Z,editingSubject:q,loadStudentData:M,displayStudentSubjects:W,populateStudentInfoDirectly:z,populateStudentInfo:Q,loadTeacherData:L,showMainCabinetWithSubjects:H,displayGradeButtons:K,populateTeacherInfo:Y,showSubjectSelection:ut,showMainCabinet:pt,loadAdminData:B,getAllUsers:te,displayAllUsers:ee,displayUsersTable:ae,toggleUsersContent:ge,showAddUserForm:_e,hideAddUserForm:Me,editUserRow:ue,loadAllTeachers:me,displayAllTeachers:He,displayTeachersTable:qe,toggleTeachersContent:Xe,showAddTeacherForm:Ve,hideAddTeacherForm:It,editTeacher:st,editTeacherRow:Ie,loadAllSubjects:je,displayAllSubjects:Ze,displaySubjectsTable:bt,toggleSubjectsContent:mt,showAddSubjectForm:$t,hideAddSubjectForm:Wt,editSubjectRow:lt,loadAcademicYear:Qe,displayAcademicYear:yt,showAddAcademicYearForm:ft,hideAddAcademicYearForm:_t,handleAddAcademicYear:zt,toggleAcademicYearContent:Jt,showAcademicYearEditor:De,updateUserProfile:Pt,clearUserData:Lt,clearUserDataWithCache:sr,setUserProfile:r,setUserSubjects:s,setUserClasses:i,setUserGrades:c,setAllUsers:f,setAllTeachers:g,setAllSubjects:v,setAcademicYears:b,setError:N};return o.jsx(Oj.Provider,{value:Te,children:e})},Jy=()=>{const e=C.useContext(Oj);if(!e)throw new Error("useUser must be used within a UserProvider");return e},Bw={STUDENT_LOGIN:"/.netlify/functions/student-login",TEACHER_LOGIN:"/.netlify/functions/teacher-login",ADMIN_LOGIN:"/.netlify/functions/admin-login",CHANGE_PASSWORD:"/.netlify/functions/change-password",GET_TEST_QUESTIONS:"/.netlify/functions/get-test-questions",SUBMIT_MULTIPLE_CHOICE_TEST:"/.netlify/functions/submit-multiple-choice-test",SUBMIT_TRUE_FALSE_TEST:"/.netlify/functions/submit-true-false-test",SUBMIT_INPUT_TEST:"/.netlify/functions/submit-input-test",SUBMIT_MATCHING_TEST:"/.netlify/functions/submit-matching-test",SUBMIT_DRAWING_TEST:"/.netlify/functions/submit-drawing-test",GET_STUDENT_SUBJECTS:"/.netlify/functions/get-student-subjects",GET_TEACHER_SUBJECTS:"/.netlify/functions/get-teacher-subjects",GET_ALL_USERS:"/.netlify/functions/get-all-users",GET_ALL_TEACHERS:"/.netlify/functions/get-all-teachers",GET_ALL_SUBJECTS:"/.netlify/functions/get-all-subjects",GET_ACADEMIC_YEAR:"/.netlify/functions/get-academic-year",SAVE_MULTIPLE_CHOICE_TEST:"/.netlify/functions/save-multiple-choice-test",SAVE_TRUE_FALSE_TEST:"/.netlify/functions/save-true-false-test",SAVE_INPUT_TEST:"/.netlify/functions/save-input-test",SAVE_MATCHING_TEST:"/.netlify/functions/save-matching-test",SAVE_DRAWING_TEST:"/.netlify/functions/save-drawing-test",UPDATE_DRAWING_TEST_SCORE:"/.netlify/functions/update-drawing-test-score",UPDATE_SPEAKING_TEST_SCORE:"/.netlify/functions/update-speaking-test-score",ASSIGN_TEST_TO_CLASSES:"/.netlify/functions/assign-test-to-classes",GET_TEACHER_ACTIVE_TESTS:"/.netlify/functions/get-teacher-active-tests",GET_STUDENT_ACTIVE_TESTS:"/.netlify/functions/get-student-active-tests"},gn={MULTIPLE_CHOICE:"multiple_choice",TRUE_FALSE:"true_false",INPUT:"input",MATCHING:"matching_type",WORD_MATCHING:"word_matching",DRAWING:"drawing",FILL_BLANKS:"fill_blanks"},si={STUDENT:"student",TEACHER:"teacher",ADMIN:"admin"};Array.from({length:10},(e,t)=>t+1);const wi={API_BASE_URL:"",APP_NAME:"Mathayom Watsing Test System",VERSION:"2.0.0",DEBUG_MODE:!1,AUTO_SAVE_INTERVAL:3e4,NOTIFICATION_DURATION:3e3,MAX_TEST_QUESTIONS:50,MIN_TEST_QUESTIONS:1,ITEMS_PER_PAGE:20,CACHE_DURATION:3e5,CURRENT_ACADEMIC_YEAR:"2025-2026",CURRENT_SEMESTER:1},Du=(e,t,r)=>{if(!e||!Array.isArray(e)||e.length===0)return{score:0,total:0,percentage:0};let n=0;return e.forEach((s,a)=>{const i=Array.isArray(t)?t[a]:t[String(s.question_id||s.id||a)];i!=null&&c0(s,i,r)&&n++}),{score:n,total:e.length,percentage:Math.round(n/e.length*100)}},op=(e,t)=>{console.log("🎓 Getting correct answer for question:",e,"testType:",t);let r="";switch(t){case gn.TRUE_FALSE:r=e.correct_answer?"true":"false",console.log("🎓 TRUE_FALSE correct_answer from question:",r,typeof r);break;case gn.MULTIPLE_CHOICE:const n=e.correct_answer.charCodeAt(0)-65,s=`option_${String.fromCharCode(97+n)}`,a=e[s];a?r=a:r=`Option ${e.correct_answer}`;break;case gn.INPUT:e.correct_answers&&Array.isArray(e.correct_answers)?r=e.correct_answers.join(", "):r=e.correct_answer||"Unknown";break;case gn.MATCHING:r=e.correct_answer||e.answer;break;case gn.WORD_MATCHING:r=e.correct_answer||e.answer;break;case gn.DRAWING:r="Drawing required";break;case gn.FILL_BLANKS:e.correct_answers&&Array.isArray(e.correct_answers)&&e.correct_answers.length>0?r=e.correct_answers[0]:r=e.correct_answer||"Unknown";break;default:r="Unknown"}return console.log("🎓 Correct answer:",r),r},c0=(e,t,r)=>{if(console.log("[DEBUG] checkAnswerCorrectness called for question:",e,"studentAnswer:",t,"testType:",r),!t||t==="")return console.log("[DEBUG] No student answer provided"),!1;let n=!1;switch(r){case gn.TRUE_FALSE:n=t.toLowerCase()==="true"===e.correct_answer;break;case gn.MULTIPLE_CHOICE:let a="";if(typeof t=="string"){const l=t.trim();if(/^[a-z]$/i.test(l))a=l.toUpperCase();else if(/^\d+$/.test(l)){const c=parseInt(l,10),d=c>=0?c:NaN;Number.isNaN(d)||(a=String.fromCharCode(65+d))}}else if(typeof t=="number"){const l=t;Number.isNaN(l)||(a=String.fromCharCode(65+l))}n=a!==""&&a===String(e.correct_answer||"").toUpperCase();break;case gn.INPUT:if(e.correct_answers&&Array.isArray(e.correct_answers)){const l=t.replace(/[.,/*';:!@#$%^&*()_+=\[\]{}|\\:";'<>?,.\s-]+/g,"").toLowerCase().trim();n=e.correct_answers.some(c=>{const d=c.replace(/[.,/*';:!@#$%^&*()_+=\[\]{}|\\:";'<>?,.\s-]+/g,"").toLowerCase().trim();return l===d})}else n=t.toLowerCase().trim()===e.correct_answer.toLowerCase().trim();break;case gn.MATCHING:if(e.correct_answer&&typeof e.correct_answer=="object"){const l=typeof t=="string"?JSON.parse(t||"{}"):t;n=JSON.stringify(l)===JSON.stringify(e.correct_answer)}break;case gn.WORD_MATCHING:if(e.correct_answer&&typeof e.correct_answer=="object"){const l=typeof t=="string"?JSON.parse(t||"{}"):t;n=JSON.stringify(l)===JSON.stringify(e.correct_answer)}break;case gn.DRAWING:console.warn("Drawing tests should not be auto-scored!"),n=!1;break;case gn.FILL_BLANKS:const i=e.correct_answers&&Array.isArray(e.correct_answers)&&e.correct_answers.length>0?e.correct_answers[0]:e.correct_answer;if(i&&t){let l="";if(typeof t=="string"){const c=t.trim();if(/^[a-z]$/i.test(c))l=c.toUpperCase();else if(/^\d+$/.test(c)){const d=parseInt(c,10),f=d>=0?d:NaN;Number.isNaN(f)||(l=String.fromCharCode(65+f))}}else if(typeof t=="number"){const c=t;Number.isNaN(c)||(l=String.fromCharCode(65+c))}n=l!==""&&l===String(i||"").toUpperCase()}break;default:console.warn(`[WARN] Unknown test type for answer checking: ${r}`),n=!1}return console.log(`[DEBUG] Answer correctness: ${n}`),n},rn={async getTestInfo(e,t){console.log(`[DEBUG] getTestInfo called with testType: ${e}, testId: ${t}`);try{const r=`/.netlify/functions/get-test-questions?test_type=${e}&test_id=${t}`;console.log("[DEBUG] Fetching test info from:",r);const n=await window.tokenManager.makeAuthenticatedRequest(r);if(console.log("[DEBUG] Response status:",n.status),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(console.log("[DEBUG] Test info data received:",s),s.success)return console.log("[DEBUG] Test info retrieved successfully"),s.test_info;throw new Error(s.error||"Failed to get test info")}catch(r){throw console.error("[ERROR] Failed to get test info:",r),r}},async getTestQuestions(e,t){console.log(`[DEBUG] getTestQuestions called with testType: ${e}, testId: ${t}`);try{const r=`/.netlify/functions/get-test-questions?test_type=${e}&test_id=${t}`;console.log("[DEBUG] Fetching test questions from:",r);const n=await window.tokenManager.makeAuthenticatedRequest(r);if(console.log("[DEBUG] Response status:",n.status),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(console.log("[DEBUG] Test questions data received:",s),s.success)return console.log("[DEBUG] Test questions retrieved successfully"),s.questions;throw new Error(s.error||"Failed to get test questions")}catch(r){throw console.error("[ERROR] Failed to get test questions:",r),r}},async getActiveTests(){console.log("getActiveTests called - extracting studentId from JWT token");try{const e="/.netlify/functions/get-student-active-tests";console.log("[DEBUG] Fetching active tests from:",e);const t=await window.tokenManager.makeAuthenticatedRequest(e);if(console.log("[DEBUG] Response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(console.log("[DEBUG] Active tests data received:",r),r.success)return console.log("[DEBUG] Active tests retrieved successfully"),r.tests;throw new Error(r.error||"Failed to get active tests")}catch(e){throw console.error("[ERROR] Failed to get active tests:",e),e}},async getTeacherTests(){console.log("getTeacherTests called - extracting teacherId from JWT token");try{const e="/.netlify/functions/get-teacher-active-tests";console.log("[DEBUG] Fetching teacher tests from:",e);const t=await window.tokenManager.makeAuthenticatedRequest(e);if(console.log("[DEBUG] Response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(console.log("[DEBUG] Teacher tests data received:",r),r.success)return console.log("[DEBUG] Teacher tests retrieved successfully"),r.tests;throw new Error(r.error||"Failed to get teacher tests")}catch(e){throw console.error("[ERROR] Failed to get teacher tests:",e),e}},async submitTest(e,t,r,n={},s=null){console.log("Submitting test:",{testType:e,testId:t});try{if(Object.keys(r).length===0)throw new Error("Please answer at least one question before submitting.");let a;try{const k=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-test-questions?test_type=${e}&test_id=${t}`)).json();if(k.success)a=k.test_info;else throw new Error("Failed to get test information")}catch(E){console.error("Error getting test info:",E);const k=await this.getTestQuestions(e,t);a={test_name:`Test ${t}`,num_questions:k.length}}const i=await this.getTestQuestions(e,t);let l,c;if(e==="drawing")l=null,c=null;else{const E=n?.answers_by_id?n.answers_by_id:r;l=Du(i,E,e).score,c=a.num_questions}const d=this.transformAnswersForSubmission(r,e),f=a.teacher_id||null,p=a.subject_id||null,g=s?.student_id||s?.id||(window.tokenManager?.getCurrentUser?window.tokenManager.getCurrentUser()?.student_id||window.tokenManager.getCurrentUser()?.id:null),y={test_id:t,test_name:a.test_name,test_type:e,teacher_id:f,subject_id:p,student_id:g,answers:d,score:l,maxScore:c,time_taken:n.time_taken||null,started_at:n.started_at||null,submitted_at:n.submitted_at||new Date().toISOString(),caught_cheating:n.caught_cheating||!1,visibility_change_times:n.visibility_change_times||0,answers_by_id:n.answers_by_id||null,question_order:n.question_order||null,retest_assignment_id:n.retest_assignment_id||null,parent_test_id:n.parent_test_id||t};console.log("🎨 testService retest_assignment_id:",n.retest_assignment_id),console.log("🎨 testService timingData:",n),console.log("🎨 testService commonData.retest_assignment_id:",y.retest_assignment_id);let v;switch(e){case"multiple_choice":v="/.netlify/functions/submit-multiple-choice-test";break;case"true_false":v="/.netlify/functions/submit-true-false-test";break;case"input":v="/.netlify/functions/submit-input-test";break;case"matching_type":v="/.netlify/functions/submit-matching-type-test";break;case"word_matching":v="/.netlify/functions/submit-word-matching-test";break;case"drawing":v="/.netlify/functions/submit-drawing-test";break;case"fill_blanks":v="/.netlify/functions/submit-fill-blanks-test";break;default:throw new Error(`Unsupported test type: ${e}`)}console.log("Submitting to:",v),console.log("Submission data:",y),console.log("Submission data JSON:",JSON.stringify(y,null,2)),console.log("🎨 Final submission retest_assignment_id:",y.retest_assignment_id);const _=await window.tokenManager.makeAuthenticatedRequest(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const b=await _.json();if(console.log("Test submission result:",b),b.success)return this.clearTestProgress(e,t),{success:!0,score:l,maxScore:c,result:b};throw new Error(b.error||"Failed to submit test")}catch(a){throw console.error("Error submitting test:",a),a}},async createTest(e){try{return(await es.post("/tests/create",e)).data}catch(t){throw new Error(t.message||"Failed to create test")}},async updateTest(e,t,r){try{return(await es.put(`/tests/${e}/${t}`,r)).data}catch(n){throw new Error(n.message||"Failed to update test")}},async deleteTest(e,t){try{return(await es.delete(`/tests/${e}/${t}`)).data}catch(r){throw new Error(r.message||"Failed to delete test")}},async duplicateTest(e,t){try{return(await es.post(`/tests/${e}/${t}/duplicate`)).data}catch(r){throw new Error(r.message||"Failed to duplicate test")}},async publishTest(e,t){try{return(await es.post(`/tests/${e}/${t}/publish`)).data}catch(r){throw new Error(r.message||"Failed to publish test")}},async unpublishTest(e,t){try{return(await es.post(`/tests/${e}/${t}/unpublish`)).data}catch(r){throw new Error(r.message||"Failed to unpublish test")}},async removeClassAssignment(e,t,r){try{return(await es.delete(`/tests/${e}/${t}/assignments/${r}`)).data}catch(n){throw new Error(n.message||"Failed to remove class assignment")}},async getTestStatistics(e,t){try{return(await es.get(`/tests/${e}/${t}/statistics`)).data}catch(r){throw new Error(r.message||"Failed to get test statistics")}},async exportTest(e,t,r="json"){try{return(await es.get(`/tests/${e}/${t}/export?format=${r}`)).data}catch(n){throw new Error(n.message||"Failed to export test")}},async importTest(e,t){try{return(await es.uploadFile(`/tests/import?type=${t}`,e)).data}catch(r){throw new Error(r.message||"Failed to import test")}},async getTestResults(e,t){try{return(await es.get(`/tests/${e}/${t}/results`)).data}catch(r){throw new Error(r.message||"Failed to get test results")}},async getStudentTestResults(){try{console.log("[DEBUG] Fetching student test results from: /.netlify/functions/get-student-test-results");const e=await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/get-student-test-results");if(console.log("[DEBUG] Response status:",e.status),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if(console.log("[DEBUG] Student test results data received:",t),t.success)return console.log("[DEBUG] Student test results retrieved successfully"),t;throw new Error(t.error||"Failed to get student test results")}catch(e){throw console.error("[ERROR] Failed to get student test results:",e),new Error(e.message||"Failed to get student test results")}},async getClassResults(e,t,r){try{return(await es.get(`/tests/class-results/${e}/${t}/${r}`)).data}catch(n){throw new Error(n.message||"Failed to get class results")}},async saveTestProgress(e,t,r){try{return(await es.post(`/tests/${e}/${t}/progress`,{progress:r})).data}catch(n){throw new Error(n.message||"Failed to save test progress")}},async getTestProgress(e,t){try{return(await es.get(`/tests/${e}/${t}/progress`)).data}catch(r){throw new Error(r.message||"Failed to get test progress")}},async clearTestProgress(e,t){try{return(await es.delete(`/tests/${e}/${t}/progress`)).data}catch(r){throw new Error(r.message||"Failed to clear test progress")}},async validateTestData(e){try{return(await es.post("/tests/validate",e)).data}catch(t){throw new Error(t.message||"Failed to validate test data")}},async getTestPreview(e,t){try{return(await es.get(`/tests/${e}/${t}/preview`)).data}catch(r){throw new Error(r.message||"Failed to get test preview")}},isAnswerCorrect(e,t,r,n){switch(n){case"multiple_choice":return String.fromCharCode(65+parseInt(t))===r.correct_answer;case"true_false":return t.toLowerCase()==="true"===r.correct_answer;case"input":return(r.correct_answers||[]).some(l=>t.toLowerCase().trim()===l.toLowerCase().trim());case"matching_type":return JSON.stringify(t)===JSON.stringify(r.correct_answer);case"word_matching":return JSON.stringify(t)===JSON.stringify(r.correct_answer);case"drawing":return t&&t!=="No answer";default:return!1}},transformAnswersForSubmission(e,t){switch(t){case"multiple_choice":return e;case"true_false":return e;case"input":return e;case"matching_type":return e;case"word_matching":return e;case"drawing":if(Array.isArray(e)&&e.length>0)try{const r=e[0];return typeof r=="string"&&r.startsWith("[")?JSON.parse(r):e}catch(r){return console.warn("Failed to parse drawing answers:",r),e}return e;default:return e}},async markTestCompleted(e,t){try{console.log(`[DEBUG] markTestCompleted called with testType: ${e}, testId: ${t}`);const r=await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/mark-test-completed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_type:e,test_id:t})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();if(console.log("[DEBUG] Mark test completed response:",n),n.success)return console.log(`Test ${e}_${t} marked as completed successfully`),{success:!0,message:n.message};throw new Error(n.error||"Failed to mark test as completed")}catch(r){throw console.error("Error marking test completed:",r),r}},clearTestProgress(e,t){try{const r=`test_progress_${e}_${t}`;localStorage.removeItem(r),console.log(`Test progress cleared for ${e}_${t}`)}catch(r){console.error("Error clearing test progress:",r)}},async saveMultipleChoiceTest(e){console.log("[DEBUG] saveMultipleChoiceTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-multiple-choice-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return console.log("[DEBUG] Save multiple choice test response:",r),r.success?{success:!0,test_id:r.test_id,message:"Test saved successfully"}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving multiple choice test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveTrueFalseTest(e){console.log("[DEBUG] saveTrueFalseTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-true-false-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return console.log("[DEBUG] Save true/false test response:",r),r.success?{success:!0,test_id:r.test_id,message:"Test saved successfully"}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving true/false test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveInputTest(e){console.log("[DEBUG] saveInputTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-input-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return console.log("[DEBUG] Save input test response:",r),r.success?{success:!0,test_id:r.test_id,message:"Test saved successfully"}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving input test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveMatchingTest(e){console.log("[DEBUG] saveMatchingTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,test_type:"matching_type",num_questions:e.num_blocks})})).json();return console.log("[DEBUG] Save matching test response:",r),r.success?{success:!0,test_id:r.test_id,message:r.message,assignments_count:r.assignments_count}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving matching test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveWordMatchingTest(e){console.log("[DEBUG] saveWordMatchingTest called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,test_type:"word_matching"})})).json();return console.log("[DEBUG] Save word matching test response:",r),r.success?{success:!0,test_id:r.test_id,message:r.message,assignments_count:r.assignments_count}:{success:!1,message:r.message||"Failed to save test"}}catch(t){return console.error("Error saving word matching test:",t),{success:!1,message:"Error saving test: "+t.message}}},async saveDrawingTest(e){console.log("[DEBUG] saveDrawingTest called with:",e);try{const t={...e,test_type:"drawing"},n=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return console.log("[DEBUG] Save drawing test response:",n),n.success?{success:!0,data:{test_id:n.test_id}}:{success:!1,message:n.message||"Failed to save test"}}catch(t){return console.error("Error saving drawing test:",t),{success:!1,message:"Error saving test: "+t.message}}},async getDrawingTest(e){console.log("[DEBUG] getDrawingTest called with testId:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-drawing-test?test_id=${e}`,{method:"GET"})).json();return console.log("[DEBUG] Get drawing test response:",r),r.success?{success:!0,data:r.data}:{success:!1,message:r.message||"Failed to get test"}}catch(t){return console.error("Error getting drawing test:",t),{success:!1,message:"Error getting test: "+t.message}}},async submitDrawingTest(e,t,r,n){console.log("[DEBUG] submitDrawingTest called with:",{testId:e,answers:t,timeTaken:r,antiCheatingData:n});try{const a=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/submit-drawing-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_id:e,answers:t,time_taken:r,caught_cheating:n?.caught_cheating||!1,visibility_change_times:n?.visibility_change_times||0})})).json();return console.log("[DEBUG] Submit drawing test response:",a),a.success?{success:!0,data:a.data}:{success:!1,message:a.message||"Failed to submit test"}}catch(s){return console.error("Error submitting drawing test:",s),{success:!1,message:"Error submitting test: "+s.message}}},async updateDrawingTestScore(e,t,r){console.log("[DEBUG] updateDrawingTestScore called with:",{resultId:e,score:t,maxScore:r});try{const s=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/update-drawing-test-score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({result_id:e,score:t,max_score:r})})).json();return console.log("[DEBUG] Update drawing test score response:",s),s.success?{success:!0,data:s.data}:{success:!1,message:s.message||"Failed to update score"}}catch(n){return console.error("Error updating drawing test score:",n),{success:!1,message:"Error updating score: "+n.message}}},async getWordMatchingTest(e){console.log("[DEBUG] getWordMatchingTest called with testId:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-word-matching-test?test_id=${e}`,{method:"GET"})).json();return console.log("[DEBUG] Get word matching test response:",r),r.success?{success:!0,data:r.data}:{success:!1,message:r.message||"Failed to get test"}}catch(t){return console.error("Error getting word matching test:",t),{success:!1,message:"Error getting test: "+t.message}}},async submitWordMatchingTest(e,t,r,n){console.log("[DEBUG] submitWordMatchingTest called with:",{testId:e,answers:t,timeTaken:r,antiCheatingData:n});try{const a=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/submit-word-matching-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_id:e,answers:t,time_taken:r,caught_cheating:n?.caught_cheating||!1,visibility_change_times:n?.visibility_change_times||0})})).json();return console.log("[DEBUG] Submit word matching test response:",a),a.success?{success:!0,result:a.result}:{success:!1,message:a.message||"Failed to submit test"}}catch(s){return console.error("Error submitting word matching test:",s),{success:!1,message:"Error submitting test: "+s.message}}},async assignTestToClasses(e){console.log("[DEBUG] assignTestToClasses called with:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return console.log("[DEBUG] Save test with assignments response:",r),r.success?{success:!0,message:"Test assigned successfully"}:{success:!1,message:r.message||"Failed to assign test"}}catch(t){return console.error("Error assigning test to classes:",t),{success:!1,message:"Error assigning test: "+t.message}}},async removeClassAssignment(e){console.log("[DEBUG] removeClassAssignment called with assignmentId:",e);try{const r=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/remove-class-assignment?assignment_id=${e}`,{method:"DELETE"})).json();return console.log("[DEBUG] Remove class assignment response:",r),r.success?{success:!0,message:"Assignment removed successfully"}:{success:!1,message:r.message||"Failed to remove assignment"}}catch(t){return console.error("Error removing class assignment:",t),{success:!1,message:"Error removing assignment: "+t.message}}}},Bj=C.createContext(),Uj=({children:e})=>{const[t,r]=C.useState(null),[n,s]=C.useState([]),[a,i]=C.useState({}),[l,c]=C.useState({}),[d,f]=C.useState(!1),[p,g]=C.useState(null),[y,v]=C.useState([]),[_,b]=C.useState(!1),[E,k]=C.useState(null),[w,N]=C.useState({isOpen:!1,testType:null,testId:null,testName:null,questions:[]}),[A,P]=C.useState(null),[R,T]=C.useState(0),{getItem:D,setItem:I,removeItem:V}=Mj();C.useEffect(()=>{let Te;return d&&A&&(Te=setInterval(()=>{const ve=Math.floor((Date.now()-A)/1e3);T(ve)},1e3)),()=>{Te&&clearInterval(Te)}},[d,A]);const X=async(Te,ve)=>{try{b(!0),k(null),console.log(`[DEBUG] loadTestForPage called with testType: ${Te}, testId: ${ve}`);const fe=await rn.getTestInfo(Te,ve);console.log("[DEBUG] Test info retrieved:",fe);const we=await rn.getTestQuestions(Te,ve);console.log("[DEBUG] Test questions retrieved:",we),r({...fe,testType:Te,testId:ve}),s(we),f(!0),P(Date.now()),T(0),Z(Te,ve),console.log("[DEBUG] Test loaded successfully")}catch(fe){k(fe.message||"Failed to load test"),console.error("Error loading test:",fe)}finally{b(!1)}},Z=(Te,ve)=>{try{const fe=`test_progress_${Te}_${ve}`,we=D(fe);we&&(i(we.answers||{}),c(we.progress||{}))}catch(fe){console.error("Error loading saved progress:",fe)}},ie=(Te,ve,fe,we)=>{try{if(window.tokenManager&&!window.tokenManager.isAuthenticated()){console.warn("[WARN] Cannot save progress: No valid JWT token");return}const St=`test_progress_${window.tokenManager?.getDecodedToken()?.sub||"unknown"}_${Te}_${ve}`,xt={...a,[fe]:we},Ht={...l,[fe]:{answered:!0,timestamp:Date.now()}};i(xt),c(Ht),I(St,{answers:xt,progress:Ht,lastSaved:Date.now()}),console.log(`Saved progress for question ${fe}:`,we)}catch(Ue){console.error("Error saving test progress:",Ue)}},q=(Te,ve,fe)=>{try{if(window.tokenManager&&!window.tokenManager.isAuthenticated())return console.warn("[WARN] Cannot get progress: No valid JWT token"),null;const Ue=`test_progress_${window.tokenManager?.getDecodedToken()?.sub||"unknown"}_${Te}_${ve}`;return D(Ue)?.answers?.[fe]||null}catch(we){return console.error("Error getting test progress:",we),null}},ne=(Te,ve)=>{try{if(console.log(`[DEBUG] clearTestProgress called with testType: ${Te}, testId: ${ve}`),window.tokenManager&&!window.tokenManager.isAuthenticated()){console.warn("[WARN] Cannot clear progress: No valid JWT token");return}const fe=window.tokenManager?.getDecodedToken()?.sub||"unknown",we=`test_progress_${fe}_${Te}_${ve}`;console.log(`[DEBUG] Removing localStorage key: ${we}`);const Ue=D(we)!==null;V(we),i({}),c({});for(let St=0;St<localStorage.length;St++){const xt=localStorage.key(St);xt&&xt.startsWith(`test_progress_${fe}_${Te}_${ve}_`)&&(localStorage.removeItem(xt),console.log(`[DEBUG] Cleared individual question key: ${xt}`))}console.log(Ue?`[DEBUG] Progress cleared for test ${Te}_${ve}`:`[DEBUG] No progress found to clear for test ${Te}_${ve}`)}catch(fe){console.error("Error clearing test progress:",fe)}},M=async(Te,ve,fe="")=>{try{b(!0),k(null),console.log("Submitting test:",{testType:Te,testId:ve});const we=te(Te,ve);if(Object.keys(we).length===0){k("Please answer at least one question before submitting.");return}let Ue;try{Ue=await rn.getTestInfo(Te,ve)}catch(Fr){console.error("Error getting test info:",Fr);const fr=await rn.getTestQuestions(Te,ve);Ue={test_name:`Test ${ve}`,num_questions:fr.length}}const St=await rn.getTestQuestions(Te,ve),xt=Du(St,we,Te),Ht=Ue.num_questions,Ot=ae(we,Te),Xt={test_id:ve,test_name:Ue.test_name,score:xt,maxScore:Ht,answers:Ot},pr=await rn.submitTest(Te,ve,Xt);if(pr.success){if(g(pr.result),K(Te,ve,fe),ne(Te,ve),fe){const Fr=`student_results_table_${fe}`;console.log("🎓 TestContext: Caching test results after submission with key:",Fr),Fn(Fr,pr.result,Dn.student_results_table)}return fe&&m0(fe,Te,ve),f(!1),pr.results}else throw new Error(pr.message||"Test submission failed")}catch(we){throw k(we.message||"Failed to submit test"),we}finally{b(!1)}},W=(Te,ve,fe)=>{g({testType:Te,testId:ve,answers:fe}),f(!1)},L=()=>{r(null),s([]),i({}),c({}),f(!1),g(null),k(null),P(null),T(0)},H=(Te,ve,fe="")=>{try{const we=`test_completed_${fe}_${Te}_${ve}`;return D(we)===!0}catch(we){return console.error("Error checking test completion:",we),!1}},K=(Te,ve,fe="")=>{try{const we=`test_completed_${fe}_${Te}_${ve}`;I(we,!0)}catch(we){console.error("Error marking test completed:",we)}},B=Te=>Object.keys(a).length,z=()=>{const Te=B(t?.testType),ve=n.length;return{canSubmit:Te===ve,answeredCount:Te,totalQuestions:ve}},Q=()=>{t&&ne(t.testType,t.testId),L()},Y=(Te="")=>{try{const ve=`student_results_table_${Te}`;console.log("🎓 TestContext: Clearing test results cache:",ve),localStorage.removeItem(ve),console.log("🎓 TestContext: Test results cache cleared")}catch(ve){console.error("Error clearing test results cache:",ve)}},te=(Te,ve)=>({...a}),ee=(Te,ve,fe=null)=>{try{if(!Te)return"No answer";switch(ve){case"true_false":return Te?"True":"False";case"multiple_choice":if(fe&&typeof Te=="string"&&!isNaN(parseInt(Te))){const we=parseInt(Te),Ue=`option_${String.fromCharCode(97+we)}`,St=fe[Ue];if(St)return St}return String(Te).toUpperCase();case"input":return String(Te);case"matching_type":return typeof Te=="object"?Object.entries(Te).map(([we,Ue])=>`${we} → ${Ue}`).join(", "):String(Te);case"word_matching":return typeof Te=="object"?Object.entries(Te).map(([we,Ue])=>`${we} → ${Ue}`).join(", "):String(Te);case"drawing":return"Drawing submitted";default:return String(Te)}}catch(we){return console.error("Error formatting student answer:",we),"Error displaying answer"}},ae=(Te,ve)=>{try{if(!Te||typeof Te!="object")return{};const fe={};return Object.entries(Te).forEach(([we,Ue])=>{if(Ue!=null)switch(ve){case"true_false":fe[we]=!!Ue;break;case"multiple_choice":fe[we]=String(Ue).toUpperCase();break;case"input":fe[we]=String(Ue).trim();break;case"matching_type":typeof Ue=="object"?fe[we]=Ue:fe[we]=String(Ue);break;case"word_matching":typeof Ue=="object"?fe[we]=Ue:fe[we]=String(Ue);break;case"drawing":fe[we]=Ue;break;default:fe[we]=Ue}}),fe}catch(fe){return console.error("Error transforming answers for submission:",fe),Te||{}}},ge=C.useCallback(async(Te="")=>{try{b(!0);const ve=`student_active_tests_${Te}`,fe=jn(ve);if(fe)return v(fe),fe;const we=await rn.getActiveTests();return v(we),Fn(ve,we,Dn.student_active_tests),we}catch(ve){return k(ve.message||"Failed to load active tests"),v([]),[]}finally{b(!1)}},[]),_e=async()=>{try{return b(!0),await rn.getTeacherTests()}catch(Te){return k(Te.message||"Failed to load teacher tests"),[]}finally{b(!1)}},Me=async Te=>{try{return b(!0),await rn.createTest(Te)}catch(ve){throw k(ve.message||"Failed to create test"),ve}finally{b(!1)}},ue=async(Te,ve)=>{try{return b(!0),await rn.deleteTest(Te,ve)}catch(fe){throw k(fe.message||"Failed to delete test"),fe}finally{b(!1)}},me=async(Te,ve)=>{try{return await rn.getTestInfo(Te,ve)}catch(fe){throw console.error("Error getting test info:",fe),fe}},He=async(Te,ve)=>{try{return await rn.getTestQuestions(Te,ve)}catch(fe){throw console.error("Error getting test questions:",fe),fe}},qe=async(Te,ve,fe)=>{try{console.log("Showing test results:",{testType:Te,testId:ve,studentAnswers:fe});const we=await me(Te,ve),Ue=await He(Te,ve);It(we,Ue,Te,fe),f(!1),console.log("Test results displayed successfully")}catch(we){console.error("Error showing test results:",we),k("Failed to display test results"),g({testType:Te,testId:ve,answers:fe,showResults:!0,error:"Could not load detailed results"}),f(!1)}},Xe=async(Te,ve,fe)=>{try{b(!0);const we=await me(Te,ve),Ue=await He(Te,ve);It(we,Ue,Te,fe)}catch(we){k(we.message||"Failed to load test results")}finally{b(!1)}},Ve=C.useCallback(async(Te="")=>{try{b(!0);const ve=`student_results_table_${Te}`;console.log("🎓 TestContext: Checking cache for key:",ve);const fe=jn(ve);if(fe)return console.log("🎓 TestContext: Cache HIT! Using cached test results"),g(fe),fe;console.log("🎓 TestContext: Cache MISS! Fetching from API");const we=await rn.getStudentTestResults();return console.log("🎓 TestContext: Test results loaded:",we),console.log("🎓 TestContext: Results data:",we?.results||we),console.log("🎓 TestContext: Results length:",we?.results?.length||0),g(we),console.log("🎓 TestContext: Caching test results with key:",ve),console.log("🎓 TestContext: Results being cached:",we),console.log("🎓 TestContext: Results.results being cached:",we.results),Fn(ve,we,Dn.student_results_table),we}catch(ve){throw console.error("Error loading test results:",ve),k(ve.message||"Failed to load test results"),ve}finally{b(!1)}},[]),It=(Te,ve,fe,we)=>{try{console.log("Displaying test results:",{testInfo:Te,questions:ve,testType:fe,studentAnswers:we});const Ue=Du(ve,we,fe),St=Te?.num_questions||ve?.length||0,xt=St>0?Math.round(Ue/St*100):0,Ht=xt>=60,Ot=ve.map((Xt,pr)=>{const Fr=Xt.question_id||Xt.id,fr=we[Fr],vr=c0(Xt,fr,fe);return{questionNumber:pr+1,question:Xt.question||Xt.question_text,userAnswer:ee(fr,fe),correctAnswer:op(Xt,fe),isCorrect:vr,questionType:fe}});g({testInfo:Te,questions:ve,testType:fe,studentAnswers:we,showResults:!0,score:Ue,totalQuestions:St,percentage:xt,passed:Ht,questionAnalysis:Ot,timestamp:new Date().toISOString()}),c(Xt=>({...Xt,score:Ue,totalQuestions:St,percentage:xt,passed:Ht,lastUpdated:Date.now()})),st(),console.log(`Test results displayed: ${Ue}/${St} (${xt}%) - ${Ht?"PASSED":"FAILED"}`)}catch(Ue){console.error("Error displaying test results:",Ue),k("Failed to display test results")}},st=C.useCallback(()=>{try{console.log("Setting up test results page event listeners");const Te=St=>{if(St.key==="Escape"&&Q(),St.ctrlKey&&St.key==="p"&&(St.preventDefault(),window.print()),St.key==="Enter"&&p&&!p.passed){const xt=document.getElementById("retake-test-button");xt&&xt.click()}},ve=()=>{window.print()},fe=()=>{if(p){const St=`Test: ${p.testInfo?.test_name||"Test"}
Score: ${p.score}/${p.totalQuestions} (${p.percentage}%)
Status: ${p.passed?"PASSED":"FAILED"}
Completed: ${new Date(p.timestamp).toLocaleString()}`;navigator.clipboard.writeText(St).then(()=>{console.log("Results copied to clipboard")}).catch(xt=>{console.error("Failed to copy results:",xt)})}};document.addEventListener("keydown",Te);const we=document.getElementById("print-results");we&&we.addEventListener("click",ve);const Ue=document.getElementById("copy-results");return Ue&&Ue.addEventListener("click",fe),()=>{document.removeEventListener("keydown",Te),we&&we.removeEventListener("click",ve),Ue&&Ue.removeEventListener("click",fe)}}catch(Te){console.error("Error setting up test results page event listeners:",Te)}},[Q,p]),Ie=async(Te,ve,fe)=>{try{b(!0),k(null),console.log("Viewing test details:",{testType:Te,testId:ve,testName:fe}),N({isOpen:!0,testType:Te,testId:ve,testName:fe,questions:[],isLoading:!0});const we=await rn.getTestQuestions(Te,ve);we&&we.length>0?(N({isOpen:!0,testType:Te,testId:ve,testName:fe,questions:we,isLoading:!1}),console.log(`Test details loaded: ${we.length} questions`)):(k("Could not load test questions. Please try again."),N({isOpen:!0,testType:Te,testId:ve,testName:fe,questions:[],isLoading:!1,error:"No questions available for this test"}))}catch(we){console.error("Error loading test details:",we),k("Error loading test details. Please try again."),N({isOpen:!0,testType:Te,testId:ve,testName:fe,questions:[],isLoading:!1,error:we.message||"Failed to load test details"})}finally{b(!1)}},je=(Te,ve,fe,we)=>{try{console.log("Showing test details modal:",{testType:Te,testId:ve,testName:fe,questions:we}),N({isOpen:!0,testType:Te,testId:ve,testName:fe,questions:we||[],isLoading:!1,error:null})}catch(Ue){console.error("Error showing test details modal:",Ue),k("Failed to show test details modal")}},Ze=()=>{try{console.log("Closing test details modal"),N({isOpen:!1,testType:null,testId:null,testName:null,questions:[],isLoading:!1,error:null})}catch(Te){console.error("Error closing test details modal:",Te)}},bt=(Te,ve)=>{try{switch(ve){case"multiple_choice":return o.jsxs("div",{className:"answer-options",children:[o.jsx("p",{children:o.jsx("strong",{children:"Options:"})}),o.jsxs("p",{children:["A) ",Te.option_a||"No text"]}),o.jsxs("p",{children:["B) ",Te.option_b||"No text"]}),Te.option_c&&o.jsxs("p",{children:["C) ",Te.option_c]}),Te.option_d&&o.jsxs("p",{children:["D) ",Te.option_d]}),Te.option_e&&o.jsxs("p",{children:["E) ",Te.option_e]}),Te.option_f&&o.jsxs("p",{children:["F) ",Te.option_f]}),o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",Te.correct_answer||"Not specified"]})})]});case"true_false":return o.jsx("div",{className:"answer-options",children:o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",Te.correct_answer?"True":"False"]})})});case"input":return o.jsx("div",{className:"answer-options",children:o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",Te.correct_answer||"Not specified"]})})});case"matching_type":return o.jsx("div",{className:"answer-options",children:o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",Te.correct_answer?JSON.stringify(Te.correct_answer):"Not specified"]})})});case"word_matching":return o.jsx("div",{className:"answer-options",children:o.jsx("p",{className:"correct-answer",children:o.jsxs("strong",{children:["Correct Answer: ",Te.correct_answer?JSON.stringify(Te.correct_answer):"Not specified"]})})});default:return o.jsx("p",{children:"Unknown question type"})}}catch(fe){return console.error("Error formatting question answer display:",fe),o.jsx("p",{children:"Error displaying question"})}},mt=(Te,ve)=>{try{console.log("Navigating to test:",{testType:Te,testId:ve}),r({testType:Te,testId:ve}),f(!0),X(Te,ve)}catch(fe){console.error("Error navigating to test:",fe),k("Failed to navigate to test")}},$t=()=>{try{console.log("Hiding test sections"),r(null),s([]),i({}),c({}),f(!1),g(null),k(null)}catch(Te){console.error("Error hiding test sections:",Te)}},Wt=(Te,ve,fe,we)=>{try{console.log("Displaying test on page:",{testInfo:Te,questions:ve,testType:fe,testId:we}),r({...Te,testType:fe,testId:we}),s(ve),f(!0),Z(fe,we),Jt(fe,we),_t(fe,we)}catch(Ue){console.error("Error displaying test on page:",Ue),k("Failed to display test on page")}},lt=(Te,ve,fe)=>{try{return console.log("Rendering questions for page:",{questions:Te,testType:ve,testId:fe}),!Te||!Array.isArray(Te)?(console.warn("Invalid questions array for rendering"),[]):Te.map((we,Ue)=>{const St=xt=>{const Ht={...a,[we.question_id]:xt};i(Ht),ie(ve,fe,we.question_id,xt)};return{question:we,index:Ue,testType:ve,testId:fe,studentAnswer:a[we.question_id]||"",onAnswerChange:St}})}catch(we){return console.error("Error rendering questions for page:",we),[]}},Qe=C.useCallback((Te,ve)=>{try{if(!Te||!ve){console.warn("Cannot save progress: missing testType or testId");return}const fe=`test_progress_${Te}_${ve}`,we={answers:a,progress:l,lastSaved:Date.now(),testType:Te,testId:ve};I(fe,we),console.log(`Progress saved for test ${Te}_${ve}:`,we)}catch(fe){console.error("Error saving progress for page:",fe)}},[a,l,I]),yt=C.useCallback(Te=>{try{return!a||Object.keys(a).length===0?0:Object.values(a).filter(fe=>fe==null?!1:typeof fe=="string"?fe.trim()!=="":typeof fe=="object"?Object.keys(fe).length>0:!0).length}catch(ve){return console.error("Error getting answered questions count for page:",ve),0}},[a]),ft=C.useCallback((Te,ve)=>{try{console.log("Updating progress display for page:",{testType:Te,testId:ve});const fe=yt(Te),we=n.length,Ue=we>0?Math.round(fe/we*100):0,St=fe===we&&we>0;c(Xt=>({...Xt,answeredCount:fe,totalQuestions:we,percentage:Ue,canSubmit:St,remainingQuestions:we-fe,lastUpdated:Date.now()}));const xt=document.getElementById("progress-bar"),Ht=document.getElementById("progress-text"),Ot=document.getElementById("submit-test-button");return xt&&(xt.style.width=`${Ue}%`,xt.className=xt.className.replace(/bg-\w+-\d+/,""),Ue>=100?xt.classList.add("bg-green-500"):Ue>=80?xt.classList.add("bg-blue-500"):Ue>=60?xt.classList.add("bg-yellow-500"):Ue>=40?xt.classList.add("bg-orange-500"):xt.classList.add("bg-red-500")),Ht&&(Ht.textContent=`${fe}/${we} questions answered (${Ue}%)`),Ot&&(Ot.disabled=!St,St?(Ot.textContent="✅ Submit Test",Ot.classList.remove("bg-gray-400"),Ot.classList.add("bg-green-600","hover:bg-green-700")):(Ot.textContent=`⏳ Complete ${we-fe} more question${we-fe!==1?"s":""}`,Ot.classList.remove("bg-green-600","hover:bg-green-700"),Ot.classList.add("bg-gray-400"))),{answeredCount:fe,totalQuestions:we,percentage:Ue,canSubmit:St}}catch(fe){return console.error("Error updating progress display for page:",fe),{answeredCount:0,totalQuestions:0,percentage:0,canSubmit:!1}}},[n.length,yt]),_t=C.useCallback((Te,ve)=>{try{console.log("Setting up test page event listeners:",{testType:Te,testId:ve});const fe=setInterval(()=>{Object.keys(a).length>0&&(Qe(Te,ve),console.log("Auto-saved progress for test:",Te,ve))},3e4),we=setInterval(()=>{ft(Te,ve)},2e3),Ue=Xt=>{Xt.key==="Escape"&&window.confirm("Are you sure you want to exit the test? Your progress will be saved.")&&Q(),Xt.ctrlKey&&Xt.key==="s"&&(Xt.preventDefault(),Qe(Te,ve),console.log("Manual save triggered")),Xt.key},St=Xt=>{Object.keys(a).length>0&&(Xt.preventDefault(),Xt.returnValue="Your test progress will be saved. Are you sure you want to leave?")},xt=()=>{document.hidden&&(console.log("Tab became hidden - saving progress"),Qe(Te,ve))},Ht=()=>{console.log("Window focused - updating progress"),ft(Te,ve)},Ot=()=>{console.log("Window blurred - saving progress"),Qe(Te,ve)};return document.addEventListener("keydown",Ue),window.addEventListener("beforeunload",St),document.addEventListener("visibilitychange",xt),window.addEventListener("focus",Ht),window.addEventListener("blur",Ot),window.testIntervals||(window.testIntervals={}),window.testIntervals[`autosave_${Te}_${ve}`]=fe,window.testIntervals[`progress_${Te}_${ve}`]=we,()=>{clearInterval(fe),clearInterval(we),document.removeEventListener("keydown",Ue),window.removeEventListener("beforeunload",St),document.removeEventListener("visibilitychange",xt),window.removeEventListener("focus",Ht),window.removeEventListener("blur",Ot),window.testIntervals&&(delete window.testIntervals[`autosave_${Te}_${ve}`],delete window.testIntervals[`progress_${Te}_${ve}`])}}catch(fe){console.error("Error setting up test page event listeners:",fe)}},[a,Qe,ft,Q]),zt=C.useCallback(()=>{try{const Te=yt(t?.testType),ve=n.length,fe=Te===ve&&ve>0,we=document.getElementById("submit-test-button");return we&&(we.disabled=!fe,we.textContent=fe?"Submit Test":`Complete ${ve-Te} more questions`),{canSubmit:fe,answeredCount:Te,totalQuestions:ve}}catch(Te){return console.error("Error updating submit button state for page:",Te),{canSubmit:!1,answeredCount:0,totalQuestions:0}}},[t,n.length,yt]),Jt=C.useCallback((Te,ve)=>{try{console.log("Setting up progress tracking for page:",{testType:Te,testId:ve});const fe=setInterval(()=>{ft(Te,ve),zt()},1e3),we=setInterval(()=>{Object.keys(a).length>0&&Qe(Te,ve)},3e4);return window.testIntervals||(window.testIntervals={}),window.testIntervals[`progress_${Te}_${ve}`]=fe,window.testIntervals[`autosave_${Te}_${ve}`]=we,()=>{clearInterval(fe),clearInterval(we),window.testIntervals&&(delete window.testIntervals[`progress_${Te}_${ve}`],delete window.testIntervals[`autosave_${Te}_${ve}`])}}catch(fe){console.error("Error setting up progress tracking for page:",fe)}},[a,ft,zt,Qe]),De=C.useCallback(async(Te,ve)=>{const fe=document.getElementById("submit-test-button");try{const we=yt(Te),Ue=n.length;if(we<Ue){k(`Please answer all ${Ue} questions before submitting.`);return}if(!window.confirm("Are you sure you want to submit your test? This action cannot be undone."))return;fe&&(fe.disabled=!0,fe.innerHTML=`
          <div class="flex items-center justify-center space-x-2">
            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
            <span>Submitting...</span>
          </div>
        `),await M(Te,ve)&&(ne(Te,ve),W(Te,ve,a),console.log("Test submitted successfully!"))}catch(we){console.error("Error submitting test from page:",we),k("Failed to submit test. Please try again."),fe&&(fe.disabled=!1,fe.textContent="Submit Test")}},[yt,n.length,M,ne,W,a]),ut=C.useCallback(()=>{try{if(!t)return null;const Te=["true_false","multiple_choice","input","matching_type","word_matching"];return Te.includes(t.testType)?t.testType:Te.includes(t.test_type)?t.test_type:null}catch(Te){return console.error("Error getting current test type:",Te),null}},[t]),pt=C.useCallback((Te,ve)=>{try{console.log("Clearing progress tracking interval:",{testType:Te,testId:ve});const fe=`progress_interval_${Te}_${ve}`,we=`autosave_interval_${Te}_${ve}`;window.testIntervals&&(window.testIntervals[fe]&&(clearInterval(window.testIntervals[fe]),delete window.testIntervals[fe]),window.testIntervals[we]&&(clearInterval(window.testIntervals[we]),delete window.testIntervals[we])),console.log(`Cleared progress tracking intervals for test ${Te}_${ve}`)}catch(fe){console.error("Error clearing progress tracking interval:",fe)}},[]),sr={currentTest:t,testQuestions:n,studentAnswers:a,testProgress:l,isTestActive:d,testResults:p,activeTests:y,isLoading:_,error:E,testDetailsModal:w,testStartTime:A,timeElapsed:R,loadTestForPage:X,submitTest:M,navigateToTestResults:W,navigateBackToCabinet:L,clearTestDataAndReturnToCabinet:Q,saveTestProgress:ie,getTestProgress:q,clearTestProgress:ne,loadSavedProgressForPage:Z,isTestCompleted:H,markTestCompleted:K,markTestCompletedInUI:(Te,ve)=>{console.log("Marking test completed in UI:",{testType:Te,testId:ve}),K(Te,ve)},getAnsweredQuestionsCount:B,updateSubmitButtonState:z,updateSubmitButtonStateForPage:zt,loadStudentActiveTests:ge,loadActiveTests:ge,loadTeacherActiveTests:_e,getTestInfo:me,getTestQuestions:He,createTest:Me,deleteTest:ue,showTestResults:qe,loadTestResults:Ve,loadTestResultsForPage:Xe,displayTestResultsOnPage:It,setupTestResultsPageEventListeners:st,clearTestResultsCache:Y,viewTestDetails:Ie,showTestDetailsModal:je,closeTestDetailsModal:Ze,getQuestionAnswerDisplay:bt,navigateToTest:mt,hideTestSections:$t,displayTestOnPage:Wt,renderQuestionsForPage:lt,setupTestPageEventListeners:_t,setupProgressTrackingForPage:Jt,updateProgressDisplayForPage:ft,submitTestFromPage:De,getAnsweredQuestionsCountForPage:yt,getCurrentTestType:ut,saveProgressForPage:Qe,clearProgressTrackingInterval:pt,collectTestAnswers:te,calculateTestScore:Du,checkAnswerCorrectness:c0,formatStudentAnswerForDisplay:ee,getCorrectAnswer:op,transformAnswersForSubmission:ae,clearAllTestData:()=>{try{console.log("Clearing old test data from localStorage (older than 15 days)...");const ve=Date.now()-360*60*60*1e3,fe=[];for(let we=0;we<localStorage.length;we++){const Ue=localStorage.key(we);if(!(!Ue||!((Ue.startsWith("test_")||Ue.startsWith("student_")||Ue.startsWith("teacher_")||Ue.startsWith("admin_")||Ue.includes("progress")||Ue.includes("answers"))&&!Ue.includes("test_completed_"))))try{const xt=localStorage.getItem(Ue);if(!xt){fe.push(Ue);continue}let Ht=null;if(xt.startsWith("{")||xt.startsWith("[")){const Ot=JSON.parse(xt),Xt=Ot.timestamp||Ot.lastSaved||Ot.lastTickAt||Ot.createdAt||Ot.updatedAt||Ot.startedAt||Ot.started_at||Ot.created_at;Xt&&(Ht=new Date(Xt).getTime())}if(!Ht){const Ot=`${Ue}__ts`,Xt=localStorage.getItem(Ot);Xt&&(Ht=parseInt(Xt)||null)}if(!Ht)continue;Ht<ve&&fe.push(Ue)}catch{continue}}return fe.forEach(we=>{console.log(`Removing old localStorage key: ${we}`),V(we)}),console.log(`Cleared ${fe.length} old test-related items from localStorage`),{success:!0,clearedCount:fe.length}}catch(Te){return console.error("Error clearing old test data:",Te),{success:!1,error:Te.message}}},setCurrentTest:r,setTestQuestions:s,setStudentAnswers:i,setTestProgress:c,setIsTestActive:f,setTestResults:g,setError:k};return o.jsx(Bj.Provider,{value:sr,children:e})},zp=()=>{const e=C.useContext(Bj);if(!e)throw new Error("useTest must be used within a TestProvider");return e},Hp=({testResults:e,onBackToCabinet:t,onRetakeTest:r,isLoading:n=!1,caught_cheating:s=!1,visibility_change_times:a=0})=>{if(!e||!e.showResults)return o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsx("div",{className:"text-center",children:o.jsx("p",{className:"text-gray-500",children:"No test results to display"})})});const{testInfo:i,testType:l,score:c,totalQuestions:d,percentage:f,passed:p,questionAnalysis:g,timestamp:y}=e,v=E=>({multiple_choice:"Multiple Choice",true_false:"True/False",input:"Input",matching_type:"Matching"})[E]||E,_=E=>E>=80?"text-green-600 bg-green-50":E>=60?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50",b=E=>E?"text-green-600 bg-green-100 border-green-200":"text-red-600 bg-red-100 border-red-200";return n?o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading test results..."})]})}):o.jsx("div",{className:"bg-gray-50 py-8 overflow-y-auto",children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[o.jsxs(et.div,{className:"bg-white rounded-lg shadow-lg p-6 mb-6",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(e?.caught_cheating||s)&&o.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 p-4 mb-6",children:o.jsxs("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),o.jsx("div",{className:"ml-3",children:o.jsxs("p",{className:"text-sm text-red-700",children:[o.jsx("strong",{children:"Academic Integrity Warning:"}),"This test has been flagged for suspicious behavior. You have switched tabs ",e?.visibility_change_times||a||0," times during the test."]})})]})}),o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Test Results"}),o.jsx("h2",{className:"text-xl text-gray-700 mb-1",children:i?.test_name||"Test"}),o.jsxs("p",{className:"text-sm text-gray-500",children:[v(l)," • Completed on ",new Date(y).toLocaleDateString()]})]}),o.jsx("div",{className:"text-right",children:o.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-full text-sm font-medium border ${b(p)}`,children:p?"✓ PASSED":"✗ FAILED"})})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[o.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[o.jsx("div",{className:"text-3xl font-bold text-gray-900",children:c}),o.jsx("div",{className:"text-sm text-gray-600",children:"Correct Answers"})]}),o.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[o.jsx("div",{className:"text-3xl font-bold text-gray-900",children:d}),o.jsx("div",{className:"text-sm text-gray-600",children:"Total Questions"})]}),o.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:`text-3xl font-bold ${_(f).split(" ")[0]}`,children:[f,"%"]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Score"})]})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-6",children:o.jsx(et.div,{className:`h-3 rounded-full ${_(f).split(" ")[1]}`,initial:{width:0},animate:{width:`${f}%`},transition:{duration:1,ease:"easeOut"}})}),o.jsx("div",{className:"flex flex-wrap gap-3",children:o.jsx(nt,{onClick:t,variant:"primary",className:"flex items-center gap-2",children:"← Back to Cabinet"})})]}),l!=="matching_type"&&l!=="word_matching"&&o.jsxs(et.div,{className:"bg-white rounded-lg shadow-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[o.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Question Review"}),o.jsx("div",{className:"space-y-4",children:g.map((E,k)=>o.jsxs(et.div,{className:`p-4 rounded-lg border-2 ${E.isCorrect?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:k*.1},children:[o.jsxs("div",{className:"flex items-start justify-between mb-3",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:["Question ",E.questionNumber]}),o.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${E.isCorrect?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:E.isCorrect?"✓ Correct":"✗ Incorrect"})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("p",{className:"text-gray-800 font-medium mb-2",children:"Question:"}),o.jsx("p",{className:"text-gray-700 bg-gray-100 p-3 rounded",children:E.question})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-800 font-medium mb-2",children:"Your Answer:"}),o.jsx("p",{className:`p-3 rounded ${E.isCorrect?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:E.userAnswer||"No answer provided"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-800 font-medium mb-2",children:"Correct Answer:"}),o.jsx("p",{className:"bg-blue-100 text-blue-800 p-3 rounded",children:E.correctAnswer})]})]})]},k))})]}),o.jsxs(et.div,{className:"bg-white rounded-lg shadow-lg p-6 mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:[o.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Summary Statistics"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.filter(E=>E.isCorrect).length}),o.jsx("div",{className:"text-sm text-blue-600",children:"Correct"})]}),o.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:g.filter(E=>!E.isCorrect).length}),o.jsx("div",{className:"text-sm text-red-600",children:"Incorrect"})]}),o.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"text-2xl font-bold text-gray-600",children:[Math.round(g.filter(E=>E.isCorrect).length/d*100),"%"]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Accuracy"})]}),o.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-purple-600",children:d}),o.jsx("div",{className:"text-sm text-purple-600",children:"Total"})]})]})]})]})})},$j=({isOpen:e,onClose:t,testType:r,testId:n,testName:s,questions:a=[],isLoading:i=!1})=>{if(!e)return null;const l=p=>({multiple_choice:"Multiple Choice",true_false:"True/False",input:"Input",matching_type:"Matching"})[p]||p,c=p=>({multiple_choice:"🔘",true_false:"✅",input:"✏️",matching_type:"🔗"})[p]||"❓",d=(p,g)=>{switch(g){case"multiple_choice":return o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Options:"}),o.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[p.option_a&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"A"}),o.jsx("span",{className:"text-gray-700",children:p.option_a})]}),p.option_b&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"B"}),o.jsx("span",{className:"text-gray-700",children:p.option_b})]}),p.option_c&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"C"}),o.jsx("span",{className:"text-gray-700",children:p.option_c})]}),p.option_d&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"D"}),o.jsx("span",{className:"text-gray-700",children:p.option_d})]}),p.option_e&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"E"}),o.jsx("span",{className:"text-gray-700",children:p.option_e})]}),p.option_f&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"F"}),o.jsx("span",{className:"text-gray-700",children:p.option_f})]})]})]});case"true_false":return o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Options:"}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"T"}),o.jsx("span",{className:"text-gray-700",children:"True"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:"F"}),o.jsx("span",{className:"text-gray-700",children:"False"})]})]})]});case"input":return o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Answer Format:"}),o.jsx("div",{className:"bg-gray-100 p-3 rounded",children:o.jsx("span",{className:"text-gray-600 italic",children:"Type your answer in the text input field"})})]});case"matching_type":return o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Instructions:"}),o.jsx("div",{className:"bg-gray-100 p-3 rounded",children:o.jsx("span",{className:"text-gray-600 italic",children:"Match the items by connecting them with lines or selecting pairs"})})]});default:return null}},f=(p,g)=>{if(!p.correct_answer)return null;let y="";switch(g){case"multiple_choice":y=p.correct_answer.toUpperCase();break;case"true_false":y=p.correct_answer?"True":"False";break;case"input":y=p.correct_answer;break;case"matching_type":y=typeof p.correct_answer=="object"?JSON.stringify(p.correct_answer):p.correct_answer;break;default:y=String(p.correct_answer)}return o.jsxs("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded",children:[o.jsx("p",{className:"font-medium text-green-800 mb-1",children:"Correct Answer:"}),o.jsx("p",{className:"text-green-700 font-mono",children:y})]})};return o.jsx(_i,{children:o.jsxs(et.div,{className:"fixed inset-0 z-50 overflow-y-auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[o.jsx(et.div,{className:"fixed inset-0 bg-black bg-opacity-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t}),o.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:o.jsxs(et.div,{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.3},children:[o.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("span",{className:"text-2xl",children:c(r)}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s||"Test Details"}),o.jsxs("p",{className:"text-sm text-gray-600",children:[l(r)," • ",a.length," Questions"]})]})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(nt,{onClick:()=>window.print(),variant:"outline",size:"sm",className:"flex items-center space-x-1",children:"🖨️ Print"}),o.jsx(nt,{onClick:t,variant:"outline",size:"sm",className:"flex items-center space-x-1",children:"✕ Close"})]})]}),o.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:i?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading test details..."})]})}):a.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📝"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No Questions Available"}),o.jsx("p",{className:"text-gray-500",children:"This test doesn't have any questions yet."})]}):o.jsx("div",{className:"space-y-6",children:a.map((p,g)=>o.jsxs(et.div,{className:"bg-gray-50 rounded-lg p-6 border border-gray-200",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:g*.1,duration:.3},children:[o.jsx("div",{className:"flex items-start justify-between mb-4",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsxs("span",{className:"bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full",children:["Question ",g+1]}),o.jsx("span",{className:"text-gray-500 text-sm",children:l(r)})]})}),o.jsx("div",{className:"mb-4",children:o.jsx("p",{className:"text-gray-800 font-medium text-lg leading-relaxed",children:p.question||p.question_text})}),d(p,r),f(p,r)]},p.id||p.question_id||g))})}),o.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[o.jsx("div",{className:"text-sm text-gray-600",children:a.length>0&&o.jsxs("span",{children:["Showing ",a.length," question",a.length!==1?"s":""]})}),o.jsx("div",{className:"flex items-center space-x-3",children:o.jsx(nt,{onClick:t,variant:"primary",className:"flex items-center space-x-2",children:"Close"})})]})]})})]})})},GW=({answeredCount:e=0,totalQuestions:t=0,timeElapsed:r=0,onSubmitTest:n,isSubmitting:s=!1,canSubmit:a=!1,className:i=""})=>{const l=t>0?Math.round(e/t*100):0,c=t-e,d=g=>{const y=Math.floor(g/3600),v=Math.floor(g%3600/60),_=g%60;return y>0?`${y}:${v.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`:`${v}:${_.toString().padStart(2,"0")}`},f=g=>g>=100?"bg-green-500":g>=80?"bg-blue-500":g>=60?"bg-yellow-500":g>=40?"bg-orange-500":"bg-red-500",p=g=>g>=100?"text-green-600":g>=80?"text-blue-600":g>=60?"text-yellow-600":g>=40?"text-orange-600":"text-red-600";return o.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-6 ${i}`,children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Test Progress"}),o.jsx("div",{className:"flex items-center space-x-4",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-2xl",children:"⏱️"}),o.jsx("span",{className:"text-sm font-mono text-gray-600",children:d(r)})]})})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),o.jsxs("span",{className:`text-sm font-semibold ${p(l)}`,children:[l,"%"]})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:o.jsx(et.div,{className:`h-full ${f(l)} transition-colors duration-300`,initial:{width:0},animate:{width:`${l}%`},transition:{duration:.5,ease:"easeOut"}})})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 mb-4",children:[o.jsxs("div",{className:"text-center p-2 sm:p-3 bg-blue-50 rounded-lg",children:[o.jsx("div",{className:"text-lg sm:text-2xl font-bold text-blue-600",children:e}),o.jsx("div",{className:"text-xs text-blue-600",children:"Answered"})]}),o.jsxs("div",{className:"text-center p-2 sm:p-3 bg-gray-50 rounded-lg",children:[o.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-600",children:c}),o.jsx("div",{className:"text-xs text-gray-600",children:"Remaining"})]}),o.jsxs("div",{className:"text-center p-2 sm:p-3 bg-purple-50 rounded-lg",children:[o.jsx("div",{className:"text-lg sm:text-2xl font-bold text-purple-600",children:t}),o.jsx("div",{className:"text-xs text-purple-600",children:"Total"})]})]}),o.jsx("div",{className:"mb-4",children:e===t?o.jsx(et.div,{className:"flex items-center justify-center p-3 bg-green-50 border border-green-200 rounded-lg",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:o.jsx("span",{className:"text-green-600 font-medium",children:"🎉 All questions answered! Ready to submit."})}):c===1?o.jsx(et.div,{className:"flex items-center justify-center p-3 bg-yellow-50 border border-yellow-200 rounded-lg",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:o.jsx("span",{className:"text-yellow-600 font-medium",children:"Almost there! 1 question remaining."})}):o.jsx("div",{className:"flex items-center justify-center p-3 bg-gray-50 border border-gray-200 rounded-lg",children:o.jsxs("span",{className:"text-gray-600 font-medium",children:[c," questions remaining"]})})}),a&&o.jsx("div",{className:"flex justify-center",children:o.jsx(et.button,{onClick:n,disabled:s,className:`px-8 py-3 rounded-lg font-semibold text-white transition-all duration-300 ${s?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 shadow-lg hover:shadow-xl"}`,whileHover:s?{}:{scale:1.05},whileTap:s?{}:{scale:.95},children:s?o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),o.jsx("span",{children:"Submitting..."})]}):o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{children:"✅"}),o.jsx("span",{children:"Submit Test"})]})})})]})},VW=({testText:e,blanks:t,separateType:r=!0,testId:n,testName:s="Unknown Test",teacherId:a="Unknown Teacher",subjectId:i,onTestComplete:l,onAnswerChange:c})=>{if(console.log("🔍 FillBlanksTestStudent Props Debug:"),console.log("- testText:",e),console.log("- blanks:",t),console.log("- separateType:",r),console.log("- testId:",n),console.log("- testName:",s),console.log("- teacherId:",a),console.log("- subjectId:",i),!e||!t||!Array.isArray(t))return console.log("❌ FillBlanksTestStudent: Missing test data"),o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx(kt,{className:"max-w-md w-full",children:o.jsxs(kt.Body,{className:"text-center",children:[o.jsx("div",{className:"text-gray-500 text-6xl mb-4",children:"📝"}),o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Test Data"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Unable to load fill blanks test data"}),o.jsx(nt,{onClick:()=>window.history.back(),variant:"primary",children:"Back to Dashboard"})]})})});const[d,f]=C.useState({}),[p,g]=C.useState(!1),[y,v]=C.useState(null),[_,b]=C.useState(null),[E,k]=C.useState(!1),[w,N]=C.useState(null),{showNotification:A}=ka(),{makeAuthenticatedRequest:P}=zi(),{user:R}=Bn(),{startTracking:T,stopTracking:D,getCheatingData:I,clearData:V}=Wp("fill_blanks",n,R?.student_id||R?.id);Qy();const X=C.useCallback((ne,M)=>{try{let W=ne;if(typeof ne=="string"&&ne.startsWith("{"))try{const B=JSON.parse(ne);B.root&&B.root.children&&(W=B.root.children.map(z=>z.children?z.children.map(Q=>Q.style&&Q.style.includes("background-color: #f0f9ff")?"[BLANK_PLACEHOLDER]":Q.text||"").join(""):"").join(" "))}catch(B){console.error("Error parsing Lexical JSON:",B)}let L=W;M.forEach((B,z)=>{const Q=`[${z+1}_________]`;L=L.replace("[BLANK_PLACEHOLDER]",Q)});const K=L.split(/(\[\d+_________\])/).map((B,z)=>B.match(/\[\d+_________\]/)?o.jsx("span",{className:"inline-block px-3 py-1 mx-1 bg-purple-100 text-purple-800 border-2 border-purple-400 rounded-lg font-mono font-bold shadow-sm",children:B},z):o.jsx("span",{children:B},z));return o.jsx("div",{className:"prose max-w-none mb-6",children:o.jsx("div",{className:"text-lg leading-relaxed whitespace-pre-wrap",children:K})})}catch(W){return console.error("Error rendering text with blanks:",W),o.jsx("div",{className:"text-red-500",children:"Error loading test content"})}},[]),Z=C.useCallback((ne,M)=>{try{let W=ne;if(typeof ne=="string"&&ne.startsWith("{"))try{const B=JSON.parse(ne);B.root&&B.root.children&&(W=B.root.children.map(z=>z.children?z.children.map(Q=>Q.style&&Q.style.includes("background-color: #f0f9ff")?"[BLANK_PLACEHOLDER]":Q.text||"").join(""):"").join(" "))}catch(B){console.error("Error parsing Lexical JSON:",B)}const L=[];M.forEach((B,z)=>{const Q=d[B.id],Y=Q?B.options[Q.charCodeAt(0)-65]:null,te=Y?o.jsx("span",{className:"inline-block px-3 py-2 bg-green-100 text-green-800 rounded-lg border-2 border-green-400 cursor-pointer hover:bg-green-200 hover:border-green-500 transition-all duration-200 font-bold shadow-sm",onClick:()=>b(B.id),children:Y},z):o.jsxs("span",{className:"inline-block px-3 py-2 bg-purple-100 text-purple-800 rounded-lg border-2 border-purple-400 cursor-pointer hover:bg-purple-200 hover:border-purple-500 transition-all duration-200 font-bold shadow-sm",onClick:()=>b(B.id),children:[z+1,"_________"]},z);L.push(te),W=W.replace("[BLANK_PLACEHOLDER]",`__BLANK_${B.id}__`)});const H=W.split(/__BLANK_\d+__/),K=[];for(let B=0;B<H.length;B++)H[B]&&K.push(o.jsx("span",{children:H[B]},`text-${B}`)),B<L.length&&K.push(L[B]);return o.jsx("div",{className:"prose max-w-none mb-6",children:o.jsx("div",{className:"text-lg leading-relaxed whitespace-pre-wrap",children:K})})}catch(W){return console.error("Error rendering text with inline blanks:",W),o.jsx("div",{className:"text-red-500",children:"Error loading test content"})}},[d]),ie=C.useCallback((ne,M)=>{const W={...d,[ne]:M};f(W),c&&c(ne,M)},[d,c]),q=C.useCallback(ne=>o.jsx("div",{className:"space-y-6",children:ne.map((M,W)=>{const L=M.blank_options||M.options||[];M.correct_answers;const H=M.question_json||M.question||`Blank ${W+1}`;return console.log(`🔍 Blank ${W+1} question text:`,H),o.jsxs(kt,{className:"p-4",children:[o.jsxs("div",{className:"mb-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Question ",W+1]}),o.jsx("p",{className:"text-gray-600 mb-4",children:H})]}),o.jsx("div",{className:"space-y-3",children:L.filter(K=>K&&K.trim().length>0).map((K,B)=>o.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors",children:[o.jsx("input",{type:"radio",name:`blank_${M.question_id||M.id||W}`,value:String.fromCharCode(65+B),checked:d[M.question_id||M.id||W]===String.fromCharCode(65+B),onChange:z=>ie(M.question_id||M.id||W,z.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),o.jsxs("span",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600",children:String.fromCharCode(65+B)}),o.jsx("span",{className:"text-gray-700",children:K})]})]},B))})]},M.question_id||M.id||W)})}),[d,ie]);return C.useEffect(()=>{if(n&&R?.student_id){v(new Date),T(),console.log("🛡️ Anti-cheating tracking started for fill blanks test");const M=`test_progress_${R.student_id}_fill_blanks_${n}`,W=jn(M);W&&(f(W.answers||{}),v(new Date(W.startTime)),console.log("🎯 Fill blanks test progress restored:",W))}},[n,R?.student_id,t,T]),C.useEffect(()=>{if(y&&R?.student_id&&n){const ne=setInterval(()=>{const M={answers:d,startTime:y.toISOString()},W=`test_progress_${R.student_id}_fill_blanks_${n}`;Fn(W,M,Dn.test_progress),console.log("🎯 Fill blanks progress auto-saved")},3e4);return()=>clearInterval(ne)}},[y,d,R?.student_id,n]),C.useEffect(()=>()=>{D(),V(),console.log("🛡️ Fill blanks test component unmounted - anti-cheating cleanup")},[D,V]),C.useCallback(async()=>{g(!0);try{const ne=t.length;let M=0;t.forEach((_e,Me)=>{const ue=d[_e.id];ue&&ue===_e.correct_answer&&M++});const W=M,L=ne;console.log(`🎯 Fill Blanks Score: ${W}/${L} (${Math.round(W/L*100)}%)`);const H=new Date,K=y?Math.round((H-y)/1e3):0,B=y?y.toISOString():H.toISOString(),z=I();console.log("🛡️ Anti-cheating data for fill blanks submission:",z);const Q=R.student_id,Y=`retest_assignment_id_${Q}_fill_blanks_${n}`,te=localStorage.getItem(Y),ee={test_id:n,test_name:s,teacher_id:a||null,subject_id:i||null,student_id:Q,parent_test_id:n,retest_assignment_id:te?Number(te):null,answers:d,score:W,maxScore:L,time_taken:K,started_at:B,submitted_at:H.toISOString(),caught_cheating:z.caught_cheating,visibility_change_times:z.visibility_change_times};console.log("🎯 Submitting fill blanks test:",ee);const ge=await(await P("/.netlify/functions/submit-fill-blanks-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee)})).json();if(ge.success){if(A("Test submitted successfully!","success"),D(),V(),console.log("🛡️ Anti-cheating tracking stopped and data cleared for fill blanks test"),R?.student_id&&(m0(R.student_id,"fill_blanks",n),console.log("🎓 Fill blanks test data cleared from cache")),R?.student_id){const _e=`test_completed_${R.student_id}_fill_blanks_${n}`;localStorage.setItem(_e,"true"),console.log("✅ Fill blanks test marked as completed in localStorage:",_e);const Me=`retest1_${Q}_fill_blanks_${n}`;localStorage.removeItem(Me),localStorage.removeItem(Y)}if(R?.student_id){const _e=`student_results_table_${R.student_id}`;Fn(_e,ge,Dn.student_results_table),console.log("🎓 Fill blanks test results cached with key:",_e)}setShowSubmitModal(!1),setTimeout(()=>{l&&l(W)},2e3)}else throw new Error(ge.message||"Failed to submit test")}catch(ne){console.error("Error submitting test:",ne),A("Error submitting test. Please try again.","error")}finally{g(!1)}},[d,t,n,s,a,i,y,I,D,V,P,A,l,R]),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:o.jsxs(kt,{children:[p&&o.jsx(kt.Header,{children:o.jsx("div",{className:"flex items-center justify-center",children:o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[o.jsx(jr,{size:"small"}),o.jsx("span",{children:"Submitting..."})]})})}),o.jsx(kt.Body,{children:r===!0?o.jsxs(o.Fragment,{children:[X(e,t),q(t)]}):o.jsx(o.Fragment,{children:Z(e,t)})}),r===!1&&_&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Select Answer"}),o.jsx("div",{className:"space-y-2",children:t.find(ne=>ne.id===_)?.options.filter(ne=>ne.trim().length>0).map((ne,M)=>o.jsxs("button",{onClick:()=>{ie(_,String.fromCharCode(65+M)),b(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-100 rounded-lg border border-gray-200",children:[o.jsxs("span",{className:"font-semibold text-blue-600 mr-2",children:[String.fromCharCode(65+M),")"]}),ne]},M))}),o.jsx("div",{className:"mt-4 flex justify-end",children:o.jsx(nt,{onClick:()=>b(null),variant:"secondary",size:"sm",children:"Cancel"})})]})}),o.jsx(kt.Footer,{children:o.jsx("div",{className:"flex gap-3"})})]})})};let KW=class{constructor(){this.tokenKey="auth_token",this.refreshTokenKey="refresh_token",this.userKey="user_data"}getToken(){return localStorage.getItem(this.tokenKey)}getRefreshToken(){return localStorage.getItem(this.refreshTokenKey)}getUserData(){const t=localStorage.getItem(this.userKey);return t?JSON.parse(t):null}setToken(t){localStorage.setItem(this.tokenKey,t)}setRefreshToken(t){localStorage.setItem(this.refreshTokenKey,t)}setUserData(t){localStorage.setItem(this.userKey,JSON.stringify(t))}setTokens(t,r){this.setToken(t),this.setUserData({role:r}),localStorage.setItem("accessToken",t)}isAuthenticated(){const t=this.getToken();if(!t)return!1;try{const r=JSON.parse(atob(t.split(".")[1])),n=Date.now()/1e3;return r.exp>n}catch(r){return console.error("Error decoding token:",r),!1}}getUserRole(){const t=this.getUserData();return t?t.role:null}isAdmin(){return this.getUserRole()==="admin"}isTeacher(){return this.getUserRole()==="teacher"}isStudent(){return this.getUserRole()==="student"}clearAuth(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.refreshTokenKey),localStorage.removeItem(this.userKey)}logout(){this.clearAuth(),window.location.href="/login"}getAuthHeader(){const t=this.getToken();return t?`Bearer ${t}`:null}async makeAuthenticatedRequest(t,r={}){const n=this.getToken();if(!n)throw new Error("No authentication token found");const s={"Content-Type":"application/json",Authorization:`Bearer ${n}`,...r.headers},a=await fetch(t,{...r,headers:s});if(a.status===401){if(await this.refreshToken())return s.Authorization=`Bearer ${this.getToken()}`,fetch(t,{...r,headers:s});throw this.logout(),new Error("Authentication failed")}return a}async refreshToken(){const t=this.getRefreshToken();if(!t)return!1;try{const r=await fetch("/.netlify/functions/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(r.ok){const n=await r.json();return this.setToken(n.accessToken),n.refreshToken&&this.setRefreshToken(n.refreshToken),!0}}catch(r){console.error("Error refreshing token:",r)}return!1}getAccessToken(){return this.getToken()}decodeToken(t){try{return JSON.parse(atob(t.split(".")[1]))}catch(r){return console.error("Error decoding token:",r),null}}init(){return this.isAuthenticated()?(this.setupTokenRefresh(),!0):(window.location.pathname!=="/login"&&(window.location.href="/login"),!1)}setupTokenRefresh(){setInterval(async()=>{this.isAuthenticated()&&await this.refreshToken()},3e3*1e3)}};const u0=new KW;window.tokenManager=u0;typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{u0.init()}):u0.init());const Wj=async(e,t,r,n,s)=>{try{console.log("📊 Fetching teacher student results:",{teacherId:e,grade:t,className:r,semester:n,academicPeriodId:s});const i=await(await u0.makeAuthenticatedRequest(`/.netlify/functions/get-teacher-student-results?teacher_id=${e}&grade=${t}&class=${r}&semester=${n}&academic_period_id=${s}`)).json();if(i.success)return console.log("📊 Teacher student results loaded:",i.results.length,"results"),console.log("📊 Students loaded:",i.students?.length||0,"students"),{success:!0,results:i.results,students:i.students||[],count:i.results.length,student_count:i.student_count||0};throw new Error(i.error||"Failed to load teacher student results")}catch(a){return console.error("Error fetching teacher student results:",a),{success:!1,error:a.message,results:[]}}},zj=async(e,t)=>{try{console.log("📊 Fetching student results view:",{studentId:e,academicPeriodId:t});const r=t?`&academic_period_id=${t}`:"",s=await(await u0.makeAuthenticatedRequest(`/.netlify/functions/get-student-results-view?student_id=${e}${r}`)).json();if(s.success)return console.log("📊 Student results view loaded:",s.results.length,"results"),{success:!0,results:s.results,count:s.results.length};throw new Error(s.error||"Failed to load student results view")}catch(r){return console.error("Error fetching student results view:",r),{success:!1,error:r.message,results:[]}}},qW=async(e,t,r,n)=>{try{console.log("📊 Fetching class summary:",{teacherId:e,grade:t,className:r,academicPeriodId:n});const a=await(await u0.makeAuthenticatedRequest(`/.netlify/functions/get-class-summary?teacher_id=${e}&grade=${t}&class=${r}&academic_period_id=${n}`)).json();if(a.success)return console.log("📊 Class summary loaded:",a.summary),{success:!0,summary:a.summary,hasData:!!a.summary};throw new Error(a.error||"Failed to load class summary")}catch(s){return console.error("Error fetching class summary:",s),{success:!1,error:s.message,summary:null}}},XW=async(e,t,r,n,s,a={})=>{try{const i=await Wj(e,t,r,n,s);if(!i.success)return i;let l=i.results;return a.subject&&(l=l.filter(c=>c.subject&&c.subject.toLowerCase().includes(a.subject.toLowerCase()))),a.testType&&(l=l.filter(c=>c.test_type===a.testType)),a.minScore!==void 0&&(l=l.filter(c=>c.score/c.max_score*100>=a.minScore)),a.maxScore!==void 0&&(l=l.filter(c=>c.score/c.max_score*100<=a.maxScore)),a.passed!==void 0&&(l=l.filter(c=>c.score>=c.passing_score===a.passed)),{success:!0,results:l,count:l.length,originalCount:i.results.length}}catch(i){return console.error("Error filtering teacher student results:",i),{success:!1,error:i.message,results:[]}}},YW=async(e,t,r={})=>{try{const n=await zj(e,t);if(!n.success)return n;let s=n.results;return r.subject&&(s=s.filter(a=>a.subject&&a.subject.toLowerCase().includes(r.subject.toLowerCase()))),r.testType&&(s=s.filter(a=>a.test_type===r.testType)),r.semester&&(s=s.filter(a=>a.semester===r.semester)),r.passed!==void 0&&(s=s.filter(a=>a.score>=a.passing_score===r.passed)),{success:!0,results:s,count:s.length,originalCount:n.results.length}}catch(n){return console.error("Error filtering student results view:",n),{success:!1,error:n.message,results:[]}}},QW={getTeacherStudentResults:Wj,getStudentResultsView:zj,getClassSummary:qW,getTeacherStudentResultsFiltered:XW,getStudentResultsViewFiltered:YW};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JW=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ZW=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),rN=e=>{const t=ZW(e);return t.charAt(0).toUpperCase()+t.slice(1)},Hj=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),ez=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var tz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rz=C.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:a,iconNode:i,...l},c)=>C.createElement("svg",{ref:c,...tz,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:Hj("lucide",s),...!a&&!ez(l)&&{"aria-hidden":"true"},...l},[...i.map(([d,f])=>C.createElement(d,f)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0=(e,t)=>{const r=C.forwardRef(({className:n,...s},a)=>C.createElement(rz,{ref:a,iconNode:t,className:Hj(`lucide-${JW(rN(e))}`,`lucide-${e}`,n),...s}));return r.displayName=rN(e),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nz=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],sz=A0("download",nz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const az=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],iz=A0("maximize-2",az);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oz=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],lz=A0("rotate-cw",oz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cz=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Gj=A0("x",cz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uz=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],dz=A0("zoom-in",uz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fz=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],hz=A0("zoom-out",fz),Io={WIDTH:1536,HEIGHT:2048,ASPECT_RATIO:1536/2048},Vj={MIN:.25,MAX:1,INITIAL:.25,STEP:.1},Pd={PENCIL:"pencil",LINE:"line",RECTANGLE:"rectangle",CIRCLE:"circle",ERASER:"eraser"},nN={CURSOR_COLOR:"#ff0000",CURSOR_OPACITY:.3},sN={ERASER_TO_THICKNESS_RATIO:2.5,THICKNESS_TO_ERASER_RATIO:.4},uy={MAX_ENTRIES:10,MAX_MEMORY_KB:500,COMPRESSION_THRESHOLD:200},Kj=e=>{try{const t=JSON.stringify(e);return new Blob([t]).size/1024}catch(t){return console.warn("Error calculating memory usage:",t),0}},gz=e=>Array.isArray(e)?e.map(t=>Array.isArray(t)?mz(t):t):e,mz=e=>{if(e.length<=2)return e;const t=[e[0]],r=2;for(let n=1;n<e.length-1;n++){const s=e[n-1],a=e[n];e[n+1],Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2))>r&&t.push(a)}return t.push(e[e.length-1]),t},pz=(e,t=Date.now())=>{const r=Kj(e);return{data:[...e],timestamp:t,memoryUsage:r,compressed:r>uy.COMPRESSION_THRESHOLD}},aN=(e,t,r)=>{const n=pz(t),s=Kj(t),a=e.slice(0,r+1);a.push(n);let i=a;return s>uy.MAX_MEMORY_KB&&(i=xz(a)),i.length>uy.MAX_ENTRIES&&(i=i.slice(-10)),{history:i,index:i.length-1}},xz=e=>e.map(t=>t.memoryUsage>uy.COMPRESSION_THRESHOLD?{...t,data:gz(t.data),compressed:!0}:t),iN=(e,t)=>{if(t<0||t>=e.length)return[];const r=e[t];return r?r.compressed?yz(r.data):[...r.data]:[]},yz=e=>[...e],oN=e=>e>0,lN=(e,t)=>e<t-1,vz=()=>({history:[],index:-1}),wz=()=>{const[e,t]=C.useState({zoom:1,position:{x:0,y:0},rotation:0,currentTool:"pencil",currentColor:"#000000",currentThickness:2,eraserSize:10,isDrawing:!1,currentLine:[],currentShape:null,drawingHistory:[],historyIndex:-1,isFullscreen:!1,preFullscreenState:null}),[r,n]=C.useState([]),[s,a]=C.useState([]),i=C.useCallback(A=>{t(P=>({...P,...A}))},[]),l=C.useCallback(()=>{t({zoom:1,position:{x:0,y:0},rotation:0,currentTool:"pencil",currentColor:"#000000",currentThickness:2,eraserSize:10,isDrawing:!1,currentLine:[],currentShape:null,drawingHistory:[],historyIndex:-1,isFullscreen:!1,preFullscreenState:null})},[]),c=C.useCallback(A=>{const P={x:A.x,y:A.y,color:e.currentColor,thickness:e.currentThickness};e.currentTool==="pencil"?t(R=>({...R,isDrawing:!0,currentLine:[P]})):["line","rectangle","circle"].includes(e.currentTool)&&t(R=>({...R,isDrawing:!0,currentShape:{type:e.currentTool,startX:A.x,startY:A.y,endX:A.x,endY:A.y,color:e.currentColor,thickness:e.currentThickness}}))},[e.currentTool,e.currentColor,e.currentThickness]),d=C.useCallback(A=>{if(!e.isDrawing)return;const P={x:A.x,y:A.y,color:e.currentColor,thickness:e.currentThickness};e.currentTool==="pencil"?t(R=>({...R,currentLine:[...R.currentLine,P]})):e.currentShape&&t(R=>({...R,currentShape:{...R.currentShape,endX:A.x,endY:A.y}}))},[e.isDrawing,e.currentTool,e.currentColor,e.currentThickness,e.currentShape]),f=C.useCallback(()=>{if(!e.isDrawing)return;let A=r;if(e.currentTool==="pencil"&&e.currentLine.length>0?(A=[...r,e.currentLine],n(A)):e.currentShape&&(A=[...r,e.currentShape],n(A)),A!==r){const P=aN(e.drawingHistory,A,e.historyIndex);t(R=>({...R,isDrawing:!1,currentLine:[],currentShape:null,drawingHistory:P.history,historyIndex:P.index}))}else t(P=>({...P,isDrawing:!1,currentLine:[],currentShape:null}))},[e.isDrawing,e.currentTool,e.currentLine,e.currentShape,r,e.drawingHistory,e.historyIndex]),p=C.useCallback(A=>Math.round(A*sN.ERASER_TO_THICKNESS_RATIO),[]),g=C.useCallback(A=>Math.round(A*sN.THICKNESS_TO_ERASER_RATIO),[]),y=C.useCallback(A=>{t(P=>({...P,currentThickness:A,eraserSize:p(A)}))},[p]),v=C.useCallback(A=>{t(P=>({...P,eraserSize:A,currentThickness:g(A)}))},[g]),_=C.useCallback(A=>{const P=aN(e.drawingHistory,A,e.historyIndex);t(R=>({...R,drawingHistory:P.history,historyIndex:P.index}))},[e.drawingHistory,e.historyIndex]),b=C.useCallback(()=>{if(oN(e.historyIndex)){const A=e.historyIndex-1,P=iN(e.drawingHistory,A);n([...P]),t(R=>({...R,historyIndex:A}))}},[e.historyIndex,e.drawingHistory]),E=C.useCallback(()=>{if(lN(e.historyIndex,e.drawingHistory.length)){const A=e.historyIndex+1,P=iN(e.drawingHistory,A);n([...P]),t(R=>({...R,historyIndex:A}))}},[e.historyIndex,e.drawingHistory]),k=C.useCallback(()=>{const A=vz();t(P=>({...P,drawingHistory:A.history,historyIndex:A.index}))},[]),w=oN(e.historyIndex),N=lN(e.historyIndex,e.drawingHistory.length);return{drawingState:e,setDrawingState:t,drawingData:r,setDrawingData:n,textBoxes:s,setTextBoxes:a,updateDrawingState:i,resetDrawingState:l,startDrawing:c,continueDrawing:d,finishDrawing:f,handleThicknessChange:y,handleEraserSizeChange:v,saveToHistoryState:_,undo:b,redo:E,clearHistoryState:k,canUndoState:w,canRedoState:N}},cN={SCALE_DELTA:.05,CENTER_DELTA:20},zh=e=>{if(e.length<2)return 0;const t=e[0],r=e[1];return Math.sqrt(Math.pow(r.clientX-t.clientX,2)+Math.pow(r.clientY-t.clientY,2))},Su=e=>{if(e.length<2)return null;const t=e[0],r=e[1];return{x:(t.clientX+r.clientX)/2,y:(t.clientY+r.clientY)/2}},_z=(e,t)=>{if(e.length!==2||!t)return null;const r=zh(e),n=zh(t),s=Su(e),a=Su(t);if(n===0)return null;const i=Math.abs(r/n-1),l=Math.sqrt(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2));return i>cN.SCALE_DELTA?"zoom":l>cN.CENTER_DELTA?"pan":null},bz=e=>{let t;return function(){const r=arguments,n=this;t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{e.apply(n,r),t=null})}},Rh=(e,t)=>{const r=t.getPointerPosition();return{x:(r.x-t.x())/t.scaleX(),y:(r.y-t.y())/t.scaleY()}},so={PENCIL:"pencil",LINE:"line",RECTANGLE:"rectangle",CIRCLE:"circle",PAN:"pan"},dy={color:"#000000",thickness:2},uN=(e,t,r)=>({x:e.x,y:e.y,color:t||dy.color,thickness:r||dy.thickness}),Sz=(e,t,r,n,s)=>({type:e,startX:t.x,startY:t.y,endX:r.x,endY:r.y,color:n||dy.color,thickness:s||dy.thickness}),qj=(e,t,r,n,s,a)=>{const i=e-r,l=t-n,c=s-r,d=a-n,f=i*c+l*d,p=c*c+d*d;let g=-1;p!==0&&(g=f/p);let y,v;g<0?(y=r,v=n):g>1?(y=s,v=a):(y=r+g*c,v=n+g*d);const _=e-y,b=t-v;return Math.sqrt(_*_+b*b)},kz=(e,t)=>{if(t.length===0)return[e];const r=t.sort((a,i)=>a.index-i.index),n=[];let s=0;for(const a of r)a.index>s&&n.push(e.slice(s,a.index+1)),s=a.index+1;return s<e.length&&n.push(e.slice(s)),n.filter(a=>a.length>0)},Cz=(e,t,r,n)=>{const s=[],a=r/2;for(let i=0;i<n.length-1;i++){const l=n[i],c=n[i+1],d=qj(e,t,l.x,l.y,c.x,c.y);d<=a&&s.push({index:i,point:{x:l.x,y:l.y},distance:d})}return s},Tz=(e,t,r,n)=>{const s=Cz(t,r,n,e);return s.length===0?[e]:kz(e,s)},Ez=(e,t,r,n)=>{if(n.type==="rectangle"){const s=Math.min(n.startX,n.endX),a=Math.min(n.startY,n.endY),i=Math.abs(n.endX-n.startX),l=Math.abs(n.endY-n.startY);return e>=s&&e<=s+i&&t>=a&&t<=a+l}else if(n.type==="circle"){const s=(n.startX+n.endX)/2,a=(n.startY+n.endY)/2,i=Math.sqrt(Math.pow(n.endX-n.startX,2)+Math.pow(n.endY-n.startY,2))/2;return Math.sqrt(Math.pow(e-s,2)+Math.pow(t-a,2))<=i}return!1},dN=(e,t,r,n)=>{const s=[];for(const a of n)if(Array.isArray(a)){const i=Tz(a,e,t,r);s.push(...i)}else a.type==="line"?qj(e,t,a.startX,a.startY,a.endX,a.endY)>r/2&&s.push(a):(a.type==="rectangle"||a.type==="circle")&&(Ez(e,t,r,a)||s.push(a));return s},Nz=(e,t,r,n,s,a,i,l,c)=>{const[d,f]=C.useState({isActive:!1,type:null,lastDistance:null,lastCenter:null}),p=C.useCallback(P=>{if(P.evt.preventDefault(),P.evt.stopPropagation(),e.currentTool===so.PAN)return;const R=P.target.getStage(),T=Rh(P,R),D=uN(T,e.currentColor,e.currentThickness);e.currentTool===so.PENCIL?t(I=>({...I,isDrawing:!0,currentLine:[D]})):[so.LINE,so.RECTANGLE,so.CIRCLE].includes(e.currentTool)&&t(I=>({...I,isDrawing:!0,currentShape:Sz(e.currentTool,T,T,e.currentColor,e.currentThickness)}))},[e.currentTool,e.currentColor,e.currentThickness,t]),g=C.useCallback(P=>{const R=dN(P.x,P.y,e.eraserSize,r);n(R),s(R)},[e.eraserSize,r,n,s]),y=C.useCallback(P=>{l&&(a(),_("Undo",P))},[l,a]),v=C.useCallback(P=>{c&&(i(),_("Redo",P))},[c,i]),_=C.useCallback((P,R)=>{const T=R.target.getStage(),D=Rh(R,T),I=new Konva.Circle({x:D.x,y:D.y,radius:20,stroke:"#4CAF50",strokeWidth:3,opacity:.8,listening:!1});T.add(I),I.to({scaleX:2,scaleY:2,opacity:0,duration:.3,onFinish:()=>{I.destroy()}})},[]),b=C.useCallback(P=>{if(P.evt.preventDefault(),P.evt.stopPropagation(),!e.isDrawing)return;const R=P.target.getStage(),T=Rh(P,R),D=uN(T,e.currentColor,e.currentThickness);e.currentTool===so.PENCIL?t(I=>({...I,currentLine:[...I.currentLine,D]})):e.currentShape&&t(I=>({...I,currentShape:{...I.currentShape,endX:T.x,endY:T.y}}))},[e.isDrawing,e.currentTool,e.currentColor,e.currentThickness,e.currentShape,t]),E=C.useCallback(P=>{P&&P.evt&&(P.evt.preventDefault(),P.evt.stopPropagation()),e.isDrawing&&(e.currentTool===so.PENCIL&&e.currentLine.length>0?n(R=>[...R,e.currentLine]):e.currentShape&&n(R=>[...R,e.currentShape]),t(R=>({...R,isDrawing:!1,currentLine:[],currentShape:null})))},[e.isDrawing,e.currentTool,e.currentLine,e.currentShape,n,t]),k=C.useCallback(P=>{P.evt.preventDefault(),P.evt.stopPropagation();const R=P.evt.touches;if(R.length===2)f({isActive:!0,type:"pan",lastDistance:zh(R),lastCenter:Su(R)});else if(R.length===1)if(e.currentTool===so.ERASER){const T=P.target.getStage(),D=Rh(P,T);g(D)}else e.currentTool===so.UNDO?y(P):e.currentTool===so.REDO?v(P):p(P)},[zh,Su,p,e.currentTool,g,y,v]),w=C.useCallback(bz(P=>{P.evt.preventDefault(),P.evt.stopPropagation();const R=P.evt.touches;if(R.length===2&&d.isActive){const T=_z(R,d);if(T==="zoom"){const D=zh(R),I=Su(R),V=D/d.lastDistance,X=Math.max(.25,Math.min(1,e.zoom*V));t(Z=>({...Z,zoom:X,position:{x:I.x-(I.x-Z.position.x)*(X/Z.zoom),y:I.y-(I.y-Z.position.y)*(X/Z.zoom)}}))}else if(T==="pan"){const D=Su(R),I=D.x-d.lastCenter.x,V=D.y-d.lastCenter.y;t(X=>({...X,position:{x:X.position.x+I,y:X.position.y+V}}))}f(D=>({...D,lastDistance:zh(R),lastCenter:Su(R)}))}else if(R.length===1)if(e.currentTool===so.ERASER){const T=P.target.getStage(),D=Rh(P,T),I=dN(D.x,D.y,e.eraserSize,r);n(I)}else if(e.currentTool===so.PAN){const T=Su(R),D=T.x-d.lastCenter.x,I=T.y-d.lastCenter.y;t(V=>({...V,position:{x:V.position.x+D,y:V.position.y+I}})),f(V=>({...V,lastCenter:T}))}else b(P)}),[d,e.zoom,t,b]),N=C.useCallback(P=>{w(P)},[w]),A=C.useCallback(P=>{P.evt.preventDefault(),P.evt.stopPropagation();const R=P.evt.touches;R.length===0?(E(P),f({isActive:!1,type:null,lastDistance:null,lastCenter:null})):R.length===1&&f(T=>({...T,isActive:!1}))},[E]);return{handleTouchStart:k,handleTouchMove:N,handleTouchEnd:A,handleEraserStart:g,handleUndoTouch:y,handleRedoTouch:v,showTouchFeedback:_}},Az=(e,t)=>{const[r,n]=C.useState(e.MIN),[s,a]=C.useState({x:0,y:0}),i=C.useCallback((g,y,v)=>{const _=Math.max(e.MIN,Math.min(e.MAX,g));if(y){const b=_/r,E={x:y.x-(y.x-s.x)*b,y:y.y-(y.y-s.y)*b};return{zoom:_,position:E}}else{const b=t.width*_,E=t.height*_,k={x:(v.width-b)/2,y:(v.height-E)/2};return{zoom:_,position:k}}},[r,s,e,t]),l=C.useCallback(()=>{const g=Math.min(r*(1+e.STEP),e.MAX);n(g)},[r,e]),c=C.useCallback(()=>{const g=Math.max(r/(1+e.STEP),e.MIN);n(g)},[r,e]),d=C.useCallback((g,y,v)=>{const _=i(g,y,v);n(_.zoom),a(_.position)},[i]),f=C.useCallback((g,y)=>{a(v=>({x:v.x+g,y:v.y+y}))},[]),p=C.useCallback(()=>{n(e.INITIAL),a({x:0,y:0})},[e.INITIAL]);return{zoom:r,setZoom:n,position:s,setPosition:a,handleZoomIn:l,handleZoomOut:c,handleZoomToPoint:d,handlePan:f,resetZoom:p}},jz=e=>{const[t,r]=C.useState([]),[n,s]=C.useState(0),a=C.useCallback(p=>{if(console.log("parseDrawingData - input drawing:",p),console.log("parseDrawingData - drawing.answers:",p?.answers),!p?.answers)return console.log("parseDrawingData - no answers found, returning empty array"),[];try{if(typeof p.answers=="string"){console.log("parseDrawingData - parsing string answers");const g=JSON.parse(p.answers);return console.log("parseDrawingData - parsed string result:",g),g&&typeof g=="object"&&g.lines&&console.log("parseDrawingData - new format detected with lines and textBoxes"),g}if(p.answers&&typeof p.answers=="object"&&p.answers.lines)return console.log("parseDrawingData - answers is new format object"),p.answers;if(Array.isArray(p.answers)){if(console.log("parseDrawingData - answers is array"),p.answers.every(y=>typeof y=="string"))try{const y=p.answers.map(v=>{try{return JSON.parse(v)}catch{return v}});return console.log("parseDrawingData - parsed array elements"),y}catch{return console.log("parseDrawingData - failed to parse array elements, returning raw"),p.answers}return p.answers}return console.log("parseDrawingData - answers is neither string nor array, returning empty array"),[]}catch(g){return console.error("Error parsing drawing data:",g),[]}},[]),i=C.useCallback(p=>{if(console.log("processQuestions - input answers:",p),console.log("processQuestions - answers type:",typeof p),console.log("processQuestions - answers isArray:",Array.isArray(p)),p&&typeof p=="object"&&p.lines){console.log("processQuestions - new format detected with lines and textBoxes"),console.log("processQuestions - lines count:",p.lines?.length),console.log("processQuestions - textBoxes count:",p.textBoxes?.length);const y=l(p.lines);return console.log("processQuestions - canvas groups:",y),console.log("processQuestions - number of canvas groups:",y.length),y.map((v,_)=>(console.log(`processQuestions - canvas ${_} strokes:`,v),console.log(`processQuestions - canvas ${_} stroke count:`,v.length),{questionNumber:_+1,drawingData:v,textBoxes:p.textBoxes||[]}))}if(Array.isArray(p)&&p.every(y=>y&&typeof y=="object"&&y.lines))return console.log("processQuestions - array of {lines,textBoxes} detected"),p.map((y,v)=>({questionNumber:v+1,drawingData:y.lines||[],textBoxes:y.textBoxes||[]}));if(!Array.isArray(p))return console.log("processQuestions - answers is not array or object, returning empty array"),[];console.log("processQuestions - processing",p.length,"answers (old format)");const g=l(p);return console.log("processQuestions - canvas groups:",g),console.log("processQuestions - number of canvas groups:",g.length),g.map((y,v)=>(console.log(`processQuestions - canvas ${v} strokes:`,y),console.log(`processQuestions - canvas ${v} stroke count:`,y.length),{questionNumber:v+1,drawingData:y,textBoxes:[]}))},[]),l=C.useCallback(p=>{console.log("groupStrokesByCanvas - input answers:",p);const g=c(p);return console.log("groupStrokesByCanvas - using strategy:",g),g==="by_question_boundary"?d(p):g==="by_stroke_type"?f(p):[p]},[]),c=C.useCallback(p=>{console.log("determineGroupingStrategy - analyzing answers:",p);let g=0,y=0;return p.forEach(v=>{Array.isArray(v)?g++:typeof v=="object"&&y++}),console.log("determineGroupingStrategy - arrayCount:",g,"objectCount:",y),g>0&&y>0?"by_stroke_type":p.length>3?"by_question_boundary":"single_canvas"},[]),d=C.useCallback(p=>{console.log("groupByQuestionBoundary - grouping answers:",p);const g=[];let y=[];const v=Math.ceil(p.length/2);for(let _=0;_<p.length;_++)y.push(p[_]),(_+1)%v===0&&_<p.length-1&&(g.push([...y]),y=[]);return y.length>0&&g.push(y),console.log("groupByQuestionBoundary - result:",g),g},[]),f=C.useCallback(p=>{console.log("groupByStrokeType - grouping answers:",p);const g=[],y=[];p.forEach(_=>{Array.isArray(_)?g.push(_):typeof _=="object"&&y.push(_)});const v=[];return g.length>0&&v.push(g),y.length>0&&v.push(y),console.log("groupByStrokeType - result:",v),v},[]);return C.useEffect(()=>{if(e){console.log("useDataParsing - drawing object:",e),console.log("useDataParsing - drawing.answers:",e.answers),console.log("useDataParsing - drawing.answers type:",typeof e.answers),console.log("useDataParsing - drawing.answers length:",e.answers?.length);const p=a(e);console.log("useDataParsing - parsed answers:",p),console.log("useDataParsing - parsed answers type:",typeof p),console.log("useDataParsing - parsed answers length:",p?.length);const g=i(p);console.log("useDataParsing - processed questions:",g),console.log("useDataParsing - processed questions length:",g?.length),g.length>0&&(console.log("useDataParsing - first question drawingData:",g[0]?.drawingData),console.log("useDataParsing - first question drawingData length:",g[0]?.drawingData?.length)),r(g),s(0)}},[e,a,i]),{questionsData:t,setQuestionsData:r,currentQuestionIndex:n,setCurrentQuestionIndex:s,parseDrawingData:a,processQuestions:i}},fN={MIN:.25,INITIAL:1},Fz=(e,t)=>{const[r,n]=C.useState(!1),[s,a]=C.useState(null),i=C.useCallback(()=>{document.fullscreenElement||(a({zoom:e.zoom,position:{...e.position}}),document.documentElement.requestFullscreen().then(()=>{n(!0),t(c=>({...c,zoom:fN.MIN,position:{x:0,y:0},isFullscreen:!0}))}).catch(c=>{console.error("Error entering fullscreen:",c)}))},[e.zoom,e.position,t]),l=C.useCallback(()=>{document.fullscreenElement&&document.exitFullscreen().then(()=>{n(!1),s?(t(c=>({...c,zoom:s.zoom,position:s.position,isFullscreen:!1})),a(null)):t(c=>({...c,zoom:fN.INITIAL,position:{x:0,y:0},isFullscreen:!1}))}).catch(c=>{console.error("Error exiting fullscreen:",c)})},[s,t]);return{isFullscreen:r,enterFullscreen:i,exitFullscreen:l}},Xj=C.forwardRef(({drawingData:e,textBoxes:t=[],drawingState:r,canvasSize:n,zoom:s,position:a,onTouchStart:i,onTouchMove:l,onTouchEnd:c,mousePosition:d,isMouseOverCanvas:f,isEraserDrawing:p},g)=>{const y=C.useRef(null),[v,_]=C.useState(.25),[b,E]=C.useState(null),[k,w]=C.useState({x:0,y:0}),[N,A]=C.useState(!1),P=C.useCallback(({x:H,y:K,size:B,visible:z,isDrawing:Q})=>!z||!H||!K?null:o.jsx(ju,{x:H,y:K,radius:B/2,stroke:nN.CURSOR_COLOR,strokeWidth:2,dash:[5,5],opacity:Q?.8:nN.CURSOR_OPACITY,listening:!1,zIndex:1e3}),[]),R=C.useCallback(H=>{if(r.currentTool===Pd.ERASER){const K=H.target.getStage(),B=Rh(H,K);w(B)}},[r.currentTool]),T=C.useCallback(()=>{r.currentTool===Pd.ERASER&&A(!0)},[r.currentTool]),D=C.useCallback(()=>{A(!1)},[]);C.useEffect(()=>{const H=g.current;if(H)return H.on("mousemove",R),H.on("mouseenter",T),H.on("mouseleave",D),()=>{H.off("mousemove",R),H.off("mouseenter",T),H.off("mouseleave",D)}},[R,T,D,g]),C.useEffect(()=>{const H=n.width??n.WIDTH,K=n.height??n.HEIGHT,B=()=>{const z=y.current;if(!z)return;const Q=z.clientWidth||1,Y=z.clientHeight||1,te=Math.abs(r.rotation%180)===90,ee=te?K:H,ae=te?H:K,ge=Math.min(Q/(ee||1),Y/(ae||1));_(Math.min(ge,1))};return B(),window.addEventListener("resize",B),()=>window.removeEventListener("resize",B)},[n.width,n.height,n.WIDTH,n.HEIGHT,r.rotation]);const I=C.useMemo(()=>{const H=y.current;if(!H||!b)return 0;const K=H.clientWidth||1,B=H.clientHeight||1,z=Math.min(K/Math.max(b.width,1),B/Math.max(b.height,1));return Math.min(z,Vj.MAX)},[b]),V=C.useMemo(()=>Math.max(s,v||1),[s,v]),X=C.useMemo(()=>{const H=n.width??n.WIDTH,K=n.height??n.HEIGHT;if(!y.current)return{x:0,y:0};const B=y.current.clientWidth||1,z=y.current.clientHeight||1,Q=(B-H*V)/2,Y=(z-K*V)/2;return s<=v?{x:Q,y:Y}:{x:a.x!==void 0?a.x:Q,y:a.y!==void 0?a.y:Y}},[a,s,v,V,n.width,n.height,b,I]);C.useEffect(()=>{if(!Array.isArray(e)||e.length===0){E(null);return}let H=1/0,K=1/0,B=-1/0,z=-1/0;const Q=(ae,ge)=>{Number.isFinite(ae)&&Number.isFinite(ge)&&(ae<H&&(H=ae),ge<K&&(K=ge),ae>B&&(B=ae),ge>z&&(z=ge))};if(e.forEach(ae=>{if(Array.isArray(ae))ae.forEach(ge=>Q(ge.x,ge.y));else if(ae&&typeof ae=="object"){if(ae.type==="line")Q(ae.startX,ae.startY),Q(ae.endX,ae.endY);else if(ae.type==="rectangle")Q(ae.startX,ae.startY),Q(ae.endX,ae.endY);else if(ae.type==="circle"){const ge=Math.sqrt(Math.pow(ae.endX-ae.startX,2)+Math.pow(ae.endY-ae.startY,2))/2,_e=(ae.startX+ae.endX)/2,Me=(ae.startY+ae.endY)/2;Q(_e-ge,Me-ge),Q(_e+ge,Me+ge)}}}),!Number.isFinite(H)||!Number.isFinite(K)||!Number.isFinite(B)||!Number.isFinite(z)){E(null);return}const Y=16,te=Math.max(1,B-H+Y*2),ee=Math.max(1,z-K+Y*2);E({minX:H-Y,minY:K-Y,width:te,height:ee})},[e]),C.useEffect(()=>{console.log("CanvasViewer - drawingData:",e),console.log("CanvasViewer - drawingData length:",e?.length),console.log("CanvasViewer - textBoxes:",t),console.log("CanvasViewer - textBoxes length:",t?.length),e&&e.length>0&&console.log("CanvasViewer - first item:",e[0]),t&&t.length>0&&console.log("CanvasViewer - first textBox:",t[0])},[e,t]),C.useEffect(()=>{const H=n.width??n.WIDTH,K=n.height??n.HEIGHT;console.log("CanvasViewer - canvas dimensions:",{width:H,height:K}),console.log("CanvasViewer - zoom:",s,"fitZoom:",v,"displayScale:",V),console.log("CanvasViewer - stagePosition:",X)},[n,s,v,V,X]);const Z=(H,K)=>{if(console.log(`CanvasViewer - rendering element ${K}:`,H),Array.isArray(H))return console.log(`CanvasViewer - rendering line with ${H.length} points`),o.jsx(xa,{points:H.flatMap(B=>[B.x,B.y]),stroke:H[0]?.color||"#000000",strokeWidth:H[0]?.thickness||2,tension:.5,lineCap:"round",lineJoin:"round"},K);if(H.type==="line")return o.jsx(xa,{points:[H.startX,H.startY,H.endX,H.endY],stroke:H.color,strokeWidth:H.thickness,lineCap:"round"},K);if(H.type==="rectangle"){const B=Math.abs(H.endX-H.startX),z=Math.abs(H.endY-H.startY),Q=Math.min(H.startX,H.endX),Y=Math.min(H.startY,H.endY);return o.jsx(ra,{x:Q,y:Y,width:B,height:z,stroke:H.color,strokeWidth:H.thickness,fill:"transparent"},K)}else if(H.type==="circle"){const B=Math.sqrt(Math.pow(H.endX-H.startX,2)+Math.pow(H.endY-H.startY,2))/2,z=(H.startX+H.endX)/2,Q=(H.startY+H.endY)/2;return o.jsx(ju,{x:z,y:Q,radius:B,stroke:H.color,strokeWidth:H.thickness,fill:"transparent"},K)}return null},ie=()=>{if(!r.isDrawing)return null;if(r.currentTool===Pd.PENCIL&&r.currentLine.length>0)return o.jsx(xa,{points:r.currentLine.flatMap(H=>[H.x,H.y]),stroke:r.currentColor,strokeWidth:r.currentThickness,tension:.5,lineCap:"round",lineJoin:"round"});if(r.currentShape){const{type:H,startX:K,startY:B,endX:z,endY:Q,color:Y,thickness:te}=r.currentShape;if(H===Pd.LINE)return o.jsx(xa,{points:[K,B,z,Q],stroke:Y,strokeWidth:te,lineCap:"round"});if(H===Pd.RECTANGLE){const ee=Math.abs(z-K),ae=Math.abs(Q-B),ge=Math.min(K,z),_e=Math.min(B,Q);return o.jsx(ra,{x:ge,y:_e,width:ee,height:ae,stroke:Y,strokeWidth:te,fill:"transparent"})}else if(H===Pd.CIRCLE){const ee=Math.sqrt(Math.pow(z-K,2)+Math.pow(Q-B,2))/2,ae=(K+z)/2,ge=(B+Q)/2;return o.jsx(ju,{x:ae,y:ge,radius:ee,stroke:Y,strokeWidth:te,fill:"transparent"})}}return null},q=r.isFullscreen?{position:"fixed",inset:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f3f4f6",zIndex:60}:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent"},ne={transform:`rotate(${r.rotation}deg)`,transformOrigin:"center center"},M=C.useCallback(H=>{H.preventDefault(),H.stopPropagation()},[]),W=C.useCallback(H=>{H.preventDefault(),H.stopPropagation()},[]),L=C.useCallback(H=>{H.preventDefault(),H.stopPropagation()},[]);return o.jsx("div",{style:{...q,touchAction:"none",WebkitTouchCallout:"none"},ref:y,className:"select-none",onTouchStart:M,onTouchMove:W,onTouchEnd:L,children:o.jsx("div",{style:{...ne,touchAction:"none",WebkitTouchCallout:"none"},className:"select-none",onTouchStart:M,onTouchMove:W,onTouchEnd:L,children:o.jsx(Qd,{ref:g,width:Math.max((n.width??n.WIDTH)||0,1536),height:Math.max((n.height??n.HEIGHT)||0,2048),scaleX:V,scaleY:V,x:X.x,y:X.y,onTouchStart:i,onTouchMove:l,onTouchEnd:c,children:o.jsxs(Yd,{children:[o.jsx(ra,{x:0,y:0,width:Math.max((n.width??n.WIDTH)||0,1536),height:Math.max((n.height??n.HEIGHT)||0,2048),fill:"white"}),e.map((H,K)=>(console.log(`CanvasViewer - mapping item ${K}:`,H),Z(H,K))),t&&t.map((H,K)=>o.jsx(ra,{x:H.x,y:H.y,width:H.width,height:H.height,fill:"#ffffff",stroke:"#d1d5db",strokeWidth:1,cornerRadius:6,shadowColor:"black",shadowBlur:2,shadowOffset:{x:1,y:1}},`textbox-${K}`)),t&&t.map((H,K)=>o.jsx(kl,{x:H.x+8,y:H.y+8,width:H.width-16,height:H.height-16,text:H.text,fontSize:H.fontSize||14,fill:H.color||"#000000",wrap:"word",align:"left",verticalAlign:"top"},`text-${K}`)),ie(),r.currentTool===Pd.ERASER&&o.jsx(P,{x:k.x,y:k.y,size:r.eraserSize,visible:N,isDrawing:p})]})})})})});Xj.displayName="CanvasViewer";function Pz({containerRef:e,canvasSize:t,rotation:r=0}){const[n,s]=C.useState(1),[a,i]=C.useState({x:0,y:0}),l=C.useRef({width:1,height:1}),c=C.useRef(.01),d=C.useRef(0),f=C.useRef(!1),p=C.useCallback(()=>{const N=t?.width??t?.WIDTH??0,A=t?.height??t?.HEIGHT??0,P=Math.abs(r%180)===90;return{width:P?A:N,height:P?N:A}},[t,r]),g=C.useCallback(()=>{const N=e?.current;if(!N)return{width:1,height:1};const A=N.clientWidth||1,P=N.clientHeight||1;return l.current={width:A,height:P},{width:A,height:P}},[e]),y=C.useCallback(()=>{const{width:N,height:A}=l.current,{width:P,height:R}=p(),T=N/Math.max(P,1),D=A/Math.max(R,1);return Math.min(T,D,1)*.98},[p]),v=C.useCallback(N=>{const{width:A,height:P}=l.current,{width:R,height:T}=p(),D=Math.max(c.current,Math.min(N,1.5));let I=(A-R*D)/2,V=(P-T*D)/2;const X=A-R*D,Z=P-T*D;I=Math.min(Math.max(0,I),Math.max(0,X)),V=Math.min(Math.max(0,V),Math.max(0,Z));try{console.log("[Camera] centerAtScale",{targetScale:N,clampedScale:D,container:{containerW:A,containerH:P},canvas:{canvasW:R,canvasH:T},translate:{x:I,y:V},rotation:r})}catch{}i({x:I,y:V}),s(D)},[p]),_=C.useCallback(()=>{const{width:N,height:A}=g(),{width:P,height:R}=p(),T=y();let D=(N-P*T)/2,I=(A-R*T)/2;const V=N-P*T,X=A-R*T;D=Math.min(Math.max(0,D),Math.max(0,V)),I=Math.min(Math.max(0,I),Math.max(0,X));try{console.log("[Camera] fitCanvas",{scale:T,container:{containerW:N,containerH:A},canvas:{canvasW:P,canvasH:R},translate:{x:D,y:I},rotation:r})}catch{}s(T),i({x:D,y:I}),c.current=T,f.current=!1},[p,g,y]),b=C.useCallback(()=>{const{width:N,height:A}=g(),{width:P,height:R}=p(),T=(N-P)/2,D=(A-R)/2;s(1),i({x:T,y:D})},[p,g]),E=C.useCallback((N,A)=>{const{width:P,height:R}=l.current,{width:T,height:D}=p(),I=Math.max(c.current,Math.min(N,1.5));if(A&&Number.isFinite(A.x)&&Number.isFinite(A.y)){const V={x:(A.x-a.x)/n,y:(A.y-a.y)/n},X=A.x-V.x*I,Z=A.y-V.y*I;try{console.log("[Camera] zoomTo(pointer) ->",{from:n,to:I})}catch{}s(I),i({x:X,y:Z}),d.current=Date.now()+400,f.current=!0}else{let V=(P-T*I)/2,X=(R-D*I)/2;const Z=P-T*I,ie=R-D*I;V=Math.min(Math.max(0,V),Math.max(0,Z)),X=Math.min(Math.max(0,X),Math.max(0,ie));try{console.log("[Camera] zoomTo(center) ->",{from:n,to:I})}catch{}s(I),i({x:V,y:X}),d.current=Date.now()+400,f.current=!0}},[p,n,a]),k=C.useCallback((N,A)=>{const P=n*N,{width:R,height:T}=l.current,D={x:R/2,y:T/2};E(P,A||D)},[n,E]),w=C.useCallback((N,A)=>{i(P=>({x:P.x+N,y:P.y+A})),d.current=Date.now()+200,f.current=!0},[]);return C.useEffect(()=>{const N=e?.current;if(!N)return;const A=new ResizeObserver(()=>{g();const P=y();if(c.current=P,!(Date.now()<d.current)&&!f.current){try{console.log("[Camera] resize centerAtScale",{scale:n})}catch{}v(n)}});return A.observe(N),g(),()=>A.disconnect()},[e,g,y,v,n]),C.useEffect(()=>{f.current=!1,c.current=y(),v(n)},[r,t?.width,t?.height,t?.WIDTH,t?.HEIGHT,y,v,n]),C.useMemo(()=>({scale:n,translate:a,setScale:s,setTranslate:i,centerAtScale:v,fitCanvas:_,oneToOne:b,zoomTo:E,zoomByFactor:k,panBy:w}),[n,a,v,_,b,E,k,w])}const ym=new Map,Yj=C.forwardRef(({drawingData:e,textBoxes:t=[],canvasSize:r,rotation:n=0,onScaleChange:s,persistKey:a="viewer"},i)=>{const l=C.useRef(null),c=C.useRef(null),d=Pz({containerRef:l,canvasSize:r,rotation:n}),[f,p]=C.useState({width:1,height:1}),g=C.useRef(null),y=C.useRef(null),[v,_]=C.useState(null);C.useEffect(()=>{console.log("[ViewerCanvas] drawingData received:",e),console.log("[ViewerCanvas] drawingData length:",e?.length),e&&e.length>0&&console.log("[ViewerCanvas] First drawing element:",e[0]),console.log("[ViewerCanvas] textBoxes:",t),console.log("[ViewerCanvas] textBoxes length:",t?.length)},[e]),C.useEffect(()=>{typeof s=="function"&&s(d.scale);try{console.log("[ViewerCanvas] scale changed",{scale:d.scale})}catch{}if(a){const q=ym.get(a)||{};ym.set(a,{...q,scale:d.scale})}},[d.scale,s]),C.useEffect(()=>{if(a){const q=ym.get(a)||{};ym.set(a,{...q,translate:{x:d.translate.x,y:d.translate.y}})}},[a,d.translate.x,d.translate.y]),C.useImperativeHandle(i,()=>({zoomIn:q=>d.zoomByFactor(1.1,q),zoomOut:q=>d.zoomByFactor(1/1.1,q),fitCanvas:()=>d.fitCanvas(),oneToOne:()=>d.oneToOne(),getScale:()=>d.scale,getStage:()=>c.current,getPointerPosition:()=>c.current?.getPointerPosition?.(),exportPNGFullCanvas:()=>{const q=c.current;if(!q)return null;const ne=r?.width??r?.WIDTH??1536,M=r?.height??r?.HEIGHT??2048,W={scaleX:q.scaleX(),scaleY:q.scaleY(),x:q.x(),y:q.y(),width:q.width(),height:q.height()},L=g.current,H=y.current,K=L?{x:L.x(),y:L.y(),scaleX:L.scaleX(),scaleY:L.scaleY()}:null,B=H?{x:H.x(),y:H.y(),rotation:H.rotation()}:null;try{return q.scale({x:1,y:1}),q.position({x:0,y:0}),q.size({width:ne,height:M}),L&&(L.position({x:0,y:0}),L.scale({x:1,y:1})),H&&(H.position({x:0,y:0}),H.rotation(0)),q.batchDraw(),q.toDataURL({mimeType:"image/png",quality:1,pixelRatio:1,x:0,y:0,width:ne,height:M})}finally{H&&B&&(H.position({x:B.x,y:B.y}),H.rotation(B.rotation)),L&&K&&(L.position({x:K.x,y:K.y}),L.scale({x:K.scaleX,y:K.scaleY})),q.scale({x:W.scaleX,y:W.scaleY}),q.position({x:W.x,y:W.y}),q.size({width:W.width,height:W.height}),q.batchDraw()}}}),[d]),C.useEffect(()=>{const q=l.current;if(!q)return;const ne=()=>{p({width:q.clientWidth||1,height:q.clientHeight||1})};ne();const M=new ResizeObserver(ne);return M.observe(q),()=>M.disconnect()},[]),C.useEffect(()=>{if(!Array.isArray(e)||e.length===0){_(null);return}let q=1/0,ne=1/0,M=-1/0,W=-1/0;const L=(z,Q)=>{Number.isFinite(z)&&Number.isFinite(Q)&&(z<q&&(q=z),Q<ne&&(ne=Q),z>M&&(M=z),Q>W&&(W=Q))};if(e.forEach(z=>{if(Array.isArray(z))z.forEach(Q=>L(Q.x,Q.y));else if(z&&typeof z=="object"){if(z.type==="line")L(z.startX,z.startY),L(z.endX,z.endY);else if(z.type==="rectangle")L(z.startX,z.startY),L(z.endX,z.endY);else if(z.type==="circle"){const Q=Math.hypot(z.endX-z.startX,z.endY-z.startY)/2,Y=(z.startX+z.endX)/2,te=(z.startY+z.endY)/2;L(Y-Q,te-Q),L(Y+Q,te+Q)}}}),!Number.isFinite(q)||!Number.isFinite(ne)||!Number.isFinite(M)||!Number.isFinite(W)){_(null);return}const H=16,K=Math.max(1,M-q+H*2),B=Math.max(1,W-ne+H*2);_({minX:q-H,minY:ne-H,width:K,height:B,centerX:q-H+K/2,centerY:ne-H+B/2})},[e]);const b=C.useMemo(()=>{if(!v)return{scale:1,x:0,y:0};const q=r?.width??r?.WIDTH??1536,ne=r?.height??r?.HEIGHT??2048,M=Math.min(q/Math.max(1,v.width),ne/Math.max(1,v.height),1),W=v.width*M,L=v.height*M,H=(q-W)/2,K=(ne-L)/2,B=H-v.minX*M,z=K-v.minY*M;return{scale:M,x:B,y:z}},[v,r?.width,r?.height,r?.WIDTH,r?.HEIGHT]),E=C.useRef(!1);C.useEffect(()=>{if(E.current)return;const q=a?ym.get(a):null;q&&Number.isFinite(q.scale)&&q.translate&&Number.isFinite(q.translate.x)&&Number.isFinite(q.translate.y)?(d.setScale(q.scale),d.setTranslate(q.translate)):d.fitCanvas(),E.current=!0},[a,d]),C.useEffect(()=>{try{console.log("[ViewerCanvas] rotation changed",{rotation:n,scale:d.scale,translate:d.translate})}catch{}d.fitCanvas()},[n]),C.useEffect(()=>{d.centerAtScale(d.scale)},[n]);const k=q=>{q.evt.preventDefault();const ne=c.current;if(!ne)return;const M=ne.getPointerPosition(),W=Math.pow(1.0015,-q.evt.deltaY);d.zoomByFactor(W,M)},w=C.useRef(!1),N=C.useRef({x:0,y:0}),A=()=>{const q=l.current;if(!q)return 1;const ne=q.clientWidth||1,M=q.clientHeight||1,W=r?.width??r?.WIDTH??1,L=r?.height??r?.HEIGHT??1,H=Math.abs(n%180)===90,K=H?L:W,B=H?W:L,z=Math.min(ne/K,M/B);return Math.min(z,1)},P=q=>{const ne=A();d.scale<=ne||(w.current=!0,N.current={x:q.evt.clientX,y:q.evt.clientY})},R=q=>{if(!w.current)return;const ne=q.evt.clientX-N.current.x,M=q.evt.clientY-N.current.y;N.current={x:q.evt.clientX,y:q.evt.clientY},d.panBy(ne,M)},T=()=>{w.current=!1},D=1536,I=2048,V=(q,ne)=>{if(console.log(`[ViewerCanvas] Rendering drawing element ${ne}:`,q),Array.isArray(q))return console.log(`[ViewerCanvas] Array item with ${q.length} points:`,q.slice(0,3)),o.jsx(xa,{points:q.flatMap(M=>[M.x,M.y]),stroke:q[0]?.color||"#000000",strokeWidth:q[0]?.thickness||2,tension:.5,lineCap:"round",lineJoin:"round"},ne);if(q?.type==="line")return o.jsx(xa,{points:[q.startX,q.startY,q.endX,q.endY],stroke:q.color,strokeWidth:q.thickness,lineCap:"round"},ne);if(q?.type==="rectangle"){const M=Math.abs(q.endX-q.startX),W=Math.abs(q.endY-q.startY),L=Math.min(q.startX,q.endX),H=Math.min(q.startY,q.endY);return o.jsx(ra,{x:L,y:H,width:M,height:W,stroke:q.color,strokeWidth:q.thickness,fill:"transparent"},ne)}else if(q?.type==="circle"){const M=Math.sqrt(Math.pow(q.endX-q.startX,2)+Math.pow(q.endY-q.startY,2))/2,W=(q.startX+q.endX)/2,L=(q.startY+q.endY)/2;return o.jsx(ju,{x:W,y:L,radius:M,stroke:q.color,strokeWidth:q.thickness,fill:"transparent"},ne)}return null},X=C.useCallback(q=>{q.preventDefault(),q.stopPropagation()},[]),Z=C.useCallback(q=>{q.preventDefault(),q.stopPropagation()},[]),ie=C.useCallback(q=>{q.preventDefault(),q.stopPropagation()},[]);return o.jsx("div",{ref:l,style:{width:"100%",height:"100%",display:"block",backgroundColor:"transparent",touchAction:"none",WebkitTouchCallout:"none"},className:"select-none",onTouchStart:X,onTouchMove:Z,onTouchEnd:ie,children:o.jsx(Qd,{ref:c,width:f.width,height:f.height,onWheel:k,onMouseDown:P,onMouseMove:R,onMouseUp:T,onMouseLeave:T,children:o.jsx(Yd,{children:o.jsx($o,{ref:g,x:d.translate.x,y:d.translate.y,scaleX:d.scale,scaleY:d.scale,children:(()=>{const q=(n%360+360)%360;let ne=0,M=0;q===90?ne=I:q===180?(ne=D,M=I):q===270&&(M=D);try{console.log("[ViewerCanvas] rotatedGroup offset",{rotation:n,norm:q,tx:ne,ty:M,canvasW:D,canvasH:I})}catch{}return o.jsxs($o,{ref:y,x:ne,y:M,rotation:n,children:[o.jsx(ra,{x:0,y:0,width:D,height:I,fill:"white"}),o.jsxs($o,{x:b.x,y:b.y,scaleX:b.scale,scaleY:b.scale,children:[Array.isArray(e)?(console.log("[ViewerCanvas] Rendering",e.length,"drawing elements"),e.map((W,L)=>V(W,L))):null,Array.isArray(t)&&t.map((W,L)=>o.jsxs($o,{x:W.x,y:W.y,listening:!1,children:[o.jsx(ra,{width:W.width,height:W.height,fill:"#ffffff",stroke:"#d1d5db",strokeWidth:1,cornerRadius:6,shadowColor:"black",shadowBlur:2,shadowOffset:{x:1,y:1}}),o.jsx(kl,{text:W.text,x:8,y:8,width:Math.max(0,(W.width||0)-16),height:Math.max(0,(W.height||0)-16),fontSize:W.fontSize||14,fill:W.color||"#000000",wrap:"word",align:"left",verticalAlign:"top"})]},`tb-${L}`))]})]})})()})})})})});Yj.displayName="ViewerCanvas";const Rz=({zoom:e,onZoomIn:t,onZoomOut:r,onRotate:n,onDownload:s,onFullscreen:a,isFullscreen:i})=>o.jsxs("div",{className:"absolute top-4 right-4 flex flex-col space-y-2 items-center justify-center",children:[o.jsx(nt,{onClick:t,variant:"secondary",size:"icon",className:"w-10 h-10",title:"Zoom In",children:o.jsx(dz,{className:"w-4 h-4 mx-auto my-auto"})}),o.jsx(nt,{onClick:r,variant:"secondary",size:"icon",className:"w-10 h-10",title:"Zoom Out",children:o.jsx(hz,{className:"w-4 h-4 mx-auto my-auto"})}),o.jsx(nt,{onClick:n,variant:"secondary",size:"icon",className:"w-10 h-10",title:"Rotate",children:o.jsx(lz,{className:"w-4 h-4 mx-auto my-auto"})}),o.jsx(nt,{onClick:s,variant:"secondary",size:"icon",className:"w-10 h-10",title:"Download",children:o.jsx(sz,{className:"w-4 h-4 mx-auto my-auto"})}),o.jsx(nt,{onClick:a,variant:"secondary",size:"icon",className:"w-10 h-10",title:i?"Exit Fullscreen":"Enter Fullscreen",children:i?o.jsx(Gj,{className:"w-4 h-4 mx-auto my-auto"}):o.jsx(iz,{className:"w-4 h-4 mx-auto my-auto"})})]}),Dz=({currentQuestion:e,totalQuestions:t,onPrevious:r,onNext:n,drawingDataLength:s})=>t<=1?null:o.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(nt,{onClick:r,disabled:e===0,variant:"outline",size:"sm",children:"Previous"}),o.jsxs("span",{className:"text-sm text-gray-600",children:["Question ",e+1," of ",t]}),o.jsx(nt,{onClick:n,disabled:e===t-1,variant:"outline",size:"sm",children:"Next"})]}),o.jsxs("div",{className:"text-sm text-gray-500",children:[s," lines"]})]})}),Qj=({drawing:e,isOpen:t,onClose:r,onScoreChange:n,onMaxScoreChange:s,isTeacherView:a=!1})=>{const{drawingState:i,setDrawingState:l,drawingData:c,setDrawingData:d,textBoxes:f,setTextBoxes:p,saveToHistoryState:g,undo:y,redo:v,canUndoState:_,canRedoState:b}=wz(),{questionsData:E,currentQuestionIndex:k,setCurrentQuestionIndex:w}=jz(e),{zoom:N,position:A,handleZoomIn:P,handleZoomOut:R}=Az(Vj,Io),{isFullscreen:T,enterFullscreen:D,exitFullscreen:I}=Fz(i,l),{handleTouchStart:V,handleTouchMove:X,handleTouchEnd:Z}=Nz(i,l,c,d,g,y,v,_,b),ie=C.useRef(null),q=C.useRef(null),[ne,M]=C.useState(1),[W,L]=C.useState(""),[H,K]=C.useState("");C.useEffect(()=>{if(console.log("DrawingModal - questionsData:",E),console.log("DrawingModal - currentQuestionIndex:",k),E.length>0){const ae=E[k]?.drawingData||[],ge=E[k]?.textBoxes||[];console.log("DrawingModal - setting drawingData:",ae),console.log("DrawingModal - setting textBoxes:",ge),d(ae),p(ge)}},[E,k,d,p]),C.useEffect(()=>{t&&e&&(L(e.score?.toString()||""),K(e.max_score?.toString()||"100"))},[t,e]);const B=()=>{k>0&&w(k-1)},z=()=>{k<E.length-1&&w(k+1)},Q=()=>{_&&y()},Y=()=>{b&&v()};C.useEffect(()=>{const ae=ge=>{(ge.ctrlKey||ge.metaKey)&&(ge.key==="z"&&!ge.shiftKey?(ge.preventDefault(),Q()):(ge.key==="y"||ge.key==="z"&&ge.shiftKey)&&(ge.preventDefault(),Y()))};return document.addEventListener("keydown",ae),()=>document.removeEventListener("keydown",ae)},[Q,Y]);const te=()=>{l(ae=>({...ae,rotation:(ae.rotation+90)%360}))},ee=()=>{if(a&&q.current){const Me=q.current.exportPNGFullCanvas();if(!Me)return;const ue=document.createElement("a");ue.href=Me,ue.download=`drawing-${e?.name||"student"}-${new Date().toISOString().split("T")[0]}.png`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue);return}const ae=ie.current;if(!ae)return;const ge=ae.toDataURL({mimeType:"image/png",quality:1,pixelRatio:1,x:0,y:0,width:Io.WIDTH,height:Io.HEIGHT}),_e=document.createElement("a");_e.href=ge,_e.download=`drawing-${e?.name||"student"}-${new Date().toISOString().split("T")[0]}.png`,document.body.appendChild(_e),_e.click(),document.body.removeChild(_e)};return!t||!e?null:o.jsx(_i,{children:o.jsx(et.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,children:o.jsxs(et.div,{className:"bg-white rounded-lg shadow-xl max-w-4xl h-[90vh] w-full mx-4 flex flex-col select-none",style:{touchAction:"none",WebkitTouchCallout:"none"},initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:ae=>ae.stopPropagation(),onTouchStart:ae=>ae.preventDefault(),onTouchMove:ae=>ae.preventDefault(),onTouchEnd:ae=>ae.preventDefault(),children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Drawing Submission"}),o.jsxs("p",{className:"text-sm text-gray-600",children:[e.name," ",e.surname," - ",e.test_name]})]}),o.jsx(nt,{onClick:r,variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",children:o.jsx(Gj,{className:"w-5 h-5"})})]}),E.length>1&&o.jsx(Dz,{currentQuestion:k,totalQuestions:E.length,onPrevious:B,onNext:z,drawingDataLength:E[k]?.drawingData?.length||0}),o.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[o.jsxs("div",{className:"flex-1 min-h-0 relative overflow-hidden bg-gray-100 p-0 sm:p-4 select-none",style:{touchAction:"none",WebkitTouchCallout:"none"},children:[a?o.jsx(Yj,{ref:q,drawingData:c,textBoxes:f,canvasSize:{width:Io.WIDTH,height:Io.HEIGHT,WIDTH:Io.WIDTH,HEIGHT:Io.HEIGHT},rotation:i.rotation,onScaleChange:M}):o.jsx(Xj,{ref:ie,drawingData:c,textBoxes:f,drawingState:i,canvasSize:{width:Io.WIDTH,height:Io.HEIGHT,WIDTH:Io.WIDTH,HEIGHT:Io.HEIGHT},zoom:N,position:A,onTouchStart:V,onTouchMove:X,onTouchEnd:Z,mousePosition:{x:0,y:0},isMouseOverCanvas:!1,isEraserDrawing:!1}),o.jsx(Rz,{zoom:a?ne:N,onZoomIn:()=>{if(a&&q.current){try{console.log("[ZoomButton] ZoomIn click (teacher)",{before:q.current.getScale?.()})}catch{}q.current.zoomIn(void 0),setTimeout(()=>{try{console.log("[ZoomButton] ZoomIn after",{after:q.current.getScale?.()})}catch{}},0)}else P()},onZoomOut:()=>{if(a&&q.current){try{console.log("[ZoomButton] ZoomOut click (teacher)",{before:q.current.getScale?.()})}catch{}q.current.zoomOut(void 0),setTimeout(()=>{try{console.log("[ZoomButton] ZoomOut after",{after:q.current.getScale?.()})}catch{}},0)}else R()},onRotate:te,onDownload:ee,onFullscreen:T?I:D,isFullscreen:T}),o.jsxs("div",{className:"absolute bottom-4 left-4 bg-gray-800 bg-opacity-70 text-white px-3 py-1 rounded-full text-sm",children:[Math.round((a?ne:N)*100),"%"]})]}),!1]})]})})})},Jj=({testType:e,testId:t,studentAnswers:r,onBackToCabinet:n,compact:s=!1,showAll:a=!1,onToggleShowAll:i,maxInitial:l=3})=>{const c=Ei(),{user:d,isAuthenticated:f}=Bn(),{testResults:p,loadTestResults:g}=zp(),[y,v]=C.useState(!0),[_,b]=C.useState(""),[E,k]=C.useState([]),[w,N]=C.useState([]),[A,P]=C.useState(null),[R,T]=C.useState([]),[D,I]=C.useState(0),[V,X]=C.useState(0),[Z,ie]=C.useState(!1),[q,ne]=C.useState(null);C.useEffect(()=>{M()},[e,t]),C.useEffect(()=>{!e&&!t&&(p&&p.results?(console.log("🎓 Using cached test results from TestContext"),N(p.results),v(!1)):L())},[e,t,p]);const M=C.useCallback(async()=>{console.log("🎓 Initializing Student Results...");try{if(v(!0),b(""),!f||!d){console.log("🎓 User not authenticated"),b("User not authenticated");return}if(d.role!==si.STUDENT){console.error("🎓 Invalid user role for student results:",d.role),b("Access denied. Student role required.");return}console.log("🎓 Loading test results..."),await g(d?.student_id||d?.id||""),e&&t&&r&&(console.log("🎓 Loading specific test results..."),await W(e,t,r)),console.log("🎓 Student Results initialization complete!")}catch(te){console.error("🎓 Error initializing student results:",te),b("Failed to initialize student results")}finally{v(!1)}},[f,d,e,t,r,g]),W=C.useCallback(async(te,ee,ae)=>{console.log("🎓 Loading specific test results:",te,ee);try{const ge=await rn.getTestInfo(te,ee);console.log("🎓 Test info loaded:",ge),P(ge);const _e=await rn.getTestQuestions(te,ee);console.log("🎓 Test questions loaded:",_e),T(_e);const Me=Du(_e,ae,te).score,ue=_e.length>0?Math.round(Me/_e.length*100):0;I(Me),X(ue),console.log("🎓 Test results calculated:",{score:Me,percentage:ue})}catch(ge){throw console.error("🎓 Error loading specific test results:",ge),ge}},[]),L=C.useCallback(async(te=0)=>{console.log("🎓 Loading all student results using existing test results API...",te>0?`(retry ${te})`:"");try{if(!(d?.student_id||d?.sub))throw new Error("Student ID not found");const ae=await rn.getStudentTestResults();if(ae.success){console.log("🎓 All student results loaded:",ae.results.length,"results");const ge=ae.results.map(_e=>({..._e,caught_cheating:_e.caught_cheating||!1,visibility_change_times:_e.visibility_change_times||0}));N(ge),ne(new Date),ae.results.length===0&&te===0&&(console.log("🎓 No results found, retrying in 2 seconds..."),setTimeout(()=>{L(1)},2e3))}else throw new Error(ae.error||"Failed to load student results")}catch(ee){console.error("🎓 Error loading all student results:",ee),b(ee.message)}},[d]),H=C.useCallback(te=>({"Listening and Speaking":"L&S","Reading and Writing":"R&W","English for Career":"Eng for Career","Science Fundamental":"Science F","Science Supplementary":"Science S","Math Fundamental":"Math F","Math Supplementary":"Math S","English for Communication":"Eng for Comm"})[te]||te,[]),K=C.useCallback(te=>{if(!te||te.length===0)return o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No results available"})});const ee=a?te:te.slice(0,l);return o.jsxs("div",{className:"overflow-x-auto",children:[o.jsxs("table",{className:"w-full divide-y divide-gray-200",children:[o.jsx("thead",{className:"bg-gray-50",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),o.jsx("th",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),o.jsx("th",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Test Name"}),o.jsx("th",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Result"}),o.jsx("th",{className:"hidden sm:table-cell px-2 sm:px-4 lg:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),o.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ee.map((ae,ge)=>o.jsxs("tr",{className:"hover:bg-gray-50",children:[o.jsx("td",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-4 whitespace-nowrap text-xs font-medium text-gray-900",children:o.jsx("span",{className:"bg-blue-100 text-blue-800 px-0.5 sm:px-2 py-0.5 rounded text-xs",children:H(ae.subject)})}),o.jsx("td",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-4 whitespace-nowrap text-xs text-gray-500 truncate max-w-12 sm:max-w-none",children:ae.teacher_name}),o.jsx("td",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-4 whitespace-nowrap text-xs text-gray-500 truncate max-w-16 sm:max-w-none",children:ae.test_name}),o.jsx("td",{className:"px-1 sm:px-4 lg:px-6 py-1 sm:py-4 whitespace-nowrap text-xs text-gray-500",children:o.jsx("div",{className:"flex flex-col items-center space-y-1",children:ae.test_type==="drawing"?ae.score!==null?o.jsxs("span",{className:`px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold ${Math.round(ae.score/ae.max_score*100)>=80?"bg-green-100 text-green-800":Math.round(ae.score/ae.max_score*100)>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[ae.score,"/",ae.max_score," (",Math.round(ae.score/ae.max_score*100),"%)"]}):o.jsx("span",{className:"px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-800",children:"Pending Review"}):ae.test_type==="speaking"?ae.score!==null?o.jsxs("span",{className:`px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold ${Math.round(ae.score/ae.max_score*100)>=80?"bg-green-100 text-green-800":Math.round(ae.score/ae.max_score*100)>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[ae.score,"/",ae.max_score," (",Math.round(ae.score/ae.max_score*100),"%)"]}):o.jsx("span",{className:"px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-800",children:"Pending Review"}):o.jsxs("span",{className:`px-0.5 sm:px-2 py-0.5 rounded text-xs font-semibold ${Math.round(ae.score/ae.max_score*100)>=80?"bg-green-100 text-green-800":Math.round(ae.score/ae.max_score*100)>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[ae.score,"/",ae.max_score," (",Math.round(ae.score/ae.max_score*100),"%)"]})})}),o.jsx("td",{className:"hidden sm:table-cell px-2 sm:px-4 lg:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:new Date(ae.submitted_at).toLocaleDateString()})]},ge))})]}),te.length>l&&i&&o.jsx("div",{className:"text-center pt-4",children:o.jsx("button",{onClick:i,className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:a?"Show Less":`Show ${te.length-l} More`})})]})},[H,a,l,i]),B=C.useCallback((te,ee)=>{if(console.log("🔍 formatAnswer called with:",{answer:te,testType:ee,answerType:typeof te}),!te)return"No answer";switch(ee){case"true_false":const ae=typeof te=="boolean"?te:te==="true";return console.log("🔍 Boolean answer processed:",ae),ae?"True":"False";case"multiple_choice":return te.toUpperCase();case"input":return te;case"word_matching":return typeof te=="object"?Object.entries(te).map(([ge,_e])=>`${ge} → ${_e}`).join(", "):te;case"drawing":return"Drawing submitted";default:return te}},[]),z=C.useCallback(()=>!A||!R||!r?null:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:["Test Results: ",A.test_name||A.title||"Test"]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold text-blue-600",children:D}),o.jsx("p",{className:"text-sm text-gray-500",children:"Correct Answers"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold text-gray-900",children:R.length}),o.jsx("p",{className:"text-sm text-gray-500",children:"Total Questions"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:`text-3xl font-bold ${V>=80?"text-green-600":V>=60?"text-yellow-600":"text-red-600"}`,children:[V,"%"]}),o.jsx("p",{className:"text-sm text-gray-500",children:"Score"})]})]})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Questions Review"}),o.jsx("div",{className:"space-y-4",children:R.map((te,ee)=>{const ae=r[ee],ge=op(te,e),_e=c0(te,ae,e);return o.jsxs("div",{className:`border rounded-lg p-4 ${_e?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("h4",{className:"font-medium text-gray-900",children:["Question ",ee+1]}),o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${_e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:_e?"Correct":"Incorrect"})]}),o.jsx("p",{className:"text-gray-700 mb-3",children:te.question}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Your Answer:"}),o.jsx("p",{className:"text-sm text-gray-900",children:B(ae,e)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Correct Answer:"}),o.jsx("p",{className:"text-sm text-gray-900",children:B(ge,e)})]})]})]},ee)})})]})]}),[A,R,r,e,D,V,op,c0,B]),Q=C.useCallback(()=>{if(!w||w.length===0)return o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No test results available yet."})});const te={};return w.forEach(ee=>{const ae=ee.subject||"Unknown Subject";te[ae]||(te[ae]=[]),te[ae].push(ee)}),o.jsx("div",{className:"space-y-6",children:Object.entries(te).map(([ee,ae])=>o.jsxs("div",{className:"bg-white rounded-lg shadow",children:[o.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:ee})}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[o.jsx("thead",{className:"bg-gray-50",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Test Name"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Score"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),o.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ae.map((ge,_e)=>{const Me=Math.round(ge.score/ge.max_score*100),ue=Me>=80?"text-green-600":Me>=60?"text-yellow-600":"text-red-600";return o.jsxs("tr",{className:"hover:bg-gray-50",children:[o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:ge.test_name}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:ge.teacher_name||"Unknown"}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:o.jsxs("span",{className:ue,children:[ge.score,"/",ge.max_score," (",Me,"%)"]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(ge.submitted_at).toLocaleDateString()})]},_e)})})]})})]},ee))})},[w]);C.useCallback(()=>{console.log("🎓 Clearing test data and returning to cabinet..."),P(null),T([]),setStudentAnswers(null),I(0),X(0),ie(!1),n?n():c("/student")},[n,c]);const Y=C.useCallback(()=>{console.log("🎓 Navigating back to cabinet..."),n?n():c("/student")},[n,c]);return C.useCallback((te,ee)=>{const ae={id:Date.now(),message:te,type:ee,timestamp:new Date};k(ge=>[...ge,ae]),setTimeout(()=>{k(ge=>ge.filter(_e=>_e.id!==ae.id))},wi.NOTIFICATION_DURATION)},[]),y?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Student Results..."})]})}):_?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Results Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:_}),o.jsx(nt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):s?o.jsxs("div",{children:[y?o.jsxs("div",{className:"text-center py-8",children:[o.jsx(jr,{size:"md"}),o.jsx("p",{className:"mt-2 text-gray-600",children:"Loading results..."})]}):_?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-red-500 text-4xl mb-2",children:"⚠️"}),o.jsx("p",{className:"text-red-600",children:_})]}):K(w),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:E.map(te=>o.jsx(Ko,{type:te.type,message:te.message,onClose:()=>k(ee=>ee.filter(ae=>ae.id!==te.id))},te.id))})]}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Student Results"}),o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",q?q.toLocaleString():"Never"]})]}),o.jsxs("div",{className:"flex space-x-3",children:[A&&o.jsx(nt,{variant:"outline",onClick:()=>ie(!Z),children:Z?"Hide Details":"Show Details"}),o.jsx(nt,{variant:"outline",onClick:Y,children:"Back to Cabinet"})]})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:Z&&A?z():Q()}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:E.map(te=>o.jsx(Ko,{type:te.type,message:te.message,onClose:()=>k(ee=>ee.filter(ae=>ae.id!==te.id))},te.id))}),selectedDrawing&&o.jsx(Qj,{drawing:selectedDrawing,isOpen:isDrawingModalOpen,onClose:()=>setIsDrawingModalOpen(!1)})]})},Iz=({isMenuOpen:e,onToggleMenu:t,onShowPasswordChange:r})=>{const n=Ei(),{user:s,isAuthenticated:a,logout:i}=Bn(),{studentData:l,loadStudentData:c}=Jy(),{activeTests:d,testResults:f,loadActiveTests:p,loadTestResults:g,viewTestDetails:y,testDetailsModal:v,closeTestDetailsModal:_}=zp(),[b,E]=C.useState(!0),[k,w]=C.useState(""),[N,A]=C.useState([]),[P,R]=C.useState(null),[T,D]=C.useState(!1),[I,V]=C.useState(null),[X,Z]=C.useState(null),[ie,q]=C.useState(new Set),[ne,M]=C.useState(!1),[W,L]=C.useState(!1),[H,K]=C.useState(!1),[B,z]=C.useState(!1);C.useEffect(()=>{Q()},[]),C.useEffect(()=>()=>{K(!1)},[]),C.useEffect(()=>{if(H){const me=setTimeout(()=>{K(!1)},1e3);return()=>clearTimeout(me)}},[H]);const Q=C.useCallback(async()=>{console.log("🎓 Initializing Student Cabinet...");try{if(E(!0),w(""),!a||!s){console.log("🎓 User not authenticated, redirecting to login"),n("/login");return}if(s.role!==si.STUDENT){console.error("🎓 Invalid user role for student cabinet:",s.role),w("Access denied. Student role required.");return}console.log("🎓 Loading student data..."),await c(),console.log("🎓 Loading active tests...");try{localStorage.removeItem("student_active_tests_")}catch{}await p(),console.log("🎓 Loading test results..."),await g(s?.student_id||s?.id||""),console.log("🎓 Calculating average score..."),await Y(),console.log("🎓 Student Cabinet initialization complete!")}catch(me){console.error("🎓 Error initializing student cabinet:",me),w("Failed to initialize student cabinet")}finally{E(!1)}},[a,s,n]),Y=C.useCallback(async()=>{console.log("🎓 Calculating average score...");try{if(f&&f.length>0){const me=f.reduce((qe,Xe)=>typeof Xe.score=="number"&&typeof Xe.max_score=="number"&&Xe.max_score>0?qe+Math.round(Xe.score/Xe.max_score*100):qe,0),He=Math.round(me/f.length);Z(He),console.log("🎓 Average score calculated:",He)}}catch(me){console.error("🎓 Error calculating average score:",me)}},[f]);C.useEffect(()=>{if(H){console.log("🎓 Skipping completed tests initialization during navigation");return}const me=s?.student_id||s?.id;if(!me){console.log("🎓 Student ID not available yet, skipping localStorage initialization");return}const He=new Set;for(let qe=0;qe<localStorage.length;qe++){const Xe=localStorage.key(qe);if(Xe&&Xe.startsWith(`test_completed_${me}_`)&&localStorage.getItem(Xe)==="true"){const It=Xe.replace(`test_completed_${me}_`,"").split("_");if(It.length>=2){const st=It[0],Ie=It.slice(1).join("_"),je=`${st}_${Ie}`;He.add(je),console.log("🎓 Found completed test in localStorage:",je)}}}q(He),z(!0),console.log("🎓 Initialized completed tests from localStorage:",Array.from(He))},[s?.student_id,s?.id,H]),C.useEffect(()=>{console.log("🎓 testResults structure:",f);const me=f?.results||f;if(console.log("🎓 resultsArray:",me),me&&me.length>0){const He=s?.student_id||s?.id||"",qe=new Set;me.forEach(Xe=>{const Ve=`${Xe.test_type}_${Xe.test_id}`;qe.add(Ve),localStorage.setItem(`test_completed_${He}_${Xe.test_type}_${Xe.test_id}`,"true")}),q(Xe=>{const Ve=new Set([...Xe,...qe]);return console.log("🎓 Updated completed tests (merged):",Array.from(Ve)),Ve})}},[f,s?.student_id,s?.id]);const te=C.useCallback(async(me,He,qe=!1,Xe=null)=>{console.log("🎓 Checking test completion:",me,He,"retestAvailable:",qe);try{const Ve=s?.student_id||s?.id||"";if(qe){console.log("🎓 Retest available from backend, checking attempt limits.");const je=[];for(let mt=1;mt<=10;mt++){const $t=`retest_attempt${mt}_${Ve}_${me}_${He}`;localStorage.getItem($t)==="true"&&je.push($t)}const Ze=je.length,bt=Xe?.retest_attempts_left||Xe?.max_attempts||3;return console.log("🎓 Current attempts:",Ze,"Max attempts:",bt,"Attempt keys:",je),Ze>=bt?(console.log("🎓 Maximum retest attempts reached in localStorage"),!0):(console.log("🎓 Retest attempts available, allowing start."),!1)}const It=`test_completed_${Ve}_${me}_${He}`,st=localStorage.getItem(It);if(console.log("🎓 localStorage key:",It),console.log("🎓 localStorage value:",st),me==="word_matching"){console.log("🎓 Debug: All localStorage keys for student",Ve);for(let je=0;je<localStorage.length;je++){const Ze=localStorage.key(je);Ze&&Ze.includes(Ve)&&Ze.includes("word_matching")&&console.log("🎓 Found word_matching key:",Ze,"=",localStorage.getItem(Ze))}}if(st==="true")return console.log("✅ Found completion status in local storage:",st),!0;const Ie=f?.results||f;return Ie&&Ie.length>0&&(console.log("🎓 Checking database results:",Ie.length,"results"),Ie.some(Ze=>(console.log("🎓 Checking result:",Ze.test_type,Ze.test_id,"vs",me,He),Ze.test_type===me&&Ze.test_id===He)))?(console.log("✅ Found completion status in database results"),localStorage.setItem(It,"true"),!0):(console.log("❌ Test not completed according to local storage or database"),!1)}catch(Ve){return console.error("🎓 Error checking test completion:",Ve),!1}},[f,s?.student_id,s?.id]),ee=C.useCallback((me,He)=>{const qe={id:Date.now(),message:me,type:He,timestamp:new Date};A(Xe=>[...Xe,qe]),setTimeout(()=>{A(Xe=>Xe.filter(Ve=>Ve.id!==qe.id))},wi.NOTIFICATION_DURATION)},[]),ae=C.useCallback(async me=>{console.log("🎓 Showing test details:",me);try{await y(me.test_type,me.test_id,me.test_name)}catch(He){console.error("Error loading test details:",He),ee("Failed to load test details","error")}},[y,ee]),ge=C.useCallback(me=>{console.log("🎓 Starting test:",me);const He=`${me.test_type}_${me.test_id}`;if(ie.has(He)&&!me?.retest_available){ee("This test has already been completed","warning");return}if(console.log("🎓 Checking retest conditions:"),console.log("🎓 test.retest_available:",me?.retest_available),console.log("🎓 testKey:",He),console.log("🎓 completedTests.has(testKey):",ie.has(He)),console.log("🎓 completedTests:",Array.from(ie)),me?.retest_available){const qe=s?.student_id||s?.id||"",Xe=`retest1_${qe}_${me.test_type}_${me.test_id}`;if(localStorage.setItem(Xe,"true"),console.log("🎓 Set retest key:",Xe),console.log("🎓 Test retest_assignment_id:",me.retest_assignment_id),console.log("🎓 Test retest_assignment_id type:",typeof me.retest_assignment_id),me?.retest_assignment_id){const Ve=`retest_assignment_id_${qe}_${me.test_type}_${me.test_id}`;localStorage.setItem(Ve,String(me.retest_assignment_id)),console.log("🎓 Set retest assignment ID:",Ve,"=",me.retest_assignment_id)}else console.log("🎓 No retest assignment ID found in test data")}else console.log("🎓 Retest assignment ID storage skipped - retest not available");if(K(!0),console.log("🎓 Set isStartingTest to true for test:",me.test_type),me.test_type==="matching_type"){console.log("🎯 Redirecting to matching test page for testId:",me.test_id),n(`/student/matching-test/${me.test_id}`);return}if(me.test_type==="word_matching"){console.log("🎯 Redirecting to word matching test page for testId:",me.test_id),n(`/student/word-matching-test/${me.test_id}`);return}if(me.test_type==="speaking"){console.log("🎤 Redirecting to speaking test page for testId:",me.test_id),n(`/student/speaking-test/${me.test_id}`);return}n(`/student/test/${me.test_type}/${me.test_id}`)},[n,ie,ee,s?.student_id,s?.id]),_e=C.useCallback(()=>{M(me=>!me)},[]),Me=C.useCallback(()=>{L(me=>!me)},[]),ue=C.useCallback(async me=>{if(console.log("🎓 Starting test:",me),H){console.log("🎓 Test already starting, ignoring click");return}try{if(await te(me.test_type,me.test_id,me?.retest_available,me)&&!me?.retest_available){ee("This test has already been completed","warning");return}ge(me)}catch(He){console.error("🎓 Error starting test:",He),ee("Failed to start test. Please try again.","error")}},[te,ge,ee,H]);return C.useCallback(me=>{console.log("🎓 Viewing test details:",me),ae(me)},[ae]),b?o.jsx(et.div,{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:o.jsxs(et.div,{className:"text-center",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsx(jr,{size:"lg"}),o.jsx(et.p,{className:"mt-4 text-gray-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.3},children:"Loading Student Cabinet..."})]})}):k?o.jsx(et.div,{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:o.jsx(et.div,{className:"text-center",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.5},children:o.jsxs(et.div,{className:"bg-white border border-red-200 rounded-xl p-8 max-w-md shadow-lg",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3,duration:.3},children:[o.jsx(et.div,{className:"text-4xl mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.4,duration:.3,type:"spring"},children:"⚠️"}),o.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Cabinet Error"}),o.jsx("p",{className:"text-red-600 mb-6",children:k}),o.jsx(nt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):o.jsxs(et.div,{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[o.jsx(et.div,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-6",children:[o.jsxs(et.div,{className:"flex items-center space-x-4",initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(et.div,{className:"h-12 w-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.3,type:"spring"},whileHover:{scale:1.1},children:o.jsx("span",{className:"text-white font-semibold text-xl",children:s?.name?.charAt(0)||"S"})})}),o.jsxs("div",{children:[o.jsxs("h1",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white",children:[s?.name," ",s?.surname]}),o.jsxs("p",{className:"text-blue-100 text-sm sm:text-base md:text-lg",children:["Grade ",s?.grade," - Class ",s?.class]})]})]}),o.jsxs(et.div,{className:"relative",initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3,duration:.5},children:[o.jsxs("button",{onClick:t,className:"flex items-center space-x-1 sm:space-x-2 bg-white/10 border-white/20 text-white hover:bg-white/20 font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm border-2",style:{zIndex:1e3},children:[o.jsx("span",{className:"hidden sm:inline",children:"Menu"}),o.jsx(et.svg,{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:{rotate:e?180:0},transition:{duration:.2},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]}),o.jsx(_i,{children:e&&o.jsx(et.div,{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg z-50 overflow-hidden",initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},children:o.jsxs("div",{className:"py-2",children:[o.jsx(et.button,{onClick:r,className:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 transition-colors",whileHover:{x:4},transition:{duration:.2},children:"Change Password"}),o.jsx(et.button,{onClick:()=>{t(),i()},className:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-red-50 transition-colors",whileHover:{x:4},transition:{duration:.2},children:"Logout"})]})})})]})]})})}),o.jsxs(et.div,{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.5},children:[o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:o.jsx("div",{className:"lg:col-span-1 space-y-6",children:X!==null&&o.jsx(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.7,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{children:"Average Score"})}),o.jsx(kt.Body,{children:o.jsxs(et.div,{className:"text-center",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.8,duration:.3},children:[o.jsxs(et.div,{className:"text-4xl font-bold text-blue-600 mb-2",initial:{scale:0},animate:{scale:1},transition:{delay:.9,duration:.5,type:"spring"},children:[X,"%"]}),o.jsx("p",{className:"text-sm text-gray-500",children:"Overall Performance"})]})})]})})})}),o.jsxs("div",{className:"space-y-6",children:[o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{className:"text-center",children:"Active Tests"})}),o.jsx(kt.Body,{children:d&&d.length>0?o.jsxs("div",{className:"relative",children:[console.log("🎓 Rendering overlay, isStartingTest:",H),H&&o.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50 rounded-lg border-2 border-blue-200",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-blue-600 font-semibold text-lg",children:"Starting test..."}),o.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Please wait..."})]})}),o.jsxs("div",{className:"space-y-4",children:[(ne?d:d.slice(0,3)).map((me,He)=>o.jsx(et.div,{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:ne?0:.7+He*.1,duration:.3},whileHover:{scale:1.02},children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("div",{className:"flex-1",children:o.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[o.jsx("h3",{className:"text-sm sm:text-lg font-medium text-gray-900 w-16 sm:w-auto break-words leading-tight line-clamp-2 sm:line-clamp-none",children:me.test_name}),o.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:me.subject}),o.jsx("span",{className:"text-gray-500",children:me.teacher_name}),o.jsxs("span",{className:"text-gray-500",children:[o.jsx("span",{className:"sm:hidden",children:new Date(me.assigned_at).toLocaleDateString("en-US",{year:"2-digit",month:"numeric",day:"numeric"})}),o.jsx("span",{className:"hidden sm:inline",children:new Date(me.assigned_at).toLocaleDateString()})]})]})}),o.jsx("div",{className:"flex space-x-2 ml-4",children:(()=>{const qe=`${me.test_type}_${me.test_id}`,Xe=ie.has(qe);return B?Xe&&me?.retest_available?o.jsx(nt,{variant:"primary",size:"sm",onClick:()=>ue(me),disabled:H,children:"Start Retest"}):Xe?o.jsx(nt,{variant:"secondary",size:"xs",disabled:!0,className:"bg-green-100 text-green-800 border-green-200",children:"✓ Completed"}):(console.log("🎓 Button render, isStartingTest:",H,"test:",me.test_type),o.jsx(nt,{variant:"primary",size:"sm",onClick:()=>ue(me),disabled:H,children:"Start Test"})):o.jsx(nt,{variant:"secondary",size:"sm",disabled:!0,className:"bg-gray-100 text-gray-500 border-gray-200",children:"Loading..."})})()})]})},`${me.test_type}_${me.test_id}`)),d.length>3&&o.jsx("div",{className:"text-center pt-2",children:o.jsx("button",{onClick:_e,className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:ne?"Show Less":`Show ${d.length-3} More`})})]})]}):o.jsxs(et.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7,duration:.3},children:[o.jsx(et.div,{className:"text-6xl mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.8,duration:.5,type:"spring"},children:"📝"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No Active Tests"}),o.jsx("p",{className:"text-gray-500",children:"No active tests available for your class at the moment."})]})})]})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{children:"Test Results"})}),o.jsx(kt.Body,{children:f&&f.showResults?o.jsx(Hp,{testResults:f,onBackToCabinet:()=>{setTestResults(null)},onRetakeTest:(me,He)=>{p(),setTestResults(null)},isLoading:b}):o.jsx(Jj,{compact:!0,showAll:W,onToggleShowAll:Me,maxInitial:3})})]})})]})]}),o.jsx($j,{isOpen:v.isOpen,onClose:_,testType:v.testType,testId:v.testId,testName:v.testName,questions:v.questions||[],isLoading:v.isLoading||!1}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:N.map(me=>o.jsx(Ko,{type:me.type,message:me.message,onClose:()=>A(He=>He.filter(qe=>qe.id!==me.id))},me.id))})]})},Mz=({testInfo:e,questions:t,testType:r,studentAnswers:n,onBackToCabinet:s,checkAnswerCorrectness:a,formatStudentAnswerForDisplay:i,getCorrectAnswer:l})=>{const[c,d]=C.useState(0),[f,p]=C.useState(0),[g,y]=C.useState(!0);if(C.useEffect(()=>{const b=()=>{try{const E=Du(t,n,r).score,k=e?.num_questions||t?.length||0,w=k>0?Math.round(E/k*100):0;d(E),p(w),y(!1)}catch(E){console.error("Error calculating test results:",E),d(0),p(0),y(!1)}};t&&t.length>0?b():y(!1)},[t,n,r,e,Du]),g)return o.jsx("div",{className:"flex justify-center items-center min-h-64",children:o.jsx("div",{className:"text-lg",children:"Calculating results..."})});const v=e?.num_questions||t?.length||0,_=e?.test_name||e?.title||"Test";return o.jsxs("div",{className:"test-results-page max-w-4xl mx-auto p-6 overflow-y-auto min-h-screen",children:[o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"results-header text-center",children:[o.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:["Test Results: ",_]}),o.jsx("p",{className:"text-gray-600",children:r==="matching_type"?"Matching Test":r==="multiple_choice"?"Multiple Choice Test":r==="true_false"?"True/False Test":r==="input"?"Input Test":r==="drawing"?"Drawing Test":"Test"})]})}),o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"results-summary",children:[o.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 text-center",children:["Your Score: ",c," / ",v," (",f,"%)"]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-4",children:o.jsx("div",{className:`h-4 rounded-full transition-all duration-500 ${f>=80?"bg-green-500":f>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${f}%`}})}),o.jsx("div",{className:"text-center",children:o.jsx("p",{className:`text-lg font-medium ${f>=80?"text-green-600":f>=60?"text-yellow-600":"text-red-600"}`,children:f>=80?"Excellent!":f>=60?"Good job!":"Keep practicing!"})})]})}),t&&t.length>0&&o.jsx(kt,{className:"mb-6",children:o.jsxs("div",{className:"questions-review",children:[o.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Question Review"}),o.jsx("div",{className:"space-y-4",children:t.map((b,E)=>{const k=n[String(b.question_id)]||"No answer";console.log("🔍 TestResultsDisplay - Question",E+1,":",{question:b,studentAnswer:k,testType:r});const w=a(b,k,r);return console.log("🔍 TestResultsDisplay - isCorrect result:",w),o.jsxs("div",{className:`question-review p-4 rounded-lg border-2 ${w?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[o.jsxs("div",{className:"question-review-header flex justify-between items-start mb-3",children:[o.jsxs("h4",{className:"text-lg font-medium text-gray-800",children:["Question ",E+1]}),o.jsx("span",{className:`text-2xl font-bold ${w?"text-green-600":"text-red-600"}`,children:w?"✓":"✗"})]}),o.jsx("div",{className:"question-text mb-3",children:o.jsx("p",{className:"text-gray-700 font-medium",children:b.question})}),o.jsxs("div",{className:"answer-section space-y-2",children:[o.jsxs("p",{className:"student-answer",children:[o.jsx("strong",{className:"text-gray-600",children:"Your Answer:"})," ",o.jsx("span",{className:`font-medium ${w?"text-green-700":"text-red-700"}`,children:i(k,r,b)})]}),!w&&o.jsxs("p",{className:"correct-answer",children:[o.jsx("strong",{className:"text-gray-600",children:"Correct Answer:"})," ",o.jsx("span",{className:"text-green-700 font-medium",children:r==="multiple_choice"?String(b.correct_answer||"").toUpperCase():i(l(b,r),r,b)})]})]})]},b.question_id||E)})})]})}),o.jsx(kt,{children:o.jsx("div",{className:"results-actions text-center",children:o.jsx(nt,{onClick:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 text-lg font-medium",children:"Back to Cabinet"})})})]})},Oz=({onBackToCabinet:e,currentTest:t})=>{const r=Ei(),{user:n,isAuthenticated:s}=Bn(),{activeTests:a,loadActiveTests:i}=zp(),l=C.useCallback((De,ut,pt)=>{try{const Lt=`test_progress_${n?.student_id||n?.id||"unknown"}_${De}_${ut}`;localStorage.setItem(Lt,JSON.stringify(pt)),console.log(`Saved test progress for ${De}_${ut}:`,pt)}catch(Pt){console.error("Error saving test progress:",Pt)}},[n?.student_id,n?.id]),c=C.useCallback((De,ut)=>{try{const Pt=`test_progress_${n?.student_id||n?.id||"unknown"}_${De}_${ut}`,Lt=localStorage.getItem(Pt);return Lt?JSON.parse(Lt):null}catch(pt){return console.error("Error getting test progress:",pt),null}},[n?.student_id,n?.id]),d=C.useCallback((De,ut)=>{try{const pt=n?.student_id||n?.id||"unknown",Pt=`test_progress_${pt}_${De}_${ut}`;localStorage.removeItem(Pt);for(let Lt=0;Lt<localStorage.length;Lt++){const sr=localStorage.key(Lt);sr&&sr.startsWith(`test_progress_${pt}_${De}_${ut}_`)&&(localStorage.removeItem(sr),console.log(`🧹 Cleared individual question key: ${sr}`))}console.log(`Cleared test progress for ${De}_${ut}`)}catch(pt){console.error("Error clearing test progress:",pt)}},[n?.student_id,n?.id]),[f,p]=C.useState(!0),[g,y]=C.useState(!1),[v,_]=C.useState(""),[b,E]=C.useState(!1),[k,w]=C.useState(""),[N,A]=C.useState([]),[P,R]=C.useState(t?"test":"list"),[T,D]=C.useState(null),[I,V]=C.useState(null),[X,Z]=C.useState(null),[ie,q]=C.useState([]),[ne,M]=C.useState([]),[W,L]=C.useState(0),[H,K]=C.useState(0),[B,z]=C.useState(null),Q=ns.useRef(null),Y=ns.useRef(null),[te,ee]=C.useState(!1),[ae,ge]=C.useState(!1),[_e,Me]=C.useState(null),[ue,me]=C.useState(null),{startTracking:He,stopTracking:qe,getCheatingData:Xe,clearData:Ve,isCheating:It,tabSwitches:st}=Wp(T?.test_type,T?.test_id,n?.student_id||n?.id);C.useEffect(()=>{(()=>{const ut=[];for(let pt=0;pt<localStorage.length;pt++){const Pt=localStorage.key(pt);if(Pt&&Pt.startsWith("test_progress_")&&!Pt.includes("_51712_")&&!Pt.includes("_51736_")){const Lt=Pt.split("_");Lt.length===4&&Lt[0]==="test"&&Lt[1]==="progress"&&ut.push(Pt)}}ut.forEach(pt=>{localStorage.removeItem(pt),console.log("🧹 Cleared old cache key:",pt)})})()},[]),C.useEffect(()=>{Ie()},[]),C.useEffect(()=>{t&&(console.log("🎯 Auto-starting test from prop:",t),E(!0),bt(t))},[t]);const Ie=C.useCallback(async()=>{console.log("🎓 Initializing Student Tests...");try{if(p(!0),w(""),!s||!n){console.log("🎓 User not authenticated"),w("User not authenticated");return}if(n.role!==si.STUDENT){console.error("🎓 Invalid user role for student tests:",n.role),w("Access denied. Student role required.");return}console.log("🎓 Loading active tests..."),await i(),console.log("🎓 Student Tests initialization complete!")}catch(De){console.error("🎓 Error initializing student tests:",De),w("Failed to initialize student tests")}finally{p(!1)}},[s,n,i]);C.useCallback(async()=>{console.log("🎓 Loading student active tests...");try{const De=await rn.getActiveTests();console.log("🎓 Active tests loaded:",De);const ut=De.map(pt=>({...pt,subject_id:pt.subject_id||pt.subjectId,teacher_id:pt.teacher_id||pt.teacherId,is_active:pt.is_active!==void 0?pt.is_active:!0,created_at:pt.created_at||pt.createdAt,updated_at:pt.updated_at||pt.updatedAt}));return me(new Date),ut}catch(De){throw console.error("🎓 Error loading active tests:",De),De}},[]),C.useCallback(async(De,ut)=>{console.log("🎓 Checking test completion:",De,ut);try{const pt=c(De,ut);return pt&&pt.completed}catch(pt){return console.error("🎓 Error checking test completion:",pt),!1}},[c]),C.useEffect(()=>{if(ie.length>0&&T?.test_id){const De=setTimeout(()=>{let ut=!1;const pt=new Array(ie.length).fill("");if(ie.forEach((Pt,Lt)=>{const Te=`test_progress_${n?.student_id||n?.id||"unknown"}_${I}_${T?.test_id}_${Pt.question_id}`,ve=localStorage.getItem(Te);if(ve){const fe=ve.replace(/^"(.*)"$/,"$1");pt[Lt]=fe,ut=!0}}),ut){M(pt);const Pt=pt.filter(sr=>sr&&typeof sr=="string"&&sr.trim()!=="").length,Lt=ie.length>0?Pt/ie.length*100:0;L(Lt)}},100);return()=>clearTimeout(De)}},[ie,I,T?.test_id]);const je=C.useCallback(async(De,ut)=>{console.log("🎓 Marking test as completed:",De,ut);try{const pt=c(De,ut)||{};pt.completed=!0,pt.completedAt=new Date().toISOString(),l(De,ut,pt);const Lt=`test_completed_${n?.student_id||n?.id||""}_${De}_${ut}`;localStorage.setItem(Lt,"true"),console.log("🎓 Test completion marked in localStorage:",Lt),console.log("🎓 localStorage value after setting:",localStorage.getItem(Lt)),yt("Test marked as completed","success")}catch(pt){console.error("🎓 Error marking test as completed:",pt),yt("Failed to mark test as completed","error")}},[c,l]),Ze=C.useCallback(De=>{console.log("🎓 Showing test details:",De),Me(De),ge(!0)},[]),bt=C.useCallback(async De=>{console.log("🎓 Starting test:",De);let ut=Date.now(),pt;try{_(""),y(!0),ut=Date.now();const Pt=()=>{const fr=Date.now()-ut,Mr=Math.max(0,250-fr);setTimeout(()=>{p(!1),y(!1)},Mr)};let Lt=!1;pt=setTimeout(()=>{Lt=!0,_("Loading is taking longer than expected...")},15e3);const Te=`test_completed_${n?.student_id||n?.id||""}_${De.test_type}_${De.test_id}`,ve=localStorage.getItem(Te)==="true";if(ve&&!De?.retest_available){console.log("🎓 Test already completed, redirecting to main cabinet"),yt("This test has already been completed","info"),r("/student");return}if(ve&&De?.retest_available&&console.log("🎓 Test completed but retest available, allowing retest"),De.test_type===gn.MATCHING){console.log("🎯 Redirecting to matching test page for testId:",De.test_id),r(`/student/matching-test/${De.test_id}`);return}if(De.test_type===gn.WORD_MATCHING){console.log("🎯 Redirecting to word matching test page for testId:",De.test_id),r(`/student/word-matching-test/${De.test_id}`);return}D(De),V(De.test_type);const[fe,we]=await Promise.all([rn.getTestInfo(De.test_type,De.test_id),rn.getTestQuestions(De.test_type,De.test_id)]);Z(fe);let Ue=we;try{if(!!fe?.is_shuffled){const vr=n?.student_id||n?.id||"unknown",Mr=`${vr}:${De.test_type}:${De.test_id}`,sn=Array.from(Mr).reduce((pe,xe)=>(pe<<5)-pe+xe.charCodeAt(0),0)>>>0,le=`test_shuffle_order_${vr}_${De.test_type}_${De.test_id}`,be=localStorage.getItem(le);if(be){const pe=JSON.parse(be),xe=new Map(we.map(Se=>[Se.question_id,Se]));Ue=pe.map(Se=>xe.get(Se)).filter(Boolean)}else{const xe=function(ke){return function(){var $e=ke+=1831565813;return $e=Math.imul($e^$e>>>15,$e|1),$e^=$e+Math.imul($e^$e>>>7,$e|61),(($e^$e>>>14)>>>0)/4294967296}}(sn);Ue=[...we];for(let ke=Ue.length-1;ke>0;ke--){const $e=Math.floor(xe()*(ke+1));[Ue[ke],Ue[$e]]=[Ue[$e],Ue[ke]]}const Se=Ue.map(ke=>ke.question_id);localStorage.setItem(le,JSON.stringify(Se))}}}catch(fr){console.error("Shuffle error (ignored):",fr)}q(Ue),Pt();let xt=c(De.test_type,De.test_id)?.answers||new Array(we.length).fill("");we.forEach((fr,vr)=>{const sn=`test_progress_${n?.student_id||n?.id||"unknown"}_${De.test_type}_${De.test_id}_${fr.question_id}`,le=localStorage.getItem(sn);console.log(`🔍 Checking individual answer for question ${fr.question_id}:`,le),le&&(xt[vr]=le,console.log(`✅ Loaded individual answer for question ${fr.question_id}:`,le))}),console.log("🔍 Initial answers after loading individual saves:",xt),M(xt);const Ht=xt.filter(fr=>fr&&typeof fr=="string"&&fr.trim()!=="").length,Ot=we.length>0?Ht/we.length*100:0;console.log("🔍 Calculated progress:",Ht,"answered out of",we.length,"=",Ot+"%"),L(Ot);const Xt=Number(fe?.allowed_time||0),pr=n?.student_id||n?.id||"unknown";if(Q.current=`test_timer_${pr}_${De.test_type}_${De.test_id}`,Xt>0)try{const fr=localStorage.getItem(Q.current),vr=Date.now();if(fr){const Mr=JSON.parse(fr),sn=Math.floor((vr-new Date(Mr.lastTickAt).getTime())/1e3),le=Math.max(0,Number(Mr.remainingSeconds||Xt)-Math.max(0,sn));K(le),Y.current=vr}else K(Xt),Y.current=vr,localStorage.setItem(Q.current,JSON.stringify({remainingSeconds:Xt,lastTickAt:new Date(vr).toISOString(),startedAt:new Date(vr).toISOString()}))}catch(fr){console.error("Timer cache init error:",fr),K(Xt)}else K(0);const Fr=new Date;z(Fr),console.log("⏱️ Test timer started at:",Fr.toISOString()),He(),console.log("🛡️ Anti-cheating tracking started"),R("test"),console.log("🎓 Test started successfully")}catch(Pt){console.error("🎓 Error starting test:",Pt),yt("Failed to start test","error"),_("Failed to load test data. Please try again.")}finally{const Pt=Date.now()-ut,sr=Math.max(0,250-Pt);setTimeout(()=>{p(!1),y(!1)},sr),E(!1);try{pt&&clearTimeout(pt)}catch{}}},[c]),mt=C.useCallback(async()=>{if(!T||!X||!ie||!ne){yt("No test data to submit","error");return}console.log("🎓 Submitting test:",T);try{ee(!0);const De=Du(ie,ne,T.test_type),ut=new Date,pt=B?Math.round((ut-B)/1e3):0,Pt=B?B.toISOString():ut.toISOString();console.log("⏱️ Test timing:",{startedAt:Pt,endTime:ut.toISOString(),timeTaken:`${pt} seconds`});const Lt=Xe();console.log("🛡️ Anti-cheating data for submission:",Lt);const sr={};ie.forEach((ve,fe)=>{sr[ve.question_id]=ne[fe]??""}),T.test_type==="drawing"&&(console.log("🎨 Drawing test answers being submitted:",ne),console.log("🎨 Drawing test answers type:",typeof ne[0]),console.log("🎨 Drawing test answers content:",ne[0]));const Te=await rn.submitTest(T.test_type,T.test_id,ne,{time_taken:(()=>{const ve=Number(X?.allowed_time||0);return ve>0?Math.min(pt,ve):pt})(),started_at:Pt,submitted_at:ut.toISOString(),answers_by_id:sr,question_order:ie.map(ve=>ve.question_id),caught_cheating:Lt.caught_cheating,visibility_change_times:Lt.visibility_change_times,retest_assignment_id:(()=>{const fe=`retest_assignment_id_${n?.student_id||n?.id||""}_${T.test_type}_${T.test_id}`,we=localStorage.getItem(fe);return console.log("🎨 Frontend retest key:",fe),console.log("🎨 Frontend retest assignment ID from localStorage:",we),console.log("🎨 Frontend retest assignment ID converted:",we?Number(we):null),console.log("🎨 Frontend current test data:",T),console.log("🎨 Frontend current test retest_assignment_id:",T.retest_assignment_id),we?Number(we):null})(),parent_test_id:T.test_id},n);if(console.log("🎓 Test submission result:",Te),Te.success){const ve=n?.student_id||n?.id||"",fe=`retest1_${ve}_${T.test_type}_${T.test_id}`;if(localStorage.getItem(fe)==="true"){const xt=T?.retest_attempts_left||T?.max_attempts||3;if((Te?.percentage_score??0)>=50){const Ot=`retest_attempt${xt}_${ve}_${T.test_type}_${T.test_id}`;localStorage.setItem(Ot,"true"),console.log("🎓 Passed retest, marking last-slot key:",Ot),localStorage.removeItem(fe)}else{let Ot=1;for(let pr=1;pr<=10;pr++){const Fr=`retest_attempt${pr}_${ve}_${T.test_type}_${T.test_id}`;if(localStorage.getItem(Fr)!=="true"){Ot=pr;break}}const Xt=`retest_attempt${Ot}_${ve}_${T.test_type}_${T.test_id}`;localStorage.setItem(Xt,"true"),console.log("🎓 Marked retest attempt as completed:",Xt),Ot>=xt&&localStorage.removeItem(fe)}}if(console.log("🎓 Marking test as completed..."),await je(T.test_type,T.test_id),T.test_type!=="drawing"){console.log("🎓 Caching test results after submission...");const Ht=`student_results_table_${n?.student_id||n?.id||"unknown"}`,{setCachedData:Ot,CACHE_TTL:Xt}=await Uo(async()=>{const{setCachedData:pr,CACHE_TTL:Fr}=await Promise.resolve().then(()=>Ih);return{setCachedData:pr,CACHE_TTL:Fr}},void 0);Ot(Ht,Te,Xt.student_results_table),console.log("🎓 Test results cached with key:",Ht)}else console.log("🎓 Drawing test submitted - not caching results (will appear after teacher grades)");console.log("🎓 Clearing test progress..."),d(T.test_type,T.test_id);try{const xt=n?.student_id||n?.id||"unknown",Ht=`test_timer_${xt}_${T.test_type}_${T.test_id}`;localStorage.removeItem(Ht);const Ot=`test_shuffle_order_${xt}_${T.test_type}_${T.test_id}`;localStorage.removeItem(Ot)}catch{}if(n?.student_id){const xt=`test_completed_${n.student_id}_${T.test_type}_${T.test_id}`;localStorage.setItem(xt,"true"),console.log("✅ Test marked as completed in localStorage:",xt)}try{const xt=n?.student_id||n?.id||"",Ht=`retest1_${xt}_${T.test_type}_${T.test_id}`,Ot=`retest_assignment_id_${xt}_${T.test_type}_${T.test_id}`;localStorage.removeItem(Ht),localStorage.removeItem(Ot),console.log("🧹 Cleared retest keys:",Ht,Ot)}catch(xt){console.warn("Failed to clear retest keys:",xt)}console.log("🧹 Clearing test progress and anti-cheating data...");const Ue=n?.student_id||n?.id||"unknown",St=[];for(let xt=0;xt<localStorage.length;xt++){const Ht=localStorage.key(xt);Ht&&(Ht.startsWith(`test_progress_${Ue}_`)||Ht.startsWith(`anti_cheating_${Ue}_`))&&St.push(Ht)}St.forEach(xt=>{localStorage.removeItem(xt),console.log(`🧹 Cleared: ${xt}`)}),console.log("🛡️ Clearing anti-cheating data..."),qe(),Ve(),T.test_type!=="drawing"?R("results"):r("/student"),yt("Test submitted successfully!","success"),console.log("🎓 Test submitted successfully")}else throw console.error("🎓 Test submission failed:",Te.error),new Error(Te.error||"Failed to submit test")}catch(De){console.error("🎓 Error submitting test:",De),yt("Failed to submit test","error")}finally{ee(!1)}},[T,X,ie,ne,je,d]);C.useCallback(()=>(console.log("🎓 Collecting test answers..."),ne),[ne]);const $t=C.useCallback(()=>{if(!ie||!ne)return;const De=ne.filter(pt=>pt&&typeof pt=="string"&&pt.trim()!=="").length,ut=ie.length>0?De/ie.length*100:0;if(L(ut),console.log(`🎓 Progress updated: ${De}/${ie.length} questions answered (${Math.round(ut)}%)`),T){const pt={answers:ne,progress:ut,lastSaved:new Date().toISOString()};l(T.test_type,T.test_id,pt)}},[ie,ne,T,l]);C.useEffect(()=>{$t()},[$t]);const Wt=C.useCallback(()=>{if(!ne)return 0;const De=ne.filter(ut=>ut&&typeof ut=="string"&&ut.trim()!=="").length;return console.log("🎓 getAnsweredCount:",{studentAnswers:ne,answeredCount:De,totalQuestions:ie?.length}),De},[ne,ie]),lt=C.useCallback(()=>{console.log("🎓 Navigating back to cabinet..."),e?e():r("/student")},[e,r]);C.useCallback(()=>{console.log("🎓 Showing test results..."),R("results")},[]);const Qe=C.useCallback((De,ut,pt=null)=>{switch(console.log("🎓 Formatting student answer for display:",De,"testType:",ut,"question:",pt),ut){case gn.MULTIPLE_CHOICE:if(De.toString().startsWith("Option "))return De;if(pt&&typeof De=="string"&&!isNaN(parseInt(De))){const Pt=parseInt(De),Lt=`option_${String.fromCharCode(97+Pt)}`,sr=pt[Lt];if(sr)return console.log("🎓 Converted",De,"to option text:",sr),sr;{const Te=String.fromCharCode(65+Pt);return console.log("🎓 Converted",De,"to",Te),Te}}else{if(typeof De=="string"&&isNaN(parseInt(De)))return console.log("🎓 Already formatted text:",De),De;{const Pt=String.fromCharCode(65+parseInt(De));return console.log("🎓 Converted",De,"to",Pt),Pt}}case gn.TRUE_FALSE:return De==="true"?"True":"False";case gn.INPUT:return De;case gn.MATCHING:return typeof De=="object"?JSON.stringify(De):De;case gn.WORD_MATCHING:return typeof De=="object"?JSON.stringify(De):De;case gn.DRAWING:return De&&De.trim()!==""?"Drawing submitted":"No drawing";case gn.FILL_BLANKS:return De;default:return console.warn("🎓 Unknown test type for answer formatting:",ut),De}},[]),yt=C.useCallback((De,ut)=>{const pt={id:Date.now(),message:De,type:ut,timestamp:new Date};A(Pt=>[...Pt,pt]),setTimeout(()=>{A(Pt=>Pt.filter(Lt=>Lt.id!==pt.id))},wi.NOTIFICATION_DURATION)},[]);C.useEffect(()=>{$t()},[$t]),C.useEffect(()=>{if(P!=="test")return;const De=Number(X?.allowed_time||0);if(!De)return;const ut=setInterval(()=>{K(pt=>{const Pt=Math.max(0,pt-1);try{const Lt=Date.now();Y.current||(Y.current=Lt),Q.current&&localStorage.setItem(Q.current,JSON.stringify({remainingSeconds:Pt,lastTickAt:new Date(Lt).toISOString(),startedAt:B?B.toISOString():new Date(Lt-(De-Pt)*1e3).toISOString()}))}catch{}return Pt===0&&mt(),Pt})},1e3);return()=>clearInterval(ut)},[P,X?.allowed_time,mt,B]);const ft=C.useCallback((De,ut)=>{if(!De)return null;const pt=(Pt,Lt)=>{const sr=[...ne];sr[ut]=Lt,M(sr),console.log(`🎓 Answer changed: question ${Pt} = ${Lt}`),console.log("🎓 Updated studentAnswers:",sr)};switch(T.test_type){case gn.TRUE_FALSE:return o.jsx(PW,{question:De,questionIndex:ut,studentAnswer:ne[ut]||"",onAnswerChange:pt,mode:"student",testId:T?.test_id,testType:I,displayNumber:ut+1});case gn.MULTIPLE_CHOICE:return o.jsx(RW,{question:De,questionIndex:ut,studentAnswer:ne[ut]||"",onAnswerChange:pt,mode:"student",testId:T?.test_id,testType:I,displayNumber:ut+1});case gn.INPUT:return o.jsx(DW,{question:De,questionIndex:ut,studentAnswer:ne[ut]||"",onAnswerChange:pt,mode:"student",testId:T?.test_id,testType:I,displayNumber:ut+1});case gn.MATCHING:return console.error("Matching test reached renderQuestion - this should not happen"),o.jsxs("div",{className:"text-center p-8",children:[o.jsx("h2",{className:"text-xl font-semibold text-gray-600 mb-4",children:"Matching Test"}),o.jsx("p",{className:"text-gray-500 mb-4",children:"Redirecting to matching test page..."}),o.jsx(nt,{onClick:()=>r("/student"),variant:"primary",children:"Back to Dashboard"})]});case gn.DRAWING:return o.jsx(zW,{question:De,questionIndex:ut,studentAnswer:ne[ut]||"",onAnswerChange:pt,mode:"student",testId:T?.test_id,testType:I});case gn.FILL_BLANKS:return ut===0?o.jsx(VW,{testText:X?.test_text,blanks:(ie||[]).map((Pt,Lt)=>({id:Pt.question_id||Lt+1,options:Pt.blank_options||[],correct_answer:Pt.correct_answers?.[0]||Pt.correct_answer,question:Pt.question_json||""})),separateType:X?.separate_type,testId:T?.test_id,testName:X?.test_name||T?.test_name,teacherId:X?.teacher_id||T?.teacher_id,subjectId:X?.subject_id||T?.subject_id,onTestComplete:mt,onAnswerChange:(Pt,Lt)=>{const sr=ie.findIndex(Te=>Te.question_id===Pt);if(sr!==-1){const Te=[...ne];Te[sr]=Lt,M(Te),console.log(`🎓 Fill Blanks answer changed: question ${Pt} = ${Lt}`)}}},`fill-blanks-${T?.test_id}-${X?.test_name}`):null;default:return o.jsx("div",{children:"Unsupported question type"})}},[T,ne,I]);function _t(){return!T||!X||!ie?null:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("div",{className:"flex justify-between items-center mb-4",children:o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:X.test_name||X.title||"Test"})}),o.jsx("div",{className:"mb-4",children:o.jsx(GW,{answeredCount:Wt(),totalQuestions:ie.length,percentage:Math.round(W),timeElapsed:Number(X?.allowed_time||0)>0?H:0,showDetails:!0})})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Answer all questions below:"}),o.jsx("div",{className:"space-y-8",children:ie.map((De,ut)=>o.jsx("div",{className:"question-container",children:ft(De,ut)},De.question_id||ut))})]}),o.jsx("div",{className:"flex justify-center",children:o.jsx(nt,{variant:"primary",size:"lg",onClick:mt,disabled:te||Wt()<ie.length,loading:te,children:te?"Submitting...":`Submit Test (${Wt()}/${ie.length})`})})]})}if(f)return o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:t?"Starting Test...":"Loading Student Tests..."})]})});if(k)return o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Tests Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:k}),o.jsx(nt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})});return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Student Test"})}),o.jsx(nt,{variant:"outline",onClick:lt,children:"Back to Cabinet"})]})})}),It&&P==="results"&&o.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 p-4 mx-4 sm:mx-6 lg:mx-8 mt-4",children:o.jsxs("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),o.jsx("div",{className:"ml-3",children:o.jsxs("p",{className:"text-sm text-red-700",children:[o.jsx("strong",{children:"Academic Integrity Warning:"}),"This test has been flagged for suspicious behavior. You have switched tabs ",st," times during the test."]})})]})}),o.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 overflow-y-auto",children:[!t&&P==="list"&&zt(),P==="test"&&_t(),P==="results"&&Jt()]}),P==="test"&&g&&o.jsxs("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-[1px] flex flex-col items-center justify-center z-50",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-3 text-gray-700",children:"Preparing your test…"}),v&&o.jsx("div",{className:"mt-3 text-sm text-gray-500",children:v})]}),o.jsx($j,{isOpen:ae,onClose:()=>ge(!1),testType:_e?.test_type,testId:_e?.test_id,testName:_e?.test_name,questions:_e?.questions,isLoading:f}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:N.map(De=>o.jsx(Ko,{type:De.type,message:De.message,onClose:()=>A(ut=>ut.filter(pt=>pt.id!==De.id))},De.id))})]});function zt(){return!a||a.length===0?o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No active tests available for your class."})}):o.jsx("div",{className:"space-y-6",children:a.map((De,ut)=>o.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:De.test_name}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Subject:"})," ",De.subject]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Teacher:"})," ",De.teacher_name]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Type:"})," ",De.test_type]})]}),o.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Assigned: ",new Date(De.assigned_at).toLocaleDateString()]})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx(nt,{variant:"outline",onClick:()=>Ze(De),disabled:b||f,children:"View Details"}),o.jsx(nt,{variant:"primary",onClick:()=>bt(De),disabled:b||f,children:b?"Starting...":"Start Test"})]})]})},ut))})}function Jt(){if(!T||!X||!ie||!ne)return null;const De={};return ne.forEach((ut,pt)=>{if(ie[pt]){const Pt=ie[pt].question_id||ie[pt].id||pt;De[String(Pt)]=ut,console.log("🔍 Converting answer:",{index:pt,questionId:Pt,answer:ut,question:ie[pt]})}}),console.log("🔍 Final answersObject:",De),console.log("🔍 Questions structure:",ie.map(ut=>({id:ut.question_id,correct_answer:ut.correct_answer}))),o.jsx(Mz,{testInfo:X,questions:ie,testType:T.test_type,studentAnswers:De,onBackToCabinet:lt,checkAnswerCorrectness:c0,formatStudentAnswerForDisplay:Qe,getCorrectAnswer:op})}},Lz=()=>{const{testId:e}=Ny(),t=Ei(),{user:r}=Bn(),{makeAuthenticatedRequest:n}=zi(),{showNotification:s}=ka(),[a,i]=C.useState(null),[l,c]=C.useState(!0),[d,f]=C.useState(null),[p,g]=C.useState(null),[y,v]=C.useState(!1);Wp("matching_type",a?.id);const _=C.useCallback(()=>{if(!r?.student_id||!e)return!1;const N=`test_completed_${r.student_id}_matching_type_${e}`,A=localStorage.getItem(N)==="true",P=`retest1_${r.student_id}_matching_type_${e}`,R=localStorage.getItem(P)==="true";return A&&!R?(console.log("🎓 Test already completed, redirecting to cabinet"),s("This test has already been completed","info"),t("/student"),!0):!1},[r?.student_id,e,t,s]),b=C.useCallback(async()=>{if(!e){f("Test ID is required"),c(!1);return}if(!_())try{c(!0),f(null);const N=await n(`/.netlify/functions/get-matching-type-test?test_id=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!N.ok)throw new Error("Failed to load test data");const A=await N.json();if(!A.success)throw new Error(A.message||"Failed to load test");const P=A.data;console.log("🔍 Test data from get-matching-type-test:",P);const R=await n(`/.netlify/functions/get-test-questions?test_id=${e}&test_type=matching_type`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!R.ok)throw new Error("Failed to load test questions");const T=await R.json();if(!T.success)throw new Error(T.message||"Failed to load test questions");console.log("🔍 Questions data from get-test-questions:",T);const D={id:P.test_id,test_name:P.test_name,teacher_id:P.teacher_id,subject_id:P.subject_id,image_url:P.image_url,image:null,blocks:(()=>{if(Array.isArray(T.questions)&&T.questions.length>0){const I=T.questions[0];return Array.isArray(I.blocks)?I.blocks.map((V,X)=>{let Z=V.block_coordinates||V.coordinates||(typeof V.x=="number"?{x:V.x,y:V.y,width:V.width,height:V.height}:null);if(typeof Z=="string")try{Z=JSON.parse(Z)}catch{Z=null}return(!Z||typeof Z!="object")&&(Z={x:0,y:0,width:30,height:10}),Z={x:(typeof Z.x=="number"?Z.x:Number(Z.x))||0,y:(typeof Z.y=="number"?Z.y:Number(Z.y))||0,width:(typeof Z.width=="number"?Z.width:Number(Z.width))||30,height:(typeof Z.height=="number"?Z.height:Number(Z.height))||10},{id:V.block_id||V.question_id||V.id||X+1,word:V.word||`Word ${X+1}`,coordinates:Z,hasArrow:!!V.has_arrow,arrow:V.arrow||null}}):T.questions.map(V=>{console.log("🔍 Processing question:",V);let X;try{X=typeof V.block_coordinates=="string"?JSON.parse(V.block_coordinates):V.block_coordinates}catch{X={x:0,y:0,width:100,height:100}}return(!X||typeof X!="object")&&(X={x:0,y:0,width:100,height:100}),X={x:(typeof X.x=="number"?X.x:Number(X.x))||0,y:(typeof X.y=="number"?X.y:Number(X.y))||0,width:(typeof X.width=="number"?X.width:Number(X.width))||100,height:(typeof X.height=="number"?X.height:Number(X.height))||100},{id:V.question_id,word:V.word,coordinates:X,hasArrow:V.has_arrow,arrow:V.arrow}})}return[]})(),words:(()=>{if(Array.isArray(T.questions)&&T.questions.length>0){const I=T.questions[0];if(Array.isArray(I.words)){const V=I.words,X=Array.isArray(I.blocks)?I.blocks:[];return typeof V[0]=="string"?V.map((ie,q)=>({id:`w_${X[q]?.question_id||X[q]?.block_id||T.questions[q]?.question_id||q+1}_${q}`,word:String(ie),blockId:null,isPlaced:!1,isCorrect:!1})):V.map((ie,q)=>({id:`w_${ie.question_id||ie.id||q+1}_${q}`,word:ie.word||String(ie.text||""),blockId:null,isPlaced:!1,isCorrect:!1}))}return T.questions.map(V=>({id:`w_${V.question_id}`,word:V.word,blockId:null,isPlaced:!1,isCorrect:!1}))}return[]})(),arrows:P.arrows?P.arrows.map(I=>(console.log("🔍 Processing arrow:",I),{id:I.id,questionId:I.question_id,blockId:I.block_id||I.question_id,start:{x:Number(I.start_x)||0,y:Number(I.start_y)||0},end:{x:Number(I.end_x)||0,y:Number(I.end_y)||0},rel_start_x:I.rel_start_x!==null?Number(I.rel_start_x):null,rel_start_y:I.rel_start_y!==null?Number(I.rel_start_y):null,rel_end_x:I.rel_end_x!==null?Number(I.rel_end_x):null,rel_end_y:I.rel_end_y!==null?Number(I.rel_end_y):null,image_width:I.image_width?Number(I.image_width):null,image_height:I.image_height?Number(I.image_height):null,style:(typeof I.style=="string"?JSON.parse(I.style):I.style)||{color:"#dc3545",thickness:3}})):[]};if(P.image_url){const I=new Image;I.crossOrigin="anonymous",I.onload=()=>{D.image=I,i(D),c(!1)},I.onerror=()=>{console.warn("Failed to load test image"),i(D),c(!1)},I.src=P.image_url}else i(D),c(!1)}catch(N){console.error("Error loading test data:",N),f(N.message||"Failed to load test"),c(!1)}},[e,n]);C.useEffect(()=>{r?.student_id&&b()},[b,r?.student_id]);const E=C.useCallback(async N=>{console.log("Test completed:",N),s("Test completed successfully!","success");const A=parseInt(N)||0,P=a?.blocks?.length||a?.words?.length||0,R=P>0?Math.round(A/P*100):0,T={showResults:!0,testInfo:{test_name:a?.test_name||"Test",id:a?.id,test_id:a?.id},testType:"matching_type",score:A,totalQuestions:P,percentage:R,passed:R>=60,questionAnalysis:a?.questions?.map((D,I)=>({questionNumber:I+1,isCorrect:I<A,userAnswer:I<A?`Matched: ${D.word}`:"Not answered",correctAnswer:`Match: ${D.word}`}))||Array.from({length:P},(D,I)=>({questionNumber:I+1,isCorrect:I<A,userAnswer:I<A?"Matched":"Not answered",correctAnswer:"Match required"})),timestamp:new Date().toISOString(),caught_cheating:!1,visibility_change_times:0};console.log("🎯 Using test results data:",T),g(T),v(!0)},[a,s]),k=C.useCallback(()=>{t("/student")},[t]),w=C.useCallback(()=>{v(!1),g(null),b()},[b]);return l?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx(kt,{className:"max-w-md w-full",children:o.jsxs(kt.Body,{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading test..."})]})})}):d?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx(kt,{className:"max-w-md w-full",children:o.jsxs(kt.Body,{className:"text-center",children:[o.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Test"}),o.jsx("p",{className:"text-gray-600 mb-4",children:d}),o.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Dashboard"})]})})}):a?y&&p?o.jsx("div",{className:"bg-gray-50 overflow-y-auto min-h-screen",children:o.jsx(Hp,{testResults:p,onBackToCabinet:k,onRetakeTest:w,isLoading:!1})}):o.jsx(IW,{testData:a,onTestComplete:E,onBackToCabinet:k}):o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx(kt,{className:"max-w-md w-full",children:o.jsxs(kt.Body,{className:"text-center",children:[o.jsx("div",{className:"text-gray-500 text-6xl mb-4",children:"📝"}),o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Test Data"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Unable to load test data"}),o.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Dashboard"})]})})})},Bz=()=>{const{testId:e}=Ny(),t=Ei(),{user:r}=Bn(),{makeAuthenticatedRequest:n}=zi(),{showNotification:s}=ka(),[a,i]=C.useState(null),[l,c]=C.useState(!0),[d,f]=C.useState(null),[p,g]=C.useState(null),[y,v]=C.useState(!1),_=C.useCallback(()=>{if(!r?.student_id||!e)return!1;const w=`test_completed_${r.student_id}_word_matching_${e}`,N=`retest1_${r.student_id}_word_matching_${e}`;return localStorage.getItem(N)==="true"?!1:localStorage.getItem(w)==="true"},[r?.student_id,e]),b=C.useCallback(async()=>{if(!e){f("Test ID is required"),c(!1);return}if(_()){s("This test has already been completed","warning"),t("/student");return}c(!0),f(null);try{const w=`word_matching_test_${e}`,N=jn(w);if(N){if(console.log("🎯 Word matching test loaded from cache:",N),N.id){let R=N;if(Array.isArray(R.rightWords)&&Array.isArray(R.correctPairs)){const T=R.rightWords.map((X,Z)=>Z);for(let X=T.length-1;X>0;X--){const Z=Math.floor(Math.random()*(X+1));[T[X],T[Z]]=[T[Z],T[X]]}const D=T.map(X=>R.rightWords[X]),I=new Map(T.map((X,Z)=>[X,Z])),V=R.correctPairs.map(X=>I.get(X));R={...R,rightWords:D,correctPairs:V}}i(R)}else{let T={id:N.test_id,test_id:N.test_id,test_name:N.test_name,teacher_id:N.teacher_id,subject_id:N.subject_id,num_questions:N.num_questions,interaction_type:N.interaction_type,passing_score:N.passing_score,created_at:N.created_at,updated_at:N.updated_at,leftWords:N.leftWords,rightWords:N.rightWords,correctPairs:N.correctPairs,originalPairs:N.originalPairs};if(Array.isArray(T.rightWords)&&Array.isArray(T.correctPairs)){const D=T.rightWords.map((Z,ie)=>ie);for(let Z=D.length-1;Z>0;Z--){const ie=Math.floor(Math.random()*(Z+1));[D[Z],D[ie]]=[D[ie],D[Z]]}const I=D.map(Z=>T.rightWords[Z]),V=new Map(D.map((Z,ie)=>[Z,ie])),X=T.correctPairs.map(Z=>V.get(Z));T={...T,rightWords:I,correctPairs:X}}i(T)}c(!1);return}const P=await(await n(`/.netlify/functions/get-word-matching-test?test_id=${e}`)).json();if(P.success){const R={id:P.data.test_id,test_id:P.data.test_id,test_name:P.data.test_name,teacher_id:P.data.teacher_id,subject_id:P.data.subject_id,num_questions:P.data.num_questions,interaction_type:P.data.interaction_type,passing_score:P.data.passing_score,created_at:P.data.created_at,updated_at:P.data.updated_at,leftWords:P.data.leftWords,rightWords:P.data.rightWords,correctPairs:P.data.correctPairs,originalPairs:P.data.originalPairs};let T=R;if(Array.isArray(T.rightWords)&&Array.isArray(T.correctPairs)){const D=T.rightWords.map((Z,ie)=>ie);for(let Z=D.length-1;Z>0;Z--){const ie=Math.floor(Math.random()*(Z+1));[D[Z],D[ie]]=[D[ie],D[Z]]}const I=D.map(Z=>T.rightWords[Z]),V=new Map(D.map((Z,ie)=>[Z,ie])),X=T.correctPairs.map(Z=>V.get(Z));T={...T,rightWords:I,correctPairs:X}}i(T),Fn(w,T,Dn.word_matching_test),console.log("🎯 Word matching test loaded from API and cached:",R)}else throw new Error(P.message||"Failed to load test")}catch(w){console.error("Error loading word matching test:",w),f(w.message),s("Failed to load test: "+w.message,"error")}finally{c(!1)}},[e,_,n,s,t]),E=C.useCallback(async w=>{console.log("Test completed:",w),s("Test completed successfully!","success");const N=parseInt(w)||0,A=a?.num_questions||0,P=A>0?Math.round(N/A*100):0,R={showResults:!0,testInfo:{test_name:a?.test_name||"Test",id:a?.id,test_id:a?.id},testType:"word_matching",score:N,totalQuestions:A,percentage:P,passed:P>=60,questionAnalysis:Array.isArray(a?.correctPairs)?a.correctPairs.map((T,D)=>({questionNumber:D+1,isCorrect:D<N,userAnswer:D<N?`${T.left} → ${T.right}`:"Not answered",correctAnswer:`${T.left} → ${T.right}`})):Array.from({length:A},(T,D)=>({questionNumber:D+1,isCorrect:D<N,userAnswer:D<N?"Matched":"Not answered",correctAnswer:"Match required"})),timestamp:new Date().toISOString(),caught_cheating:!1,visibility_change_times:0};console.log("🎯 Using test results data:",R),g(R),v(!0)},[a,s]),k=C.useCallback(()=>{t("/student")},[t]);return C.useEffect(()=>{b()},[b]),l?o.jsx("div",{className:"flex justify-center items-center min-h-screen",children:o.jsxs(kt,{className:"p-8 text-center",children:[o.jsx(jr,{size:"lg",className:"mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading word matching test..."})]})}):d?o.jsx("div",{className:"flex justify-center items-center min-h-screen",children:o.jsx(kt,{className:"p-8 text-center",children:o.jsxs("div",{className:"text-red-600 mb-4",children:[o.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),o.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Loading Test"}),o.jsx("p",{className:"text-gray-600 mb-4",children:d}),o.jsx("button",{onClick:()=>t("/student"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Cabinet"})]})})}):a?y&&p?o.jsx("div",{className:"bg-gray-50 overflow-y-auto min-h-screen",children:o.jsx(Hp,{testResults:p,onBackToCabinet:()=>{g(null),v(!1),t("/student")},onRetakeTest:(w,N)=>{g(null),v(!1),b()},isLoading:!1})}):o.jsx(et.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"min-h-screen bg-gray-50 py-8",children:o.jsx(LW,{testData:a,onTestComplete:E,onBackToCabinet:k})}):o.jsx("div",{className:"flex justify-center items-center min-h-screen",children:o.jsx(kt,{className:"p-8 text-center",children:o.jsxs("div",{className:"text-gray-600 mb-4",children:[o.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Test Not Found"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"The requested test could not be found."}),o.jsx("button",{onClick:()=>t("/student"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Cabinet"})]})})})},Uz=C.forwardRef(({onRecordingComplete:e,minDuration:t=0,maxDuration:r=600,minWords:n=50,maxAttempts:s=3,currentAttempt:a=1},i)=>{const[l,c]=C.useState(!1),[d,f]=C.useState(!1),[p,g]=C.useState(0),[y,v]=C.useState(null),[_,b]=C.useState(null),[E,k]=C.useState("good"),w=C.useRef(null),N=C.useRef([]),A=C.useRef(null),P=C.useRef(null),R=C.useRef(null),T=C.useRef(null),D=C.useRef(null);C.useImperativeHandle(i,()=>({startRecording:()=>I(),stopRecording:()=>V(),pauseRecording:()=>X(),resumeRecording:()=>Z()}));const I=C.useCallback(async()=>{try{if(b(null),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Microphone access is not supported in this browser. Please use a modern browser like Chrome, Safari, or Firefox.");if(!window.isSecureContext&&!window.location.hostname.includes("localhost"))throw new Error("Microphone access requires HTTPS. Please use a secure connection.");console.log("🎤 Requesting microphone permission...");const W=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100}});console.log("🎤 Microphone permission granted"),A.current=W;const L=new(window.AudioContext||window.webkitAudioContext),H=L.createAnalyser();L.createMediaStreamSource(W).connect(H),H.fftSize=256,R.current=L,T.current=H,ie();const B=new MediaRecorder(W,{mimeType:"audio/webm;codecs=opus"});w.current=B,N.current=[],B.ondataavailable=z=>{z.data.size>0&&N.current.push(z.data)},B.onstop=()=>{const z=new Blob(N.current,{type:"audio/webm"});v(z),e(z,p),A.current&&A.current.getTracks().forEach(Q=>Q.stop()),R.current&&R.current.close(),D.current&&cancelAnimationFrame(D.current)},B.start(1e3),c(!0),g(0),P.current=setInterval(()=>{g(z=>{const Q=z+1;return Q>=r&&V(),Q})},1e3)}catch(W){console.error("Error starting recording:",W);const L=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;W.name==="NotAllowedError"?b(L?"Microphone access denied. Please go to Settings > Safari > Microphone and allow access, then refresh the page.":"Microphone access denied. Please allow microphone access in your browser settings and try again."):W.name==="NotFoundError"?b("No microphone found. Please connect a microphone and try again."):W.name==="NotSupportedError"?b("Microphone access is not supported in this browser. Please use a modern browser like Chrome, Safari, or Firefox."):W.message.includes("HTTPS")?b("Microphone access requires HTTPS. Please use a secure connection."):b(`Failed to access microphone: ${W.message}`)}},[r]),V=C.useCallback(()=>{if(w.current&&l&&(w.current.stop(),c(!1),f(!1),P.current&&clearInterval(P.current),p<t)){b(`Recording must be at least ${t} seconds long.`);return}},[l,p,t,y,e]),X=C.useCallback(()=>{w.current&&l&&!d&&(w.current.pause(),f(!0),P.current&&clearInterval(P.current))},[l,d]),Z=C.useCallback(()=>{w.current&&l&&d&&(w.current.resume(),f(!1),P.current=setInterval(()=>{g(W=>{const L=W+1;return L>=r&&V(),L})},1e3))},[l,d,r,V]),ie=C.useCallback(()=>{if(!T.current)return;const W=T.current,L=new Uint8Array(W.frequencyBinCount),H=()=>{W.getByteFrequencyData(L);const K=L.reduce((B,z)=>B+z,0)/L.length;K<10?k("poor"):K<30?k("fair"):k("good"),l&&(D.current=requestAnimationFrame(H))};H()},[l]),q=W=>{const L=Math.floor(W/60),H=W%60;return`${L}:${H.toString().padStart(2,"0")}`},ne=()=>{switch(E){case"poor":return"text-red-600";case"fair":return"text-yellow-600";case"good":return"text-green-600";default:return"text-gray-600"}},M=()=>{switch(E){case"poor":return"Poor audio quality - speak closer to microphone";case"fair":return"Fair audio quality - good for recording";case"good":return"Excellent audio quality";default:return"Monitoring audio quality..."}};return o.jsxs("div",{className:"audio-recorder bg-white rounded-lg shadow-lg p-3 sm:p-6",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Record Your Response"}),o.jsx("p",{className:"text-gray-600",children:"Speak clearly and at a normal pace. You can pause and resume if needed."})]}),o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:q(p)}),o.jsx("div",{className:`text-sm ${ne()}`,children:M()}),d&&o.jsx("div",{className:"text-yellow-600 font-semibold mt-2",children:"⏸️ Recording Paused"})]}),l&&o.jsx("div",{className:"mb-6",children:o.jsx("div",{className:"flex justify-center items-center space-x-1 h-8",children:Array.from({length:20},(W,L)=>o.jsx("div",{className:"bg-blue-400 rounded-sm",style:{width:"4px",height:`${Math.random()*20+4}px`,animation:"pulse 0.5s ease-in-out infinite"}},L))})}),o.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-center mb-6",children:l?o.jsxs(o.Fragment,{children:[d?o.jsxs("button",{onClick:Z,className:"w-full sm:w-auto bg-green-600 text-white px-6 py-4 rounded-full hover:bg-green-700 flex items-center justify-center space-x-2 min-h-[48px] text-lg font-semibold",children:[o.jsx("span",{className:"text-xl",children:"▶️"}),o.jsx("span",{children:"Resume"})]}):o.jsxs("button",{onClick:X,className:"w-full sm:w-auto bg-yellow-600 text-white px-6 py-4 rounded-full hover:bg-yellow-700 flex items-center justify-center space-x-2 min-h-[48px] text-lg font-semibold",children:[o.jsx("span",{className:"text-xl",children:"⏸️"}),o.jsx("span",{children:"Pause"})]}),o.jsxs("button",{onClick:V,className:"w-full sm:w-auto bg-gray-600 text-white px-6 py-4 rounded-full hover:bg-gray-700 flex items-center justify-center space-x-2 min-h-[48px] text-lg font-semibold",children:[o.jsx("span",{className:"text-xl",children:"⏹️"}),o.jsx("span",{children:"Stop & Submit"})]})]}):o.jsxs("button",{onClick:I,className:"w-full sm:w-auto bg-red-600 text-white px-6 py-4 rounded-full hover:bg-red-700 flex items-center justify-center space-x-2 min-h-[48px] text-lg font-semibold",children:[o.jsx("span",{className:"text-xl",children:"🎤"}),o.jsx("span",{children:"Start Recording"})]})}),_&&o.jsx("div",{className:"mt-4 p-3 sm:p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-800",children:_})}),o.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:["Attempt ",a," of ",s,a<s&&o.jsx("span",{className:"ml-2 text-blue-600",children:"(You can re-record if needed)"})]})]})}),Zj=({audioBlob:e,audioUrl:t,recordingTime:r,className:n=""})=>{const[s,a]=C.useState(!1),[i,l]=C.useState(0),[c,d]=C.useState(0),[f,p]=C.useState(1),[g,y]=C.useState(1),[v,_]=C.useState(!0),[b,E]=C.useState(""),[k,w]=C.useState(!1),[N,A]=C.useState(null),[P,R]=C.useState(!1),T=C.useRef(null),D=C.useRef(null),I=C.useRef(!1);C.useEffect(()=>()=>{I.current=!0},[]),C.useEffect(()=>{let L=!1;if(t)console.log("AudioPlayer: Using provided URL:",t),L||E(t);else if(e){if(!e||e.size===0){console.log("Invalid audio blob provided to AudioPlayer"),L||_(!1);return}if(!(e instanceof Blob)){console.error("audioBlob is not a Blob:",typeof e,e),L||_(!1);return}console.log("AudioPlayer: Creating URL for blob:",{size:e.size,type:e.type,isBlob:e instanceof Blob});const H=URL.createObjectURL(e);return L||E(H),()=>{L=!0,console.log("AudioPlayer: Revoking URL"),URL.revokeObjectURL(H)}}return()=>{L=!0}},[e,t]),C.useEffect(()=>{let L=!1;async function H(K){if(!K||P||/\/object\/sign\//.test(K))return K;try{if((await fetch(K,{method:"HEAD"})).ok)return K;if(!P){const Q=new URL(K).pathname.replace(/^\/storage\/v1\/object\/public\//,""),Y=Q.split("/")[0],te=Q.substring(Y.length+1),ee=await fetch(`/.netlify/functions/get-speaking-test-new?action=sign-audio&bucket=${encodeURIComponent(Y)}&file_path=${encodeURIComponent(te)}`);if(ee.ok){const{url:ae}=await ee.json();return!L&&!I.current&&(R(!0),E(ae)),ae}}}catch{}return K}return(async()=>{if(t){const K=await H(t);!L&&!I.current&&!P&&E(K)}})(),()=>{L=!0}},[t,P]),C.useEffect(()=>{let L=!1;return b&&(L||(w(!1),A(null),_(!0))),()=>{L=!0}},[b]),C.useEffect(()=>{if(T.current&&b){const L=T.current;let H=!1;console.log("AudioPlayer: Setting up audio with URL:",b);try{L.src=b}catch{}L.load();const K=()=>{if(H||I.current)return;let ue=L.duration;if(console.log("Audio duration:",ue),console.log("Recording time prop:",r),ue===1/0)try{L.currentTime=1e101,L.ontimeupdate=()=>{if(H||I.current)return;L.ontimeupdate=null;const me=L.duration;console.log("Fixed duration via seek trick:",me),H||(d(isFinite(me)&&me>0?me:0),L.currentTime=0,_(!1))};return}catch(me){console.warn("Seek trick failed:",me)}if(isNaN(ue)||!isFinite(ue)||ue<=0){const me=L.seekable&&L.seekable.length>0&&isFinite(L.seekable.end(0)),He=!me&&L.buffered&&L.buffered.length>0&&isFinite(L.buffered.end(L.buffered.length-1));me?(ue=L.seekable.end(0),console.log("Using seekable end as duration fallback:",ue)):He&&(ue=L.buffered.end(L.buffered.length-1),console.log("Using buffered end as duration fallback:",ue))}isNaN(ue)||!isFinite(ue)||ue<=0?(console.warn("Invalid audio duration after fallbacks:",ue),r&&r>0?(console.log("Using recording time as fallback:",r),H||d(r)):H||d(0)):H||d(ue),H||_(!1)},B=()=>{H||I.current||K()},z=()=>{H||I.current||K()},Q=()=>{H||I.current||K()},Y=()=>{H||I.current||K()},te=()=>{H||I.current||l(L.currentTime)},ee=()=>{H||I.current||(a(!1),l(0))},ae=()=>{H||I.current||a(!0)},ge=()=>{H||I.current||a(!1)},_e=ue=>{if(H||I.current)return;console.error("Audio loading error:",ue),console.error("Audio error details:",{error:L.error,networkState:L.networkState,readyState:L.readyState,src:L.src,currentSrc:L.currentSrc});const me=L.error?.code;console.log("Audio error code:",me,"MEDIA_ERR_SRC_NOT_SUPPORTED is 4"),me===4?(console.log("Marking format as unsupported due to error code 4"),w(!0)):console.log("Not marking as unsupported, error code:",me),A(L.error||{code:me}),_(!1)},Me=setTimeout(()=>{H||I.current||L.readyState===0&&(console.warn("AudioPlayer: Fallback timeout reached; stopping loader but not marking unsupported"),_(!1))},6e3);return L.addEventListener("loadedmetadata",B),L.addEventListener("durationchange",z),L.addEventListener("canplay",Q),L.addEventListener("canplaythrough",Y),L.addEventListener("timeupdate",te),L.addEventListener("ended",ee),L.addEventListener("play",ae),L.addEventListener("pause",ge),L.addEventListener("error",_e),()=>{H=!0,clearTimeout(Me),L.removeEventListener("loadedmetadata",B),L.removeEventListener("durationchange",z),L.removeEventListener("canplay",Q),L.removeEventListener("canplaythrough",Y),L.removeEventListener("timeupdate",te),L.removeEventListener("ended",ee),L.removeEventListener("play",ae),L.removeEventListener("pause",ge),L.removeEventListener("error",_e),L.pause(),L.src="",L.load()}}},[b,r]),C.useEffect(()=>{let L=!1;return r&&r>0&&(isNaN(c)||!isFinite(c)||c<=0)&&(console.log("Updating duration from recordingTime prop:",r),L||d(r)),()=>{L=!0}},[r,c]);const V=()=>{console.log("Play button clicked, audioRef.current:",T.current),console.log("Audio src:",T.current?.src),console.log("Audio readyState:",T.current?.readyState),console.log("Audio networkState:",T.current?.networkState),T.current&&(s?(console.log("Pausing audio"),T.current.pause()):(console.log("Playing audio"),T.current.play().catch(L=>{console.error("Play failed:",L)})))},X=L=>{if(T.current&&D.current&&c>0){const H=D.current.getBoundingClientRect(),K=L.clientX-H.left,B=H.width,z=Math.max(0,Math.min(c,K/B*c));isFinite(z)&&z>=0&&(T.current.currentTime=z,l(z))}},Z=L=>{const H=parseFloat(L.target.value);p(H),T.current&&(T.current.volume=H)},ie=L=>{const H=parseFloat(L.target.value);y(H),T.current&&(T.current.playbackRate=H)},q=L=>{if(isNaN(L))return"0:00";const H=Math.floor(L/60),K=Math.floor(L%60);return`${H}:${K.toString().padStart(2,"0")}`};if(!e&&!t)return o.jsx("div",{className:`audio-player ${n}`,children:o.jsx("div",{className:"text-center text-gray-500 py-8",children:"No audio available"})});const M=(L=>{try{const K=(L||"").toLowerCase().split("?")[0].split("#")[0];return K.endsWith(".webm")?"audio/webm":K.endsWith(".mp3")?"audio/mpeg":K.endsWith(".m4a")?"audio/mp4":K.endsWith(".aac")?"audio/aac":K.endsWith(".wav")?"audio/wav":void 0}catch{return}})(b||t),W=ns.useMemo(()=>typeof window>"u"?!0:document.createElement("audio").canPlayType("audio/webm")!=="",[]);return console.log("AudioPlayer: URL analysis",{audioObjectUrl:b,audioUrl:t,guessedType:M,unsupportedFormat:k,loadError:N,webmSupported:W,canPlayWebM:typeof window<"u"?document.createElement("audio").canPlayType("audio/webm"):"unknown"}),o.jsxs("div",{className:`audio-player bg-gray-50 rounded-lg p-4 ${n}`,children:[o.jsx("audio",{ref:T,preload:"metadata",controls:!1,style:{display:"none"},crossOrigin:"anonymous",children:o.jsx("source",{src:b,type:M})}),v?o.jsxs("div",{className:"text-center py-4",children:[o.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),o.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading audio..."})]}):k?o.jsxs("div",{className:"text-center py-4",children:[o.jsx("p",{className:"text-sm text-red-600",children:"This audio format isn't supported by your browser."}),b?o.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-sm",children:"Open in new tab"}):null,M?o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Detected type: ",M]}):null,o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Browser WebM support: ",W?"Yes":"No",!W&&" - Try using Chrome, Firefox, or Edge"]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Preferred format: WebM"})]}):N?o.jsxs("div",{className:"text-center py-4",children:[o.jsx("p",{className:"text-sm text-red-600",children:"Playback failed. Please try opening the audio directly."}),b?o.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-sm",children:"Open in new tab"}):null,M?o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Detected type: ",M]}):null]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"mb-4",children:[o.jsx("div",{ref:D,className:"w-full bg-gray-200 rounded-full h-3 cursor-pointer hover:h-4 transition-all min-h-[24px]",onClick:X,children:o.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all",style:{width:`${i/c*100}%`}})}),o.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-2 font-medium",children:[o.jsx("span",{children:q(i)}),o.jsx("span",{children:q(c)})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("button",{onClick:V,className:"bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:s?o.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:o.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):o.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:o.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.617l3.766-3.793a1 1 0 011.617.793zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:f,onChange:Z,className:"w-24 h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer min-h-[20px]"}),o.jsxs("span",{className:"text-sm text-gray-600 w-10 font-medium",children:[Math.round(f*100),"%"]})]})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Speed:"}),o.jsxs("select",{value:g,onChange:ie,className:"text-sm border border-gray-300 rounded px-2 py-1",children:[o.jsx("option",{value:"0.5",children:"0.5x"}),o.jsx("option",{value:"0.75",children:"0.75x"}),o.jsx("option",{value:"1",children:"1x"}),o.jsx("option",{value:"1.25",children:"1.25x"}),o.jsx("option",{value:"1.5",children:"1.5x"}),o.jsx("option",{value:"2",children:"2x"})]})]})]})]})]})},$z=({transcript:e,scores:t,audioBlob:r,recordingTime:n,onReRecord:s,onFinalSubmit:a,canReRecord:i,attemptNumber:l,maxAttempts:c,isSubmitting:d=!1})=>{const[f,p]=C.useState(!1);console.log("🎤 FeedbackDisplay received recordingTime:",n);const g=(b,E)=>{const k=b/E*100;return k>=80?"text-green-600":k>=60?"text-yellow-600":"text-red-600"},y=(b,E)=>{const k=b/E*100;return k>=90?"A+":k>=80?"A":k>=70?"B":k>=60?"C":k>=50?"D":"F"},v=()=>y(t?.overall_score||0,100),_=()=>g(t?.overall_score||0,100);return console.log("🎯 FeedbackDisplay received scores:",t),console.log("🎯 Individual score values:",{grammar_score:t?.grammar_score,vocabulary_score:t?.vocabulary_score,pronunciation_score:t?.pronunciation_score,fluency_score:t?.fluency_score,content_score:t?.content_score}),o.jsxs("div",{className:"feedback-display bg-white rounded-lg shadow-lg p-3 sm:p-6",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Speaking Test Results"}),o.jsx("p",{className:"text-gray-600",children:"Review your performance and decide whether to submit or re-record."})]}),o.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-3 sm:p-6 rounded-lg mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:`text-4xl font-bold ${_()}`,children:[t?.overall_score||0,"/100"]}),o.jsxs("div",{className:`text-2xl font-semibold ${_()} mt-2`,children:["Grade: ",v()]}),o.jsx("div",{className:"text-gray-600 mt-2",children:t?.overall_score>=80?"Excellent work!":t?.overall_score>=60?"Good job!":t?.overall_score>=50?"Not bad, but could be better.":"Keep practicing!"})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Grammar"}),o.jsxs("span",{className:`font-bold ${g(t?.grammar_score||0,25)}`,children:[t?.grammar_score||0,"/25"]})]}),o.jsxs("div",{className:"text-sm text-gray-600",children:[t?.grammar_mistakes||0," mistakes found"]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min((t?.grammar_score||0)/25*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Vocabulary"}),o.jsxs("span",{className:`font-bold ${g(t?.vocabulary_score||0,20)}`,children:[t?.vocabulary_score||0,"/20"]})]}),o.jsxs("div",{className:"text-sm text-gray-600",children:[t?.vocabulary_mistakes||0," vocabulary issues"]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min((t?.vocabulary_score||0)/20*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Pronunciation"}),o.jsxs("span",{className:`font-bold ${g(t?.pronunciation_score||0,15)}`,children:[t?.pronunciation_score||0,"/15"]})]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Clarity and accuracy"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-orange-600 h-2 rounded-full",style:{width:`${Math.min((t?.pronunciation_score||0)/15*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Fluency"}),o.jsxs("span",{className:`font-bold ${g(t?.fluency_score||0,20)}`,children:[t?.fluency_score||0,"/20"]})]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Pace, pauses, and flow"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min((t?.fluency_score||0)/20*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Content"}),o.jsxs("span",{className:`font-bold ${g(t?.content_score||0,20)}`,children:[t?.content_score||0,"/20"]})]}),o.jsx("div",{className:"text-sm text-gray-600",children:"How well addressed the prompt"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-indigo-600 h-2 rounded-full",style:{width:`${Math.min((t?.content_score||0)/20*100,100)}%`}})})]}),o.jsxs("div",{className:"bg-white border rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-700",children:"Word Count"}),o.jsxs("span",{className:"font-bold text-gray-700",children:[t?.word_count||0," words"]})]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Total words spoken"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-gray-600 h-2 rounded-full",style:{width:`${Math.min((t?.word_count||0)/100*100,100)}%`}})})]})]}),r&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Your Recording"}),o.jsx(Zj,{audioBlob:r,recordingTime:n})]}),t?.feedback&&o.jsx("div",{className:"mb-6 bg-gradient-to-r from-green-50 to-blue-50 p-3 sm:p-6 rounded-lg border border-green-200",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("span",{className:"text-green-600 text-2xl",children:"🤖"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-semibold text-green-800 mb-3 text-lg",children:"AI Feedback"}),o.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.feedback})]})]})}),t?.improved_transcript&&o.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-3 sm:p-4",children:[o.jsxs("div",{className:"flex items-start space-x-2 mb-3",children:[o.jsx("span",{className:"text-green-600 text-lg",children:"✨"}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"Improved Version"}),o.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Here's how your response could be improved with better grammar and vocabulary:"})]})]}),o.jsx("div",{className:"bg-white border border-green-200 rounded p-3",children:o.jsx("p",{className:"text-gray-800 leading-relaxed",children:t.improved_transcript})})]}),o.jsx("div",{className:"mb-6",children:o.jsx("button",{onClick:()=>p(!f),className:"text-blue-600 hover:text-blue-800 text-sm",children:f?"Hide Details":"Show Details"})}),f&&o.jsxs("div",{className:"mb-6 bg-blue-50 p-3 sm:p-4 rounded-lg",children:[o.jsx("h4",{className:"font-semibold mb-3",children:"Detailed Analysis"}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Word Count Analysis:"}),o.jsxs("span",{className:"ml-2 text-gray-700",children:["You spoke ",t?.word_count||0," words.",t?.word_count>=50?" Great job meeting the minimum requirement!":" Consider speaking more to meet the minimum word requirement."]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Grammar Analysis:"}),o.jsx("span",{className:"ml-2 text-gray-700",children:t?.grammar_mistakes===0?"Perfect grammar!":`Found ${t?.grammar_mistakes||0} grammar ${t?.grammar_mistakes===1?"mistake":"mistakes"}.`}),t?.grammar_corrections&&t.grammar_corrections.length>0&&o.jsx("div",{className:"mt-2 space-y-2",children:t.grammar_corrections.map((b,E)=>o.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-2 sm:p-3",children:o.jsxs("div",{className:"flex items-start space-x-2",children:[o.jsx("span",{className:"text-red-600 font-mono text-sm",children:"✗"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-red-600",children:b.mistake}),o.jsx("span",{className:"mx-2",children:"→"}),o.jsx("span",{className:"font-medium text-green-600",children:b.correction})]}),o.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[o.jsx("strong",{children:"Explanation:"})," ",b.explanation]})]})]})},E))})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Vocabulary Analysis:"}),o.jsx("span",{className:"ml-2 text-gray-700",children:t?.vocabulary_mistakes===0?"Excellent vocabulary usage!":`Found ${t?.vocabulary_mistakes||0} vocabulary ${t?.vocabulary_mistakes===1?"issue":"issues"}.`}),t?.vocabulary_corrections&&t.vocabulary_corrections.length>0&&o.jsx("div",{className:"mt-2 space-y-2",children:t.vocabulary_corrections.map((b,E)=>o.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded p-2 sm:p-3",children:o.jsxs("div",{className:"flex items-start space-x-2",children:[o.jsx("span",{className:"text-purple-600 font-mono text-sm",children:"📝"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-purple-600",children:b.mistake}),o.jsx("span",{className:"mx-2",children:"→"}),o.jsx("span",{className:"font-medium text-green-600",children:b.correction})]}),o.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[o.jsx("strong",{children:"Explanation:"})," ",b.explanation]})]})]})},E))})]})]})]}),o.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:["Attempt ",l," of ",c]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-center justify-center",children:[i&&o.jsxs("button",{onClick:s,className:"w-full sm:w-auto bg-yellow-600 text-white px-4 py-2.5 rounded-lg hover:bg-yellow-700 flex items-center justify-center space-x-2 min-h-[40px] text-base font-medium",children:[o.jsx("span",{children:"🔄"}),o.jsx("span",{children:"Re-record"})]}),o.jsx("button",{onClick:a,disabled:d,className:`w-full sm:w-auto px-4 py-2.5 rounded-lg flex items-center justify-center space-x-2 min-h-[40px] text-base font-medium ${d?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} text-white`,children:d?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),o.jsx("span",{children:"Submitting..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"✅"}),o.jsx("span",{children:"Submit Final"})]})})]}),!i&&o.jsx("div",{className:"mt-4 p-2 sm:p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:o.jsxs("p",{className:"text-yellow-800 text-sm",children:[o.jsx("strong",{children:"Maximum attempts reached."}),' This is your final attempt. Click "Submit Final" to complete the test.']})})]})},Wz=({testData:e,onComplete:t,onExit:r,onTestComplete:n})=>{const[s,a]=C.useState("recording"),[i,l]=C.useState(null),[c,d]=C.useState(""),[f,p]=C.useState(null),[g,y]=C.useState(!1),[v,_]=C.useState(null),[b,E]=C.useState(1),[k]=C.useState(e.max_attempts||3),[w,N]=C.useState(!1),[A,P]=C.useState(0),R=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,[T,D]=C.useState(0),[I,V]=C.useState(null),X=zi(),{user:Z}=Bn(),{makeAuthenticatedRequest:ie}=X,q=C.useRef(null);C.useEffect(()=>{if(e?.test_id&&Z?.student_id){const Y=`speaking_attempts_${Z.student_id}_${e.test_id}`,te=localStorage.getItem(Y);if(te){const ee=parseInt(te,10);ee>0&&ee<=k&&(E(ee),console.log("🔄 Loaded attempts from localStorage:",ee))}}},[e,Z,k]),C.useEffect(()=>{if(e&&!I){const Y=new Date;V(Y),console.log("⏱️ Speaking test timer started at:",Y.toISOString())}},[e,I]),C.useEffect(()=>{let Y=0;s==="recording"?Y=25:s==="processing"?Y=50:s==="feedback"?Y=75:s==="completed"&&(Y=100),D(Y)},[s]),C.useEffect(()=>{(async()=>{try{if(console.log("🎤 Automatically requesting microphone permission..."),!window.isSecureContext&&!window.location.hostname.includes("localhost")){_("Microphone access requires HTTPS. Please use a secure connection.");return}if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){_("Microphone access is not supported in this browser. Please use a modern browser like Chrome, Safari, or Firefox.");return}if(R())return;const te=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});console.log("🎤 Microphone permission granted!"),N(!0),te.getTracks().forEach(ee=>ee.stop())}catch(te){console.error("🎤 Microphone permission denied:",te),te.name==="NotAllowedError"?_("Microphone access denied. Please allow microphone access in your browser settings and refresh the page."):te.name==="NotFoundError"?_("No microphone found. Please connect a microphone and try again."):_("Microphone access failed. Please check your browser settings and try again.")}})()},[]),C.useEffect(()=>{const Y=setInterval(()=>{i&&s==="recording"&&ne()},3e4);return()=>clearInterval(Y)},[i,s]);const ne=C.useCallback(async()=>{try{const Y={test_id:e.test_id,audio_blob:i?await M(i):null,attempt_number:b,step:s,timestamp:new Date().toISOString()};localStorage.setItem(`speaking_progress_${e.test_id}`,JSON.stringify(Y))}catch(Y){console.error("Failed to save progress:",Y)}},[e.test_id,i,b,s]),M=Y=>new Promise((te,ee)=>{const ae=new FileReader;ae.onloadend=()=>{const _e=ae.result.split(",")[1];te(_e)},ae.onerror=ee,ae.readAsDataURL(Y)}),W=C.useCallback(Y=>{if(e?.test_id&&Z?.student_id){const te=`speaking_attempts_${Z.student_id}_${e.test_id}`;localStorage.setItem(te,Y.toString()),console.log("💾 Saved attempts to localStorage:",Y)}},[e,Z]),L=C.useCallback(async(Y,te,ee,ae,ge)=>{if(e?.test_id&&Z?.student_id)try{const{setCachedData:_e,CACHE_TTL:Me}=await Uo(async()=>{const{setCachedData:qe,CACHE_TTL:Xe}=await Promise.resolve().then(()=>Ih);return{setCachedData:qe,CACHE_TTL:Xe}},void 0),ue=`speaking_test_data_${Z.student_id}_${e.test_id}`,He={audioBlob:Y?await M(Y):null,transcript:te,scores:ee,recordingTime:ae,currentStep:ge,timestamp:Date.now()};_e(ue,He,Me.speaking_test_data),console.log("💾 Saved speaking test data to cache:",ue)}catch(_e){console.error("Failed to save speaking test data to cache:",_e)}},[e,Z]),H=C.useCallback(async()=>{if(e?.test_id&&Z?.student_id)try{const{getCachedData:Y}=await Uo(async()=>{const{getCachedData:ae}=await Promise.resolve().then(()=>Ih);return{getCachedData:ae}},void 0),te=`speaking_test_data_${Z.student_id}_${e.test_id}`,ee=Y(te);if(ee){if(console.log("💾 Loaded speaking test data from cache:",ee),ee.audioBlob){const ae=new Blob([Uint8Array.from(atob(ee.audioBlob),ge=>ge.charCodeAt(0))],{type:"audio/webm"});l(ae)}return ee.transcript&&d(ee.transcript),ee.scores&&p(ee.scores),ee.recordingTime&&P(ee.recordingTime),ee.currentStep&&a(ee.currentStep),!0}}catch(Y){console.error("Failed to load speaking test data from cache:",Y)}return!1},[e,Z]);C.useEffect(()=>{e?.test_id&&Z?.student_id&&H()},[e,Z,H]),C.useEffect(()=>{e?.test_id&&Z?.student_id&&(i||c||f)&&L(i,c,f,A,s)},[i,c,f,A,s,e,Z,L]);const K=C.useCallback(async(Y,te)=>{console.log("🎤 Recording completed, duration:",te),l(Y),P(te),a("processing"),_(null);try{const ee=await M(Y),ae=new Date,ge=e.start_time?Math.round((ae-e.start_time)/1e3):0,_e=e.start_time?new Date(e.start_time).toISOString():ae.toISOString(),Me=Z.student_id,ue=`retest_assignment_id_${Me}_speaking_${e.test_id}`,me=localStorage.getItem(ue),He={test_id:e.test_id,test_name:e.test_name,teacher_id:e.teacher_id||null,subject_id:e.subject_id||null,student_id:Me,question_id:e.question_id||1,audio_blob:ee,audio_duration:Y.duration||0,time_taken:ge,started_at:_e,submitted_at:ae.toISOString(),caught_cheating:!1,visibility_change_times:0,is_completed:!0,retest_assignment_id:me?Number(me):null,parent_test_id:e.test_id};console.log("🎤 Submitting speaking test:",He),console.log("🎤 Processing audio with AI...");try{const Xe=await(await ie("/.netlify/functions/process-speaking-audio-ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_id:e.test_id,question_id:e.question_id||1,audio_blob:ee})})).json();if(Xe.success){console.log("🎤 AI Analysis Result:",Xe),d(Xe.transcript);const Ve=Xe.transcript?Xe.transcript.split(/\s+/).filter(Ie=>Ie.length>0).length:0;console.log("🎤 Word Count Verification:",{aiCount:Xe.word_count,actualCount:Ve,transcript:Xe.transcript});const It=Ve,st={overall_score:Xe.overall_score,word_count:It,grammar_score:Xe.grammar_score,vocabulary_score:Xe.vocabulary_score,pronunciation_score:Xe.pronunciation_score,fluency_score:Xe.fluency_score,content_score:Xe.content_score,grammar_mistakes:Xe.grammar_mistakes,vocabulary_mistakes:Xe.vocabulary_mistakes,feedback:Xe.feedback,improved_transcript:Xe.improved_transcript,grammar_corrections:Xe.grammar_corrections||[],vocabulary_corrections:Xe.vocabulary_corrections||[]};console.log("🎤 Mapped Scores:",st),console.log("🎤 Individual scores check:",{grammar_score:Xe.grammar_score,vocabulary_score:Xe.vocabulary_score,pronunciation_score:Xe.pronunciation_score,fluency_score:Xe.fluency_score,content_score:Xe.content_score}),p(st),a("feedback")}else throw new Error(Xe.message||"Failed to process audio with AI");localStorage.removeItem(`speaking_progress_${e.test_id}`)}catch(qe){console.error("Speaking test submission error:",qe),qe.message.includes("No valid authentication token found")?(_("Your session has expired. Please refresh the page and try again."),setTimeout(()=>{window.location.reload()},3e3)):_(qe.message),a("recording")}}catch(ee){console.error("Speaking test submission error:",ee),_(ee.message),a("recording")}},[e,Z,ie,b,W]),B=C.useCallback(()=>{if(b<k){l(null),d(""),p(null),_(null);const Y=b+1;E(Y),W(Y),a("recording")}else _("Maximum attempts reached")},[b,k,W]),z=C.useCallback(async()=>{if(!(!c||!f)){y(!0);try{const Y=new Date,te=e.start_time?Math.round((Y-e.start_time)/1e3):0,ee=e.start_time?new Date(e.start_time).toISOString():Y.toISOString(),ae=Z.student_id,ge=`retest_assignment_id_${ae}_speaking_${e.test_id}`,_e=localStorage.getItem(ge),Me={test_id:e.test_id,test_name:e.test_name,teacher_id:e.teacher_id||null,subject_id:e.subject_id||null,student_id:ae,question_id:e.question_id||1,audio_blob:i?await M(i):null,audio_duration:i?.duration||0,time_taken:te,started_at:ee,submitted_at:Y.toISOString(),caught_cheating:!1,visibility_change_times:0,is_completed:!0,retest_assignment_id:_e?Number(_e):null,parent_test_id:e.test_id,transcript:c,scores:f,final_submission:!0};console.log("🎤 Final submission:",Me),console.log("🎤 Making final submission request...");const ue=await ie("/.netlify/functions/submit-speaking-test-final",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Me)});console.log("🎤 Final submission response status:",ue.status);const me=await ue.json();if(console.log("🎤 Final submission result:",me),me.success){if(Z?.student_id){const Ie=`test_completed_${Z.student_id}_speaking_${e.test_id}`;localStorage.setItem(Ie,"true"),console.log("✅ Speaking test marked as completed in localStorage:",Ie);const je=`speaking_attempts_${Z.student_id}_${e.test_id}`;localStorage.removeItem(je),console.log("🗑️ Cleared attempts from localStorage upon submission");const{clearTestData:Ze}=await Uo(async()=>{const{clearTestData:bt}=await Promise.resolve().then(()=>Ih);return{clearTestData:bt}},void 0);Ze(Z.student_id,"speaking_test_data",e.test_id),console.log("🗑️ Cleared speaking test data from cache upon submission")}console.log("🎤 Caching speaking test results after submission...");const qe=`student_results_table_${Z?.student_id||Z?.id||"unknown"}`,{setCachedData:Xe,CACHE_TTL:Ve,clearTestData:It}=await Uo(async()=>{const{setCachedData:Ie,CACHE_TTL:je,clearTestData:Ze}=await Promise.resolve().then(()=>Ih);return{setCachedData:Ie,CACHE_TTL:je,clearTestData:Ze}},void 0),st={success:!0,results:[{id:Date.now(),test_id:e.test_id,test_type:"speaking",test_name:e.test_name,score:Math.round(f.overall_score/10),max_score:10,percentage:f.overall_score,caught_cheating:!1,visibility_change_times:0,is_completed:!0,submitted_at:new Date().toISOString(),academic_period_id:3,subject:"Listening and Speaking",teacher_name:e.teacher_name||"Unknown"}]};Xe(qe,st,Ve.student_results_table),console.log("🎤 Speaking test results cached with key:",qe),Z?.student_id&&It(Z.student_id,"speaking",e.test_id),a("completed"),t({test_id:e.test_id,transcript:c,scores:f,attempt_number:b}),n&&n(f.overall_score)}else throw new Error(me.message||"Failed to submit speaking test")}catch(Y){console.error("Speaking test submission error:",Y),_(Y.message)}finally{y(!1)}}},[e,Z,ie,c,f,i,b,t]);C.useCallback(()=>{a("completed"),t({test_id:e.test_id,transcript:c,scores:f,attempt_number:b})},[e.test_id,c,f,b,t]);const Q=()=>{switch(s){case"recording":return o.jsxs("div",{className:"speaking-test-recording",children:[o.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:e.test_name}),o.jsxs("div",{className:"mb-6 text-center",children:[o.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Instructions:"}),o.jsx("p",{className:"text-gray-700 mb-4",children:e.prompt}),o.jsx("div",{className:"bg-blue-50 p-3 sm:p-4 rounded-lg",children:o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Requirements:"})," Minimum ",e.min_words||50," words, 0-",e.max_duration||600," seconds duration"]})})]}),o.jsx(Uz,{ref:q,onRecordingComplete:K,minDuration:0,maxDuration:e.max_duration||600,minWords:e.min_words||50,maxAttempts:k,currentAttempt:b}),v&&o.jsx("div",{className:"mt-4 p-3 sm:p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-800",children:v})})]});case"processing":return o.jsxs("div",{className:"transcription-status bg-white rounded-lg shadow-lg p-4 sm:p-8 text-center",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("div",{className:"text-6xl mb-4",children:"⏳"}),o.jsx("h3",{className:"text-2xl font-semibold mb-2",children:"Processing Your Speech"}),o.jsx("p",{className:"text-lg text-blue-600",children:"Please wait while we process your audio..."})]}),o.jsxs("div",{className:"inline-flex space-x-1",children:[o.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce"}),o.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),o.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]});case"feedback":return console.log("🎤 Rendering feedback step with Submit Final button"),o.jsx($z,{transcript:c,scores:f,audioBlob:i,recordingTime:A,onReRecord:B,onFinalSubmit:z,canReRecord:b<k,attemptNumber:b,maxAttempts:k,isSubmitting:g});case"completed":const Y={showResults:!0,testInfo:{test_name:e?.test_name||"Speaking Test",id:e?.test_id,test_id:e?.test_id},testType:"speaking",score:f?.overall_score||0,totalQuestions:1,percentage:f?.overall_score||0,passed:(f?.overall_score||0)>=50,questionAnalysis:[{questionNumber:1,userAnswer:c,correctAnswer:"Speaking test completed",isCorrect:!0,score:f?.overall_score||0,maxScore:100,feedback:`Word Count: ${f?.word_count||0}, Grammar: ${f?.grammar_score||0}/40, Vocabulary: ${f?.vocab_score||0}/30`}],timestamp:new Date().toISOString(),caught_cheating:!1,visibility_change_times:0};return o.jsx("div",{className:"speaking-test-completed",children:o.jsx(Hp,{testResults:Y,onBackToCabinet:r,onRetakeTest:()=>{a("recording"),d(""),p(null),l(null),E(1)},isLoading:!1})});default:return null}};return o.jsx("div",{children:o.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-3 sm:p-6",children:[v&&o.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-800",children:v})}),Q()]})})},zz=()=>{const{testId:e}=Ny(),t=Ei(),{user:r}=Bn(),n=zi(),[s,a]=C.useState(null),[i,l]=C.useState([]),[c,d]=C.useState(!0),[f,p]=C.useState(null),[g,y]=C.useState(!1),[v,_]=C.useState(null);C.useEffect(()=>{b(),E()},[e]);const b=async()=>{try{d(!0);const A=await n.getSpeakingTest(e);if(A.success)a(A.test);else throw new Error(A.message||"Failed to load test");const P=await n.getSpeakingTestQuestions(e);P.success&&l(P.questions)}catch(A){console.error("Error loading test data:",A),p(A.message)}finally{d(!1)}},E=()=>{const P=`test_completed_${r?.student_id||r?.id}_speaking_${e}`;if(localStorage.getItem(P)==="true"){y(!0);const T=localStorage.getItem(`speaking_test_result_${e}`);T&&_(JSON.parse(T))}},k=async A=>{try{y(!0),_(A),localStorage.setItem(`speaking_test_result_${e}`,JSON.stringify(A)),window.dispatchEvent(new CustomEvent("testCompleted",{detail:{testId:e,testType:"speaking"}})),setTimeout(()=>{t("/student")},2e3)}catch(P){console.error("Error handling test completion:",P)}},w=()=>{t("/student")};if(c)return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test"})}),o.jsx(nt,{variant:"outline",onClick:w,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),o.jsx("p",{className:"text-gray-600 mt-4",children:"Loading speaking test..."})]})})})]});if(f)return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test"})}),o.jsx(nt,{variant:"outline",onClick:w,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-red-600 text-6xl mb-4",children:"⚠️"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error Loading Test"}),o.jsx("p",{className:"text-gray-600 mb-6",children:f})]})})})]});if(g&&v)return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test Results"})}),o.jsx(nt,{variant:"outline",onClick:w,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx(Hp,{testType:"speaking",testData:s,result:v,onRetake:()=>{y(!1),_(null);const A=JSON.parse(localStorage.getItem("userData")||"{}").student_id;localStorage.removeItem(`test_completed_${A}_speaking_${e}`)}})})]});if(!s||i.length===0)return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test"})}),o.jsx(nt,{variant:"outline",onClick:w,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📝"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Test Data"}),o.jsx("p",{className:"text-gray-600 mb-6",children:"Unable to load test information"})]})})})]});const N=i[0];return o.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-y-auto",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsx("div",{children:o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Speaking Test"})}),o.jsx(nt,{variant:"outline",onClick:w,children:"Back to Cabinet"})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsx(Wz,{testData:{...s,test_id:parseInt(e),question_id:N?.id,prompt:N?.prompt,start_time:Date.now()},onComplete:k,onExit:w,onTestComplete:k})})]})},Hz=()=>{const{testType:e,testId:t}=Ny(),r=Ei(),{activeTests:n}=zp(),s=()=>{r("/student")},a=n.find(i=>i.test_type===e&&i.test_id===parseInt(t));return o.jsx(Oz,{onBackToCabinet:s,currentTest:a||{test_type:e,test_id:parseInt(t)}})},Gz=()=>{const e=Ei(),{user:t,isAuthenticated:r,isLoading:n}=Bn(),[s,a]=C.useState(!1),[i,l]=C.useState(!0),[c,d]=C.useState(""),[f,p]=C.useState([]),[g,y]=C.useState(!1),[v,_]=C.useState(!1),[b,E]=C.useState({currentPassword:"",newPassword:"",confirmPassword:""}),k=C.useCallback(async()=>{console.log("🎓 Initializing Student Application...");try{if(l(!0),d(""),!r||!t){console.log("🎓 User not authenticated, redirecting to login"),e("/login");return}if(t.role!==si.STUDENT){console.error("🎓 Invalid user role for student app:",t.role),d("Access denied. Student role required.");return}console.log("🎓 Initializing event listeners..."),w(),console.log("🎓 Setting up back to cabinet button listeners..."),N(),console.log("🎓 Setting up password change form listener..."),A(),console.log("🎓 Loading student data..."),await P(),console.log("🎓 Exposing student functions globally..."),R(),console.log("🎓 Populating student info from user data..."),Z(t),a(!0),console.log("🎓 Student Application initialization complete!")}catch(ne){console.error("🎓 Error initializing student app:",ne),d("Failed to initialize student application")}finally{l(!1)}},[r,t,e]);C.useEffect(()=>{n||k()},[n,r,t,k]);const w=C.useCallback(()=>{console.log("🎓 Setting up student event listeners...");const ne=W=>{g&&!W.target.closest(".student-menu")&&y(!1)},M=W=>{W.key==="Escape"&&g&&y(!1)};return document.addEventListener("click",ne),document.addEventListener("keydown",M),()=>{document.removeEventListener("click",ne),document.removeEventListener("keydown",M)}},[g]),N=C.useCallback(()=>{console.log("🎓 Setting up back to cabinet listeners...")},[]),A=C.useCallback(()=>{console.log("🎓 Setting up password change form...")},[]),P=C.useCallback(async()=>{console.log("🎓 Loading student data...");try{console.log("🎓 Student data loaded successfully")}catch(ne){throw console.error("🎓 Error loading student data:",ne),ne}},[]),R=C.useCallback(()=>{console.log("🎓 Exposing student functions globally..."),window.toggleStudentMenu=T,window.showChangePasswordTab=D,window.hideChangePasswordTab=I,window.navigateBackToCabinet=X,window.handlePasswordChange=V,window.populateStudentInfoDirectly=Z,console.log("🎓 All student functions exposed globally")},[]),T=C.useCallback(()=>{console.log("🔧 toggleStudentMenu called"),y(ne=>{const M=!ne;return console.log("🔧 Menu state changed from",ne,"to",M),M}),console.log("🔧 Toggled dropdown menu")},[]),D=C.useCallback(()=>{console.log("🔧 showChangePasswordTab called"),_(!0),y(!1)},[]),I=C.useCallback(()=>{console.log("🔧 hideChangePasswordTab called"),_(!1),E({currentPassword:"",newPassword:"",confirmPassword:""})},[]),V=C.useCallback(async ne=>{ne.preventDefault(),console.log("🔧 handlePasswordChange called");const{currentPassword:M,newPassword:W,confirmPassword:L}=b;if(!M||!W||!L){ie("Please fill in all fields","error");return}if(W!==L){ie("New passwords do not match","error");return}if(W.length<6){ie("New password must be at least 6 characters long","error");return}const H=/[a-zA-Z]/.test(W),K=/[0-9]/.test(W);if(!H||!K){ie("New password must contain both letters and numbers","error");return}if(!t||!t.student_id){ie("Session expired. Please login again.","error");return}const B=t.student_id;if(window.confirm("Are you sure you want to change your password?"))try{l(!0);const z=await _n.changePassword({studentId:B,currentPassword:M,newPassword:W});z.success?(ie("Password changed successfully!","success"),I()):ie(z.message||"Failed to change password","error")}catch(z){console.error("Password change error:",z),ie("Failed to change password. Please try again.","error")}finally{l(!1)}},[b,t]),X=C.useCallback(()=>{if(console.log("[DEBUG] navigateBackToCabinet called"),!r||!t){console.warn("[WARN] No valid user found, redirecting to login"),e("/login");return}t.role===si.STUDENT?(console.log("[DEBUG] Navigating to student cabinet"),e("/student")):(console.warn("[WARN] Unknown user role, redirecting to login"),e("/login"))},[r,t,e]),Z=C.useCallback(ne=>{console.log("🎓 populateStudentInfoDirectly called with:",ne);try{console.log("🎓 Student info populated successfully")}catch(M){console.error("🎓 Error populating student info:",M)}},[]),ie=C.useCallback((ne,M)=>{const W={id:Date.now(),message:ne,type:M,timestamp:new Date};p(L=>[...L,W]),setTimeout(()=>{p(L=>L.filter(H=>H.id!==W.id))},wi.NOTIFICATION_DURATION)},[]),q=C.useCallback(ne=>{const{name:M,value:W}=ne.target;E(L=>({...L,[M]:W}))},[]);return i?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Initializing Student Application..."})]})}):c?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Initialization Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:c}),o.jsx(nt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):s?o.jsxs("div",{className:"bg-gray-50",children:[o.jsxs(b2,{children:[o.jsx(ss,{path:"/",element:o.jsxs("div",{className:"student-app",children:[o.jsx(Iz,{isMenuOpen:g,onToggleMenu:T,onShowPasswordChange:D}),v&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Change Password"}),o.jsxs("form",{onSubmit:V,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),o.jsx("input",{type:"password",id:"currentPassword",name:"currentPassword",value:b.currentPassword,onChange:q,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),o.jsx("input",{type:"password",id:"newPassword",name:"newPassword",value:b.newPassword,onChange:q,required:!0,minLength:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),o.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:b.confirmPassword,onChange:q,required:!0,minLength:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),o.jsxs("div",{className:"flex space-x-3 pt-4",children:[o.jsx(nt,{type:"button",variant:"secondary",onClick:I,className:"flex-1",children:"Cancel"}),o.jsx(nt,{type:"submit",variant:"primary",disabled:i,className:"flex-1",children:i?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",className:"mr-2"}),"Changing..."]}):"Change Password"})]})]})]})})]})}),o.jsx(ss,{path:"/test/:testType/:testId",element:o.jsx(Hz,{})}),o.jsx(ss,{path:"matching-test/:testId",element:o.jsx(Lz,{})}),o.jsx(ss,{path:"word-matching-test/:testId",element:o.jsx(Bz,{})}),o.jsx(ss,{path:"speaking-test/:testId",element:o.jsx(zz,{})}),o.jsx(ss,{path:"/results",element:o.jsx(Jj,{})})]}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:f.map(ne=>o.jsx(Ko,{type:ne.type,message:ne.message,onClose:()=>p(M=>M.filter(W=>W.id!==ne.id))},ne.id))})]}):o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Setting up Student Application..."})]})})},Vz=()=>o.jsx(W3,{children:o.jsx(Uj,{children:o.jsx(Lj,{children:o.jsx(Gz,{})})})}),Kz=({result:e,isOpen:t,onClose:r,initialTab:n="overview",editingSpeakingScore:s,tempSpeakingScore:a,isSavingSpeakingScore:i,onStartSpeakingScoreEdit:l,onSaveSpeakingScore:c,onCancelSpeakingScoreEdit:d,onTempSpeakingScoreChange:f})=>{const[p,g]=C.useState(n),y=C.useRef(!1);if(C.useEffect(()=>()=>{y.current=!0},[]),C.useEffect(()=>{t&&g(n)},[t,n]),!t||!e)return null;const v={test_id:e.test_id,test_name:e.test_name,subject_id:e.subject_id};let _=e?.__audioUrl||void 0;const b=_?void 0:e?.answers;typeof b=="string"?_=b:b&&typeof b=="object"&&(_=b.audio_url),C.useEffect(()=>{console.log("[SpeakingReview] Transcript sources",{fromResult:e?.transcript,fromAnswersObject:typeof b=="object"&&b?.transcript?b.transcript:void 0,hasAnswers:!!b,test_id:e?.test_id,student_id:e?.student_id})},[e?.test_id,e?.student_id]);const[E,k]=C.useState("");C.useEffect(()=>{const N=new AbortController;let A=!1;const P=e?.__studentId||e?.student_id;return!e?.transcript&&!(typeof b=="object"&&b?.transcript)&&e?.test_id&&P&&(async()=>{try{const R=`/.netlify/functions/get-speaking-test-new?action=transcript&test_id=${encodeURIComponent(e.test_id)}&student_id=${encodeURIComponent(P)}`;console.log("[SpeakingReview] Fetching transcript from API:",{url:R});const T=localStorage.getItem("auth_token")||localStorage.getItem("accessToken")||localStorage.getItem("token"),D=await fetch(R,{headers:{Authorization:T?`Bearer ${T}`:""},signal:N.signal});console.log("[SpeakingReview] Transcript API response:",{ok:D.ok,status:D.status});const I=await D.json().catch(()=>({}));console.log("[SpeakingReview] Transcript API body:",I),!A&&!y.current&&(D.ok?k(I.transcript||""):console.warn("[SpeakingReview] Transcript API failed:",I?.error||"unknown error"))}catch(R){R.name!=="AbortError"&&!y.current&&console.error("[SpeakingReview] Transcript fetch error:",R)}})(),()=>{A=!0;try{N.abort()}catch{}}},[e]);const w={score:e.score,max_score:e.max_score,percentage:e.percentage,audio_url:_,transcript:e.transcript||E||(typeof b=="object"&&b?.transcript?b.transcript:void 0),time_taken:e.time_taken,started_at:e.started_at,submitted_at:e.submitted_at};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center",children:[o.jsxs("h2",{className:"text-xl font-semibold",children:["Speaking Test Review - ",v.test_name]}),o.jsx("button",{onClick:r,className:"text-white hover:text-gray-200 text-2xl font-bold",children:"×"})]}),o.jsx("div",{className:"border-b border-gray-200",children:o.jsx("nav",{className:"flex space-x-8 px-6",children:[{id:"overview",label:"Overview"},{id:"audio",label:"Audio"},{id:"transcript",label:"Transcript"},{id:"analysis",label:"AI Analysis"},{id:"scoring",label:"Scoring"}].map(N=>o.jsx("button",{onClick:()=>g(N.id),className:`py-4 px-1 border-b-2 font-medium text-sm ${p===N.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:N.label},N.id))})}),o.jsxs("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:[p==="overview"&&o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Test Name"}),o.jsx("p",{className:"mt-1 text-sm text-gray-900",children:v.test_name})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Score"}),o.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[w.score," / ",w.max_score," (",w.percentage,"%)"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Time Taken"}),o.jsx("p",{className:"mt-1 text-sm text-gray-900",children:w.time_taken?`${Math.floor(w.time_taken/60)}:${(w.time_taken%60).toString().padStart(2,"0")}`:"N/A"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Submitted At"}),o.jsx("p",{className:"mt-1 text-sm text-gray-900",children:w.submitted_at?new Date(w.submitted_at).toLocaleString():"N/A"})]})]})}),p==="audio"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Audio Recording"}),w.audio_url?o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-sm text-gray-600",children:"Click the play button to listen to the student's recording:"}),o.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:o.jsx(Zj,{audioUrl:w.audio_url,className:"w-full"})})]}):o.jsx("div",{className:"text-center py-8 text-gray-500",children:o.jsx("p",{children:"No audio recording available"})})]}),p==="transcript"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transcript"}),w.transcript?o.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:o.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:w.transcript})}):o.jsx("div",{className:"text-center py-8 text-gray-500",children:o.jsx("p",{children:"No transcript available"})})]}),p==="analysis"&&o.jsxs("div",{className:"space-y-6",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"AI Analysis Results"}),o.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-4",children:"AI Analysis Results"}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold text-gray-800",children:e.overall_score||0}),o.jsx("div",{className:"text-sm text-gray-600",children:"Overall Score (0-100)"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"Performance Metrics"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Word Count:"}),o.jsx("span",{className:"text-sm font-medium",children:e.word_count||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Grammar Mistakes:"}),o.jsx("span",{className:"text-sm font-medium text-red-600",children:e.grammar_mistakes||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Vocabulary Issues:"}),o.jsx("span",{className:"text-sm font-medium text-red-600",children:e.vocabulary_mistakes||0})]})]})]}),o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"AI Feedback"}),e.feedback?o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:o.jsx("p",{className:"text-sm text-gray-700",children:e.feedback})}):o.jsx("div",{className:"text-center py-4 text-gray-500",children:o.jsx("p",{className:"text-sm",children:"No AI feedback available"})})]})]}),o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-4",children:"Score Summary"}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:[e.overall_score||0,"/100"]}),o.jsx("div",{className:"text-sm text-gray-600",children:e.overall_score>=80?"Excellent":e.overall_score>=60?"Good":e.overall_score>=40?"Fair":"Needs Improvement"})]})]})]}),p==="scoring"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Score Details"}),s?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Score"}),o.jsx("input",{type:"number",min:"0",max:w.max_score,value:a,onChange:N=>f(N.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Max Score"}),o.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[w.max_score," (Fixed)"]})]})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx("button",{onClick:c,disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:i?"Saving...":"Save Score"}),o.jsx("button",{onClick:d,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Cancel"})]})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Current Score"}),o.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[w.score," / ",w.max_score]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Percentage"}),o.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[w.percentage,"%"]})]})]}),o.jsx("button",{onClick:()=>l(e.id,w.score),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit Score"})]})]})]}),o.jsx("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3",children:o.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Close"})})]})})};class hN extends ns.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){if(console.error("ErrorBoundary caught an error:",t,r),t.message&&t.message.includes("Minified React error #300")){console.warn("React error #300 caught and handled by ErrorBoundary");return}}render(){return this.state.hasError?o.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[o.jsx("h3",{className:"text-red-800 font-medium",children:"Something went wrong"}),o.jsx("p",{className:"text-red-600 text-sm mt-1",children:"An error occurred while rendering this component."})]}):this.props.children}}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var fy={};fy.version="0.18.5";var e8=1252,qz=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],sS={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},aS=function(e){qz.indexOf(e)!=-1&&(e8=sS[0]=e)};function Xz(){aS(1252)}var Wo=function(e){aS(e)};function iS(){Wo(1200),Xz()}function gN(e){for(var t=[],r=0,n=e.length;r<n;++r)t[r]=e.charCodeAt(r);return t}function Yz(e){for(var t=[],r=0;r<e.length>>1;++r)t[r]=String.fromCharCode(e.charCodeAt(2*r)+(e.charCodeAt(2*r+1)<<8));return t.join("")}function t8(e){for(var t=[],r=0;r<e.length>>1;++r)t[r]=String.fromCharCode(e.charCodeAt(2*r+1)+(e.charCodeAt(2*r)<<8));return t.join("")}var Sm=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1);return t==255&&r==254?Yz(e.slice(2)):t==254&&r==255?t8(e.slice(2)):t==65279?e.slice(1):e},p1=function(t){return String.fromCharCode(t)},mN=function(t){return String.fromCharCode(t)},lp,Nu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function cp(e){for(var t="",r=0,n=0,s=0,a=0,i=0,l=0,c=0,d=0;d<e.length;)r=e.charCodeAt(d++),a=r>>2,n=e.charCodeAt(d++),i=(r&3)<<4|n>>4,s=e.charCodeAt(d++),l=(n&15)<<2|s>>6,c=s&63,isNaN(n)?l=c=64:isNaN(s)&&(c=64),t+=Nu.charAt(a)+Nu.charAt(i)+Nu.charAt(l)+Nu.charAt(c);return t}function Wi(e){var t="",r=0,n=0,s=0,a=0,i=0,l=0,c=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var d=0;d<e.length;)a=Nu.indexOf(e.charAt(d++)),i=Nu.indexOf(e.charAt(d++)),r=a<<2|i>>4,t+=String.fromCharCode(r),l=Nu.indexOf(e.charAt(d++)),n=(i&15)<<4|l>>2,l!==64&&(t+=String.fromCharCode(n)),c=Nu.indexOf(e.charAt(d++)),s=(l&3)<<6|c,c!==64&&(t+=String.fromCharCode(s));return t}var Lr=(function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node})(),jc=(function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(t,r){return r?new Buffer(t,r):new Buffer(t)}:Buffer.from.bind(Buffer)}return function(){}})();function Bu(e){return Lr?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function pN(e){return Lr?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var Bi=function(t){return Lr?jc(t,"binary"):t.split("").map(function(r){return r.charCodeAt(0)&255})};function Zy(e){if(typeof ArrayBuffer>"u")return Bi(e);for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n!=e.length;++n)r[n]=e.charCodeAt(n)&255;return t}function Yu(e){if(Array.isArray(e))return e.map(function(n){return String.fromCharCode(n)}).join("");for(var t=[],r=0;r<e.length;++r)t[r]=String.fromCharCode(e[r]);return t.join("")}function Qz(e){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(e)}function oS(e){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(e instanceof ArrayBuffer)return oS(new Uint8Array(e));for(var t=new Array(e.length),r=0;r<e.length;++r)t[r]=e[r];return t}var ta=Lr?function(e){return Buffer.concat(e.map(function(t){return Buffer.isBuffer(t)?t:jc(t)}))}:function(e){if(typeof Uint8Array<"u"){var t=0,r=0;for(t=0;t<e.length;++t)r+=e[t].length;var n=new Uint8Array(r),s=0;for(t=0,r=0;t<e.length;r+=s,++t)if(s=e[t].length,e[t]instanceof Uint8Array)n.set(e[t],r);else{if(typeof e[t]=="string")throw"wtf";n.set(new Uint8Array(e[t]),r)}return n}return[].concat.apply([],e.map(function(a){return Array.isArray(a)?a:[].slice.call(a)}))};function Jz(e){for(var t=[],r=0,n=e.length+250,s=Bu(e.length+255),a=0;a<e.length;++a){var i=e.charCodeAt(a);if(i<128)s[r++]=i;else if(i<2048)s[r++]=192|i>>6&31,s[r++]=128|i&63;else if(i>=55296&&i<57344){i=(i&1023)+64;var l=e.charCodeAt(++a)&1023;s[r++]=240|i>>8&7,s[r++]=128|i>>2&63,s[r++]=128|l>>6&15|(i&3)<<4,s[r++]=128|l&63}else s[r++]=224|i>>12&15,s[r++]=128|i>>6&63,s[r++]=128|i&63;r>n&&(t.push(s.slice(0,r)),r=0,s=Bu(65535),n=65530)}return t.push(s.slice(0,r)),ta(t)}var oi=/\u0000/g,km=/[\u0001-\u0006]/g;function Jh(e){for(var t="",r=e.length-1;r>=0;)t+=e.charAt(r--);return t}function zo(e,t){var r=""+e;return r.length>=t?r:as("0",t-r.length)+r}function lS(e,t){var r=""+e;return r.length>=t?r:as(" ",t-r.length)+r}function hy(e,t){var r=""+e;return r.length>=t?r:r+as(" ",t-r.length)}function Zz(e,t){var r=""+Math.round(e);return r.length>=t?r:as("0",t-r.length)+r}function eH(e,t){var r=""+e;return r.length>=t?r:as("0",t-r.length)+r}var xN=Math.pow(2,32);function Ch(e,t){if(e>xN||e<-xN)return Zz(e,t);var r=Math.round(e);return eH(r,t)}function gy(e,t){return t=t||0,e.length>=7+t&&(e.charCodeAt(t)|32)===103&&(e.charCodeAt(t+1)|32)===101&&(e.charCodeAt(t+2)|32)===110&&(e.charCodeAt(t+3)|32)===101&&(e.charCodeAt(t+4)|32)===114&&(e.charCodeAt(t+5)|32)===97&&(e.charCodeAt(t+6)|32)===108}var yN=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Uw=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function tH(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',e}var wr={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},vN={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},rH={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function my(e,t,r){for(var n=e<0?-1:1,s=e*n,a=0,i=1,l=0,c=1,d=0,f=0,p=Math.floor(s);d<t&&(p=Math.floor(s),l=p*i+a,f=p*d+c,!(s-p<5e-8));)s=1/(s-p),a=i,i=l,c=d,d=f;if(f>t&&(d>t?(f=c,l=a):(f=d,l=i)),!r)return[0,n*l,f];var g=Math.floor(n*l/f);return[g,n*l-g*f,f]}function Bd(e,t,r){if(e>2958465||e<0)return null;var n=e|0,s=Math.floor(86400*(e-n)),a=0,i=[],l={D:n,T:s,u:86400*(e-n)-s,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(l.u)<1e-6&&(l.u=0),t&&t.date1904&&(n+=1462),l.u>.9999&&(l.u=0,++s==86400&&(l.T=s=0,++n,++l.D)),n===60)i=r?[1317,10,29]:[1900,2,29],a=3;else if(n===0)i=r?[1317,8,29]:[1900,1,0],a=6;else{n>60&&--n;var c=new Date(1900,0,1);c.setDate(c.getDate()+n-1),i=[c.getFullYear(),c.getMonth()+1,c.getDate()],a=c.getDay(),n<60&&(a=(a+6)%7),r&&(a=lH(c,i))}return l.y=i[0],l.m=i[1],l.d=i[2],l.S=s%60,s=Math.floor(s/60),l.M=s%60,s=Math.floor(s/60),l.H=s,l.q=a,l}var r8=new Date(1899,11,31,0,0,0),nH=r8.getTime(),sH=new Date(1900,2,1,0,0,0);function n8(e,t){var r=e.getTime();return t?r-=1461*24*60*60*1e3:e>=sH&&(r+=1440*60*1e3),(r-(nH+(e.getTimezoneOffset()-r8.getTimezoneOffset())*6e4))/(1440*60*1e3)}function cS(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function aH(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function iH(e){var t=e<0?12:11,r=cS(e.toFixed(12));return r.length<=t||(r=e.toPrecision(10),r.length<=t)?r:e.toExponential(5)}function oH(e){var t=cS(e.toFixed(11));return t.length>(e<0?12:11)||t==="0"||t==="-0"?e.toPrecision(6):t}function up(e){var t=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),r;return t>=-4&&t<=-1?r=e.toPrecision(10+t):Math.abs(t)<=9?r=iH(e):t===10?r=e.toFixed(10).substr(0,12):r=oH(e),cS(aH(r.toUpperCase()))}function df(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):up(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return vo(14,n8(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function lH(e,t){t[0]-=581;var r=e.getDay();return e<60&&(r=(r+6)%7),r}function cH(e,t,r,n){var s="",a=0,i=0,l=r.y,c,d=0;switch(e){case 98:l=r.y+543;case 121:switch(t.length){case 1:case 2:c=l%100,d=2;break;default:c=l%1e4,d=4;break}break;case 109:switch(t.length){case 1:case 2:c=r.m,d=t.length;break;case 3:return Uw[r.m-1][1];case 5:return Uw[r.m-1][0];default:return Uw[r.m-1][2]}break;case 100:switch(t.length){case 1:case 2:c=r.d,d=t.length;break;case 3:return yN[r.q][0];default:return yN[r.q][1]}break;case 104:switch(t.length){case 1:case 2:c=1+(r.H+11)%12,d=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:c=r.H,d=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:c=r.M,d=t.length;break;default:throw"bad minute format: "+t}break;case 115:if(t!="s"&&t!="ss"&&t!=".0"&&t!=".00"&&t!=".000")throw"bad second format: "+t;return r.u===0&&(t=="s"||t=="ss")?zo(r.S,t.length):(n>=2?i=n===3?1e3:100:i=n===1?10:1,a=Math.round(i*(r.S+r.u)),a>=60*i&&(a=0),t==="s"?a===0?"0":""+a/i:(s=zo(a,2+n),t==="ss"?s.substr(0,2):"."+s.substr(2,t.length-1)));case 90:switch(t){case"[h]":case"[hh]":c=r.D*24+r.H;break;case"[m]":case"[mm]":c=(r.D*24+r.H)*60+r.M;break;case"[s]":case"[ss]":c=((r.D*24+r.H)*60+r.M)*60+Math.round(r.S+r.u);break;default:throw"bad abstime format: "+t}d=t.length===3?1:2;break;case 101:c=l,d=1;break}var f=d>0?zo(c,d):"";return f}function Au(e){var t=3;if(e.length<=t)return e;for(var r=e.length%t,n=e.substr(0,r);r!=e.length;r+=t)n+=(n.length>0?",":"")+e.substr(r,t);return n}var s8=/%/g;function uH(e,t,r){var n=t.replace(s8,""),s=t.length-n.length;return wc(e,n,r*Math.pow(10,2*s))+as("%",s)}function dH(e,t,r){for(var n=t.length-1;t.charCodeAt(n-1)===44;)--n;return wc(e,t.substr(0,n),r/Math.pow(10,3*(t.length-n)))}function a8(e,t){var r,n=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+a8(e,-t);var s=e.indexOf(".");s===-1&&(s=e.indexOf("E"));var a=Math.floor(Math.log(t)*Math.LOG10E)%s;if(a<0&&(a+=s),r=(t/Math.pow(10,a)).toPrecision(n+1+(s+a)%s),r.indexOf("e")===-1){var i=Math.floor(Math.log(t)*Math.LOG10E);for(r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(i-r.length+a):r+="E+"+(i-a);r.substr(0,2)==="0.";)r=r.charAt(0)+r.substr(2,s)+"."+r.substr(2+s),r=r.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,d,f){return c+d+f.substr(0,(s+a)%s)+"."+f.substr(a)+"E"})}else r=t.toExponential(n);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}var i8=/# (\?+)( ?)\/( ?)(\d+)/;function fH(e,t,r){var n=parseInt(e[4],10),s=Math.round(t*n),a=Math.floor(s/n),i=s-a*n,l=n;return r+(a===0?"":""+a)+" "+(i===0?as(" ",e[1].length+1+e[4].length):lS(i,e[1].length)+e[2]+"/"+e[3]+zo(l,e[4].length))}function hH(e,t,r){return r+(t===0?"":""+t)+as(" ",e[1].length+2+e[4].length)}var o8=/^#*0*\.([0#]+)/,l8=/\).*[0#]/,c8=/\(###\) ###\\?-####/;function ri(e){for(var t="",r,n=0;n!=e.length;++n)switch(r=e.charCodeAt(n)){case 35:break;case 63:t+=" ";break;case 48:t+="0";break;default:t+=String.fromCharCode(r)}return t}function wN(e,t){var r=Math.pow(10,t);return""+Math.round(e*r)/r}function _N(e,t){var r=e-Math.floor(e),n=Math.pow(10,t);return t<(""+Math.round(r*n)).length?0:Math.round(r*n)}function gH(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}function mH(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function io(e,t,r){if(e.charCodeAt(0)===40&&!t.match(l8)){var n=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?io("n",n,r):"("+io("n",n,-r)+")"}if(t.charCodeAt(t.length-1)===44)return dH(e,t,r);if(t.indexOf("%")!==-1)return uH(e,t,r);if(t.indexOf("E")!==-1)return a8(t,r);if(t.charCodeAt(0)===36)return"$"+io(e,t.substr(t.charAt(1)==" "?2:1),r);var s,a,i,l,c=Math.abs(r),d=r<0?"-":"";if(t.match(/^00+$/))return d+Ch(c,t.length);if(t.match(/^[#?]+$/))return s=Ch(r,0),s==="0"&&(s=""),s.length>t.length?s:ri(t.substr(0,t.length-s.length))+s;if(a=t.match(i8))return fH(a,c,d);if(t.match(/^#+0+$/))return d+Ch(c,t.length-t.indexOf("0"));if(a=t.match(o8))return s=wN(r,a[1].length).replace(/^([^\.]+)$/,"$1."+ri(a[1])).replace(/\.$/,"."+ri(a[1])).replace(/\.(\d*)$/,function(v,_){return"."+_+as("0",ri(a[1]).length-_.length)}),t.indexOf("0.")!==-1?s:s.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),a=t.match(/^(0*)\.(#*)$/))return d+wN(c,a[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=t.match(/^#{1,3},##0(\.?)$/))return d+Au(Ch(c,0));if(a=t.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+io(e,t,-r):Au(""+(Math.floor(r)+gH(r,a[1].length)))+"."+zo(_N(r,a[1].length),a[1].length);if(a=t.match(/^#,#*,#0/))return io(e,t.replace(/^#,#*,/,""),r);if(a=t.match(/^([0#]+)(\\?-([0#]+))+$/))return s=Jh(io(e,t.replace(/[\\-]/g,""),r)),i=0,Jh(Jh(t.replace(/\\/g,"")).replace(/[0#]/g,function(v){return i<s.length?s.charAt(i++):v==="0"?"0":""}));if(t.match(c8))return s=io(e,"##########",r),"("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var f="";if(a=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(a[4].length,7),l=my(c,Math.pow(10,i)-1,!1),s=""+d,f=wc("n",a[1],l[1]),f.charAt(f.length-1)==" "&&(f=f.substr(0,f.length-1)+"0"),s+=f+a[2]+"/"+a[3],f=hy(l[2],i),f.length<a[4].length&&(f=ri(a[4].substr(a[4].length-f.length))+f),s+=f,s;if(a=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(a[1].length,a[4].length),7),l=my(c,Math.pow(10,i)-1,!0),d+(l[0]||(l[1]?"":"0"))+" "+(l[1]?lS(l[1],i)+a[2]+"/"+a[3]+hy(l[2],i):as(" ",2*i+1+a[2].length+a[3].length));if(a=t.match(/^[#0?]+$/))return s=Ch(r,0),t.length<=s.length?s:ri(t.substr(0,t.length-s.length))+s;if(a=t.match(/^([#0?]+)\.([#0]+)$/)){s=""+r.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),i=s.indexOf(".");var p=t.indexOf(".")-i,g=t.length-s.length-p;return ri(t.substr(0,p)+s+t.substr(t.length-g))}if(a=t.match(/^00,000\.([#0]*0)$/))return i=_N(r,a[1].length),r<0?"-"+io(e,t,-r):Au(mH(r)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(v){return"00,"+(v.length<3?zo(0,3-v.length):"")+v})+"."+zo(i,a[1].length);switch(t){case"###,##0.00":return io(e,"#,##0.00",r);case"###,###":case"##,###":case"#,###":var y=Au(Ch(c,0));return y!=="0"?d+y:"";case"###,###.00":return io(e,"###,##0.00",r).replace(/^0\./,".");case"#,###.00":return io(e,"#,##0.00",r).replace(/^0\./,".")}throw new Error("unsupported format |"+t+"|")}function pH(e,t,r){for(var n=t.length-1;t.charCodeAt(n-1)===44;)--n;return wc(e,t.substr(0,n),r/Math.pow(10,3*(t.length-n)))}function xH(e,t,r){var n=t.replace(s8,""),s=t.length-n.length;return wc(e,n,r*Math.pow(10,2*s))+as("%",s)}function u8(e,t){var r,n=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+u8(e,-t);var s=e.indexOf(".");s===-1&&(s=e.indexOf("E"));var a=Math.floor(Math.log(t)*Math.LOG10E)%s;if(a<0&&(a+=s),r=(t/Math.pow(10,a)).toPrecision(n+1+(s+a)%s),!r.match(/[Ee]/)){var i=Math.floor(Math.log(t)*Math.LOG10E);r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(i-r.length+a):r+="E+"+(i-a),r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,d,f){return c+d+f.substr(0,(s+a)%s)+"."+f.substr(a)+"E"})}else r=t.toExponential(n);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}function vl(e,t,r){if(e.charCodeAt(0)===40&&!t.match(l8)){var n=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?vl("n",n,r):"("+vl("n",n,-r)+")"}if(t.charCodeAt(t.length-1)===44)return pH(e,t,r);if(t.indexOf("%")!==-1)return xH(e,t,r);if(t.indexOf("E")!==-1)return u8(t,r);if(t.charCodeAt(0)===36)return"$"+vl(e,t.substr(t.charAt(1)==" "?2:1),r);var s,a,i,l,c=Math.abs(r),d=r<0?"-":"";if(t.match(/^00+$/))return d+zo(c,t.length);if(t.match(/^[#?]+$/))return s=""+r,r===0&&(s=""),s.length>t.length?s:ri(t.substr(0,t.length-s.length))+s;if(a=t.match(i8))return hH(a,c,d);if(t.match(/^#+0+$/))return d+zo(c,t.length-t.indexOf("0"));if(a=t.match(o8))return s=(""+r).replace(/^([^\.]+)$/,"$1."+ri(a[1])).replace(/\.$/,"."+ri(a[1])),s=s.replace(/\.(\d*)$/,function(v,_){return"."+_+as("0",ri(a[1]).length-_.length)}),t.indexOf("0.")!==-1?s:s.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),a=t.match(/^(0*)\.(#*)$/))return d+(""+c).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=t.match(/^#{1,3},##0(\.?)$/))return d+Au(""+c);if(a=t.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+vl(e,t,-r):Au(""+r)+"."+as("0",a[1].length);if(a=t.match(/^#,#*,#0/))return vl(e,t.replace(/^#,#*,/,""),r);if(a=t.match(/^([0#]+)(\\?-([0#]+))+$/))return s=Jh(vl(e,t.replace(/[\\-]/g,""),r)),i=0,Jh(Jh(t.replace(/\\/g,"")).replace(/[0#]/g,function(v){return i<s.length?s.charAt(i++):v==="0"?"0":""}));if(t.match(c8))return s=vl(e,"##########",r),"("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var f="";if(a=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(a[4].length,7),l=my(c,Math.pow(10,i)-1,!1),s=""+d,f=wc("n",a[1],l[1]),f.charAt(f.length-1)==" "&&(f=f.substr(0,f.length-1)+"0"),s+=f+a[2]+"/"+a[3],f=hy(l[2],i),f.length<a[4].length&&(f=ri(a[4].substr(a[4].length-f.length))+f),s+=f,s;if(a=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(a[1].length,a[4].length),7),l=my(c,Math.pow(10,i)-1,!0),d+(l[0]||(l[1]?"":"0"))+" "+(l[1]?lS(l[1],i)+a[2]+"/"+a[3]+hy(l[2],i):as(" ",2*i+1+a[2].length+a[3].length));if(a=t.match(/^[#0?]+$/))return s=""+r,t.length<=s.length?s:ri(t.substr(0,t.length-s.length))+s;if(a=t.match(/^([#0]+)\.([#0]+)$/)){s=""+r.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),i=s.indexOf(".");var p=t.indexOf(".")-i,g=t.length-s.length-p;return ri(t.substr(0,p)+s+t.substr(t.length-g))}if(a=t.match(/^00,000\.([#0]*0)$/))return r<0?"-"+vl(e,t,-r):Au(""+r).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(v){return"00,"+(v.length<3?zo(0,3-v.length):"")+v})+"."+zo(0,a[1].length);switch(t){case"###,###":case"##,###":case"#,###":var y=Au(""+c);return y!=="0"?d+y:"";default:if(t.match(/\.[0#?]*$/))return vl(e,t.slice(0,t.lastIndexOf(".")),r)+ri(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function wc(e,t,r){return(r|0)===r?vl(e,t,r):io(e,t,r)}function yH(e){for(var t=[],r=!1,n=0,s=0;n<e.length;++n)switch(e.charCodeAt(n)){case 34:r=!r;break;case 95:case 42:case 92:++n;break;case 59:t[t.length]=e.substr(s,n-s),s=n+1}if(t[t.length]=e.substr(s),r===!0)throw new Error("Format |"+e+"| unterminated string ");return t}var d8=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function j0(e){for(var t=0,r="",n="";t<e.length;)switch(r=e.charAt(t)){case"G":gy(e,t)&&(t+=6),t++;break;case'"':for(;e.charCodeAt(++t)!==34&&t<e.length;);++t;break;case"\\":t+=2;break;case"_":t+=2;break;case"@":++t;break;case"B":case"b":if(e.charAt(t+1)==="1"||e.charAt(t+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(e.substr(t,3).toUpperCase()==="A/P"||e.substr(t,5).toUpperCase()==="AM/PM"||e.substr(t,5).toUpperCase()==="上午/下午")return!0;++t;break;case"[":for(n=r;e.charAt(t++)!=="]"&&t<e.length;)n+=e.charAt(t);if(n.match(d8))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(r=e.charAt(++t))>-1||r=="\\"&&e.charAt(t+1)=="-"&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===r;);break;case"*":++t,(e.charAt(t)==" "||e.charAt(t)=="*")&&++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;case" ":++t;break;default:++t;break}return!1}function vH(e,t,r,n){for(var s=[],a="",i=0,l="",c="t",d,f,p,g="H";i<e.length;)switch(l=e.charAt(i)){case"G":if(!gy(e,i))throw new Error("unrecognized character "+l+" in "+e);s[s.length]={t:"G",v:"General"},i+=7;break;case'"':for(a="";(p=e.charCodeAt(++i))!==34&&i<e.length;)a+=String.fromCharCode(p);s[s.length]={t:"t",v:a},++i;break;case"\\":var y=e.charAt(++i),v=y==="("||y===")"?y:"t";s[s.length]={t:v,v:y},++i;break;case"_":s[s.length]={t:"t",v:" "},i+=2;break;case"@":s[s.length]={t:"T",v:t},++i;break;case"B":case"b":if(e.charAt(i+1)==="1"||e.charAt(i+1)==="2"){if(d==null&&(d=Bd(t,r,e.charAt(i+1)==="2"),d==null))return"";s[s.length]={t:"X",v:e.substr(i,2)},c=l,i+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":l=l.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0||d==null&&(d=Bd(t,r),d==null))return"";for(a=l;++i<e.length&&e.charAt(i).toLowerCase()===l;)a+=l;l==="m"&&c.toLowerCase()==="h"&&(l="M"),l==="h"&&(l=g),s[s.length]={t:l,v:a},c=l;break;case"A":case"a":case"上":var _={t:l,v:l};if(d==null&&(d=Bd(t,r)),e.substr(i,3).toUpperCase()==="A/P"?(d!=null&&(_.v=d.H>=12?"P":"A"),_.t="T",g="h",i+=3):e.substr(i,5).toUpperCase()==="AM/PM"?(d!=null&&(_.v=d.H>=12?"PM":"AM"),_.t="T",i+=5,g="h"):e.substr(i,5).toUpperCase()==="上午/下午"?(d!=null&&(_.v=d.H>=12?"下午":"上午"),_.t="T",i+=5,g="h"):(_.t="t",++i),d==null&&_.t==="T")return"";s[s.length]=_,c=l;break;case"[":for(a=l;e.charAt(i++)!=="]"&&i<e.length;)a+=e.charAt(i);if(a.slice(-1)!=="]")throw'unterminated "[" block: |'+a+"|";if(a.match(d8)){if(d==null&&(d=Bd(t,r),d==null))return"";s[s.length]={t:"Z",v:a.toLowerCase()},c=a.charAt(1)}else a.indexOf("$")>-1&&(a=(a.match(/\$([^-\[\]]*)/)||[])[1]||"$",j0(e)||(s[s.length]={t:"t",v:a}));break;case".":if(d!=null){for(a=l;++i<e.length&&(l=e.charAt(i))==="0";)a+=l;s[s.length]={t:"s",v:a};break}case"0":case"#":for(a=l;++i<e.length&&"0#?.,E+-%".indexOf(l=e.charAt(i))>-1;)a+=l;s[s.length]={t:"n",v:a};break;case"?":for(a=l;e.charAt(++i)===l;)a+=l;s[s.length]={t:l,v:a},c=l;break;case"*":++i,(e.charAt(i)==" "||e.charAt(i)=="*")&&++i;break;case"(":case")":s[s.length]={t:n===1?"t":l,v:l},++i;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(a=l;i<e.length&&"0123456789".indexOf(e.charAt(++i))>-1;)a+=e.charAt(i);s[s.length]={t:"D",v:a};break;case" ":s[s.length]={t:l,v:l},++i;break;case"$":s[s.length]={t:"t",v:"$"},++i;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(l)===-1)throw new Error("unrecognized character "+l+" in "+e);s[s.length]={t:"t",v:l},++i;break}var b=0,E=0,k;for(i=s.length-1,c="t";i>=0;--i)switch(s[i].t){case"h":case"H":s[i].t=g,c="h",b<1&&(b=1);break;case"s":(k=s[i].v.match(/\.0+$/))&&(E=Math.max(E,k[0].length-1)),b<3&&(b=3);case"d":case"y":case"M":case"e":c=s[i].t;break;case"m":c==="s"&&(s[i].t="M",b<2&&(b=2));break;case"X":break;case"Z":b<1&&s[i].v.match(/[Hh]/)&&(b=1),b<2&&s[i].v.match(/[Mm]/)&&(b=2),b<3&&s[i].v.match(/[Ss]/)&&(b=3)}switch(b){case 0:break;case 1:d.u>=.5&&(d.u=0,++d.S),d.S>=60&&(d.S=0,++d.M),d.M>=60&&(d.M=0,++d.H);break;case 2:d.u>=.5&&(d.u=0,++d.S),d.S>=60&&(d.S=0,++d.M);break}var w="",N;for(i=0;i<s.length;++i)switch(s[i].t){case"t":case"T":case" ":case"D":break;case"X":s[i].v="",s[i].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":s[i].v=cH(s[i].t.charCodeAt(0),s[i].v,d,E),s[i].t="t";break;case"n":case"?":for(N=i+1;s[N]!=null&&((l=s[N].t)==="?"||l==="D"||(l===" "||l==="t")&&s[N+1]!=null&&(s[N+1].t==="?"||s[N+1].t==="t"&&s[N+1].v==="/")||s[i].t==="("&&(l===" "||l==="n"||l===")")||l==="t"&&(s[N].v==="/"||s[N].v===" "&&s[N+1]!=null&&s[N+1].t=="?"));)s[i].v+=s[N].v,s[N]={v:"",t:";"},++N;w+=s[i].v,i=N-1;break;case"G":s[i].t="t",s[i].v=df(t,r);break}var A="",P,R;if(w.length>0){w.charCodeAt(0)==40?(P=t<0&&w.charCodeAt(0)===45?-t:t,R=wc("n",w,P)):(P=t<0&&n>1?-t:t,R=wc("n",w,P),P<0&&s[0]&&s[0].t=="t"&&(R=R.substr(1),s[0].v="-"+s[0].v)),N=R.length-1;var T=s.length;for(i=0;i<s.length;++i)if(s[i]!=null&&s[i].t!="t"&&s[i].v.indexOf(".")>-1){T=i;break}var D=s.length;if(T===s.length&&R.indexOf("E")===-1){for(i=s.length-1;i>=0;--i)s[i]==null||"n?".indexOf(s[i].t)===-1||(N>=s[i].v.length-1?(N-=s[i].v.length,s[i].v=R.substr(N+1,s[i].v.length)):N<0?s[i].v="":(s[i].v=R.substr(0,N+1),N=-1),s[i].t="t",D=i);N>=0&&D<s.length&&(s[D].v=R.substr(0,N+1)+s[D].v)}else if(T!==s.length&&R.indexOf("E")===-1){for(N=R.indexOf(".")-1,i=T;i>=0;--i)if(!(s[i]==null||"n?".indexOf(s[i].t)===-1)){for(f=s[i].v.indexOf(".")>-1&&i===T?s[i].v.indexOf(".")-1:s[i].v.length-1,A=s[i].v.substr(f+1);f>=0;--f)N>=0&&(s[i].v.charAt(f)==="0"||s[i].v.charAt(f)==="#")&&(A=R.charAt(N--)+A);s[i].v=A,s[i].t="t",D=i}for(N>=0&&D<s.length&&(s[D].v=R.substr(0,N+1)+s[D].v),N=R.indexOf(".")+1,i=T;i<s.length;++i)if(!(s[i]==null||"n?(".indexOf(s[i].t)===-1&&i!==T)){for(f=s[i].v.indexOf(".")>-1&&i===T?s[i].v.indexOf(".")+1:0,A=s[i].v.substr(0,f);f<s[i].v.length;++f)N<R.length&&(A+=R.charAt(N++));s[i].v=A,s[i].t="t",D=i}}}for(i=0;i<s.length;++i)s[i]!=null&&"n?".indexOf(s[i].t)>-1&&(P=n>1&&t<0&&i>0&&s[i-1].v==="-"?-t:t,s[i].v=wc(s[i].t,s[i].v,P),s[i].t="t");var I="";for(i=0;i!==s.length;++i)s[i]!=null&&(I+=s[i].v);return I}var bN=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function SN(e,t){if(t==null)return!1;var r=parseFloat(t[2]);switch(t[1]){case"=":if(e==r)return!0;break;case">":if(e>r)return!0;break;case"<":if(e<r)return!0;break;case"<>":if(e!=r)return!0;break;case">=":if(e>=r)return!0;break;case"<=":if(e<=r)return!0;break}return!1}function wH(e,t){var r=yH(e),n=r.length,s=r[n-1].indexOf("@");if(n<4&&s>-1&&--n,r.length>4)throw new Error("cannot find right format for |"+r.join("|")+"|");if(typeof t!="number")return[4,r.length===4||s>-1?r[r.length-1]:"@"];switch(r.length){case 1:r=s>-1?["General","General","General",r[0]]:[r[0],r[0],r[0],"@"];break;case 2:r=s>-1?[r[0],r[0],r[0],r[1]]:[r[0],r[1],r[0],"@"];break;case 3:r=s>-1?[r[0],r[1],r[0],r[2]]:[r[0],r[1],r[2],"@"];break}var a=t>0?r[0]:t<0?r[1]:r[2];if(r[0].indexOf("[")===-1&&r[1].indexOf("[")===-1)return[n,a];if(r[0].match(/\[[=<>]/)!=null||r[1].match(/\[[=<>]/)!=null){var i=r[0].match(bN),l=r[1].match(bN);return SN(t,i)?[n,r[0]]:SN(t,l)?[n,r[1]]:[n,r[i!=null&&l!=null?2:1]]}return[n,a]}function vo(e,t,r){r==null&&(r={});var n="";switch(typeof e){case"string":e=="m/d/yy"&&r.dateNF?n=r.dateNF:n=e;break;case"number":e==14&&r.dateNF?n=r.dateNF:n=(r.table!=null?r.table:wr)[e],n==null&&(n=r.table&&r.table[vN[e]]||wr[vN[e]]),n==null&&(n=rH[e]||"General");break}if(gy(n,0))return df(t,r);t instanceof Date&&(t=n8(t,r.date1904));var s=wH(n,t);if(gy(s[1]))return df(t,r);if(t===!0)t="TRUE";else if(t===!1)t="FALSE";else if(t===""||t==null)return"";return vH(s[1],t,r,s[0])}function _c(e,t){if(typeof t!="number"){t=+t||-1;for(var r=0;r<392;++r){if(wr[r]==null){t<0&&(t=r);continue}if(wr[r]==e){t=r;break}}t<0&&(t=391)}return wr[t]=e,t}function ev(e){for(var t=0;t!=392;++t)e[t]!==void 0&&_c(e[t],t)}function F0(){wr=tH()}var _H={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},f8=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function bH(e){var t=typeof e=="number"?wr[e]:e;return t=t.replace(f8,"(\\d+)"),new RegExp("^"+t+"$")}function SH(e,t,r){var n=-1,s=-1,a=-1,i=-1,l=-1,c=-1;(t.match(f8)||[]).forEach(function(p,g){var y=parseInt(r[g+1],10);switch(p.toLowerCase().charAt(0)){case"y":n=y;break;case"d":a=y;break;case"h":i=y;break;case"s":c=y;break;case"m":i>=0?l=y:s=y;break}}),c>=0&&l==-1&&s>=0&&(l=s,s=-1);var d=(""+(n>=0?n:new Date().getFullYear())).slice(-4)+"-"+("00"+(s>=1?s:1)).slice(-2)+"-"+("00"+(a>=1?a:1)).slice(-2);d.length==7&&(d="0"+d),d.length==8&&(d="20"+d);var f=("00"+(i>=0?i:0)).slice(-2)+":"+("00"+(l>=0?l:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2);return i==-1&&l==-1&&c==-1?d:n==-1&&s==-1&&a==-1?f:d+"T"+f}var kH=(function(){var e={};e.version="1.2.0";function t(){for(var R=0,T=new Array(256),D=0;D!=256;++D)R=D,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,R=R&1?-306674912^R>>>1:R>>>1,T[D]=R;return typeof Int32Array<"u"?new Int32Array(T):T}var r=t();function n(R){var T=0,D=0,I=0,V=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(I=0;I!=256;++I)V[I]=R[I];for(I=0;I!=256;++I)for(D=R[I],T=256+I;T<4096;T+=256)D=V[T]=D>>>8^R[D&255];var X=[];for(I=1;I!=16;++I)X[I-1]=typeof Int32Array<"u"?V.subarray(I*256,I*256+256):V.slice(I*256,I*256+256);return X}var s=n(r),a=s[0],i=s[1],l=s[2],c=s[3],d=s[4],f=s[5],p=s[6],g=s[7],y=s[8],v=s[9],_=s[10],b=s[11],E=s[12],k=s[13],w=s[14];function N(R,T){for(var D=T^-1,I=0,V=R.length;I<V;)D=D>>>8^r[(D^R.charCodeAt(I++))&255];return~D}function A(R,T){for(var D=T^-1,I=R.length-15,V=0;V<I;)D=w[R[V++]^D&255]^k[R[V++]^D>>8&255]^E[R[V++]^D>>16&255]^b[R[V++]^D>>>24]^_[R[V++]]^v[R[V++]]^y[R[V++]]^g[R[V++]]^p[R[V++]]^f[R[V++]]^d[R[V++]]^c[R[V++]]^l[R[V++]]^i[R[V++]]^a[R[V++]]^r[R[V++]];for(I+=15;V<I;)D=D>>>8^r[(D^R[V++])&255];return~D}function P(R,T){for(var D=T^-1,I=0,V=R.length,X=0,Z=0;I<V;)X=R.charCodeAt(I++),X<128?D=D>>>8^r[(D^X)&255]:X<2048?(D=D>>>8^r[(D^(192|X>>6&31))&255],D=D>>>8^r[(D^(128|X&63))&255]):X>=55296&&X<57344?(X=(X&1023)+64,Z=R.charCodeAt(I++)&1023,D=D>>>8^r[(D^(240|X>>8&7))&255],D=D>>>8^r[(D^(128|X>>2&63))&255],D=D>>>8^r[(D^(128|Z>>6&15|(X&3)<<4))&255],D=D>>>8^r[(D^(128|Z&63))&255]):(D=D>>>8^r[(D^(224|X>>12&15))&255],D=D>>>8^r[(D^(128|X>>6&63))&255],D=D>>>8^r[(D^(128|X&63))&255]);return~D}return e.table=r,e.bstr=N,e.buf=A,e.str=P,e})(),mr=(function(){var t={};t.version="1.2.1";function r(le,be){for(var pe=le.split("/"),xe=be.split("/"),Se=0,ke=0,$e=Math.min(pe.length,xe.length);Se<$e;++Se){if(ke=pe[Se].length-xe[Se].length)return ke;if(pe[Se]!=xe[Se])return pe[Se]<xe[Se]?-1:1}return pe.length-xe.length}function n(le){if(le.charAt(le.length-1)=="/")return le.slice(0,-1).indexOf("/")===-1?le:n(le.slice(0,-1));var be=le.lastIndexOf("/");return be===-1?le:le.slice(0,be+1)}function s(le){if(le.charAt(le.length-1)=="/")return s(le.slice(0,-1));var be=le.lastIndexOf("/");return be===-1?le:le.slice(be+1)}function a(le,be){typeof be=="string"&&(be=new Date(be));var pe=be.getHours();pe=pe<<6|be.getMinutes(),pe=pe<<5|be.getSeconds()>>>1,le.write_shift(2,pe);var xe=be.getFullYear()-1980;xe=xe<<4|be.getMonth()+1,xe=xe<<5|be.getDate(),le.write_shift(2,xe)}function i(le){var be=le.read_shift(2)&65535,pe=le.read_shift(2)&65535,xe=new Date,Se=pe&31;pe>>>=5;var ke=pe&15;pe>>>=4,xe.setMilliseconds(0),xe.setFullYear(pe+1980),xe.setMonth(ke-1),xe.setDate(Se);var $e=be&31;be>>>=5;var ht=be&63;return be>>>=6,xe.setHours(be),xe.setMinutes(ht),xe.setSeconds($e<<1),xe}function l(le){ya(le,0);for(var be={},pe=0;le.l<=le.length-4;){var xe=le.read_shift(2),Se=le.read_shift(2),ke=le.l+Se,$e={};switch(xe){case 21589:pe=le.read_shift(1),pe&1&&($e.mtime=le.read_shift(4)),Se>5&&(pe&2&&($e.atime=le.read_shift(4)),pe&4&&($e.ctime=le.read_shift(4))),$e.mtime&&($e.mt=new Date($e.mtime*1e3));break}le.l=ke,be[xe]=$e}return be}var c;function d(){return c||(c={})}function f(le,be){if(le[0]==80&&le[1]==75)return Te(le,be);if((le[0]|32)==109&&(le[1]|32)==105)return Xt(le,be);if(le.length<512)throw new Error("CFB file size "+le.length+" < 512");var pe=3,xe=512,Se=0,ke=0,$e=0,ht=0,Ke=0,oe=[],he=le.slice(0,512);ya(he,0);var Ce=p(he);switch(pe=Ce[0],pe){case 3:xe=512;break;case 4:xe=4096;break;case 0:if(Ce[1]==0)return Te(le,be);default:throw new Error("Major Version: Expected 3 or 4 saw "+pe)}xe!==512&&(he=le.slice(0,xe),ya(he,28));var Ne=le.slice(0,xe);g(he,pe);var Ge=he.read_shift(4,"i");if(pe===3&&Ge!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Ge);he.l+=4,$e=he.read_shift(4,"i"),he.l+=4,he.chk("00100000","Mini Stream Cutoff Size: "),ht=he.read_shift(4,"i"),Se=he.read_shift(4,"i"),Ke=he.read_shift(4,"i"),ke=he.read_shift(4,"i");for(var ot=-1,Le=0;Le<109&&(ot=he.read_shift(4,"i"),!(ot<0));++Le)oe[Le]=ot;var Et=y(le,xe);b(Ke,ke,Et,xe,oe);var Bt=k(Et,$e,oe,xe);Bt[$e].name="!Directory",Se>0&&ht!==Z&&(Bt[ht].name="!MiniFAT"),Bt[oe[0]].name="!FAT",Bt.fat_addrs=oe,Bt.ssz=xe;var Yt={},Fe=[],We=[],Ct=[];w($e,Bt,Et,Fe,Se,Yt,We,ht),v(We,Ct,Fe),Fe.shift();var at={FileIndex:We,FullPaths:Ct};return be&&be.raw&&(at.raw={header:Ne,sectors:Et}),at}function p(le){if(le[le.l]==80&&le[le.l+1]==75)return[0,0];le.chk(ie,"Header Signature: "),le.l+=16;var be=le.read_shift(2,"u");return[le.read_shift(2,"u"),be]}function g(le,be){var pe=9;switch(le.l+=2,pe=le.read_shift(2)){case 9:if(be!=3)throw new Error("Sector Shift: Expected 9 saw "+pe);break;case 12:if(be!=4)throw new Error("Sector Shift: Expected 12 saw "+pe);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+pe)}le.chk("0600","Mini Sector Shift: "),le.chk("000000000000","Reserved: ")}function y(le,be){for(var pe=Math.ceil(le.length/be)-1,xe=[],Se=1;Se<pe;++Se)xe[Se-1]=le.slice(Se*be,(Se+1)*be);return xe[pe-1]=le.slice(pe*be),xe}function v(le,be,pe){for(var xe=0,Se=0,ke=0,$e=0,ht=0,Ke=pe.length,oe=[],he=[];xe<Ke;++xe)oe[xe]=he[xe]=xe,be[xe]=pe[xe];for(;ht<he.length;++ht)xe=he[ht],Se=le[xe].L,ke=le[xe].R,$e=le[xe].C,oe[xe]===xe&&(Se!==-1&&oe[Se]!==Se&&(oe[xe]=oe[Se]),ke!==-1&&oe[ke]!==ke&&(oe[xe]=oe[ke])),$e!==-1&&(oe[$e]=xe),Se!==-1&&xe!=oe[xe]&&(oe[Se]=oe[xe],he.lastIndexOf(Se)<ht&&he.push(Se)),ke!==-1&&xe!=oe[xe]&&(oe[ke]=oe[xe],he.lastIndexOf(ke)<ht&&he.push(ke));for(xe=1;xe<Ke;++xe)oe[xe]===xe&&(ke!==-1&&oe[ke]!==ke?oe[xe]=oe[ke]:Se!==-1&&oe[Se]!==Se&&(oe[xe]=oe[Se]));for(xe=1;xe<Ke;++xe)if(le[xe].type!==0){if(ht=xe,ht!=oe[ht])do ht=oe[ht],be[xe]=be[ht]+"/"+be[xe];while(ht!==0&&oe[ht]!==-1&&ht!=oe[ht]);oe[xe]=-1}for(be[0]+="/",xe=1;xe<Ke;++xe)le[xe].type!==2&&(be[xe]+="/")}function _(le,be,pe){for(var xe=le.start,Se=le.size,ke=[],$e=xe;pe&&Se>0&&$e>=0;)ke.push(be.slice($e*X,$e*X+X)),Se-=X,$e=Id(pe,$e*4);return ke.length===0?wt(0):ta(ke).slice(0,le.size)}function b(le,be,pe,xe,Se){var ke=Z;if(le===Z){if(be!==0)throw new Error("DIFAT chain shorter than expected")}else if(le!==-1){var $e=pe[le],ht=(xe>>>2)-1;if(!$e)return;for(var Ke=0;Ke<ht&&(ke=Id($e,Ke*4))!==Z;++Ke)Se.push(ke);b(Id($e,xe-4),be-1,pe,xe,Se)}}function E(le,be,pe,xe,Se){var ke=[],$e=[];Se||(Se=[]);var ht=xe-1,Ke=0,oe=0;for(Ke=be;Ke>=0;){Se[Ke]=!0,ke[ke.length]=Ke,$e.push(le[Ke]);var he=pe[Math.floor(Ke*4/xe)];if(oe=Ke*4&ht,xe<4+oe)throw new Error("FAT boundary crossed: "+Ke+" 4 "+xe);if(!le[he])break;Ke=Id(le[he],oe)}return{nodes:ke,data:IN([$e])}}function k(le,be,pe,xe){var Se=le.length,ke=[],$e=[],ht=[],Ke=[],oe=xe-1,he=0,Ce=0,Ne=0,Ge=0;for(he=0;he<Se;++he)if(ht=[],Ne=he+be,Ne>=Se&&(Ne-=Se),!$e[Ne]){Ke=[];var ot=[];for(Ce=Ne;Ce>=0;){ot[Ce]=!0,$e[Ce]=!0,ht[ht.length]=Ce,Ke.push(le[Ce]);var Le=pe[Math.floor(Ce*4/xe)];if(Ge=Ce*4&oe,xe<4+Ge)throw new Error("FAT boundary crossed: "+Ce+" 4 "+xe);if(!le[Le]||(Ce=Id(le[Le],Ge),ot[Ce]))break}ke[Ne]={nodes:ht,data:IN([Ke])}}return ke}function w(le,be,pe,xe,Se,ke,$e,ht){for(var Ke=0,oe=xe.length?2:0,he=be[le].data,Ce=0,Ne=0,Ge;Ce<he.length;Ce+=128){var ot=he.slice(Ce,Ce+128);ya(ot,64),Ne=ot.read_shift(2),Ge=pS(ot,0,Ne-oe),xe.push(Ge);var Le={name:Ge,type:ot.read_shift(1),color:ot.read_shift(1),L:ot.read_shift(4,"i"),R:ot.read_shift(4,"i"),C:ot.read_shift(4,"i"),clsid:ot.read_shift(16),state:ot.read_shift(4,"i"),start:0,size:0},Et=ot.read_shift(2)+ot.read_shift(2)+ot.read_shift(2)+ot.read_shift(2);Et!==0&&(Le.ct=N(ot,ot.l-8));var Bt=ot.read_shift(2)+ot.read_shift(2)+ot.read_shift(2)+ot.read_shift(2);Bt!==0&&(Le.mt=N(ot,ot.l-8)),Le.start=ot.read_shift(4,"i"),Le.size=ot.read_shift(4,"i"),Le.size<0&&Le.start<0&&(Le.size=Le.type=0,Le.start=Z,Le.name=""),Le.type===5?(Ke=Le.start,Se>0&&Ke!==Z&&(be[Ke].name="!StreamData")):Le.size>=4096?(Le.storage="fat",be[Le.start]===void 0&&(be[Le.start]=E(pe,Le.start,be.fat_addrs,be.ssz)),be[Le.start].name=Le.name,Le.content=be[Le.start].data.slice(0,Le.size)):(Le.storage="minifat",Le.size<0?Le.size=0:Ke!==Z&&Le.start!==Z&&be[Ke]&&(Le.content=_(Le,be[Ke].data,(be[ht]||{}).data))),Le.content&&ya(Le.content,0),ke[Ge]=Le,$e.push(Le)}}function N(le,be){return new Date((Li(le,be+4)/1e7*Math.pow(2,32)+Li(le,be)/1e7-11644473600)*1e3)}function A(le,be){return d(),f(c.readFileSync(le),be)}function P(le,be){var pe=be&&be.type;switch(pe||Lr&&Buffer.isBuffer(le)&&(pe="buffer"),pe||"base64"){case"file":return A(le,be);case"base64":return f(Bi(Wi(le)),be);case"binary":return f(Bi(le),be)}return f(le,be)}function R(le,be){var pe=be||{},xe=pe.root||"Root Entry";if(le.FullPaths||(le.FullPaths=[]),le.FileIndex||(le.FileIndex=[]),le.FullPaths.length!==le.FileIndex.length)throw new Error("inconsistent CFB structure");le.FullPaths.length===0&&(le.FullPaths[0]=xe+"/",le.FileIndex[0]={name:xe,type:5}),pe.CLSID&&(le.FileIndex[0].clsid=pe.CLSID),T(le)}function T(le){var be="Sh33tJ5";if(!mr.find(le,"/"+be)){var pe=wt(4);pe[0]=55,pe[1]=pe[3]=50,pe[2]=54,le.FileIndex.push({name:be,type:2,content:pe,size:4,L:69,R:69,C:69}),le.FullPaths.push(le.FullPaths[0]+be),D(le)}}function D(le,be){R(le);for(var pe=!1,xe=!1,Se=le.FullPaths.length-1;Se>=0;--Se){var ke=le.FileIndex[Se];switch(ke.type){case 0:xe?pe=!0:(le.FileIndex.pop(),le.FullPaths.pop());break;case 1:case 2:case 5:xe=!0,isNaN(ke.R*ke.L*ke.C)&&(pe=!0),ke.R>-1&&ke.L>-1&&ke.R==ke.L&&(pe=!0);break;default:pe=!0;break}}if(!(!pe&&!be)){var $e=new Date(1987,1,19),ht=0,Ke=Object.create?Object.create(null):{},oe=[];for(Se=0;Se<le.FullPaths.length;++Se)Ke[le.FullPaths[Se]]=!0,le.FileIndex[Se].type!==0&&oe.push([le.FullPaths[Se],le.FileIndex[Se]]);for(Se=0;Se<oe.length;++Se){var he=n(oe[Se][0]);xe=Ke[he],xe||(oe.push([he,{name:s(he).replace("/",""),type:1,clsid:ne,ct:$e,mt:$e,content:null}]),Ke[he]=!0)}for(oe.sort(function(Ge,ot){return r(Ge[0],ot[0])}),le.FullPaths=[],le.FileIndex=[],Se=0;Se<oe.length;++Se)le.FullPaths[Se]=oe[Se][0],le.FileIndex[Se]=oe[Se][1];for(Se=0;Se<oe.length;++Se){var Ce=le.FileIndex[Se],Ne=le.FullPaths[Se];if(Ce.name=s(Ne).replace("/",""),Ce.L=Ce.R=Ce.C=-(Ce.color=1),Ce.size=Ce.content?Ce.content.length:0,Ce.start=0,Ce.clsid=Ce.clsid||ne,Se===0)Ce.C=oe.length>1?1:-1,Ce.size=0,Ce.type=5;else if(Ne.slice(-1)=="/"){for(ht=Se+1;ht<oe.length&&n(le.FullPaths[ht])!=Ne;++ht);for(Ce.C=ht>=oe.length?-1:ht,ht=Se+1;ht<oe.length&&n(le.FullPaths[ht])!=n(Ne);++ht);Ce.R=ht>=oe.length?-1:ht,Ce.type=1}else n(le.FullPaths[Se+1]||"")==n(Ne)&&(Ce.R=Se+1),Ce.type=2}}}function I(le,be){var pe=be||{};if(pe.fileType=="mad")return pr(le,pe);switch(D(le),pe.fileType){case"zip":return fe(le,pe)}var xe=(function(Ge){for(var ot=0,Le=0,Et=0;Et<Ge.FileIndex.length;++Et){var Bt=Ge.FileIndex[Et];if(Bt.content){var Yt=Bt.content.length;Yt>0&&(Yt<4096?ot+=Yt+63>>6:Le+=Yt+511>>9)}}for(var Fe=Ge.FullPaths.length+3>>2,We=ot+7>>3,Ct=ot+127>>7,at=We+Le+Fe+Ct,Qt=at+127>>7,tt=Qt<=109?0:Math.ceil((Qt-109)/127);at+Qt+tt+127>>7>Qt;)tt=++Qt<=109?0:Math.ceil((Qt-109)/127);var jt=[1,tt,Qt,Ct,Fe,Le,ot,0];return Ge.FileIndex[0].size=ot<<6,jt[7]=(Ge.FileIndex[0].start=jt[0]+jt[1]+jt[2]+jt[3]+jt[4]+jt[5])+(jt[6]+7>>3),jt})(le),Se=wt(xe[7]<<9),ke=0,$e=0;{for(ke=0;ke<8;++ke)Se.write_shift(1,q[ke]);for(ke=0;ke<8;++ke)Se.write_shift(2,0);for(Se.write_shift(2,62),Se.write_shift(2,3),Se.write_shift(2,65534),Se.write_shift(2,9),Se.write_shift(2,6),ke=0;ke<3;++ke)Se.write_shift(2,0);for(Se.write_shift(4,0),Se.write_shift(4,xe[2]),Se.write_shift(4,xe[0]+xe[1]+xe[2]+xe[3]-1),Se.write_shift(4,0),Se.write_shift(4,4096),Se.write_shift(4,xe[3]?xe[0]+xe[1]+xe[2]-1:Z),Se.write_shift(4,xe[3]),Se.write_shift(-4,xe[1]?xe[0]-1:Z),Se.write_shift(4,xe[1]),ke=0;ke<109;++ke)Se.write_shift(-4,ke<xe[2]?xe[1]+ke:-1)}if(xe[1])for($e=0;$e<xe[1];++$e){for(;ke<236+$e*127;++ke)Se.write_shift(-4,ke<xe[2]?xe[1]+ke:-1);Se.write_shift(-4,$e===xe[1]-1?Z:$e+1)}var ht=function(Ge){for($e+=Ge;ke<$e-1;++ke)Se.write_shift(-4,ke+1);Ge&&(++ke,Se.write_shift(-4,Z))};for($e=ke=0,$e+=xe[1];ke<$e;++ke)Se.write_shift(-4,M.DIFSECT);for($e+=xe[2];ke<$e;++ke)Se.write_shift(-4,M.FATSECT);ht(xe[3]),ht(xe[4]);for(var Ke=0,oe=0,he=le.FileIndex[0];Ke<le.FileIndex.length;++Ke)he=le.FileIndex[Ke],he.content&&(oe=he.content.length,!(oe<4096)&&(he.start=$e,ht(oe+511>>9)));for(ht(xe[6]+7>>3);Se.l&511;)Se.write_shift(-4,M.ENDOFCHAIN);for($e=ke=0,Ke=0;Ke<le.FileIndex.length;++Ke)he=le.FileIndex[Ke],he.content&&(oe=he.content.length,!(!oe||oe>=4096)&&(he.start=$e,ht(oe+63>>6)));for(;Se.l&511;)Se.write_shift(-4,M.ENDOFCHAIN);for(ke=0;ke<xe[4]<<2;++ke){var Ce=le.FullPaths[ke];if(!Ce||Ce.length===0){for(Ke=0;Ke<17;++Ke)Se.write_shift(4,0);for(Ke=0;Ke<3;++Ke)Se.write_shift(4,-1);for(Ke=0;Ke<12;++Ke)Se.write_shift(4,0);continue}he=le.FileIndex[ke],ke===0&&(he.start=he.size?he.start-1:Z);var Ne=ke===0&&pe.root||he.name;if(oe=2*(Ne.length+1),Se.write_shift(64,Ne,"utf16le"),Se.write_shift(2,oe),Se.write_shift(1,he.type),Se.write_shift(1,he.color),Se.write_shift(-4,he.L),Se.write_shift(-4,he.R),Se.write_shift(-4,he.C),he.clsid)Se.write_shift(16,he.clsid,"hex");else for(Ke=0;Ke<4;++Ke)Se.write_shift(4,0);Se.write_shift(4,he.state||0),Se.write_shift(4,0),Se.write_shift(4,0),Se.write_shift(4,0),Se.write_shift(4,0),Se.write_shift(4,he.start),Se.write_shift(4,he.size),Se.write_shift(4,0)}for(ke=1;ke<le.FileIndex.length;++ke)if(he=le.FileIndex[ke],he.size>=4096)if(Se.l=he.start+1<<9,Lr&&Buffer.isBuffer(he.content))he.content.copy(Se,Se.l,0,he.size),Se.l+=he.size+511&-512;else{for(Ke=0;Ke<he.size;++Ke)Se.write_shift(1,he.content[Ke]);for(;Ke&511;++Ke)Se.write_shift(1,0)}for(ke=1;ke<le.FileIndex.length;++ke)if(he=le.FileIndex[ke],he.size>0&&he.size<4096)if(Lr&&Buffer.isBuffer(he.content))he.content.copy(Se,Se.l,0,he.size),Se.l+=he.size+63&-64;else{for(Ke=0;Ke<he.size;++Ke)Se.write_shift(1,he.content[Ke]);for(;Ke&63;++Ke)Se.write_shift(1,0)}if(Lr)Se.l=Se.length;else for(;Se.l<Se.length;)Se.write_shift(1,0);return Se}function V(le,be){var pe=le.FullPaths.map(function(Ke){return Ke.toUpperCase()}),xe=pe.map(function(Ke){var oe=Ke.split("/");return oe[oe.length-(Ke.slice(-1)=="/"?2:1)]}),Se=!1;be.charCodeAt(0)===47?(Se=!0,be=pe[0].slice(0,-1)+be):Se=be.indexOf("/")!==-1;var ke=be.toUpperCase(),$e=Se===!0?pe.indexOf(ke):xe.indexOf(ke);if($e!==-1)return le.FileIndex[$e];var ht=!ke.match(km);for(ke=ke.replace(oi,""),ht&&(ke=ke.replace(km,"!")),$e=0;$e<pe.length;++$e)if((ht?pe[$e].replace(km,"!"):pe[$e]).replace(oi,"")==ke||(ht?xe[$e].replace(km,"!"):xe[$e]).replace(oi,"")==ke)return le.FileIndex[$e];return null}var X=64,Z=-2,ie="d0cf11e0a1b11ae1",q=[208,207,17,224,161,177,26,225],ne="00000000000000000000000000000000",M={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Z,FREESECT:-1,HEADER_SIGNATURE:ie,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:ne,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function W(le,be,pe){d();var xe=I(le,pe);c.writeFileSync(be,xe)}function L(le){for(var be=new Array(le.length),pe=0;pe<le.length;++pe)be[pe]=String.fromCharCode(le[pe]);return be.join("")}function H(le,be){var pe=I(le,be);switch(be&&be.type||"buffer"){case"file":return d(),c.writeFileSync(be.filename,pe),pe;case"binary":return typeof pe=="string"?pe:L(pe);case"base64":return cp(typeof pe=="string"?pe:L(pe));case"buffer":if(Lr)return Buffer.isBuffer(pe)?pe:jc(pe);case"array":return typeof pe=="string"?Bi(pe):pe}return pe}var K;function B(le){try{var be=le.InflateRaw,pe=new be;if(pe._processChunk(new Uint8Array([3,0]),pe._finishFlushFlag),pe.bytesRead)K=le;else throw new Error("zlib does not expose bytesRead")}catch(xe){console.error("cannot use native zlib: "+(xe.message||xe))}}function z(le,be){if(!K)return Lt(le,be);var pe=K.InflateRaw,xe=new pe,Se=xe._processChunk(le.slice(le.l),xe._finishFlushFlag);return le.l+=xe.bytesRead,Se}function Q(le){return K?K.deflateRawSync(le):ft(le)}var Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],te=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],ee=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function ae(le){var be=(le<<1|le<<11)&139536|(le<<5|le<<15)&558144;return(be>>16|be>>8|be)&255}for(var ge=typeof Uint8Array<"u",_e=ge?new Uint8Array(256):[],Me=0;Me<256;++Me)_e[Me]=ae(Me);function ue(le,be){var pe=_e[le&255];return be<=8?pe>>>8-be:(pe=pe<<8|_e[le>>8&255],be<=16?pe>>>16-be:(pe=pe<<8|_e[le>>16&255],pe>>>24-be))}function me(le,be){var pe=be&7,xe=be>>>3;return(le[xe]|(pe<=6?0:le[xe+1]<<8))>>>pe&3}function He(le,be){var pe=be&7,xe=be>>>3;return(le[xe]|(pe<=5?0:le[xe+1]<<8))>>>pe&7}function qe(le,be){var pe=be&7,xe=be>>>3;return(le[xe]|(pe<=4?0:le[xe+1]<<8))>>>pe&15}function Xe(le,be){var pe=be&7,xe=be>>>3;return(le[xe]|(pe<=3?0:le[xe+1]<<8))>>>pe&31}function Ve(le,be){var pe=be&7,xe=be>>>3;return(le[xe]|(pe<=1?0:le[xe+1]<<8))>>>pe&127}function It(le,be,pe){var xe=be&7,Se=be>>>3,ke=(1<<pe)-1,$e=le[Se]>>>xe;return pe<8-xe||($e|=le[Se+1]<<8-xe,pe<16-xe)||($e|=le[Se+2]<<16-xe,pe<24-xe)||($e|=le[Se+3]<<24-xe),$e&ke}function st(le,be,pe){var xe=be&7,Se=be>>>3;return xe<=5?le[Se]|=(pe&7)<<xe:(le[Se]|=pe<<xe&255,le[Se+1]=(pe&7)>>8-xe),be+3}function Ie(le,be,pe){var xe=be&7,Se=be>>>3;return pe=(pe&1)<<xe,le[Se]|=pe,be+1}function je(le,be,pe){var xe=be&7,Se=be>>>3;return pe<<=xe,le[Se]|=pe&255,pe>>>=8,le[Se+1]=pe,be+8}function Ze(le,be,pe){var xe=be&7,Se=be>>>3;return pe<<=xe,le[Se]|=pe&255,pe>>>=8,le[Se+1]=pe&255,le[Se+2]=pe>>>8,be+16}function bt(le,be){var pe=le.length,xe=2*pe>be?2*pe:be+5,Se=0;if(pe>=be)return le;if(Lr){var ke=pN(xe);if(le.copy)le.copy(ke);else for(;Se<le.length;++Se)ke[Se]=le[Se];return ke}else if(ge){var $e=new Uint8Array(xe);if($e.set)$e.set(le);else for(;Se<pe;++Se)$e[Se]=le[Se];return $e}return le.length=xe,le}function mt(le){for(var be=new Array(le),pe=0;pe<le;++pe)be[pe]=0;return be}function $t(le,be,pe){var xe=1,Se=0,ke=0,$e=0,ht=0,Ke=le.length,oe=ge?new Uint16Array(32):mt(32);for(ke=0;ke<32;++ke)oe[ke]=0;for(ke=Ke;ke<pe;++ke)le[ke]=0;Ke=le.length;var he=ge?new Uint16Array(Ke):mt(Ke);for(ke=0;ke<Ke;++ke)oe[Se=le[ke]]++,xe<Se&&(xe=Se),he[ke]=0;for(oe[0]=0,ke=1;ke<=xe;++ke)oe[ke+16]=ht=ht+oe[ke-1]<<1;for(ke=0;ke<Ke;++ke)ht=le[ke],ht!=0&&(he[ke]=oe[ht+16]++);var Ce=0;for(ke=0;ke<Ke;++ke)if(Ce=le[ke],Ce!=0)for(ht=ue(he[ke],xe)>>xe-Ce,$e=(1<<xe+4-Ce)-1;$e>=0;--$e)be[ht|$e<<Ce]=Ce&15|ke<<4;return xe}var Wt=ge?new Uint16Array(512):mt(512),lt=ge?new Uint16Array(32):mt(32);if(!ge){for(var Qe=0;Qe<512;++Qe)Wt[Qe]=0;for(Qe=0;Qe<32;++Qe)lt[Qe]=0}(function(){for(var le=[],be=0;be<32;be++)le.push(5);$t(le,lt,32);var pe=[];for(be=0;be<=143;be++)pe.push(8);for(;be<=255;be++)pe.push(9);for(;be<=279;be++)pe.push(7);for(;be<=287;be++)pe.push(8);$t(pe,Wt,288)})();var yt=(function(){for(var be=ge?new Uint8Array(32768):[],pe=0,xe=0;pe<ee.length-1;++pe)for(;xe<ee[pe+1];++xe)be[xe]=pe;for(;xe<32768;++xe)be[xe]=29;var Se=ge?new Uint8Array(259):[];for(pe=0,xe=0;pe<te.length-1;++pe)for(;xe<te[pe+1];++xe)Se[xe]=pe;function ke(ht,Ke){for(var oe=0;oe<ht.length;){var he=Math.min(65535,ht.length-oe),Ce=oe+he==ht.length;for(Ke.write_shift(1,+Ce),Ke.write_shift(2,he),Ke.write_shift(2,~he&65535);he-- >0;)Ke[Ke.l++]=ht[oe++]}return Ke.l}function $e(ht,Ke){for(var oe=0,he=0,Ce=ge?new Uint16Array(32768):[];he<ht.length;){var Ne=Math.min(65535,ht.length-he);if(Ne<10){for(oe=st(Ke,oe,+(he+Ne==ht.length)),oe&7&&(oe+=8-(oe&7)),Ke.l=oe/8|0,Ke.write_shift(2,Ne),Ke.write_shift(2,~Ne&65535);Ne-- >0;)Ke[Ke.l++]=ht[he++];oe=Ke.l*8;continue}oe=st(Ke,oe,+(he+Ne==ht.length)+2);for(var Ge=0;Ne-- >0;){var ot=ht[he];Ge=(Ge<<5^ot)&32767;var Le=-1,Et=0;if((Le=Ce[Ge])&&(Le|=he&-32768,Le>he&&(Le-=32768),Le<he))for(;ht[Le+Et]==ht[he+Et]&&Et<250;)++Et;if(Et>2){ot=Se[Et],ot<=22?oe=je(Ke,oe,_e[ot+1]>>1)-1:(je(Ke,oe,3),oe+=5,je(Ke,oe,_e[ot-23]>>5),oe+=3);var Bt=ot<8?0:ot-4>>2;Bt>0&&(Ze(Ke,oe,Et-te[ot]),oe+=Bt),ot=be[he-Le],oe=je(Ke,oe,_e[ot]>>3),oe-=3;var Yt=ot<4?0:ot-2>>1;Yt>0&&(Ze(Ke,oe,he-Le-ee[ot]),oe+=Yt);for(var Fe=0;Fe<Et;++Fe)Ce[Ge]=he&32767,Ge=(Ge<<5^ht[he])&32767,++he;Ne-=Et-1}else ot<=143?ot=ot+48:oe=Ie(Ke,oe,1),oe=je(Ke,oe,_e[ot]),Ce[Ge]=he&32767,++he}oe=je(Ke,oe,0)-1}return Ke.l=(oe+7)/8|0,Ke.l}return function(Ke,oe){return Ke.length<8?ke(Ke,oe):$e(Ke,oe)}})();function ft(le){var be=wt(50+Math.floor(le.length*1.1)),pe=yt(le,be);return be.slice(0,pe)}var _t=ge?new Uint16Array(32768):mt(32768),zt=ge?new Uint16Array(32768):mt(32768),Jt=ge?new Uint16Array(128):mt(128),De=1,ut=1;function pt(le,be){var pe=Xe(le,be)+257;be+=5;var xe=Xe(le,be)+1;be+=5;var Se=qe(le,be)+4;be+=4;for(var ke=0,$e=ge?new Uint8Array(19):mt(19),ht=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ke=1,oe=ge?new Uint8Array(8):mt(8),he=ge?new Uint8Array(8):mt(8),Ce=$e.length,Ne=0;Ne<Se;++Ne)$e[Y[Ne]]=ke=He(le,be),Ke<ke&&(Ke=ke),oe[ke]++,be+=3;var Ge=0;for(oe[0]=0,Ne=1;Ne<=Ke;++Ne)he[Ne]=Ge=Ge+oe[Ne-1]<<1;for(Ne=0;Ne<Ce;++Ne)(Ge=$e[Ne])!=0&&(ht[Ne]=he[Ge]++);var ot=0;for(Ne=0;Ne<Ce;++Ne)if(ot=$e[Ne],ot!=0){Ge=_e[ht[Ne]]>>8-ot;for(var Le=(1<<7-ot)-1;Le>=0;--Le)Jt[Ge|Le<<ot]=ot&7|Ne<<3}var Et=[];for(Ke=1;Et.length<pe+xe;)switch(Ge=Jt[Ve(le,be)],be+=Ge&7,Ge>>>=3){case 16:for(ke=3+me(le,be),be+=2,Ge=Et[Et.length-1];ke-- >0;)Et.push(Ge);break;case 17:for(ke=3+He(le,be),be+=3;ke-- >0;)Et.push(0);break;case 18:for(ke=11+Ve(le,be),be+=7;ke-- >0;)Et.push(0);break;default:Et.push(Ge),Ke<Ge&&(Ke=Ge);break}var Bt=Et.slice(0,pe),Yt=Et.slice(pe);for(Ne=pe;Ne<286;++Ne)Bt[Ne]=0;for(Ne=xe;Ne<30;++Ne)Yt[Ne]=0;return De=$t(Bt,_t,286),ut=$t(Yt,zt,30),be}function Pt(le,be){if(le[0]==3&&!(le[1]&3))return[Bu(be),2];for(var pe=0,xe=0,Se=pN(be||1<<18),ke=0,$e=Se.length>>>0,ht=0,Ke=0;(xe&1)==0;){if(xe=He(le,pe),pe+=3,xe>>>1)xe>>1==1?(ht=9,Ke=5):(pe=pt(le,pe),ht=De,Ke=ut);else{pe&7&&(pe+=8-(pe&7));var oe=le[pe>>>3]|le[(pe>>>3)+1]<<8;if(pe+=32,oe>0)for(!be&&$e<ke+oe&&(Se=bt(Se,ke+oe),$e=Se.length);oe-- >0;)Se[ke++]=le[pe>>>3],pe+=8;continue}for(;;){!be&&$e<ke+32767&&(Se=bt(Se,ke+32767),$e=Se.length);var he=It(le,pe,ht),Ce=xe>>>1==1?Wt[he]:_t[he];if(pe+=Ce&15,Ce>>>=4,(Ce>>>8&255)===0)Se[ke++]=Ce;else{if(Ce==256)break;Ce-=257;var Ne=Ce<8?0:Ce-4>>2;Ne>5&&(Ne=0);var Ge=ke+te[Ce];Ne>0&&(Ge+=It(le,pe,Ne),pe+=Ne),he=It(le,pe,Ke),Ce=xe>>>1==1?lt[he]:zt[he],pe+=Ce&15,Ce>>>=4;var ot=Ce<4?0:Ce-2>>1,Le=ee[Ce];for(ot>0&&(Le+=It(le,pe,ot),pe+=ot),!be&&$e<Ge&&(Se=bt(Se,Ge+100),$e=Se.length);ke<Ge;)Se[ke]=Se[ke-Le],++ke}}}return be?[Se,pe+7>>>3]:[Se.slice(0,ke),pe+7>>>3]}function Lt(le,be){var pe=le.slice(le.l||0),xe=Pt(pe,be);return le.l+=xe[1],xe[0]}function sr(le,be){if(le)typeof console<"u"&&console.error(be);else throw new Error(be)}function Te(le,be){var pe=le;ya(pe,0);var xe=[],Se=[],ke={FileIndex:xe,FullPaths:Se};R(ke,{root:be.root});for(var $e=pe.length-4;(pe[$e]!=80||pe[$e+1]!=75||pe[$e+2]!=5||pe[$e+3]!=6)&&$e>=0;)--$e;pe.l=$e+4,pe.l+=4;var ht=pe.read_shift(2);pe.l+=6;var Ke=pe.read_shift(4);for(pe.l=Ke,$e=0;$e<ht;++$e){pe.l+=20;var oe=pe.read_shift(4),he=pe.read_shift(4),Ce=pe.read_shift(2),Ne=pe.read_shift(2),Ge=pe.read_shift(2);pe.l+=8;var ot=pe.read_shift(4),Le=l(pe.slice(pe.l+Ce,pe.l+Ce+Ne));pe.l+=Ce+Ne+Ge;var Et=pe.l;pe.l=ot+4,ve(pe,oe,he,ke,Le),pe.l=Et}return ke}function ve(le,be,pe,xe,Se){le.l+=2;var ke=le.read_shift(2),$e=le.read_shift(2),ht=i(le);if(ke&8257)throw new Error("Unsupported ZIP encryption");for(var Ke=le.read_shift(4),oe=le.read_shift(4),he=le.read_shift(4),Ce=le.read_shift(2),Ne=le.read_shift(2),Ge="",ot=0;ot<Ce;++ot)Ge+=String.fromCharCode(le[le.l++]);if(Ne){var Le=l(le.slice(le.l,le.l+Ne));(Le[21589]||{}).mt&&(ht=Le[21589].mt),((Se||{})[21589]||{}).mt&&(ht=Se[21589].mt)}le.l+=Ne;var Et=le.slice(le.l,le.l+oe);switch($e){case 8:Et=z(le,he);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+$e)}var Bt=!1;ke&8&&(Ke=le.read_shift(4),Ke==134695760&&(Ke=le.read_shift(4),Bt=!0),oe=le.read_shift(4),he=le.read_shift(4)),oe!=be&&sr(Bt,"Bad compressed size: "+be+" != "+oe),he!=pe&&sr(Bt,"Bad uncompressed size: "+pe+" != "+he),fr(xe,Ge,Et,{unsafe:!0,mt:ht})}function fe(le,be){var pe=be||{},xe=[],Se=[],ke=wt(1),$e=pe.compression?8:0,ht=0,Ke=0,oe=0,he=0,Ce=0,Ne=le.FullPaths[0],Ge=Ne,ot=le.FileIndex[0],Le=[],Et=0;for(Ke=1;Ke<le.FullPaths.length;++Ke)if(Ge=le.FullPaths[Ke].slice(Ne.length),ot=le.FileIndex[Ke],!(!ot.size||!ot.content||Ge=="Sh33tJ5")){var Bt=he,Yt=wt(Ge.length);for(oe=0;oe<Ge.length;++oe)Yt.write_shift(1,Ge.charCodeAt(oe)&127);Yt=Yt.slice(0,Yt.l),Le[Ce]=kH.buf(ot.content,0);var Fe=ot.content;$e==8&&(Fe=Q(Fe)),ke=wt(30),ke.write_shift(4,67324752),ke.write_shift(2,20),ke.write_shift(2,ht),ke.write_shift(2,$e),ot.mt?a(ke,ot.mt):ke.write_shift(4,0),ke.write_shift(-4,Le[Ce]),ke.write_shift(4,Fe.length),ke.write_shift(4,ot.content.length),ke.write_shift(2,Yt.length),ke.write_shift(2,0),he+=ke.length,xe.push(ke),he+=Yt.length,xe.push(Yt),he+=Fe.length,xe.push(Fe),ke=wt(46),ke.write_shift(4,33639248),ke.write_shift(2,0),ke.write_shift(2,20),ke.write_shift(2,ht),ke.write_shift(2,$e),ke.write_shift(4,0),ke.write_shift(-4,Le[Ce]),ke.write_shift(4,Fe.length),ke.write_shift(4,ot.content.length),ke.write_shift(2,Yt.length),ke.write_shift(2,0),ke.write_shift(2,0),ke.write_shift(2,0),ke.write_shift(2,0),ke.write_shift(4,0),ke.write_shift(4,Bt),Et+=ke.l,Se.push(ke),Et+=Yt.length,Se.push(Yt),++Ce}return ke=wt(22),ke.write_shift(4,101010256),ke.write_shift(2,0),ke.write_shift(2,0),ke.write_shift(2,Ce),ke.write_shift(2,Ce),ke.write_shift(4,Et),ke.write_shift(4,he),ke.write_shift(2,0),ta([ta(xe),ta(Se),ke])}var we={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Ue(le,be){if(le.ctype)return le.ctype;var pe=le.name||"",xe=pe.match(/\.([^\.]+)$/);return xe&&we[xe[1]]||be&&(xe=(pe=be).match(/[\.\\]([^\.\\])+$/),xe&&we[xe[1]])?we[xe[1]]:"application/octet-stream"}function St(le){for(var be=cp(le),pe=[],xe=0;xe<be.length;xe+=76)pe.push(be.slice(xe,xe+76));return pe.join(`\r
`)+`\r
`}function xt(le){var be=le.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(oe){var he=oe.charCodeAt(0).toString(16).toUpperCase();return"="+(he.length==1?"0"+he:he)});be=be.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),be.charAt(0)==`
`&&(be="=0D"+be.slice(1)),be=be.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var pe=[],xe=be.split(`\r
`),Se=0;Se<xe.length;++Se){var ke=xe[Se];if(ke.length==0){pe.push("");continue}for(var $e=0;$e<ke.length;){var ht=76,Ke=ke.slice($e,$e+ht);Ke.charAt(ht-1)=="="?ht--:Ke.charAt(ht-2)=="="?ht-=2:Ke.charAt(ht-3)=="="&&(ht-=3),Ke=ke.slice($e,$e+ht),$e+=ht,$e<ke.length&&(Ke+="="),pe.push(Ke)}}return pe.join(`\r
`)}function Ht(le){for(var be=[],pe=0;pe<le.length;++pe){for(var xe=le[pe];pe<=le.length&&xe.charAt(xe.length-1)=="=";)xe=xe.slice(0,xe.length-1)+le[++pe];be.push(xe)}for(var Se=0;Se<be.length;++Se)be[Se]=be[Se].replace(/[=][0-9A-Fa-f]{2}/g,function(ke){return String.fromCharCode(parseInt(ke.slice(1),16))});return Bi(be.join(`\r
`))}function Ot(le,be,pe){for(var xe="",Se="",ke="",$e,ht=0;ht<10;++ht){var Ke=be[ht];if(!Ke||Ke.match(/^\s*$/))break;var oe=Ke.match(/^(.*?):\s*([^\s].*)$/);if(oe)switch(oe[1].toLowerCase()){case"content-location":xe=oe[2].trim();break;case"content-type":ke=oe[2].trim();break;case"content-transfer-encoding":Se=oe[2].trim();break}}switch(++ht,Se.toLowerCase()){case"base64":$e=Bi(Wi(be.slice(ht).join("")));break;case"quoted-printable":$e=Ht(be.slice(ht));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+Se)}var he=fr(le,xe.slice(pe.length),$e,{unsafe:!0});ke&&(he.ctype=ke)}function Xt(le,be){if(L(le.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var pe=be&&be.root||"",xe=(Lr&&Buffer.isBuffer(le)?le.toString("binary"):L(le)).split(`\r
`),Se=0,ke="";for(Se=0;Se<xe.length;++Se)if(ke=xe[Se],!!/^Content-Location:/i.test(ke)&&(ke=ke.slice(ke.indexOf("file")),pe||(pe=ke.slice(0,ke.lastIndexOf("/")+1)),ke.slice(0,pe.length)!=pe))for(;pe.length>0&&(pe=pe.slice(0,pe.length-1),pe=pe.slice(0,pe.lastIndexOf("/")+1),ke.slice(0,pe.length)!=pe););var $e=(xe[1]||"").match(/boundary="(.*?)"/);if(!$e)throw new Error("MAD cannot find boundary");var ht="--"+($e[1]||""),Ke=[],oe=[],he={FileIndex:Ke,FullPaths:oe};R(he);var Ce,Ne=0;for(Se=0;Se<xe.length;++Se){var Ge=xe[Se];Ge!==ht&&Ge!==ht+"--"||(Ne++&&Ot(he,xe.slice(Ce,Se),pe),Ce=Se)}return he}function pr(le,be){var pe=be||{},xe=pe.boundary||"SheetJS";xe="------="+xe;for(var Se=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+xe.slice(2)+'"',"","",""],ke=le.FullPaths[0],$e=ke,ht=le.FileIndex[0],Ke=1;Ke<le.FullPaths.length;++Ke)if($e=le.FullPaths[Ke].slice(ke.length),ht=le.FileIndex[Ke],!(!ht.size||!ht.content||$e=="Sh33tJ5")){$e=$e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Et){return"_x"+Et.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Et){return"_u"+Et.charCodeAt(0).toString(16)+"_"});for(var oe=ht.content,he=Lr&&Buffer.isBuffer(oe)?oe.toString("binary"):L(oe),Ce=0,Ne=Math.min(1024,he.length),Ge=0,ot=0;ot<=Ne;++ot)(Ge=he.charCodeAt(ot))>=32&&Ge<128&&++Ce;var Le=Ce>=Ne*4/5;Se.push(xe),Se.push("Content-Location: "+(pe.root||"file:///C:/SheetJS/")+$e),Se.push("Content-Transfer-Encoding: "+(Le?"quoted-printable":"base64")),Se.push("Content-Type: "+Ue(ht,$e)),Se.push(""),Se.push(Le?xt(he):St(he))}return Se.push(xe+`--\r
`),Se.join(`\r
`)}function Fr(le){var be={};return R(be,le),be}function fr(le,be,pe,xe){var Se=xe&&xe.unsafe;Se||R(le);var ke=!Se&&mr.find(le,be);if(!ke){var $e=le.FullPaths[0];be.slice(0,$e.length)==$e?$e=be:($e.slice(-1)!="/"&&($e+="/"),$e=($e+be).replace("//","/")),ke={name:s(be),type:2},le.FileIndex.push(ke),le.FullPaths.push($e),Se||mr.utils.cfb_gc(le)}return ke.content=pe,ke.size=pe?pe.length:0,xe&&(xe.CLSID&&(ke.clsid=xe.CLSID),xe.mt&&(ke.mt=xe.mt),xe.ct&&(ke.ct=xe.ct)),ke}function vr(le,be){R(le);var pe=mr.find(le,be);if(pe){for(var xe=0;xe<le.FileIndex.length;++xe)if(le.FileIndex[xe]==pe)return le.FileIndex.splice(xe,1),le.FullPaths.splice(xe,1),!0}return!1}function Mr(le,be,pe){R(le);var xe=mr.find(le,be);if(xe){for(var Se=0;Se<le.FileIndex.length;++Se)if(le.FileIndex[Se]==xe)return le.FileIndex[Se].name=s(pe),le.FullPaths[Se]=pe,!0}return!1}function sn(le){D(le,!0)}return t.find=V,t.read=P,t.parse=f,t.write=H,t.writeFile=W,t.utils={cfb_new:Fr,cfb_add:fr,cfb_del:vr,cfb_mov:Mr,cfb_gc:sn,ReadShift:Mm,CheckField:D8,prep_blob:ya,bconcat:ta,use_zlib:B,_deflateRaw:ft,_inflateRaw:Lt,consts:M},t})();function CH(e){return typeof e=="string"?Zy(e):Array.isArray(e)?Qz(e):e}function Gp(e,t,r){if(typeof Deno<"u"){if(r&&typeof t=="string")switch(r){case"utf8":t=new TextEncoder(r).encode(t);break;case"binary":t=Zy(t);break;default:throw new Error("Unsupported encoding "+r)}return Deno.writeFileSync(e,t)}var n=r=="utf8"?Tl(t):t;if(typeof IE_SaveFile<"u")return IE_SaveFile(n,e);if(typeof Blob<"u"){var s=new Blob([CH(n)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(s,e);if(typeof saveAs<"u")return saveAs(s,e);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var a=URL.createObjectURL(s);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),chrome.downloads.download({url:a,filename:e,saveAs:!0});var i=document.createElement("a");if(i.download!=null)return i.download=e,i.href=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),a}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var l=File(e);return l.open("w"),l.encoding="binary",Array.isArray(t)&&(t=Yu(t)),l.write(t),l.close(),t}catch(c){if(!c.message||!c.message.match(/onstruct/))throw c}throw new Error("cannot save file "+e)}function TH(e){if(typeof Deno<"u")return Deno.readFileSync(e);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var t=File(e);t.open("r"),t.encoding="binary";var r=t.read();return t.close(),r}catch(n){if(!n.message||!n.message.match(/onstruct/))throw n}throw new Error("Cannot access file "+e)}function os(e){for(var t=Object.keys(e),r=[],n=0;n<t.length;++n)Object.prototype.hasOwnProperty.call(e,t[n])&&r.push(t[n]);return r}function kN(e,t){for(var r=[],n=os(e),s=0;s!==n.length;++s)r[e[n[s]][t]]==null&&(r[e[n[s]][t]]=n[s]);return r}function tv(e){for(var t=[],r=os(e),n=0;n!==r.length;++n)t[e[r[n]]]=r[n];return t}function rv(e){for(var t=[],r=os(e),n=0;n!==r.length;++n)t[e[r[n]]]=parseInt(r[n],10);return t}function EH(e){for(var t=[],r=os(e),n=0;n!==r.length;++n)t[e[r[n]]]==null&&(t[e[r[n]]]=[]),t[e[r[n]]].push(r[n]);return t}var py=new Date(1899,11,30,0,0,0);function zs(e,t){var r=e.getTime(),n=py.getTime()+(e.getTimezoneOffset()-py.getTimezoneOffset())*6e4;return(r-n)/(1440*60*1e3)}var h8=new Date,NH=py.getTime()+(h8.getTimezoneOffset()-py.getTimezoneOffset())*6e4,CN=h8.getTimezoneOffset();function nv(e){var t=new Date;return t.setTime(e*24*60*60*1e3+NH),t.getTimezoneOffset()!==CN&&t.setTime(t.getTime()+(t.getTimezoneOffset()-CN)*6e4),t}function AH(e){var t=0,r=0,n=!1,s=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!s)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var a=1;a!=s.length;++a)if(s[a]){switch(r=1,a>3&&(n=!0),s[a].slice(s[a].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+s[a].slice(s[a].length-1));case"D":r*=24;case"H":r*=60;case"M":if(n)r*=60;else throw new Error("Unsupported ISO Duration Field: M")}t+=r*parseInt(s[a],10)}return t}var TN=new Date("2017-02-19T19:06:09.000Z"),g8=isNaN(TN.getFullYear())?new Date("2/19/17"):TN,jH=g8.getFullYear()==2017;function On(e,t){var r=new Date(e);if(jH)return t>0?r.setTime(r.getTime()+r.getTimezoneOffset()*60*1e3):t<0&&r.setTime(r.getTime()-r.getTimezoneOffset()*60*1e3),r;if(e instanceof Date)return e;if(g8.getFullYear()==1917&&!isNaN(r.getFullYear())){var n=r.getFullYear();return e.indexOf(""+n)>-1||r.setFullYear(r.getFullYear()+100),r}var s=e.match(/\d+/g)||["2017","2","19","0","0","0"],a=new Date(+s[0],+s[1]-1,+s[2],+s[3]||0,+s[4]||0,+s[5]||0);return e.indexOf("Z")>-1&&(a=new Date(a.getTime()-a.getTimezoneOffset()*60*1e3)),a}function ff(e,t){if(Lr&&Buffer.isBuffer(e)){if(t){if(e[0]==255&&e[1]==254)return Tl(e.slice(2).toString("utf16le"));if(e[1]==254&&e[2]==255)return Tl(t8(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(t){if(e[0]==255&&e[1]==254)return Tl(new TextDecoder("utf-16le").decode(e.slice(2)));if(e[0]==254&&e[1]==255)return Tl(new TextDecoder("utf-16be").decode(e.slice(2)))}var r={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(a){return r[a]||a})}catch{}for(var n=[],s=0;s!=e.length;++s)n.push(String.fromCharCode(e[s]));return n.join("")}function Ln(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=Ln(e[r]));return t}function as(e,t){for(var r="";r.length<t;)r+=e;return r}function Go(e){var t=Number(e);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(e))return t;var r=1,n=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return r*=100,""});return!isNaN(t=Number(n))||(n=n.replace(/[(](.*)[)]/,function(s,a){return r=-r,a}),!isNaN(t=Number(n)))?t/r:t}var FH=["january","february","march","april","may","june","july","august","september","october","november","december"];function d0(e){var t=new Date(e),r=new Date(NaN),n=t.getYear(),s=t.getMonth(),a=t.getDate();if(isNaN(a))return r;var i=e.toLowerCase();if(i.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(i=i.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),i.length>3&&FH.indexOf(i)==-1)return r}else if(i.match(/[a-z]/))return r;return n<0||n>8099?r:(s>0||a>1)&&n!=101?t:e.match(/[^-0-9:,\/\\]/)?r:t}var PH=(function(){var e="abacaba".split(/(:?b)/i).length==5;return function(r,n,s){if(e||typeof n=="string")return r.split(n);for(var a=r.split(n),i=[a[0]],l=1;l<a.length;++l)i.push(s),i.push(a[l]);return i}})();function m8(e){return e?e.content&&e.type?ff(e.content,!0):e.data?Sm(e.data):e.asNodeBuffer&&Lr?Sm(e.asNodeBuffer().toString("binary")):e.asBinary?Sm(e.asBinary()):e._data&&e._data.getContent?Sm(ff(Array.prototype.slice.call(e._data.getContent(),0))):null:null}function p8(e){if(!e)return null;if(e.data)return gN(e.data);if(e.asNodeBuffer&&Lr)return e.asNodeBuffer();if(e._data&&e._data.getContent){var t=e._data.getContent();return typeof t=="string"?gN(t):Array.prototype.slice.call(t)}return e.content&&e.type?e.content:null}function RH(e){return e&&e.name.slice(-4)===".bin"?p8(e):m8(e)}function uo(e,t){for(var r=e.FullPaths||os(e.files),n=t.toLowerCase().replace(/[\/]/g,"\\"),s=n.replace(/\\/g,"/"),a=0;a<r.length;++a){var i=r[a].replace(/^Root Entry[\/]/,"").toLowerCase();if(n==i||s==i)return e.files?e.files[r[a]]:e.FileIndex[a]}return null}function uS(e,t){var r=uo(e,t);if(r==null)throw new Error("Cannot find file "+t+" in zip");return r}function Ns(e,t,r){if(!r)return RH(uS(e,t));if(!t)return null;try{return Ns(e,t)}catch{return null}}function Ui(e,t,r){if(!r)return m8(uS(e,t));if(!t)return null;try{return Ui(e,t)}catch{return null}}function DH(e,t,r){return p8(uS(e,t))}function EN(e){for(var t=e.FullPaths||os(e.files),r=[],n=0;n<t.length;++n)t[n].slice(-1)!="/"&&r.push(t[n].replace(/^Root Entry[\/]/,""));return r.sort()}function Ir(e,t,r){if(e.FullPaths){if(typeof r=="string"){var n;return Lr?n=jc(r):n=Jz(r),mr.utils.cfb_add(e,t,n)}mr.utils.cfb_add(e,t,r)}else e.file(t,r)}function dS(){return mr.utils.cfb_new()}function x8(e,t){switch(t.type){case"base64":return mr.read(e,{type:"base64"});case"binary":return mr.read(e,{type:"binary"});case"buffer":case"array":return mr.read(e,{type:"buffer"})}throw new Error("Unrecognized type "+t.type)}function Cm(e,t){if(e.charAt(0)=="/")return e.slice(1);var r=t.split("/");t.slice(-1)!="/"&&r.pop();for(var n=e.split("/");n.length!==0;){var s=n.shift();s===".."?r.pop():s!=="."&&r.push(s)}return r.join("/")}var ws=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,IH=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,NN=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,MH=/<[^>]*>/g,za=ws.match(NN)?NN:MH,OH=/<\w*:/,LH=/<(\/?)\w+:/;function kr(e,t,r){for(var n={},s=0,a=0;s!==e.length&&!((a=e.charCodeAt(s))===32||a===10||a===13);++s);if(t||(n[0]=e.slice(0,s)),s===e.length)return n;var i=e.match(IH),l=0,c="",d=0,f="",p="",g=1;if(i)for(d=0;d!=i.length;++d){for(p=i[d],a=0;a!=p.length&&p.charCodeAt(a)!==61;++a);for(f=p.slice(0,a).trim();p.charCodeAt(a+1)==32;)++a;for(g=(s=p.charCodeAt(a+1))==34||s==39?1:0,c=p.slice(a+1+g,p.length-g),l=0;l!=f.length&&f.charCodeAt(l)!==58;++l);if(l===f.length)f.indexOf("_")>0&&(f=f.slice(0,f.indexOf("_"))),n[f]=c,n[f.toLowerCase()]=c;else{var y=(l===5&&f.slice(0,5)==="xmlns"?"xmlns":"")+f.slice(l+1);if(n[y]&&f.slice(l-3,l)=="ext")continue;n[y]=c,n[y.toLowerCase()]=c}}return n}function Dl(e){return e.replace(LH,"<$1")}var y8={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},fS=tv(y8),Qr=(function(){var e=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,t=/_x([\da-fA-F]{4})_/ig;return function r(n){var s=n+"",a=s.indexOf("<![CDATA[");if(a==-1)return s.replace(e,function(l,c){return y8[l]||String.fromCharCode(parseInt(c,l.indexOf("x")>-1?16:10))||l}).replace(t,function(l,c){return String.fromCharCode(parseInt(c,16))});var i=s.indexOf("]]>");return r(s.slice(0,a))+s.slice(a+9,i)+r(s.slice(i+3))}})(),hS=/[&<>'"]/g,BH=/[\u0000-\u0008\u000b-\u001f]/g;function pn(e){var t=e+"";return t.replace(hS,function(r){return fS[r]}).replace(BH,function(r){return"_x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+"_"})}function AN(e){return pn(e).replace(/ /g,"_x0020_")}var v8=/[\u0000-\u001f]/g;function gS(e){var t=e+"";return t.replace(hS,function(r){return fS[r]}).replace(/\n/g,"<br/>").replace(v8,function(r){return"&#x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+";"})}function UH(e){var t=e+"";return t.replace(hS,function(r){return fS[r]}).replace(v8,function(r){return"&#x"+r.charCodeAt(0).toString(16).toUpperCase()+";"})}var jN=(function(){var e=/&#(\d+);/g;function t(r,n){return String.fromCharCode(parseInt(n,10))}return function(n){return n.replace(e,t)}})();function $H(e){return e.replace(/(\r\n|[\r\n])/g,"&#10;")}function Rn(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function $w(e){for(var t="",r=0,n=0,s=0,a=0,i=0,l=0;r<e.length;){if(n=e.charCodeAt(r++),n<128){t+=String.fromCharCode(n);continue}if(s=e.charCodeAt(r++),n>191&&n<224){i=(n&31)<<6,i|=s&63,t+=String.fromCharCode(i);continue}if(a=e.charCodeAt(r++),n<240){t+=String.fromCharCode((n&15)<<12|(s&63)<<6|a&63);continue}i=e.charCodeAt(r++),l=((n&7)<<18|(s&63)<<12|(a&63)<<6|i&63)-65536,t+=String.fromCharCode(55296+(l>>>10&1023)),t+=String.fromCharCode(56320+(l&1023))}return t}function FN(e){var t=Bu(2*e.length),r,n,s=1,a=0,i=0,l;for(n=0;n<e.length;n+=s)s=1,(l=e.charCodeAt(n))<128?r=l:l<224?(r=(l&31)*64+(e.charCodeAt(n+1)&63),s=2):l<240?(r=(l&15)*4096+(e.charCodeAt(n+1)&63)*64+(e.charCodeAt(n+2)&63),s=3):(s=4,r=(l&7)*262144+(e.charCodeAt(n+1)&63)*4096+(e.charCodeAt(n+2)&63)*64+(e.charCodeAt(n+3)&63),r-=65536,i=55296+(r>>>10&1023),r=56320+(r&1023)),i!==0&&(t[a++]=i&255,t[a++]=i>>>8,i=0),t[a++]=r%256,t[a++]=r>>>8;return t.slice(0,a).toString("ucs2")}function PN(e){return jc(e,"binary").toString("utf8")}var x1="foo bar bazâð£",bn=Lr&&(PN(x1)==$w(x1)&&PN||FN(x1)==$w(x1)&&FN)||$w,Tl=Lr?function(e){return jc(e,"utf8").toString("binary")}:function(e){for(var t=[],r=0,n=0,s=0;r<e.length;)switch(n=e.charCodeAt(r++),!0){case n<128:t.push(String.fromCharCode(n));break;case n<2048:t.push(String.fromCharCode(192+(n>>6))),t.push(String.fromCharCode(128+(n&63)));break;case(n>=55296&&n<57344):n-=55296,s=e.charCodeAt(r++)-56320+(n<<10),t.push(String.fromCharCode(240+(s>>18&7))),t.push(String.fromCharCode(144+(s>>12&63))),t.push(String.fromCharCode(128+(s>>6&63))),t.push(String.fromCharCode(128+(s&63)));break;default:t.push(String.fromCharCode(224+(n>>12))),t.push(String.fromCharCode(128+(n>>6&63))),t.push(String.fromCharCode(128+(n&63)))}return t.join("")},dp=(function(){var e={};return function(r,n){var s=r+"|"+(n||"");return e[s]?e[s]:e[s]=new RegExp("<(?:\\w+:)?"+r+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+r+">",n||"")}})(),w8=(function(){var e=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(t){return[new RegExp("&"+t[0]+";","ig"),t[1]]});return function(r){for(var n=r.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),s=0;s<e.length;++s)n=n.replace(e[s][0],e[s][1]);return n}})(),WH=(function(){var e={};return function(r){return e[r]!==void 0?e[r]:e[r]=new RegExp("<(?:vt:)?"+r+">([\\s\\S]*?)</(?:vt:)?"+r+">","g")}})(),zH=/<\/?(?:vt:)?variant>/g,HH=/<(?:vt:)([^>]*)>([\s\S]*)</;function RN(e,t){var r=kr(e),n=e.match(WH(r.baseType))||[],s=[];if(n.length!=r.size){if(t.WTF)throw new Error("unexpected vector length "+n.length+" != "+r.size);return s}return n.forEach(function(a){var i=a.replace(zH,"").match(HH);i&&s.push({v:bn(i[2]),t:i[1]})}),s}var _8=/(^\s|\s$|\n)/;function _a(e,t){return"<"+e+(t.match(_8)?' xml:space="preserve"':"")+">"+t+"</"+e+">"}function fp(e){return os(e).map(function(t){return" "+t+'="'+e[t]+'"'}).join("")}function Gt(e,t,r){return"<"+e+(r!=null?fp(r):"")+(t!=null?(t.match(_8)?' xml:space="preserve"':"")+">"+t+"</"+e:"/")+">"}function o2(e,t){try{return e.toISOString().replace(/\.\d*/,"")}catch(r){if(t)throw r}return""}function GH(e,t){switch(typeof e){case"string":var r=Gt("vt:lpwstr",pn(e));return r=r.replace(/&quot;/g,"_x0022_"),r;case"number":return Gt((e|0)==e?"vt:i4":"vt:r8",pn(String(e)));case"boolean":return Gt("vt:bool",e?"true":"false")}if(e instanceof Date)return Gt("vt:filetime",o2(e));throw new Error("Unable to serialize "+e)}function mS(e){if(Lr&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e=="string")return e;if(typeof Uint8Array<"u"&&e instanceof Uint8Array)return bn(Yu(oS(e)));throw new Error("Bad input format: expected Buffer or string")}var hp=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,$s={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},wf=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],Oi={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function VH(e,t){for(var r=1-2*(e[t+7]>>>7),n=((e[t+7]&127)<<4)+(e[t+6]>>>4&15),s=e[t+6]&15,a=5;a>=0;--a)s=s*256+e[t+a];return n==2047?s==0?r*(1/0):NaN:(n==0?n=-1022:(n-=1023,s+=Math.pow(2,52)),r*Math.pow(2,n-52)*s)}function KH(e,t,r){var n=(t<0||1/t==-1/0?1:0)<<7,s=0,a=0,i=n?-t:t;isFinite(i)?i==0?s=a=0:(s=Math.floor(Math.log(i)/Math.LN2),a=i*Math.pow(2,52-s),s<=-1023&&(!isFinite(a)||a<Math.pow(2,52))?s=-1022:(a-=Math.pow(2,52),s+=1023)):(s=2047,a=isNaN(t)?26985:0);for(var l=0;l<=5;++l,a/=256)e[r+l]=a&255;e[r+6]=(s&15)<<4|a&15,e[r+7]=s>>4|n}var DN=function(e){for(var t=[],r=10240,n=0;n<e[0].length;++n)if(e[0][n])for(var s=0,a=e[0][n].length;s<a;s+=r)t.push.apply(t,e[0][n].slice(s,s+r));return t},IN=Lr?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(t){return Buffer.isBuffer(t)?t:jc(t)})):DN(e)}:DN,MN=function(e,t,r){for(var n=[],s=t;s<r;s+=2)n.push(String.fromCharCode(yc(e,s)));return n.join("").replace(oi,"")},pS=Lr?function(e,t,r){return Buffer.isBuffer(e)?e.toString("utf16le",t,r).replace(oi,""):MN(e,t,r)}:MN,ON=function(e,t,r){for(var n=[],s=t;s<t+r;++s)n.push(("0"+e[s].toString(16)).slice(-2));return n.join("")},b8=Lr?function(e,t,r){return Buffer.isBuffer(e)?e.toString("hex",t,t+r):ON(e,t,r)}:ON,LN=function(e,t,r){for(var n=[],s=t;s<r;s++)n.push(String.fromCharCode(Dh(e,s)));return n.join("")},Vp=Lr?function(t,r,n){return Buffer.isBuffer(t)?t.toString("utf8",r,n):LN(t,r,n)}:LN,S8=function(e,t){var r=Li(e,t);return r>0?Vp(e,t+4,t+4+r-1):""},k8=S8,C8=function(e,t){var r=Li(e,t);return r>0?Vp(e,t+4,t+4+r-1):""},T8=C8,E8=function(e,t){var r=2*Li(e,t);return r>0?Vp(e,t+4,t+4+r-1):""},N8=E8,A8=function(t,r){var n=Li(t,r);return n>0?pS(t,r+4,r+4+n):""},j8=A8,F8=function(e,t){var r=Li(e,t);return r>0?Vp(e,t+4,t+4+r):""},P8=F8,R8=function(e,t){return VH(e,t)},xy=R8,xS=function(t){return Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array};Lr&&(k8=function(t,r){if(!Buffer.isBuffer(t))return S8(t,r);var n=t.readUInt32LE(r);return n>0?t.toString("utf8",r+4,r+4+n-1):""},T8=function(t,r){if(!Buffer.isBuffer(t))return C8(t,r);var n=t.readUInt32LE(r);return n>0?t.toString("utf8",r+4,r+4+n-1):""},N8=function(t,r){if(!Buffer.isBuffer(t))return E8(t,r);var n=2*t.readUInt32LE(r);return t.toString("utf16le",r+4,r+4+n-1)},j8=function(t,r){if(!Buffer.isBuffer(t))return A8(t,r);var n=t.readUInt32LE(r);return t.toString("utf16le",r+4,r+4+n)},P8=function(t,r){if(!Buffer.isBuffer(t))return F8(t,r);var n=t.readUInt32LE(r);return t.toString("utf8",r+4,r+4+n)},xy=function(t,r){return Buffer.isBuffer(t)?t.readDoubleLE(r):R8(t,r)},xS=function(t){return Buffer.isBuffer(t)||Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array});var Dh=function(e,t){return e[t]},yc=function(e,t){return e[t+1]*256+e[t]},qH=function(e,t){var r=e[t+1]*256+e[t];return r<32768?r:(65535-r+1)*-1},Li=function(e,t){return e[t+3]*(1<<24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]},Id=function(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]},XH=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]};function Mm(e,t){var r="",n,s,a=[],i,l,c,d;switch(t){case"dbcs":if(d=this.l,Lr&&Buffer.isBuffer(this))r=this.slice(this.l,this.l+2*e).toString("utf16le");else for(c=0;c<e;++c)r+=String.fromCharCode(yc(this,d)),d+=2;e*=2;break;case"utf8":r=Vp(this,this.l,this.l+e);break;case"utf16le":e*=2,r=pS(this,this.l,this.l+e);break;case"wstr":return Mm.call(this,e,"dbcs");case"lpstr-ansi":r=k8(this,this.l),e=4+Li(this,this.l);break;case"lpstr-cp":r=T8(this,this.l),e=4+Li(this,this.l);break;case"lpwstr":r=N8(this,this.l),e=4+2*Li(this,this.l);break;case"lpp4":e=4+Li(this,this.l),r=j8(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+Li(this,this.l),r=P8(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,r="";(i=Dh(this,this.l+e++))!==0;)a.push(p1(i));r=a.join("");break;case"_wstr":for(e=0,r="";(i=yc(this,this.l+e))!==0;)a.push(p1(i)),e+=2;e+=2,r=a.join("");break;case"dbcs-cont":for(r="",d=this.l,c=0;c<e;++c){if(this.lens&&this.lens.indexOf(d)!==-1)return i=Dh(this,d),this.l=d+1,l=Mm.call(this,e-c,i?"dbcs-cont":"sbcs-cont"),a.join("")+l;a.push(p1(yc(this,d))),d+=2}r=a.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(r="",d=this.l,c=0;c!=e;++c){if(this.lens&&this.lens.indexOf(d)!==-1)return i=Dh(this,d),this.l=d+1,l=Mm.call(this,e-c,i?"dbcs-cont":"sbcs-cont"),a.join("")+l;a.push(p1(Dh(this,d))),d+=1}r=a.join("");break;default:switch(e){case 1:return n=Dh(this,this.l),this.l++,n;case 2:return n=(t==="i"?qH:yc)(this,this.l),this.l+=2,n;case 4:case-4:return t==="i"||(this[this.l+3]&128)===0?(n=(e>0?Id:XH)(this,this.l),this.l+=4,n):(s=Li(this,this.l),this.l+=4,s);case 8:case-8:if(t==="f")return e==8?s=xy(this,this.l):s=xy([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,s;e=8;case 16:r=b8(this,this.l,e);break}}return this.l+=e,r}var YH=function(e,t,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24&255},QH=function(e,t,r){e[r]=t&255,e[r+1]=t>>8&255,e[r+2]=t>>16&255,e[r+3]=t>>24&255},JH=function(e,t,r){e[r]=t&255,e[r+1]=t>>>8&255};function ZH(e,t,r){var n=0,s=0;if(r==="dbcs"){for(s=0;s!=t.length;++s)JH(this,t.charCodeAt(s),this.l+2*s);n=2*t.length}else if(r==="sbcs"){for(t=t.replace(/[^\x00-\x7F]/g,"_"),s=0;s!=t.length;++s)this[this.l+s]=t.charCodeAt(s)&255;n=t.length}else if(r==="hex"){for(;s<e;++s)this[this.l++]=parseInt(t.slice(2*s,2*s+2),16)||0;return this}else if(r==="utf16le"){var a=Math.min(this.l+e,this.length);for(s=0;s<Math.min(t.length,e);++s){var i=t.charCodeAt(s);this[this.l++]=i&255,this[this.l++]=i>>8}for(;this.l<a;)this[this.l++]=0;return this}else switch(e){case 1:n=1,this[this.l]=t&255;break;case 2:n=2,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255;break;case 3:n=3,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255,t>>>=8,this[this.l+2]=t&255;break;case 4:n=4,YH(this,t,this.l);break;case 8:if(n=8,r==="f"){KH(this,t,this.l);break}case 16:break;case-4:n=4,QH(this,t,this.l);break}return this.l+=n,this}function D8(e,t){var r=b8(this,this.l,e.length>>1);if(r!==e)throw new Error(t+"Expected "+e+" saw "+r);this.l+=e.length>>1}function ya(e,t){e.l=t,e.read_shift=Mm,e.chk=D8,e.write_shift=ZH}function Wa(e,t){e.l+=t}function wt(e){var t=Bu(e);return ya(t,0),t}function Fc(e,t,r){if(e){var n,s,a;ya(e,e.l||0);for(var i=e.length,l=0,c=0;e.l<i;){l=e.read_shift(1),l&128&&(l=(l&127)+((e.read_shift(1)&127)<<7));var d=vp[l]||vp[65535];for(n=e.read_shift(1),a=n&127,s=1;s<4&&n&128;++s)a+=((n=e.read_shift(1))&127)<<7*s;c=e.l+a;var f=d.f&&d.f(e,a,r);if(e.l=c,t(f,d,l))return}}}function Ci(){var e=[],t=Lr?256:2048,r=function(d){var f=wt(d);return ya(f,0),f},n=r(t),s=function(){n&&(n.length>n.l&&(n=n.slice(0,n.l),n.l=n.length),n.length>0&&e.push(n),n=null)},a=function(d){return n&&d<n.length-n.l?n:(s(),n=r(Math.max(d+1,t)))},i=function(){return s(),ta(e)},l=function(d){s(),n=d,n.l==null&&(n.l=n.length),a(t)};return{next:a,push:l,end:i,_bufs:e}}function Tt(e,t,r,n){var s=+t,a;if(!isNaN(s)){n||(n=vp[s].p||(r||[]).length||0),a=1+(s>=128?1:0)+1,n>=128&&++a,n>=16384&&++a,n>=2097152&&++a;var i=e.next(a);s<=127?i.write_shift(1,s):(i.write_shift(1,(s&127)+128),i.write_shift(1,s>>7));for(var l=0;l!=4;++l)if(n>=128)i.write_shift(1,(n&127)+128),n>>=7;else{i.write_shift(1,n);break}n>0&&xS(r)&&e.push(r)}}function Om(e,t,r){var n=Ln(e);if(t.s?(n.cRel&&(n.c+=t.s.c),n.rRel&&(n.r+=t.s.r)):(n.cRel&&(n.c+=t.c),n.rRel&&(n.r+=t.r)),!r||r.biff<12){for(;n.c>=256;)n.c-=256;for(;n.r>=65536;)n.r-=65536}return n}function BN(e,t,r){var n=Ln(e);return n.s=Om(n.s,t.s,r),n.e=Om(n.e,t.s,r),n}function Lm(e,t){if(e.cRel&&e.c<0)for(e=Ln(e);e.c<0;)e.c+=t>8?16384:256;if(e.rRel&&e.r<0)for(e=Ln(e);e.r<0;)e.r+=t>8?1048576:t>5?65536:16384;var r=br(e);return!e.cRel&&e.cRel!=null&&(r=rG(r)),!e.rRel&&e.rRel!=null&&(r=eG(r)),r}function Ww(e,t){return e.s.r==0&&!e.s.rRel&&e.e.r==(t.biff>=12?1048575:t.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+Kn(e.s.c)+":"+(e.e.cRel?"":"$")+Kn(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(t.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+ys(e.s.r)+":"+(e.e.rRel?"":"$")+ys(e.e.r):Lm(e.s,t.biff)+":"+Lm(e.e,t.biff)}function yS(e){return parseInt(tG(e),10)-1}function ys(e){return""+(e+1)}function eG(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function tG(e){return e.replace(/\$(\d+)$/,"$1")}function vS(e){for(var t=nG(e),r=0,n=0;n!==t.length;++n)r=26*r+t.charCodeAt(n)-64;return r-1}function Kn(e){if(e<0)throw new Error("invalid column "+e);var t="";for(++e;e;e=Math.floor((e-1)/26))t=String.fromCharCode((e-1)%26+65)+t;return t}function rG(e){return e.replace(/^([A-Z])/,"$$$1")}function nG(e){return e.replace(/^\$([A-Z])/,"$1")}function sG(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function qn(e){for(var t=0,r=0,n=0;n<e.length;++n){var s=e.charCodeAt(n);s>=48&&s<=57?t=10*t+(s-48):s>=65&&s<=90&&(r=26*r+(s-64))}return{c:r-1,r:t-1}}function br(e){for(var t=e.c+1,r="";t;t=(t-1)/26|0)r=String.fromCharCode((t-1)%26+65)+r;return r+(e.r+1)}function Ti(e){var t=e.indexOf(":");return t==-1?{s:qn(e),e:qn(e)}:{s:qn(e.slice(0,t)),e:qn(e.slice(t+1))}}function Rr(e,t){return typeof t>"u"||typeof t=="number"?Rr(e.s,e.e):(typeof e!="string"&&(e=br(e)),typeof t!="string"&&(t=br(t)),e==t?e:e+":"+t)}function Jr(e){var t={s:{c:0,r:0},e:{c:0,r:0}},r=0,n=0,s=0,a=e.length;for(r=0;n<a&&!((s=e.charCodeAt(n)-64)<1||s>26);++n)r=26*r+s;for(t.s.c=--r,r=0;n<a&&!((s=e.charCodeAt(n)-48)<0||s>9);++n)r=10*r+s;if(t.s.r=--r,n===a||s!=10)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++n,r=0;n!=a&&!((s=e.charCodeAt(n)-64)<1||s>26);++n)r=26*r+s;for(t.e.c=--r,r=0;n!=a&&!((s=e.charCodeAt(n)-48)<0||s>9);++n)r=10*r+s;return t.e.r=--r,t}function UN(e,t){var r=e.t=="d"&&t instanceof Date;if(e.z!=null)try{return e.w=vo(e.z,r?zs(t):t)}catch{}try{return e.w=vo((e.XF||{}).numFmtId||(r?14:0),r?zs(t):t)}catch{return""+t}}function Ec(e,t,r){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&r&&r.dateNF&&(e.z=r.dateNF),e.t=="e"?Pc[e.v]||e.v:t==null?UN(e,e.v):UN(e,t))}function Qu(e,t){var r=t&&t.sheet?t.sheet:"Sheet1",n={};return n[r]=e,{SheetNames:[r],Sheets:n}}function I8(e,t,r){var n=r||{},s=e?Array.isArray(e):n.dense,a=e||(s?[]:{}),i=0,l=0;if(a&&n.origin!=null){if(typeof n.origin=="number")i=n.origin;else{var c=typeof n.origin=="string"?qn(n.origin):n.origin;i=c.r,l=c.c}a["!ref"]||(a["!ref"]="A1:A1")}var d={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(a["!ref"]){var f=Jr(a["!ref"]);d.s.c=f.s.c,d.s.r=f.s.r,d.e.c=Math.max(d.e.c,f.e.c),d.e.r=Math.max(d.e.r,f.e.r),i==-1&&(d.e.r=i=f.e.r+1)}for(var p=0;p!=t.length;++p)if(t[p]){if(!Array.isArray(t[p]))throw new Error("aoa_to_sheet expects an array of arrays");for(var g=0;g!=t[p].length;++g)if(!(typeof t[p][g]>"u")){var y={v:t[p][g]},v=i+p,_=l+g;if(d.s.r>v&&(d.s.r=v),d.s.c>_&&(d.s.c=_),d.e.r<v&&(d.e.r=v),d.e.c<_&&(d.e.c=_),t[p][g]&&typeof t[p][g]=="object"&&!Array.isArray(t[p][g])&&!(t[p][g]instanceof Date))y=t[p][g];else if(Array.isArray(y.v)&&(y.f=t[p][g][1],y.v=y.v[0]),y.v===null)if(y.f)y.t="n";else if(n.nullError)y.t="e",y.v=0;else if(n.sheetStubs)y.t="z";else continue;else typeof y.v=="number"?y.t="n":typeof y.v=="boolean"?y.t="b":y.v instanceof Date?(y.z=n.dateNF||wr[14],n.cellDates?(y.t="d",y.w=vo(y.z,zs(y.v))):(y.t="n",y.v=zs(y.v),y.w=vo(y.z,y.v))):y.t="s";if(s)a[v]||(a[v]=[]),a[v][_]&&a[v][_].z&&(y.z=a[v][_].z),a[v][_]=y;else{var b=br({c:_,r:v});a[b]&&a[b].z&&(y.z=a[b].z),a[b]=y}}}return d.s.c<1e7&&(a["!ref"]=Rr(d)),a}function P0(e,t){return I8(null,e,t)}function aG(e){return e.read_shift(4,"i")}function Vo(e,t){return t||(t=wt(4)),t.write_shift(4,e),t}function Ua(e){var t=e.read_shift(4);return t===0?"":e.read_shift(t,"dbcs")}function na(e,t){var r=!1;return t==null&&(r=!0,t=wt(4+2*e.length)),t.write_shift(4,e.length),e.length>0&&t.write_shift(0,e,"dbcs"),r?t.slice(0,t.l):t}function iG(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function oG(e,t){return t||(t=wt(4)),t.write_shift(2,0),t.write_shift(2,0),t}function wS(e,t){var r=e.l,n=e.read_shift(1),s=Ua(e),a=[],i={t:s,h:s};if((n&1)!==0){for(var l=e.read_shift(4),c=0;c!=l;++c)a.push(iG(e));i.r=a}else i.r=[{ich:0,ifnt:0}];return e.l=r+t,i}function lG(e,t){var r=!1;return t==null&&(r=!0,t=wt(15+4*e.t.length)),t.write_shift(1,0),na(e.t,t),r?t.slice(0,t.l):t}var cG=wS;function uG(e,t){var r=!1;return t==null&&(r=!0,t=wt(23+4*e.t.length)),t.write_shift(1,1),na(e.t,t),t.write_shift(4,1),oG({},t),r?t.slice(0,t.l):t}function wo(e){var t=e.read_shift(4),r=e.read_shift(2);return r+=e.read_shift(1)<<16,e.l++,{c:t,iStyleRef:r}}function _f(e,t){return t==null&&(t=wt(8)),t.write_shift(-4,e.c),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}function bf(e){var t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:t}}function Sf(e,t){return t==null&&(t=wt(4)),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}var dG=Ua,M8=na;function _S(e){var t=e.read_shift(4);return t===0||t===4294967295?"":e.read_shift(t,"dbcs")}function yy(e,t){var r=!1;return t==null&&(r=!0,t=wt(127)),t.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&t.write_shift(0,e,"dbcs"),r?t.slice(0,t.l):t}var fG=Ua,l2=_S,bS=yy;function SS(e){var t=e.slice(e.l,e.l+4),r=t[0]&1,n=t[0]&2;e.l+=4;var s=n===0?xy([0,0,0,0,t[0]&252,t[1],t[2],t[3]],0):Id(t,0)>>2;return r?s/100:s}function O8(e,t){t==null&&(t=wt(4));var r=0,n=0,s=e*100;if(e==(e|0)&&e>=-536870912&&e<1<<29?n=1:s==(s|0)&&s>=-536870912&&s<1<<29&&(n=1,r=1),n)t.write_shift(-4,((r?s:e)<<2)+(r+2));else throw new Error("unsupported RkNumber "+e)}function L8(e){var t={s:{},e:{}};return t.s.r=e.read_shift(4),t.e.r=e.read_shift(4),t.s.c=e.read_shift(4),t.e.c=e.read_shift(4),t}function hG(e,t){return t||(t=wt(16)),t.write_shift(4,e.s.r),t.write_shift(4,e.e.r),t.write_shift(4,e.s.c),t.write_shift(4,e.e.c),t}var kf=L8,R0=hG;function Ma(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function hf(e,t){return(t||wt(8)).write_shift(8,e,"f")}function gG(e){var t={},r=e.read_shift(1),n=r>>>1,s=e.read_shift(1),a=e.read_shift(2,"i"),i=e.read_shift(1),l=e.read_shift(1),c=e.read_shift(1);switch(e.l++,n){case 0:t.auto=1;break;case 1:t.index=s;var d=Vd[s];d&&(t.rgb=mp(d));break;case 2:t.rgb=mp([i,l,c]);break;case 3:t.theme=s;break}return a!=0&&(t.tint=a>0?a/32767:a/32768),t}function vy(e,t){if(t||(t=wt(8)),!e||e.auto)return t.write_shift(4,0),t.write_shift(4,0),t;e.index!=null?(t.write_shift(1,2),t.write_shift(1,e.index)):e.theme!=null?(t.write_shift(1,6),t.write_shift(1,e.theme)):(t.write_shift(1,5),t.write_shift(1,0));var r=e.tint||0;if(r>0?r*=32767:r<0&&(r*=32768),t.write_shift(2,r),!e.rgb||e.theme!=null)t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);else{var n=e.rgb||"FFFFFF";typeof n=="number"&&(n=("000000"+n.toString(16)).slice(-6)),t.write_shift(1,parseInt(n.slice(0,2),16)),t.write_shift(1,parseInt(n.slice(2,4),16)),t.write_shift(1,parseInt(n.slice(4,6),16)),t.write_shift(1,255)}return t}function mG(e){var t=e.read_shift(1);e.l++;var r={fBold:t&1,fItalic:t&2,fUnderline:t&4,fStrikeout:t&8,fOutline:t&16,fShadow:t&32,fCondense:t&64,fExtend:t&128};return r}function pG(e,t){t||(t=wt(2));var r=(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0);return t.write_shift(1,r),t.write_shift(1,0),t}function B8(e,t){var r={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},n=e.read_shift(4);switch(n){case 0:return"";case 4294967295:case 4294967294:return r[e.read_shift(4)]||""}if(n>400)throw new Error("Unsupported Clipboard: "+n.toString(16));return e.l-=4,e.read_shift(0,t==1?"lpstr":"lpwstr")}function xG(e){return B8(e,1)}function yG(e){return B8(e,2)}var kS=2,vi=3,y1=11,$N=12,wy=19,v1=64,vG=65,wG=71,_G=4108,bG=4126,Js=80,U8=81,SG=[Js,U8],c2={1:{n:"CodePage",t:kS},2:{n:"Category",t:Js},3:{n:"PresentationFormat",t:Js},4:{n:"ByteCount",t:vi},5:{n:"LineCount",t:vi},6:{n:"ParagraphCount",t:vi},7:{n:"SlideCount",t:vi},8:{n:"NoteCount",t:vi},9:{n:"HiddenCount",t:vi},10:{n:"MultimediaClipCount",t:vi},11:{n:"ScaleCrop",t:y1},12:{n:"HeadingPairs",t:_G},13:{n:"TitlesOfParts",t:bG},14:{n:"Manager",t:Js},15:{n:"Company",t:Js},16:{n:"LinksUpToDate",t:y1},17:{n:"CharacterCount",t:vi},19:{n:"SharedDoc",t:y1},22:{n:"HyperlinksChanged",t:y1},23:{n:"AppVersion",t:vi,p:"version"},24:{n:"DigSig",t:vG},26:{n:"ContentType",t:Js},27:{n:"ContentStatus",t:Js},28:{n:"Language",t:Js},29:{n:"Version",t:Js},255:{},2147483648:{n:"Locale",t:wy},2147483651:{n:"Behavior",t:wy},1919054434:{}},u2={1:{n:"CodePage",t:kS},2:{n:"Title",t:Js},3:{n:"Subject",t:Js},4:{n:"Author",t:Js},5:{n:"Keywords",t:Js},6:{n:"Comments",t:Js},7:{n:"Template",t:Js},8:{n:"LastAuthor",t:Js},9:{n:"RevNumber",t:Js},10:{n:"EditTime",t:v1},11:{n:"LastPrinted",t:v1},12:{n:"CreatedDate",t:v1},13:{n:"ModifiedDate",t:v1},14:{n:"PageCount",t:vi},15:{n:"WordCount",t:vi},16:{n:"CharCount",t:vi},17:{n:"Thumbnail",t:wG},18:{n:"Application",t:Js},19:{n:"DocSecurity",t:vi},255:{},2147483648:{n:"Locale",t:wy},2147483651:{n:"Behavior",t:wy},1919054434:{}},WN={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},kG=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function CG(e){return e.map(function(t){return[t>>16&255,t>>8&255,t&255]})}var TG=CG([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Vd=Ln(TG),Pc={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},$8={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},d2={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},w1={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function CS(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function EG(e){var t=CS();if(!e||!e.match)return t;var r={};if((e.match(za)||[]).forEach(function(n){var s=kr(n);switch(s[0].replace(OH,"<")){case"<?xml":break;case"<Types":t.xmlns=s["xmlns"+(s[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":r[s.Extension]=s.ContentType;break;case"<Override":t[d2[s.ContentType]]!==void 0&&t[d2[s.ContentType]].push(s.PartName);break}}),t.xmlns!==$s.CT)throw new Error("Unknown Namespace: "+t.xmlns);return t.calcchain=t.calcchains.length>0?t.calcchains[0]:"",t.sst=t.strs.length>0?t.strs[0]:"",t.style=t.styles.length>0?t.styles[0]:"",t.defaults=r,delete t.calcchains,t}function W8(e,t){var r=EH(d2),n=[],s;n[n.length]=ws,n[n.length]=Gt("Types",null,{xmlns:$s.CT,"xmlns:xsd":$s.xsd,"xmlns:xsi":$s.xsi}),n=n.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(c){return Gt("Default",null,{Extension:c[0],ContentType:c[1]})}));var a=function(c){e[c]&&e[c].length>0&&(s=e[c][0],n[n.length]=Gt("Override",null,{PartName:(s[0]=="/"?"":"/")+s,ContentType:w1[c][t.bookType]||w1[c].xlsx}))},i=function(c){(e[c]||[]).forEach(function(d){n[n.length]=Gt("Override",null,{PartName:(d[0]=="/"?"":"/")+d,ContentType:w1[c][t.bookType]||w1[c].xlsx})})},l=function(c){(e[c]||[]).forEach(function(d){n[n.length]=Gt("Override",null,{PartName:(d[0]=="/"?"":"/")+d,ContentType:r[c][0]})})};return a("workbooks"),i("sheets"),i("charts"),l("themes"),["strs","styles"].forEach(a),["coreprops","extprops","custprops"].forEach(l),l("vba"),l("comments"),l("threadedcomments"),l("drawings"),i("metadata"),l("people"),n.length>2&&(n[n.length]="</Types>",n[1]=n[1].replace("/>",">")),n.join("")}var Wr={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function gp(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)+"_rels/"+e.slice(t+1)+".rels"}function Bm(e,t){var r={"!id":{}};if(!e)return r;t.charAt(0)!=="/"&&(t="/"+t);var n={};return(e.match(za)||[]).forEach(function(s){var a=kr(s);if(a[0]==="<Relationship"){var i={};i.Type=a.Type,i.Target=a.Target,i.Id=a.Id,a.TargetMode&&(i.TargetMode=a.TargetMode);var l=a.TargetMode==="External"?a.Target:Cm(a.Target,t);r[l]=i,n[a.Id]=i}}),r["!id"]=n,r}function Zh(e){var t=[ws,Gt("Relationships",null,{xmlns:$s.RELS})];return os(e["!id"]).forEach(function(r){t[t.length]=Gt("Relationship",null,e["!id"][r])}),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function mn(e,t,r,n,s,a){if(s||(s={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),t<0)for(t=e["!idx"];e["!id"]["rId"+t];++t);if(e["!idx"]=t+1,s.Id="rId"+t,s.Type=n,s.Target=r,[Wr.HLINK,Wr.XPATH,Wr.XMISS].indexOf(s.Type)>-1&&(s.TargetMode="External"),e["!id"][s.Id])throw new Error("Cannot rewrite rId "+t);return e["!id"][s.Id]=s,e[("/"+s.Target).replace("//","/")]=s,t}var NG="application/vnd.oasis.opendocument.spreadsheet";function AG(e,t){for(var r=mS(e),n,s;n=hp.exec(r);)switch(n[3]){case"manifest":break;case"file-entry":if(s=kr(n[0],!1),s.path=="/"&&s.type!==NG)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(t&&t.WTF)throw n}}function jG(e){var t=[ws];t.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),t.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var r=0;r<e.length;++r)t.push('  <manifest:file-entry manifest:full-path="'+e[r][0]+'" manifest:media-type="'+e[r][1]+`"/>
`);return t.push("</manifest:manifest>"),t.join("")}function zN(e,t,r){return['  <rdf:Description rdf:about="'+e+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(r||"odf")+"#"+t+`"/>
`,`  </rdf:Description>
`].join("")}function FG(e,t){return['  <rdf:Description rdf:about="'+e+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+t+`"/>
`,`  </rdf:Description>
`].join("")}function PG(e){var t=[ws];t.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var r=0;r!=e.length;++r)t.push(zN(e[r][0],e[r][1])),t.push(FG("",e[r][0]));return t.push(zN("","Document","pkg")),t.push("</rdf:RDF>"),t.join("")}function z8(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+fy.version+"</meta:generator></office:meta></office:document-meta>"}var po=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],RG=(function(){for(var e=new Array(po.length),t=0;t<po.length;++t){var r=po[t],n="(?:"+r[0].slice(0,r[0].indexOf(":"))+":)"+r[0].slice(r[0].indexOf(":")+1);e[t]=new RegExp("<"+n+"[^>]*>([\\s\\S]*?)</"+n+">")}return e})();function H8(e){var t={};e=bn(e);for(var r=0;r<po.length;++r){var n=po[r],s=e.match(RG[r]);s!=null&&s.length>0&&(t[n[1]]=Qr(s[1])),n[2]==="date"&&t[n[1]]&&(t[n[1]]=On(t[n[1]]))}return t}function zw(e,t,r,n,s){s[e]!=null||t==null||t===""||(s[e]=t,t=pn(t),n[n.length]=r?Gt(e,t,r):_a(e,t))}function G8(e,t){var r=t||{},n=[ws,Gt("cp:coreProperties",null,{"xmlns:cp":$s.CORE_PROPS,"xmlns:dc":$s.dc,"xmlns:dcterms":$s.dcterms,"xmlns:dcmitype":$s.dcmitype,"xmlns:xsi":$s.xsi})],s={};if(!e&&!r.Props)return n.join("");e&&(e.CreatedDate!=null&&zw("dcterms:created",typeof e.CreatedDate=="string"?e.CreatedDate:o2(e.CreatedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},n,s),e.ModifiedDate!=null&&zw("dcterms:modified",typeof e.ModifiedDate=="string"?e.ModifiedDate:o2(e.ModifiedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},n,s));for(var a=0;a!=po.length;++a){var i=po[a],l=r.Props&&r.Props[i[1]]!=null?r.Props[i[1]]:e?e[i[1]]:null;l===!0?l="1":l===!1?l="0":typeof l=="number"&&(l=String(l)),l!=null&&zw(i[0],l,null,n,s)}return n.length>2&&(n[n.length]="</cp:coreProperties>",n[1]=n[1].replace("/>",">")),n.join("")}var Kd=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],V8=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function K8(e,t,r,n){var s=[];if(typeof e=="string")s=RN(e,n);else for(var a=0;a<e.length;++a)s=s.concat(e[a].map(function(f){return{v:f}}));var i=typeof t=="string"?RN(t,n).map(function(f){return f.v}):t,l=0,c=0;if(i.length>0)for(var d=0;d!==s.length;d+=2){switch(c=+s[d+1].v,s[d].v){case"Worksheets":case"工作表":case"Листы":case"أوراق العمل":case"ワークシート":case"גליונות עבודה":case"Arbeitsblätter":case"Çalışma Sayfaları":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de cálculo":case"Planilhas":case"Regneark":case"Hojas de cálculo":case"Werkbladen":r.Worksheets=c,r.SheetNames=i.slice(l,l+c);break;case"Named Ranges":case"Rangos con nombre":case"名前付き一覧":case"Benannte Bereiche":case"Navngivne områder":r.NamedRanges=c,r.DefinedNames=i.slice(l,l+c);break;case"Charts":case"Diagramme":r.Chartsheets=c,r.ChartNames=i.slice(l,l+c);break}l+=c}}function DG(e,t,r){var n={};return t||(t={}),e=bn(e),Kd.forEach(function(s){var a=(e.match(dp(s[0]))||[])[1];switch(s[2]){case"string":a&&(t[s[1]]=Qr(a));break;case"bool":t[s[1]]=a==="true";break;case"raw":var i=e.match(new RegExp("<"+s[0]+"[^>]*>([\\s\\S]*?)</"+s[0]+">"));i&&i.length>0&&(n[s[1]]=i[1]);break}}),n.HeadingPairs&&n.TitlesOfParts&&K8(n.HeadingPairs,n.TitlesOfParts,t,r),t}function q8(e){var t=[],r=Gt;return e||(e={}),e.Application="SheetJS",t[t.length]=ws,t[t.length]=Gt("Properties",null,{xmlns:$s.EXT_PROPS,"xmlns:vt":$s.vt}),Kd.forEach(function(n){if(e[n[1]]!==void 0){var s;switch(n[2]){case"string":s=pn(String(e[n[1]]));break;case"bool":s=e[n[1]]?"true":"false";break}s!==void 0&&(t[t.length]=r(n[0],s))}}),t[t.length]=r("HeadingPairs",r("vt:vector",r("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+r("vt:variant",r("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=r("TitlesOfParts",r("vt:vector",e.SheetNames.map(function(n){return"<vt:lpstr>"+pn(n)+"</vt:lpstr>"}).join(""),{size:e.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var IG=/<[^>]+>[^<]*/g;function MG(e,t){var r={},n="",s=e.match(IG);if(s)for(var a=0;a!=s.length;++a){var i=s[a],l=kr(i);switch(l[0]){case"<?xml":break;case"<Properties":break;case"<property":n=Qr(l.name);break;case"</property>":n=null;break;default:if(i.indexOf("<vt:")===0){var c=i.split(">"),d=c[0].slice(4),f=c[1];switch(d){case"lpstr":case"bstr":case"lpwstr":r[n]=Qr(f);break;case"bool":r[n]=Rn(f);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":r[n]=parseInt(f,10);break;case"r4":case"r8":case"decimal":r[n]=parseFloat(f);break;case"filetime":case"date":r[n]=On(f);break;case"cy":case"error":r[n]=Qr(f);break;default:if(d.slice(-1)=="/")break;t.WTF&&typeof console<"u"&&console.warn("Unexpected",i,d,c)}}else if(i.slice(0,2)!=="</"){if(t.WTF)throw new Error(i)}}}return r}function X8(e){var t=[ws,Gt("Properties",null,{xmlns:$s.CUST_PROPS,"xmlns:vt":$s.vt})];if(!e)return t.join("");var r=1;return os(e).forEach(function(s){++r,t[t.length]=Gt("property",GH(e[s]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:r,name:pn(s)})}),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var f2={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},Hw;function OG(e,t,r){Hw||(Hw=tv(f2)),t=Hw[t]||t,e[t]=r}function LG(e,t){var r=[];return os(f2).map(function(n){for(var s=0;s<po.length;++s)if(po[s][1]==n)return po[s];for(s=0;s<Kd.length;++s)if(Kd[s][1]==n)return Kd[s];throw n}).forEach(function(n){if(e[n[1]]!=null){var s=t&&t.Props&&t.Props[n[1]]!=null?t.Props[n[1]]:e[n[1]];switch(n[2]){case"date":s=new Date(s).toISOString().replace(/\.\d*Z/,"Z");break}typeof s=="number"?s=String(s):s===!0||s===!1?s=s?"1":"0":s instanceof Date&&(s=new Date(s).toISOString().replace(/\.\d*Z/,"")),r.push(_a(f2[n[1]]||n[1],s))}}),Gt("DocumentProperties",r.join(""),{xmlns:Oi.o})}function BG(e,t){var r=["Worksheets","SheetNames"],n="CustomDocumentProperties",s=[];return e&&os(e).forEach(function(a){if(Object.prototype.hasOwnProperty.call(e,a)){for(var i=0;i<po.length;++i)if(a==po[i][1])return;for(i=0;i<Kd.length;++i)if(a==Kd[i][1])return;for(i=0;i<r.length;++i)if(a==r[i])return;var l=e[a],c="string";typeof l=="number"?(c="float",l=String(l)):l===!0||l===!1?(c="boolean",l=l?"1":"0"):l=String(l),s.push(Gt(AN(a),l,{"dt:dt":c}))}}),t&&os(t).forEach(function(a){if(Object.prototype.hasOwnProperty.call(t,a)&&!(e&&Object.prototype.hasOwnProperty.call(e,a))){var i=t[a],l="string";typeof i=="number"?(l="float",i=String(i)):i===!0||i===!1?(l="boolean",i=i?"1":"0"):i instanceof Date?(l="dateTime.tz",i=i.toISOString()):i=String(i),s.push(Gt(AN(a),i,{"dt:dt":l}))}}),"<"+n+' xmlns="'+Oi.o+'">'+s.join("")+"</"+n+">"}function TS(e){var t=e.read_shift(4),r=e.read_shift(4);return new Date((r/1e7*Math.pow(2,32)+t/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function UG(e){var t=typeof e=="string"?new Date(Date.parse(e)):e,r=t.getTime()/1e3+11644473600,n=r%Math.pow(2,32),s=(r-n)/Math.pow(2,32);n*=1e7,s*=1e7;var a=n/Math.pow(2,32)|0;a>0&&(n=n%Math.pow(2,32),s+=a);var i=wt(8);return i.write_shift(4,n),i.write_shift(4,s),i}function Y8(e,t,r){var n=e.l,s=e.read_shift(0,"lpstr-cp");if(r)for(;e.l-n&3;)++e.l;return s}function Q8(e,t,r){var n=e.read_shift(0,"lpwstr");return n}function J8(e,t,r){return t===31?Q8(e):Y8(e,t,r)}function h2(e,t,r){return J8(e,t,r===!1?0:4)}function $G(e,t){if(!t)throw new Error("VtUnalignedString must have positive length");return J8(e,t,0)}function WG(e){for(var t=e.read_shift(4),r=[],n=0;n!=t;++n){var s=e.l;r[n]=e.read_shift(0,"lpwstr").replace(oi,""),e.l-s&2&&(e.l+=2)}return r}function zG(e){for(var t=e.read_shift(4),r=[],n=0;n!=t;++n)r[n]=e.read_shift(0,"lpstr-cp").replace(oi,"");return r}function HG(e){var t=e.l,r=_y(e,U8);e[e.l]==0&&e[e.l+1]==0&&e.l-t&2&&(e.l+=2);var n=_y(e,vi);return[r,n]}function GG(e){for(var t=e.read_shift(4),r=[],n=0;n<t/2;++n)r.push(HG(e));return r}function HN(e,t){for(var r=e.read_shift(4),n={},s=0;s!=r;++s){var a=e.read_shift(4),i=e.read_shift(4);n[a]=e.read_shift(i,t===1200?"utf16le":"utf8").replace(oi,"").replace(km,"!"),t===1200&&i%2&&(e.l+=2)}return e.l&3&&(e.l=e.l>>3<<2),n}function Z8(e){var t=e.read_shift(4),r=e.slice(e.l,e.l+t);return e.l+=t,(t&3)>0&&(e.l+=4-(t&3)&3),r}function VG(e){var t={};return t.Size=e.read_shift(4),e.l+=t.Size+3-(t.Size-1)%4,t}function _y(e,t,r){var n=e.read_shift(2),s,a=r||{};if(e.l+=2,t!==$N&&n!==t&&SG.indexOf(t)===-1&&!((t&65534)==4126&&(n&65534)==4126))throw new Error("Expected type "+t+" saw "+n);switch(t===$N?n:t){case 2:return s=e.read_shift(2,"i"),a.raw||(e.l+=2),s;case 3:return s=e.read_shift(4,"i"),s;case 11:return e.read_shift(4)!==0;case 19:return s=e.read_shift(4),s;case 30:return Y8(e,n,4).replace(oi,"");case 31:return Q8(e);case 64:return TS(e);case 65:return Z8(e);case 71:return VG(e);case 80:return h2(e,n,!a.raw).replace(oi,"");case 81:return $G(e,n).replace(oi,"");case 4108:return GG(e);case 4126:case 4127:return n==4127?WG(e):zG(e);default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+n)}}function GN(e,t){var r=wt(4),n=wt(4);switch(r.write_shift(4,e==80?31:e),e){case 3:n.write_shift(-4,t);break;case 5:n=wt(8),n.write_shift(8,t,"f");break;case 11:n.write_shift(4,t?1:0);break;case 64:n=UG(t);break;case 31:case 80:for(n=wt(4+2*(t.length+1)+(t.length%2?0:2)),n.write_shift(4,t.length+1),n.write_shift(0,t,"dbcs");n.l!=n.length;)n.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+t)}return ta([r,n])}function VN(e,t){var r=e.l,n=e.read_shift(4),s=e.read_shift(4),a=[],i=0,l=0,c=-1,d={};for(i=0;i!=s;++i){var f=e.read_shift(4),p=e.read_shift(4);a[i]=[f,p+r]}a.sort(function(k,w){return k[1]-w[1]});var g={};for(i=0;i!=s;++i){if(e.l!==a[i][1]){var y=!0;if(i>0&&t)switch(t[a[i-1][0]].t){case 2:e.l+2===a[i][1]&&(e.l+=2,y=!1);break;case 80:e.l<=a[i][1]&&(e.l=a[i][1],y=!1);break;case 4108:e.l<=a[i][1]&&(e.l=a[i][1],y=!1);break}if((!t||i==0)&&e.l<=a[i][1]&&(y=!1,e.l=a[i][1]),y)throw new Error("Read Error: Expected address "+a[i][1]+" at "+e.l+" :"+i)}if(t){var v=t[a[i][0]];if(g[v.n]=_y(e,v.t,{raw:!0}),v.p==="version"&&(g[v.n]=String(g[v.n]>>16)+"."+("0000"+String(g[v.n]&65535)).slice(-4)),v.n=="CodePage")switch(g[v.n]){case 0:g[v.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:Wo(l=g[v.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+g[v.n])}}else if(a[i][0]===1){if(l=g.CodePage=_y(e,kS),Wo(l),c!==-1){var _=e.l;e.l=a[c][1],d=HN(e,l),e.l=_}}else if(a[i][0]===0){if(l===0){c=i,e.l=a[i+1][1];continue}d=HN(e,l)}else{var b=d[a[i][0]],E;switch(e[e.l]){case 65:e.l+=4,E=Z8(e);break;case 30:e.l+=4,E=h2(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 31:e.l+=4,E=h2(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 3:e.l+=4,E=e.read_shift(4,"i");break;case 19:e.l+=4,E=e.read_shift(4);break;case 5:e.l+=4,E=e.read_shift(8,"f");break;case 11:e.l+=4,E=ps(e,4);break;case 64:e.l+=4,E=On(TS(e));break;default:throw new Error("unparsed value: "+e[e.l])}g[b]=E}}return e.l=r+n,g}var eF=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function KG(e){switch(typeof e){case"boolean":return 11;case"number":return(e|0)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64;break}return-1}function KN(e,t,r){var n=wt(8),s=[],a=[],i=8,l=0,c=wt(8),d=wt(8);if(c.write_shift(4,2),c.write_shift(4,1200),d.write_shift(4,1),a.push(c),s.push(d),i+=8+c.length,!t){d=wt(8),d.write_shift(4,0),s.unshift(d);var f=[wt(4)];for(f[0].write_shift(4,e.length),l=0;l<e.length;++l){var p=e[l][0];for(c=wt(8+2*(p.length+1)+(p.length%2?0:2)),c.write_shift(4,l+2),c.write_shift(4,p.length+1),c.write_shift(0,p,"dbcs");c.l!=c.length;)c.write_shift(1,0);f.push(c)}c=ta(f),a.unshift(c),i+=8+c.length}for(l=0;l<e.length;++l)if(!(t&&!t[e[l][0]])&&!(eF.indexOf(e[l][0])>-1||V8.indexOf(e[l][0])>-1)&&e[l][1]!=null){var g=e[l][1],y=0;if(t){y=+t[e[l][0]];var v=r[y];if(v.p=="version"&&typeof g=="string"){var _=g.split(".");g=(+_[0]<<16)+(+_[1]||0)}c=GN(v.t,g)}else{var b=KG(g);b==-1&&(b=31,g=String(g)),c=GN(b,g)}a.push(c),d=wt(8),d.write_shift(4,t?y:2+l),s.push(d),i+=8+c.length}var E=8*(a.length+1);for(l=0;l<a.length;++l)s[l].write_shift(4,E),E+=a[l].length;return n.write_shift(4,i),n.write_shift(4,a.length),ta([n].concat(s).concat(a))}function qN(e,t,r){var n=e.content;if(!n)return{};ya(n,0);var s,a,i,l,c=0;n.chk("feff","Byte Order: "),n.read_shift(2);var d=n.read_shift(4),f=n.read_shift(16);if(f!==mr.utils.consts.HEADER_CLSID&&f!==r)throw new Error("Bad PropertySet CLSID "+f);if(s=n.read_shift(4),s!==1&&s!==2)throw new Error("Unrecognized #Sets: "+s);if(a=n.read_shift(16),l=n.read_shift(4),s===1&&l!==n.l)throw new Error("Length mismatch: "+l+" !== "+n.l);s===2&&(i=n.read_shift(16),c=n.read_shift(4));var p=VN(n,t),g={SystemIdentifier:d};for(var y in p)g[y]=p[y];if(g.FMTID=a,s===1)return g;if(c-n.l==2&&(n.l+=2),n.l!==c)throw new Error("Length mismatch 2: "+n.l+" !== "+c);var v;try{v=VN(n,null)}catch{}for(y in v)g[y]=v[y];return g.FMTID=[a,i],g}function XN(e,t,r,n,s,a){var i=wt(s?68:48),l=[i];i.write_shift(2,65534),i.write_shift(2,0),i.write_shift(4,842412599),i.write_shift(16,mr.utils.consts.HEADER_CLSID,"hex"),i.write_shift(4,s?2:1),i.write_shift(16,t,"hex"),i.write_shift(4,s?68:48);var c=KN(e,r,n);if(l.push(c),s){var d=KN(s,null,null);i.write_shift(16,a,"hex"),i.write_shift(4,68+c.length),l.push(d)}return ta(l)}function _u(e,t){return e.read_shift(t),null}function qG(e,t){t||(t=wt(e));for(var r=0;r<e;++r)t.write_shift(1,0);return t}function XG(e,t,r){for(var n=[],s=e.l+t;e.l<s;)n.push(r(e,s-e.l));if(s!==e.l)throw new Error("Slurp error");return n}function ps(e,t){return e.read_shift(t)===1}function ni(e,t){return t||(t=wt(2)),t.write_shift(2,+!!e),t}function As(e){return e.read_shift(2,"u")}function fo(e,t){return t||(t=wt(2)),t.write_shift(2,e),t}function tF(e,t){return XG(e,t,As)}function YG(e){var t=e.read_shift(1),r=e.read_shift(1);return r===1?t:t===1}function rF(e,t,r){return r||(r=wt(2)),r.write_shift(1,t=="e"?+e:+!!e),r.write_shift(1,t=="e"?1:0),r}function Kp(e,t,r){var n=e.read_shift(r&&r.biff>=12?2:1),s="sbcs-cont";if(r&&r.biff>=8,!r||r.biff==8){var a=e.read_shift(1);a&&(s="dbcs-cont")}else r.biff==12&&(s="wstr");r.biff>=2&&r.biff<=5&&(s="cpstr");var i=n?e.read_shift(n,s):"";return i}function QG(e){var t=e.read_shift(2),r=e.read_shift(1),n=r&4,s=r&8,a=1+(r&1),i=0,l,c={};s&&(i=e.read_shift(2)),n&&(l=e.read_shift(4));var d=a==2?"dbcs-cont":"sbcs-cont",f=t===0?"":e.read_shift(t,d);return s&&(e.l+=4*i),n&&(e.l+=l),c.t=f,s||(c.raw="<t>"+c.t+"</t>",c.r=c.t),c}function JG(e){var t=e.t||"",r=wt(3);r.write_shift(2,t.length),r.write_shift(1,1);var n=wt(2*t.length);n.write_shift(2*t.length,t,"utf16le");var s=[r,n];return ta(s)}function gf(e,t,r){var n;if(r){if(r.biff>=2&&r.biff<=5)return e.read_shift(t,"cpstr");if(r.biff>=12)return e.read_shift(t,"dbcs-cont")}var s=e.read_shift(1);return s===0?n=e.read_shift(t,"sbcs-cont"):n=e.read_shift(t,"dbcs-cont"),n}function qp(e,t,r){var n=e.read_shift(r&&r.biff==2?1:2);return n===0?(e.l++,""):gf(e,n,r)}function Cf(e,t,r){if(r.biff>5)return qp(e,t,r);var n=e.read_shift(1);return n===0?(e.l++,""):e.read_shift(n,r.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function nF(e,t,r){return r||(r=wt(3+2*e.length)),r.write_shift(2,e.length),r.write_shift(1,1),r.write_shift(31,e,"utf16le"),r}function ZG(e){var t=e.read_shift(1);e.l++;var r=e.read_shift(2);return e.l+=2,[t,r]}function eV(e){var t=e.read_shift(4),r=e.l,n=!1;t>24&&(e.l+=t-24,e.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(n=!0),e.l=r);var s=e.read_shift((n?t-24:t)>>1,"utf16le").replace(oi,"");return n&&(e.l+=24),s}function tV(e){for(var t=e.read_shift(2),r="";t-- >0;)r+="../";var n=e.read_shift(0,"lpstr-ansi");if(e.l+=2,e.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var s=e.read_shift(4);if(s===0)return r+n.replace(/\\/g,"/");var a=e.read_shift(4);if(e.read_shift(2)!=3)throw new Error("Bad FileMoniker");var i=e.read_shift(a>>1,"utf16le").replace(oi,"");return r+i}function rV(e,t){var r=e.read_shift(16);switch(r){case"e0c9ea79f9bace118c8200aa004ba90b":return eV(e);case"0303000000000000c000000000000046":return tV(e);default:throw new Error("Unsupported Moniker "+r)}}function _1(e){var t=e.read_shift(4),r=t>0?e.read_shift(t,"utf16le").replace(oi,""):"";return r}function YN(e,t){t||(t=wt(6+e.length*2)),t.write_shift(4,1+e.length);for(var r=0;r<e.length;++r)t.write_shift(2,e.charCodeAt(r));return t.write_shift(2,0),t}function nV(e,t){var r=e.l+t,n=e.read_shift(4);if(n!==2)throw new Error("Unrecognized streamVersion: "+n);var s=e.read_shift(2);e.l+=2;var a,i,l,c,d="",f,p;s&16&&(a=_1(e,r-e.l)),s&128&&(i=_1(e,r-e.l)),(s&257)===257&&(l=_1(e,r-e.l)),(s&257)===1&&(c=rV(e,r-e.l)),s&8&&(d=_1(e,r-e.l)),s&32&&(f=e.read_shift(16)),s&64&&(p=TS(e)),e.l=r;var g=i||l||c||"";g&&d&&(g+="#"+d),g||(g="#"+d),s&2&&g.charAt(0)=="/"&&g.charAt(1)!="/"&&(g="file://"+g);var y={Target:g};return f&&(y.guid=f),p&&(y.time=p),a&&(y.Tooltip=a),y}function sV(e){var t=wt(512),r=0,n=e.Target;n.slice(0,7)=="file://"&&(n=n.slice(7));var s=n.indexOf("#"),a=s>-1?31:23;switch(n.charAt(0)){case"#":a=28;break;case".":a&=-3;break}t.write_shift(4,2),t.write_shift(4,a);var i=[8,6815827,6619237,4849780,83];for(r=0;r<i.length;++r)t.write_shift(4,i[r]);if(a==28)n=n.slice(1),YN(n,t);else if(a&2){for(i="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<i.length;++r)t.write_shift(1,parseInt(i[r],16));var l=s>-1?n.slice(0,s):n;for(t.write_shift(4,2*(l.length+1)),r=0;r<l.length;++r)t.write_shift(2,l.charCodeAt(r));t.write_shift(2,0),a&8&&YN(s>-1?n.slice(s+1):"",t)}else{for(i="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),r=0;r<i.length;++r)t.write_shift(1,parseInt(i[r],16));for(var c=0;n.slice(c*3,c*3+3)=="../"||n.slice(c*3,c*3+3)=="..\\";)++c;for(t.write_shift(2,c),t.write_shift(4,n.length-3*c+1),r=0;r<n.length-3*c;++r)t.write_shift(1,n.charCodeAt(r+3*c)&255);for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),r=0;r<6;++r)t.write_shift(4,0)}return t.slice(0,t.l)}function sF(e){var t=e.read_shift(1),r=e.read_shift(1),n=e.read_shift(1),s=e.read_shift(1);return[t,r,n,s]}function aF(e,t){var r=sF(e);return r[3]=0,r}function Il(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(2);return{r:t,c:r,ixfe:n}}function mf(e,t,r,n){return n||(n=wt(6)),n.write_shift(2,e),n.write_shift(2,t),n.write_shift(2,r||0),n}function aV(e){var t=e.read_shift(2),r=e.read_shift(2);return e.l+=8,{type:t,flags:r}}function iV(e,t,r){return t===0?"":Cf(e,t,r)}function oV(e,t,r){var n=r.biff>8?4:2,s=e.read_shift(n),a=e.read_shift(n,"i"),i=e.read_shift(n,"i");return[s,a,i]}function iF(e){var t=e.read_shift(2),r=SS(e);return[t,r]}function lV(e,t,r){e.l+=4,t-=4;var n=e.l+t,s=Kp(e,t,r),a=e.read_shift(2);if(n-=e.l,a!==n)throw new Error("Malformed AddinUdf: padding = "+n+" != "+a);return e.l+=a,s}function sv(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(2),s=e.read_shift(2);return{s:{c:n,r:t},e:{c:s,r}}}function oF(e,t){return t||(t=wt(8)),t.write_shift(2,e.s.r),t.write_shift(2,e.e.r),t.write_shift(2,e.s.c),t.write_shift(2,e.e.c),t}function lF(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(1),s=e.read_shift(1);return{s:{c:n,r:t},e:{c:s,r}}}var cV=lF;function cF(e){e.l+=4;var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(2);return e.l+=12,[r,t,n]}function uV(e){var t={};return e.l+=4,e.l+=16,t.fSharedNote=e.read_shift(2),e.l+=4,t}function dV(e){var t={};return e.l+=4,e.cf=e.read_shift(2),t}function Fa(e){e.l+=2,e.l+=e.read_shift(2)}var fV={0:Fa,4:Fa,5:Fa,6:Fa,7:dV,8:Fa,9:Fa,10:Fa,11:Fa,12:Fa,13:uV,14:Fa,15:Fa,16:Fa,17:Fa,18:Fa,19:Fa,20:Fa,21:cF};function hV(e,t){for(var r=e.l+t,n=[];e.l<r;){var s=e.read_shift(2);e.l-=2;try{n.push(fV[s](e,r-e.l))}catch{return e.l=r,n}}return e.l!=r&&(e.l=r),n}function b1(e,t){var r={BIFFVer:0,dt:0};switch(r.BIFFVer=e.read_shift(2),t-=2,t>=2&&(r.dt=e.read_shift(2),e.l-=2),r.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(t>6)throw new Error("Unexpected BIFF Ver "+r.BIFFVer)}return e.read_shift(t),r}function ES(e,t,r){var n=1536,s=16;switch(r.bookType){case"biff8":break;case"biff5":n=1280,s=8;break;case"biff4":n=4,s=6;break;case"biff3":n=3,s=6;break;case"biff2":n=2,s=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var a=wt(s);return a.write_shift(2,n),a.write_shift(2,t),s>4&&a.write_shift(2,29282),s>6&&a.write_shift(2,1997),s>8&&(a.write_shift(2,49161),a.write_shift(2,1),a.write_shift(2,1798),a.write_shift(2,0)),a}function gV(e,t){return t===0||e.read_shift(2),1200}function mV(e,t,r){if(r.enc)return e.l+=t,"";var n=e.l,s=Cf(e,0,r);return e.read_shift(t+n-e.l),s}function pV(e,t){var r=!t||t.biff==8,n=wt(r?112:54);for(n.write_shift(t.biff==8?2:1,7),r&&n.write_shift(1,0),n.write_shift(4,859007059),n.write_shift(4,5458548|(r?0:536870912));n.l<n.length;)n.write_shift(1,r?0:32);return n}function xV(e,t,r){var n=r&&r.biff==8||t==2?e.read_shift(2):(e.l+=t,0);return{fDialog:n&16,fBelow:n&64,fRight:n&128}}function yV(e,t,r){var n=e.read_shift(4),s=e.read_shift(1)&3,a=e.read_shift(1);switch(a){case 0:a="Worksheet";break;case 1:a="Macrosheet";break;case 2:a="Chartsheet";break;case 6:a="VBAModule";break}var i=Kp(e,0,r);return i.length===0&&(i="Sheet1"),{pos:n,hs:s,dt:a,name:i}}function vV(e,t){var r=!t||t.biff>=8?2:1,n=wt(8+r*e.name.length);n.write_shift(4,e.pos),n.write_shift(1,e.hs||0),n.write_shift(1,e.dt),n.write_shift(1,e.name.length),t.biff>=8&&n.write_shift(1,1),n.write_shift(r*e.name.length,e.name,t.biff<8?"sbcs":"utf16le");var s=n.slice(0,n.l);return s.l=n.l,s}function wV(e,t){for(var r=e.l+t,n=e.read_shift(4),s=e.read_shift(4),a=[],i=0;i!=s&&e.l<r;++i)a.push(QG(e));return a.Count=n,a.Unique=s,a}function _V(e,t){var r=wt(8);r.write_shift(4,e.Count),r.write_shift(4,e.Unique);for(var n=[],s=0;s<e.length;++s)n[s]=JG(e[s]);var a=ta([r].concat(n));return a.parts=[r.length].concat(n.map(function(i){return i.length})),a}function bV(e,t){var r={};return r.dsst=e.read_shift(2),e.l+=t-2,r}function SV(e){var t={};t.r=e.read_shift(2),t.c=e.read_shift(2),t.cnt=e.read_shift(2)-t.c;var r=e.read_shift(2);e.l+=4;var n=e.read_shift(1);return e.l+=3,n&7&&(t.level=n&7),n&32&&(t.hidden=!0),n&64&&(t.hpt=r/20),t}function kV(e){var t=aV(e);if(t.type!=2211)throw new Error("Invalid Future Record "+t.type);var r=e.read_shift(4);return r!==0}function CV(e){return e.read_shift(2),e.read_shift(4)}function QN(e,t,r){var n=0;r&&r.biff==2||(n=e.read_shift(2));var s=e.read_shift(2);r&&r.biff==2&&(n=1-(s>>15),s&=32767);var a={Unsynced:n&1,DyZero:(n&2)>>1,ExAsc:(n&4)>>2,ExDsc:(n&8)>>3};return[a,s]}function TV(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(2),s=e.read_shift(2),a=e.read_shift(2),i=e.read_shift(2),l=e.read_shift(2),c=e.read_shift(2),d=e.read_shift(2);return{Pos:[t,r],Dim:[n,s],Flags:a,CurTab:i,FirstTab:l,Selected:c,TabRatio:d}}function EV(){var e=wt(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}function NV(e,t,r){if(r&&r.biff>=2&&r.biff<5)return{};var n=e.read_shift(2);return{RTL:n&64}}function AV(e){var t=wt(18),r=1718;return e&&e.RTL&&(r|=64),t.write_shift(2,r),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}function jV(){}function FV(e,t,r){var n={dyHeight:e.read_shift(2),fl:e.read_shift(2)};switch(r&&r.biff||8){case 2:break;case 3:case 4:e.l+=2;break;default:e.l+=10;break}return n.name=Kp(e,0,r),n}function PV(e,t){var r=e.name||"Arial",n=t&&t.biff==5,s=n?15+r.length:16+2*r.length,a=wt(s);return a.write_shift(2,e.sz*20),a.write_shift(4,0),a.write_shift(2,400),a.write_shift(4,0),a.write_shift(2,0),a.write_shift(1,r.length),n||a.write_shift(1,1),a.write_shift((n?1:2)*r.length,r,n?"sbcs":"utf16le"),a}function RV(e){var t=Il(e);return t.isst=e.read_shift(4),t}function DV(e,t,r,n){var s=wt(10);return mf(e,t,n,s),s.write_shift(4,r),s}function IV(e,t,r){r.biffguess&&r.biff==2&&(r.biff=5);var n=e.l+t,s=Il(e);r.biff==2&&e.l++;var a=qp(e,n-e.l,r);return s.val=a,s}function MV(e,t,r,n,s){var a=!s||s.biff==8,i=wt(8+ +a+(1+a)*r.length);return mf(e,t,n,i),i.write_shift(2,r.length),a&&i.write_shift(1,1),i.write_shift((1+a)*r.length,r,a?"utf16le":"sbcs"),i}function OV(e,t,r){var n=e.read_shift(2),s=Cf(e,0,r);return[n,s]}function LV(e,t,r,n){var s=r&&r.biff==5;n||(n=wt(s?3+t.length:5+2*t.length)),n.write_shift(2,e),n.write_shift(s?1:2,t.length),s||n.write_shift(1,1),n.write_shift((s?1:2)*t.length,t,s?"sbcs":"utf16le");var a=n.length>n.l?n.slice(0,n.l):n;return a.l==null&&(a.l=a.length),a}var BV=Cf;function JN(e,t,r){var n=e.l+t,s=r.biff==8||!r.biff?4:2,a=e.read_shift(s),i=e.read_shift(s),l=e.read_shift(2),c=e.read_shift(2);return e.l=n,{s:{r:a,c:l},e:{r:i,c}}}function UV(e,t){var r=t.biff==8||!t.biff?4:2,n=wt(2*r+6);return n.write_shift(r,e.s.r),n.write_shift(r,e.e.r+1),n.write_shift(2,e.s.c),n.write_shift(2,e.e.c+1),n.write_shift(2,0),n}function $V(e){var t=e.read_shift(2),r=e.read_shift(2),n=iF(e);return{r:t,c:r,ixfe:n[0],rknum:n[1]}}function WV(e,t){for(var r=e.l+t-2,n=e.read_shift(2),s=e.read_shift(2),a=[];e.l<r;)a.push(iF(e));if(e.l!==r)throw new Error("MulRK read error");var i=e.read_shift(2);if(a.length!=i-s+1)throw new Error("MulRK length mismatch");return{r:n,c:s,C:i,rkrec:a}}function zV(e,t){for(var r=e.l+t-2,n=e.read_shift(2),s=e.read_shift(2),a=[];e.l<r;)a.push(e.read_shift(2));if(e.l!==r)throw new Error("MulBlank read error");var i=e.read_shift(2);if(a.length!=i-s+1)throw new Error("MulBlank length mismatch");return{r:n,c:s,C:i,ixfe:a}}function HV(e,t,r,n){var s={},a=e.read_shift(4),i=e.read_shift(4),l=e.read_shift(4),c=e.read_shift(2);return s.patternType=kG[l>>26],n.cellStyles&&(s.alc=a&7,s.fWrap=a>>3&1,s.alcV=a>>4&7,s.fJustLast=a>>7&1,s.trot=a>>8&255,s.cIndent=a>>16&15,s.fShrinkToFit=a>>20&1,s.iReadOrder=a>>22&2,s.fAtrNum=a>>26&1,s.fAtrFnt=a>>27&1,s.fAtrAlc=a>>28&1,s.fAtrBdr=a>>29&1,s.fAtrPat=a>>30&1,s.fAtrProt=a>>31&1,s.dgLeft=i&15,s.dgRight=i>>4&15,s.dgTop=i>>8&15,s.dgBottom=i>>12&15,s.icvLeft=i>>16&127,s.icvRight=i>>23&127,s.grbitDiag=i>>30&3,s.icvTop=l&127,s.icvBottom=l>>7&127,s.icvDiag=l>>14&127,s.dgDiag=l>>21&15,s.icvFore=c&127,s.icvBack=c>>7&127,s.fsxButton=c>>14&1),s}function GV(e,t,r){var n={};return n.ifnt=e.read_shift(2),n.numFmtId=e.read_shift(2),n.flags=e.read_shift(2),n.fStyle=n.flags>>2&1,t-=6,n.data=HV(e,t,n.fStyle,r),n}function ZN(e,t,r,n){var s=r&&r.biff==5;n||(n=wt(s?16:20)),n.write_shift(2,0),e.style?(n.write_shift(2,e.numFmtId||0),n.write_shift(2,65524)):(n.write_shift(2,e.numFmtId||0),n.write_shift(2,t<<4));var a=0;return e.numFmtId>0&&s&&(a|=1024),n.write_shift(4,a),n.write_shift(4,0),s||n.write_shift(4,0),n.write_shift(2,0),n}function VV(e){e.l+=4;var t=[e.read_shift(2),e.read_shift(2)];if(t[0]!==0&&t[0]--,t[1]!==0&&t[1]--,t[0]>7||t[1]>7)throw new Error("Bad Gutters: "+t.join("|"));return t}function KV(e){var t=wt(8);return t.write_shift(4,0),t.write_shift(2,0),t.write_shift(2,0),t}function e3(e,t,r){var n=Il(e);(r.biff==2||t==9)&&++e.l;var s=YG(e);return n.val=s,n.t=s===!0||s===!1?"b":"e",n}function qV(e,t,r,n,s,a){var i=wt(8);return mf(e,t,n,i),rF(r,a,i),i}function XV(e,t,r){r.biffguess&&r.biff==2&&(r.biff=5);var n=Il(e),s=Ma(e);return n.val=s,n}function YV(e,t,r,n){var s=wt(14);return mf(e,t,n,s),hf(r,s),s}var t3=iV;function QV(e,t,r){var n=e.l+t,s=e.read_shift(2),a=e.read_shift(2);if(r.sbcch=a,a==1025||a==14849)return[a,s];if(a<1||a>255)throw new Error("Unexpected SupBook type: "+a);for(var i=gf(e,a),l=[];n>e.l;)l.push(qp(e));return[a,s,i,l]}function r3(e,t,r){var n=e.read_shift(2),s,a={fBuiltIn:n&1,fWantAdvise:n>>>1&1,fWantPict:n>>>2&1,fOle:n>>>3&1,fOleLink:n>>>4&1,cf:n>>>5&1023,fIcon:n>>>15&1};return r.sbcch===14849&&(s=lV(e,t-2,r)),a.body=s||e.read_shift(t-2),typeof s=="string"&&(a.Name=s),a}var JV=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function n3(e,t,r){var n=e.l+t,s=e.read_shift(2),a=e.read_shift(1),i=e.read_shift(1),l=e.read_shift(r&&r.biff==2?1:2),c=0;(!r||r.biff>=5)&&(r.biff!=5&&(e.l+=2),c=e.read_shift(2),r.biff==5&&(e.l+=2),e.l+=4);var d=gf(e,i,r);s&32&&(d=JV[d.charCodeAt(0)]);var f=n-e.l;r&&r.biff==2&&--f;var p=n==e.l||l===0||!(f>0)?[]:hQ(e,f,r,l);return{chKey:a,Name:d,itab:c,rgce:p}}function uF(e,t,r){if(r.biff<8)return ZV(e,t,r);for(var n=[],s=e.l+t,a=e.read_shift(r.biff>8?4:2);a--!==0;)n.push(oV(e,r.biff>8?12:6,r));if(e.l!=s)throw new Error("Bad ExternSheet: "+e.l+" != "+s);return n}function ZV(e,t,r){e[e.l+1]==3&&e[e.l]++;var n=Kp(e,t,r);return n.charCodeAt(0)==3?n.slice(1):n}function eK(e,t,r){if(r.biff<8){e.l+=t;return}var n=e.read_shift(2),s=e.read_shift(2),a=gf(e,n,r),i=gf(e,s,r);return[a,i]}function tK(e,t,r){var n=lF(e);e.l++;var s=e.read_shift(1);return t-=8,[gQ(e,t,r),s,n]}function s3(e,t,r){var n=cV(e);switch(r.biff){case 2:e.l++,t-=7;break;case 3:case 4:e.l+=2,t-=8;break;default:e.l+=6,t-=12}return[n,dQ(e,t,r)]}function rK(e){var t=e.read_shift(4)!==0,r=e.read_shift(4)!==0,n=e.read_shift(4);return[t,r,n]}function nK(e,t,r){if(!(r.biff<8)){var n=e.read_shift(2),s=e.read_shift(2),a=e.read_shift(2),i=e.read_shift(2),l=Cf(e,0,r);return r.biff<8&&e.read_shift(1),[{r:n,c:s},l,i,a]}}function sK(e,t,r){return nK(e,t,r)}function aK(e,t){for(var r=[],n=e.read_shift(2);n--;)r.push(sv(e));return r}function iK(e){var t=wt(2+e.length*8);t.write_shift(2,e.length);for(var r=0;r<e.length;++r)oF(e[r],t);return t}function oK(e,t,r){if(r&&r.biff<8)return cK(e,t,r);var n=cF(e),s=hV(e,t-22,n[1]);return{cmo:n,ft:s}}var lK={8:function(e,t){var r=e.l+t;e.l+=10;var n=e.read_shift(2);e.l+=4,e.l+=2,e.l+=2,e.l+=2,e.l+=4;var s=e.read_shift(1);return e.l+=s,e.l=r,{fmt:n}}};function cK(e,t,r){e.l+=4;var n=e.read_shift(2),s=e.read_shift(2),a=e.read_shift(2);e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=6,t-=36;var i=[];return i.push((lK[n]||Wa)(e,t,r)),{cmo:[s,n,a],ft:i}}function uK(e,t,r){var n=e.l,s="";try{e.l+=4;var a=(r.lastobj||{cmo:[0,0]}).cmo[1],i;[0,5,7,11,12,14].indexOf(a)==-1?e.l+=6:i=ZG(e,6,r);var l=e.read_shift(2);e.read_shift(2),As(e,2);var c=e.read_shift(2);e.l+=c;for(var d=1;d<e.lens.length-1;++d){if(e.l-n!=e.lens[d])throw new Error("TxO: bad continue record");var f=e[e.l],p=gf(e,e.lens[d+1]-e.lens[d]-1);if(s+=p,s.length>=(f?l:2*l))break}if(s.length!==l&&s.length!==l*2)throw new Error("cchText: "+l+" != "+s.length);return e.l=n+t,{t:s}}catch{return e.l=n+t,{t:s}}}function dK(e,t){var r=sv(e);e.l+=16;var n=nV(e,t-24);return[r,n]}function fK(e){var t=wt(24),r=qn(e[0]);t.write_shift(2,r.r),t.write_shift(2,r.r),t.write_shift(2,r.c),t.write_shift(2,r.c);for(var n="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),s=0;s<16;++s)t.write_shift(1,parseInt(n[s],16));return ta([t,sV(e[1])])}function hK(e,t){e.read_shift(2);var r=sv(e),n=e.read_shift((t-10)/2,"dbcs-cont");return n=n.replace(oi,""),[r,n]}function gK(e){var t=e[1].Tooltip,r=wt(10+2*(t.length+1));r.write_shift(2,2048);var n=qn(e[0]);r.write_shift(2,n.r),r.write_shift(2,n.r),r.write_shift(2,n.c),r.write_shift(2,n.c);for(var s=0;s<t.length;++s)r.write_shift(2,t.charCodeAt(s));return r.write_shift(2,0),r}function mK(e){var t=[0,0],r;return r=e.read_shift(2),t[0]=WN[r]||r,r=e.read_shift(2),t[1]=WN[r]||r,t}function pK(e){return e||(e=wt(4)),e.write_shift(2,1),e.write_shift(2,1),e}function xK(e){for(var t=e.read_shift(2),r=[];t-- >0;)r.push(aF(e));return r}function yK(e){for(var t=e.read_shift(2),r=[];t-- >0;)r.push(aF(e));return r}function vK(e){e.l+=2;var t={cxfs:0,crc:0};return t.cxfs=e.read_shift(2),t.crc=e.read_shift(4),t}function dF(e,t,r){if(!r.cellStyles)return Wa(e,t);var n=r&&r.biff>=12?4:2,s=e.read_shift(n),a=e.read_shift(n),i=e.read_shift(n),l=e.read_shift(n),c=e.read_shift(2);n==2&&(e.l+=2);var d={s,e:a,w:i,ixfe:l,flags:c};return(r.biff>=5||!r.biff)&&(d.level=c>>8&7),d}function wK(e,t){var r=wt(12);r.write_shift(2,t),r.write_shift(2,t),r.write_shift(2,e.width*256),r.write_shift(2,0);var n=0;return e.hidden&&(n|=1),r.write_shift(1,n),n=e.level||0,r.write_shift(1,n),r.write_shift(2,0),r}function _K(e,t){var r={};return t<32||(e.l+=16,r.header=Ma(e),r.footer=Ma(e),e.l+=2),r}function bK(e,t,r){var n={area:!1};if(r.biff!=5)return e.l+=t,n;var s=e.read_shift(1);return e.l+=3,s&16&&(n.area=!0),n}function SK(e){for(var t=wt(2*e),r=0;r<e;++r)t.write_shift(2,r+1);return t}var kK=Il,CK=tF,TK=qp;function EK(e){var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(4),s={fmt:t,env:r,len:n,data:e.slice(e.l,e.l+n)};return e.l+=n,s}function NK(e,t,r){r.biffguess&&r.biff==5&&(r.biff=2);var n=Il(e);++e.l;var s=Cf(e,t-7,r);return n.t="str",n.val=s,n}function AK(e){var t=Il(e);++e.l;var r=Ma(e);return t.t="n",t.val=r,t}function jK(e,t,r){var n=wt(15);return Jp(n,e,t),n.write_shift(8,r,"f"),n}function FK(e){var t=Il(e);++e.l;var r=e.read_shift(2);return t.t="n",t.val=r,t}function PK(e,t,r){var n=wt(9);return Jp(n,e,t),n.write_shift(2,r),n}function RK(e){var t=e.read_shift(1);return t===0?(e.l++,""):e.read_shift(t,"sbcs-cont")}function DK(e,t){e.l+=6,e.l+=2,e.l+=1,e.l+=3,e.l+=1,e.l+=t-13}function IK(e,t,r){var n=e.l+t,s=Il(e),a=e.read_shift(2),i=gf(e,a,r);return e.l=n,s.t="str",s.val=i,s}var MK=[2,3,48,49,131,139,140,245],g2=(function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=tv({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(l,c){var d=[],f=Bu(1);switch(c.type){case"base64":f=Bi(Wi(l));break;case"binary":f=Bi(l);break;case"buffer":case"array":f=l;break}ya(f,0);var p=f.read_shift(1),g=!!(p&136),y=!1,v=!1;switch(p){case 2:break;case 3:break;case 48:y=!0,g=!0;break;case 49:y=!0,g=!0;break;case 131:break;case 139:break;case 140:v=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+p.toString(16))}var _=0,b=521;p==2&&(_=f.read_shift(2)),f.l+=3,p!=2&&(_=f.read_shift(4)),_>1048576&&(_=1e6),p!=2&&(b=f.read_shift(2));var E=f.read_shift(2),k=c.codepage||1252;p!=2&&(f.l+=16,f.read_shift(1),f[f.l]!==0&&(k=e[f[f.l]]),f.l+=1,f.l+=2),v&&(f.l+=36);for(var w=[],N={},A=Math.min(f.length,p==2?521:b-10-(y?264:0)),P=v?32:11;f.l<A&&f[f.l]!=13;)switch(N={},N.name=lp.utils.decode(k,f.slice(f.l,f.l+P)).replace(/[\u0000\r\n].*$/g,""),f.l+=P,N.type=String.fromCharCode(f.read_shift(1)),p!=2&&!v&&(N.offset=f.read_shift(4)),N.len=f.read_shift(1),p==2&&(N.offset=f.read_shift(2)),N.dec=f.read_shift(1),N.name.length&&w.push(N),p!=2&&(f.l+=v?13:14),N.type){case"B":(!y||N.len!=8)&&c.WTF&&console.log("Skipping "+N.name+":"+N.type);break;case"G":case"P":c.WTF&&console.log("Skipping "+N.name+":"+N.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+N.type)}if(f[f.l]!==13&&(f.l=b-1),f.read_shift(1)!==13)throw new Error("DBF Terminator not found "+f.l+" "+f[f.l]);f.l=b;var R=0,T=0;for(d[0]=[],T=0;T!=w.length;++T)d[0][T]=w[T].name;for(;_-- >0;){if(f[f.l]===42){f.l+=E;continue}for(++f.l,d[++R]=[],T=0,T=0;T!=w.length;++T){var D=f.slice(f.l,f.l+w[T].len);f.l+=w[T].len,ya(D,0);var I=lp.utils.decode(k,D);switch(w[T].type){case"C":I.trim().length&&(d[R][T]=I.replace(/\s+$/,""));break;case"D":I.length===8?d[R][T]=new Date(+I.slice(0,4),+I.slice(4,6)-1,+I.slice(6,8)):d[R][T]=I;break;case"F":d[R][T]=parseFloat(I.trim());break;case"+":case"I":d[R][T]=v?D.read_shift(-4,"i")^2147483648:D.read_shift(4,"i");break;case"L":switch(I.trim().toUpperCase()){case"Y":case"T":d[R][T]=!0;break;case"N":case"F":d[R][T]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+I+"|")}break;case"M":if(!g)throw new Error("DBF Unexpected MEMO for type "+p.toString(16));d[R][T]="##MEMO##"+(v?parseInt(I.trim(),10):D.read_shift(4));break;case"N":I=I.replace(/\u0000/g,"").trim(),I&&I!="."&&(d[R][T]=+I||0);break;case"@":d[R][T]=new Date(D.read_shift(-8,"f")-621356832e5);break;case"T":d[R][T]=new Date((D.read_shift(4)-2440588)*864e5+D.read_shift(4));break;case"Y":d[R][T]=D.read_shift(4,"i")/1e4+D.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":d[R][T]=-D.read_shift(-8,"f");break;case"B":if(y&&w[T].len==8){d[R][T]=D.read_shift(8,"f");break}case"G":case"P":D.l+=w[T].len;break;case"0":if(w[T].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+w[T].type)}}}if(p!=2&&f.l<f.length&&f[f.l++]!=26)throw new Error("DBF EOF Marker missing "+(f.l-1)+" of "+f.length+" "+f[f.l-1].toString(16));return c&&c.sheetRows&&(d=d.slice(0,c.sheetRows)),c.DBF=w,d}function n(l,c){var d=c||{};d.dateNF||(d.dateNF="yyyymmdd");var f=P0(r(l,d),d);return f["!cols"]=d.DBF.map(function(p){return{wch:p.len,DBF:p}}),delete d.DBF,f}function s(l,c){try{return Qu(n(l,c),c)}catch(d){if(c&&c.WTF)throw d}return{SheetNames:[],Sheets:{}}}var a={B:8,C:250,L:1,D:8,"?":0,"":0};function i(l,c){var d=c||{};if(+d.codepage>=0&&Wo(+d.codepage),d.type=="string")throw new Error("Cannot write DBF to JS string");var f=Ci(),p=ky(l,{header:1,raw:!0,cellDates:!0}),g=p[0],y=p.slice(1),v=l["!cols"]||[],_=0,b=0,E=0,k=1;for(_=0;_<g.length;++_){if(((v[_]||{}).DBF||{}).name){g[_]=v[_].DBF.name,++E;continue}if(g[_]!=null){if(++E,typeof g[_]=="number"&&(g[_]=g[_].toString(10)),typeof g[_]!="string")throw new Error("DBF Invalid column name "+g[_]+" |"+typeof g[_]+"|");if(g.indexOf(g[_])!==_){for(b=0;b<1024;++b)if(g.indexOf(g[_]+"_"+b)==-1){g[_]+="_"+b;break}}}}var w=Jr(l["!ref"]),N=[],A=[],P=[];for(_=0;_<=w.e.c-w.s.c;++_){var R="",T="",D=0,I=[];for(b=0;b<y.length;++b)y[b][_]!=null&&I.push(y[b][_]);if(I.length==0||g[_]==null){N[_]="?";continue}for(b=0;b<I.length;++b){switch(typeof I[b]){case"number":T="B";break;case"string":T="C";break;case"boolean":T="L";break;case"object":T=I[b]instanceof Date?"D":"C";break;default:T="C"}D=Math.max(D,String(I[b]).length),R=R&&R!=T?"C":T}D>250&&(D=250),T=((v[_]||{}).DBF||{}).type,T=="C"&&v[_].DBF.len>D&&(D=v[_].DBF.len),R=="B"&&T=="N"&&(R="N",P[_]=v[_].DBF.dec,D=v[_].DBF.len),A[_]=R=="C"||T=="N"?D:a[R]||0,k+=A[_],N[_]=R}var V=f.next(32);for(V.write_shift(4,318902576),V.write_shift(4,y.length),V.write_shift(2,296+32*E),V.write_shift(2,k),_=0;_<4;++_)V.write_shift(4,0);for(V.write_shift(4,0|(+t[e8]||3)<<8),_=0,b=0;_<g.length;++_)if(g[_]!=null){var X=f.next(32),Z=(g[_].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);X.write_shift(1,Z,"sbcs"),X.write_shift(1,N[_]=="?"?"C":N[_],"sbcs"),X.write_shift(4,b),X.write_shift(1,A[_]||a[N[_]]||0),X.write_shift(1,P[_]||0),X.write_shift(1,2),X.write_shift(4,0),X.write_shift(1,0),X.write_shift(4,0),X.write_shift(4,0),b+=A[_]||a[N[_]]||0}var ie=f.next(264);for(ie.write_shift(4,13),_=0;_<65;++_)ie.write_shift(4,0);for(_=0;_<y.length;++_){var q=f.next(k);for(q.write_shift(1,0),b=0;b<g.length;++b)if(g[b]!=null)switch(N[b]){case"L":q.write_shift(1,y[_][b]==null?63:y[_][b]?84:70);break;case"B":q.write_shift(8,y[_][b]||0,"f");break;case"N":var ne="0";for(typeof y[_][b]=="number"&&(ne=y[_][b].toFixed(P[b]||0)),E=0;E<A[b]-ne.length;++E)q.write_shift(1,32);q.write_shift(1,ne,"sbcs");break;case"D":y[_][b]?(q.write_shift(4,("0000"+y[_][b].getFullYear()).slice(-4),"sbcs"),q.write_shift(2,("00"+(y[_][b].getMonth()+1)).slice(-2),"sbcs"),q.write_shift(2,("00"+y[_][b].getDate()).slice(-2),"sbcs")):q.write_shift(8,"00000000","sbcs");break;case"C":var M=String(y[_][b]!=null?y[_][b]:"").slice(0,A[b]);for(q.write_shift(1,M,"sbcs"),E=0;E<A[b]-M.length;++E)q.write_shift(1,32);break}}return f.next(1).write_shift(1,26),f.end()}return{to_workbook:s,to_sheet:n,from_sheet:i}})(),fF=(function(){var e={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("\x1BN("+os(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),r=function(g,y){var v=e[y];return typeof v=="number"?mN(v):v},n=function(g,y,v){var _=y.charCodeAt(0)-32<<4|v.charCodeAt(0)-48;return _==59?g:mN(_)};e["|"]=254;function s(g,y){switch(y.type){case"base64":return a(Wi(g),y);case"binary":return a(g,y);case"buffer":return a(Lr&&Buffer.isBuffer(g)?g.toString("binary"):Yu(g),y);case"array":return a(ff(g),y)}throw new Error("Unrecognized type "+y.type)}function a(g,y){var v=g.split(/[\n\r]+/),_=-1,b=-1,E=0,k=0,w=[],N=[],A=null,P={},R=[],T=[],D=[],I=0,V;for(+y.codepage>=0&&Wo(+y.codepage);E!==v.length;++E){I=0;var X=v[E].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,n).replace(t,r),Z=X.replace(/;;/g,"\0").split(";").map(function(Y){return Y.replace(/\u0000/g,";")}),ie=Z[0],q;if(X.length>0)switch(ie){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":Z[1].charAt(0)=="P"&&N.push(X.slice(3).replace(/;;/g,";"));break;case"C":var ne=!1,M=!1,W=!1,L=!1,H=-1,K=-1;for(k=1;k<Z.length;++k)switch(Z[k].charAt(0)){case"A":break;case"X":b=parseInt(Z[k].slice(1))-1,M=!0;break;case"Y":for(_=parseInt(Z[k].slice(1))-1,M||(b=0),V=w.length;V<=_;++V)w[V]=[];break;case"K":q=Z[k].slice(1),q.charAt(0)==='"'?q=q.slice(1,q.length-1):q==="TRUE"?q=!0:q==="FALSE"?q=!1:isNaN(Go(q))?isNaN(d0(q).getDate())||(q=On(q)):(q=Go(q),A!==null&&j0(A)&&(q=nv(q))),ne=!0;break;case"E":L=!0;var B=e0(Z[k].slice(1),{r:_,c:b});w[_][b]=[w[_][b],B];break;case"S":W=!0,w[_][b]=[w[_][b],"S5S"];break;case"G":break;case"R":H=parseInt(Z[k].slice(1))-1;break;case"C":K=parseInt(Z[k].slice(1))-1;break;default:if(y&&y.WTF)throw new Error("SYLK bad record "+X)}if(ne&&(w[_][b]&&w[_][b].length==2?w[_][b][0]=q:w[_][b]=q,A=null),W){if(L)throw new Error("SYLK shared formula cannot have own formula");var z=H>-1&&w[H][K];if(!z||!z[1])throw new Error("SYLK shared formula cannot find base");w[_][b][1]=jF(z[1],{r:_-H,c:b-K})}break;case"F":var Q=0;for(k=1;k<Z.length;++k)switch(Z[k].charAt(0)){case"X":b=parseInt(Z[k].slice(1))-1,++Q;break;case"Y":for(_=parseInt(Z[k].slice(1))-1,V=w.length;V<=_;++V)w[V]=[];break;case"M":I=parseInt(Z[k].slice(1))/20;break;case"F":break;case"G":break;case"P":A=N[parseInt(Z[k].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(D=Z[k].slice(1).split(" "),V=parseInt(D[0],10);V<=parseInt(D[1],10);++V)I=parseInt(D[2],10),T[V-1]=I===0?{hidden:!0}:{wch:I},Uu(T[V-1]);break;case"C":b=parseInt(Z[k].slice(1))-1,T[b]||(T[b]={});break;case"R":_=parseInt(Z[k].slice(1))-1,R[_]||(R[_]={}),I>0?(R[_].hpt=I,R[_].hpx=h0(I)):I===0&&(R[_].hidden=!0);break;default:if(y&&y.WTF)throw new Error("SYLK bad record "+X)}Q<1&&(A=null);break;default:if(y&&y.WTF)throw new Error("SYLK bad record "+X)}}return R.length>0&&(P["!rows"]=R),T.length>0&&(P["!cols"]=T),y&&y.sheetRows&&(w=w.slice(0,y.sheetRows)),[w,P]}function i(g,y){var v=s(g,y),_=v[0],b=v[1],E=P0(_,y);return os(b).forEach(function(k){E[k]=b[k]}),E}function l(g,y){return Qu(i(g,y),y)}function c(g,y,v,_){var b="C;Y"+(v+1)+";X"+(_+1)+";K";switch(g.t){case"n":b+=g.v||0,g.f&&!g.F&&(b+=";E"+RS(g.f,{r:v,c:_}));break;case"b":b+=g.v?"TRUE":"FALSE";break;case"e":b+=g.w||g.v;break;case"d":b+='"'+(g.w||g.v)+'"';break;case"s":b+='"'+g.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return b}function d(g,y){y.forEach(function(v,_){var b="F;W"+(_+1)+" "+(_+1)+" ";v.hidden?b+="0":(typeof v.width=="number"&&!v.wpx&&(v.wpx=pp(v.width)),typeof v.wpx=="number"&&!v.wch&&(v.wch=xp(v.wpx)),typeof v.wch=="number"&&(b+=Math.round(v.wch))),b.charAt(b.length-1)!=" "&&g.push(b)})}function f(g,y){y.forEach(function(v,_){var b="F;";v.hidden?b+="M0;":v.hpt?b+="M"+20*v.hpt+";":v.hpx&&(b+="M"+20*yp(v.hpx)+";"),b.length>2&&g.push(b+"R"+(_+1))})}function p(g,y){var v=["ID;PWXL;N;E"],_=[],b=Jr(g["!ref"]),E,k=Array.isArray(g),w=`\r
`;v.push("P;PGeneral"),v.push("F;P0;DG0G8;M255"),g["!cols"]&&d(v,g["!cols"]),g["!rows"]&&f(v,g["!rows"]),v.push("B;Y"+(b.e.r-b.s.r+1)+";X"+(b.e.c-b.s.c+1)+";D"+[b.s.c,b.s.r,b.e.c,b.e.r].join(" "));for(var N=b.s.r;N<=b.e.r;++N)for(var A=b.s.c;A<=b.e.c;++A){var P=br({r:N,c:A});E=k?(g[N]||[])[A]:g[P],!(!E||E.v==null&&(!E.f||E.F))&&_.push(c(E,g,N,A))}return v.join(w)+w+_.join(w)+w+"E"+w}return{to_workbook:l,to_sheet:i,from_sheet:p}})(),hF=(function(){function e(a,i){switch(i.type){case"base64":return t(Wi(a),i);case"binary":return t(a,i);case"buffer":return t(Lr&&Buffer.isBuffer(a)?a.toString("binary"):Yu(a),i);case"array":return t(ff(a),i)}throw new Error("Unrecognized type "+i.type)}function t(a,i){for(var l=a.split(`
`),c=-1,d=-1,f=0,p=[];f!==l.length;++f){if(l[f].trim()==="BOT"){p[++c]=[],d=0;continue}if(!(c<0)){var g=l[f].trim().split(","),y=g[0],v=g[1];++f;for(var _=l[f]||"";(_.match(/["]/g)||[]).length&1&&f<l.length-1;)_+=`
`+l[++f];switch(_=_.trim(),+y){case-1:if(_==="BOT"){p[++c]=[],d=0;continue}else if(_!=="EOD")throw new Error("Unrecognized DIF special command "+_);break;case 0:_==="TRUE"?p[c][d]=!0:_==="FALSE"?p[c][d]=!1:isNaN(Go(v))?isNaN(d0(v).getDate())?p[c][d]=v:p[c][d]=On(v):p[c][d]=Go(v),++d;break;case 1:_=_.slice(1,_.length-1),_=_.replace(/""/g,'"'),_&&_.match(/^=".*"$/)&&(_=_.slice(2,-1)),p[c][d++]=_!==""?_:null;break}if(_==="EOD")break}}return i&&i.sheetRows&&(p=p.slice(0,i.sheetRows)),p}function r(a,i){return P0(e(a,i),i)}function n(a,i){return Qu(r(a,i),i)}var s=(function(){var a=function(c,d,f,p,g){c.push(d),c.push(f+","+p),c.push('"'+g.replace(/"/g,'""')+'"')},i=function(c,d,f,p){c.push(d+","+f),c.push(d==1?'"'+p.replace(/"/g,'""')+'"':p)};return function(c){var d=[],f=Jr(c["!ref"]),p,g=Array.isArray(c);a(d,"TABLE",0,1,"sheetjs"),a(d,"VECTORS",0,f.e.r-f.s.r+1,""),a(d,"TUPLES",0,f.e.c-f.s.c+1,""),a(d,"DATA",0,0,"");for(var y=f.s.r;y<=f.e.r;++y){i(d,-1,0,"BOT");for(var v=f.s.c;v<=f.e.c;++v){var _=br({r:y,c:v});if(p=g?(c[y]||[])[v]:c[_],!p){i(d,1,0,"");continue}switch(p.t){case"n":var b=p.w;!b&&p.v!=null&&(b=p.v),b==null?p.f&&!p.F?i(d,1,0,"="+p.f):i(d,1,0,""):i(d,0,b,"V");break;case"b":i(d,0,p.v?1:0,p.v?"TRUE":"FALSE");break;case"s":i(d,1,0,isNaN(p.v)?p.v:'="'+p.v+'"');break;case"d":p.w||(p.w=vo(p.z||wr[14],zs(On(p.v)))),i(d,0,p.w,"V");break;default:i(d,1,0,"")}}}i(d,-1,0,"EOD");var E=`\r
`,k=d.join(E);return k}})();return{to_workbook:n,to_sheet:r,from_sheet:s}})(),gF=(function(){function e(p){return p.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function t(p){return p.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function r(p,g){for(var y=p.split(`
`),v=-1,_=-1,b=0,E=[];b!==y.length;++b){var k=y[b].trim().split(":");if(k[0]==="cell"){var w=qn(k[1]);if(E.length<=w.r)for(v=E.length;v<=w.r;++v)E[v]||(E[v]=[]);switch(v=w.r,_=w.c,k[2]){case"t":E[v][_]=e(k[3]);break;case"v":E[v][_]=+k[3];break;case"vtf":var N=k[k.length-1];case"vtc":switch(k[3]){case"nl":E[v][_]=!!+k[4];break;default:E[v][_]=+k[4];break}k[2]=="vtf"&&(E[v][_]=[E[v][_],N])}}}return g&&g.sheetRows&&(E=E.slice(0,g.sheetRows)),E}function n(p,g){return P0(r(p,g),g)}function s(p,g){return Qu(n(p,g),g)}var a=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),i=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,l=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),c="--SocialCalcSpreadsheetControlSave--";function d(p){if(!p||!p["!ref"])return"";for(var g=[],y=[],v,_="",b=Ti(p["!ref"]),E=Array.isArray(p),k=b.s.r;k<=b.e.r;++k)for(var w=b.s.c;w<=b.e.c;++w)if(_=br({r:k,c:w}),v=E?(p[k]||[])[w]:p[_],!(!v||v.v==null||v.t==="z")){switch(y=["cell",_,"t"],v.t){case"s":case"str":y.push(t(v.v));break;case"n":v.f?(y[2]="vtf",y[3]="n",y[4]=v.v,y[5]=t(v.f)):(y[2]="v",y[3]=v.v);break;case"b":y[2]="vt"+(v.f?"f":"c"),y[3]="nl",y[4]=v.v?"1":"0",y[5]=t(v.f||(v.v?"TRUE":"FALSE"));break;case"d":var N=zs(On(v.v));y[2]="vtc",y[3]="nd",y[4]=""+N,y[5]=v.w||vo(v.z||wr[14],N);break;case"e":continue}g.push(y.join(":"))}return g.push("sheet:c:"+(b.e.c-b.s.c+1)+":r:"+(b.e.r-b.s.r+1)+":tvf:1"),g.push("valueformat:1:text-wiki"),g.join(`
`)}function f(p){return[a,i,l,i,d(p),c].join(`
`)}return{to_workbook:s,to_sheet:n,from_sheet:f}})(),f0=(function(){function e(f,p,g,y,v){v.raw?p[g][y]=f:f===""||(f==="TRUE"?p[g][y]=!0:f==="FALSE"?p[g][y]=!1:isNaN(Go(f))?isNaN(d0(f).getDate())?p[g][y]=f:p[g][y]=On(f):p[g][y]=Go(f))}function t(f,p){var g=p||{},y=[];if(!f||f.length===0)return y;for(var v=f.split(/[\r\n]/),_=v.length-1;_>=0&&v[_].length===0;)--_;for(var b=10,E=0,k=0;k<=_;++k)E=v[k].indexOf(" "),E==-1?E=v[k].length:E++,b=Math.max(b,E);for(k=0;k<=_;++k){y[k]=[];var w=0;for(e(v[k].slice(0,b).trim(),y,k,w,g),w=1;w<=(v[k].length-b)/10+1;++w)e(v[k].slice(b+(w-1)*10,b+w*10).trim(),y,k,w,g)}return g.sheetRows&&(y=y.slice(0,g.sheetRows)),y}var r={44:",",9:"	",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function s(f){for(var p={},g=!1,y=0,v=0;y<f.length;++y)(v=f.charCodeAt(y))==34?g=!g:!g&&v in r&&(p[v]=(p[v]||0)+1);v=[];for(y in p)Object.prototype.hasOwnProperty.call(p,y)&&v.push([p[y],y]);if(!v.length){p=n;for(y in p)Object.prototype.hasOwnProperty.call(p,y)&&v.push([p[y],y])}return v.sort(function(_,b){return _[0]-b[0]||n[_[1]]-n[b[1]]}),r[v.pop()[1]]||44}function a(f,p){var g=p||{},y="",v=g.dense?[]:{},_={s:{c:0,r:0},e:{c:0,r:0}};f.slice(0,4)=="sep="?f.charCodeAt(5)==13&&f.charCodeAt(6)==10?(y=f.charAt(4),f=f.slice(7)):f.charCodeAt(5)==13||f.charCodeAt(5)==10?(y=f.charAt(4),f=f.slice(6)):y=s(f.slice(0,1024)):g&&g.FS?y=g.FS:y=s(f.slice(0,1024));var b=0,E=0,k=0,w=0,N=0,A=y.charCodeAt(0),P=!1,R=0,T=f.charCodeAt(0);f=f.replace(/\r\n/mg,`
`);var D=g.dateNF!=null?bH(g.dateNF):null;function I(){var V=f.slice(w,N),X={};if(V.charAt(0)=='"'&&V.charAt(V.length-1)=='"'&&(V=V.slice(1,-1).replace(/""/g,'"')),V.length===0)X.t="z";else if(g.raw)X.t="s",X.v=V;else if(V.trim().length===0)X.t="s",X.v=V;else if(V.charCodeAt(0)==61)V.charCodeAt(1)==34&&V.charCodeAt(V.length-1)==34?(X.t="s",X.v=V.slice(2,-1).replace(/""/g,'"')):QX(V)?(X.t="n",X.f=V.slice(1)):(X.t="s",X.v=V);else if(V=="TRUE")X.t="b",X.v=!0;else if(V=="FALSE")X.t="b",X.v=!1;else if(!isNaN(k=Go(V)))X.t="n",g.cellText!==!1&&(X.w=V),X.v=k;else if(!isNaN(d0(V).getDate())||D&&V.match(D)){X.z=g.dateNF||wr[14];var Z=0;D&&V.match(D)&&(V=SH(V,g.dateNF,V.match(D)||[]),Z=1),g.cellDates?(X.t="d",X.v=On(V,Z)):(X.t="n",X.v=zs(On(V,Z))),g.cellText!==!1&&(X.w=vo(X.z,X.v instanceof Date?zs(X.v):X.v)),g.cellNF||delete X.z}else X.t="s",X.v=V;if(X.t=="z"||(g.dense?(v[b]||(v[b]=[]),v[b][E]=X):v[br({c:E,r:b})]=X),w=N+1,T=f.charCodeAt(w),_.e.c<E&&(_.e.c=E),_.e.r<b&&(_.e.r=b),R==A)++E;else if(E=0,++b,g.sheetRows&&g.sheetRows<=b)return!0}e:for(;N<f.length;++N)switch(R=f.charCodeAt(N)){case 34:T===34&&(P=!P);break;case A:case 10:case 13:if(!P&&I())break e;break}return N-w>0&&I(),v["!ref"]=Rr(_),v}function i(f,p){return!(p&&p.PRN)||p.FS||f.slice(0,4)=="sep="||f.indexOf("	")>=0||f.indexOf(",")>=0||f.indexOf(";")>=0?a(f,p):P0(t(f,p),p)}function l(f,p){var g="",y=p.type=="string"?[0,0,0,0]:$S(f,p);switch(p.type){case"base64":g=Wi(f);break;case"binary":g=f;break;case"buffer":p.codepage==65001?g=f.toString("utf8"):p.codepage&&typeof lp<"u"||(g=Lr&&Buffer.isBuffer(f)?f.toString("binary"):Yu(f));break;case"array":g=ff(f);break;case"string":g=f;break;default:throw new Error("Unrecognized type "+p.type)}return y[0]==239&&y[1]==187&&y[2]==191?g=bn(g.slice(3)):p.type!="string"&&p.type!="buffer"&&p.codepage==65001?g=bn(g):p.type=="binary"&&typeof lp<"u",g.slice(0,19)=="socialcalc:version:"?gF.to_sheet(p.type=="string"?g:bn(g),p):i(g,p)}function c(f,p){return Qu(l(f,p),p)}function d(f){for(var p=[],g=Jr(f["!ref"]),y,v=Array.isArray(f),_=g.s.r;_<=g.e.r;++_){for(var b=[],E=g.s.c;E<=g.e.c;++E){var k=br({r:_,c:E});if(y=v?(f[_]||[])[E]:f[k],!y||y.v==null){b.push("          ");continue}for(var w=(y.w||(Ec(y),y.w)||"").slice(0,10);w.length<10;)w+=" ";b.push(w+(E===0?" ":""))}p.push(b.join(""))}return p.join(`
`)}return{to_workbook:c,to_sheet:l,from_sheet:d}})();function OK(e,t){var r=t||{},n=!!r.WTF;r.WTF=!0;try{var s=fF.to_workbook(e,r);return r.WTF=n,s}catch(a){if(r.WTF=n,!a.message.match(/SYLK bad record ID/)&&n)throw a;return f0.to_workbook(e,t)}}var qd=(function(){function e(B,z,Q){if(B){ya(B,B.l||0);for(var Y=Q.Enum||H;B.l<B.length;){var te=B.read_shift(2),ee=Y[te]||Y[65535],ae=B.read_shift(2),ge=B.l+ae,_e=ee.f&&ee.f(B,ae,Q);if(B.l=ge,z(_e,ee,te))return}}}function t(B,z){switch(z.type){case"base64":return r(Bi(Wi(B)),z);case"binary":return r(Bi(B),z);case"buffer":case"array":return r(B,z)}throw"Unsupported type "+z.type}function r(B,z){if(!B)return B;var Q=z||{},Y=Q.dense?[]:{},te="Sheet1",ee="",ae=0,ge={},_e=[],Me=[],ue={s:{r:0,c:0},e:{r:0,c:0}},me=Q.sheetRows||0;if(B[2]==0&&(B[3]==8||B[3]==9)&&B.length>=16&&B[14]==5&&B[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(B[2]==2)Q.Enum=H,e(B,function(Ve,It,st){switch(st){case 0:Q.vers=Ve,Ve>=4096&&(Q.qpro=!0);break;case 6:ue=Ve;break;case 204:Ve&&(ee=Ve);break;case 222:ee=Ve;break;case 15:case 51:Q.qpro||(Ve[1].v=Ve[1].v.slice(1));case 13:case 14:case 16:st==14&&(Ve[2]&112)==112&&(Ve[2]&15)>1&&(Ve[2]&15)<15&&(Ve[1].z=Q.dateNF||wr[14],Q.cellDates&&(Ve[1].t="d",Ve[1].v=nv(Ve[1].v))),Q.qpro&&Ve[3]>ae&&(Y["!ref"]=Rr(ue),ge[te]=Y,_e.push(te),Y=Q.dense?[]:{},ue={s:{r:0,c:0},e:{r:0,c:0}},ae=Ve[3],te=ee||"Sheet"+(ae+1),ee="");var Ie=Q.dense?(Y[Ve[0].r]||[])[Ve[0].c]:Y[br(Ve[0])];if(Ie){Ie.t=Ve[1].t,Ie.v=Ve[1].v,Ve[1].z!=null&&(Ie.z=Ve[1].z),Ve[1].f!=null&&(Ie.f=Ve[1].f);break}Q.dense?(Y[Ve[0].r]||(Y[Ve[0].r]=[]),Y[Ve[0].r][Ve[0].c]=Ve[1]):Y[br(Ve[0])]=Ve[1];break}},Q);else if(B[2]==26||B[2]==14)Q.Enum=K,B[2]==14&&(Q.qpro=!0,B.l=0),e(B,function(Ve,It,st){switch(st){case 204:te=Ve;break;case 22:Ve[1].v=Ve[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Ve[3]>ae&&(Y["!ref"]=Rr(ue),ge[te]=Y,_e.push(te),Y=Q.dense?[]:{},ue={s:{r:0,c:0},e:{r:0,c:0}},ae=Ve[3],te="Sheet"+(ae+1)),me>0&&Ve[0].r>=me)break;Q.dense?(Y[Ve[0].r]||(Y[Ve[0].r]=[]),Y[Ve[0].r][Ve[0].c]=Ve[1]):Y[br(Ve[0])]=Ve[1],ue.e.c<Ve[0].c&&(ue.e.c=Ve[0].c),ue.e.r<Ve[0].r&&(ue.e.r=Ve[0].r);break;case 27:Ve[14e3]&&(Me[Ve[14e3][0]]=Ve[14e3][1]);break;case 1537:Me[Ve[0]]=Ve[1],Ve[0]==ae&&(te=Ve[1]);break}},Q);else throw new Error("Unrecognized LOTUS BOF "+B[2]);if(Y["!ref"]=Rr(ue),ge[ee||te]=Y,_e.push(ee||te),!Me.length)return{SheetNames:_e,Sheets:ge};for(var He={},qe=[],Xe=0;Xe<Me.length;++Xe)ge[_e[Xe]]?(qe.push(Me[Xe]||_e[Xe]),He[Me[Xe]]=ge[Me[Xe]]||ge[_e[Xe]]):(qe.push(Me[Xe]),He[Me[Xe]]={"!ref":"A1"});return{SheetNames:qe,Sheets:He}}function n(B,z){var Q=z||{};if(+Q.codepage>=0&&Wo(+Q.codepage),Q.type=="string")throw new Error("Cannot write WK1 to JS string");var Y=Ci(),te=Jr(B["!ref"]),ee=Array.isArray(B),ae=[];Vt(Y,0,a(1030)),Vt(Y,6,c(te));for(var ge=Math.min(te.e.r,8191),_e=te.s.r;_e<=ge;++_e)for(var Me=ys(_e),ue=te.s.c;ue<=te.e.c;++ue){_e===te.s.r&&(ae[ue]=Kn(ue));var me=ae[ue]+Me,He=ee?(B[_e]||[])[ue]:B[me];if(!(!He||He.t=="z"))if(He.t=="n")(He.v|0)==He.v&&He.v>=-32768&&He.v<=32767?Vt(Y,13,y(_e,ue,He.v)):Vt(Y,14,_(_e,ue,He.v));else{var qe=Ec(He);Vt(Y,15,p(_e,ue,qe.slice(0,239)))}}return Vt(Y,1),Y.end()}function s(B,z){var Q=z||{};if(+Q.codepage>=0&&Wo(+Q.codepage),Q.type=="string")throw new Error("Cannot write WK3 to JS string");var Y=Ci();Vt(Y,0,i(B));for(var te=0,ee=0;te<B.SheetNames.length;++te)(B.Sheets[B.SheetNames[te]]||{})["!ref"]&&Vt(Y,27,L(B.SheetNames[te],ee++));var ae=0;for(te=0;te<B.SheetNames.length;++te){var ge=B.Sheets[B.SheetNames[te]];if(!(!ge||!ge["!ref"])){for(var _e=Jr(ge["!ref"]),Me=Array.isArray(ge),ue=[],me=Math.min(_e.e.r,8191),He=_e.s.r;He<=me;++He)for(var qe=ys(He),Xe=_e.s.c;Xe<=_e.e.c;++Xe){He===_e.s.r&&(ue[Xe]=Kn(Xe));var Ve=ue[Xe]+qe,It=Me?(ge[He]||[])[Xe]:ge[Ve];if(!(!It||It.t=="z"))if(It.t=="n")Vt(Y,23,I(He,Xe,ae,It.v));else{var st=Ec(It);Vt(Y,22,R(He,Xe,ae,st.slice(0,239)))}}++ae}}return Vt(Y,1),Y.end()}function a(B){var z=wt(2);return z.write_shift(2,B),z}function i(B){var z=wt(26);z.write_shift(2,4096),z.write_shift(2,4),z.write_shift(4,0);for(var Q=0,Y=0,te=0,ee=0;ee<B.SheetNames.length;++ee){var ae=B.SheetNames[ee],ge=B.Sheets[ae];if(!(!ge||!ge["!ref"])){++te;var _e=Ti(ge["!ref"]);Q<_e.e.r&&(Q=_e.e.r),Y<_e.e.c&&(Y=_e.e.c)}}return Q>8191&&(Q=8191),z.write_shift(2,Q),z.write_shift(1,te),z.write_shift(1,Y),z.write_shift(2,0),z.write_shift(2,0),z.write_shift(1,1),z.write_shift(1,2),z.write_shift(4,0),z.write_shift(4,0),z}function l(B,z,Q){var Y={s:{c:0,r:0},e:{c:0,r:0}};return z==8&&Q.qpro?(Y.s.c=B.read_shift(1),B.l++,Y.s.r=B.read_shift(2),Y.e.c=B.read_shift(1),B.l++,Y.e.r=B.read_shift(2),Y):(Y.s.c=B.read_shift(2),Y.s.r=B.read_shift(2),z==12&&Q.qpro&&(B.l+=2),Y.e.c=B.read_shift(2),Y.e.r=B.read_shift(2),z==12&&Q.qpro&&(B.l+=2),Y.s.c==65535&&(Y.s.c=Y.e.c=Y.s.r=Y.e.r=0),Y)}function c(B){var z=wt(8);return z.write_shift(2,B.s.c),z.write_shift(2,B.s.r),z.write_shift(2,B.e.c),z.write_shift(2,B.e.r),z}function d(B,z,Q){var Y=[{c:0,r:0},{t:"n",v:0},0,0];return Q.qpro&&Q.vers!=20768?(Y[0].c=B.read_shift(1),Y[3]=B.read_shift(1),Y[0].r=B.read_shift(2),B.l+=2):(Y[2]=B.read_shift(1),Y[0].c=B.read_shift(2),Y[0].r=B.read_shift(2)),Y}function f(B,z,Q){var Y=B.l+z,te=d(B,z,Q);if(te[1].t="s",Q.vers==20768){B.l++;var ee=B.read_shift(1);return te[1].v=B.read_shift(ee,"utf8"),te}return Q.qpro&&B.l++,te[1].v=B.read_shift(Y-B.l,"cstr"),te}function p(B,z,Q){var Y=wt(7+Q.length);Y.write_shift(1,255),Y.write_shift(2,z),Y.write_shift(2,B),Y.write_shift(1,39);for(var te=0;te<Y.length;++te){var ee=Q.charCodeAt(te);Y.write_shift(1,ee>=128?95:ee)}return Y.write_shift(1,0),Y}function g(B,z,Q){var Y=d(B,z,Q);return Y[1].v=B.read_shift(2,"i"),Y}function y(B,z,Q){var Y=wt(7);return Y.write_shift(1,255),Y.write_shift(2,z),Y.write_shift(2,B),Y.write_shift(2,Q,"i"),Y}function v(B,z,Q){var Y=d(B,z,Q);return Y[1].v=B.read_shift(8,"f"),Y}function _(B,z,Q){var Y=wt(13);return Y.write_shift(1,255),Y.write_shift(2,z),Y.write_shift(2,B),Y.write_shift(8,Q,"f"),Y}function b(B,z,Q){var Y=B.l+z,te=d(B,z,Q);if(te[1].v=B.read_shift(8,"f"),Q.qpro)B.l=Y;else{var ee=B.read_shift(2);N(B.slice(B.l,B.l+ee),te),B.l+=ee}return te}function E(B,z,Q){var Y=z&32768;return z&=-32769,z=(Y?B:0)+(z>=8192?z-16384:z),(Y?"":"$")+(Q?Kn(z):ys(z))}var k={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},w=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function N(B,z){ya(B,0);for(var Q=[],Y=0,te="",ee="",ae="",ge="";B.l<B.length;){var _e=B[B.l++];switch(_e){case 0:Q.push(B.read_shift(8,"f"));break;case 1:ee=E(z[0].c,B.read_shift(2),!0),te=E(z[0].r,B.read_shift(2),!1),Q.push(ee+te);break;case 2:{var Me=E(z[0].c,B.read_shift(2),!0),ue=E(z[0].r,B.read_shift(2),!1);ee=E(z[0].c,B.read_shift(2),!0),te=E(z[0].r,B.read_shift(2),!1),Q.push(Me+ue+":"+ee+te)}break;case 3:if(B.l<B.length){console.error("WK1 premature formula end");return}break;case 4:Q.push("("+Q.pop()+")");break;case 5:Q.push(B.read_shift(2));break;case 6:{for(var me="";_e=B[B.l++];)me+=String.fromCharCode(_e);Q.push('"'+me.replace(/"/g,'""')+'"')}break;case 8:Q.push("-"+Q.pop());break;case 23:Q.push("+"+Q.pop());break;case 22:Q.push("NOT("+Q.pop()+")");break;case 20:case 21:ge=Q.pop(),ae=Q.pop(),Q.push(["AND","OR"][_e-20]+"("+ae+","+ge+")");break;default:if(_e<32&&w[_e])ge=Q.pop(),ae=Q.pop(),Q.push(ae+w[_e]+ge);else if(k[_e]){if(Y=k[_e][1],Y==69&&(Y=B[B.l++]),Y>Q.length){console.error("WK1 bad formula parse 0x"+_e.toString(16)+":|"+Q.join("|")+"|");return}var He=Q.slice(-Y);Q.length-=Y,Q.push(k[_e][0]+"("+He.join(",")+")")}else return _e<=7?console.error("WK1 invalid opcode "+_e.toString(16)):_e<=24?console.error("WK1 unsupported op "+_e.toString(16)):_e<=30?console.error("WK1 invalid opcode "+_e.toString(16)):_e<=115?console.error("WK1 unsupported function opcode "+_e.toString(16)):console.error("WK1 unrecognized opcode "+_e.toString(16))}}Q.length==1?z[1].f=""+Q[0]:console.error("WK1 bad formula parse |"+Q.join("|")+"|")}function A(B){var z=[{c:0,r:0},{t:"n",v:0},0];return z[0].r=B.read_shift(2),z[3]=B[B.l++],z[0].c=B[B.l++],z}function P(B,z){var Q=A(B);return Q[1].t="s",Q[1].v=B.read_shift(z-4,"cstr"),Q}function R(B,z,Q,Y){var te=wt(6+Y.length);te.write_shift(2,B),te.write_shift(1,Q),te.write_shift(1,z),te.write_shift(1,39);for(var ee=0;ee<Y.length;++ee){var ae=Y.charCodeAt(ee);te.write_shift(1,ae>=128?95:ae)}return te.write_shift(1,0),te}function T(B,z){var Q=A(B);Q[1].v=B.read_shift(2);var Y=Q[1].v>>1;if(Q[1].v&1)switch(Y&7){case 0:Y=(Y>>3)*5e3;break;case 1:Y=(Y>>3)*500;break;case 2:Y=(Y>>3)/20;break;case 3:Y=(Y>>3)/200;break;case 4:Y=(Y>>3)/2e3;break;case 5:Y=(Y>>3)/2e4;break;case 6:Y=(Y>>3)/16;break;case 7:Y=(Y>>3)/64;break}return Q[1].v=Y,Q}function D(B,z){var Q=A(B),Y=B.read_shift(4),te=B.read_shift(4),ee=B.read_shift(2);if(ee==65535)return Y===0&&te===3221225472?(Q[1].t="e",Q[1].v=15):Y===0&&te===3489660928?(Q[1].t="e",Q[1].v=42):Q[1].v=0,Q;var ae=ee&32768;return ee=(ee&32767)-16446,Q[1].v=(1-ae*2)*(te*Math.pow(2,ee+32)+Y*Math.pow(2,ee)),Q}function I(B,z,Q,Y){var te=wt(14);if(te.write_shift(2,B),te.write_shift(1,Q),te.write_shift(1,z),Y==0)return te.write_shift(4,0),te.write_shift(4,0),te.write_shift(2,65535),te;var ee=0,ae=0,ge=0,_e=0;return Y<0&&(ee=1,Y=-Y),ae=Math.log2(Y)|0,Y/=Math.pow(2,ae-31),_e=Y>>>0,(_e&2147483648)==0&&(Y/=2,++ae,_e=Y>>>0),Y-=_e,_e|=2147483648,_e>>>=0,Y*=Math.pow(2,32),ge=Y>>>0,te.write_shift(4,ge),te.write_shift(4,_e),ae+=16383+(ee?32768:0),te.write_shift(2,ae),te}function V(B,z){var Q=D(B);return B.l+=z-14,Q}function X(B,z){var Q=A(B),Y=B.read_shift(4);return Q[1].v=Y>>6,Q}function Z(B,z){var Q=A(B),Y=B.read_shift(8,"f");return Q[1].v=Y,Q}function ie(B,z){var Q=Z(B);return B.l+=z-10,Q}function q(B,z){return B[B.l+z-1]==0?B.read_shift(z,"cstr"):""}function ne(B,z){var Q=B[B.l++];Q>z-1&&(Q=z-1);for(var Y="";Y.length<Q;)Y+=String.fromCharCode(B[B.l++]);return Y}function M(B,z,Q){if(!(!Q.qpro||z<21)){var Y=B.read_shift(1);B.l+=17,B.l+=1,B.l+=2;var te=B.read_shift(z-21,"cstr");return[Y,te]}}function W(B,z){for(var Q={},Y=B.l+z;B.l<Y;){var te=B.read_shift(2);if(te==14e3){for(Q[te]=[0,""],Q[te][0]=B.read_shift(2);B[B.l];)Q[te][1]+=String.fromCharCode(B[B.l]),B.l++;B.l++}}return Q}function L(B,z){var Q=wt(5+B.length);Q.write_shift(2,14e3),Q.write_shift(2,z);for(var Y=0;Y<B.length;++Y){var te=B.charCodeAt(Y);Q[Q.l++]=te>127?95:te}return Q[Q.l++]=0,Q}var H={0:{n:"BOF",f:As},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:l},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:g},14:{n:"NUMBER",f:v},15:{n:"LABEL",f},16:{n:"FORMULA",f:b},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:q},222:{n:"SHEETNAMELP",f:ne},65535:{n:""}},K={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:P},23:{n:"NUMBER17",f:D},24:{n:"NUMBER18",f:T},25:{n:"FORMULA19",f:V},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:W},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:X},38:{n:"??"},39:{n:"NUMBER27",f:Z},40:{n:"FORMULA28",f:ie},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:q},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:M},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:n,book_to_wk3:s,to_workbook:t}})();function LK(e){var t={},r=e.match(za),n=0,s=!1;if(r)for(;n!=r.length;++n){var a=kr(r[n]);switch(a[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!a.val)break;case"<shadow>":case"<shadow/>":t.shadow=1;break;case"</shadow>":break;case"<charset":if(a.val=="1")break;t.cp=sS[parseInt(a.val,10)];break;case"<outline":if(!a.val)break;case"<outline>":case"<outline/>":t.outline=1;break;case"</outline>":break;case"<rFont":t.name=a.val;break;case"<sz":t.sz=a.val;break;case"<strike":if(!a.val)break;case"<strike>":case"<strike/>":t.strike=1;break;case"</strike>":break;case"<u":if(!a.val)break;switch(a.val){case"double":t.uval="double";break;case"singleAccounting":t.uval="single-accounting";break;case"doubleAccounting":t.uval="double-accounting";break}case"<u>":case"<u/>":t.u=1;break;case"</u>":break;case"<b":if(a.val=="0")break;case"<b>":case"<b/>":t.b=1;break;case"</b>":break;case"<i":if(a.val=="0")break;case"<i>":case"<i/>":t.i=1;break;case"</i>":break;case"<color":a.rgb&&(t.color=a.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":t.family=a.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":t.valign=a.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(a[0].charCodeAt(1)!==47&&!s)throw new Error("Unrecognized rich format "+a[0])}}return t}var BK=(function(){var e=dp("t"),t=dp("rPr");function r(a){var i=a.match(e);if(!i)return{t:"s",v:""};var l={t:"s",v:Qr(i[1])},c=a.match(t);return c&&(l.s=LK(c[1])),l}var n=/<(?:\w+:)?r>/g,s=/<\/(?:\w+:)?r>/;return function(i){return i.replace(n,"").split(s).map(r).filter(function(l){return l.v})}})(),UK=(function(){var t=/(\r\n|\n)/g;function r(s,a,i){var l=[];s.u&&l.push("text-decoration: underline;"),s.uval&&l.push("text-underline-style:"+s.uval+";"),s.sz&&l.push("font-size:"+s.sz+"pt;"),s.outline&&l.push("text-effect: outline;"),s.shadow&&l.push("text-shadow: auto;"),a.push('<span style="'+l.join("")+'">'),s.b&&(a.push("<b>"),i.push("</b>")),s.i&&(a.push("<i>"),i.push("</i>")),s.strike&&(a.push("<s>"),i.push("</s>"));var c=s.valign||"";return c=="superscript"||c=="super"?c="sup":c=="subscript"&&(c="sub"),c!=""&&(a.push("<"+c+">"),i.push("</"+c+">")),i.push("</span>"),s}function n(s){var a=[[],s.v,[]];return s.v?(s.s&&r(s.s,a[0],a[2]),a[0].join("")+a[1].replace(t,"<br/>")+a[2].join("")):""}return function(a){return a.map(n).join("")}})(),$K=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,WK=/<(?:\w+:)?r>/,zK=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function NS(e,t){var r=t?t.cellHTML:!0,n={};return e?(e.match(/^\s*<(?:\w+:)?t[^>]*>/)?(n.t=Qr(bn(e.slice(e.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),n.r=bn(e),r&&(n.h=gS(n.t))):e.match(WK)&&(n.r=bn(e),n.t=Qr(bn((e.replace(zK,"").match($K)||[]).join("").replace(za,""))),r&&(n.h=UK(BK(n.r)))),n):{t:""}}var HK=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,GK=/<(?:\w+:)?(?:si|sstItem)>/g,VK=/<\/(?:\w+:)?(?:si|sstItem)>/;function KK(e,t){var r=[],n="";if(!e)return r;var s=e.match(HK);if(s){n=s[2].replace(GK,"").split(VK);for(var a=0;a!=n.length;++a){var i=NS(n[a].trim(),t);i!=null&&(r[r.length]=i)}s=kr(s[1]),r.Count=s.count,r.Unique=s.uniqueCount}return r}var qK=/^\s|\s$|[\t\n\r]/;function mF(e,t){if(!t.bookSST)return"";var r=[ws];r[r.length]=Gt("sst",null,{xmlns:wf[0],count:e.Count,uniqueCount:e.Unique});for(var n=0;n!=e.length;++n)if(e[n]!=null){var s=e[n],a="<si>";s.r?a+=s.r:(a+="<t",s.t||(s.t=""),s.t.match(qK)&&(a+=' xml:space="preserve"'),a+=">"+pn(s.t)+"</t>"),a+="</si>",r[r.length]=a}return r.length>2&&(r[r.length]="</sst>",r[1]=r[1].replace("/>",">")),r.join("")}function XK(e){return[e.read_shift(4),e.read_shift(4)]}function YK(e,t){var r=[],n=!1;return Fc(e,function(a,i,l){switch(l){case 159:r.Count=a[0],r.Unique=a[1];break;case 19:r.push(a);break;case 160:return!0;case 35:n=!0;break;case 36:n=!1;break;default:if(i.T,!n||t.WTF)throw new Error("Unexpected record 0x"+l.toString(16))}}),r}function QK(e,t){return t||(t=wt(8)),t.write_shift(4,e.Count),t.write_shift(4,e.Unique),t}var JK=lG;function ZK(e){var t=Ci();Tt(t,159,QK(e));for(var r=0;r<e.length;++r)Tt(t,19,JK(e[r]));return Tt(t,160),t.end()}function pF(e){for(var t=[],r=e.split(""),n=0;n<r.length;++n)t[n]=r[n].charCodeAt(0);return t}function bc(e,t){var r={};return r.Major=e.read_shift(2),r.Minor=e.read_shift(2),t>=4&&(e.l+=t-4),r}function eq(e){var t={};return t.id=e.read_shift(0,"lpp4"),t.R=bc(e,4),t.U=bc(e,4),t.W=bc(e,4),t}function tq(e){for(var t=e.read_shift(4),r=e.l+t-4,n={},s=e.read_shift(4),a=[];s-- >0;)a.push({t:e.read_shift(4),v:e.read_shift(0,"lpp4")});if(n.name=e.read_shift(0,"lpp4"),n.comps=a,e.l!=r)throw new Error("Bad DataSpaceMapEntry: "+e.l+" != "+r);return n}function rq(e){var t=[];e.l+=4;for(var r=e.read_shift(4);r-- >0;)t.push(tq(e));return t}function nq(e){var t=[];e.l+=4;for(var r=e.read_shift(4);r-- >0;)t.push(e.read_shift(0,"lpp4"));return t}function sq(e){var t={};return e.read_shift(4),e.l+=4,t.id=e.read_shift(0,"lpp4"),t.name=e.read_shift(0,"lpp4"),t.R=bc(e,4),t.U=bc(e,4),t.W=bc(e,4),t}function aq(e){var t=sq(e);if(t.ename=e.read_shift(0,"8lpp4"),t.blksz=e.read_shift(4),t.cmode=e.read_shift(4),e.read_shift(4)!=4)throw new Error("Bad !Primary record");return t}function xF(e,t){var r=e.l+t,n={};n.Flags=e.read_shift(4)&63,e.l+=4,n.AlgID=e.read_shift(4);var s=!1;switch(n.AlgID){case 26126:case 26127:case 26128:s=n.Flags==36;break;case 26625:s=n.Flags==4;break;case 0:s=n.Flags==16||n.Flags==4||n.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+n.AlgID}if(!s)throw new Error("Encryption Flags/AlgID mismatch");return n.AlgIDHash=e.read_shift(4),n.KeySize=e.read_shift(4),n.ProviderType=e.read_shift(4),e.l+=8,n.CSPName=e.read_shift(r-e.l>>1,"utf16le"),e.l=r,n}function yF(e,t){var r={},n=e.l+t;return e.l+=4,r.Salt=e.slice(e.l,e.l+16),e.l+=16,r.Verifier=e.slice(e.l,e.l+16),e.l+=16,e.read_shift(4),r.VerifierHash=e.slice(e.l,n),e.l=n,r}function iq(e){var t=bc(e);switch(t.Minor){case 2:return[t.Minor,oq(e)];case 3:return[t.Minor,lq()];case 4:return[t.Minor,cq(e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+t.Minor)}function oq(e){var t=e.read_shift(4);if((t&63)!=36)throw new Error("EncryptionInfo mismatch");var r=e.read_shift(4),n=xF(e,r),s=yF(e,e.length-e.l);return{t:"Std",h:n,v:s}}function lq(){throw new Error("File is password-protected: ECMA-376 Extensible")}function cq(e){var t=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];e.l+=4;var r=e.read_shift(e.length-e.l,"utf8"),n={};return r.replace(za,function(a){var i=kr(a);switch(Dl(i[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":t.forEach(function(l){n[l]=i[l]});break;case"<dataIntegrity":n.encryptedHmacKey=i.encryptedHmacKey,n.encryptedHmacValue=i.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":n.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":n.uri=i.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":n.encs.push(i);break;default:throw i[0]}}),n}function uq(e,t){var r={},n=r.EncryptionVersionInfo=bc(e,4);if(t-=4,n.Minor!=2)throw new Error("unrecognized minor version code: "+n.Minor);if(n.Major>4||n.Major<2)throw new Error("unrecognized major version code: "+n.Major);r.Flags=e.read_shift(4),t-=4;var s=e.read_shift(4);return t-=4,r.EncryptionHeader=xF(e,s),t-=s,r.EncryptionVerifier=yF(e,t),r}function dq(e){var t={},r=t.EncryptionVersionInfo=bc(e,4);if(r.Major!=1||r.Minor!=1)throw"unrecognized version code "+r.Major+" : "+r.Minor;return t.Salt=e.read_shift(16),t.EncryptedVerifier=e.read_shift(16),t.EncryptedVerifierHash=e.read_shift(16),t}function AS(e){var t=0,r,n=pF(e),s=n.length+1,a,i,l,c,d;for(r=Bu(s),r[0]=n.length,a=1;a!=s;++a)r[a]=n[a-1];for(a=s-1;a>=0;--a)i=r[a],l=(t&16384)===0?0:1,c=t<<1&32767,d=l|c,t=d^i;return t^52811}var vF=(function(){var e=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],t=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],r=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],n=function(i){return(i/2|i*128)&255},s=function(i,l){return n(i^l)},a=function(i){for(var l=t[i.length-1],c=104,d=i.length-1;d>=0;--d)for(var f=i[d],p=0;p!=7;++p)f&64&&(l^=r[c]),f*=2,--c;return l};return function(i){for(var l=pF(i),c=a(l),d=l.length,f=Bu(16),p=0;p!=16;++p)f[p]=0;var g,y,v;for((d&1)===1&&(g=c>>8,f[d]=s(e[0],g),--d,g=c&255,y=l[l.length-1],f[d]=s(y,g));d>0;)--d,g=c>>8,f[d]=s(l[d],g),--d,g=c&255,f[d]=s(l[d],g);for(d=15,v=15-l.length;v>0;)g=c>>8,f[d]=s(e[v],g),--d,--v,g=c&255,f[d]=s(l[d],g),--d,--v;return f}})(),fq=function(e,t,r,n,s){s||(s=t),n||(n=vF(e));var a,i;for(a=0;a!=t.length;++a)i=t[a],i^=n[r],i=(i>>5|i<<3)&255,s[a]=i,++r;return[s,r,n]},hq=function(e){var t=0,r=vF(e);return function(n){var s=fq("",n,t,r);return t=s[1],s[0]}};function gq(e,t,r,n){var s={key:As(e),verificationBytes:As(e)};return r.password&&(s.verifier=AS(r.password)),n.valid=s.verificationBytes===s.verifier,n.valid&&(n.insitu=hq(r.password)),s}function mq(e,t,r){var n=r||{};return n.Info=e.read_shift(2),e.l-=2,n.Info===1?n.Data=dq(e):n.Data=uq(e,t),n}function pq(e,t,r){var n={Type:r.biff>=8?e.read_shift(2):0};return n.Type?mq(e,t-2,n):gq(e,r.biff>=8?t:t-2,r,n),n}var wF=(function(){function e(s,a){switch(a.type){case"base64":return t(Wi(s),a);case"binary":return t(s,a);case"buffer":return t(Lr&&Buffer.isBuffer(s)?s.toString("binary"):Yu(s),a);case"array":return t(ff(s),a)}throw new Error("Unrecognized type "+a.type)}function t(s,a){var i=a||{},l=i.dense?[]:{},c=s.match(/\\trowd.*?\\row\b/g);if(!c.length)throw new Error("RTF missing table");var d={s:{c:0,r:0},e:{c:0,r:c.length-1}};return c.forEach(function(f,p){Array.isArray(l)&&(l[p]=[]);for(var g=/\\\w+\b/g,y=0,v,_=-1;v=g.exec(f);){switch(v[0]){case"\\cell":var b=f.slice(y,g.lastIndex-v[0].length);if(b[0]==" "&&(b=b.slice(1)),++_,b.length){var E={v:b,t:"s"};Array.isArray(l)?l[p][_]=E:l[br({r:p,c:_})]=E}break}y=g.lastIndex}_>d.e.c&&(d.e.c=_)}),l["!ref"]=Rr(d),l}function r(s,a){return Qu(e(s,a),a)}function n(s){for(var a=["{\\rtf1\\ansi"],i=Jr(s["!ref"]),l,c=Array.isArray(s),d=i.s.r;d<=i.e.r;++d){a.push("\\trowd\\trautofit1");for(var f=i.s.c;f<=i.e.c;++f)a.push("\\cellx"+(f+1));for(a.push("\\pard\\intbl"),f=i.s.c;f<=i.e.c;++f){var p=br({r:d,c:f});l=c?(s[d]||[])[f]:s[p],!(!l||l.v==null&&(!l.f||l.F))&&(a.push(" "+(l.w||(Ec(l),l.w))),a.push("\\cell"))}a.push("\\pard\\intbl\\row")}return a.join("")+"}"}return{to_workbook:r,to_sheet:e,from_sheet:n}})();function xq(e){var t=e.slice(e[0]==="#"?1:0).slice(0,6);return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function mp(e){for(var t=0,r=1;t!=3;++t)r=r*256+(e[t]>255?255:e[t]<0?0:e[t]);return r.toString(16).toUpperCase().slice(1)}function yq(e){var t=e[0]/255,r=e[1]/255,n=e[2]/255,s=Math.max(t,r,n),a=Math.min(t,r,n),i=s-a;if(i===0)return[0,0,t];var l=0,c=0,d=s+a;switch(c=i/(d>1?2-d:d),s){case t:l=((r-n)/i+6)%6;break;case r:l=(n-t)/i+2;break;case n:l=(t-r)/i+4;break}return[l/6,c,d/2]}function vq(e){var t=e[0],r=e[1],n=e[2],s=r*2*(n<.5?n:1-n),a=n-s/2,i=[a,a,a],l=6*t,c;if(r!==0)switch(l|0){case 0:case 6:c=s*l,i[0]+=s,i[1]+=c;break;case 1:c=s*(2-l),i[0]+=c,i[1]+=s;break;case 2:c=s*(l-2),i[1]+=s,i[2]+=c;break;case 3:c=s*(4-l),i[1]+=c,i[2]+=s;break;case 4:c=s*(l-4),i[2]+=s,i[0]+=c;break;case 5:c=s*(6-l),i[2]+=c,i[0]+=s;break}for(var d=0;d!=3;++d)i[d]=Math.round(i[d]*255);return i}function by(e,t){if(t===0)return e;var r=yq(xq(e));return t<0?r[2]=r[2]*(1+t):r[2]=1-(1-r[2])*(1-t),mp(vq(r))}var _F=6,wq=15,_q=1,Ia=_F;function pp(e){return Math.floor((e+Math.round(128/Ia)/256)*Ia)}function xp(e){return Math.floor((e-5)/Ia*100+.5)/100}function Sy(e){return Math.round((e*Ia+5)/Ia*256)/256}function Gw(e){return Sy(xp(pp(e)))}function jS(e){var t=Math.abs(e-Gw(e)),r=Ia;if(t>.005)for(Ia=_q;Ia<wq;++Ia)Math.abs(e-Gw(e))<=t&&(t=Math.abs(e-Gw(e)),r=Ia);Ia=r}function Uu(e){e.width?(e.wpx=pp(e.width),e.wch=xp(e.wpx),e.MDW=Ia):e.wpx?(e.wch=xp(e.wpx),e.width=Sy(e.wch),e.MDW=Ia):typeof e.wch=="number"&&(e.width=Sy(e.wch),e.wpx=pp(e.width),e.MDW=Ia),e.customWidth&&delete e.customWidth}var bq=96,bF=bq;function yp(e){return e*96/bF}function h0(e){return e*bF/96}var Sq={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function kq(e,t,r,n){t.Borders=[];var s={},a=!1;(e[0].match(za)||[]).forEach(function(i){var l=kr(i);switch(Dl(l[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":s={},l.diagonalUp&&(s.diagonalUp=Rn(l.diagonalUp)),l.diagonalDown&&(s.diagonalDown=Rn(l.diagonalDown)),t.Borders.push(s);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(n&&n.WTF&&!a)throw new Error("unrecognized "+l[0]+" in borders")}})}function Cq(e,t,r,n){t.Fills=[];var s={},a=!1;(e[0].match(za)||[]).forEach(function(i){var l=kr(i);switch(Dl(l[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":s={},t.Fills.push(s);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":t.Fills.push(s),s={};break;case"<patternFill":case"<patternFill>":l.patternType&&(s.patternType=l.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":s.bgColor||(s.bgColor={}),l.indexed&&(s.bgColor.indexed=parseInt(l.indexed,10)),l.theme&&(s.bgColor.theme=parseInt(l.theme,10)),l.tint&&(s.bgColor.tint=parseFloat(l.tint)),l.rgb&&(s.bgColor.rgb=l.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":s.fgColor||(s.fgColor={}),l.theme&&(s.fgColor.theme=parseInt(l.theme,10)),l.tint&&(s.fgColor.tint=parseFloat(l.tint)),l.rgb!=null&&(s.fgColor.rgb=l.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(n&&n.WTF&&!a)throw new Error("unrecognized "+l[0]+" in fills")}})}function Tq(e,t,r,n){t.Fonts=[];var s={},a=!1;(e[0].match(za)||[]).forEach(function(i){var l=kr(i);switch(Dl(l[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":t.Fonts.push(s),s={};break;case"<name":l.val&&(s.name=bn(l.val));break;case"<name/>":case"</name>":break;case"<b":s.bold=l.val?Rn(l.val):1;break;case"<b/>":s.bold=1;break;case"<i":s.italic=l.val?Rn(l.val):1;break;case"<i/>":s.italic=1;break;case"<u":switch(l.val){case"none":s.underline=0;break;case"single":s.underline=1;break;case"double":s.underline=2;break;case"singleAccounting":s.underline=33;break;case"doubleAccounting":s.underline=34;break}break;case"<u/>":s.underline=1;break;case"<strike":s.strike=l.val?Rn(l.val):1;break;case"<strike/>":s.strike=1;break;case"<outline":s.outline=l.val?Rn(l.val):1;break;case"<outline/>":s.outline=1;break;case"<shadow":s.shadow=l.val?Rn(l.val):1;break;case"<shadow/>":s.shadow=1;break;case"<condense":s.condense=l.val?Rn(l.val):1;break;case"<condense/>":s.condense=1;break;case"<extend":s.extend=l.val?Rn(l.val):1;break;case"<extend/>":s.extend=1;break;case"<sz":l.val&&(s.sz=+l.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":l.val&&(s.vertAlign=l.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":l.val&&(s.family=parseInt(l.val,10));break;case"<family/>":case"</family>":break;case"<scheme":l.val&&(s.scheme=l.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(l.val=="1")break;l.codepage=sS[parseInt(l.val,10)];break;case"<color":if(s.color||(s.color={}),l.auto&&(s.color.auto=Rn(l.auto)),l.rgb)s.color.rgb=l.rgb.slice(-6);else if(l.indexed){s.color.index=parseInt(l.indexed,10);var c=Vd[s.color.index];s.color.index==81&&(c=Vd[1]),c||(c=Vd[1]),s.color.rgb=c[0].toString(16)+c[1].toString(16)+c[2].toString(16)}else l.theme&&(s.color.theme=parseInt(l.theme,10),l.tint&&(s.color.tint=parseFloat(l.tint)),l.theme&&r.themeElements&&r.themeElements.clrScheme&&(s.color.rgb=by(r.themeElements.clrScheme[s.color.theme].rgb,s.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":a=!0;break;case"</AlternateContent>":a=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(n&&n.WTF&&!a)throw new Error("unrecognized "+l[0]+" in fonts")}})}function Eq(e,t,r){t.NumberFmt=[];for(var n=os(wr),s=0;s<n.length;++s)t.NumberFmt[n[s]]=wr[n[s]];var a=e[0].match(za);if(a)for(s=0;s<a.length;++s){var i=kr(a[s]);switch(Dl(i[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var l=Qr(bn(i.formatCode)),c=parseInt(i.numFmtId,10);if(t.NumberFmt[c]=l,c>0){if(c>392){for(c=392;c>60&&t.NumberFmt[c]!=null;--c);t.NumberFmt[c]=l}_c(l,c)}}break;case"</numFmt>":break;default:if(r.WTF)throw new Error("unrecognized "+i[0]+" in numFmts")}}}function Nq(e){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var n=r[0];n<=r[1];++n)e[n]!=null&&(t[t.length]=Gt("numFmt",null,{numFmtId:n,formatCode:pn(e[n])}))}),t.length===1?"":(t[t.length]="</numFmts>",t[0]=Gt("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}var S1=["numFmtId","fillId","fontId","borderId","xfId"],k1=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function Aq(e,t,r){t.CellXf=[];var n,s=!1;(e[0].match(za)||[]).forEach(function(a){var i=kr(a),l=0;switch(Dl(i[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(n=i,delete n[0],l=0;l<S1.length;++l)n[S1[l]]&&(n[S1[l]]=parseInt(n[S1[l]],10));for(l=0;l<k1.length;++l)n[k1[l]]&&(n[k1[l]]=Rn(n[k1[l]]));if(t.NumberFmt&&n.numFmtId>392){for(l=392;l>60;--l)if(t.NumberFmt[n.numFmtId]==t.NumberFmt[l]){n.numFmtId=l;break}}t.CellXf.push(n);break;case"</xf>":break;case"<alignment":case"<alignment/>":var c={};i.vertical&&(c.vertical=i.vertical),i.horizontal&&(c.horizontal=i.horizontal),i.textRotation!=null&&(c.textRotation=i.textRotation),i.indent&&(c.indent=i.indent),i.wrapText&&(c.wrapText=Rn(i.wrapText)),n.alignment=c;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":s=!0;break;case"</AlternateContent>":s=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(r&&r.WTF&&!s)throw new Error("unrecognized "+i[0]+" in cellXfs")}})}function jq(e){var t=[];return t[t.length]=Gt("cellXfs",null),e.forEach(function(r){t[t.length]=Gt("xf",null,r)}),t[t.length]="</cellXfs>",t.length===2?"":(t[0]=Gt("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}var Fq=(function(){var t=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,r=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,n=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,s=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,a=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(l,c,d){var f={};if(!l)return f;l=l.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var p;return(p=l.match(t))&&Eq(p,f,d),(p=l.match(s))&&Tq(p,f,c,d),(p=l.match(n))&&Cq(p,f,c,d),(p=l.match(a))&&kq(p,f,c,d),(p=l.match(r))&&Aq(p,f,d),f}})();function SF(e,t){var r=[ws,Gt("styleSheet",null,{xmlns:wf[0],"xmlns:vt":$s.vt})],n;return e.SSF&&(n=Nq(e.SSF))!=null&&(r[r.length]=n),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(n=jq(t.cellXfs))&&(r[r.length]=n),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function Pq(e,t){var r=e.read_shift(2),n=Ua(e);return[r,n]}function Rq(e,t,r){r||(r=wt(6+4*t.length)),r.write_shift(2,e),na(t,r);var n=r.length>r.l?r.slice(0,r.l):r;return r.l==null&&(r.l=r.length),n}function Dq(e,t,r){var n={};n.sz=e.read_shift(2)/20;var s=mG(e);s.fItalic&&(n.italic=1),s.fCondense&&(n.condense=1),s.fExtend&&(n.extend=1),s.fShadow&&(n.shadow=1),s.fOutline&&(n.outline=1),s.fStrikeout&&(n.strike=1);var a=e.read_shift(2);switch(a===700&&(n.bold=1),e.read_shift(2)){case 1:n.vertAlign="superscript";break;case 2:n.vertAlign="subscript";break}var i=e.read_shift(1);i!=0&&(n.underline=i);var l=e.read_shift(1);l>0&&(n.family=l);var c=e.read_shift(1);switch(c>0&&(n.charset=c),e.l++,n.color=gG(e),e.read_shift(1)){case 1:n.scheme="major";break;case 2:n.scheme="minor";break}return n.name=Ua(e),n}function Iq(e,t){t||(t=wt(153)),t.write_shift(2,e.sz*20),pG(e,t),t.write_shift(2,e.bold?700:400);var r=0;e.vertAlign=="superscript"?r=1:e.vertAlign=="subscript"&&(r=2),t.write_shift(2,r),t.write_shift(1,e.underline||0),t.write_shift(1,e.family||0),t.write_shift(1,e.charset||0),t.write_shift(1,0),vy(e.color,t);var n=0;return n=2,t.write_shift(1,n),na(e.name,t),t.length>t.l?t.slice(0,t.l):t}var Mq=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],Vw,Oq=Wa;function a3(e,t){t||(t=wt(84)),Vw||(Vw=tv(Mq));var r=Vw[e.patternType];r==null&&(r=40),t.write_shift(4,r);var n=0;if(r!=40)for(vy({auto:1},t),vy({auto:1},t);n<12;++n)t.write_shift(4,0);else{for(;n<4;++n)t.write_shift(4,0);for(;n<12;++n)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function Lq(e,t){var r=e.l+t,n=e.read_shift(2),s=e.read_shift(2);return e.l=r,{ixfe:n,numFmtId:s}}function kF(e,t,r){r||(r=wt(16)),r.write_shift(2,t||0),r.write_shift(2,e.numFmtId||0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);var n=0;return r.write_shift(1,n),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r}function vm(e,t){return t||(t=wt(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var Bq=Wa;function Uq(e,t){return t||(t=wt(51)),t.write_shift(1,0),vm(null,t),vm(null,t),vm(null,t),vm(null,t),vm(null,t),t.length>t.l?t.slice(0,t.l):t}function $q(e,t){return t||(t=wt(52)),t.write_shift(4,e.xfId),t.write_shift(2,1),t.write_shift(1,0),t.write_shift(1,0),yy(e.name||"",t),t.length>t.l?t.slice(0,t.l):t}function Wq(e,t,r){var n=wt(2052);return n.write_shift(4,e),yy(t,n),yy(r,n),n.length>n.l?n.slice(0,n.l):n}function zq(e,t,r){var n={};n.NumberFmt=[];for(var s in wr)n.NumberFmt[s]=wr[s];n.CellXf=[],n.Fonts=[];var a=[],i=!1;return Fc(e,function(c,d,f){switch(f){case 44:n.NumberFmt[c[0]]=c[1],_c(c[1],c[0]);break;case 43:n.Fonts.push(c),c.color.theme!=null&&t&&t.themeElements&&t.themeElements.clrScheme&&(c.color.rgb=by(t.themeElements.clrScheme[c.color.theme].rgb,c.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:a[a.length-1]==617&&n.CellXf.push(c);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:i=!0;break;case 36:i=!1;break;case 37:a.push(f),i=!0;break;case 38:a.pop(),i=!1;break;default:if(d.T>0)a.push(f);else if(d.T<0)a.pop();else if(!i||r.WTF&&a[a.length-1]!=37)throw new Error("Unexpected record 0x"+f.toString(16))}}),n}function Hq(e,t){if(t){var r=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)t[s]!=null&&++r}),r!=0&&(Tt(e,615,Vo(r)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)t[s]!=null&&Tt(e,44,Rq(s,t[s]))}),Tt(e,616))}}function Gq(e){var t=1;Tt(e,611,Vo(t)),Tt(e,43,Iq({sz:12,color:{theme:1},name:"Calibri",family:2})),Tt(e,612)}function Vq(e){var t=2;Tt(e,603,Vo(t)),Tt(e,45,a3({patternType:"none"})),Tt(e,45,a3({patternType:"gray125"})),Tt(e,604)}function Kq(e){var t=1;Tt(e,613,Vo(t)),Tt(e,46,Uq()),Tt(e,614)}function qq(e){var t=1;Tt(e,626,Vo(t)),Tt(e,47,kF({numFmtId:0},65535)),Tt(e,627)}function Xq(e,t){Tt(e,617,Vo(t.length)),t.forEach(function(r){Tt(e,47,kF(r,0))}),Tt(e,618)}function Yq(e){var t=1;Tt(e,619,Vo(t)),Tt(e,48,$q({xfId:0,name:"Normal"})),Tt(e,620)}function Qq(e){var t=0;Tt(e,505,Vo(t)),Tt(e,506)}function Jq(e){var t=0;Tt(e,508,Wq(t,"TableStyleMedium9","PivotStyleMedium4")),Tt(e,509)}function Zq(e,t){var r=Ci();return Tt(r,278),Hq(r,e.SSF),Gq(r),Vq(r),Kq(r),qq(r),Xq(r,t.cellXfs),Yq(r),Qq(r),Jq(r),Tt(r,279),r.end()}var eX=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function tX(e,t,r){t.themeElements.clrScheme=[];var n={};(e[0].match(za)||[]).forEach(function(s){var a=kr(s);switch(a[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":n.rgb=a.val;break;case"<a:sysClr":n.rgb=a.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":a[0].charAt(1)==="/"?(t.themeElements.clrScheme[eX.indexOf(a[0])]=n,n={}):n.name=a[0].slice(3,a[0].length-1);break;default:if(r&&r.WTF)throw new Error("Unrecognized "+a[0]+" in clrScheme")}})}function rX(){}function nX(){}var sX=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,aX=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,iX=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function oX(e,t,r){t.themeElements={};var n;[["clrScheme",sX,tX],["fontScheme",aX,rX],["fmtScheme",iX,nX]].forEach(function(s){if(!(n=e.match(s[1])))throw new Error(s[0]+" not found in themeElements");s[2](n,t,r)})}var lX=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function CF(e,t){(!e||e.length===0)&&(e=FS());var r,n={};if(!(r=e.match(lX)))throw new Error("themeElements not found in theme");return oX(r[0],n,t),n.raw=e,n}function FS(e,t){if(t&&t.themeXLSX)return t.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var r=[ws];return r[r.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',r[r.length]="<a:themeElements>",r[r.length]='<a:clrScheme name="Office">',r[r.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',r[r.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',r[r.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',r[r.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',r[r.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',r[r.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',r[r.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',r[r.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',r[r.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',r[r.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',r[r.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',r[r.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',r[r.length]="</a:clrScheme>",r[r.length]='<a:fontScheme name="Office">',r[r.length]="<a:majorFont>",r[r.length]='<a:latin typeface="Cambria"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',r[r.length]='<a:font script="Hang" typeface="맑은 고딕"/>',r[r.length]='<a:font script="Hans" typeface="宋体"/>',r[r.length]='<a:font script="Hant" typeface="新細明體"/>',r[r.length]='<a:font script="Arab" typeface="Times New Roman"/>',r[r.length]='<a:font script="Hebr" typeface="Times New Roman"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="MoolBoran"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Times New Roman"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:majorFont>",r[r.length]="<a:minorFont>",r[r.length]='<a:latin typeface="Calibri"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',r[r.length]='<a:font script="Hang" typeface="맑은 고딕"/>',r[r.length]='<a:font script="Hans" typeface="宋体"/>',r[r.length]='<a:font script="Hant" typeface="新細明體"/>',r[r.length]='<a:font script="Arab" typeface="Arial"/>',r[r.length]='<a:font script="Hebr" typeface="Arial"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="DaunPenh"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Arial"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:minorFont>",r[r.length]="</a:fontScheme>",r[r.length]='<a:fmtScheme name="Office">',r[r.length]="<a:fillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="1"/>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="0"/>',r[r.length]="</a:gradFill>",r[r.length]="</a:fillStyleLst>",r[r.length]="<a:lnStyleLst>",r[r.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]="</a:lnStyleLst>",r[r.length]="<a:effectStyleLst>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',r[r.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',r[r.length]="</a:effectStyle>",r[r.length]="</a:effectStyleLst>",r[r.length]="<a:bgFillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]="</a:bgFillStyleLst>",r[r.length]="</a:fmtScheme>",r[r.length]="</a:themeElements>",r[r.length]="<a:objectDefaults>",r[r.length]="<a:spDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',r[r.length]="</a:spDef>",r[r.length]="<a:lnDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',r[r.length]="</a:lnDef>",r[r.length]="</a:objectDefaults>",r[r.length]="<a:extraClrSchemeLst/>",r[r.length]="</a:theme>",r.join("")}function cX(e,t,r){var n=e.l+t,s=e.read_shift(4);if(s!==124226){if(!r.cellStyles){e.l=n;return}var a=e.slice(e.l);e.l=n;var i;try{i=x8(a,{type:"array"})}catch{return}var l=Ui(i,"theme/theme/theme1.xml",!0);if(l)return CF(l,r)}}function uX(e){return e.read_shift(4)}function dX(e){var t={};switch(t.xclrType=e.read_shift(2),t.nTintShade=e.read_shift(2),t.xclrType){case 0:e.l+=4;break;case 1:t.xclrValue=fX(e,4);break;case 2:t.xclrValue=sF(e);break;case 3:t.xclrValue=uX(e);break;case 4:e.l+=4;break}return e.l+=8,t}function fX(e,t){return Wa(e,t)}function hX(e,t){return Wa(e,t)}function gX(e){var t=e.read_shift(2),r=e.read_shift(2)-4,n=[t];switch(t){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:n[1]=dX(e);break;case 6:n[1]=hX(e,r);break;case 14:case 15:n[1]=e.read_shift(r===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+t+" "+r)}return n}function mX(e,t){var r=e.l+t;e.l+=2;var n=e.read_shift(2);e.l+=2;for(var s=e.read_shift(2),a=[];s-- >0;)a.push(gX(e,r-e.l));return{ixfe:n,ext:a}}function pX(e,t){t.forEach(function(r){r[0]})}function xX(e,t){return{flags:e.read_shift(4),version:e.read_shift(4),name:Ua(e)}}function yX(e){var t=wt(12+2*e.name.length);return t.write_shift(4,e.flags),t.write_shift(4,e.version),na(e.name,t),t.slice(0,t.l)}function vX(e){for(var t=[],r=e.read_shift(4);r-- >0;)t.push([e.read_shift(4),e.read_shift(4)]);return t}function wX(e){var t=wt(4+8*e.length);t.write_shift(4,e.length);for(var r=0;r<e.length;++r)t.write_shift(4,e[r][0]),t.write_shift(4,e[r][1]);return t}function _X(e,t){var r=wt(8+2*t.length);return r.write_shift(4,e),na(t,r),r.slice(0,r.l)}function bX(e){return e.l+=4,e.read_shift(4)!=0}function SX(e,t){var r=wt(8);return r.write_shift(4,e),r.write_shift(4,1),r}function kX(e,t,r){var n={Types:[],Cell:[],Value:[]},s=r||{},a=[],i=!1,l=2;return Fc(e,function(c,d,f){switch(f){case 335:n.Types.push({name:c.name});break;case 51:c.forEach(function(p){l==1?n.Cell.push({type:n.Types[p[0]-1].name,index:p[1]}):l==0&&n.Value.push({type:n.Types[p[0]-1].name,index:p[1]})});break;case 337:l=c?1:0;break;case 338:l=2;break;case 35:a.push(f),i=!0;break;case 36:a.pop(),i=!1;break;default:if(!d.T){if(!i||s.WTF&&a[a.length-1]!=35)throw new Error("Unexpected record 0x"+f.toString(16))}}}),n}function CX(){var e=Ci();return Tt(e,332),Tt(e,334,Vo(1)),Tt(e,335,yX({name:"XLDAPR",version:12e4,flags:3496657072})),Tt(e,336),Tt(e,339,_X(1,"XLDAPR")),Tt(e,52),Tt(e,35,Vo(514)),Tt(e,4096,Vo(0)),Tt(e,4097,fo(1)),Tt(e,36),Tt(e,53),Tt(e,340),Tt(e,337,SX(1)),Tt(e,51,wX([[1,0]])),Tt(e,338),Tt(e,333),e.end()}function TX(e,t,r){var n={Types:[],Cell:[],Value:[]};if(!e)return n;var s=!1,a=2,i;return e.replace(za,function(l){var c=kr(l);switch(Dl(c[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":n.Types.push({name:c.name});break;case"</metadataType>":break;case"<futureMetadata":for(var d=0;d<n.Types.length;++d)n.Types[d].name==c.name&&(i=n.Types[d]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":a==1?n.Cell.push({type:n.Types[c.t-1].name,index:+c.v}):a==0&&n.Value.push({type:n.Types[c.t-1].name,index:+c.v});break;case"</rc>":break;case"<cellMetadata":a=1;break;case"</cellMetadata>":a=2;break;case"<valueMetadata":a=0;break;case"</valueMetadata>":a=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;case"<rvb":if(!i)break;i.offsets||(i.offsets=[]),i.offsets.push(+c.i);break;default:if(!s&&r.WTF)throw new Error("unrecognized "+c[0]+" in metadata")}return l}),n}function TF(){var e=[ws];return e.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),e.join("")}function EX(e){var t=[];if(!e)return t;var r=1;return(e.match(za)||[]).forEach(function(n){var s=kr(n);switch(s[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete s[0],s.i?r=s.i:s.i=r,t.push(s);break}}),t}function NX(e){var t={};t.i=e.read_shift(4);var r={};r.r=e.read_shift(4),r.c=e.read_shift(4),t.r=br(r);var n=e.read_shift(1);return n&2&&(t.l="1"),n&8&&(t.a="1"),t}function AX(e,t,r){var n=[];return Fc(e,function(a,i,l){switch(l){case 63:n.push(a);break;default:if(!i.T)throw new Error("Unexpected record 0x"+l.toString(16))}}),n}function jX(e,t,r,n){if(!e)return e;var s=n||{},a=!1;Fc(e,function(l,c,d){switch(d){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:a=!0;break;case 36:a=!1;break;default:if(!c.T){if(!a||s.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}},s)}function FX(e,t){if(!e)return"??";var r=(e.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return t["!id"][r].Target}var Hh=1024;function EF(e,t){for(var r=[21600,21600],n=["m0,0l0",r[1],r[0],r[1],r[0],"0xe"].join(","),s=[Gt("xml",null,{"xmlns:v":Oi.v,"xmlns:o":Oi.o,"xmlns:x":Oi.x,"xmlns:mv":Oi.mv}).replace(/\/>/,">"),Gt("o:shapelayout",Gt("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),Gt("v:shapetype",[Gt("v:stroke",null,{joinstyle:"miter"}),Gt("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:r.join(","),path:n})];Hh<e*1e3;)Hh+=1e3;return t.forEach(function(a){var i=qn(a[0]),l={color2:"#BEFF82",type:"gradient"};l.type=="gradient"&&(l.angle="-180");var c=l.type=="gradient"?Gt("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,d=Gt("v:fill",c,l),f={on:"t",obscured:"t"};++Hh,s=s.concat(["<v:shape"+fp({id:"_x0000_s"+Hh,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(a[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",d,Gt("v:shadow",null,f),Gt("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",_a("x:Anchor",[i.c+1,0,i.r+1,0,i.c+3,20,i.r+5,20].join(",")),_a("x:AutoFill","False"),_a("x:Row",String(i.r)),_a("x:Column",String(i.c)),a[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),s.push("</xml>"),s.join("")}function i3(e,t,r,n){var s=Array.isArray(e),a;t.forEach(function(i){var l=qn(i.ref);if(s?(e[l.r]||(e[l.r]=[]),a=e[l.r][l.c]):a=e[i.ref],!a){a={t:"z"},s?e[l.r][l.c]=a:e[i.ref]=a;var c=Jr(e["!ref"]||"BDWGO1000001:A1");c.s.r>l.r&&(c.s.r=l.r),c.e.r<l.r&&(c.e.r=l.r),c.s.c>l.c&&(c.s.c=l.c),c.e.c<l.c&&(c.e.c=l.c);var d=Rr(c);d!==e["!ref"]&&(e["!ref"]=d)}a.c||(a.c=[]);var f={a:i.author,t:i.t,r:i.r,T:r};i.h&&(f.h=i.h);for(var p=a.c.length-1;p>=0;--p){if(!r&&a.c[p].T)return;r&&!a.c[p].T&&a.c.splice(p,1)}if(r&&n){for(p=0;p<n.length;++p)if(f.a==n[p].id){f.a=n[p].name||f.a;break}}a.c.push(f)})}function PX(e,t){if(e.match(/<(?:\w+:)?comments *\/>/))return[];var r=[],n=[],s=e.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);s&&s[1]&&s[1].split(/<\/\w*:?author>/).forEach(function(i){if(!(i===""||i.trim()==="")){var l=i.match(/<(?:\w+:)?author[^>]*>(.*)/);l&&r.push(l[1])}});var a=e.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return a&&a[1]&&a[1].split(/<\/\w*:?comment>/).forEach(function(i){if(!(i===""||i.trim()==="")){var l=i.match(/<(?:\w+:)?comment[^>]*>/);if(l){var c=kr(l[0]),d={author:c.authorId&&r[c.authorId]||"sheetjsghost",ref:c.ref,guid:c.guid},f=qn(c.ref);if(!(t.sheetRows&&t.sheetRows<=f.r)){var p=i.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),g=!!p&&!!p[1]&&NS(p[1])||{r:"",t:"",h:""};d.r=g.r,g.r=="<t></t>"&&(g.t=g.h=""),d.t=(g.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),t.cellHTML&&(d.h=g.h),n.push(d)}}}}),n}function NF(e){var t=[ws,Gt("comments",null,{xmlns:wf[0]})],r=[];return t.push("<authors>"),e.forEach(function(n){n[1].forEach(function(s){var a=pn(s.a);r.indexOf(a)==-1&&(r.push(a),t.push("<author>"+a+"</author>")),s.T&&s.ID&&r.indexOf("tc="+s.ID)==-1&&(r.push("tc="+s.ID),t.push("<author>tc="+s.ID+"</author>"))})}),r.length==0&&(r.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),e.forEach(function(n){var s=0,a=[];if(n[1][0]&&n[1][0].T&&n[1][0].ID?s=r.indexOf("tc="+n[1][0].ID):n[1].forEach(function(c){c.a&&(s=r.indexOf(pn(c.a))),a.push(c.t||"")}),t.push('<comment ref="'+n[0]+'" authorId="'+s+'"><text>'),a.length<=1)t.push(_a("t",pn(a[0]||"")));else{for(var i=`Comment:
    `+a[0]+`
`,l=1;l<a.length;++l)i+=`Reply:
    `+a[l]+`
`;t.push(_a("t",pn(i)))}t.push("</text></comment>")}),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function RX(e,t){var r=[],n=!1,s={},a=0;return e.replace(za,function(l,c){var d=kr(l);switch(Dl(d[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":s={author:d.personId,guid:d.id,ref:d.ref,T:1};break;case"</threadedComment>":s.t!=null&&r.push(s);break;case"<text>":case"<text":a=c+l.length;break;case"</text>":s.t=e.slice(a,c).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":n=!0;break;case"</mentions>":n=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(!n&&t.WTF)throw new Error("unrecognized "+d[0]+" in threaded comments")}return l}),r}function DX(e,t,r){var n=[ws,Gt("ThreadedComments",null,{xmlns:$s.TCMNT}).replace(/[\/]>/,">")];return e.forEach(function(s){var a="";(s[1]||[]).forEach(function(i,l){if(!i.T){delete i.ID;return}i.a&&t.indexOf(i.a)==-1&&t.push(i.a);var c={ref:s[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+r.tcid++).slice(-12)+"}"};l==0?a=c.id:c.parentId=a,i.ID=c.id,i.a&&(c.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(i.a)).slice(-12)+"}"),n.push(Gt("threadedComment",_a("text",i.t||""),c))})}),n.push("</ThreadedComments>"),n.join("")}function IX(e,t){var r=[],n=!1;return e.replace(za,function(a){var i=kr(a);switch(Dl(i[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":r.push({name:i.displayname,id:i.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(!n&&t.WTF)throw new Error("unrecognized "+i[0]+" in threaded comments")}return a}),r}function MX(e){var t=[ws,Gt("personList",null,{xmlns:$s.TCMNT,"xmlns:x":wf[0]}).replace(/[\/]>/,">")];return e.forEach(function(r,n){t.push(Gt("person",null,{displayName:r,id:"{54EE7950-7262-4200-6969-"+("000000000000"+n).slice(-12)+"}",userId:r,providerId:"None"}))}),t.push("</personList>"),t.join("")}function OX(e){var t={};t.iauthor=e.read_shift(4);var r=kf(e);return t.rfx=r.s,t.ref=br(r.s),e.l+=16,t}function LX(e,t){return t==null&&(t=wt(36)),t.write_shift(4,e[1].iauthor),R0(e[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}var BX=Ua;function UX(e){return na(e.slice(0,54))}function $X(e,t){var r=[],n=[],s={},a=!1;return Fc(e,function(l,c,d){switch(d){case 632:n.push(l);break;case 635:s=l;break;case 637:s.t=l.t,s.h=l.h,s.r=l.r;break;case 636:if(s.author=n[s.iauthor],delete s.iauthor,t.sheetRows&&s.rfx&&t.sheetRows<=s.rfx.r)break;s.t||(s.t=""),delete s.rfx,r.push(s);break;case 3072:break;case 35:a=!0;break;case 36:a=!1;break;case 37:break;case 38:break;default:if(!c.T){if(!a||t.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}}),r}function WX(e){var t=Ci(),r=[];return Tt(t,628),Tt(t,630),e.forEach(function(n){n[1].forEach(function(s){r.indexOf(s.a)>-1||(r.push(s.a.slice(0,54)),Tt(t,632,UX(s.a)))})}),Tt(t,631),Tt(t,633),e.forEach(function(n){n[1].forEach(function(s){s.iauthor=r.indexOf(s.a);var a={s:qn(n[0]),e:qn(n[0])};Tt(t,635,LX([a,s])),s.t&&s.t.length>0&&Tt(t,637,uG(s)),Tt(t,636),delete s.iauthor})}),Tt(t,634),Tt(t,629),t.end()}var zX="application/vnd.ms-office.vbaProject";function HX(e){var t=mr.utils.cfb_new({root:"R"});return e.FullPaths.forEach(function(r,n){if(!(r.slice(-1)==="/"||!r.match(/_VBA_PROJECT_CUR/))){var s=r.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");mr.utils.cfb_add(t,s,e.FileIndex[n].content)}}),mr.write(t)}function GX(e,t){t.FullPaths.forEach(function(r,n){if(n!=0){var s=r.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");s.slice(-1)!=="/"&&mr.utils.cfb_add(e,s,t.FileIndex[n].content)}})}var AF=["xlsb","xlsm","xlam","biff8","xla"];function VX(){return{"!type":"dialog"}}function KX(){return{"!type":"dialog"}}function qX(){return{"!type":"macro"}}function XX(){return{"!type":"macro"}}var e0=(function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function r(n,s,a,i){var l=!1,c=!1;a.length==0?c=!0:a.charAt(0)=="["&&(c=!0,a=a.slice(1,-1)),i.length==0?l=!0:i.charAt(0)=="["&&(l=!0,i=i.slice(1,-1));var d=a.length>0?parseInt(a,10)|0:0,f=i.length>0?parseInt(i,10)|0:0;return l?f+=t.c:--f,c?d+=t.r:--d,s+(l?"":"$")+Kn(f)+(c?"":"$")+ys(d)}return function(s,a){return t=a,s.replace(e,r)}})(),PS=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,RS=(function(){return function(t,r){return t.replace(PS,function(n,s,a,i,l,c){var d=vS(i)-(a?0:r.c),f=yS(c)-(l?0:r.r),p=f==0?"":l?f+1:"["+f+"]",g=d==0?"":a?d+1:"["+d+"]";return s+"R"+p+"C"+g})}})();function jF(e,t){return e.replace(PS,function(r,n,s,a,i,l){return n+(s=="$"?s+a:Kn(vS(a)+t.c))+(i=="$"?i+l:ys(yS(l)+t.r))})}function YX(e,t,r){var n=Ti(t),s=n.s,a=qn(r),i={r:a.r-s.r,c:a.c-s.c};return jF(e,i)}function QX(e){return e.length!=1}function o3(e){return e.replace(/_xlfn\./g,"")}function Es(e){e.l+=1}function $u(e,t){var r=e.read_shift(2);return[r&16383,r>>14&1,r>>15&1]}function FF(e,t,r){var n=2;if(r){if(r.biff>=2&&r.biff<=5)return PF(e);r.biff==12&&(n=4)}var s=e.read_shift(n),a=e.read_shift(n),i=$u(e),l=$u(e);return{s:{r:s,c:i[0],cRel:i[1],rRel:i[2]},e:{r:a,c:l[0],cRel:l[1],rRel:l[2]}}}function PF(e){var t=$u(e),r=$u(e),n=e.read_shift(1),s=e.read_shift(1);return{s:{r:t[0],c:n,cRel:t[1],rRel:t[2]},e:{r:r[0],c:s,cRel:r[1],rRel:r[2]}}}function JX(e,t,r){if(r.biff<8)return PF(e);var n=e.read_shift(r.biff==12?4:2),s=e.read_shift(r.biff==12?4:2),a=$u(e),i=$u(e);return{s:{r:n,c:a[0],cRel:a[1],rRel:a[2]},e:{r:s,c:i[0],cRel:i[1],rRel:i[2]}}}function RF(e,t,r){if(r&&r.biff>=2&&r.biff<=5)return ZX(e);var n=e.read_shift(r&&r.biff==12?4:2),s=$u(e);return{r:n,c:s[0],cRel:s[1],rRel:s[2]}}function ZX(e){var t=$u(e),r=e.read_shift(1);return{r:t[0],c:r,cRel:t[1],rRel:t[2]}}function eY(e){var t=e.read_shift(2),r=e.read_shift(2);return{r:t,c:r&255,fQuoted:!!(r&16384),cRel:r>>15,rRel:r>>15}}function tY(e,t,r){var n=r&&r.biff?r.biff:8;if(n>=2&&n<=5)return rY(e);var s=e.read_shift(n>=12?4:2),a=e.read_shift(2),i=(a&16384)>>14,l=(a&32768)>>15;if(a&=16383,l==1)for(;s>524287;)s-=1048576;if(i==1)for(;a>8191;)a=a-16384;return{r:s,c:a,cRel:i,rRel:l}}function rY(e){var t=e.read_shift(2),r=e.read_shift(1),n=(t&32768)>>15,s=(t&16384)>>14;return t&=16383,n==1&&t>=8192&&(t=t-16384),s==1&&r>=128&&(r=r-256),{r:t,c:r,cRel:s,rRel:n}}function nY(e,t,r){var n=(e[e.l++]&96)>>5,s=FF(e,r.biff>=2&&r.biff<=5?6:8,r);return[n,s]}function sY(e,t,r){var n=(e[e.l++]&96)>>5,s=e.read_shift(2,"i"),a=8;if(r)switch(r.biff){case 5:e.l+=12,a=6;break;case 12:a=12;break}var i=FF(e,a,r);return[n,s,i]}function aY(e,t,r){var n=(e[e.l++]&96)>>5;return e.l+=r&&r.biff>8?12:r.biff<8?6:8,[n]}function iY(e,t,r){var n=(e[e.l++]&96)>>5,s=e.read_shift(2),a=8;if(r)switch(r.biff){case 5:e.l+=12,a=6;break;case 12:a=12;break}return e.l+=a,[n,s]}function oY(e,t,r){var n=(e[e.l++]&96)>>5,s=JX(e,t-1,r);return[n,s]}function lY(e,t,r){var n=(e[e.l++]&96)>>5;return e.l+=r.biff==2?6:r.biff==12?14:7,[n]}function l3(e){var t=e[e.l+1]&1,r=1;return e.l+=4,[t,r]}function cY(e,t,r){e.l+=2;for(var n=e.read_shift(r&&r.biff==2?1:2),s=[],a=0;a<=n;++a)s.push(e.read_shift(r&&r.biff==2?1:2));return s}function uY(e,t,r){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(r&&r.biff==2?1:2)]}function dY(e,t,r){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(r&&r.biff==2?1:2)]}function fY(e){var t=e[e.l+1]&255?1:0;return e.l+=2,[t,e.read_shift(2)]}function hY(e,t,r){var n=e[e.l+1]&255?1:0;return e.l+=r&&r.biff==2?3:4,[n]}function DF(e){var t=e.read_shift(1),r=e.read_shift(1);return[t,r]}function gY(e){return e.read_shift(2),DF(e)}function mY(e){return e.read_shift(2),DF(e)}function pY(e,t,r){var n=(e[e.l]&96)>>5;e.l+=1;var s=RF(e,0,r);return[n,s]}function xY(e,t,r){var n=(e[e.l]&96)>>5;e.l+=1;var s=tY(e,0,r);return[n,s]}function yY(e,t,r){var n=(e[e.l]&96)>>5;e.l+=1;var s=e.read_shift(2);r&&r.biff==5&&(e.l+=12);var a=RF(e,0,r);return[n,s,a]}function vY(e,t,r){var n=(e[e.l]&96)>>5;e.l+=1;var s=e.read_shift(r&&r.biff<=3?1:2);return[bQ[s],OF[s],n]}function wY(e,t,r){var n=e[e.l++],s=e.read_shift(1),a=r&&r.biff<=3?[n==88?-1:0,e.read_shift(1)]:_Y(e);return[s,(a[0]===0?OF:_Q)[a[1]]]}function _Y(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function bY(e,t,r){e.l+=r&&r.biff==2?3:4}function SY(e,t,r){if(e.l++,r&&r.biff==12)return[e.read_shift(4,"i"),0];var n=e.read_shift(2),s=e.read_shift(r&&r.biff==2?1:2);return[n,s]}function kY(e){return e.l++,Pc[e.read_shift(1)]}function CY(e){return e.l++,e.read_shift(2)}function TY(e){return e.l++,e.read_shift(1)!==0}function EY(e){return e.l++,Ma(e)}function NY(e,t,r){return e.l++,Kp(e,t-1,r)}function AY(e,t){var r=[e.read_shift(1)];if(t==12)switch(r[0]){case 2:r[0]=4;break;case 4:r[0]=16;break;case 0:r[0]=1;break;case 1:r[0]=2;break}switch(r[0]){case 4:r[1]=ps(e,1)?"TRUE":"FALSE",t!=12&&(e.l+=7);break;case 37:case 16:r[1]=Pc[e[e.l]],e.l+=t==12?4:8;break;case 0:e.l+=8;break;case 1:r[1]=Ma(e);break;case 2:r[1]=Cf(e,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+r[0])}return r}function jY(e,t,r){for(var n=e.read_shift(r.biff==12?4:2),s=[],a=0;a!=n;++a)s.push((r.biff==12?kf:sv)(e));return s}function FY(e,t,r){var n=0,s=0;r.biff==12?(n=e.read_shift(4),s=e.read_shift(4)):(s=1+e.read_shift(1),n=1+e.read_shift(2)),r.biff>=2&&r.biff<8&&(--n,--s==0&&(s=256));for(var a=0,i=[];a!=n&&(i[a]=[]);++a)for(var l=0;l!=s;++l)i[a][l]=AY(e,r.biff);return i}function PY(e,t,r){var n=e.read_shift(1)>>>5&3,s=!r||r.biff>=8?4:2,a=e.read_shift(s);switch(r.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[n,0,a]}function RY(e,t,r){if(r.biff==5)return DY(e);var n=e.read_shift(1)>>>5&3,s=e.read_shift(2),a=e.read_shift(4);return[n,s,a]}function DY(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2,"i");e.l+=8;var n=e.read_shift(2);return e.l+=12,[t,r,n]}function IY(e,t,r){var n=e.read_shift(1)>>>5&3;e.l+=r&&r.biff==2?3:4;var s=e.read_shift(r&&r.biff==2?1:2);return[n,s]}function MY(e,t,r){var n=e.read_shift(1)>>>5&3,s=e.read_shift(r&&r.biff==2?1:2);return[n,s]}function OY(e,t,r){var n=e.read_shift(1)>>>5&3;return e.l+=4,r.biff<8&&e.l--,r.biff==12&&(e.l+=2),[n]}function LY(e,t,r){var n=(e[e.l++]&96)>>5,s=e.read_shift(2),a=4;if(r)switch(r.biff){case 5:a=15;break;case 12:a=6;break}return e.l+=a,[n,s]}var BY=Wa,UY=Wa,$Y=Wa;function Xp(e,t,r){return e.l+=2,[eY(e)]}function DS(e){return e.l+=6,[]}var WY=Xp,zY=DS,HY=DS,GY=Xp;function IF(e){return e.l+=2,[As(e),e.read_shift(2)&1]}var VY=Xp,KY=IF,qY=DS,XY=Xp,YY=Xp,QY=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function JY(e){e.l+=2;var t=e.read_shift(2),r=e.read_shift(2),n=e.read_shift(4),s=e.read_shift(2),a=e.read_shift(2),i=QY[r>>2&31];return{ixti:t,coltype:r&3,rt:i,idx:n,c:s,C:a}}function ZY(e){return e.l+=2,[e.read_shift(4)]}function eQ(e,t,r){return e.l+=5,e.l+=2,e.l+=r.biff==2?1:4,["PTGSHEET"]}function tQ(e,t,r){return e.l+=r.biff==2?4:5,["PTGENDSHEET"]}function rQ(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2);return[t,r]}function nQ(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2);return[t,r]}function sQ(e){return e.l+=4,[0,0]}var c3={1:{n:"PtgExp",f:SY},2:{n:"PtgTbl",f:$Y},3:{n:"PtgAdd",f:Es},4:{n:"PtgSub",f:Es},5:{n:"PtgMul",f:Es},6:{n:"PtgDiv",f:Es},7:{n:"PtgPower",f:Es},8:{n:"PtgConcat",f:Es},9:{n:"PtgLt",f:Es},10:{n:"PtgLe",f:Es},11:{n:"PtgEq",f:Es},12:{n:"PtgGe",f:Es},13:{n:"PtgGt",f:Es},14:{n:"PtgNe",f:Es},15:{n:"PtgIsect",f:Es},16:{n:"PtgUnion",f:Es},17:{n:"PtgRange",f:Es},18:{n:"PtgUplus",f:Es},19:{n:"PtgUminus",f:Es},20:{n:"PtgPercent",f:Es},21:{n:"PtgParen",f:Es},22:{n:"PtgMissArg",f:Es},23:{n:"PtgStr",f:NY},26:{n:"PtgSheet",f:eQ},27:{n:"PtgEndSheet",f:tQ},28:{n:"PtgErr",f:kY},29:{n:"PtgBool",f:TY},30:{n:"PtgInt",f:CY},31:{n:"PtgNum",f:EY},32:{n:"PtgArray",f:lY},33:{n:"PtgFunc",f:vY},34:{n:"PtgFuncVar",f:wY},35:{n:"PtgName",f:PY},36:{n:"PtgRef",f:pY},37:{n:"PtgArea",f:nY},38:{n:"PtgMemArea",f:IY},39:{n:"PtgMemErr",f:BY},40:{n:"PtgMemNoMem",f:UY},41:{n:"PtgMemFunc",f:MY},42:{n:"PtgRefErr",f:OY},43:{n:"PtgAreaErr",f:aY},44:{n:"PtgRefN",f:xY},45:{n:"PtgAreaN",f:oY},46:{n:"PtgMemAreaN",f:rQ},47:{n:"PtgMemNoMemN",f:nQ},57:{n:"PtgNameX",f:RY},58:{n:"PtgRef3d",f:yY},59:{n:"PtgArea3d",f:sY},60:{n:"PtgRefErr3d",f:LY},61:{n:"PtgAreaErr3d",f:iY},255:{}},aQ={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},iQ={1:{n:"PtgElfLel",f:IF},2:{n:"PtgElfRw",f:XY},3:{n:"PtgElfCol",f:WY},6:{n:"PtgElfRwV",f:YY},7:{n:"PtgElfColV",f:GY},10:{n:"PtgElfRadical",f:VY},11:{n:"PtgElfRadicalS",f:qY},13:{n:"PtgElfColS",f:zY},15:{n:"PtgElfColSV",f:HY},16:{n:"PtgElfRadicalLel",f:KY},25:{n:"PtgList",f:JY},29:{n:"PtgSxName",f:ZY},255:{}},oQ={0:{n:"PtgAttrNoop",f:sQ},1:{n:"PtgAttrSemi",f:hY},2:{n:"PtgAttrIf",f:dY},4:{n:"PtgAttrChoose",f:cY},8:{n:"PtgAttrGoto",f:uY},16:{n:"PtgAttrSum",f:bY},32:{n:"PtgAttrBaxcel",f:l3},33:{n:"PtgAttrBaxcel",f:l3},64:{n:"PtgAttrSpace",f:gY},65:{n:"PtgAttrSpaceSemi",f:mY},128:{n:"PtgAttrIfError",f:fY},255:{}};function Yp(e,t,r,n){if(n.biff<8)return Wa(e,t);for(var s=e.l+t,a=[],i=0;i!==r.length;++i)switch(r[i][0]){case"PtgArray":r[i][1]=FY(e,0,n),a.push(r[i][1]);break;case"PtgMemArea":r[i][2]=jY(e,r[i][1],n),a.push(r[i][2]);break;case"PtgExp":n&&n.biff==12&&(r[i][1][1]=e.read_shift(4),a.push(r[i][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+r[i][0]}return t=s-e.l,t!==0&&a.push(Wa(e,t)),a}function Qp(e,t,r){for(var n=e.l+t,s,a,i=[];n!=e.l;)t=n-e.l,a=e[e.l],s=c3[a]||c3[aQ[a]],(a===24||a===25)&&(s=(a===24?iQ:oQ)[e[e.l+1]]),!s||!s.f?Wa(e,t):i.push([s.n,s.f(e,t,r)]);return i}function lQ(e){for(var t=[],r=0;r<e.length;++r){for(var n=e[r],s=[],a=0;a<n.length;++a){var i=n[a];if(i)switch(i[0]){case 2:s.push('"'+i[1].replace(/"/g,'""')+'"');break;default:s.push(i[1])}else s.push("")}t.push(s.join(","))}return t.join(";")}var cQ={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function uQ(e,t){if(!e&&!(t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function MF(e,t,r){if(!e)return"SH33TJSERR0";if(r.biff>8&&(!e.XTI||!e.XTI[t]))return e.SheetNames[t];if(!e.XTI)return"SH33TJSERR6";var n=e.XTI[t];if(r.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),t==0?"":e.XTI[t-1];if(!n)return"SH33TJSERR1";var s="";if(r.biff>8)switch(e[n[0]][0]){case 357:return s=n[1]==-1?"#REF":e.SheetNames[n[1]],n[1]==n[2]?s:s+":"+e.SheetNames[n[2]];case 358:return r.SID!=null?e.SheetNames[r.SID]:"SH33TJSSAME"+e[n[0]][0];case 355:default:return"SH33TJSSRC"+e[n[0]][0]}switch(e[n[0]][0][0]){case 1025:return s=n[1]==-1?"#REF":e.SheetNames[n[1]]||"SH33TJSERR3",n[1]==n[2]?s:s+":"+e.SheetNames[n[2]];case 14849:return e[n[0]].slice(1).map(function(a){return a.Name}).join(";;");default:return e[n[0]][0][3]?(s=n[1]==-1?"#REF":e[n[0]][0][3][n[1]]||"SH33TJSERR4",n[1]==n[2]?s:s+":"+e[n[0]][0][3][n[2]]):"SH33TJSERR2"}}function u3(e,t,r){var n=MF(e,t,r);return n=="#REF"?n:uQ(n,r)}function Da(e,t,r,n,s){var a=s&&s.biff||8,i={s:{c:0,r:0}},l=[],c,d,f,p=0,g=0,y,v="";if(!e[0]||!e[0][0])return"";for(var _=-1,b="",E=0,k=e[0].length;E<k;++E){var w=e[0][E];switch(w[0]){case"PtgUminus":l.push("-"+l.pop());break;case"PtgUplus":l.push("+"+l.pop());break;case"PtgPercent":l.push(l.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(c=l.pop(),d=l.pop(),_>=0){switch(e[0][_][1][0]){case 0:b=as(" ",e[0][_][1][1]);break;case 1:b=as("\r",e[0][_][1][1]);break;default:if(b="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][_][1][0])}d=d+b,_=-1}l.push(d+cQ[w[0]]+c);break;case"PtgIsect":c=l.pop(),d=l.pop(),l.push(d+" "+c);break;case"PtgUnion":c=l.pop(),d=l.pop(),l.push(d+","+c);break;case"PtgRange":c=l.pop(),d=l.pop(),l.push(d+":"+c);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":f=Om(w[1][1],i,s),l.push(Lm(f,a));break;case"PtgRefN":f=r?Om(w[1][1],r,s):w[1][1],l.push(Lm(f,a));break;case"PtgRef3d":p=w[1][1],f=Om(w[1][2],i,s),v=u3(n,p,s),l.push(v+"!"+Lm(f,a));break;case"PtgFunc":case"PtgFuncVar":var N=w[1][0],A=w[1][1];N||(N=0),N&=127;var P=N==0?[]:l.slice(-N);l.length-=N,A==="User"&&(A=P.shift()),l.push(A+"("+P.join(",")+")");break;case"PtgBool":l.push(w[1]?"TRUE":"FALSE");break;case"PtgInt":l.push(w[1]);break;case"PtgNum":l.push(String(w[1]));break;case"PtgStr":l.push('"'+w[1].replace(/"/g,'""')+'"');break;case"PtgErr":l.push(w[1]);break;case"PtgAreaN":y=BN(w[1][1],r?{s:r}:i,s),l.push(Ww(y,s));break;case"PtgArea":y=BN(w[1][1],i,s),l.push(Ww(y,s));break;case"PtgArea3d":p=w[1][1],y=w[1][2],v=u3(n,p,s),l.push(v+"!"+Ww(y,s));break;case"PtgAttrSum":l.push("SUM("+l.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":g=w[1][2];var R=(n.names||[])[g-1]||(n[0]||[])[g],T=R?R.Name:"SH33TJSNAME"+String(g);T&&T.slice(0,6)=="_xlfn."&&!s.xlfn&&(T=T.slice(6)),l.push(T);break;case"PtgNameX":var D=w[1][1];g=w[1][2];var I;if(s.biff<=5)D<0&&(D=-D),n[D]&&(I=n[D][g]);else{var V="";if(((n[D]||[])[0]||[])[0]==14849||(((n[D]||[])[0]||[])[0]==1025?n[D][g]&&n[D][g].itab>0&&(V=n.SheetNames[n[D][g].itab-1]+"!"):V=n.SheetNames[g-1]+"!"),n[D]&&n[D][g])V+=n[D][g].Name;else if(n[0]&&n[0][g])V+=n[0][g].Name;else{var X=(MF(n,D,s)||"").split(";;");X[g-1]?V=X[g-1]:V+="SH33TJSERRX"}l.push(V);break}I||(I={Name:"SH33TJSERRY"}),l.push(I.Name);break;case"PtgParen":var Z="(",ie=")";if(_>=0){switch(b="",e[0][_][1][0]){case 2:Z=as(" ",e[0][_][1][1])+Z;break;case 3:Z=as("\r",e[0][_][1][1])+Z;break;case 4:ie=as(" ",e[0][_][1][1])+ie;break;case 5:ie=as("\r",e[0][_][1][1])+ie;break;default:if(s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][_][1][0])}_=-1}l.push(Z+l.pop()+ie);break;case"PtgRefErr":l.push("#REF!");break;case"PtgRefErr3d":l.push("#REF!");break;case"PtgExp":f={c:w[1][1],r:w[1][0]};var q={c:r.c,r:r.r};if(n.sharedf[br(f)]){var ne=n.sharedf[br(f)];l.push(Da(ne,i,q,n,s))}else{var M=!1;for(c=0;c!=n.arrayf.length;++c)if(d=n.arrayf[c],!(f.c<d[0].s.c||f.c>d[0].e.c)&&!(f.r<d[0].s.r||f.r>d[0].e.r)){l.push(Da(d[1],i,q,n,s)),M=!0;break}M||l.push(w[1])}break;case"PtgArray":l.push("{"+lQ(w[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":_=E;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":l.push("");break;case"PtgAreaErr":l.push("#REF!");break;case"PtgAreaErr3d":l.push("#REF!");break;case"PtgList":l.push("Table"+w[1].idx+"[#"+w[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(w));default:throw new Error("Unrecognized Formula Token: "+String(w))}var W=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(s.biff!=3&&_>=0&&W.indexOf(e[0][E][0])==-1){w=e[0][_];var L=!0;switch(w[1][0]){case 4:L=!1;case 0:b=as(" ",w[1][1]);break;case 5:L=!1;case 1:b=as("\r",w[1][1]);break;default:if(b="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+w[1][0])}l.push((L?b:"")+l.pop()+(L?"":b)),_=-1}}if(l.length>1&&s.WTF)throw new Error("bad formula stack");return l[0]}function dQ(e,t,r){var n=e.l+t,s=r.biff==2?1:2,a,i=e.read_shift(s);if(i==65535)return[[],Wa(e,t-2)];var l=Qp(e,i,r);return t!==i+s&&(a=Yp(e,t-i-s,l,r)),e.l=n,[l,a]}function fQ(e,t,r){var n=e.l+t,s=r.biff==2?1:2,a,i=e.read_shift(s);if(i==65535)return[[],Wa(e,t-2)];var l=Qp(e,i,r);return t!==i+s&&(a=Yp(e,t-i-s,l,r)),e.l=n,[l,a]}function hQ(e,t,r,n){var s=e.l+t,a=Qp(e,n,r),i;return s!==e.l&&(i=Yp(e,s-e.l,a,r)),[a,i]}function gQ(e,t,r){var n=e.l+t,s,a=e.read_shift(2),i=Qp(e,a,r);return a==65535?[[],Wa(e,t-2)]:(t!==a+2&&(s=Yp(e,n-a-2,i,r)),[i,s])}function mQ(e){var t;if(yc(e,e.l+6)!==65535)return[Ma(e),"n"];switch(e[e.l]){case 0:return e.l+=8,["String","s"];case 1:return t=e[e.l+2]===1,e.l+=8,[t,"b"];case 2:return t=e[e.l+2],e.l+=8,[t,"e"];case 3:return e.l+=8,["","s"]}return[]}function pQ(e){if(e==null){var t=wt(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}else if(typeof e=="number")return hf(e);return hf(0)}function Kw(e,t,r){var n=e.l+t,s=Il(e);r.biff==2&&++e.l;var a=mQ(e),i=e.read_shift(1);r.biff!=2&&(e.read_shift(1),r.biff>=5&&e.read_shift(4));var l=fQ(e,n-e.l,r);return{cell:s,val:a[0],formula:l,shared:i>>3&1,tt:a[1]}}function xQ(e,t,r,n,s){var a=mf(t,r,s),i=pQ(e.v),l=wt(6),c=33;l.write_shift(2,c),l.write_shift(4,0);for(var d=wt(e.bf.length),f=0;f<e.bf.length;++f)d[f]=e.bf[f];var p=ta([a,i,l,d]);return p}function av(e,t,r){var n=e.read_shift(4),s=Qp(e,n,r),a=e.read_shift(4),i=a>0?Yp(e,a,s,r):null;return[s,i]}var yQ=av,iv=av,vQ=av,wQ=av,_Q={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},OF={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},bQ={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function d3(e){return e.slice(0,3)=="of:"&&(e=e.slice(3)),e.charCodeAt(0)==61&&(e=e.slice(1),e.charCodeAt(0)==61&&(e=e.slice(1))),e=e.replace(/COM\.MICROSOFT\./g,""),e=e.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(t,r){return r.replace(/\./g,"")}),e=e.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),e.replace(/[;~]/g,",").replace(/\|/g,";")}function SQ(e){var t="of:="+e.replace(PS,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return t.replace(/;/g,"|").replace(/,/g,";")}function qw(e){var t=e.split(":"),r=t[0].split(".")[0];return[r,t[0].split(".")[1]+(t.length>1?":"+(t[1].split(".")[1]||t[1].split(".")[0]):"")]}function kQ(e){return e.replace(/\./,"!")}var Um={},t0={},$m=typeof Map<"u";function IS(e,t,r){var n=0,s=e.length;if(r){if($m?r.has(t):Object.prototype.hasOwnProperty.call(r,t)){for(var a=$m?r.get(t):r[t];n<a.length;++n)if(e[a[n]].t===t)return e.Count++,a[n]}}else for(;n<s;++n)if(e[n].t===t)return e.Count++,n;return e[s]={t},e.Count++,e.Unique++,r&&($m?(r.has(t)||r.set(t,[]),r.get(t).push(s)):(Object.prototype.hasOwnProperty.call(r,t)||(r[t]=[]),r[t].push(s))),s}function ov(e,t){var r={min:e+1,max:e+1},n=-1;return t.MDW&&(Ia=t.MDW),t.width!=null?r.customWidth=1:t.wpx!=null?n=xp(t.wpx):t.wch!=null&&(n=t.wch),n>-1?(r.width=Sy(n),r.customWidth=1):t.width!=null&&(r.width=t.width),t.hidden&&(r.hidden=!0),t.level!=null&&(r.outlineLevel=r.level=t.level),r}function Xd(e,t){if(e){var r=[.7,.7,.75,.75,.3,.3];t=="xlml"&&(r=[1,1,1,1,.5,.5]),e.left==null&&(e.left=r[0]),e.right==null&&(e.right=r[1]),e.top==null&&(e.top=r[2]),e.bottom==null&&(e.bottom=r[3]),e.header==null&&(e.header=r[4]),e.footer==null&&(e.footer=r[5])}}function Ju(e,t,r){var n=r.revssf[t.z!=null?t.z:"General"],s=60,a=e.length;if(n==null&&r.ssf){for(;s<392;++s)if(r.ssf[s]==null){_c(t.z,s),r.ssf[s]=t.z,r.revssf[t.z]=n=s;break}}for(s=0;s!=a;++s)if(e[s].numFmtId===n)return s;return e[a]={numFmtId:n,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},a}function LF(e,t,r,n,s,a){try{n.cellNF&&(e.z=wr[t])}catch(l){if(n.WTF)throw l}if(!(e.t==="z"&&!n.cellStyles)){if(e.t==="d"&&typeof e.v=="string"&&(e.v=On(e.v)),(!n||n.cellText!==!1)&&e.t!=="z")try{if(wr[t]==null&&_c(_H[t]||"General",t),e.t==="e")e.w=e.w||Pc[e.v];else if(t===0)if(e.t==="n")(e.v|0)===e.v?e.w=e.v.toString(10):e.w=up(e.v);else if(e.t==="d"){var i=zs(e.v);(i|0)===i?e.w=i.toString(10):e.w=up(i)}else{if(e.v===void 0)return"";e.w=df(e.v,t0)}else e.t==="d"?e.w=vo(t,zs(e.v),t0):e.w=vo(t,e.v,t0)}catch(l){if(n.WTF)throw l}if(n.cellStyles&&r!=null)try{e.s=a.Fills[r],e.s.fgColor&&e.s.fgColor.theme&&!e.s.fgColor.rgb&&(e.s.fgColor.rgb=by(s.themeElements.clrScheme[e.s.fgColor.theme].rgb,e.s.fgColor.tint||0),n.WTF&&(e.s.fgColor.raw_rgb=s.themeElements.clrScheme[e.s.fgColor.theme].rgb)),e.s.bgColor&&e.s.bgColor.theme&&(e.s.bgColor.rgb=by(s.themeElements.clrScheme[e.s.bgColor.theme].rgb,e.s.bgColor.tint||0),n.WTF&&(e.s.bgColor.raw_rgb=s.themeElements.clrScheme[e.s.bgColor.theme].rgb))}catch(l){if(n.WTF&&a.Fills)throw l}}}function CQ(e,t,r){if(e&&e["!ref"]){var n=Jr(e["!ref"]);if(n.e.c<n.s.c||n.e.r<n.s.r)throw new Error("Bad range ("+r+"): "+e["!ref"])}}function TQ(e,t){var r=Jr(t);r.s.r<=r.e.r&&r.s.c<=r.e.c&&r.s.r>=0&&r.s.c>=0&&(e["!ref"]=Rr(r))}var EQ=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,NQ=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,AQ=/<(?:\w:)?hyperlink [^>]*>/mg,jQ=/"(\w*:\w*)"/,FQ=/<(?:\w:)?col\b[^>]*[\/]?>/g,PQ=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,RQ=/<(?:\w:)?pageMargins[^>]*\/>/g,BF=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,DQ=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,IQ=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function MQ(e,t,r,n,s,a,i){if(!e)return e;n||(n={"!id":{}});var l=t.dense?[]:{},c={s:{r:2e6,c:2e6},e:{r:0,c:0}},d="",f="",p=e.match(NQ);p?(d=e.slice(0,p.index),f=e.slice(p.index+p[0].length)):d=f=e;var g=d.match(BF);g?MS(g[0],l,s,r):(g=d.match(DQ))&&LQ(g[0],g[1]||"",l,s,r);var y=(d.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(y>0){var v=d.slice(y,y+50).match(jQ);v&&TQ(l,v[1])}var _=d.match(IQ);_&&_[1]&&QQ(_[1],s);var b=[];if(t.cellStyles){var E=d.match(FQ);E&&VQ(b,E)}p&&eJ(p[1],l,t,c,a,i);var k=f.match(PQ);k&&(l["!autofilter"]=qQ(k[0]));var w=[],N=f.match(EQ);if(N)for(y=0;y!=N.length;++y)w[y]=Jr(N[y].slice(N[y].indexOf('"')+1));var A=f.match(AQ);A&&zQ(l,A,n);var P=f.match(RQ);if(P&&(l["!margins"]=HQ(kr(P[0]))),!l["!ref"]&&c.e.c>=c.s.c&&c.e.r>=c.s.r&&(l["!ref"]=Rr(c)),t.sheetRows>0&&l["!ref"]){var R=Jr(l["!ref"]);t.sheetRows<=+R.e.r&&(R.e.r=t.sheetRows-1,R.e.r>c.e.r&&(R.e.r=c.e.r),R.e.r<R.s.r&&(R.s.r=R.e.r),R.e.c>c.e.c&&(R.e.c=c.e.c),R.e.c<R.s.c&&(R.s.c=R.e.c),l["!fullref"]=l["!ref"],l["!ref"]=Rr(R))}return b.length>0&&(l["!cols"]=b),w.length>0&&(l["!merges"]=w),l}function OQ(e){if(e.length===0)return"";for(var t='<mergeCells count="'+e.length+'">',r=0;r!=e.length;++r)t+='<mergeCell ref="'+Rr(e[r])+'"/>';return t+"</mergeCells>"}function MS(e,t,r,n){var s=kr(e);r.Sheets[n]||(r.Sheets[n]={}),s.codeName&&(r.Sheets[n].CodeName=Qr(bn(s.codeName)))}function LQ(e,t,r,n,s){MS(e.slice(0,e.indexOf(">")),r,n,s)}function BQ(e,t,r,n,s){var a=!1,i={},l=null;if(n.bookType!=="xlsx"&&t.vbaraw){var c=t.SheetNames[r];try{t.Workbook&&(c=t.Workbook.Sheets[r].CodeName||c)}catch{}a=!0,i.codeName=Tl(pn(c))}if(e&&e["!outline"]){var d={summaryBelow:1,summaryRight:1};e["!outline"].above&&(d.summaryBelow=0),e["!outline"].left&&(d.summaryRight=0),l=(l||"")+Gt("outlinePr",null,d)}!a&&!l||(s[s.length]=Gt("sheetPr",l,i))}var UQ=["objects","scenarios","selectLockedCells","selectUnlockedCells"],$Q=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function WQ(e){var t={sheet:1};return UQ.forEach(function(r){e[r]!=null&&e[r]&&(t[r]="1")}),$Q.forEach(function(r){e[r]!=null&&!e[r]&&(t[r]="0")}),e.password&&(t.password=AS(e.password).toString(16).toUpperCase()),Gt("sheetProtection",null,t)}function zQ(e,t,r){for(var n=Array.isArray(e),s=0;s!=t.length;++s){var a=kr(bn(t[s]),!0);if(!a.ref)return;var i=((r||{})["!id"]||[])[a.id];i?(a.Target=i.Target,a.location&&(a.Target+="#"+Qr(a.location))):(a.Target="#"+Qr(a.location),i={Target:a.Target,TargetMode:"Internal"}),a.Rel=i,a.tooltip&&(a.Tooltip=a.tooltip,delete a.tooltip);for(var l=Jr(a.ref),c=l.s.r;c<=l.e.r;++c)for(var d=l.s.c;d<=l.e.c;++d){var f=br({c:d,r:c});n?(e[c]||(e[c]=[]),e[c][d]||(e[c][d]={t:"z",v:void 0}),e[c][d].l=a):(e[f]||(e[f]={t:"z",v:void 0}),e[f].l=a)}}}function HQ(e){var t={};return["left","right","top","bottom","header","footer"].forEach(function(r){e[r]&&(t[r]=parseFloat(e[r]))}),t}function GQ(e){return Xd(e),Gt("pageMargins",null,e)}function VQ(e,t){for(var r=!1,n=0;n!=t.length;++n){var s=kr(t[n],!0);s.hidden&&(s.hidden=Rn(s.hidden));var a=parseInt(s.min,10)-1,i=parseInt(s.max,10)-1;for(s.outlineLevel&&(s.level=+s.outlineLevel||0),delete s.min,delete s.max,s.width=+s.width,!r&&s.width&&(r=!0,jS(s.width)),Uu(s);a<=i;)e[a++]=Ln(s)}}function KQ(e,t){for(var r=["<cols>"],n,s=0;s!=t.length;++s)(n=t[s])&&(r[r.length]=Gt("col",null,ov(s,n)));return r[r.length]="</cols>",r.join("")}function qQ(e){var t={ref:(e.match(/ref="([^"]*)"/)||[])[1]};return t}function XQ(e,t,r,n){var s=typeof e.ref=="string"?e.ref:Rr(e.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var a=r.Workbook.Names,i=Ti(s);i.s.r==i.e.r&&(i.e.r=Ti(t["!ref"]).e.r,s=Rr(i));for(var l=0;l<a.length;++l){var c=a[l];if(c.Name=="_xlnm._FilterDatabase"&&c.Sheet==n){c.Ref="'"+r.SheetNames[n]+"'!"+s;break}}return l==a.length&&a.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+r.SheetNames[n]+"'!"+s}),Gt("autoFilter",null,{ref:s})}var YQ=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function QQ(e,t){t.Views||(t.Views=[{}]),(e.match(YQ)||[]).forEach(function(r,n){var s=kr(r);t.Views[n]||(t.Views[n]={}),+s.zoomScale&&(t.Views[n].zoom=+s.zoomScale),Rn(s.rightToLeft)&&(t.Views[n].RTL=!0)})}function JQ(e,t,r,n){var s={workbookViewId:"0"};return(((n||{}).Workbook||{}).Views||[])[0]&&(s.rightToLeft=n.Workbook.Views[0].RTL?"1":"0"),Gt("sheetViews",Gt("sheetView",null,s),{})}function ZQ(e,t,r,n){if(e.c&&r["!comments"].push([t,e.c]),e.v===void 0&&typeof e.f!="string"||e.t==="z"&&!e.f)return"";var s="",a=e.t,i=e.v;if(e.t!=="z")switch(e.t){case"b":s=e.v?"1":"0";break;case"n":s=""+e.v;break;case"e":s=Pc[e.v];break;case"d":n&&n.cellDates?s=On(e.v,-1).toISOString():(e=Ln(e),e.t="n",s=""+(e.v=zs(On(e.v)))),typeof e.z>"u"&&(e.z=wr[14]);break;default:s=e.v;break}var l=_a("v",pn(s)),c={r:t},d=Ju(n.cellXfs,e,n);switch(d!==0&&(c.s=d),e.t){case"n":break;case"d":c.t="d";break;case"b":c.t="b";break;case"e":c.t="e";break;case"z":break;default:if(e.v==null){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(n&&n.bookSST){l=_a("v",""+IS(n.Strings,e.v,n.revStrings)),c.t="s";break}c.t="str";break}if(e.t!=a&&(e.t=a,e.v=i),typeof e.f=="string"&&e.f){var f=e.F&&e.F.slice(0,t.length)==t?{t:"array",ref:e.F}:null;l=Gt("f",pn(e.f),f)+(e.v!=null?l:"")}return e.l&&r["!links"].push([t,e.l]),e.D&&(c.cm=1),Gt("c",l,c)}var eJ=(function(){var e=/<(?:\w+:)?c[ \/>]/,t=/<\/(?:\w+:)?row>/,r=/r=["']([^"']*)["']/,n=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,s=/ref=["']([^"']*)["']/,a=dp("v"),i=dp("f");return function(c,d,f,p,g,y){for(var v=0,_="",b=[],E=[],k=0,w=0,N=0,A="",P,R,T=0,D=0,I,V,X=0,Z=0,ie=Array.isArray(y.CellXf),q,ne=[],M=[],W=Array.isArray(d),L=[],H={},K=!1,B=!!f.sheetStubs,z=c.split(t),Q=0,Y=z.length;Q!=Y;++Q){_=z[Q].trim();var te=_.length;if(te!==0){var ee=0;e:for(v=0;v<te;++v)switch(_[v]){case">":if(_[v-1]!="/"){++v;break e}if(f&&f.cellStyles){if(R=kr(_.slice(ee,v),!0),T=R.r!=null?parseInt(R.r,10):T+1,D=-1,f.sheetRows&&f.sheetRows<T)continue;H={},K=!1,R.ht&&(K=!0,H.hpt=parseFloat(R.ht),H.hpx=h0(H.hpt)),R.hidden=="1"&&(K=!0,H.hidden=!0),R.outlineLevel!=null&&(K=!0,H.level=+R.outlineLevel),K&&(L[T-1]=H)}break;case"<":ee=v;break}if(ee>=v)break;if(R=kr(_.slice(ee,v),!0),T=R.r!=null?parseInt(R.r,10):T+1,D=-1,!(f.sheetRows&&f.sheetRows<T)){p.s.r>T-1&&(p.s.r=T-1),p.e.r<T-1&&(p.e.r=T-1),f&&f.cellStyles&&(H={},K=!1,R.ht&&(K=!0,H.hpt=parseFloat(R.ht),H.hpx=h0(H.hpt)),R.hidden=="1"&&(K=!0,H.hidden=!0),R.outlineLevel!=null&&(K=!0,H.level=+R.outlineLevel),K&&(L[T-1]=H)),b=_.slice(v).split(e);for(var ae=0;ae!=b.length&&b[ae].trim().charAt(0)=="<";++ae);for(b=b.slice(ae),v=0;v!=b.length;++v)if(_=b[v].trim(),_.length!==0){if(E=_.match(r),k=v,w=0,N=0,_="<c "+(_.slice(0,1)=="<"?">":"")+_,E!=null&&E.length===2){for(k=0,A=E[1],w=0;w!=A.length&&!((N=A.charCodeAt(w)-64)<1||N>26);++w)k=26*k+N;--k,D=k}else++D;for(w=0;w!=_.length&&_.charCodeAt(w)!==62;++w);if(++w,R=kr(_.slice(0,w),!0),R.r||(R.r=br({r:T-1,c:D})),A=_.slice(w),P={t:""},(E=A.match(a))!=null&&E[1]!==""&&(P.v=Qr(E[1])),f.cellFormula){if((E=A.match(i))!=null&&E[1]!==""){if(P.f=Qr(bn(E[1])).replace(/\r\n/g,`
`),f.xlfn||(P.f=o3(P.f)),E[0].indexOf('t="array"')>-1)P.F=(A.match(s)||[])[1],P.F.indexOf(":")>-1&&ne.push([Jr(P.F),P.F]);else if(E[0].indexOf('t="shared"')>-1){V=kr(E[0]);var ge=Qr(bn(E[1]));f.xlfn||(ge=o3(ge)),M[parseInt(V.si,10)]=[V,ge,R.r]}}else(E=A.match(/<f[^>]*\/>/))&&(V=kr(E[0]),M[V.si]&&(P.f=YX(M[V.si][1],M[V.si][2],R.r)));var _e=qn(R.r);for(w=0;w<ne.length;++w)_e.r>=ne[w][0].s.r&&_e.r<=ne[w][0].e.r&&_e.c>=ne[w][0].s.c&&_e.c<=ne[w][0].e.c&&(P.F=ne[w][1])}if(R.t==null&&P.v===void 0)if(P.f||P.F)P.v=0,P.t="n";else if(B)P.t="z";else continue;else P.t=R.t||"n";switch(p.s.c>D&&(p.s.c=D),p.e.c<D&&(p.e.c=D),P.t){case"n":if(P.v==""||P.v==null){if(!B)continue;P.t="z"}else P.v=parseFloat(P.v);break;case"s":if(typeof P.v>"u"){if(!B)continue;P.t="z"}else I=Um[parseInt(P.v,10)],P.v=I.t,P.r=I.r,f.cellHTML&&(P.h=I.h);break;case"str":P.t="s",P.v=P.v!=null?bn(P.v):"",f.cellHTML&&(P.h=gS(P.v));break;case"inlineStr":E=A.match(n),P.t="s",E!=null&&(I=NS(E[1]))?(P.v=I.t,f.cellHTML&&(P.h=I.h)):P.v="";break;case"b":P.v=Rn(P.v);break;case"d":f.cellDates?P.v=On(P.v,1):(P.v=zs(On(P.v,1)),P.t="n");break;case"e":(!f||f.cellText!==!1)&&(P.w=P.v),P.v=$8[P.v];break}if(X=Z=0,q=null,ie&&R.s!==void 0&&(q=y.CellXf[R.s],q!=null&&(q.numFmtId!=null&&(X=q.numFmtId),f.cellStyles&&q.fillId!=null&&(Z=q.fillId))),LF(P,X,Z,f,g,y),f.cellDates&&ie&&P.t=="n"&&j0(wr[X])&&(P.t="d",P.v=nv(P.v)),R.cm&&f.xlmeta){var Me=(f.xlmeta.Cell||[])[+R.cm-1];Me&&Me.type=="XLDAPR"&&(P.D=!0)}if(W){var ue=qn(R.r);d[ue.r]||(d[ue.r]=[]),d[ue.r][ue.c]=P}else d[R.r]=P}}}}L.length>0&&(d["!rows"]=L)}})();function tJ(e,t,r,n){var s=[],a=[],i=Jr(e["!ref"]),l="",c,d="",f=[],p=0,g=0,y=e["!rows"],v=Array.isArray(e),_={r:d},b,E=-1;for(g=i.s.c;g<=i.e.c;++g)f[g]=Kn(g);for(p=i.s.r;p<=i.e.r;++p){for(a=[],d=ys(p),g=i.s.c;g<=i.e.c;++g){c=f[g]+d;var k=v?(e[p]||[])[g]:e[c];k!==void 0&&(l=ZQ(k,c,e,t))!=null&&a.push(l)}(a.length>0||y&&y[p])&&(_={r:d},y&&y[p]&&(b=y[p],b.hidden&&(_.hidden=1),E=-1,b.hpx?E=yp(b.hpx):b.hpt&&(E=b.hpt),E>-1&&(_.ht=E,_.customHeight=1),b.level&&(_.outlineLevel=b.level)),s[s.length]=Gt("row",a.join(""),_))}if(y)for(;p<y.length;++p)y&&y[p]&&(_={r:p+1},b=y[p],b.hidden&&(_.hidden=1),E=-1,b.hpx?E=yp(b.hpx):b.hpt&&(E=b.hpt),E>-1&&(_.ht=E,_.customHeight=1),b.level&&(_.outlineLevel=b.level),s[s.length]=Gt("row","",_));return s.join("")}function UF(e,t,r,n){var s=[ws,Gt("worksheet",null,{xmlns:wf[0],"xmlns:r":$s.r})],a=r.SheetNames[e],i=0,l="",c=r.Sheets[a];c==null&&(c={});var d=c["!ref"]||"A1",f=Jr(d);if(f.e.c>16383||f.e.r>1048575){if(t.WTF)throw new Error("Range "+d+" exceeds format limit A1:XFD1048576");f.e.c=Math.min(f.e.c,16383),f.e.r=Math.min(f.e.c,1048575),d=Rr(f)}n||(n={}),c["!comments"]=[];var p=[];BQ(c,r,e,t,s),s[s.length]=Gt("dimension",null,{ref:d}),s[s.length]=JQ(c,t,e,r),t.sheetFormat&&(s[s.length]=Gt("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),c["!cols"]!=null&&c["!cols"].length>0&&(s[s.length]=KQ(c,c["!cols"])),s[i=s.length]="<sheetData/>",c["!links"]=[],c["!ref"]!=null&&(l=tJ(c,t),l.length>0&&(s[s.length]=l)),s.length>i+1&&(s[s.length]="</sheetData>",s[i]=s[i].replace("/>",">")),c["!protect"]&&(s[s.length]=WQ(c["!protect"])),c["!autofilter"]!=null&&(s[s.length]=XQ(c["!autofilter"],c,r,e)),c["!merges"]!=null&&c["!merges"].length>0&&(s[s.length]=OQ(c["!merges"]));var g=-1,y,v=-1;return c["!links"].length>0&&(s[s.length]="<hyperlinks>",c["!links"].forEach(function(_){_[1].Target&&(y={ref:_[0]},_[1].Target.charAt(0)!="#"&&(v=mn(n,-1,pn(_[1].Target).replace(/#.*$/,""),Wr.HLINK),y["r:id"]="rId"+v),(g=_[1].Target.indexOf("#"))>-1&&(y.location=pn(_[1].Target.slice(g+1))),_[1].Tooltip&&(y.tooltip=pn(_[1].Tooltip)),s[s.length]=Gt("hyperlink",null,y))}),s[s.length]="</hyperlinks>"),delete c["!links"],c["!margins"]!=null&&(s[s.length]=GQ(c["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&(s[s.length]=_a("ignoredErrors",Gt("ignoredError",null,{numberStoredAsText:1,sqref:d}))),p.length>0&&(v=mn(n,-1,"../drawings/drawing"+(e+1)+".xml",Wr.DRAW),s[s.length]=Gt("drawing",null,{"r:id":"rId"+v}),c["!drawing"]=p),c["!comments"].length>0&&(v=mn(n,-1,"../drawings/vmlDrawing"+(e+1)+".vml",Wr.VML),s[s.length]=Gt("legacyDrawing",null,{"r:id":"rId"+v}),c["!legacy"]=v),s.length>1&&(s[s.length]="</worksheet>",s[1]=s[1].replace("/>",">")),s.join("")}function rJ(e,t){var r={},n=e.l+t;r.r=e.read_shift(4),e.l+=4;var s=e.read_shift(2);e.l+=1;var a=e.read_shift(1);return e.l=n,a&7&&(r.level=a&7),a&16&&(r.hidden=!0),a&32&&(r.hpt=s/20),r}function nJ(e,t,r){var n=wt(145),s=(r["!rows"]||[])[e]||{};n.write_shift(4,e),n.write_shift(4,0);var a=320;s.hpx?a=yp(s.hpx)*20:s.hpt&&(a=s.hpt*20),n.write_shift(2,a),n.write_shift(1,0);var i=0;s.level&&(i|=s.level),s.hidden&&(i|=16),(s.hpx||s.hpt)&&(i|=32),n.write_shift(1,i),n.write_shift(1,0);var l=0,c=n.l;n.l+=4;for(var d={r:e,c:0},f=0;f<16;++f)if(!(t.s.c>f+1<<10||t.e.c<f<<10)){for(var p=-1,g=-1,y=f<<10;y<f+1<<10;++y){d.c=y;var v=Array.isArray(r)?(r[d.r]||[])[d.c]:r[br(d)];v&&(p<0&&(p=y),g=y)}p<0||(++l,n.write_shift(4,p),n.write_shift(4,g))}var _=n.l;return n.l=c,n.write_shift(4,l),n.l=_,n.length>n.l?n.slice(0,n.l):n}function sJ(e,t,r,n){var s=nJ(n,r,t);(s.length>17||(t["!rows"]||[])[n])&&Tt(e,0,s)}var aJ=kf,iJ=R0;function oJ(){}function lJ(e,t){var r={},n=e[e.l];return++e.l,r.above=!(n&64),r.left=!(n&128),e.l+=18,r.name=dG(e),r}function cJ(e,t,r){r==null&&(r=wt(84+4*e.length));var n=192;t&&(t.above&&(n&=-65),t.left&&(n&=-129)),r.write_shift(1,n);for(var s=1;s<3;++s)r.write_shift(1,0);return vy({auto:1},r),r.write_shift(-4,-1),r.write_shift(-4,-1),M8(e,r),r.slice(0,r.l)}function uJ(e){var t=wo(e);return[t]}function dJ(e,t,r){return r==null&&(r=wt(8)),_f(t,r)}function fJ(e){var t=bf(e);return[t]}function hJ(e,t,r){return r==null&&(r=wt(4)),Sf(t,r)}function gJ(e){var t=wo(e),r=e.read_shift(1);return[t,r,"b"]}function mJ(e,t,r){return r==null&&(r=wt(9)),_f(t,r),r.write_shift(1,e.v?1:0),r}function pJ(e){var t=bf(e),r=e.read_shift(1);return[t,r,"b"]}function xJ(e,t,r){return r==null&&(r=wt(5)),Sf(t,r),r.write_shift(1,e.v?1:0),r}function yJ(e){var t=wo(e),r=e.read_shift(1);return[t,r,"e"]}function vJ(e,t,r){return r==null&&(r=wt(9)),_f(t,r),r.write_shift(1,e.v),r}function wJ(e){var t=bf(e),r=e.read_shift(1);return[t,r,"e"]}function _J(e,t,r){return r==null&&(r=wt(8)),Sf(t,r),r.write_shift(1,e.v),r.write_shift(2,0),r.write_shift(1,0),r}function bJ(e){var t=wo(e),r=e.read_shift(4);return[t,r,"s"]}function SJ(e,t,r){return r==null&&(r=wt(12)),_f(t,r),r.write_shift(4,t.v),r}function kJ(e){var t=bf(e),r=e.read_shift(4);return[t,r,"s"]}function CJ(e,t,r){return r==null&&(r=wt(8)),Sf(t,r),r.write_shift(4,t.v),r}function TJ(e){var t=wo(e),r=Ma(e);return[t,r,"n"]}function EJ(e,t,r){return r==null&&(r=wt(16)),_f(t,r),hf(e.v,r),r}function $F(e){var t=bf(e),r=Ma(e);return[t,r,"n"]}function NJ(e,t,r){return r==null&&(r=wt(12)),Sf(t,r),hf(e.v,r),r}function AJ(e){var t=wo(e),r=SS(e);return[t,r,"n"]}function jJ(e,t,r){return r==null&&(r=wt(12)),_f(t,r),O8(e.v,r),r}function FJ(e){var t=bf(e),r=SS(e);return[t,r,"n"]}function PJ(e,t,r){return r==null&&(r=wt(8)),Sf(t,r),O8(e.v,r),r}function RJ(e){var t=wo(e),r=wS(e);return[t,r,"is"]}function DJ(e){var t=wo(e),r=Ua(e);return[t,r,"str"]}function IJ(e,t,r){return r==null&&(r=wt(12+4*e.v.length)),_f(t,r),na(e.v,r),r.length>r.l?r.slice(0,r.l):r}function MJ(e){var t=bf(e),r=Ua(e);return[t,r,"str"]}function OJ(e,t,r){return r==null&&(r=wt(8+4*e.v.length)),Sf(t,r),na(e.v,r),r.length>r.l?r.slice(0,r.l):r}function LJ(e,t,r){var n=e.l+t,s=wo(e);s.r=r["!row"];var a=e.read_shift(1),i=[s,a,"b"];if(r.cellFormula){e.l+=2;var l=iv(e,n-e.l,r);i[3]=Da(l,null,s,r.supbooks,r)}else e.l=n;return i}function BJ(e,t,r){var n=e.l+t,s=wo(e);s.r=r["!row"];var a=e.read_shift(1),i=[s,a,"e"];if(r.cellFormula){e.l+=2;var l=iv(e,n-e.l,r);i[3]=Da(l,null,s,r.supbooks,r)}else e.l=n;return i}function UJ(e,t,r){var n=e.l+t,s=wo(e);s.r=r["!row"];var a=Ma(e),i=[s,a,"n"];if(r.cellFormula){e.l+=2;var l=iv(e,n-e.l,r);i[3]=Da(l,null,s,r.supbooks,r)}else e.l=n;return i}function $J(e,t,r){var n=e.l+t,s=wo(e);s.r=r["!row"];var a=Ua(e),i=[s,a,"str"];if(r.cellFormula){e.l+=2;var l=iv(e,n-e.l,r);i[3]=Da(l,null,s,r.supbooks,r)}else e.l=n;return i}var WJ=kf,zJ=R0;function HJ(e,t){return t==null&&(t=wt(4)),t.write_shift(4,e),t}function GJ(e,t){var r=e.l+t,n=kf(e),s=_S(e),a=Ua(e),i=Ua(e),l=Ua(e);e.l=r;var c={rfx:n,relId:s,loc:a,display:l};return i&&(c.Tooltip=i),c}function VJ(e,t){var r=wt(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));R0({s:qn(e[0]),e:qn(e[0])},r),bS("rId"+t,r);var n=e[1].Target.indexOf("#"),s=n==-1?"":e[1].Target.slice(n+1);return na(s||"",r),na(e[1].Tooltip||"",r),na("",r),r.slice(0,r.l)}function KJ(){}function qJ(e,t,r){var n=e.l+t,s=L8(e),a=e.read_shift(1),i=[s];if(i[2]=a,r.cellFormula){var l=yQ(e,n-e.l,r);i[1]=l}else e.l=n;return i}function XJ(e,t,r){var n=e.l+t,s=kf(e),a=[s];if(r.cellFormula){var i=wQ(e,n-e.l,r);a[1]=i,e.l=n}else e.l=n;return a}function YJ(e,t,r){r==null&&(r=wt(18));var n=ov(e,t);r.write_shift(-4,e),r.write_shift(-4,e),r.write_shift(4,(n.width||10)*256),r.write_shift(4,0);var s=0;return t.hidden&&(s|=1),typeof n.width=="number"&&(s|=2),t.level&&(s|=t.level<<8),r.write_shift(2,s),r}var WF=["left","right","top","bottom","header","footer"];function QJ(e){var t={};return WF.forEach(function(r){t[r]=Ma(e)}),t}function JJ(e,t){return t==null&&(t=wt(48)),Xd(e),WF.forEach(function(r){hf(e[r],t)}),t}function ZJ(e){var t=e.read_shift(2);return e.l+=28,{RTL:t&32}}function eZ(e,t,r){r==null&&(r=wt(30));var n=924;return(((t||{}).Views||[])[0]||{}).RTL&&(n|=32),r.write_shift(2,n),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,100),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(4,0),r}function tZ(e){var t=wt(24);return t.write_shift(4,4),t.write_shift(4,1),R0(e,t),t}function rZ(e,t){return t==null&&(t=wt(66)),t.write_shift(2,e.password?AS(e.password):0),t.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(r){r[1]?t.write_shift(4,e[r[0]]!=null&&!e[r[0]]?1:0):t.write_shift(4,e[r[0]]!=null&&e[r[0]]?0:1)}),t}function nZ(){}function sZ(){}function aZ(e,t,r,n,s,a,i){if(!e)return e;var l=t||{};n||(n={"!id":{}});var c=l.dense?[]:{},d,f={s:{r:2e6,c:2e6},e:{r:0,c:0}},p=!1,g=!1,y,v,_,b,E,k,w,N,A,P=[];l.biff=12,l["!row"]=0;var R=0,T=!1,D=[],I={},V=l.supbooks||s.supbooks||[[]];if(V.sharedf=I,V.arrayf=D,V.SheetNames=s.SheetNames||s.Sheets.map(function(W){return W.name}),!l.supbooks&&(l.supbooks=V,s.Names))for(var X=0;X<s.Names.length;++X)V[0][X+1]=s.Names[X];var Z=[],ie=[],q=!1;vp[16]={n:"BrtShortReal",f:$F};var ne;if(Fc(e,function(L,H,K){if(!g)switch(K){case 148:d=L;break;case 0:y=L,l.sheetRows&&l.sheetRows<=y.r&&(g=!0),N=ys(b=y.r),l["!row"]=y.r,(L.hidden||L.hpt||L.level!=null)&&(L.hpt&&(L.hpx=h0(L.hpt)),ie[L.r]=L);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(v={t:L[2]},L[2]){case"n":v.v=L[1];break;case"s":w=Um[L[1]],v.v=w.t,v.r=w.r;break;case"b":v.v=!!L[1];break;case"e":v.v=L[1],l.cellText!==!1&&(v.w=Pc[v.v]);break;case"str":v.t="s",v.v=L[1];break;case"is":v.t="s",v.v=L[1].t;break}if((_=i.CellXf[L[0].iStyleRef])&&LF(v,_.numFmtId,null,l,a,i),E=L[0].c==-1?E+1:L[0].c,l.dense?(c[b]||(c[b]=[]),c[b][E]=v):c[Kn(E)+N]=v,l.cellFormula){for(T=!1,R=0;R<D.length;++R){var B=D[R];y.r>=B[0].s.r&&y.r<=B[0].e.r&&E>=B[0].s.c&&E<=B[0].e.c&&(v.F=Rr(B[0]),T=!0)}!T&&L.length>3&&(v.f=L[3])}if(f.s.r>y.r&&(f.s.r=y.r),f.s.c>E&&(f.s.c=E),f.e.r<y.r&&(f.e.r=y.r),f.e.c<E&&(f.e.c=E),l.cellDates&&_&&v.t=="n"&&j0(wr[_.numFmtId])){var z=Bd(v.v);z&&(v.t="d",v.v=new Date(z.y,z.m-1,z.d,z.H,z.M,z.S,z.u))}ne&&(ne.type=="XLDAPR"&&(v.D=!0),ne=void 0);break;case 1:case 12:if(!l.sheetStubs||p)break;v={t:"z",v:void 0},E=L[0].c==-1?E+1:L[0].c,l.dense?(c[b]||(c[b]=[]),c[b][E]=v):c[Kn(E)+N]=v,f.s.r>y.r&&(f.s.r=y.r),f.s.c>E&&(f.s.c=E),f.e.r<y.r&&(f.e.r=y.r),f.e.c<E&&(f.e.c=E),ne&&(ne.type=="XLDAPR"&&(v.D=!0),ne=void 0);break;case 176:P.push(L);break;case 49:ne=((l.xlmeta||{}).Cell||[])[L-1];break;case 494:var Q=n["!id"][L.relId];for(Q?(L.Target=Q.Target,L.loc&&(L.Target+="#"+L.loc),L.Rel=Q):L.relId==""&&(L.Target="#"+L.loc),b=L.rfx.s.r;b<=L.rfx.e.r;++b)for(E=L.rfx.s.c;E<=L.rfx.e.c;++E)l.dense?(c[b]||(c[b]=[]),c[b][E]||(c[b][E]={t:"z",v:void 0}),c[b][E].l=L):(k=br({c:E,r:b}),c[k]||(c[k]={t:"z",v:void 0}),c[k].l=L);break;case 426:if(!l.cellFormula)break;D.push(L),A=l.dense?c[b][E]:c[Kn(E)+N],A.f=Da(L[1],f,{r:y.r,c:E},V,l),A.F=Rr(L[0]);break;case 427:if(!l.cellFormula)break;I[br(L[0].s)]=L[1],A=l.dense?c[b][E]:c[Kn(E)+N],A.f=Da(L[1],f,{r:y.r,c:E},V,l);break;case 60:if(!l.cellStyles)break;for(;L.e>=L.s;)Z[L.e--]={width:L.w/256,hidden:!!(L.flags&1),level:L.level},q||(q=!0,jS(L.w/256)),Uu(Z[L.e+1]);break;case 161:c["!autofilter"]={ref:Rr(L)};break;case 476:c["!margins"]=L;break;case 147:s.Sheets[r]||(s.Sheets[r]={}),L.name&&(s.Sheets[r].CodeName=L.name),(L.above||L.left)&&(c["!outline"]={above:L.above,left:L.left});break;case 137:s.Views||(s.Views=[{}]),s.Views[0]||(s.Views[0]={}),L.RTL&&(s.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:p=!0;break;case 36:p=!1;break;case 37:p=!0;break;case 38:p=!1;break;default:if(!H.T){if(!p||l.WTF)throw new Error("Unexpected record 0x"+K.toString(16))}}},l),delete l.supbooks,delete l["!row"],!c["!ref"]&&(f.s.r<2e6||d&&(d.e.r>0||d.e.c>0||d.s.r>0||d.s.c>0))&&(c["!ref"]=Rr(d||f)),l.sheetRows&&c["!ref"]){var M=Jr(c["!ref"]);l.sheetRows<=+M.e.r&&(M.e.r=l.sheetRows-1,M.e.r>f.e.r&&(M.e.r=f.e.r),M.e.r<M.s.r&&(M.s.r=M.e.r),M.e.c>f.e.c&&(M.e.c=f.e.c),M.e.c<M.s.c&&(M.s.c=M.e.c),c["!fullref"]=c["!ref"],c["!ref"]=Rr(M))}return P.length>0&&(c["!merges"]=P),Z.length>0&&(c["!cols"]=Z),ie.length>0&&(c["!rows"]=ie),c}function iZ(e,t,r,n,s,a,i){if(t.v===void 0)return!1;var l="";switch(t.t){case"b":l=t.v?"1":"0";break;case"d":t=Ln(t),t.z=t.z||wr[14],t.v=zs(On(t.v)),t.t="n";break;case"n":case"e":l=""+t.v;break;default:l=t.v;break}var c={r,c:n};switch(c.s=Ju(s.cellXfs,t,s),t.l&&a["!links"].push([br(c),t.l]),t.c&&a["!comments"].push([br(c),t.c]),t.t){case"s":case"str":return s.bookSST?(l=IS(s.Strings,t.v,s.revStrings),c.t="s",c.v=l,i?Tt(e,18,CJ(t,c)):Tt(e,7,SJ(t,c))):(c.t="str",i?Tt(e,17,OJ(t,c)):Tt(e,6,IJ(t,c))),!0;case"n":return t.v==(t.v|0)&&t.v>-1e3&&t.v<1e3?i?Tt(e,13,PJ(t,c)):Tt(e,2,jJ(t,c)):i?Tt(e,16,NJ(t,c)):Tt(e,5,EJ(t,c)),!0;case"b":return c.t="b",i?Tt(e,15,xJ(t,c)):Tt(e,4,mJ(t,c)),!0;case"e":return c.t="e",i?Tt(e,14,_J(t,c)):Tt(e,3,vJ(t,c)),!0}return i?Tt(e,12,hJ(t,c)):Tt(e,1,dJ(t,c)),!0}function oZ(e,t,r,n){var s=Jr(t["!ref"]||"A1"),a,i="",l=[];Tt(e,145);var c=Array.isArray(t),d=s.e.r;t["!rows"]&&(d=Math.max(s.e.r,t["!rows"].length-1));for(var f=s.s.r;f<=d;++f){i=ys(f),sJ(e,t,s,f);var p=!1;if(f<=s.e.r)for(var g=s.s.c;g<=s.e.c;++g){f===s.s.r&&(l[g]=Kn(g)),a=l[g]+i;var y=c?(t[f]||[])[g]:t[a];if(!y){p=!1;continue}p=iZ(e,y,f,g,n,t,p)}}Tt(e,146)}function lZ(e,t){!t||!t["!merges"]||(Tt(e,177,HJ(t["!merges"].length)),t["!merges"].forEach(function(r){Tt(e,176,zJ(r))}),Tt(e,178))}function cZ(e,t){!t||!t["!cols"]||(Tt(e,390),t["!cols"].forEach(function(r,n){r&&Tt(e,60,YJ(n,r))}),Tt(e,391))}function uZ(e,t){!t||!t["!ref"]||(Tt(e,648),Tt(e,649,tZ(Jr(t["!ref"]))),Tt(e,650))}function dZ(e,t,r){t["!links"].forEach(function(n){if(n[1].Target){var s=mn(r,-1,n[1].Target.replace(/#.*$/,""),Wr.HLINK);Tt(e,494,VJ(n,s))}}),delete t["!links"]}function fZ(e,t,r,n){if(t["!comments"].length>0){var s=mn(n,-1,"../drawings/vmlDrawing"+(r+1)+".vml",Wr.VML);Tt(e,551,bS("rId"+s)),t["!legacy"]=s}}function hZ(e,t,r,n){if(t["!autofilter"]){var s=t["!autofilter"],a=typeof s.ref=="string"?s.ref:Rr(s.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var i=r.Workbook.Names,l=Ti(a);l.s.r==l.e.r&&(l.e.r=Ti(t["!ref"]).e.r,a=Rr(l));for(var c=0;c<i.length;++c){var d=i[c];if(d.Name=="_xlnm._FilterDatabase"&&d.Sheet==n){d.Ref="'"+r.SheetNames[n]+"'!"+a;break}}c==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+r.SheetNames[n]+"'!"+a}),Tt(e,161,R0(Jr(a))),Tt(e,162)}}function gZ(e,t,r){Tt(e,133),Tt(e,137,eZ(t,r)),Tt(e,138),Tt(e,134)}function mZ(e,t){t["!protect"]&&Tt(e,535,rZ(t["!protect"]))}function pZ(e,t,r,n){var s=Ci(),a=r.SheetNames[e],i=r.Sheets[a]||{},l=a;try{r&&r.Workbook&&(l=r.Workbook.Sheets[e].CodeName||l)}catch{}var c=Jr(i["!ref"]||"A1");if(c.e.c>16383||c.e.r>1048575){if(t.WTF)throw new Error("Range "+(i["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");c.e.c=Math.min(c.e.c,16383),c.e.r=Math.min(c.e.c,1048575)}return i["!links"]=[],i["!comments"]=[],Tt(s,129),(r.vbaraw||i["!outline"])&&Tt(s,147,cJ(l,i["!outline"])),Tt(s,148,iJ(c)),gZ(s,i,r.Workbook),cZ(s,i),oZ(s,i,e,t),mZ(s,i),hZ(s,i,r,e),lZ(s,i),dZ(s,i,n),i["!margins"]&&Tt(s,476,JJ(i["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&uZ(s,i),fZ(s,i,e,n),Tt(s,130),s.end()}function xZ(e){var t=[],r=e.match(/^<c:numCache>/),n;(e.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(a){var i=a.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);i&&(t[+i[1]]=r?+i[2]:i[2])});var s=Qr((e.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(e.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(a){n=a.replace(/<.*?>/g,"")}),[t,s,n]}function yZ(e,t,r,n,s,a){var i=a||{"!type":"chart"};if(!e)return a;var l=0,c=0,d="A",f={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(e.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(p){var g=xZ(p);f.s.r=f.s.c=0,f.e.c=l,d=Kn(l),g[0].forEach(function(y,v){i[d+ys(v)]={t:"n",v:y,z:g[1]},c=v}),f.e.r<c&&(f.e.r=c),++l}),l>0&&(i["!ref"]=Rr(f)),i}function vZ(e,t,r,n,s){if(!e)return e;n||(n={"!id":{}});var a={"!type":"chart","!drawel":null,"!rel":""},i,l=e.match(BF);return l&&MS(l[0],a,s,r),(i=e.match(/drawing r:id="(.*?)"/))&&(a["!rel"]=i[1]),n["!id"][a["!rel"]]&&(a["!drawel"]=n["!id"][a["!rel"]]),a}function wZ(e,t){e.l+=10;var r=Ua(e);return{name:r}}function _Z(e,t,r,n,s){if(!e)return e;n||(n={"!id":{}});var a={"!type":"chart","!drawel":null,"!rel":""},i=!1;return Fc(e,function(c,d,f){switch(f){case 550:a["!rel"]=c;break;case 651:s.Sheets[r]||(s.Sheets[r]={}),c.name&&(s.Sheets[r].CodeName=c.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:i=!0;break;case 36:i=!1;break;case 37:break;case 38:break;default:if(!(d.T>0)){if(!(d.T<0)){if(!i||t.WTF)throw new Error("Unexpected record 0x"+f.toString(16))}}}},t),n["!id"][a["!rel"]]&&(a["!drawel"]=n["!id"][a["!rel"]]),a}var OS=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],bZ=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],SZ=[],kZ=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function f3(e,t){for(var r=0;r!=e.length;++r)for(var n=e[r],s=0;s!=t.length;++s){var a=t[s];if(n[a[0]]==null)n[a[0]]=a[1];else switch(a[2]){case"bool":typeof n[a[0]]=="string"&&(n[a[0]]=Rn(n[a[0]]));break;case"int":typeof n[a[0]]=="string"&&(n[a[0]]=parseInt(n[a[0]],10));break}}}function h3(e,t){for(var r=0;r!=t.length;++r){var n=t[r];if(e[n[0]]==null)e[n[0]]=n[1];else switch(n[2]){case"bool":typeof e[n[0]]=="string"&&(e[n[0]]=Rn(e[n[0]]));break;case"int":typeof e[n[0]]=="string"&&(e[n[0]]=parseInt(e[n[0]],10));break}}}function zF(e){h3(e.WBProps,OS),h3(e.CalcPr,kZ),f3(e.WBView,bZ),f3(e.Sheets,SZ),t0.date1904=Rn(e.WBProps.date1904)}function CZ(e){return!e.Workbook||!e.Workbook.WBProps?"false":Rn(e.Workbook.WBProps.date1904)?"true":"false"}var TZ="][*?/\\".split("");function HF(e,t){if(e.length>31)throw new Error("Sheet names cannot exceed 31 chars");var r=!0;return TZ.forEach(function(n){if(e.indexOf(n)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),r}function EZ(e,t,r){e.forEach(function(n,s){HF(n);for(var a=0;a<s;++a)if(n==e[a])throw new Error("Duplicate Sheet Name: "+n);if(r){var i=t&&t[s]&&t[s].CodeName||n;if(i.charCodeAt(0)==95&&i.length>22)throw new Error("Bad Code Name: Worksheet"+i)}})}function NZ(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");var t=e.Workbook&&e.Workbook.Sheets||[];EZ(e.SheetNames,t,!!e.vbaraw);for(var r=0;r<e.SheetNames.length;++r)CQ(e.Sheets[e.SheetNames[r]],e.SheetNames[r],r)}var AZ=/<\w+:workbook/;function jZ(e,t){if(!e)throw new Error("Could not find file");var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},n=!1,s="xmlns",a={},i=0;if(e.replace(za,function(c,d){var f=kr(c);switch(Dl(f[0])){case"<?xml":break;case"<workbook":c.match(AZ)&&(s="xmlns"+c.match(/<(\w+):/)[1]),r.xmlns=f[s];break;case"</workbook>":break;case"<fileVersion":delete f[0],r.AppVersion=f;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":OS.forEach(function(p){if(f[p[0]]!=null)switch(p[2]){case"bool":r.WBProps[p[0]]=Rn(f[p[0]]);break;case"int":r.WBProps[p[0]]=parseInt(f[p[0]],10);break;default:r.WBProps[p[0]]=f[p[0]]}}),f.codeName&&(r.WBProps.CodeName=bn(f.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete f[0],r.WBView.push(f);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(f.state){case"hidden":f.Hidden=1;break;case"veryHidden":f.Hidden=2;break;default:f.Hidden=0}delete f.state,f.name=Qr(bn(f.name)),delete f[0],r.Sheets.push(f);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":n=!0;break;case"</definedNames>":n=!1;break;case"<definedName":a={},a.Name=bn(f.name),f.comment&&(a.Comment=f.comment),f.localSheetId&&(a.Sheet=+f.localSheetId),Rn(f.hidden||"0")&&(a.Hidden=!0),i=d+c.length;break;case"</definedName>":a.Ref=Qr(bn(e.slice(i,d))),r.Names.push(a);break;case"<definedName/>":break;case"<calcPr":delete f[0],r.CalcPr=f;break;case"<calcPr/>":delete f[0],r.CalcPr=f;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":n=!0;break;case"</AlternateContent>":n=!1;break;case"<revisionPtr":break;default:if(!n&&t.WTF)throw new Error("unrecognized "+f[0]+" in workbook")}return c}),wf.indexOf(r.xmlns)===-1)throw new Error("Unknown Namespace: "+r.xmlns);return zF(r),r}function GF(e){var t=[ws];t[t.length]=Gt("workbook",null,{xmlns:wf[0],"xmlns:r":$s.r});var r=e.Workbook&&(e.Workbook.Names||[]).length>0,n={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(OS.forEach(function(l){e.Workbook.WBProps[l[0]]!=null&&e.Workbook.WBProps[l[0]]!=l[1]&&(n[l[0]]=e.Workbook.WBProps[l[0]])}),e.Workbook.WBProps.CodeName&&(n.codeName=e.Workbook.WBProps.CodeName,delete n.CodeName)),t[t.length]=Gt("workbookPr",null,n);var s=e.Workbook&&e.Workbook.Sheets||[],a=0;if(s&&s[0]&&s[0].Hidden){for(t[t.length]="<bookViews>",a=0;a!=e.SheetNames.length&&!(!s[a]||!s[a].Hidden);++a);a==e.SheetNames.length&&(a=0),t[t.length]='<workbookView firstSheet="'+a+'" activeTab="'+a+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",a=0;a!=e.SheetNames.length;++a){var i={name:pn(e.SheetNames[a].slice(0,31))};if(i.sheetId=""+(a+1),i["r:id"]="rId"+(a+1),s[a])switch(s[a].Hidden){case 1:i.state="hidden";break;case 2:i.state="veryHidden";break}t[t.length]=Gt("sheet",null,i)}return t[t.length]="</sheets>",r&&(t[t.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach(function(l){var c={name:l.Name};l.Comment&&(c.comment=l.Comment),l.Sheet!=null&&(c.localSheetId=""+l.Sheet),l.Hidden&&(c.hidden="1"),l.Ref&&(t[t.length]=Gt("definedName",pn(l.Ref),c))}),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function FZ(e,t){var r={};return r.Hidden=e.read_shift(4),r.iTabID=e.read_shift(4),r.strRelID=l2(e),r.name=Ua(e),r}function PZ(e,t){return t||(t=wt(127)),t.write_shift(4,e.Hidden),t.write_shift(4,e.iTabID),bS(e.strRelID,t),na(e.name.slice(0,31),t),t.length>t.l?t.slice(0,t.l):t}function RZ(e,t){var r={},n=e.read_shift(4);r.defaultThemeVersion=e.read_shift(4);var s=t>8?Ua(e):"";return s.length>0&&(r.CodeName=s),r.autoCompressPictures=!!(n&65536),r.backupFile=!!(n&64),r.checkCompatibility=!!(n&4096),r.date1904=!!(n&1),r.filterPrivacy=!!(n&8),r.hidePivotFieldList=!!(n&1024),r.promptedSolutions=!!(n&16),r.publishItems=!!(n&2048),r.refreshAllConnections=!!(n&262144),r.saveExternalLinkValues=!!(n&128),r.showBorderUnselectedTables=!!(n&4),r.showInkAnnotation=!!(n&32),r.showObjects=["all","placeholders","none"][n>>13&3],r.showPivotChartFilter=!!(n&32768),r.updateLinks=["userSet","never","always"][n>>8&3],r}function DZ(e,t){t||(t=wt(72));var r=0;return e&&e.filterPrivacy&&(r|=8),t.write_shift(4,r),t.write_shift(4,0),M8(e&&e.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}function IZ(e,t){var r={};return e.read_shift(4),r.ArchID=e.read_shift(4),e.l+=t-8,r}function MZ(e,t,r){var n=e.l+t;e.l+=4,e.l+=1;var s=e.read_shift(4),a=fG(e),i=vQ(e,0,r),l=_S(e);e.l=n;var c={Name:a,Ptg:i};return s<268435455&&(c.Sheet=s),l&&(c.Comment=l),c}function OZ(e,t){var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},n=[],s=!1;t||(t={}),t.biff=12;var a=[],i=[[]];return i.SheetNames=[],i.XTI=[],vp[16]={n:"BrtFRTArchID$",f:IZ},Fc(e,function(c,d,f){switch(f){case 156:i.SheetNames.push(c.name),r.Sheets.push(c);break;case 153:r.WBProps=c;break;case 39:c.Sheet!=null&&(t.SID=c.Sheet),c.Ref=Da(c.Ptg,null,null,i,t),delete t.SID,delete c.Ptg,a.push(c);break;case 1036:break;case 357:case 358:case 355:case 667:i[0].length?i.push([f,c]):i[0]=[f,c],i[i.length-1].XTI=[];break;case 362:i.length===0&&(i[0]=[],i[0].XTI=[]),i[i.length-1].XTI=i[i.length-1].XTI.concat(c),i.XTI=i.XTI.concat(c);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:n.push(f),s=!0;break;case 36:n.pop(),s=!1;break;case 37:n.push(f),s=!0;break;case 38:n.pop(),s=!1;break;case 16:break;default:if(!d.T){if(!s||t.WTF&&n[n.length-1]!=37&&n[n.length-1]!=35)throw new Error("Unexpected record 0x"+f.toString(16))}}},t),zF(r),r.Names=a,r.supbooks=i,r}function LZ(e,t){Tt(e,143);for(var r=0;r!=t.SheetNames.length;++r){var n=t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[r]&&t.Workbook.Sheets[r].Hidden||0,s={Hidden:n,iTabID:r+1,strRelID:"rId"+(r+1),name:t.SheetNames[r]};Tt(e,156,PZ(s))}Tt(e,144)}function BZ(e,t){t||(t=wt(127));for(var r=0;r!=4;++r)t.write_shift(4,0);return na("SheetJS",t),na(fy.version,t),na(fy.version,t),na("7262",t),t.length>t.l?t.slice(0,t.l):t}function UZ(e,t){t||(t=wt(29)),t.write_shift(-4,0),t.write_shift(-4,460),t.write_shift(4,28800),t.write_shift(4,17600),t.write_shift(4,500),t.write_shift(4,e),t.write_shift(4,e);var r=120;return t.write_shift(1,r),t.length>t.l?t.slice(0,t.l):t}function $Z(e,t){if(!(!t.Workbook||!t.Workbook.Sheets)){for(var r=t.Workbook.Sheets,n=0,s=-1,a=-1;n<r.length;++n)!r[n]||!r[n].Hidden&&s==-1?s=n:r[n].Hidden==1&&a==-1&&(a=n);a>s||(Tt(e,135),Tt(e,158,UZ(s)),Tt(e,136))}}function WZ(e,t){var r=Ci();return Tt(r,131),Tt(r,128,BZ()),Tt(r,153,DZ(e.Workbook&&e.Workbook.WBProps||null)),$Z(r,e),LZ(r,e),Tt(r,132),r.end()}function zZ(e,t,r){return t.slice(-4)===".bin"?OZ(e,r):jZ(e,r)}function HZ(e,t,r,n,s,a,i,l){return t.slice(-4)===".bin"?aZ(e,n,r,s,a,i,l):MQ(e,n,r,s,a,i,l)}function GZ(e,t,r,n,s,a,i,l){return t.slice(-4)===".bin"?_Z(e,n,r,s,a):vZ(e,n,r,s,a)}function VZ(e,t,r,n,s,a,i,l){return t.slice(-4)===".bin"?qX():XX()}function KZ(e,t,r,n,s,a,i,l){return t.slice(-4)===".bin"?VX():KX()}function qZ(e,t,r,n){return t.slice(-4)===".bin"?zq(e,r,n):Fq(e,r,n)}function XZ(e,t,r){return CF(e,r)}function YZ(e,t,r){return t.slice(-4)===".bin"?YK(e,r):KK(e,r)}function QZ(e,t,r){return t.slice(-4)===".bin"?$X(e,r):PX(e,r)}function JZ(e,t,r){return t.slice(-4)===".bin"?AX(e):EX(e)}function ZZ(e,t,r,n){return r.slice(-4)===".bin"?jX(e,t,r,n):void 0}function eee(e,t,r){return t.slice(-4)===".bin"?kX(e,t,r):TX(e,t,r)}function tee(e,t,r){return(t.slice(-4)===".bin"?WZ:GF)(e)}function ree(e,t,r,n,s){return(t.slice(-4)===".bin"?pZ:UF)(e,r,n,s)}function nee(e,t,r){return(t.slice(-4)===".bin"?Zq:SF)(e,r)}function see(e,t,r){return(t.slice(-4)===".bin"?ZK:mF)(e,r)}function aee(e,t,r){return(t.slice(-4)===".bin"?WX:NF)(e)}function iee(e){return(e.slice(-4)===".bin"?CX:TF)()}var VF=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,KF=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function Mo(e,t){var r=e.split(/\s+/),n=[];if(n[0]=r[0],r.length===1)return n;var s=e.match(VF),a,i,l,c;if(s)for(c=0;c!=s.length;++c)a=s[c].match(KF),(i=a[1].indexOf(":"))===-1?n[a[1]]=a[2].slice(1,a[2].length-1):(a[1].slice(0,6)==="xmlns:"?l="xmlns"+a[1].slice(6):l=a[1].slice(i+1),n[l]=a[2].slice(1,a[2].length-1));return n}function oee(e){var t=e.split(/\s+/),r={};if(t.length===1)return r;var n=e.match(VF),s,a,i,l;if(n)for(l=0;l!=n.length;++l)s=n[l].match(KF),(a=s[1].indexOf(":"))===-1?r[s[1]]=s[2].slice(1,s[2].length-1):(s[1].slice(0,6)==="xmlns:"?i="xmlns"+s[1].slice(6):i=s[1].slice(a+1),r[i]=s[2].slice(1,s[2].length-1));return r}var Wm;function lee(e,t){var r=Wm[e]||Qr(e);return r==="General"?df(t):vo(r,t)}function cee(e,t,r,n){var s=n;switch((r[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":s=Rn(n);break;case"i2":case"int":s=parseInt(n,10);break;case"r4":case"float":s=parseFloat(n);break;case"date":case"dateTime.tz":s=On(n);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+r[0])}e[Qr(t)]=s}function uee(e,t,r){if(e.t!=="z"){if(!r||r.cellText!==!1)try{e.t==="e"?e.w=e.w||Pc[e.v]:t==="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=up(e.v):e.w=df(e.v):e.w=lee(t||"General",e.v)}catch(a){if(r.WTF)throw a}try{var n=Wm[t]||t||"General";if(r.cellNF&&(e.z=n),r.cellDates&&e.t=="n"&&j0(n)){var s=Bd(e.v);s&&(e.t="d",e.v=new Date(s.y,s.m-1,s.d,s.H,s.M,s.S,s.u))}}catch(a){if(r.WTF)throw a}}}function dee(e,t,r){if(r.cellStyles&&t.Interior){var n=t.Interior;n.Pattern&&(n.patternType=Sq[n.Pattern]||n.Pattern)}e[t.ID]=t}function fee(e,t,r,n,s,a,i,l,c,d){var f="General",p=n.StyleID,g={};d=d||{};var y=[],v=0;for(p===void 0&&l&&(p=l.StyleID),p===void 0&&i&&(p=i.StyleID);a[p]!==void 0&&(a[p].nf&&(f=a[p].nf),a[p].Interior&&y.push(a[p].Interior),!!a[p].Parent);)p=a[p].Parent;switch(r.Type){case"Boolean":n.t="b",n.v=Rn(e);break;case"String":n.t="s",n.r=jN(Qr(e)),n.v=e.indexOf("<")>-1?Qr(t||e).replace(/<.*?>/g,""):n.r;break;case"DateTime":e.slice(-1)!="Z"&&(e+="Z"),n.v=(On(e)-new Date(Date.UTC(1899,11,30)))/(1440*60*1e3),n.v!==n.v?n.v=Qr(e):n.v<60&&(n.v=n.v-1),(!f||f=="General")&&(f="yyyy-mm-dd");case"Number":n.v===void 0&&(n.v=+e),n.t||(n.t="n");break;case"Error":n.t="e",n.v=$8[e],d.cellText!==!1&&(n.w=e);break;default:e==""&&t==""?n.t="z":(n.t="s",n.v=jN(t||e));break}if(uee(n,f,d),d.cellFormula!==!1)if(n.Formula){var _=Qr(n.Formula);_.charCodeAt(0)==61&&(_=_.slice(1)),n.f=e0(_,s),delete n.Formula,n.ArrayRange=="RC"?n.F=e0("RC:RC",s):n.ArrayRange&&(n.F=e0(n.ArrayRange,s),c.push([Jr(n.F),n.F]))}else for(v=0;v<c.length;++v)s.r>=c[v][0].s.r&&s.r<=c[v][0].e.r&&s.c>=c[v][0].s.c&&s.c<=c[v][0].e.c&&(n.F=c[v][1]);d.cellStyles&&(y.forEach(function(b){!g.patternType&&b.patternType&&(g.patternType=b.patternType)}),n.s=g),n.StyleID!==void 0&&(n.ixfe=n.StyleID)}function hee(e){e.t=e.v||"",e.t=e.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.v=e.w=e.ixfe=void 0}function Xw(e,t){var r=t||{};F0();var n=Sm(mS(e));(r.type=="binary"||r.type=="array"||r.type=="base64")&&(n=bn(n));var s=n.slice(0,1024).toLowerCase(),a=!1;if(s=s.replace(/".*?"/g,""),(s.indexOf(">")&1023)>Math.min(s.indexOf(",")&1023,s.indexOf(";")&1023)){var i=Ln(r);return i.type="string",f0.to_workbook(n,i)}if(s.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(It){s.indexOf("<"+It)>=0&&(a=!0)}),a)return Jee(n,r);Wm={"General Number":"General","General Date":wr[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":wr[15],"Short Date":wr[14],"Long Time":wr[19],"Medium Time":wr[18],"Short Time":wr[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:wr[2],Standard:wr[4],Percent:wr[10],Scientific:wr[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var l,c=[],d,f={},p=[],g=r.dense?[]:{},y="",v={},_={},b=Mo('<Data ss:Type="String">'),E=0,k=0,w=0,N={s:{r:2e6,c:2e6},e:{r:0,c:0}},A={},P={},R="",T=0,D=[],I={},V={},X=0,Z=[],ie=[],q={},ne=[],M,W=!1,L=[],H=[],K={},B=0,z=0,Q={Sheets:[],WBProps:{date1904:!1}},Y={};hp.lastIndex=0,n=n.replace(/<!--([\s\S]*?)-->/mg,"");for(var te="";l=hp.exec(n);)switch(l[3]=(te=l[3]).toLowerCase()){case"data":if(te=="data"){if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break}if(c[c.length-1][1])break;l[1]==="/"?fee(n.slice(E,l.index),R,b,c[c.length-1][0]=="comment"?q:v,{c:k,r:w},A,ne[k],_,L,r):(R="",b=Mo(l[0]),E=l.index+l[0].length);break;case"cell":if(l[1]==="/")if(ie.length>0&&(v.c=ie),(!r.sheetRows||r.sheetRows>w)&&v.v!==void 0&&(r.dense?(g[w]||(g[w]=[]),g[w][k]=v):g[Kn(k)+ys(w)]=v),v.HRef&&(v.l={Target:Qr(v.HRef)},v.HRefScreenTip&&(v.l.Tooltip=v.HRefScreenTip),delete v.HRef,delete v.HRefScreenTip),(v.MergeAcross||v.MergeDown)&&(B=k+(parseInt(v.MergeAcross,10)|0),z=w+(parseInt(v.MergeDown,10)|0),D.push({s:{c:k,r:w},e:{c:B,r:z}})),!r.sheetStubs)v.MergeAcross?k=B+1:++k;else if(v.MergeAcross||v.MergeDown){for(var ee=k;ee<=B;++ee)for(var ae=w;ae<=z;++ae)(ee>k||ae>w)&&(r.dense?(g[ae]||(g[ae]=[]),g[ae][ee]={t:"z"}):g[Kn(ee)+ys(ae)]={t:"z"});k=B+1}else++k;else v=oee(l[0]),v.Index&&(k=+v.Index-1),k<N.s.c&&(N.s.c=k),k>N.e.c&&(N.e.c=k),l[0].slice(-2)==="/>"&&++k,ie=[];break;case"row":l[1]==="/"||l[0].slice(-2)==="/>"?(w<N.s.r&&(N.s.r=w),w>N.e.r&&(N.e.r=w),l[0].slice(-2)==="/>"&&(_=Mo(l[0]),_.Index&&(w=+_.Index-1)),k=0,++w):(_=Mo(l[0]),_.Index&&(w=+_.Index-1),K={},(_.AutoFitHeight=="0"||_.Height)&&(K.hpx=parseInt(_.Height,10),K.hpt=yp(K.hpx),H[w]=K),_.Hidden=="1"&&(K.hidden=!0,H[w]=K));break;case"worksheet":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"));p.push(y),N.s.r<=N.e.r&&N.s.c<=N.e.c&&(g["!ref"]=Rr(N),r.sheetRows&&r.sheetRows<=N.e.r&&(g["!fullref"]=g["!ref"],N.e.r=r.sheetRows-1,g["!ref"]=Rr(N))),D.length&&(g["!merges"]=D),ne.length>0&&(g["!cols"]=ne),H.length>0&&(g["!rows"]=H),f[y]=g}else N={s:{r:2e6,c:2e6},e:{r:0,c:0}},w=k=0,c.push([l[3],!1]),d=Mo(l[0]),y=Qr(d.Name),g=r.dense?[]:{},D=[],L=[],H=[],Y={name:y,Hidden:0},Q.Sheets.push(Y);break;case"table":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else{if(l[0].slice(-2)=="/>")break;c.push([l[3],!1]),ne=[],W=!1}break;case"style":l[1]==="/"?dee(A,P,r):P=Mo(l[0]);break;case"numberformat":P.nf=Qr(Mo(l[0]).Format||"General"),Wm[P.nf]&&(P.nf=Wm[P.nf]);for(var ge=0;ge!=392&&wr[ge]!=P.nf;++ge);if(ge==392){for(ge=57;ge!=392;++ge)if(wr[ge]==null){_c(P.nf,ge);break}}break;case"column":if(c[c.length-1][0]!=="table")break;if(M=Mo(l[0]),M.Hidden&&(M.hidden=!0,delete M.Hidden),M.Width&&(M.wpx=parseInt(M.Width,10)),!W&&M.wpx>10){W=!0,Ia=_F;for(var _e=0;_e<ne.length;++_e)ne[_e]&&Uu(ne[_e])}W&&Uu(M),ne[M.Index-1||ne.length]=M;for(var Me=0;Me<+M.Span;++Me)ne[ne.length]=Ln(M);break;case"namedrange":if(l[1]==="/")break;Q.Names||(Q.Names=[]);var ue=kr(l[0]),me={Name:ue.Name,Ref:e0(ue.RefersTo.slice(1),{r:0,c:0})};Q.Sheets.length>0&&(me.Sheet=Q.Sheets.length-1),Q.Names.push(me);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(l[0].slice(-2)==="/>")break;l[1]==="/"?R+=n.slice(T,l.index):T=l.index+l[0].length;break;case"interior":if(!r.cellStyles)break;P.Interior=Mo(l[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(l[0].slice(-2)==="/>")break;l[1]==="/"?OG(I,te,n.slice(X,l.index)):X=l.index+l[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else c.push([l[3],!1]);break;case"comment":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"));hee(q),ie.push(q)}else c.push([l[3],!1]),d=Mo(l[0]),q={a:d.Author};break;case"autofilter":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else if(l[0].charAt(l[0].length-2)!=="/"){var He=Mo(l[0]);g["!autofilter"]={ref:e0(He.Range).replace(/\$/g,"")},c.push([l[3],!0])}break;case"name":break;case"datavalidation":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break;case"null":break;default:if(c.length==0&&l[3]=="document"||c.length==0&&l[3]=="uof")return y3(n,r);var qe=!0;switch(c[c.length-1][0]){case"officedocumentsettings":switch(l[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:qe=!1}break;case"componentoptions":switch(l[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:qe=!1}break;case"excelworkbook":switch(l[3]){case"date1904":Q.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:qe=!1}break;case"workbookoptions":switch(l[3]){case"owcversion":break;case"height":break;case"width":break;default:qe=!1}break;case"worksheetoptions":switch(l[3]){case"visible":if(l[0].slice(-2)!=="/>")if(l[1]==="/")switch(n.slice(X,l.index)){case"SheetHidden":Y.Hidden=1;break;case"SheetVeryHidden":Y.Hidden=2;break}else X=l.index+l[0].length;break;case"header":g["!margins"]||Xd(g["!margins"]={},"xlml"),isNaN(+kr(l[0]).Margin)||(g["!margins"].header=+kr(l[0]).Margin);break;case"footer":g["!margins"]||Xd(g["!margins"]={},"xlml"),isNaN(+kr(l[0]).Margin)||(g["!margins"].footer=+kr(l[0]).Margin);break;case"pagemargins":var Xe=kr(l[0]);g["!margins"]||Xd(g["!margins"]={},"xlml"),isNaN(+Xe.Top)||(g["!margins"].top=+Xe.Top),isNaN(+Xe.Left)||(g["!margins"].left=+Xe.Left),isNaN(+Xe.Right)||(g["!margins"].right=+Xe.Right),isNaN(+Xe.Bottom)||(g["!margins"].bottom=+Xe.Bottom);break;case"displayrighttoleft":Q.Views||(Q.Views=[]),Q.Views[0]||(Q.Views[0]={}),Q.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":g["!outline"]||(g["!outline"]={}),g["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":g["!outline"]||(g["!outline"]={}),g["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:qe=!1}break;case"pivottable":case"pivotcache":switch(l[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:qe=!1}break;case"pagebreaks":switch(l[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:qe=!1}break;case"autofilter":switch(l[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:qe=!1}break;case"querytable":switch(l[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:qe=!1}break;case"datavalidation":switch(l[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:qe=!1}break;case"sorting":case"conditionalformatting":switch(l[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:qe=!1}break;case"mapinfo":case"schema":case"data":switch(l[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:qe=!1}break;case"smarttags":break;default:qe=!1;break}if(qe||l[3].match(/!\[CDATA/))break;if(!c[c.length-1][1])throw"Unrecognized tag: "+l[3]+"|"+c.join("|");if(c[c.length-1][0]==="customdocumentproperties"){if(l[0].slice(-2)==="/>")break;l[1]==="/"?cee(V,te,Z,n.slice(X,l.index)):(Z=l,X=l.index+l[0].length);break}if(r.WTF)throw"Unrecognized tag: "+l[3]+"|"+c.join("|")}var Ve={};return!r.bookSheets&&!r.bookProps&&(Ve.Sheets=f),Ve.SheetNames=p,Ve.Workbook=Q,Ve.SSF=Ln(wr),Ve.Props=I,Ve.Custprops=V,Ve}function m2(e,t){switch(BS(t=t||{}),t.type||"base64"){case"base64":return Xw(Wi(e),t);case"binary":case"buffer":case"file":return Xw(e,t);case"array":return Xw(Yu(e),t)}}function gee(e,t){var r=[];return e.Props&&r.push(LG(e.Props,t)),e.Custprops&&r.push(BG(e.Props,e.Custprops)),r.join("")}function mee(){return""}function pee(e,t){var r=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach(function(n,s){var a=[];a.push(Gt("NumberFormat",null,{"ss:Format":pn(wr[n.numFmtId])}));var i={"ss:ID":"s"+(21+s)};r.push(Gt("Style",a.join(""),i))}),Gt("Styles",r.join(""))}function qF(e){return Gt("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+RS(e.Ref,{r:0,c:0})})}function xee(e){if(!((e||{}).Workbook||{}).Names)return"";for(var t=e.Workbook.Names,r=[],n=0;n<t.length;++n){var s=t[n];s.Sheet==null&&(s.Name.match(/^_xlfn\./)||r.push(qF(s)))}return Gt("Names",r.join(""))}function yee(e,t,r,n){if(!e||!((n||{}).Workbook||{}).Names)return"";for(var s=n.Workbook.Names,a=[],i=0;i<s.length;++i){var l=s[i];l.Sheet==r&&(l.Name.match(/^_xlfn\./)||a.push(qF(l)))}return a.join("")}function vee(e,t,r,n){if(!e)return"";var s=[];if(e["!margins"]&&(s.push("<PageSetup>"),e["!margins"].header&&s.push(Gt("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&s.push(Gt("Footer",null,{"x:Margin":e["!margins"].footer})),s.push(Gt("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),s.push("</PageSetup>")),n&&n.Workbook&&n.Workbook.Sheets&&n.Workbook.Sheets[r])if(n.Workbook.Sheets[r].Hidden)s.push(Gt("Visible",n.Workbook.Sheets[r].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var a=0;a<r&&!(n.Workbook.Sheets[a]&&!n.Workbook.Sheets[a].Hidden);++a);a==r&&s.push("<Selected/>")}return((((n||{}).Workbook||{}).Views||[])[0]||{}).RTL&&s.push("<DisplayRightToLeft/>"),e["!protect"]&&(s.push(_a("ProtectContents","True")),e["!protect"].objects&&s.push(_a("ProtectObjects","True")),e["!protect"].scenarios&&s.push(_a("ProtectScenarios","True")),e["!protect"].selectLockedCells!=null&&!e["!protect"].selectLockedCells?s.push(_a("EnableSelection","NoSelection")):e["!protect"].selectUnlockedCells!=null&&!e["!protect"].selectUnlockedCells&&s.push(_a("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(i){e["!protect"][i[0]]&&s.push("<"+i[1]+"/>")})),s.length==0?"":Gt("WorksheetOptions",s.join(""),{xmlns:Oi.x})}function wee(e){return e.map(function(t){var r=$H(t.t||""),n=Gt("ss:Data",r,{xmlns:"http://www.w3.org/TR/REC-html40"});return Gt("Comment",n,{"ss:Author":t.a})}).join("")}function _ee(e,t,r,n,s,a,i){if(!e||e.v==null&&e.f==null)return"";var l={};if(e.f&&(l["ss:Formula"]="="+pn(RS(e.f,i))),e.F&&e.F.slice(0,t.length)==t){var c=qn(e.F.slice(t.length+1));l["ss:ArrayRange"]="RC:R"+(c.r==i.r?"":"["+(c.r-i.r)+"]")+"C"+(c.c==i.c?"":"["+(c.c-i.c)+"]")}if(e.l&&e.l.Target&&(l["ss:HRef"]=pn(e.l.Target),e.l.Tooltip&&(l["x:HRefScreenTip"]=pn(e.l.Tooltip))),r["!merges"])for(var d=r["!merges"],f=0;f!=d.length;++f)d[f].s.c!=i.c||d[f].s.r!=i.r||(d[f].e.c>d[f].s.c&&(l["ss:MergeAcross"]=d[f].e.c-d[f].s.c),d[f].e.r>d[f].s.r&&(l["ss:MergeDown"]=d[f].e.r-d[f].s.r));var p="",g="";switch(e.t){case"z":if(!n.sheetStubs)return"";break;case"n":p="Number",g=String(e.v);break;case"b":p="Boolean",g=e.v?"1":"0";break;case"e":p="Error",g=Pc[e.v];break;case"d":p="DateTime",g=new Date(e.v).toISOString(),e.z==null&&(e.z=e.z||wr[14]);break;case"s":p="String",g=UH(e.v||"");break}var y=Ju(n.cellXfs,e,n);l["ss:StyleID"]="s"+(21+y),l["ss:Index"]=i.c+1;var v=e.v!=null?g:"",_=e.t=="z"?"":'<Data ss:Type="'+p+'">'+v+"</Data>";return(e.c||[]).length>0&&(_+=wee(e.c)),Gt("Cell",_,l)}function bee(e,t){var r='<Row ss:Index="'+(e+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=h0(t.hpt)),t.hpx&&(r+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(r+=' ss:Hidden="1"')),r+">"}function See(e,t,r,n){if(!e["!ref"])return"";var s=Jr(e["!ref"]),a=e["!merges"]||[],i=0,l=[];e["!cols"]&&e["!cols"].forEach(function(b,E){Uu(b);var k=!!b.width,w=ov(E,b),N={"ss:Index":E+1};k&&(N["ss:Width"]=pp(w.width)),b.hidden&&(N["ss:Hidden"]="1"),l.push(Gt("Column",null,N))});for(var c=Array.isArray(e),d=s.s.r;d<=s.e.r;++d){for(var f=[bee(d,(e["!rows"]||[])[d])],p=s.s.c;p<=s.e.c;++p){var g=!1;for(i=0;i!=a.length;++i)if(!(a[i].s.c>p)&&!(a[i].s.r>d)&&!(a[i].e.c<p)&&!(a[i].e.r<d)){(a[i].s.c!=p||a[i].s.r!=d)&&(g=!0);break}if(!g){var y={r:d,c:p},v=br(y),_=c?(e[d]||[])[p]:e[v];f.push(_ee(_,v,e,t,r,n,y))}}f.push("</Row>"),f.length>2&&l.push(f.join(""))}return l.join("")}function kee(e,t,r){var n=[],s=r.SheetNames[e],a=r.Sheets[s],i=a?yee(a,t,e,r):"";return i.length>0&&n.push("<Names>"+i+"</Names>"),i=a?See(a,t,e,r):"",i.length>0&&n.push("<Table>"+i+"</Table>"),n.push(vee(a,t,e,r)),n.join("")}function Cee(e,t){t||(t={}),e.SSF||(e.SSF=Ln(wr)),e.SSF&&(F0(),ev(e.SSF),t.revssf=rv(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF,t.cellXfs=[],Ju(t.cellXfs,{},{revssf:{General:0}}));var r=[];r.push(gee(e,t)),r.push(mee()),r.push(""),r.push("");for(var n=0;n<e.SheetNames.length;++n)r.push(Gt("Worksheet",kee(n,t,e),{"ss:Name":pn(e.SheetNames[n])}));return r[2]=pee(e,t),r[3]=xee(e),ws+Gt("Workbook",r.join(""),{xmlns:Oi.ss,"xmlns:o":Oi.o,"xmlns:x":Oi.x,"xmlns:ss":Oi.ss,"xmlns:dt":Oi.dt,"xmlns:html":Oi.html})}function Tee(e){var t={},r=e.content;if(r.l=28,t.AnsiUserType=r.read_shift(0,"lpstr-ansi"),t.AnsiClipboardFormat=xG(r),r.length-r.l<=4)return t;var n=r.read_shift(4);if(n==0||n>40||(r.l-=4,t.Reserved1=r.read_shift(0,"lpstr-ansi"),r.length-r.l<=4)||(n=r.read_shift(4),n!==1907505652)||(t.UnicodeClipboardFormat=yG(r),n=r.read_shift(4),n==0||n>40))return t;r.l-=4,t.Reserved2=r.read_shift(0,"lpwstr")}var Eee=[60,1084,2066,2165,2175];function Nee(e,t,r,n,s){var a=n,i=[],l=r.slice(r.l,r.l+a);if(s&&s.enc&&s.enc.insitu&&l.length>0)switch(e){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:s.enc.insitu(l)}i.push(l),r.l+=a;for(var c=yc(r,r.l),d=p2[c],f=0;d!=null&&Eee.indexOf(c)>-1;)a=yc(r,r.l+2),f=r.l+4,c==2066?f+=4:(c==2165||c==2175)&&(f+=12),l=r.slice(f,r.l+4+a),i.push(l),r.l+=4+a,d=p2[c=yc(r,r.l)];var p=ta(i);ya(p,0);var g=0;p.lens=[];for(var y=0;y<i.length;++y)p.lens.push(g),g+=i[y].length;if(p.length<n)throw"XLS Record 0x"+e.toString(16)+" Truncated: "+p.length+" < "+n;return t.f(p,p.length,s)}function yl(e,t,r){if(e.t!=="z"&&e.XF){var n=0;try{n=e.z||e.XF.numFmtId||0,t.cellNF&&(e.z=wr[n])}catch(a){if(t.WTF)throw a}if(!t||t.cellText!==!1)try{e.t==="e"?e.w=e.w||Pc[e.v]:n===0||n=="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=up(e.v):e.w=df(e.v):e.w=vo(n,e.v,{date1904:!!r,dateNF:t&&t.dateNF})}catch(a){if(t.WTF)throw a}if(t.cellDates&&n&&e.t=="n"&&j0(wr[n]||String(n))){var s=Bd(e.v);s&&(e.t="d",e.v=new Date(s.y,s.m-1,s.d,s.H,s.M,s.S,s.u))}}}function C1(e,t,r){return{v:e,ixfe:t,t:r}}function Aee(e,t){var r={opts:{}},n={},s=t.dense?[]:{},a={},i={},l=null,c=[],d="",f={},p,g="",y,v,_,b,E={},k=[],w,N,A=[],P=[],R={Sheets:[],WBProps:{date1904:!1},Views:[{}]},T={},D=function(ft){return ft<8?Vd[ft]:ft<64&&P[ft-8]||Vd[ft]},I=function(ft,_t,zt){var Jt=_t.XF.data;if(!(!Jt||!Jt.patternType||!zt||!zt.cellStyles)){_t.s={},_t.s.patternType=Jt.patternType;var De;(De=mp(D(Jt.icvFore)))&&(_t.s.fgColor={rgb:De}),(De=mp(D(Jt.icvBack)))&&(_t.s.bgColor={rgb:De})}},V=function(ft,_t,zt){if(!(K>1)&&!(zt.sheetRows&&ft.r>=zt.sheetRows)){if(zt.cellStyles&&_t.XF&&_t.XF.data&&I(ft,_t,zt),delete _t.ixfe,delete _t.XF,p=ft,g=br(ft),(!i||!i.s||!i.e)&&(i={s:{r:0,c:0},e:{r:0,c:0}}),ft.r<i.s.r&&(i.s.r=ft.r),ft.c<i.s.c&&(i.s.c=ft.c),ft.r+1>i.e.r&&(i.e.r=ft.r+1),ft.c+1>i.e.c&&(i.e.c=ft.c+1),zt.cellFormula&&_t.f){for(var Jt=0;Jt<k.length;++Jt)if(!(k[Jt][0].s.c>ft.c||k[Jt][0].s.r>ft.r)&&!(k[Jt][0].e.c<ft.c||k[Jt][0].e.r<ft.r)){_t.F=Rr(k[Jt][0]),(k[Jt][0].s.c!=ft.c||k[Jt][0].s.r!=ft.r)&&delete _t.f,_t.f&&(_t.f=""+Da(k[Jt][1],i,ft,L,X));break}}zt.dense?(s[ft.r]||(s[ft.r]=[]),s[ft.r][ft.c]=_t):s[g]=_t}},X={enc:!1,sbcch:0,snames:[],sharedf:E,arrayf:k,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!t&&!!t.cellStyles,WTF:!!t&&!!t.wtf};t.password&&(X.password=t.password);var Z,ie=[],q=[],ne=[],M=[],W=!1,L=[];L.SheetNames=X.snames,L.sharedf=X.sharedf,L.arrayf=X.arrayf,L.names=[],L.XTI=[];var H=0,K=0,B=0,z=[],Q=[],Y;X.codepage=1200,Wo(1200);for(var te=!1;e.l<e.length-1;){var ee=e.l,ae=e.read_shift(2);if(ae===0&&H===10)break;var ge=e.l===e.length?0:e.read_shift(2),_e=p2[ae];if(_e&&_e.f){if(t.bookSheets&&H===133&&ae!==133)break;if(H=ae,_e.r===2||_e.r==12){var Me=e.read_shift(2);if(ge-=2,!X.enc&&Me!==ae&&((Me&255)<<8|Me>>8)!==ae)throw new Error("rt mismatch: "+Me+"!="+ae);_e.r==12&&(e.l+=10,ge-=10)}var ue={};if(ae===10?ue=_e.f(e,ge,X):ue=Nee(ae,_e,e,ge,X),K==0&&[9,521,1033,2057].indexOf(H)===-1)continue;switch(ae){case 34:r.opts.Date1904=R.WBProps.date1904=ue;break;case 134:r.opts.WriteProtect=!0;break;case 47:if(X.enc||(e.l=0),X.enc=ue,!t.password)throw new Error("File is password-protected");if(ue.valid==null)throw new Error("Encryption scheme unsupported");if(!ue.valid)throw new Error("Password is incorrect");break;case 92:X.lastuser=ue;break;case 66:var me=Number(ue);switch(me){case 21010:me=1200;break;case 32768:me=1e4;break;case 32769:me=1252;break}Wo(X.codepage=me),te=!0;break;case 317:X.rrtabid=ue;break;case 25:X.winlocked=ue;break;case 439:r.opts.RefreshAll=ue;break;case 12:r.opts.CalcCount=ue;break;case 16:r.opts.CalcDelta=ue;break;case 17:r.opts.CalcIter=ue;break;case 13:r.opts.CalcMode=ue;break;case 14:r.opts.CalcPrecision=ue;break;case 95:r.opts.CalcSaveRecalc=ue;break;case 15:X.CalcRefMode=ue;break;case 2211:r.opts.FullCalc=ue;break;case 129:ue.fDialog&&(s["!type"]="dialog"),ue.fBelow||((s["!outline"]||(s["!outline"]={})).above=!0),ue.fRight||((s["!outline"]||(s["!outline"]={})).left=!0);break;case 224:A.push(ue);break;case 430:L.push([ue]),L[L.length-1].XTI=[];break;case 35:case 547:L[L.length-1].push(ue);break;case 24:case 536:Y={Name:ue.Name,Ref:Da(ue.rgce,i,null,L,X)},ue.itab>0&&(Y.Sheet=ue.itab-1),L.names.push(Y),L[0]||(L[0]=[],L[0].XTI=[]),L[L.length-1].push(ue),ue.Name=="_xlnm._FilterDatabase"&&ue.itab>0&&ue.rgce&&ue.rgce[0]&&ue.rgce[0][0]&&ue.rgce[0][0][0]=="PtgArea3d"&&(Q[ue.itab-1]={ref:Rr(ue.rgce[0][0][1][2])});break;case 22:X.ExternCount=ue;break;case 23:L.length==0&&(L[0]=[],L[0].XTI=[]),L[L.length-1].XTI=L[L.length-1].XTI.concat(ue),L.XTI=L.XTI.concat(ue);break;case 2196:if(X.biff<8)break;Y!=null&&(Y.Comment=ue[1]);break;case 18:s["!protect"]=ue;break;case 19:ue!==0&&X.WTF&&console.error("Password verifier: "+ue);break;case 133:a[ue.pos]=ue,X.snames.push(ue.name);break;case 10:{if(--K)break;if(i.e){if(i.e.r>0&&i.e.c>0){if(i.e.r--,i.e.c--,s["!ref"]=Rr(i),t.sheetRows&&t.sheetRows<=i.e.r){var He=i.e.r;i.e.r=t.sheetRows-1,s["!fullref"]=s["!ref"],s["!ref"]=Rr(i),i.e.r=He}i.e.r++,i.e.c++}ie.length>0&&(s["!merges"]=ie),q.length>0&&(s["!objects"]=q),ne.length>0&&(s["!cols"]=ne),M.length>0&&(s["!rows"]=M),R.Sheets.push(T)}d===""?f=s:n[d]=s,s=t.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(X.biff===8&&(X.biff={9:2,521:3,1033:4}[ae]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[ue.BIFFVer]||8),X.biffguess=ue.BIFFVer==0,ue.BIFFVer==0&&ue.dt==4096&&(X.biff=5,te=!0,Wo(X.codepage=28591)),X.biff==8&&ue.BIFFVer==0&&ue.dt==16&&(X.biff=2),K++)break;if(s=t.dense?[]:{},X.biff<8&&!te&&(te=!0,Wo(X.codepage=t.codepage||1252)),X.biff<5||ue.BIFFVer==0&&ue.dt==4096){d===""&&(d="Sheet1"),i={s:{r:0,c:0},e:{r:0,c:0}};var qe={pos:e.l-ge,name:d};a[qe.pos]=qe,X.snames.push(d)}else d=(a[ee]||{name:""}).name;ue.dt==32&&(s["!type"]="chart"),ue.dt==64&&(s["!type"]="macro"),ie=[],q=[],X.arrayf=k=[],ne=[],M=[],W=!1,T={Hidden:(a[ee]||{hs:0}).hs,name:d}}break;case 515:case 3:case 2:s["!type"]=="chart"&&(t.dense?(s[ue.r]||[])[ue.c]:s[br({c:ue.c,r:ue.r})])&&++ue.c,w={ixfe:ue.ixfe,XF:A[ue.ixfe]||{},v:ue.val,t:"n"},B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V({c:ue.c,r:ue.r},w,t);break;case 5:case 517:w={ixfe:ue.ixfe,XF:A[ue.ixfe],v:ue.val,t:ue.t},B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V({c:ue.c,r:ue.r},w,t);break;case 638:w={ixfe:ue.ixfe,XF:A[ue.ixfe],v:ue.rknum,t:"n"},B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V({c:ue.c,r:ue.r},w,t);break;case 189:for(var Xe=ue.c;Xe<=ue.C;++Xe){var Ve=ue.rkrec[Xe-ue.c][0];w={ixfe:Ve,XF:A[Ve],v:ue.rkrec[Xe-ue.c][1],t:"n"},B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V({c:Xe,r:ue.r},w,t)}break;case 6:case 518:case 1030:{if(ue.val=="String"){l=ue;break}if(w=C1(ue.val,ue.cell.ixfe,ue.tt),w.XF=A[w.ixfe],t.cellFormula){var It=ue.formula;if(It&&It[0]&&It[0][0]&&It[0][0][0]=="PtgExp"){var st=It[0][0][1][0],Ie=It[0][0][1][1],je=br({r:st,c:Ie});E[je]?w.f=""+Da(ue.formula,i,ue.cell,L,X):w.F=((t.dense?(s[st]||[])[Ie]:s[je])||{}).F}else w.f=""+Da(ue.formula,i,ue.cell,L,X)}B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V(ue.cell,w,t),l=ue}break;case 7:case 519:if(l)l.val=ue,w=C1(ue,l.cell.ixfe,"s"),w.XF=A[w.ixfe],t.cellFormula&&(w.f=""+Da(l.formula,i,l.cell,L,X)),B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V(l.cell,w,t),l=null;else throw new Error("String record expects Formula");break;case 33:case 545:{k.push(ue);var Ze=br(ue[0].s);if(y=t.dense?(s[ue[0].s.r]||[])[ue[0].s.c]:s[Ze],t.cellFormula&&y){if(!l||!Ze||!y)break;y.f=""+Da(ue[1],i,ue[0],L,X),y.F=Rr(ue[0])}}break;case 1212:{if(!t.cellFormula)break;if(g){if(!l)break;E[br(l.cell)]=ue[0],y=t.dense?(s[l.cell.r]||[])[l.cell.c]:s[br(l.cell)],(y||{}).f=""+Da(ue[0],i,p,L,X)}}break;case 253:w=C1(c[ue.isst].t,ue.ixfe,"s"),c[ue.isst].h&&(w.h=c[ue.isst].h),w.XF=A[w.ixfe],B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V({c:ue.c,r:ue.r},w,t);break;case 513:t.sheetStubs&&(w={ixfe:ue.ixfe,XF:A[ue.ixfe],t:"z"},B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V({c:ue.c,r:ue.r},w,t));break;case 190:if(t.sheetStubs)for(var bt=ue.c;bt<=ue.C;++bt){var mt=ue.ixfe[bt-ue.c];w={ixfe:mt,XF:A[mt],t:"z"},B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V({c:bt,r:ue.r},w,t)}break;case 214:case 516:case 4:w=C1(ue.val,ue.ixfe,"s"),w.XF=A[w.ixfe],B>0&&(w.z=z[w.ixfe>>8&63]),yl(w,t,r.opts.Date1904),V({c:ue.c,r:ue.r},w,t);break;case 0:case 512:K===1&&(i=ue);break;case 252:c=ue;break;case 1054:if(X.biff==4){z[B++]=ue[1];for(var $t=0;$t<B+163&&wr[$t]!=ue[1];++$t);$t>=163&&_c(ue[1],B+163)}else _c(ue[1],ue[0]);break;case 30:{z[B++]=ue;for(var Wt=0;Wt<B+163&&wr[Wt]!=ue;++Wt);Wt>=163&&_c(ue,B+163)}break;case 229:ie=ie.concat(ue);break;case 93:q[ue.cmo[0]]=X.lastobj=ue;break;case 438:X.lastobj.TxO=ue;break;case 127:X.lastobj.ImData=ue;break;case 440:for(b=ue[0].s.r;b<=ue[0].e.r;++b)for(_=ue[0].s.c;_<=ue[0].e.c;++_)y=t.dense?(s[b]||[])[_]:s[br({c:_,r:b})],y&&(y.l=ue[1]);break;case 2048:for(b=ue[0].s.r;b<=ue[0].e.r;++b)for(_=ue[0].s.c;_<=ue[0].e.c;++_)y=t.dense?(s[b]||[])[_]:s[br({c:_,r:b})],y&&y.l&&(y.l.Tooltip=ue[1]);break;case 28:{if(X.biff<=5&&X.biff>=2)break;y=t.dense?(s[ue[0].r]||[])[ue[0].c]:s[br(ue[0])];var lt=q[ue[2]];y||(t.dense?(s[ue[0].r]||(s[ue[0].r]=[]),y=s[ue[0].r][ue[0].c]={t:"z"}):y=s[br(ue[0])]={t:"z"},i.e.r=Math.max(i.e.r,ue[0].r),i.s.r=Math.min(i.s.r,ue[0].r),i.e.c=Math.max(i.e.c,ue[0].c),i.s.c=Math.min(i.s.c,ue[0].c)),y.c||(y.c=[]),v={a:ue[1],t:lt.TxO.t},y.c.push(v)}break;case 2173:pX(A[ue.ixfe],ue.ext);break;case 125:{if(!X.cellStyles)break;for(;ue.e>=ue.s;)ne[ue.e--]={width:ue.w/256,level:ue.level||0,hidden:!!(ue.flags&1)},W||(W=!0,jS(ue.w/256)),Uu(ne[ue.e+1])}break;case 520:{var Qe={};ue.level!=null&&(M[ue.r]=Qe,Qe.level=ue.level),ue.hidden&&(M[ue.r]=Qe,Qe.hidden=!0),ue.hpt&&(M[ue.r]=Qe,Qe.hpt=ue.hpt,Qe.hpx=h0(ue.hpt))}break;case 38:case 39:case 40:case 41:s["!margins"]||Xd(s["!margins"]={}),s["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[ae]]=ue;break;case 161:s["!margins"]||Xd(s["!margins"]={}),s["!margins"].header=ue.header,s["!margins"].footer=ue.footer;break;case 574:ue.RTL&&(R.Views[0].RTL=!0);break;case 146:P=ue;break;case 2198:Z=ue;break;case 140:N=ue;break;case 442:d?T.CodeName=ue||T.name:R.WBProps.CodeName=ue||"ThisWorkbook";break}}else _e||console.error("Missing Info for XLS Record 0x"+ae.toString(16)),e.l+=ge}return r.SheetNames=os(a).sort(function(yt,ft){return Number(yt)-Number(ft)}).map(function(yt){return a[yt].name}),t.bookSheets||(r.Sheets=n),!r.SheetNames.length&&f["!ref"]?(r.SheetNames.push("Sheet1"),r.Sheets&&(r.Sheets.Sheet1=f)):r.Preamble=f,r.Sheets&&Q.forEach(function(yt,ft){r.Sheets[r.SheetNames[ft]]["!autofilter"]=yt}),r.Strings=c,r.SSF=Ln(wr),X.enc&&(r.Encryption=X.enc),Z&&(r.Themes=Z),r.Metadata={},N!==void 0&&(r.Metadata.Country=N),L.names.length>0&&(R.Names=L.names),r.Workbook=R,r}var zm={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function jee(e,t,r){var n=mr.find(e,"/!DocumentSummaryInformation");if(n&&n.size>0)try{var s=qN(n,c2,zm.DSI);for(var a in s)t[a]=s[a]}catch(d){if(r.WTF)throw d}var i=mr.find(e,"/!SummaryInformation");if(i&&i.size>0)try{var l=qN(i,u2,zm.SI);for(var c in l)t[c]==null&&(t[c]=l[c])}catch(d){if(r.WTF)throw d}t.HeadingPairs&&t.TitlesOfParts&&(K8(t.HeadingPairs,t.TitlesOfParts,t,r),delete t.HeadingPairs,delete t.TitlesOfParts)}function Fee(e,t){var r=[],n=[],s=[],a=0,i,l=kN(c2,"n"),c=kN(u2,"n");if(e.Props)for(i=os(e.Props),a=0;a<i.length;++a)(Object.prototype.hasOwnProperty.call(l,i[a])?r:Object.prototype.hasOwnProperty.call(c,i[a])?n:s).push([i[a],e.Props[i[a]]]);if(e.Custprops)for(i=os(e.Custprops),a=0;a<i.length;++a)Object.prototype.hasOwnProperty.call(e.Props||{},i[a])||(Object.prototype.hasOwnProperty.call(l,i[a])?r:Object.prototype.hasOwnProperty.call(c,i[a])?n:s).push([i[a],e.Custprops[i[a]]]);var d=[];for(a=0;a<s.length;++a)eF.indexOf(s[a][0])>-1||V8.indexOf(s[a][0])>-1||s[a][1]!=null&&d.push(s[a]);n.length&&mr.utils.cfb_add(t,"/SummaryInformation",XN(n,zm.SI,c,u2)),(r.length||d.length)&&mr.utils.cfb_add(t,"/DocumentSummaryInformation",XN(r,zm.DSI,l,c2,d.length?d:null,zm.UDI))}function XF(e,t){t||(t={}),BS(t),iS(),t.codepage&&aS(t.codepage);var r,n;if(e.FullPaths){if(mr.find(e,"/encryption"))throw new Error("File is password-protected");r=mr.find(e,"!CompObj"),n=mr.find(e,"/Workbook")||mr.find(e,"/Book")}else{switch(t.type){case"base64":e=Bi(Wi(e));break;case"binary":e=Bi(e);break;case"buffer":break;case"array":Array.isArray(e)||(e=Array.prototype.slice.call(e));break}ya(e,0),n={content:e}}var s,a;if(r&&Tee(r),t.bookProps&&!t.bookSheets)s={};else{var i=Lr?"buffer":"array";if(n&&n.content)s=Aee(n.content,t);else if((a=mr.find(e,"PerfectOffice_MAIN"))&&a.content)s=qd.to_workbook(a.content,(t.type=i,t));else if((a=mr.find(e,"NativeContent_MAIN"))&&a.content)s=qd.to_workbook(a.content,(t.type=i,t));else throw(a=mr.find(e,"MN0"))&&a.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");t.bookVBA&&e.FullPaths&&mr.find(e,"/_VBA_PROJECT_CUR/VBA/dir")&&(s.vbaraw=HX(e))}var l={};return e.FullPaths&&jee(e,l,t),s.Props=s.Custprops=l,t.bookFiles&&(s.cfb=e),s}function Pee(e,t){var r=t||{},n=mr.utils.cfb_new({root:"R"}),s="/Workbook";switch(r.bookType||"xls"){case"xls":r.bookType="biff8";case"xla":r.bookType||(r.bookType="xla");case"biff8":s="/Workbook",r.biff=8;break;case"biff5":s="/Book",r.biff=5;break;default:throw new Error("invalid type "+r.bookType+" for XLS CFB")}return mr.utils.cfb_add(n,s,YF(e,r)),r.biff==8&&(e.Props||e.Custprops)&&Fee(e,n),r.biff==8&&e.vbaraw&&GX(n,mr.read(e.vbaraw,{type:typeof e.vbaraw=="string"?"binary":"buffer"})),n}var vp={0:{f:rJ},1:{f:uJ},2:{f:AJ},3:{f:yJ},4:{f:gJ},5:{f:TJ},6:{f:DJ},7:{f:bJ},8:{f:$J},9:{f:UJ},10:{f:LJ},11:{f:BJ},12:{f:fJ},13:{f:FJ},14:{f:wJ},15:{f:pJ},16:{f:$F},17:{f:MJ},18:{f:kJ},19:{f:wS},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:MZ},40:{},42:{},43:{f:Dq},44:{f:Pq},45:{f:Oq},46:{f:Bq},47:{f:Lq},48:{},49:{f:aG},50:{},51:{f:vX},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:dF},62:{f:RJ},63:{f:NX},64:{f:nZ},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:Wa,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:ZJ},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:lJ},148:{f:aJ,p:16},151:{f:KJ},152:{},153:{f:RZ},154:{},155:{},156:{f:FZ},157:{},158:{},159:{T:1,f:XK},160:{T:-1},161:{T:1,f:kf},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:WJ},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:xX},336:{T:-1},337:{f:bX,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:l2},357:{},358:{},359:{},360:{T:1},361:{},362:{f:uF},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:qJ},427:{f:XJ},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:QJ},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:oJ},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:GJ},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:l2},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:BX},633:{T:1},634:{T:-1},635:{T:1,f:OX},636:{T:-1},637:{f:cG},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:wZ},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:sZ},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},p2={6:{f:Kw},10:{f:_u},12:{f:As},13:{f:As},14:{f:ps},15:{f:ps},16:{f:Ma},17:{f:ps},18:{f:ps},19:{f:As},20:{f:t3},21:{f:t3},23:{f:uF},24:{f:n3},25:{f:ps},26:{},27:{},28:{f:sK},29:{},34:{f:ps},35:{f:r3},38:{f:Ma},39:{f:Ma},40:{f:Ma},41:{f:Ma},42:{f:ps},43:{f:ps},47:{f:pq},49:{f:FV},51:{f:As},60:{},61:{f:TV},64:{f:ps},65:{f:jV},66:{f:As},77:{},80:{},81:{},82:{},85:{f:As},89:{},90:{},91:{},92:{f:mV},93:{f:oK},94:{},95:{f:ps},96:{},97:{},99:{f:ps},125:{f:dF},128:{f:VV},129:{f:xV},130:{f:As},131:{f:ps},132:{f:ps},133:{f:yV},134:{},140:{f:mK},141:{f:As},144:{},146:{f:yK},151:{},152:{},153:{},154:{},155:{},156:{f:As},157:{},158:{},160:{f:CK},161:{f:_K},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:WV},190:{f:zV},193:{f:_u},197:{},198:{},199:{},200:{},201:{},202:{f:ps},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:As},220:{},221:{f:ps},222:{},224:{f:GV},225:{f:gV},226:{f:_u},227:{},229:{f:aK},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:wV},253:{f:RV},255:{f:bV},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:tF},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:ps},353:{f:_u},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:QV},431:{f:ps},432:{},433:{},434:{},437:{},438:{f:uK},439:{f:ps},440:{f:dK},441:{},442:{f:qp},443:{},444:{f:As},445:{},446:{},448:{f:_u},449:{f:CV,r:2},450:{f:_u},512:{f:JN},513:{f:kK},515:{f:XV},516:{f:IV},517:{f:e3},519:{f:TK},520:{f:SV},523:{},545:{f:s3},549:{f:QN},566:{},574:{f:NV},638:{f:$V},659:{},1048:{},1054:{f:OV},1084:{},1212:{f:tK},2048:{f:hK},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:b1},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:_u},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:vK,r:12},2173:{f:mX,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:ps,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:eK,r:12},2197:{},2198:{f:cX,r:12},2199:{},2200:{},2201:{},2202:{f:rK,r:12},2203:{f:_u},2204:{},2205:{},2206:{},2207:{},2211:{f:kV},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:As},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:bK},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:xK},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:JN},1:{},2:{f:FK},3:{f:AK},4:{f:NK},5:{f:e3},7:{f:RK},8:{},9:{f:b1},11:{},22:{f:As},30:{f:BV},31:{},32:{},33:{f:s3},36:{},37:{f:QN},50:{f:DK},62:{},52:{},67:{},68:{f:As},69:{},86:{},126:{},127:{f:EK},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:IK},223:{},234:{},354:{},421:{},518:{f:Kw},521:{f:b1},536:{f:n3},547:{f:r3},561:{},579:{},1030:{f:Kw},1033:{f:b1},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function Vt(e,t,r,n){var s=t;if(!isNaN(s)){var a=n||(r||[]).length||0,i=e.next(4);i.write_shift(2,s),i.write_shift(2,a),a>0&&xS(r)&&e.push(r)}}function Ree(e,t,r,n){var s=(r||[]).length||0;if(s<=8224)return Vt(e,t,r,s);var a=t;if(!isNaN(a)){for(var i=r.parts||[],l=0,c=0,d=0;d+(i[l]||8224)<=8224;)d+=i[l]||8224,l++;var f=e.next(4);for(f.write_shift(2,a),f.write_shift(2,d),e.push(r.slice(c,c+d)),c+=d;c<s;){for(f=e.next(4),f.write_shift(2,60),d=0;d+(i[l]||8224)<=8224;)d+=i[l]||8224,l++;f.write_shift(2,d),e.push(r.slice(c,c+d)),c+=d}}}function Jp(e,t,r){return e||(e=wt(7)),e.write_shift(2,t),e.write_shift(2,r),e.write_shift(2,0),e.write_shift(1,0),e}function Dee(e,t,r,n){var s=wt(9);return Jp(s,e,t),rF(r,n||"b",s),s}function Iee(e,t,r){var n=wt(8+2*r.length);return Jp(n,e,t),n.write_shift(1,r.length),n.write_shift(r.length,r,"sbcs"),n.l<n.length?n.slice(0,n.l):n}function Mee(e,t,r,n){if(t.v!=null)switch(t.t){case"d":case"n":var s=t.t=="d"?zs(On(t.v)):t.v;s==(s|0)&&s>=0&&s<65536?Vt(e,2,PK(r,n,s)):Vt(e,3,jK(r,n,s));return;case"b":case"e":Vt(e,5,Dee(r,n,t.v,t.t));return;case"s":case"str":Vt(e,4,Iee(r,n,(t.v||"").slice(0,255)));return}Vt(e,1,Jp(null,r,n))}function Oee(e,t,r,n){var s=Array.isArray(t),a=Jr(t["!ref"]||"A1"),i,l="",c=[];if(a.e.c>255||a.e.r>16383){if(n.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");a.e.c=Math.min(a.e.c,255),a.e.r=Math.min(a.e.c,16383),i=Rr(a)}for(var d=a.s.r;d<=a.e.r;++d){l=ys(d);for(var f=a.s.c;f<=a.e.c;++f){d===a.s.r&&(c[f]=Kn(f)),i=c[f]+l;var p=s?(t[d]||[])[f]:t[i];p&&Mee(e,p,d,f)}}}function Lee(e,t){for(var r=t||{},n=Ci(),s=0,a=0;a<e.SheetNames.length;++a)e.SheetNames[a]==r.sheet&&(s=a);if(s==0&&r.sheet&&e.SheetNames[0]!=r.sheet)throw new Error("Sheet not found: "+r.sheet);return Vt(n,r.biff==4?1033:r.biff==3?521:9,ES(e,16,r)),Oee(n,e.Sheets[e.SheetNames[s]],s,r),Vt(n,10),n.end()}function Bee(e,t,r){Vt(e,49,PV({sz:12,name:"Arial"},r))}function Uee(e,t,r){t&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)t[s]!=null&&Vt(e,1054,LV(s,t[s],r))})}function $ee(e,t){var r=wt(19);r.write_shift(4,2151),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,1),r.write_shift(4,0),Vt(e,2151,r),r=wt(39),r.write_shift(4,2152),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(2,1),r.write_shift(4,4),r.write_shift(2,0),oF(Jr(t["!ref"]||"A1"),r),r.write_shift(4,4),Vt(e,2152,r)}function Wee(e,t){for(var r=0;r<16;++r)Vt(e,224,ZN({numFmtId:0,style:!0},0,t));t.cellXfs.forEach(function(n){Vt(e,224,ZN(n,0,t))})}function zee(e,t){for(var r=0;r<t["!links"].length;++r){var n=t["!links"][r];Vt(e,440,fK(n)),n[1].Tooltip&&Vt(e,2048,gK(n))}delete t["!links"]}function Hee(e,t){if(t){var r=0;t.forEach(function(n,s){++r<=256&&n&&Vt(e,125,wK(ov(s,n),s))})}}function Gee(e,t,r,n,s){var a=16+Ju(s.cellXfs,t,s);if(t.v==null&&!t.bf){Vt(e,513,mf(r,n,a));return}if(t.bf)Vt(e,6,xQ(t,r,n,s,a));else switch(t.t){case"d":case"n":var i=t.t=="d"?zs(On(t.v)):t.v;Vt(e,515,YV(r,n,i,a));break;case"b":case"e":Vt(e,517,qV(r,n,t.v,a,s,t.t));break;case"s":case"str":if(s.bookSST){var l=IS(s.Strings,t.v,s.revStrings);Vt(e,253,DV(r,n,l,a))}else Vt(e,516,MV(r,n,(t.v||"").slice(0,255),a,s));break;default:Vt(e,513,mf(r,n,a))}}function Vee(e,t,r){var n=Ci(),s=r.SheetNames[e],a=r.Sheets[s]||{},i=(r||{}).Workbook||{},l=(i.Sheets||[])[e]||{},c=Array.isArray(a),d=t.biff==8,f,p="",g=[],y=Jr(a["!ref"]||"A1"),v=d?65536:16384;if(y.e.c>255||y.e.r>=v){if(t.WTF)throw new Error("Range "+(a["!ref"]||"A1")+" exceeds format limit A1:IV16384");y.e.c=Math.min(y.e.c,255),y.e.r=Math.min(y.e.c,v-1)}Vt(n,2057,ES(r,16,t)),Vt(n,13,fo(1)),Vt(n,12,fo(100)),Vt(n,15,ni(!0)),Vt(n,17,ni(!1)),Vt(n,16,hf(.001)),Vt(n,95,ni(!0)),Vt(n,42,ni(!1)),Vt(n,43,ni(!1)),Vt(n,130,fo(1)),Vt(n,128,KV()),Vt(n,131,ni(!1)),Vt(n,132,ni(!1)),d&&Hee(n,a["!cols"]),Vt(n,512,UV(y,t)),d&&(a["!links"]=[]);for(var _=y.s.r;_<=y.e.r;++_){p=ys(_);for(var b=y.s.c;b<=y.e.c;++b){_===y.s.r&&(g[b]=Kn(b)),f=g[b]+p;var E=c?(a[_]||[])[b]:a[f];E&&(Gee(n,E,_,b,t),d&&E.l&&a["!links"].push([f,E.l]))}}var k=l.CodeName||l.name||s;return d&&Vt(n,574,AV((i.Views||[])[0])),d&&(a["!merges"]||[]).length&&Vt(n,229,iK(a["!merges"])),d&&zee(n,a),Vt(n,442,nF(k)),d&&$ee(n,a),Vt(n,10),n.end()}function Kee(e,t,r){var n=Ci(),s=(e||{}).Workbook||{},a=s.Sheets||[],i=s.WBProps||{},l=r.biff==8,c=r.biff==5;if(Vt(n,2057,ES(e,5,r)),r.bookType=="xla"&&Vt(n,135),Vt(n,225,l?fo(1200):null),Vt(n,193,qG(2)),c&&Vt(n,191),c&&Vt(n,192),Vt(n,226),Vt(n,92,pV("SheetJS",r)),Vt(n,66,fo(l?1200:1252)),l&&Vt(n,353,fo(0)),l&&Vt(n,448),Vt(n,317,SK(e.SheetNames.length)),l&&e.vbaraw&&Vt(n,211),l&&e.vbaraw){var d=i.CodeName||"ThisWorkbook";Vt(n,442,nF(d))}Vt(n,156,fo(17)),Vt(n,25,ni(!1)),Vt(n,18,ni(!1)),Vt(n,19,fo(0)),l&&Vt(n,431,ni(!1)),l&&Vt(n,444,fo(0)),Vt(n,61,EV()),Vt(n,64,ni(!1)),Vt(n,141,fo(0)),Vt(n,34,ni(CZ(e)=="true")),Vt(n,14,ni(!0)),l&&Vt(n,439,ni(!1)),Vt(n,218,fo(0)),Bee(n,e,r),Uee(n,e.SSF,r),Wee(n,r),l&&Vt(n,352,ni(!1));var f=n.end(),p=Ci();l&&Vt(p,140,pK()),l&&r.Strings&&Ree(p,252,_V(r.Strings)),Vt(p,10);var g=p.end(),y=Ci(),v=0,_=0;for(_=0;_<e.SheetNames.length;++_)v+=(l?12:11)+(l?2:1)*e.SheetNames[_].length;var b=f.length+v+g.length;for(_=0;_<e.SheetNames.length;++_){var E=a[_]||{};Vt(y,133,vV({pos:b,hs:E.Hidden||0,dt:0,name:e.SheetNames[_]},r)),b+=t[_].length}var k=y.end();if(v!=k.length)throw new Error("BS8 "+v+" != "+k.length);var w=[];return f.length&&w.push(f),k.length&&w.push(k),g.length&&w.push(g),ta(w)}function qee(e,t){var r=t||{},n=[];e&&!e.SSF&&(e.SSF=Ln(wr)),e&&e.SSF&&(F0(),ev(e.SSF),r.revssf=rv(e.SSF),r.revssf[e.SSF[65535]]=0,r.ssf=e.SSF),r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,US(r),r.cellXfs=[],Ju(r.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var s=0;s<e.SheetNames.length;++s)n[n.length]=Vee(s,r,e);return n.unshift(Kee(e,n,r)),ta(n)}function YF(e,t){for(var r=0;r<=e.SheetNames.length;++r){var n=e.Sheets[e.SheetNames[r]];if(!(!n||!n["!ref"])){var s=Ti(n["!ref"]);s.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+e.SheetNames[r]+"' extends beyond column IV (255).  Data may be lost.")}}var a=t||{};switch(a.biff||2){case 8:case 5:return qee(e,t);case 4:case 3:case 2:return Lee(e,t)}throw new Error("invalid type "+a.bookType+" for BIFF")}function g3(e,t){var r=t||{},n=r.dense?[]:{};e=e.replace(/<!--.*?-->/g,"");var s=e.match(/<table/i);if(!s)throw new Error("Invalid HTML: could not find <table>");var a=e.match(/<\/table/i),i=s.index,l=a&&a.index||e.length,c=PH(e.slice(i,l),/(:?<tr[^>]*>)/i,"<tr>"),d=-1,f=0,p=0,g=0,y={s:{r:1e7,c:1e7},e:{r:0,c:0}},v=[];for(i=0;i<c.length;++i){var _=c[i].trim(),b=_.slice(0,3).toLowerCase();if(b=="<tr"){if(++d,r.sheetRows&&r.sheetRows<=d){--d;break}f=0;continue}if(!(b!="<td"&&b!="<th")){var E=_.split(/<\/t[dh]>/i);for(l=0;l<E.length;++l){var k=E[l].trim();if(k.match(/<t[dh]/i)){for(var w=k,N=0;w.charAt(0)=="<"&&(N=w.indexOf(">"))>-1;)w=w.slice(N+1);for(var A=0;A<v.length;++A){var P=v[A];P.s.c==f&&P.s.r<d&&d<=P.e.r&&(f=P.e.c+1,A=-1)}var R=kr(k.slice(0,k.indexOf(">")));g=R.colspan?+R.colspan:1,((p=+R.rowspan)>1||g>1)&&v.push({s:{r:d,c:f},e:{r:d+(p||1)-1,c:f+g-1}});var T=R.t||R["data-t"]||"";if(!w.length){f+=g;continue}if(w=w8(w),y.s.r>d&&(y.s.r=d),y.e.r<d&&(y.e.r=d),y.s.c>f&&(y.s.c=f),y.e.c<f&&(y.e.c=f),!w.length){f+=g;continue}var D={t:"s",v:w};r.raw||!w.trim().length||T=="s"||(w==="TRUE"?D={t:"b",v:!0}:w==="FALSE"?D={t:"b",v:!1}:isNaN(Go(w))?isNaN(d0(w).getDate())||(D={t:"d",v:On(w)},r.cellDates||(D={t:"n",v:zs(D.v)}),D.z=r.dateNF||wr[14]):D={t:"n",v:Go(w)}),r.dense?(n[d]||(n[d]=[]),n[d][f]=D):n[br({r:d,c:f})]=D,f+=g}}}}return n["!ref"]=Rr(y),v.length&&(n["!merges"]=v),n}function Xee(e,t,r,n){for(var s=e["!merges"]||[],a=[],i=t.s.c;i<=t.e.c;++i){for(var l=0,c=0,d=0;d<s.length;++d)if(!(s[d].s.r>r||s[d].s.c>i)&&!(s[d].e.r<r||s[d].e.c<i)){if(s[d].s.r<r||s[d].s.c<i){l=-1;break}l=s[d].e.r-s[d].s.r+1,c=s[d].e.c-s[d].s.c+1;break}if(!(l<0)){var f=br({r,c:i}),p=n.dense?(e[r]||[])[i]:e[f],g=p&&p.v!=null&&(p.h||gS(p.w||(Ec(p),p.w)||""))||"",y={};l>1&&(y.rowspan=l),c>1&&(y.colspan=c),n.editable?g='<span contenteditable="true">'+g+"</span>":p&&(y["data-t"]=p&&p.t||"z",p.v!=null&&(y["data-v"]=p.v),p.z!=null&&(y["data-z"]=p.z),p.l&&(p.l.Target||"#").charAt(0)!="#"&&(g='<a href="'+p.l.Target+'">'+g+"</a>")),y.id=(n.id||"sjs")+"-"+f,a.push(Gt("td",g,y))}}var v="<tr>";return v+a.join("")+"</tr>"}var Yee='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',Qee="</body></html>";function Jee(e,t){var r=e.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!r||r.length==0)throw new Error("Invalid HTML: could not find <table>");if(r.length==1)return Qu(g3(r[0],t),t);var n=zS();return r.forEach(function(s,a){HS(n,g3(s,t),"Sheet"+(a+1))}),n}function Zee(e,t,r){var n=[];return n.join("")+"<table"+(r&&r.id?' id="'+r.id+'"':"")+">"}function QF(e,t){var r=t||{},n=r.header!=null?r.header:Yee,s=r.footer!=null?r.footer:Qee,a=[n],i=Ti(e["!ref"]);r.dense=Array.isArray(e),a.push(Zee(e,i,r));for(var l=i.s.r;l<=i.e.r;++l)a.push(Xee(e,i,l,r));return a.push("</table>"+s),a.join("")}function JF(e,t,r){var n=r||{},s=0,a=0;if(n.origin!=null)if(typeof n.origin=="number")s=n.origin;else{var i=typeof n.origin=="string"?qn(n.origin):n.origin;s=i.r,a=i.c}var l=t.getElementsByTagName("tr"),c=Math.min(n.sheetRows||1e7,l.length),d={s:{r:0,c:0},e:{r:s,c:a}};if(e["!ref"]){var f=Ti(e["!ref"]);d.s.r=Math.min(d.s.r,f.s.r),d.s.c=Math.min(d.s.c,f.s.c),d.e.r=Math.max(d.e.r,f.e.r),d.e.c=Math.max(d.e.c,f.e.c),s==-1&&(d.e.r=s=f.e.r+1)}var p=[],g=0,y=e["!rows"]||(e["!rows"]=[]),v=0,_=0,b=0,E=0,k=0,w=0;for(e["!cols"]||(e["!cols"]=[]);v<l.length&&_<c;++v){var N=l[v];if(m3(N)){if(n.display)continue;y[_]={hidden:!0}}var A=N.children;for(b=E=0;b<A.length;++b){var P=A[b];if(!(n.display&&m3(P))){var R=P.hasAttribute("data-v")?P.getAttribute("data-v"):P.hasAttribute("v")?P.getAttribute("v"):w8(P.innerHTML),T=P.getAttribute("data-z")||P.getAttribute("z");for(g=0;g<p.length;++g){var D=p[g];D.s.c==E+a&&D.s.r<_+s&&_+s<=D.e.r&&(E=D.e.c+1-a,g=-1)}w=+P.getAttribute("colspan")||1,((k=+P.getAttribute("rowspan")||1)>1||w>1)&&p.push({s:{r:_+s,c:E+a},e:{r:_+s+(k||1)-1,c:E+a+(w||1)-1}});var I={t:"s",v:R},V=P.getAttribute("data-t")||P.getAttribute("t")||"";R!=null&&(R.length==0?I.t=V||"z":n.raw||R.trim().length==0||V=="s"||(R==="TRUE"?I={t:"b",v:!0}:R==="FALSE"?I={t:"b",v:!1}:isNaN(Go(R))?isNaN(d0(R).getDate())||(I={t:"d",v:On(R)},n.cellDates||(I={t:"n",v:zs(I.v)}),I.z=n.dateNF||wr[14]):I={t:"n",v:Go(R)})),I.z===void 0&&T!=null&&(I.z=T);var X="",Z=P.getElementsByTagName("A");if(Z&&Z.length)for(var ie=0;ie<Z.length&&!(Z[ie].hasAttribute("href")&&(X=Z[ie].getAttribute("href"),X.charAt(0)!="#"));++ie);X&&X.charAt(0)!="#"&&(I.l={Target:X}),n.dense?(e[_+s]||(e[_+s]=[]),e[_+s][E+a]=I):e[br({c:E+a,r:_+s})]=I,d.e.c<E+a&&(d.e.c=E+a),E+=w}}++_}return p.length&&(e["!merges"]=(e["!merges"]||[]).concat(p)),d.e.r=Math.max(d.e.r,_-1+s),e["!ref"]=Rr(d),_>=c&&(e["!fullref"]=Rr((d.e.r=l.length-v+_-1+s,d))),e}function ZF(e,t){var r=t||{},n=r.dense?[]:{};return JF(n,e,t)}function ete(e,t){return Qu(ZF(e,t),t)}function m3(e){var t="",r=tte(e);return r&&(t=r(e).getPropertyValue("display")),t||(t=e.style&&e.style.display),t==="none"}function tte(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function rte(e){var t=e.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(n,s){return Array(parseInt(s,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),r=Qr(t.replace(/<[^>]*>/g,""));return[r]}var p3={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function eP(e,t){var r=t||{},n=mS(e),s=[],a,i,l={name:""},c="",d=0,f,p,g={},y=[],v=r.dense?[]:{},_,b,E={value:""},k="",w=0,N=[],A=-1,P=-1,R={s:{r:1e6,c:1e7},e:{r:0,c:0}},T=0,D={},I=[],V={},X=0,Z=0,ie=[],q=1,ne=1,M=[],W={Names:[]},L={},H=["",""],K=[],B={},z="",Q=0,Y=!1,te=!1,ee=0;for(hp.lastIndex=0,n=n.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");_=hp.exec(n);)switch(_[3]=_[3].replace(/_.*$/,"")){case"table":case"工作表":_[1]==="/"?(R.e.c>=R.s.c&&R.e.r>=R.s.r?v["!ref"]=Rr(R):v["!ref"]="A1:A1",r.sheetRows>0&&r.sheetRows<=R.e.r&&(v["!fullref"]=v["!ref"],R.e.r=r.sheetRows-1,v["!ref"]=Rr(R)),I.length&&(v["!merges"]=I),ie.length&&(v["!rows"]=ie),f.name=f.名称||f.name,typeof JSON<"u"&&JSON.stringify(f),y.push(f.name),g[f.name]=v,te=!1):_[0].charAt(_[0].length-2)!=="/"&&(f=kr(_[0],!1),A=P=-1,R.s.r=R.s.c=1e7,R.e.r=R.e.c=0,v=r.dense?[]:{},I=[],ie=[],te=!0);break;case"table-row-group":_[1]==="/"?--T:++T;break;case"table-row":case"行":if(_[1]==="/"){A+=q,q=1;break}if(p=kr(_[0],!1),p.行号?A=p.行号-1:A==-1&&(A=0),q=+p["number-rows-repeated"]||1,q<10)for(ee=0;ee<q;++ee)T>0&&(ie[A+ee]={level:T});P=-1;break;case"covered-table-cell":_[1]!=="/"&&++P,r.sheetStubs&&(r.dense?(v[A]||(v[A]=[]),v[A][P]={t:"z"}):v[br({r:A,c:P})]={t:"z"}),k="",N=[];break;case"table-cell":case"数据":if(_[0].charAt(_[0].length-2)==="/")++P,E=kr(_[0],!1),ne=parseInt(E["number-columns-repeated"]||"1",10),b={t:"z",v:null},E.formula&&r.cellFormula!=!1&&(b.f=d3(Qr(E.formula))),(E.数据类型||E["value-type"])=="string"&&(b.t="s",b.v=Qr(E["string-value"]||""),r.dense?(v[A]||(v[A]=[]),v[A][P]=b):v[br({r:A,c:P})]=b),P+=ne-1;else if(_[1]!=="/"){++P,k="",w=0,N=[],ne=1;var ae=q?A+q-1:A;if(P>R.e.c&&(R.e.c=P),P<R.s.c&&(R.s.c=P),A<R.s.r&&(R.s.r=A),ae>R.e.r&&(R.e.r=ae),E=kr(_[0],!1),K=[],B={},b={t:E.数据类型||E["value-type"],v:null},r.cellFormula)if(E.formula&&(E.formula=Qr(E.formula)),E["number-matrix-columns-spanned"]&&E["number-matrix-rows-spanned"]&&(X=parseInt(E["number-matrix-rows-spanned"],10)||0,Z=parseInt(E["number-matrix-columns-spanned"],10)||0,V={s:{r:A,c:P},e:{r:A+X-1,c:P+Z-1}},b.F=Rr(V),M.push([V,b.F])),E.formula)b.f=d3(E.formula);else for(ee=0;ee<M.length;++ee)A>=M[ee][0].s.r&&A<=M[ee][0].e.r&&P>=M[ee][0].s.c&&P<=M[ee][0].e.c&&(b.F=M[ee][1]);switch((E["number-columns-spanned"]||E["number-rows-spanned"])&&(X=parseInt(E["number-rows-spanned"],10)||0,Z=parseInt(E["number-columns-spanned"],10)||0,V={s:{r:A,c:P},e:{r:A+X-1,c:P+Z-1}},I.push(V)),E["number-columns-repeated"]&&(ne=parseInt(E["number-columns-repeated"],10)),b.t){case"boolean":b.t="b",b.v=Rn(E["boolean-value"]);break;case"float":b.t="n",b.v=parseFloat(E.value);break;case"percentage":b.t="n",b.v=parseFloat(E.value);break;case"currency":b.t="n",b.v=parseFloat(E.value);break;case"date":b.t="d",b.v=On(E["date-value"]),r.cellDates||(b.t="n",b.v=zs(b.v)),b.z="m/d/yy";break;case"time":b.t="n",b.v=AH(E["time-value"])/86400,r.cellDates&&(b.t="d",b.v=nv(b.v)),b.z="HH:MM:SS";break;case"number":b.t="n",b.v=parseFloat(E.数据数值);break;default:if(b.t==="string"||b.t==="text"||!b.t)b.t="s",E["string-value"]!=null&&(k=Qr(E["string-value"]),N=[]);else throw new Error("Unsupported value type "+b.t)}}else{if(Y=!1,b.t==="s"&&(b.v=k||"",N.length&&(b.R=N),Y=w==0),L.Target&&(b.l=L),K.length>0&&(b.c=K,K=[]),k&&r.cellText!==!1&&(b.w=k),Y&&(b.t="z",delete b.v),(!Y||r.sheetStubs)&&!(r.sheetRows&&r.sheetRows<=A))for(var ge=0;ge<q;++ge){if(ne=parseInt(E["number-columns-repeated"]||"1",10),r.dense)for(v[A+ge]||(v[A+ge]=[]),v[A+ge][P]=ge==0?b:Ln(b);--ne>0;)v[A+ge][P+ne]=Ln(b);else for(v[br({r:A+ge,c:P})]=b;--ne>0;)v[br({r:A+ge,c:P+ne})]=Ln(b);R.e.c<=P&&(R.e.c=P)}ne=parseInt(E["number-columns-repeated"]||"1",10),P+=ne-1,ne=0,b={},k="",N=[]}L={};break;case"document":case"document-content":case"电子表格文档":case"spreadsheet":case"主体":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(_[1]==="/"){if((a=s.pop())[0]!==_[3])throw"Bad state: "+a}else _[0].charAt(_[0].length-2)!=="/"&&s.push([_[3],!0]);break;case"annotation":if(_[1]==="/"){if((a=s.pop())[0]!==_[3])throw"Bad state: "+a;B.t=k,N.length&&(B.R=N),B.a=z,K.push(B)}else _[0].charAt(_[0].length-2)!=="/"&&s.push([_[3],!1]);z="",Q=0,k="",w=0,N=[];break;case"creator":_[1]==="/"?z=n.slice(Q,_.index):Q=_.index+_[0].length;break;case"meta":case"元数据":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(_[1]==="/"){if((a=s.pop())[0]!==_[3])throw"Bad state: "+a}else _[0].charAt(_[0].length-2)!=="/"&&s.push([_[3],!1]);k="",w=0,N=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(_[1]==="/"){if(D[l.name]=c,(a=s.pop())[0]!==_[3])throw"Bad state: "+a}else _[0].charAt(_[0].length-2)!=="/"&&(c="",l=kr(_[0],!1),s.push([_[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(s[s.length-1][0]){case"time-style":case"date-style":i=kr(_[0],!1),c+=p3[_[3]][i.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(s[s.length-1][0]){case"time-style":case"date-style":i=kr(_[0],!1),c+=p3[_[3]][i.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(_[0].slice(-2)==="/>")break;if(_[1]==="/")switch(s[s.length-1][0]){case"number-style":case"date-style":case"time-style":c+=n.slice(d,_.index);break}else d=_.index+_[0].length;break;case"named-range":i=kr(_[0],!1),H=qw(i["cell-range-address"]);var _e={Name:i.name,Ref:H[0]+"!"+H[1]};te&&(_e.Sheet=y.length),W.Names.push(_e);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"电子表格":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"文本串":if(["master-styles"].indexOf(s[s.length-1][0])>-1)break;if(_[1]==="/"&&(!E||!E["string-value"])){var Me=rte(n.slice(w,_.index));k=(k.length>0?k+`
`:"")+Me[0]}else kr(_[0],!1),w=_.index+_[0].length;break;case"s":break;case"database-range":if(_[1]==="/")break;try{H=qw(kr(_[0])["target-range-address"]),g[H[0]]["!autofilter"]={ref:H[1]}}catch{}break;case"date":break;case"object":break;case"title":case"标题":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(_[1]!=="/"){if(L=kr(_[0],!1),!L.href)break;L.Target=Qr(L.href),delete L.href,L.Target.charAt(0)=="#"&&L.Target.indexOf(".")>-1?(H=qw(L.Target.slice(1)),L.Target="#"+H[0]+"!"+H[1]):L.Target.match(/^\.\.[\\\/]/)&&(L.Target=L.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(_[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"表:":case"字:":break;default:if(r.WTF)throw new Error(_)}}var ue={Sheets:g,SheetNames:y,Workbook:W};return r.bookSheets&&delete ue.Sheets,ue}function x3(e,t){t=t||{},uo(e,"META-INF/manifest.xml")&&AG(Ns(e,"META-INF/manifest.xml"),t);var r=Ui(e,"content.xml");if(!r)throw new Error("Missing content.xml in ODS / UOF file");var n=eP(bn(r),t);return uo(e,"meta.xml")&&(n.Props=H8(Ns(e,"meta.xml"))),n}function y3(e,t){return eP(e,t)}var nte=(function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+fp({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return ws+t}})(),v3=(function(){var e=function(a){return pn(a).replace(/  +/g,function(i){return'<text:s text:c="'+i.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},t=`          <table:table-cell />
`,r=`          <table:covered-table-cell/>
`,n=function(a,i,l){var c=[];c.push('      <table:table table:name="'+pn(i.SheetNames[l])+`" table:style-name="ta1">
`);var d=0,f=0,p=Ti(a["!ref"]||"A1"),g=a["!merges"]||[],y=0,v=Array.isArray(a);if(a["!cols"])for(f=0;f<=p.e.c;++f)c.push("        <table:table-column"+(a["!cols"][f]?' table:style-name="co'+a["!cols"][f].ods+'"':"")+`></table:table-column>
`);var _="",b=a["!rows"]||[];for(d=0;d<p.s.r;++d)_=b[d]?' table:style-name="ro'+b[d].ods+'"':"",c.push("        <table:table-row"+_+`></table:table-row>
`);for(;d<=p.e.r;++d){for(_=b[d]?' table:style-name="ro'+b[d].ods+'"':"",c.push("        <table:table-row"+_+`>
`),f=0;f<p.s.c;++f)c.push(t);for(;f<=p.e.c;++f){var E=!1,k={},w="";for(y=0;y!=g.length;++y)if(!(g[y].s.c>f)&&!(g[y].s.r>d)&&!(g[y].e.c<f)&&!(g[y].e.r<d)){(g[y].s.c!=f||g[y].s.r!=d)&&(E=!0),k["table:number-columns-spanned"]=g[y].e.c-g[y].s.c+1,k["table:number-rows-spanned"]=g[y].e.r-g[y].s.r+1;break}if(E){c.push(r);continue}var N=br({r:d,c:f}),A=v?(a[d]||[])[f]:a[N];if(A&&A.f&&(k["table:formula"]=pn(SQ(A.f)),A.F&&A.F.slice(0,N.length)==N)){var P=Ti(A.F);k["table:number-matrix-columns-spanned"]=P.e.c-P.s.c+1,k["table:number-matrix-rows-spanned"]=P.e.r-P.s.r+1}if(!A){c.push(t);continue}switch(A.t){case"b":w=A.v?"TRUE":"FALSE",k["office:value-type"]="boolean",k["office:boolean-value"]=A.v?"true":"false";break;case"n":w=A.w||String(A.v||0),k["office:value-type"]="float",k["office:value"]=A.v||0;break;case"s":case"str":w=A.v==null?"":A.v,k["office:value-type"]="string";break;case"d":w=A.w||On(A.v).toISOString(),k["office:value-type"]="date",k["office:date-value"]=On(A.v).toISOString(),k["table:style-name"]="ce1";break;default:c.push(t);continue}var R=e(w);if(A.l&&A.l.Target){var T=A.l.Target;T=T.charAt(0)=="#"?"#"+kQ(T.slice(1)):T,T.charAt(0)!="#"&&!T.match(/^\w+:/)&&(T="../"+T),R=Gt("text:a",R,{"xlink:href":T.replace(/&/g,"&amp;")})}c.push("          "+Gt("table:table-cell",Gt("text:p",R,{}),k)+`
`)}c.push(`        </table:table-row>
`)}return c.push(`      </table:table>
`),c.join("")},s=function(a,i){a.push(` <office:automatic-styles>
`),a.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),a.push(`   <number:month number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:day number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:year/>
`),a.push(`  </number:date-style>
`);var l=0;i.SheetNames.map(function(d){return i.Sheets[d]}).forEach(function(d){if(d&&d["!cols"]){for(var f=0;f<d["!cols"].length;++f)if(d["!cols"][f]){var p=d["!cols"][f];if(p.width==null&&p.wpx==null&&p.wch==null)continue;Uu(p),p.ods=l;var g=d["!cols"][f].wpx+"px";a.push('  <style:style style:name="co'+l+`" style:family="table-column">
`),a.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+g+`"/>
`),a.push(`  </style:style>
`),++l}}});var c=0;i.SheetNames.map(function(d){return i.Sheets[d]}).forEach(function(d){if(d&&d["!rows"]){for(var f=0;f<d["!rows"].length;++f)if(d["!rows"][f]){d["!rows"][f].ods=c;var p=d["!rows"][f].hpx+"px";a.push('  <style:style style:name="ro'+c+`" style:family="table-row">
`),a.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+p+`"/>
`),a.push(`  </style:style>
`),++c}}}),a.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),a.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),a.push(`  </style:style>
`),a.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),a.push(` </office:automatic-styles>
`)};return function(i,l){var c=[ws],d=fp({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),f=fp({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});l.bookType=="fods"?(c.push("<office:document"+d+f+`>
`),c.push(z8().replace(/office:document-meta/g,"office:meta"))):c.push("<office:document-content"+d+`>
`),s(c,i),c.push(`  <office:body>
`),c.push(`    <office:spreadsheet>
`);for(var p=0;p!=i.SheetNames.length;++p)c.push(n(i.Sheets[i.SheetNames[p]],i,p));return c.push(`    </office:spreadsheet>
`),c.push(`  </office:body>
`),l.bookType=="fods"?c.push("</office:document>"):c.push("</office:document-content>"),c.join("")}})();function tP(e,t){if(t.bookType=="fods")return v3(e,t);var r=dS(),n="",s=[],a=[];return n="mimetype",Ir(r,n,"application/vnd.oasis.opendocument.spreadsheet"),n="content.xml",Ir(r,n,v3(e,t)),s.push([n,"text/xml"]),a.push([n,"ContentFile"]),n="styles.xml",Ir(r,n,nte(e,t)),s.push([n,"text/xml"]),a.push([n,"StylesFile"]),n="meta.xml",Ir(r,n,ws+z8()),s.push([n,"text/xml"]),a.push([n,"MetadataFile"]),n="manifest.rdf",Ir(r,n,PG(a)),s.push([n,"application/rdf+xml"]),n="META-INF/manifest.xml",Ir(r,n,jG(s)),r}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function pf(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function x2(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):bn(Yu(e))}function ste(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Bi(Tl(e))}function ate(e,t){e:for(var r=0;r<=e.length-t.length;++r){for(var n=0;n<t.length;++n)if(e[r+n]!=t[n])continue e;return!0}return!1}function Wu(e){var t=e.reduce(function(s,a){return s+a.length},0),r=new Uint8Array(t),n=0;return e.forEach(function(s){r.set(s,n),n+=s.length}),r}function w3(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>>24}function ite(e,t){for(var r=(e[t+15]&127)<<7|e[t+14]>>1,n=e[t+14]&1,s=t+13;s>=t;--s)n=n*256+e[s];return(e[t+15]&128?-n:n)*Math.pow(10,r-6176)}function ote(e,t,r){var n=Math.floor(r==0?0:Math.LOG10E*Math.log(Math.abs(r)))+6176-20,s=r/Math.pow(10,n-6176);e[t+15]|=n>>7,e[t+14]|=(n&127)<<1;for(var a=0;s>=1;++a,s/=256)e[t+a]=s&255;e[t+15]|=r>=0?0:128}function wp(e,t){var r=t?t[0]:0,n=e[r]&127;e:if(e[r++]>=128&&(n|=(e[r]&127)<<7,e[r++]<128||(n|=(e[r]&127)<<14,e[r++]<128)||(n|=(e[r]&127)<<21,e[r++]<128)||(n+=(e[r]&127)*Math.pow(2,28),++r,e[r++]<128)||(n+=(e[r]&127)*Math.pow(2,35),++r,e[r++]<128)||(n+=(e[r]&127)*Math.pow(2,42),++r,e[r++]<128)))break e;return t&&(t[0]=r),n}function hn(e){var t=new Uint8Array(7);t[0]=e&127;var r=1;e:if(e>127){if(t[r-1]|=128,t[r]=e>>7&127,++r,e<=16383||(t[r-1]|=128,t[r]=e>>14&127,++r,e<=2097151)||(t[r-1]|=128,t[r]=e>>21&127,++r,e<=268435455)||(t[r-1]|=128,t[r]=e/256>>>21&127,++r,e<=34359738367)||(t[r-1]|=128,t[r]=e/65536>>>21&127,++r,e<=4398046511103))break e;t[r-1]|=128,t[r]=e/16777216>>>21&127,++r}return t.slice(0,r)}function is(e){var t=0,r=e[t]&127;e:if(e[t++]>=128){if(r|=(e[t]&127)<<7,e[t++]<128||(r|=(e[t]&127)<<14,e[t++]<128)||(r|=(e[t]&127)<<21,e[t++]<128))break e;r|=(e[t]&127)<<28}return r}function tn(e){for(var t=[],r=[0];r[0]<e.length;){var n=r[0],s=wp(e,r),a=s&7;s=Math.floor(s/8);var i=0,l;if(s==0)break;switch(a){case 0:{for(var c=r[0];e[r[0]++]>=128;);l=e.slice(c,r[0])}break;case 5:i=4,l=e.slice(r[0],r[0]+i),r[0]+=i;break;case 1:i=8,l=e.slice(r[0],r[0]+i),r[0]+=i;break;case 2:i=wp(e,r),l=e.slice(r[0],r[0]+i),r[0]+=i;break;case 3:case 4:default:throw new Error("PB Type ".concat(a," for Field ").concat(s," at offset ").concat(n))}var d={data:l,type:a};t[s]==null?t[s]=[d]:t[s].push(d)}return t}function ma(e){var t=[];return e.forEach(function(r,n){r.forEach(function(s){s.data&&(t.push(hn(n*8+s.type)),s.type==2&&t.push(hn(s.data.length)),t.push(s.data))})}),Wu(t)}function LS(e,t){return e?.map(function(r){return t(r.data)})||[]}function oo(e){for(var t,r=[],n=[0];n[0]<e.length;){var s=wp(e,n),a=tn(e.slice(n[0],n[0]+s));n[0]+=s;var i={id:is(a[1][0].data),messages:[]};a[2].forEach(function(l){var c=tn(l.data),d=is(c[3][0].data);i.messages.push({meta:c,data:e.slice(n[0],n[0]+d)}),n[0]+=d}),(t=a[3])!=null&&t[0]&&(i.merge=is(a[3][0].data)>>>0>0),r.push(i)}return r}function Th(e){var t=[];return e.forEach(function(r){var n=[];n[1]=[{data:hn(r.id),type:0}],n[2]=[],r.merge!=null&&(n[3]=[{data:hn(+!!r.merge),type:0}]);var s=[];r.messages.forEach(function(i){s.push(i.data),i.meta[3]=[{type:0,data:hn(i.data.length)}],n[2].push({data:ma(i.meta),type:2})});var a=ma(n);t.push(hn(a.length)),t.push(a),s.forEach(function(i){return t.push(i)})}),Wu(t)}function lte(e,t){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var r=[0],n=wp(t,r),s=[];r[0]<t.length;){var a=t[r[0]]&3;if(a==0){var i=t[r[0]++]>>2;if(i<60)++i;else{var l=i-59;i=t[r[0]],l>1&&(i|=t[r[0]+1]<<8),l>2&&(i|=t[r[0]+2]<<16),l>3&&(i|=t[r[0]+3]<<24),i>>>=0,i++,r[0]+=l}s.push(t.slice(r[0],r[0]+i)),r[0]+=i;continue}else{var c=0,d=0;if(a==1?(d=(t[r[0]]>>2&7)+4,c=(t[r[0]++]&224)<<3,c|=t[r[0]++]):(d=(t[r[0]++]>>2)+1,a==2?(c=t[r[0]]|t[r[0]+1]<<8,r[0]+=2):(c=(t[r[0]]|t[r[0]+1]<<8|t[r[0]+2]<<16|t[r[0]+3]<<24)>>>0,r[0]+=4)),s=[Wu(s)],c==0)throw new Error("Invalid offset 0");if(c>s[0].length)throw new Error("Invalid offset beyond length");if(d>=c)for(s.push(s[0].slice(-c)),d-=c;d>=s[s.length-1].length;)s.push(s[s.length-1]),d-=s[s.length-1].length;s.push(s[0].slice(-c,-c+d))}}var f=Wu(s);if(f.length!=n)throw new Error("Unexpected length: ".concat(f.length," != ").concat(n));return f}function lo(e){for(var t=[],r=0;r<e.length;){var n=e[r++],s=e[r]|e[r+1]<<8|e[r+2]<<16;r+=3,t.push(lte(n,e.slice(r,r+s))),r+=s}if(r!==e.length)throw new Error("data is not a valid framed stream!");return Wu(t)}function Eh(e){for(var t=[],r=0;r<e.length;){var n=Math.min(e.length-r,268435455),s=new Uint8Array(4);t.push(s);var a=hn(n),i=a.length;t.push(a),n<=60?(i++,t.push(new Uint8Array([n-1<<2]))):n<=256?(i+=2,t.push(new Uint8Array([240,n-1&255]))):n<=65536?(i+=3,t.push(new Uint8Array([244,n-1&255,n-1>>8&255]))):n<=16777216?(i+=4,t.push(new Uint8Array([248,n-1&255,n-1>>8&255,n-1>>16&255]))):n<=4294967296&&(i+=5,t.push(new Uint8Array([252,n-1&255,n-1>>8&255,n-1>>16&255,n-1>>>24&255]))),t.push(e.slice(r,r+n)),i+=n,s[0]=0,s[1]=i&255,s[2]=i>>8&255,s[3]=i>>16&255,r+=n}return Wu(t)}function cte(e,t,r,n){var s=pf(e),a=s.getUint32(4,!0),i=(n>1?12:8)+w3(a&(n>1?3470:398))*4,l=-1,c=-1,d=NaN,f=new Date(2001,0,1);a&512&&(l=s.getUint32(i,!0),i+=4),i+=w3(a&(n>1?12288:4096))*4,a&16&&(c=s.getUint32(i,!0),i+=4),a&32&&(d=s.getFloat64(i,!0),i+=8),a&64&&(f.setTime(f.getTime()+s.getFloat64(i,!0)*1e3),i+=8);var p;switch(e[2]){case 0:break;case 2:p={t:"n",v:d};break;case 3:p={t:"s",v:t[c]};break;case 5:p={t:"d",v:f};break;case 6:p={t:"b",v:d>0};break;case 7:p={t:"n",v:d/86400};break;case 8:p={t:"e",v:0};break;case 9:if(l>-1)p={t:"s",v:r[l]};else if(c>-1)p={t:"s",v:t[c]};else if(!isNaN(d))p={t:"n",v:d};else throw new Error("Unsupported cell type ".concat(e.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(e.slice(0,4)))}return p}function ute(e,t,r){var n=pf(e),s=n.getUint32(8,!0),a=12,i=-1,l=-1,c=NaN,d=NaN,f=new Date(2001,0,1);s&1&&(c=ite(e,a),a+=16),s&2&&(d=n.getFloat64(a,!0),a+=8),s&4&&(f.setTime(f.getTime()+n.getFloat64(a,!0)*1e3),a+=8),s&8&&(l=n.getUint32(a,!0),a+=4),s&16&&(i=n.getUint32(a,!0),a+=4);var p;switch(e[1]){case 0:break;case 2:p={t:"n",v:c};break;case 3:p={t:"s",v:t[l]};break;case 5:p={t:"d",v:f};break;case 6:p={t:"b",v:d>0};break;case 7:p={t:"n",v:d/86400};break;case 8:p={t:"e",v:0};break;case 9:if(i>-1)p={t:"s",v:r[i]};else throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(s&31," : ").concat(e.slice(0,4)));break;case 10:p={t:"n",v:c};break;default:throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(s&31," : ").concat(e.slice(0,4)))}return p}function Yw(e,t){var r=new Uint8Array(32),n=pf(r),s=12,a=0;switch(r[0]=5,e.t){case"n":r[1]=2,ote(r,s,e.v),a|=1,s+=16;break;case"b":r[1]=6,n.setFloat64(s,e.v?1:0,!0),a|=2,s+=8;break;case"s":if(t.indexOf(e.v)==-1)throw new Error("Value ".concat(e.v," missing from SST!"));r[1]=3,n.setUint32(s,t.indexOf(e.v),!0),a|=8,s+=4;break;default:throw"unsupported cell type "+e.t}return n.setUint32(8,a,!0),r.slice(0,s)}function Qw(e,t){var r=new Uint8Array(32),n=pf(r),s=12,a=0;switch(r[0]=3,e.t){case"n":r[2]=2,n.setFloat64(s,e.v,!0),a|=32,s+=8;break;case"b":r[2]=6,n.setFloat64(s,e.v?1:0,!0),a|=32,s+=8;break;case"s":if(t.indexOf(e.v)==-1)throw new Error("Value ".concat(e.v," missing from SST!"));r[2]=3,n.setUint32(s,t.indexOf(e.v),!0),a|=16,s+=4;break;default:throw"unsupported cell type "+e.t}return n.setUint32(4,a,!0),r.slice(0,s)}function dte(e,t,r){switch(e[0]){case 0:case 1:case 2:case 3:return cte(e,t,r,e[0]);case 5:return ute(e,t,r);default:throw new Error("Unsupported payload version ".concat(e[0]))}}function Ra(e){var t=tn(e);return wp(t[1][0].data)}function _3(e,t){var r=tn(t.data),n=is(r[1][0].data),s=r[3],a=[];return(s||[]).forEach(function(i){var l=tn(i.data),c=is(l[1][0].data)>>>0;switch(n){case 1:a[c]=x2(l[3][0].data);break;case 8:{var d=e[Ra(l[9][0].data)][0],f=tn(d.data),p=e[Ra(f[1][0].data)][0],g=is(p.meta[1][0].data);if(g!=2001)throw new Error("2000 unexpected reference to ".concat(g));var y=tn(p.data);a[c]=y[3].map(function(v){return x2(v.data)}).join("")}break}}),a}function fte(e,t){var r,n,s,a,i,l,c,d,f,p,g,y,v,_,b=tn(e),E=is(b[1][0].data)>>>0,k=is(b[2][0].data)>>>0,w=((n=(r=b[8])==null?void 0:r[0])==null?void 0:n.data)&&is(b[8][0].data)>0||!1,N,A;if((a=(s=b[7])==null?void 0:s[0])!=null&&a.data&&t!=0)N=(l=(i=b[7])==null?void 0:i[0])==null?void 0:l.data,A=(d=(c=b[6])==null?void 0:c[0])==null?void 0:d.data;else if((p=(f=b[4])==null?void 0:f[0])!=null&&p.data&&t!=1)N=(y=(g=b[4])==null?void 0:g[0])==null?void 0:y.data,A=(_=(v=b[3])==null?void 0:v[0])==null?void 0:_.data;else throw"NUMBERS Tile missing ".concat(t," cell storage");for(var P=w?4:1,R=pf(N),T=[],D=0;D<N.length/2;++D){var I=R.getUint16(D*2,!0);I<65535&&T.push([D,I])}if(T.length!=k)throw"Expected ".concat(k," cells, found ").concat(T.length);var V=[];for(D=0;D<T.length-1;++D)V[T[D][0]]=A.subarray(T[D][1]*P,T[D+1][1]*P);return T.length>=1&&(V[T[T.length-1][0]]=A.subarray(T[T.length-1][1]*P)),{R:E,cells:V}}function hte(e,t){var r,n=tn(t.data),s=(r=n?.[7])!=null&&r[0]?is(n[7][0].data)>>>0>0?1:0:-1,a=LS(n[5],function(i){return fte(i,s)});return{nrows:is(n[4][0].data)>>>0,data:a.reduce(function(i,l){return i[l.R]||(i[l.R]=[]),l.cells.forEach(function(c,d){if(i[l.R][d])throw new Error("Duplicate cell r=".concat(l.R," c=").concat(d));i[l.R][d]=c}),i},[])}}function gte(e,t,r){var n,s=tn(t.data),a={s:{r:0,c:0},e:{r:0,c:0}};if(a.e.r=(is(s[6][0].data)>>>0)-1,a.e.r<0)throw new Error("Invalid row varint ".concat(s[6][0].data));if(a.e.c=(is(s[7][0].data)>>>0)-1,a.e.c<0)throw new Error("Invalid col varint ".concat(s[7][0].data));r["!ref"]=Rr(a);var i=tn(s[4][0].data),l=_3(e,e[Ra(i[4][0].data)][0]),c=(n=i[17])!=null&&n[0]?_3(e,e[Ra(i[17][0].data)][0]):[],d=tn(i[3][0].data),f=0;d[1].forEach(function(p){var g=tn(p.data),y=e[Ra(g[2][0].data)][0],v=is(y.meta[1][0].data);if(v!=6002)throw new Error("6001 unexpected reference to ".concat(v));var _=hte(e,y);_.data.forEach(function(b,E){b.forEach(function(k,w){var N=br({r:f+E,c:w}),A=dte(k,l,c);A&&(r[N]=A)})}),f+=_.nrows})}function mte(e,t){var r=tn(t.data),n={"!ref":"A1"},s=e[Ra(r[2][0].data)],a=is(s[0].meta[1][0].data);if(a!=6001)throw new Error("6000 unexpected reference to ".concat(a));return gte(e,s[0],n),n}function pte(e,t){var r,n=tn(t.data),s={name:(r=n[1])!=null&&r[0]?x2(n[1][0].data):"",sheets:[]},a=LS(n[2],Ra);return a.forEach(function(i){e[i].forEach(function(l){var c=is(l.meta[1][0].data);c==6e3&&s.sheets.push(mte(e,l))})}),s}function xte(e,t){var r=zS(),n=tn(t.data),s=LS(n[1],Ra);if(s.forEach(function(a){e[a].forEach(function(i){var l=is(i.meta[1][0].data);if(l==2){var c=pte(e,i);c.sheets.forEach(function(d,f){HS(r,d,f==0?c.name:c.name+"_"+f,!0)})}})}),r.SheetNames.length==0)throw new Error("Empty NUMBERS file");return r}function Jw(e){var t,r,n,s,a={},i=[];if(e.FullPaths.forEach(function(c){if(c.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),e.FileIndex.forEach(function(c){if(c.name.match(/\.iwa$/)){var d;try{d=lo(c.content)}catch(p){return console.log("?? "+c.content.length+" "+(p.message||p))}var f;try{f=oo(d)}catch(p){return console.log("## "+(p.message||p))}f.forEach(function(p){a[p.id]=p.messages,i.push(p.id)})}}),!i.length)throw new Error("File has no messages");var l=((s=(n=(r=(t=a?.[1])==null?void 0:t[0])==null?void 0:r.meta)==null?void 0:n[1])==null?void 0:s[0].data)&&is(a[1][0].meta[1][0].data)==1&&a[1][0];if(l||i.forEach(function(c){a[c].forEach(function(d){var f=is(d.meta[1][0].data)>>>0;if(f==1)if(!l)l=d;else throw new Error("Document has multiple roots")})}),!l)throw new Error("Cannot find Document root");return xte(a,l)}function yte(e,t,r){var n,s,a,i;if(!((n=e[6])!=null&&n[0])||!((s=e[7])!=null&&s[0]))throw"Mutation only works on post-BNC storages!";var l=((i=(a=e[8])==null?void 0:a[0])==null?void 0:i.data)&&is(e[8][0].data)>0||!1;if(l)throw"Math only works with normal offsets";for(var c=0,d=pf(e[7][0].data),f=0,p=[],g=pf(e[4][0].data),y=0,v=[],_=0;_<t.length;++_){if(t[_]==null){d.setUint16(_*2,65535,!0),g.setUint16(_*2,65535);continue}d.setUint16(_*2,f,!0),g.setUint16(_*2,y,!0);var b,E;switch(typeof t[_]){case"string":b=Yw({t:"s",v:t[_]},r),E=Qw({t:"s",v:t[_]},r);break;case"number":b=Yw({t:"n",v:t[_]},r),E=Qw({t:"n",v:t[_]},r);break;case"boolean":b=Yw({t:"b",v:t[_]},r),E=Qw({t:"b",v:t[_]},r);break;default:throw new Error("Unsupported value "+t[_])}p.push(b),f+=b.length,v.push(E),y+=E.length,++c}for(e[2][0].data=hn(c);_<e[7][0].data.length/2;++_)d.setUint16(_*2,65535,!0),g.setUint16(_*2,65535,!0);return e[6][0].data=Wu(p),e[3][0].data=Wu(v),c}function vte(e,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var r=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var n=Ti(r["!ref"]);n.s.r=n.s.c=0;var s=!1;n.e.c>9&&(s=!0,n.e.c=9),n.e.r>49&&(s=!0,n.e.r=49),s&&console.error("The Numbers writer is currently limited to ".concat(Rr(n)));var a=ky(r,{range:n,header:1}),i=["~Sh33tJ5~"];a.forEach(function(z){return z.forEach(function(Q){typeof Q=="string"&&i.push(Q)})});var l={},c=[],d=mr.read(t.numbers,{type:"base64"});d.FileIndex.map(function(z,Q){return[z,d.FullPaths[Q]]}).forEach(function(z){var Q=z[0],Y=z[1];if(Q.type==2&&Q.name.match(/\.iwa/)){var te=Q.content,ee=lo(te),ae=oo(ee);ae.forEach(function(ge){c.push(ge.id),l[ge.id]={deps:[],location:Y,type:is(ge.messages[0].meta[1][0].data)}})}}),c.sort(function(z,Q){return z-Q});var f=c.filter(function(z){return z>1}).map(function(z){return[z,hn(z)]});d.FileIndex.map(function(z,Q){return[z,d.FullPaths[Q]]}).forEach(function(z){var Q=z[0];if(z[1],!!Q.name.match(/\.iwa/)){var Y=oo(lo(Q.content));Y.forEach(function(te){te.messages.forEach(function(ee){f.forEach(function(ae){te.messages.some(function(ge){return is(ge.meta[1][0].data)!=11006&&ate(ge.data,ae[1])})&&l[ae[0]].deps.push(te.id)})})})}});for(var p=mr.find(d,l[1].location),g=oo(lo(p.content)),y,v=0;v<g.length;++v){var _=g[v];_.id==1&&(y=_)}var b=Ra(tn(y.messages[0].data)[1][0].data);for(p=mr.find(d,l[b].location),g=oo(lo(p.content)),v=0;v<g.length;++v)_=g[v],_.id==b&&(y=_);for(b=Ra(tn(y.messages[0].data)[2][0].data),p=mr.find(d,l[b].location),g=oo(lo(p.content)),v=0;v<g.length;++v)_=g[v],_.id==b&&(y=_);for(b=Ra(tn(y.messages[0].data)[2][0].data),p=mr.find(d,l[b].location),g=oo(lo(p.content)),v=0;v<g.length;++v)_=g[v],_.id==b&&(y=_);var E=tn(y.messages[0].data);{E[6][0].data=hn(n.e.r+1),E[7][0].data=hn(n.e.c+1);var k=Ra(E[46][0].data),w=mr.find(d,l[k].location),N=oo(lo(w.content));{for(var A=0;A<N.length&&N[A].id!=k;++A);if(N[A].id!=k)throw"Bad ColumnRowUIDMapArchive";var P=tn(N[A].messages[0].data);P[1]=[],P[2]=[],P[3]=[];for(var R=0;R<=n.e.c;++R){var T=[];T[1]=T[2]=[{type:0,data:hn(R+420690)}],P[1].push({type:2,data:ma(T)}),P[2].push({type:0,data:hn(R)}),P[3].push({type:0,data:hn(R)})}P[4]=[],P[5]=[],P[6]=[];for(var D=0;D<=n.e.r;++D)T=[],T[1]=T[2]=[{type:0,data:hn(D+726270)}],P[4].push({type:2,data:ma(T)}),P[5].push({type:0,data:hn(D)}),P[6].push({type:0,data:hn(D)});N[A].messages[0].data=ma(P)}w.content=Eh(Th(N)),w.size=w.content.length,delete E[46];var I=tn(E[4][0].data);{I[7][0].data=hn(n.e.r+1);var V=tn(I[1][0].data),X=Ra(V[2][0].data);w=mr.find(d,l[X].location),N=oo(lo(w.content));{if(N[0].id!=X)throw"Bad HeaderStorageBucket";var Z=tn(N[0].messages[0].data);for(D=0;D<a.length;++D){var ie=tn(Z[2][0].data);ie[1][0].data=hn(D),ie[4][0].data=hn(a[D].length),Z[2][D]={type:Z[2][0].type,data:ma(ie)}}N[0].messages[0].data=ma(Z)}w.content=Eh(Th(N)),w.size=w.content.length;var q=Ra(I[2][0].data);w=mr.find(d,l[q].location),N=oo(lo(w.content));{if(N[0].id!=q)throw"Bad HeaderStorageBucket";for(Z=tn(N[0].messages[0].data),R=0;R<=n.e.c;++R)ie=tn(Z[2][0].data),ie[1][0].data=hn(R),ie[4][0].data=hn(n.e.r+1),Z[2][R]={type:Z[2][0].type,data:ma(ie)};N[0].messages[0].data=ma(Z)}w.content=Eh(Th(N)),w.size=w.content.length;var ne=Ra(I[4][0].data);(function(){for(var z=mr.find(d,l[ne].location),Q=oo(lo(z.content)),Y,te=0;te<Q.length;++te){var ee=Q[te];ee.id==ne&&(Y=ee)}var ae=tn(Y.messages[0].data);{ae[3]=[];var ge=[];i.forEach(function(ue,me){ge[1]=[{type:0,data:hn(me)}],ge[2]=[{type:0,data:hn(1)}],ge[3]=[{type:2,data:ste(ue)}],ae[3].push({type:2,data:ma(ge)})})}Y.messages[0].data=ma(ae);var _e=Th(Q),Me=Eh(_e);z.content=Me,z.size=z.content.length})();var M=tn(I[3][0].data);{var W=M[1][0];delete M[2];var L=tn(W.data);{var H=Ra(L[2][0].data);(function(){for(var z=mr.find(d,l[H].location),Q=oo(lo(z.content)),Y,te=0;te<Q.length;++te){var ee=Q[te];ee.id==H&&(Y=ee)}var ae=tn(Y.messages[0].data);{delete ae[6],delete M[7];var ge=new Uint8Array(ae[5][0].data);ae[5]=[];for(var _e=0,Me=0;Me<=n.e.r;++Me){var ue=tn(ge);_e+=yte(ue,a[Me],i),ue[1][0].data=hn(Me),ae[5].push({data:ma(ue),type:2})}ae[1]=[{type:0,data:hn(n.e.c+1)}],ae[2]=[{type:0,data:hn(n.e.r+1)}],ae[3]=[{type:0,data:hn(_e)}],ae[4]=[{type:0,data:hn(n.e.r+1)}]}Y.messages[0].data=ma(ae);var me=Th(Q),He=Eh(me);z.content=He,z.size=z.content.length})()}W.data=ma(L)}I[3][0].data=ma(M)}E[4][0].data=ma(I)}y.messages[0].data=ma(E);var K=Th(g),B=Eh(K);return p.content=B,p.size=p.content.length,d}function rP(e){return function(r){for(var n=0;n!=e.length;++n){var s=e[n];r[s[0]]===void 0&&(r[s[0]]=s[1]),s[2]==="n"&&(r[s[0]]=Number(r[s[0]]))}}}function BS(e){rP([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(e)}function US(e){rP([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function wte(e){return Wr.WS.indexOf(e)>-1?"sheet":e==Wr.CS?"chart":e==Wr.DS?"dialog":e==Wr.MS?"macro":e&&e.length?e:"sheet"}function _te(e,t){if(!e)return 0;try{e=t.map(function(n){return n.id||(n.id=n.strRelID),[n.name,e["!id"][n.id].Target,wte(e["!id"][n.id].Type)]})}catch{return null}return!e||e.length===0?null:e}function bte(e,t,r,n,s,a,i,l,c,d,f,p){try{a[n]=Bm(Ui(e,r,!0),t);var g=Ns(e,t),y;switch(l){case"sheet":y=HZ(g,t,s,c,a[n],d,f,p);break;case"chart":if(y=GZ(g,t,s,c,a[n],d,f,p),!y||!y["!drawel"])break;var v=Cm(y["!drawel"].Target,t),_=gp(v),b=FX(Ui(e,v,!0),Bm(Ui(e,_,!0),v)),E=Cm(b,v),k=gp(E);y=yZ(Ui(e,E,!0),E,c,Bm(Ui(e,k,!0),E),d,y);break;case"macro":y=VZ(g,t,s,c,a[n],d,f,p);break;case"dialog":y=KZ(g,t,s,c,a[n],d,f,p);break;default:throw new Error("Unrecognized sheet type "+l)}i[n]=y;var w=[];a&&a[n]&&os(a[n]).forEach(function(N){var A="";if(a[n][N].Type==Wr.CMNT){A=Cm(a[n][N].Target,t);var P=QZ(Ns(e,A,!0),A,c);if(!P||!P.length)return;i3(y,P,!1)}a[n][N].Type==Wr.TCMNT&&(A=Cm(a[n][N].Target,t),w=w.concat(RX(Ns(e,A,!0),c)))}),w&&w.length&&i3(y,w,!0,c.people||[])}catch(N){if(c.WTF)throw N}}function ao(e){return e.charAt(0)=="/"?e.slice(1):e}function Ste(e,t){if(F0(),t=t||{},BS(t),uo(e,"META-INF/manifest.xml")||uo(e,"objectdata.xml"))return x3(e,t);if(uo(e,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof Jw<"u"){if(e.FileIndex)return Jw(e);var r=mr.utils.cfb_new();return EN(e).forEach(function(ie){Ir(r,ie,DH(e,ie))}),Jw(r)}throw new Error("Unsupported NUMBERS file")}if(!uo(e,"[Content_Types].xml"))throw uo(e,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):uo(e,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var n=EN(e),s=EG(Ui(e,"[Content_Types].xml")),a=!1,i,l;if(s.workbooks.length===0&&(l="xl/workbook.xml",Ns(e,l,!0)&&s.workbooks.push(l)),s.workbooks.length===0){if(l="xl/workbook.bin",!Ns(e,l,!0))throw new Error("Could not find workbook");s.workbooks.push(l),a=!0}s.workbooks[0].slice(-3)=="bin"&&(a=!0);var c={},d={};if(!t.bookSheets&&!t.bookProps){if(Um=[],s.sst)try{Um=YZ(Ns(e,ao(s.sst)),s.sst,t)}catch(ie){if(t.WTF)throw ie}t.cellStyles&&s.themes.length&&(c=XZ(Ui(e,s.themes[0].replace(/^\//,""),!0)||"",s.themes[0],t)),s.style&&(d=qZ(Ns(e,ao(s.style)),s.style,c,t))}s.links.map(function(ie){try{var q=Bm(Ui(e,gp(ao(ie))),ie);return ZZ(Ns(e,ao(ie)),q,ie,t)}catch{}});var f=zZ(Ns(e,ao(s.workbooks[0])),s.workbooks[0],t),p={},g="";s.coreprops.length&&(g=Ns(e,ao(s.coreprops[0]),!0),g&&(p=H8(g)),s.extprops.length!==0&&(g=Ns(e,ao(s.extprops[0]),!0),g&&DG(g,p,t)));var y={};(!t.bookSheets||t.bookProps)&&s.custprops.length!==0&&(g=Ui(e,ao(s.custprops[0]),!0),g&&(y=MG(g,t)));var v={};if((t.bookSheets||t.bookProps)&&(f.Sheets?i=f.Sheets.map(function(q){return q.name}):p.Worksheets&&p.SheetNames.length>0&&(i=p.SheetNames),t.bookProps&&(v.Props=p,v.Custprops=y),t.bookSheets&&typeof i<"u"&&(v.SheetNames=i),t.bookSheets?v.SheetNames:t.bookProps))return v;i={};var _={};t.bookDeps&&s.calcchain&&(_=JZ(Ns(e,ao(s.calcchain)),s.calcchain));var b=0,E={},k,w;{var N=f.Sheets;p.Worksheets=N.length,p.SheetNames=[];for(var A=0;A!=N.length;++A)p.SheetNames[A]=N[A].name}var P=a?"bin":"xml",R=s.workbooks[0].lastIndexOf("/"),T=(s.workbooks[0].slice(0,R+1)+"_rels/"+s.workbooks[0].slice(R+1)+".rels").replace(/^\//,"");uo(e,T)||(T="xl/_rels/workbook."+P+".rels");var D=Bm(Ui(e,T,!0),T.replace(/_rels.*/,"s5s"));(s.metadata||[]).length>=1&&(t.xlmeta=eee(Ns(e,ao(s.metadata[0])),s.metadata[0],t)),(s.people||[]).length>=1&&(t.people=IX(Ns(e,ao(s.people[0])),t)),D&&(D=_te(D,f.Sheets));var I=Ns(e,"xl/worksheets/sheet.xml",!0)?1:0;e:for(b=0;b!=p.Worksheets;++b){var V="sheet";if(D&&D[b]?(k="xl/"+D[b][1].replace(/[\/]?xl\//,""),uo(e,k)||(k=D[b][1]),uo(e,k)||(k=T.replace(/_rels\/.*$/,"")+D[b][1]),V=D[b][2]):(k="xl/worksheets/sheet"+(b+1-I)+"."+P,k=k.replace(/sheet0\./,"sheet.")),w=k.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),t&&t.sheets!=null)switch(typeof t.sheets){case"number":if(b!=t.sheets)continue e;break;case"string":if(p.SheetNames[b].toLowerCase()!=t.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(t.sheets)){for(var X=!1,Z=0;Z!=t.sheets.length;++Z)typeof t.sheets[Z]=="number"&&t.sheets[Z]==b&&(X=1),typeof t.sheets[Z]=="string"&&t.sheets[Z].toLowerCase()==p.SheetNames[b].toLowerCase()&&(X=1);if(!X)continue e}}bte(e,k,w,p.SheetNames[b],b,E,i,V,t,f,c,d)}return v={Directory:s,Workbook:f,Props:p,Custprops:y,Deps:_,Sheets:i,SheetNames:p.SheetNames,Strings:Um,Styles:d,Themes:c,SSF:Ln(wr)},t&&t.bookFiles&&(e.files?(v.keys=n,v.files=e.files):(v.keys=[],v.files={},e.FullPaths.forEach(function(ie,q){ie=ie.replace(/^Root Entry[\/]/,""),v.keys.push(ie),v.files[ie]=e.FileIndex[q]}))),t&&t.bookVBA&&(s.vba.length>0?v.vbaraw=Ns(e,ao(s.vba[0]),!0):s.defaults&&s.defaults.bin===zX&&(v.vbaraw=Ns(e,"xl/vbaProject.bin",!0))),v}function kte(e,t){var r=t||{},n="Workbook",s=mr.find(e,n);try{if(n="/!DataSpaces/Version",s=mr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);if(eq(s.content),n="/!DataSpaces/DataSpaceMap",s=mr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var a=rq(s.content);if(a.length!==1||a[0].comps.length!==1||a[0].comps[0].t!==0||a[0].name!=="StrongEncryptionDataSpace"||a[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+n);if(n="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",s=mr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var i=nq(s.content);if(i.length!=1||i[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+n);if(n="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",s=mr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);aq(s.content)}catch{}if(n="/EncryptionInfo",s=mr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var l=iq(s.content);if(n="/EncryptedPackage",s=mr.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);if(l[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(l[1],s.content,r.password||"",r);if(l[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(l[1],s.content,r.password||"",r);throw new Error("File is password-protected")}function Cte(e,t){return t.bookType=="ods"?tP(e,t):t.bookType=="numbers"?vte(e,t):t.bookType=="xlsb"?Tte(e,t):Ete(e,t)}function Tte(e,t){Hh=1024,e&&!e.SSF&&(e.SSF=Ln(wr)),e&&e.SSF&&(F0(),ev(e.SSF),t.revssf=rv(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,$m?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var r=t.bookType=="xlsb"?"bin":"xml",n=AF.indexOf(t.bookType)>-1,s=CS();US(t=t||{});var a=dS(),i="",l=0;if(t.cellXfs=[],Ju(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),i="docProps/core.xml",Ir(a,i,G8(e.Props,t)),s.coreprops.push(i),mn(t.rels,2,i,Wr.CORE_PROPS),i="docProps/app.xml",!(e.Props&&e.Props.SheetNames))if(!e.Workbook||!e.Workbook.Sheets)e.Props.SheetNames=e.SheetNames;else{for(var c=[],d=0;d<e.SheetNames.length;++d)(e.Workbook.Sheets[d]||{}).Hidden!=2&&c.push(e.SheetNames[d]);e.Props.SheetNames=c}for(e.Props.Worksheets=e.Props.SheetNames.length,Ir(a,i,q8(e.Props)),s.extprops.push(i),mn(t.rels,3,i,Wr.EXT_PROPS),e.Custprops!==e.Props&&os(e.Custprops||{}).length>0&&(i="docProps/custom.xml",Ir(a,i,X8(e.Custprops)),s.custprops.push(i),mn(t.rels,4,i,Wr.CUST_PROPS)),l=1;l<=e.SheetNames.length;++l){var f={"!id":{}},p=e.Sheets[e.SheetNames[l-1]],g=(p||{})["!type"]||"sheet";switch(g){case"chart":default:i="xl/worksheets/sheet"+l+"."+r,Ir(a,i,ree(l-1,i,t,e,f)),s.sheets.push(i),mn(t.wbrels,-1,"worksheets/sheet"+l+"."+r,Wr.WS[0])}if(p){var y=p["!comments"],v=!1,_="";y&&y.length>0&&(_="xl/comments"+l+"."+r,Ir(a,_,aee(y,_)),s.comments.push(_),mn(f,-1,"../comments"+l+"."+r,Wr.CMNT),v=!0),p["!legacy"]&&v&&Ir(a,"xl/drawings/vmlDrawing"+l+".vml",EF(l,p["!comments"])),delete p["!comments"],delete p["!legacy"]}f["!id"].rId1&&Ir(a,gp(i),Zh(f))}return t.Strings!=null&&t.Strings.length>0&&(i="xl/sharedStrings."+r,Ir(a,i,see(t.Strings,i,t)),s.strs.push(i),mn(t.wbrels,-1,"sharedStrings."+r,Wr.SST)),i="xl/workbook."+r,Ir(a,i,tee(e,i)),s.workbooks.push(i),mn(t.rels,1,i,Wr.WB),i="xl/theme/theme1.xml",Ir(a,i,FS(e.Themes,t)),s.themes.push(i),mn(t.wbrels,-1,"theme/theme1.xml",Wr.THEME),i="xl/styles."+r,Ir(a,i,nee(e,i,t)),s.styles.push(i),mn(t.wbrels,-1,"styles."+r,Wr.STY),e.vbaraw&&n&&(i="xl/vbaProject.bin",Ir(a,i,e.vbaraw),s.vba.push(i),mn(t.wbrels,-1,"vbaProject.bin",Wr.VBA)),i="xl/metadata."+r,Ir(a,i,iee(i)),s.metadata.push(i),mn(t.wbrels,-1,"metadata."+r,Wr.XLMETA),Ir(a,"[Content_Types].xml",W8(s,t)),Ir(a,"_rels/.rels",Zh(t.rels)),Ir(a,"xl/_rels/workbook."+r+".rels",Zh(t.wbrels)),delete t.revssf,delete t.ssf,a}function Ete(e,t){Hh=1024,e&&!e.SSF&&(e.SSF=Ln(wr)),e&&e.SSF&&(F0(),ev(e.SSF),t.revssf=rv(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,$m?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var r="xml",n=AF.indexOf(t.bookType)>-1,s=CS();US(t=t||{});var a=dS(),i="",l=0;if(t.cellXfs=[],Ju(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),i="docProps/core.xml",Ir(a,i,G8(e.Props,t)),s.coreprops.push(i),mn(t.rels,2,i,Wr.CORE_PROPS),i="docProps/app.xml",!(e.Props&&e.Props.SheetNames))if(!e.Workbook||!e.Workbook.Sheets)e.Props.SheetNames=e.SheetNames;else{for(var c=[],d=0;d<e.SheetNames.length;++d)(e.Workbook.Sheets[d]||{}).Hidden!=2&&c.push(e.SheetNames[d]);e.Props.SheetNames=c}e.Props.Worksheets=e.Props.SheetNames.length,Ir(a,i,q8(e.Props)),s.extprops.push(i),mn(t.rels,3,i,Wr.EXT_PROPS),e.Custprops!==e.Props&&os(e.Custprops||{}).length>0&&(i="docProps/custom.xml",Ir(a,i,X8(e.Custprops)),s.custprops.push(i),mn(t.rels,4,i,Wr.CUST_PROPS));var f=["SheetJ5"];for(t.tcid=0,l=1;l<=e.SheetNames.length;++l){var p={"!id":{}},g=e.Sheets[e.SheetNames[l-1]],y=(g||{})["!type"]||"sheet";switch(y){case"chart":default:i="xl/worksheets/sheet"+l+"."+r,Ir(a,i,UF(l-1,t,e,p)),s.sheets.push(i),mn(t.wbrels,-1,"worksheets/sheet"+l+"."+r,Wr.WS[0])}if(g){var v=g["!comments"],_=!1,b="";if(v&&v.length>0){var E=!1;v.forEach(function(k){k[1].forEach(function(w){w.T==!0&&(E=!0)})}),E&&(b="xl/threadedComments/threadedComment"+l+"."+r,Ir(a,b,DX(v,f,t)),s.threadedcomments.push(b),mn(p,-1,"../threadedComments/threadedComment"+l+"."+r,Wr.TCMNT)),b="xl/comments"+l+"."+r,Ir(a,b,NF(v)),s.comments.push(b),mn(p,-1,"../comments"+l+"."+r,Wr.CMNT),_=!0}g["!legacy"]&&_&&Ir(a,"xl/drawings/vmlDrawing"+l+".vml",EF(l,g["!comments"])),delete g["!comments"],delete g["!legacy"]}p["!id"].rId1&&Ir(a,gp(i),Zh(p))}return t.Strings!=null&&t.Strings.length>0&&(i="xl/sharedStrings."+r,Ir(a,i,mF(t.Strings,t)),s.strs.push(i),mn(t.wbrels,-1,"sharedStrings."+r,Wr.SST)),i="xl/workbook."+r,Ir(a,i,GF(e)),s.workbooks.push(i),mn(t.rels,1,i,Wr.WB),i="xl/theme/theme1.xml",Ir(a,i,FS(e.Themes,t)),s.themes.push(i),mn(t.wbrels,-1,"theme/theme1.xml",Wr.THEME),i="xl/styles."+r,Ir(a,i,SF(e,t)),s.styles.push(i),mn(t.wbrels,-1,"styles."+r,Wr.STY),e.vbaraw&&n&&(i="xl/vbaProject.bin",Ir(a,i,e.vbaraw),s.vba.push(i),mn(t.wbrels,-1,"vbaProject.bin",Wr.VBA)),i="xl/metadata."+r,Ir(a,i,TF()),s.metadata.push(i),mn(t.wbrels,-1,"metadata."+r,Wr.XLMETA),f.length>1&&(i="xl/persons/person.xml",Ir(a,i,MX(f)),s.people.push(i),mn(t.wbrels,-1,"persons/person.xml",Wr.PEOPLE)),Ir(a,"[Content_Types].xml",W8(s,t)),Ir(a,"_rels/.rels",Zh(t.rels)),Ir(a,"xl/_rels/workbook."+r+".rels",Zh(t.wbrels)),delete t.revssf,delete t.ssf,a}function $S(e,t){var r="";switch((t||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":r=Wi(e.slice(0,12));break;case"binary":r=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3),r.charCodeAt(4),r.charCodeAt(5),r.charCodeAt(6),r.charCodeAt(7)]}function Nte(e,t){return mr.find(e,"EncryptedPackage")?kte(e,t):XF(e,t)}function Ate(e,t){var r,n=e,s=t||{};return s.type||(s.type=Lr&&Buffer.isBuffer(e)?"buffer":"base64"),r=x8(n,s),Ste(r,s)}function nP(e,t){var r=0;e:for(;r<e.length;)switch(e.charCodeAt(r)){case 10:case 13:case 32:++r;break;case 60:return m2(e.slice(r),t);default:break e}return f0.to_workbook(e,t)}function jte(e,t){var r="",n=$S(e,t);switch(t.type){case"base64":r=Wi(e);break;case"binary":r=e;break;case"buffer":r=e.toString("binary");break;case"array":r=ff(e);break;default:throw new Error("Unrecognized type "+t.type)}return n[0]==239&&n[1]==187&&n[2]==191&&(r=bn(r)),t.type="binary",nP(r,t)}function Fte(e,t){var r=e;return t.type=="base64"&&(r=Wi(r)),r=lp.utils.decode(1200,r.slice(2),"str"),t.type="binary",nP(r,t)}function Pte(e){return e.match(/[^\x00-\x7F]/)?Tl(e):e}function Zw(e,t,r,n){return n?(r.type="string",f0.to_workbook(e,r)):f0.to_workbook(t,r)}function y2(e,t){iS();var r=t||{};if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return y2(new Uint8Array(e),(r=Ln(r),r.type="array",r));typeof Uint8Array<"u"&&e instanceof Uint8Array&&!r.type&&(r.type=typeof Deno<"u"?"buffer":"array");var n=e,s=[0,0,0,0],a=!1;if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),t0={},r.dateNF&&(t0.dateNF=r.dateNF),r.type||(r.type=Lr&&Buffer.isBuffer(e)?"buffer":"base64"),r.type=="file"&&(r.type=Lr?"buffer":"binary",n=TH(e),typeof Uint8Array<"u"&&!Lr&&(r.type="array")),r.type=="string"&&(a=!0,r.type="binary",r.codepage=65001,n=Pte(e)),r.type=="array"&&typeof Uint8Array<"u"&&e instanceof Uint8Array&&typeof ArrayBuffer<"u"){var i=new ArrayBuffer(3),l=new Uint8Array(i);if(l.foo="bar",!l.foo)return r=Ln(r),r.type="array",y2(oS(n),r)}switch((s=$S(n,r))[0]){case 208:if(s[1]===207&&s[2]===17&&s[3]===224&&s[4]===161&&s[5]===177&&s[6]===26&&s[7]===225)return Nte(mr.read(n,r),r);break;case 9:if(s[1]<=8)return XF(n,r);break;case 60:return m2(n,r);case 73:if(s[1]===73&&s[2]===42&&s[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(s[1]===68)return OK(n,r);break;case 84:if(s[1]===65&&s[2]===66&&s[3]===76)return hF.to_workbook(n,r);break;case 80:return s[1]===75&&s[2]<9&&s[3]<9?Ate(n,r):Zw(e,n,r,a);case 239:return s[3]===60?m2(n,r):Zw(e,n,r,a);case 255:if(s[1]===254)return Fte(n,r);if(s[1]===0&&s[2]===2&&s[3]===0)return qd.to_workbook(n,r);break;case 0:if(s[1]===0&&(s[2]>=2&&s[3]===0||s[2]===0&&(s[3]===8||s[3]===9)))return qd.to_workbook(n,r);break;case 3:case 131:case 139:case 140:return g2.to_workbook(n,r);case 123:if(s[1]===92&&s[2]===114&&s[3]===116)return wF.to_workbook(n,r);break;case 10:case 13:case 32:return jte(n,r);case 137:if(s[1]===80&&s[2]===78&&s[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return MK.indexOf(s[0])>-1&&s[2]<=12&&s[3]<=31?g2.to_workbook(n,r):Zw(e,n,r,a)}function sP(e,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return Gp(t.file,mr.write(e,{type:Lr?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return mr.write(e,t)}function Rte(e,t){var r=Ln(t||{}),n=Cte(e,r);return Dte(n,r)}function Dte(e,t){var r={},n=Lr?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(t.compression&&(r.compression="DEFLATE"),t.password)r.type=n;else switch(t.type){case"base64":r.type="base64";break;case"binary":r.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":r.type=n;break;default:throw new Error("Unrecognized type "+t.type)}var s=e.FullPaths?mr.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[r.type]||r.type,compression:!!t.compression}):e.generate(r);if(typeof Deno<"u"&&typeof s=="string"){if(t.type=="binary"||t.type=="base64")return s;s=new Uint8Array(Zy(s))}return t.password&&typeof encrypt_agile<"u"?sP(encrypt_agile(s,t.password),t):t.type==="file"?Gp(t.file,s):t.type=="string"?bn(s):s}function Ite(e,t){var r=t||{},n=Pee(e,r);return sP(n,r)}function wl(e,t,r){r||(r="");var n=r+e;switch(t.type){case"base64":return cp(Tl(n));case"binary":return Tl(n);case"string":return e;case"file":return Gp(t.file,n,"utf8");case"buffer":return Lr?jc(n,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(n):wl(n,{type:"binary"}).split("").map(function(s){return s.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function Mte(e,t){switch(t.type){case"base64":return cp(e);case"binary":return e;case"string":return e;case"file":return Gp(t.file,e,"binary");case"buffer":return Lr?jc(e,"binary"):e.split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function T1(e,t){switch(t.type){case"string":case"base64":case"binary":for(var r="",n=0;n<e.length;++n)r+=String.fromCharCode(e[n]);return t.type=="base64"?cp(r):t.type=="string"?bn(r):r;case"file":return Gp(t.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+t.type)}}function aP(e,t){iS(),NZ(e);var r=Ln(t||{});if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),r.type=="array"){r.type="binary";var n=aP(e,r);return r.type="array",Zy(n)}var s=0;if(r.sheet&&(typeof r.sheet=="number"?s=r.sheet:s=e.SheetNames.indexOf(r.sheet),!e.SheetNames[s]))throw new Error("Sheet not found: "+r.sheet+" : "+typeof r.sheet);switch(r.bookType||"xlsb"){case"xml":case"xlml":return wl(Cee(e,r),r);case"slk":case"sylk":return wl(fF.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"htm":case"html":return wl(QF(e.Sheets[e.SheetNames[s]],r),r);case"txt":return Mte(iP(e.Sheets[e.SheetNames[s]],r),r);case"csv":return wl(WS(e.Sheets[e.SheetNames[s]],r),r,"\uFEFF");case"dif":return wl(hF.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"dbf":return T1(g2.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"prn":return wl(f0.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"rtf":return wl(wF.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"eth":return wl(gF.from_sheet(e.Sheets[e.SheetNames[s]],r),r);case"fods":return wl(tP(e,r),r);case"wk1":return T1(qd.sheet_to_wk1(e.Sheets[e.SheetNames[s]],r),r);case"wk3":return T1(qd.book_to_wk3(e,r),r);case"biff2":r.biff||(r.biff=2);case"biff3":r.biff||(r.biff=3);case"biff4":return r.biff||(r.biff=4),T1(YF(e,r),r);case"biff5":r.biff||(r.biff=5);case"biff8":case"xla":case"xls":return r.biff||(r.biff=8),Ite(e,r);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return Rte(e,r);default:throw new Error("Unrecognized bookType |"+r.bookType+"|")}}function Ote(e){if(!e.bookType){var t={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},r=e.file.slice(e.file.lastIndexOf(".")).toLowerCase();r.match(/^\.[a-z]+$/)&&(e.bookType=r.slice(1)),e.bookType=t[e.bookType]||e.bookType}}function Lte(e,t,r){var n={};return n.type="file",n.file=t,Ote(n),aP(e,n)}function Bte(e,t,r,n,s,a,i,l){var c=ys(r),d=l.defval,f=l.raw||!Object.prototype.hasOwnProperty.call(l,"raw"),p=!0,g=s===1?[]:{};if(s!==1)if(Object.defineProperty)try{Object.defineProperty(g,"__rowNum__",{value:r,enumerable:!1})}catch{g.__rowNum__=r}else g.__rowNum__=r;if(!i||e[r])for(var y=t.s.c;y<=t.e.c;++y){var v=i?e[r][y]:e[n[y]+c];if(v===void 0||v.t===void 0){if(d===void 0)continue;a[y]!=null&&(g[a[y]]=d);continue}var _=v.v;switch(v.t){case"z":if(_==null)break;continue;case"e":_=_==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+v.t)}if(a[y]!=null){if(_==null)if(v.t=="e"&&_===null)g[a[y]]=null;else if(d!==void 0)g[a[y]]=d;else if(f&&_===null)g[a[y]]=null;else continue;else g[a[y]]=f&&(v.t!=="n"||v.t==="n"&&l.rawNumbers!==!1)?_:Ec(v,_,l);_!=null&&(p=!1)}}return{row:g,isempty:p}}function ky(e,t){if(e==null||e["!ref"]==null)return[];var r={t:"n",v:0},n=0,s=1,a=[],i=0,l="",c={s:{r:0,c:0},e:{r:0,c:0}},d=t||{},f=d.range!=null?d.range:e["!ref"];switch(d.header===1?n=1:d.header==="A"?n=2:Array.isArray(d.header)?n=3:d.header==null&&(n=0),typeof f){case"string":c=Jr(f);break;case"number":c=Jr(e["!ref"]),c.s.r=f;break;default:c=f}n>0&&(s=0);var p=ys(c.s.r),g=[],y=[],v=0,_=0,b=Array.isArray(e),E=c.s.r,k=0,w={};b&&!e[E]&&(e[E]=[]);var N=d.skipHidden&&e["!cols"]||[],A=d.skipHidden&&e["!rows"]||[];for(k=c.s.c;k<=c.e.c;++k)if(!(N[k]||{}).hidden)switch(g[k]=Kn(k),r=b?e[E][k]:e[g[k]+p],n){case 1:a[k]=k-c.s.c;break;case 2:a[k]=g[k];break;case 3:a[k]=d.header[k-c.s.c];break;default:if(r==null&&(r={w:"__EMPTY",t:"s"}),l=i=Ec(r,null,d),_=w[i]||0,!_)w[i]=1;else{do l=i+"_"+_++;while(w[l]);w[i]=_,w[l]=1}a[k]=l}for(E=c.s.r+s;E<=c.e.r;++E)if(!(A[E]||{}).hidden){var P=Bte(e,c,E,g,n,a,b,d);(P.isempty===!1||(n===1?d.blankrows!==!1:d.blankrows))&&(y[v++]=P.row)}return y.length=v,y}var b3=/"/g;function Ute(e,t,r,n,s,a,i,l){for(var c=!0,d=[],f="",p=ys(r),g=t.s.c;g<=t.e.c;++g)if(n[g]){var y=l.dense?(e[r]||[])[g]:e[n[g]+p];if(y==null)f="";else if(y.v!=null){c=!1,f=""+(l.rawNumbers&&y.t=="n"?y.v:Ec(y,null,l));for(var v=0,_=0;v!==f.length;++v)if((_=f.charCodeAt(v))===s||_===a||_===34||l.forceQuotes){f='"'+f.replace(b3,'""')+'"';break}f=="ID"&&(f='"ID"')}else y.f!=null&&!y.F?(c=!1,f="="+y.f,f.indexOf(",")>=0&&(f='"'+f.replace(b3,'""')+'"')):f="";d.push(f)}return l.blankrows===!1&&c?null:d.join(i)}function WS(e,t){var r=[],n=t??{};if(e==null||e["!ref"]==null)return"";var s=Jr(e["!ref"]),a=n.FS!==void 0?n.FS:",",i=a.charCodeAt(0),l=n.RS!==void 0?n.RS:`
`,c=l.charCodeAt(0),d=new RegExp((a=="|"?"\\|":a)+"+$"),f="",p=[];n.dense=Array.isArray(e);for(var g=n.skipHidden&&e["!cols"]||[],y=n.skipHidden&&e["!rows"]||[],v=s.s.c;v<=s.e.c;++v)(g[v]||{}).hidden||(p[v]=Kn(v));for(var _=0,b=s.s.r;b<=s.e.r;++b)(y[b]||{}).hidden||(f=Ute(e,s,b,p,i,c,a,n),f!=null&&(n.strip&&(f=f.replace(d,"")),(f||n.blankrows!==!1)&&r.push((_++?l:"")+f)));return delete n.dense,r.join("")}function iP(e,t){t||(t={}),t.FS="	",t.RS=`
`;var r=WS(e,t);return r}function $te(e){var t="",r,n="";if(e==null||e["!ref"]==null)return[];var s=Jr(e["!ref"]),a="",i=[],l,c=[],d=Array.isArray(e);for(l=s.s.c;l<=s.e.c;++l)i[l]=Kn(l);for(var f=s.s.r;f<=s.e.r;++f)for(a=ys(f),l=s.s.c;l<=s.e.c;++l)if(t=i[l]+a,r=d?(e[f]||[])[l]:e[t],n="",r!==void 0){if(r.F!=null){if(t=r.F,!r.f)continue;n=r.f,t.indexOf(":")==-1&&(t=t+":"+t)}if(r.f!=null)n=r.f;else{if(r.t=="z")continue;if(r.t=="n"&&r.v!=null)n=""+r.v;else if(r.t=="b")n=r.v?"TRUE":"FALSE";else if(r.w!==void 0)n="'"+r.w;else{if(r.v===void 0)continue;r.t=="s"?n="'"+r.v:n=""+r.v}}c[c.length]=t+"="+n}return c}function oP(e,t,r){var n=r||{},s=+!n.skipHeader,a=e||{},i=0,l=0;if(a&&n.origin!=null)if(typeof n.origin=="number")i=n.origin;else{var c=typeof n.origin=="string"?qn(n.origin):n.origin;i=c.r,l=c.c}var d,f={s:{c:0,r:0},e:{c:l,r:i+t.length-1+s}};if(a["!ref"]){var p=Jr(a["!ref"]);f.e.c=Math.max(f.e.c,p.e.c),f.e.r=Math.max(f.e.r,p.e.r),i==-1&&(i=p.e.r+1,f.e.r=i+t.length-1+s)}else i==-1&&(i=0,f.e.r=t.length-1+s);var g=n.header||[],y=0;t.forEach(function(_,b){os(_).forEach(function(E){(y=g.indexOf(E))==-1&&(g[y=g.length]=E);var k=_[E],w="z",N="",A=br({c:l+y,r:i+b+s});d=_p(a,A),k&&typeof k=="object"&&!(k instanceof Date)?a[A]=k:(typeof k=="number"?w="n":typeof k=="boolean"?w="b":typeof k=="string"?w="s":k instanceof Date?(w="d",n.cellDates||(w="n",k=zs(k)),N=n.dateNF||wr[14]):k===null&&n.nullError&&(w="e",k=0),d?(d.t=w,d.v=k,delete d.w,delete d.R,N&&(d.z=N)):a[A]=d={t:w,v:k},N&&(d.z=N))})}),f.e.c=Math.max(f.e.c,l+g.length-1);var v=ys(i);if(s)for(y=0;y<g.length;++y)a[Kn(y+l)+v]={t:"s",v:g[y]};return a["!ref"]=Rr(f),a}function Wte(e,t){return oP(null,e,t)}function _p(e,t,r){if(typeof t=="string"){if(Array.isArray(e)){var n=qn(t);return e[n.r]||(e[n.r]=[]),e[n.r][n.c]||(e[n.r][n.c]={t:"z"})}return e[t]||(e[t]={t:"z"})}return typeof t!="number"?_p(e,br(t)):_p(e,br({r:t,c:r||0}))}function zte(e,t){if(typeof t=="number"){if(t>=0&&e.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}else if(typeof t=="string"){var r=e.SheetNames.indexOf(t);if(r>-1)return r;throw new Error("Cannot find sheet name |"+t+"|")}else throw new Error("Cannot find sheet |"+t+"|")}function zS(){return{SheetNames:[],Sheets:{}}}function HS(e,t,r,n){var s=1;if(!r)for(;s<=65535&&e.SheetNames.indexOf(r="Sheet"+s)!=-1;++s,r=void 0);if(!r||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(n&&e.SheetNames.indexOf(r)>=0){var a=r.match(/(^.*?)(\d+)$/);s=a&&+a[2]||0;var i=a&&a[1]||r;for(++s;s<=65535&&e.SheetNames.indexOf(r=i+s)!=-1;++s);}if(HF(r),e.SheetNames.indexOf(r)>=0)throw new Error("Worksheet with name |"+r+"| already exists!");return e.SheetNames.push(r),e.Sheets[r]=t,r}function Hte(e,t,r){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var n=zte(e,t);switch(e.Workbook.Sheets[n]||(e.Workbook.Sheets[n]={}),r){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+r)}e.Workbook.Sheets[n].Hidden=r}function Gte(e,t){return e.z=t,e}function lP(e,t,r){return t?(e.l={Target:t},r&&(e.l.Tooltip=r)):delete e.l,e}function Vte(e,t,r){return lP(e,"#"+t,r)}function Kte(e,t,r){e.c||(e.c=[]),e.c.push({t,a:r||"SheetJS"})}function qte(e,t,r,n){for(var s=typeof t!="string"?t:Jr(t),a=typeof t=="string"?t:Rr(t),i=s.s.r;i<=s.e.r;++i)for(var l=s.s.c;l<=s.e.c;++l){var c=_p(e,i,l);c.t="n",c.F=a,delete c.v,i==s.s.r&&l==s.s.c&&(c.f=r,n&&(c.D=!0))}return e}var M1={encode_col:Kn,encode_row:ys,encode_cell:br,encode_range:Rr,decode_col:vS,decode_row:yS,split_cell:sG,decode_cell:qn,decode_range:Ti,format_cell:Ec,sheet_add_aoa:I8,sheet_add_json:oP,sheet_add_dom:JF,aoa_to_sheet:P0,json_to_sheet:Wte,table_to_sheet:ZF,table_to_book:ete,sheet_to_csv:WS,sheet_to_txt:iP,sheet_to_json:ky,sheet_to_html:QF,sheet_to_formulae:$te,sheet_to_row_object_array:ky,sheet_get_cell:_p,book_new:zS,book_append_sheet:HS,book_set_sheet_visibility:Hte,cell_set_number_format:Gte,cell_set_hyperlink:lP,cell_set_internal_link:Vte,cell_add_comment:Kte,sheet_set_array_formula:qte,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};const cP=({onBackToCabinet:e,selectedGrade:t,selectedClass:r,openRetestModal:n})=>{Ei(),Ey();const{user:s,isAuthenticated:a}=Bn(),{showNotification:i}=ka(),l=C.useCallback(Fe=>{let We=null;if(typeof Fe?.percentage=="number"&&!Number.isNaN(Fe.percentage))return We=Math.round(Fe.percentage),console.debug("[TeacherResults] Using provided percentage",{percentage:Fe.percentage,rounded:We,result:Fe}),We;const Ct=Fe?.retest_best_score??Fe?.score,at=Fe?.retest_best_max_score??Fe?.max_score,Qt=Number(Ct??0),tt=Number(at??0);return tt>0&&(We=Math.round(Qt/tt*100)),console.debug("[TeacherResults] Computed percentage",{score:Fe?.score,max_score:Fe?.max_score,retest_best_score:Fe?.retest_best_score,retest_best_max_score:Fe?.retest_best_max_score,derived:We,result:Fe}),We},[]);C.useCallback(Fe=>{const We=l(Fe);return We===null?"bg-gray-100 text-gray-800":We<50?"bg-red-100 text-red-700":We<70?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"},[l]),C.useCallback(Fe=>{const We=l(Fe);return We!==null&&We<50},[l]);const[c,d]=C.useState(null),[f,p]=C.useState(!0),[g,y]=C.useState(""),[v,_]=C.useState([]),[b,E]=C.useState(null),[k,w]=C.useState(!1),[N,A]=C.useState([]),[P,R]=C.useState([]),[T,D]=C.useState([1,2]),[I,V]=C.useState(null),[X,Z]=C.useState(null),[ie,q]=C.useState(null),[ne,M]=C.useState("main"),[W,L]=C.useState(null),[H,K]=C.useState(null),B=W||t,z=H||r,[Q,Y]=C.useState(null),[te,ee]=C.useState({}),[ae,ge]=C.useState(!1),[_e,Me]=C.useState(new Set),[ue,me]=C.useState(!1),[He,qe]=C.useState(!1),Xe=C.useRef(null),[Ve,It]=C.useState(null),[st,Ie]=C.useState(!1),[je,Ze]=C.useState(null),[bt,mt]=C.useState(!1),[$t,Wt]=C.useState(null),[lt,Qe]=C.useState(""),[yt,ft]=C.useState(""),[_t,zt]=C.useState(!1),[Jt,De]=C.useState(!1),[ut,pt]=C.useState(null),[Pt,Lt]=C.useState(""),[sr,Te]=C.useState(!1),[ve,fe]=C.useState(new Set),[we,Ue]=C.useState({}),[St,xt]=C.useState(!1),Ht=C.useRef(new Set),Ot=C.useRef({}),Xt=C.useRef(null);C.useEffect(()=>{console.log("🎯 editingColumns state changed:",Array.from(ve)),Ht.current=ve},[ve]),C.useEffect(()=>{console.log("🎯 columnScores state changed:",we),Ot.current=we},[we]);const pr=C.useCallback(Fe=>{console.log("🔄 Toggling test collapse for:",Fe),Me(We=>{const Ct=new Set(We);return Ct.has(Fe)?(Ct.delete(Fe),console.log("📤 Expanding test:",Fe)):(Ct.add(Fe),console.log("📥 Collapsing test:",Fe)),console.log("📋 New collapsed tests:",Array.from(Ct)),Ct})},[]),Fr=C.useCallback(()=>{if(Xe.current){const{scrollLeft:Fe,scrollWidth:We,clientWidth:Ct}=Xe.current;me(Fe>0),qe(Fe<We-Ct-1)}},[]);C.useEffect(()=>{Mr()},[]),C.useEffect(()=>{if(I&&Xe.current){const Fe=setTimeout(Fr,100);return()=>clearTimeout(Fe)}},[I,Fr]),C.useEffect(()=>{console.log("📋 Current collapsed tests state:",Array.from(_e))},[_e]);const fr=C.useCallback(async(Fe,We,Ct)=>{console.log("👨‍🏫 Loading class results for:",Fe,We,Ct),ge(!0);try{const at=`${Fe}/${We}`;console.log("👨‍🏫 Formatted class name:",at);let Qt=c;Qt||(console.log("👨‍🏫 Teacher data not loaded, loading now..."),Qt=await _n.getTeacherData(),d(Qt));const tt=s?.teacher_id;let jt=null,re=X;if(re||(console.log("👨‍🏫 Academic year data not loaded, loading now..."),re=await be()),re&&Array.isArray(re)&&re.length>0){const Pe=parseInt(Ct);console.log("👨‍🏫 Looking for semester",Pe,"in current academic year");const Je=new Date,gr=re.find(Zr=>{const dr=new Date(Zr.start_date),_s=new Date(Zr.end_date);return Je>=dr&&Je<=_s}),or=gr?gr.academic_year:re[0].academic_year;console.log("👨‍🏫 Current academic year:",or);const Or=re.filter(Zr=>Zr.academic_year===or);console.log("👨‍🏫 Current year periods:",Or);const Dr=Or.filter(Zr=>parseInt(Zr.semester)===1),Xr=Or.filter(Zr=>parseInt(Zr.semester)===2);if(console.log("👨‍🏫 Semester 1 periods:",Dr),console.log("👨‍🏫 Semester 2 periods:",Xr),Pe===1?(jt=Dr[0]?.id,console.log("👨‍🏫 Using semester 1 period:",Dr[0])):Pe===2&&(jt=Xr[0]?.id,console.log("👨‍🏫 Using semester 2 period:",Xr[0])),!jt)throw new Error(`No ${Pe===1?"Semester 1":"Semester 2"} data available for academic year ${or}`)}if(!tt||!jt)throw console.error("👨‍🏫 Missing data:",{teacherId:tt,academicPeriodId:jt,academicYear:X}),new Error("Missing teacher ID or academic period ID");const de=await QW.getTeacherStudentResults(tt,Fe,at,Ct,jt);if(console.log("👨‍🏫 Class results response:",de),de.success){console.log("👨‍🏫 API Response details:",{results:de.results,students:de.students,count:de.count,student_count:de.student_count});const Pe=[],Je=new Set,gr=new Set;de.results&&de.results.length>0&&de.results.forEach(Dr=>{Dr.test_name&&!Je.has(Dr.test_name)&&(Je.add(Dr.test_name),Pe.push({test_name:Dr.test_name,test_type:Dr.test_type,subject:Dr.subject})),Dr.subject&&gr.add(Dr.subject)}),console.log("🔍 RAW RESULTS DATA:",de.results),console.log("🔍 RAW STUDENTS DATA:",de.students);const or=(de.students||[]).map(Dr=>{const Xr={};return(de.results||[]).filter(dr=>(console.log(`🔍 Checking result ${dr.id} for student ${Dr.student_id}:`,{result_student_id:dr.student_id,student_id:Dr.student_id,match:dr.student_id===Dr.student_id,test_type:dr.test_type}),dr.student_id===Dr.student_id)).forEach(dr=>{console.log(`🔍 Mapping result ${dr.id} (${dr.test_type}) to student ${Dr.student_id}:`,{test_name:dr.test_name,test_type:dr.test_type,score:dr.score,answers:dr.answers}),dr.test_name&&(Xr[dr.test_name]={id:dr.id,test_type:dr.test_type,test_id:dr.test_id,subject_id:dr.subject_id,score:dr.score,max_score:dr.max_score,retest_offered:dr.retest_offered,caught_cheating:dr.caught_cheating,visibility_change_times:dr.visibility_change_times,answers:dr.answers,name:dr.name,surname:dr.surname,test_name:dr.test_name},console.log(`🔍 MAPPED: ${dr.test_name} -> student ${Dr.student_id}:`,Xr[dr.test_name]))}),{...Dr,...Xr}}),Or={results:de.results||[],students:or,class:or,unique_tests:Pe,subjects:Array.from(gr),count:de.count||0,student_count:de.student_count||0};console.log("👨‍🏫 Processed results data:",{uniqueTests:Pe.length,subjects:Array.from(gr),resultsCount:de.results?.length||0,studentsWithScores:or.length,sampleStudent:or[0]}),V(Or),ee(Or),q(new Date),de.students&&de.students.length>0?(console.log("👨‍🏫 Student list loaded:",de.students.length,"students"),console.log("👨‍🏫 Sample student:",de.students[0])):console.log("👨‍🏫 No students found for this class")}else console.log("👨‍🏫 API call failed for this class"),V(null),ee(null)}catch(at){console.error("👨‍🏫 Error loading class results:",at),i("Error loading class results","error"),V(null),ee(null)}finally{ge(!1)}},[c,s,X,i]),vr=C.useCallback(async(Fe,We)=>{console.log("👨‍🏫 Determining current semester for:",Fe,We);try{if(X&&X.length>0){const Ct=new Date;let at=1,Qt=null;for(const tt of X){const jt=new Date(tt.start_date),re=new Date(tt.end_date);if(console.log("👨‍🏫 Checking period:",{period:tt,semester:tt.semester,semesterType:typeof tt.semester,startDate:jt,endDate:re,currentDate:Ct,isInRange:Ct>=jt&&Ct<=re}),Ct>=jt&&Ct<=re){Qt=tt,at=tt.semester,console.log("👨‍🏫 Found matching period:",{period:tt,semester:tt.semester,semesterType:typeof tt.semester});break}}if(Qt){console.log("👨‍🏫 Current academic period found:",Qt),console.log("👨‍🏫 Current semester:",at);const tt=at&&!isNaN(at)?at:1;console.log("👨‍🏫 Using semester:",tt),E(tt),await fr(Fe,We,tt)}else console.log("👨‍🏫 No current academic period found, using default semester 1"),E(1),await fr(Fe,We,1)}else console.log("👨‍🏫 No academic year data, using default semester 1"),E(1),await fr(Fe,We,1)}catch(Ct){console.error("👨‍🏫 Error determining current semester:",Ct),E(1),await fr(Fe,We,1)}},[X,fr]);C.useEffect(()=>{t&&r&&(console.log("👨‍🏫 Props detected:",{grade:t,class:r}),vr(t,r))},[t,r,vr]);const Mr=C.useCallback(async()=>{console.log("👨‍🏫 Initializing teacher results...");try{if(p(!0),y(""),!a||!s){console.log("👨‍🏫 User not authenticated"),y("User not authenticated");return}if(s.role!==si.TEACHER){console.error("👨‍🏫 Invalid user role for teacher results:",s.role),y("Access denied. Teacher role required.");return}console.log("👨‍🏫 Loading teacher assignments..."),await sn(),console.log("👨‍🏫 Loading academic year data..."),await le(),console.log("👨‍🏫 Teacher results initialization complete!")}catch(Fe){console.error("👨‍🏫 Error initializing teacher results:",Fe),y("Failed to initialize teacher results")}finally{p(!1)}},[a,s]),sn=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher assignments...");try{const Fe=`teacher_data_${s?.teacher_id||s?.id||""}`;let We=jn(Fe);We?console.log("👨‍🏫 Cache HIT! Using cached teacher data"):(console.log("👨‍🏫 Cache MISS! Fetching teacher data from API"),We=await _n.getTeacherData(),console.log("👨‍🏫 Teacher data loaded:",We),Fn(Fe,We,Dn.teacher_subjects)),d(We);const Ct=[];We&&We.subjects&&We.subjects.forEach(re=>{re.classes&&re.classes.forEach(de=>{de.grade&&de.class&&Ct.push({grade:de.grade,class:de.class,subject:re.name})})}),R(Ct),console.log("👨‍🏫 Available classes from teacher data:",Ct);const at=`teacher_tests_${s?.teacher_id||s?.id||""}`,Qt=jn(at);Qt&&Qt.some(re=>re.test_type==="drawing")&&(console.log("🎨 Drawing test detected - forcing cache refresh"),localStorage.removeItem(at));let tt=jn(at);tt?console.log("👨‍🏫 Cache HIT! Using cached teacher tests"):(console.log("👨‍🏫 Cache MISS! Fetching teacher tests from API"),tt=await rn.getTeacherTests(),console.log("👨‍🏫 Teacher tests loaded:",tt),Fn(at,tt,Dn.teacher_tests));const jt=tt.flatMap(re=>re.assignments||[]);_(jt),console.log("👨‍🏫 Raw assignments data:",jt),console.log("👨‍🏫 Teacher assignments loaded:",jt.length)}catch(Fe){console.error("👨‍🏫 Error loading teacher assignments:",Fe),i("Failed to load teacher assignments","error")}},[i]),le=C.useCallback(async()=>{console.log("👨‍🏫 Loading academic year data...");try{const Fe="admin_academic_years_";let We=jn(Fe);We?console.log("👨‍🏫 Cache HIT! Using cached academic year data"):(console.log("👨‍🏫 Cache MISS! Fetching academic year from API"),We=await _n.getAcademicYear(),console.log("👨‍🏫 Academic year response:",We),Fn(Fe,We,Dn.admin_academic_years)),console.log("👨‍🏫 First academic year record:",We?.[0]||We?.academic_years?.[0]),We&&Array.isArray(We)?(Z(We),console.log("👨‍🏫 Academic year data loaded:",We.length),console.log("👨‍🏫 Sample record fields:",Object.keys(We[0]||{}))):We&&We.academic_years?(Z(We.academic_years),console.log("👨‍🏫 Academic year data loaded:",We.academic_years.length),console.log("👨‍🏫 Sample record fields:",Object.keys(We.academic_years[0]||{}))):console.warn("👨‍🏫 Failed to load academic year data:",We?.error||"No data received")}catch(Fe){console.error("👨‍🏫 Error loading academic year data:",Fe)}},[]),be=C.useCallback(async()=>{console.log("👨‍🏫 Loading academic year data (direct return)...");try{const Fe="admin_academic_years_";let We=jn(Fe);return We?console.log("👨‍🏫 Cache HIT! Using cached academic year data"):(console.log("👨‍🏫 Cache MISS! Fetching academic year from API"),We=await _n.getAcademicYear(),console.log("👨‍🏫 Academic year response:",We),Fn(Fe,We,Dn.admin_academic_years)),We&&Array.isArray(We)?(console.log("👨‍🏫 Returning academic year data:",We.length),We):We&&We.academic_years?(console.log("👨‍🏫 Returning academic year data:",We.academic_years.length),We.academic_years):(console.warn("👨‍🏫 Failed to load academic year data:",We?.error||"No data received"),null)}catch(Fe){return console.error("👨‍🏫 Error loading academic year data:",Fe),null}},[]),pe=C.useCallback(async(Fe,We)=>{console.log("👨‍🏫 Showing classes for grade:",Fe,"class:",We),L(Fe),K(We),E(null),V(null),Fe&&We&&await vr(Fe,We)},[vr]);C.useCallback((Fe,We)=>{console.log("👨‍🏫 Showing semesters for class:",Fe,We),E(null),V(null),vr(Fe,We)},[]),C.useCallback((Fe,We)=>{console.log("👨‍🏫 Class clicked:",Fe,We),w(!0),vr(Fe,We)},[]);const xe=C.useCallback(async Fe=>{!B||!z||(console.log("👨‍🏫 Loading results for semester:",Fe),E(Fe),await fr(B,z,Fe))},[B,z,fr]);C.useCallback(()=>{let Fe=1;if(X&&X.length>0){const We=new Date;for(const Ct of X){const at=new Date(Ct.start_date),Qt=new Date(Ct.end_date);if(We>=at&&We<=Qt){Fe=Ct.semester;break}}}return o.jsx("div",{className:"flex space-x-4 mb-6",children:[1,2].map(We=>o.jsxs(et.button,{className:`px-6 py-3 rounded-lg font-semibold transition-all duration-300 ${b===We?"bg-blue-600 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>xe(We),whileHover:{scale:1.05},whileTap:{scale:.95},children:["Semester ",We,We===Fe&&o.jsx("span",{className:"ml-2 text-xs",children:"(Current)"})]},We))})},[b,xe,X]),C.useCallback(Fe=>Fe.reduce((We,Ct)=>(We[Ct.student_id]||(We[Ct.student_id]=[]),We[Ct.student_id].push(Ct),We),{}),[]),C.useCallback(Fe=>{if(Fe.length===0)return 0;const We=Fe.reduce((Ct,at)=>Ct+(at.percentage||0),0);return Math.round(We/Fe.length)},[]),C.useCallback(Fe=>{Fe.score<Fe.passing_score&&window.confirm("Give another try?")&&Se(Fe.student_id,Fe.test_id)},[]);const Se=C.useCallback(async(Fe,We)=>{try{(await fetch("/.netlify/functions/reset-test-attempt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:Fe,testId:We})})).ok&&(z&&xe(b),i("Test made accessible to student","success"))}catch(Ct){console.error("Error resetting test attempt:",Ct),i("Failed to reset test attempt","error")}},[z,b,xe,i]),ke=C.useCallback((Fe,We)=>{if(Fe===null||We===null)return"";const Ct=Math.round(Fe/We*100);return Ct>=80?"text-green-600 bg-green-50":Ct>=60?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50"},[]),$e=C.useCallback(Fe=>{It(Fe),Ie(!0)},[]),ht=C.useCallback((Fe,We="overview",Ct)=>{const at={...Fe,__initialTab:We};Ct&&(at.__audioUrl=Ct),Ze(at),mt(!0)},[]);C.useCallback((Fe,We,Ct)=>{Wt({resultId:Fe,score:We,maxScore:Ct}),Qe(We?.toString()||""),ft(Ct?.toString()||""),De(!0)},[]),C.useCallback(Fe=>{Qe(Fe)},[]),C.useCallback(Fe=>{ft(Fe)},[]),C.useCallback(async()=>{if($t){zt(!0);try{const Fe={resultId:$t.resultId,score:parseInt(lt)||0,maxScore:parseInt(yt)||1};(await fetch(Bw.UPDATE_DRAWING_TEST_SCORE,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Fe)})).ok?(i("Score updated successfully","success"),z&&xe(b),Wt(null),Qe(""),ft(""),De(!1)):i("Failed to update score","error")}catch(Fe){console.error("Error updating score:",Fe),i("Failed to update score","error")}finally{zt(!1)}}},[$t,lt,yt,z,b,xe,i]),C.useCallback(()=>{Wt(null),Qe(""),ft(""),De(!1)},[]);const Ke=C.useCallback((Fe,We)=>{pt({resultId:Fe,score:We}),Lt(We.toString())},[]),oe=C.useCallback(async()=>{if(ut){Te(!0);try{const Fe={resultId:ut.resultId,score:parseInt(Pt)||0},We=await fetch(Bw.UPDATE_SPEAKING_TEST_SCORE,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Fe)});if(We.ok){const Ct=await We.json();i("Speaking test score updated successfully","success"),je&&Ze(at=>({...at,score:Ct.score,percentage:Ct.percentage})),z&&xe(b),pt(null),Lt("")}else{const Ct=await We.json();i(Ct.error||"Failed to update speaking test score","error")}}catch(Fe){console.error("Error updating speaking test score:",Fe),i("Failed to update speaking test score","error")}finally{Te(!1)}}},[ut,Pt,z,b,xe,i]),he=C.useCallback(()=>{pt(null),Lt("")},[]),Ce=(Fe,We)=>{if(console.log("🎯 Starting column editing for drawing test:",Fe),console.log("🎯 Current editingColumns before update:",Array.from(ve)),console.log("🎯 Results data passed to function:",We),fe(Ct=>{const at=new Set(Ct).add(Fe);return console.log("🎯 Updated editingColumns:",Array.from(at)),at}),console.log("🎯 Initializing column scores for test:",Fe),console.log("🎯 Results data:",We),console.log("🎯 Results.class:",We?We.class:"null"),We&&We.class){const Ct={};console.log("🎯 Processing",We.class.length,"students"),We.class.forEach((at,Qt)=>{console.log(`🎯 Student ${Qt}:`,at.student_id,"Keys:",Object.keys(at));const tt=at[Fe];console.log(`🎯 Student ${at.student_id} test result for ${Fe}:`,tt),console.log("🎯 Test result keys:",tt?Object.keys(tt):"null"),console.log("🎯 Test result id:",tt?tt.id:"null"),tt&&(tt.test_type==="drawing"||tt.test_type==="speaking")&&(console.log("🎯 SPEAKING TEST RESULT:",tt),console.log("🎯 SPEAKING TEST TYPE:",tt.test_type),console.log("🎯 SPEAKING TEST ANSWERS:",tt.answers),Ct[at.student_id]={score:(tt.score||0).toString(),maxScore:(tt.max_score||100).toString(),resultId:tt.id})}),console.log("🎯 Initial scores for column:",Ct),Ue(at=>({...at,[Fe]:Ct}))}else console.log("🎯 No results or class data available")},Ne=C.useCallback(Fe=>{fe(We=>{const Ct=new Set(We);return Ct.delete(Fe),Ct}),Ue(We=>{const Ct={...We};return delete Ct[Fe],Ct})},[]),Ge=C.useCallback((Fe,We,Ct,at)=>{const Qt=at.toString();Ot.current[Fe]||(Ot.current[Fe]={}),Ot.current[Fe][We]||(Ot.current[Fe][We]={}),Ot.current[Fe][We][Ct]=Qt;const tt=parseInt(at)||0;Ue(jt=>({...jt,[Fe]:{...jt[Fe],[We]:{...jt[Fe]?.[We],[Ct]:tt}}}))},[]),ot=C.useCallback(async Fe=>{if(Ot.current[Fe]){xt(!0);try{const We=Object.entries(Ot.current[Fe]).map(([tt,jt])=>({resultId:jt.resultId,score:parseInt(jt.score)||0,maxScore:parseInt(jt.maxScore)||100}));console.log("🎯 Saving column scores for",Fe,":",We);const Ct=We.map(tt=>(console.log("🎯 Sending update:",tt),fetch(Bw.UPDATE_DRAWING_TEST_SCORE,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(tt)})));(await Promise.all(Ct)).every(tt=>tt.ok)?(i(`Scores updated successfully for ${Fe}`,"success"),z&&xe(b),Ne(Fe)):i("Failed to update some scores","error")}catch(We){console.error("Error updating column scores:",We),i("Failed to update scores","error")}finally{xt(!1)}}},[we,z,b,xe,i,Ne]),Le=C.useCallback((Fe,We,Ct)=>!We||We.length===0?o.jsx(et.div,{className:"text-center py-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:o.jsx("p",{className:"text-gray-500",children:"No students found for this subject"})}):o.jsxs(et.div,{className:"relative",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:[ue&&o.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 z-10 bg-blue-500 text-white rounded-full p-2 shadow-lg",children:o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),He&&o.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 z-10 bg-blue-500 text-white rounded-full p-2 shadow-lg",children:o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),o.jsxs(et.div,{className:"bg-white rounded-lg shadow-lg overflow-hidden",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1},children:[o.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",onScroll:at=>{Xe.current&&(Xe.current.scrollLeft=at.target.scrollLeft)},children:o.jsx("div",{className:"min-w-full h-1",children:o.jsx("div",{className:"h-1",style:{width:`${(Ct.length+5)*120}px`}})})}),o.jsx("div",{ref:Xe,className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",onScroll:at=>{Fr(at);const Qt=at.target.previousElementSibling;Qt&&(Qt.scrollLeft=at.target.scrollLeft)},children:o.jsxs("table",{className:"min-w-full border-collapse text-sm min-w-max",children:[o.jsx("thead",{children:o.jsxs(et.tr,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:[o.jsx("th",{className:"border-b border-gray-200 px-4 py-4 text-left font-semibold text-gray-700 w-20 text-center",children:"Student ID"}),o.jsx("th",{className:"border-b border-gray-200 px-4 py-4 text-left font-semibold text-gray-700 min-w-[120px]",children:"Name"}),o.jsx("th",{className:"border-b border-gray-200 px-4 py-4 text-left font-semibold text-gray-700 min-w-[120px]",children:"Surname"}),o.jsx("th",{className:"border-b border-gray-200 px-4 py-4 text-left font-semibold text-gray-700 w-16 text-center",children:"No."}),o.jsx("th",{className:"border-b border-gray-200 px-4 py-4 text-left font-semibold text-gray-700 min-w-[100px]",children:"Nickname"}),Ct.map((at,Qt)=>{const tt=_e.has(at.test_name),jt=at.test_type==="drawing",re=Ht.current.has(at.test_name);return console.log(`🎯 Rendering test ${at.test_name}:`,{isDrawingTest:jt,isEditingColumn:re,editingColumns:Array.from(Ht.current),test_type:at.test_type}),o.jsx("th",{className:`border-b border-gray-200 px-2 py-4 text-left font-semibold text-gray-700 cursor-pointer hover:bg-blue-200 transition-colors select-none ${tt?"w-8 min-w-[32px] max-w-[32px] bg-gray-100":"min-w-[100px] bg-blue-50"}`,onClick:de=>{de.preventDefault(),de.stopPropagation(),console.log("🖱️ Clicked on test header:",at.test_name),pr(at.test_name)},children:tt?o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):o.jsxs("div",{className:"flex flex-col space-y-2",children:[jt&&o.jsx("div",{className:"flex justify-center",children:re?o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:de=>{de.preventDefault(),de.stopPropagation(),ot(at.test_name)},disabled:St,className:"px-2 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:St?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save"}),o.jsx("button",{onClick:de=>{de.preventDefault(),de.stopPropagation(),Ne(at.test_name)},disabled:St,className:"px-2 py-1 bg-gray-500 text-white text-xs rounded hover:bg-gray-600 disabled:opacity-50",children:"Cancel"})]}):o.jsx("button",{onClick:de=>{de.preventDefault(),de.stopPropagation(),console.log("🎯 Edit Column button clicked for drawing test:",at.test_name),console.log("🎯 Results state at button click:",I),console.log("🎯 Current results ref:",Xt.current),Ce(at.test_name,Xt.current)},className:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Edit Column"})}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"truncate",title:at.test_name,children:at.test_name.length>8?at.test_name.substring(0,8)+"...":at.test_name}),o.jsx("svg",{className:"w-4 h-4 ml-1 flex-shrink-0 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})},Qt)})]})}),o.jsx("tbody",{children:o.jsx(_i,{children:We.map((at,Qt)=>o.jsxs(et.tr,{className:`border-b border-gray-100 hover:bg-blue-50 transition-colors duration-200 ${Qt%2===0?"bg-white":"bg-gray-50"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1+Qt*.05,ease:"easeOut"},whileHover:{scale:1.01,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.99},children:[o.jsx(et.td,{className:"border-b border-gray-100 px-4 py-4 text-center font-semibold text-gray-900",whileHover:{scale:1.05},transition:{duration:.2},children:at.student_id}),o.jsx(et.td,{className:"border-b border-gray-100 px-4 py-4 text-gray-900",whileHover:{scale:1.02},transition:{duration:.2},children:at.name}),o.jsx(et.td,{className:"border-b border-gray-100 px-4 py-4 text-gray-900",whileHover:{scale:1.02},transition:{duration:.2},children:at.surname}),o.jsx(et.td,{className:"border-b border-gray-100 px-4 py-4 text-center text-gray-900",whileHover:{scale:1.02},transition:{duration:.2},children:at.number??Qt+1}),o.jsx(et.td,{className:"border-b border-gray-100 px-4 py-4 text-gray-600",whileHover:{scale:1.02},transition:{duration:.2},children:at.nickname||"-"}),Ct.map((tt,jt)=>{const re=_e.has(tt.test_name),de=at[tt.test_name];return re?(console.log("📥 Rendering collapsed column for test:",tt.test_name),o.jsx("td",{className:"border-b border-gray-100 px-1 py-4 text-sm w-8 min-w-[32px] max-w-[32px]",children:o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-4 h-4 text-gray-400 cursor-pointer hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:Pe=>{Pe.preventDefault(),Pe.stopPropagation(),console.log("🖱️ Clicked on collapsed arrow for:",tt.test_name),pr(tt.test_name)},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})},jt)):o.jsx(et.td,{className:"border-b border-gray-100 px-2 py-4 text-sm min-w-[100px]",initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},transition:{duration:.3},whileHover:{scale:1.02},onClick:Pe=>{if(console.debug("[TeacherResults] Main table TD clicked",{testResult:de,student:at.student_id}),de?.retest_offered){i("Retest is already offered","info");return}const Je=l(de);Je!==null&&Je<50&&(console.debug("[TeacherResults] Main table TD -> opening retest modal",{studentId:at.student_id,test:tt}),n({failedStudentIds:[at.student_id],test_type:tt.test_type,original_test_id:de?.test_id||tt.test_id,subject_id:de?.subject_id||tt.subject_id,grade:t,class:r}))},children:de&&de.test_type==="drawing"?o.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[o.jsx("button",{onClick:()=>$e(de),className:"text-blue-600 hover:text-blue-800 underline text-sm font-medium px-2 py-1 rounded hover:bg-blue-50",children:"View Drawing"}),(()=>{const Pe=Ht.current.has(tt.test_name);return console.log(`🎯 Score cell for ${tt.test_name}:`,{isEditing:Pe,editingColumns:Array.from(Ht.current),test_name:tt.test_name}),Pe})()?o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"number",min:"0",max:de.max_score||100,value:Ot.current[tt.test_name]?.[at.student_id]?.score||de.score||"",onChange:Pe=>Ge(tt.test_name,at.student_id,"score",Pe.target.value),className:"w-16 px-2 py-1 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Score"}),o.jsx("span",{className:"text-xs text-gray-500",children:"/"}),o.jsx("input",{type:"number",min:"1",value:Ot.current[tt.test_name]?.[at.student_id]?.maxScore||de.max_score||100,onChange:Pe=>Ge(tt.test_name,at.student_id,"maxScore",Pe.target.value),className:"w-16 px-2 py-1 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Max"})]}):o.jsxs("div",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 cursor-pointer hover:bg-gray-200 transition-colors",onDoubleClick:()=>{console.log("🎯 Double-clicked on drawing test score:",tt.test_name),console.log("🎯 Results state at double-click:",I),console.log("🎯 Current results ref:",Xt.current),Ce(tt.test_name,Xt.current)},title:"Double-click to edit column",children:[de.score||0,"/",de.max_score||100]}),de.caught_cheating&&de.visibility_change_times&&o.jsxs("span",{className:"text-xs text-red-600",children:["(",de.visibility_change_times,")"]})]}):de&&(de.test_type==="speaking"||tt.test_type==="speaking")?o.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[(()=>{const Pe=de?.answers;let Je;if(typeof Pe=="string")if(/^https?:\/\//i.test(Pe))Je=Pe;else try{Je=JSON.parse(Pe)?.audio_url}catch{}else Pe&&typeof Pe=="object"&&(Je=Pe.audio_url);return!Je&&de?.audio_url&&(Je=de.audio_url),console.log("🎧 Final computed audioUrl (main table):",{studentId:at.student_id,testName:tt.test_name,audioUrl:Je}),o.jsx(o.Fragment,{children:o.jsx("button",{onClick:()=>ht({...de,__studentId:at.student_id},"audio",Je),className:"text-blue-600 hover:text-blue-800 underline text-sm font-medium px-2 py-1 rounded hover:bg-blue-50",children:"View Audio"})})})(),(()=>{const Pe=Ht.current.has(tt.test_name);return console.log(`🎯 Score cell for ${tt.test_name}:`,{isEditing:Pe,editingColumns:Array.from(Ht.current),test_name:tt.test_name}),Pe})()?o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"number",min:"0",max:de.max_score||100,value:Ot.current[tt.test_name]?.[at.student_id]?.score||de.score||"",onChange:Pe=>Ge(tt.test_name,at.student_id,"score",Pe.target.value),className:"w-16 px-2 py-1 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Score"}),o.jsx("span",{className:"text-xs text-gray-500",children:"/"}),o.jsx("input",{type:"number",min:"1",value:Ot.current[tt.test_name]?.[at.student_id]?.maxScore||de.max_score||100,onChange:Pe=>Ge(tt.test_name,at.student_id,"maxScore",Pe.target.value),className:"w-16 px-2 py-1 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Max"})]}):o.jsxs("div",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 cursor-pointer hover:bg-gray-200 transition-colors",onDoubleClick:()=>{console.log("🎯 Double-clicked on speaking test score:",tt.test_name),console.log("🎯 Results state at double-click:",I),console.log("🎯 Test result:",de),console.log("🎯 Student:",at),console.log("🎯 Test:",tt),de&&de.id?(console.log("🎯 Starting column editing for speaking test:",tt.test_name),Ce(tt.test_name)):console.log("🎯 No test result ID found, cannot edit")},title:"Double-click to edit scores",children:[(()=>{const Pe=l(de),Je=Pe!==null&&Pe<50,gr=Pe!==null&&Pe>=50&&Pe<70,or=de.retest_offered,Or=Pe===null?"text-gray-600":Je?"text-red-600 font-semibold":gr?"text-yellow-600":"text-green-600";return o.jsxs(et.div,{className:`px-2 py-1 rounded-full text-xs font-medium ${Or} ${Je?"cursor-pointer hover:opacity-90":""} ${or?"bg-blue-50 text-blue-700 border border-blue-200":""}`,style:Je?{color:"#b91c1c"}:void 0,whileHover:{scale:Je?1.1:1.05},transition:{duration:.2},onClick:()=>{Je&&!or&&(console.log("🎯 Offering retest for speaking test:",tt.test_name),n({failedStudentIds:[at.student_id],test_type:tt.test_type,original_test_id:de?.test_id||tt.test_id,subject_id:de?.subject_id||tt.subject_id,grade:t,class:r}))},title:or?"Retest offered":Je?"Offer retest":"",children:[(()=>{const Dr=de.retest_best_score??de.score,Xr=de.retest_best_max_score??de.max_score;return o.jsxs(o.Fragment,{children:[o.jsx("span",{className:Je?"text-red-700":"",children:Dr}),"/",o.jsx("span",{children:Xr})]})})(),de.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})})(),de.caught_cheating&&de.visibility_change_times&&o.jsxs("span",{className:"text-xs text-red-600",children:["(",de.visibility_change_times,")"]})]})]}):de&&de.score!==null&&de.score!==void 0?o.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[(()=>{const Pe=l(de),Je=Pe!==null&&Pe<50,gr=Pe!==null&&Pe>=50&&Pe<70,or=Pe!==null&&Pe>=70;console.debug("[TeacherResults] Main table pill",{studentId:at.student_id,pct:Pe,isRed:Je,isYellow:gr,isGreen:or,testResult:de});const Or=Pe===null?"text-gray-600":Je?"text-red-600 font-semibold":gr?"text-yellow-600":"text-green-600",Dr=de?.retest_offered===!0;return o.jsxs(et.div,{className:`px-2 py-1 rounded-full text-xs font-medium ${Or} ${Je?"cursor-pointer hover:opacity-90":""} ${Dr?"bg-blue-50 text-blue-700 border border-blue-200":""}`,style:Je?{color:"#b91c1c"}:void 0,whileHover:{scale:Je?1.1:1.05},transition:{duration:.2},onClick:Xr=>{if(Xr.preventDefault(),Xr.stopPropagation(),de?.retest_offered){i("Retest is already offered","info");return}Je&&(console.debug("[TeacherResults] Main table pill clicked -> opening retest modal",{studentId:at.student_id,test:tt}),n({failedStudentIds:[at.student_id],test_type:tt.test_type,original_test_id:de?.test_id||tt.test_id,subject_id:de?.subject_id||tt.subject_id,grade:t,class:r}))},title:Dr?"Retest offered":Je?"Offer retest":"",children:[(()=>{const Xr=de.retest_best_score??de.score,Zr=de.retest_best_max_score??de.max_score;return o.jsxs(o.Fragment,{children:[o.jsx("span",{className:Je?"text-red-700":"",children:Xr}),"/",o.jsx("span",{children:Zr})]})})(),de.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})})(),de.caught_cheating&&de.visibility_change_times&&o.jsxs("span",{className:"text-xs text-red-600",children:["(",de.visibility_change_times,")"]})]}):o.jsx("span",{className:"text-gray-400",children:"-"})},jt)})]},Qt))})})]})})]})]}),[ke,_e,pr]),Et=C.useCallback((Fe,We,Ct)=>!We||We.length===0?o.jsx(et.div,{className:"text-center py-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:o.jsx("p",{className:"text-gray-500",children:"No students found for this subject"})}):o.jsx(et.div,{className:"w-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},children:o.jsx(et.div,{className:"overflow-x-auto -mx-4 px-4",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.1},children:o.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden min-w-max",children:o.jsxs("table",{className:"w-full border-collapse text-xs min-w-max",children:[o.jsx("thead",{children:o.jsxs(et.tr,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.2,delay:.2},children:[o.jsx("th",{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 w-16 text-center",children:"ID"}),o.jsx("th",{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 min-w-[100px]",children:"Name"}),o.jsx("th",{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 min-w-[100px]",children:"Surname"}),o.jsx("th",{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 w-12 text-center",children:"No."}),o.jsx("th",{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 min-w-[80px]",children:"Nickname"}),Ct.map((at,Qt)=>{const tt=at.test_type==="drawing",jt=Ht.current.has(at.test_name);return o.jsx(et.th,{className:"border-b border-gray-200 px-3 py-3 text-left font-semibold text-gray-700 min-w-[100px]",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.2,delay:.3+Qt*.05},children:o.jsxs("div",{className:"flex flex-col space-y-1",children:[tt&&o.jsx("div",{className:"flex justify-center",children:jt?o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:re=>{re.preventDefault(),re.stopPropagation(),ot(at.test_name)},disabled:St,className:"px-1 py-0.5 bg-green-600 text-white text-xs rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:St?"Saving...":"Save"}),o.jsx("button",{onClick:re=>{re.preventDefault(),re.stopPropagation(),Ne(at.test_name)},disabled:St,className:"px-1 py-0.5 bg-gray-500 text-white text-xs rounded hover:bg-gray-600 disabled:opacity-50",children:"Cancel"})]}):o.jsx("button",{onClick:re=>{re.preventDefault(),re.stopPropagation(),Ce(at.test_name)},className:"px-1 py-0.5 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Edit"})}),o.jsx("span",{className:"text-xs",children:at.test_name.length>10?at.test_name.substring(0,10)+"...":at.test_name})]})},Qt)})]})}),o.jsx("tbody",{children:o.jsx(_i,{children:We.map((at,Qt)=>o.jsxs(et.tr,{className:`border-b border-gray-100 hover:bg-blue-50 transition-colors duration-200 ${Qt%2===0?"bg-white":"bg-gray-50"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.2,delay:.1+Qt*.03,ease:"easeOut"},whileHover:{scale:1.005,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.995},children:[o.jsx(et.td,{className:"border-b border-gray-100 px-3 py-3 text-center font-semibold text-gray-900",whileHover:{scale:1.03},transition:{duration:.15},children:at.student_id}),o.jsx(et.td,{className:"border-b border-gray-100 px-3 py-3 text-gray-900 truncate",whileHover:{scale:1.01},transition:{duration:.15},children:at.name}),o.jsx(et.td,{className:"border-b border-gray-100 px-3 py-3 text-gray-900 truncate",whileHover:{scale:1.01},transition:{duration:.15},children:at.surname}),o.jsx(et.td,{className:"border-b border-gray-100 px-3 py-3 text-center text-gray-900 truncate",whileHover:{scale:1.01},transition:{duration:.15},children:at.number??Qt+1}),o.jsx(et.td,{className:"border-b border-gray-100 px-3 py-3 text-gray-600 whitespace-normal break-words",whileHover:{scale:1.01},transition:{duration:.15},children:at.nickname||"-"}),Ct.map((tt,jt)=>{const re=_e.has(tt.test_name),de=at[tt.test_name];return re?o.jsx("td",{className:"border-b border-gray-100 px-1 py-3 text-sm w-8 min-w-[32px] max-w-[32px]",children:o.jsx("div",{className:"flex justify-center",children:o.jsx("svg",{className:"w-4 h-4 text-gray-400 cursor-pointer hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:Pe=>{Pe.preventDefault(),Pe.stopPropagation(),pr(tt.test_name)},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})},jt):o.jsx(et.td,{className:"border-b border-gray-100 px-3 py-3 text-sm",whileHover:{scale:1.01},transition:{duration:.15},onClick:Pe=>{console.debug("[TeacherResults] TD clicked",{testResult:de,student:at.student_id});const Je=l(de);if(Je!==null&&Je<50){if(de?.retest_offered){i("Retest is already offered","info");return}console.debug("[TeacherResults] TD -> opening retest modal",{studentId:at.student_id}),n({failedStudentIds:[at.student_id],grade:t,class:r})}},children:de&&de.score!==null&&de.score!==void 0?o.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[de.test_type==="drawing"?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>$e(de),className:"text-blue-600 hover:text-blue-800 underline text-xs font-medium px-1 py-0.5 rounded hover:bg-blue-50",children:"View"}),Ht.current.has(tt.test_name)?o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"number",min:"0",max:de.max_score||100,value:Ot.current[tt.test_name]?.[at.student_id]?.score||de.score||"",onChange:Pe=>Ge(tt.test_name,at.student_id,"score",Pe.target.value),className:"w-12 px-1 py-0.5 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Score"}),o.jsx("span",{className:"text-xs text-gray-500",children:"/"}),o.jsx("input",{type:"number",min:"1",value:Ot.current[tt.test_name]?.[at.student_id]?.maxScore||de.max_score||100,onChange:Pe=>Ge(tt.test_name,at.student_id,"maxScore",Pe.target.value),className:"w-12 px-1 py-0.5 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Max"})]}):o.jsxs(et.div,{className:`px-1 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 cursor-pointer hover:bg-gray-200 transition-colors ${de.caught_cheating?"bg-red-100 text-red-800 border border-red-300":"bg-gray-100 text-gray-800"}`,whileHover:{scale:1.05},transition:{duration:.15},onDoubleClick:()=>Ce(tt.test_name),title:"Double-click to edit column",children:[de.score,"/",de.max_score,de.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})]}):de.test_type==="speaking"||tt.test_type==="speaking"?o.jsxs(o.Fragment,{children:[console.log("🎧 Rendering speaking link (compact table):",{studentId:at.student_id,testName:tt.test_name,testType:de?.test_type,answers:de?.answers}),o.jsx("button",{onClick:()=>ht({...de,__studentId:at.student_id},"audio"),className:"text-blue-600 hover:text-blue-800 underline text-xs font-medium px-1 py-0.5 rounded hover:bg-blue-50",children:"View Audio"}),Ht.current.has(tt.test_name)?o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"number",min:"0",max:de.max_score||100,value:Ot.current[tt.test_name]?.[at.student_id]?.score||de.score||"",onChange:Pe=>Ge(tt.test_name,at.student_id,"score",Pe.target.value),className:"w-12 px-1 py-0.5 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Score"}),o.jsx("span",{className:"text-xs text-gray-500",children:"/"}),o.jsx("input",{type:"number",min:"1",value:Ot.current[tt.test_name]?.[at.student_id]?.maxScore||de.max_score||100,onChange:Pe=>Ge(tt.test_name,at.student_id,"maxScore",Pe.target.value),className:"w-12 px-1 py-0.5 text-xs border border-blue-500 bg-blue-50 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Max"})]}):o.jsxs(et.div,{className:`px-1 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 cursor-pointer hover:bg-gray-200 transition-colors ${de.caught_cheating?"bg-red-100 text-red-800 border border-red-300":"bg-gray-100 text-gray-800"}`,whileHover:{scale:1.05},transition:{duration:.15},onDoubleClick:()=>Ce(tt.test_name),title:"Double-click to edit scores",children:[de.score||0,"/",de.max_score||100,de.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})]}):(()=>{const Pe=l(de),Je=Pe!==null&&Pe<50,gr=Pe!==null&&Pe>=50&&Pe<70,or=Pe!==null&&Pe>=70;console.debug("[TeacherResults] Render pill",{studentId:at.student_id,pct:Pe,isRed:Je,isYellow:gr,isGreen:or,score:de.score,max:de.max_score,percentageField:de.percentage});const Dr=`px-1 py-0.5 rounded text-xs font-medium ${Pe===null?"text-gray-600":Je?"text-red-600 font-semibold":gr?"text-yellow-600":"text-green-600"} ${Je?"cursor-pointer hover:opacity-90 pointer-events-auto":""}`;return console.debug("[TeacherResults] Pill classes",{classNameStr:Dr,pct:Pe,isRed:Je,isYellow:gr,isGreen:or}),o.jsxs(et.div,{className:Dr,style:Je?{color:"#b91c1c"}:void 0,whileHover:{scale:Je?1.05:1},transition:{duration:.15},onClick:Je?Xr=>{Xr.preventDefault(),Xr.stopPropagation();const Zr=window.getComputedStyle(Xr.currentTarget).color;console.debug("[TeacherResults] Red pill clicked -> opening retest modal",{studentId:at.student_id,className:Dr,computedColor:Zr}),n({failedStudentIds:[at.student_id],grade:t,class:r})}:void 0,title:Je?"Offer retest":"",children:[o.jsx("span",{className:Je?"text-red-700":"",children:de.score}),"/",o.jsx("span",{children:de.max_score}),de.caught_cheating&&o.jsx("span",{className:"ml-1",children:"⚠️"})]})})(),de.caught_cheating&&de.visibility_change_times&&o.jsxs("span",{className:"text-xs text-red-600",children:["(",de.visibility_change_times,")"]})]}):o.jsx("span",{className:"text-gray-400",children:"-"})},jt)})]},Qt))})})]})})})}),[ke,_e,pr]),Bt=C.useCallback(()=>{if(!I)return null;console.log("🔍 renderResults - results:",I),console.log("🔍 renderResults - results.class:",I.class),console.log("🔍 renderResults - results.unique_tests:",I.unique_tests);const Fe=I.class&&Array.isArray(I.class)&&I.class.length>0;if(console.log("🔍 renderResults - hasStudentData:",Fe),!Fe)return console.log("🔍 renderResults - No student data, showing no students message"),o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No students found for this class and semester."})});const We=I.unique_tests||[];return console.log("🔍 renderResults - uniqueTests:",We),Xt.current=I,o.jsxs("div",{className:"space-y-6",children:[o.jsxs(et.div,{className:"bg-gradient-to-r from-red-500 to-pink-500 rounded-lg p-6 text-white",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:[o.jsxs(et.h2,{className:"text-2xl font-bold mb-2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.1},children:["Test Results - Grade M",B,", Class ",B,"/",z,", Semester ",b]}),o.jsxs(et.p,{className:"text-cyan-100",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2},children:["Viewing results for ",I.subjects?.length||0," subject(s)"]}),o.jsxs(et.div,{className:"mt-4 flex gap-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},children:[o.jsx("button",{onClick:()=>{const Ct=I.unique_tests?.map(at=>at.test_name)||[];Me(new Set(Ct))},className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-colors",children:"Collapse All Tests"}),o.jsx("button",{onClick:()=>Me(new Set),className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-colors",children:"Expand All Tests"})]})]}),o.jsxs(et.div,{className:"bg-white rounded-lg shadow p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},children:[o.jsx(et.h3,{className:"text-lg font-semibold text-gray-900 mb-4",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.2},children:"Class Results"}),o.jsx("div",{className:"hidden md:block",children:Le("All Subjects",I.class,We)}),o.jsx("div",{className:"md:hidden",children:Et("All Subjects",I.class,We)})]})]})},[I,Le,B,z,b]),Yt=C.useCallback(()=>{if(!I||!I.class||!I.unique_tests)return;const Fe=["Student ID","Name","Surname","No.","Nickname",...I.unique_tests.map(jt=>jt.test_name)],We=I.class.map((jt,re)=>{const de=[];return de.push(jt.student_id),de.push(jt.name),de.push(jt.surname),de.push(jt.number??re+1),de.push(jt.nickname||"-"),I.unique_tests.forEach(Pe=>{const Je=jt[Pe.test_name];Je&&Je.score!==null&&Je.score!==void 0?de.push(`${Je.score}/${Je.max_score}`):de.push("-")}),de}),Ct=M1.aoa_to_sheet([Fe,...We]),at=M1.book_new(),Qt=[{wch:10},{wch:15},{wch:15},{wch:6},{wch:12},...I.unique_tests.map(()=>({wch:15}))];Ct["!cols"]=Qt,M1.book_append_sheet(at,Ct,"Class Results");const tt=`class-results-${B}-${z}-semester-${b}.xlsx`;Lte(at,tt),i("Excel file exported successfully!","success")},[I,B,z,b,i]);return f?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Teacher Results..."})]})}):g?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Results Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:g}),o.jsx(nt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsx("div",{className:"flex justify-between items-center py-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Results"}),o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",ie?ie.toLocaleString():"Never"]})]})})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Class"}),P.length>0?o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:P.map((Fe,We)=>o.jsxs(nt,{variant:B===Fe.grade&&z===Fe.class?"primary":"outline",onClick:()=>pe(Fe.grade,Fe.class),className:"w-full",children:[Fe.grade,"/",Fe.class]},`${Fe.grade}-${Fe.class}-${We}`))}):o.jsx("p",{className:"text-gray-500",children:"No classes available"})]}),z&&o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Select Semester for ",B,"/",z]}),o.jsx("div",{className:"flex space-x-4",children:[1,2].map(Fe=>{let We=1;if(X&&X.length>0){const Ct=new Date;for(const at of X){const Qt=new Date(at.start_date),tt=new Date(at.end_date);if(Ct>=Qt&&Ct<=tt){We=at.semester;break}}}return o.jsxs(et.button,{className:`px-6 py-3 rounded-lg font-semibold transition-all duration-300 ${b===Fe?"bg-blue-600 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>xe(Fe),whileHover:{scale:1.05},whileTap:{scale:.95},children:["Semester ",Fe,Fe===We&&o.jsx("span",{className:"ml-2 text-xs",children:"(Current)"})]},Fe)})})]}),z&&I&&o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[B," ",z," - Test Results (Semester ",b,")"]}),o.jsx("div",{className:"flex space-x-3",children:o.jsxs("button",{type:"button",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md hover:shadow-lg transition-all duration-200 flex items-center space-x-2",onClick:Yt,children:[o.jsx("img",{src:"/pics/excel.png",alt:"Excel",className:"w-4 h-4 object-contain"}),o.jsx("span",{className:"font-medium text-sm",children:"Export Excel"})]})})]}),Bt()]}),z&&!I&&o.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"No test results available for this class and semester."})})})]})}),Ve&&st&&o.jsx(hN,{children:o.jsx(Qj,{drawing:Ve,isOpen:st,onClose:()=>Ie(!1),isTeacherView:!0})}),je&&bt&&o.jsx(hN,{children:o.jsx(Kz,{result:je,isOpen:bt,onClose:()=>mt(!1),initialTab:je.__initialTab||"overview",editingSpeakingScore:ut,tempSpeakingScore:Pt,isSavingSpeakingScore:sr,onStartSpeakingScoreEdit:Ke,onSaveSpeakingScore:oe,onCancelSpeakingScoreEdit:he,onTempSpeakingScoreChange:Lt})})]})},S3=({onBackToLogin:e})=>{const t=Ei(),{user:r,isAuthenticated:n,logout:s,getCurrentTeacherUsername:a}=Bn(),{teacherData:i,loadTeacherData:l}=Jy(),{activeTests:c,loadActiveTests:d}=zp(),{showNotification:f,notifications:p}=ka(),[g,y]=C.useState(!0),[v,_]=C.useState(""),[b,E]=C.useState("main"),[k,w]=C.useState([]),[N,A]=C.useState([]),[P,R]=C.useState(null),[T,D]=C.useState(null),[I,V]=C.useState(null),[X,Z]=C.useState(!1),[ie,q]=C.useState(!1),[ne,M]=C.useState(null),[W,L]=C.useState(!1),[H,K]=C.useState(null),[B,z]=C.useState(!1),[Q,Y]=C.useState(null),[te,ee]=C.useState(null),[ae,ge]=C.useState([]),[_e,Me]=C.useState(!1),[ue,me]=C.useState(null),[He,qe]=C.useState({}),[Xe,Ve]=C.useState(!1),[It,st]=C.useState(!1),[Ie,je]=C.useState(0),[Ze,bt]=C.useState(!1),[mt,$t]=C.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[Wt,lt]=C.useState([]),[Qe,yt]=C.useState([]),[ft,_t]=C.useState(!1),[zt,Jt]=C.useState(null),[De,ut]=C.useState([]),[pt,Pt]=C.useState(!1),[Lt,sr]=C.useState("subject");C.useEffect(()=>{Ht()},[]),C.useEffect(()=>{const re=de=>{Xe&&!de.target.closest(".relative")&&Ve(!1),It&&!de.target.closest(".relative")&&st(!1)};return document.addEventListener("mousedown",re),()=>{document.removeEventListener("mousedown",re)}},[Xe,It]);const Te=C.useCallback(()=>{console.log("🔧 showChangePasswordTab called"),bt(!0),Ve(!1),st(!1)},[]),ve=C.useCallback(()=>{console.log("🔧 hideChangePasswordTab called"),bt(!1),$t({currentPassword:"",newPassword:"",confirmPassword:""})},[]),fe=C.useCallback(async()=>{if(!r)return;const{currentPassword:re,newPassword:de,confirmPassword:Pe}=mt;if(!re||!de||!Pe){f("Please fill in all fields","error");return}if(de!==Pe){f("New passwords do not match","error");return}if(de.length<6){f("New password must be at least 6 characters long","error");return}const Je=/[a-zA-Z]/.test(de),gr=/[0-9]/.test(de);if(!Je||!gr){f("New password must contain both letters and numbers","error");return}try{const or=await _n.changePassword({username:r.username,currentPassword:re,newPassword:de});or.success?(f("Password changed successfully!","success"),ve()):f(or.message||"Failed to change password","error")}catch(or){console.error("Password change error:",or),f("Failed to change password. Please try again.","error")}},[r,mt,f]),we=C.useCallback(re=>{const{name:de,value:Pe}=re.target;$t(Je=>({...Je,[de]:Pe}))},[]),Ue=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher data...");try{const re=await _n.getTeacherData();return console.log("👨‍🏫 Teacher data loaded:",re),ee(new Date),re}catch(re){throw console.error("👨‍🏫 Error loading teacher data:",re),re}},[]),St=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher subjects...");try{const re=`teacher_subjects_${r?.teacher_id||r?.id||""}`,de=jn(re);if(de)return console.log("👨‍🏫 Using cached teacher subjects"),w(de),de;const Pe=await _n.getTeacherData();console.log("👨‍🏫 Raw teacher data:",Pe);const Je=_n.getTeacherSubjects(Pe.subjects);return console.log("👨‍🏫 Teacher subjects loaded:",Je),w(Je),Fn(re,Je,Dn.teacher_subjects),console.log("📊 Available classes for performance chart:",Je[0]?.classes||[]),console.log("📊 Performance chart will load when user clicks on a class"),Je}catch(re){throw console.error("👨‍🏫 Error loading teacher subjects:",re),re}},[r?.teacher_id,r?.id]),xt=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher active tests...");try{const re=`teacher_tests_${r?.teacher_id||r?.id||""}`,de=jn(re);de&&de.some(gr=>gr.test_type==="drawing")&&(console.log("🎨 Drawing test detected - forcing cache refresh"),localStorage.removeItem(re));const Pe=jn(re);if(Pe)return console.log("👨‍🏫 Using cached teacher tests"),A(Pe),Pe;const Je=await rn.getTeacherTests();return console.log("👨‍🏫 Teacher tests loaded:",Je),A(Je),Fn(re,Je,Dn.teacher_tests),Je}catch(re){throw console.error("👨‍🏫 Error loading teacher tests:",re),re}},[r?.teacher_id,r?.id]),Ht=C.useCallback(async()=>{console.log("👨‍🏫 Initializing Teacher Cabinet...");try{if(y(!0),_(""),!n||!r){console.log("👨‍🏫 User not authenticated"),_("User not authenticated");return}if(r.role!==si.TEACHER){console.error("👨‍🏫 Invalid user role for teacher cabinet:",r.role),_("Access denied. Teacher role required.");return}console.log("👨‍🏫 Loading teacher data..."),await Ue(),console.log("👨‍🏫 Loading teacher subjects..."),await St(),console.log("👨‍🏫 Loading active tests..."),await xt(),console.log("👨‍🏫 Teacher Cabinet initialization complete!")}catch(re){console.error("👨‍🏫 Error initializing teacher cabinet:",re),_("Failed to initialize teacher cabinet")}finally{y(!1)}},[n,r,Ue,St,xt]),Ot=C.useCallback(()=>{console.log("👨‍🏫 Showing subject selection prompt..."),Z(!0),Xt(),sr("subject")},[]),Xt=C.useCallback(async()=>{console.log("👨‍🏫 Loading available subjects..."),_t(!0);try{const re=await _n.getSubjectsForSelection();lt(re),console.log("👨‍🏫 Available subjects loaded:",re)}catch(re){console.error("👨‍🏫 Error loading available subjects:",re),f("Failed to load subjects","error")}finally{_t(!1)}},[]),pr=C.useCallback(re=>{if(!re){Jt(null);return}const de=Wt.find(Pe=>Pe.subject_id==re);de&&(Jt(de),ut([]),sr("classes"))},[Wt]),Fr=C.useCallback((re,de)=>{ut(Pe=>Pe.some(Je=>Je.grade===re&&Je.class===de)?Pe.filter(Je=>!(Je.grade===re&&Je.class===de)):[...Pe,{grade:re,class:de}])},[]),fr=C.useCallback(()=>{if(!zt||De.length===0){f("Please select at least one class","warning");return}const re={subject_id:parseInt(zt.subject_id),subject_name:zt.subject,classes:De};yt(de=>[...de,re]),Jt(null),ut([]),sr("subject"),f(`Added ${zt.subject} with ${De.length} classes`,"success")},[zt,De]),vr=C.useCallback(re=>{yt(de=>de.filter((Pe,Je)=>Je!==re))},[]),Mr=C.useCallback(async(re,de,Pe)=>{console.log("👨‍🏫 Deleting teacher subject:",{subjectId:re,grade:de,classNumber:Pe});try{const Je={subjectId:re,grade:de,class:Pe};console.log("👨‍🏫 Sending delete request with data:",Je);const gr=await _n.deleteTeacherSubject(Je);if(gr.success)f("Subject assignment deleted successfully!","success"),await St();else throw new Error(gr.error||"Failed to delete subject assignment")}catch(Je){console.error("👨‍🏫 Error deleting subject assignment:",Je),f("Error deleting subject assignment. Please try again.","error")}},[St,f]),sn=C.useCallback((re,de,Pe,Je)=>{Y({subjectId:re,subjectName:de,grade:Pe,classNumber:Je}),z(!0)},[]),le=C.useCallback(async()=>{Q&&(await Mr(Q.subjectId,Q.grade,Q.classNumber),z(!1),Y(null))},[Q,Mr]),be=C.useCallback(()=>{z(!1),Y(null)},[]),pe=C.useCallback(async()=>{if(Qe.length===0){f("Please select at least one subject","warning");return}try{const re=await _n.saveTeacherSubjects(Qe);if(re.success)f("Subjects saved successfully!","success"),Z(!1),yt([]),sr("subject"),await St();else throw new Error(re.error||"Failed to save subjects")}catch(re){console.error("👨‍🏫 Error saving teacher subjects:",re),f("Failed to save subjects","error")}},[Qe,St]);C.useCallback(async re=>{console.log("👨‍🏫 Saving teacher subjects:",re);try{const de=await _n.saveTeacherSubjects(re);if(de.success)f("Subjects saved successfully!","success"),await St(),Z(!1);else throw new Error(de.error||"Failed to save subjects")}catch(de){console.error("👨‍🏫 Error saving teacher subjects:",de),f("Failed to save subjects","error")}},[St]);const xe=C.useCallback(()=>{console.log("👨‍🏫 Showing active tests..."),E("tests")},[]),Se=C.useCallback(re=>{console.log("👨‍🏫 Showing test details:",re),M(re),q(!0)},[]);C.useCallback(async(re,de,Pe)=>{console.log("👨‍🏫 Removing class assignment:",re,de,Pe);try{const Je=await rn.removeClassAssignment(re,de,Pe);if(Je.success)f("Assignment removed successfully!","success"),await xt();else throw new Error(Je.error||"Failed to remove assignment")}catch(Je){console.error("👨‍🏫 Error removing class assignment:",Je),f("Failed to remove assignment","error")}},[xt]);const ke=C.useCallback(async(re,de)=>{console.log("👨‍🏫 Marking test as completed:",re,de);try{const Pe=await rn.markTestCompleted(re,de);if(Pe.success){f("Test marked as completed!","success");const Je=`teacher_tests_${r?.teacher_id||r?.id||""}`;localStorage.removeItem(Je),console.log("👨‍🏫 Cleared teacher tests cache"),await xt()}else throw new Error(Pe.error||"Failed to mark test as completed")}catch(Pe){console.error("👨‍🏫 Error marking test as completed:",Pe),f("Failed to mark test as completed","error")}},[xt,f,r?.teacher_id,r?.id]),$e=C.useCallback(async()=>{console.log("👨‍🏫 Refreshing active tests data...");try{await xt(),f("Tests refreshed successfully!","success")}catch(re){console.error("👨‍🏫 Error refreshing tests:",re),f("Failed to refresh tests","error")}},[xt]),[ht,Ke]=C.useState(!1),oe=C.useCallback(async re=>{console.log("📊 Loading performance data for class:",re),console.log("📊 Current selectedClassForChart:",ue);try{Ke(!0);const[de,Pe]=re.split("/"),Je=de.startsWith("M")?de:`M${de}`,gr=`class_summary_${r.teacher_id}_${Je}_${Pe}_${wi.CURRENT_ACADEMIC_YEAR}_${wi.CURRENT_SEMESTER}`,or=jn(gr);if((or?Date.now()-or.timestamp:1/0)>36e5)try{await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/refresh-class-summary-semester")}catch(dr){console.warn("Materialized view refresh failed (continuing):",dr.message)}const Xr=await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-class-summary-semester?teacher_id=${r.teacher_id}&grade=${Je}&class=${Pe}&semester=${wi.CURRENT_SEMESTER}&academic_year=${wi.CURRENT_ACADEMIC_YEAR}`);console.log("📊 API response status:",Xr.status);const Zr=await Xr.json();if(console.log("📊 Performance API response:",Zr),console.log("📊 API success:",Zr.success),console.log("📊 API summary:",Zr.summary),Zr.success&&Zr.summary){console.log("📊 Processing semester performance data:",Zr.summary);const dr=Zr.summary;console.log("📊 Semester summary:",{total_students:dr.total_students,total_tests:dr.total_tests,completed_tests:dr.completed_tests,average_class_score:dr.average_class_score,pass_rate:dr.pass_rate,cheating_incidents:dr.cheating_incidents});const _s={summary:dr,semester:wi.CURRENT_SEMESTER,academicYear:wi.CURRENT_ACADEMIC_YEAR,overallAverage:dr.average_class_score||0,totalTests:dr.total_tests||0,completedTests:dr.completed_tests||0,passRate:dr.pass_rate||0,cheatingIncidents:dr.cheating_incidents||0,lastTestDate:dr.last_test_date,semesterProgress:he(dr)};console.log("📊 Semester performance data:",_s),qe(Ml=>({...Ml,[re]:_s}))}else console.log("📊 No performance data available for class:",re),qe(dr=>({...dr,[re]:{tests:[],overallAverage:0}}))}catch(de){console.error("📊 Error loading performance data:",de),console.error("📊 Error details:",de.message),qe(Pe=>({...Pe,[re]:{tests:[],overallAverage:0}}))}finally{Ke(!1)}},[r]),he=C.useCallback(re=>{if(!re.last_test_date)return 0;const de=new Date("2025-05-01"),Pe=new Date("2025-09-30"),Je=new Date,gr=Pe-de,or=Math.min(Je-de,gr);return Math.round(or/gr*100)},[]);C.useCallback((re,de)=>{console.log("👨‍🏫 Showing class results:",re,de),console.log("👨‍🏫 Class click - grade:",re,"className:",de),D(re),V(de),E("results");const Pe=`${re}/${de}`;console.log("📊 Loading performance data for clicked class:",Pe),me(Pe),oe(Pe)},[oe]);const[Ce,Ne]=C.useState([]),[Ge,ot]=C.useState([]),Le=C.useCallback(async()=>{try{const de=await(await Uo(()=>import("./retestService-C6b0YDiD.js"),[])).retestService.getRetestAssignments(r.teacher_id);Ne(de)}catch(re){console.warn("Failed to load retests",re)}},[r]);C.useCallback(async re=>{try{const Pe=await(await Uo(()=>import("./retestService-C6b0YDiD.js"),[])).retestService.getRetestTargets(re);ot(Pe)}catch(de){console.warn("Failed to load retest targets",de)}},[]);const[Et,Bt]=C.useState(!1);C.useEffect(()=>{console.debug("[TeacherCabinet] showRetestModal state changed:",Et)},[Et]);const[Yt,Fe]=C.useState({test_type:"",original_test_id:"",subject_id:"",passing_threshold:50,scoring_policy:"BEST",max_attempts:1,window_days:2,student_ids:[]}),We=C.useCallback(async re=>{console.debug("[TeacherCabinet] openRetestModal called with:",re);const{test_type:de,original_test_id:Pe,subject_id:Je,failedStudentIds:gr=[],grade:or,class:Or}=re||{};Fe({test_type:de||"multiple_choice",original_test_id:Pe||"",subject_id:Je||"",passing_threshold:50,scoring_policy:"BEST",max_attempts:1,window_days:2,student_ids:gr}),or!==void 0&&D(or),Or!==void 0&&V(Or),console.debug("[TeacherCabinet] Setting showRetestModal to true"),Bt(!0)},[]),Ct=C.useCallback(async()=>{try{const re=await Uo(()=>import("./retestService-C6b0YDiD.js"),[]),de=new Date,Pe=new Date(de.getTime()+Yt.window_days*24*60*60*1e3),Je={...Yt,grade:T,class:I,window_start:de.toISOString(),window_end:Pe.toISOString()};await re.retestService.createRetestAssignment(Je),f("Retest created","success"),Bt(!1),Le(),je(gr=>gr+1)}catch(re){console.error("Create retest error",re),f(re.message||"Failed to create retest","error")}},[Yt,T,I,Le]),at=C.useCallback(re=>{if(!re)return o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"📊"}),o.jsx("p",{className:"text-gray-500",children:"Click on a class to view performance data"})]});const Pe=(He[re]||{}).summary;return Pe?o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[o.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[Pe.average_class_score?.toFixed(1)||0,"%"]}),o.jsx("div",{className:"text-sm text-blue-600",children:"Class Average"})]}),o.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-3xl font-bold text-green-600",children:Pe.total_tests||0}),o.jsx("div",{className:"text-sm text-green-600",children:"Total Tests"})]}),o.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[o.jsxs("div",{className:"text-3xl font-bold text-purple-600",children:[Pe.pass_rate?.toFixed(1)||0,"%"]}),o.jsx("div",{className:"text-sm text-purple-600",children:"Pass Rate"})]}),o.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-3xl font-bold text-red-600",children:Pe.cheating_incidents||0}),o.jsx("div",{className:"text-sm text-red-600",children:"Cheating Incidents"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[o.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:Pe.completed_tests||0}),o.jsx("div",{className:"text-sm text-yellow-600",children:"Completed Tests"})]}),o.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:Pe.highest_score||0}),o.jsx("div",{className:"text-sm text-indigo-600",children:"Highest Score"})]}),o.jsxs("div",{className:"bg-pink-50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold text-pink-600",children:Pe.total_students||0}),o.jsx("div",{className:"text-sm text-pink-600",children:"Total Students"})]})]}),ht&&o.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-xs text-center",children:[o.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-gray-300 border-t-transparent rounded-full mx-auto mb-2"}),o.jsx("div",{className:"text-sm text-gray-700",children:"Loading latest class summary..."})]})})]}):o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"📊"}),o.jsx("p",{className:"text-gray-500",children:"No performance data available for this class"})]})},[He]);if(g)return o.jsxs("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:[o.jsxs("div",{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Teacher Cabinet..."})]}),o.jsx("div",{className:"flex flex-wrap gap-2"})]});if(v)return o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Cabinet Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:v}),o.jsx(nt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})});return o.jsxs(et.div,{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[o.jsx(et.div,{className:"bg-gradient-to-r from-sky-400 to-sky-600 text-white shadow-lg",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-6",children:[o.jsxs(et.div,{className:"flex-1 text-center",initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-white mb-2",children:"Teacher Cabinet"}),o.jsxs("p",{className:"text-sky-100 text-sm sm:text-base md:text-lg",children:["Welcome, Teacher ",a()||""]})]}),o.jsxs(et.div,{className:"relative",initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3,duration:.5},children:[o.jsx("div",{className:"hidden md:block",children:o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>Ve(!Xe),className:"flex items-center space-x-1 sm:space-x-2 bg-white/10 border border-white/20 text-white hover:bg-white/20 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-white/50",children:[o.jsx("span",{className:"hidden sm:inline text-xs sm:text-sm font-medium",children:"Menu"}),o.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 transition-transform duration-200",style:{transform:Xe?"rotate(180deg)":"rotate(0deg)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]}),Xe&&o.jsxs(et.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[o.jsxs("button",{onClick:()=>{Ve(!1),Te()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})}),o.jsx("span",{children:"Change Password"})]}),o.jsxs("button",{onClick:()=>{Ve(!1),e?e():s()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),o.jsx("span",{children:"Logout"})]})]})]})}),o.jsxs("div",{className:"md:hidden",children:[o.jsx("button",{onClick:()=>st(!It),className:"flex items-center justify-center w-10 h-10 bg-white/10 border border-white/20 text-white hover:bg-white/20 rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-white/50",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),It&&o.jsxs(et.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[o.jsxs("div",{className:"px-4 py-2 border-b border-gray-200",children:[o.jsx("p",{className:"text-sm font-medium text-gray-900",children:a()||"Teacher"}),o.jsx("p",{className:"text-xs text-gray-500",children:"Teacher Account"})]}),o.jsxs("button",{onClick:()=>{st(!1),Te()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})}),o.jsx("span",{children:"Change Password"})]}),o.jsxs("button",{onClick:()=>{st(!1),e?e():s()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),o.jsx("span",{children:"Logout"})]})]})]})]})]})})}),o.jsx(et.div,{className:"bg-white border-b shadow-sm",initial:{y:-10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.5},children:o.jsx("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8",children:o.jsx("nav",{className:"flex space-x-1 sm:space-x-8 overflow-x-auto",children:[{key:"main",label:"Main Dashboard",shortLabel:"Dashboard"},{key:"tests",label:"Test Management",shortLabel:"Tests"},{key:"results",label:"Class Results",shortLabel:"Results"},{key:"subjects",label:"Subject Management",shortLabel:"Subjects"}].map((re,de)=>o.jsxs(et.button,{onClick:()=>re.key==="tests"?xe():E(re.key),className:`py-2 sm:py-4 px-2 sm:px-1 border-b-2 font-medium text-xs sm:text-sm transition-colors duration-200 whitespace-nowrap flex-shrink-0 ${b===re.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,initial:{y:-10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5+de*.1,duration:.3},whileHover:{scale:1.05},whileTap:{scale:.95},children:[o.jsx("span",{className:"sm:hidden",children:re.shortLabel}),o.jsx("span",{className:"hidden sm:inline",children:re.label})]},re.key))})})}),o.jsx(et.div,{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.5},children:o.jsxs(_i,{mode:"wait",children:[b==="main"&&o.jsx(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:Qt()},"main"),b==="subjects"&&o.jsx(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:tt()},"subjects"),b==="tests"&&o.jsx(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:jt()},"tests"),b==="results"&&o.jsx(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:o.jsx(cP,{selectedGrade:T,selectedClass:I,onBackToCabinet:()=>E("main"),openRetestModal:We},Ie)},"results")]})}),X&&o.jsx(Bo,{isOpen:X,onClose:()=>{Z(!1),sr("subject"),yt([]),Jt(null),ut([])},title:"Select Subjects and Classes",size:"large",children:o.jsxs("div",{className:"space-y-6 px-4 max-h-[80vh] overflow-y-auto",children:[Lt==="subject"&&o.jsxs(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Step 1: Select Subject"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Choose the subject you want to teach:"}),ft?o.jsxs("div",{className:"flex items-center justify-center py-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),o.jsx("span",{className:"ml-2 text-gray-600",children:"Loading subjects..."})]}):o.jsxs("select",{value:zt?.subject_id||"",onChange:re=>pr(re.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[o.jsx("option",{value:"",children:"Select a subject"}),Wt.map(re=>o.jsx("option",{value:re.subject_id,children:re.subject},re.subject_id))]})]}),o.jsxs("div",{className:"flex justify-end space-x-3",children:[o.jsx(nt,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),o.jsx(nt,{variant:"primary",onClick:()=>sr("classes"),disabled:!zt,children:"Next: Select Classes"})]})]}),Lt==="classes"&&zt&&o.jsxs(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["Step 2: Select Classes for ",zt.subject]}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Choose the classes you teach for this subject:"}),o.jsx("div",{className:"max-h-80 overflow-y-auto border border-gray-200 rounded-lg p-4",children:o.jsx("div",{className:"grid grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(re=>o.jsxs("div",{className:"space-y-2",children:[o.jsxs("h4",{className:"font-medium text-gray-700 text-sm",children:["Grade ",re]}),o.jsx("div",{className:"space-y-1",children:[15,16].map(de=>o.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[o.jsx("input",{type:"checkbox",checked:De.some(Pe=>Pe.grade===re.toString()&&Pe.class===de.toString()),onChange:()=>Fr(re.toString(),de.toString()),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),o.jsxs("span",{className:"text-xs text-gray-700",children:["Class ",de]})]},de))})]},re))})})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx(nt,{variant:"outline",onClick:()=>sr("subject"),children:"Back to Subjects"}),o.jsxs("div",{className:"space-x-3",children:[o.jsx(nt,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),o.jsx(nt,{variant:"primary",onClick:fr,disabled:De.length===0,children:"Add Subject"})]})]})]}),Qe.length>0&&o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Selected Subjects"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Review your selected subjects and classes:"}),o.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:Qe.map((re,de)=>o.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-gray-900",children:re.subject_name}),o.jsxs("p",{className:"text-sm text-gray-600",children:["Classes: ",re.classes.map(Pe=>`Grade ${Pe.grade} Class ${Pe.class}`).join(", ")]})]}),o.jsx("button",{onClick:()=>vr(de),className:"text-red-600 hover:text-red-800 p-1",children:o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},de))})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx(nt,{variant:"outline",onClick:()=>sr("subject"),children:"Add More Subjects"}),o.jsxs("div",{className:"space-x-3",children:[o.jsx(nt,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),o.jsx(nt,{variant:"primary",onClick:pe,children:"Save All Subjects"})]})]})]})]})}),Et&&o.jsxs(Bo,{isOpen:Et,onClose:()=>Bt(!1),title:"Create Retest",size:"medium",children:[o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Retest Window"}),o.jsxs("select",{className:"w-full border rounded px-3 py-2 text-sm",value:Yt.window_days,onChange:re=>Fe(de=>({...de,window_days:Number(re.target.value)})),children:[o.jsx("option",{value:1,children:"1 day"}),o.jsx("option",{value:2,children:"2 days"}),o.jsx("option",{value:3,children:"3 days"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Attempts"}),o.jsxs("select",{className:"w-full border rounded px-3 py-2 text-sm",value:Yt.max_attempts,onChange:re=>Fe(de=>({...de,max_attempts:Number(re.target.value)})),children:[o.jsx("option",{value:1,children:"1 attempt"}),o.jsx("option",{value:2,children:"2 attempts"}),o.jsx("option",{value:3,children:"3 attempts"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Students can retry immediately if they fail"})]})]})}),o.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[o.jsx("button",{onClick:()=>Bt(!1),className:"px-4 py-2 text-sm rounded border border-gray-300 hover:bg-gray-50",children:"Cancel"}),o.jsx("button",{onClick:Ct,className:"px-4 py-2 text-sm rounded bg-indigo-600 text-white hover:bg-indigo-700",children:"Create Retest"})]})]}),ie&&ne&&o.jsxs(Bo,{isOpen:ie,onClose:()=>q(!1),title:"Test Details",size:"large",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Test Name:"}),o.jsx("p",{className:"text-sm text-gray-900",children:ne.test_name})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Subject:"}),o.jsx("p",{className:"text-sm text-gray-900",children:ne.subject})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Test Type:"}),o.jsx("p",{className:"text-sm text-gray-900",children:ne.test_type})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Created:"}),o.jsx("p",{className:"text-sm text-gray-900",children:new Date(ne.created_at).toLocaleDateString()})]})]}),o.jsx("div",{className:"flex justify-end space-x-3 mt-6",children:o.jsx(nt,{variant:"outline",onClick:()=>q(!1),children:"Close"})})]}),B&&Q&&o.jsx(Bo,{isOpen:B,onClose:be,title:"Delete Subject Assignment",size:"small",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:o.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Delete Subject Assignment"}),o.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Are you sure you want to delete the assignment for"," ",o.jsx("span",{className:"font-semibold text-gray-900",children:Q.subjectName})," ","in Grade ",Q.grade,", Class ",Q.classNumber,"?"]}),o.jsx("p",{className:"text-xs text-red-600",children:"This action cannot be undone."})]}),o.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[o.jsx(nt,{variant:"outline",onClick:be,children:"Cancel"}),o.jsx(nt,{variant:"danger",onClick:le,children:"Delete Assignment"})]})]})}),o.jsx(et.div,{className:"fixed top-4 right-4 space-y-2 z-50",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.8,duration:.5},children:p.map(re=>o.jsx(et.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},transition:{duration:.3},children:o.jsx("div",{className:`p-4 rounded-lg shadow-lg ${re.type==="success"?"bg-green-600 text-white":re.type==="error"?"bg-red-600 text-white":re.type==="warning"?"bg-yellow-600 text-white":"bg-blue-600 text-white"}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:re.message}),o.jsx("button",{onClick:()=>setNotifications(de=>de.filter(Pe=>Pe.id!==re.id)),className:"ml-4 text-white hover:text-gray-200",children:"×"})]})})},re.id))}),Ze&&o.jsx(Bo,{isOpen:Ze,onClose:ve,title:"Change Password",size:"sm",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),o.jsx("input",{type:"password",name:"currentPassword",value:mt.currentPassword,onChange:we,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Enter current password"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),o.jsx("input",{type:"password",name:"newPassword",value:mt.newPassword,onChange:we,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Enter new password"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),o.jsx("input",{type:"password",name:"confirmPassword",value:mt.confirmPassword,onChange:we,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Confirm new password"})]}),o.jsxs("div",{className:"flex space-x-3 pt-4",children:[o.jsx(nt,{type:"button",variant:"secondary",onClick:ve,className:"flex-1",children:"Cancel"}),o.jsx(nt,{type:"button",onClick:fe,className:"flex-1",children:"Change Password"})]})]})})]});function Qt(){return o.jsxs("div",{className:"space-y-8",children:[o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{children:"My Subjects & Classes"})}),o.jsx(kt.Body,{children:k.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📚"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No subjects assigned"}),o.jsx("p",{className:"text-gray-500 mb-4",children:"You don't have any subjects assigned yet."}),o.jsx(nt,{variant:"outline",onClick:()=>E("subjects"),children:"Manage Subjects"})]}):o.jsx("div",{className:"space-y-6",children:k.map((re,de)=>o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2+de*.1,duration:.3},className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:re.name}),o.jsxs("span",{className:"text-sm text-gray-500",children:[re.classes?.length||0," classes"]})]}),re.classes&&re.classes.length>0?o.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:re.classes.map((Pe,Je)=>o.jsx(et.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3+de*.1+Je*.05,duration:.2},whileHover:{scale:1.05},whileTap:{scale:.95},children:o.jsxs(nt,{variant:"outline",size:"sm",onClick:()=>{D(Pe.grade),V(Pe.class),E("results")},className:"font-medium",children:[Pe.grade,"/",Pe.class]})},Je))}):o.jsx("div",{className:"text-center py-4 text-gray-500",children:o.jsx("span",{className:"text-sm",children:"No classes assigned to this subject"})})]},re.id))})})]})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},children:o.jsxs(kt,{children:[o.jsxs(kt.Header,{children:[o.jsx(kt.Title,{children:"Test Performance Overview"}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Average scores across all tests by class"})]}),o.jsx(kt.Body,{children:k.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"📊"}),o.jsx("p",{className:"text-gray-500",children:"No subjects assigned - no performance data available"})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"flex flex-wrap gap-2 border-b border-gray-200",children:(()=>{const re=[];return k.forEach(de=>{de.classes&&de.classes.forEach(Pe=>{const Je=`${Pe.grade}/${Pe.class}`;re.find(gr=>gr.key===Je)||re.push({key:Je,grade:Pe.grade,class:Pe.class,subject:de.name})})}),re})().map((re,de)=>o.jsxs("button",{onClick:()=>{console.log("🎯 Class button clicked:",re.key),me(re.key),oe(re.key)},className:`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${ue===re.key?"bg-blue-100 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[re.grade,"/",re.class]},re.key))}),o.jsx("div",{className:"mt-4",children:at(ue)})]})})]})})]})}function tt(){return o.jsxs("div",{className:"space-y-8",children:[o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.5},children:o.jsx(kt,{children:o.jsx(kt.Header,{children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(kt.Title,{children:"Subject Management"}),o.jsx(nt,{variant:"primary",onClick:Ot,children:"Add Subject"})]})})})}),k.length===0?o.jsx(et.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2,duration:.5},children:o.jsx(kt,{children:o.jsx(kt.Body,{children:o.jsxs("div",{className:"text-center p-12",children:[o.jsx(et.div,{className:"text-6xl mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.5,type:"spring"},children:"📚"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"No subjects assigned yet"}),o.jsx("p",{className:"text-gray-600 mb-6",children:"Add your first subject to get started with creating tests and managing classes."}),o.jsx(nt,{variant:"primary",onClick:Ot,size:"lg",children:"Add Your First Subject"})]})})})}):o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:o.jsxs(kt,{children:[o.jsx(kt.Header,{children:o.jsx(kt.Title,{children:"Your Subjects"})}),o.jsx(kt.Body,{children:o.jsx("div",{className:"space-y-4",children:k.map((re,de)=>o.jsx(et.div,{className:"p-4 bg-gray-50 rounded-lg border-l-4 border-green-500",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+de*.1,duration:.3},whileHover:{scale:1.02,backgroundColor:"#f9fafb"},children:o.jsx("div",{className:"flex justify-between items-start",children:o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:re.name}),o.jsx("div",{className:"flex flex-wrap gap-2",children:re.classes?.map((Pe,Je)=>o.jsxs(et.div,{className:"inline-flex items-center gap-2 bg-blue-100 text-blue-800 text-xs rounded-full px-3 py-1",initial:{scale:0},animate:{scale:1},transition:{delay:.4+de*.1+Je*.05,duration:.2},whileHover:{scale:1.1},children:[o.jsxs("span",{children:[Pe.grade," - ",Pe.className]}),o.jsx("button",{onClick:()=>sn(re.id,re.name,Pe.grade,Pe.class),className:"ml-1 text-red-600 hover:text-red-800 transition-colors",title:"Delete this subject assignment",children:o.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},Je))||o.jsx("span",{className:"text-gray-500 text-sm",children:"No classes assigned"})})]})})},de))})})]})})]})}function jt(){return o.jsxs("div",{className:"space-y-8",children:[o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.5},children:o.jsx(kt,{children:o.jsx(kt.Header,{children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(kt.Title,{children:"Active Tests"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(nt,{variant:"outline",onClick:$e,children:"Refresh"}),o.jsx(nt,{variant:"primary",onClick:()=>t("/teacher/tests/create"),children:"Create New Test"})]})]})})})}),N.length===0?o.jsx(et.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2,duration:.5},children:o.jsx(kt,{children:o.jsx(kt.Body,{children:o.jsxs("div",{className:"text-center p-12",children:[o.jsx(et.div,{className:"text-6xl mb-4",initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.5,type:"spring"},children:"📝"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"No active tests found"}),o.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first test to get started with assessments."}),o.jsx(nt,{variant:"primary",onClick:()=>t("/teacher/tests/create"),size:"lg",children:"Create Your First Test"})]})})})}):o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},className:"space-y-4",children:N.map((re,de)=>o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3+de*.1,duration:.3},whileHover:{scale:1.01},children:o.jsx(kt,{children:o.jsx(kt.Body,{children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex-1 flex items-center space-x-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 min-w-0 flex-shrink-0",children:re.test_name}),o.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium flex-shrink-0",children:re.test_type}),o.jsxs("div",{className:"hidden sm:flex items-center space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-600 flex-shrink-0",children:[o.jsx("span",{className:"font-medium",children:"Assignments:"}),o.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium",children:re.assignments?.length||0})]}),re.assignments&&re.assignments.length>0&&o.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-600 flex-shrink-0",children:[o.jsx("span",{className:"font-medium",children:"Classes:"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:re.assignments.map((Pe,Je)=>o.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs font-medium",children:[Pe.grade,"/",Pe.class]},Je))})]}),o.jsx("div",{className:"text-sm text-gray-500 flex-shrink-0",children:new Date(re.created_at).toLocaleDateString()})]})]}),o.jsxs("div",{className:"flex gap-2 ml-4 flex-shrink-0",children:[o.jsx("div",{className:"sm:hidden",children:o.jsx(nt,{variant:"outline",onClick:()=>Se(re),size:"sm",className:"text-xs",title:`Assignments: ${re.assignments?.length||0} | Classes: ${re.assignments?.map(Pe=>`${Pe.grade}/${Pe.class}`).join(", ")||"None"} | ${new Date(re.created_at).toLocaleDateString("en-US",{year:"2-digit",month:"numeric",day:"numeric"})}`,children:"Details"})}),o.jsx("div",{className:"hidden sm:block",children:o.jsx(nt,{variant:"outline",onClick:()=>Se(re),size:"sm",children:"Details"})}),o.jsx(nt,{variant:"success",onClick:()=>ke(re.test_type,re.test_id),size:"sm",children:"Complete"})]})]})})})},de))})]})}},Xte={multipleChoice:"multiple_choice",trueFalse:"true_false",input:"input",matching:"matching_type",wordMatching:"word_matching",drawing:"drawing",fillBlanks:"fill_blanks",speaking:"speaking"},k3=()=>{const{user:e}=Bn();OW();const{notifications:t,showNotification:r,removeNotification:n}=ka(),[s,a]=C.useState(!1),[i,l]=C.useState(!1),[c,d]=C.useState("typeSelection"),[f,p]=C.useState(!1),[g,y]=C.useState(null),[v,_]=C.useState([]),[b,E]=C.useState(!1),[k,w]=C.useState(!1),[N,A]=C.useState(!1),[P,R]=C.useState(!1),[T,D]=C.useState({testName:"",numQuestions:0,numOptions:0,questions:{},enableTimer:!1,timerMinutes:"",isShuffled:!1}),[I,V]=C.useState([]),[X,Z]=C.useState(null);C.useRef(null),C.useRef(null),C.useRef(null),C.useRef(null),C.useRef(null),C.useRef(null),C.useRef(null);const ie=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in initializeTestCreation, redirecting to login"),r("Missing teacher session. Please sign in again.","error");return}console.log("🔍 Setting up test creation event listeners..."),K(),console.log("🔍 Test creation initialization complete")},[e,r]),q=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in showTestTypeSelection, redirecting to login"),r("Missing teacher session. Please sign in again.","error");return}console.log("🔍 showTestTypeSelection called - starting new test creation"),l(!1),console.log("🔍 Reset testAssignmentCompleted flag to false"),a(!0),console.log("🔍 Set isInTestCreation flag to true"),ne(),d("typeSelection"),W("testTypeSelection")},[e,r]),ne=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in disableNavigationButtons, redirecting to login");return}console.log("🔍 Disabling navigation buttons..."),p(!0)},[e]),M=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in enableNavigationButtons, redirecting to login");return}console.log("🔍 Enabling navigation buttons..."),p(!1)},[e]),W=C.useCallback(async oe=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in saveTestCreationState, redirecting to login");return}console.log("🔍 🔴 saveTestCreationState called with step:",oe),console.log("🔍 🔴 Call stack:",new Error().stack);const he={multipleChoice:{buttonVisible:!0,hintVisible:!1},trueFalse:{buttonVisible:!0,hintVisible:!1},input:{buttonVisible:!0,hintVisible:!1}},Ce={isInTestCreation:!0,currentStep:oe,timestamp:Date.now(),excelState:he};localStorage.setItem("test_creation_state",JSON.stringify(Ce)),console.log("🔍 Saved test creation state:",Ce);const Ne={};switch(oe){case"testTypeSelection":break;case"multipleChoiceForm":Ne.testName=T.testName||"",Ne.numQuestions=T.numQuestions||"",Ne.numOptions=T.numOptions||"",Ne.questions=T.questions||{};break;case"trueFalseForm":Ne.testName=T.testName||"",Ne.numQuestions=T.numQuestions||"",Ne.questions=T.questions||{};break;case"inputForm":Ne.testName=T.testName||"",Ne.numQuestions=T.numQuestions||"",Ne.questions=T.questions||{};break;case"formCreation":Ne.testName=T.testName||"",Ne.numQuestions=T.numQuestions||"",Ne.numOptions=T.numOptions||"",Ne.questions=T.questions||{},Ne.enableTimer=!!T.enableTimer,Ne.timerMinutes=T.timerMinutes||"",Ne.isShuffled=!!T.isShuffled;break;case"assignment":case"testAssignment":Ne.testName=T.testName||"",Ne.numQuestions=T.numQuestions||"",Ne.numOptions=T.numOptions||"",Ne.questions=T.questions||{};break;default:console.log("🔍 Unknown step in saveTestCreationState:",oe);break}Object.keys(Ne).length>0&&(localStorage.setItem(`form_data_${oe}`,JSON.stringify(Ne)),console.log("🔍 Saved form data for step:",oe,Ne))},[e,T]),L=C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in clearTestCreationState, redirecting to login");return}localStorage.removeItem("test_creation_state"),localStorage.removeItem("test_creation_form_data");const oe=[];for(let he=0;he<localStorage.length;he++){const Ce=localStorage.key(he);Ce&&(Ce.includes("test")||Ce.includes("form")||Ce.includes("question"))&&oe.push(Ce)}oe.forEach(he=>{localStorage.removeItem(he),console.log("🔍 Removed localStorage key:",he)}),console.log("🔍 Cleared test creation state from localStorage")},[e]);C.useCallback(async()=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in clearAllTestFields, redirecting to login");return}console.log("🔍 Clearing all test form fields..."),D({testName:"",numQuestions:0,numOptions:0,questions:{}}),y(null),V([]),Z(null),console.log("🔍 Cleared all test form fields")},[e]);const H=C.useCallback(()=>{console.log("🔍 Resetting Excel upload state..."),_t({multipleChoice:{buttonVisible:!1,hintVisible:!1},trueFalse:{buttonVisible:!1,hintVisible:!1},input:{buttonVisible:!1,hintVisible:!1}}),["multiple-choice","true-false","input","word-matching"].forEach(he=>{const Ce=document.querySelector(`.excel-upload-btn[data-test-type="${he}"]`);Ce&&(Ce.style.display="none",console.log("🔍 Excel button hidden for:",he));const Ne=document.querySelector(`.excel-hint[data-test-type="${he}"]`);Ne&&(Ne.style.display="none",console.log("🔍 Excel hint hidden for:",he));const Ge=document.querySelector(`.excel-file-input[data-test-type="${he}"]`);Ge&&(Ge.value="",console.log("🔍 File input cleared for:",he))}),console.log("✅ Excel upload state reset complete")},[]),K=C.useCallback(()=>{console.log("🔍 Setting up auto-save listeners for initial form fields..."),["testName","numQuestions","numOptions","enableTimer","timerMinutes","isShuffled"].forEach(he=>{const Ce=document.getElementById(he);Ce&&Ce.addEventListener("input",()=>{console.log(`🔍 Auto-save triggered for field: ${he}`)})}),console.log("✅ Form auto-save setup complete")},[]);C.useCallback(async oe=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in saveFormDataForStep, redirecting to login");return}console.log("🔍 🔴 saveFormDataForStep called with step:",oe),console.log("🔍 🔴 Call stack:",new Error().stack);const he={};switch(oe){case"testTypeSelection":break;case"multipleChoiceForm":he.testName=T.testName||"",he.numQuestions=T.numQuestions||"",he.numOptions=T.numOptions||"",he.questions=T.questions||{};break;case"trueFalseForm":he.testName=T.testName||"",he.numQuestions=T.numQuestions||"",he.questions=T.questions||{};break;case"inputForm":he.testName=T.testName||"",he.numQuestions=T.numQuestions||"",he.questions=T.questions||{};break;case"formCreation":he.testName=T.testName||"",he.numQuestions=T.numQuestions||"",he.numOptions=T.numOptions||"",he.questions=T.questions||{};break;default:console.log("🔍 Unknown step for form data save:",oe);return}localStorage.setItem("test_creation_form_data",JSON.stringify({step:oe,data:he,timestamp:Date.now()})),console.log("🔍 Saved form data for step:",oe,he)},[e,T]);const B=C.useCallback(async oe=>{console.log("🔍 Restoring form data for step:",oe);try{const he=localStorage.getItem(`form_data_${oe}`);if(he){const Ce=JSON.parse(he);console.log("🔍 Restored form data:",Ce),D(Ne=>{const Ge={...Ne,...Ce};return console.log("🔍 Updated formData with restored data:",Ge),console.log("🔍 Matching test data in restored data:",Ge.matchingTestData),Ge}),Object.keys(Ce).forEach(Ne=>{const Ge=document.getElementById(Ne);Ge&&Ce[Ne]!==void 0&&(Ge.value=Ce[Ne])}),console.log("✅ Form data restored for step:",oe)}else console.log("ℹ️ No saved data found for step:",oe)}catch(he){console.error("❌ Error restoring form data:",he)}},[e]),z=C.useCallback(()=>{console.log("🔍 Setting up multiple choice form auto-save..."),["mcNumOptions"].forEach(Ce=>{const Ne=document.getElementById(Ce);Ne&&Ne.addEventListener("input",()=>{console.log(`🔍 Auto-save triggered for MC field: ${Ce}`)})}),document.querySelectorAll("#mcQuestionsContainer input, #mcQuestionsContainer textarea, #mcQuestionsContainer select").forEach(Ce=>{Ce.addEventListener("input",()=>{console.log("🔍 Auto-save triggered for MC question field")})}),console.log("✅ Multiple choice form auto-save setup complete")},[]),Q=C.useCallback(()=>{console.log("🔍 Setting up true/false form auto-save..."),document.querySelectorAll("#tfQuestionsContainer input, #tfQuestionsContainer textarea, #tfQuestionsContainer select").forEach(he=>{he.addEventListener("input",()=>{console.log("🔍 Auto-save triggered for TF question field")})}),console.log("✅ True/false form auto-save setup complete")},[]),Y=C.useCallback(()=>{console.log("🔍 Setting up input form auto-save..."),document.querySelectorAll("#inputQuestionsContainer input, #inputQuestionsContainer textarea, #inputQuestionsContainer select").forEach(he=>{he.addEventListener("input",()=>{console.log("🔍 Auto-save triggered for Input question field")})}),console.log("✅ Input form auto-save setup complete")},[]),te=C.useCallback(oe=>{console.log("🔍 showExcelUploadButton called with testType:",oe);const he=oe==="multiple-choice"?"multipleChoice":oe==="true-false"?"trueFalse":oe==="input"?"input":oe;_t(Ce=>({...Ce,[he]:{...Ce[he],buttonVisible:!0}}))},[]),ee=C.useCallback(oe=>{console.log("🔍 showExcelHint called with testType:",oe);const he=oe==="multiple-choice"?"multipleChoice":oe==="true-false"?"trueFalse":oe==="input"?"input":oe;_t(Ce=>({...Ce,[he]:{...Ce[he],hintVisible:!0}}))},[]),ae=C.useCallback(async(oe,he,Ce)=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in displayTestAssignmentOptions, redirecting to login");return}console.log("displayTestAssignmentOptions called with:",{classes:oe,testType:he,testId:Ce}),_(oe),console.log("🔍 Test assignment options displayed for:",{testType:he,testId:Ce,classesCount:oe.length})},[e]),ge=C.useCallback(async(oe,he)=>{try{if(console.log("Loading teacher grades and classes for test assignment"),!e||!e.teacher_id){console.error("No valid teacher session found, redirecting to login");return}console.log("Teacher ID:",e.teacher_id);const Ne=await(await window.tokenManager.makeAuthenticatedRequest(`/.netlify/functions/get-teacher-subjects?teacher_id=${e.teacher_id}`)).json();console.log("Teacher subjects response:",Ne),Ne.success&&Ne.subjects&&Ne.subjects.length>0?(console.log("Teacher subjects loaded:",Ne.subjects),_(Ne.subjects),ae(Ne.subjects,oe,he)):(console.log("No teacher subjects found"),r("No subjects found. Please assign subjects to grades and classes first.","warning"))}catch(Ce){console.error("Error loading teacher grades and classes:",Ce),r("Error loading teacher grades and classes","error")}},[e,r,ae]),_e=C.useCallback(async()=>{console.log("👨‍🏫 Loading available classes...");try{const oe=await _n.getGradesAndClasses();if(console.log("👨‍🏫 Raw grades/classes data:",oe),!oe||oe.length===0){_([]);return}const he=new Map;oe.forEach(Ne=>{const Ge=Ne.subject_id,ot=Ne.subject||`Subject ${Ge}`;he.has(Ge)||he.set(Ge,{subject_id:Ge,subject:ot,classes:[]}),he.get(Ge).classes.push({grade:Ne.grade,class:Ne.class})});const Ce=Array.from(he.values());_(Ce),console.log("👨‍🏫 Transformed available classes:",Ce)}catch(oe){console.error("👨‍🏫 Error loading available classes:",oe),r("Failed to load available classes","error")}},[r]);C.useCallback(async(oe,he)=>{if(i){l(!1);return}if(!e||!e.teacher_id){console.error("No valid teacher session found in showTestAssignment, redirecting to login");return}ne(),W("testAssignment"),Z(he),y(oe),d("testAssignment"),ge(oe,he),_e(),console.log("🔍 Test assignment interface shown for:",{testType:oe,testId:he})},[i,e,ne,W,ge,_e]);const Me=C.useCallback(async oe=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in displayTeacherActiveTests, redirecting to login");return}if(console.log("🔍 Displaying teacher active tests:",oe),oe.length===0){Ve([]);return}Ve(oe),console.log("🔍 Active tests displayed:",oe.length,"tests")},[e]);C.useCallback(async(oe,he)=>{try{console.log("🔍 Loading test questions for:",{testType:oe,testId:he});const Ce=await rn.getTestQuestions(he,oe);return console.log("🔍 Test questions loaded:",Ce),Ce}catch(Ce){throw console.error("Error loading test questions:",Ce),Ce}},[]),C.useCallback((oe,he,Ce,Ne)=>{console.log("🔍 Showing teacher test details modal:",{testType:oe,testId:he,testName:Ce,questionsCount:Ne.length}),console.log("Test Details:",{testType:oe,testId:he,testName:Ce,questions:Ne.map(Ge=>({id:Ge.question_id,question:Ge.question,correctAnswer:Ge.correct_answer}))}),r(`Test details for "${Ce}" loaded successfully.`,"success")},[r]);const ue=C.useCallback(async()=>{console.log("🔧 DEBUG: loadTeacherActiveTests called");try{console.log("🔧 DEBUG: Fetching teacher active tests using JWT authentication...");const oe=await rn.getTeacherTests();console.log("🔧 DEBUG: Tests loaded:",oe),oe&&oe.length>0?(console.log("🔧 DEBUG: Success! Displaying",oe.length,"tests"),Me(oe)):(console.log("🔧 DEBUG: No tests found"),Ve([]))}catch(oe){console.error("🔧 DEBUG: Error loading active tests:",oe),r("Error loading active tests.","error")}},[r,Me]),me=C.useCallback(()=>{console.log("showTestCreationSuccessMessage called"),r("Test created and assigned successfully!","success"),d("typeSelection"),D({testName:"",numQuestions:0,numOptions:0,questions:{}}),V([]),l(!1),a(!1),L()},[r,L]),He=C.useCallback(async(oe,he)=>{if(console.log("🔍 === ASSIGN TEST TO CLASSES DEBUG START ==="),console.log("🔍 Test Type:",oe),console.log("🔍 Test ID:",he),console.log("🔍 Current formData:",T),console.log("🔍 Selected Classes:",I),console.log("🔍 User:",e),!e||!e.teacher_id){console.error("❌ No valid teacher session found in assignTestToClasses, redirecting to login"),r("Missing teacher session. Please sign in again.","error");return}if(console.log("✅ Teacher ID:",e.teacher_id),I.length===0){console.warn("⚠️ No classes selected"),r("Please select at least one class.","warning");return}try{console.log("📤 Preparing test + assignment request...");const Ce=I.map(Le=>{const Et={grade:parseInt(Le.grade),class:parseInt(Le.class),subject_id:parseInt(Le.subject_id),academic_period_id:8,due_date:null};return console.log("🔍 Created assignment:",Et),Et});if(console.log("📋 Final assignments array:",Ce),oe==="matching"){console.log("🎯 Processing matching test..."),console.log("🔄 Setting isAssigningTest to true for matching test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Fe=>setTimeout(Fe,100));const Le=T.matchingTestData;if(console.log("🔍 Matching test data from formData:",Le),!Le){console.error("❌ Matching test data not found in formData"),r("Matching test data not found. Please recreate the test.","error");return}console.log("✅ Matching test data found, processing...");let Et;Le.processedQuestions?(console.log("🔍 Using pre-processed questions from MatchingTestCreator"),Et=Le.processedQuestions):(console.log("🔍 Converting blocks to questions (fallback)..."),console.log("🔍 Blocks:",Le.blocks),console.log("🔍 Words:",Le.words),console.log("🔍 Arrows:",Le.arrows),Et=Le.blocks.map((Fe,We)=>{const Ct=Le.words.find(jt=>jt.blockId===Fe.id)?.word||`Word ${We+1}`,at=Le.arrows.some(jt=>jt.startBlock===Fe.id),Qt=Le.arrows.find(jt=>jt.startBlock===Fe.id)||null,tt={question_id:We+1,word:Ct,block_coordinates:{x:Fe.x,y:Fe.y,width:Fe.width,height:Fe.height},has_arrow:at,arrow:Qt?{startX:Qt.startX,startY:Qt.startY,endX:Qt.endX,endY:Qt.endY,style:Qt.style||{}}:null};return console.log(`🔍 Question ${We+1}:`,tt),tt})),console.log("📋 Final questions array:",Et);const Bt={teacher_id:e.teacher_id,test_name:T.testName,image_url:Le.imageUrl,num_blocks:Le.blocks.length,questions:Et,allowed_time:T.enableTimer?Math.max(0,Math.floor(Number(T.timerMinutes||0)*60)):null,assignments:Ce};console.log("📤 Final matching test data payload:",Bt),console.log("🚀 Calling testService.saveMatchingTest...");const Yt=await rn.saveMatchingTest(Bt);console.log("📥 API Response:",Yt),Yt.success?(console.log("✅ Matching test created and assigned successfully!"),r("Matching test created and assigned successfully!","success"),console.log("Matching test created and assigned successfully"),l(!0),qe()):(console.error("❌ Failed to create matching test:",Yt.message),r("Error creating and assigning matching test: "+Yt.message,"error")),R(!1);return}if(oe==="wordMatching"){console.log("🎯 Processing word matching test..."),console.log("🔄 Setting isAssigningTest to true for word matching test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Fe=>setTimeout(Fe,100));const Le=T.wordMatchingData;if(console.log("🔍 Word matching test data from formData:",Le),!Le){console.error("❌ Word matching test data not found in formData"),r("Word matching test data not found. Please recreate the test.","error");return}console.log("✅ Word matching test data found, processing...");const Et=Le.wordPairs.map((Fe,We)=>({question_id:We+1,left_word:Fe.leftWord,right_word:Fe.rightWord}));console.log("📋 Final word matching questions array:",Et);const Bt={teacher_id:e.teacher_id,test_type:"word_matching",test_name:T.testName,num_questions:Le.wordPairs.length,interaction_type:Le.interactionType||"drag",questions:Et,allowed_time:T.enableTimer?Math.max(0,Math.floor(Number(T.timerMinutes||0)*60)):null,assignments:Ce};console.log("📤 Final word matching test data payload:",Bt),console.log("🚀 Calling testService.assignTestToClasses for word matching...");const Yt=await rn.assignTestToClasses(Bt);console.log("📥 API Response:",Yt),Yt.success?(console.log("✅ Word matching test created and assigned successfully!"),r("Word matching test created and assigned successfully!","success"),console.log("Word matching test created and assigned successfully"),l(!0),qe()):(console.error("❌ Failed to create word matching test:",Yt.message),r("Error creating and assigning word matching test: "+Yt.message,"error")),R(!1);return}if(oe==="drawing"){console.log("🎯 Processing drawing test..."),console.log("🔄 Setting isAssigningTest to true for drawing test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Fe=>setTimeout(Fe,100));const Le=T.drawingData;if(console.log("🔍 Drawing test data from formData:",Le),!Le){console.error("❌ Drawing test data not found in formData"),r("Drawing test data not found. Please recreate the test.","error");return}console.log("✅ Drawing test data found, processing...");const Et=Le.questions||[];console.log("📋 Drawing questions array:",Et);const Bt={teacher_id:e.teacher_id,test_type:"drawing",test_name:T.testName,num_questions:Le.num_questions,passing_score:Le.passing_score,questions:Et,allowed_time:T.enableTimer?Math.max(0,Math.floor(Number(T.timerMinutes||0)*60)):null,assignments:Ce};console.log("📤 Final drawing test data payload:",Bt),console.log("🚀 Calling testService.assignTestToClasses...");const Yt=await rn.assignTestToClasses(Bt);console.log("📥 API Response:",Yt),Yt.success?(console.log("✅ Drawing test created and assigned successfully!"),r("Drawing test created and assigned successfully!","success"),l(!0),qe()):(console.error("❌ Failed to create drawing test:",Yt.message),r("Error creating and assigning drawing test: "+Yt.message,"error")),R(!1);return}if(oe==="fillBlanks"){console.log("🎯 Processing fill blanks test..."),console.log("🔄 Setting isAssigningTest to true for fill blanks test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Fe=>setTimeout(Fe,100));const Le=T.fillBlanksData;if(console.log("🔍 Fill blanks test data from formData:",Le),!Le){console.error("❌ Fill blanks test data not found in formData"),r("Fill blanks test data not found. Please recreate the test.","error");return}console.log("✅ Fill blanks test data found, processing...");const Et=Le.blanks||[];console.log("📋 Fill blanks questions array:",Et);const Bt={teacher_id:e.teacher_id,test_type:"fill_blanks",test_name:T.testName,test_text:Le.test_text,num_questions:Le.num_questions,num_blanks:Le.num_blanks,separate_type:Le.separate_type,allowed_time:T.enableTimer?Math.max(0,Math.floor(Number(T.timerMinutes||0)*60)):null,questions:Et,assignments:Ce};console.log("📤 Final fill blanks test data payload:",Bt),console.log("🚀 Calling testService.assignTestToClasses...");const Yt=await rn.assignTestToClasses(Bt);console.log("📥 API Response:",Yt),Yt.success?(console.log("✅ Fill blanks test created and assigned successfully!"),r("Fill blanks test created and assigned successfully!","success"),l(!0),qe()):(console.error("❌ Failed to create fill blanks test:",Yt.message),r("Error creating and assigning fill blanks test: "+Yt.message,"error")),R(!1);return}if(oe==="speaking"){console.log("🎯 Processing speaking test..."),console.log("🔄 Setting isAssigningTest to true for speaking test..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Fe=>setTimeout(Fe,100));const Le=T.speakingData;if(console.log("🔍 Speaking test data from formData:",Le),!Le){console.error("❌ Speaking test data not found in formData"),r("Speaking test data not found. Please recreate the test.","error");return}console.log("✅ Speaking test data found, processing...");const Et={teacher_id:e.teacher_id,test_type:"speaking",test_name:T.testName,time_limit:Le.time_limit,min_duration:Le.min_duration,max_duration:Le.max_duration,max_attempts:Le.max_attempts,min_words:Le.min_words,passing_score:Le.passing_score,allowed_time:T.enableTimer?Math.max(0,Math.floor(Number(T.timerMinutes||0)*60)):null,questions:Le.questions,assignments:Ce};console.log("📤 Final speaking test data payload:",Et),console.log("🚀 Calling save-speaking-test-with-assignments for speaking test...");const Yt=await(await window.tokenManager.makeAuthenticatedRequest("/.netlify/functions/save-speaking-test-with-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Et)})).json();console.log("📥 API Response:",Yt),Yt.success?(console.log("✅ Speaking test created and assigned successfully!"),r("Speaking test created and assigned successfully!","success"),l(!0),qe()):(console.error("❌ Failed to create speaking test:",Yt.message),r("Error creating and assigning speaking test: "+Yt.message,"error")),R(!1);return}console.log("🔍 Processing non-matching test..."),console.log("🔍 Form data questions:",T.questions);const Ne=Object.keys(T.questions).map(Le=>{const Et=T.questions[Le];console.log(`🔍 Processing question ${Le}:`,Et);let Bt;oe==="input"?Bt={correct_answers:Et.correct_answers||[Et.correctAnswer||""]}:Bt={correct_answer:Et.correctAnswer||Et.correct_answers?.[0]||""};const Yt={question_id:parseInt(Le),question:Et.question,...Bt,options:Et.options||[]};return console.log(`🔍 Question ${Le} correct_answers:`,Et.correct_answers),console.log(`🔍 Question ${Le} correctAnswer:`,Et.correctAnswer),console.log(`🔍 Converted question ${Le}:`,Yt),Yt});console.log("📋 Final questions array:",Ne);const Ge={teacher_id:e.teacher_id,test_type:Xte[oe],test_name:T.testName,num_questions:T.numQuestions,num_options:T.numOptions,questions:Ne,allowed_time:T.enableTimer?Math.max(0,Math.floor(Number(T.timerMinutes||0)*60)):null,is_shuffled:!!T.isShuffled,assignments:Ce};console.log("📤 Final test data payload:",Ge),console.log("🔄 Setting isAssigningTest to true..."),R(!0),console.log("🔄 isAssigningTest set to true, overlay should show"),await new Promise(Le=>setTimeout(Le,100)),console.log("🚀 Calling testService.assignTestToClasses...");const ot=await rn.assignTestToClasses(Ge);console.log("📥 API Response:",ot),ot.success?(console.log("✅ Test created and assigned successfully!"),r("Test created and assigned successfully!","success"),console.log("Test created and assigned successfully"),l(!0),qe()):(console.error("❌ Failed to create and assign test:",ot.message),r("Error creating and assigning test: "+ot.message,"error"))}catch(Ce){console.error("💥 Exception in assignTestToClasses:",Ce),console.error("Error creating and assigning test:",Ce),r("Error creating and assigning test. Please try again.","error")}finally{R(!1)}console.log("🔍 === ASSIGN TEST TO CLASSES DEBUG END ===")},[e,I,T,r,me]),qe=C.useCallback(async()=>{console.log("returnToMainCabinet called - restoring main cabinet view");try{a(!1),l(!1),d("typeSelection"),y(null),Z(null),V([]),M(),L(),me(),console.log("🔍 Returned to main cabinet")}catch(oe){console.error("Error returning to main cabinet:",oe)}},[M,L,me]),[Xe,Ve]=C.useState([]),[It,st]=C.useState(!1);C.useCallback(async()=>{console.log("🔍 Refreshing active tests data...");try{await ue(),r("Active tests data refreshed.","success")}catch(oe){console.error("Error refreshing active tests data:",oe),r("Error refreshing data.","error")}},[ue,r]);const[Ie,je]=C.useState([]),[Ze,bt]=C.useState([]),[mt,$t]=C.useState(!1),[Wt,lt]=C.useState(!1),Qe=C.useCallback(async oe=>{if(!e||!e.teacher_id){console.error("No valid teacher session found in displayExistingSubjectsInSelection, redirecting to login");return}console.log("Displaying existing subjects in selection interface:",oe),je(oe),console.log("🔍 Existing subjects displayed in selection:",oe.length,"subjects")},[e]);C.useCallback(async()=>{try{console.log("Loading existing subjects...");const oe=await _n.getTeacherSubjects();console.log("Existing subjects loaded:",oe),oe&&oe.length>0?Qe(oe):(console.log("No existing subjects found"),je([]))}catch(oe){console.error("Error loading existing subjects:",oe),r("Error loading subjects.","error")}},[r,Qe]);const yt=C.useCallback(oe=>{console.log("Checking for outside click...");const he=document.getElementById("dropdownMenu"),Ce=document.querySelector("[data-menu-button]");he&&!he.contains(oe.target)&&!Ce?.contains(oe.target)&&(console.log("Outside click detected, closing menu"),he.classList.remove("show"),document.removeEventListener("click",yt))},[]),[ft,_t]=C.useState({multipleChoice:{buttonVisible:!1,hintVisible:!1},trueFalse:{buttonVisible:!1,hintVisible:!1},input:{buttonVisible:!1,hintVisible:!1}}),zt=C.useCallback((oe,he)=>{const Ce=oe.target.files[0];if(!Ce)return;if(!Ce.name.match(/\.(xlsx|xls)$/i)){r("Please select a valid Excel file (.xlsx or .xls)","error"),oe.target.value="";return}if(Ce.size>5*1024*1024){r("File is too large. Please select a file smaller than 5MB.","error"),oe.target.value="";return}A(!0);const Ne=new FileReader;Ne.onload=function(Ge){try{console.log("🔍 File loaded, processing data...");const ot=new Uint8Array(Ge.target.result),Le=y2(ot,{type:"array"}),Et=Le.SheetNames[0],Bt=Le.Sheets[Et],Yt=M1.sheet_to_json(Bt,{header:1});console.log("🔍 Parsed Excel data:",Yt),De(Yt,he),A(!1)}catch(ot){console.error("Error processing Excel file:",ot),r("Error reading Excel file: "+ot.message,"error"),oe.target.value="",A(!1)}},Ne.onerror=function(){r("Failed to read file","error"),oe.target.value="",A(!1)},Ne.readAsArrayBuffer(Ce)},[r]),Jt=C.useCallback(()=>{console.log("🔍 Initializing Excel upload for all test types...");const oe=document.querySelectorAll(".excel-upload-btn");console.log(`🔍 Found ${oe.length} Excel upload buttons`),oe.forEach((he,Ce)=>{const Ne=he.dataset.testType,Ge=document.querySelector(`.excel-file-input[data-test-type="${Ne}"]`);console.log(`🔍 Processing button ${Ce+1}: testType=${Ne}, fileInput=${Ge?"found":"not found"}`),Ge?(he._excelClickHandler&&he.removeEventListener("click",he._excelClickHandler),Ge._excelChangeHandler&&Ge.removeEventListener("change",Ge._excelChangeHandler),he._excelClickHandler=()=>{console.log(`🔍 Excel upload button clicked for test type: ${Ne}`),Ge.click()},Ge._excelChangeHandler=ot=>{console.log(`🔍 File input changed for test type: ${Ne}`),zt(ot,Ne)},he.addEventListener("click",he._excelClickHandler),Ge.addEventListener("change",Ge._excelChangeHandler),console.log(`✅ Excel upload initialized for test type: ${Ne}`)):console.warn(`⚠️ File input not found for test type: ${Ne}`)}),console.log("✅ Excel upload initialization complete")},[zt]),De=C.useCallback((oe,he)=>{const Ce=oe.filter(Bt=>Array.isArray(Bt)&&Bt.length>0&&Bt.some(Yt=>Yt&&Yt.toString().trim()!==""));console.log("🔍 Original Excel data rows:",oe.length),console.log("🔍 Filtered Excel data rows:",Ce.length);const Ge=ut(Ce,he).dataRows;if(Ge.length===0){const Bt="No data rows found after header processing. Please check your Excel file.";r(Bt,"error"),alert(Bt),fe(he);return}console.log(`🔍 Processing Excel data for test type: ${he}`),console.log("🔍 Data rows after header processing:",Ge);const ot=Lt(Ge,he);if(console.log("🔍 Recognition result:",ot),!ot.recognized){console.log(`❌ Excel data recognition failed for test type: ${he}`);const Bt="Excel data recognition failed. Please check your file format.";r(Bt,"error"),alert(Bt),fe(he);return}console.log(`✅ Excel data recognition successful for test type: ${he}`);const Le=Ge.length,Et=ve(he);if(Et===0)console.log(`🔍 No question count specified, using CSV count: ${Le}`),D(Bt=>({...Bt,numQuestions:Le}));else if(Le!==Et){const Bt=`Your CSV file has ${Le} data rows, but you specified ${Et} questions.

Please either:
1. Change your question count to ${Le}, or
2. Fix your CSV file to have exactly ${Et} data rows

Then try uploading again.`;r(Bt,"error"),fe(he);return}we(Ge,he)},[r]),ut=C.useCallback((oe,he)=>{if(oe.length===0)return{hasHeaders:!1,headerRow:null,dataRows:oe};const Ce=oe[0],Ne=pt(he);if(Pt(Ce,Ne).isLikelyHeader){const ot=`The first row of your Excel file looks like it contains headers:

"${Ce.join(" | ")}"

Does the first row contain column headers?

Click "OK" if YES (headers will be removed)
Click "Cancel" if NO (first row will be treated as data)`;if(window.confirm(ot))return{hasHeaders:!0,headerRow:Ce,dataRows:oe.slice(1)}}return{hasHeaders:!1,headerRow:null,dataRows:oe}},[]),pt=C.useCallback(oe=>{switch(oe){case"multipleChoice":return{keywords:["question","answer","correct","option","a","b","c","d","e","f"],expectedColumns:4};case"trueFalse":return{keywords:["question","answer","correct","true","false"],expectedColumns:2};case"input":return{keywords:["question","answer","correct"],expectedColumns:2};default:return{keywords:[],expectedColumns:0}}},[]),Pt=C.useCallback((oe,he)=>{if(!oe||oe.length===0)return{isLikelyHeader:!1};if(oe.length<he.expectedColumns)return{isLikelyHeader:!1};const Ce=oe.join(" ").toLowerCase(),Ne=he.keywords.filter(ot=>Ce.includes(ot.toLowerCase()));return{isLikelyHeader:Ne.length>he.keywords.length/2,keywordMatches:Ne}},[]),Lt=C.useCallback((oe,he)=>{if(oe.length===0)return r("No data rows found. Please check your Excel file.","error"),{recognized:!1,data:[]};console.log(`🔍 Checking data pattern for test type: ${he}`),console.log("🔍 Excel data to validate:",oe);const Ce=sr(oe,he);if(console.log("🔍 Recognition result:",Ce),!Ce.matches){const Ne=`Your Excel file doesn't match the expected format.

Required format:
${Te(he)}

Please review your Excel file and make sure it follows this format exactly.

Then try uploading again.`;return console.log("❌ Data pattern validation failed:",Ne),console.log("🔍 Calling showNotification with message:",Ne),r(Ne,"error"),console.log("🔍 showNotification called"),alert(Ne),{recognized:!1,data:[]}}return console.log(`✅ Data pattern validation passed for test type: ${he}`),{recognized:!0,data:oe}},[r]),sr=C.useCallback((oe,he)=>{if(he==="multipleChoice")for(let Ce=0;Ce<oe.length;Ce++){const Ne=oe[Ce];if(Ne.length<4)return{matches:!1,issue:`Row ${Ce+1} has ${Ne.length} columns but needs at least 4`};if(!Ne[0]||Ne[0].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no question in column 1`};if(!Ne[1]||Ne[1].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no correct answer in column 2`}}else if(he==="trueFalse")for(let Ce=0;Ce<oe.length;Ce++){const Ne=oe[Ce];if(Ne.length<2)return{matches:!1,issue:`Row ${Ce+1} has ${Ne.length} columns but needs at least 2`};if(!Ne[0]||Ne[0].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no question in column 1`};const Ge=Ne[1]?.toString().trim().toLowerCase();if(!Ge||!["true","false","t","f"].includes(Ge))return{matches:!1,issue:`Row ${Ce+1} has invalid correct answer in column 2 (must be True/False)`}}else if(he==="input")for(let Ce=0;Ce<oe.length;Ce++){const Ne=oe[Ce];if(Ne.length<2)return{matches:!1,issue:`Row ${Ce+1} has ${Ne.length} columns but needs at least 2`};if(!Ne[0]||Ne[0].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no question in column 1`};if(!Ne[1]||Ne[1].toString().trim()==="")return{matches:!1,issue:`Row ${Ce+1} has no correct answer in column 2`}}return{matches:!0}},[]),Te=C.useCallback(oe=>{switch(oe){case"multipleChoice":return`Column 1: Question
Column 2: Correct Answer (A, B, C, D, E, or F)
Column 3: Option A
Column 4: Option B
Column 5: Option C (optional)
Column 6: Option D (optional)
Column 7: Option E (optional)
Column 8: Option F (optional)`;case"trueFalse":return`Column 1: Question
Column 2: Correct Answer (True or False)`;case"input":return`Column 1: Question
Column 2: Correct Answer`;default:return"Unknown test type"}},[]),ve=C.useCallback(oe=>T.numQuestions||0,[T.numQuestions]),fe=C.useCallback(oe=>{console.log(`🔍 Clearing file input for test type: ${oe}`)},[]),we=C.useCallback((oe,he)=>{switch(console.log(`🔍 populateFromExcelForTestType called with testType: ${he}`),he){case"multipleChoice":case"multiple-choice":Ue(oe);break;case"trueFalse":case"true-false":St(oe);break;case"input":xt(oe);break;default:console.log(`❌ Unknown test type: ${he}`)}},[]),Ue=C.useCallback(oe=>{console.log("🔍 populateMultipleChoiceFromExcel called with:",oe);const he=Math.max(...oe.map(Ge=>Ge.length-2)),Ce=Math.min(he,6);console.log(`🔍 Excel data has ${he} option columns, using ${Ce} options`),D(Ge=>({...Ge,numOptions:Ce}));const Ne={};oe.forEach((Ge,ot)=>{const Le=ot+1;console.log(`🔍 Row ${ot+1} data:`,Ge);const Et={question:(Ge[0]||"").toString().trim(),options:[],correctAnswer:(Ge[1]||"").toString().trim().toUpperCase()};console.log(`🔍 Question ${Le} correctAnswer:`,Et.correctAnswer),["A","B","C","D","E","F"].slice(0,Ce).forEach((Fe,We)=>{const Ct=(Ge[We+2]||"").toString().trim();console.log(`🔍 Option ${We} (${Fe}):`,Ct),Et.options.push(Ct)}),Ne[Le]=Et}),D(Ge=>{const ot={...Ge,questions:Ne};return console.log("🔍 Updating form data with:",ot),ot}),console.log("🔍 Populated multiple choice questions from Excel:",Ne),r(`Successfully loaded ${oe.length} questions from CSV file!`,"success"),z(),Ht("multiple-choice")},[T.numOptions,z,r]),St=C.useCallback(oe=>{console.log("🔍 populateTrueFalseFromExcel called with:",oe);const he={};oe.forEach((Ce,Ne)=>{const Ge=Ne+1,ot={question:(Ce[0]||"").toString().trim(),correctAnswer:Ce[1]?.toString().trim().toLowerCase()==="true"?"true":"false"};he[Ge]=ot}),D(Ce=>({...Ce,questions:he})),console.log("🔍 Populated true/false questions from Excel:",he),r(`Successfully loaded ${oe.length} questions from CSV file!`,"success"),Q(),Ht("true-false")},[Q,r]),xt=C.useCallback(oe=>{console.log("🔍 populateInputFromExcel called with:",oe);const he={};oe.forEach((Ce,Ne)=>{const Ge=Ne+1,ot=[];for(let Et=1;Et<Ce.length;Et++){const Bt=(Ce[Et]||"").toString().trim();Bt&&ot.push(Bt)}const Le={question:(Ce[0]||"").toString().trim(),correctAnswer:ot[0]||"",correct_answers:ot};console.log(`🔍 Excel question ${Ge} data:`,Le),he[Ge]=Le}),D(Ce=>({...Ce,questions:he})),console.log("🔍 Populated input questions from Excel:",he),r(`Successfully loaded ${oe.length} questions from Excel file!`,"success"),Y(),Ht("input")},[Y,r]),Ht=C.useCallback(oe=>{switch(console.log(`🔍 Reattaching form event listeners for test type: ${oe}`),document.querySelectorAll('[data-listener-attached="true"]').forEach(Ce=>{Ce.removeEventListener("input",()=>{}),Ce.removeAttribute("data-listener-attached")}),oe){case"multiple-choice":z();break;case"true-false":Q();break;case"input":Y();break;default:console.warn("Unknown test type for event listener reattachment:",oe)}console.log(`✅ Form event listeners reattached for test type: ${oe}`)},[z,Q,Y]),Ot=C.useCallback(()=>{const oe=localStorage.getItem("test_creation_state");if(!oe)return console.log("🔍 No test creation state found in localStorage"),!1;try{const he=JSON.parse(oe);console.log("🔍 Found test creation state:",he);const Ce=Date.now()-he.timestamp,Ne=1800*1e3;if(Ce>Ne)return console.log("🔍 Test creation state is too old, clearing it"),L(),!1;switch(a(!0),console.log("🔍 Restored isInTestCreation flag to true"),ne(),he.excelState&&H(),he.currentStep){case"testTypeSelection":console.log("🔍 Restoring test type selection step"),d("typeSelection");break;case"multipleChoiceForm":console.log("🔍 Restoring multiple choice form step"),y("multipleChoice"),d("formCreation");break;case"trueFalseForm":console.log("🔍 Restoring true/false form step"),y("trueFalse"),d("formCreation");break;case"inputForm":console.log("🔍 Restoring input form step"),y("input"),d("formCreation");break;case"testAssignment":case"assignment":console.log("🔍 Restoring test assignment step"),console.log("🔍 Cannot restore test assignment step without test data, going back to type selection"),d("typeSelection");break;default:console.log("🔍 Unknown step in state, defaulting to type selection"),d("typeSelection")}return B(he.currentStep),!0}catch(he){return console.error("🔍 Error restoring test creation state:",he),L(),!1}},[L,ne,H,B]);C.useEffect(()=>{console.log("👨‍🏫 Initializing Teacher Tests..."),ie(),Ot(),_e(),Jt()},[ie,Ot,_e,Jt]),C.useEffect(()=>{T.numQuestions>0&&g&&g!=="matching"&&g!=="drawing"&&g!=="fillBlanks"&&(console.log("🔍 Excel upload buttons rendered, initializing event listeners..."),setTimeout(()=>{Jt()},100))},[T.numQuestions,g,Jt]);const Xt=oe=>{console.log("👨‍🏫 Test type selected:",oe),console.log("👨‍🏫 Setting testType to:",oe),y(oe),d("formCreation"),D({testName:"",numQuestions:0,numOptions:0,questions:{},enableTimer:!1,timerMinutes:""}),W("formCreation"),setTimeout(()=>{Jt()},100)},pr=(oe,he)=>{D(Ce=>({...Ce,[oe]:he}))},Fr=(oe,he,Ce)=>{D(Ne=>({...Ne,questions:{...Ne.questions,[oe]:{...Ne.questions[oe],[he]:Ce}}}))},fr=(oe,he,Ce,Ne=0)=>{const Ge={};for(let ot=1;ot<=Ce;ot++)oe==="multipleChoice"?Ge[ot]={question:"",options:Array.from({length:Ne},()=>""),correctAnswer:""}:oe==="trueFalse"?Ge[ot]={question:"",correctAnswer:""}:oe==="input"&&(Ge[ot]={question:"",correct_answers:[""]});D(ot=>({...ot,questions:Ge})),oe==="multipleChoice"?(te("multiple-choice"),ee("multiple-choice")):oe==="trueFalse"?(te("true-false"),ee("true-false")):oe==="input"&&(te("input"),ee("input"))},vr=async()=>{if(!g||!T.testName||!T.numQuestions){r("Please fill in all required fields","error");return}console.log("👨‍🏫 Test form completed, proceeding to assignment step"),W("testAssignment",T),d("testAssignment"),r("Test form completed! Now select classes and subjects.","success")},Mr=(oe,he,Ce,Ne,Ge)=>{V(Ce?ot=>[...ot,{grade:oe,class:he,subject_id:Ne,subject:Ge}]:ot=>ot.filter(Le=>!(Le.grade===oe&&Le.class===he&&Le.subject_id===Ne)))},sn=C.useCallback(async oe=>{console.log("🎯 [DEBUG] handleMatchingTestSave called"),console.log("🎯 [DEBUG] Received testData:",oe),console.log("🎯 [DEBUG] Current formData:",T),console.log("🎯 [DEBUG] Current testType:",g),console.log("🎯 [DEBUG] Current user:",e),console.log("🎯 [DEBUG] Current currentStep:",c),w(!0);try{const he=oe.blocks.map((Ge,ot)=>{const Le=oe.words.find(Yt=>Yt.blockId===Ge.id)?.word||`Word ${ot+1}`,Et=oe.arrows.some(Yt=>Yt.startBlock===Ge.id),Bt=oe.arrows.find(Yt=>Yt.startBlock===Ge.id)||null;return{question_id:ot+1,word:Le,block_coordinates:{x:Ge.x,y:Ge.y,width:Ge.width,height:Ge.height},has_arrow:Et,arrow:Bt?{startX:Bt.startX,startY:Bt.startY,endX:Bt.endX,endY:Bt.endY,style:Bt.style||{}}:null}}),Ce={teacher_id:e.teacher_id,test_name:T.testName||`Matching Test - ${new Date().toLocaleString()}`,image_url:oe.imageUrl,num_blocks:oe.blocks.length,questions:he,assignments:[]};console.log("📦 Sending matching test payload:",Ce);const Ne={...T,testName:Ce.test_name,numQuestions:Ce.num_blocks,numOptions:0,questions:he.reduce((Ge,ot,Le)=>(Ge[Le+1]={question:ot.word,correctAnswer:ot.word,options:[]},Ge),{}),matchingTestData:oe};console.log("📦 Assignment form data:",Ne),D(Ne),W("testAssignment",Ne),console.log("📦 Setting current step to testAssignment"),d("testAssignment"),r("Matching test data saved! Now select classes and subjects.","success")}catch(he){console.error("❌ Error saving matching test:",he),r("Failed to save matching test: "+he.message,"error")}finally{w(!1)}},[e,T,g,r,W]),le=C.useCallback(()=>{console.log("❌ Cancelling matching test creation"),d("typeSelection"),D({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),be=C.useCallback(async oe=>{console.log("🎯 [DEBUG] handleWordMatchingTestSave called"),console.log("🎯 [DEBUG] Received testData:",oe),w(!0);try{D(he=>({...he,wordMatchingData:oe,numQuestions:oe.numQuestions||oe.wordPairs?.length||0})),d("testAssignment"),r("Word matching test created! Now assign it to classes.","success")}catch(he){console.error("Error saving word matching test:",he),r("Failed to save word matching test: "+he.message,"error")}finally{w(!1)}},[r]),pe=C.useCallback(()=>{console.log("❌ Cancelling word matching test creation"),d("typeSelection"),D({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),xe=C.useCallback(async oe=>{console.log("🎯 [DEBUG] handleDrawingTestSave called"),console.log("🎯 [DEBUG] Received testData:",oe),w(!0);try{D(he=>({...he,drawingData:oe,numQuestions:oe.num_questions||oe.questions?.length||0})),d("testAssignment"),r("Drawing test created! Now assign it to classes.","success")}catch(he){console.error("❌ Error saving drawing test:",he),r("Error saving drawing test","error")}finally{w(!1)}},[r]),Se=C.useCallback(()=>{console.log("❌ Cancelling drawing test creation"),d("typeSelection"),D({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),ke=C.useCallback(()=>{console.log("❌ Cancelling fill blanks test creation"),d("typeSelection"),D({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),$e=C.useCallback(async oe=>{console.log("🎯 [DEBUG] handleFillBlanksTestSave called"),console.log("🎯 [DEBUG] Received testData:",oe),w(!0);try{D(he=>({...he,fillBlanksData:oe,numQuestions:oe.num_questions||oe.blanks?.length||0})),d("testAssignment"),r("Fill blanks test created! Now assign it to classes.","success")}catch(he){console.error("❌ Error saving fill blanks test:",he),r("Error saving fill blanks test","error")}finally{w(!1)}},[r]),ht=C.useCallback(()=>{console.log("❌ Cancelling speaking test creation"),d("typeSelection"),D({testName:"",numQuestions:0,numOptions:0,questions:{}})},[]),Ke=C.useCallback(async oe=>{console.log("🎯 [DEBUG] handleSpeakingTestSave called"),console.log("🎯 [DEBUG] Received testData:",oe),w(!0);try{D(he=>({...he,speakingData:oe,numQuestions:oe.questions?.length||0})),d("testAssignment"),r("Speaking test created! Now assign it to classes.","success")}catch(he){console.error("❌ Error saving speaking test:",he),r("Error saving speaking test","error")}finally{w(!1)}},[r]);return o.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[o.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs(_i,{mode:"wait",children:[c==="typeSelection"&&o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs(nt,{variant:"outline",onClick:()=>window.history.back(),className:"flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),o.jsx("span",{children:"Back to Main"})]}),o.jsx("div",{className:"flex-1"})]}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Create New Test"}),o.jsx("p",{className:"text-gray-600",children:"Choose the type of test you want to create"})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[{type:"multipleChoice",title:"Multiple Choice",description:"Questions with multiple answer options",icon:"/pics/multiple-choice.png"},{type:"trueFalse",title:"True/False",description:"Questions with true or false answers",icon:"/pics/true-false.png"},{type:"input",title:"Input",description:"Questions requiring text input",icon:"/pics/input.png"},{type:"matching",title:"Picture Matching",description:"Labeling pictures",icon:"/pics/matching.png"},{type:"wordMatching",title:"Word Matching",description:"Matching word pairs by dragging or drawing arrows",icon:"/pics/matching-words.png"},{type:"drawing",title:"Drawing Test",description:"Interactive drawing tests with canvas for students",icon:"/pics/drawing.png"},{type:"fillBlanks",title:"Fill Blanks",description:"Text with multiple choice blanks",icon:"/pics/fill-blanks.png"},{type:"speaking",title:"Speaking Test",description:"Audio recording with AI-powered feedback",icon:"/pics/speaking.png"}].map(({type:oe,title:he,description:Ce,icon:Ne})=>o.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"cursor-pointer",onClick:()=>Xt(oe),children:o.jsxs(kt,{className:"h-full text-center hover:shadow-lg transition-shadow",children:[o.jsx("div",{className:"mb-3 flex justify-center",children:o.jsx("img",{src:Ne,alt:he,className:"w-12 h-12 object-contain"})}),o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:he}),o.jsx("p",{className:"text-sm text-gray-600",children:Ce})]})},oe))})]}),c==="formCreation"&&o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"flex space-x-2",children:o.jsx(nt,{variant:"outline",onClick:q,children:"← Back to Test Types"})}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Create ",g==="multipleChoice"?"Multiple Choice":g==="trueFalse"?"True/False":g==="input"?"Input":g==="drawing"?"Drawing":g==="fillBlanks"?"Fill Blanks":g==="wordMatching"?"Word Matching":g==="speaking"?"Speaking":"Picture Matching"," Test"]}),o.jsx("p",{className:"text-gray-600",children:"Fill in the test details and questions"})]})]})}),o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Test Information"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Test Name"}),o.jsx("input",{type:"text",value:T.testName,onChange:oe=>pr("testName",oe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter test name"})]}),g!=="matching"&&g!=="wordMatching"&&g!=="drawing"&&g!=="fillBlanks"&&g!=="speaking"&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Questions"}),o.jsx("input",{type:"number",min:"1",max:"50",value:T.numQuestions,onChange:oe=>{const he=parseInt(oe.target.value)||0;pr("numQuestions",he),he>0&&fr(g,T.testName,he,T.numOptions)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter number of questions"})]}),g==="multipleChoice"&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Options per Question"}),o.jsx("input",{type:"number",min:"2",max:"6",value:T.numOptions,onChange:oe=>{const he=parseInt(oe.target.value)||0;pr("numOptions",he),he>0&&he<2&&r("Multiple choice tests require at least 2 options per question. Please enter 2 or more.","warning"),T.numQuestions>0&&fr(g,T.testName,T.numQuestions,he)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter number of options (2-6)"})]}),g!=="speaking"&&o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs("label",{className:"inline-flex items-center space-x-2",children:[o.jsx("input",{type:"checkbox",checked:!!T.enableTimer,onChange:oe=>pr("enableTimer",oe.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),o.jsx("span",{className:"text-sm text-gray-700",children:"Enable timer for this test"})]}),T.enableTimer&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("label",{className:"text-sm text-gray-700",children:"Time (minutes):"}),o.jsx("input",{type:"number",min:"1",max:"1440",value:T.timerMinutes,onChange:oe=>pr("timerMinutes",oe.target.value.replace(/[^0-9]/g,"")),className:"w-28 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g. 30"})]}),g!=="drawing"&&g!=="matching"&&g!=="wordMatching"&&g!=="fillBlanks"&&g!=="speaking"&&o.jsxs("label",{className:"inline-flex items-center space-x-2 ml-6",children:[o.jsx("input",{type:"checkbox",checked:!!T.isShuffled,onChange:oe=>pr("isShuffled",oe.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),o.jsx("span",{className:"text-sm text-gray-700",children:"Shuffle questions during test"})]})]})]})}),g==="matching"&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4 text-center",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Picture Matching Test"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Upload an image and create interactive matching blocks with words."}),o.jsx(DL,{testName:T.testName,onTestSaved:sn,onCancel:le,onBackToCabinet:qe,isSaving:k,validationErrors:{}})]})}),g==="wordMatching"&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4 text-center",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Word Matching Test"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Create word pairs for students to match by dragging or drawing arrows."}),o.jsx(MW,{testName:T.testName,onTestSaved:be,onCancel:pe,onBackToCabinet:qe,isSaving:k,validationErrors:{}})]})}),g==="drawing"&&o.jsxs("div",{className:"drawing-test-section",children:[console.log("🎨 Rendering DrawingTestCreator, testType:",g),o.jsx(CW,{testName:T.testName,onTestSaved:xe,onCancel:Se,onBackToCabinet:qe,isSaving:k,validationErrors:{}})]}),g==="fillBlanks"&&o.jsxs("div",{className:"fill-blanks-test-section",children:[console.log("📝 Rendering FillBlanksTestCreator, testType:",g),o.jsx(AW,{testName:T.testName,allowedTime:T.enableTimer&&parseInt(T.timerMinutes)||null,onTestSaved:$e,onCancel:ke,onBackToCabinet:qe,isSaving:k,validationErrors:{}})]}),g==="speaking"&&o.jsxs(kt,{children:[console.log("🎤 Rendering SpeakingTestCreator, testType:",g),o.jsx(FW,{testName:T.testName,onTestSaved:Ke,onCancel:ht,onBackToCabinet:qe,isSaving:k,validationErrors:{}})]}),g!=="matching"&&g!=="drawing"&&g!=="fillBlanks"&&g!=="speaking"&&T.numQuestions>0&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Excel Upload"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Upload an Excel file to automatically populate questions, or fill them in manually below."}),o.jsxs("div",{className:"space-y-6",children:[g==="multipleChoice"&&ft.multipleChoice?.buttonVisible&&o.jsxs("div",{className:"flex items-start space-x-4",children:[o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("button",{type:"button",className:"excel-upload-btn px-6 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md hover:shadow-lg transition-all duration-200 flex items-center space-x-3 min-h-[60px] disabled:opacity-50 disabled:cursor-not-allowed","data-test-type":"multiple-choice",disabled:N,children:N?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",color:"white"}),o.jsx("span",{className:"font-medium",children:"Processing..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("img",{src:"/pics/excel.png",alt:"Excel",className:"w-6 h-6 object-contain"}),o.jsx("span",{className:"font-medium",children:"Upload Excel"})]})}),o.jsx("input",{type:"file",accept:".xlsx,.xls",className:"excel-file-input hidden","data-test-type":"multiple-choice"})]}),o.jsx("div",{className:"w-fit",children:o.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md min-h-[60px] flex items-start",children:o.jsxs("div",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Multiple Choice Format:"}),o.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[o.jsx("div",{children:"Column 1: Question"}),o.jsx("div",{children:"Column 2: Correct Answer (A-F)"}),o.jsx("div",{children:"Column 3: Option A text"}),o.jsx("div",{children:"Column 4: Option B text"}),o.jsx("div",{children:"Column 5: Option C text"}),o.jsx("div",{children:"Column 6: Option D text"})]})]})})})]}),g==="trueFalse"&&ft.trueFalse?.buttonVisible&&o.jsxs("div",{className:"flex items-start space-x-4",children:[o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("button",{type:"button",className:"excel-upload-btn px-6 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md hover:shadow-lg transition-all duration-200 flex items-center space-x-3 min-h-[60px] disabled:opacity-50 disabled:cursor-not-allowed","data-test-type":"true-false",disabled:N,children:N?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",color:"white"}),o.jsx("span",{className:"font-medium",children:"Processing..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("img",{src:"/pics/excel.png",alt:"Excel",className:"w-6 h-6 object-contain"}),o.jsx("span",{className:"font-medium",children:"Upload Excel"})]})}),o.jsx("input",{type:"file",accept:".xlsx,.xls",className:"excel-file-input hidden","data-test-type":"true-false"})]}),o.jsx("div",{className:"w-fit",children:o.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md min-h-[60px] flex items-start",children:o.jsxs("div",{className:"text-xs text-blue-800",children:[o.jsxs("div",{children:[o.jsx("strong",{children:"Format:"})," Question | Answer (true/false)"]}),o.jsxs("div",{className:"mt-1",children:[o.jsx("strong",{children:"Example:"})," The Earth is round | true"]}),o.jsxs("div",{className:"mt-1",children:[o.jsx("strong",{children:"Note:"})," Headers are optional"]})]})})})]}),g==="input"&&ft.input?.buttonVisible&&o.jsxs("div",{className:"flex items-start space-x-4",children:[o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("button",{type:"button",className:"excel-upload-btn px-6 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md hover:shadow-lg transition-all duration-200 flex items-center space-x-3 min-h-[60px] disabled:opacity-50 disabled:cursor-not-allowed","data-test-type":"input",disabled:N,children:N?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",color:"white"}),o.jsx("span",{className:"font-medium",children:"Processing..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("img",{src:"/pics/excel.png",alt:"Excel",className:"w-6 h-6 object-contain"}),o.jsx("span",{className:"font-medium",children:"Upload Excel"})]})}),o.jsx("input",{type:"file",accept:".xlsx,.xls",className:"excel-file-input hidden","data-test-type":"input"})]}),o.jsx("div",{className:"w-fit",children:o.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md min-h-[60px] flex items-start",children:o.jsxs("div",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Input Test Format:"}),o.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[o.jsx("div",{children:"Column 1: Question"}),o.jsx("div",{children:"Column 2: Answer 1"}),o.jsx("div",{children:"Column 3: Answer 2 (optional)"})]})]})})})]})]})]})}),g!=="matching"&&g!=="drawing"&&g!=="fillBlanks"&&T.numQuestions>0&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Manual Question Entry"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Fill in the questions manually using the form below."})]})}),T.numQuestions>0&&o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Questions"}),o.jsx("div",{className:"space-y-6",children:Object.keys(T.questions).map(oe=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Question ",oe]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question Text"}),o.jsx("textarea",{value:T.questions[oe]?.question||"",onChange:he=>Fr(oe,"question",he.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Enter the question text"})]}),g==="multipleChoice"&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Answer Options"}),o.jsx("div",{className:"space-y-2",children:T.questions[oe]?.options?.map((he,Ce)=>o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("span",{className:"w-6 text-sm font-medium text-gray-700",children:[String.fromCharCode(65+Ce),":"]}),o.jsx("input",{type:"text",value:he,onChange:Ne=>{const Ge=[...T.questions[oe].options];Ge[Ce]=Ne.target.value,Fr(oe,"options",Ge)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Option ${String.fromCharCode(65+Ce)}`})]},Ce))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Correct Answer"}),g==="multipleChoice"?o.jsx("div",{children:o.jsxs("select",{value:T.questions[oe]?.correctAnswer||"",onChange:he=>Fr(oe,"correctAnswer",he.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"",children:"Select correct answer"}),T.questions[oe]?.options?.map((he,Ce)=>o.jsx("option",{value:String.fromCharCode(65+Ce),children:String.fromCharCode(65+Ce)},Ce))]})}):g==="trueFalse"?o.jsxs("select",{value:T.questions[oe]?.correctAnswer||"",onChange:he=>Fr(oe,"correctAnswer",he.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"true",children:"True"}),o.jsx("option",{value:"false",children:"False"})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Correct Answer(s)"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("input",{type:"text",value:T.questions[oe]?.correct_answers?.[0]||"",onChange:he=>{const Ne=[...T.questions[oe]?.correct_answers||[""]];Ne[0]=he.target.value,Fr(oe,"correct_answers",Ne)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter the primary correct answer"}),T.questions[oe]?.correct_answers?.slice(1).map((he,Ce)=>o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"text",value:he,onChange:Ne=>{const Ge=[...T.questions[oe]?.correct_answers||[]];Ge[Ce+1]=Ne.target.value,Fr(oe,"correct_answers",Ge)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Alternative answer ${Ce+2}`}),o.jsx("button",{type:"button",onClick:()=>{const Ne=[...T.questions[oe]?.correct_answers||[]];Ne.splice(Ce+1,1),Fr(oe,"correct_answers",Ne)},className:"px-2 py-1 text-red-600 hover:text-red-800 text-sm",children:"Remove"})]},Ce))||[],o.jsx("button",{type:"button",onClick:()=>{const Ce=[...T.questions[oe]?.correct_answers||[""],""];Fr(oe,"correct_answers",Ce)},className:"px-3 py-1 text-blue-600 hover:text-blue-800 text-sm border border-blue-300 rounded-md hover:bg-blue-50",children:"+ Add Alternative Answer"})]}),o.jsx("p",{className:"text-xs text-gray-500",children:"You can add multiple correct answers for the same question. Students will get credit for any of them."})]})]})]})]},oe))})]})}),T.testName&&T.numQuestions>0&&o.jsx("div",{className:"flex justify-end",children:o.jsx(nt,{onClick:vr,disabled:k,className:"px-8",children:k?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",color:"white",className:"mr-2"}),"Saving Test..."]}):"Save Test & Continue to Assignment"})})]}),c==="testAssignment"&&o.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs(nt,{variant:"outline",onClick:()=>window.history.back(),className:"flex items-center space-x-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),o.jsx("span",{children:"Back to Main"})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Assign Test to Classes"}),o.jsx("p",{className:"text-gray-600",children:"Select which classes should take this test"})]})]}),o.jsx(nt,{variant:"outline",onClick:()=>d("formCreation"),children:"← Back to Test Form"})]}),o.jsx(kt,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Available Classes"}),v.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📚"}),o.jsx("p",{className:"text-gray-500 text-lg",children:"No subjects available for assignment."}),o.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"You need to assign subjects to grades and classes first."}),o.jsx("div",{className:"mt-4",children:o.jsx(nt,{onClick:()=>window.location.href="/teacher/subjects",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Go to Subjects Page"})})]}):o.jsx("div",{className:"space-y-6",children:v.map(oe=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:oe.subject}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2",children:oe.classes.map(he=>o.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:I.some(Ce=>Ce.grade===he.grade&&Ce.class===he.class&&Ce.subject_id===oe.subject_id),onChange:Ce=>Mr(he.grade,he.class,Ce.target.checked,oe.subject_id,oe.subject),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),o.jsxs("span",{className:"text-sm text-gray-700",children:[he.grade,"/",he.class]})]},`${he.grade}-${he.class}-${oe.subject_id}`))})]},oe.subject_id))})]})}),I.length>0&&o.jsx("div",{className:"flex justify-end",children:o.jsx(nt,{onClick:()=>He(g,null),disabled:b,className:"px-8",children:b?o.jsxs(o.Fragment,{children:[o.jsx(jr,{size:"sm",color:"white",className:"mr-2"}),"Assigning Test..."]}):`Assign Test to ${I.length} Class${I.length>1?"es":""}`})})]})]})}),console.log("🔍 Checking isAssigningTest:",P),P&&o.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-blue-600 font-semibold text-lg",children:"Assigning test to classes..."}),o.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Please wait while we process your assignment"})]})}),k&&o.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-blue-600 font-semibold text-lg",children:"Saving test..."}),o.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Please wait while we save your test"})]})}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:t.map(oe=>o.jsx(Ko,{type:oe.type,message:oe.message,duration:oe.duration,onClose:()=>n(oe.id)},oe.id))})]})},Yte=({onDataLoaded:e,onError:t})=>{const r=Ei(),{user:n,isAuthenticated:s}=Bn(),{teacherData:a,loadTeacherData:i}=Jy(),[l,c]=C.useState(!0),[d,f]=C.useState(""),[p,g]=C.useState([]),[y,v]=C.useState(null),[_,b]=C.useState([]),[E,k]=C.useState([]),[w,N]=C.useState([]),[A,P]=C.useState(null),[R,T]=C.useState(0);C.useEffect(()=>{ie()},[]),C.useCallback(async ne=>{console.log("👨‍🏫 Teacher login attempt...");try{const M=await _n.teacherLogin(ne);if(M.success)return Z("Login successful!","success"),await D(),M;throw new Error(M.error||"Login failed")}catch(M){throw console.error("👨‍🏫 Teacher login error:",M),Z("Login failed. Please check your credentials.","error"),M}},[]);const D=C.useCallback(async()=>{console.log("👨‍🏫 Loading teacher data...");try{if(c(!0),f(""),!s||!n){console.log("👨‍🏫 User not authenticated"),f("User not authenticated");return}if(n.role!==si.TEACHER){console.error("👨‍🏫 Invalid user role for teacher data:",n.role),f("Access denied. Teacher role required.");return}console.log("👨‍🏫 Fetching teacher data from service...");const ne=await _n.getTeacherData();if(ne&&ne.success)console.log("👨‍🏫 Teacher data loaded successfully:",ne),v(ne.teacher||n),ne.subjects&&(b(ne.subjects),console.log("👨‍🏫 Teacher subjects loaded:",ne.subjects.length)),ne.grades&&k(ne.grades),ne.classes&&N(ne.classes),P(new Date),T(M=>M+1),e&&e(ne),Z("Teacher data loaded successfully!","success");else throw new Error(ne?.error||"Failed to load teacher data")}catch(ne){console.error("👨‍🏫 Error loading teacher data:",ne);const M=ne.message||"Failed to load teacher data";f(M),t&&t(ne),Z(M,"error")}finally{c(!1)}},[s,n,e,t]),I=C.useCallback(()=>{console.log("👨‍🏫 Returning to main cabinet..."),r("/teacher/cabinet")},[r]);C.useCallback(ne=>{console.log("👨‍🏫 Showing main cabinet with subjects:",ne),ne&&b(ne),r("/teacher/cabinet")},[r]);const V=C.useCallback(()=>(console.log("👨‍🏫 Rendering grade buttons..."),["M1","M2","M3","M4","M5","M6"].map(M=>({id:M,name:`Grade ${M}`,classes:X(M)}))),[]),X=C.useCallback(ne=>Array.from({length:10},(W,L)=>L+1).map(W=>({id:`${ne}-${W}`,name:`Class ${W}`,grade:ne,classNumber:W})),[]),Z=C.useCallback((ne,M)=>{const W={id:Date.now(),message:ne,type:M,timestamp:new Date};g(L=>[...L,W]),setTimeout(()=>{g(L=>L.filter(H=>H.id!==W.id))},wi.NOTIFICATION_DURATION)},[]),ie=C.useCallback(async()=>{console.log("👨‍🏫 Initializing teacher data..."),await D()},[D]),q=C.useCallback(async()=>{console.log("👨‍🏫 Refreshing teacher data..."),await D()},[D]);return C.useCallback(async ne=>{console.log("👨‍🏫 Updating teacher profile:",ne);try{const M=await _n.updateUserProfile(ne);if(M.success)return v(W=>({...W,...ne})),Z("Profile updated successfully!","success"),M;throw new Error(M.error||"Failed to update profile")}catch(M){throw console.error("👨‍🏫 Error updating teacher profile:",M),Z("Failed to update profile","error"),M}},[]),C.useCallback(async ne=>{console.log("👨‍🏫 Changing teacher password...");try{const M=await _n.changePassword(ne);if(M.success)return Z("Password changed successfully!","success"),M;throw new Error(M.error||"Failed to change password")}catch(M){throw console.error("👨‍🏫 Error changing teacher password:",M),Z("Failed to change password","error"),M}},[]),l?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Teacher Data..."})]})}):d?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Data Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:d}),o.jsxs("div",{className:"flex space-x-3 justify-center",children:[o.jsx(nt,{variant:"primary",onClick:q,children:"Retry"}),o.jsx(nt,{variant:"outline",onClick:I,children:"Go Back"})]})]})})}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Teacher Data"}),o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",A?A.toLocaleString():"Never"," | Version: ",R]})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx(nt,{variant:"outline",onClick:q,children:"Refresh Data"}),o.jsx(nt,{variant:"outline",onClick:I,children:"Back to Cabinet"})]})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Teacher Information"}),y?o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Name:"}),o.jsx("p",{className:"text-sm text-gray-900",children:y.name||"N/A"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Username:"}),o.jsx("p",{className:"text-sm text-gray-900",children:y.username||"N/A"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Email:"}),o.jsx("p",{className:"text-sm text-gray-900",children:y.email||"N/A"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Role:"}),o.jsx("p",{className:"text-sm text-gray-900",children:y.role||"N/A"})]})]}):o.jsx("p",{className:"text-gray-500",children:"No teacher information available"})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Subjects (",_.length,")"]}),_.length>0?o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map((ne,M)=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("h3",{className:"font-medium text-gray-900",children:ne.name}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:ne.description||"No description"}),ne.classes&&ne.classes.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Classes:"}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:ne.classes.map((W,L)=>o.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:[W.grade," - ",W.className]},L))})]})]},M))}):o.jsx("p",{className:"text-gray-500",children:"No subjects assigned"})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Grade Levels"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:V().map(ne=>o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:ne.name}),o.jsx("div",{className:"grid grid-cols-5 gap-1",children:ne.classes.map(M=>o.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded transition-colors",onClick:()=>console.log("Class clicked:",M),children:M.classNumber},M.id))})]},ne.id))})]}),o.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Data Statistics"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:_.length}),o.jsx("p",{className:"text-sm text-gray-500",children:"Subjects"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-semibold text-green-600",children:E.length}),o.jsx("p",{className:"text-sm text-gray-500",children:"Grades"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-semibold text-yellow-600",children:w.length}),o.jsx("p",{className:"text-sm text-gray-500",children:"Classes"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-semibold text-purple-600",children:R}),o.jsx("p",{className:"text-sm text-gray-500",children:"Data Version"})]})]})]})]})}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:p.map(ne=>o.jsx(Ko,{type:ne.type,message:ne.message,onClose:()=>g(M=>M.filter(W=>W.id!==ne.id))},ne.id))})]})},Qte=({onBackToCabinet:e})=>{const t=Ei(),{user:r,isAuthenticated:n}=Bn(),{teacherData:s}=Jy(),[a,i]=C.useState(!0),[l,c]=C.useState(""),[d,f]=C.useState([]),[p,g]=C.useState([]),[y,v]=C.useState([]),[_,b]=C.useState([]),[E,k]=C.useState(null),[w,N]=C.useState([]),[A,P]=C.useState(!1),[R,T]=C.useState(!1),[D,I]=C.useState(!1),[V,X]=C.useState(!1),[Z,ie]=C.useState(null),[q,ne]=C.useState(!0),[M,W]=C.useState(null);C.useEffect(()=>{Ve()},[]),C.useCallback(st=>{console.log("👨‍🏫 Rendering existing subjects:",st),g(st)},[]);const L=C.useCallback(()=>{console.log("👨‍🏫 Showing subject selection prompt..."),P(!0),ne(!1),H()},[]),H=C.useCallback(async()=>{console.log("👨‍🏫 Loading existing subjects...");try{const st=await _n.getTeacherSubjects();st.success&&st.subjects&&st.subjects.length>0?(console.log("👨‍🏫 Existing subjects found:",st.subjects),K(st.subjects)):(console.log("👨‍🏫 No existing subjects found"),b([]))}catch(st){console.error("👨‍🏫 Error loading existing subjects:",st),Xe("Failed to load existing subjects","error")}},[]),K=C.useCallback(st=>{console.log("👨‍🏫 Rendering subject selection:",st);const Ie=[];st.forEach(je=>{je.classes&&Array.isArray(je.classes)&&je.classes.forEach(Ze=>{Ie.push({id:`${je.subject_id}-${Ze.grade}-${Ze.class}`,subjectId:je.subject_id,subjectName:je.subject,grade:Ze.grade,class:Ze.class,displayText:`${je.subject} - ${Ze.grade}/${Ze.class}`})})}),b(Ie),console.log("👨‍🏫 Processed subjects for selection:",Ie)},[]),B=C.useCallback(async st=>{if(console.log("👨‍🏫 Saving teacher subjects:",st),!st||st.length===0){Xe("Please select at least one subject and class combination.","warning");return}try{const Ie=st.reduce((Ze,bt)=>{const mt=Ze.find($t=>$t.subject_id===bt.subjectId);return mt?mt.classes.push({grade:bt.grade,class:bt.class}):Ze.push({subject_id:bt.subjectId,classes:[{grade:bt.grade,class:bt.class}]}),Ze},[]);console.log("👨‍🏫 Transformed data for backend:",Ie);const je=await _n.saveTeacherSubjects(Ie);if(je.success)Xe("Subjects saved successfully!","success"),P(!1),ne(!0),W(new Date),await H();else throw new Error(je.error||"Failed to save subjects")}catch(Ie){console.error("👨‍🏫 Error saving subjects:",Ie),Xe("Error saving subjects. Please try again.","error")}},[]),z=C.useCallback(()=>{console.log("👨‍🏫 Toggling subject dropdown..."),T(st=>!st),I(!1)},[]),Q=C.useCallback(async()=>{console.log("👨‍🏫 Loading subjects for dropdown...");try{const st=await _n.getAllSubjects();if(st.success)v(st.subjects||[]),console.log("👨‍🏫 Available subjects loaded:",st.subjects?.length||0);else throw new Error(st.error||"Failed to load subjects")}catch(st){console.error("👨‍🏫 Error loading subjects for dropdown:",st),Xe("Failed to load subjects","error")}},[]),Y=C.useCallback(st=>{console.log("👨‍🏫 Subject selected:",st);const Ie=y.find(je=>je.subject_id===parseInt(st));Ie&&(k(Ie),I(!0),T(!1),te())},[y]),te=C.useCallback(()=>{console.log("👨‍🏫 Loading grades and classes...")},[]),ee=C.useCallback((st,Ie)=>{console.log("👨‍🏫 Saving classes for subject:",st,Ie);const je={id:`${st.subject_id}-${Date.now()}`,subjectId:st.subject_id,subjectName:st.subject,grade:Ie.grade,class:Ie.class,displayText:`${st.subject} - ${Ie.grade}/${Ie.class}`};b(Ze=>[...Ze,je]),k(null),N([]),I(!1),ge(`Added ${st.subject} for ${Ie.grade}/${Ie.class}`)},[]),ae=C.useCallback(()=>{console.log("👨‍🏫 Resetting subject selection..."),k(null),N([]),T(!1),I(!1)},[]),ge=C.useCallback(st=>{console.log("👨‍🏫 Showing message:",st),Xe(st,"success")},[]),_e=C.useCallback(st=>{console.log("👨‍🏫 Showing confirmation modal:",st),ie(st),X(!0)},[]),Me=C.useCallback(()=>{console.log("👨‍🏫 Hiding confirmation modal..."),X(!1),ie(null)},[]),ue=C.useCallback(()=>{console.log("👨‍🏫 Confirming save subjects..."),Me(),B(_)},[_,B,Me]),me=C.useCallback(()=>{console.log("👨‍🏫 Cancelling save subjects..."),Me()},[Me]),He=C.useCallback(st=>{console.log("👨‍🏫 Removing subject:",st),b(Ie=>Ie.filter(je=>je.id!==st)),Xe("Subject removed","info")},[]);C.useCallback(()=>{console.log("👨‍🏫 Showing edit subjects button..."),ne(!0)},[]),C.useCallback(()=>{console.log("👨‍🏫 Hiding edit subjects button..."),ne(!1)},[]);const qe=C.useCallback(st=>{console.log("👨‍🏫 Generating class buttons for grade:",st);let Ie;return st===1||st===2?Ie=["15","16"]:st===3?Ie=["15","16"]:st===4?Ie=["13","14"]:st===5||st===6?Ie=["13","14"]:Ie=[],Ie.map(je=>({id:`${st}-${je}`,grade:st,class:je,displayText:`${st}/${je}`}))},[]);C.useCallback((st,Ie)=>{console.log("👨‍🏫 Showing class results:",st,Ie),t("/teacher/results")},[t]);const Xe=C.useCallback((st,Ie)=>{const je={id:Date.now(),message:st,type:Ie,timestamp:new Date};f(Ze=>[...Ze,je]),setTimeout(()=>{f(Ze=>Ze.filter(bt=>bt.id!==je.id))},wi.NOTIFICATION_DURATION)},[]),Ve=C.useCallback(async()=>{console.log("👨‍🏫 Initializing teacher subjects...");try{if(i(!0),c(""),!n||!r){console.log("👨‍🏫 User not authenticated"),c("User not authenticated");return}if(r.role!==si.TEACHER){console.error("👨‍🏫 Invalid user role for teacher subjects:",r.role),c("Access denied. Teacher role required.");return}await H(),await Q(),console.log("👨‍🏫 Teacher subjects initialization complete!")}catch(st){console.error("👨‍🏫 Error initializing teacher subjects:",st),c("Failed to initialize teacher subjects")}finally{i(!1)}},[n,r,H,Q]),It=C.useCallback(()=>{e?e():t("/teacher/cabinet")},[e,t]);return a?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(jr,{size:"lg"}),o.jsx("p",{className:"mt-4 text-gray-600",children:"Loading Teacher Subjects..."})]})}):l?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[o.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Subjects Error"}),o.jsx("p",{className:"text-red-600 mb-4",children:l}),o.jsx(nt,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]})})}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-white shadow-sm border-b",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Subject Management"}),o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",M?M.toLocaleString():"Never"]})]}),o.jsxs("div",{className:"flex space-x-3",children:[q&&o.jsx(nt,{variant:"primary",onClick:L,children:"Edit Subjects"}),o.jsx(nt,{variant:"outline",onClick:It,children:"Back to Cabinet"})]})]})})}),o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsxs("div",{className:"space-y-6",children:[!A&&o.jsxs("div",{className:`\r
              bg-white rounded-xl shadow-md border border-gray-200 p-6\r
              hover:shadow-lg hover:-translate-y-1 transition-all duration-200\r
            `,children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Assigned Subjects"}),o.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your teaching subjects and class assignments"})]}),o.jsx("div",{className:"flex space-x-3",children:o.jsxs(nt,{variant:"primary",onClick:L,className:"px-6 py-2",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Subjects"]})})]}),p.length>0?o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map((st,Ie)=>o.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200",children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:st.subject}),st.classes&&st.classes.length>0&&o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-gray-600 mb-2",children:"Assigned Classes:"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:st.classes.map((je,Ze)=>o.jsxs("span",{className:"px-3 py-1 bg-blue-500 text-white text-sm font-medium rounded-full",children:["Grade ",je.grade," - Class ",je.class]},Ze))})]})]}),o.jsx("div",{className:"ml-4",children:o.jsx(nt,{variant:"outline",size:"sm",onClick:()=>He(st.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 border-red-300",children:o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]})},Ie))}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:o.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No subjects assigned yet"}),o.jsx("p",{className:"text-gray-500 mb-6",children:"Get started by adding your teaching subjects and class assignments"}),o.jsxs(nt,{variant:"primary",onClick:L,className:"px-6 py-3",children:[o.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Your First Subject"]})]})]}),A&&o.jsxs("div",{className:`\r
              bg-white rounded-xl shadow-md border border-gray-200 p-6\r
              hover:shadow-lg hover:-translate-y-1 transition-all duration-200\r
            `,children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Select Subjects and Classes"}),o.jsx("p",{className:"text-gray-600",children:"Choose the subjects you want to teach and assign them to specific classes"})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"mb-8",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:o.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:"1"})}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"Select Subject"}),o.jsx("p",{className:"text-gray-600",children:"Choose the subject you want to teach"})]})]}),o.jsxs("div",{className:"relative",children:[o.jsxs(nt,{variant:"outline",onClick:z,className:"w-full justify-between p-4 h-auto text-left border-2 border-gray-200 hover:border-blue-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white rounded-xl shadow-sm",children:[o.jsx("span",{className:"text-gray-900 font-medium",children:E?E.subject:"Select a subject"}),o.jsx("svg",{className:"w-5 h-5 ml-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),R&&o.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-xl max-h-60 overflow-y-auto",children:y.map(st=>o.jsx("button",{onClick:()=>Y(st.subject_id),className:"w-full px-4 py-4 text-left hover:bg-blue-50 focus:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200 border-b border-gray-100 last:border-b-0",children:o.jsx("span",{className:"text-gray-900 font-medium",children:st.subject})},st.subject_id))})]})]}),D&&E&&o.jsxs("div",{className:"mb-8",children:[o.jsxs("div",{className:"flex items-center mb-6",children:[o.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3",children:o.jsx("span",{className:"text-green-600 font-semibold text-sm",children:"2"})}),o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Select Classes for ",E.subject]}),o.jsx("p",{className:"text-gray-600",children:"Choose which classes you want to teach this subject to"})]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(st=>o.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-2",children:o.jsx("span",{className:"text-white font-bold text-xs",children:st})}),o.jsxs("h4",{className:"font-semibold text-gray-900",children:["Grade ",st]})]}),o.jsx("div",{className:"space-y-3",children:qe(st).map(Ie=>o.jsx(nt,{variant:"outline",size:"sm",onClick:()=>ee(E,Ie),className:"w-full text-sm py-2 px-4 border-green-300 hover:border-green-400 hover:bg-green-100 focus:ring-2 focus:ring-green-500 rounded-lg font-medium",children:Ie.displayText},Ie.id))})]},st))})]}),_.length>0&&o.jsxs("div",{className:"mb-8",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-3",children:o.jsx("span",{className:"text-purple-600 font-semibold text-sm",children:"3"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Selected Subjects"}),o.jsx("p",{className:"text-gray-600",children:"Review your subject and class selections"})]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:_.map(st=>o.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-xl p-4 hover:shadow-md transition-shadow duration-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("div",{className:"flex-1",children:o.jsx("span",{className:"text-sm font-semibold text-purple-900",children:st.displayText})}),o.jsx(nt,{variant:"outline",size:"sm",onClick:()=>He(st.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 border-red-300 focus:ring-2 focus:ring-red-500 rounded-lg",children:o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},st.id))})]}),o.jsxs("div",{className:"flex justify-between items-center pt-6 border-t-2 border-gray-100",children:[o.jsx("div",{className:"text-sm text-gray-500",children:_.length>0?`${_.length} subject${_.length>1?"s":""} selected`:"No subjects selected"}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsxs(nt,{variant:"outline",onClick:()=>{P(!1),ne(!0),ae()},className:"px-6 py-3 text-sm font-medium text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 focus:ring-2 focus:ring-gray-500 rounded-xl",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Cancel"]}),o.jsxs(nt,{variant:"primary",onClick:()=>_e({type:"save",data:_}),disabled:_.length===0,className:"px-8 py-3 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-indigo-600 border border-transparent rounded-xl hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),D?"Next: Select Classes":"Save Subjects"]})]})]})]})]})]})}),V&&o.jsx(Bo,{isOpen:V,onClose:Me,title:"Confirm Save",variant:"confirmation",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to save ",Z?.data?.length||0," subject assignments?"]}),o.jsxs("div",{className:"flex justify-end space-x-3",children:[o.jsx(nt,{variant:"outline",onClick:me,children:"Cancel"}),o.jsx(nt,{variant:"primary",onClick:ue,children:"Save"})]})]})}),o.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:d.map(st=>o.jsx(Ko,{type:st.type,message:st.message,onClose:()=>f(Ie=>Ie.filter(je=>je.id!==st.id))},st.id))})]})},Jte=()=>{const{user:e,role:t,isAuthenticated:r,isLoading:n}=Bn(),[s,a]=C.useState("cabinet");return!r||t!=="teacher"?o.jsx(r0,{to:"/login",replace:!0}):n?o.jsxs("div",{className:"teacher-app-loading",children:[o.jsx(jr,{}),o.jsx("p",{children:"Loading teacher interface..."})]}):o.jsx("div",{className:"teacher-app",children:o.jsxs(b2,{children:[o.jsx(ss,{path:"/",element:o.jsx(S3,{})}),o.jsx(ss,{path:"/cabinet",element:o.jsx(S3,{})}),o.jsx(ss,{path:"/tests",element:o.jsx(k3,{})}),o.jsx(ss,{path:"/tests/create",element:o.jsx(k3,{})}),o.jsx(ss,{path:"/data",element:o.jsx(Yte,{})}),o.jsx(ss,{path:"/subjects",element:o.jsx(Qte,{})}),o.jsx(ss,{path:"/results",element:o.jsx(cP,{})}),o.jsx(ss,{path:"*",element:o.jsx(r0,{to:"/teacher",replace:!0})})]})})},Ae={container:"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100",mainContainer:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",header:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg",headerContent:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",headerFlex:"flex justify-between items-center",adminInfo:"flex items-center space-x-4",adminAvatar:"h-12 w-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",adminText:"text-lg sm:text-xl md:text-2xl font-bold text-white",adminSubtext:"text-purple-100 text-sm sm:text-base md:text-lg",menuContainer:"relative admin-menu",menuButton:"flex items-center space-x-1 sm:space-x-2 bg-white/10 border-white/20 text-white hover:bg-white/20 font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm border-2",menuDropdown:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg z-50 overflow-hidden",menuItem:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-purple-50 transition-colors",menuItemLogout:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-red-50 transition-colors",cardContainer:"bg-white rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300",cardHeader:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-indigo-50",cardTitle:"text-xl font-bold text-gray-800",cardBody:"p-6",buttonGroup:"flex flex-wrap gap-3 mb-6",buttonPrimary:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200",buttonSecondary:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium px-4 py-2 rounded-lg transition-colors duration-200",formContainer:"bg-gray-50 rounded-lg p-6 border border-gray-200",formGrid:"grid grid-cols-1 md:grid-cols-2 gap-4",formGroup:"space-y-2",formLabel:"block text-sm font-medium text-gray-700",formInput:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors duration-200",formCheckbox:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded",formActions:"flex space-x-3 pt-4",table:"min-w-full divide-y divide-gray-200",tableHeader:"bg-gray-50",tableHeaderCell:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",tableBody:"bg-white divide-y divide-gray-200",tableRow:"hover:bg-gray-50 transition-colors duration-150",tableCell:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",statusActive:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",statusInactive:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",modalOverlay:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",modalContent:"bg-white rounded-lg p-6 w-full max-w-md mx-4 shadow-xl",modalTitle:"text-xl font-semibold text-gray-900 mb-4",modalActions:"flex space-x-3 pt-4"},Zte=()=>{const{user:e,isAdmin:t,logout:r}=Bn(),{get:n,post:s,delete:a}=zi(),i=C.useCallback(async()=>{try{y({type:"info",message:"Refreshing class summary view..."});const re=await s("/.netlify/functions/refresh-class-summary-semester",{});re&&(re.success||re.message)?y({type:"success",message:"Class summary view refreshed."}):y({type:"error",message:re?.error||"Failed to refresh view"})}catch(re){y({type:"error",message:"Failed to refresh view"}),console.error("Refresh class summary error:",re)}},[s]),l=C.useCallback(async()=>{try{y({type:"info",message:"Checking for overdue assignments..."});const re=await s("/.netlify/functions/check-overdue-assignments",{});if(re&&re.success){const de=re.overdue_count||0;de>0?y({type:"success",message:`Found and marked ${de} overdue assignments as inactive.`}):y({type:"info",message:"No overdue assignments found."})}else y({type:"error",message:re?.error||"Failed to check assignments"})}catch(re){y({type:"error",message:"Failed to check assignments"}),console.error("Check overdue assignments error:",re)}},[s]),[c,d]=C.useState(!1),[f,p]=C.useState(null),[g,y]=C.useState(null),[v,_]=C.useState(!1),[b,E]=C.useState(!1),[k,w]=C.useState(!1),[N,A]=C.useState(!1),[P,R]=C.useState(""),[T,D]=C.useState(null),[I,V]=C.useState({}),[X,Z]=C.useState(null),[ie,q]=C.useState({}),[ne,M]=C.useState(null),[W,L]=C.useState({}),[H,K]=C.useState([]),[B,z]=C.useState(""),[Q,Y]=C.useState(""),[te,ee]=C.useState(""),[ae,ge]=C.useState(!0),[_e,Me]=C.useState(!1),[ue,me]=C.useState([]),[He,qe]=C.useState(""),[Xe,Ve]=C.useState(""),[It,st]=C.useState(""),[Ie,je]=C.useState(!1),[Ze,bt]=C.useState(!1),[mt,$t]=C.useState([]),[Wt,lt]=C.useState([]),[Qe,yt]=C.useState([]),[ft,_t]=C.useState([]),[zt,Jt]=C.useState(!1),[De,ut]=C.useState(!1),[pt,Pt]=C.useState(!1),[Lt,sr]=C.useState(!1),[Te,ve]=C.useState({grade:"",class:"",number:"",student_id:"",name:"",surname:"",nickname:"",password:"",is_active:!0}),[fe,we]=C.useState({teacher_id:"",username:"",password:"",first_name:"",last_name:"",is_active:!0}),[Ue,St]=C.useState({subject_id:"",subject:"",description:"",is_active:!0}),[xt,Ht]=C.useState({startDate:"",endDate:"",teacherId:"",grades:[],classes:[],subjectId:""});C.useEffect(()=>{console.log("🔄 AdminCabinet component mounted - initializing..."),Ot()},[]),C.useEffect(()=>{const re=de=>{Ie&&!de.target.closest(".admin-menu")&&je(!1)};return document.addEventListener("mousedown",re),()=>{document.removeEventListener("mousedown",re)}},[Ie]);const Ot=C.useCallback(async()=>{try{d(!0),await fr(),console.log("Admin app initialized")}catch(re){p("Failed to initialize admin app"),console.error("Admin app initialization error:",re)}finally{d(!1)}},[]),Xt=C.useCallback(()=>{je(re=>!re)},[]),pr=C.useCallback(()=>{bt(!0),je(!1)},[]),Fr=C.useCallback(()=>{bt(!1)},[]),fr=C.useCallback(async()=>{try{await Promise.all([vr(),Mr(),sn(),le()])}catch(re){console.error("Error loading admin data:",re),p("Failed to load admin data")}},[]),vr=C.useCallback(async()=>{try{const re="admin_users_",de=jn(re);if(de){console.log("📊 Using cached users data"),$t(de);return}const Pe=await n("/.netlify/functions/get-all-users");console.log("📊 Users response:",Pe);const Je=Pe.users||[];$t(Je),Fn(re,Je,Dn.admin_users),console.log("👥 Users set to state:",Je)}catch(re){console.error("Error loading users:",re)}},[n]),Mr=C.useCallback(async()=>{try{const re="admin_teachers_",de=jn(re);if(de){console.log("📊 Using cached teachers data"),lt(de);return}const Pe=await n("/.netlify/functions/get-all-teachers");console.log("📊 Teachers response:",Pe);const Je=Pe.teachers||[];lt(Je),Fn(re,Je,Dn.admin_teachers),console.log("👨‍🏫 Teachers set to state:",Je)}catch(re){console.error("Error loading teachers:",re)}},[n]),sn=C.useCallback(async()=>{try{const re="admin_subjects_",de=jn(re);if(de){console.log("📊 Using cached subjects data"),yt(de);return}const Pe=await n("/.netlify/functions/get-all-subjects");console.log("📊 Subjects response:",Pe);const Je=Pe.subjects||[];yt(Je),Fn(re,Je,Dn.admin_subjects),console.log("📚 Subjects set to state:",Je)}catch(re){console.error("Error loading subjects:",re)}},[n]),le=C.useCallback(async()=>{try{const re="admin_academic_years_",de=jn(re);if(de){console.log("📊 Using cached academic years data"),_t(de);return}const Je=(await n("/.netlify/functions/get-academic-year")).academic_years||[];_t(Je),Fn(re,Je,Dn.admin_academic_years)}catch(re){console.error("Error loading academic year:",re)}},[n]),be=C.useCallback(async()=>{try{if(A(!N),!N){const[re,de]=await Promise.all([n("/.netlify/functions/get-all-tests"),n("/.netlify/functions/get-test-assignments")]);console.log("📊 Active tests response:",re),console.log("📊 Assignments response:",de);const Pe=re.tests||[],gr=(de.assignments||[]).reduce((Or,Dr)=>{const Xr=`${Dr.test_type}-${Dr.test_id}`;return Or[Xr]||(Or[Xr]=[]),Or[Xr].push(Dr),Or},{}),or=Pe.map(Or=>{const Dr=`${Or.test_type}-${Or.test_id}`,Xr=gr[Dr]||[],Zr=Xr.some(dr=>dr.is_active);return{...Or,is_active:Zr,assignments:Xr}});K(or),console.log("🧪 All tests with status set to state:",or)}}catch(re){console.error("Error loading tests:",re),y({type:"error",message:"Failed to load tests"})}},[n,N]),pe=C.useCallback((re,de)=>{ve(Pe=>({...Pe,[re]:de}))},[]),xe=C.useCallback((re,de)=>{we(Pe=>({...Pe,[re]:de}))},[]),Se=C.useCallback((re,de)=>{St(Pe=>({...Pe,[re]:de}))},[]);C.useCallback(()=>{console.log("🧪 Testing local storage...");try{const re={test:"data",timestamp:Date.now()};localStorage.setItem("test",JSON.stringify(re));const de=JSON.parse(localStorage.getItem("test"));console.log("✅ Local storage test successful:",de),y({type:"success",message:"Local storage test successful"})}catch(re){console.error("❌ Local storage test failed:",re),y({type:"error",message:"Local storage test failed"})}},[]),C.useCallback(()=>{console.log("🧹 Clearing local storage...");try{localStorage.clear(),console.log("✅ Local storage cleared"),y({type:"success",message:"Local storage cleared"})}catch(re){console.error("❌ Error clearing local storage:",re),y({type:"error",message:"Error clearing local storage"})}},[]),C.useCallback(async()=>{console.log("👨‍🏫 Checking teacher subjects...");try{const de=(await n("/.netlify/functions/get-all-teachers")).data||[];console.log("📊 Teachers data:",de),y({type:"success",message:`Found ${de.length} teachers`})}catch(re){console.error("❌ Error checking teacher subjects:",re),y({type:"error",message:"Error checking teacher subjects"})}},[n]);const ke=C.useCallback(async re=>{re.preventDefault();try{console.log("👤 Submitting user:",Te);const de=await s("/.netlify/functions/add-user",Te);de.success?(y({type:"success",message:"User added successfully"}),Jt(!1),ve({grade:"",class:"",number:"",student_id:"",name:"",surname:"",nickname:"",password:"",is_active:!0}),vr()):y({type:"error",message:de.message||"Failed to add user"})}catch(de){console.error("❌ Error adding user:",de),y({type:"error",message:"Error adding user"})}},[Te,s,vr]),$e=C.useCallback(async re=>{re.preventDefault();try{console.log("👨‍🏫 Submitting teacher:",fe);const de=await s("/.netlify/functions/add-teacher",fe);de.success?(y({type:"success",message:"Teacher added successfully"}),ut(!1),we({teacher_id:"",username:"",password:"",first_name:"",last_name:"",is_active:!0}),Mr()):y({type:"error",message:de.message||"Failed to add teacher"})}catch(de){console.error("❌ Error adding teacher:",de),y({type:"error",message:"Error adding teacher"})}},[fe,s,Mr]),ht=C.useCallback(async re=>{re.preventDefault();try{console.log("📚 Submitting subject:",Ue);const de=await s("/.netlify/functions/add-subject",Ue);de.success?(y({type:"success",message:"Subject added successfully"}),Pt(!1),St({subject_id:"",subject:"",description:"",is_active:!0}),sn()):y({type:"error",message:de.message||"Failed to add subject"})}catch(de){console.error("❌ Error adding subject:",de),y({type:"error",message:"Error adding subject"})}},[Ue,s,sn]),Ke=C.useCallback(re=>{D(re),V({name:re.name||"",surname:re.surname||"",grade:re.grade||"",class:re.class||"",student_id:re.student_id||"",nickname:re.nickname||"",password:re.password||"",is_active:re.is_active!==void 0?re.is_active:!0})},[]),oe=C.useCallback(async()=>{try{const re=[];Object.keys(I).forEach(de=>{de!=="student_id"&&I[de]!==T[de]&&re.push({fieldName:de,newValue:I[de]})});for(const de of re)await s("/.netlify/functions/update-user",{userId:T.student_id,fieldName:de.fieldName,newValue:de.newValue});y({type:"success",message:"User updated successfully!"}),D(null),V({}),vr()}catch{y({type:"error",message:"Failed to update user"})}},[I,T,s,vr]),he=C.useCallback(async re=>{if(window.confirm("Are you sure you want to delete this user?"))try{(await s("/.netlify/functions/delete-user",{userId:re})).success&&(y({type:"success",message:"User deleted successfully!"}),vr())}catch{y({type:"error",message:"Failed to delete user"})}},[s,vr]),Ce=C.useCallback(re=>{Z(re),q({teacher_id:re.teacher_id||"",username:re.username||"",password:re.password||"",first_name:re.first_name||"",last_name:re.last_name||"",is_active:re.is_active!==void 0?re.is_active:!0})},[]),Ne=C.useCallback(async()=>{try{const re=[];Object.keys(ie).forEach(de=>{de!=="teacher_id"&&ie[de]!==X[de]&&re.push({fieldName:de,newValue:ie[de]})});for(const de of re)await s("/.netlify/functions/update-teacher",{teacherId:X.teacher_id,fieldName:de.fieldName,newValue:de.newValue});y({type:"success",message:"Teacher updated successfully!"}),Z(null),q({}),Mr()}catch{y({type:"error",message:"Failed to update teacher"})}},[ie,X,s,Mr]),Ge=C.useCallback(async re=>{if(window.confirm("Are you sure you want to delete this teacher?"))try{(await s("/.netlify/functions/delete-teacher",{teacherId:re})).success&&(y({type:"success",message:"Teacher deleted successfully!"}),Mr())}catch{y({type:"error",message:"Failed to delete teacher"})}},[s,Mr]),ot=C.useCallback(re=>{M(re),L({subject_id:re.subject_id||"",subject:re.subject||""})},[]),Le=C.useCallback(async()=>{try{const re=[];Object.keys(W).forEach(de=>{de!=="subject_id"&&W[de]!==ne[de]&&re.push({fieldName:de,newValue:W[de]})});for(const de of re)await s("/.netlify/functions/update-subject",{subjectId:ne.subject_id,fieldName:de.fieldName,newValue:de.newValue});y({type:"success",message:"Subject updated successfully!"}),M(null),L({}),sn()}catch{y({type:"error",message:"Failed to update subject"})}},[W,ne,s,sn]),Et=C.useCallback(async re=>{if(window.confirm("Are you sure you want to delete this subject?"))try{const de=await s("/.netlify/functions/delete-subject",{subjectId:re});de.success?(y({type:"success",message:"Subject deleted successfully!"}),sn()):y({type:"error",message:de.message||"Failed to delete subject"})}catch{y({type:"error",message:"Failed to delete subject"})}},[s,sn]),Bt=C.useCallback((re,de)=>{Ht(Pe=>({...Pe,[re]:de}))},[]),Yt=C.useCallback(async re=>{if(re.preventDefault(),!xt.startDate||!xt.endDate||!xt.teacherId){y({type:"error",message:"Please fill in all required fields (Start Date, End Date, Teacher ID)"});return}if(window.confirm("Are you sure you want to delete all test data for the selected criteria? This action cannot be undone."))try{const de=await s("/.netlify/functions/delete-test-data",xt);de.success?(y({type:"success",message:`Successfully deleted ${de.deletedCount} test records!`}),sr(!1),Ht({startDate:"",endDate:"",teacherId:"",grades:[],classes:[],subjectId:""})):y({type:"error",message:de.message||"Failed to delete test data"})}catch{y({type:"error",message:"Failed to delete test data"})}},[xt,s]),Fe=C.useCallback(async(re,de,Pe)=>{try{const Je=await n("/.netlify/functions/get-test-assignments");if(Je.success&&Je.assignments){const gr=Je.assignments.filter(or=>or.test_id===parseInt(re)&&or.test_type===de);if(gr.length===0){y({type:"error",message:"No assignments found for this test"});return}for(const or of gr){const Or=await s("/.netlify/functions/remove-assignment",{teacher_id:Pe,assignment_id:or.assignment_id,test_type:de,test_id:re});if(!Or.success){y({type:"error",message:`Failed to complete test: ${Or.message}`});return}}y({type:"success",message:"Test marked as complete successfully!"}),await be()}else y({type:"error",message:"Failed to get test assignments"})}catch(Je){console.error("Error completing test:",Je),y({type:"error",message:"Failed to complete test"})}},[s,n,be]),We=C.useCallback(async(re,de,Pe)=>{try{const Je=await n("/.netlify/functions/get-test-assignments");if(Je.success&&Je.assignments){const gr=Je.assignments.filter(or=>or.test_id===parseInt(re)&&or.test_type===de);if(gr.length===0){y({type:"error",message:"No assignments found for this test"});return}for(const or of gr){const Or=await s("/.netlify/functions/remove-assignment",{teacher_id:Pe,assignment_id:or.assignment_id,test_type:de,test_id:re,mark_active:!0});if(!Or.success){y({type:"error",message:`Failed to reactivate test: ${Or.message}`});return}}y({type:"success",message:"Test marked as active successfully!"}),await be()}else y({type:"error",message:"Failed to get test assignments"})}catch(Je){console.error("Error reactivating test:",Je),y({type:"error",message:"Failed to reactivate test"})}},[s,n,be]),Ct=C.useCallback(async()=>{try{if(Me(!_e),!_e){const re=await n("/.netlify/functions/get-all-tests");console.log("📊 Actual tests response:",re),me(re.tests||[]),console.log("🧪 Actual tests set to state:",re.tests||[])}}catch(re){console.error("Error loading actual tests:",re),y({type:"error",message:"Failed to load tests"})}},[n,_e]),at=C.useCallback(async(re,de,Pe)=>{try{const Je=await s("/.netlify/functions/delete-test",{test_id:re,test_type:de,teacher_id:Pe});Je.success?(y({type:"success",message:"Test deleted successfully!"}),await Ct()):y({type:"error",message:`Failed to delete test: ${Je.message}`})}catch(Je){console.error("Error deleting test:",Je),y({type:"error",message:"Failed to delete test"})}},[s,Ct]),Qt=P?mt.filter(re=>re.grade.toString()===P):mt,tt=H.filter(re=>{const de=!B||re.teacher_id===B,Pe=!Q||new Date(re.created_at)>=new Date(Q),Je=!te||new Date(re.created_at)<=new Date(te+"T23:59:59"),gr=ae?re.is_active:!re.is_active;return de&&Pe&&Je&&gr}),jt=ue.filter(re=>{const de=!He||re.teacher_id===He,Pe=!Xe||new Date(re.created_at)>=new Date(Xe),Je=!It||new Date(re.created_at)<=new Date(It+"T23:59:59");return de&&Pe&&Je});return o.jsxs(et.div,{id:"admin-cabinet-main",className:Ae.container,initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[o.jsx(et.div,{className:Ae.header,initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},children:o.jsx("div",{className:Ae.headerContent,children:o.jsxs("div",{className:Ae.headerFlex,children:[o.jsxs(et.div,{className:Ae.adminInfo,initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2,duration:.5},children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(et.div,{className:Ae.adminAvatar,initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.3,type:"spring"},whileHover:{scale:1.1},children:o.jsx("span",{className:"text-white font-semibold text-xl",children:e?.username?.charAt(0)||"A"})})}),o.jsxs("div",{children:[o.jsx("h1",{className:Ae.adminText,children:e?.username||"Administrator"}),o.jsx("p",{className:Ae.adminSubtext,children:"Administrator Dashboard"})]})]}),o.jsxs(et.div,{className:Ae.menuContainer,initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3,duration:.5},children:[o.jsxs("button",{onClick:Xt,className:Ae.menuButton,style:{zIndex:1e3},children:[o.jsx("span",{className:"hidden sm:inline",children:"Menu"}),o.jsx(et.svg,{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:{rotate:Ie?180:0},transition:{duration:.2},children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]}),o.jsx(_i,{children:Ie&&o.jsx(et.div,{className:Ae.menuDropdown,initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},children:o.jsxs("div",{className:"py-2",children:[o.jsx(et.button,{onClick:pr,className:Ae.menuItem,whileHover:{x:4},transition:{duration:.2},children:"Change Password"}),o.jsx(et.button,{onClick:()=>{Xt(),r()},className:Ae.menuItemLogout,whileHover:{x:4},transition:{duration:.2},children:"Logout"})]})})})]})]})})}),c&&o.jsx(jr,{text:"Loading..."}),f&&o.jsx(Ko,{type:"error",message:f,onClose:()=>p(null)}),g&&o.jsx(Ko,{type:g.type,message:g.message,onClose:()=>y(null)}),Ze&&o.jsx("div",{className:Ae.modalOverlay,children:o.jsxs("div",{className:Ae.modalContent,children:[o.jsx("h2",{className:Ae.modalTitle,children:"Change Password"}),o.jsxs("form",{className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{htmlFor:"currentPassword",className:Ae.formLabel,children:"Current Password"}),o.jsx("input",{type:"password",id:"currentPassword",className:Ae.formInput})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{htmlFor:"newPassword",className:Ae.formLabel,children:"New Password"}),o.jsx("input",{type:"password",id:"newPassword",className:Ae.formInput})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{htmlFor:"confirmPassword",className:Ae.formLabel,children:"Confirm New Password"}),o.jsx("input",{type:"password",id:"confirmPassword",className:Ae.formInput})]}),o.jsxs("div",{className:Ae.modalActions,children:[o.jsx(nt,{type:"button",variant:"secondary",onClick:Fr,className:"flex-1",children:"Cancel"}),o.jsx(nt,{type:"submit",variant:"primary",className:"flex-1 bg-purple-600 hover:bg-purple-700",children:"Change Password"})]})]})]})}),o.jsx(et.div,{className:Ae.mainContainer,initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.5},children:o.jsxs("div",{className:"space-y-6",children:[o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"User Management"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsxs("div",{className:Ae.buttonGroup,children:[o.jsx(nt,{variant:"primary",onClick:()=>Jt(!0),className:Ae.buttonPrimary,children:"Add User"}),o.jsx(nt,{variant:"secondary",onClick:()=>{vr(),_(!v)},className:Ae.buttonSecondary,children:v?"Hide Users Table":"Get All Users ▶"})]}),o.jsx(_i,{children:zt&&o.jsxs(et.div,{className:Ae.formContainer,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Add New User"}),o.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGrid,children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Grade"}),o.jsx("input",{type:"text",value:Te.grade,onChange:re=>pe("grade",re.target.value),className:Ae.formInput,placeholder:"Enter grade"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Class"}),o.jsx("input",{type:"text",value:Te.class,onChange:re=>pe("class",re.target.value),className:Ae.formInput,placeholder:"Enter class"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Number"}),o.jsx("input",{type:"text",value:Te.number,onChange:re=>pe("number",re.target.value),className:Ae.formInput,placeholder:"Enter number"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Student ID"}),o.jsx("input",{type:"text",value:Te.student_id,onChange:re=>pe("student_id",re.target.value),className:Ae.formInput,placeholder:"Enter student ID"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Name"}),o.jsx("input",{type:"text",value:Te.name,onChange:re=>pe("name",re.target.value),className:Ae.formInput,placeholder:"Enter name"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Surname"}),o.jsx("input",{type:"text",value:Te.surname,onChange:re=>pe("surname",re.target.value),className:Ae.formInput,placeholder:"Enter surname"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Nickname"}),o.jsx("input",{type:"text",value:Te.nickname,onChange:re=>pe("nickname",re.target.value),className:Ae.formInput,placeholder:"Enter nickname"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Password"}),o.jsx("input",{type:"password",value:Te.password,onChange:re=>pe("password",re.target.value),className:Ae.formInput,placeholder:"Enter password"})]})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"userActive",checked:Te.is_active,onChange:re=>pe("is_active",re.target.checked),className:Ae.formCheckbox}),o.jsx("label",{htmlFor:"userActive",className:"ml-2 text-sm text-gray-700",children:"Active"})]}),o.jsxs("div",{className:Ae.formActions,children:[o.jsx(nt,{type:"button",variant:"secondary",onClick:()=>Jt(!1),className:Ae.buttonSecondary,children:"Cancel"}),o.jsx(nt,{type:"submit",variant:"primary",className:Ae.buttonPrimary,children:"Add User"})]})]})]})}),v&&o.jsxs("div",{className:"mt-6",children:[o.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:["All Users (",Qt.length," of ",mt.length,")"]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Filter by Grade:"}),o.jsxs("select",{value:P,onChange:re=>R(re.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[o.jsx("option",{value:"",children:"All Grades"}),[...new Set(mt.map(re=>re.grade))].sort().map(re=>o.jsxs("option",{value:re,children:["Grade ",re]},re))]})]})]}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Grade"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Class"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Student ID"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Number"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Nickname"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:Qt.map((re,de)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsxs("td",{className:Ae.tableCell,children:[re.name," ",re.surname]}),o.jsx("td",{className:Ae.tableCell,children:re.grade}),o.jsx("td",{className:Ae.tableCell,children:re.class}),o.jsx("td",{className:Ae.tableCell,children:re.student_id}),o.jsx("td",{className:Ae.tableCell,children:re.number}),o.jsx("td",{className:Ae.tableCell,children:re.nickname}),o.jsx("td",{className:Ae.tableCell,children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>Ke(re),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),o.jsx("button",{onClick:()=>he(re.student_id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Delete"})]})})]},re.id||de))})]})})})]})]})]})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsxs(kt.Header,{className:Ae.cardHeader,children:[o.jsx(kt.Title,{className:Ae.cardTitle,children:"Teacher Management"}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-xs whitespace-nowrap",title:"Refresh materialized class summary view",children:"Refresh Class Summary View"}),o.jsx("button",{onClick:l,className:"px-3 py-1.5 bg-orange-600 text-white rounded hover:bg-orange-700 transition-colors text-xs whitespace-nowrap",title:"Check and mark overdue assignments (7+ days old) as inactive",children:"Check Overdue Assignments"}),o.jsx(nt,{variant:"primary",onClick:()=>ut(!0),className:"text-xs whitespace-nowrap",children:"Add Teacher"}),o.jsx(nt,{variant:"secondary",onClick:()=>{Mr(),E(!b)},className:"text-xs whitespace-nowrap",children:b?"Hide Teachers Table":"Get All Teachers ▶"})]})]}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsx(_i,{children:De&&o.jsxs(et.div,{className:Ae.formContainer,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Add New Teacher"}),o.jsxs("form",{onSubmit:$e,className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGrid,children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Teacher ID"}),o.jsx("input",{type:"text",value:fe.teacher_id,onChange:re=>xe("teacher_id",re.target.value),className:Ae.formInput,placeholder:"Enter teacher ID"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Username"}),o.jsx("input",{type:"text",value:fe.username,onChange:re=>xe("username",re.target.value),className:Ae.formInput,placeholder:"Enter username"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Password"}),o.jsx("input",{type:"password",value:fe.password,onChange:re=>xe("password",re.target.value),className:Ae.formInput,placeholder:"Enter password"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"First Name"}),o.jsx("input",{type:"text",value:fe.first_name,onChange:re=>xe("first_name",re.target.value),className:Ae.formInput,placeholder:"Enter first name"})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Last Name"}),o.jsx("input",{type:"text",value:fe.last_name,onChange:re=>xe("last_name",re.target.value),className:Ae.formInput,placeholder:"Enter last name"})]})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"teacherActive",checked:fe.is_active,onChange:re=>xe("is_active",re.target.checked),className:Ae.formCheckbox}),o.jsx("label",{htmlFor:"teacherActive",className:"ml-2 text-sm text-gray-700",children:"Active"})]}),o.jsxs("div",{className:Ae.formActions,children:[o.jsx(nt,{type:"button",variant:"secondary",onClick:()=>ut(!1),className:Ae.buttonSecondary,children:"Cancel"}),o.jsx(nt,{type:"submit",variant:"primary",className:Ae.buttonPrimary,children:"Add Teacher"})]})]})]})}),T&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Edit User"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),o.jsx("input",{type:"text",value:I.name,onChange:re=>V({...I,name:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Surname"}),o.jsx("input",{type:"text",value:I.surname,onChange:re=>V({...I,surname:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Grade"}),o.jsx("input",{type:"number",value:I.grade,onChange:re=>V({...I,grade:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class"}),o.jsx("input",{type:"number",value:I.class,onChange:re=>V({...I,class:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student ID"}),o.jsx("input",{type:"text",value:I.student_id,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500 cursor-not-allowed"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Student ID cannot be changed"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nickname"}),o.jsx("input",{type:"text",value:I.nickname,onChange:re=>V({...I,nickname:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),o.jsx("input",{type:"text",value:I.password,onChange:re=>V({...I,password:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"is_active",checked:I.is_active,onChange:re=>V({...I,is_active:re.target.checked}),className:"h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),o.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm font-medium text-gray-700",children:"Active"})]})]}),o.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[o.jsx("button",{onClick:()=>{D(null),V({})},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),o.jsx("button",{onClick:oe,className:"px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-md hover:bg-purple-700",children:"Update User"})]})]})}),b&&o.jsxs("div",{className:"mt-6",children:[o.jsx("div",{className:"mb-4",children:o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:["All Teachers (",Wt.length,")"]})}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-96",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Teacher ID"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Username"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Password"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Status"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Created"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:Wt.map((re,de)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsx("td",{className:Ae.tableCell,children:re.teacher_id}),o.jsxs("td",{className:Ae.tableCell,children:[re.first_name," ",re.last_name]}),o.jsx("td",{className:Ae.tableCell,children:re.username}),o.jsx("td",{className:Ae.tableCell,children:re.password}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("span",{className:re.is_active?Ae.statusActive:Ae.statusInactive,children:re.is_active?"Active":"Inactive"})}),o.jsx("td",{className:Ae.tableCell,children:new Date(re.created_at).toLocaleDateString()}),o.jsx("td",{className:Ae.tableCell,children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>Ce(re),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),o.jsx("button",{onClick:()=>Ge(re.teacher_id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Delete"})]})})]},re.teacher_id||de))})]})})})]})]})]})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Subject Management"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsxs("div",{className:Ae.buttonGroup,children:[o.jsx(nt,{variant:"primary",onClick:()=>Pt(!0),className:Ae.buttonPrimary,children:"Add Subject"}),o.jsx(nt,{variant:"secondary",onClick:()=>{sn(),w(!k)},className:Ae.buttonSecondary,children:k?"Hide Subjects Table":"Get All Subjects ▶"})]}),o.jsx(_i,{children:pt&&o.jsxs(et.div,{className:Ae.formContainer,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Add New Subject"}),o.jsxs("form",{onSubmit:ht,className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Subject Name"}),o.jsx("input",{type:"text",value:Ue.subject,onChange:re=>Se("subject",re.target.value),className:Ae.formInput,placeholder:"Enter subject name",required:!0}),o.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Subject ID will be automatically generated"})]}),o.jsxs("div",{className:Ae.formActions,children:[o.jsx(nt,{type:"button",variant:"secondary",onClick:()=>Pt(!1),className:Ae.buttonSecondary,children:"Cancel"}),o.jsx(nt,{type:"submit",variant:"primary",className:Ae.buttonPrimary,children:"Add Subject"})]})]})]})}),X&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Edit Teacher"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teacher ID"}),o.jsx("input",{type:"text",value:ie.teacher_id,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500 cursor-not-allowed"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Teacher ID cannot be changed"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),o.jsx("input",{type:"text",value:ie.username,onChange:re=>q({...ie,username:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),o.jsx("input",{type:"text",value:ie.password,onChange:re=>q({...ie,password:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),o.jsx("input",{type:"text",value:ie.first_name,onChange:re=>q({...ie,first_name:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),o.jsx("input",{type:"text",value:ie.last_name,onChange:re=>q({...ie,last_name:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"teacher_is_active",checked:ie.is_active,onChange:re=>q({...ie,is_active:re.target.checked}),className:"h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),o.jsx("label",{htmlFor:"teacher_is_active",className:"ml-2 text-sm font-medium text-gray-700",children:"Active"})]})]}),o.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[o.jsx("button",{onClick:()=>{Z(null),q({})},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),o.jsx("button",{onClick:Ne,className:"px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-md hover:bg-purple-700",children:"Update Teacher"})]})]})}),ne&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Edit Subject"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject ID"}),o.jsx("input",{type:"text",value:W.subject_id,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500 cursor-not-allowed"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Subject ID cannot be changed"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject Name"}),o.jsx("input",{type:"text",value:W.subject,onChange:re=>L({...W,subject:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]})]}),o.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[o.jsx("button",{onClick:()=>M(null),className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),o.jsx("button",{onClick:Le,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:"Update Subject"})]})]})}),k&&o.jsxs("div",{className:"mt-6",children:[o.jsx("div",{className:"mb-4",children:o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:["All Subjects (",Qe.length,")"]})}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-96",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Subject ID"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Subject Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:Qe.map((re,de)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsx("td",{className:Ae.tableCell,children:re.subject_id}),o.jsx("td",{className:Ae.tableCell,children:re.subject}),o.jsx("td",{className:Ae.tableCell,children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>ot(re),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),o.jsx("button",{onClick:()=>Et(re.subject_id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Delete"})]})})]},re.subject_id||de))})]})})})]})]})]})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Test Data Deletion"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsx("div",{className:Ae.buttonGroup,children:o.jsx(nt,{variant:"danger",onClick:()=>sr(!0),className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 shadow-md",children:"Delete Test Data"})}),o.jsx(_i,{children:Lt&&o.jsxs(et.div,{className:Ae.formContainer,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Delete Test Data by Date Range"}),o.jsxs("form",{onSubmit:Yt,className:"space-y-4",children:[o.jsxs("div",{className:Ae.formGrid,children:[o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Start Date *"}),o.jsx("input",{type:"date",value:xt.startDate,onChange:re=>Bt("startDate",re.target.value),className:Ae.formInput,required:!0})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"End Date *"}),o.jsx("input",{type:"date",value:xt.endDate,onChange:re=>Bt("endDate",re.target.value),className:Ae.formInput,required:!0})]})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Teacher ID *"}),o.jsxs("select",{value:xt.teacherId,onChange:re=>Bt("teacherId",re.target.value),className:Ae.formInput,required:!0,children:[o.jsx("option",{value:"",children:"Select a teacher"}),Wt.map(re=>o.jsxs("option",{value:re.teacher_id,children:[re.teacher_id," - ",re.first_name," ",re.last_name]},re.teacher_id))]})]}),o.jsxs("div",{className:Ae.formGroup,children:[o.jsx("label",{className:Ae.formLabel,children:"Subject (Optional)"}),o.jsxs("select",{value:xt.subjectId,onChange:re=>Bt("subjectId",re.target.value),className:Ae.formInput,children:[o.jsx("option",{value:"",children:"All subjects"}),Qe.map(re=>o.jsx("option",{value:re.subject_id,children:re.subject},re.subject_id))]})]}),o.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:o.jsxs("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),o.jsxs("div",{className:"ml-3",children:[o.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Warning: This action cannot be undone"}),o.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[o.jsx("p",{children:"This will permanently delete:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"All test records within the date range"}),o.jsx("li",{children:"All test questions and answers"}),o.jsx("li",{children:"All test results and submissions"}),o.jsx("li",{children:"All test assignments"}),o.jsx("li",{children:"Associated Cloudinary images (for matching tests)"})]})]})]})]})}),o.jsxs("div",{className:Ae.formActions,children:[o.jsx(nt,{type:"button",variant:"secondary",onClick:()=>sr(!1),className:Ae.buttonSecondary,children:"Cancel"}),o.jsx(nt,{type:"submit",variant:"danger",className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 shadow-md",children:"Delete Test Data"})]})]})]})})]})]})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.85,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Assignments Management"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsx("div",{className:"mb-4",children:o.jsx(nt,{variant:"primary",onClick:be,className:Ae.buttonPrimary,children:N?"Hide Assignments Table":"Get All Assignments ▶"})}),N&&o.jsx("div",{className:"mb-6",children:o.jsx("div",{className:"border-b border-gray-200",children:o.jsxs("nav",{className:"-mb-px flex space-x-8",children:[o.jsx("button",{onClick:()=>ge(!0),className:`py-2 px-1 border-b-2 font-medium text-sm ${ae?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Active Assignments"}),o.jsx("button",{onClick:()=>ge(!1),className:`py-2 px-1 border-b-2 font-medium text-sm ${ae?"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":"border-purple-500 text-purple-600"}`,children:"Inactive Assignments"})]})})}),N&&o.jsxs("div",{className:"mt-6",children:[o.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:[ae?"Active":"Inactive"," Assignments (",tt.length," of ",H.filter(re=>ae?re.is_active:!re.is_active).length,")"]}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsxs("select",{value:B,onChange:re=>z(re.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[o.jsx("option",{value:"",children:"All Teachers"}),Wt.map(re=>o.jsxs("option",{value:re.teacher_id,children:[re.first_name," ",re.last_name]},re.teacher_id))]}),o.jsx("input",{type:"date",value:Q,onChange:re=>Y(re.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Start Date"}),o.jsx("input",{type:"date",value:te,onChange:re=>ee(re.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"End Date"})]})]}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-96",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Test Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Type"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Teacher"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Questions"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Created"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:tt.map((re,de)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsx("td",{className:Ae.tableCell,children:re.test_name}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:re.test_type.replace("_"," ").toUpperCase()})}),o.jsx("td",{className:Ae.tableCell,children:re.teacher_name}),o.jsx("td",{className:Ae.tableCell,children:re.num_questions}),o.jsx("td",{className:Ae.tableCell,children:new Date(re.created_at).toLocaleDateString()}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("div",{className:"flex space-x-2",children:ae?o.jsx("button",{onClick:()=>Fe(re.test_id,re.test_type,re.teacher_id),className:"text-sm font-medium px-3 py-1 rounded bg-orange-100 text-orange-700 hover:bg-orange-200",children:"Mark Complete"}):o.jsx("button",{onClick:()=>We(re.test_id,re.test_type,re.teacher_id),className:"text-sm font-medium px-3 py-1 rounded bg-green-100 text-green-700 hover:bg-green-200",children:"Mark Active"})})})]},`${re.test_type}-${re.test_id}-${de}`))})]})})})]})]})]})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Test Management"})}),o.jsxs(kt.Body,{className:Ae.cardBody,children:[o.jsx("div",{className:"mb-4",children:o.jsx(nt,{variant:"primary",onClick:Ct,className:Ae.buttonPrimary,children:_e?"Hide Tests Table":"Get All Tests ▶"})}),_e&&o.jsxs("div",{className:"mt-6",children:[o.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:["All Tests (",jt.length," of ",ue.length,")"]}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsxs("select",{value:He,onChange:re=>qe(re.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[o.jsx("option",{value:"",children:"All Teachers"}),Wt.map(re=>o.jsxs("option",{value:re.teacher_id,children:[re.first_name," ",re.last_name]},re.teacher_id))]}),o.jsx("input",{type:"date",value:Xe,onChange:re=>Ve(re.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Start Date"}),o.jsx("input",{type:"date",value:It,onChange:re=>st(re.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"End Date"})]})]}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto max-h-96",children:o.jsxs("table",{className:Ae.table,children:[o.jsx("thead",{className:Ae.tableHeader,children:o.jsxs("tr",{children:[o.jsx("th",{className:Ae.tableHeaderCell,children:"Test Name"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Type"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Teacher"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Questions"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Created"}),o.jsx("th",{className:Ae.tableHeaderCell,children:"Actions"})]})}),o.jsx("tbody",{className:Ae.tableBody,children:jt.map((re,de)=>o.jsxs("tr",{className:Ae.tableRow,children:[o.jsx("td",{className:Ae.tableCell,children:re.test_name}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:re.test_type.replace("_"," ").toUpperCase()})}),o.jsx("td",{className:Ae.tableCell,children:re.teacher_name}),o.jsx("td",{className:Ae.tableCell,children:re.num_questions}),o.jsx("td",{className:Ae.tableCell,children:new Date(re.created_at).toLocaleDateString()}),o.jsx("td",{className:Ae.tableCell,children:o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{onClick:()=>at(re.test_id,re.test_type,re.teacher_id),className:"text-sm font-medium px-3 py-1 rounded bg-red-100 text-red-700 hover:bg-red-200",children:"Delete Test"})})})]},`${re.test_type}-${re.test_id}-${de}`))})]})})})]})]})]})}),o.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9,duration:.5},children:o.jsxs(kt,{className:Ae.cardContainer,children:[o.jsx(kt.Header,{className:Ae.cardHeader,children:o.jsx(kt.Title,{className:Ae.cardTitle,children:"Debug & Testing"})}),o.jsx(kt.Body,{className:Ae.cardBody})]})})]})})]})},ere=()=>{const{isAdmin:e,getCurrentAdminId:t,logout:r}=Bn(),{get:n}=zi(),{showNotification:s}=ka();C.useEffect(()=>{a()},[]);const a=C.useCallback(async()=>{if(console.log("👨‍💼 Initializing Admin Application..."),!e()){console.error("❌ User is not an admin, redirecting to login"),s("Access Denied: You are not an administrator.","error"),r();return}try{i(),await l(),c(),d(),console.log("✅ Admin Application initialized successfully"),s("Admin dashboard loaded successfully","success")}catch(f){console.error("❌ Error initializing admin app:",f),s("Failed to initialize admin dashboard","error")}},[e,t,r,s,n]),i=C.useCallback(()=>{console.log("🔧 Initializing global event listeners...");const f=p=>{p.ctrlKey&&p.key==="k"&&(p.preventDefault(),console.log("Admin search shortcut triggered"))};return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[]),l=C.useCallback(async()=>{try{console.log("📊 Loading admin data...");const[f,p,g,y]=await Promise.allSettled([n("/.netlify/functions/get-all-users"),n("/.netlify/functions/get-all-teachers"),n("/.netlify/functions/get-all-subjects"),n("/.netlify/functions/get-academic-year")]);f.status==="fulfilled"&&f.value?.success&&console.log("✅ Users loaded:",f.value.users?.length||0),p.status==="fulfilled"&&p.value?.success&&console.log("✅ Teachers loaded:",p.value.teachers?.length||0),g.status==="fulfilled"&&g.value?.success&&console.log("✅ Subjects loaded:",g.value.subjects?.length||0),y.status==="fulfilled"&&y.value?.success&&console.log("✅ Academic years loaded:",y.value.academic_years?.length||0),console.log("✅ Admin data loading completed")}catch(f){throw console.error("❌ Error loading admin data:",f),f}},[n]),c=C.useCallback(()=>{console.log("🗑️ Initializing test deletion functionality..."),console.log("✅ Test deletion functionality initialized")},[]),d=C.useCallback(()=>{console.log("🌐 Exposing admin functions globally..."),window.toggleSubjectsContent=()=>{const p=document.getElementById("allSubjectsContainer"),g=document.querySelector('button[onclick="toggleSubjectsContent()"]');if(!p){console.error("❌ allSubjectsContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Subjects":"Hide Subjects"},window.showAddSubjectForm=()=>{const p=document.getElementById("addSubjectForm");p&&(p.style.display="block")},window.hideAddSubjectForm=()=>{const p=document.getElementById("addSubjectForm"),g=document.getElementById("newSubjectForm");p&&(p.style.display="none"),g&&g.reset()},window.showAddAcademicYearForm=()=>{const p=document.getElementById("addAcademicYearForm");p&&(p.style.display="block")},window.hideAddAcademicYearForm=()=>{const p=document.getElementById("addAcademicYearForm"),g=document.getElementById("newAcademicYearForm");p&&(p.style.display="none"),g&&g.reset()},window.toggleUsersContent=()=>{const p=document.getElementById("allUsersContainer"),g=document.querySelector('button[onclick="toggleUsersContent()"]');if(!p){console.error("❌ allUsersContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Users":"Hide Users"},window.showAddUserForm=()=>{const p=document.getElementById("addUserForm");p&&(p.style.display="block")},window.hideAddUserForm=()=>{const p=document.getElementById("addUserForm"),g=document.getElementById("newUserForm");p&&(p.style.display="none"),g&&g.reset()},window.showAddTeacherForm=()=>{const p=document.getElementById("addTeacherForm");p&&(p.style.display="block")},window.hideAddTeacherForm=()=>{const p=document.getElementById("addTeacherForm"),g=document.getElementById("newTeacherForm");p&&(p.style.display="none"),g&&g.reset()},window.toggleTeachersContent=()=>{const p=document.getElementById("allTeachersContainer"),g=document.querySelector('button[onclick="toggleTeachersContent()"]');if(!p){console.error("❌ allTeachersContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Teachers":"Hide Teachers"},window.toggleTestsContent=()=>{const p=document.getElementById("allTestsContainer"),g=document.querySelector('button[onclick="toggleTestsContent()"]');if(!p){console.error("❌ allTestsContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Tests":"Hide Tests"},window.toggleAssignmentsContent=()=>{const p=document.getElementById("allAssignmentsContainer"),g=document.querySelector('button[onclick="toggleAssignmentsContent()"]');if(!p){console.error("❌ allAssignmentsContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Assignments":"Hide Assignments"},window.toggleResultsContent=()=>{const p=document.getElementById("allResultsContainer"),g=document.querySelector('button[onclick="toggleResultsContent()"]');if(!p){console.error("❌ allResultsContainer not found");return}if(!g){console.error("❌ Button not found");return}const y=p.style.display!=="none";p.style.display=y?"none":"block",g.textContent=y?"Show Results":"Hide Results"};const f={};window.toggleSection=p=>{console.log(`🔧 toggleSection called with sectionId: ${p}`);const g=Date.now();if(f[p]&&g-f[p]<300){console.log(`🔧 Ignoring rapid successive call for ${p}`);return}f[p]=g;const y=document.getElementById(p);if(!y){console.error(`❌ Section with id '${p}' not found!`);return}const v=y.style.display!=="none";y.style.display=v?"none":"block";const _=document.querySelector(`button[onclick="toggleSection('${p}')"]`);_&&(_.textContent=v?"Show":"Hide")},window.addClickListeners=()=>{console.log("🔧 Adding click listeners to section headers...");const p=document.querySelectorAll(".section-header");console.log(`🔧 Found ${p.length} section headers`),p.forEach((g,y)=>{const v=g.textContent.trim();if(console.log(`🔧 Processing header ${y+1}:`,v),g.dataset.listenerAdded==="true"){console.log(`🔧 Skipping header ${v} - listener already added`);return}g.addEventListener("click",()=>{const _=g.dataset.sectionId;_&&window.toggleSection(_)}),g.dataset.listenerAdded="true",console.log(`🔧 Added click listener to header: ${v}`)})},window.makeFieldEditable=p=>{const g=p.textContent;p.dataset.field;const y=document.createElement("input");y.type="text",y.value=g,y.className="editable-input";const v=document.createElement("button");v.textContent="Save",v.className="btn-save",v.onclick=()=>window.saveField(p,y,v,_);const _=document.createElement("button");_.textContent="Cancel",_.className="btn-cancel",_.onclick=()=>{p.textContent=g,p.style.display="block",y.remove(),v.remove(),_.remove()},p.style.display="none",p.parentNode.insertBefore(y,p),p.parentNode.insertBefore(v,p),p.parentNode.insertBefore(_,p)},window.saveField=(p,g,y,v)=>{const _=g.value.trim(),b=p.dataset.field,E=p.dataset.recordId;if(!_){alert("Field cannot be empty");return}console.log(`Saving field ${b} for record ${E} with value: ${_}`),p.textContent=_,p.style.display="block",g.remove(),y.remove(),v.remove()},window.showTestDataDeletion=()=>console.log("showTestDataDeletion called"),window.hideTestDataDeletionForm=()=>console.log("hideTestDataDeletionForm called"),window.loadTeacherGradesClasses=()=>console.log("loadTeacherGradesClasses called"),window.checkTeacherSubjects=()=>console.log("checkTeacherSubjects called"),window.initializeTestDeletion=()=>console.log("initializeTestDeletion called"),window.handleAssignmentDeletion=()=>console.log("handleAssignmentDeletion called"),window.handleTestDataDeletion=()=>console.log("handleTestDataDeletion called"),window.getSelectedGradesClasses=()=>console.log("getSelectedGradesClasses called"),window.hideAssignmentDeletionForm=()=>console.log("hideAssignmentDeletionForm called"),window.addKeyboardAccessibility=()=>console.log("addKeyboardAccessibility called"),window.testToggleSection=()=>console.log("testToggleSection called"),window.testAllToggles=()=>console.log("testAllToggles called"),window.manualToggleTest=()=>console.log("manualToggleTest called"),window.addEditableFieldListeners=()=>console.log("addEditableFieldListeners called"),window.deleteTest=()=>console.log("deleteTest called"),window.testLocalStorage=()=>{console.log("Testing localStorage...");try{localStorage.setItem("test","value");const p=localStorage.getItem("test");return localStorage.removeItem("test"),console.log("✅ localStorage is working"),!0}catch(p){return console.error("❌ localStorage error:",p),!1}},window.clearAllLocalStorage=()=>{console.log("Clearing all localStorage..."),localStorage.clear(),console.log("✅ localStorage cleared")},window.exportLocalStorage=()=>{console.log("Exporting localStorage...");const p={};for(let _=0;_<localStorage.length;_++){const b=localStorage.key(_);p[b]=localStorage.getItem(b)}const g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),y=URL.createObjectURL(g),v=document.createElement("a");v.href=y,v.download="localStorage-backup.json",v.click(),URL.revokeObjectURL(y)},console.log("✅ Admin functions exposed globally")},[]);return e()?o.jsx(Zte,{}):o.jsxs("div",{className:"admin-error",children:[o.jsx("h2",{children:"Access Denied"}),o.jsx("p",{children:"You don't have permission to access the admin dashboard."}),o.jsx("button",{onClick:r,children:"Return to Login"})]})},e_=({children:e,allowedRoles:t})=>{const{isAuthenticated:r,role:n,isLoading:s}=Bn();return s?o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):r?t&&!t.includes(n)?o.jsx(r0,{to:"/unauthorized",replace:!0}):e:o.jsx(r0,{to:"/login",replace:!0})},tre=()=>o.jsxs("div",{className:"unauthorized-page",children:[o.jsx("h1",{children:"Access Denied"}),o.jsx("p",{children:"You don't have permission to access this page."})]}),rre=()=>o.jsx(W3,{children:o.jsx(Uj,{children:o.jsx(Lj,{children:o.jsx(DR,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:o.jsx("div",{className:"app",children:o.jsxs(b2,{children:[o.jsx(ss,{path:"/login",element:o.jsx(HW,{})}),o.jsx(ss,{path:"/unauthorized",element:o.jsx(tre,{})}),o.jsx(ss,{path:"/student/*",element:o.jsx(e_,{allowedRoles:["student"],children:o.jsx(Vz,{})})}),o.jsx(ss,{path:"/teacher/*",element:o.jsx(e_,{allowedRoles:["teacher"],children:o.jsx(Jte,{})})}),o.jsx(ss,{path:"/admin/*",element:o.jsx(e_,{allowedRoles:["admin"],children:o.jsx(ere,{})})}),o.jsx(ss,{path:"/",element:o.jsx(r0,{to:"/login",replace:!0})}),o.jsx(ss,{path:"*",element:o.jsx(r0,{to:"/login",replace:!0})})]})})})})})});class nre{constructor(){this.tokenKey="auth_token",this.refreshTokenKey="refresh_token",this.userKey="user_data"}getToken(){return localStorage.getItem(this.tokenKey)}getRefreshToken(){return localStorage.getItem(this.refreshTokenKey)}getUserData(){const t=localStorage.getItem(this.userKey);return t?JSON.parse(t):null}setToken(t){localStorage.setItem(this.tokenKey,t)}setRefreshToken(t){localStorage.setItem(this.refreshTokenKey,t)}setUserData(t){localStorage.setItem(this.userKey,JSON.stringify(t))}setTokens(t,r){this.setToken(t),this.setUserData({role:r}),localStorage.setItem("accessToken",t)}isAuthenticated(){const t=this.getToken();if(!t)return!1;try{const r=JSON.parse(atob(t.split(".")[1])),n=Date.now()/1e3;return r.exp>n}catch(r){return console.error("Error decoding token:",r),!1}}getUserRole(){const t=this.getUserData();return t?t.role:null}isAdmin(){return this.getUserRole()==="admin"}isTeacher(){return this.getUserRole()==="teacher"}isStudent(){return this.getUserRole()==="student"}clearAuth(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.refreshTokenKey),localStorage.removeItem(this.userKey)}logout(){this.clearAuth(),window.location.href="/login"}getAuthHeader(){const t=this.getToken();return t?`Bearer ${t}`:null}async makeAuthenticatedRequest(t,r={}){const n=this.getToken();if(!n)throw new Error("No authentication token found");const s={"Content-Type":"application/json",Authorization:`Bearer ${n}`,...r.headers},a=await fetch(t,{...r,headers:s});if(a.status===401){if(await this.refreshToken())return s.Authorization=`Bearer ${this.getToken()}`,fetch(t,{...r,headers:s});throw this.logout(),new Error("Authentication failed")}return a}async refreshToken(){const t=this.getRefreshToken();if(!t)return!1;try{const r=await fetch("/.netlify/functions/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(r.ok){const n=await r.json();return this.setToken(n.token),n.refreshToken&&this.setRefreshToken(n.refreshToken),!0}}catch(r){console.error("Error refreshing token:",r)}return!1}getAccessToken(){return this.getToken()}decodeToken(t){try{return JSON.parse(atob(t.split(".")[1]))}catch(r){return console.error("Error decoding token:",r),null}}init(){return this.isAuthenticated()?(this.setupTokenRefresh(),!0):(window.location.pathname!=="/login"&&(window.location.href="/login"),!1)}setupTokenRefresh(){setInterval(async()=>{this.isAuthenticated()&&await this.refreshToken()},3e3*1e3)}}const v2=new nre;window.tokenManager=v2;typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{v2.init()}):v2.init());class uP{constructor(){this.currentRole=null,this.loadedFunctions=new Set,this.blockedFunctions=new Set,this.initialized=!1,this.retryCount=0,this.maxRetries=20}initialize(){if(this.initialized){console.log("[DEBUG] Role-based loader already initialized, skipping...");return}if(this.retryCount>=this.maxRetries){console.warn("[DEBUG] Max retries reached, stopping role-based loader initialization");return}if(this.retryCount++,(this.retryCount%5===1||this.retryCount===this.maxRetries)&&console.log(`[DEBUG] Role-based loader initializing... (attempt ${this.retryCount}/${this.maxRetries})`),console.log("[DEBUG] Token manager available:",!!window.tokenManager),window.tokenManager&&window.tokenManager.isAuthenticated()){const t=window.tokenManager.getUserRole();console.log("[DEBUG] Role from token manager:",t),console.log("[DEBUG] Access token exists:",!!window.tokenManager.getAccessToken()),t?(this.currentRole=t,this.initialized=!0,this.retryCount=0,this.setupRoleBasedAccess()):(console.log("[DEBUG] No role found, waiting for role to be set..."),setTimeout(()=>this.initialize(),500))}else console.log("[DEBUG] Token manager not available or not authenticated, waiting..."),setTimeout(()=>this.initialize(),500)}setupRoleBasedAccess(){this.currentRole||(console.warn("No role detected, defaulting to student access"),this.currentRole="student");let t=!1;try{const r=window.tokenManager.getAccessToken();r&&(t=window.tokenManager.decodeToken(r).role==="admin")}catch(r){console.warn("Could not decode token for admin check:",r),t=!1}console.log(`Role-based loader initialized for: ${this.currentRole}${t?" (admin)":""}`),this.loadRoleSpecificFunctions(),this.setupRoleBasedUI(),this.replaceBlockedFunctions()}loadRoleSpecificFunctions(){this.currentRole==="teacher"?this.loadTeacherFunctions():this.currentRole==="student"&&this.loadStudentFunctions()}loadTeacherFunctions(){console.log("Teacher functions already available in main script")}loadStudentFunctions(){console.log("Student functions already available in main script")}loadFunction(t,r){console.log(`Function ${t} already available in main script for ${r}`),this.loadedFunctions.add(t)}setupRoleBasedUI(){let t=!1;try{const r=window.tokenManager.getAccessToken();r&&(t=window.tokenManager.decodeToken(r).role==="admin")}catch(r){console.warn("Could not decode token for admin check in UI:",r),t=!1}this.currentRole==="student"&&this.hideTeacherElements(),this.currentRole==="teacher"&&!t&&this.hideStudentElements()}hideTeacherElements(){[".teacher-cabinet",".test-creation-panel",".grade-management-panel",".class-management-panel",'[data-role="teacher"]'].forEach(r=>{document.querySelectorAll(r).forEach(s=>{s.style.display="none",s.classList.add("role-hidden")})})}hideStudentElements(){[".student-cabinet",".test-taking-panel",".results-viewing-panel",'[data-role="student"]'].forEach(r=>{document.querySelectorAll(r).forEach(s=>{s.style.display="none",s.classList.add("role-hidden")})})}replaceBlockedFunctions(){this.currentRole==="student"?this.blockTeacherFunctions():this.currentRole==="teacher"&&this.blockStudentFunctions()}blockTeacherFunctions(){Object.entries({createTest:()=>this.showAccessDenied("teacher"),assignTest:()=>this.showAccessDenied("teacher"),gradeTest:()=>this.showAccessDenied("teacher"),manageClasses:()=>this.showAccessDenied("teacher"),viewAllResults:()=>this.showAccessDenied("teacher")}).forEach(([r,n])=>{window[r]&&(this.blockedFunctions.add(r),window[r]=n)})}blockStudentFunctions(){Object.entries({takeTest:()=>this.showAccessDenied("student"),submitTest:()=>this.showAccessDenied("student"),viewMyResults:()=>this.showAccessDenied("student")}).forEach(([r,n])=>{window[r]&&(this.blockedFunctions.add(r),window[r]=n)})}showAccessDenied(t){const r=`Access denied. This function requires ${t} role.`;console.warn(r),typeof showNotification=="function"?showNotification(r,"warning"):alert(r)}isFunctionBlocked(t){return this.blockedFunctions.has(t)}isFunctionLoaded(t){return this.loadedFunctions.has(t)}getCurrentRole(){return this.currentRole}hasRole(t){return this.currentRole===t}reloadRoleAccess(){this.initialize()}setupAccessAfterLogin(){if(console.log("[DEBUG] Setting up role-based access after login..."),console.log("[DEBUG] Role-based loader will now initialize (no more retry loop before login)"),!window.tokenManager)return console.error("[ERROR] Token manager not available during setupAccessAfterLogin"),!1;if(!window.tokenManager.isAuthenticated())return console.error("[ERROR] User not authenticated during setupAccessAfterLogin"),!1;const t=window.tokenManager.getUserRole();return t?(console.log("[DEBUG] Setting role after login:",t),this.currentRole=t,this.initialized=!0,this.retryCount=0,this.setupRoleBasedAccess(),console.log("[DEBUG] Role-based access setup completed successfully for role:",t),!0):(console.error("[ERROR] No role found in token during setupAccessAfterLogin"),!1)}}window.roleBasedLoader=new uP;typeof O1<"u"&&O1.exports&&(O1.exports=uP);const sre=()=>{console.log("[DEBUG] Initializing application with new structure");const e={schemaVersion:"2.0",enhancedFeatures:!0,newUserStructure:!0,newTestStructure:!0};localStorage.setItem("app_init_data",JSON.stringify(e)),console.log("[DEBUG] Application initialized with enhanced features")},are=()=>{console.log("[DEBUG] Starting main application"),sre(),WP.createRoot(document.getElementById("root")).render(o.jsx(ns.StrictMode,{children:o.jsx(rre,{})}))};are()});export default ire();
